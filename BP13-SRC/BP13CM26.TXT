       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CM26.                                                 
       AUTHOR.        CS94317.                                                  
      *DATE-WRITTEN.  08/08/23.                                                 
                                                                                
      ******************************************************************        
      *   OBJECTIVE : TO DETERMINE CORE NUCLEUS PERSON(S) IN THE                
      *               APPLICATION EVER GOTTEN A CHANCE TO BOOK A FLAT           
      *               IN THE PAST 5 YEARS FROM APPLICATION REQUEST DATE         
      *================================================================*        
      * FILES DESCRIPTION :                                            *        
      *                ACCESS     REC                                  *        
      * DD NAME  I/O/E  MODE      LEN  KEY          REMARKS            *        
      * -------  ----- -------    ---  ---          -------            *        
      ******************************************************************        
      * CHG REF    DATE     BY    DESCRIPTION                          *        
      * -------- -------- ------- -----------                          *        
      * BP139530 08092023 CS94317 NEW PROGRAM TO BOOK A FLAT IN THE    *        
      *                           PAST 5 YEARS FROM APPLICATION REQUEST*        
      *                           DATE                                 *        
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13FIN1 ASSIGN TO BP13FIN1.                                  
                                                                                
           SELECT BP13K595 ASSIGN       TO BP13K595                             
                           ORGANIZATION IS INDEXED                              
                           RECORD KEY   IS K595-KEY-FLD                         
                           ACCESS MODE  IS DYNAMIC                              
                           FILE STATUS  IS WS-K595-FILE-STATUS                  
                           ALTERNATE KEY IS K595-NUM-NRIC1                      
                           ALTERNATE KEY IS K595-NUM-NRIC2                      
                           ALTERNATE KEY IS K595-NUM-NRIC3                      
                           ALTERNATE KEY IS K595-NUM-NRIC4.                     
                                                                                
           SELECT BP13K800 ASSIGN       TO BP13K800                             
                           ORGANIZATION IS INDEXED                              
                           RECORD KEY   IS K800-NUM-REGN                        
                           ACCESS MODE  IS RANDOM                               
                           FILE STATUS  IS K800-FILE-STATUS.                    
                                                                                
           SELECT BP13K893 ASSIGN       TO BP13K893                             
                           ORGANIZATION IS INDEXED                              
                           RECORD KEY   IS K893-KEY-FLD                         
                           ACCESS MODE  IS DYNAMIC                              
                           FILE STATUS  IS K893-FILE-STATUS.                    
                                                                                
           SELECT BP13FIN2 ASSIGN TO BP13FIN2.                                  
           SELECT BP13FOT1 ASSIGN TO BP13FOT1.                                  
           SELECT BP13FOT2 ASSIGN TO BP13FOT2.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *** INPUT RECORD LAYOUT ***                                               
                                                                                
       FD  BP13FIN1 LABEL RECORDS STANDARD.                                     
       01  BP13FIN1-REC.                                                        
           05 FIN1-HDR-REC.                                                     
              10 FIN1-HDR-TYPE              PIC X.                              
              10 FIN1-HDR-DTE-BALLOT-QTR    PIC 9(6).                           
              10 FIN1-LOW-VALUES            PIC X(8).                           
              10 FIN1-DTE-CREATE            PIC 9(8).                           
              10 FIN1-TIME-CREATE           PIC 9(6).                           
              10 FIN1-HDR-FILLER            PIC X(72).                          
                                                                                
           05 FIN1-DTL1-REC REDEFINES FIN1-HDR-REC.                             
              10 FIN1-RCD1-TYPE             PIC X.                              
              10 FIN1-DTL-DTE-BALLOT-QTR    PIC 9(6).                           
              10 FIN1-NUM-REGN              PIC X(8).                           
              10 FIN1-CDE-ELIG-SCH          PIC X(3).                           
              10 FIN1-NUM-ALLO-CAT          PIC X(3).                           
              10 FIN1-CDE-HOUSEHOLD         PIC X.                              
              10 FIN1-NUM-FT2T              PIC X.                              
              10 FIN1-DTE-REQUEST           PIC X(8).                           
              10 FIN1-NUM-HFE               PIC X(9).                           
              10 FIN1-DTE-HFE-APPLN         PIC X(8).                           
              10 FIN1-CDE-FAMILY-OUTCOME    PIC X.                              
              10 FIN1-CDE-RES-OUTCOME       PIC X.                              
              10 FIN1-DTL-FILLER-1          PIC X(5).                           
              10 FIN1-CDE-CHANCE-OUTCOME    PIC X.                              
              10 FIN1-CDE-FTPMC             PIC X.                              
              10 FIN1-REMARK                PIC X(30).                          
              10 FIN1-DTL-FILLER-2          PIC X(14).                          
                                                                                
           05 FIN1-DTL2-REC REDEFINES FIN1-DTL1-REC.                            
              10 FIN1-RCD2-TYPE             PIC X.                              
              10 FIN1-DTL2-DTE-BALLOT-QTR   PIC 9(6).                           
              10 FIN1-NUM-REGN2             PIC X(8).                           
              10 FIN1-NUM-NRIC              PIC X(9).                           
              10 FIN1-NUM-LESSEE-CHECK      PIC X.                              
              10 FIN1-DTL2-FILLER           PIC X(76).                          
                                                                                
           05 FIN1-CTL-REC REDEFINES FIN1-HDR-REC.                              
              10 FIN1-CTL-TYPE              PIC X.                              
              10 FIN1-CTL-DTE-BALLOT-QTR    PIC 9(6).                           
              10 FIN1-HIGH-VALUES           PIC X(8).                           
              10 FIN1-RCD-CNT               PIC 9(8).                           
              10 FIN1-CTL-FILLER            PIC X(78).                          
                                                                                
       FD   BP13K595                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            LABEL RECORD IS STANDARD.                                           
       COPY BP13K595.                                                           
                                                                                
       FD   BP13K800                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORD IS STANDARD.                                           
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K893                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2050 CHARACTERS                                     
            LABEL RECORD IS STANDARD.                                           
       COPY BP13K893.                                                           
                                                                                
       FD  BP13FIN2 LABEL RECORDS STANDARD.                                     
       01  BP13FIN2-REC.                                                        
           05 FIN2-BKSTS-1                PIC X(2).                             
           05 FIN2-BKSTS-2                PIC X(2).                             
           05 FIN2-BKSTS-3                PIC X(2).                             
           05 FIN2-BKSTS-4                PIC X(2).                             
           05 FIN2-BKSTS-5                PIC X(2).                             
           05 FIN2-BKSTS-6                PIC X(2).                             
           05 FIN2-BKSTS-7                PIC X(2).                             
           05 FIN2-BKSTS-8                PIC X(2).                             
           05 FIN2-BKSTS-9                PIC X(2).                             
           05 FIN2-BKSTS-10               PIC X(2).                             
           05 FIN2-BKSTS-11               PIC X(2).                             
           05 FIN2-BKSTS-12               PIC X(2).                             
           05 FIN2-BKSTS-13               PIC X(2).                             
           05 FIN2-BKSTS-14               PIC X(2).                             
           05 FIN2-BKSTS-15               PIC X(2).                             
           05 FIN2-BKSTS-16               PIC X(2).                             
           05 FIN2-BKSTS-17               PIC X(2).                             
           05 FIN2-BKSTS-18               PIC X(2).                             
           05 FIN2-BKSTS-19               PIC X(2).                             
           05 FIN2-BKSTS-20               PIC X(2).                             
           05 FIN2-BKSTS-21               PIC X(2).                             
           05 FIN2-BKSTS-22               PIC X(2).                             
           05 FIN2-BKSTS-23               PIC X(2).                             
           05 FIN2-BKSTS-24               PIC X(2).                             
           05 FIN2-BKSTS-25               PIC X(2).                             
           05 FIN2-BKSTS-26               PIC X(2).                             
           05 FIN2-BKSTS-27               PIC X(2).                             
           05 FIN2-BKSTS-28               PIC X(2).                             
           05 FIN2-BKSTS-29               PIC X(2).                             
           05 FIN2-BKSTS-30               PIC X(2).                             
           05 FIN2-FILLER                 PIC X(20).                            
                                                                                
       FD  BP13FOT1                                                             
           BLOCK CONTAINS     0 RECORDS                                         
           RECORD CONTAINS  100 CHARACTERS                                      
           RECORDING MODE    IS F                                               
           LABEL RECORD      IS STANDARD.                                       
       01  BP13FOT1-REC.                                                        
           05 FOT1-HDR-REC.                                                     
              10 FOT1-HDR-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT1-HDR-LOW-VAL         PIC X(8).                             
              10 FOT1-DTE-CREATE          PIC 9(8).                             
              10 FOT1-TIME-CREATE         PIC 9(6).                             
              10 FOT1-HDR-FILLER          PIC X(72).                            
                                                                                
           05 FOT1-DTL-REC REDEFINES FOT1-HDR-REC.                              
              10 FOT1-DTL-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT1-NUM-REGN            PIC X(8).                             
              10 FOT1-CDE-ELIG-SCH        PIC X(3).                             
              10 FOT1-NUM-ALLO-CAT        PIC X(3).                             
              10 FOT1-CDE-HOUSEHOLD       PIC X.                                
              10 FOT1-NUM-FT2T            PIC X.                                
              10 FOT1-DTE-REQUEST         PIC X(8).                             
              10 FOT1-NUM-HFE             PIC X(9).                             
              10 FOT1-DTE-HFE-APPLN       PIC X(8).                             
              10 FOT1-CDE-FAMILY-OUTCOME  PIC X.                                
              10 FOT1-CDE-RES-OUTCOME     PIC X.                                
              10 FOT1-DTL-FILLER-1        PIC X(5).                             
              10 FOT1-CDE-CHANCE-OUTCOME  PIC X.                                
              10 FOT1-CDE-FTPMC           PIC X.                                
              10 FOT1-REMARK              PIC X(30).                            
              10 FOT1-DTL-FILLER-2        PIC X(14).                            
                                                                                
           05 FOT1-CTL-REC REDEFINES FOT1-HDR-REC.                              
              10 FOT1-CTL-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT1-CTL-HIGH-VAL        PIC X(8).                             
              10 FOT1-RCD-CNT             PIC 9(8).                             
              10 FOT1-CTL-FILLER          PIC X(78).                            
                                                                                
       FD  BP13FOT2                                                             
           BLOCK CONTAINS     0 RECORDS                                         
           RECORD CONTAINS  100 CHARACTERS                                      
           RECORDING MODE    IS F                                               
           LABEL RECORD      IS STANDARD.                                       
       01  BP13FOT2-REC.                                                        
           05 FOT2-HDR-REC.                                                     
              10 FOT2-HDR-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT2-HDR-LOW-VAL         PIC X(8).                             
              10 FOT2-DTE-CREATE          PIC 9(8).                             
              10 FOT2-TIME-CREATE         PIC 9(6).                             
              10 FOT2-HDR-FILLER          PIC X(72).                            
                                                                                
           05 FOT2-DTL-REC REDEFINES FOT2-HDR-REC.                              
              10 FOT2-DTL-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT2-NUM-REGN            PIC X(8).                             
              10 FOT2-CDE-ELIG-SCH        PIC X(3).                             
              10 FOT2-NUM-ALLO-CAT        PIC X(3).                             
              10 FOT2-CDE-HOUSEHOLD       PIC X.                                
              10 FOT2-NUM-FT2T            PIC X.                                
              10 FOT2-DTE-REQUEST         PIC X(8).                             
              10 FOT2-NUM-HFE             PIC X(9).                             
              10 FOT2-DTE-HFE-APPLN       PIC X(8).                             
              10 FOT2-CDE-FAMILY-OUTCOME  PIC X.                                
              10 FOT2-CDE-RES-OUTCOME     PIC X.                                
              10 FOT2-DTL-FILLER-1        PIC X(5).                             
              10 FOT2-CDE-CHANCE-OUTCOME  PIC X.                                
              10 FOT2-CDE-FTPMC           PIC X.                                
              10 FOT2-REMARK              PIC X(30).                            
              10 FOT2-DTL-FILLER-2        PIC X(14).                            
                                                                                
           05 FOT2-CTL-REC REDEFINES FOT2-HDR-REC.                              
              10 FOT2-CTL-DTE-BALLOT-QTR  PIC 9(6).                             
              10 FOT2-CTL-HIGH-VAL        PIC X(8).                             
              10 FOT2-RCD-CNT             PIC 9(8).                             
              10 FOT2-CTL-FILLER          PIC X(78).                            
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-FIN1-EOF                 PIC X(1) VALUE 'N'.                   
           05 WS-FIN2-EOF                 PIC X(1) VALUE 'N'.                   
           05 WS-EOF-K595                 PIC X(1) VALUE 'N'.                   
           05 WS-EOF-K800                 PIC X(1) VALUE 'N'.                   
           05 WS-EOF-K893                 PIC X(1) VALUE 'N'.                   
           05 WS-NRIC-FND                 PIC X(1) VALUE 'N'.                   
           05 WS-RCD-TP1-FND              PIC X    VALUE 'N'.                   
           05 WS-RCD-TP2-FND              PIC X    VALUE 'N'.                   
           05 WS-HAD-CHANCE               PIC X    VALUE SPACE.                 
           05 WS-RCD-TP2-NOTFND-CASE      PIC X    VALUE SPACE.                 
           05 WS-FIN1-DET-CNT             PIC 9(6) VALUE ZERO.                  
           05 WS-MTH-CNT                  PIC 9(6) VALUE ZERO.                  
           05 WS-MATCH-CNT                PIC 9    VALUE ZERO.                  
           05 WS-FIN1-CNT                 PIC 9(6) VALUE ZERO.                  
           05 WS-FIN1-RCD1-CNT            PIC 9(6) VALUE ZERO.                  
           05 WS-FIN1-RCD2-CNT            PIC 9(6) VALUE ZERO.                  
           05 WS-ACP-CNT                  PIC 9(6) VALUE ZERO.                  
           05 WS-REJ-CNT                  PIC 9(6) VALUE ZERO.                  
           05 WS-TYP2-BYPASS-CNT          PIC 9(6) VALUE ZERO.                  
           05 WS-FIN1-TYPE2-CNT           PIC 9(6) VALUE ZERO.                  
           05 WS-FIN1-READ                PIC X    VALUE SPACES.                
           05 WS-FOT1-NUM-REGN            PIC X(8).                             
           05 WS-FIN1-DTL-DTE-BALLOT-QTR  PIC 9(6).                             
           05 WS-K595-FILE-STATUS         PIC 9(2) VALUE 0.                     
           05 K800-FILE-STATUS            PIC 9(2) VALUE 0.                     
           05 K893-FILE-STATUS            PIC 9(2) VALUE 0.                     
           05 WS-K595-DTE-BALLOT.                                               
              10 WS-K595-DTE-BALLOT-CCYY  PIC 9(4) VALUE 0.                     
              10 WS-K595-DTE-BALLOT-MM    PIC 9(2) VALUE 0.                     
           05 WS-FIN1-DTE-REQUEST.                                              
              10 WS-FIN1-DTE-REQUEST-CCYY PIC 9(4) VALUE 0.                     
              10 WS-FIN1-DTE-REQUEST-MM   PIC 9(2) VALUE 0.                     
              10 WS-FIN1-DTE-REQUEST-DD   PIC 9(2) VALUE 0.                     
           05 WS-COMPUTE-MTH              PIC X    VALUE SPACES.                
           05 WS-X                        PIC 9(2) VALUE ZEROES.                
           05 WS-NCBKSTS-CNT              PIC 9(2) VALUE ZEROES.                
           05 WS-NCBKSTS-1 OCCURS 30 TIMES.                                     
              10 WS-NCBKSTS               PIC X(2) VALUE SPACES.                
           05 WS-CDE-RES-OUTCOME          PIC X    VALUE SPACES.                
           05 WS-FIN1-NUM-REGN            PIC X(8).                             
           05 WS-FIN1-CDE-ELIG-SCH        PIC X(3).                             
           05 WS-FIN1-NUM-ALLO-CAT        PIC X(3).                             
           05 WS-FIN1-CDE-HOUSEHOLD       PIC X.                                
           05 WS-FIN1-NUM-FT2T            PIC X.                                
           05 WS-FIN1-DATE-REQUEST        PIC X(8).                             
           05 WS-FIN1-NUM-HFE             PIC X(9).                             
           05 WS-FIN1-DTE-HFE-APPLN       PIC X(8).                             
           05 WS-FROM-DATE                PIC X(8).                             
           05 WS-NS-DATE                  PIC X(8).                             
           05 WS-TO-DATE                  PIC X(8).                             
           05 WS-CHK-NS-DATE              PIC X(8).                             
           05 WS-FIN1-CDE-FAMILY-OUTCOME  PIC X.                                
           05 WS-FIN1-CDE-RES-OUTCOME     PIC X.                                
           05 WS-FIN1-CDE-CHANCE-OUTCOME  PIC X.                                
           05 WS-FIN1-CDE-FTPMC           PIC X.                                
           05 WS-FIN1-REMARK              PIC X(30).                            
           05 WS-REJ                      PIC X.                                
                                                                                
                                                                                
           05 WS-CURR-DTETIME.                                                  
              10 WS-CURR-CDTE.                                                  
                 15 WS-CURR-CDTE-CCYY     PIC X(04) VALUE SPACES.               
                 15 WS-CURR-CDTE-MM       PIC X(02) VALUE SPACES.               
                 15 WS-CURR-CDTE-DD       PIC X(02) VALUE SPACES.               
              10 WS-CURR-TME              PIC X(06) VALUE SPACES.               
                                                                                
           05 WS-DTE-CURR                 PIC 9(08) VALUE ZEROES.               
           05 WS-TME-CURR                 PIC 9(06) VALUE ZEROES.               
           05 WS-DTE-CREATE               PIC 9(08) VALUE ZEROES.               
           05 WS-TIME-CREATE              PIC 9(06) VALUE ZEROES.               
           05 WS-DTE-BALLOT-QTR           PIC 9(06) VALUE ZEROES.               
           05 WS-CDE-FAMILY-OUTCOME       PIC X     VALUE SPACES.               
           05 WS-ERR-MSG                  PIC X(50) VALUE SPACES.               
           05 WS-REJ-TAG                  PIC X     VALUE SPACES.               
           05 WS-DTE-HFE-APPLN.                                                 
              10 WS-DTE-HFE-APPLN-CCYY    PIC 9(4)  VALUE ZEROES.               
              10 WS-DTE-HFE-APPLN-MM      PIC 9(2)  VALUE ZEROES.               
              10 WS-DTE-HFE-APPLN-DD      PIC 9(2)  VALUE ZEROES.               
           05 WS-REJ-REMARK               PIC X(30) VALUE SPACES.               
           05 WS-CURR-NUM-REGN            PIC X(9)  VALUE SPACES.               
           05 WS-EOF-FIN1                 PIC X     VALUE 'N'.                  
           05 WS-EOF-FIN2                 PIC X     VALUE 'N'.                  
           05 WS-AGE                      PIC 9(3)  VALUE ZEROES.               
           05 WS-AGE-DAY.                                                       
              10 WS-YRS                   PIC 9(3) VALUE ZEROES.                
              10 WS-MTH                   PIC S9(2) VALUE ZEROES.               
              10 WS-DAY                   PIC S9(2) VALUE ZEROES.               
           05 WS-FIN2-DOB.                                                      
              10 WS-FIN2-DOB-CCYY         PIC 9(4).                             
              10 WS-FIN2-DOB-MM           PIC 9(2).                             
              10 WS-FIN2-DOB-DD           PIC 9(2).                             
                                                                                
       LINKAGE SECTION.                                                         
                                                                                
       COPY P13CARM.                                                            
                                                                                
       PROCEDURE DIVISION USING P13CARMWR.                                      
                                                                                
      ****************                                                          
       0000-MAIN-PROC.                                                          
      ****************                                                          
           PERFORM 1000-OPEN-FILES       THRU 1000-EXIT                         
           PERFORM 2000-VALIDATE-INPUT   THRU 2000-EXIT                         
           PERFORM 3000-MAIN-PROCESS     THRU 3000-EXIT                         
                   UNTIL WS-FIN1-EOF = 'Y' OR                                   
                         FIN1-NUM-REGN >= HIGH-VALUES                           
           PERFORM 6000-CTL-REC          THRU 6000-EXIT                         
           PERFORM 7000-CTL-SUMMARY      THRU 7000-EXIT                         
           PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                               
           STOP RUN                                                             
           .                                                                    
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *******************************************************                   
       1000-OPEN-FILES.                                                         
      *******************************************************                   
           OPEN INPUT  BP13FIN1                                                 
                       BP13FIN2                                                 
                       BP13K595                                                 
                       BP13K800                                                 
                       BP13K893                                                 
                                                                                
                OUTPUT BP13FOT1                                                 
                       BP13FOT2                                                 
           .                                                                    
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **********************                                                    
       2000-VALIDATE-INPUT.                                                     
      **********************                                                    
           READ BP13FIN2                                                        
             AT END                                                             
                DISPLAY 'BP13CM26-E01: BP13FIN2 IS EMPTY'                       
                MOVE 'BP13CM26-E01: BP13FIN2 IS EMPTY' TO WS-ERR-MSG            
                PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                          
                PERFORM 9999-CANCEL-JOB THRU 9999-EXIT                          
             NOT AT END                                                         
               MOVE 0 TO WS-NCBKSTS-CNT                                         
                                                                                
               IF FIN2-BKSTS-1 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-1  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-2 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-2  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-3 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-3  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-4 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-4  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-5 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-5  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-6 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-6  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-7 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-7  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-8 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-8  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-9 NOT = SPACE                                      
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-9  TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-10 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-10 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-11 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-11 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-12 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-12 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-13 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-13 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-14 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-14 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-15 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-15 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-16 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-16 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-17 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-17 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-18 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-18 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-19 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-19 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-20 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-20 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-21 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-21 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-22 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-22 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-23 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-23 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
               IF FIN2-BKSTS-24 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-24 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-25 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-25 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-26 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-26 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-27 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-27 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-28 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-28 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-29 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-29 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
                                                                                
               IF FIN2-BKSTS-30 NOT = SPACE                                     
                  ADD 1              TO WS-NCBKSTS-CNT                          
                  MOVE FIN2-BKSTS-30 TO WS-NCBKSTS(WS-NCBKSTS-CNT)              
               END-IF                                                           
           END-READ                                                             
                                                                                
           READ BP13FIN1                                                        
             AT END                                                             
                DISPLAY 'BP13CM26-E02: BP13FIN1 IS EMPTY'                       
                MOVE 'BP13CM26-E02: BP13FIN1 IS EMPTY' TO WS-ERR-MSG            
                PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                          
                PERFORM 9999-CANCEL-JOB THRU 9999-EXIT                          
             NOT AT END                                                         
                IF FIN1-RCD1-TYPE = 0 AND FIN1-LOW-VALUES = LOW-VALUES          
                   MOVE FIN1-DTE-CREATE         TO FOT1-DTE-CREATE              
                                                   FOT2-DTE-CREATE              
                   MOVE FIN1-TIME-CREATE        TO FOT1-TIME-CREATE             
                                                   FOT2-TIME-CREATE             
                   MOVE FIN1-HDR-DTE-BALLOT-QTR TO                              
                                              FOT1-HDR-DTE-BALLOT-QTR           
                                              FOT2-HDR-DTE-BALLOT-QTR           
                   PERFORM 2300-HDR-REC         THRU 2300-EXIT                  
                   PERFORM 2100-READ-FIN1       THRU 2100-EXIT                  
                   SUBTRACT 1                   FROM WS-FIN1-CNT                
                END-IF                                                          
           END-READ                                                             
                                                                                
           IF WS-K595-FILE-STATUS NOT = 00 AND 97                               
              DISPLAY 'BP13CM26-E03: BP13K595 FILE OPENING ERROR'               
              MOVE 'BP13CM26-E03: BP13K595 FILE OPENING ERROR' TO               
                                           WS-ERR-MSG                           
              DISPLAY 'K595-FILE-STATUS :' WS-K595-FILE-STATUS                  
              PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                            
              PERFORM 9999-CANCEL-JOB THRU 9999-EXIT                            
           END-IF                                                               
                                                                                
           IF K800-FILE-STATUS NOT = 00 AND 97                                  
              DISPLAY 'BP13CM26-E04: BP13K800 FILE OPENING ERROR'               
              MOVE 'BP13CM26-E04: BP13K800 FILE OPENING ERROR' TO               
                                           WS-ERR-MSG                           
              DISPLAY 'K800-FILE-STATUS :' K800-FILE-STATUS                     
              PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                            
              PERFORM 9999-CANCEL-JOB THRU 9999-EXIT                            
           END-IF                                                               
                                                                                
           IF K893-FILE-STATUS NOT = 00 AND 97                                  
              DISPLAY 'BP13CM26-E05: BP13K893 FILE OPENING ERROR'               
              MOVE 'BP13CM26-E05: BP13K893 FILE OPENING ERROR' TO               
                                           WS-ERR-MSG                           
              DISPLAY 'K893-FILE-STATUS :' K893-FILE-STATUS                     
              PERFORM 9998-CLOSE-FILE THRU 9998-EXIT                            
              PERFORM 9999-CANCEL-JOB THRU 9999-EXIT                            
           END-IF                                                               
                                                                                
           PERFORM 2200-INIT-VALUES       THRU 2200-EXIT                        
           .                                                                    
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *******************                                                       
       2200-INIT-VALUES.                                                        
      *******************                                                       
           MOVE SPACES            TO WS-FOT1-NUM-REGN                           
                                     WS-FIN1-CDE-ELIG-SCH                       
                                     WS-FIN1-NUM-ALLO-CAT                       
                                     WS-FIN1-CDE-HOUSEHOLD                      
                                     WS-FIN1-NUM-FT2T                           
                                     WS-FIN1-DATE-REQUEST                       
                                     WS-FIN1-NUM-HFE                            
                                     WS-FIN1-DTE-HFE-APPLN                      
                                     WS-FIN1-CDE-FAMILY-OUTCOME                 
                                     WS-FIN1-CDE-RES-OUTCOME                    
                                     WS-FIN1-CDE-CHANCE-OUTCOME                 
                                     WS-FIN1-CDE-FTPMC                          
                                     WS-FIN1-REMARK                             
           MOVE 'N'               TO WS-COMPUTE-MTH                             
           MOVE 0                 TO WS-FIN1-DTE-REQUEST                        
           MOVE 0                 TO WS-K595-DTE-BALLOT                         
                                     WS-MTH-CNT                                 
           .                                                                    
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************                                                            
       2300-HDR-REC.                                                            
      **************                                                            
           INITIALIZE FOT1-HDR-REC                                              
           INITIALIZE FOT2-HDR-REC                                              
           MOVE LOW-VALUES              TO FOT1-HDR-LOW-VAL                     
                                           FOT2-HDR-LOW-VAL                     
           MOVE FIN1-DTE-CREATE         TO FOT1-DTE-CREATE                      
                                           FOT2-DTE-CREATE                      
           MOVE FIN1-TIME-CREATE        TO FOT1-TIME-CREATE                     
                                           FOT2-TIME-CREATE                     
           MOVE FIN1-HDR-DTE-BALLOT-QTR TO FOT1-HDR-DTE-BALLOT-QTR              
                                           FOT2-HDR-DTE-BALLOT-QTR              
           MOVE SPACES                  TO FOT1-HDR-FILLER                      
                                           FOT2-HDR-FILLER                      
           WRITE BP13FOT1-REC                                                   
           WRITE BP13FOT2-REC                                                   
           .                                                                    
       2300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *******************                                                       
       3000-MAIN-PROCESS.                                                       
      *******************                                                       
           MOVE SPACE                TO WS-HAD-CHANCE                           
           MOVE 'N'                  TO WS-REJ                                  
           MOVE 'N'                  TO WS-COMPUTE-MTH                          
           MOVE 0                    TO WS-MTH-CNT                              
           IF FIN1-RCD1-TYPE = '1'                                              
              PERFORM 3100-PROCESS-RCD-TYPE1 THRU 3100-EXIT                     
              ADD 1                  TO WS-FIN1-RCD1-CNT                        
           ELSE                                                                 
              IF FIN1-RCD1-TYPE = '2'                                           
                 ADD 1               TO WS-TYP2-BYPASS-CNT                      
                 ADD 1               TO WS-FIN1-RCD2-CNT                        
                 PERFORM 2100-READ-FIN1       THRU 2100-EXIT                    
              END-IF                                                            
           END-IF                                                               
           .                                                                    
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************                                                          
       2100-READ-FIN1.                                                          
      ****************                                                          
           READ BP13FIN1                                                        
             AT END                                                             
                MOVE 'Y'              TO WS-FIN1-EOF                            
             NOT AT END                                                         
                ADD 1 TO WS-FIN1-CNT                                            
           .                                                                    
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ************************                                                  
       3100-PROCESS-RCD-TYPE1.                                                  
      ************************                                                  
           MOVE 'Y'                     TO WS-RCD-TP1-FND                       
           MOVE FIN1-DTL-DTE-BALLOT-QTR TO WS-FIN1-DTL-DTE-BALLOT-QTR           
           MOVE FIN1-NUM-REGN           TO WS-CURR-NUM-REGN                     
           MOVE FIN1-NUM-REGN           TO WS-FOT1-NUM-REGN                     
           MOVE FIN1-CDE-ELIG-SCH       TO WS-FIN1-CDE-ELIG-SCH                 
           MOVE FIN1-NUM-ALLO-CAT       TO WS-FIN1-NUM-ALLO-CAT                 
           MOVE FIN1-CDE-HOUSEHOLD      TO WS-FIN1-CDE-HOUSEHOLD                
           MOVE FIN1-NUM-FT2T           TO WS-FIN1-NUM-FT2T                     
           MOVE FIN1-DTE-REQUEST        TO WS-FIN1-DATE-REQUEST                 
                                           WS-FIN1-DTE-REQUEST                  
           MOVE FIN1-NUM-HFE            TO WS-FIN1-NUM-HFE                      
           MOVE FIN1-DTE-HFE-APPLN      TO WS-FIN1-DTE-HFE-APPLN                
           MOVE FIN1-CDE-FAMILY-OUTCOME TO WS-FIN1-CDE-FAMILY-OUTCOME           
           MOVE FIN1-CDE-RES-OUTCOME    TO WS-FIN1-CDE-RES-OUTCOME              
           MOVE FIN1-CDE-FAMILY-OUTCOME TO WS-CDE-RES-OUTCOME                   
           MOVE FIN1-CDE-FTPMC          TO WS-FIN1-CDE-FTPMC                    
           MOVE FIN1-REMARK             TO WS-FIN1-REMARK                       
           PERFORM 2100-READ-FIN1       THRU 2100-EXIT                          
           PERFORM 2400-PROCESS-CHK-TYPE2 THRU 2400-EXIT                        
           .                                                                    
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ************************                                                  
       2400-PROCESS-CHK-TYPE2.                                                  
      ************************                                                  
           IF FIN1-RCD1-TYPE = '2'                                              
              IF FIN1-NUM-REGN = WS-CURR-NUM-REGN                               
                 MOVE 'Y'     TO WS-RCD-TP2-FND                                 
                 PERFORM 3200-PROCESS-RCD-TYPE2 THRU 3200-EXIT                  
                     UNTIL FIN1-RCD1-TYPE NOT = '2' OR                          
                         FIN1-NUM-REGN NOT = WS-CURR-NUM-REGN OR                
                         WS-FIN1-EOF = 'Y'                                      
                 IF WS-HAD-CHANCE = SPACE                                       
                    MOVE 'N'                    TO WS-HAD-CHANCE                
                 END-IF                                                         
              ELSE                                                              
                 MOVE 'PERSON DATA NOT FOUND'   TO WS-REJ-REMARK                
                 MOVE 'Y'                       TO WS-HAD-CHANCE                
      *          MOVE 'Y'                       TO WS-REJ                       
              END-IF                                                            
           ELSE                                                                 
              MOVE 'PERSON DATA NOT FOUND'   TO WS-REJ-REMARK                   
              MOVE 'Y'                       TO WS-HAD-CHANCE                   
      *       MOVE 'Y'                       TO WS-REJ                          
           END-IF                                                               
                                                                                
           IF WS-HAD-CHANCE = 'N'                                               
              MOVE WS-CDE-RES-OUTCOME    TO WS-FIN1-CDE-CHANCE-OUTCOME          
              PERFORM 8000-OUT-ACCEPT    THRU 8000-EXIT                         
           END-IF                                                               
                                                                                
           IF WS-HAD-CHANCE = 'Y'                                               
      *       IF WS-MTH-CNT = 0 AND WS-REJ = 'N'                                
      *          MOVE 'INVALID DATES'   TO WS-REJ-REMARK                        
      *       ELSE                                                              
      *          IF WS-MTH-CNT > 0 AND WS-REJ = 'N'                             
      *             MOVE 'HAD CHANCE TO BOOK FLAT' TO WS-REJ-REMARK             
      *          END-IF                                                         
      *       END-IF                                                            
              MOVE 'N'                  TO WS-FIN1-CDE-CHANCE-OUTCOME           
              MOVE 'N'                  TO WS-FIN1-CDE-FTPMC                    
              PERFORM 9000-OUT-REJECT   THRU 9000-EXIT                          
           END-IF                                                               
           .                                                                    
       2400-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ************************                                                  
       3200-PROCESS-RCD-TYPE2.                                                  
      ************************                                                  
           PERFORM 3300-PROCESS-NRICS   THRU 3300-EXIT                          
           ADD 1                        TO WS-FIN1-RCD2-CNT                     
           PERFORM 2100-READ-FIN1       THRU 2100-EXIT                          
           .                                                                    
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ********************                                                      
       3300-PROCESS-NRICS.                                                      
      ********************                                                      
           PERFORM 3400-FOUND-NRICS     THRU 3400-EXIT                          
           .                                                                    
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************                                                        
       3400-FOUND-NRICS.                                                        
      ******************                                                        
           PERFORM 3500-FIND-BY-NRIC1     THRU 3500-EXIT                        
                                                                                
           IF WS-NRIC-FND = 'N' AND WS-HAD-CHANCE = SPACE                       
              PERFORM 3600-FIND-BY-NRIC2  THRU 3600-EXIT                        
           END-IF                                                               
                                                                                
           IF WS-NRIC-FND = 'N' AND WS-HAD-CHANCE = SPACE                       
              PERFORM 3700-FIND-BY-NRIC3  THRU 3700-EXIT                        
           END-IF                                                               
                                                                                
           IF WS-NRIC-FND = 'N' AND WS-HAD-CHANCE = SPACE                       
              PERFORM 3800-FIND-BY-NRIC4  THRU 3800-EXIT                        
           END-IF                                                               
           .                                                                    
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       3500-FIND-BY-NRIC1.                                                      
      ********************                                                      
           PERFORM 3900-INITIAL-BP13K595  THRU 3900-EXIT                        
           MOVE FIN1-NUM-NRIC             TO K595-NUM-NRIC1                     
                                                                                
           START BP13K595 KEY >= K595-NUM-NRIC1                                 
                                                                                
           EVALUATE WS-K595-FILE-STATUS                                         
           WHEN 00                                                              
           WHEN 02                                                              
              PERFORM 4000-READ-BP13K595          THRU 4000-EXIT                
                                                                                
              IF K595-NUM-NRIC1 = FIN1-NUM-NRIC                                 
                 PERFORM 4100-PROCESS-BP13K595-NRIC1 THRU 4100-EXIT             
                 UNTIL WS-EOF-K595 = 'Y' OR                                     
                       WS-HAD-CHANCE = 'Y'                                      
              ELSE                                                              
                 CONTINUE                                                       
              END-IF                                                            
           WHEN 20                                                              
           WHEN 23                                                              
              CONTINUE                                                          
           WHEN OTHER                                                           
              DISPLAY 'BP13CM26-E06: BP13K595 READING ERROR.'                   
              DISPLAY 'K595-STATUS : ' WS-K595-FILE-STATUS                      
              DISPLAY 'NRIC        : ' FIN1-NUM-NRIC                            
              PERFORM 9998-CLOSE-FILE  THRU 9998-EXIT                           
              PERFORM 9999-CANCEL-JOB  THRU 9999-EXIT                           
           END-EVALUATE                                                         
           .                                                                    
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       3600-FIND-BY-NRIC2.                                                      
      ********************                                                      
           PERFORM 3900-INITIAL-BP13K595  THRU 3900-EXIT                        
           MOVE FIN1-NUM-NRIC             TO K595-NUM-NRIC2                     
                                                                                
           START BP13K595 KEY >= K595-NUM-NRIC2                                 
                                                                                
           EVALUATE WS-K595-FILE-STATUS                                         
           WHEN 00                                                              
           WHEN 02                                                              
              PERFORM 4000-READ-BP13K595          THRU 4000-EXIT                
              IF K595-NUM-NRIC2 = FIN1-NUM-NRIC                                 
                 PERFORM 4200-PROCESS-BP13K595-NRIC2 THRU 4200-EXIT             
                 UNTIL WS-EOF-K595 = 'Y' OR                                     
                       WS-HAD-CHANCE = 'Y'                                      
              ELSE                                                              
                 CONTINUE                                                       
              END-IF                                                            
           WHEN 20                                                              
           WHEN 23                                                              
              CONTINUE                                                          
           WHEN OTHER                                                           
              DISPLAY 'BP13CM26-E07: BP13K595 READING ERROR.'                   
              DISPLAY 'K595-STATUS : ' WS-K595-FILE-STATUS                      
              DISPLAY 'NRIC        : ' FIN1-NUM-NRIC                            
              PERFORM 9998-CLOSE-FILE  THRU 9998-EXIT                           
              PERFORM 9999-CANCEL-JOB  THRU 9999-EXIT                           
           END-EVALUATE                                                         
           .                                                                    
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       3700-FIND-BY-NRIC3.                                                      
      ********************                                                      
           PERFORM 3900-INITIAL-BP13K595  THRU 3900-EXIT                        
           MOVE FIN1-NUM-NRIC             TO K595-NUM-NRIC3                     
                                                                                
           START BP13K595 KEY >= K595-NUM-NRIC3                                 
                                                                                
           EVALUATE WS-K595-FILE-STATUS                                         
           WHEN 00                                                              
           WHEN 02                                                              
              PERFORM 4000-READ-BP13K595          THRU 4000-EXIT                
                                                                                
              IF K595-NUM-NRIC3 = FIN1-NUM-NRIC                                 
                 PERFORM 4300-PROCESS-BP13K595-NRIC3 THRU 4300-EXIT             
                 UNTIL WS-EOF-K595 = 'Y' OR                                     
                       WS-HAD-CHANCE = 'Y'                                      
              ELSE                                                              
                 CONTINUE                                                       
              END-IF                                                            
           WHEN 20                                                              
           WHEN 23                                                              
              CONTINUE                                                          
           WHEN OTHER                                                           
              DISPLAY 'BP13CM26-E08: BP13K595 READING ERROR.'                   
              DISPLAY 'K595-STATUS : ' WS-K595-FILE-STATUS                      
              DISPLAY 'NRIC        : ' FIN1-NUM-NRIC                            
              PERFORM 9998-CLOSE-FILE  THRU 9998-EXIT                           
              PERFORM 9999-CANCEL-JOB  THRU 9999-EXIT                           
           END-EVALUATE                                                         
           .                                                                    
       3700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       3800-FIND-BY-NRIC4.                                                      
      ********************                                                      
           PERFORM 3900-INITIAL-BP13K595  THRU 3900-EXIT                        
           MOVE FIN1-NUM-NRIC             TO K595-NUM-NRIC4                     
                                                                                
           START BP13K595 KEY >= K595-NUM-NRIC4                                 
                                                                                
           EVALUATE WS-K595-FILE-STATUS                                         
           WHEN 00                                                              
           WHEN 02                                                              
              PERFORM 4000-READ-BP13K595          THRU 4000-EXIT                
                                                                                
              IF K595-NUM-NRIC4 = FIN1-NUM-NRIC                                 
                 PERFORM 4400-PROCESS-BP13K595-NRIC4 THRU 4400-EXIT             
                 UNTIL WS-EOF-K595 = 'Y' OR                                     
                       WS-HAD-CHANCE = 'Y'                                      
              ELSE                                                              
                 CONTINUE                                                       
              END-IF                                                            
           WHEN 20                                                              
           WHEN 23                                                              
              CONTINUE                                                          
           WHEN OTHER                                                           
              DISPLAY 'BP13CM26-E09: BP13K595 READING ERROR.'                   
              DISPLAY 'K595-STATUS : ' WS-K595-FILE-STATUS                      
              DISPLAY 'NRIC        : ' FIN1-NUM-NRIC                            
              PERFORM 9998-CLOSE-FILE  THRU 9998-EXIT                           
              PERFORM 9999-CANCEL-JOB  THRU 9999-EXIT                           
           END-EVALUATE                                                         
           .                                                                    
       3800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***********************                                                   
       3900-INITIAL-BP13K595.                                                   
      ***********************                                                   
           MOVE 'N'                      TO WS-NRIC-FND                         
                                            WS-EOF-K595                         
           MOVE SPACES                   TO BP13K595-REC                        
           MOVE ZERO                     TO WS-K595-FILE-STATUS                 
           INITIALIZE BP13K595-REC                                              
           .                                                                    
       3900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       4000-READ-BP13K595.                                                      
      ********************                                                      
           READ BP13K595 NEXT RECORD                                            
              AT END MOVE 'Y' TO WS-EOF-K595                                    
           .                                                                    
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************************                                             
       4100-PROCESS-BP13K595-NRIC1.                                             
      *****************************                                             
           IF K595-NUM-NRIC1 = FIN1-NUM-NRIC                                    
              PERFORM 5000-DTRMINE-FTPMC-ELIG THRU 5000-EXIT                    
           ELSE                                                                 
              MOVE 'Y'                        TO WS-EOF-K595                    
           END-IF                                                               
           PERFORM 4000-READ-BP13K595         THRU 4000-EXIT                    
           .                                                                    
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************************                                             
       4200-PROCESS-BP13K595-NRIC2.                                             
      *****************************                                             
           IF K595-NUM-NRIC2 = FIN1-NUM-NRIC                                    
              PERFORM 5000-DTRMINE-FTPMC-ELIG THRU 5000-EXIT                    
           ELSE                                                                 
              MOVE 'Y'                        TO WS-EOF-K595                    
           END-IF                                                               
           PERFORM 4000-READ-BP13K595         THRU 4000-EXIT                    
           .                                                                    
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************************                                             
       4300-PROCESS-BP13K595-NRIC3.                                             
      *****************************                                             
           IF K595-NUM-NRIC3 = FIN1-NUM-NRIC                                    
              PERFORM 5000-DTRMINE-FTPMC-ELIG THRU 5000-EXIT                    
           ELSE                                                                 
              MOVE 'Y'                        TO WS-EOF-K595                    
           END-IF                                                               
           PERFORM 4000-READ-BP13K595         THRU 4000-EXIT                    
           .                                                                    
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************************                                             
       4400-PROCESS-BP13K595-NRIC4.                                             
      *****************************                                             
           IF K595-NUM-NRIC4 = FIN1-NUM-NRIC                                    
              PERFORM 5000-DTRMINE-FTPMC-ELIG THRU 5000-EXIT                    
           ELSE                                                                 
              MOVE 'Y'                        TO WS-EOF-K595                    
           END-IF                                                               
           PERFORM 4000-READ-BP13K595         THRU 4000-EXIT                    
           .                                                                    
       4400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************                                                 
       5000-DTRMINE-FTPMC-ELIG.                                                 
      *************************                                                 
           MOVE 'N'                    TO WS-CHK-NS-DATE                        
           MOVE K595-DTE-BALLOT        TO WS-K595-DTE-BALLOT                    
                                                                                
           IF K595-CDE-REQUEST-STATUS NOT = 'C'   AND                           
              K595-CDE-REQUEST-STATUS NOT = SPACE AND                           
              K595-NUM-BOOK-STATUS    NOT = SPACE AND                           
              (K595-NUM-ALLO-CAT = 'BTO' OR                                     
              K595-NUM-ALLO-CAT = 'SBF')                                        
                                                                                
              PERFORM 5100-DTRMINE-CHANCE-BK-STS  THRU 5100-EXIT                
              IF WS-CHK-NS-DATE = 'Y'                                           
                 PERFORM 5400-GET-NS-DATE        THRU 5400-EXIT                 
              END-IF                                                            
           END-IF                                                               
           .                                                                    
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       5100-DTRMINE-CHANCE-BK-STS.                                              
      ****************************                                              
           MOVE 1                        TO WS-X                                
           MOVE 0                        TO WS-MATCH-CNT                        
           PERFORM 5300-BK-STS-CNT       THRU 5300-EXIT                         
                 UNTIL WS-X > WS-NCBKSTS-CNT                                    
           IF WS-MATCH-CNT = 0                                                  
              MOVE 'Y'                   TO WS-CHK-NS-DATE                      
           END-IF                                                               
           .                                                                    
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************                                                
      *5200-COMPUTE-MONTH-COUNT.                                                
      **************************                                                
      *    IF WS-K595-DTE-BALLOT = ZEROES OR                                    
      *       WS-K595-DTE-BALLOT = SPACES OR                                    
      *       WS-FIN1-DTE-REQUEST = ZEROES OR                                   
      *       WS-FIN1-DTE-REQUEST = SPACES                                      
      *       COMPUTE WS-MTH-CNT = 0                                            
      *    ELSE                                                                 
      *       COMPUTE WS-MTH-CNT = (WS-FIN1-DTE-REQUEST-CCYY * 12 +             
      *                             WS-FIN1-DTE-REQUEST-MM) -                   
      *                            (WS-K595-DTE-BALLOT-CCYY * 12 +              
      *                             WS-K595-DTE-BALLOT-MM)                      
      *    END-IF                                                               
      *    .                                                                    
      *5200-EXIT.                                                               
      *    EXIT.                                                                
                                                                                
      ***********************                                                   
       5200-DTRMINE-NS-DATE.                                                    
      ***********************                                                   
           MOVE WS-FIN1-DTE-REQUEST        TO WS-TO-DATE                        
           PERFORM 5500-DTRMINE-FROM-DATE  THRU 5500-EXIT                       
                                                                                
           IF WS-FROM-DATE NOT = SPACE AND                                      
              WS-FROM-DATE NOT = ZERO  AND                                      
              WS-NS-DATE   NOT = SPACE AND                                      
              WS-NS-DATE   NOT = ZERO  AND                                      
              WS-TO-DATE   NOT = SPACE AND                                      
              WS-TO-DATE   NOT = ZERO                                           
              IF WS-NS-DATE >= WS-FROM-DATE AND                                 
                 WS-NS-DATE <= WS-TO-DATE                                       
                 MOVE 'Y' TO WS-HAD-CHANCE                                      
                 MOVE 'Y' TO WS-NRIC-FND                                        
                 MOVE 'HAD CHANCE TO BOOK FLAT' TO WS-REJ-REMARK                
              END-IF                                                            
           ELSE                                                                 
              MOVE 'Y' TO WS-HAD-CHANCE                                         
              MOVE 'Y' TO WS-NRIC-FND                                           
              MOVE 'INVALID DATES'              TO WS-REJ-REMARK                
           END-IF                                                               
           .                                                                    
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       5300-BK-STS-CNT.                                                         
      *****************                                                         
           IF K595-NUM-BOOK-STATUS = WS-NCBKSTS(WS-X)                           
              ADD 1                       TO WS-MATCH-CNT                       
           END-IF                                                               
           ADD 1                          TO WS-X                               
           .                                                                    
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *******************                                                       
       5400-GET-NS-DATE.                                                        
      *******************                                                       
                                                                                
           MOVE ZERO TO WS-NS-DATE                                              
                                                                                
           MOVE SPACES                 TO BP13K800-MASTER                       
           INITIALIZE BP13K800-MASTER                                           
           MOVE K595-NUM-REGN          TO K800-NUM-REGN                         
                                                                                
           READ BP13K800                                                        
                                                                                
           EVALUATE K800-FILE-STATUS                                            
           WHEN 00                                                              
              MOVE K800-DTE-BK-APPT           TO WS-NS-DATE                     
              PERFORM 5200-DTRMINE-NS-DATE     THRU 5200-EXIT                   
           WHEN 10                                                              
           WHEN 23                                                              
              PERFORM 5600-CHK-APPLN-HISTORY  THRU 5600-EXIT                    
           WHEN OTHER                                                           
              MOVE 0                          TO WS-NS-DATE                     
           END-EVALUATE                                                         
           .                                                                    
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************                                                 
       5500-DTRMINE-FROM-DATE.                                                  
      *************************                                                 
           INITIALIZE P13CARMWR.                                                
           MOVE WS-FIN1-DTE-REQUEST        TO CARM-DATE-IN                      
           MOVE 'S'                        TO CARM-OPR-CODE                     
           MOVE 000                        TO CARM-NO-OF-DAY                    
           MOVE 00                         TO CARM-NO-OF-MONTH                  
           MOVE 05                         TO CARM-NO-OF-YEAR                   
           CALL 'BP13CARM' USING P13CARMWR                                      
                                                                                
           IF CARM-RETURN-CODE = '00'                                           
              MOVE CARM-DATE-OUT           TO WS-FROM-DATE                      
           ELSE                                                                 
              MOVE 0                       TO WS-FROM-DATE                      
           END-IF                                                               
           .                                                                    
       5500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************                                                 
       5600-CHK-APPLN-HISTORY.                                                  
      *************************                                                 
           MOVE 'N' TO WS-EOF-K893                                              
                                                                                
           MOVE SPACES                 TO BP13K893-MASTER                       
           INITIALIZE BP13K893-MASTER                                           
           MOVE K595-NUM-REGN          TO K893-NUM-REGN-HIST                    
                                                                                
           START BP13K893 KEY >= K893-NUM-REGN-HIST                             
                                                                                
           EVALUATE K893-FILE-STATUS                                            
           WHEN 00                                                              
              PERFORM 5700-READ-BP13K893      THRU 5700-EXIT                    
              PERFORM UNTIL WS-EOF-K893 = 'Y' OR WS-HAD-CHANCE = 'Y'            
                 IF K893-NUM-REGN-HIST = K595-NUM-REGN                          
                    MOVE K893-DTE-BK-APPT TO WS-NS-DATE                         
                    PERFORM 5200-DTRMINE-NS-DATE     THRU 5200-EXIT             
                 ELSE                                                           
                    MOVE 'Y' TO WS-EOF-K893                                     
                 END-IF                                                         
                 PERFORM 5700-READ-BP13K893 THRU 5700-EXIT                      
              END-PERFORM                                                       
           WHEN OTHER                                                           
              MOVE 'Y' TO WS-EOF-K893                                           
           END-EVALUATE                                                         
           .                                                                    
       5600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       5700-READ-BP13K893.                                                      
      *********************                                                     
           READ BP13K893 NEXT RECORD                                            
              AT END                                                            
                 MOVE 'Y' TO WS-EOF-K893.                                       
                                                                                
           EVALUATE K893-FILE-STATUS                                            
           WHEN 00                                                              
           WHEN 02                                                              
              CONTINUE                                                          
           WHEN OTHER                                                           
              MOVE 'Y' TO WS-EOF-K893                                           
           END-EVALUATE                                                         
           .                                                                    
       5700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************                                                           
       6000-CTL-REC.                                                            
      ***************                                                           
           INITIALIZE FOT1-CTL-REC                                              
           INITIALIZE FOT2-CTL-REC                                              
           MOVE FIN1-CTL-DTE-BALLOT-QTR TO FOT1-CTL-DTE-BALLOT-QTR              
                                           FOT2-CTL-DTE-BALLOT-QTR              
           MOVE HIGH-VALUES             TO FOT1-CTL-HIGH-VAL                    
                                           FOT2-CTL-HIGH-VAL                    
           COMPUTE FOT1-RCD-CNT = WS-ACP-CNT                                    
           COMPUTE FOT2-RCD-CNT = WS-REJ-CNT                                    
           MOVE SPACES                  TO FOT1-CTL-FILLER                      
                                           FOT2-CTL-FILLER                      
           WRITE BP13FOT1-REC                                                   
           WRITE BP13FOT2-REC                                                   
           .                                                                    
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************                                                        
       7000-CTL-SUMMARY.                                                        
      ******************                                                        
           DISPLAY 'BP13CM26-I01: CONTROL SUMMARY'                              
           DISPLAY 'BP13FIN1 PROCESS DETAIL CNT :' WS-FIN1-CNT                  
           DISPLAY 'BP13FIN1 TYP1 RCD CNT       :' WS-FIN1-RCD1-CNT             
           DISPLAY 'BP13FIN1 TYP2 RCD CNT       :' WS-FIN1-RCD2-CNT             
           DISPLAY 'BP13FIN1 TYP2 BYPASS CNT    :' WS-TYP2-BYPASS-CNT           
           DISPLAY 'ACCEPTED CNT                :' WS-ACP-CNT                   
           DISPLAY 'REJECTED CNT                :' WS-REJ-CNT                   
           .                                                                    
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       8000-OUT-ACCEPT.                                                         
      *****************                                                         
           MOVE WS-FIN1-DTL-DTE-BALLOT-QTR TO FOT1-DTL-DTE-BALLOT-QTR           
           MOVE WS-FOT1-NUM-REGN           TO FOT1-NUM-REGN                     
           MOVE WS-FIN1-CDE-ELIG-SCH       TO FOT1-CDE-ELIG-SCH                 
           MOVE WS-FIN1-NUM-ALLO-CAT       TO FOT1-NUM-ALLO-CAT                 
           MOVE WS-FIN1-CDE-HOUSEHOLD      TO FOT1-CDE-HOUSEHOLD                
           MOVE WS-FIN1-NUM-FT2T           TO FOT1-NUM-FT2T                     
           MOVE WS-FIN1-DATE-REQUEST       TO FOT1-DTE-REQUEST                  
           MOVE WS-FIN1-NUM-HFE            TO FOT1-NUM-HFE                      
           MOVE WS-FIN1-DTE-HFE-APPLN      TO FOT1-DTE-HFE-APPLN                
           MOVE WS-FIN1-CDE-FAMILY-OUTCOME TO FOT1-CDE-FAMILY-OUTCOME           
           MOVE WS-FIN1-CDE-RES-OUTCOME    TO FOT1-CDE-RES-OUTCOME              
           MOVE WS-FIN1-CDE-CHANCE-OUTCOME TO FOT1-CDE-CHANCE-OUTCOME           
           MOVE WS-FIN1-CDE-FTPMC          TO FOT1-CDE-FTPMC                    
           MOVE WS-FIN1-REMARK             TO FOT1-REMARK                       
           MOVE SPACES                     TO FOT1-DTL-FILLER-1                 
           MOVE SPACES                     TO FOT1-DTL-FILLER-2                 
           ADD  1                          TO WS-ACP-CNT                        
           WRITE BP13FOT1-REC                                                   
           .                                                                    
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       9000-OUT-REJECT.                                                         
      *****************                                                         
           MOVE WS-FIN1-DTL-DTE-BALLOT-QTR TO FOT2-DTL-DTE-BALLOT-QTR           
           MOVE WS-FOT1-NUM-REGN           TO FOT2-NUM-REGN                     
           MOVE WS-FIN1-CDE-ELIG-SCH       TO FOT2-CDE-ELIG-SCH                 
           MOVE WS-FIN1-NUM-ALLO-CAT       TO FOT2-NUM-ALLO-CAT                 
           MOVE WS-FIN1-CDE-HOUSEHOLD      TO FOT2-CDE-HOUSEHOLD                
           MOVE WS-FIN1-NUM-FT2T           TO FOT2-NUM-FT2T                     
           MOVE WS-FIN1-DATE-REQUEST       TO FOT2-DTE-REQUEST                  
           MOVE WS-FIN1-NUM-HFE            TO FOT2-NUM-HFE                      
           MOVE WS-FIN1-DTE-HFE-APPLN      TO FOT2-DTE-HFE-APPLN                
           MOVE WS-FIN1-CDE-FAMILY-OUTCOME TO FOT2-CDE-FAMILY-OUTCOME           
           MOVE WS-FIN1-CDE-RES-OUTCOME    TO FOT2-CDE-RES-OUTCOME              
           MOVE WS-FIN1-CDE-CHANCE-OUTCOME TO FOT2-CDE-CHANCE-OUTCOME           
           MOVE WS-FIN1-CDE-FTPMC          TO FOT2-CDE-FTPMC                    
           MOVE WS-REJ-REMARK              TO FOT2-REMARK                       
           MOVE SPACES                     TO FOT2-DTL-FILLER-1                 
           MOVE SPACES                     TO FOT2-DTL-FILLER-2                 
           ADD  1                          TO WS-REJ-CNT                        
           WRITE BP13FOT2-REC                                                   
           .                                                                    
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       9998-CLOSE-FILE.                                                         
      *****************                                                         
           CLOSE BP13FIN1 BP13K595 BP13FIN2 BP13K800 BP13K893                   
                 BP13FOT1 BP13FOT2                                              
           .                                                                    
       9998-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       9999-CANCEL-JOB.                                                         
      *****************                                                         
           MOVE '111' TO RETURN-CODE                                            
           DISPLAY WS-ERR-MSG                                                   
           STOP RUN                                                             
           .                                                                    
       9999-EXIT.                                                               
           EXIT.                                                                
