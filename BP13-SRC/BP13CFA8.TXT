       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13CFA8.                                         00020000
       AUTHOR.        ZDD1.                                             00030000
       DATE-WRITTEN.  28 JUNE 2017.                                     00040000
                                                                        00050000
      *************************************************************     00060000
      *        SYSTEM OF COMMITMENT               (BP13)          *     00070000
      *===========================================================*     00080000
      *                                                           *     00090000
      *  OBJECTIVE   : Generate XML files for FTP to send         *     00100000
      *                automated SMS                              *     00110000
      *                                                           *     00120000
      *  INPUT FILES  : BP13F213                                  *     00130000
      *               : SY02F001                                  *     00140000
      *                                                           *     00150000
      *                                                           *     00160000
      *                                                           *     00170000
      *  OUTPUT FILE  : BP13F213                                  *     00180000
      *                                                           *     00190000
      *-----------------------------------------------------------*     00200000
      *                                                           *     00210000
      * CHGE REQ #   DATE       AUTHOR    REMARKS                 *     00220000
      * ----------   --------   ------    -------                 *     00230000
      * BP136992X    28062017   zdd1      NEW PROGRAM             *     00240000
      * BP137216     20022018   zdd1      changes on sms content  *     00250000
      * BP137420     08082018   srg1      changes on sms content  *     00260000
      * BP137602     27022019   MRN1      date ballot to get from *     00270000
      *                                   BP13F213                *     00270105
      * BP137934     23092019   PP11      changes on sms content  *     00271005
      *************************************************************     00290000
                                                                        00300000
       ENVIRONMENT DIVISION.                                            00310000
                                                                        00320000
       CONFIGURATION SECTION.                                           00330000
                                                                        00340000
       SOURCE-COMPUTER. IBM-3090.                                       00350000
       OBJECT-COMPUTER. IBM-3090.                                       00360000
                                                                        00370000
       INPUT-OUTPUT SECTION.                                            00380000
                                                                        00390000
       FILE-CONTROL.                                                    00400000
                                                                        00410000
           SELECT SY02F001  ASSIGN        TO  SY02F001.                 00420000
                                                                        00430000
           SELECT B13DUMMY  ASSIGN        TO  B13DUMMY.                 00440000
                                                                        00450000
           SELECT BP13F213  ASSIGN        TO  BP13F213.                 00460000
                                                                        00470000
           SELECT B13F213A  ASSIGN        TO  B13F213A.                 00480000
           SELECT B13F213B  ASSIGN        TO  B13F213B.                 00490000
           SELECT B13F213C  ASSIGN        TO  B13F213C.                 00500000
           SELECT B13F213D  ASSIGN        TO  B13F213D.                 00510000
           SELECT B13F213E  ASSIGN        TO  B13F213E.                 00520000
                                                                        00530000
       DATA DIVISION.                                                   00540000
                                                                        00550000
       FILE SECTION.                                                    00560000
                                                                        00570000
       FD   B13F213A                    RECORD CONTAINS 700 CHARACTERS  00580000
                                        RECORDING MODE IS F.            00590000
       01   B13F213A-REC                PIC X(700).                     00600000
                                                                        00610000
       FD   B13F213B                    RECORD CONTAINS 700 CHARACTERS  00620000
                                        RECORDING MODE IS F.            00630000
       01   B13F213B-REC                PIC X(700).                     00640000
                                                                        00650000
       FD   B13F213C                    RECORD CONTAINS 700 CHARACTERS  00660000
                                        RECORDING MODE IS F.            00670000
       01   B13F213C-REC                PIC X(700).                     00680000
                                                                        00690000
       FD   B13F213D                    RECORD CONTAINS 700 CHARACTERS  00700000
                                        RECORDING MODE IS F.            00710000
       01   B13F213D-REC                PIC X(700).                     00720000
                                                                        00730000
       FD   B13F213E                    RECORD CONTAINS 700 CHARACTERS  00740000
                                        RECORDING MODE IS F.            00750000
       01   B13F213E-REC                PIC X(700).                     00760000
                                                                        00770000
       FD   B13DUMMY                    RECORD CONTAINS 20  CHARACTERS  00780000
                                        RECORDING MODE IS F.            00790000
       01   B13DUMMY-REC.                                               00800000
            05 B13DUMMY-NUM-MOBILE      PIC X(8).                       00810000
            05 FILLER                   PIC X(12).                      00820000
                                                                        00830000
       FD   BP13F213                    RECORD CONTAINS 200 CHARACTERS  00840000
                                        RECORDING MODE IS F.            00850000
       01  BP13F213-REC.                                                00860000
           05  F213-DETAILS.                                            00870000
               10  F213-NUM-ALLO-MODE         PIC X(3).                 00880000
               10  F213-NUM-NEW-TOWN          PIC X(3).                 00890000
               10  F213-NUM-FLAT-TYPE         PIC X(2).                 00900000
               10  F213-TYPE-APPMT            PIC X(2).                 00910000
               10  F213-NUM-ETHNIC            PIC X(1).                 00920000
           05  F213-KEY-FLD.                                            00930000
               10  F213-NUM-REGN              PIC X(8).                 00940000
           05  F213-DETAILS2.                                           00950000
               10  F213-DTE-BALLOT            PIC X(6).                 00960000
               10  F213-DTE-APPMT             PIC X(8).                 00970000
               10  F213-NUM-QUEUE             PIC X(5).                 00980000
           05  F213-TME-APPMT                 PIC X(4).                 00990000
           05  F213-NUM-NRIC                  PIC X(9).                 01000000
           05  F213-NME-NRIC                  PIC X(66).                01010000
           05  K203-ALT-KEY.                                            01020000
               10  F213-NUM-HP                PIC X(9).                 01030000
           05  F213-NUM-APLCNT                PIC X(3).                 01040000
           05  F213-NUM-ZONE                  PIC X(2).                 01050000
           05  F213-NUM-REF                   PIC X(8).                 01060000
           05  F213-NUM-BLOCK                 PIC X(1).                 01070000
           05  F213-NUM-STATUS                PIC X(1).                 01080000
           05  F213-DTE-BOOK-PD-END           PIC X(8).                 01090000
           05  F213-NUM-UNIT-OFFER            PIC X(4).                 01100000
           05  FILLER                         PIC X(47).                01110000
                                                                        01120000
       COPY SY02F001.                                                   01130000
                                                                        01140000
       WORKING-STORAGE SECTION.                                         01150000
                                                                        01160000
       01  WS-COUNTERS.                                                 01170000
           05  WS-CTR-BP13F213-READ      PIC 9(07) VALUE 0.             01180000
           05  WS-B13F213A-WRT           PIC 9(07) VALUE 0.             01190000
           05  WS-B13F213B-WRT           PIC 9(07) VALUE 0.             01200000
           05  WS-B13F213C-WRT           PIC 9(07) VALUE 0.             01210000
           05  WS-B13F213D-WRT           PIC 9(07) VALUE 0.             01220000
           05  WS-B13F213E-WRT           PIC 9(07) VALUE 0.             01230000
                                                                        01240000
       01  WS-VARIABLES.                                                01250000
           05  WS-BP13K993-STATUS        PIC 9(2)  VALUE 0.             01260000
           05  WS-BP13F213-EOF           PIC X(1)  VALUE  'N'.          01270000
           05  WS-B13DUMMY-EOF           PIC X(1)  VALUE  'N'.          01280000
           05  WS-DTE-CURRENT            PIC X(08).                     01290000
           05  WS-DAY-OF-WEEK            PIC X(3)  VALUE SPACES.        01300000
           05  WS-HOLIDAY                PIC X(3)  VALUE SPACES.        01310000
           05  WS-DTE-PROP-SEND.                                        01320000
               10 WS-DTE-PROP-SEND-CY    PIC X(4)  VALUE SPACES.        01330000
               10 WS-DTE-PROP-SEND-MM    PIC X(2)  VALUE SPACES.        01340000
               10 WS-DTE-PROP-SEND-DD    PIC X(2)  VALUE '15'.          01350000
           05  WS-NUM-TYPE               PIC X(12) VALUE '1STREM2TO4'.  01360000
           05  WS-SEND-LESSEE            PIC X     VALUE 'N'.           01370000
                                                                        01380000
       01  WS-BP13F213-REC.                                             01390000
           05  FILLER                    PIC X(5)                       01400000
                                         VALUE '<SMS>'.                 01410000
           05  FILLER                    PIC X(11)                      01420000
                                         VALUE '<AGENCYREF>'.           01430000
           05  WS-NUM-SMS                PIC 9(16)                      01440000
                                         VALUE ZEROES.                  01450000
           05  FILLER                    PIC X(12)                      01460000
                                         VALUE '</AGENCYREF>'.          01470000
           05  FILLER                    PIC X(06)                      01480000
                                         VALUE '<DEST>'.                01490000
           05  WS-NUM-MOBILE             PIC X(8)                       01500000
                                         VALUE SPACES.                  01510000
           05  FILLER                    PIC X(07)                      01520000
                                         VALUE '</DEST>'.               01530000
           05  FILLER                    PIC X(05)                      01540000
                                         VALUE '<MSG>'.                 01550000
           05  WS-SMS                    PIC X(477).                    01560006
           05  FILLER                    PIC X(06)                      01570000
                                         VALUE '</MSG>'.                01580000
           05  FILLER                    PIC X(06)                      01590000
                                         VALUE '</SMS>'.                01600000
           05  FILLER                    PIC X(34)    VALUE SPACES.     01610000
                                                                        01620000
       01  WS-BP13F213-REC-A.                                           01630000
           05  FILLER                    PIC X(5)                       01640000
                                         VALUE '<SMS>'.                 01650000
           05  FILLER                    PIC X(11)                      01660000
                                         VALUE '<AGENCYREF>'.           01670000
           05  WS-NUM-SMS-A              PIC 9(16)                      01680000
                                         VALUE ZEROES.                  01690000
           05  FILLER                    PIC X(12)                      01700000
                                         VALUE '</AGENCYREF>'.          01710000
           05  FILLER                    PIC X(06)                      01720000
                                         VALUE '<DEST>'.                01730000
           05  WS-NUM-MOBILE-A           PIC X(8)                       01740000
                                         VALUE SPACES.                  01750000
           05  FILLER                    PIC X(07)                      01760000
                                         VALUE '</DEST>'.               01770000
           05  FILLER                    PIC X(05)                      01780000
                                         VALUE '<MSG>'.                 01790000
           05  WS-SMS-A                  PIC X(477).                    01800006
           05  FILLER                    PIC X(06)                      01810000
                                         VALUE '</MSG>'.                01820000
           05  FILLER                    PIC X(06)                      01830000
                                         VALUE '</SMS>'.                01840000
           05  FILLER                    PIC X(263)     VALUE SPACES.   01850000
                                                                        01860000
       01  WS-MESSAGES.                                                 01870000
           05  WS-LESSEE-MSG.                                           01880000
               10 FILLER                 PIC X(033) VALUE               01890000
               'Your balloted queue position for '.                     01900000
               10 WS-BALLOT-MONTH        PIC X(003) VALUE SPACES.       01910000
               10 FILLER                 PIC X(001) VALUE SPACES.       01920000
               10 WS-BALLOT-YEAR         PIC X(004) VALUE SPACES.       01930000
               10 FILLER                 PIC X(013) VALUE               01940000
               ' ROF exercise'.                                         01950000
               10 FILLER                 PIC X(004) VALUE               01960000
               ' is '.                                                  01970000
               10 WS-QUEUE-MSG           PIC X(005) VALUE SPACES.       01980000
               10 FILLER                 PIC X(028) VALUE               01990000
               '. This has far exceeded the '.                          02000000
               10 WS-OFFER-MSG           PIC X(004) VALUE SPACES.       02010000
               10 FILLER                 PIC X(054) VALUE               02020000
               ' flats on offer. But you may have a chance to book a f'.02030000
               10 FILLER                 PIC X(054) VALUE               02040000
               'lat if sufficient applicants queued ahead of you do no'.02050000
               10 FILLER                 PIC X(054) VALUE               02060004
               't book a flat. More details will be provided at a late'.02070000
               10 FILLER                 PIC X(054) VALUE               02080000
               'r date. If you have yet to book a flat, you may contin'.02090000
               10 FILLER                 PIC X(054) VALUE               02091000
               'ue to participate in our BTO, SBF, ROF exercise or the'.02092006
               10 FILLER                 PIC X(054) VALUE               02093000
               ' open booking of flats. Please visit HDB InfoWEB at ww'.02094006
               10 FILLER                 PIC X(054) VALUE               02095000
               'w.hdb.gov.sg for the details when there is a sales lau'.02096006
               10 FILLER                 PIC X(004) VALUE               02097006
               'nch.'.                                                  02098006
                                                                        02160000
           05  WS-START-SMS-MSG          PIC X(500) VALUE               02170000
               'Automated SMS sending has started.'.                    02180000
           05  WS-END-SMS-MSG            PIC X(500) VALUE               02190000
               'Automated SMS sending is finished.'.                    02200000
                                                                        02210000
       01  WS-XML-HEADER                 PIC X(500) VALUE               02220000
               "<?xml version='1.0' encoding='UTF-8'?>".                02230000
       01  WS-XML-START                  PIC X(500) VALUE               02240000
               '<SENDSMSBROADCASTREQ>'.                                 02250000
       01  WS-END-XML                    PIC X(500) VALUE               02260000
               '</SENDSMSBROADCASTREQ>'.                                02270000
                                                                        02280000
       PROCEDURE DIVISION.                                              02290000
                                                                        02300000
      ***************************************************************   02310000
       0000-CONTROL.                                                    02320000
      ***************************************************************   02330000
                                                                        02340000
           PERFORM 1000-START-UP           THRU 1000-EXIT.              02350000
           PERFORM 4000-MAIN-ROUTINE       THRU 4000-EXIT               02360000
                   UNTIL WS-BP13F213-EOF = 'Y'.                         02370000
                                                                        02380000
           PERFORM 9999-WRAP-UP.                                        02390000
                                                                        02400000
                                                                        02410000
      ***************************************************************   02420000
       1000-START-UP.                                                   02430000
      ***************************************************************   02440000
                                                                        02450000
           OPEN INPUT  BP13F213                                         02460000
                       SY02F001                                         02470000
                OUTPUT B13F213A                                         02480000
                       B13F213B                                         02490000
                       B13F213C                                         02500000
                       B13F213D                                         02510000
                       B13F213E.                                        02520000
                                                                        02530000
      *----------------------------------                               02540000
      * Read current date from SY02F001                                 02550000
      *----------------------------------                               02560000
                                                                        02570000
           READ SY02F001.                                               02580000
           MOVE F001-DTE-CURRENT          TO  WS-DTE-CURRENT.           02590000
                                                                        02600000
           MOVE F001-DTE-CURRENT(1:4)     TO  WS-DTE-PROP-SEND-CY.      02610000
           MOVE F001-DTE-CURRENT(5:2)     TO  WS-DTE-PROP-SEND-MM.      02620000
                                                                        02630000
       1000-EXIT.                                                       02640000
            EXIT.                                                       02650000
                                                                        02660000
      ***************************************************************   02670000
       4000-MAIN-ROUTINE.                                               02680000
      ***************************************************************   02690000
                                                                        02700000
           PERFORM 5000-BP13F213-READ    THRU 5000-EXIT.                02710000
           PERFORM 6000-WRITE-XML-FILE   THRU 6000-EXIT.                02720000
                                                                        02730000
       4000-EXIT.                                                       02740000
            EXIT.                                                       02750000
                                                                        02760000
      ***************************************************************   02770000
       5000-BP13F213-READ.                                              02780000
      ***************************************************************   02790000
                                                                        02800000
           READ BP13F213                                                02810000
                AT END                                                  02820000
                   MOVE 'Y'           TO   WS-BP13F213-EOF              02830000
                NOT AT END                                              02840000
                   ADD  1                  TO WS-CTR-BP13F213-READ      02850000
                                              WS-NUM-SMS                02860000
                   MOVE F213-NUM-HP        TO WS-NUM-MOBILE             02870000
                   MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG.           02880000
                   MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG.           02890000
                   MOVE F213-DTE-BALLOT(1:4) TO WS-BALLOT-YEAR.         02900000
                   EVALUATE F213-DTE-BALLOT(5:2)                        02910000
                    WHEN '01'                                           02920000
                      MOVE 'Jan'             TO WS-BALLOT-MONTH         02930000
                    WHEN '02'                                           02940000
                      MOVE 'Feb'             TO WS-BALLOT-MONTH         02950000
                    WHEN '03'                                           02960000
                      MOVE 'Mar'             TO WS-BALLOT-MONTH         02970000
                    WHEN '04'                                           02980000
                      MOVE 'Apr'             TO WS-BALLOT-MONTH         02990000
                    WHEN '05'                                           03000000
                      MOVE 'May'             TO WS-BALLOT-MONTH         03010000
                    WHEN '06'                                           03020000
                      MOVE 'Jun'             TO WS-BALLOT-MONTH         03030000
                    WHEN '07'                                           03040000
                      MOVE 'Jul'             TO WS-BALLOT-MONTH         03050000
                    WHEN '08'                                           03060000
                      MOVE 'Aug'             TO WS-BALLOT-MONTH         03070000
                    WHEN '09'                                           03080000
                      MOVE 'Sep'             TO WS-BALLOT-MONTH         03090000
                    WHEN '10'                                           03100000
                      MOVE 'Oct'             TO WS-BALLOT-MONTH         03110000
                    WHEN '11'                                           03120000
                      MOVE 'Nov'             TO WS-BALLOT-MONTH         03130000
                    WHEN '12'                                           03140000
                      MOVE 'Dec'             TO WS-BALLOT-MONTH         03150000
                   END-EVALUATE.                                        03160000
                                                                        03170000
                                                                        03180000
       5000-EXIT.                                                       03190000
            EXIT.                                                       03200000
                                                                        03210000
      ****************************************************************  03220000
       6000-WRITE-XML-FILE.                                             03230000
      ****************************************************************  03240000
                                                                        03250000
                 IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000          03260000
               PERFORM 6100-WRITE-B13F213A      THRU 6100-EXIT          03270000
            ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000          03280000
               PERFORM 6200-WRITE-B13F213B      THRU 6200-EXIT          03290000
            ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000          03300000
               PERFORM 6300-WRITE-B13F213C      THRU 6300-EXIT          03310000
            ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000          03320000
               PERFORM 6400-WRITE-B13F213D      THRU 6400-EXIT          03330000
            ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000          03340000
               PERFORM 6500-WRITE-B13F213E      THRU 6500-EXIT          03350000
            END-IF.                                                     03360000
                                                                        03370000
       6000-EXIT.                                                       03380000
            EXIT.                                                       03390000
                                                                        03400000
      ****************************************************************  03410000
       6100-WRITE-B13F213A.                                             03420000
      ****************************************************************  03430000
                                                                        03440000
           IF WS-BP13F213-EOF = 'Y'                                     03450000
              IF WS-NUM-SMS > 0                                         03460000
                 ADD 1                     TO WS-NUM-SMS                03470000
                 MOVE 'N'                  TO WS-SEND-LESSEE            03480000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  03490000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             03500000
                 WRITE B13F213A-REC        FROM WS-END-XML              03510000
              END-IF                                                    03520000
              GO TO 6100-EXIT                                           03530000
           END-IF.                                                      03540000
                                                                        03550000
           IF WS-B13F213A-WRT = 0                                       03560000
              WRITE B13F213A-REC        FROM WS-XML-HEADER              03570000
              WRITE B13F213A-REC        FROM WS-XML-START               03580000
                                                                        03590000
      *-------------------------------*                                 03600000
      * WRITE DUMMY RECORD            *                                 03610000
      *-------------------------------*                                 03620000
      * Notify start of sms sending   *                                 03630000
      *-------------------------------*                                 03640000
              MOVE 'N'                  TO WS-SEND-LESSEE               03650000
              MOVE WS-START-SMS-MSG     TO WS-SMS-A                     03660000
              PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT                03670000
                                                                        03680000
      *-------------------------------*                                 03690000
      * Send text msg sent to lessees *                                 03700000
      *-------------------------------*                                 03710000
              MOVE 'Y'                  TO WS-SEND-LESSEE               03720000
              MOVE WS-LESSEE-MSG        TO WS-SMS                       03730000
              PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT                03740000
                                                                        03750000
              MOVE F213-NUM-HP          TO WS-NUM-MOBILE                03760000
              MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG                 03770000
              MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG                 03780000
           END-IF.                                                      03790000
                                                                        03800000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          03810000
           WRITE B13F213A-REC        FROM WS-BP13F213-REC               03820000
           ADD 1                     TO WS-B13F213A-WRT.                03830000
                                                                        03840000
           IF WS-B13F213A-WRT = 2000                                    03850000
              WRITE B13F213A-REC        FROM WS-END-XML.                03860000
                                                                        03870000
       6100-EXIT.                                                       03880000
           EXIT.                                                        03890000
                                                                        03900000
      ****************************************************************  03910000
       6200-WRITE-B13F213B.                                             03920000
      ****************************************************************  03930000
                                                                        03940000
           IF WS-BP13F213-EOF = 'Y'                                     03950000
              IF WS-NUM-SMS > 0                                         03960000
                 ADD 1                     TO WS-NUM-SMS                03970000
                 MOVE 'N'                  TO WS-SEND-LESSEE            03980000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  03990000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             04000000
                 MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE             04010000
                 WRITE B13F213B-REC        FROM WS-END-XML              04020000
              END-IF                                                    04030000
              GO TO 6200-EXIT                                           04040000
           END-IF.                                                      04050000
                                                                        04060000
           IF WS-B13F213B-WRT = 0                                       04070000
              WRITE B13F213B-REC        FROM WS-XML-HEADER              04080000
              WRITE B13F213B-REC        FROM WS-XML-START               04090000
           END-IF.                                                      04100000
                                                                        04110000
           MOVE F213-NUM-HP          TO WS-NUM-MOBILE                   04120000
           MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG                    04130000
           MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG                    04140000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04150000
           WRITE B13F213B-REC        FROM WS-BP13F213-REC               04160000
           ADD 1                     TO WS-B13F213B-WRT.                04170000
                                                                        04180000
           IF WS-B13F213B-WRT = 2000                                    04190000
              WRITE B13F213B-REC        FROM WS-END-XML.                04200000
                                                                        04210000
       6200-EXIT.                                                       04220000
           EXIT.                                                        04230000
                                                                        04240000
      ****************************************************************  04250000
       6300-WRITE-B13F213C.                                             04260000
      ****************************************************************  04270000
                                                                        04280000
           IF WS-BP13F213-EOF = 'Y'                                     04290000
              IF WS-NUM-SMS > 0                                         04300000
                 ADD 1                     TO WS-NUM-SMS                04310000
                 MOVE 'N'                  TO WS-SEND-LESSEE            04320000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  04330000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             04340000
                 WRITE B13F213C-REC        FROM WS-END-XML              04350000
              END-IF                                                    04360000
              GO TO 6300-EXIT                                           04370000
           END-IF.                                                      04380000
                                                                        04390000
           IF WS-B13F213C-WRT = 0                                       04400000
              WRITE B13F213C-REC        FROM WS-XML-HEADER              04410000
              WRITE B13F213C-REC        FROM WS-XML-START               04420000
           END-IF.                                                      04430000
                                                                        04440000
           MOVE F213-NUM-HP          TO WS-NUM-MOBILE                   04450000
           MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG                    04460000
           MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG                    04470000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04480000
           WRITE B13F213C-REC        FROM WS-BP13F213-REC               04490000
           ADD 1                     TO WS-B13F213C-WRT.                04500000
                                                                        04510000
           IF WS-B13F213C-WRT = 2000                                    04520000
              WRITE B13F213C-REC        FROM WS-END-XML.                04530000
                                                                        04540000
       6300-EXIT.                                                       04550000
           EXIT.                                                        04560000
                                                                        04570000
      ****************************************************************  04580000
       6400-WRITE-B13F213D.                                             04590000
      ****************************************************************  04600000
                                                                        04610000
           IF WS-BP13F213-EOF = 'Y'                                     04620000
              IF WS-NUM-SMS > 0                                         04630000
                 ADD 1                     TO WS-NUM-SMS                04640000
                 MOVE 'N'                  TO WS-SEND-LESSEE            04650000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  04660000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             04670000
                 WRITE B13F213D-REC        FROM WS-END-XML              04680000
              END-IF                                                    04690000
              GO TO 6400-EXIT                                           04700000
           END-IF.                                                      04710000
                                                                        04720000
           IF WS-B13F213D-WRT = 0                                       04730000
              WRITE B13F213D-REC        FROM WS-XML-HEADER              04740000
              WRITE B13F213D-REC        FROM WS-XML-START               04750000
           END-IF.                                                      04760000
                                                                        04770000
           MOVE F213-NUM-HP          TO WS-NUM-MOBILE                   04780000
           MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG                    04790000
           MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG                    04800000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04810000
           WRITE B13F213D-REC        FROM WS-BP13F213-REC               04820000
           ADD 1                     TO WS-B13F213D-WRT.                04830000
                                                                        04840000
           IF WS-B13F213D-WRT = 2000                                    04850000
              WRITE B13F213D-REC        FROM WS-END-XML.                04860000
                                                                        04870000
       6400-EXIT.                                                       04880000
           EXIT.                                                        04890000
                                                                        04900000
      ****************************************************************  04910000
       6500-WRITE-B13F213E.                                             04920000
      ****************************************************************  04930000
                                                                        04940000
           IF WS-BP13F213-EOF = 'Y'                                     04950000
              IF WS-NUM-SMS > 0                                         04960000
                 ADD 1                     TO WS-NUM-SMS                04970000
                 MOVE 'N'                  TO WS-SEND-LESSEE            04980000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  04990000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             05000000
                 WRITE B13F213E-REC        FROM WS-END-XML              05010000
              END-IF                                                    05020000
              GO TO 6500-EXIT                                           05030000
           END-IF.                                                      05040000
                                                                        05050000
           IF WS-B13F213E-WRT = 0                                       05060000
              WRITE B13F213E-REC        FROM WS-XML-HEADER              05070000
              WRITE B13F213E-REC        FROM WS-XML-START               05080000
           END-IF.                                                      05090000
                                                                        05100000
           MOVE F213-NUM-HP          TO WS-NUM-MOBILE                   05110000
           MOVE F213-NUM-QUEUE       TO WS-QUEUE-MSG                    05120000
           MOVE F213-NUM-UNIT-OFFER  TO WS-OFFER-MSG                    05130000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          05140000
           WRITE B13F213E-REC        FROM WS-BP13F213-REC               05150000
           ADD 1                     TO WS-B13F213E-WRT.                05160000
                                                                        05170000
           IF WS-B13F213E-WRT = 2000                                    05180000
              WRITE B13F213E-REC        FROM WS-END-XML.                05190000
                                                                        05200000
       6500-EXIT.                                                       05210000
           EXIT.                                                        05220000
                                                                        05230000
      ****************************************************************  05240000
       6700-WRITE-DUMMY-HP.                                             05250000
      ****************************************************************  05260000
                                                                        05270000
           MOVE 'N'                     TO WS-B13DUMMY-EOF.             05280000
           OPEN INPUT B13DUMMY.                                         05290000
                                                                        05300000
           PERFORM 6710-WRITE-DUMMY          THRU 6710-EXIT             05310000
                   UNTIL WS-B13DUMMY-EOF = 'Y'.                         05320000
                                                                        05330000
           CLOSE B13DUMMY.                                              05340000
                                                                        05350000
       6700-EXIT.                                                       05360000
           EXIT.                                                        05370000
                                                                        05380000
      ****************************************************************  05390000
       6710-WRITE-DUMMY.                                                05400000
      ****************************************************************  05410000
                                                                        05420000
           READ B13DUMMY                                                05430000
                AT END                                                  05440000
                   MOVE 'Y'            TO WS-B13DUMMY-EOF               05450000
                   GO TO 6710-EXIT.                                     05460000
                                                                        05470000
                                                                        05480000
           IF WS-SEND-LESSEE = 'N'                                      05490000
              MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE-A              05500000
           ELSE                                                         05510000
              MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE                05520000
           END-IF.                                                      05530000
                                                                        05540000
           IF WS-SEND-LESSEE = 'N'                                      05550000
              IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000             05560000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05570000
                  WRITE B13F213A-REC    FROM WS-BP13F213-REC-A          05580000
                  ADD 1                 TO WS-B13F213A-WRT              05590000
              ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000        05600000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05610000
                  WRITE B13F213B-REC    FROM WS-BP13F213-REC-A          05620000
                  ADD 1                 TO WS-B13F213B-WRT              05630000
              ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000        05640000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05650000
                  WRITE B13F213C-REC    FROM WS-BP13F213-REC-A          05660000
                  ADD 1                 TO WS-B13F213C-WRT              05670000
              ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000        05680000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05690000
                  WRITE B13F213D-REC    FROM WS-BP13F213-REC-A          05700000
                  ADD 1                 TO WS-B13F213D-WRT              05710000
              ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000        05720000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05730000
                  WRITE B13F213E-REC    FROM WS-BP13F213-REC-A          05740000
                  ADD 1                 TO WS-B13F213E-WRT              05750000
              END-IF                                                    05760000
           ELSE                                                         05770000
              IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000             05780000
                  WRITE B13F213A-REC    FROM WS-BP13F213-REC            05790000
                  ADD 1                 TO WS-B13F213A-WRT              05800000
              ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000        05810000
                  WRITE B13F213B-REC    FROM WS-BP13F213-REC            05820000
                  ADD 1                 TO WS-B13F213B-WRT              05830000
              ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000        05840000
                  WRITE B13F213C-REC    FROM WS-BP13F213-REC            05850000
                  ADD 1                 TO WS-B13F213C-WRT              05860000
              ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000        05870000
                  WRITE B13F213D-REC    FROM WS-BP13F213-REC            05880000
                  ADD 1                 TO WS-B13F213D-WRT              05890000
              ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000        05900000
                  WRITE B13F213E-REC    FROM WS-BP13F213-REC            05910000
                  ADD 1                 TO WS-B13F213E-WRT              05920000
              END-IF                                                    05930000
           END-IF.                                                      05940000
                                                                        05950000
           ADD 1                     TO WS-NUM-SMS.                     05960000
                                                                        05970000
       6710-EXIT.                                                       05980000
           EXIT.                                                        05990000
                                                                        06000000
      ***************************************************************   06010000
       9999-WRAP-UP.                                                    06020000
      ***************************************************************   06030000
                                                                        06040000
           DISPLAY SPACES.                                              06050000
           DISPLAY '********** CONTROL TOTALS *************'.           06060000
           DISPLAY ' PROGRAM ID                 : BP13CFA8'.            06070000
           DISPLAY '----------------------------------------'.          06080000
           DISPLAY 'CURRENT DATE :                            : '       06090000
                                        WS-DTE-CURRENT.                 06100000
           DISPLAY 'TOTAL BP13F213 RECS READ                  : '       06110000
                                        WS-CTR-BP13F213-READ.           06120000
           DISPLAY 'TOTAL CASES B13F213A WRITTEN              : '       06130000
                                        WS-B13F213A-WRT.                06140000
           DISPLAY 'TOTAL CASES B13F213B WRITTEN              : '       06150000
                                        WS-B13F213B-WRT.                06160000
           DISPLAY 'TOTAL CASES B13F213C WRITTEN              : '       06170000
                                        WS-B13F213C-WRT.                06180000
           DISPLAY 'TOTAL CASES B13F213D WRITTEN              : '       06190000
                                        WS-B13F213D-WRT.                06200000
           DISPLAY 'TOTAL CASES B13F213E WRITTEN              : '       06210000
                                        WS-B13F213E-WRT.                06220000
           DISPLAY 'Note : The first and last record written are dummy  06230000
      -            'records'.                                           06240000
           DISPLAY SPACES.                                              06250000
                                                                        06260000
           IF WS-NUM-SMS = 0                                            06270000
               MOVE 01                              TO RETURN-CODE.     06280000
                                                                        06290000
           CLOSE B13F213A                                               06300000
                 B13F213B                                               06310000
                 B13F213C                                               06320000
                 B13F213D                                               06330000
                 B13F213E                                               06340000
                 SY02F001                                               06350000
                 BP13F213.                                              06360000
                                                                        06370000
                                                                        06380000
           STOP RUN.                                                    06390000
                                                                        06400000
       9999-EXIT.                                                       06410000
            EXIT.                                                       06420000
                                                                        06430000
