       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C528.                                                 
       AUTHOR.        LSB.                                                      
      *DATE-WRITTEN.  18/02/91.                                                 
      *========================================================*                
      * SYSTEM OF COMMITMENT (BP13)                            *                
      *========================================================*                
      *                                                        *                
      *1. PROGRAM TO CREATE SOC APPLCATION MASTER, SOC OCCUPIER*                
      *   AND SOC APPLN HISTORY FILE FROM BALLOT FILE AFTER    *                
      *   ASSIGNING REGISTRATION NO.                           *                
      *                                                        *                
      *2. CREATE TRANSACTION REC TO CFS FOR PRE-E CHECK.       *                
      *                                                        *                
      *   BP13K800 - APPLN INFOR, REGN, NT.FT, NRIC            *                
      *   BP13K820 - OCCUPIER INFOR + 4 APPLN REGN/NRIC        *                
      *   BP13K840 - APPLN HISTORY WITH STATUS = N             *                
      *                                                        *                
      *    INPUT   :  BP13F520  (BALLOT FILE)                  *                
      *               BP13K825  (REQ-OCCUP FILE)               *                
      *               BP13K530                                 *                
      *    I-O     :  BP13K800  }                              *                
      *               BP13K820  }  CREATE NEW RECORDS FOR      *                
      *               BP13K840  }    EACHRESPECTIVELY          *                
      *    OUTPUT  :  BP13F310                                 *                
      *               BP13F800                                 *                
      * ------------------------------------------------------ *                
      * CHG-NO  CHG-DATE  BY   DESCRIPTION                     *                
      * ------  --------  --   -----------                     *                
      * C91     18/02/91  LSB  NEW PROGRAM FOR NEW REQUEST     *                
      * C910537 26/06/91  LJL  TO UPD BO CDE TO DPM-AREA-OFFICE*                
      * I911209 17/12/91  LSB  TO CREATE OCCUP REC FOR NT-WITH *                
      *                        LAND, CHANGES FOR SOC-PH7       *                
      * C920334 12/03/92  LSB  TO CREATE OCCUP REC FOR MATURE  *                
      *                        NT                              *                
      * N930012   /  /93  JAP  SOC PH8                         *                
      * SOC-PH8 04/09/93  RML  REFER TO BP13K800/BP13K820      *                
      * C940596 04/07/94  LSB  TENANT PRIORITY SCHEME          *                
      * C9404F5 20/07/94  LMS  TO MOVE UPDATE INCOME TO OCCUP  *                
      *                        FILE, AND HSE-INCOME TO SOC     *                
      *                        MASTER FOR SALE OF ST FLAT.     *                
      * C940786 18/08/94  LSB  TO UPDATE CDE-PARENT-CHILD      *                
      *                        TO SOC MASTER                   *                
      * SOCPH9A 04/10/94  LSB  UPDATE 5-YR,ZONE,WT,JB-PARENT   *                
      *                        AMT-REGN                        *                
      * SOCPH9B 22/11/94  RGM  CHANGE K558 TO K825 & CHANGE KEY*                
      *                        OF K520 TO K520-KEY-NEW         *                
      * SOCPH9B 06/12/94  LJL  TO UPDATE THE CURRENT REGN FOR  *                
      *                        TENANT CASES.                   *                
      * C9411B3 15/12/94  GD   TO MOVE THE FF. FIELDS FROM     *                
      *                           K825 TO K820 :               *                
      *                        - CPF, NATIONALITY AND INCOME-TP*                
      * C9503F7 31/03/95  YPH  USE ZONE TO DETERMINE RFS REQ   *                
      * C9503A3 06/04/95  LSB  MOVE NT-FT-QUEUE TO SOC MASTER  *                
      * C950424 26/04/95  GD   TO GET CURREGN FROM K530 FOR    *                
      *                          >1994 CASES                   *                
      * C950392 11/05/95  LJL  TO WRITE TO A BP13F800 FOR NEW  *                
      *                        CASES.                          *                
      *BP130109 10/07/96  LSB  FOR SALES-TY 2B CASES, HHTY= NHH*                
      *                        BUT SUBJECT TO 5-YR CHECK, REGN *                
      *                        FEE = $618                      *                
      *BP130124 27/07/96  SSS  CHG CDATECHK TO AV02C010.       *                
      *BP130145 14/08/96  LSB  RELOCATION DO NOT ALLOW NHT     *                
      *BP130299 07/05/97  LSB  UPDATE CPF-NO FROM NRIC         *                
      *BP130323 07/07/97  LSB  UPDATE MTH-RESIDE               *                
      *BP130377 15/09/97  LSB  UPDATE MTH-SUBLET               *                
      *BP130388 29/10/97  MPA  UPDATE IDP-SCH, CA-TAG, SUBLET  *                
      *BP130426 09/01/98  LSB  FOR ELIG-SCH=NCS,SMP, TAG PARENT*                
      *                        'Y' FREEZE-OCCUP                *                
      *BP130426 20/01/98  LSB  FOR 3-RM, IDP=FRT, FNS          *                
      *BP130364 27/03/98  LSB  UPDATE SRS SPR,CA-TAG,LOAN,CAP  *                
      *BP130503 06/07/98  LSB  5000 REGN-DEPOSIT FOR FS SCHEME *                
      *BP130418 06/07/98  LSB  CATER FOR Y2000                 *                
      *                   SSS  CHG AV02C010 TO AV02C001.       *                
      *BP130494 17/07/98  LSB  NON-CITIZEN, MOVE '0000000J' TO *                
      *                        CPF-NO                          *                
      *BP130418 19/09/98  SIA  TO CATER FOR Y2K                *                
      *BP130539 29/12/98  SIA  ALOC-SCHEME=REN, IDP=NRT        *                
      *BP130534 09/01/99  LSB  FS SCHEME MOVE '3' TO FS-TAG    *                
      *                        NHT MOVE 'RT' TO LESSEE-CODE    *                
      *BP130534 30/01/99  LSB  FOR NHH, SET AS 'NH'            *                
      *BP130636 11/03/99  LSB  INITIALISE SCCC-ELGBTY TO 'Y'   *                
      *                        INITIALISE AMT-REGN-DEPOSIT     *                
      *BP130613 11/03/99  LSB  INCLUDE PREFIX 'T' FOR CPF-NO   *                
      *BP130534 06/04/99  LSB  CPF-NO FOR ALL HA               *                
      *BP130684 19/07/99  LSB  CPF-NO FOR HA WITHOUT INCOME    *                
      *                        SET 0000000J FOR WITH INCOME    *                
      *BP130713 18/09/99  LSB  SERS CASE IDP-SCH=PA, SPOUSE-IC *                
      *BP130652 20/02/99  NOR  EXPAND F520 RECL FROM 300 TO 500*                
      *BP130754 26/11/99  LSB  ONETIME UPD FOR ZONE=ME,ZN      *                
      *BP130718 24/09/99  MCC  MOVE F520-DTE-1ST-LETTER,       *                
      *                        F520-NUM-APPLN-TYPE AND         *                
      *                        NUM-PTE-PRTY TO CORRESPONDING   *                
      *                        BP13K800 FIELDS                 *                
      *                        MOVE 'RB' TO F310-CDE-TRANS     *                
      *                        FOR INTERNET APPLICATIONS.      *                
      *BP130747 02/02/00  LSB  OUTPUT F310 ONLY IF ZONE=ME,ZN  *                
      *                        OR SPACES AND APPLN-TY = 'I'    *                
      *BP130801 02/02/00  SB   TO CATER FOR ZONE = ME, ZN      *                
      *BP130808 20/02/00  YCH2 TO CATER FOR NUM-LESSEE         *                
      *BP130820 21/03/00  SB   TO CATER FOR UPDATING CA-TAG    *                
      *BP130932 15/12/00  AS1  INCLUDE HALF IDP-SCH            *                
      *BP130932 06/01/01  AS1  CHECK FOR AGE> 0 FOR HALF-IDP   *                
      *BP130932 11/01/01  AS1  HALF-IDP FOR PARENT/MARRIED SON *                
      *BP130925 03/03/01  ANC1 REMOVE K800-NUM-CO-LESSEE       *                
      *BP130970 03/03/01  ED   MOVE K825-NUM-FREEZE-OCCP TO    *                
      *                        K820-NUM-FREEZE-OCCP.           *                
      *                        COMMENT-OUT UPDATE OF           *                
      *                        F520-NUM-EXIST-SALES-TYPE.      *                
      *BP130925 03/03/01  ANC1 ADD TAGGING OF TWO-ROOMER       *                
      *BP130993 10/04/01  ANC1 INCLUDE K800-NUM-BTO            *                
      *BP130978 16/04/01  AS1  TMT, TJB, HALF-IDP=SPACES       *                
      *BP130978 18/04/01  AS1  CHANGING THE HALF-IDP LOGIC     *                
      *                        REMOVE NUM-LESSEE               *                
      *BP131010 09/05/01  YCH2 LIFT OUT NUM-BTO TAG            *                
      *BP131036 14/06/01  RAS  TO CATER FOR ALLOC CDES: SFC &  *                
      *                        SRC                             *                
      *BP130925 03/07/01  ANC1 ADD TAGGING OF TWO-ROOMER       *                
      *BP132031 03/10/01  MALC CATER FOR SALE OF SERS FLAT     *                
      *                        TO SINGLES                      *                
      *BP132069 22/12/01  JAM1 CHANGED HARDCODING VALUES FROM: *                
      *                        A. 200.00  TO   500.00          *                
      *                        B. 600.00  TO  1000.00          *                
      *                        C. 206.00  TO   515.00          *                
      *                        D. 618.00  TO  1030.00          *                
      *BP132098 05/02/02  LSB  ADD MCPS TO ALLO/IDP-SCH        *                
      *                        NO CUR-REGN FOR BE              *                
      *BP132063 12/02/02  MTD  MOVE ALLOCATION CATEGORY TO     *                
      *                        K800-NUM-ALLO-CAT               *                
      *BP132165 14/06/02  MTD  CHANGE LOGIC OF ASSIGNING       *                
      *                        ALLO-CAT                        *                
      *BP132261 14/12/02  MCC  EXTEND SDS SCHEME TILL 20030630 *                
      *BP132207 23/09/02  MALC TO CATER FOR CHANGE OF GST      *                
      *BP132283 26/12/02  ANC1 TO CATER FOR LOAN-TAG & PREM-CDE*                
      *                        TO CATER FOR EDUCATIONAL LEVEL  *                
      *BP132293 11/02/03  CKK7 TO REMOVE MOVING NUM-PPO TO     *                
      *                        CA-TAG                          *                
      *BP132317 21/03/03  LSB  BTO CHANGES                     *                
      *BP132317 29/03/03  SK   MOVE ORIG LNTAG,POLICY CODE AND *                
      *                        ELIGIBLE LOAN POLICY CODE       *                
      *BP132344 07/05/03  YCH2 UPD LOW-FLOOR TO K800           *                
      *BP132366 19/06/03  JF4  EXTEND SDS SCHEME TILL DEC 2003 *                
      *BP132352 26062003  SK   REMOVE THE CHECKING BEFORE      *                
      *                        WRITING TO BP13F800             *                
      *BP132384 01/08/03  ANC1 TO WRITE SMS/RSL/RDB STATUS AND *                
      *                        FLAT TYPE IN K800 FROM F520 FILE*                
      *BP132399 05/09/03  MTD  ADD IDP-SCHEMES "LRT" & "LIF"   *                
      *BP132412 02/10/03  SK   MOVE F520-CDE-REQ-ALLOC-SCH TO  *                
      *                             K800-CDE-REQ-ALLOC-SCH     *                
      *BP132463 08/12/03  SK   CATER CDE-REQ-ALLOC FOR SPACES  *                
      *                        AND HA1,HA2,HA3 & HA4           *                
      *BP132464 23/12/03  JF4  REMOVE ENHANCED SDS(HALF-IDP=A) *                
      *                        FOR 'TMT' 'TJB' 'TMC' 'LIF'     *                
      *                        'LRT' REMOVE HALF-IDP TAG.      *                
      *BP132482 20/02/04  MTD  REMOVE CHECKING OF DTE-BALLOT = *                
      *                        '200309' FOR BE/BTO APPLICATIONS*                
      *BP132482 02/03/04  MTD  ADD CONDITIONS IN UPDATING IDP  *                
      *                        SCHEME                          *                
      *BP132500 01/04/04  JF4  CATER CONDITIONS TO DETERMINE   *                
      *                        ALLO-CAT, IDP-SCH & CA-TAG.     *                
      *BP132500 23/04/04  MTD  MOVE 'PA ' TO IDP-SCHEME FOR    *                
      *                        A GIVEN SERS ALLO-SCHEME        *                
      *BP132535 11/05/04  MTD  CHECK THE FIRST BYTE OF         *                
      *                        K800-NUM-FLAT-TYPE              *                
      *BP132540 25052004  YCH2 INCLUDE PHONE-OFF               *                
      *BP132583 23/08/04  SK   MOVE PORT-ELIG-TAG TO BP13K800  *                
      *BP132582 04/11/04  LMS  TO CATER FOR 3-ROOM HALF-IDP.   *                
      *BP132618 06/11/04  YCH2 INCLUDE SPL-APPRV-TYPE          *                
      *BP132626 24/11/04  SK   CHANGE DTE-REGN TO DTE-REQUEST  *                
      *BP132648 28/12/04  MTD  CHANGE 'LIF' IDP SCHEME TO 'PA' *                
      *BP132626 29/12/04  CKK  MOVE ALLO-SCH TO SERS-ALLO-PRIO *                
      *                        FOR PORT CASE                   *                
      *BP132653 15/02/05  CKK  UPDATE MCP ONLY FOR PA CASES    *                
      *BP132693 12/05/05  CKK  REMOVE IDP = TMC FOR MCP CASES  *                
      *BP132722 18/07/05  LMS  CHECK HALF-IDP FOR LOW-INCOME   *                
      *                        AND PRIORITY SCHEMES.           *                
      *BP132846 22/05/06  CKK  ADD K800-NUM-SA-CPF FOR SA AND  *                
      *                        K800-NUM-PAYMENT-SCHEME FOR DBSS*                
      *BP132862 14/06/06  CKK  UPDATE LOAN-TAG IF INCOME > 8K  *                
      *BP132886 24/09/06  CKK  UPDATE SA CASES LOAN TAG        *                
      *BP132977 27/12/06  ED1  MOVE 'P' IF F520  LOANTAG IS H  *                
      *BP133030 27/03/07  CKK  CATER FOR NEW WIS AND 3R        *                
      *BP133017 27/04/07  CKK  MOVE BK DTE/TME TO BP13K800     *                
      *BP132900 18/06/07  YCH2 CHECK SERS SCHEME TO DETERMINE  *                
      *                         LOAN-TAG                       *                
      *BP133111 20/08/07  LSB1 HARDCODE SPACES TO DTE-BK/TME   *                
      *                        FOR WIC QUEUE > 20000           *                
      *BP133166 16/10/07  LSB1 HARDCODE SPACES TO DTE-BK/TME   *                
      *                        FOR WIA OCT 07(PHASE 2)         *                
      *BP133213 17/12/07  RB12 HARDCODE SPACES TO DTE-BK/TME   *                
      *                        FOR WIB QUEUE > B2000           *                
      *BP133258 18/02/08  RB12 HARDCODE SPACES TO DTE-BK/TME   *                
      *                        FOR WIC QUEUE > 02000           *                
      *BP133311 16/04/08  RB12 HARDCODE SPACES TO DTE-BK/TME   *                
      *                        FOR WIA QUEUE > A2500           *                
      *BP133362 30/06/08  IL5  WRITE NEW FIELD BALLOT-STATUS   *                
      *                        TO BP13K800                     *                
      *BP133402 06/08/08  LMS1 TO CHECK FLAT TYPE = '1' AND '2'*                
      *                        WHEN DETERMINING HALF-IDP       *                
      *BP133412 15/08/08  IL5  ADD UPDATING OF PROV TAG AND RSN*                
      *                        TO K800                         *                
      *BP133430 10/09/08  LMS1 NEW SELECTION TYPE WIH          *                
      *BP133452 29/10/08  MSD1 HARD CODE DATE-BALLOT           *                
      *BP133452 26/11/08  IL5  MOVE F520-CDE-NT1 TO BP13K800   *                
      *BP133465 26/11/08  IL5  DEFAULT K800-NUM-LOAN-TAG = 'N' *                
      *                        FOR 'NPL' CASES                 *                
      *BP133501 15/01/09  IL5  WRITE NEW FIELD CDE-BALLOT-HH   *                
      *                        TO BP13K800                     *                
      *BP133721 29/09/09  ZDD  INCLUDE SBF                     *                
      *BP133913 27/05/10  ZDD  CHANGE TO 'C' STATUS IF NO QUEUE*                
      *BP133924 30/06/10  ZDD  CATER FOR NPL FOR K800-NUM-ZONE *                
      *BP133990 25/08/10  ZDD  INCLUDE BP13K813  AND           *                
      *                        CITIZENSHIP-HOUSEHOLD           *                
      *BP134050 08/10/10  YCH2 SERS WITH HALF IDP TAG          *                
      *BP134067 25/02/11  IL5  HARDCODE BALLOT DATE FOR DBSS   *                
      *BP134143 09/02/11  ZDD1 ADD  NMH-TAG                    *                
      *BP134211 15/06/11  IL5  HARDCODE BALLOT DATE FOR DBSS   *                
      *BP134275 15/06/11  IL5  BYPASS BP13K648 FOR NPL         *                
      *BP134292 26/07/11  ZDD1 ADD NUM-HARDLUCK                *                
      *BP134375 20/10/11  ZDD1 CHANGE 8000 TO 10000            *                
      *BP134385 01/11/11  ZDD1 CATER FOR DBS HH INC > 8K TO UPD*                
      *                        LOAN TAG TO 'B'                 *                
      *BP134407 28/11/11  ZDD1 CATER FOR DBS HH INC > 8K TO UPD*                
      *                        ORIG LOAN TAG TO 'B'            *                
      *BP134471 12/03/12  ESA1 TO USE F520-NUM-SPRQUOTA-TAG    *                
      *BP134483 12/04/12  ZDD1 TO ADD APPS AND APPS-ELIG       *                
      *BP134673 16/10/12  IMC1 REMOVE CHECKING OF NT IF SBF    *                
      *BP134688 23/11/12  IL5  MOVE F520-CDE-NT1 INSTEAD OF    *                
      *                        F520-CDE-SUCC-NT-ZONE INTO      *                
      *                        K800-NUM-NEW-TOWN FOR SBF       *                
      *BP134782 14/02/13  SMR2 WRITE F520-NUM-PPS-ELIG-TAG TO  *                
      *                        F800-NUM-PPS-ELIG               *                
      *BP134838 25/02/13  YCH2 INCLUDE NHA                     *                
      *BP134914 30/05/13  SMR2 CATER FOR PPS-QUOTA & AST-QUOTA *                
      *BP134914 27/06/13  SMR2 UPDATE AST & PREGNANT-PPS       *                
      *BP134996 26/07/13  SMR2 CHECK FT FOR MCP CASES          *                
      *BP135028 05/08/13  SMR2 COMPUTE HH INCOME OF FTS SCHEME *                
      *                        FOR NCS, USE HA1-4 & SPOUSE REL *                
      *                        FOR SSC/JSS, USE HA1-4 ONLY     *                
      *BP135100 12/11/13  SMR2 INCLUDE 3GEN                    *                
      *BP135170 27/12/13  IL5  INCLUDE STEPUP                  *                
      *BP135190 04/12/13  SMR2 EXPAND BP13K813 TO 1000         *                
      *BP135235 11/04/14  SMR2 CATER FOR HALF-IDP (NCS)        *                
      *BP135485 19/09/14  SMR2 REMOVE DETERMINATION OF HALF-IDP*                
      *                        AND SPRQUOTA-TAG                *                
      *BP135492 02/10/14  SMR2 TO REMOVE DETERMINATION OF MCP  *                
      *                        ALLOCATION SCHEME DURING UPLOAD *                
      *BP135847 25/05/15  SMR2 MOVE TO FIELD REGARDLESS OF THE *                
      *                        VALUE IN PORT-ELIG-TAG          *                
      *BP135904 21/08/15  ZDD1 CHANGE 8000 TO 10000            *                
      *BP135904 25/08/15  ZDD1 CHANGE 10000 TO 12000           *                
      *BP135944 15/09/15  SMR2 REMOVE REFERENCE TO CDE-NT6/7/8 *                
      *BP136096 14/01/16  SMR2 POPULATE ELDERLY-EXEMPTION,     *                
      *                        NTIMER & ELDERLY                *                
      *BP136096 26/01/16  SMR2 POPULATE PPO                    *                
      *BP136169 12/04/16  SMR2 CHANGE 10000 TO 12000           *                
      *BP136721 27/03/17  SMR2 POPULATE FLATLIST-GRO FROM WARD *                
      *BP136866 14/08/17  SMR2 CATER FOR ROF                   *                
      *BP136866 16/08/17  SMR2 POPULATE BTO-FLAT-TYPE AND      *                
      *                        BTO-ZONE FOR ROF                *                
      *BP137786 18/04/19   KV6 CATER FOR OBF                   *                
      *BP137817 06/06/19   KV6 POPULATE K800-NUM-NHFL          *                
      *BP137927 10/09/19  CCC5 CHANGE 12000 TO 14000           *                
      *BP138600 08/03/21  SMP3 POPULATE CCA AND CCA-QUOTA      *                
      *BP138776 29/06/21  ZDD1 TO CATER FOR CCA FLAT CA LOAN   *                
      *BP139211 02/01/23  KAC1 TO IMPLEMENT 8% GST             *                
      *                        REPLACED BP13C90D BY AV02C025   *                
      *BP139211 04/01/23  AM25 REMOVE OBSOLETE PROCESSING ON   *                
      *                        GST RATE/REMOVAL OF AV02C025    *                
      *BP139678 02/08/23  AM25 CATER FOR FILE STATUS 02 WHEN   *                
      *                        WRITING TO VSAM FILES W/ ALT KEY*                
      *BP139530 20231004  SC54 TO ADD NUM-FTPMC                *                
      *BP139485 02/01/24  KAC1 TO IMPLEMENT 9% GST             *                
      *                        REPLACED BP13C90D BY AV02C025   *                
      *BP139747 22/01/24  EL27 REMOVE OVERWRITING OF LOAN TAG  *                
      *                        FOR OCT 2023 ONWARDS HFE CASES  *                
      **********************************************************                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13F520 ASSIGN TO BP13F520.                                  
           SELECT BP13F800 ASSIGN TO BP13F800.                                  
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K800-NUM-REGN                              
                  FILE STATUS     IS K800-STATUS.                               
           SELECT BP13K820 ASSIGN TO BP13K820                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K820-KEY-FLD                               
                  FILE STATUS     IS K820-STATUS.                               
           SELECT BP13K840  ASSIGN TO BP13K840                                  
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K840-NUM-REGN                              
                  FILE STATUS     IS K840-STATUS.                               
           SELECT BP13K825 ASSIGN TO BP13K825                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K825-KEY-FLD                               
                  FILE STATUS     IS K825-STATUS.                               
           SELECT BP13K530 ASSIGN TO BP13K530                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K530-KEY-FLD                               
                  FILE STATUS     IS K530-STATUS.                               
           SELECT BP13K648 ASSIGN TO BP13K648                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K648-KEY-FLD                               
                  FILE STATUS     IS K648-STATUS.                               
           SELECT BP13K813 ASSIGN TO BP13K813                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K813-KEY-FLD                               
                  FILE STATUS     IS K813-STATUS.                               
           SELECT BP13F310 ASSIGN TO BP13F310.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
       FD  BP13F520                                                             
           RECORD    CONTAINS 500 CHARACTERS                                    
           BLOCK     CONTAINS   0 RECORDS                                       
           LABEL     RECORDS  ARE STANDARD                                      
           RECORDING MODE     IS  F.                                            
       COPY BP13F520.                                                           
                                                                                
       FD  BP13K825                                                             
           RECORD    CONTAINS 200 CHARACTERS.                                   
       COPY BP13K825.                                                           
                                                                                
       FD  BP13F800                                                             
           RECORD    CONTAINS 2000 CHARACTERS                                   
           BLOCK     CONTAINS   0 RECORDS                                       
           LABEL     RECORDS  ARE STANDARD                                      
           RECORDING MODE     IS  F.                                            
       COPY BP13F800.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD    CONTAINS 2000 CHARACTERS.                                  
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD    CONTAINS 400 CHARACTERS.                                   
       COPY BP13K820.                                                           
                                                                                
       FD  BP13K840                                                             
           RECORD    CONTAINS 500 CHARACTERS.                                   
       COPY BP13K840.                                                           
                                                                                
       FD  BP13K530                                                             
           RECORD    CONTAINS  50 CHARACTERS.                                   
       COPY BP13K530.                                                           
                                                                                
       FD  BP13K648                                                             
           RECORD    CONTAINS 500 CHARACTERS.                                   
       COPY BP13K648.                                                           
                                                                                
       FD  BP13K813                                                             
           RECORD    CONTAINS 1000 CHARACTERS.                                  
       COPY BP13K813.                                                           
                                                                                
       FD  BP13F310                                                             
           RECORD    CONTAINS 150 CHARACTERS                                    
           BLOCK     CONTAINS   0 RECORDS                                       
           LABEL     RECORDS  ARE STANDARD                                      
           RECORDING MODE     IS  F.                                            
       COPY BP13F310.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       COPY IDPTABLE.                                                           
       COPY SERSCH.                                                             
       COPY PRIOSCH.                                                            
                                                                                
       01  FILE-STATUS.                                                         
           03  K800-STATUS             PIC 9(02)  VALUE 0.                      
           03  K820-STATUS             PIC 9(02)  VALUE 0.                      
           03  K840-STATUS             PIC 9(02)  VALUE 0.                      
           03  K825-STATUS             PIC 9(02)  VALUE 0.                      
           03  K530-STATUS             PIC 9(02)  VALUE 0.                      
           03  K648-STATUS             PIC 9(02)  VALUE 0.                      
           03  K813-STATUS             PIC 9(02)  VALUE 0.                      
                                                                                
       01  WS-SWITCHES.                                                         
           03  WS-FOUND-SW             PIC X       VALUE 'N'.                   
           03  F520-EOF-IND            PIC X       VALUE SPACES.                
               88 F520-EOF             VALUE 'Y'.                               
           03  K825-EOF-IND            PIC X       VALUE SPACES.                
               88 K825-EOF             VALUE 'Y'.                               
           03  WS-ALLOC-SCH-FOUND-SW   PIC X(01)   VALUE SPACES.                
               88 C-ALLOC-SCH-FOUND    VALUE 'Y'.                               
                                                                                
       01  WS-ACCUMULATORS.                                                     
           03  WS-NO-READ-F520         PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-READ-K825         PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-FOUND-K530        PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-NOTFND-K530       PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-WRT-K820          PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-WRT-K800          PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-WRT-K840          PIC 9(6)    VALUE ZERO.                  
           03  WS-NO-WRT-F310          PIC 9(6)    VALUE ZERO.                  
           03  WS-SEQ-NO               PIC 9(3)    VALUE ZERO.                  
           03  WS-DESC                 PIC X(3)    VALUE SPACES.                
           03  WS-K648-UPDATE          PIC 9(6)    VALUE ZERO.                  
                                                                                
       01  WS-COMPUTE-WAIT-TIME.                                                
           03  WS-WAIT-TIME-ZEROS      PIC X       VALUE ZEROS.                 
           03  WS-WAIT-TIME-F520       PIC 9(2)    VALUE ZEROS.                 
                                                                                
       01  WS-CUR-DATE                 PIC X(8).                                
                                                                                
       01  WS-F800-DTE-REGN.                                                    
           05  WS-REGN-DATE.                                                    
               10  WS-REGN-CCYY.                                                
                   15  WS-REGN-CC      PIC 99.                                  
                   15  WS-REGN-YY      PIC 99.                                  
               10  WS-REGN-CCYY-9      REDEFINES WS-REGN-CCYY                   
                                       PIC 9(4).                                
               10  WS-REGN-MM          PIC 99.                                  
               10  WS-REGN-DD          PIC 99.                                  
                                                                                
       01  WS-REGN-MM-S99              PIC S9(2).                               
                                                                                
       01  WS-ALT-KEY.                                                          
           03  WS-PREFIX               PIC X(1)    VALUE '#'.                   
           03  WS-NUM-REGN             PIC X(8).                                
                                                                                
       01  WS-REGN-BLANK-TEMP.                                                  
           03  WS-HEX                  PIC X(1)    VALUE '#'.                   
           03  WS-REGN-BLANK           PIC X(8)    VALUE SPACES.                
                                                                                
       01  WS-RESIDENT                 PIC X.                                   
       01  WS-RESIDENT-FOUND           PIC X.                                   
                                                                                
       01 WS-VARIABLES.                                                         
           05  WS-AGE-APPL                 PIC 9(4)       VALUE ZEROES.         
           05  WS-AGE-SPOUSE               PIC 9(4)       VALUE ZEROES.         
           05  WS-AGE-FIANCEE              PIC 9(4)       VALUE ZEROES.         
           05  WS-F520-DTE-REGN.                                                
               10  WS-F520-DTE-REGN-YR     PIC 9(4)       VALUE ZEROES.         
               10  WS-F520-DTE-REGN-MM     PIC 9(2)       VALUE ZEROES.         
               10  WS-F520-DTE-REGN-DD     PIC 9(2)       VALUE ZEROES.         
                                                                                
           05  WS-K825-DTE-BIRTH.                                               
               10  WS-K825-DTE-BIRTH-YR   PIC 9(4)        VALUE ZEROES.         
               10  WS-K825-DTE-BIRTH-MM   PIC 9(2)        VALUE ZEROES.         
               10  WS-K825-DTE-BIRTH-DD   PIC 9(2)        VALUE ZEROES.         
                                                                                
           05  WS-AGE                      PIC 9(04)      VALUE ZEROES.         
           05  WS-ZONE                     PIC X(02).                           
               88  C-ZONE-RFS        VALUE 'NN' 'NE' 'WW' 'PG'.                 
               88  C-ZONE-WIS        VALUE '3R'.                                
               88  C-ZONE-OTB        VALUE 'ME' 'ZN'.                           
           05  WS-FLAT-TYPE                PIC X(02).                           
              88  C-FLAT-TYPE-SA    VALUE '1A' '2A'.                            
              88  C-FLAT-TYPE-SER   VALUE '9 '.                                 
           05  WS-IDP-FLAT-TYPE            PIC X(02).                           
                                                                                
       01  WS-APPL-MARITAL-STATUS          PIC X  VALUE SPACES.                 
       01  WS-SPOUSE-MARITAL-STATUS        PIC X  VALUE SPACES.                 
                                                                                
       01  WS-SPOUSE-NUM-RELATIONSHIP      PIC X  VALUE SPACES.                 
           88 WS-SPOUSE-REL-TAG            VALUE  'Y'.                          
       01  WS-FIANCEE-NUM-RELATIONSHIP     PIC X  VALUE SPACES.                 
           88 WS-FIANCEE-REL-TAG           VALUE  'Y'.                          
                                                                                
       01  WS-LIF-ALLOC-SCHEME             PIC X(03).                           
           88  N-LIF-ALLOC-SCH      VALUE 'SPO' 'SPP' 'SPS' 'SSP' 'SRP'         
                                          'SSD' 'SSR' 'SJD' 'SDF' 'SSC'         
                                          'SJC' 'SDC' 'SFC' 'SRC' 'SJO'.        
                                                                                
       01  WS-LIF-ELIG-SCHEME              PIC X(03).                           
           88  N-LIF-ELIG-SCH       VALUE 'SOL' 'SSC' 'JSS' 'NCS' 'NCP'         
                                          'NCF' 'OR ' 'ASC'.                    
                                                                                
      *-----------------------------------------------------------*             
      *    WS VARIABELS PASSED  TO SUB-PROGRAM "AV02C001"         *             
      *-----------------------------------------------------------*             
       COPY AV02COMM.                                                           
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       000-MAIN-PROCESS.                                                        
      *-------------------------------------------------------------            
             PERFORM 0100-OPEN-ROUTINE        THRU 0100-EXIT.                   
             PERFORM 0200-READ-BP13F520       THRU 0200-EXIT.                   
             PERFORM 0300-CREATE-WAITING-LIST THRU 0300-EXIT                    
               UNTIL F520-EOF.                                                  
             PERFORM 9999-CLOSE-ROUTINE       THRU 9999-EXIT.                   
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
       0100-OPEN-ROUTINE.                                                       
      *-------------------------------------------------------------            
           OPEN INPUT BP13F520                                                  
                      BP13K825                                                  
                      BP13K530                                                  
                      BP13K813                                                  
               I-O    BP13K800                                                  
                      BP13K648                                                  
                      BP13K820                                                  
                      BP13K840                                                  
               OUTPUT BP13F310                                                  
                      BP13F800.                                                 
                                                                                
           IF K800-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K800  FILE, STATUS '                  
                  K800-STATUS                                                   
              MOVE K800-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
           IF K820-STATUS NOT = ZEROS AND '97'                                  
              DISPLAY ' ERROR OPENING BP13K820  FILE, STATUS '                  
                  K820-STATUS                                                   
              MOVE K820-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
           IF K840-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K840  FILE, STATUS '                  
                  K840-STATUS                                                   
              MOVE K840-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
           IF K825-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K825 FILE, STATUS '                   
                  K825-STATUS                                                   
              MOVE K825-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
           IF K530-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K530 FILE, STATUS '                   
                  K530-STATUS                                                   
              MOVE K530-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE                                        
                 THRU 9999-EXIT.                                                
                                                                                
           IF K648-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K648 FILE, STATUS '                   
                  K648-STATUS                                                   
              MOVE K648-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE                                        
                 THRU 9999-EXIT.                                                
                                                                                
           IF K813-STATUS NOT = ZEROS AND 97                                    
              DISPLAY ' ERROR OPENING BP13K813 FILE, STATUS '                   
                  K813-STATUS                                                   
              MOVE K813-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE                                        
                 THRU 9999-EXIT.                                                
                                                                                
           MOVE FUNCTION CURRENT-DATE    TO WS-CUR-DATE.                        
                                                                                
       0100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       0200-READ-BP13F520.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13F520                                                        
                AT END  MOVE 'Y' TO F520-EOF-IND                                
                GO TO 0200-EXIT.                                                
                                                                                
           ADD 1 TO WS-NO-READ-F520.                                            
                                                                                
       0200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************************************************                 
      *                                                       *                 
      *    READ BP13F520 UNTIL END OF FILE.                   *                 
      *    1. WRITE TO BP13K800 FILE                          *                 
      *    2. WRITE TO BP13K825 SOC-OCCP                      *                 
      *    3. WRITE TO BP13K840 SOC HIST FILE                 *                 
      *    4. WRITE TO BP13F310 FOR CLEAR FILE CHECK          *                 
      *                                                       *                 
      *********************************************************                 
       0300-CREATE-WAITING-LIST.                                                
      *-------------------------------------------------------------            
                                                                                
           IF F520-NUM-REGN NOT = SPACES AND LOW-VALUES                         
              PERFORM 1000-CREATE-BP13K800 THRU 1000-EXIT                       
              PERFORM 5000-CREATE-BP13K840 THRU 5000-EXIT                       
      *       PERFORM 6000-CREATE-BP13F310 THRU 6000-EXIT                       
           END-IF.                                                              
                                                                                
           PERFORM 0200-READ-BP13F520   THRU 0200-EXIT.                         
                                                                                
       0300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************************************************                 
      *                                                       *                 
      *  WRITE BP13K800 RECORD WITH DETAILS FROM BP13F520     *                 
      *                                                       *                 
      *********************************************************                 
       1000-CREATE-BP13K800.                                                    
      *-------------------------------------------------------------            
                                                                                
           PERFORM 1100-INITIALIZE-K800-REC THRU 1100-EXIT.                     
           PERFORM 3000-START-K825          THRU 3000-EXIT.                     
           PERFORM 1200-MOVE-FIELDS-K800    THRU 1200-EXIT.                     
                                                                                
      *** REMOVE ENHANCED STAGGERED DOWNPAYMENT SCHEME FOR IDP WITH  ***        
      *** 'TMT' OR 'TJB' OR 'TMC' OR 'LIF' OR 'LRT'                  ***        
      *** ---------------------------------------------------------- ***        
           IF ((K800-NUM-IDP-SCHEME = 'TMT' OR 'TJB' OR 'TMC' OR                
                                      'LIF' OR 'LRT') AND                       
               (K800-NUM-NEW-IDP = 'N')) OR                                     
               (K800-NUM-ALLO-CAT = 'SER')                                      
              MOVE SPACES    TO   K800-NUM-HALF-IDP                             
           END-IF.                                                              
                                                                                
           WRITE  BP13K800-MASTER.                                              
                                                                                
           IF K800-STATUS = 0                                                   
              MOVE   BP13K800-MASTER TO BP13F800-MASTER                         
              WRITE  BP13F800-MASTER                                            
              ADD 1 TO WS-NO-WRT-K800                                           
           ELSE                                                                 
           IF K800-STATUS = 22                                                  
              DISPLAY ' ERROR WRITING TO BP13K800,'                             
                      ' FOUND DUPLICATE REC, STATUS ' K800-STATUS               
                      ' ORIG REG : ' K800-NUM-REGN                              
           ELSE                                                                 
              DISPLAY ' ERROR WRITING BP13K800, STATUS ' K800-STATUS            
              DISPLAY 'K800-NUM-REGN - ' K800-NUM-REGN                          
              MOVE K800-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE                                        
                 THRU 9999-EXIT.                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1100-INITIALIZE-K800-REC.                                                
      *-------------------------------------------------------------            
                                                                                
                                                                                
           MOVE SPACES TO  BP13K800-MASTER.                                     
           MOVE SPACES TO  K800-NUM-NHFL                                        
           MOVE ZEROES TO  K800-DTE-UPDATE                                      
                           K800-DTE-EXPIRED-TP                                  
                           K800-DTE-REGN                                        
                           K800-DTE-QN-RECV                                     
                           K800-NUM-JT-BALLOT-MTF                               
                           K800-NUM-CAT                                         
                           K800-AMT-HSE-INCOME                                  
                           K800-NUM-JT-APPL                                     
                           K800-QTY-JT-BALLOT.                                  
           MOVE ZEROES TO  K800-NUM-CANCEL-REASON                               
                           K800-NUM-ALLOC-DATE                                  
                           K800-NUM-ALLOC-TAG.                                  
           MOVE ZEROES TO  K800-AMT-REGN-REQ                                    
                           K800-AMT-REGN-PAID                                   
                           K800-AMT-REGN-TR                                     
                           K800-AMT-REGN-GST.                                   
           MOVE ZEROES TO  K800-AMT-BK-REQ                                      
                           K800-AMT-BK-PAID                                     
                           K800-AMT-BK-TR.                                      
           MOVE ZEROES TO  K800-AMT-LEASE-FEE                                   
                           K800-AMT-CONVEY-FEE                                  
                           K800-AMT-CONVEY-FEE-GST                              
                           K800-AMT-CD                                          
                           K800-AMT-SOC-DEBTOR                                  
                           K800-AMT-SOC-CASH                                    
                           K800-AMT-CPF1-PAID                                   
                           K800-AMT-CPF2-PAID                                   
                           K800-AMT-CPF3-PAID                                   
                           K800-AMT-CPF4-PAID.                                  
           MOVE ZEROES TO  K800-AMT-SOC-CASH-REQ                                
                           K800-AMT-SOC-CPF1-REQ                                
                           K800-AMT-SOC-CPF2-REQ                                
                           K800-AMT-SOC-CPF3-REQ                                
                           K800-AMT-SOC-CPF4-REQ.                               
           MOVE ZEROES TO  K800-AMT-CD-CASH                                     
                           K800-AMT-CD-CPF1                                     
                           K800-AMT-CD-CPF2                                     
                           K800-AMT-CD-CPF3                                     
                           K800-AMT-CD-CPF4                                     
                           K800-NUM-PREMIUM-RATE.                               
           MOVE ZEROES TO  K800-NUM-SHR1                                        
                           K800-NUM-SHR2                                        
                           K800-NUM-SHR3                                        
                           K800-NUM-SHR4                                        
                           K800-NUM-SHR-BASE.                                   
           MOVE 'Y'    TO  K800-NUM-SCCC-ELGBTY.                                
           MOVE ZEROS  TO  K800-AMT-REGN-DEPOSIT-CASH                           
                           K800-AMT-REGN-DEPOSIT-CPF1                           
                           K800-AMT-REGN-DEPOSIT-CPF2                           
                           K800-AMT-REGN-DEPOSIT-CPF3                           
                           K800-AMT-REGN-DEPOSIT-CPF4.                          
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1200-MOVE-FIELDS-K800.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE 'N'                      TO K800-NUM-STATUS                     
           IF F520-CDE-REQUEST-STATUS = 'U'                                     
             IF F520-DTE-BALLOT >= '201004'                                     
               IF F520-NUM-ALLO-CAT = 'SBF' OR 'BTO' OR 'ROF' OR 'OBF'          
                  MOVE 'C'               TO K800-NUM-STATUS                     
                  MOVE 'NS'              TO K800-NUM-ALLOC-TAG                  
                                            K800-NUM-CANCEL-REASON              
                  MOVE WS-CUR-DATE       TO K800-DTE-CANCEL                     
               END-IF                                                           
             END-IF                                                             
           END-IF.                                                              
                                                                                
           MOVE F520-CDE-FLAT-TYPE       TO K800-NUM-FLAT-TYPE                  
                                            K800-NUM-BTO-FLAT-TYPE.             
           MOVE F520-NUM-REGN            TO K800-NUM-REGN.                      
           MOVE WS-CUR-DATE              TO K800-DTE-UPDATE.                    
           MOVE F520-CDE-CATEGORY        TO K800-NUM-CAT.                       
           MOVE F520-CDE-ALLOC-SCH       TO K800-NUM-ALLO-SCHEME.               
           MOVE F520-CDE-HOUSEHOLD       TO K800-NUM-HOUSEHOLD.                 
           MOVE F520-NUM-TWO-ROOMER      TO K800-NUM-TWO-ROOMER.                
           MOVE F520-NUM-LOW-FLOOR       TO K800-NUM-LOW-FLOOR.                 
           MOVE F520-CDE-REQUEST-STATUS  TO K800-NUM-BALLOT-STATUS.             
      ** BP133412                                                               
           MOVE F520-NUM-PROV-TAG        TO K800-NUM-PROV-TAG.                  
           MOVE F520-NUM-PROV-REASON     TO K800-NUM-PROV-REASON.               
      ** BP133501                                                               
           MOVE F520-CDE-BALLOT-HOUSEHOLD TO                                    
                                          K800-CDE-BALLOT-HOUSEHOLD.            
                                                                                
           IF F520-CDE-IDP-SCH = SPACES                                         
               PERFORM 1205-DECODE-IDP-SCHEME THRU 1205-EXIT                    
               MOVE WS-DESC              TO K800-NUM-IDP-SCHEME                 
           ELSE                                                                 
               MOVE F520-CDE-IDP-SCH     TO K800-NUM-IDP-SCHEME                 
           END-IF.                                                              
                                                                                
      ** SEARCH F520-CDE-ALLOC-SCH IN SERS TABLE **                             
            MOVE SPACES        TO WS-ALLOC-SCH-FOUND-SW.                        
            SET WS-SERS-PTR    TO 1.                                            
            SEARCH WS-SERS-SCH                                                  
               AT END                                                           
                  MOVE SPACES         TO WS-ALLOC-SCH-FOUND-SW                  
               WHEN WS-SERS-SCHEME (WS-SERS-PTR) = F520-CDE-ALLOC-SCH           
                  MOVE 'Y'            TO WS-ALLOC-SCH-FOUND-SW                  
            END-SEARCH.                                                         
                                                                                
      ** DETERMINE ALLOCATION CATEGORY **                                       
           IF F520-NUM-ALLO-CAT = SPACES                                        
              PERFORM 1230-MOVE-ALLOC-CAT THRU 1230-EXIT                        
           ELSE                                                                 
              MOVE F520-NUM-ALLO-CAT TO K800-NUM-ALLO-CAT                       
           END-IF.                                                              
                                                                                
           IF K800-NUM-ALLO-CAT = 'DBS'                                         
              MOVE 'P'               TO K800-NUM-PAYMENT-SCHEME                 
              MOVE F520-CDE-NT1      TO K800-NUM-NEW-TOWN                       
           END-IF.                                                              
                                                                                
      ** IF REN CASES, REMAIN AS IDP=NRT                                        
      ** IF SERS CASES, REMAIN AS PA                                            
      *------------------------------------------------------------             
      *  1) BE, BTO: (DTE-BALLOT = 200309)                                      
      *     - HH-TYPE = T; IDP-SCH = 'LRT'                                      
      *     - HH-TYPE NE T:                                                     
      *          HH-INCOME > 2000; IDP-SCH = 'PA'                               
      *          HH-INCOME <= 2000; ROOM-TYPE = 4:                              
      *          ALLOC-SCH    ELIG-SCH   IDP-SCH                                
      *          1.  PA       PA/FS      LIF                                    
      *          2.  PA       OR         PA                                     
      *          3.  TCP     *NO CHK*    LIF                                    
      *  2) RHA/RHO/RHS: (DTE-REGN >= 20031001)                                 
      *          FT         IDP-SCH                                             
      *      1.  1,2,3,4    LIF                                                 
      *      2.  5,6        PA                                                  
      *  3)  SERS CASES: IDP-SCH IS ALWAYS 'PA' (DTE-REGN >= 20031001)          
      *------------------------------------------------------------             
           IF F520-CDE-FLAT-TYPE (1:1)  = 'E'                                   
              MOVE '6 '                    TO WS-IDP-FLAT-TYPE                  
           ELSE                                                                 
              MOVE F520-CDE-FLAT-TYPE      TO WS-IDP-FLAT-TYPE                  
           END-IF.                                                              
                                                                                
           IF WS-IDP-FLAT-TYPE   = '1A' OR '2A' OR 'SP'                         
              MOVE      'SA '              TO K800-NUM-IDP-SCHEME               
           ELSE                                                                 
              IF (K800-NUM-ALLO-CAT = 'BE ' OR 'BTO' OR 'SER' OR 'SBF'          
                                            OR 'ROF' OR 'OBF')                  
                 PERFORM 1202-GET-BTO-BE-IDP-SCHEME     THRU 1202-EXIT          
              ELSE                                                              
                 IF (F520-DTE-REQUEST >= '20031001')                            
                    PERFORM 1203-GET-RHA-IDP-SCHEME     THRU 1203-EXIT          
                 ELSE                                                           
                    IF F520-CDE-FLAT-TYPE = '3 '                                
                       IF F520-CDE-HOUSEHOLD = 'T'                              
                          MOVE 'FRT'       TO K800-NUM-IDP-SCHEME               
                       ELSE                                                     
                          MOVE 'FNS'       TO K800-NUM-IDP-SCHEME               
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      **-- CHANGE LIF IDP-SCHEME TO PA                                          
           IF (K800-NUM-IDP-SCHEME = 'LIF')   AND                               
              (K800-NUM-ALLO-CAT NOT = '3R ')                                   
              MOVE 'PA '          TO K800-NUM-IDP-SCHEME                        
           END-IF.                                                              
                                                                                
      **@  **CHGE-REQ-BP130820                                                  
           IF F520-CDE-FLAT-TYPE = '1A' OR '2A'                                 
              MOVE 'N'                    TO K800-NUM-CA-TAG                    
           ELSE IF F520-CDE-FLAT-TYPE = '3 '                                    
              MOVE 'E'                    TO K800-NUM-CA-TAG                    
           END-IF.                                                              
                                                                                
      ****   DECODE THE PRIORITY SCHEEM.                                        
           MOVE 'Y'                       TO WS-FOUND-SW.                       
           SET WS-ALLOC-PTR               TO 1.                                 
                                                                                
           SEARCH WS-ALLOC-SCH                                                  
              AT END MOVE 'N'             TO WS-FOUND-SW                        
              WHEN WS-ALLOC-SCH-DESP(WS-ALLOC-PTR) = F520-CDE-ALLOC-SCH         
                   MOVE WS-MAIN-SCH-CD(WS-ALLOC-PTR)                            
                                          TO WS-DESC                            
           END-SEARCH.                                                          
                                                                                
           IF WS-FOUND-SW = 'Y'                                                 
              EVALUATE WS-DESC                                                  
              WHEN 'REN'                                                        
              WHEN 'RH '                                                        
                   IF (F520-DTE-BALLOT NOT = SPACES)                            
                      MOVE 'E'            TO K800-NUM-CA-TAG                    
                   END-IF                                                       
              WHEN 'RDC'                                                        
              WHEN 'MCP'                                                        
              WHEN 'PA '                                                        
                   MOVE 'Y'               TO K800-NUM-CA-TAG                    
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
      * IF ALLOC-SCH = 'STD' OR 'RP ' OR SERS SCHEME, GET F520-CA-TAG*          
      * ELSE IF DTE-REGN >= 20031001, CA-TAG = 'Y'.                  *          
      *--------------------------------------------------------------*          
           IF (F520-CDE-ALLOC-SCH = 'STD' OR 'RP ')  OR                         
              (C-ALLOC-SCH-FOUND)                                               
              MOVE F520-NUM-SPR-TAG         TO K800-NUM-SPR-TAG                 
              MOVE F520-NUM-SUBSIDISED-LOAN TO K800-NUM-SUBSIDISED-LOAN         
              MOVE F520-NUM-CAP             TO K800-NUM-CAP                     
              MOVE F520-NUM-CA-TAG          TO K800-NUM-CA-TAG                  
           ELSE                                                                 
              IF F520-DTE-REQUEST >= '20031001'                                 
                 MOVE     'Y'               TO K800-NUM-CA-TAG                  
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F520-CDE-ALLOC-SCH = 'BCA' OR 'BCE' OR 'BCL' OR 'BCS' OR          
                                   'BDC' OR 'REA' OR 'REE' OR 'REN' OR          
                                   'RES'                                        
              IF F520-CDE-HOUSEHOLD = 'T'                                       
                  MOVE 'H'               TO F520-CDE-HOUSEHOLD                  
                                            K800-NUM-HOUSEHOLD.                 
                                                                                
      ** FOR MATURE NT, ONLY SUCC REQUEST UPDATE TO SOC MASTER                  
      ** FOR NON-MATURE NT, WAITING LIST SHOULD NOT HAVE DATE-BALLOT            
           IF F520-CDE-ZONE = SPACES OR LOW-VALUES                              
      *       MOVE F520-CDE-SUCC-NT-ZONE TO K800-NUM-NEW-TOWN                   
              MOVE F520-CDE-NT1          TO K800-NUM-NEW-TOWN                   
           END-IF.                                                              
                                                                                
           MOVE F520-DTE-BALLOT          TO K800-DTE-BALLOT.                    
           IF F520-NUM-ALLO-CAT = 'DBS'                                         
              EVALUATE F520-CDE-NT1                                             
              WHEN 'TAP'                                                        
                   MOVE '201106'         TO K800-DTE-BALLOT                     
              WHEN 'TP '                                                        
                   MOVE '200904'         TO K800-DTE-BALLOT                     
              WHEN 'KWN'                                                        
                   MOVE '200801'         TO K800-DTE-BALLOT                     
              WHEN 'AMK'                                                        
                   MOVE '200807'         TO K800-DTE-BALLOT                     
              WHEN 'BH '                                                        
                   MOVE '200810'         TO K800-DTE-BALLOT                     
              WHEN 'YS '                                                        
                   MOVE '201102'         TO K800-DTE-BALLOT                     
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
           MOVE F520-NUM-NRIC1           TO K800-NUM-NRIC1.                     
           IF F520-CDE-JB = SPACES                                              
               IF F520-CDE-ALLOC-SCH = 'JB '                                    
                   MOVE '1' TO K800-NUM-JT-BALLOT-MTF                           
               ELSE                                                             
               IF F520-CDE-ALLOC-SCH = 'MT ' OR 'MTS'                           
                   MOVE '4' TO K800-NUM-JT-BALLOT-MTF                           
               ELSE                                                             
               IF F520-CDE-ALLOC-SCH = 'TCP'                                    
                   MOVE '9' TO K800-NUM-JT-BALLOT-MTF                           
               ELSE                                                             
                   MOVE '0' TO K800-NUM-JT-BALLOT-MTF                           
           ELSE                                                                 
               MOVE F520-CDE-JB          TO K800-NUM-JT-BALLOT-MTF.             
                                                                                
           MOVE F520-NUM-JB-CNT(2:1)     TO K800-QTY-JT-BALLOT.                 
      *    MOVE F520-CDE-BO              TO K800-NUM-BO.                        
           IF F520-CDE-ALLOC-SCH = 'PA ' AND                                    
              F520-CDE-REQ-ALLOC-SCH = 'TCP'                                    
              MOVE 'PA '                 TO K800-NUM-ELIG-SCHEME                
           ELSE                                                                 
              MOVE F520-CDE-ELIG-SCH     TO K800-NUM-ELIG-SCHEME                
           END-IF.                                                              
           MOVE F520-CDE-NT-WITH-LAND    TO K800-NUM-NT-WITH-LAND.              
           MOVE F520-CDE-PARENT-CHILD    TO K800-NUM-PARENT-CHILD.              
           MOVE F520-CDE-ZONE            TO K800-NUM-ZONE.                      
           MOVE F520-DTE-1ST-LETTER      TO K800-DTE-1ST-LETTER.                
           MOVE F520-NUM-APPLN-TYPE      TO K800-NUM-APPLN-TYPE.                
           MOVE F520-DTE-REQUEST         TO K800-DTE-REGN                       
                                            WS-F800-DTE-REGN                    
                                            K800-DTE-QN-RECV.                   
           IF (F520-NUM-OWN-PTE-PRTY = 'Y') OR                                  
              (F520-NUM-DISPOSED-PTE-PRTY = 'Y')                                
              MOVE 'Y' TO K800-NUM-PTE-PRTY.                                    
                                                                                
      ** NEW ADDITION FOR WIS                                                   
           IF F520-NUM-ALLO-CAT = 'BE' OR 'BTO' OR 'SBF'                        
             IF F520-CDE-HOUSEHOLD = 'T' AND F520-CDE-ZONE NOT = SPACES         
              IF  F520-NUM-ALLO-CAT NOT = 'BE' AND 'SBF'                        
                 PERFORM 1210-PROCESS-DATE  THRU 1210-EXIT                      
                 PERFORM 1220-READ-BP13K530 THRU 1220-EXIT                      
              END-IF                                                            
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF F520-NUM-MTH-RESIDE IS NOT NUMERIC                                
                MOVE ZEROS TO F520-NUM-MTH-RESIDE.                              
                                                                                
           IF F520-NUM-MTH-SUBLET IS NOT NUMERIC                                
                MOVE ZEROS TO F520-NUM-MTH-SUBLET.                              
                                                                                
           IF F520-NUM-MTH-RES-JB-IND IS NOT NUMERIC                            
                MOVE ZEROS TO F520-NUM-MTH-RES-JB-IND.                          
           MOVE F520-NUM-5YR-OCCUPN      TO K800-NUM-5YR-OCCUPN.                
           MOVE F520-NUM-MTH-RESIDE      TO K800-NUM-MTH-RESIDE.                
           MOVE F520-NUM-MTH-RES-JB-IND  TO K800-NUM-MTH-RES-JB-IND.            
           MOVE F520-NUM-MTH-SUBLET      TO K800-NUM-MTH-SUBLET.                
           MOVE F520-CDE-JB-PARENT       TO K800-NUM-JT-BALLOT-PARENT.          
           MOVE F520-NUM-JB-REGN         TO K800-NUM-JT-BALLOT-REGN.            
                                                                                
           IF F520-NUM-NRIC4(1:1) NOT = '#' AND SPACES AND LOW-VALUES           
              MOVE F520-NUM-NRIC4 TO K800-NUM-NRIC4                             
              MOVE F520-NUM-NRIC3 TO K800-NUM-NRIC3                             
              MOVE F520-NUM-NRIC2 TO K800-NUM-NRIC2                             
              MOVE '4'            TO K800-NUM-JT-APPL                           
              MOVE 'JT'           TO K800-NUM-HOLDING-TYPE                      
           ELSE                                                                 
           IF F520-NUM-NRIC3(1:1) NOT = '#' AND SPACES AND LOW-VALUES           
              MOVE F520-NUM-NRIC3 TO K800-NUM-NRIC3                             
              MOVE F520-NUM-NRIC2 TO K800-NUM-NRIC2                             
              MOVE '3'            TO K800-NUM-JT-APPL                           
              MOVE 'JT'           TO K800-NUM-HOLDING-TYPE                      
           ELSE                                                                 
           IF F520-NUM-NRIC2(1:1) NOT = '#' AND SPACES AND LOW-VALUES           
              MOVE F520-NUM-NRIC2 TO K800-NUM-NRIC2                             
              MOVE '2'            TO K800-NUM-JT-APPL                           
              MOVE 'JT'           TO K800-NUM-HOLDING-TYPE                      
           ELSE                                                                 
              MOVE '1'            TO K800-NUM-JT-APPL                           
              MOVE 'SO'           TO K800-NUM-HOLDING-TYPE.                     
                                                                                
           IF F520-NUM-NT-FT-QUEUE NOT = SPACES                                 
              MOVE F520-NUM-NT-FT-QUEUE TO K800-NUM-NT-FT-QUEUE.                
                                                                                
      ** BP13F520 STORE 2 BYTES WAIT-TIME , BP13K800 - STORE 3 BYTES            
      **   MOVE F520-NUM-WAIT-TIME      TO WS-WAIT-TIME-F520.                   
      **   MOVE WS-COMPUTE-WAIT-TIME    TO K800-NUM-WAIT-TIME.                  
                                                                                
           IF (F520-CDE-ZONE = 'ME' OR 'ZN') OR                                 
              (F520-NUM-ALLO-CAT = 'BTO')                                       
              MOVE ZEROES          TO K800-AMT-REGN-REQ                         
                                      K800-AMT-REGN-GST                         
              MOVE 'Y'             TO K800-NUM-CA-TAG                           
           END-IF.                                                              
                                                                                
           MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-REQ.                            
           MOVE SPACES TO K800-NUM-FS-DEFER-TAG.                                
                                                                                
           IF (K800-DTE-REGN < '20030101') AND                                  
              (K800-NUM-ALLO-CAT NOT = 'BTO' AND 'BE ' AND '3R ' AND            
                                       'WIA' AND 'WIB' AND 'WIC' AND            
                                       'WIH' AND 'SBF' AND 'NPL')               
              MOVE SPACES          TO K800-NUM-LOAN-TAG                         
                                      K800-NUM-ORIG-LOAN-TAG                    
                                      K800-NUM-MORT-LOAN-POLICY                 
                                      K800-NUM-ELIG-LOAN-POLICY                 
           ELSE                                                                 
             IF (F520-NUM-ALLO-CAT = '3R ' OR 'WIA' OR 'WIB' OR                 
                                     'WIC' OR 'WIH')                            
                MOVE F520-NUM-APPL-LOAN-REQ    TO F520-NUM-LOAN-TAG             
             END-IF                                                             
                                                                                
             IF F520-NUM-LOAN-TAG = 'H' AND                                     
                F520-DTE-BALLOT < '202310'                                      
                IF C-ALLOC-SCH-FOUND                                            
                   MOVE F520-NUM-LOAN-TAG      TO K800-NUM-LOAN-TAG             
                ELSE                                                            
                   MOVE 'P'                    TO K800-NUM-LOAN-TAG             
                END-IF                                                          
             ELSE                                                               
                MOVE F520-NUM-LOAN-TAG         TO K800-NUM-LOAN-TAG             
             END-IF                                                             
                                                                                
                                                                                
             MOVE F520-NUM-ORIG-LOAN-TAG    TO K800-NUM-ORIG-LOAN-TAG           
             MOVE F520-NUM-MORT-LOAN-POLICY TO K800-NUM-MORT-LOAN-POLICY        
             MOVE F520-NUM-ELIG-LOAN-POLICY TO K800-NUM-ELIG-LOAN-POLICY        
           END-IF.                                                              
                                                                                
           MOVE F520-NUM-PREM-CDE         TO K800-NUM-PREM-CODE.                
                                                                                
           IF F520-NUM-ALLO-CAT = 'BTO'                                         
              PERFORM 6200-READ-K813    THRU 6200-EXIT                          
              MOVE K813-CDE-NT            TO K800-NUM-NEW-TOWN                  
              MOVE F520-CDE-NT1           TO K800-NUM-BTO-ZONE                  
           END-IF.                                                              
                                                                                
           IF F520-NUM-ALLO-CAT = 'NPL'                                         
              MOVE SPACES                 TO K800-NUM-NEW-TOWN                  
              MOVE F520-CDE-NT1           TO K800-NUM-ZONE                      
           END-IF.                                                              
                                                                                
           IF F520-NUM-ALLO-CAT = 'ROF' OR 'OBF'                                
              MOVE F520-CDE-NT1           TO K800-NUM-BTO-ZONE                  
           END-IF.                                                              
                                                                                
           MOVE  F520-CDE-CITIZENSHIP-HOUSEHOLD                                 
                       TO K800-CDE-CITIZENSHIP-HOUSEHOLD.                       
           MOVE F520-NUM-SMS-STATUS      TO K800-NUM-SMS-STATUS.                
           MOVE F520-NUM-SMS-FT          TO K800-NUM-SMS-FT.                    
           MOVE F520-NUM-RSL-STATUS      TO K800-NUM-RSL-STATUS.                
           MOVE F520-NUM-RSL-FT          TO K800-NUM-RSL-FT.                    
           MOVE F520-NUM-RDB-STATUS      TO K800-NUM-RDB-STATUS.                
           MOVE F520-NUM-RDB-FT          TO K800-NUM-RDB-FT.                    
           MOVE F520-CDE-REQ-ALLOC-SCH   TO K800-CDE-REQ-ALLOC-SCH.             
           MOVE F520-NUM-BUYBACK         TO K800-NUM-BUYBACK.                   
           MOVE F520-NUM-PORT-ELIG-TAG   TO K800-NUM-PORT-ELIG-TAG.             
           MOVE F520-CDE-SPL-APPRV-TYPE  TO K800-CDE-SPL-APPRV-TYPE.            
           MOVE F520-NUM-MCPS-POSTAL     TO K800-NUM-MCPS-POSTAL.               
           MOVE F520-NUM-MCPS            TO K800-CDE-MCPS-REQ(1:1).             
           MOVE F520-CDE-RESIDENT-HA1    TO K800-CDE-MCPS-REQ(2:1).             
                                                                                
           IF F520-CDE-REQ-ALLOC-SCH = SPACES OR LOW-VALUES                     
              MOVE F520-CDE-ELIG-SCH     TO K800-CDE-REQ-ELIG-SCH               
           ELSE                                                                 
              IF F520-CDE-REQ-ALLOC-SCH  = 'TCP'                                
                 MOVE 'TCP'              TO K800-CDE-REQ-ELIG-SCH               
              ELSE                                                              
                 MOVE F520-CDE-ELIG-SCH  TO K800-CDE-REQ-ELIG-SCH               
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K800-NUM-ALLO-SCHEME     TO K800-NUM-SERS-ALLOC-PRIO.           
                                                                                
           IF F520-CDE-FLAT-TYPE = '1A' OR '2A' OR 'SP'                         
              MOVE 'Y'                   TO K800-NUM-SA-CPF                     
              MOVE 'N'                   TO K800-NUM-ORIG-LOAN-TAG              
              MOVE 'N'                   TO K800-NUM-LOAN-TAG                   
              MOVE 'N'                   TO K800-NUM-CA-TAG                     
              MOVE 'SA'                  TO K800-NUM-IDP-SCHEME                 
           END-IF.                                                              
                                                                                
           IF F520-CDE-FLAT-TYPE = '1F'                                         
              MOVE ' '                   TO K800-NUM-SA-CPF                     
              MOVE 'N'                   TO K800-NUM-ORIG-LOAN-TAG              
              MOVE 'N'                   TO K800-NUM-LOAN-TAG                   
              MOVE 'N'                   TO K800-NUM-CA-TAG                     
              MOVE 'PA'                  TO K800-NUM-IDP-SCHEME                 
           END-IF.                                                              
                                                                                
           IF F520-DTE-BK-APPT NOT = SPACES AND LOW-VALUES                      
              MOVE  F520-DTE-BK-APPT     TO K800-DTE-BK-APPT                    
              MOVE  F520-TME-BK-APPT     TO K800-TME-BK-APPT                    
           END-IF.                                                              
                                                                                
           IF (K800-NUM-ALLO-CAT = 'WIC' AND                                    
               K800-NUM-NT-FT-QUEUE > '02000') OR                               
              (K800-NUM-ALLO-CAT = 'WIA' AND                                    
               K800-NUM-NT-FT-QUEUE(1:1) =  'J') OR                             
              (K800-NUM-ALLO-CAT = 'WIA' AND                                    
               K800-NUM-NT-FT-QUEUE > 'A2500') OR                               
              (K800-NUM-ALLO-CAT = 'WIB' AND                                    
               K800-NUM-NT-FT-QUEUE > 'B2000') OR                               
              (K800-NUM-ALLO-CAT = 'WIH' AND                                    
               K800-NUM-NT-FT-QUEUE > '02000')                                  
              MOVE  SPACES               TO K800-DTE-BK-APPT                    
                                            K800-TME-BK-APPT                    
           END-IF.                                                              
                                                                                
           IF ((K800-AMT-HSE-INCOME > 14000) AND                                
              (K800-NUM-ALLO-CAT NOT = 'SER') AND                               
              (K800-DTE-BALLOT < '202310'))                                     
              MOVE 'B'                   TO K800-NUM-LOAN-TAG                   
              IF (K800-NUM-ALLO-CAT NOT = '3R ' AND 'WIA' AND 'WIB' AND         
                                          'WIC' AND 'WIH' AND 'NPL')            
                 PERFORM 6050-READ-K648     THRU 6050-EXIT                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF ((K800-AMT-HSE-INCOME > 14000) AND                                
              (K800-NUM-ALLO-CAT  = 'DBS'))                                     
              MOVE 'B'                   TO K800-NUM-LOAN-TAG                   
                                            K800-NUM-ORIG-LOAN-TAG              
              IF (K800-NUM-ALLO-CAT NOT = '3R ' AND 'WIA' AND 'WIB' AND         
                                          'WIC' AND 'WIH' AND 'NPL')            
                 PERFORM 6050-READ-K648     THRU 6050-EXIT                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F520-NUM-ALLO-CAT = 'NPL'                                         
              MOVE 'N'                       TO K800-NUM-LOAN-TAG               
           END-IF.                                                              
                                                                                
           MOVE F520-NUM-HALF-IDP            TO K800-NUM-HALF-IDP.              
           MOVE F520-NUM-HARDLUCK            TO K800-NUM-HARDLUCK.              
           MOVE F520-NUM-APPS                TO K800-NUM-APPS.                  
           MOVE F520-NUM-APPS-ELIG-TAG       TO K800-NUM-APPS-ELIG-TAG.         
           MOVE F520-NUM-PPS-ELIG-TAG        TO K800-NUM-PPS-ELIG.              
           MOVE F520-NUM-AST                 TO K800-NUM-AST-ELIG.              
           IF F520-NUM-PPS-SUCC = 'Y'                                           
              MOVE F520-CDE-REQUEST-STATUS   TO K800-NUM-PPS-QUOTA              
           END-IF.                                                              
           IF F520-NUM-AST-SUCC = 'Y'                                           
              MOVE F520-CDE-REQUEST-STATUS   TO K800-NUM-AST-QUOTA              
           END-IF.                                                              
           MOVE F520-NUM-CCA                 TO K800-NUM-CCA.                   
           MOVE F520-NUM-CCA-SUCC            TO K800-NUM-CCA-QUOTA.             
           MOVE F520-NUM-FT2T                TO K800-NUM-FT2T.                  
           MOVE F520-NUM-GEN3                TO K800-NUM-GEN3.                  
           MOVE F520-NUM-STEPUP              TO K800-NUM-STEPUP.                
                                                                                
      **BP137817 - POPULATE K800-NUM-NHFL                                       
           IF (F520-NUM-ALLO-CAT = 'BTO') AND                                   
              (F520-DTE-REQUEST >= '20190510')                                  
              MOVE 'N'                 TO K800-NUM-NHFL                         
           END-IF                                                               
                                                                                
           IF F520-NUM-INCOME-EXEMPTION = 'Y'                                   
              MOVE 'C'                 TO K800-NUM-ELDERLY-EXEMPTION            
           ELSE                                                                 
              MOVE SPACES              TO K800-NUM-ELDERLY-EXEMPTION            
           END-IF.                                                              
           MOVE F520-NUM-NTIMER        TO K800-NUM-NTIMER.                      
           MOVE F520-NUM-ELDERLY       TO K800-NUM-ELDERLY.                     
           MOVE F520-NUM-PPO           TO K800-NUM-PPO.                         
           MOVE F520-NUM-WARD          TO K800-NUM-FLATLIST-GRO.                
      *CR BP139530 SC54 START.                                                  
           MOVE F520-NUM-FTPMC         TO K800-NUM-FTPMC.                       
      *CR BP139530 SC54 END.                                                    
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1201-DETERMINE-IDP-HALF.                                                 
      *-------------------------------------------------------------            
                                                                                
           IF K800-NUM-ELIG-SCHEME = 'FS '                                      
              IF ((K800-NUM-FLAT-TYPE (1:1)                                     
                              = '1' OR '2' OR '3' OR '4' OR '5') AND            
                  (K800-NUM-FLAT-TYPE NOT = '1A' AND '2A')) AND                 
                 ((K800-NUM-HOUSEHOLD = 'H' OR 'T') OR                          
                  (K800-NUM-FT2T = 'Y'))                                        
                 IF ( WS-AGE-APPL <= 30 AND WS-AGE-APPL > 0 ) AND               
                      WS-FIANCEE-REL-TAG                                        
                     MOVE 'S'              TO K800-NUM-HALF-IDP                 
                 ELSE                                                           
                 IF                                                             
                    ( WS-AGE-FIANCEE <= 30 AND WS-AGE-FIANCEE > 0 )             
                     MOVE 'S'              TO K800-NUM-HALF-IDP                 
                 END-IF                                                         
                END-IF                                                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K800-NUM-ELIG-SCHEME = 'PA ' OR 'TCP' OR 'NCS'                    
              IF ((K800-NUM-FLAT-TYPE (1:1)                                     
                              = '1' OR '2' OR '3' OR '4' OR '5') AND            
                  (K800-NUM-FLAT-TYPE NOT = '1A' AND '2A')) AND                 
                 ((K800-NUM-HOUSEHOLD = 'H' OR 'T') OR                          
                  (K800-NUM-FT2T = 'Y'))                                        
                 IF ( WS-AGE-APPL <= 30 AND WS-AGE-APPL > 0 ) AND               
                    ( WS-APPL-MARITAL-STATUS = '2' OR 'M')     AND              
                      WS-SPOUSE-REL-TAG                                         
                      MOVE 'S'              TO K800-NUM-HALF-IDP                
                 ELSE                                                           
                 IF                                                             
                    ( WS-AGE-SPOUSE <= 30 AND WS-AGE-SPOUSE > 0 ) AND           
                    ( WS-SPOUSE-MARITAL-STATUS = '2' OR 'M' )                   
                      MOVE 'S'              TO K800-NUM-HALF-IDP                
                END-IF                                                          
              END-IF                                                            
             END-IF                                                             
           END-IF.                                                              
                                                                                
           MOVE SPACES         TO  WS-SPOUSE-NUM-RELATIONSHIP                   
                                   WS-FIANCEE-NUM-RELATIONSHIP                  
                                   WS-APPL-MARITAL-STATUS                       
                                   WS-SPOUSE-MARITAL-STATUS.                    
           MOVE ZEROES         TO  WS-AGE-APPL                                  
                                   WS-AGE-SPOUSE                                
                                   WS-AGE-FIANCEE.                              
                                                                                
                                                                                
       1201-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1202-GET-BTO-BE-IDP-SCHEME.                                              
      *---------------------------------------------------------------          
                                                                                
           IF F520-CDE-ALLOC-SCH = 'MT ' OR 'MTS'                               
              MOVE 'TMT'              TO K800-NUM-IDP-SCHEME                    
              GO TO 1202-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F520-CDE-ALLOC-SCH = 'JB '                                        
              MOVE 'TJB'              TO K800-NUM-IDP-SCHEME                    
              GO TO 1202-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF WS-IDP-FLAT-TYPE NOT = '2 ' AND '3 ' AND '4 '                     
              MOVE 'PA '              TO K800-NUM-IDP-SCHEME                    
              GO TO 1202-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F520-CDE-HOUSEHOLD = 'T'                                          
              MOVE 'LRT'              TO K800-NUM-IDP-SCHEME                    
              GO TO 1202-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF K800-AMT-HSE-INCOME > 2000                                        
              MOVE 'PA '              TO K800-NUM-IDP-SCHEME                    
           ELSE                                                                 
              EVALUATE TRUE                                                     
                 WHEN F520-CDE-ALLOC-SCH = 'PA '                                
                     IF F520-CDE-ELIG-SCH = 'PA ' OR 'FS '                      
                        MOVE  'LIF'          TO K800-NUM-IDP-SCHEME             
                     ELSE                                                       
                        IF F520-CDE-ELIG-SCH = 'OR '                            
                           MOVE 'PA '        TO K800-NUM-IDP-SCHEME             
                        END-IF                                                  
                     END-IF                                                     
                 WHEN F520-CDE-ALLOC-SCH = 'TCP'                                
                     MOVE  'LIF'             TO K800-NUM-IDP-SCHEME             
                 WHEN OTHER                                                     
                     MOVE F520-CDE-ALLOC-SCH TO WS-LIF-ALLOC-SCHEME             
                     MOVE F520-CDE-ELIG-SCH  TO WS-LIF-ELIG-SCHEME              
                     IF NOT N-LIF-ALLOC-SCH                                     
                        IF NOT N-LIF-ELIG-SCH                                   
                           MOVE 'LIF'        TO K800-NUM-IDP-SCHEME             
                        ELSE                                                    
                           MOVE 'PA '        TO K800-NUM-IDP-SCHEME             
                        END-IF                                                  
                     ELSE                                                       
                        MOVE 'PA '           TO K800-NUM-IDP-SCHEME             
                     END-IF                                                     
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
       1202-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1203-GET-RHA-IDP-SCHEME.                                                 
      *---------------------------------------------------------------          
      *----------------------------------------                                 
      * DO NOT GET IDP-SCH FOR THE FF CASES:                                    
      * - RP; STD                                                               
      *----------------------------------------                                 
           IF F520-CDE-ALLOC-SCH = 'STD' OR 'RP '                               
              GO TO 1203-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F520-CDE-ALLOC-SCH = 'RHA' OR 'RHO' OR 'RHS'                      
              IF WS-IDP-FLAT-TYPE <= '4 '                                       
                 MOVE 'LIF'      TO K800-NUM-IDP-SCHEME                         
              ELSE                                                              
                 MOVE 'PA '      TO K800-NUM-IDP-SCHEME                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       1203-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1205-DECODE-IDP-SCHEME.                                                  
      *-------------------------------------------------------------            
           MOVE 'Y'                      TO  WS-FOUND-SW.                       
           MOVE SPACES                   TO WS-DESC.                            
           SET WS-IDP-PTR             TO 1                                      
           SEARCH WS-IDP-SCH                                                    
               AT   END MOVE 'N'       TO   WS-FOUND-SW                         
               WHEN WS-ALC-SCH-CODE (WS-IDP-PTR) = F520-CDE-ALLOC-SCH           
                    MOVE WS-IDP-SCH-CODE (WS-IDP-PTR) TO WS-DESC                
           END-SEARCH                                                           
                                                                                
           IF  WS-FOUND-SW = 'N'                                                
               MOVE 'PA '                TO  WS-DESC                            
           END-IF.                                                              
                                                                                
       1205-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1210-PROCESS-DATE.                                                       
      *-------------------------------------------------------------            
      *-----------> BACKDATE FOR 6 MONTHS                                       
                                                                                
           SUBTRACT 6 FROM WS-REGN-MM GIVING WS-REGN-MM-S99.                    
                                                                                
           IF WS-REGN-MM-S99 < 1                                                
              ADD      12   TO   WS-REGN-MM-S99                                 
              SUBTRACT  1   FROM WS-REGN-CCYY-9                                 
           END-IF.                                                              
                                                                                
           MOVE WS-REGN-MM-S99     TO WS-REGN-MM.                               
                                                                                
      *-------> CHECK IF LAST DAY FOR THE NEW MONTH IS VALID                    
                                                                                
           MOVE 'CD'               TO WS-IN-OPTION.                             
           PERFORM 1211-CALL-AV02C001    THRU 1211-EXIT.                        
                                                                                
      *-------> IF NOT VALID, GET LAST DAY FOR THE NEW MONTH                    
                                                                                
           IF WS-RETURN = 'EID'                                                 
              MOVE  '01'           TO WS-REGN-DD                                
              MOVE  'LM'           TO WS-IN-OPTION                              
              PERFORM 1211-CALL-AV02C001    THRU 1211-EXIT                      
              MOVE  WS-RET-MM      TO WS-REGN-DD                                
           END-IF.                                                              
                                                                                
       1210-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1211-CALL-AV02C001.                                                      
      *-------------------------------------------------------------            
           MOVE WS-F800-DTE-REGN       TO WS-IN-DATE.                           
           MOVE ZEROS                  TO WS-RETURN.                            
                                                                                
           CALL 'AV02C001'             USING LINK-REC.                          
                                                                                
       1211-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1220-READ-BP13K530.                                                      
      *-------------------------------------------------------------            
           MOVE WS-F800-DTE-REGN             TO    K530-KEY-FLD.                
           START BP13K530 KEY >= K530-KEY-FLD.                                  
                                                                                
           EVALUATE K530-STATUS                                                 
           WHEN ZEROS                                                           
              PERFORM 1221-READNEXT-BP13K530 THRU 1221-EXIT                     
           WHEN 23                                                              
              DISPLAY 'BP13K530 RECORD NOT FOUND, KEY IS ' K530-KEY-FLD         
           WHEN OTHER                                                           
              DISPLAY 'BP13K530 START ERROR, STATUS IS ' K530-STATUS            
              DISPLAY 'RECORD KEY IS ' K530-KEY-FLD                             
           END-EVALUATE.                                                        
                                                                                
       1220-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1221-READNEXT-BP13K530.                                                  
      *-------------------------------------------------------------            
           READ BP13K530 NEXT RECORD.                                           
                                                                                
           EVALUATE K530-STATUS                                                 
           WHEN ZEROS                                                           
              MOVE K530-NUM-FIRST-REGN    TO K800-NUM-CUR-REGN                  
              DISPLAY 'K530-KEY-FLD - ' K530-KEY-FLD                            
              DISPLAY 'ORG - ' K800-NUM-REGN ' CUR - ' K800-NUM-CUR-REGN        
           WHEN OTHER                                                           
              DISPLAY 'BP13K530 READ ERROR, STATUS IS ' K530-STATUS             
              DISPLAY 'RECORD KEY IS ' K530-KEY-FLD                             
           END-EVALUATE.                                                        
                                                                                
       1221-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1230-MOVE-ALLOC-CAT.                                                     
      *-------------------------------------------------------------            
                                                                                
      *    MOVE K800-NUM-ZONE       TO WS-ZONE.                                 
           MOVE K800-NUM-BTO-ZONE   TO WS-ZONE.                                 
           MOVE K800-NUM-FLAT-TYPE  TO WS-FLAT-TYPE.                            
                                                                                
            IF WS-ZONE NOT = SPACES                                             
             IF WS-ZONE NUMERIC                                                 
                MOVE 'BTO'              TO K800-NUM-ALLO-CAT                    
             ELSE                                                               
              IF C-ZONE-RFS                                                     
                  MOVE 'RFS'            TO K800-NUM-ALLO-CAT                    
              ELSE                                                              
               IF C-ZONE-WIS                                                    
                  MOVE '3R'             TO K800-NUM-ALLO-CAT                    
               ELSE                                                             
                IF C-ZONE-OTB                                                   
                    MOVE 'OTB'          TO K800-NUM-ALLO-CAT                    
                END-IF                                                          
               END-IF                                                           
              END-IF                                                            
             END-IF                                                             
            ELSE                                                                
             IF WS-ZONE = SPACES  AND  K800-NUM-NEW-TOWN NOT = SPACES           
      *         MOVE 'BE '            TO K800-NUM-ALLO-CAT                      
                MOVE 'SBF'            TO K800-NUM-ALLO-CAT                      
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF C-ALLOC-SCH-FOUND                                                 
              MOVE 'SER'            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
           IF C-FLAT-TYPE-SA                                                    
              MOVE 'SA '            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
           IF C-FLAT-TYPE-SER                                                   
              MOVE 'SER'            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
           IF K800-NUM-ALLO-SCHEME = 'STD'                                      
              MOVE 'STD'            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
           IF K800-NUM-ALLO-SCHEME = 'RP '                                      
              MOVE 'RP '            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
           IF K800-NUM-ALLO-SCHEME = 'MG '                                      
              MOVE 'SHS'            TO K800-NUM-ALLO-CAT                        
           ELSE                                                                 
              PERFORM 1232-SEARCH-TABLES         THRU 1232-EXIT.                
                                                                                
           IF K800-NUM-ALLO-CAT = SPACES OR LOW-VALUES                          
              MOVE 'SHS'            TO K800-NUM-ALLO-CAT.                       
                                                                                
       1230-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1232-SEARCH-TABLES.                                                      
      *-------------------------------------------------------------            
                                                                                
            SET WS-ALLOC-PTR   TO  1.                                           
            SEARCH WS-ALLOC-SCH                                                 
              AT END                                                            
                 CONTINUE                                                       
              WHEN WS-ALLOC-SCH-DESP (WS-ALLOC-PTR) =                           
                                      K800-NUM-ALLO-SCHEME                      
                 IF WS-MAIN-SCH-CD (WS-ALLOC-PTR) = 'REN'                       
                    MOVE 'REN'       TO K800-NUM-ALLO-CAT                       
                 END-IF                                                         
            END-SEARCH.                                                         
                                                                                
       1232-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************************************************                 
      *   START READING BP13K825 FOR SUBSEQUENT RECORDS       *                 
      *   WITH SAME REF-NO                                    *                 
      *   IF START SUCCESSFUL                                 *                 
      *      READ  NEXT RECORD AND PROCESS UNTIL REF-NO CHANGE*                 
      *********************************************************                 
       3000-START-K825.                                                         
      *-------------------------------------------------------------            
                                                                                
                                                                                
           MOVE F520-NUM-REGN      TO K825-NUM-REGN.                            
           MOVE SPACES             TO K825-NUM-NRIC                             
                                      K825-EOF-IND.                             
                                                                                
                                                                                
           START BP13K825 KEY > K825-KEY-FLD.                                   
           IF K825-STATUS = 0                                                   
              PERFORM 4000-READ-NEXT-K825  THRU 4000-EXIT                       
              PERFORM 4200-CREATE-OCCUPIER THRU 4200-EXIT                       
                UNTIL (K825-NUM-REGN NOT = F520-NUM-REGN) OR                    
                       K825-EOF                                                 
           ELSE                                                                 
           IF K825-STATUS = 23                                                  
              DISPLAY ' RECORD NOT FOUND IN BP13K825, KEY ' K825-KEY-FLD        
           ELSE                                                                 
              DISPLAY ' ERROR IN READING BP13K825, STATUS ' K825-STATUS         
              MOVE K825-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************************************************                 
      *   READ NEXT RECORD                                    *                 
      *      IF EOF OR REG-NO   CHANGES - END THE ROUTINE     *                 
      *      ELSE                                             *                 
      *         WRITE SUBSEQUENT RECORDS TO OCCUPIER RECORD   *                 
      *            IN BP13K820 FILE.                          *                 
      *********************************************************                 
       4000-READ-NEXT-K825.                                                     
      *-------------------------------------------------------------            
                                                                                
                                                                                
           READ BP13K825 NEXT AT END                                            
                MOVE 'Y' TO K825-EOF-IND                                        
                GO TO 4000-EXIT.                                                
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4200-CREATE-OCCUPIER.                                                    
      *-------------------------------------------------------------            
                                                                                
                                                                                
           IF K825-NUM-REGN = F520-NUM-REGN                                     
              ADD 1   TO WS-NO-READ-K825                                        
              PERFORM 4500-PROCESS-OCCUPIER THRU 4500-EXIT                      
              PERFORM 4600-WRITE-OCCUPIER-REC THRU 4600-EXIT.                   
                                                                                
           PERFORM 4000-READ-NEXT-K825 THRU 4000-EXIT.                          
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************************************************                 
      *     WRITE APPLN  INFO TO OCCUPIER FILE (BP13K820)     *                 
      *-------------------------------------------------------*                 
      * C9404F5  K820-AMT-INCOME AND K800-AMT-HSE-INCOME      *                 
      *          IS ONLY UPDATED FOR SALES OF SITTING TENANT  *                 
      *          FLATS.                                       *                 
      *********************************************************                 
       4500-PROCESS-OCCUPIER.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO BP13K820-REC.                                         
           MOVE ZEROES TO K820-AMT-INCOME.                                      
           MOVE ZEROES TO K820-AMT-INCOME-TP.                                   
                                                                                
           MOVE F520-NUM-REGN            TO K820-NUM-REGN.                      
           MOVE K825-NME-OCCP            TO K820-NME-OCCP.                      
                                                                                
                                                                                
           MOVE K825-NUM-NRIC            TO K820-NUM-NRIC.                      
           MOVE K825-NUM-NRIC-SPOUSE     TO K820-NUM-NRIC-SPOUSE.               
           MOVE K825-NUM-RELATIONSHIP    TO K820-NUM-RELATIONSHIP.              
           MOVE K825-NUM-ETHNIC          TO K820-NUM-ETHNIC.                    
           MOVE K825-NUM-SEX             TO K820-NUM-SEX.                       
           MOVE K825-NUM-MARITAL-STATUS  TO K820-NUM-MARITAL-STATUS.            
           MOVE K825-DTE-BIRTH           TO K820-DTE-BIRTH.                     
           MOVE K825-NUM-CITIZENSHIP     TO K820-NUM-CITIZENSHIP.               
           MOVE K825-NUM-5YR-OCCUPN      TO K820-NUM-5YR-OCCUPN.                
           MOVE K825-NUM-LESSEE-CHECK    TO K820-NUM-LESSEE-CHECK.              
           MOVE K825-NUM-NATIONALITY     TO K820-NUM-NATIONALITY.               
           MOVE K825-NUM-PHONE           TO K820-NUM-PHONE.                     
           MOVE K825-NUM-PHONE-OFF       TO K820-NUM-PHONE-OFF.                 
           MOVE K825-NUM-HP-PGR          TO K820-NUM-HP-PGR.                    
           MOVE K825-NUM-EDUCATION       TO K820-NUM-EDUCATION.                 
           MOVE K825-NUM-NHA             TO K820-NUM-NHA.                       
           MOVE K825-NUM-AST             TO K820-NUM-AST.                       
           MOVE K825-NUM-PPS-PREGNANT    TO K820-NUM-PPS-PREGNANT.              
                                                                                
           IF K825-AMT-INCOME-TP IS NOT NUMERIC                                 
              MOVE ZEROS           TO K825-AMT-INCOME-TP                        
           END-IF.                                                              
                                                                                
           MOVE K825-AMT-INCOME-TP TO K820-AMT-INCOME-TP.                       
                                                                                
           IF   K825-AMT-INCOME IS NOT NUMERIC                                  
                MOVE ZEROS TO K825-AMT-INCOME.                                  
                                                                                
           MOVE K825-AMT-INCOME    TO K820-AMT-INCOME.                          
                                                                                
           IF K820-AMT-INCOME NOT = 99999                                       
              IF F520-CDE-ALLOC-SCH NOT = 'FTS' AND 'STS'                       
                 ADD K820-AMT-INCOME TO K800-AMT-HSE-INCOME                     
              ELSE                                                              
                 IF K820-NUM-NRIC = F520-NUM-NRIC1 OR F520-NUM-NRIC2 OR         
                                    F520-NUM-NRIC3 OR F520-NUM-NRIC4            
                    ADD K820-AMT-INCOME TO K800-AMT-HSE-INCOME                  
                 ELSE                                                           
                    IF F520-CDE-ELIG-SCH = 'NCS' AND                            
                       K820-NUM-RELATIONSHIP = '20'                             
                       ADD K820-AMT-INCOME TO K800-AMT-HSE-INCOME               
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K825-NUM-CPF = SPACES                                             
               PERFORM 4520-UPDATE-CPF-NO THRU 4520-EXIT                        
           ELSE                                                                 
               MOVE K825-NUM-CPF         TO K820-NUM-CPF.                       
                                                                                
           MOVE WS-CUR-DATE              TO K820-DTE-UPDATE.                    
                                                                                
           IF (F520-NUM-NRIC1 = K820-NUM-NRIC) AND                              
              (F520-CDE-RESIDENT-HA1 NOT = SPACES AND LOW-VALUES AND            
                                           'H' AND 'M' AND 'P')                 
              MOVE F520-CDE-RESIDENT-HA1   TO WS-RESIDENT                       
              PERFORM 4550-CHECK-RESIDENT-CODE  THRU 4550-EXIT                  
              MOVE WS-RESIDENT-FOUND TO K820-NUM-RESIDENT-NT                    
           ELSE                                                                 
           IF (F520-NUM-NRIC2 = K820-NUM-NRIC) AND                              
              (F520-CDE-RESIDENT-HA2 NOT = SPACES AND LOW-VALUES AND            
                                           'H' AND 'M' AND 'P')                 
              MOVE F520-CDE-RESIDENT-HA2   TO WS-RESIDENT                       
              PERFORM 4550-CHECK-RESIDENT-CODE  THRU 4550-EXIT                  
              MOVE WS-RESIDENT-FOUND TO K820-NUM-RESIDENT-NT                    
           ELSE                                                                 
           IF (F520-NUM-NRIC3 = K820-NUM-NRIC) AND                              
              (F520-CDE-RESIDENT-HA3 NOT = SPACES AND LOW-VALUES AND            
                                           'H' AND 'M' AND 'P')                 
              MOVE F520-CDE-RESIDENT-HA3   TO WS-RESIDENT                       
              PERFORM 4550-CHECK-RESIDENT-CODE  THRU 4550-EXIT                  
              MOVE WS-RESIDENT-FOUND TO K820-NUM-RESIDENT-NT                    
           ELSE                                                                 
           IF (F520-NUM-NRIC4 = K820-NUM-NRIC) AND                              
              (F520-CDE-RESIDENT-HA4 NOT = SPACES AND LOW-VALUES AND            
                                           'H' AND 'M' AND 'P')                 
              MOVE F520-CDE-RESIDENT-HA4   TO WS-RESIDENT                       
              PERFORM 4550-CHECK-RESIDENT-CODE  THRU 4550-EXIT                  
              MOVE WS-RESIDENT-FOUND TO K820-NUM-RESIDENT-NT.                   
                                                                                
           IF K825-NUM-FREEZE-OCCP = 'Y'                                        
              MOVE 'Y'                  TO K820-NUM-FREEZE-OCCP                 
           END-IF.                                                              
                                                                                
      *******   CHANGE REQUEST NO : BP130932  *****************                 
                                                                                
           IF F520-DTE-REQUEST IS NOT NUMERIC                                   
              MOVE ZEROS TO F520-DTE-REQUEST                                    
           END-IF.                                                              
                                                                                
           MOVE F520-DTE-REQUEST    TO  WS-F520-DTE-REGN.                       
                                                                                
           IF K825-DTE-BIRTH IS NOT NUMERIC                                     
              MOVE ZEROS TO K825-DTE-BIRTH                                      
           END-IF.                                                              
                                                                                
           MOVE K825-DTE-BIRTH    TO  WS-K825-DTE-BIRTH.                        
                                                                                
           IF K825-NUM-RELATIONSHIP = '00'                                      
              MOVE ZEROES             TO WS-AGE-APPL                            
              PERFORM 4560-CHECK-AGE  THRU 4560-EXIT                            
              MOVE WS-AGE             TO WS-AGE-APPL                            
              MOVE K825-NUM-MARITAL-STATUS   TO  WS-APPL-MARITAL-STATUS         
                                                                                
           END-IF.                                                              
                                                                                
           IF K825-NUM-RELATIONSHIP = '20'                                      
              MOVE ZEROES             TO WS-AGE-SPOUSE                          
              PERFORM 4560-CHECK-AGE  THRU 4560-EXIT                            
              MOVE WS-AGE             TO WS-AGE-SPOUSE                          
              MOVE 'Y'                TO WS-SPOUSE-NUM-RELATIONSHIP             
              MOVE K825-NUM-MARITAL-STATUS   TO                                 
                                         WS-SPOUSE-MARITAL-STATUS               
                                                                                
           END-IF.                                                              
                                                                                
           IF K825-NUM-RELATIONSHIP = '09'                                      
              MOVE ZEROES             TO WS-AGE-FIANCEE                         
                                                                                
              PERFORM 4560-CHECK-AGE  THRU 4560-EXIT                            
              MOVE WS-AGE             TO WS-AGE-FIANCEE                         
              MOVE 'Y'                TO WS-FIANCEE-NUM-RELATIONSHIP            
                                                                                
           END-IF.                                                              
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4520-UPDATE-CPF-NO.                                                      
                                                                                
           IF K825-NUM-NRIC = F520-NUM-NRIC1 OR                                 
              K825-NUM-NRIC = F520-NUM-NRIC2 OR                                 
              K825-NUM-NRIC = F520-NUM-NRIC3 OR                                 
              K825-NUM-NRIC = F520-NUM-NRIC4                                    
              IF K825-NUM-NRIC(1:1)  = 'S' OR 'T'                               
                 IF K825-NUM-CITIZENSHIP = 'SP' OR 'OC'                         
                    MOVE '00000000J'  TO K820-NUM-CPF                           
                 ELSE                                                           
                    MOVE K825-NUM-NRIC      TO K820-NUM-CPF                     
              ELSE                                                              
                 MOVE '00000000J'  TO K820-NUM-CPF                              
           ELSE                                                                 
              IF K820-AMT-INCOME NOT = ZEROS                                    
                 IF K825-NUM-NRIC(1:1)  = 'S' OR 'T'                            
                    IF K825-NUM-CITIZENSHIP = 'SP' OR 'OC'                      
                        MOVE '00000000J'  TO K820-NUM-CPF                       
                    ELSE                                                        
                        MOVE K825-NUM-NRIC      TO K820-NUM-CPF                 
                 ELSE                                                           
                    MOVE '00000000J'            TO K820-NUM-CPF                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4520-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4550-CHECK-RESIDENT-CODE.                                                
      *-------------------------------------------------------------            
           MOVE SPACES TO WS-RESIDENT-FOUND.                                    
                                                                                
           IF WS-RESIDENT = '1' OR 'A'                                          
              IF F520-CDE-NT1 = F520-CDE-SUCC-NT-ZONE                           
                 MOVE 'R'     TO WS-RESIDENT-FOUND                              
              ELSE                                                              
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
           IF WS-RESIDENT = '2' OR 'B'                                          
              IF F520-CDE-NT2 = F520-CDE-SUCC-NT-ZONE                           
                 MOVE 'R'     TO WS-RESIDENT-FOUND                              
              ELSE                                                              
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
           IF WS-RESIDENT = '3' OR 'C'                                          
              IF F520-CDE-NT3 = F520-CDE-SUCC-NT-ZONE                           
                 MOVE 'R'     TO WS-RESIDENT-FOUND                              
              ELSE                                                              
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
           IF WS-RESIDENT = '4' OR 'D'                                          
              IF F520-CDE-NT4 = F520-CDE-SUCC-NT-ZONE                           
                 MOVE 'R'     TO WS-RESIDENT-FOUND                              
              ELSE                                                              
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
           IF WS-RESIDENT = '5' OR 'E'                                          
              IF F520-CDE-NT5 = F520-CDE-SUCC-NT-ZONE                           
                 MOVE 'R'     TO WS-RESIDENT-FOUND                              
              ELSE                                                              
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
           IF WS-RESIDENT = 'T'                                                 
                 MOVE 'T'     TO WS-RESIDENT-FOUND                              
           ELSE                                                                 
                 MOVE SPACES  TO WS-RESIDENT-FOUND.                             
                                                                                
       4550-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *********************************************************                 
      *       CREATE AN OCCUPIER RECORD IN BP13K820           *                 
      *********************************************************                 
       4600-WRITE-OCCUPIER-REC.                                                 
      *-------------------------------------------------------------            
                                                                                
                                                                                
           WRITE BP13K820-REC.                                                  
                                                                                
           IF K820-STATUS = 00 OR 02                                            
                                                                                
              ADD 1 TO WS-NO-WRT-K820                                           
           ELSE                                                                 
           IF K820-STATUS = 22                                                  
              DISPLAY ' ERROR WRITING TO BP13K820 DUP OCCUPIER REC '            
                      ' STATUS ' K820-STATUS                                    
              DISPLAY ' K820-KEY-FLD ' K820-KEY-FLD                             
           ELSE                                                                 
              DISPLAY ' ERROR WRITING TO BP13K820 OCCUPIER REC '                
                      ' STATUS ' K820-STATUS                                    
              DISPLAY ' K820-KEY-FLD ' K820-KEY-FLD.                            
                                                                                
       4600-EXIT.                                                               
            EXIT.                                                               
      ******************************************************************        
       4560-CHECK-AGE.                                                          
      ******************************************************************        
                                                                                
            COMPUTE WS-AGE = WS-F520-DTE-REGN-YR   -                            
                             WS-K825-DTE-BIRTH-YR                               
                                                                                
      *---TO CHECK MONTH AND DAY OF BIRTH FOR AGE = 30 CASES -------*           
                                                                                
            IF WS-AGE  = 30                                                     
               IF WS-K825-DTE-BIRTH-MM   > WS-F520-DTE-REGN-MM                  
                     SUBTRACT 1 FROM WS-AGE                                     
               ELSE                                                             
                  IF WS-K825-DTE-BIRTH-MM   = WS-F520-DTE-REGN-MM               
                     IF WS-K825-DTE-BIRTH-DD   >                                
                                         WS-F520-DTE-REGN-DD                    
                        SUBTRACT 1 FROM WS-AGE                                  
                     END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
                                                                                
               IF WS-F520-DTE-REGN-MM > WS-K825-DTE-BIRTH-MM                    
                  ADD 1 TO  WS-AGE                                              
               ELSE                                                             
                  IF WS-F520-DTE-REGN-MM  = WS-K825-DTE-BIRTH-MM                
                     IF WS-F520-DTE-REGN-DD > WS-K825-DTE-BIRTH-DD              
                        ADD 1 TO WS-AGE                                         
                     END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
                                                                                
            END-IF.                                                             
                                                                                
       4560-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *********************************************************                 
      *        LOG DETAILS FROM BP13F520 TO BP13K840          *                 
      *                                                       *                 
      * TO INITIALISE THE ALT-KEY WITH '#/REGN-NO' SO THAT    *                 
      * THE FILE WILL NOT HAVE BLANK ALT-KEY                  *                 
      *********************************************************                 
       5000-CREATE-BP13K840.                                                    
      *-------------------------------------------------------------            
                                                                                
                                                                                
           MOVE SPACES              TO BP13K840-REC.                            
           MOVE F520-NUM-REGN       TO K840-NUM-REGN.                           
           MOVE K840-NUM-REGN       TO WS-REGN-BLANK.                           
           MOVE WS-REGN-BLANK-TEMP  TO K840-NUM-NRIC1.                          
           MOVE WS-REGN-BLANK-TEMP  TO K840-NUM-NRIC2.                          
           MOVE WS-REGN-BLANK-TEMP  TO K840-NUM-NRIC3.                          
           MOVE WS-REGN-BLANK-TEMP  TO K840-NUM-NRIC4.                          
                                                                                
           MOVE F520-CDE-ZONE       TO K840-NUM-ZONE.                           
           MOVE F520-CDE-NT1        TO K840-NUM-NEW-TOWN.                       
           MOVE F520-CDE-FLAT-TYPE  TO K840-NUM-FLAT-TYPE.                      
           MOVE F520-DTE-REQUEST    TO K840-DTE-REGN.                           
           MOVE WS-CUR-DATE         TO K840-DTE-UPDATE.                         
           MOVE F520-CDE-ALLOC-SCH  TO K840-NUM-ALLOC-SCH.                      
           MOVE F520-NUM-REGN       TO WS-NUM-REGN.                             
           MOVE 'P13C528'           TO K840-NUM-USERID.                         
                                                                                
           WRITE BP13K840-REC.                                                  
                                                                                
           IF K840-STATUS = 0 OR 2                                              
              ADD 1 TO WS-NO-WRT-K840                                           
           ELSE                                                                 
           IF K840-STATUS = 22                                                  
              DISPLAY ' ERROR WRITING TO BP13K840,'                             
                      ' FOUND DUPLICATE REC, STATUS ' K840-STATUS               
                      ' ACCESS KEY : ' K840-KEY-FLD                             
           ELSE                                                                 
              DISPLAY ' ERROR WRITING TO BP13K840 ' K840-STATUS                 
              MOVE K840-STATUS TO RETURN-CODE                                   
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       6000-CREATE-BP13F310.                                                    
      *-------------------------------------------------------------            
                                                                                
                                                                                
           MOVE SPACES TO BP13F310-TRANS-REC.                                   
           MOVE F520-NUM-REGN            TO F310-REGN-NO.                       
                                                                                
           IF F520-NUM-APPLN-TYPE = 'I'                                         
              MOVE 'RB'                  TO F310-CDE-TRANS                      
           ELSE                                                                 
              MOVE 'RQ'                  TO F310-CDE-TRANS                      
           END-IF.                                                              
                                                                                
           IF (F520-NUM-APPLN-TYPE = 'I') OR                                    
              (F520-CDE-ZONE = SPACES OR 'ME' OR 'ZN')                          
              MOVE WS-CUR-DATE           TO F310-DTE-TRANS                      
              WRITE BP13F310-TRANS-REC                                          
              ADD 1 TO WS-NO-WRT-F310                                           
           END-IF.                                                              
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       6050-READ-K648.                                                          
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES           TO K648-NUM-REGN.                              
           MOVE F520-NUM-REGN    TO K648-NUM-REGN.                              
                                                                                
           READ BP13K648.                                                       
                                                                                
           EVALUATE K648-STATUS                                                 
              WHEN 00                                                           
                 PERFORM 6100-REWRITE-K648   THRU 6100-EXIT                     
              WHEN OTHER                                                        
                 DISPLAY ' ERROR READING BP13K648 TRANS REC '                   
                         ' STATUS ' K648-STATUS                                 
                 DISPLAY ' KEY IS ' K648-NUM-REGN                               
                 PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       6050-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       6100-REWRITE-K648.                                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE 'B'                   TO K648-NUM-LOAN-TAG.                     
                                                                                
           REWRITE BP13K648-TRANS-REC.                                          
                                                                                
           EVALUATE K648-STATUS                                                 
              WHEN 00                                                           
                 ADD 1 TO  WS-K648-UPDATE                                       
              WHEN OTHER                                                        
                 DISPLAY ' ERROR UPDATING TO BP13K648 TRANS REC '               
                         ' STATUS ' K648-STATUS                                 
                 DISPLAY ' KEY IS ' K648-NUM-REGN                               
                 PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6200-READ-K813.                                                          
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES             TO BP13K813-REC.                             
           MOVE F520-CDE-NT1       TO K813-NUM-ZONE.                            
           MOVE F520-CDE-FLAT-TYPE TO K813-NUM-FLAT-TYPE.                       
           MOVE F520-DTE-BALLOT    TO K813-DTE-BALLOT.                          
                                                                                
           READ BP13K813.                                                       
                                                                                
           EVALUATE K813-STATUS                                                 
              WHEN 00                                                           
                 CONTINUE                                                       
              WHEN 23                                                           
                 DISPLAY 'RECORD NOT FOUND KEY IS :' K813-KEY-FLD               
              WHEN OTHER                                                        
                 DISPLAY ' ERROR READING BP13K813 TRANS REC '                   
                         ' STATUS ' K813-STATUS                                 
                 DISPLAY ' KEY IS ' K813-KEY-FLD                                
                 PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       9999-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
           CLOSE BP13F310                                                       
                 BP13F520                                                       
                 BP13F800                                                       
                 BP13K530                                                       
                 BP13K648                                                       
                 BP13K825                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K840                                                       
                 BP13K813.                                                      
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K800  FILE, STATUS '                  
              K800-STATUS.                                                      
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K820  FILE, STATUS '                  
              K820-STATUS.                                                      
                                                                                
           IF K840-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K840  FILE, STATUS '                  
              K840-STATUS.                                                      
                                                                                
           IF K825-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K825 FILE, STATUS '                   
              K825-STATUS.                                                      
                                                                                
           IF K648-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K648 FILE, STATUS '                   
              K825-STATUS.                                                      
                                                                                
           IF K813-STATUS NOT = 00 AND 97                                       
              DISPLAY ' ERROR CLOSING BP13K813 FILE, STATUS '                   
              K813-STATUS.                                                      
                                                                                
           DISPLAY ' ** BP13C528 - UPDATE APPLN TO SOC MASTER    **'.           
           DISPLAY ' **          - UPDATE OCCUP TO SOC OCCUP FILE**'.           
           DISPLAY '1) NO. OF REC READ  FROM F520  = ' WS-NO-READ-F520.         
           DISPLAY '2) NO. OF REC WRITTEN TO K800  = ' WS-NO-WRT-K800.          
           DISPLAY '3) NO. OF REC WRITTEN TO K840  = ' WS-NO-WRT-K840.          
           DISPLAY '4) NO. OF REC WRITTEN TO K820  = ' WS-NO-WRT-K820.          
           DISPLAY '5) NO. OF REC READ  FROM K825  = ' WS-NO-READ-K825.         
           DISPLAY '6) NO. OF REC WRITTEN TO F310  = ' WS-NO-WRT-F310.          
           DISPLAY '7) NO. OF REC UPDATED TO K648  = ' WS-K648-UPDATE.          
           DISPLAY ' NOTE : '.                                                  
           DISPLAY ' 1) = 2) = 3) = 6)'.                                        
           DISPLAY ' 4) = 5)'.                                                  
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
