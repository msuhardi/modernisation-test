       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C527.                                                 
      *AUTHOR.        LOU J L.                                                  
      *DATE-WRITTEN.  17/10/89.                                                 
      **********************************************************                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *                                                        *                
      *    SYSTEM ID : BP13                                    *                
      *                                                        *                
      *    OBJECTIVE :                                         *                
      *      1.  THIS IS A PROGRAM TO PRINT A REPORT ON THE    *                
      *          APPLICATION CANCELLED FOR THE SALES UNIT      *                
      *          (APPLICATION TEAM).                           *                
      *                                                        *                
      *     INPUT FILES:                                       *                
      *      1  BP13K500                                       *                
      *      2  BP13K552                                       *                
      *      3  BP13K830                                       *                
      *                                                        *                
      *     LISTING:                                           *                
      *     1. CONTOL LISTING  (BP13L527)                      *                
      *                                                        *                
      *CHG-NO   BY   ON     DESCRIPTION                        *                
      *--------------------------------                        *                
      *C9107A6 LSB 300791 - TO PRINT ADDRESS                   *                
      *I911209 LSB 051291 - CHG FOR SOC-PH7, ADD IN OCCP FILE  *                
      *N930012 YPH 260693 - SOC PH8 - COBOL 2                  *                
      *C9401   YPH 170194 - PRINT BY USERID/REFNO              *                
      *N940017 RGM 040195 - CHANGE KEY FIELD OF K500 & F595-   *                
      *                     DTE-UPDATE TO F595-DTE-UPDATE-MAT  *                
      *SOC-PH9 RGM 240195 - INCREASE LENGTH OF STREET NAME FROM*                
      *                     X(20) TO X(32). CHANGE REP. FORMAT *                
      *SOC-PH9 RGM 070295 - CHANGE K552 TO K828                *                
      *BP130418 SIA 040498- CATER FOR Y2000                    *                
      *BP130652 NOR 190299- EXPAND K500 & F595 RECL 300 TO 500 *                
      *BP135944 SMR 150915- REMOVE REFERENCE TO CDE-NT6/7/8    *                
      **********************************************************                
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *                                                                         
       INPUT-OUTPUT SECTION.                                                    
      *                                                                         
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K500     ASSIGN       TO BP13K500                         
                               ACCESS MODE  IS DYNAMIC                          
                               ORGANIZATION IS INDEXED                          
                               RECORD KEY   IS K500-KEY-NEW                     
                               ALTERNATE RECORD KEY IS K500-ALT1-KEY            
                               ALTERNATE RECORD KEY IS K500-ALT2-KEY            
                               FILE STATUS  IS BP13K500-STATUS.                 
                                                                                
           SELECT BP13K828     ASSIGN       TO BP13K828                         
                               ACCESS MODE  IS DYNAMIC                          
                               ORGANIZATION IS INDEXED                          
                               RECORD KEY   IS K828-KEY-FLD                     
                               FILE STATUS  IS BP13K828-STATUS.                 
                                                                                
           SELECT BP13K830     ASSIGN       TO BP13K830                         
                               ACCESS MODE  IS RANDOM                           
                               ORGANIZATION IS INDEXED                          
                               RECORD KEY   IS K830-KEY-FLD                     
                               FILE STATUS  IS BP13K830-STATUS.                 
                                                                                
                                                                                
           SELECT BP13F595 ASSIGN TO BP13F595.                                  
           SELECT BP13L527 ASSIGN TO BP13L527.                                  
                                                                                
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD   BP13K500                                                            
            RECORD    CONTAINS 500 CHARACTERS.                                  
       COPY BP13K500.                                                           
      *                                                                         
       FD   BP13F595                                                            
            RECORD    CONTAINS 500 CHARACTERS                                   
            LABEL     RECORD   IS  STANDARD                                     
            RECORDING MODE     IS  F.                                           
       COPY BP13F595.                                                           
      *                                                                         
       FD   BP13K828                                                            
            RECORD    CONTAINS 200 CHARACTERS.                                  
       COPY BP13K828.                                                           
      *                                                                         
       FD   BP13K830                                                            
            RECORD    CONTAINS 250 CHARACTERS.                                  
       COPY BP13K830.                                                           
      *                                                                         
       FD  BP13L527                                                             
           RECORD     CONTAINS 132 CHARACTERS                                   
           LABEL      RECORDS  ARE OMITTED                                      
           RECORDING  MODE     IS  F.                                           
       01  BP13L527-REC                 PIC X(132).                             
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  WORK-AREA.                                                           
           05  BP13K500-STATUS         PIC 9(2)    VALUE ZEROS.                 
           05  BP13K828-STATUS         PIC 9(2)    VALUE ZEROS.                 
           05  BP13K830-STATUS         PIC 9(2)    VALUE ZEROS.                 
           05  WS-F595-READ-CTR        PIC 9(5)    VALUE ZEROS.                 
           05  WS-K828-READ-CTR        PIC 9(5)    VALUE ZEROS.                 
           05  WS-K830-READ-CTR        PIC 9(5)    VALUE ZEROS.                 
           05  WS-K828-EOF             PIC X       VALUE 'N'.                   
           05  WS-K828-FND             PIC X       VALUE 'N'.                   
           05  WS-LINE-CTR             PIC 9(3)    VALUE 60.                    
           05  WS-PAGE-CTR             PIC 9(3)    VALUE ZEROS.                 
           05  WS-WRITE-CTR            PIC 9(5)    VALUE ZEROS.                 
           05  WS-NRIC1-STATUS         PIC 9(2)    VALUE ZEROS.                 
           05  WS-PREV-USER-ID         PIC X(7)    VALUE SPACES.                
           05  WS-PREV-REFNO           PIC X(6)    VALUE SPACES.                
           05  WS-MTH                  PIC S9(2)   VALUE ZEROS.                 
           05  WS-YR                   PIC S9(2)   VALUE ZEROS.                 
           05  WS5-DATE.                                                        
               10 WS5-DD           PIC 99     VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-MM           PIC 99     VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-YEAR         PIC 9(4)   VALUE ZEROS.                      
           05  WS5-PR-CUR-DATE.                                                 
               10 WS5-PC-DD        PIC 99     VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-PC-MM        PIC 99     VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-PC-YY        PIC 9(4)   VALUE ZEROS.                      
           05  WS-F595-DATE.                                                    
               10 WS-F595-YY  PIC 9(4)        VALUE ZEROS.                      
               10 WS-F595-MM  PIC 99          VALUE ZEROS.                      
               10 WS-F595-DD  PIC 99          VALUE ZEROS.                      
                                                                                
           05  WS-DATE.                                                         
               10 WS-YY       PIC 9(4)        VALUE ZEROS.                      
               10 WS-MM       PIC 99          VALUE ZEROS.                      
               10 WS-DD       PIC 99          VALUE ZEROS.                      
                                                                                
           05  WS-DATE-PR.                                                      
               10 WS-DD-PR    PIC 99          VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS-MM-PR    PIC 99          VALUE ZEROS.                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS-YY-PR    PIC 9(4)        VALUE ZEROS.                      
                                                                                
       01  WS5-CURRENT-DATE.                                                    
           05 WS5-CUR-YY       PIC 9(4)   VALUE ZEROS.                          
           05 WS5-CUR-MM       PIC 99     VALUE ZEROS.                          
           05 WS5-CUR-DD       PIC 99     VALUE ZEROS.                          
       01  WS-CUR-DATE.                                                         
           05 WS-CUR-DTE-YY   PIC 9(4)    VALUE ZEROS.                          
           05 WS-CUR-DTE-MM   PIC 99      VALUE ZEROS.                          
           05 WS-CUR-DTE-DD   PIC 99      VALUE ZEROS.                          
                                                                                
                                                                                
      **********************************************************                
      *        WS FOR LIST OF REQUEST CASES                    *                
      **********************************************************                
                                                                                
       01  L500-PR-HEAD-01.                                                     
           05  FILLER              PIC X(14)   VALUE 'BP13L527      '.          
           05  FILLER              PIC X(8)    VALUE 'HDB3    '.                
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'DATE: '.                  
           05  PRINT-DATE          PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(3)    VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'PAGE: '.                  
           05  PRINT-PAGE          PIC ZZZ9.                                    
                                                                                
       01  L500-PR-HEAD-02.                                                     
           05  FILLER              PIC X(42)   VALUE SPACES.                    
           05  FILLER              PIC X(35)   VALUE                            
               'REPORT ON THE APPLICATION CANCELLED'.                           
           05  FILLER              PIC X(26)   VALUE SPACES.                    
                                                                                
       01  L500-PR-HEAD-03.                                                     
           05  FILLER              PIC X(45)   VALUE SPACES.                    
           05  FILLER              PIC X(32)   VALUE                            
               'SALES UNIT (APPLICATION TEAM)'.                                 
                                                                                
       01  L500-PR-HEAD-04.                                                     
           05  FILLER              PIC X(15)   VALUE SPACES.                    
           05  FILLER              PIC X(07)   VALUE 'ADDRESS'.                 
           05  FILLER              PIC X(23)   VALUE SPACES.                    
           05  FILLER              PIC X(03)   VALUE 'LSE'.                     
           05  FILLER              PIC X(04)   VALUE SPACES.                    
           05  FILLER              PIC X(04)   VALUE 'NRIC'.                    
           05  FILLER              PIC X(21)   VALUE SPACES.                    
           05  FILLER              PIC X(08)   VALUE 'AL  ELG '.                
           05  FILLER              PIC X(10)   VALUE 'FT JB   JB'.              
           05  FILLER              PIC X(03)   VALUE SPACES.                    
           05  FILLER              PIC X(15)   VALUE '  JB    DATE   '.         
           05  FILLER              PIC X(13)   VALUE ' NT1 NT2 NT3 '.           
           05  FILLER              PIC X(06)   VALUE 'BO NT/'.                  
                                                                                
       01  L500-PR-HEAD-05.                                                     
           05  FILLER              PIC X(06)   VALUE '  S/N '.                  
           05  FILLER              PIC X(09)   VALUE 'REF/REGN '.               
           05  FILLER              PIC X(16)   VALUE 'NAME (TRUNCATED)'.        
           05  FILLER              PIC X(07)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE 'RELN   CHK    '.          
           05  FILLER              PIC X(21)   VALUE 'NO'.                      
           05  FILLER              PIC X(04)   VALUE 'CAT '.                    
           05  FILLER              PIC X(11)   VALUE 'SCH SCH    '.             
           05  FILLER              PIC X(12)   VALUE 'CD   REGN   '.            
           05  FILLER              PIC X(14)   VALUE 'CN  UPDATED   '.          
           05  FILLER              PIC X(13)   VALUE 'NT4 NT5 NT6  '.           
           05  FILLER              PIC X(05)   VALUE ' LAND'.                   
                                                                                
       01  L500-PR-HEAD-06.                                                     
           05  FILLER              PIC X(06)   VALUE '  --- '.                  
           05  FILLER              PIC X(09)   VALUE '-------- '.               
           05  FILLER              PIC X(16)   VALUE '----------------'.        
           05  FILLER              PIC X(07)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE '----   ---    '.          
           05  FILLER              PIC X(10)   VALUE '---       '.              
           05  FILLER              PIC X(14)   VALUE '           ---'.          
           05  FILLER              PIC X(12)   VALUE ' --- --- -- '.            
           05  FILLER              PIC X(12)   VALUE '-- -------- '.            
           05  FILLER              PIC X(14)   VALUE '-- ---------- '.          
           05  FILLER              PIC X(12)   VALUE '--- --- --- '.            
           05  FILLER              PIC X(07)   VALUE '-- ----'.                 
                                                                                
       01  L500-PR-DETAIL-1.                                                    
           05  L500-NO             PIC ZZZZ9.                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-REF-REGN       PIC X(08).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-BLK            PIC X(10).                                   
           05  L500-NUM-FLAT       PIC X(11).                                   
           05  L500-STREET         PIC X(30).                                   
           05  L500-POST           PIC X(06).                                   
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L500-CAT            PIC X(01).                                   
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L500-ALLOC          PIC X(03).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-ELIG           PIC X(03).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-FLAT           PIC X(02).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-JB-CDE         PIC X(01).                                   
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L500-JB-REF-REGN    PIC X(08).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-JB-CNT         PIC X(02).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-DATE-UPD       PIC X(10).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-NT1            PIC X(03).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-NT2            PIC X(03).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-NT3            PIC X(03).                                   
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  L500-BO             PIC X(02).                                   
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L500-NT-LAND        PIC X(01).                                   
                                                                                
       01  L500-PR-DETAIL-2.                                                    
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  L500-REF-2          PIC X(08).                                   
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L500-NAME           PIC X(18).                                   
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  L500-RELN           PIC X(02).                                   
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  L500-LSE-CHK        PIC X(01).                                   
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  L500-NRIC           PIC X(09).                                   
           05  FILLER              PIC X(45) VALUE SPACES.                      
           05  L500-DATE-UPDATE    PIC X(10).                                   
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L500-NT4            PIC X(03).                                   
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L500-NT5            PIC X(03).                                   
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L500-NT6            PIC X(03).                                   
                                                                                
                                                                                
      **********************************************************                
       PROCEDURE DIVISION.                                                      
      **********************************************************                
                                                                                
       0000-MAIN-ROUTINE.                                                       
           PERFORM 1000-OPEN-FILES                                              
              THRU 1000-EXIT.                                                   
           PERFORM 2000-READ-BP13F595                                           
              THRU 2000-EXIT.                                                   
           PERFORM 3000-PROCESS-REC                                             
              THRU 3000-EXIT                                                    
             UNTIL F595-KEY-FLD = HIGH-VALUES                                   
           PERFORM 9000-CLOSE-ROUTINE                                           
              THRU 9000-EXIT.                                                   
                                                                                
           STOP RUN.                                                            
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1000-OPEN-FILES.                                                         
           OPEN INPUT  BP13F595                                                 
                       BP13K828                                                 
                       BP13K830                                                 
                       BP13K500                                                 
                OUTPUT BP13L527.                                                
                                                                                
           IF BP13K828-STATUS = 0 OR 97                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY ' OPENING ERROR, BP13K828-STATUS '                        
                        BP13K828-STATUS                                         
              MOVE BP13K828-STATUS       TO RETURN-CODE                         
              PERFORM 9000-CLOSE-ROUTINE                                        
                 THRU 9000-EXIT.                                                
                                                                                
           IF BP13K500-STATUS = 0 OR 97                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY ' OPENING ERROR, BP13K500-STATUS '                        
                        BP13K500-STATUS                                         
              MOVE BP13K500-STATUS       TO RETURN-CODE                         
              PERFORM 9000-CLOSE-ROUTINE                                        
                 THRU 9000-EXIT.                                                
                                                                                
           IF BP13K830-STATUS = 0 OR 97                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY ' OPENING ERROR, BP13K830-STATUS '                        
                        BP13K830-STATUS                                         
              MOVE BP13K830-STATUS       TO RETURN-CODE                         
              PERFORM 9000-CLOSE-ROUTINE                                        
                 THRU 9000-EXIT.                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       2000-READ-BP13F595.                                                      
           READ BP13F595 AT END                                                 
              MOVE HIGH-VALUES           TO F595-KEY-FLD                        
              GO TO 2000-EXIT.                                                  
                                                                                
           ADD 1                         TO WS-F595-READ-CTR.                   
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       3000-PROCESS-REC.                                                        
      *************************************************************             
      *                                                           *             
      *  F595-DTE-UPDATE SHOULD BE EQUAL TO OR A MONTH LESS/MORE  *             
      *                  THAN THE CURRENT MONTH.                  *             
      *************************************************************             
                                                                                
           MOVE   FUNCTION CURRENT-DATE    TO WS-CUR-DATE.                      
           MOVE   F595-DTE-UPDATE          TO WS-F595-DATE.                     
                                                                                
           COMPUTE WS-MTH = WS-CUR-DTE-MM - WS-F595-MM.                         
           COMPUTE WS-YR  = WS-CUR-DTE-YY - WS-F595-YY.                         
                                                                                
           IF ((WS-YR  =  0            ) AND                                    
               (WS-MTH =  0 OR  1 OR  2)     ) OR                               
              ((WS-YR  =  1            ) AND                                    
               (WS-MTH = -10 OR -11    )     )                                  
              PERFORM 3100-PROCESS-F595    THRU 3100-EXIT                       
           END-IF.                                                              
                                                                                
       3000-READNEXT.                                                           
           PERFORM 2000-READ-BP13F595      THRU 2000-EXIT.                      
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3100-PROCESS-F595.                                                       
           PERFORM 3300-REQUEST-DTL         THRU 3300-EXIT.                     
           PERFORM 3200-OCCUP-DTL           THRU 3200-EXIT.                     
                                                                                
           IF WS-K828-FND = 'Y'                                                 
              GO TO 3100-EXIT.                                                  
                                                                                
           IF F595-NUM-NRIC1(2:1) NOT = '#'                                     
              MOVE F595-NUM-REGN            TO K828-NUM-REGN                    
              MOVE F595-NUM-NRIC1           TO K828-NUM-NRIC                    
                                                                                
              READ BP13K828                                                     
              IF BP13K828-STATUS = 23                                           
                 MOVE SPACES                TO K828-NUM-REGN                    
                 READ BP13K828                                                  
              END-IF                                                            
              MOVE F595-NUM-NRIC1           TO L500-NRIC                        
              PERFORM 4000-PRINT-OCCUP      THRU 4000-EXIT.                     
                                                                                
           IF F595-NUM-NRIC2(2:1) NOT = '#'                                     
              MOVE F595-NUM-REGN            TO K828-NUM-REGN                    
              MOVE F595-NUM-NRIC2           TO K828-NUM-NRIC                    
                                                                                
              READ BP13K828                                                     
              IF BP13K828-STATUS = 23                                           
                 MOVE SPACES                TO K828-NUM-REGN                    
                 READ BP13K828                                                  
              END-IF                                                            
              MOVE F595-NUM-NRIC2           TO L500-NRIC                        
              PERFORM 4000-PRINT-OCCUP      THRU 4000-EXIT.                     
                                                                                
           IF F595-NUM-NRIC3(2:1) NOT = '#'                                     
              MOVE F595-NUM-REGN            TO K828-NUM-REGN                    
              MOVE F595-NUM-NRIC3           TO K828-NUM-NRIC                    
                                                                                
              READ BP13K828                                                     
              IF BP13K828-STATUS = 23                                           
                 MOVE SPACES                TO K828-NUM-REGN                    
                 READ BP13K828                                                  
              END-IF                                                            
              MOVE F595-NUM-NRIC3           TO L500-NRIC                        
              PERFORM 4000-PRINT-OCCUP      THRU 4000-EXIT.                     
                                                                                
           IF F595-NUM-NRIC4(2:1) NOT = '#'                                     
              MOVE F595-NUM-REGN            TO K828-NUM-REGN                    
              MOVE F595-NUM-NRIC4           TO K828-NUM-NRIC                    
                                                                                
              READ BP13K828                                                     
              IF BP13K828-STATUS = 23                                           
                 MOVE SPACES                TO K828-NUM-REGN                    
                 READ BP13K828                                                  
              END-IF                                                            
              MOVE F595-NUM-NRIC4           TO L500-NRIC                        
              PERFORM 4000-PRINT-OCCUP      THRU 4000-EXIT.                     
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3200-OCCUP-DTL.                                                          
            MOVE 'N'                      TO WS-K828-FND.                       
            IF F595-NUM-REGN = SPACES OR LOW-VALUES                             
               GO TO 3200-EXIT.                                                 
                                                                                
            MOVE SPACES                   TO BP13K828-REC.                      
            MOVE F595-NUM-REGN            TO K828-NUM-REGN.                     
                                                                                
            START BP13K828 KEY >= K828-KEY-FLD.                                 
                                                                                
            IF BP13K828-STATUS NOT = 00                                         
               DISPLAY 'START ERROR, BP13K828-STATUS = ' BP13K828-STATUS        
               DISPLAY 'K828-KEY-FLD = ' K828-KEY-FLD                           
                                                                                
            ELSE                                                                
               PERFORM 3250-READ-OCCUP THRU 3250-EXIT                           
                 UNTIL (WS-K828-EOF = 'Y') OR                                   
                       (F595-NUM-REGN NOT = K828-NUM-REGN).                     
       3200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3250-READ-OCCUP.                                                         
            READ BP13K828 NEXT                                                  
                 AT END MOVE 'Y' TO WS-K828-EOF                                 
                 GO TO 3250-EXIT.                                               
                                                                                
            IF K828-NUM-REGN = F595-NUM-REGN                                    
               MOVE 'Y'                  TO   WS-K828-FND                       
               PERFORM 4000-PRINT-OCCUP  THRU 4000-EXIT                         
            ELSE                                                                
               MOVE 'Y'          TO WS-K828-EOF.                                
       3250-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3300-REQUEST-DTL.                                                        
           MOVE SPACES                   TO L500-PR-DETAIL-1.                   
           MOVE SPACES                   TO L500-PR-DETAIL-2.                   
           MOVE SPACES                   TO K830-KEY-FLD.                       
           MOVE F595-NUM-REGN-REF        TO L500-REF-REGN.                      
           MOVE F595-NUM-JB-REGN         TO L500-JB-REF-REGN.                   
           MOVE F595-CDE-CATEGORY        TO L500-CAT.                           
           MOVE F595-CDE-ALLOC-SCH       TO L500-ALLOC.                         
           MOVE F595-CDE-ELIG-SCH        TO L500-ELIG.                          
           MOVE F595-CDE-FLAT-TYPE       TO L500-FLAT.                          
           MOVE F595-CDE-JB              TO L500-JB-CDE.                        
           MOVE F595-NUM-JB-CNT          TO L500-JB-CNT.                        
           MOVE F595-DTE-UPDATE          TO WS-DATE.                            
           MOVE WS-DD                    TO WS-DD-PR.                           
           MOVE WS-MM                    TO WS-MM-PR.                           
           MOVE WS-YY                    TO WS-YY-PR.                           
           MOVE WS-DATE-PR               TO L500-DATE-UPD.                      
           MOVE F595-CDE-NT1             TO L500-NT1.                           
           MOVE F595-CDE-NT2             TO L500-NT2.                           
           MOVE F595-CDE-NT3             TO L500-NT3.                           
           MOVE F595-CDE-NT4             TO L500-NT4.                           
           MOVE F595-CDE-NT5             TO L500-NT5.                           
           MOVE SPACES                   TO L500-NT6.                           
           MOVE F595-CDE-BO              TO L500-BO.                            
           MOVE F595-CDE-NT-WITH-LAND    TO L500-NT-LAND.                       
                                                                                
           MOVE F595-NUM-REGN            TO K830-KEY-FLD.                       
           READ BP13K830.                                                       
           IF BP13K830-STATUS = 00                                              
              ADD 1                      TO WS-K830-READ-CTR                    
           ELSE                                                                 
           IF BP13K830-STATUS = 23                                              
              DISPLAY ' BP13K830 NOT FOUND ' K830-KEY-FLD                       
              GO TO 3300-PRINT-REQUEST                                          
                                                                                
           ELSE                                                                 
              DISPLAY ' ERROR READING, BP13K830 ' BP13K830-STATUS               
              MOVE BP13K830-STATUS       TO RETURN-CODE                         
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT.                        
                                                                                
           IF K830-NUM-MAIL-ADDR = SPACES                                       
              MOVE K830-NUM-BLK             TO L500-BLK                         
              MOVE K830-NUM-FLAT            TO L500-NUM-FLAT                    
              MOVE K830-NME-STREET          TO L500-STREET                      
              MOVE K830-NUM-POSTAL          TO L500-POST                        
           ELSE                                                                 
              MOVE K830-NUM-MAIL-BLK        TO L500-BLK                         
              MOVE K830-NUM-MAIL-FLAT       TO L500-NUM-FLAT                    
              MOVE K830-NME-MAIL-STREET     TO L500-STREET                      
              MOVE K830-NUM-MAIL-POSTAL     TO L500-POST.                       
                                                                                
       3300-PRINT-REQUEST.                                                      
           IF WS-LINE-CTR      NOT < 58                                         
              PERFORM 5000-PRINT-HEADER                                         
                 THRU 5000-EXIT.                                                
                                                                                
           ADD   1                          TO WS-WRITE-CTR.                    
           MOVE  WS-WRITE-CTR               TO L500-NO.                         
           WRITE BP13L527-REC               FROM L500-PR-DETAIL-1               
                                                 AFTER 2.                       
           ADD 2                            TO WS-LINE-CTR.                     
                                                                                
       3300-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       4000-PRINT-OCCUP.                                                        
            IF BP13K828-STATUS = 23                                             
               MOVE SPACES                   TO L500-NAME                       
                                                L500-RELN                       
                                                L500-LSE-CHK                    
                                                L500-DATE-UPDATE                
            ELSE                                                                
               ADD 1                         TO WS-K828-READ-CTR                
               MOVE K828-NME-OCCP            TO L500-NAME                       
               MOVE K828-NUM-NRIC            TO L500-NRIC                       
               MOVE K828-NUM-RELATIONSHIP    TO L500-RELN                       
               MOVE K828-NUM-LESSEE-CHECK    TO L500-LSE-CHK                    
               MOVE K828-DTE-UPDATE          TO WS-DATE                         
               MOVE WS-DD                    TO WS-DD-PR                        
               MOVE WS-MM                    TO WS-MM-PR                        
               MOVE WS-YY                    TO WS-YY-PR                        
               MOVE WS-DATE-PR               TO L500-DATE-UPDATE.               
                                                                                
            PERFORM 4500-CHECK-K500          THRU 4500-EXIT.                    
                                                                                
      ******************************************************************        
      *                                                                *        
      *       PRINT LIST OF APPLICANTS AFTER THE OPENING OF NEW TOWN   *        
      *                                                                *        
      ******************************************************************        
           IF WS-LINE-CTR      NOT < 60                                         
              PERFORM 5000-PRINT-HEADER                                         
                 THRU 5000-EXIT.                                                
                                                                                
           WRITE BP13L527-REC FROM L500-PR-DETAIL-2 AFTER 1.                    
           ADD 1              TO WS-LINE-CTR.                                   
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       4500-CHECK-K500.                                                         
            MOVE L500-NRIC          TO K500-ALT1-KEY.                           
            READ BP13K500 KEY IS K500-ALT1-KEY.                                 
            IF BP13K500-STATUS = 00                                             
               NEXT SENTENCE                                                    
                                                                                
            ELSE                                                                
            IF BP13K500-STATUS = 23                                             
               MOVE L500-NRIC       TO K500-ALT2-KEY                            
               READ BP13K500 KEY IS K500-ALT2-KEY                               
                                                                                
            ELSE                                                                
               DISPLAY 'ERROR READING BP13K500, STATUS = '                      
                                      BP13K500-STATUS.                          
                                                                                
            IF BP13K500-STATUS = 23                                             
               MOVE SPACES                   TO L500-REF-2                      
            ELSE                                                                
               MOVE '   ** '                 TO L500-REF-2.                     
                                                                                
       4500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5000-PRINT-HEADER.                                                       
      ******************************************************************        
      *                                                                *        
      *         CHECK LINE COUNT TO DETERMINE PAGE THROW               *        
      *                                                                *        
      ******************************************************************        
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS5-CURRENT-DATE.                      
           MOVE WS5-CUR-DD               TO WS5-PC-DD.                          
           MOVE WS5-CUR-MM               TO WS5-PC-MM.                          
           MOVE WS5-CUR-YY               TO WS5-PC-YY.                          
           MOVE WS5-PR-CUR-DATE          TO PRINT-DATE.                         
                                                                                
           MOVE 9                        TO WS-LINE-CTR.                        
           ADD 1                         TO WS-PAGE-CTR.                        
           MOVE WS-PAGE-CTR              TO PRINT-PAGE.                         
                                                                                
           WRITE BP13L527-REC FROM L500-PR-HEAD-01 AFTER PAGE.                  
           WRITE BP13L527-REC FROM L500-PR-HEAD-02 AFTER 2.                     
           WRITE BP13L527-REC FROM L500-PR-HEAD-03 AFTER 1.                     
           WRITE BP13L527-REC FROM L500-PR-HEAD-04 AFTER 2.                     
           WRITE BP13L527-REC FROM L500-PR-HEAD-05 AFTER 1.                     
           WRITE BP13L527-REC FROM L500-PR-HEAD-06 AFTER 1.                     
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       9000-CLOSE-ROUTINE.                                                      
      ****************************************************************          
      *                                                              *          
      *            CLOSE FILES AND END PROCESSING                    *          
      *                                                              *          
      ****************************************************************          
           CLOSE BP13F595                                                       
                 BP13K500                                                       
                 BP13K828                                                       
                 BP13K830                                                       
                 BP13L527.                                                      
                                                                                
           DISPLAY ' ** BP13C527 ** '.                                          
           DISPLAY 'NO OF REC READ FROM DATA ENTRY FILE (BP13F595) : '          
                   WS-F595-READ-CTR.                                            
           DISPLAY 'NO OF REC READ FROM HISTORY OCCUPIER(BP13K828) : '          
                   WS-K828-READ-CTR.                                            
           DISPLAY 'NO OF REC READ FROM ADDRESS FILE    (BP13K830) : '          
                   WS-K830-READ-CTR.                                            
           DISPLAY 'NO OF NEW REQUESTS                  (BP13L527) : '          
                   WS-WRITE-CTR.                                                
                                                                                
           STOP RUN.                                                            
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
