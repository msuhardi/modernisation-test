       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C0FW.                                                 
       AUTHOR.        JOHN.                                                     
       DATE-WRITTEN.  08 FEB 2013.                                              
      ************************************************************              
      *   SYSTEM NAME : SOC - GENERATE WEEKLY SOC EMAIL ALERT    *              
      *                                                          *              
      *   OBJECTIVE:                                             *              
      *      GENERATE A WEEKLY REPORT ON CASES TO BE SCHEDULED   *              
      *      TP/SATP APPT.  READ B13F462 FILE MONITORED CASES    *              
      *      AND OUTPUT ON THE REPORT CASES WITH RESALE COMPLETED*              
      *      BUT NO TP APPOINTMENT OR WITH TP APPOINTMENT BUT    *              
      *      NOT YET EXECUTED.  ALSO INCLUDE RESALE WITH ABORTIVE*              
      *      DATES                                               *              
      *                                                          *              
      * CHG-NO  BY   ON       DESCRIPTION                        *              
      *-------  ---  ------   ----------                         *              
      *BP134763 JGO1 08/02/13 INITIAL CODING                     *              
      *BP136173 PCL4 11/04/16 TO UPDATE EMAIL RECIPIENTS         *              
      *BP136477 RJB1 18/10/16 TO REPLACE KIM HUAT TO YEE MIEN    *              
      *BP136560 PCL4 12/01/17 TO UPDATE EMAIL RECIPIENTS         *              
      *BP137554 DN8  09/11/18 KATHIJAH BEE ALI MOHAMED(HDB)      *              
      *                       REPLACE WITH HON HUAT LAU(HDB)     *              
      *BP138202 KV5  20/02/20 REMOVED THE EMAIL                  *              
      *BP138202 KV5  20/02/20 HONG HUAT LAU(HDB)                 *              
      *                       REPLACE WITH BERNICE               *              
      *BP138757 KV8  15/06/21 REMOVED LAU HONG HUAT AND          *              
      *                       INCLUDE BERNICE JH GAN             *              
      *BP139030 ZAR7 07/01/22  REPLACE CHUA YEE MIEN TO LIM KOK CHUN            
      *BP139564 KAC1 03/06/23 REPLACE LIM KOK CHUN TO ZANY *    *               
      *                       REPLACE BERNICE GAN   TO HEE_WAN_MENG             
      *                       REPLACE HONG HUAT     TO JANICE OH                
      *BP139175 KAC1 23/04/24 REPLACE ZANY TO SOFFIA_RAPHAY@HDB.GOV.SG          
      ************************************************************              
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F462  ASSIGN       TO BP13F462.                           
                                                                                
           SELECT BP13K410  ASSIGN       TO BP13K410                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K410-KEY-FLD                        
                            FILE STATUS  IS BP13K410-STATUS.                    
                                                                                
           SELECT BP13K022  ASSIGN       TO BP13K022                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K022-KEY-FLD                        
                            ALTERNATE RECORD KEY IS K022-NUM-REGN               
                            WITH DUPLICATES                                     
                            FILE STATUS  IS BP13K022-STATUS.                    
                                                                                
           SELECT BP13K450  ASSIGN       TO BP13K450                            
                            ACCESS MODE  IS DYNAMIC                             
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K454-KEY-FLD                        
                            ALTERNATE KEY IS K454-ALT1-KEY                      
                            FILE STATUS  IS BP13K454-STATUS.                    
                                                                                
           SELECT BB24K130  ASSIGN       TO BB24K130                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K130-KEY-FLD                        
                            FILE STATUS  IS BB24K130-STATUS.                    
                                                                                
           SELECT BB24K010  ASSIGN       TO BB24K010                            
                            ACCESS MODE  IS DYNAMIC                             
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K010-KEY-FLD                        
                            ALTERNATE KEY IS K010-ALT-KEY1                      
                            FILE STATUS  IS BB24K010-STATUS.                    
                                                                                
           SELECT BP13K462  ASSIGN       TO BP13K462                            
                            ACCESS MODE  IS DYNAMIC                             
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K462-KEY-FLD                        
                            FILE STATUS  IS BP13K462-STATUS.                    
                                                                                
           SELECT BM06K110  ASSIGN       TO BM06K110                            
                            ACCESS MODE  IS DYNAMIC                             
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K110-KEY-FLD                        
                            ALTERNATE KEY IS K110-REGN-NO                       
                            FILE STATUS  IS BM06K110-STATUS.                    
                                                                                
           SELECT BP13F0FW  ASSIGN       TO BP13F0FW.                           
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F0FW                                                            
            RECORDING MODE  F                                                   
            RECORD CONTAINS 100 CHARACTERS.                                     
       01   MAIL-PRTREC              PIC X(100).                                
                                                                                
       FD   BP13K410                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K410.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K462                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K462.                                                           
                                                                                
       FD   BP13F462                                                            
                                      RECORD CONTAINS 1000 CHARACTERS           
                                      LABEL RECORD IS STANDARD                  
                                      RECORDING MODE IS F.                      
       COPY BP13F462.                                                           
                                                                                
       FD   BP13K450                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K454.                                                           
                                                                                
       FD   BB24K130                                                            
            RECORD CONTAINS 5000 CHARACTERS.                                    
       COPY BB24K130.                                                           
                                                                                
       FD   BB24K010                                                            
            RECORD CONTAINS 5000 CHARACTERS.                                    
       COPY BB24K010.                                                           
                                                                                
       FD  BM06K110                                                             
                                      RECORD CONTAINS 500 CHARACTERS.           
       COPY BM06K110.                                                           
                                                                                
      *-------------------------                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------                                                
       01  BP13F462-STATUS              PIC 99     VALUE 00.                    
       01  BP13K462-STATUS              PIC 99     VALUE 00.                    
       01  BP13K454-STATUS              PIC 99     VALUE 00.                    
       01  BB24K010-STATUS              PIC 99     VALUE 00.                    
       01  BM06K110-STATUS              PIC 99     VALUE 00.                    
       01  BP13K410-STATUS              PIC 99     VALUE 00.                    
       01  BP13K022-STATUS              PIC 99     VALUE 00.                    
       01  BB24K130-STATUS              PIC 99     VALUE 00.                    
       01  WS-F462-EOF                  PIC X      VALUE 'N'.                   
       01  WS-K010-EOF                  PIC X      VALUE 'N'.                   
       01  WS-K454-EOF                  PIC X      VALUE 'N'.                   
       01  WS-K010-FOUND                PIC X      VALUE 'N'.                   
       01  WS-K454-FOUND                PIC X      VALUE 'N'.                   
       01  WS-K010-CASE                 PIC X(8)   VALUE SPACES.                
       01  WS-CURRENT-DATE.                                                     
           05 WS-CURR-CCYY.                                                     
              10 WS-CURR-CC            PIC X(2).                                
              10 WS-CURR-YY            PIC X(2).                                
           05 WS-CURR-MM               PIC X(2).                                
           05 WS-CURR-DD               PIC X(2).                                
       01  WS-COUNTER.                                                          
           05 WS-F0FW-WRITE             PIC 9(6)   VALUE ZEROES.                
           05 WS-K462-UPDATE            PIC 9(6)   VALUE ZEROES.                
           05 WS-F0FW-WRITE-Z           PIC ZZZ,ZZ9 VALUE ZEROES.               
           05 WS-F462-READ              PIC 9(6)   VALUE ZEROES.                
       01  WS-FLAGS.                                                            
           05 WS-WRITE-OUT              PIC X.                                  
       01  WS-HDR-LINES.                                                        
           05 WS-RECIPIENT              PIC X(30)                               
              VALUE 'TO:SALES OPERATIONS SECTION'.                              
           05 WS-TITLE                  PIC X(50)                               
              VALUE 'REPORT ON CASES TO BE SCHEDULED TP/SATP APPT'.             
           05 WS-SUBJ3                  PIC X(45)                               
              VALUE 'PLEASE SCHEDULE TP APPT FOR YOUR CASES BELOW:'.            
           05 WS-HDR2-1                 PIC X(12)                               
              VALUE                  'REG NUMBER'.                              
           05 WS-HDR2-2                 PIC X(13)                               
              VALUE                  'NRIC'.                                    
           05 WS-HDR2-3                 PIC X(15)                               
              VALUE                  'RESL COMP DATE'.                          
           05 WS-HDR2-4                 PIC X(20)                               
              VALUE                  'RESL ABORTIVE DATE'.                      
       01  MAIL-HDR1.                                                           
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.                 
           05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
       01  MAIL-HDR2.                                                           
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                         
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.                    
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL1A.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
      *    05  FILLER PIC X(60) VALUE                                           
      *        'BERNICE_JH_GAN@HDB.GOV.SG'.                                     
           05  FILLER PIC X(60) VALUE                                           
               'HEE_WAN_MENG@HDB.GOV.SG'.                                       
                                                                                
       01  MAIL-DTL1A1.                                                         
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER PIC X(60) VALUE                                           
               'TENG_SIEW_HONG@HDB.GOV.SG>'.                                    
                                                                                
       01  MAIL-DTL1B.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER PIC X(60) VALUE                                           
               'DAVID_FG_SOH@HDB.GOV.SG>'.                                      
      *        'KONG_YOKE_PHENG@HDB.GOV.SG>'.                                   
                                                                                
      *01  MAIL-DTL1C.                                                          
      *    05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
      *    05  FILLER  PIC X(60) VALUE                                          
      *        'LOW_SOO_CHIEW@HDB.GOV.SG>'.                                     
                                                                                
       01  MAIL-DTL1D.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER  PIC X(60) VALUE                                          
               'SOFFIA_RAPHAY@HDB.GOV.SG>'.                                     
      *        'CHUA_YEE_MIEN@HDB.GOV.SG>'.                                     
                                                                                
       01  MAIL-DTL2.                                                           
           05  FILLER          PIC X(04)  VALUE 'DATA'.                         
           05  FILLER          PIC X(96)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL3.                                                           
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                        
           05  MAIL-SENDMAILID PIC X(26)  VALUE                                 
               'SOC - EMAIL ALERT'.                                             
           05  FILLER          PIC X(69)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4A.                                                          
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  RCPT-ID PIC X(60)  VALUE                                         
               'JANICE_ML_OH@HDB.GOV.SG>'.                                      
      *        'LAU_HONG_HUAT@HDB.GOV.SG>'.                                     
                                                                                
       01  MAIL-DTL4A1.                                                         
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  RCPT-ID PIC X(60)  VALUE                                         
               'TENG_SIEW_HONG@HDB.GOV.SG>'.                                    
                                                                                
       01  MAIL-DTL4B.                                                          
           05  FILLER          PIC X(04)  VALUE 'CC:<'.                         
           05  FILLER PIC X(60) VALUE                                           
               'DAVID_FG_SOH@HDB.GOV.SG>'.                                      
      *        'KONG_YOKE_PHENG@HDB.GOV.SG>'.                                   
                                                                                
       01  MAIL-DTL4C.                                                          
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  FILLER  PIC X(60) VALUE                                          
               'SOFFIA_RAPHAY@HDB.GOV.SG>'.                                     
                                                                                
      *01  MAIL-DTL4D.                                                          
      *    05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
      *    05  FILLER  PIC X(60) VALUE                                          
      *        'LOW_SOO_CHIEW@HDB.GOV.SG>'.                                     
                                                                                
       01  MAIL-HDR-SUBJ.                                                       
           05  FILLER          PIC X(35)                                        
                 VALUE 'SUBJECT: WEEKLY EXCEPTION REPORT'.                      
                                                                                
       01 F0FW-HDR-REC.                                                         
            05 FILLER                  PIC X(05).                               
            05 F0FW-HDR-TITLE          PIC X(85).                               
       01 F0FW-DTL-REC.                                                         
            05 F0FW-SERIAL-NO          PIC X(07).                               
            05 FILLER                  PIC X(01).                               
            05 F0FW-RESL-COMP-DTE      PIC X(10).                               
            05 FILLER                  PIC X(02).                               
            05 F0FW-RESL-ABRT-DTE      PIC X(10).                               
            05 FILLER                  PIC X(02).                               
            05 F0FW-ADDRESS            PIC X(25).                               
            05 FILLER                  PIC X(01).                               
            05 F0FW-OIC                PIC X(06).                               
            05 FILLER                  PIC X(02).                               
            05 F0FW-CASE-NUM           PIC X(08).                               
            05 FILLER                  PIC X(02).                               
            05 F0FW-TP-APPT            PIC X(14).                               
                                                                                
      *-------------------------                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------                                                
       0000-MAIN.                                                               
                                                                                
            PERFORM A000-HOUSEKEEPING   THRU A000-EXIT.                         
            PERFORM P100-PROCESS        THRU P100-EXIT                          
                     UNTIL WS-F462-EOF = 'Y'.                                   
            PERFORM Z999-CLOSING        THRU Z999-EXIT.                         
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
       A000-HOUSEKEEPING.                                                       
                                                                                
            OPEN INPUT  BP13F462                                                
                        BB24K130                                                
                        BP13K410                                                
                        BP13K022                                                
                        BM06K110                                                
                 I-O    BP13K462                                                
                 OUTPUT BP13F0FW.                                               
                                                                                
           IF BP13K410-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BP13K410-STATUS ' BP13K410-STATUS         
              MOVE     BP13K410-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           IF BM06K110-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BM06K110-STATUS ' BM06K110-STATUS         
              MOVE     BM06K110-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           IF BP13K462-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BP13K462-STATUS ' BP13K462-STATUS         
              MOVE     BP13K462-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           IF BP13K022-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BP13K022-STATUS ' BP13K022-STATUS         
              MOVE     BP13K022-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           IF BB24K130-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BB24K130-STATUS ' BB24K130-STATUS         
              MOVE     BB24K130-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO WS-CURRENT-DATE.                 
           DISPLAY 'CURRENT-DATE : ' WS-CURRENT-DATE.                           
                                                                                
       A000-EXIT.                                                               
            EXIT.                                                               
                                                                                
       P000-READ-F462.                                                          
                                                                                
           MOVE 'N' TO WS-WRITE-OUT.                                            
           READ BP13F462 AT END                                                 
                MOVE 'Y'         TO WS-F462-EOF                                 
                GO TO P100-EXIT.                                                
           ADD 1 TO WS-F462-READ.                                               
                                                                                
       P000-EXIT.                                                               
            EXIT.                                                               
                                                                                
       P100-PROCESS.                                                            
                                                                                
            PERFORM P000-READ-F462      THRU P000-EXIT.                         
            MOVE F462-NUM-REGN TO K410-NUM-REGN.                                
            READ BP13K410.                                                      
            IF BP13K410-STATUS = '00'                                           
                 GO TO P100-EXIT                                                
            ELSE                                                                
                 DISPLAY 'K410 NOT FOUND: ' F462-NUM-REGN                       
            END-IF.                                                             
            MOVE SPACES TO  MAIL-PRTREC.                                        
            MOVE SPACES TO K130-DTE-ABORT.                                      
            MOVE 'N' TO WS-K010-EOF.                                            
            MOVE 'N' TO WS-K454-EOF.                                            
            MOVE 'N' TO WS-K010-FOUND.                                          
            MOVE 'N' TO WS-K454-FOUND.                                          
            PERFORM P200-START-K010 THRU P200-EXIT.                             
            PERFORM P300-READ-K010  THRU P300-EXIT                              
               UNTIL WS-K010-EOF = 'Y' OR                                       
                     WS-K010-FOUND = 'Y'.                                       
                                                                                
            CLOSE BB24K010.                                                     
            IF BB24K010-STATUS  NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP24K010, STAT ' BB24K010-STATUS          
               MOVE     BB24K010-STATUS TO RETURN-CODE                          
               PERFORM  Z999-CLOSING THRU Z999-EXIT                             
            END-IF.                                                             
                                                                                
            MOVE WS-K010-CASE    TO K130-NUM-CASE.                              
            READ BB24K130.                                                      
            IF BB24K130-STATUS = '00'                                           
               IF K130-DTE-ABORT NOT = SPACES OR LOW-VALUES                     
                  MOVE 'Y' TO WS-WRITE-OUT                                      
               ELSE                                                             
                  MOVE SPACES TO K130-DTE-ABORT                                 
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF WS-WRITE-OUT = 'Y'                                               
               IF WS-F0FW-WRITE = 0                                             
                  PERFORM W200-WRITE-HEADER THRU W200-EXIT                      
               END-IF                                                           
               PERFORM W300-READ-K462 THRU W300-EXIT                            
               PERFORM W100-GEN-EMAIL THRU W100-EXIT                            
            END-IF.                                                             
                                                                                
       P100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       P200-START-K010.                                                         
                                                                                
           OPEN INPUT   BB24K010.                                               
                                                                                
           IF BB24K010-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BB24K010-STATUS ' BB24K010-STATUS         
              MOVE     BB24K010-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           MOVE F462-NUM-HDBREF-DISPOSAL TO K010-ALT-KEY1.                      
           START BB24K010 KEY NOT LESS THAN K010-ALT-KEY1                       
           IF BB24K010-STATUS = ZEROES                                          
              CONTINUE                                                          
           ELSE                                                                 
            DISPLAY 'START READ ERROR BB24K010,STATUS' BB24K010-STATUS          
              MOVE     BB24K010-STATUS TO RETURN-CODE                           
              PERFORM Z999-CLOSING THRU Z999-EXIT                               
           END-IF.                                                              
                                                                                
       P200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       P300-READ-K010.                                                          
                                                                                
           READ BB24K010 NEXT RECORD AT END                                     
                MOVE 'Y'   TO  WS-K010-EOF                                      
                GO TO P300-EXIT.                                                
                                                                                
           IF BB24K010-STATUS = 00 OR 02                                        
              IF K010-ALT-KEY1 = F462-NUM-HDBREF-DISPOSAL                       
                 MOVE K010-NUM-CASE TO WS-K010-CASE                             
                 MOVE 'Y'           TO WS-K010-FOUND                            
                 IF K010-DTE-STATUS-UPDATE(17) <= WS-CURRENT-DATE               
                    AND K010-DTE-STATUS-UPDATE(17) NOT = SPACES                 
                    AND K010-DTE-STATUS-UPDATE(17) NOT = LOW-VALUES             
                     PERFORM P400-CHECK-K454 THRU P400-EXIT                     
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              DISPLAY 'READ ERROR BB24K010,STATUS ' BB24K010-STATUS             
              MOVE     BB24K010-STATUS TO RETURN-CODE                           
              PERFORM Z999-CLOSING THRU Z999-EXIT                               
           END-IF.                                                              
                                                                                
       P300-EXIT.                                                               
           EXIT.                                                                
                                                                                
       P400-CHECK-K454.                                                         
                                                                                
           OPEN INPUT   BP13K450.                                               
                                                                                
           IF BP13K454-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR, BP13K454-STATUS ' BP13K454-STATUS         
              MOVE     BP13K454-STATUS TO RETURN-CODE                           
              PERFORM  Z999-CLOSING THRU Z999-EXIT                              
           END-IF.                                                              
                                                                                
           MOVE LOW-VALUES      TO K454-CDE-APPT-TYPE.                          
           MOVE F462-NUM-REGN   TO K454-NUM-REGN.                               
           PERFORM P500-READ-K454  THRU P500-EXIT                               
               UNTIL WS-K454-EOF = 'Y' OR                                       
                     WS-K454-FOUND = 'Y'.                                       
                                                                                
           CLOSE BP13K450.                                                      
           IF BP13K454-STATUS  NOT = 00 AND 97                                  
               DISPLAY 'CLOSING ERROR BP13K454, STAT ' BP13K454-STATUS          
               MOVE     BP13K454-STATUS TO RETURN-CODE                          
               PERFORM  Z999-CLOSING THRU Z999-EXIT                             
           END-IF.                                                              
                                                                                
                                                                                
       P400-EXIT.                                                               
            EXIT.                                                               
                                                                                
       P500-READ-K454.                                                          
                                                                                
           READ BP13K450 NEXT RECORD AT END                                     
                MOVE 'Y'   TO WS-WRITE-OUT                                      
                MOVE 'Y'   TO  WS-K454-EOF                                      
                GO TO P500-EXIT.                                                
                                                                                
           IF BP13K454-STATUS = 00 OR 02                                        
              IF F462-NUM-REGN = K454-NUM-REGN                                  
                 MOVE 'Y'  TO WS-K454-FOUND                                     
                 MOVE 'Y'  TO WS-WRITE-OUT                                      
              END-IF                                                            
           ELSE                                                                 
              DISPLAY 'READ ERROR BP13K454,STATUS ' BP13K454-STATUS             
              MOVE     BP13K454-STATUS TO RETURN-CODE                           
              PERFORM Z999-CLOSING THRU Z999-EXIT                               
           END-IF.                                                              
                                                                                
       P500-EXIT.                                                               
           EXIT.                                                                
                                                                                
       P600-READ-BM06K110.                                                      
                                                                                
            INITIALIZE K110-REC.                                                
            MOVE F462-NUM-REGN TO K110-REGN-NO.                                 
            READ BM06K110 KEY IS K110-REGN-NO.                                  
            IF BM06K110-STATUS = '00'                                           
              MOVE K110-DTE-KEY-ISSUED TO K462-DTE-KEY-ISSUE                    
            ELSE                                                                
              MOVE SPACES              TO K462-DTE-KEY-ISSUE                    
              DISPLAY 'K110 REC NOT FOUND:' F462-NUM-REGN                       
            END-IF.                                                             
                                                                                
                                                                                
       P600-EXIT.                                                               
            EXIT.                                                               
                                                                                
       W100-GEN-EMAIL.                                                          
                                                                                
            MOVE SPACES TO F0FW-DTL-REC.                                        
            ADD 1 TO WS-F0FW-WRITE.                                             
            MOVE WS-F0FW-WRITE           TO WS-F0FW-WRITE-Z.                    
            MOVE WS-F0FW-WRITE-Z         TO F0FW-SERIAL-NO.                     
            IF K010-DTE-STATUS-UPDATE(17) = SPACES OR LOW-VALUES                
              MOVE SPACES                     TO  F0FW-RESL-COMP-DTE            
            ELSE                                                                
              MOVE K010-DTE-STATUS-UPDATE(17) TO  F0FW-RESL-COMP-DTE            
            END-IF.                                                             
            MOVE K130-DTE-ABORT          TO F0FW-RESL-ABRT-DTE.                 
            STRING ' BLK' K010-NUM-BLOCK K010-NME-STREET                        
                     DELIMITED BY SIZE  INTO  F0FW-ADDRESS.                     
            MOVE F462-NUM-REGN           TO K022-NUM-REGN.                      
            READ BP13K022 KEY IS K022-NUM-REGN.                                 
            IF BP13K022-STATUS = '00'                                           
                 MOVE K022-NUM-OIC       TO F0FW-OIC                            
            ELSE                                                                
                 MOVE SPACES             TO F0FW-OIC                            
                 DISPLAY 'OIC NOT FOUND: ' F462-NUM-REGN                        
            END-IF.                                                             
            MOVE K010-NUM-CASE           TO F0FW-CASE-NUM.                      
            MOVE K010-DTE-STATUS-UPDATE(17) TO  F0FW-TP-APPT.                   
            WRITE MAIL-PRTREC FROM F0FW-DTL-REC.                                
                                                                                
            MOVE SPACES TO F0FW-DTL-REC.                                        
            STRING ' #' K010-NUM-LEVEL '-' K010-NUM-UNIT '( '                   
                   K010-NUM-POSTAL-CDE ' )' DELIMITED BY SIZE                   
                   INTO F0FW-ADDRESS.                                           
            WRITE MAIL-PRTREC FROM F0FW-DTL-REC.                                
                                                                                
       W100-EXIT.                                                               
            EXIT.                                                               
                                                                                
       W200-WRITE-HEADER.                                                       
                                                                                
            WRITE MAIL-PRTREC FROM MAIL-HDR1.                                   
            WRITE MAIL-PRTREC FROM MAIL-HDR2.                                   
            WRITE MAIL-PRTREC FROM MAIL-DTL1A.                                  
            WRITE MAIL-PRTREC FROM MAIL-DTL1A1.                                 
            WRITE MAIL-PRTREC FROM MAIL-DTL1B.                                  
      *     WRITE MAIL-PRTREC FROM MAIL-DTL1C.                                  
            WRITE MAIL-PRTREC FROM MAIL-DTL1D.                                  
            WRITE MAIL-PRTREC FROM MAIL-DTL2.                                   
            WRITE MAIL-PRTREC FROM MAIL-DTL3.                                   
            WRITE MAIL-PRTREC FROM MAIL-DTL4A.                                  
            WRITE MAIL-PRTREC FROM MAIL-DTL4A1.                                 
            WRITE MAIL-PRTREC FROM MAIL-DTL4B.                                  
            WRITE MAIL-PRTREC FROM MAIL-DTL4C.                                  
      *     WRITE MAIL-PRTREC FROM MAIL-DTL4D.                                  
            WRITE MAIL-PRTREC FROM MAIL-HDR-SUBJ.                               
            MOVE SPACES TO F0FW-HDR-REC.                                        
            MOVE   WS-RECIPIENT    TO F0FW-HDR-TITLE.                           
            WRITE MAIL-PRTREC FROM F0FW-HDR-REC.                                
            MOVE SPACES TO F0FW-HDR-REC.                                        
            WRITE MAIL-PRTREC FROM F0FW-HDR-REC.                                
            MOVE SPACES TO F0FW-HDR-REC.                                        
            MOVE   WS-TITLE        TO F0FW-HDR-TITLE.                           
            WRITE MAIL-PRTREC FROM F0FW-HDR-REC.                                
            MOVE SPACES TO F0FW-HDR-REC.                                        
            WRITE MAIL-PRTREC FROM F0FW-HDR-REC.                                
                                                                                
            MOVE SPACES TO F0FW-DTL-REC.                                        
            MOVE '  S/NO'          TO   F0FW-SERIAL-NO.                         
            MOVE 'RESL COMP'       TO   F0FW-RESL-COMP-DTE.                     
            MOVE 'RESL ABORTIVE'   TO   F0FW-RESL-ABRT-DTE.                     
            MOVE '    FLAT ADDRESS' TO   F0FW-ADDRESS.                          
            MOVE ' OIC '           TO   F0FW-OIC.                               
            MOVE 'CASE NO'         TO   F0FW-CASE-NUM.                          
            MOVE 'TP APPT FIXED'   TO   F0FW-TP-APPT.                           
            WRITE MAIL-PRTREC FROM F0FW-DTL-REC.                                
            MOVE SPACES TO F0FW-DTL-REC.                                        
            MOVE '  DATE   '       TO   F0FW-RESL-COMP-DTE.                     
            MOVE '  DATE   '       TO   F0FW-RESL-ABRT-DTE.                     
            MOVE '   BUT NOT   '   TO   F0FW-TP-APPT.                           
            WRITE MAIL-PRTREC FROM F0FW-DTL-REC.                                
            MOVE SPACES TO F0FW-DTL-REC.                                        
            MOVE '   EXECUTED  '   TO   F0FW-TP-APPT.                           
            WRITE MAIL-PRTREC FROM F0FW-DTL-REC.                                
                                                                                
       W200-EXIT.                                                               
            EXIT.                                                               
                                                                                
       W300-READ-K462.                                                          
                                                                                
            MOVE F462-KEY-FLD TO K462-KEY-FLD.                                  
            READ BP13K462.                                                      
                                                                                
            IF BP13K462-STATUS = 00 OR 02                                       
              PERFORM W350-UPDATE-K462 THRU W350-EXIT                           
            ELSE                                                                
              DISPLAY 'READ ERROR BP13K462,STATUS ' BP13K462-STATUS             
              MOVE     BP13K462-STATUS TO RETURN-CODE                           
              PERFORM Z999-CLOSING THRU Z999-EXIT                               
            END-IF.                                                             
                                                                                
       W300-EXIT.                                                               
            EXIT.                                                               
                                                                                
       W350-UPDATE-K462.                                                        
                                                                                
            PERFORM P600-READ-BM06K110   THRU P600-EXIT.                        
            REWRITE BP13K462-REC.                                               
            IF BP13K462-STATUS = 00 OR 02                                       
              ADD 1 TO WS-K462-UPDATE                                           
            ELSE                                                                
              DISPLAY 'READ ERROR BP13K462,STATUS ' BP13K462-STATUS             
              MOVE     BP13K462-STATUS TO RETURN-CODE                           
              PERFORM Z999-CLOSING THRU Z999-EXIT                               
            END-IF.                                                             
                                                                                
       W350-EXIT.                                                               
            EXIT.                                                               
                                                                                
       Z100-SUMMARY.                                                            
                                                                                
            DISPLAY '*********************'.                                    
            DISPLAY '*  BP13C0FW TOTALS  *'.                                    
            DISPLAY '*********************'.                                    
            DISPLAY 'ALERT WRITE: ' WS-F0FW-WRITE.                              
            DISPLAY 'F462  READ:  ' WS-F462-READ.                               
            DISPLAY 'K462  UPD :  ' WS-K462-UPDATE.                             
                                                                                
       Z100-EXIT.                                                               
            EXIT.                                                               
                                                                                
       Z999-CLOSING.                                                            
                                                                                
            PERFORM Z100-SUMMARY THRU Z100-EXIT.                                
            CLOSE BP13F462                                                      
                  BP13K410                                                      
                  BP13K462                                                      
                  BP13K022                                                      
                  BB24K130                                                      
                  BM06K110                                                      
                  BP13F0FW.                                                     
                                                                                
            IF BP13K410-STATUS  NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K410, STAT ' BP13K410-STATUS.         
                                                                                
            IF BM06K110-STATUS  NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BM06K110, STAT ' BM06K110-STATUS.         
                                                                                
            IF BP13K022-STATUS  NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K022, STAT ' BP13K022-STATUS.         
                                                                                
            IF BB24K130-STATUS  NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K130, STAT ' BB24K130-STATUS.         
                                                                                
            STOP RUN.                                                           
                                                                                
       Z999-EXIT.                                                               
            EXIT.                                                               
