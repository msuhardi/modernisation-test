       IDENTIFICATION DIVISION.                                         00010002
       PROGRAM-ID.    BP13C148.                                         00020002
      *AUTHOR.        CKK7                                              00030002
      *DATE-WRITTEN.  20MAY2003.                                        00040002
      * ====================================================== *        00050002
      *                                                        *        00060002
      *    SYSTEM NAME : SYSTEM OF COMMITMENT  (SOC)           *        00070002
      *                                                        *        00080002
      *    SYSTEM ID   : BP13                                  *        00090002
      *                                                        *        00100002
      *    OBJECTIVES :                                        *        00110002
      *                                                        *        00120002
      *    1. UPDATE OF OIC FILE.                              *        00130002
      *    2. TO ASSIGN REGN TO OIC'S FOR WIS APPLICATION      *        00140002
      *       APPLIED FFOR THE DAY.                            *        00150002
      *                                                        *        00160002
      *    INPUT FILES  : BP13F800 - TRANSACTION FILE          *        00170002
      *    I-O            BP13K022 - OIC FILE                  *        00180002
      *                   BP13K025 - CONTROL FILE              *        00190002
      *                                                        *        00200002
      *--------------------------------------------------------*        00210002
      * CHG-NO  BY  DATE      DETAILS                          *        00220002
      *=======  === ========= =================================*        00230002
      *BP132957 CKK 20061126  NEW PGM                          *        00240002
      *BP133427 IL5 20090108  REMOVE COMPARISON OF CURRENT DATE*        00250002
      *         JB8           AND F800-DTE-REGN                *        00260002
      *BP133628 ZDD120060604  TO STILL ASSGIN OIC TO CASES THAT*        00270002
      *                       WAS NOT FOUND OF BP13K022        *        00280002
      *BP133671 ZDD120060604  INITIALIZE BP13K022 BEFORE       *        00281002
      *                       WRITING A RECORD                 *        00282002
      *BP134091 JB8 20110407  TO CATER FOR KB25 NOT FND        *        00283002
      *BP136185 SMR 20170112  CATER FOR NUM-PRJCT(DBS/EC/NPL)  *        00284002
      *========================================================*        00290002
       ENVIRONMENT DIVISION.                                            00300002
       CONFIGURATION SECTION.                                           00310002
       SOURCE-COMPUTER. IBM-4341.                                       00320002
       OBJECT-COMPUTER. IBM-4341.                                       00330002
       INPUT-OUTPUT SECTION.                                            00340002
       FILE-CONTROL.                                                    00350002
                                                                        00360002
           SELECT SY02F001 ASSIGN TO SY02F001.                          00370002
                                                                        00380002
           SELECT BP13F800 ASSIGN TO BP13F800.                          00390002
                                                                        00400002
           SELECT BP13K022 ASSIGN TO BP13K022                           00410002
                  ACCESS MODE     IS DYNAMIC                            00420002
                  ORGANIZATION    IS INDEXED                            00430002
                  RECORD KEY      IS K022-KEY-FLD                       00440002
                  ALTERNATE KEY   IS K022-NUM-REGN                      00450002
                  FILE STATUS     IS WS-K022-STATUS.                    00460002
                                                                        00470002
           SELECT BP13KB25 ASSIGN TO BP13KB25                           00480002
                  ACCESS MODE     IS DYNAMIC                            00490002
                  ORGANIZATION    IS INDEXED                            00500002
                  RECORD KEY      IS KB25-KEY-FLD                       00510002
                  ALTERNATE KEY   IS KB25-ALT-KEY                       00520002
                  FILE STATUS     IS WS-KB25-STATUS.                    00530002
                                                                        00540002
           SELECT BP13K025 ASSIGN TO BP13K025                           00550002
                  ACCESS MODE     IS DYNAMIC                            00560002
                  ORGANIZATION    IS INDEXED                            00570002
                  RECORD KEY      IS K025-KEY-FLD                       00580002
                  FILE STATUS     IS WS-K025-STATUS.                    00590002
                                                                        00600002
           SELECT P13L148A ASSIGN TO P13L148A.                          00610002
                                                                        00620002
       DATA DIVISION.                                                   00630002
       FILE SECTION.                                                    00640002
                                                                        00650002
       COPY SY02F001.                                                   00660002
                                                                        00670002
       FD   BP13F800                                                    00680002
            RECORDING MODE    F                                         00690002
            BLOCK CONTAINS    0 RECORDS                                 00700002
            LABEL RECORDS   ARE STANDARD                                00710002
            RECORD CONTAINS 2000 CHARACTERS.                            00720002
       COPY BP13F800.                                                   00730002
                                                                        00740002
       FD   BP13K022                                                    00750002
            RECORD CONTAINS 100 CHARACTERS.                             00760002
       COPY BP13K022.                                                   00770002
                                                                        00780002
       FD   BP13KB25                                                    00790002
            RECORD CONTAINS 3400 CHARACTERS.                            00800002
       COPY BP13KB25.                                                   00810002
                                                                        00820002
       FD   BP13K025                                                    00830002
            RECORD CONTAINS 100 CHARACTERS.                             00840002
       COPY BP13K025.                                                   00850002
                                                                        00860002
       FD   P13L148A                                                    00870002
            RECORD CONTAINS 132 CHARACTERS                              00880002
            RECORDING MODE  IS F.                                       00890002
       01   P13L148A-REC    PIC X(132).                                 00900002
                                                                        00910002
                                                                        00920002
       WORKING-STORAGE SECTION.                                         00930002
                                                                        00940002
       01  WS-FILE-CONTROLS.                                            00950002
           05  WS-F800-EOF-SW                 PIC X(1)  VALUE 'N'.      00960002
           05  WS-K022-EOF-SW                 PIC X(1)  VALUE 'N'.      00970002
           05  WS-KB25-EOF-SW                 PIC X(1)  VALUE 'N'.      00980002
           05  WS-K025-EOF-SW                 PIC X(1)  VALUE 'N'.      00990002
           05  WS-K022-STATUS                 PIC 9(2)  VALUE 0.        01000002
           05  WS-KB25-STATUS                 PIC 9(2)  VALUE 0.        01010002
           05  WS-K025-STATUS                 PIC 9(2)  VALUE 0.        01020002
           05  WS-CNT-READ-F800               PIC 9(6)  VALUE ZEROS.    01030002
           05  WS-CNT-WRIT-L148               PIC 9(6)  VALUE ZEROS.    01040002
           05  WS-WALK-IN                     PIC 9(6)  VALUE ZEROS.    01050002
           05  WS-ERR-DEL-KB25                PIC 9(6)  VALUE ZEROS.    01060002
           05  WS-ERR-WRT-KB25                PIC 9(6)  VALUE ZEROS.    01070002
           05  WS-ERR-READ-KB25               PIC 9(6)  VALUE ZEROS.    01080002
                                                                        01090002
       01  WS-L148-CONTROLS.                                            01100002
           05  WS-L148-LINECTR-A              PIC 9(2)  VALUE 60.       01110002
           05  WS-L148-PAGECTR-A              PIC 9(5)  VALUE ZEROS.    01120002
           05  WS-L148-SNO-A                  PIC 9(5)  VALUE 0.        01130002
                                                                        01140002
       01  WS-MISCELLANEOUS-VARS.                                       01150002
           05  WS-BLANK-LINE                  PIC X(132) VALUE SPACES.  01160002
           05  WS-REGN-ALLOC-CTR              PIC 9(6)  VALUE ZEROS.    01170002
           05  WS-PREV-OIC                    PIC X(5).                 01180002
           05  WS-ALLO-CAT-PREV               PIC X(1).                 01190002
           05  WS-CNT                         PIC 9(3)  VALUE 0.        01200002
           05  WS-SKIP                        PIC 9(1)  VALUE 0.        01210002
           05  WS-FLAG                        PIC X(1)  VALUE 'N'.      01220002
           05  WS-DONE                        PIC X(1)  VALUE 'N'.      01230002
           05  WS-READ-FLAG-BL                PIC X(1)  VALUE 'N'.      01240002
           05  WS-FOUND                       PIC X(1)  VALUE 'N'.      01250002
           05  WS-KB25-FND                    PIC X(1)  VALUE 'N'.      01251002
               88  KB25-FND                             VALUE 'Y'.      01252002
           05  WS-F800-PRJCT                  PIC X(3)  VALUE SPACES.   01253002
                                                                        01260002
       01  WS-TIME-DATES.                                               01270002
           05  WS-SYSTEM-DATE.                                          01280002
               10  WS-SYS-CCYY.                                         01290002
                   15  WS-SYS-CC              PIC 9(2).                 01300002
                   15  WS-SYS-YY              PIC 9(2).                 01310002
               10  WS-SYS-MM                  PIC 9(2).                 01320002
               10  WS-SYS-DD                  PIC 9(2).                 01330002
                                                                        01340002
           05  WS-EDITED-DATE.                                          01350002
               10  WS-EDITED-DD               PIC 9(2).                 01360002
               10  FILLER                     PIC X(1)  VALUE '/'.      01370002
               10  WS-EDITED-MM               PIC 9(2).                 01380002
               10  FILLER                     PIC X(1)  VALUE '/'.      01390002
               10  WS-EDITED-YY               PIC 9(4).                 01400002
                                                                        01410002
                                                                        01420002
      *============================================================*    01430002
      *         BP13L148  -  R E P O R T    L A Y O U T            *    01440002
      *============================================================*    01450002
                                                                        01460002
       01  L148-HEADER-1A.                                              01470002
           05  FILLER              PIC X(08)     VALUE 'P13L148A'.      01480002
           05  FILLER              PIC X(04)     VALUE SPACES.          01490002
           05  FILLER              PIC X(08)     VALUE 'HDBCAT 3'.      01500002
           05  FILLER              PIC X(25)     VALUE SPACES.          01510002
           05  FILLER              PIC X(41)     VALUE                  01520002
               'S Y S T E M    O F    C O M M I T M E N T'.             01530002
           05  FILLER              PIC X(12)     VALUE SPACES.          01540002
           05  FILLER              PIC X(07)     VALUE 'DATE :'.        01550002
           05  L148-RUN-DATE-A     PIC X(10)     VALUE SPACES.          01560002
           05  FILLER              PIC X(02)     VALUE SPACES.          01570002
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.       01580002
           05  L148-PAGE-NO-A      PIC ZZZZ9 .                          01590002
                                                                        01600002
       01  L148-HEADER-2A.                                              01610002
           05  FILLER              PIC X(41)     VALUE SPACES.          01620002
           05  FILLER              PIC X(55)     VALUE                  01630002
           '        REPORT ON CASES ASSIGNED TO OIC          '.         01640002
                                                                        01650002
                                                                        01660002
       01  L148-HEADER-03.                                              01670002
           05  FILLER              PIC X(05)     VALUE SPACES.          01680002
           05  FILLER              PIC X(05)     VALUE ' S/N '.         01690002
           05  FILLER              PIC X(03)     VALUE SPACES.          01700002
           05  FILLER              PIC X(03)     VALUE 'NT '.           01710002
           05  FILLER              PIC X(03)     VALUE SPACES.          01720002
           05  FILLER              PIC X(04)     VALUE 'ZONE'.          01730002
           05  FILLER              PIC X(03)     VALUE SPACES.          01740002
           05  FILLER              PIC X(03)     VALUE 'FT '.           01750002
           05  FILLER              PIC X(03)     VALUE SPACES.          01760002
           05  FILLER              PIC X(08)     VALUE 'REGNO   '.      01770002
           05  FILLER              PIC X(03)     VALUE SPACES.          01780002
           05  FILLER              PIC X(10)     VALUE 'REGN DATE '.    01790002
           05  FILLER              PIC X(03)     VALUE SPACES.          01800002
           05  FILLER              PIC X(05)     VALUE 'OIC  '.         01810002
           05  FILLER              PIC X(03)     VALUE SPACES.          01820002
           05  FILLER              PIC X(30)     VALUE 'OIC NAME'.      01830002
           05  FILLER              PIC X(05)     VALUE SPACES.          01840002
           05  FILLER              PIC X(10)     VALUE 'ALLOC CAT'.     01850002
           05  FILLER              PIC X(05)     VALUE SPACES.          01860002
           05  FILLER              PIC X(09)     VALUE 'LOAN TAG'.      01870002
                                                                        01880002
       01  L148-HEADER-04.                                              01890002
           05  FILLER              PIC X(130)    VALUE ALL '-'.         01900002
                                                                        01910002
       01  L148-DETAIL.                                                 01920002
           05  FILLER              PIC X(05)     VALUE SPACES.          01930002
           05  L148-SNO            PIC ZZZZ9.                           01940002
           05  FILLER              PIC X(03)     VALUE SPACES.          01950002
           05  L148-NT             PIC X(03).                           01960002
           05  FILLER              PIC X(03)     VALUE SPACES.          01970002
           05  L148-ZONE           PIC X(04).                           01980002
           05  FILLER              PIC X(03)     VALUE SPACES.          01990002
           05  L148-FT             PIC X(03).                           02000002
           05  FILLER              PIC X(03)     VALUE SPACES.          02010002
           05  L148-REGNO          PIC X(08).                           02020002
           05  FILLER              PIC X(03)     VALUE SPACES.          02030002
           05  L148-DTE-REGN       PIC X(10).                           02040002
           05  FILLER              PIC X(03)     VALUE SPACES.          02050002
           05  L148-OIC            PIC X(05).                           02060002
           05  FILLER              PIC X(03)     VALUE SPACES.          02070002
           05  L148-NME-OIC        PIC X(30).                           02080002
           05  FILLER              PIC X(05)     VALUE SPACES.          02090002
           05  L148-ALLO-CAT       PIC X(03).                           02100002
           05  FILLER              PIC X(12)     VALUE SPACES.          02110002
           05  L148-LOAN-TAG       PIC X(03).                           02120002
                                                                        02130002
      ****************************************************************  02140002
       PROCEDURE DIVISION.                                              02150002
      ****************************************************************  02160002
       0000-MAIN-ROUTINE.                                               02170002
      ****************************************************************  02180002
                                                                        02190002
           PERFORM 1000-OPEN-ROUTINE      THRU 1000-EXIT.               02200002
                                                                        02210002
           PERFORM 3000-PROCESS-F800      THRU 3000-EXIT                02220002
                  UNTIL WS-F800-EOF-SW = 'Y'.                           02230002
                                                                        02240002
           PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT.               02250002
                                                                        02260002
       0000-EXIT.                                                       02270002
           EXIT.                                                        02280002
                                                                        02290002
      ****************************************************************  02300002
       1000-OPEN-ROUTINE.                                               02310002
      ****************************************************************  02320002
                                                                        02330002
           OPEN INPUT  BP13F800                                         02340002
                       SY02F001                                         02350002
                I-O    BP13K022                                         02360002
                       BP13K025                                         02370002
                       BP13KB25                                         02380002
                OUTPUT P13L148A.                                        02390002
                                                                        02400002
           IF WS-K022-STATUS NOT = 00 AND 97                            02410002
              DISPLAY 'BP13K022 OPEN ERROR, STATUS IS ' WS-K022-STATUS  02420002
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             02430002
           END-IF.                                                      02440002
                                                                        02450002
           IF WS-KB25-STATUS NOT = 00 AND 97                            02460002
              DISPLAY 'BP13KB25 OPEN ERROR, STATUS IS ' WS-KB25-STATUS  02470002
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             02480002
           END-IF.                                                      02490002
                                                                        02500002
           IF WS-K025-STATUS NOT = 00 AND 97                            02510002
              DISPLAY 'BP13K025 OPEN ERROR, STATUS IS ' WS-K025-STATUS  02520002
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             02530002
           END-IF.                                                      02540002
                                                                        02550002
           PERFORM 1500-READ-SY02F001 THRU 1500-EXIT.                   02560002
           MOVE FUNCTION CURRENT-DATE(1:8)  TO  WS-SYSTEM-DATE.         02570002
           MOVE   WS-SYS-DD           TO WS-EDITED-DD.                  02580002
           MOVE   WS-SYS-MM           TO WS-EDITED-MM.                  02590002
           MOVE   WS-SYS-CCYY         TO WS-EDITED-YY.                  02600002
           MOVE   WS-EDITED-DATE      TO L148-RUN-DATE-A.               02610002
                                                                        02620002
       1000-EXIT.                                                       02630002
           EXIT.                                                        02640002
                                                                        02650002
      ******************************************************************02660002
        1500-READ-SY02F001.                                             02670002
      ******************************************************************02680002
                                                                        02690002
            READ SY02F001.                                              02700002
                                                                        02710002
        1500-EXIT.                                                      02720002
            EXIT.                                                       02730002
                                                                        02740002
      ****************************************************************  02750002
       2000-READ-F800.                                                  02760002
      ****************************************************************  02770002
                                                                        02780002
           READ BP13F800                                                02790002
              AT END MOVE 'Y' TO WS-F800-EOF-SW                         02800002
              GO TO 3000-EXIT                                           02810002
           END-READ.                                                    02820002
                                                                        02830002
           ADD  +1                TO WS-CNT-READ-F800.                  02840002
                                                                        02850002
           MOVE 'N'               TO WS-FOUND.                          02860002
                                                                        02870002
           PERFORM 2100-READ-K021 THRU 2100-EXIT.                       02880002
                                                                        02890002
           IF WS-FOUND = 'Y'                                            02900002
              CONTINUE                                                  02910002
           ELSE                                                         02920002
              ADD 1 TO WS-WALK-IN                                       02930002
           END-IF.                                                      02940002
                                                                        02950002
       2000-EXIT.                                                       02960002
           EXIT.                                                        02970002
                                                                        02980002
      ****************************************************************  02990002
       2100-READ-K021.                                                  03000002
      ****************************************************************  03010002
                                                                        03020002
           MOVE LOW-VALUES           TO K022-KEY-FLD.                   03030002
           MOVE F800-NUM-REGN        TO K022-NUM-REGN.                  03040002
                                                                        03050002
           START BP13K022 KEY >= K022-NUM-REGN.                         03060002
                                                                        03070002
           IF WS-K022-STATUS = 00 OR 02                                 03080002
              READ BP13K022 NEXT RECORD                                 03090002
              IF WS-K022-STATUS = 00 OR 02                              03100002
                 IF  (K022-NUM-REGN = F800-NUM-REGN)                    03110002
                    MOVE 'Y' TO WS-FOUND                                03120002
                 ELSE                                                   03130002
                    MOVE 'N' TO WS-FOUND                                03140002
                 END-IF                                                 03150002
              END-IF                                                    03160002
           ELSE                                                         03170002
           IF WS-K022-STATUS = 23                                       03180002
              MOVE 'N' TO WS-FOUND                                      03190002
           ELSE                                                         03200002
              DISPLAY 'ERROR WITH START READ OF BP13K022. STATUS IS '   03210002
                       WS-K022-STATUS                                   03220002
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             03230002
           END-IF.                                                      03240002
                                                                        03250002
       2100-EXIT.                                                       03260002
           EXIT.                                                        03270002
                                                                        03280002
      ****************************************************************  03290002
       2500-READ-K025.                                                  03300002
      ****************************************************************  03310002
                                                                        03320002
           MOVE  LOW-VALUES   TO K025-KEY-FLD.                          03330002
           MOVE  SPACES       TO WS-F800-PRJCT.                         03331002
           IF F800-NUM-ALLO-CAT = 'DBS' OR 'EC ' OR 'NPL'               03332002
              MOVE F800-NUM-ALLO-CAT     TO WS-F800-PRJCT               03333002
           ELSE                                                         03334002
              EVALUATE F800-NUM-REGN(1:1)                               03335002
              WHEN '5'                                                  03336002
                   MOVE 'DBS'            TO WS-F800-PRJCT               03337002
              WHEN '6'                                                  03337102
                   MOVE 'EC '            TO WS-F800-PRJCT               03337202
              WHEN '2'                                                  03337302
              WHEN '3'                                                  03337402
                   MOVE 'NPL'            TO WS-F800-PRJCT               03337502
              END-EVALUATE                                              03338002
           END-IF.                                                      03339002
           MOVE  WS-F800-PRJCT           TO K025-NUM-PRJCT.             03340002
           MOVE  'N'          TO WS-FLAG.                               03350002
           START BP13K025 KEY >  K025-KEY-FLD.                          03360002
                                                                        03370002
           IF WS-K025-STATUS = 00                                       03380002
              PERFORM UNTIL WS-FLAG = 'Y'                               03390002
                 READ BP13K025 NEXT RECORD                              03400002
                      AT END MOVE 'Y' TO WS-FLAG                        03410002
                 END-READ                                               03420002
                 IF WS-K025-STATUS = 00 AND                             03430002
                    K025-NUM-PRJCT = WS-F800-PRJCT                      03440002
                    IF K025-CDE-LAST-REC-BL = 'Y'                       03450002
                       MOVE 'N'                TO K025-CDE-LAST-REC-BL  03460002
                       PERFORM 5100-REWRITE-K025  THRU 5100-EXIT        03470002
                       MOVE 'Y' TO WS-FLAG                              03480002
                    END-IF                                              03490002
                 ELSE                                                   03500002
                    DISPLAY 'ERROR READING CURRENT OIC IN BP13K025'     03510002
                    MOVE 99                      TO RETURN-CODE         03520002
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT           03530002
                 END-IF                                                 03540002
              END-PERFORM                                               03550002
           ELSE                                                         03560002
              DISPLAY 'ERROR WITH START READ OF BP13K025. STATUS IS '   03570002
                       WS-K025-STATUS                                   03580002
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             03590002
           END-IF.                                                      03600002
                                                                        03610002
       2500-EXIT.                                                       03620002
           EXIT.                                                        03630002
                                                                        03640002
      ****************************************************************  03650002
       3000-PROCESS-F800.                                               03660002
      ****************************************************************  03670002
                                                                        03680002
           PERFORM 2000-READ-F800    THRU 2000-EXIT.                    03690002
           PERFORM 3100-PROCESS-BANKLOAN  THRU 3100-EXIT.               03700002
                                                                        03710002
       3000-EXIT.                                                       03720002
           EXIT.                                                        03730002
                                                                        03740002
      ****************************************************************  03750002
       3100-PROCESS-BANKLOAN.                                           03760002
      ****************************************************************  03770002
                                                                        03780002
           MOVE 'N'                   TO WS-KB25-FND                    03781002
           IF WS-FOUND = 'Y'                                            03790002
             PERFORM 5300-READ-KB25  THRU 5300-EXIT                     03800002
           END-IF.                                                      03810002
           PERFORM 2500-READ-K025  THRU 2500-EXIT.                      03820002
                                                                        03830002
           MOVE  0                    TO WS-CNT.                        03840002
           MOVE 'N'                   TO WS-FLAG.                       03850002
                                                                        03860002
           PERFORM UNTIL WS-FLAG = 'Y'                                  03870002
           PERFORM 4500-READNEXT-K025  THRU 4500-EXIT                   03880002
              IF WS-K025-EOF-SW = 'Y'                                   03890002
                 ADD 1                    TO WS-CNT                     03900002
                 MOVE  LOW-VALUES   TO K025-KEY-FLD                     03910002
                 MOVE  WS-F800-PRJCT        TO K025-NUM-PRJCT           03920002
                 START BP13K025 KEY >  K025-KEY-FLD                     03930002
                 PERFORM 4500-READNEXT-K025  THRU 4500-EXIT             03940002
                 MOVE  'N'          TO WS-K025-EOF-SW                   03950002
                 IF WS-DONE = 'Y'                                       03960002
                    MOVE  'N'          TO WS-DONE                       03970002
                    WRITE P13L148A-REC    FROM WS-BLANK-LINE            03980002
                    ADD 1                 TO WS-L148-LINECTR-A          03990002
                 END-IF                                                 04000002
              END-IF                                                    04010002
              IF K025-CDE-BLOCK NOT = 'Y'                               04020002
                 IF K025-NUM-RATIO = K025-NUM-CUR-CNT                   04030002
                    SUBTRACT K025-NUM-RATIO FROM K025-NUM-MAX-CNT       04040002
                             GIVING WS-SKIP                             04050002
                    IF WS-SKIP <= K025-NUM-SKIP                         04060002
                       MOVE 1                     TO K025-NUM-CUR-CNT   04070002
                       MOVE ZEROES                TO K025-NUM-SKIP      04080002
                       MOVE 'Y'           TO K025-CDE-LAST-REC-BL       04090002
                       PERFORM 5100-REWRITE-K025  THRU 5100-EXIT        04100002
                       IF WS-FOUND = 'Y'                                04110002
                       PERFORM 5050-DELETE-K022   THRU 5050-EXIT        04120002
                       END-IF                                           04130002
                       PERFORM 5000-WRITE-K022    THRU 5000-EXIT        04140002
                       IF KB25-FND                                      04150002
                          PERFORM 5250-DELETE-KB25 THRU 5250-EXIT       04160002
                          PERFORM 5200-WRITE-KB25 THRU 5200-EXIT        04170002
                       END-IF                                           04180002
                       MOVE 'Y'                   TO WS-FLAG            04190002
                       MOVE 'Y'                   TO WS-DONE            04200002
                    ELSE                                                04210002
                       ADD  1                     TO K025-NUM-SKIP      04220002
                       PERFORM 5100-REWRITE-K025  THRU 5100-EXIT        04230002
                    END-IF                                              04240002
                 ELSE                                                   04250002
                    ADD   1                    TO K025-NUM-CUR-CNT      04260002
                    MOVE 'Y'              TO K025-CDE-LAST-REC-BL       04270002
                    IF WS-FOUND = 'Y'                                   04280002
                    PERFORM 5050-DELETE-K022   THRU 5050-EXIT           04290002
                    END-IF                                              04300002
                    PERFORM 5000-WRITE-K022    THRU 5000-EXIT           04310002
                    PERFORM 5100-REWRITE-K025  THRU 5100-EXIT           04320002
                    IF KB25-FND                                         04331002
                       PERFORM 5250-DELETE-KB25 THRU 5250-EXIT          04340002
                       PERFORM 5200-WRITE-KB25 THRU 5200-EXIT           04350002
                    END-IF                                              04360002
                    MOVE 'Y'                   TO WS-FLAG               04370002
                    MOVE 'Y'                   TO WS-DONE               04380002
                 END-IF                                                 04390002
              END-IF                                                    04400002
              IF WS-CNT > 1                                             04410002
                 MOVE 'Y'                         TO WS-FLAG            04420002
              END-IF                                                    04430002
           END-PERFORM.                                                 04440002
                                                                        04450002
           IF WS-CNT > 1                                                04460002
              DISPLAY 'ERROR: ALL OIC''S MARKED AS BLOCK.'              04470002
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                 04480002
           END-IF.                                                      04490002
                                                                        04500002
       3100-EXIT.                                                       04510002
           EXIT.                                                        04520002
                                                                        04530002
                                                                        04540002
      ****************************************************************  04550002
       4500-READNEXT-K025.                                              04560002
      ****************************************************************  04570002
                                                                        04580002
            READ BP13K025 NEXT RECORD                                   04590002
               AT END MOVE 'Y' TO WS-K025-EOF-SW                        04600002
               GO TO 4500-EXIT                                          04610002
            END-READ.                                                   04620002
                                                                        04630002
            IF WS-K025-STATUS = 00                                      04640002
               IF K025-NUM-PRJCT = WS-F800-PRJCT                        04650002
                  CONTINUE                                              04660002
               ELSE                                                     04670002
                  MOVE 'Y'                    TO WS-K025-EOF-SW         04680002
               END-IF                                                   04690002
            ELSE                                                        04700002
            IF WS-K025-STATUS = 46                                      04710002
               MOVE 'Y'                       TO WS-K025-EOF-SW         04720002
            ELSE                                                        04730002
               DISPLAY 'ERROR READING BP13K025. STATUS IS '             04740002
                        WS-K025-STATUS                                  04750002
               PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT            04760002
            END-IF.                                                     04770002
                                                                        04780002
       4500-EXIT.                                                       04790002
           EXIT.                                                        04800002
                                                                        04810002
      ****************************************************************  04820002
       5000-WRITE-K022.                                                 04830002
      ****************************************************************  04840002
                                                                        04850002
            MOVE SPACES                    TO BP13K022-REC.             04851002
            INITIALIZE                        BP13K022-REC.             04852002
                                                                        04853002
            MOVE K025-NUM-OIC              TO K022-NUM-OIC.             04860002
            MOVE F800-NUM-REGN             TO K022-NUM-REGN.            04870002
            MOVE F800-NUM-ALLO-CAT         TO K022-CDE-ALLO-CAT.        04880002
            MOVE F800-NUM-LOAN-TAG         TO K022-CDE-BANKLOAN.        04890002
            MOVE 'BP13C148'                TO K022-NUM-USERID           04900002
            MOVE WS-SYSTEM-DATE            TO K022-DTE-UPDATE.          04910002
                                                                        04920002
            WRITE BP13K022-REC.                                         04930002
                                                                        04940002
            EVALUATE WS-K022-STATUS                                     04950002
            WHEN 00                                                     04960002
               ADD 1 TO WS-REGN-ALLOC-CTR                               04970002
            WHEN OTHER                                                  04980002
               DISPLAY 'ERROR WRITING BP13K022. STATUS IS '             04990002
                        WS-K022-STATUS                                  05000002
               PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT               05010002
            END-EVALUATE.                                               05020002
                                                                        05030002
            PERFORM 8000-PRINT-RPT-A    THRU 8000-EXIT.                 05040002
                                                                        05050002
       5000-EXIT.                                                       05060002
           EXIT.                                                        05070002
                                                                        05080002
      ****************************************************************  05090002
       5050-DELETE-K022.                                                05100002
      ****************************************************************  05110002
                                                                        05120002
            DELETE BP13K022.                                            05130002
                                                                        05140002
            EVALUATE WS-K022-STATUS                                     05150002
               WHEN 00                                                  05160002
               WHEN 97                                                  05170002
                  CONTINUE                                              05180002
               WHEN OTHER                                               05190002
                  DISPLAY 'ERROR DELETING BP13K022. STATUS IS '         05200002
                           WS-K022-STATUS                               05210002
                  PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT            05220002
            END-EVALUATE.                                               05230002
                                                                        05240002
       5050-EXIT.                                                       05250002
           EXIT.                                                        05260002
                                                                        05270002
      ****************************************************************  05280002
       5100-REWRITE-K025.                                               05290002
      ****************************************************************  05300002
                                                                        05310002
            MOVE 'BP13C148'            TO K025-NUM-USERID.              05320002
            MOVE WS-SYSTEM-DATE        TO K025-DTE-UPDATE.              05330002
                                                                        05340002
            REWRITE BP13K025-REC.                                       05350002
                                                                        05360002
            EVALUATE WS-K025-STATUS                                     05370002
            WHEN 00                                                     05380002
               CONTINUE                                                 05390002
            WHEN OTHER                                                  05400002
               DISPLAY 'ERROR WRITING BP13K025. STATUS IS '             05410002
                        WS-K025-STATUS                                  05420002
               PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT            05430002
            END-EVALUATE.                                               05440002
                                                                        05450002
       5100-EXIT.                                                       05460002
           EXIT.                                                        05470002
                                                                        05480002
      ****************************************************************  05490002
       5200-WRITE-KB25.                                                 05500002
      ****************************************************************  05510002
                                                                        05520002
            MOVE K025-NUM-OIC              TO KB25-NUM-OIC.             05530002
                                                                        05540002
            WRITE BP13KB25-REC.                                         05550002
                                                                        05560002
            EVALUATE WS-KB25-STATUS                                     05570002
            WHEN 00                                                     05580002
               CONTINUE                                                 05590002
            WHEN OTHER                                                  05600002
               DISPLAY 'ERROR WRITING BP13KB25. STATUS IS '             05610002
                        WS-KB25-STATUS                                  05620002
               DISPLAY '-KB25-KEY : ' KB25-KEY-FLD                      05630002
               ADD 1 TO WS-ERR-WRT-KB25                                 05640002
      *        PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT               05650002
            END-EVALUATE.                                               05660002
                                                                        05670002
       5200-EXIT.                                                       05680002
           EXIT.                                                        05690002
                                                                        05700002
      ****************************************************************  05710002
       5250-DELETE-KB25.                                                05720002
      ****************************************************************  05730002
                                                                        05740002
            DELETE BP13KB25.                                            05750002
                                                                        05760002
            EVALUATE WS-KB25-STATUS                                     05770002
               WHEN 00                                                  05780002
               WHEN 97                                                  05790002
                  CONTINUE                                              05800002
               WHEN OTHER                                               05810002
                  DISPLAY 'ERROR DELETING BP13KB25. STATUS IS '         05820002
                           WS-KB25-STATUS                               05830002
                  DISPLAY '-KB25-KEY : ' KB25-KEY-FLD                   05840002
                  ADD 1 TO WS-ERR-DEL-KB25                              05850002
      *           PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT            05860002
            END-EVALUATE.                                               05870002
                                                                        05880002
       5250-EXIT.                                                       05890002
           EXIT.                                                        05900002
                                                                        05910002
      ****************************************************************  05920002
       5300-READ-KB25.                                                  05930002
      ****************************************************************  05940002
                                                                        05950002
           MOVE  SPACES       TO KB25-KEY-FLD.                          05960002
           MOVE K022-NUM-OIC  TO KB25-NUM-OIC.                          05970002
           MOVE K022-NUM-REGN TO KB25-NUM-REGN.                         05980002
                                                                        05990002
           READ BP13KB25 KEY IS KB25-ALT-KEY.                           06000002
                                                                        06010002
           IF WS-KB25-STATUS = 00                                       06020002
              MOVE 'Y'                         TO WS-KB25-FND           06030002
           ELSE                                                         06040002
              IF WS-KB25-STATUS = 23                                    06041002
                 MOVE 'N'                      TO WS-KB25-FND           06042002
              ELSE                                                      06043002
                 DISPLAY 'ERROR WITH START READ OF BP13KB25. STATUS IS '06050002
                          WS-KB25-STATUS                                06060002
                 DISPLAY 'REGN NO : ' KB25-NUM-REGN ' ' KB25-NUM-OIC    06070002
                 DISPLAY '-KB25-KEY : ' KB25-KEY-FLD                    06080002
                 ADD 1 TO WS-ERR-READ-KB25                              06090002
      *          PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT          06100002
              END-IF                                                    06101002
           END-IF.                                                      06110002
                                                                        06120002
       5300-EXIT.                                                       06130002
           EXIT.                                                        06140002
                                                                        06150002
      ****************************************************************  06160002
       8000-PRINT-RPT-A.                                                06170002
      ****************************************************************  06180002
                                                                        06190002
           ADD  1                             TO WS-L148-SNO-A.         06200002
           MOVE WS-L148-SNO-A                 TO L148-SNO.              06210002
                                                                        06220002
           PERFORM 8500-MOVE-VALUES     THRU 8500-EXIT.                 06230002
                                                                        06240002
           IF WS-L148-LINECTR-A >= 55                                   06250002
              ADD                   1   TO WS-L148-PAGECTR-A            06260002
              MOVE WS-L148-PAGECTR-A    TO L148-PAGE-NO-A               06270002
              WRITE P13L148A-REC    FROM L148-HEADER-1A  AFTER PAGE     06280002
              WRITE P13L148A-REC    FROM L148-HEADER-2A                 06290002
              WRITE P13L148A-REC    FROM L148-HEADER-03  AFTER 2        06300002
              WRITE P13L148A-REC    FROM L148-HEADER-04                 06310002
              WRITE P13L148A-REC    FROM L148-DETAIL                    06320002
              MOVE                  6 TO WS-L148-LINECTR-A              06330002
           ELSE                                                         06340002
              ADD                   1 TO WS-L148-LINECTR-A              06350002
              WRITE P13L148A-REC    FROM L148-DETAIL                    06360002
           END-IF.                                                      06370002
                                                                        06380002
           ADD 1                    TO WS-CNT-WRIT-L148.                06390002
                                                                        06400002
       8000-EXIT.                                                       06410002
           EXIT.                                                        06420002
                                                                        06430002
      ****************************************************************  06440002
       8500-MOVE-VALUES.                                                06450002
      ****************************************************************  06460002
                                                                        06470002
           MOVE F800-NUM-NEW-TOWN             TO L148-NT.               06480002
           MOVE F800-NUM-ZONE                 TO L148-ZONE              06490002
           MOVE F800-NUM-FLAT-TYPE            TO L148-FT.               06500002
           STRING F800-DTE-REGN(7:2) '/'                                06510002
                  F800-DTE-REGN(5:2) '/'                                06520002
                  F800-DTE-REGN(1:4)                                    06530002
                  DELIMITED BY SIZE         INTO L148-DTE-REGN.         06540002
           MOVE F800-NUM-REGN                 TO L148-REGNO.            06550002
           MOVE K022-NUM-OIC                  TO L148-OIC.              06560002
           MOVE K025-NME-OIC                  TO L148-NME-OIC.          06570002
           MOVE F800-NUM-ALLO-CAT             TO L148-ALLO-CAT.         06580002
           MOVE F800-NUM-LOAN-TAG             TO L148-LOAN-TAG.         06590002
                                                                        06600002
       8500-EXIT.                                                       06610002
           EXIT.                                                        06620002
                                                                        06630002
      ****************************************************************  06640002
       9999-CLOSE-ROUTINE.                                              06650002
      ****************************************************************  06660002
                                                                        06670002
           CLOSE BP13F800                                               06680002
                 BP13K025                                               06690002
                 BP13KB25                                               06700002
                 SY02F001                                               06710002
                 BP13K022                                               06720002
                 P13L148A.                                              06730002
                                                                        06740002
           DISPLAY SPACES.                                              06750002
           DISPLAY '*===========BP13C148 CONTROL TOTALS============*'.  06760002
           DISPLAY SPACES.                                              06770002
           DISPLAY 'BP13F800 RECORDS READ        = ' WS-CNT-READ-F800.  06780002
           DISPLAY 'NO OF REGNO ALLOCATED TO OIC = ' WS-REGN-ALLOC-CTR. 06790002
           DISPLAY SPACES.                                              06800002
           DISPLAY 'NO OF WALK-IN CASES          = ' WS-WALK-IN.        06810002
           DISPLAY 'NO OF ERROR CASES WRITE KB25 = ' WS-ERR-WRT-KB25.   06820002
           DISPLAY 'NO OF ERROR CASES DELETE KB25 = ' WS-ERR-DEL-KB25.  06830002
           DISPLAY 'NO OF ERROR CASES READ  KB25 = ' WS-ERR-READ-KB25.  06840002
           DISPLAY SPACES.                                              06850002
           DISPLAY '*==============================================*'.  06860002
                                                                        06870002
           STOP RUN.                                                    06880002
       9999-EXIT.                                                       06890002
           EXIT.                                                        06900002
