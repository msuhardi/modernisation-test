       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C119.                                                 
       AUTHOR.        NPK.                                                      
       DATE-WRITTEN.  10/01/90.                                                 
      *REMARKS.                                                                 
      * ====================================================== *                
      *                                                        *                
      *   PROGRAM TO PRINT OUT THE TOTAL BOOKING FEE , TOTAL   *                
      *   COMMITMENT DEPOSIT AND TOTAL SOC DEBTOR FOR 'E'      *                
      *   TYPE OF ROOM AND OTHER ROOM TYPES TO F900 FOR        *                
      *   THE PROCESSING OF ACCOUNTING BY ACTIVITY.            *                
      *                                                        *                
      *     INPUT FILE:                                        *                
      *           1. BP13K800                                  *                
      *     I-O   1. BP13K160                                  *                
      *     OUTPUT FILE :                                      *                
      *           1. BP13F900                                  *                
      *                                                        *                
      *   REF      DATE      BY    DESCRIPTIONS                *                
      *   -------  --------  ----  ------------                *                
      *   SOC-PH8B 15/07/93  KPS   UPD BP13K800 INSTEAD OF RFF *                
      *                            AND EXPAND REGN AND NRIC NO *                
      *   I920718  210793    LJL   TO CONVERT TO COBOL2.       *                
      *   C9307A1  210793    LJL   TO EXPAND THE GRAND TOTAL   *                
      *                            FROM S9(9)V99 TO S9(11)V99. *                
      * BP130103   210396    LJL   TO CATER FOR SUB-TRANSFER   *                
      *                            MODULE.                     *                
      * BP130207   291096    LJL   TO EXPAND PIC S9(9)V99 TO   *                
      *                            S9(11)V99 TO CATER FOR BILLIONS.             
      * BP130320   280697    LJL   TO CATER FOR REGISTRATION   *                
      *                            DEPOSIT.                    *                
      * BP130418   250898    RHB   TO CATER FOR Y2000.         *                
      * BP132440   051103    MALC  FOR GRAND-TOTAL IF DEBTOR   *                
      *                            > ZEROES SUBTRACT ELSE ADD  *                
      * BP134034   041110    ESA1  CATER FOR NEW ERP GL ACCOUNT*                
      * BP134034   100211    ESD1  CATER FOR INTERFACE FILE TO ERP              
      * BP134034   050511    DW5   CHANGE ACT CDE 21 TO 20     *                
      * ====================================================== *                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K800  ASSIGN TO BP13K800                                  
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE IS SEQUENTIAL                                     
                  RECORD KEY IS K800-NUM-REGN                                   
                  FILE STATUS IS K800-STATUS.                                   
                                                                                
           SELECT BP13K885  ASSIGN TO BP13K885                                  
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE IS SEQUENTIAL                                     
                  RECORD KEY IS K885-KEY-FLD                                    
                  FILE STATUS IS K885-STATUS.                                   
                                                                                
           SELECT BP13K160   ASSIGN TO BP13K160                                 
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE IS DYNAMIC                                        
                  RECORD KEY IS K160-KEY-FLD                                    
                  FILE STATUS IS K160-STATUS.                                   
                                                                                
           SELECT AG20F900  ASSIGN TO AG20F900.                                 
           SELECT BP13F190  ASSIGN TO BP13F190.                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS                                      
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K885                                                             
           RECORD CONTAINS 400 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K885.                                                           
                                                                                
       FD  BP13K160                                                             
           RECORD CONTAINS 100 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K160.                                                           
                                                                                
       FD  AG20F900                                                             
           RECORD CONTAINS 120 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       COPY AG20F900.                                                           
                                                                                
       FD  BP13F190                                                             
           RECORD CONTAINS 120 CHARACTERS                                       
           BLOCK CONTAINS 0 RECORDS                                             
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       COPY BP13F190.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  WS-EOF.                                                              
           03  WS-EOF-K800             PIC X  VALUE 'N'.                        
           03  WS-EOF-K885             PIC X  VALUE 'N'.                        
           03  WS-EOF-K160             PIC X  VALUE 'N'.                        
       01      WS-TRANS-TYPE           PIC X(2).                                
                                                                                
       01  FILE-STS.                                                            
           05  K800-STATUS             PIC 99  VALUE ZEROS.                     
           05  K885-STATUS             PIC 99  VALUE ZEROS.                     
           05  K160-STATUS             PIC 99  VALUE ZEROS.                     
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-BK-FEE-PA            PIC S9(11)V99 VALUE ZEROS.               
           05  WS-BK-FEE-EX            PIC S9(11)V99 VALUE ZEROS.               
           05  WS-CD-PA                PIC S9(11)V99 VALUE ZEROS.               
           05  WS-CD-EX                PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SUSPENSE-PA          PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SUSPENSE-EX          PIC S9(11)V99 VALUE ZEROS.               
           05  WS-REGN-DEP-PA          PIC S9(11)V99 VALUE ZEROS.               
           05  WS-REGN-DEP-EX          PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SOC-DEBTOR-PA        PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SOC-DEBTOR-EX        PIC S9(11)V99 VALUE ZEROS.               
           05  WS-BK-FEE               PIC S9(11)V99 VALUE ZEROS.               
           05  WS-CD                   PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SUSPENSE             PIC S9(11)V99 VALUE ZEROS.               
           05  WS-REGN-DEP             PIC S9(11)V99 VALUE ZEROS.               
           05  WS-SOC-DEBTOR           PIC S9(11)V99 VALUE ZEROS.               
           05  WS-K160-AMT             PIC S9(11)V99 VALUE ZEROS.               
           05  WS-GRAND-BK             PIC S9(12)V99 VALUE ZEROS.               
           05  WS-GRAND-CD             PIC S9(12)V99 VALUE ZEROS.               
           05  WS-GRAND-SUSPENSE       PIC S9(12)V99 VALUE ZEROS.               
           05  WS-GRAND-REGN-DEP       PIC S9(12)V99 VALUE ZEROS.               
           05  WS-GRAND-SOC            PIC S9(12)V99 VALUE ZEROS.               
           05  WS-GRAND-TOTAL          PIC S9(12)V99 VALUE ZEROS.               
           05  WS-REWRITE              PIC 9(4)     VALUE ZEROS.                
                                                                                
       01  WS-YEAR                        PIC 999.                              
       01  WS-LEAP-YEAR                   PIC 99.                               
       01  WS-ODD-MONTH                   PIC 9.                                
       01  WS-MONTH                       PIC X(2).                             
           88  CHECK-MM            VALUE '04' '06' '09' '11'.                   
           88  CHECK-FEB           VALUE '02'.                                  
                                                                                
       01  WS-EDITED-DATE.                                                      
           03  WS-DD                   PIC 99.                                  
           03  FILLER                  PIC X        VALUE '/'.                  
           03  WS-MM                   PIC 99.                                  
           03  FILLER                  PIC X        VALUE '/'.                  
           03  WS-CC                   PIC 99.                                  
           03  WS-YY                   PIC 99.                                  
                                                                                
       01  WS-CUR-DATE.                                                         
           03  WS-MM                   PIC 99.                                  
           03  FILLER                  PIC X.                                   
           03  WS-DD                   PIC 99.                                  
           03  FILLER                  PIC X.                                   
           03  WS-CC                   PIC 99.                                  
           03  WS-YY                   PIC 99.                                  
                                                                                
      ****************************************************************          
      *    GET K160-DTE-OPEN-BF AS GL TRANS DATE FOR MONTH           *          
      ****************************************************************          
       01  WS-F190-TRANS-DATE.                                                  
           05 WS-F190-TRANS-CCYY         PIC 9(4).                              
           05 WS-F190-TRANS-CCYY-N REDEFINES WS-F190-TRANS-CCYY.                
              10 WS-F190-TRANS-CC            PIC 99.                            
              10 WS-F190-TRANS-YY            PIC 99.                            
           05 WS-F190-TRANS-MM            PIC 99.                               
           05 WS-F190-TRANS-DD            PIC 99.                               
                                                                                
       01  WS-F190-PERIOD                 PIC 99    VALUE ZEROS.                
       01  WS-F191-PERIOD                 PIC 99    VALUE ZEROS.                
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
                                                                                
       000-MAIN-ROUTINE.                                                        
                                                                                
           PERFORM 010-OPEN-FILES      THRU 010-EXIT.                           
           PERFORM 100-START-BP13K800  THRU 100-EXIT.                           
           PERFORM 150-GET-OPEN-DATE   THRU 150-EXIT.                           
           PERFORM 200-READ-K800       THRU 200-EXIT.                           
           PERFORM 300-PROCESS-K800    THRU 300-EXIT                            
                   UNTIL WS-EOF-K800 = 'Y'.                                     
           PERFORM 130-START-BP13K885  THRU 130-EXIT.                           
           PERFORM 150-GET-OPEN-DATE   THRU 150-EXIT.                           
           PERFORM 230-READ-K885       THRU 230-EXIT.                           
           PERFORM 330-PROCESS-K885    THRU 330-EXIT                            
                   UNTIL WS-EOF-K885 = 'Y'.                                     
             DISPLAY  'BF 400-WRITE-F900 '                                      
           PERFORM 400-WRITE-F900      THRU 400-EXIT.                           
             DISPLAY  ' 1 400-WRITE-F900 '                                      
           PERFORM 900-CLOSE-ROUTINE   THRU 900-EXIT.                           
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
       010-OPEN-FILES.                                                          
                                                                                
           OPEN INPUT  BP13K800                                                 
                       BP13K885                                                 
                I-O    BP13K160                                                 
                OUTPUT AG20F900                                                 
                       BP13F190.                                                
                                                                                
           IF K800-STATUS NOT = 0 AND 97                                        
              MOVE K800-STATUS    TO  RETURN-CODE                               
              DISPLAY 'OPENING ERROR K800  ' K800-STATUS                        
              PERFORM 900-CLOSE-ROUTINE   THRU  900-EXIT.                       
                                                                                
           IF K885-STATUS NOT = 0 AND 97                                        
              MOVE K885-STATUS    TO  RETURN-CODE                               
              DISPLAY 'OPENING ERROR K885  ' K885-STATUS                        
              PERFORM 900-CLOSE-ROUTINE   THRU  900-EXIT.                       
                                                                                
           IF K160-STATUS NOT = 0 AND 97                                        
              MOVE K160-STATUS    TO  RETURN-CODE                               
              DISPLAY 'OPENING ERROR K160  ' K160-STATUS                        
              PERFORM 900-CLOSE-ROUTINE   THRU  900-EXIT.                       
                                                                                
       010-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       100-START-BP13K800.                                                      
                                                                                
           MOVE LOW-VALUES TO K800-NUM-REGN.                                    
           START BP13K800 KEY > K800-NUM-REGN                                   
               INVALID KEY                                                      
                    DISPLAY 'START ERROR K800 = ' K800-STATUS                   
                    PERFORM 900-CLOSE-ROUTINE    THRU  900-EXIT.                
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
       130-START-BP13K885.                                                      
                                                                                
           MOVE LOW-VALUES TO K885-NUM-REGN.                                    
           START BP13K885 KEY > K885-KEY-FLD                                    
               INVALID KEY                                                      
                    DISPLAY 'START ERROR K885 = ' K885-STATUS                   
                    PERFORM 900-CLOSE-ROUTINE    THRU  900-EXIT.                
                                                                                
       130-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    READ FILE BP13K160 FOR OPEN BALANCE DATE                   *         
      *****************************************************************         
       150-GET-OPEN-DATE.                                                       
                                                                                
           READ BP13K160  NEXT AT END                                           
                MOVE 'Y' TO WS-EOF-K800                                         
                MOVE 'Y' TO WS-EOF-K885                                         
                GO TO 150-EXIT.                                                 
                                                                                
           IF K160-DTE-OPEN-BF NOT NUMERIC                                      
              GO TO 150-GET-OPEN-DATE                                           
           ELSE                                                                 
              MOVE K160-DTE-OPEN-BF  TO WS-F190-TRANS-DATE.                     
                                                                                
           PERFORM 600-CHK-PERIOD   THRU 600-EXIT.                              
           PERFORM 610-CHK-TRAN-DTE THRU 610-EXIT.                              
                                                                                
                                                                                
       150-EXIT.                                                                
           EXIT.                                                                
                                                                                
       200-READ-K800.                                                           
            READ BP13K800 NEXT AT END                                           
                 MOVE 'Y' TO WS-EOF-K800                                        
                 GO TO 200-EXIT.                                                
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       230-READ-K885.                                                           
            READ BP13K885 NEXT AT END                                           
                 MOVE 'Y' TO WS-EOF-K885                                        
                 GO TO 230-EXIT.                                                
                                                                                
       230-EXIT.                                                                
           EXIT.                                                                
                                                                                
      **************************************************************            
      *   TO CHECK WHETHER THE ROOM TYPE IS EQUAL TO 'E' OR OTHERS *            
      **************************************************************            
                                                                                
       300-PROCESS-K800.                                                        
                                                                                
           PERFORM 350-CHECK-ROOM-TYPE THRU 350-EXIT.                           
           PERFORM 200-READ-K800       THRU 200-EXIT.                           
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       330-PROCESS-K885.                                                        
                                                                                
           PERFORM 380-CHECK-ROOM-TYPE THRU 380-EXIT.                           
           PERFORM 230-READ-K885       THRU 230-EXIT.                           
                                                                                
       330-EXIT.                                                                
           EXIT.                                                                
                                                                                
       350-CHECK-ROOM-TYPE.                                                     
                                                                                
           IF K800-AMT-BK-PAID NOT NUMERIC                                      
              MOVE ZEROES TO K800-AMT-BK-PAID.                                  
                                                                                
           IF K800-AMT-CD NOT NUMERIC                                           
              MOVE ZEROES TO K800-AMT-CD.                                       
                                                                                
           IF K800-AMT-SOC-DEBTOR NOT NUMERIC                                   
              MOVE ZEROES TO K800-AMT-SOC-DEBTOR.                               
                                                                                
           IF K800-AMT-REGN-DEPOSIT-CASH          NOT NUMERIC                   
              MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-CASH.                        
                                                                                
           IF K800-AMT-REGN-DEPOSIT-CPF1          NOT NUMERIC                   
              MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-CPF1.                        
                                                                                
           IF K800-AMT-REGN-DEPOSIT-CPF2          NOT NUMERIC                   
              MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-CPF2.                        
                                                                                
           IF K800-AMT-REGN-DEPOSIT-CPF3          NOT NUMERIC                   
              MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-CPF3.                        
                                                                                
           IF K800-AMT-REGN-DEPOSIT-CPF4          NOT NUMERIC                   
              MOVE ZEROES TO K800-AMT-REGN-DEPOSIT-CPF4.                        
                                                                                
           IF K800-NUM-ROOM = 'E'                                               
              COMPUTE WS-BK-FEE-EX     = WS-BK-FEE-EX + K800-AMT-BK-PAID        
              COMPUTE WS-CD-EX         = WS-CD-EX + K800-AMT-CD                 
              COMPUTE WS-REGN-DEP-EX   = WS-REGN-DEP-EX +                       
                                         K800-AMT-REGN-DEPOSIT-CASH +           
                                         K800-AMT-REGN-DEPOSIT-CPF1 +           
                                         K800-AMT-REGN-DEPOSIT-CPF2 +           
                                         K800-AMT-REGN-DEPOSIT-CPF3 +           
                                         K800-AMT-REGN-DEPOSIT-CPF4             
              COMPUTE WS-SOC-DEBTOR-EX = WS-SOC-DEBTOR-EX -                     
                                         K800-AMT-SOC-DEBTOR                    
           ELSE                                                                 
              COMPUTE WS-BK-FEE-PA     = WS-BK-FEE-PA + K800-AMT-BK-PAID        
              COMPUTE WS-CD-PA         = WS-CD-PA + K800-AMT-CD                 
              COMPUTE WS-REGN-DEP-PA   = WS-REGN-DEP-PA +                       
                                         K800-AMT-REGN-DEPOSIT-CASH +           
                                         K800-AMT-REGN-DEPOSIT-CPF1 +           
                                         K800-AMT-REGN-DEPOSIT-CPF2 +           
                                         K800-AMT-REGN-DEPOSIT-CPF3 +           
                                         K800-AMT-REGN-DEPOSIT-CPF4             
              COMPUTE WS-SOC-DEBTOR-PA = WS-SOC-DEBTOR-PA -                     
                                         K800-AMT-SOC-DEBTOR.                   
                                                                                
       350-EXIT.                                                                
           EXIT.                                                                
                                                                                
       380-CHECK-ROOM-TYPE.                                                     
                                                                                
           IF K885-AMT-SUSPENSE NOT NUMERIC                                     
              MOVE ZEROES TO K885-AMT-SUSPENSE.                                 
                                                                                
                                                                                
              IF K885-NUM-FLAT = 'E'                                            
              COMPUTE WS-SUSPENSE-EX   = WS-SUSPENSE-EX +                       
                                         K885-AMT-SUSPENSE                      
              ELSE                                                              
              COMPUTE WS-SUSPENSE-PA   = WS-SUSPENSE-PA +                       
                                         K885-AMT-SUSPENSE.                     
                                                                                
       380-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       400-WRITE-F900.                                                          
             DISPLAY  '   400-WRITE-F900 '                                      
           MOVE SPACES                    TO   AG20F900-REC                     
                                               F190-GL-REC.                     
                                                                                
           IF WS-BK-FEE-PA IS NUMERIC                                           
              MOVE 'PA'                   TO WS-TRANS-TYPE                      
              MOVE WS-BK-FEE-PA           TO WS-BK-FEE                          
              MOVE 'ACTY ACCTG - BOOKING FEE (PH)' TO                           
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204516'        TO   F900-HDR-ACCT-NO                 
              MOVE '0000000204516'        TO   F190-ACC-NO                      
              PERFORM 510-CR-BK-FEE       THRU 510-EXIT.                        
                                                                                
           IF WS-BK-FEE-EX IS NUMERIC                                           
              MOVE 'EX'                   TO WS-TRANS-TYPE                      
              MOVE WS-BK-FEE-EX           TO WS-BK-FEE                          
              MOVE 'ACTY ACCTG - BOOKING FEE (EX)' TO                   LS      
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204516'        TO   F900-HDR-ACCT-NO                 
              MOVE '0000000204516'        TO   F190-ACC-NO                      
              PERFORM 510-CR-BK-FEE       THRU 510-EXIT.                        
                                                                                
                                                                                
           MOVE 'ACTY ACCTG - BOOKING FEE     ' TO                      LS      
                F900-DTL-TRANS-DESC F190-TRANS-DETAILS                          
           MOVE '0000000104516'        TO   F900-HDR-ACCT-NO                    
                                            F190-ACC-NO                         
           PERFORM 410-DR-BK-FEE       THRU 410-EXIT.                           
                                                                                
           IF WS-SOC-DEBTOR-PA IS NUMERIC                                       
              MOVE 'PA'                   TO WS-TRANS-TYPE                      
              MOVE WS-SOC-DEBTOR-PA       TO   WS-SOC-DEBTOR                    
              MOVE 'ACTY ACCTG - SOC(PH)' TO                                    
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204518'        TO   F900-HDR-ACCT-NO                 
                                               F190-ACC-NO                      
              PERFORM 520-CR-SOC          THRU 520-EXIT.                        
                                                                                
           IF WS-SOC-DEBTOR-EX IS NUMERIC                                       
              MOVE 'EX'                   TO WS-TRANS-TYPE                      
              MOVE WS-SOC-DEBTOR-EX       TO   WS-SOC-DEBTOR                    
              MOVE 'ACTY ACCTG - SOC(EX)' TO                                    
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204518'        TO   F900-HDR-ACCT-NO                 
                                               F190-ACC-NO                      
              PERFORM 520-CR-SOC          THRU 520-EXIT.                        
                                                                                
           MOVE 'ACTY ACCTG - SOC    ' TO                                       
                F900-DTL-TRANS-DESC F190-TRANS-DETAILS.                         
           MOVE '0000000104518'        TO   F900-HDR-ACCT-NO                    
                                            F190-ACC-NO                         
           PERFORM 420-DR-SOC          THRU 420-EXIT.                           
                                                                                
                                                                                
           IF WS-CD-PA IS NUMERIC                                               
              MOVE 'PA'                   TO WS-TRANS-TYPE                      
              MOVE WS-CD-PA               TO   WS-CD                            
              MOVE 'ACTY ACCTG - CD (PH)' TO                                    
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204517'        TO   F900-HDR-ACCT-NO                 
                                               F190-ACC-NO                      
              PERFORM 530-CR-CD           THRU 530-EXIT.                        
                                                                                
            IF WS-CD-EX IS NUMERIC                                              
               MOVE 'EX'                   TO WS-TRANS-TYPE                     
               MOVE WS-CD-EX               TO   WS-CD                           
               MOVE 'ACTY ACCTG - CD (EX)' TO                                   
                    F900-DTL-TRANS-DESC F190-TRANS-DETAILS                      
               MOVE '0000000204517'        TO   F900-HDR-ACCT-NO                
                                                F190-ACC-NO                     
               PERFORM 530-CR-CD           THRU 530-EXIT.                       
                                                                                
            MOVE 'ACTY ACCTG - CD     ' TO                                      
                 F900-DTL-TRANS-DESC F190-TRANS-DETAILS.                        
            MOVE '0000000104517'        TO   F900-HDR-ACCT-NO                   
                                             F190-ACC-NO.                       
            PERFORM 430-DR-CD          THRU 430-EXIT.                           
                                                                                
                                                                                
           IF WS-SUSPENSE-PA IS NUMERIC                                         
              MOVE 'PA'                   TO WS-TRANS-TYPE                      
              MOVE WS-SUSPENSE-PA         TO   WS-SUSPENSE                      
              MOVE 'ACTY ACCTG - SUSPENSE (PH)' TO                              
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204009'        TO   F900-HDR-ACCT-NO                 
                                               F190-ACC-NO                      
              PERFORM 540-CR-SUSPENSE  THRU 540-SUSPENSE-EXIT.                  
                                                                                
            IF WS-SUSPENSE-EX IS NUMERIC                                        
               MOVE 'EX'                   TO WS-TRANS-TYPE                     
               MOVE WS-SUSPENSE-EX         TO   WS-SUSPENSE                     
               MOVE 'ACTY ACCTG - SUSPENSE (EX)' TO                             
                    F900-DTL-TRANS-DESC F190-TRANS-DETAILS                      
               MOVE '0000000204009'        TO   F900-HDR-ACCT-NO                
                                                F190-ACC-NO                     
              PERFORM 540-CR-SUSPENSE  THRU 540-SUSPENSE-EXIT.                  
                                                                                
            MOVE 'ACTY ACCTG - SUSPENSE     ' TO                                
                 F900-DTL-TRANS-DESC F190-TRANS-DETAILS.                        
            MOVE '0000000104009'        TO   F900-HDR-ACCT-NO                   
                                             F190-ACC-NO.                       
                                                                                
            PERFORM 440-DR-SUSPENSE    THRU 440-EXIT.                           
                                                                                
           IF WS-REGN-DEP-PA IS NUMERIC                                         
              MOVE 'PA'                   TO WS-TRANS-TYPE                      
              MOVE WS-REGN-DEP-PA         TO   WS-REGN-DEP                      
              MOVE 'ACTY ACCTG - REGN-DEP (PH)' TO                              
                   F900-DTL-TRANS-DESC F190-TRANS-DETAILS                       
              MOVE '0000000204515'        TO   F900-HDR-ACCT-NO                 
                                               F190-ACC-NO                      
              PERFORM 540-CR-REGN-DEP  THRU 540-REGN-DEP-EXIT.                  
                                                                                
            IF WS-REGN-DEP-EX IS NUMERIC                                        
               MOVE 'EX'                   TO WS-TRANS-TYPE                     
               MOVE WS-REGN-DEP-EX         TO   WS-REGN-DEP                     
               MOVE 'ACTY ACCTG - REGN-DEP (EX)' TO                             
                    F900-DTL-TRANS-DESC F190-TRANS-DETAILS                      
               MOVE '0000000204515'        TO   F900-HDR-ACCT-NO                
                                                F190-ACC-NO                     
              PERFORM 540-CR-REGN-DEP  THRU 540-REGN-DEP-EXIT.                  
                                                                                
            MOVE 'ACTY ACCTG - REGN-DEP     ' TO                                
                 F900-DTL-TRANS-DESC F190-TRANS-DETAILS.                        
            MOVE '0000000104515'        TO   F900-HDR-ACCT-NO                   
                                             F190-ACC-NO.                       
                                                                                
            PERFORM 441-DR-REGN-DEP    THRU 441-EXIT.                           
                                                                                
            PERFORM 540-TOTAL          THRU 540-EXIT.                           
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ************************************************************              
      *    DEBIT BOOKING FEE                                     *              
      ************************************************************              
       410-DR-BK-FEE.                                                           
                                                                                
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT =  WS-BK-FEE-PA + WS-BK-FEE-EX.           
           COMPUTE F190-CR-AMT =  0 - F900-HDR-DR-CR-AMT.                       
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       410-EXIT.                                                                
           EXIT.                                                                
                                                                                
       420-DR-SOC.                                                              
                                                                                
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = WS-SOC-DEBTOR-PA +                      
                                  WS-SOC-DEBTOR-EX.                             
           COMPUTE F190-CR-AMT =  0 - F900-HDR-DR-CR-AMT.                       
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       420-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    COMPUTE TOTAL                                              *         
      *****************************************************************         
                                                                                
       430-DR-CD.                                                               
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = WS-CD-PA + WS-CD-EX.                    
           COMPUTE F190-CR-AMT =  0 - F900-HDR-DR-CR-AMT.                       
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       430-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       440-DR-SUSPENSE.                                                         
                                                                                
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = WS-SUSPENSE-PA + WS-SUSPENSE-EX.        
           COMPUTE F190-CR-AMT =  0 - F900-HDR-DR-CR-AMT.                       
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       440-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       441-DR-REGN-DEP.                                                         
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = WS-REGN-DEP-PA + WS-REGN-DEP-EX.        
           COMPUTE F190-CR-AMT =  0 - F900-HDR-DR-CR-AMT.                       
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       441-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    CREDIT BOOKING FEE                                         *         
      *****************************************************************         
       510-CR-BK-FEE.                                                           
                                                                                
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-BK-FEE.                          
           COMPUTE F190-CR-AMT =  WS-BK-FEE.                                    
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              GO TO 510-EXIT                                                    
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           IF WS-BK-FEE NOT = ZEROES                                            
              COMPUTE WS-GRAND-TOTAL =  WS-GRAND-TOTAL - WS-BK-FEE.             
                                                                                
           MOVE 'BK ' TO K160-KEY-FLD.                                          
           READ BP13K160.                                                       
                                                                                
           IF WS-TRANS-TYPE  = 'PA'                                             
              MOVE  WS-BK-FEE-PA TO K160-AMT-PUBLIC-HOUSING                     
           ELSE                                                                 
              MOVE  WS-BK-FEE-EX TO K160-AMT-EXEC-HOUSING.                      
                                                                                
           REWRITE BP13K160-BAL.                                                
           IF K160-STATUS = ZEROES                                              
              ADD 1 TO WS-REWRITE                                               
           ELSE                                                                 
              DISPLAY 'REWRITE ERROR, K160-STATUS : ' K160-STATUS               
              PERFORM 900-CLOSE-ROUTINE THRU  900-EXIT.                         
                                                                                
            MOVE SPACES                 TO   AG20F900-REC.                      
            MOVE SPACES                 TO   F190-GL-REC.                       
                                                                                
       510-EXIT.                                                                
           EXIT.                                                                
      *****************************************************************         
      *    CREDIT SOC DEBTOR                                          *         
      *****************************************************************         
       520-CR-SOC.                                                              
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
                                                                                
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
                                                                                
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
                                                                                
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
                                                                                
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-SOC-DEBTOR.                      
           COMPUTE F190-CR-AMT = WS-SOC-DEBTOR.                                 
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              GO TO 520-EXIT                                                    
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           IF WS-SOC-DEBTOR  > ZEROES                                           
              COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL - WS-SOC-DEBTOR           
           ELSE                                                                 
              COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL + WS-SOC-DEBTOR           
           END-IF.                                                              
                                                                                
           MOVE 'SOC' TO K160-KEY-FLD.                                          
                                                                                
           READ BP13K160.                                                       
                                                                                
           IF WS-TRANS-TYPE  = 'PA'                                             
              MOVE  WS-SOC-DEBTOR-PA TO K160-AMT-PUBLIC-HOUSING                 
           ELSE                                                                 
              MOVE  WS-SOC-DEBTOR-EX TO K160-AMT-EXEC-HOUSING.                  
                                                                                
           REWRITE BP13K160-BAL.                                                
                                                                                
           IF K160-STATUS = 00                                                  
              ADD 1 TO WS-REWRITE                                               
           ELSE                                                                 
              DISPLAY 'REWRITE ERROR, K160-STATUS : ' K160-STATUS               
              PERFORM 900-CLOSE-ROUTINE THRU  900-EXIT.                         
                                                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
      *****************************************************************         
      *    CREDIT COMMITMENT DEPOSIT                                  *         
      *****************************************************************         
       530-CR-CD.                                                               
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-CD.                              
           COMPUTE F190-CR-AMT =  WS-CD.                                        
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              GO TO 530-EXIT                                                    
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           IF WS-CD NOT = ZEROES                                                
              COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL - WS-CD.                  
                                                                                
           MOVE 'CD ' TO K160-KEY-FLD.                                          
           READ BP13K160.                                                       
                                                                                
           IF WS-TRANS-TYPE  = 'PA'                                             
              MOVE  WS-CD-PA TO K160-AMT-PUBLIC-HOUSING                         
           ELSE                                                                 
              MOVE  WS-CD-EX TO K160-AMT-EXEC-HOUSING.                          
                                                                                
           REWRITE BP13K160-BAL.                                                
                                                                                
           IF K160-STATUS = 00                                                  
              ADD 1 TO WS-REWRITE                                               
           ELSE                                                                 
              DISPLAY 'REWRITE ERROR, K160-STATUS : ' K160-STATUS               
              PERFORM 900-CLOSE-ROUTINE THRU  900-EXIT.                         
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       530-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    CREDIT SUSPENSE AMOUNT                                     *         
      *****************************************************************         
       540-CR-SUSPENSE.                                                         
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
                                                                                
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
                                                                                
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
                                                                                
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-SUSPENSE.                        
           COMPUTE F190-CR-AMT =  WS-SUSPENSE.                                  
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              GO TO 540-SUSPENSE-EXIT                                           
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           IF WS-SUSPENSE NOT = ZEROES                                          
              COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL - WS-SUSPENSE.            
                                                                                
           MOVE 'SUS' TO K160-KEY-FLD.                                          
           READ BP13K160.                                                       
                                                                                
           IF WS-TRANS-TYPE  = 'PA'                                             
              MOVE  WS-SUSPENSE-PA          TO K160-AMT-PUBLIC-HOUSING          
           ELSE                                                                 
              MOVE  WS-SUSPENSE-EX          TO K160-AMT-EXEC-HOUSING.           
                                                                                
           REWRITE BP13K160-BAL.                                                
                                                                                
           IF K160-STATUS = 00                                                  
              ADD 1 TO WS-REWRITE                                               
           ELSE                                                                 
              DISPLAY 'REWRITE ERROR, K160-STATUS : ' K160-STATUS               
              PERFORM 900-CLOSE-ROUTINE THRU  900-EXIT.                         
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       540-SUSPENSE-EXIT.                                                       
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    CREDIT REGN DEP AMOUNT                                     *         
      *****************************************************************         
       540-CR-REGN-DEP.                                                         
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
                                                                                
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
                                                                                
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
                                                                                
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
           MOVE ZEROES                 TO   F900-DTL-TAX-RATE.                  
           MOVE ZEROES                 TO   F190-TAX-RATE.                      
           COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-REGN-DEP.                        
           COMPUTE F190-CR-AMT =  WS-REGN-DEP.                                  
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              GO TO 540-REGN-DEP-EXIT                                           
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           IF WS-REGN-DEP NOT = ZEROES                                          
              COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL - WS-REGN-DEP.            
                                                                                
           MOVE 'RDE' TO K160-KEY-FLD.                                          
           READ BP13K160.                                                       
                                                                                
           IF WS-TRANS-TYPE  = 'PA'                                             
              MOVE  WS-REGN-DEP-PA          TO K160-AMT-PUBLIC-HOUSING          
           ELSE                                                                 
              MOVE  WS-REGN-DEP-EX          TO K160-AMT-EXEC-HOUSING.           
                                                                                
           REWRITE BP13K160-BAL.                                                
                                                                                
           IF K160-STATUS = 00                                                  
              ADD 1 TO WS-REWRITE                                               
           ELSE                                                                 
              DISPLAY 'REWRITE ERROR, K160-STATUS : ' K160-STATUS               
              PERFORM 900-CLOSE-ROUTINE THRU  900-EXIT.                         
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       540-REGN-DEP-EXIT.                                                       
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    COMPUTE TOTAL                                              *         
      *****************************************************************         
                                                                                
       540-TOTAL.                                                               
           STRING  'SB'                                                         
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-JRNL-NO                                               
                                                                                
           STRING  WS-F190-TRANS-DD                                             
                   WS-F190-TRANS-MM                                             
                   WS-F190-TRANS-YY DELIMITED BY SIZE                           
           INTO  F900-HDR-TRANS-DATE                                            
           MOVE 'SC'                   TO   F190-JR-SC.                         
           MOVE 'T'                    TO   F900-HDR-JRNL-TOT-CODE              
                                            F190-CDE-TOTAL.                     
           MOVE WS-F190-TRANS-YY       TO   F190-JR-YY F190-TRANS-YY.           
                                                                                
           MOVE WS-F190-TRANS-MM       TO   F190-JR-MM F190-TRANS-MM.           
                                                                                
           MOVE WS-F190-TRANS-DD       TO   F190-TRANS-DD.                      
                                                                                
           MOVE WS-F190-PERIOD         TO   F900-HDR-TRANS-PERIOD.              
           MOVE WS-F191-PERIOD         TO   F190-PERIOD.                        
                                                                                
           IF WS-GRAND-TOTAL NOT = ZEROES                                       
              COMPUTE F900-HDR-DR-CR-AMT = 0 - WS-GRAND-TOTAL                   
              COMPUTE F190-CR-AMT =  F900-HDR-DR-CR-AMT.                        
                                                                                
           IF F900-HDR-DR-CR-AMT = 0                                            
              NEXT SENTENCE                                                     
           ELSE                                                                 
              WRITE AG20F900-REC                                                
              WRITE F190-GL-REC.                                                
                                                                                
           MOVE SPACES                 TO   AG20F900-REC.                       
           MOVE SPACES                 TO   F190-GL-REC.                        
                                                                                
       540-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    CORRECTING CALENDER DATE TO FINANCIAL YEAR PERIOD          *         
      *****************************************************************         
       600-CHK-PERIOD.                                                          
                                                                                
           IF WS-F190-TRANS-MM  < 4                                             
              ADD 9 WS-F190-TRANS-MM GIVING WS-F190-PERIOD.                     
                                                                                
           IF WS-F190-TRANS-MM  > 3                                             
              SUBTRACT 3 FROM WS-F190-TRANS-MM GIVING WS-F190-PERIOD.           
                                                                                
           MOVE WS-F190-PERIOD  TO   WS-F191-PERIOD.                            
           ADD 1                TO   WS-F191-PERIOD.                            
           IF WS-F191-PERIOD = 13                                               
              MOVE 01  TO WS-F191-PERIOD.                                       
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ****************************************************************          
      *    MOVING THE APPROPRIATE MONTH END DATE ACCORDING TO        *          
      *    CALENDER MONTH AND YEAR                                   *          
      ****************************************************************          
       610-CHK-TRAN-DTE.                                                        
           DIVIDE WS-F190-TRANS-CCYY  BY 4 GIVING WS-YEAR REMAINDER             
                                            WS-LEAP-YEAR.                       
                                                                                
           MOVE WS-F190-TRANS-MM TO WS-MONTH.                                   
           IF WS-F190-TRANS-MM = 2                                              
              IF WS-LEAP-YEAR = 0                                               
                 MOVE 29 TO WS-F190-TRANS-DD                                    
              ELSE                                                              
                 MOVE 28 TO WS-F190-TRANS-DD                                    
           ELSE                                                                 
              IF CHECK-MM                                                       
                 MOVE 30 TO WS-F190-TRANS-DD                                    
              ELSE                                                              
                 MOVE 31 TO WS-F190-TRANS-DD.                                   
                                                                                
       610-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       900-CLOSE-ROUTINE.                                                       
                                                                                
           CLOSE BP13K800                                                       
                 BP13K885                                                       
                 BP13K160                                                       
                 AG20F900                                                       
                 BP13F190.                                                      
                                                                                
           IF K800-STATUS NOT = 0                                               
              MOVE K800-STATUS     TO   RETURN-CODE                             
              DISPLAY 'K800 CLOSING ERROR  ' K800-STATUS.                       
                                                                                
           IF K885-STATUS NOT = 0                                               
              MOVE K885-STATUS     TO   RETURN-CODE                             
              DISPLAY 'K885 CLOSING ERROR  ' K885-STATUS.                       
                                                                                
           IF K160-STATUS NOT = 0                                               
              MOVE K160-STATUS     TO   RETURN-CODE                             
              DISPLAY 'K160 CLOSING ERROR  ' K160-STATUS.                       
                                                                                
           STOP RUN.                                                            
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
