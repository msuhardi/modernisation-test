       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13CS10.                                         00020000
       AUTHOR.        ZARITA DANE SARMIENTO.                            00030000
      *DATE-WRITTEN.  22/09/2015.                                       00040000
                                                                        00050000
      *************************************************************     00060000
      *      SYSTEM OF COMMITMENT (BP13)                          *     00070000
      *===========================================================*     00080000
      *                                                           *     00090000
      *  OBJECTIVES: 1. TO NOTIFY APPLICANTS THRU EMAIL OF THE    *     00100000
      *                 AHG/SHG PAPROVAL                          *     00110000
      *              2. PROGRAM TO PUT MQ MESSAGE INTO QUEUE      *     00120000
      *                 WHICH CONTAINS CUSTOMER'S EMAIL ADDRESS,  *     00130000
      *                 TO BE SENT BY THE JAVA INTERFACE.         *     00140000
      *                                                           *     00150000
      *   PROGRAM LOGIC:                                          *     00160000
      *         PROCESS INPUT FILES                               *     00170000
      *         MQCONNECT TO QUEUE MANAGER                        *     00180000
      *         MQOPEN QUEUE                                      *     00190000
      *         MQPUT                                             *     00200000
      *         MQCLOSE QUEUE                                     *     00210000
      *         MQDISCONNECT FROM QUEUE MANAGER                   *     00220000
      *                                                           *     00230000
      * WS-PROJ-NAME = OIC NAME                                   *     00240000
      * WS-MSG-APPT-TYPE = CODE                                   *     00250000
      *    CODE Z1 = AHG ONLY                                     *     00260000
      *    CODE Z2 = SHG ONLY                                     *     00270000
      *    CODE Z3 = ANG AND SHG                                  *     00280000
      *                                                           *     00290000
      *===========================================================*     00300000
      * MODIFICATIONS :                                           *     00310000
      *                                                           *     00320000
      * CHG REQ#    DATE    AUTHOR REMARKS                        *     00330000
      * -------- ---------- ------ ------------------------------ *     00340000
      * BP13XXXX 22/09/2015  ZDD1  NEW PROGRAM                    *     00350000
      * BP138006 12/11/2019  PP11  CATER FOR EG CASE              *     00360000
      * BP139027 21/04/2022  PP11  CATER FOR LG APPOINTMENT TYPE  *     00361001
      *************************************************************     00370000
                                                                        00380000
       ENVIRONMENT DIVISION.                                            00390000
       CONFIGURATION SECTION.                                           00400000
       SOURCE-COMPUTER. IBM-3090.                                       00410000
       OBJECT-COMPUTER. IBM-3090.                                       00420000
       SPECIAL-NAMES.                                                   00430000
           SYSIN IS PARM-INPUT.                                         00440000
                                                                        00450000
       INPUT-OUTPUT SECTION.                                            00460000
       FILE-CONTROL.                                                    00470000
      *                                                                 00480000
           SELECT BP13F23A ASSIGN TO BP13F23A                           00490000
                  ORGANIZATION    IS SEQUENTIAL                         00500000
                  FILE STATUS     IS BP13F23A-STAT.                     00510000
                                                                        00520000
                                                                        00530000
                                                                        00540000
       DATA DIVISION.                                                   00550000
       FILE SECTION.                                                    00560000
                                                                        00570000
                                                                        00580000
       FD  BP13F23A                                                     00590000
           RECORD CONTAINS 200 CHARACTERS                               00600000
           RECORDING MODE IS F.                                         00610000
       COPY BP13F23A.                                                   00620000
                                                                        00630000
                                                                        00640000
       WORKING-STORAGE SECTION.                                         00650000
                                                                        00660000
      *----------------------------------------------------------*      00670000
      *  IMPORTANT!                                              *      00680000
      *  FOR PRODUCTION, QUEUE MANAGER IS 'MQP1'                 *      00690000
      *  FOR TESTING,    QUEUE MANAGER IS 'MQT1'                 *      00700000
      *----------------------------------------------------------*      00710000
       01  WS-QM-NAME               PIC X(48) VALUE 'MQP1'.             00720000
      *01  WS-QM-NAME               PIC X(48) VALUE 'MQT1'.             00730000
       01  WS-BP13Q-NAME            PIC X(48) VALUE SPACES.             00740000
                                                                        00750000
      *----------------------------------------------------------*      00760000
      *  OUTPUT QUEUE NAME TO CRIMSONLOGIC                       *      00770000
      *  FOR PROD, QUEUE NAME IS BP13.WIS.MDB.REQUESTQ           *      00780000
      *  FOR TESTING, QUEUE NAME IS BP13S.WIS.MDB.REQUESTQ       *      00790000
      *----------------------------------------------------------*      00800000
       01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13.WIS.MDB.REQUESTQ'.     00810000
      *01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13S.WIS.MDB.REQUESTQ'.    00820000
                                                                        00830000
      *----------------------------------------------------------*      00840000
      *  MESSAGE LENGTH                                          *      00850000
      *----------------------------------------------------------*      00860000
       01  WS-MESSAGE-LENGTH        PIC 9(06) VALUE 368012.             00870000
                                                                        00880000
      *----------------------------------------------------------*      00890000
      *  MESSAGE                                                 *      00900000
      *----------------------------------------------------------*      00910000
       01  WS-SEND-MESSAGE.                                             00920000
           05  WS-MSG-CDE                   PIC X(03).                  00930000
           05  WS-FILLER-01                 PIC X(01).                  00940000
           05  WS-MSG-APPT-TYP              PIC X(02).                  00950000
           05  WS-FILLER-02                 PIC X(01).                  00960000
           05  WS-MSG-CTR                   PIC 9(04).                  00970000
           05  WS-FILLER-03                 PIC X(01).                  00980000
           05  WS-MSG OCCURS 2000 TIMES.                                00990000
               10  WS-MSG-EMAIL             PIC X(50).                  01000000
               10  WS-FILLER-04             PIC X(01).                  01010000
               10  WS-DTE-BALLOT            PIC X(06).                  01020000
               10  WS-FILLER-05             PIC X(01).                  01030000
               10  WS-MSG-FLAT-TYPE         PIC X(02).                  01040000
               10  WS-FILLER-06             PIC X(01).                  01050000
               10  WS-MSG-QUEUE-NO          PIC X(05).                  01060000
               10  WS-FILLER-07             PIC X(01).                  01070000
               10  WS-PROJ-NAME             PIC X(30).                  01080000
               10  WS-FILLER-08             PIC X(01).                  01090000
               10  WS-SEL-PERIOD            PIC X(20).                  01100000
               10  WS-FILLER-09             PIC X(01).                  01110000
               10  WS-MSG-REGN              PIC X(08).                  01120000
               10  WS-FILLER-10             PIC X(01).                  01130000
               10  WS-MSG-QUEUE-GRO         PIC X(05).                  01140000
               10  WS-FILLER-11             PIC X(01).                  01150000
               10  WS-MSG-WARD              PIC X(25).                  01160000
               10  WS-FILLER-12             PIC X(01).                  01170000
               10  WS-NUM-UNIT-OFFER        PIC X(04).                  01180000
               10  WS-FILLER-13             PIC X(01).                  01190000
               10  WS-MSG-FLAT-TYPE-P       PIC X(02).                  01200000
               10  WS-FILLER-14             PIC X(01).                  01210000
               10  WS-MSG-FLAT-TYPE-C       PIC X(02).                  01220000
               10  WS-FILLER-15             PIC X(01).                  01230000
               10  WS-MSG-ME-TAG            PIC X(01).                  01240000
               10  WS-FILLER-16             PIC X(01).                  01250000
               10  WS-MSG-LAUNCH-TXT        PIC X(10).                  01260000
               10  WS-FILLER-17             PIC X(01).                  01270000
                                                                        01280000
      *----------------------------------------------------------*      01290000
      *  OTHER VARIABLES                                         *      01300000
      *----------------------------------------------------------*      01310000
       01  WS-VARIABLES.                                                01320000
           05  WS-CTR               PIC 9(04).                          01330000
           05  WS-START             PIC 9(03).                          01340000
           05  WS-F23A-READ         PIC 9(05).                          01350000
           05  WS-EMAIL-SENT        PIC 9(06) VALUE ZEROES.             01360000
                                                                        01370000
      *-------------------------------------------------------------    01380000
      *  MQI - TEMPORARY VARIABLES FOR ERROR CODES                      01390000
      *-------------------------------------------------------------    01400000
       01  BP13CS10-REC.                                                01410000
           05 CS10-REASON          PIC 9(4).                            01420000
           05 CS10-COMPLETION-CODE PIC 9(4).                            01430000
           05 CS10-ERR-MSG         PIC X(66).                           01440000
           05 FILLER               PIC X(27).                           01450000
                                                                        01460000
                                                                        01470000
      *----------------------------------------------------------*      01480000
      *              MQI STRUCTURE DECLARATION                   *      01490000
      *----------------------------------------------------------*      01500000
       01 MY-MQ-CONSTANTS.                                              01510000
          COPY CMQV.                                                    01520000
                                                                        01530000
       01 OBJECT-DESCRIPTOR.                                            01540000
          COPY CMQODV.                                                  01550000
                                                                        01560000
       01 MESSAGE-DESCRIPTOR.                                           01570000
          COPY CMQMDV.                                                  01580000
                                                                        01590000
      * PUT MESSAGE OPTIONS                                             01600000
       01 PMOPTIONS.                                                    01610000
          COPY CMQPMOV.                                                 01620000
                                                                        01630000
      *----------------------------------------------------------*      01640000
      * VARIABLE DESCRIPTION:                                    *      01650000
      * (1) HCONN                                                *      01660000
      *       - CONNECTION HANDLE - REPRESENTS THE CONNECTION TO *      01670000
      *         THE QUEUE MANAGER. VALUE IS RETURNED BY MQCONN   *      01680000
      *         AND SUBSEQUENTLY REFERENCED IN MQOPEN, MQPUT,    *      01690000
      *         MQCLOSE AND MQDISC                               *      01700000
      *                                                          *      01710000
      * (2) Q-HANDLE                                             *      01720000
      *       - ACCESS THAT HAS BEEN ESTABLISHED  TO THE OBJECT  *      01730000
      *         CONNECTION HANDLE - VALUE IS RETURNED BY MQOPEN  *      01740000
      *         AND SUBSEQUENTLY REFERENCED IN MQPUT AND MQCLOSE *      01750000
      *                                                          *      01760000
      * (3) OBJECT-DESCRIPTOR                                    *      01770000
      *       - THIS IDENTIFIES THE OBJECT TO BE OPENED          *      01780000
      *                                                          *      01790000
      * (4) OPTIONS                                              *      01800000
      *       WHEN USED IN MQOPEN                                *      01810000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQOPEN        *      01820000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      01830000
      *         MQOO-OUTPUT - THE QUEUE IS OPENED FOR USE WITH   *      01840000
      *                       SUBSEQUENT MQPUT CALL              *      01850000
      *         MQOO-FAIL-IF-QUIESCING - FORCES MQCALL TO FAIL   *      01860000
      *                       IF QUEUE MANAGER IS IN QUIESCING   *      01870000
      *                       STATE (I.E. PREPARING TO SHUTDOWN) *      01880000
      *                                                          *      01890000
      *       WHEN USED IN MQCLOSE                               *      01900000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQCLOSE       *      01910000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      01920000
      *         MQCO-NONE   - NO OPTIONAL CLOSE PROCESSING       *      01930000
      *                       REQUIRED                           *      01940000
      *                                                          *      01950000
      * (5) MESSAGE-DESCRIPTOR                                   *      01960000
      *       - THIS DESCRIBES THE ATTRIBUTES OF THE MESSAGE     *      01970000
      *         BEING SENT, AND RECEIVES INFO ABOUT THE MESSAGE  *      01980000
      *         AFTER THE PUT REQUEST IS COMPLETE                *      01990000
      *                                                          *      02000000
      * (6) PMOPTIONS (PUT MESSAGE OPTIONS)                      *      02010000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQPUT         *      02020000
      *       - OPTION USED IN THIS PROGRAM:                     *      02030000
      *         MQMD-EXPIRY - MESSAGE LIFETIME. THE MESSAGE      *      02040000
      *                       BECOMES ELIGIBLE TO BE DISCARDED   *      02050000
      *                       IF IT HAS NOT BEEN REMOVED FROM    *      02060000
      *                       FROM THE QUEUE BEFORE THIS PERIOD  *      02070000
      *                       OF TIME ELAPSED                    *      02080000
      *                     - MUST BE SET TO MQEI_UNLIMITED      *      02090000
      *         MQMD-PERSISTENCE = MQPER-PERSISTENT              *      02100000
      *                                                          *      02110000
      * (7) BUFFER-LENGTH                                        *      02120000
      *       - LENGTH OF THE MESSAGE IN BUFFER                  *      02130000
      *                                                          *      02140000
      * (7) BUFFER                                               *      02150000
      *       - MESSAGE DATA                                     *      02160000
      *----------------------------------------------------------*      02170000
       01 HCONN                    PIC S9(9) BINARY.                    02180000
       01 Q-HANDLE                 PIC S9(9) BINARY.                    02190000
       01 OPTIONS                  PIC S9(9) BINARY.                    02200000
       01 COMPLETION-CODE          PIC S9(9) BINARY.                    02210000
       01 OPEN-CODE                PIC S9(9) BINARY.                    02220000
       01 CON-REASON               PIC S9(9) BINARY.                    02230000
       01 REASON                   PIC S9(9) BINARY.                    02240000
       01 MQMSGD                   PIC S9(9) BINARY.                    02250000
       01 BUFFER-LENGTH            PIC S9(9) BINARY.                    02260000
       01 BUFFER                   PIC X(368012).                       02270000
       01 QM-NAME                  PIC X(48) VALUE SPACES.              02280000
       01 TARGET-QUEUE             PIC X(48) VALUE SPACES.              02290000
                                                                        02300000
      *-------------------------------------------------------------    02310000
      *  FILE STATUS                                                    02320000
      *-------------------------------------------------------------    02330000
       01  WS-FILE-STAT.                                                02340000
           05 BP13F23A-STAT        PIC X(02)  VALUE SPACES.             02350000
                                                                        02360000
      *-------------------------------------------------------------    02370000
      *  FLAGS / SWITCHES                                               02380000
      *-------------------------------------------------------------    02390000
       01  WS-FLAGS.                                                    02400000
           05 F23A-EOF             PIC X(01) VALUE 'N'.                 02410000
           05 F23A-EMPTY           PIC X(01) VALUE 'N'.                 02420000
                                                                        02430000
      ****************************************************************  02440000
       PROCEDURE DIVISION.                                              02450000
      ****************************************************************  02460000
                                                                        02470000
      ********************                                              02480000
       0000-MAIN-PROCESS.                                               02490000
      ********************                                              02500000
                                                                        02510000
           PERFORM 0100-OPEN-FILES         THRU 0100-EXIT.              02520000
           PERFORM 0200-INITIALIZATION     THRU 0200-EXIT.              02530000
                                                                        02540000
           ACCEPT WS-BP13Q-NAME            FROM PARM-INPUT.             02550000
                                                                        02560000
           PERFORM 1000-CHECK-MESSAGE      THRU 1000-EXIT.              02570000
           MOVE F23A-TYPE-APPMT            TO WS-MSG-APPT-TYP.          02580000
           PERFORM 3000-PROCESS-BP13F23A   THRU 3000-EXIT               02590000
                   UNTIL F23A-EOF = 'Y'.                                02600000
           DISPLAY 'WS-SEND-MESSAGE : ' WS-SEND-MESSAGE.                02610000
           PERFORM 5300-MQ-PUT-MESSAGE     THRU 5300-EXIT.              02620000
           DISPLAY ' *** APPOINTMENT NOTIFICATION SENT!'                02630000
           PERFORM 5400-MQ-CLOSE           THRU 5400-EXIT.              02640000
           PERFORM 5500-MQ-DISCONNECT      THRU 5500-EXIT.              02650000
           PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT.              02660000
                                                                        02670000
           STOP RUN.                                                    02680000
                                                                        02690000
       0000-EXIT.                                                       02700000
           EXIT.                                                        02710000
                                                                        02720000
      ********************                                              02730000
       0100-OPEN-FILES.                                                 02740000
      ********************                                              02750000
                                                                        02760000
           DISPLAY ' ***** STARTING PROGRAM BP13CS10 . . . '.           02770000
           DISPLAY ' '.                                                 02780000
           OPEN    INPUT   BP13F23A.                                    02790000
                                                                        02800000
           IF  BP13F23A-STAT     NOT  =  00                             02810000
               DISPLAY ' OPEN ERROR BP13F23A'                           02820000
               DISPLAY 'BP13F23A-STAT = ' BP13F23A-STAT                 02830000
               MOVE     12                   TO RETURN-CODE             02840000
               PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT.            02850000
                                                                        02860000
       0100-EXIT.                                                       02870000
           EXIT.                                                        02880000
                                                                        02890000
      **********************                                            02900000
       0200-INITIALIZATION.                                             02910000
      **********************                                            02920000
                                                                        02930000
           MOVE SPACES     TO WS-SEND-MESSAGE.                          02940000
           INITIALIZE         WS-SEND-MESSAGE.                          02950000
           MOVE ';'        TO WS-FILLER-01                              02960000
                              WS-FILLER-02                              02970000
                              WS-FILLER-03.                             02980000
           PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 2000       02990000
              MOVE ';'     TO WS-FILLER-04(WS-CTR)                      03000000
                              WS-FILLER-05(WS-CTR)                      03010000
                              WS-FILLER-06(WS-CTR)                      03020000
                              WS-FILLER-07(WS-CTR)                      03030000
                              WS-FILLER-08(WS-CTR)                      03040000
                              WS-FILLER-09(WS-CTR)                      03050000
                              WS-FILLER-10(WS-CTR)                      03060000
                              WS-FILLER-11(WS-CTR)                      03070000
                              WS-FILLER-12(WS-CTR)                      03080000
                              WS-FILLER-13(WS-CTR)                      03090000
                              WS-FILLER-14(WS-CTR)                      03100000
                              WS-FILLER-15(WS-CTR)                      03110000
                              WS-FILLER-16(WS-CTR)                      03120000
                              WS-FILLER-17(WS-CTR)                      03130000
           END-PERFORM.                                                 03140000
                                                                        03150000
           MOVE 'EML'      TO WS-MSG-CDE.                               03160000
                                                                        03170000
      *-----------------------------                                    03180000
      *  INITIAL READ OF INPUT FILES                                    03190000
      *-----------------------------                                    03200000
           READ BP13F23A                                                03210000
               AT END                                                   03220000
                   MOVE 'Y' TO F23A-EOF                                 03230000
                   MOVE 'Y' TO F23A-EMPTY                               03240000
                   DISPLAY ' *** '                                      03250000
                   DISPLAY ' *** NO RECORDS FOUND IN SMS FILE'          03260000
                   DISPLAY ' *** '.                                     03270000
                                                                        03280000
                                                                        03290000
       0200-EXIT.                                                       03300000
           EXIT.                                                        03310000
                                                                        03320000
      ************************                                          03330000
       1000-CHECK-MESSAGE.                                              03340000
      ************************                                          03350000
                                                                        03360000
           IF F23A-EMPTY = 'Y'                                          03370000
               PERFORM 9000-CLOSE-FILES  THRU  9000-EXIT                03380000
           ELSE                                                         03390000
               PERFORM 5100-MQ-CONNECT   THRU  5100-EXIT                03400000
               PERFORM 5200-MQ-OPEN      THRU  5200-EXIT                03410000
           END-IF.                                                      03420000
                                                                        03430000
           MOVE SPACES                     TO BUFFER.                   03440000
                                                                        03450000
       1000-EXIT.                                                       03460000
           EXIT.                                                        03470000
                                                                        03480000
      ************************                                          03490000
       3000-PROCESS-BP13F23A.                                           03500000
      ************************                                          03510000
                                                                        03520000
           DISPLAY 'F23A-TYPE-APPMT    -' F23A-TYPE-APPMT               03530000
           IF F23A-TYPE-APPMT = 'Z1' OR 'Z2' OR 'Z3' OR 'EG' OR         03540000
                                'Y1' OR 'Y2' OR 'LG'                    03550000
                PERFORM 3200-PASS-MSG       THRU 3200-EXIT              03560000
           END-IF.                                                      03570000
                                                                        03580000
           READ BP13F23A                                                03590000
               AT END                                                   03600000
                   MOVE 'Y' TO F23A-EOF.                                03610000
                                                                        03620000
       3000-EXIT.                                                       03630000
           EXIT.                                                        03640000
                                                                        03650000
      ****************************************************************  03660000
       3200-PASS-MSG.                                                   03670000
      ****************************************************************  03680000
                                                                        03690000
           ADD 1  TO WS-MSG-CTR.                                        03700000
                                                                        03710000
           MOVE F23A-NUM-REGN        TO WS-MSG-REGN (WS-MSG-CTR).       03720000
           MOVE F23A-NUM-FLAT-TYPE   TO WS-MSG-FLAT-TYPE(WS-MSG-CTR).   03730000
           MOVE F23A-NUM-FLAT-TYPE-PARENT                               03740000
                                     TO WS-MSG-FLAT-TYPE-P(WS-MSG-CTR). 03750000
           MOVE F23A-NUM-FLAT-TYPE-CHILD                                03760000
                                     TO WS-MSG-FLAT-TYPE-C(WS-MSG-CTR). 03770000
           MOVE F23A-DTE-BALLOT      TO WS-DTE-BALLOT(WS-MSG-CTR).      03780000
           MOVE F23A-NUM-PRJ-NME     TO WS-PROJ-NAME(WS-MSG-CTR).       03790000
           MOVE F23A-NUM-SEL-PERIOD  TO WS-SEL-PERIOD(WS-MSG-CTR).      03800000
           MOVE F23A-NUM-EMAIL       TO WS-MSG-EMAIL(WS-MSG-CTR).       03810000
           MOVE F23A-NUM-QUEUE       TO WS-MSG-QUEUE-NO(WS-MSG-CTR).    03820000
           MOVE F23A-NUM-QUEUE-GRO   TO WS-MSG-QUEUE-GRO(WS-MSG-CTR).   03830000
           MOVE F23A-NUM-WARD        TO WS-MSG-WARD(WS-MSG-CTR).        03840000
           MOVE F23A-NUM-UNIT-OFFER  TO WS-NUM-UNIT-OFFER(WS-MSG-CTR).  03850000
           MOVE F23A-NUM-MATURE-EST-TAG TO WS-MSG-ME-TAG(WS-MSG-CTR).   03860000
           MOVE F23A-TXT-NEXT-LAUNCH-LTR TO                             03870000
                                      WS-MSG-LAUNCH-TXT(WS-MSG-CTR).    03880000
                                                                        03890000
       3200-EXIT.                                                       03900000
           EXIT.                                                        03910000
                                                                        03920000
                                                                        03930000
      ****************************************************************  03940000
       5100-MQ-CONNECT.                                                 03950000
      ****************************************************************  03960000
      *---------------------------------------------------------------  03970000
      *  SET THE QUEUE MANAGER NAME                                     03980000
      *---------------------------------------------------------------  03990000
           IF WS-BP13Q-NAME NOT = SPACES AND LOW-VALUES                 04000000
              MOVE WS-BP13Q-NAME           TO   QM-NAME                 04010000
           ELSE                                                         04020000
              MOVE WS-QM-NAME              TO   QM-NAME                 04030000
           END-IF.                                                      04040000
                                                                        04050000
      *---------------------------------------------------------------  04060000
      *   MQCONN                                                        04070000
      *---------------------------------------------------------------  04080000
           CALL 'MQCONN'                                                04090000
                USING QM-NAME, HCONN,                                   04100000
                COMPLETION-CODE, CON-REASON.                            04110000
                                                                        04120000
           IF COMPLETION-CODE  = MQCC-FAILED                            04130000
              MOVE CON-REASON              TO   CS10-REASON             04140000
              MOVE COMPLETION-CODE         TO   CS10-COMPLETION-CODE    04150000
              MOVE 'BP13CS10 MQCONN ERROR' TO   CS10-ERR-MSG            04160000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               04170000
           END-IF.                                                      04180000
                                                                        04190000
       5100-EXIT.                                                       04200000
           EXIT.                                                        04210000
                                                                        04220000
      ****************************************************************  04230000
       5200-MQ-OPEN.                                                    04240000
      ****************************************************************  04250000
      *---------------------------------------------------------------  04260000
      *  USE DEFAULT WS-QUEUE-NAME                                      04270000
      *---------------------------------------------------------------  04280000
                                                                        04290000
           MOVE  WS-QUEUE-NAME         TO MQOD-OBJECTNAME.              04300000
           ADD   MQOO-OUTPUT MQOO-FAIL-IF-QUIESCING                     04310000
                               GIVING OPTIONS.                          04320000
                                                                        04330000
      *---------------------------------------------------------------  04340000
      *   MQOPEN                                                        04350000
      *---------------------------------------------------------------  04360000
           CALL 'MQOPEN'                                                04370000
                USING HCONN, OBJECT-DESCRIPTOR,                         04380000
                OPTIONS, Q-HANDLE,                                      04390000
                OPEN-CODE, REASON.                                      04400000
                                                                        04410000
           IF REASON NOT =  MQRC-NONE                                   04420000
              MOVE REASON                     TO   CS10-REASON          04430000
              MOVE OPEN-CODE                  TO   CS10-COMPLETION-CODE 04440000
              MOVE 'MQOPEN ENDED WITH REASON CODE'                      04450000
                                              TO   CS10-ERR-MSG         04460000
              PERFORM 9100-EXIT-MQCONN        THRU 9100-EXIT            04470000
           END-IF.                                                      04480000
                                                                        04490000
       5200-EXIT.                                                       04500000
           EXIT.                                                        04510000
                                                                        04520000
      ***********************                                           04530000
       5300-MQ-PUT-MESSAGE.                                             04540000
      ***********************                                           04550000
                                                                        04560000
           MOVE WS-SEND-MESSAGE     TO BUFFER.                          04570000
                                                                        04580000
      *---------------------------------------------------------------  04590000
      *  SET UP MESSAGE DESCRIPTOR                                      04600000
      *---------------------------------------------------------------  04610000
           MOVE MQEI-UNLIMITED      TO MQMD-EXPIRY.                     04620000
           MOVE MQPER-PERSISTENT    TO MQMD-PERSISTENCE.                04630000
           MOVE MQFMT-STRING        TO MQMD-FORMAT.                     04640000
           MOVE WS-MESSAGE-LENGTH   TO BUFFER-LENGTH.                   04650000
      *---------------------------------------------------------------  04660000
      *   MQPUT                                                         04670000
      *---------------------------------------------------------------  04680000
                                                                        04690000
           CALL 'MQPUT'                                                 04700000
                USING HCONN, Q-HANDLE,                                  04710000
                      MESSAGE-DESCRIPTOR, PMOPTIONS,                    04720000
                      BUFFER-LENGTH, BUFFER,                            04730000
                      COMPLETION-CODE, REASON.                          04740000
                                                                        04750000
           IF REASON NOT =  MQRC-NONE                                   04760000
              MOVE REASON                  TO   CS10-REASON             04770000
              MOVE COMPLETION-CODE         TO   CS10-COMPLETION-CODE    04780000
              MOVE 'BP13CS10 MQPUT ERROR'  TO   CS10-ERR-MSG            04790000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               04800000
           END-IF.                                                      04810000
                                                                        04820000
       5300-EXIT.                                                       04830000
           EXIT.                                                        04840000
                                                                        04850000
      ****************************************************************  04860000
       5400-MQ-CLOSE.                                                   04870000
      ****************************************************************  04880000
                                                                        04890000
           MOVE MQCO-NONE TO OPTIONS.                                   04900000
                                                                        04910000
      *---------------------------------------------------------------  04920000
      *   MQCLOSE                                                       04930000
      *---------------------------------------------------------------  04940000
           CALL 'MQCLOSE'                                               04950000
                USING HCONN, Q-HANDLE, OPTIONS,                         04960000
                COMPLETION-CODE, REASON.                                04970000
                                                                        04980000
           IF REASON NOT =  MQRC-NONE                                   04990000
              MOVE REASON                   TO   CS10-REASON            05000000
              MOVE COMPLETION-CODE          TO   CS10-COMPLETION-CODE   05010000
              MOVE 'BP13CS10 MQCLOSE ERROR' TO   CS10-ERR-MSG           05020000
              PERFORM 9100-EXIT-MQCONN      THRU 9100-EXIT              05030000
           END-IF.                                                      05040000
                                                                        05050000
       5400-EXIT.                                                       05060000
           EXIT.                                                        05070000
                                                                        05080000
      ****************************************************************  05090000
       5500-MQ-DISCONNECT.                                              05100000
      ****************************************************************  05110000
      *---------------------------------------------------------------  05120000
      *  DISCONNECT FROM QUEUE MANAGER                                  05130000
      *---------------------------------------------------------------  05140000
           CALL 'MQDISC'                                                05150000
           USING HCONN, COMPLETION-CODE, REASON                         05160000
                                                                        05170000
           IF REASON NOT =  MQRC-NONE                                   05180000
              MOVE REASON                  TO   CS10-REASON             05190000
              MOVE COMPLETION-CODE         TO   CS10-COMPLETION-CODE    05200000
              MOVE 'BP13CS10 MQDISC ERROR' TO   CS10-ERR-MSG            05210000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               05220000
           END-IF.                                                      05230000
                                                                        05240000
       5500-EXIT.                                                       05250000
           EXIT.                                                        05260000
                                                                        05270000
                                                                        05280000
      ****************************************************************  05290000
       9000-CLOSE-FILES.                                                05300000
      ****************************************************************  05310000
                                                                        05320000
           CLOSE BP13F23A.                                              05330000
                                                                        05340000
           IF    RETURN-CODE NOT = ZERO                                 05350000
                 DISPLAY ' *** RETURN-CODE = ' RETURN-CODE ' ERROR'     05360000
           ELSE                                                         05370000
                 DISPLAY ' '                                            05380000
                 DISPLAY ' *** SUCCESSFUL EXECUTION OF BP13CS10.'       05390000
                 DISPLAY ' *** MESSAGE/S PUT INTO QUEUE SUCCESSFULLY!'  05400000
                 DISPLAY ' *** Q MANAGER : ' QM-NAME                    05410000
                 DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME              05420000
                 DISPLAY ' *** EMAIL ALREADY SENT: ' WS-EMAIL-SENT      05430000
                 DISPLAY ' '                                            05440000
           END-IF.                                                      05450000
                                                                        05460000
           STOP RUN.                                                    05470000
                                                                        05480000
       9000-EXIT.                                                       05490000
           EXIT.                                                        05500000
                                                                        05510000
      ****************************************************************  05520000
       9100-EXIT-MQCONN.                                                05530000
      ****************************************************************  05540000
                                                                        05550000
           DISPLAY ' *** PROGRAM ID:  BP13CS10 '                        05560000
           DISPLAY ' *** Q MANAGER : ' QM-NAME                          05570000
           DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME                    05580000
           DISPLAY ' '                                                  05590000
           IF CS10-COMPLETION-CODE NOT = ZEROES AND LOW-VALUES          05600000
              DISPLAY ' *** MQ COMPLETION CODE: ' CS10-COMPLETION-CODE  05610000
              DISPLAY ' *** MQ REASON         : ' CS10-REASON           05620000
              DISPLAY ' *** MQ ERROR MSG      : ' CS10-ERR-MSG          05630000
              MOVE 99                    TO  RETURN-CODE                05640000
           END-IF.                                                      05650000
                                                                        05660000
           PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT.                05670000
                                                                        05680000
       9100-EXIT.                                                       05690000
           EXIT.                                                        05700000
                                                                        05710000
      ****************************************************************  05720000
      **********            END OF BP13CS10                 **********  05730000
      ****************************************************************  05740000
