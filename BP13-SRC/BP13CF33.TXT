       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CF33.                                                 
      *AUTHOR.        ZARITA DANE SARMIENTO.                                    
      *DATE-WRITTEN.  14JUL2011.                                                
      * ====================================================== *                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT  (SOC)           *                
      *                                                        *                
      *    SYSTEM ID   : BP13                                  *                
      *                                                        *                
      *    OBJECTIVES :                                        *                
      *                                                        *                
      *    1. DETERMINE HARDLUCK APPLICANTS                    *                
      *                                                        *                
      *--------------------------------------------------------*                
      * CHG-NO  BY  DATE      DETAILS                          *                
      *=======  === ========= =================================*                
      *BP134292 ZDD 20110714  NEW PGM                          *                
      *BP134367 JB8 20110927  TO BYPASS MATURE ESTATE          *                
      *BP135190 SMR 20131204  EXPAND BP13K813 TO 1000          *                
      *BP135237 LSB 20140302  FT, FT2T COUNT >2, 2T COUNT > 3  *                
      *BP135237 IMC 20140303  CATER FOR G3 CASES               *                
      *BP135237 ZDD 20140328  CATER FOR HARLUCK COUNT          *                
      *BP135351 IMC 20140529  ADD NEW COND WHEN UPDATE BP13K730*                
      *BP135635 LSB 20150120  CATER FOR FTS 6 COUNTS           *                
      *BP135785 FNP 22072015  CATER FOR BP13K585 KEY EXPANSION *                
      *BP136160 FNP 20150314  CATER FOR HOUSEHOLD INCOME CHECKING,              
      *                       STS, PPO AND NTIMER CASES        *                
      *BP136740 FNP 20170609  CATER FOR SAP                    *                
      *BP137336 IL5 20180514  NON-ELDERLY FTS COUNT >= 5       *                
      *========================================================*                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F500 ASSIGN TO BP13F500.                                  
                                                                                
           SELECT BP13K585 ASSIGN TO BP13K585                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K585-KEY-FLD                               
                  FILE STATUS     IS WS-K585-STATUS.                            
                                                                                
           SELECT BP13K825 ASSIGN TO BP13K825                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K825-KEY-FLD                               
                  FILE STATUS     IS WS-K825-STATUS.                            
                                                                                
           SELECT BP13K730 ASSIGN TO BP13K730                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K730-NUM-REGN                              
                  FILE STATUS     IS WS-K730-STATUS.                            
                                                                                
           SELECT BP13K813 ASSIGN TO BP13K813                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K813-KEY-FLD                               
                  FILE STATUS     IS WS-K813-STATUS.                            
                                                                                
           SELECT AB03K080     ASSIGN        TO AB03K080                        
                               ACCESS MODE   IS DYNAMIC                         
                               ORGANIZATION  IS INDEXED                         
                               RECORD KEY    IS K080-KEY                        
                               FILE STATUS   IS WS-K080-STATUS.                 
           SELECT AB03K030     ASSIGN        TO AB03K030                        
                               ACCESS MODE   IS RANDOM                          
                               ORGANIZATION  IS INDEXED                         
                               RECORD KEY    IS K030-NUM-HDB-REF                
                               FILE STATUS   IS WS-K030-STATUS.                 
                                                                                
           SELECT P13LF33A ASSIGN TO P13LF33A.                                  
           SELECT P13LF33B ASSIGN TO P13LF33B.                                  
           SELECT P13F500A ASSIGN TO P13F500A.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F500                                                            
            RECORDING MODE    F                                                 
            BLOCK CONTAINS    0 RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORD CONTAINS 500  CHARACTERS.                                    
       COPY BP13F500.                                                           
                                                                                
       FD   BP13K585                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K585.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K730                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K730.                                                           
                                                                                
       FD   BP13K813                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K813.                                                           
                                                                                
       FD   AB03K080                                                            
            RECORD CONTAINS 50 CHARACTERS.                                      
       COPY AB03K080.                                                           
       FD   AB03K030                                                            
            RECORD CONTAINS 800 CHARACTERS.                                     
       COPY AB03K030.                                                           
                                                                                
       FD   P13LF33A                                                            
            BLOCK CONTAINS    0 RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORD CONTAINS 450 CHARACTERS                                      
            RECORDING MODE  IS F.                                               
       01   P13LF33A-REC    PIC X(450).                                         
                                                                                
       FD   P13LF33B                                                            
            BLOCK CONTAINS    0 RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORD CONTAINS 450 CHARACTERS                                      
            RECORDING MODE  IS F.                                               
       01   P13LF33B-REC    PIC X(450).                                         
                                                                                
       FD   P13F500A                                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            RECORDING MODE  IS F.                                               
       01   P13F500A-REC    PIC X(500).                                         
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-FILE-CONTROLS.                                                    
           05  WS-F500-EOF-SW                 PIC X(1)  VALUE 'N'.              
           05  WS-K585-STATUS                 PIC 9(2)  VALUE 0.                
           05  WS-K825-STATUS                 PIC 9(2)  VALUE 0.                
           05  WS-K080-STATUS                 PIC 9(2)  VALUE ZEROES.           
           05  WS-K030-STATUS                 PIC 9(2)  VALUE ZEROES.           
           05  WS-K730-STATUS                 PIC 9(2)  VALUE 0.                
           05  WS-K813-STATUS                 PIC 9(2)  VALUE 0.                
           05  WS-CNT-READ-F500               PIC 9(6)  VALUE ZEROS.            
           05  WS-CNT-WRIT-LF33               PIC 9(6)  VALUE ZEROS.            
           05  WS-CNT-WRIT-F500A              PIC 9(6)  VALUE ZEROS.            
           05  WS-CNT-SMS-FOUND               PIC 9(6)  VALUE ZEROS.            
           05  WS-HARDLUCK-CTR                PIC 9(6)  VALUE ZEROS.            
           05  WS-NOT-HARDLUCK-CTR            PIC 9(6)  VALUE ZEROS.            
           05  WS-K730-UPD                    PIC 9(6)  VALUE ZEROS.            
           05  WS-K730-FND                    PIC 9(6)  VALUE ZEROS.            
           05  WS-K730-NFND                   PIC 9(6)  VALUE ZEROS.            
           05  WS-MATURE-CASE                 PIC 9(6)  VALUE ZEROS.            
           05  WS-STS-CASE                    PIC 9(6)  VALUE ZEROS.            
           05  WS-PPO-CASE                    PIC 9(6)  VALUE ZEROS.            
           05  WS-NTIMER-CASE                 PIC 9(6)  VALUE ZEROS.            
           05  WS-INCOME-GT6K                 PIC 9(6)  VALUE ZEROS.            
                                                                                
       01  WS-LF33-CONTROLS.                                                    
           05  WS-LF33-LINECTR-A              PIC 9(2)  VALUE 60.               
           05  WS-LF33-PAGECTR-A              PIC 9(5)  VALUE ZEROS.            
           05  WS-LF33-SNO-A                  PIC 9(5)  VALUE 0.                
           05  WS-LF33-LINECTR-B              PIC 9(2)  VALUE 60.               
           05  WS-LF33-PAGECTR-B              PIC 9(5)  VALUE ZEROS.            
           05  WS-LF33-SNO-B                  PIC 9(5)  VALUE 0.                
                                                                                
       01  WS-MISCELLANEOUS-VARS.                                               
           05  WS-FOUND                       PIC X(1)  VALUE 'N'.              
           05  WS-FLAG                        PIC X(1)  VALUE 'N'.              
           05  WS-SMS-FND                     PIC X(1)  VALUE 'N'.              
           05  WS-SMS-FND-REGNO               PIC X(1)  VALUE 'N'.              
           05  WS-K080-EOF                    PIC X(1)  VALUE 'N'.              
           05  WS-HARDLUCK                    PIC X(1)  VALUE 'N'.              
           05  WS-FS-HARDLUCK                 PIC X(1)  VALUE 'N'.              
           05  WS-NUM-NRIC                    PIC X(9)  VALUE SPACES.           
           05  WS-NAME                        PIC X(66) VALUE SPACES.           
           05  WS-NAME1                       PIC X(66) VALUE SPACES.           
           05  WS-NAME2                       PIC X(66) VALUE SPACES.           
           05  WS-NAME3                       PIC X(66) VALUE SPACES.           
           05  WS-NAME4                       PIC X(66) VALUE SPACES.           
           05  WS-NRIC-FOUND             PIC X(1)  VALUE 'N'.                   
           05  WS-K080-NRIC-PREV         PIC X(9)  VALUE SPACES.                
           05  WS-HARDLUCK-CNT                PIC 9(2)  VALUE ZEROES.           
           05  WS-F585-TRANS                  PIC X(1)  VALUE SPACES.           
                                                                                
       01  WS-TIME-DATES.                                                       
           05  WS-SYSTEM-DATE.                                                  
               10  WS-SYS-CCYY.                                                 
                   15  WS-SYS-CC              PIC 9(2).                         
                   15  WS-SYS-YY              PIC 9(2).                         
               10  WS-SYS-MM                  PIC 9(2).                         
               10  WS-SYS-DD                  PIC 9(2).                         
                                                                                
           05  WS-EDITED-DATE.                                                  
               10  WS-EDITED-DD               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-MM               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-YY               PIC 9(4).                         
                                                                                
                                                                                
      *============================================================*            
      *         BP13LF33  -  R E P O R T    L A Y O U T            *            
      *============================================================*            
                                                                                
       01  LF33-HEADER-1A.                                                      
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'P13LF33A'.              
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(25)     VALUE SPACES.                  
           05  FILLER              PIC X(41)     VALUE                          
               '  FT - FT  HARDLUCK CASE FOR BALLOTING   '.                     
           05  FILLER              PIC X(12)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE :'.                
           05  LF33-RUN-DATE-A     PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
                                                                                
       01  LF33-HEADER-1B.                                                      
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'P13LF33B'.              
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(25)     VALUE SPACES.                  
           05  FILLER              PIC X(41)     VALUE                          
               '  FT - ST  HARDLUCK CASE FOR BALLOTING   '.                     
           05  FILLER              PIC X(12)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE :'.                
           05  LF33-RUN-DATE-B     PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
                                                                                
       01  LF33-HEADER-2A.                                                      
           05  FILLER              PIC X(41)     VALUE SPACES.                  
           05  FILLER              PIC X(55)     VALUE                          
           '        REPORT ON HARDLUCK APPLICANTS            '.                 
                                                                                
                                                                                
       01  LF33-HEADER-03.                                                      
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE ' S/N '.                 
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'BTO'.                   
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'NT'.                    
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'FT'.                    
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'HH'.                    
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'BHH'.                   
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'REG NUM '.              
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(30)     VALUE 'HA1 NAME'.              
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE 'NRIC 1   '.             
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(30)     VALUE 'HA2 NAME'.              
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE 'NRIC 2   '.             
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(30)     VALUE 'HA3 NAME'.              
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE 'NRIC 3   '.             
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(30)     VALUE 'HA4 NAME'.              
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE 'NRIC 4   '.             
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'ETHNIC GRP'.            
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(12)     VALUE 'ALLOC SCHEME'.          
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(11)     VALUE 'ELIG SCHEME'.           
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  FILLER              PIC X(9)      VALUE 'TOTAL CNT'.             
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  FILLER              PIC X(5)      VALUE 'TRANS'.                 
                                                                                
       01  LF33-HEADER-04.                                                      
           05  FILLER              PIC X(130)    VALUE ALL ' '.                 
                                                                                
       01  LF33-DETAIL.                                                         
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  LF33-SNO            PIC ZZZZ9.                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-BTO-PROJ       PIC X(03).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NT             PIC X(02).                                   
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LF33-FLAT-TYPE      PIC X(02).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-HH             PIC X(01).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-BHH            PIC X(01).                                   
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  LF33-REGNUM         PIC X(08).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NME-HA1        PIC X(30).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NRIC1          PIC X(09).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NME-HA2        PIC X(30).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NRIC2          PIC X(09).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NME-HA3        PIC X(30).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NRIC3          PIC X(09).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NME-HA4        PIC X(30).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-NRIC4          PIC X(09).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-ETHNIC         PIC X(10).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-ALLOC          PIC X(12).                                   
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LF33-ELIG           PIC X(11).                                   
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  LF33-TOT-CNT        PIC X(9).                                    
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  LF33-TRANS          PIC X(1).                                    
                                                                                
      ****************************************************************          
       PROCEDURE DIVISION.                                                      
      ****************************************************************          
       0000-MAIN-ROUTINE.                                                       
      ****************************************************************          
                                                                                
           PERFORM 1000-OPEN-ROUTINE      THRU 1000-EXIT.                       
                                                                                
           PERFORM 3000-PROCESS-F500      THRU 3000-EXIT                        
                  UNTIL WS-F500-EOF-SW = 'Y'.                                   
                                                                                
           PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       1000-OPEN-ROUTINE.                                                       
      ****************************************************************          
                                                                                
           OPEN INPUT  BP13F500                                                 
                       BP13K585                                                 
                       BP13K825                                                 
                       BP13K813                                                 
                       AB03K080                                                 
                       AB03K030                                                 
                I-O    BP13K730                                                 
                OUTPUT P13LF33A                                                 
                       P13LF33B                                                 
                       P13F500A.                                                
                                                                                
           IF WS-K585-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K585 OPEN ERROR, STATUS IS ' WS-K585-STATUS          
              MOVE WS-K585-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K825 OPEN ERROR, STATUS IS ' WS-K825-STATUS          
              MOVE WS-K825-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K730 OPEN ERROR, STATUS IS ' WS-K730-STATUS          
              MOVE WS-K730-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           IF WS-K813-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K813 OPEN ERROR, STATUS IS ' WS-K813-STATUS          
              MOVE WS-K813-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           IF WS-K080-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K080 OPEN ERROR, STATUS IS ' WS-K080-STATUS          
              MOVE WS-K080-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           IF WS-K030-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K080 OPEN ERROR, STATUS IS ' WS-K030-STATUS          
              MOVE WS-K030-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO  WS-SYSTEM-DATE.                 
           MOVE   WS-SYS-DD           TO WS-EDITED-DD.                          
           MOVE   WS-SYS-MM           TO WS-EDITED-MM.                          
           MOVE   WS-SYS-CCYY         TO WS-EDITED-YY.                          
           MOVE   WS-EDITED-DATE      TO LF33-RUN-DATE-A                        
                                         LF33-RUN-DATE-B.                       
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2000-READ-F500.                                                          
      ****************************************************************          
                                                                                
           MOVE SPACES        TO WS-F585-TRANS.                                 
                                                                                
           READ BP13F500                                                        
              AT END MOVE 'Y' TO WS-F500-EOF-SW                                 
              GO TO 3000-EXIT                                                   
           END-READ.                                                            
                                                                                
           ADD  +1                TO WS-CNT-READ-F500.                          
                                                                                
           IF F500-CDE-ALLOC-SCH = 'FTS' OR                                     
              (F500-CDE-ALLOC-SCH = 'SAP' AND                                   
              (F500-CDE-ELIG-SCH  = 'SSC' OR 'JSS' OR 'NCS'))                   
              MOVE '4' TO WS-F585-TRANS                                         
           ELSE                                                                 
            IF F500-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                           
               MOVE '1' TO WS-F585-TRANS                                        
            ELSE                                                                
             IF F500-CDE-BALLOT-HOUSEHOLD = 'G' OR 'F' OR 'N'                   
               IF F500-NUM-FT2T = 'Y'                                           
                  MOVE '2' TO WS-F585-TRANS                                     
               ELSE                                                             
                  MOVE '3' TO WS-F585-TRANS                                     
               END-IF                                                           
             END-IF                                                             
            END-IF                                                              
           END-IF.                                                              
                                                                                
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2100-READ-K585.                                                          
      ****************************************************************          
                                                                                
           READ BP13K585.                                                       
                                                                                
           EVALUATE WS-K585-STATUS                                              
             WHEN 00                                                            
                IF K585-NUM-TRANS = 1                                           
                   IF K585-NUM-UNSUCC-BTO >= 2                                  
                     MOVE 'Y'  TO WS-HARDLUCK                                   
                     MOVE K585-NUM-UNSUCC-BTO TO WS-HARDLUCK-CNT                
                   END-IF                                                       
                END-IF                                                          
                IF K585-NUM-TRANS = 2                                           
                   IF K585-NUM-UNSUCC-BTO >= 2                                  
                     MOVE 'Y'  TO WS-HARDLUCK                                   
                     MOVE K585-NUM-UNSUCC-BTO TO WS-HARDLUCK-CNT                
                   END-IF                                                       
                END-IF                                                          
                IF K585-NUM-TRANS = 3                                           
                   IF K585-NUM-UNSUCC-BTO >= 3                                  
                     MOVE 'Y'  TO WS-HARDLUCK                                   
                     MOVE K585-NUM-UNSUCC-BTO TO WS-HARDLUCK-CNT                
                   END-IF                                                       
                END-IF                                                          
                IF K585-NUM-TRANS = 4                                           
                   IF K585-NUM-UNSUCC-BTO >= 5                                  
                     MOVE 'Y'  TO WS-HARDLUCK                                   
                     MOVE K585-NUM-UNSUCC-BTO TO WS-HARDLUCK-CNT                
                   END-IF                                                       
                END-IF                                                          
             WHEN 23                                                            
                MOVE 'N' TO WS-FOUND                                            
                                                                                
             WHEN OTHER                                                         
              DISPLAY 'ERROR WITH READ OF BP13K585. STATUS IS '                 
                       WS-K585-STATUS                                           
              MOVE WS-K585-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2500-START-K825.                                                         
      ****************************************************************          
                                                                                
           START BP13K825 KEY >  K825-KEY-FLD.                                  
                                                                                
           EVALUATE WS-K825-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                                                                                
                 PERFORM 2510-READNEXT-K825    THRU 2510-EXIT                   
                    UNTIL WS-FLAG = 'Y' OR WS-FS-HARDLUCK = 'Y' OR              
                        F500-NUM-REGN NOT = K825-NUM-REGN                       
              WHEN 10                                                           
              WHEN 23                                                           
                 MOVE 'N'   TO WS-FOUND                                         
              WHEN OTHER                                                        
                DISPLAY 'ERROR WITH START READ OF BP13K825. STATUS IS '         
                       WS-K825-STATUS                                           
                MOVE WS-K825-STATUS              TO RETURN-CODE                 
                PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2510-READNEXT-K825.                                                      
      ****************************************************************          
                                                                                
           READ BP13K825 NEXT RECORD.                                           
                                                                                
           EVALUATE WS-K825-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                                                                                
                 IF F500-NUM-REGN  = K825-NUM-REGN                              
                   IF K825-NUM-NRIC NOT = F500-NUM-NRIC1 AND                    
                                          F500-NUM-NRIC2 AND                    
                                          F500-NUM-NRIC3 AND                    
                                          F500-NUM-NRIC4                        
                     IF K825-NUM-RELATIONSHIP   = '09'                          
                        MOVE SPACES               TO BP13K585-REC               
                        MOVE K825-NUM-NRIC        TO K585-NUM-NRIC              
                        MOVE WS-F585-TRANS        TO K585-NUM-TRANS             
                        MOVE 'N'                  TO WS-HARDLUCK                
                        PERFORM 2100-READ-K585 THRU 2100-EXIT                   
                        IF WS-HARDLUCK = 'Y'                                    
                          PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT          
                          ADD 1 TO WS-HARDLUCK-CTR                              
                          MOVE 'Y'   TO WS-FS-HARDLUCK                          
                        END-IF                                                  
                     END-IF                                                     
                   END-IF                                                       
                 END-IF                                                         
              WHEN 10                                                           
              WHEN 23                                                           
                 MOVE 'Y'   TO WS-FLAG                                          
              WHEN OTHER                                                        
                DISPLAY 'ERROR WITH READNEXT   OF BP13K825. STATUS IS '         
                       WS-K825-STATUS                                           
                MOVE WS-K825-STATUS              TO RETURN-CODE                 
                PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       2510-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2550-READ-K825.                                                          
      ****************************************************************          
                                                                                
           READ BP13K825.                                                       
                                                                                
           EVALUATE WS-K825-STATUS                                              
             WHEN 00                                                            
                MOVE SPACES  TO WS-NAME                                         
                MOVE K825-NME-OCCP  TO WS-NAME                                  
                IF K825-NUM-NRIC-SPOUSE NOT = SPACES AND LOW-VALUES             
                   MOVE 'Y' TO WS-FOUND                                         
                ELSE                                                            
                   MOVE 'N' TO WS-FOUND                                         
                END-IF                                                          
             WHEN 23                                                            
                   MOVE SPACES  TO WS-NAME                                      
                   MOVE 'N' TO WS-FOUND                                         
             WHEN OTHER                                                         
              DISPLAY 'ERROR WITH READ OF BP13K825. STATUS IS '                 
                       WS-K825-STATUS                                           
              MOVE WS-K825-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
             END-EVALUATE.                                                      
                                                                                
       2550-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2560-READ-BP13K730.                                                      
      ****************************************************************          
                                                                                
           READ BP13K730.                                                       
                                                                                
           EVALUATE WS-K730-STATUS                                              
             WHEN 00                                                            
                   ADD 1 TO WS-K730-FND                                         
                   MOVE 'Y' TO WS-FOUND                                         
             WHEN 23                                                            
                   ADD 1 TO WS-K730-NFND                                        
                   MOVE 'N' TO WS-FOUND                                         
             WHEN OTHER                                                         
              DISPLAY 'ERROR WITH READ OF BP13K730. STATUS IS '                 
                       WS-K730-STATUS                                           
              MOVE WS-K730-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
             END-EVALUATE.                                                      
                                                                                
       2560-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2600-PROCESS-OUTPUT.                                                     
      ****************************************************************          
      ***** TRANS=3 UPDATE BP13K730 ONLY IF ALL NRIC NOT FND IN SMS ****        
           IF F500-CDE-ALLOC-SCH = 'FTS' OR                                     
              (F500-CDE-ALLOC-SCH = 'SAP' AND                                   
              (F500-CDE-ELIG-SCH  = 'SSC' OR 'JSS' OR 'NCS'))                   
              IF K585-NUM-TRANS = 4                                             
                 PERFORM  4200-UPDATE-K730     THRU 4200-EXIT                   
                 PERFORM  4000-WRITE-REPORT    THRU 4000-EXIT                   
                 PERFORM  4100-WRITE-F500A     THRU 4100-EXIT                   
              END-IF                                                            
           ELSE                                                                 
            IF K585-NUM-TRANS = 3                                               
              MOVE 'N'                     TO WS-SMS-FND-REGNO                  
              PERFORM 2700-CHECK-ALL-NRIC  THRU 2700-EXIT                       
              IF WS-SMS-FND-REGNO = 'N'                                         
                 PERFORM  4200-UPDATE-K730     THRU 4200-EXIT                   
                                                                                
                 PERFORM  4000-WRITE-REPORT    THRU 4000-EXIT                   
                 PERFORM  4100-WRITE-F500A     THRU 4100-EXIT                   
              ELSE                                                              
                 DISPLAY ' FDSMS=' F500-NUM-REGN                                
              END-IF                                                            
            ELSE                                                                
              IF K585-NUM-TRANS = 1 OR 2                                        
                 PERFORM  4200-UPDATE-K730     THRU 4200-EXIT                   
                 PERFORM  4000-WRITE-REPORT    THRU 4000-EXIT                   
                 PERFORM  4100-WRITE-F500A     THRU 4100-EXIT                   
              END-IF                                                            
            END-IF                                                              
           END-IF.                                                              
                                                                                
       2600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       2700-CHECK-ALL-NRIC.                                                     
      ****************************************************************          
                                                                                
      *****PROCESS HA1*****                                                     
           MOVE F500-NUM-NRIC1       TO WS-NUM-NRIC                             
                                                                                
           PERFORM 5000-START-AB03K080  THRU 5000-EXIT                          
           IF WS-SMS-FND = 'Y'                                                  
              ADD 1 TO WS-CNT-SMS-FOUND                                         
              GO TO 2700-EXIT                                                   
           END-IF                                                               
                                                                                
      *****PROCESS HA2*****                                                     
           MOVE F500-NUM-NRIC2       TO WS-NUM-NRIC                             
                                                                                
           PERFORM 5000-START-AB03K080  THRU 5000-EXIT                          
           IF WS-SMS-FND = 'Y'                                                  
              ADD 1 TO WS-CNT-SMS-FOUND                                         
              GO TO 2700-EXIT                                                   
           END-IF                                                               
                                                                                
      *****PROCESS HA3*****                                                     
           MOVE F500-NUM-NRIC3       TO WS-NUM-NRIC                             
                                                                                
           PERFORM 5000-START-AB03K080  THRU 5000-EXIT                          
           IF WS-SMS-FND = 'Y'                                                  
              ADD 1 TO WS-CNT-SMS-FOUND                                         
              GO TO 2700-EXIT                                                   
           END-IF                                                               
                                                                                
      *****PROCESS HA4*****                                                     
           MOVE F500-NUM-NRIC4       TO WS-NUM-NRIC                             
                                                                                
           PERFORM 5000-START-AB03K080  THRU 5000-EXIT                          
           IF WS-SMS-FND = 'Y'                                                  
              ADD 1 TO WS-CNT-SMS-FOUND                                         
              GO TO 2700-EXIT                                                   
           END-IF                                                               
                                                                                
      *****PROCESS HA1 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC1       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
              MOVE K825-NUM-NRIC-SPOUSE TO WS-NUM-NRIC                          
                                                                                
              PERFORM 5000-START-AB03K080  THRU 5000-EXIT                       
              IF WS-SMS-FND = 'Y'                                               
                 ADD 1 TO WS-CNT-SMS-FOUND                                      
                 GO TO 2700-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *****PROCESS HA2 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC2       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
              MOVE K825-NUM-NRIC-SPOUSE TO WS-NUM-NRIC                          
                                                                                
              PERFORM 5000-START-AB03K080  THRU 5000-EXIT                       
              IF WS-SMS-FND = 'Y'                                               
                 ADD 1 TO WS-CNT-SMS-FOUND                                      
                 GO TO 2700-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *****PROCESS HA3 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC3       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
              MOVE K825-NUM-NRIC-SPOUSE TO WS-NUM-NRIC                          
                                                                                
              PERFORM 5000-START-AB03K080  THRU 5000-EXIT                       
              IF WS-SMS-FND = 'Y'                                               
                 ADD 1 TO WS-CNT-SMS-FOUND                                      
                 GO TO 2700-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *****PROCESS HA4 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC4       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
              MOVE K825-NUM-NRIC-SPOUSE TO WS-NUM-NRIC                          
                                                                                
              PERFORM 5000-START-AB03K080  THRU 5000-EXIT                       
              IF WS-SMS-FND = 'Y'                                               
                 ADD 1 TO WS-CNT-SMS-FOUND                                      
                 GO TO 2700-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      *****PROCESS FIANCE/FIANCEE*****                                          
           MOVE 'N'                  TO WS-FLAG                                 
                                        WS-FOUND                                
                                        WS-FS-HARDLUCK                          
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           PERFORM 2500-START-K825 THRU 2500-EXIT.                              
                                                                                
       2700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       3000-PROCESS-F500.                                                       
      ****************************************************************          
                                                                                
           PERFORM 2000-READ-F500    THRU 2000-EXIT.                            
                                                                                
           PERFORM 8001-READ-BP13K813  THRU 8001-EXIT                           
                                                                                
           IF K813-NUM-MATURE-EST-TAG = 'Y'                                     
              DISPLAY ' F500-KEY : ' F500-KEY-FLD                               
                      ' NT1 : ' F500-CDE-NT1                                    
                      ' FT  : ' F500-CDE-FLAT-TYPE                              
                      ' BLT : ' F500-DTE-BALLOT                                 
                      ' MATURE : ' K813-NUM-MATURE-EST-TAG                      
              ADD 1                    TO WS-MATURE-CASE                        
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F500-AMT-HSE-INCOME NOT NUMERIC                                   
              MOVE ZEROES TO F500-AMT-HSE-INCOME                                
           END-IF.                                                              
                                                                                
           IF F500-CDE-FLAT-TYPE = '2F'                                         
              IF F500-CDE-ALLOC-SCH = 'STS'                                     
                 ADD 1 TO WS-STS-CASE                                           
                 GO TO 3000-EXIT                                                
              END-IF                                                            
              IF F500-NUM-PPO NOT = 'E' AND SPACES                              
                 ADD 1 TO WS-PPO-CASE                                           
                 GO TO 3000-EXIT                                                
              END-IF                                                            
              IF F500-NUM-NTIMER = 'Y'                                          
                 ADD 1 TO WS-NTIMER-CASE                                        
                 GO TO 3000-EXIT                                                
              END-IF                                                            
              IF F500-AMT-HSE-INCOME > 6000                                     
                 IF F500-NUM-INCOME-EXEMPTION NOT = SPACES                      
                    CONTINUE                                                    
                 ELSE                                                           
                    ADD 1                    TO WS-INCOME-GT6K                  
                    GO TO 3000-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
              DISPLAY ' F500-KEY : ' F500-KEY-FLD                               
                      ' NT1 : ' F500-CDE-NT1                                    
                      ' FT  : ' F500-CDE-FLAT-TYPE                              
                      ' BLT : ' F500-DTE-BALLOT                                 
                      ' INCOME : ' F500-AMT-HSE-INCOME                          
                      ' INC EXEMPT: ' F500-NUM-INCOME-EXEMPTION                 
                      ' PPO : ' F500-NUM-PPO                                    
                      ' NTIMER: ' F500-NUM-NTIMER                               
                      ' ALLOC: ' F500-CDE-ALLOC-SCH                             
           END-IF.                                                              
                                                                                
           MOVE SPACES               TO WS-NAME1                                
                                        WS-NAME2                                
                                        WS-NAME3                                
                                        WS-NAME4                                
                                        WS-NAME.                                
                                                                                
           MOVE ZEROES               TO WS-HARDLUCK-CNT                         
                                                                                
      *****PROCESS HA1*****                                                     
           MOVE SPACES               TO BP13K585-REC.                           
           MOVE F500-NUM-NRIC1       TO K585-NUM-NRIC.                          
           MOVE 'N'                  TO WS-HARDLUCK.                            
           MOVE WS-F585-TRANS        TO K585-NUM-TRANS.                         
                                                                                
           PERFORM 2100-READ-K585 THRU 2100-EXIT.                               
           IF WS-HARDLUCK = 'Y'                                                 
              PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                      
              ADD 1 TO WS-HARDLUCK-CTR                                          
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
      *****PROCESS HA2*****                                                     
           MOVE SPACES               TO BP13K585-REC                            
           MOVE F500-NUM-NRIC2       TO K585-NUM-NRIC                           
           MOVE 'N'                  TO WS-HARDLUCK                             
           MOVE WS-F585-TRANS        TO K585-NUM-TRANS.                         
                                                                                
           PERFORM 2100-READ-K585 THRU 2100-EXIT                                
           IF WS-HARDLUCK = 'Y'                                                 
              PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                      
              ADD 1 TO WS-HARDLUCK-CTR                                          
              GO TO 3000-EXIT                                                   
           END-IF                                                               
                                                                                
      *****PROCESS HA3*****                                                     
           MOVE SPACES               TO BP13K585-REC                            
           MOVE F500-NUM-NRIC3       TO K585-NUM-NRIC                           
           MOVE 'N'                  TO WS-HARDLUCK.                            
           MOVE WS-F585-TRANS        TO K585-NUM-TRANS.                         
                                                                                
           PERFORM 2100-READ-K585 THRU 2100-EXIT.                               
           IF WS-HARDLUCK = 'Y'                                                 
              PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                      
              ADD 1 TO WS-HARDLUCK-CTR                                          
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
      *****PROCESS HA4*****                                                     
           MOVE SPACES               TO BP13K585-REC                            
           MOVE F500-NUM-NRIC4       TO K585-NUM-NRIC                           
           MOVE 'N'                  TO WS-HARDLUCK.                            
           MOVE WS-F585-TRANS        TO K585-NUM-TRANS.                         
                                                                                
           PERFORM 2100-READ-K585 THRU 2100-EXIT.                               
           IF WS-HARDLUCK = 'Y'                                                 
              PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                      
              ADD 1 TO WS-HARDLUCK-CTR                                          
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
      *****PROCESS HA1 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC1       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
             MOVE SPACES               TO BP13K585-REC                          
             MOVE K825-NUM-NRIC-SPOUSE TO K585-NUM-NRIC                         
             MOVE 'N'                  TO WS-HARDLUCK                           
             MOVE WS-F585-TRANS        TO K585-NUM-TRANS                        
                                                                                
             PERFORM 2100-READ-K585 THRU 2100-EXIT                              
             IF WS-HARDLUCK = 'Y'                                               
                PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                    
                ADD 1 TO WS-HARDLUCK-CTR                                        
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           END-IF.                                                              
                                                                                
      *****PROCESS HA2 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC2       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
             MOVE SPACES               TO BP13K585-REC                          
             MOVE K825-NUM-NRIC-SPOUSE TO K585-NUM-NRIC                         
             MOVE 'N'                  TO WS-HARDLUCK                           
             MOVE WS-F585-TRANS        TO K585-NUM-TRANS                        
                                                                                
             PERFORM 2100-READ-K585 THRU 2100-EXIT                              
             IF WS-HARDLUCK = 'Y'                                               
                PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                    
                ADD 1 TO WS-HARDLUCK-CTR                                        
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           END-IF.                                                              
                                                                                
      *****PROCESS HA3 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC3       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
             MOVE SPACES               TO BP13K585-REC                          
             MOVE K825-NUM-NRIC-SPOUSE TO K585-NUM-NRIC                         
             MOVE 'N'                  TO WS-HARDLUCK                           
             MOVE WS-F585-TRANS        TO K585-NUM-TRANS                        
                                                                                
             PERFORM 2100-READ-K585 THRU 2100-EXIT                              
             IF WS-HARDLUCK = 'Y'                                               
                PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                    
                ADD 1 TO WS-HARDLUCK-CTR                                        
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           END-IF.                                                              
                                                                                
      *****PROCESS HA4 SPOUSE*****                                              
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC4       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
                                                                                
           IF WS-FOUND = 'Y'                                                    
             MOVE SPACES               TO BP13K585-REC                          
             MOVE K825-NUM-NRIC-SPOUSE TO K585-NUM-NRIC                         
             MOVE 'N'                  TO WS-HARDLUCK                           
             MOVE WS-F585-TRANS        TO K585-NUM-TRANS                        
                                                                                
             PERFORM 2100-READ-K585 THRU 2100-EXIT                              
             IF WS-HARDLUCK = 'Y'                                               
                PERFORM  2600-PROCESS-OUTPUT  THRU 2600-EXIT                    
                ADD 1 TO WS-HARDLUCK-CTR                                        
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           END-IF.                                                              
                                                                                
      *****PROCESS FIANCE/FIANCEE*****                                          
           MOVE 'N'                  TO WS-FLAG                                 
                                        WS-FOUND                                
                                        WS-FS-HARDLUCK                          
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           PERFORM 2500-START-K825 THRU 2500-EXIT.                              
                                                                                
           IF WS-FS-HARDLUCK = 'N'                                              
             WRITE P13F500A-REC  FROM BP13F500-REC                              
             ADD 1 TO  WS-NOT-HARDLUCK-CTR                                      
                       WS-CNT-WRIT-F500A                                        
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       4000-WRITE-REPORT.                                                       
      ****************************************************************          
                                                                                
           MOVE SPACES                          TO  LF33-DETAIL.                
           INITIALIZE                               LF33-DETAIL.                
                                                                                
           MOVE SPACES               TO BP13K825-REC                            
           MOVE F500-NUM-REGN        TO K825-NUM-REGN                           
           MOVE F500-NUM-NRIC1       TO K825-NUM-NRIC                           
           PERFORM 2550-READ-K825  THRU 2550-EXIT                               
           MOVE WS-NAME              TO WS-NAME1                                
                                                                                
           MOVE F500-NUM-NRIC1                  TO LF33-NRIC1                   
           MOVE WS-NAME1                        TO LF33-NME-HA1                 
                                                                                
           IF F500-NUM-NRIC2(1:1) NOT = '#'                                     
             MOVE SPACES               TO BP13K825-REC                          
             MOVE F500-NUM-REGN                 TO K825-NUM-REGN                
             MOVE F500-NUM-NRIC2                TO K825-NUM-NRIC                
             PERFORM 2550-READ-K825  THRU 2550-EXIT                             
             MOVE WS-NAME                       TO WS-NAME2                     
             MOVE F500-NUM-NRIC2                TO LF33-NRIC2                   
             MOVE WS-NAME2                      TO LF33-NME-HA2                 
           END-IF.                                                              
           IF F500-NUM-NRIC3(1:1) NOT = '#'                                     
             MOVE SPACES               TO BP13K825-REC                          
             MOVE F500-NUM-REGN                 TO K825-NUM-REGN                
             MOVE F500-NUM-NRIC3                TO K825-NUM-NRIC                
             PERFORM 2550-READ-K825  THRU 2550-EXIT                             
             MOVE WS-NAME                       TO WS-NAME3                     
             MOVE F500-NUM-NRIC3                TO LF33-NRIC3                   
             MOVE WS-NAME3                      TO LF33-NME-HA3                 
           END-IF.                                                              
           IF F500-NUM-NRIC4(1:1) NOT = '#'                                     
             MOVE SPACES               TO BP13K825-REC                          
             MOVE F500-NUM-REGN                 TO K825-NUM-REGN                
             MOVE F500-NUM-NRIC4                TO K825-NUM-NRIC                
             PERFORM 2550-READ-K825  THRU 2550-EXIT                             
             MOVE WS-NAME                       TO WS-NAME4                     
             MOVE F500-NUM-NRIC4                TO LF33-NRIC4                   
             MOVE WS-NAME4                      TO LF33-NME-HA4                 
           END-IF.                                                              
           MOVE F500-NUM-REGN                   TO LF33-REGNUM                  
           MOVE F500-CDE-HOUSEHOLD              TO LF33-HH                      
           MOVE F500-CDE-BALLOT-HOUSEHOLD       TO LF33-BHH                     
           MOVE F500-CDE-NT1                    TO LF33-BTO-PROJ                
           MOVE K813-CDE-NT                     TO LF33-NT                      
           MOVE F500-CDE-FLAT-TYPE              TO LF33-FLAT-TYPE               
           MOVE F500-CDE-CATEGORY               TO LF33-ETHNIC                  
           MOVE F500-CDE-ALLOC-SCH              TO LF33-ALLOC                   
           MOVE F500-CDE-ELIG-SCH               TO LF33-ELIG                    
           MOVE K585-NUM-UNSUCC-BTO             TO LF33-TOT-CNT                 
           MOVE K585-NUM-TRANS                  TO LF33-TRANS                   
                                                                                
           IF K585-NUM-TRANS = 1 OR 2 OR 4                                      
             ADD  1                             TO WS-LF33-SNO-A                
             MOVE WS-LF33-SNO-A                 TO LF33-SNO                     
             IF WS-LF33-SNO-A = 1                                               
               WRITE P13LF33A-REC    FROM LF33-HEADER-1A                        
               WRITE P13LF33A-REC    FROM LF33-HEADER-03                        
               WRITE P13LF33A-REC    FROM LF33-HEADER-04                        
             END-IF                                                             
             WRITE P13LF33A-REC    FROM LF33-DETAIL                             
           END-IF.                                                              
                                                                                
           IF K585-NUM-TRANS = 3                                                
             ADD  1                             TO WS-LF33-SNO-B                
             MOVE WS-LF33-SNO-B                 TO LF33-SNO                     
             IF WS-LF33-SNO-B = 1                                               
               WRITE P13LF33B-REC    FROM LF33-HEADER-1B                        
               WRITE P13LF33B-REC    FROM LF33-HEADER-03                        
               WRITE P13LF33B-REC    FROM LF33-HEADER-04                        
             END-IF                                                             
             WRITE P13LF33B-REC    FROM LF33-DETAIL                             
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       4100-WRITE-F500A.                                                        
      ****************************************************************          
                                                                                
           MOVE SPACES           TO P13F500A-REC.                               
           MOVE K585-NUM-TRANS   TO F500-NUM-HARDLUCK                           
           WRITE P13F500A-REC  FROM BP13F500-REC                                
           ADD 1                 TO WS-CNT-WRIT-F500A.                          
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       4200-UPDATE-K730.                                                        
      ****************************************************************          
                                                                                
           MOVE SPACES                 TO BP13K730-REC.                         
           MOVE 'N'                    TO WS-FOUND.                             
           MOVE F500-NUM-REGN          TO K730-NUM-REGN.                        
                                                                                
           PERFORM 2560-READ-BP13K730  THRU 2560-EXIT.                          
           IF WS-FOUND = 'Y'                                                    
              MOVE K585-NUM-TRANS      TO K730-NUM-HARDLUCK                     
              MOVE WS-HARDLUCK-CNT     TO K730-NUM-HARDLUCK-COUNT               
              PERFORM 4250-REWRITE-BP13K730   THRU 4250-EXIT                    
           END-IF.                                                              
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       4250-REWRITE-BP13K730.                                                   
      ****************************************************************          
                                                                                
           REWRITE BP13K730-REC.                                                
                                                                                
           EVALUATE WS-K730-STATUS                                              
             WHEN 00                                                            
                   ADD 1 TO WS-K730-UPD                                         
             WHEN OTHER                                                         
              DISPLAY 'ERROR WITH UPDATING OF BP13K730. STATUS IS '             
                       WS-K730-STATUS                                           
              MOVE WS-K730-STATUS              TO RETURN-CODE                   
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                     
             END-EVALUATE.                                                      
                                                                                
       4250-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************************************************             
       5000-START-AB03K080.                                                     
      *************************************************************             
           MOVE SPACES                   TO AB03K080-REC.                       
           INITIALIZE                       AB03K080-REC.                       
                                                                                
           MOVE WS-NUM-NRIC              TO K080-NUM-UIN                        
                                            WS-K080-NRIC-PREV.                  
           MOVE 'N'                      TO WS-K080-EOF                         
                                            WS-SMS-FND                          
                                            WS-NRIC-FOUND.                      
                                                                                
           START AB03K080 KEY >= K080-KEY.                                      
                                                                                
           EVALUATE WS-K080-STATUS                                              
               WHEN 00                                                          
                    PERFORM 5100-READNEXT-AB03K080 THRU 5100-EXIT               
                      UNTIL K080-NUM-UIN NOT = WS-K080-NRIC-PREV                
                         OR WS-K080-EOF = 'Y'                                   
                         OR WS-NRIC-FOUND = 'Y'                                 
               WHEN 10                                                          
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    DISPLAY 'AB03K080 START ERROR ' WS-K080-STATUS              
                    DISPLAY 'K080 KEY: ' K080-KEY                               
                    MOVE WS-K080-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *************************************************************             
       5100-READNEXT-AB03K080.                                                  
      *************************************************************             
           READ AB03K080 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'                 TO WS-K080-EOF                         
           END-READ.                                                            
                                                                                
           EVALUATE WS-K080-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    IF K080-NUM-UIN = WS-K080-NRIC-PREV                         
                       PERFORM 5500-READ-AB03K030 THRU 5500-EXIT                
                                                                                
                    END-IF                                                      
               WHEN 10                                                          
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    DISPLAY 'AB03K080 READ NEXT ERROR ' WS-K080-STATUS          
                    DISPLAY 'K080 KEY: ' K080-KEY                               
                    MOVE WS-K080-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       5100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *************************************************************             
       5500-READ-AB03K030.                                                      
      *************************************************************             
           MOVE SPACES                   TO AB03K030-REC.                       
           INITIALIZE                       AB03K030-REC.                       
                                                                                
           MOVE K080-NUM-HDB-REF         TO K030-NUM-HDB-REF.                   
                                                                                
           READ AB03K030.                                                       
                                                                                
           EVALUATE WS-K030-STATUS                                              
               WHEN 00                                                          
                    IF K030-CDE-ACCT-STAT = 'C'                                 
                       MOVE 'Y'        TO WS-SMS-FND                            
                                          WS-SMS-FND-REGNO                      
                                          WS-NRIC-FOUND                         
                    END-IF                                                      
               WHEN 10                                                          
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    DISPLAY 'AB03K030 READ ERROR ' WS-K030-STATUS               
                    DISPLAY 'K030 KEY: ' K030-NUM-HDB-REF                       
                    MOVE WS-K030-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ****************************************************************          
       8001-READ-BP13K813.                                                      
      ****************************************************************          
                                                                                
           MOVE SPACES                 TO K813-KEY-FLD                          
           INITIALIZE                     K813-KEY-FLD                          
                                                                                
           MOVE F500-CDE-NT1           TO K813-NUM-ZONE                         
                                                                                
           START BP13K813 KEY >= K813-KEY-FLD                                   
                                                                                
           IF WS-K813-STATUS = 00 OR 02                                         
              READ BP13K813 NEXT RECORD                                         
              IF WS-K813-STATUS = 00 OR 02                                      
                 IF F500-CDE-NT1 = K813-NUM-ZONE                                
                    CONTINUE                                                    
                 ELSE                                                           
                    DISPLAY ' NT1 NOT FND : ' F500-CDE-NT1                      
                            ' KEY : ' F500-KEY-FLD                              
                    MOVE SPACES         TO K813-NUM-MATURE-EST-TAG              
                                           K813-CDE-NT                          
                 END-IF                                                         
              ELSE                                                              
                 IF WS-K813-STATUS = 10 OR 23                                   
                    DISPLAY ' NT1 NOT FND : ' F500-CDE-NT1                      
                            ' KEY : ' F500-KEY-FLD                              
                    MOVE SPACES         TO K813-NUM-MATURE-EST-TAG              
                                           K813-CDE-NT                          
                 ELSE                                                           
                    DISPLAY 'BP13K813 - READ ERROR (' WS-K813-STATUS ')'        
                    MOVE WS-K813-STATUS TO RETURN-CODE                          
                    GO TO 9999-CLOSE-ROUTINE                                    
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              DISPLAY 'BP13K813 - READ ERROR (' WS-K813-STATUS ')'              
              MOVE WS-K813-STATUS       TO RETURN-CODE                          
              GO TO 9999-CLOSE-ROUTINE                                          
           END-IF.                                                              
                                                                                
       8001-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************************************************          
       9999-CLOSE-ROUTINE.                                                      
      ****************************************************************          
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '*===========BP13CF33 CONTROL TOTALS============*'.          
           DISPLAY SPACES.                                                      
           DISPLAY 'BP13F500 RECORDS READ      = ' WS-CNT-READ-F500.            
           DISPLAY 'NO OF HARDLUCK CASES       = ' WS-HARDLUCK-CTR.             
           DISPLAY 'NO OF NOT HARDLUCK CASES   = ' WS-NOT-HARDLUCK-CTR.         
           DISPLAY 'NO OF CASES WRITTEN LF33 FT= ' WS-LF33-SNO-A.               
           DISPLAY 'NO OF CASES WRITTEN LF33 ST= ' WS-LF33-SNO-B.               
           DISPLAY 'NO OF CASES WRITTEN F500   = ' WS-CNT-WRIT-F500A.           
           DISPLAY 'NO OF CASES FOUND IN K730  = ' WS-K730-FND.                 
           DISPLAY 'NO OF CASES NOT FND IN K730= ' WS-K730-NFND.                
           DISPLAY 'NO OF CASES UPDATED IN K730= ' WS-K730-UPD.                 
           DISPLAY 'NO OF MATURE CASES FOUND   = ' WS-MATURE-CASE.              
           DISPLAY 'NO OF STS CASES FOUND      = ' WS-STS-CASE.                 
           DISPLAY 'NO OF PPO CASES FOUND      = ' WS-PPO-CASE.                 
           DISPLAY 'NO OF NTIMER CASES FOUND   = ' WS-NTIMER-CASE.              
           DISPLAY 'NO OF CASES W/ INCOME >6K  = ' WS-INCOME-GT6K.              
           DISPLAY 'NO OF CASES FOUND IN SMS   = ' WS-CNT-SMS-FOUND.            
           DISPLAY SPACES.                                                      
           DISPLAY '*==============================================*'.          
                                                                                
           CLOSE BP13F500                                                       
                 BP13K825                                                       
                 BP13K585                                                       
                 BP13K730                                                       
                 BP13K813                                                       
                 AB03K080                                                       
                 AB03K030                                                       
                 P13LF33A                                                       
                 P13LF33B                                                       
                 P13F500A.                                                      
                                                                                
           IF WS-K585-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K585 CLOSE ERROR, STATUS IS ' WS-K585-STATUS         
              MOVE WS-K585-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K825 CLOSE ERROR, STATUS IS ' WS-K825-STATUS         
              MOVE WS-K825-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
           IF WS-K813-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K813 CLOSE ERROR, STATUS IS ' WS-K813-STATUS         
              MOVE WS-K813-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K730 CLOSE ERROR, STATUS IS ' WS-K730-STATUS         
              MOVE WS-K730-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
           IF WS-K080-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K080 CLOSE ERROR, STATUS IS ' WS-K080-STATUS         
              MOVE WS-K080-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
           IF WS-K030-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K030 CLOSE ERROR, STATUS IS ' WS-K030-STATUS         
              MOVE WS-K030-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
       9999-EXIT.                                                               
           EXIT.                                                                
