       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CZ26.                                                 
      *AUTHOR.        IMC1.                                                     
      *DATE-WRITTEN.  30JAN2013.                                                
      * ========================================================== *            
      * SYSTEM OF COMMITMENT  (BP13)                               *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE   : GET DETAIL INFORMATION FOR PPS APPLICATION  *            
      *                GET DTE-OBTAIN-CITIZEN FROM MHA FILE.       *            
      *                                                            *            
      *  INPUT FILES : 1.  BP13F730  -  SOC REQ FILE               *            
      *                2.  BP13K825  -  OCCUPIER FILE              *            
      *                3.  BP13K515  -  FROM BE01F515              *            
      *                                                            *            
      *  OUTPUT FILE : 1.  BP13F595                                *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * CHG REF  BY    DATE    DESCRIPTION                         *            
      * -------- ---  ------   -----------                         *            
      * BP134931 IMC  20130130 NEW PROGRAM.                        *            
      * BP134931 IMC  20130718 ADD NEW OUTPUT REPORT.              *            
      * BP135190 SMR2 20131204 EXPAND BP13K813 TO 1000             *            
      * BP136252 FNP1 20160615 ADD ALLO-CAT AND NT                 *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
      *-------------------------------------------------------------            
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F730  ASSIGN        TO BP13F730.                          
                                                                                
           SELECT BP13K825  ASSIGN        TO BP13K825                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K825-KEY-FLD                       
                            FILE STATUS   IS WS-K825-STATUS.                    
                                                                                
           SELECT BP13K828  ASSIGN        TO BP13K828                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K828-KEY-FLD                       
                            FILE STATUS   IS WS-K828-STATUS.                    
                                                                                
           SELECT BP13K515  ASSIGN        TO BP13K515                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K515-KEY-FLD                       
                            FILE STATUS   IS WS-K515-STATUS.                    
                                                                                
           SELECT BP13K813  ASSIGN        TO BP13K813                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K813-KEY-FLD                       
                            FILE STATUS   IS WS-K813-STATUS.                    
                                                                                
           SELECT BP13F595  ASSIGN        TO BP13F595.                          
                                                                                
           SELECT BP13LZ26  ASSIGN        TO BP13LZ26.                          
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F730                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13F730.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K828                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K828.                                                           
                                                                                
       FD   BP13K515                                                            
            RECORD CONTAINS 580 CHARACTERS.                                     
       COPY BP13K515.                                                           
                                                                                
       FD   BP13K813                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K813.                                                           
                                                                                
       FD  BP13F595                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 500 CHARACTERS.                                      
       COPY BP13F595.                                                           
                                                                                
       FD   BP13LZ26                                                            
            RECORD CONTAINS 133 CHARACTERS.                                     
       01   BP13LZ26-REC        PIC X(133).                                     
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
                                                                                
       01  WS-STATUS.                                                           
           05  WS-K825-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K828-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K830-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K813-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K816-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K515-STATUS               PIC 99    VALUE ZEROS.              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F730-NOT-FND              PIC 9(06)  VALUE ZEROS.             
           05  WS-NOT-FND-K740              PIC X     VALUE 'N'.                
           05  WS-K740-NOT-FND              PIC 9(06)  VALUE ZEROS.             
           05  WS-F730-READ-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-FOUT-WRT-CTR              PIC 9(06)  VALUE ZEROS.             
           05  WS-K825-NOTFND               PIC 9(06)  VALUE ZEROS.             
           05  WS-K828-NOTFND               PIC 9(06)  VALUE ZEROS.             
           05  WS-K515-FND                  PIC 9(06)  VALUE ZEROS.             
           05  WS-K515-NOTFND               PIC 9(06)  VALUE ZEROS.             
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-F730-EOF                  PIC X     VALUE 'N'.                
           05  WS-K740-EOF                  PIC X     VALUE 'N'.                
           05  WS-K825-EOF                  PIC X     VALUE 'N'.                
           05  WS-K828-EOF                  PIC X     VALUE 'N'.                
           05  WS-K515-EOF                  PIC X     VALUE 'N'.                
           05  WS-K825-PROCESS              PIC X     VALUE 'N'.                
           05  WS-NOT-FND-K825-K828         PIC X     VALUE 'N'.                
           05  WS-FS-FND                    PIC X     VALUE 'N'.                
           05  WS-NUM-NRIC-K515             PIC X(09) VALUE ZEROES.             
           05  WS-NRIC-DATE                 PIC 9(02) VALUE ZEROES.             
           05  WS-NRIC-DATE-S               PIC 9(02) VALUE ZEROES.             
           05  WS-SPOUSE-DATE               PIC 9(02) VALUE ZEROES.             
           05  WS-SNO                       PIC 9(07) VALUE ZEROES.             
           05  WS-DTE-OPEN-BTO              PIC 9(8)  VALUE ZEROES.             
           05  WS-DTE-OBTAIN-CTZN           PIC 9(8)  VALUE ZEROES.             
           05  WS-DTE-CITIZEN               PIC 9(8)  VALUE ZEROES.             
           05  WS-DATE                   PIC 9(6)     VALUE ZEROES.             
           05  WS-RED-DATE REDEFINES WS-DATE.                                   
               07 WS-DATE-COMP           PIC 9(04).                             
               07 WS-NUM-REMNG           PIC 9(02).                             
           05 WS-NUM-CITIZENSHIP-SPOUSE     PIC X(2)  VALUE SPACES.             
           05 WS-NUM-CITIZENSHIP-S          PIC X(2)  VALUE SPACES.             
           05 WS-NUM-NEW-TOWN               PIC X(3)  VALUE SPACES.             
                                                                                
       01  WS-DATE-VARIABLES.                                                   
           05  WS-CURR-DATE                 PIC 9(8)  VALUE ZEROES.             
           05  WS-DAYS                      PIC 9(7)  VALUE ZEROES.             
           05  WS-APPMT-TIME.                                                   
               10  WS-APPMT-HR              PIC 9(2)  VALUE 00.                 
               10  WS-APPMT-MIN             PIC 9(2)  VALUE 00.                 
                                                                                
       01  WS-K825-REC.                                                         
           05 WS-KEY-FLD.                                                       
              10 WS-NUM-REGN        PIC X(8).                                   
              10 WS-NUM-MATURE-KEY REDEFINES WS-NUM-REGN.                       
                 15 WS-NUM-REF      PIC X(8).                                   
              10 WS-NUM-NRIC        PIC X(9).                                   
           05 FILLER                  PIC X(1).                                 
           05 WS-NUM-CPF            PIC X(9).                                   
           05 WS-NME-OCCP           PIC X(66).                                  
           05 WS-NUM-ETHNIC         PIC X(1).                                   
           05 WS-NUM-SEX            PIC X(1).                                   
           05 WS-NUM-MARITAL-STATUS PIC X(1).                                   
           05 WS-DTE-BIRTH          PIC X(8).                                   
           05 WS-NUM-CITIZENSHIP    PIC X(2).                                   
           05 WS-NUM-RELATIONSHIP   PIC X(2).                                   
           05 WS-AMT-INCOME         PIC 9(5).                                   
           05 WS-NUM-NATIONALITY    PIC X(2).                                   
           05 WS-NUM-RESIDENT-NT    PIC X(1).                                   
           05 WS-AMT-INCOME-TP      PIC 9(5).                                   
           05 WS-DTE-UPDATE         PIC X(8).                                   
           05 WS-NUM-5YR-OCCUPN     PIC X(1).                                   
           05 WS-NUM-LESSEE-CHECK   PIC X(1).                                   
           05 WS-DTE-ISSUE-REGN     PIC X(8).                                   
           05 WS-NUM-TAG2           PIC X(5).                                   
           05 WS-DTE-OBTAIN-CITIZEN PIC X(8).                                   
           05 FILLER                  PIC X(06).                                
           05 WS-NUM-FREEZE-OCCP    PIC X(1).                                   
           05 WS-NUM-NRIC-SPOUSE    PIC X(9).                                   
           05 WS-NUM-PHONE          PIC X(8).                                   
           05 WS-NUM-HP-PGR         PIC X(8).                                   
           05 WS-NUM-PHONE-OFF      PIC X(8).                                   
           05 WS-NUM-EDUCATION      PIC X(1).                                   
           05 WS-USERID             PIC X(7).                                   
                                                                                
       01  BP13LZ26-HEADER.                                                     
           05  FILLER                   PIC X(7) VALUE 'S/NO'.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(8) VALUE 'REG NO'.                
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(9) VALUE 'NRIC1'.                 
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(9) VALUE 'NRIC2'.                 
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(2) VALUE 'HH'.                    
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(2) VALUE 'FT'.                    
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(8) VALUE 'ALLO SCH'.              
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(8) VALUE 'ELIG SCH'.              
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(4) VALUE 'Y SC'.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(5) VALUE 'Y NSC'.                 
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(3) VALUE 'PPS'.                   
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(4) VALUE 'YEAR'.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(3) VALUE 'TAG'.                   
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(8) VALUE 'ALLO CAT'.              
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  FILLER                   PIC X(3) VALUE 'NT'.                    
           05  FILLER                   PIC X(1) VALUE ';'.                     
                                                                                
       01  BP13LZ26-DETAIL.                                                     
           05  LZ26-SNO                 PIC 9(7) VALUE ZEROES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-REGN-NO             PIC X(8) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-NRIC1           PIC X(9) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-NRIC2           PIC X(9) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-HOUSEHOLD       PIC X(1) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-FLAT-TYPE       PIC X(2) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-ALLO-SCH        PIC X(3) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-ELIG-SCH        PIC X(3) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-YOUNG-AGE-SC    PIC X(2) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-YOUNG-AGE-NSC   PIC X(2) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-PPS-TAG         PIC X(1) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-YEAR            PIC 9(2) VALUE ZEROES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-TAG             PIC X(1) VALUE ZEROES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-ALLO-CAT            PIC X(3) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
           05  LZ26-NUM-TOWN            PIC X(3) VALUE SPACES.                  
           05  FILLER                   PIC X(1) VALUE ';'.                     
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
       0000-MAIN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-FILES             THRU 1000-EXIT.                  
           PERFORM 3500-READ-BP13F730          THRU 3500-EXIT.                  
           PERFORM 3000-PROCESS-RECORDS        THRU 3000-EXIT                   
                   UNTIL WS-F730-EOF = 'Y'.                                     
           PERFORM 9000-CLOSE-ROUTINE          THRU 9000-EXIT.                  
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-FILES.                                                         
      ******************************************************************        
           OPEN INPUT BP13F730                                                  
                      BP13K813                                                  
                      BP13K825                                                  
                      BP13K828                                                  
                      BP13K515                                                  
               OUTPUT BP13F595                                                  
                      BP13LZ26.                                                 
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K825 STATUS IS ' WS-K825-STATUS            
              MOVE     WS-K825-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K828-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K828 STATUS IS ' WS-K828-STATUS            
              MOVE     WS-K828-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K515-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K515 STATUS IS ' WS-K515-STATUS            
              MOVE     WS-K515-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K813-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K813 STATUS IS ' WS-K813-STATUS            
              MOVE     WS-K813-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
            WRITE BP13LZ26-REC    FROM  BP13LZ26-HEADER.                        
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           PERFORM 4100-READ-BP13K813          THRU 4100-EXIT.                  
           PERFORM 3100-CHECK-MARITAL-STAT THRU 3100-EXIT.                      
                                                                                
           PERFORM 3500-READ-BP13F730      THRU 3500-EXIT.                      
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3100-CHECK-MARITAL-STAT.                                                 
      ******************************************************************        
      * CHECK NRIC 1                                                            
           INITIALIZE BP13K825-REC                                              
                      BP13K828-REC                                              
                      WS-NRIC-DATE-S                                            
                      WS-NUM-CITIZENSHIP-S                                      
                                                                                
           MOVE 'N'                      TO WS-NOT-FND-K825-K828                
                                            WS-FS-FND.                          
                                                                                
           MOVE F730-NUM-REGN            TO K825-NUM-REGN                       
           MOVE F730-NUM-NRIC1           TO K825-NUM-NRIC                       
                                            WS-NUM-NRIC-K515                    
                                                                                
           PERFORM 4600-READ-BP13K825      THRU 4600-EXIT.                      
           PERFORM 3250-COMPUTE-DATE-NRIC1 THRU 3250-EXIT.                      
           MOVE WS-NRIC-DATE               TO WS-NRIC-DATE-S.                   
           MOVE K825-NUM-CITIZENSHIP       TO WS-NUM-CITIZENSHIP-S.             
                                                                                
      * CHECK ELIG SCHEME                                                       
                                                                                
           IF K825-NUM-MARITAL-STATUS = '2'                                     
              PERFORM 3200-CHECK-CITIZENSHIP  THRU 3200-EXIT                    
              GO TO 3100-EXIT                                                   
           ELSE                                                                 
             IF K825-NUM-MARITAL-STATUS NOT = '2' AND                           
                K825-NUM-RELATIONSHIP = '09'                                    
                MOVE 'Y'  TO WS-FS-FND                                          
             END-IF                                                             
           END-IF                                                               
                                                                                
      * CHECK NRIC 2                                                            
           IF F730-NUM-NRIC2(1:1) NOT = SPACES AND '#'                          
              INITIALIZE BP13K825-REC                                           
              MOVE F730-NUM-REGN            TO K825-NUM-REGN                    
              MOVE F730-NUM-NRIC2           TO K825-NUM-NRIC                    
                                               WS-NUM-NRIC-K515                 
                                                                                
              PERFORM 4600-READ-BP13K825    THRU 4600-EXIT                      
              PERFORM 3250-COMPUTE-DATE-NRIC1 THRU 3250-EXIT                    
                                                                                
              IF K825-NUM-MARITAL-STATUS = '2'                                  
                 PERFORM 3200-CHECK-CITIZENSHIP  THRU 3200-EXIT                 
                 GO TO 3100-EXIT                                                
              ELSE                                                              
                IF K825-NUM-MARITAL-STATUS NOT = '2' AND                        
                   K825-NUM-RELATIONSHIP = '09'                                 
                   MOVE 'Y'  TO WS-FS-FND                                       
                END-IF                                                          
              END-IF                                                            
                                                                                
           END-IF.                                                              
                                                                                
      * CHECK NRIC 3                                                            
           IF F730-NUM-NRIC3(1:1) NOT = SPACES AND '#'                          
              INITIALIZE BP13K825-REC                                           
              MOVE F730-NUM-REGN            TO K825-NUM-REGN                    
              MOVE F730-NUM-NRIC3           TO K825-NUM-NRIC                    
                                               WS-NUM-NRIC-K515                 
                                                                                
              PERFORM 4600-READ-BP13K825    THRU 4600-EXIT                      
              PERFORM 3250-COMPUTE-DATE-NRIC1 THRU 3250-EXIT                    
                                                                                
              IF K825-NUM-MARITAL-STATUS = '2'                                  
                 PERFORM 3200-CHECK-CITIZENSHIP  THRU 3200-EXIT                 
                 GO TO 3100-EXIT                                                
              ELSE                                                              
                IF K825-NUM-MARITAL-STATUS NOT = '2' AND                        
                   K825-NUM-RELATIONSHIP = '09'                                 
                   MOVE 'Y'  TO WS-FS-FND                                       
                END-IF                                                          
              END-IF                                                            
            END-IF.                                                             
                                                                                
      * CHECK NRIC 4                                                            
           IF F730-NUM-NRIC4(1:1) NOT = SPACES AND '#'                          
              INITIALIZE BP13K825-REC                                           
              MOVE F730-NUM-REGN            TO K825-NUM-REGN                    
              MOVE F730-NUM-NRIC4           TO K825-NUM-NRIC                    
                                               WS-NUM-NRIC-K515                 
                                                                                
              PERFORM 4600-READ-BP13K825    THRU 4600-EXIT                      
              PERFORM 3250-COMPUTE-DATE-NRIC1 THRU 3250-EXIT                    
                                                                                
              IF K825-NUM-MARITAL-STATUS = '2'                                  
                 PERFORM 3200-CHECK-CITIZENSHIP  THRU 3200-EXIT                 
                 GO TO 3100-EXIT                                                
              ELSE                                                              
                IF K825-NUM-MARITAL-STATUS NOT = '2' AND                        
                   K825-NUM-RELATIONSHIP = '09'                                 
                   MOVE 'Y'  TO WS-FS-FND                                       
                END-IF                                                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F730-CDE-ELIG-SCH = 'FS' OR WS-FS-FND = 'Y'                       
              PERFORM 4700-BROWSE-BP13K825 THRU 4700-EXIT                       
              GO TO 3100-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF WS-NOT-FND-K825-K828 = 'Y'                                        
             PERFORM 3410-PROCESS-NOT-FND      THRU 3410-EXIT                   
           ELSE                                                                 
             PERFORM 3400-PROCESS-SINGLE       THRU 3400-EXIT                   
           END-IF.                                                              
                                                                                
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3200-CHECK-CITIZENSHIP.                                                  
      ******************************************************************        
           MOVE BP13K825-REC        TO WS-K825-REC.                             
                                                                                
           INITIALIZE BP13K825-REC                                              
                      F730-TME-SYSTEM                                           
                                                                                
      * GET SPOUSE INFO                                                         
           MOVE WS-NUM-REGN         TO K825-NUM-REGN.                           
           MOVE WS-NUM-NRIC-SPOUSE  TO K825-NUM-NRIC                            
                                       WS-NUM-NRIC-K515.                        
                                                                                
           PERFORM 4600-READ-BP13K825       THRU 4600-EXIT.                     
                                                                                
           MOVE K825-NUM-CITIZENSHIP TO WS-NUM-CITIZENSHIP-SPOUSE               
                                                                                
           PERFORM 3300-COMPUTE-DATE-SPOUSE THRU 3300-EXIT.                     
                                                                                
           EVALUATE TRUE                                                        
           WHEN WS-NUM-CITIZENSHIP   = 10 AND                                   
                WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                          
                WS-NRIC-DATE         = 99 AND                                   
                WS-SPOUSE-DATE       = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                                                                                
                MOVE 'A'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP   = 10 AND                                   
                WS-NUM-CITIZENSHIP-SPOUSE    = 10 AND                           
                WS-NRIC-DATE         = 99 AND                                   
                WS-SPOUSE-DATE   NOT = 99                                       
                                                                                
                MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                   
                MOVE 'B'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP   = 10 AND                                   
                WS-NUM-CITIZENSHIP-SPOUSE    = 10 AND                           
                WS-NRIC-DATE     NOT = 99 AND                                   
                WS-SPOUSE-DATE       = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                MOVE 'B'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP   = 10 AND                                   
                WS-NUM-CITIZENSHIP-SPOUSE    = 10 AND                           
                WS-NRIC-DATE     NOT = 99 AND                                   
                WS-SPOUSE-DATE   NOT = 99                                       
                                                                                
                IF WS-NRIC-DATE <= WS-SPOUSE-DATE                               
                   MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                
                ELSE                                                            
                   MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                
                END-IF                                                          
                MOVE 'C'                 TO F730-TME-SYSTEM(8:1)                
                                                                                
           WHEN WS-NUM-CITIZENSHIP            = 10 AND                          
                WS-NUM-CITIZENSHIP-SPOUSE     = 20 AND                          
                WS-NRIC-DATE         = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                MOVE 'D'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP            = 20 AND                          
                WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                          
                WS-SPOUSE-DATE        = 99                                      
                                                                                
                MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                   
                MOVE 'D'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP        = 10 AND                              
                WS-NUM-CITIZENSHIP-SPOUSE = 20 AND                              
                WS-NRIC-DATE     NOT = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                MOVE 'E'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP        = 20 AND                              
                WS-NUM-CITIZENSHIP-SPOUSE = 10 AND                              
                WS-SPOUSE-DATE     NOT = 99                                     
                                                                                
                MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                   
                MOVE 'E'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP            = 10 AND                          
               (WS-NUM-CITIZENSHIP-SPOUSE NOT = 10 AND 20) AND                  
                WS-NRIC-DATE         = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                MOVE 'F'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN (WS-NUM-CITIZENSHIP        NOT = 10 AND 20) AND                 
                 WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                         
                WS-SPOUSE-DATE         = 99                                     
                                                                                
                MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                   
                MOVE 'F'              TO F730-TME-SYSTEM(8:1)                   
                                                                                
           WHEN WS-NUM-CITIZENSHIP            = 10 AND                          
               (WS-NUM-CITIZENSHIP-SPOUSE NOT = 10 AND 20) AND                  
                WS-NRIC-DATE     NOT = 99                                       
                                                                                
                MOVE WS-NRIC-DATE     TO F730-TME-SYSTEM(6:2)                   
                MOVE 'G'              TO F730-TME-SYSTEM(8:1)                   
           WHEN (WS-NUM-CITIZENSHIP        NOT = 10 AND 20) AND                 
                 WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                         
                 WS-SPOUSE-DATE   NOT = 99                                      
                                                                                
                MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)                   
                MOVE 'G'              TO F730-TME-SYSTEM(8:1)                   
           WHEN (WS-NUM-CITIZENSHIP             = 20 AND                        
                 WS-NUM-CITIZENSHIP-SPOUSE      = 20) OR                        
                (WS-NUM-CITIZENSHIP             = 20 AND                        
                (WS-NUM-CITIZENSHIP-SPOUSE  NOT = 10 AND 20)) OR                
                (WS-NUM-CITIZENSHIP         NOT = 10 AND 20 AND                 
                (WS-NUM-CITIZENSHIP-SPOUSE      = 20))                          
                PERFORM 3400-PROCESS-SINGLE   THRU 3400-EXIT                    
           WHEN OTHER                                                           
                MOVE 'J'              TO F730-TME-SYSTEM(8:1)                   
           END-EVALUATE.                                                        
                                                                                
           PERFORM 6000-WRITE-BP13F595  THRU 6000-EXIT.                         
           PERFORM 6100-WRITE-BP13LZ26  THRU 6100-EXIT.                         
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3250-COMPUTE-DATE-NRIC1.                                                 
      ******************************************************************        
           INITIALIZE WS-DATE                                                   
                      WS-NRIC-DATE                                              
                      WS-DTE-CITIZEN                                            
                                                                                
           PERFORM 4500-READ-BP13K515   THRU 4500-EXIT                          
                                                                                
           INITIALIZE WS-DTE-OBTAIN-CTZN                                        
                                                                                
           STRING K515-DTE-OBTAIN-CTZN(1:4)                                     
                  K515-DTE-OBTAIN-CTZN(6:2)                                     
                  K515-DTE-OBTAIN-CTZN(9:2)                                     
                  DELIMITED BY SIZE                                             
             INTO WS-DTE-OBTAIN-CTZN                                            
      * COMPUTE NRIC DATE                                                       
                                                                                
           IF WS-DTE-OBTAIN-CTZN IS NUMERIC AND                                 
              WS-DTE-OBTAIN-CTZN NOT = ZEROES                                   
              MOVE WS-DTE-OBTAIN-CTZN    TO WS-DTE-CITIZEN                      
              COMPUTE WS-DATE = WS-DTE-OPEN-BTO - WS-DTE-CITIZEN                
              MOVE WS-DATE-COMP(1:2)  TO WS-NRIC-DATE                           
           ELSE                                                                 
              MOVE 99              TO WS-NRIC-DATE                              
           END-IF.                                                              
                                                                                
       3250-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3300-COMPUTE-DATE-SPOUSE.                                                
      ******************************************************************        
           INITIALIZE WS-DATE                                                   
                      WS-SPOUSE-DATE                                            
                      WS-DTE-CITIZEN                                            
                                                                                
           PERFORM 4500-READ-BP13K515   THRU 4500-EXIT                          
                                                                                
           INITIALIZE WS-DTE-OBTAIN-CTZN                                        
                                                                                
           STRING K515-DTE-OBTAIN-CTZN(1:4)                                     
                  K515-DTE-OBTAIN-CTZN(6:2)                                     
                  K515-DTE-OBTAIN-CTZN(9:2)                                     
                  DELIMITED BY SIZE                                             
             INTO WS-DTE-OBTAIN-CTZN                                            
                                                                                
      * COMPUTE SPOUSE DATE                                                     
           IF WS-DTE-OBTAIN-CTZN IS NUMERIC AND                                 
              WS-DTE-OBTAIN-CTZN NOT = ZEROES                                   
              MOVE WS-DTE-OBTAIN-CTZN    TO WS-DTE-CITIZEN                      
              COMPUTE WS-DATE = WS-DTE-OPEN-BTO - WS-DTE-CITIZEN                
              MOVE WS-DATE-COMP(1:2) TO WS-SPOUSE-DATE                          
           ELSE                                                                 
              MOVE 99              TO WS-SPOUSE-DATE                            
           END-IF.                                                              
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3400-PROCESS-SINGLE.                                                     
      ******************************************************************        
                                                                                
           INITIALIZE F730-TME-SYSTEM                                           
                                                                                
           IF WS-NRIC-DATE-S NOT = 99                                           
               MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)                    
               MOVE 'I'              TO F730-TME-SYSTEM(8:1)                    
           ELSE                                                                 
               MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)                    
               MOVE 'H'              TO F730-TME-SYSTEM(8:1)                    
           END-IF.                                                              
                                                                                
           PERFORM 6000-WRITE-BP13F595  THRU 6000-EXIT.                         
           PERFORM 6100-WRITE-BP13LZ26  THRU 6100-EXIT.                         
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3410-PROCESS-NOT-FND.                                                    
      ******************************************************************        
                                                                                
           INITIALIZE F730-TME-SYSTEM                                           
                                                                                
               MOVE SPACES           TO F730-TME-SYSTEM(6:2)                    
               MOVE SPACES           TO F730-TME-SYSTEM(8:1)                    
                                                                                
           PERFORM 6000-WRITE-BP13F595  THRU 6000-EXIT.                         
           PERFORM 6100-WRITE-BP13LZ26  THRU 6100-EXIT.                         
                                                                                
       3410-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3500-READ-BP13F730.                                                      
      ******************************************************************        
                                                                                
           READ BP13F730                                                        
                AT END MOVE 'Y' TO WS-F730-EOF                                  
                       GO TO 3500-EXIT.                                         
                                                                                
           ADD  1   TO  WS-F730-READ-CTR.                                       
           MOVE 'N' TO  WS-NOT-FND-K740.                                        
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4100-READ-BP13K813.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                          TO BP13K813-REC.                
           INITIALIZE                              BP13K813-REC.                
                                                                                
           MOVE F730-CDE-NT1                    TO K813-NUM-ZONE                
                                                   WS-NUM-NEW-TOWN.             
           MOVE F730-CDE-FLAT-TYPE              TO K813-NUM-FLAT-TYPE.          
           MOVE F730-DTE-BALLOT                 TO K813-DTE-BALLOT.             
                                                                                
           READ BP13K813.                                                       
                                                                                
           EVALUATE WS-K813-STATUS                                              
               WHEN 00                                                          
                    MOVE K813-DTE-OPEN-BTO      TO WS-DTE-OPEN-BTO              
                    IF K813-CDE-NT NOT = SPACES AND LOW-VALUES                  
                       MOVE K813-CDE-NT         TO WS-NUM-NEW-TOWN              
                    END-IF                                                      
               WHEN 23                                                          
                    DISPLAY 'BP13K813 NOT FND: ' K813-KEY-FLD                   
               WHEN OTHER                                                       
                    MOVE WS-K813-STATUS               TO RETURN-CODE            
                    DISPLAY 'ERROR READING BP13K813: ' WS-K813-STATUS           
                            ' KEY : ' K813-KEY-FLD                              
                    PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                  
           END-EVALUATE.                                                        
                                                                                
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4500-READ-BP13K515.                                                      
      ******************************************************************        
                                                                                
           MOVE WS-NUM-NRIC-K515     TO K515-KEY-FLD.                           
           READ BP13K515.                                                       
                                                                                
           IF WS-K515-STATUS = 00 OR 02                                         
              ADD 1             TO WS-K515-FND                                  
           ELSE                                                                 
           IF WS-K515-STATUS = 23                                               
              DISPLAY 'K515 REC NOT FOUND : '   K515-KEY-FLD                    
              ADD 1             TO WS-K515-NOTFND                               
              MOVE ZEROES       TO K515-DTE-OBTAIN-CTZN                         
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K515 = '   WS-K515-STATUS              
                      ', K515-KEY-FLD = '   K515-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4600-READ-BP13K825.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES TO WS-NUM-CITIZENSHIP-SPOUSE.                            
                                                                                
           READ BP13K825.                                                       
                                                                                
           IF WS-K825-STATUS = 00 OR 02                                         
              CONTINUE                                                          
           ELSE                                                                 
           IF WS-K825-STATUS = 23                                               
              DISPLAY 'K825 REC NOT FOUND : '   K825-KEY-FLD                    
              ADD 1         TO WS-K825-NOTFND                                   
              MOVE K825-KEY-FLD  TO K828-KEY-FLD                                
              PERFORM 4650-READ-BP13K828   THRU 4650-EXIT                       
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K825 = '   WS-K825-STATUS              
                      ', K825-KEY-FLD = '   K825-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4650-READ-BP13K828.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES TO WS-NUM-CITIZENSHIP-SPOUSE.                            
                                                                                
           READ BP13K828.                                                       
                                                                                
           IF WS-K828-STATUS = 00 OR 02                                         
              MOVE BP13K828-REC   TO BP13K825-REC                               
           ELSE                                                                 
           IF WS-K828-STATUS = 23                                               
              DISPLAY 'K828 REC NOT FOUND : '   K828-KEY-FLD                    
              ADD 1         TO WS-K828-NOTFND                                   
              MOVE 'Y'      TO WS-NOT-FND-K825-K828                             
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K828 = '   WS-K828-STATUS              
                      ', K828-KEY-FLD = '   K828-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
                                                                                
       4650-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4700-BROWSE-BP13K825.                                                    
      ******************************************************************        
                                                                                
           MOVE 'N'                      TO WS-K825-EOF                         
                                            WS-K825-PROCESS.                    
           MOVE SPACES                   TO K825-KEY-FLD.                       
           MOVE F730-NUM-REGN            TO K825-NUM-REGN.                      
           START BP13K825 KEY >= K825-KEY-FLD                                   
                                                                                
           IF WS-K825-STATUS = 00 OR 02                                         
              PERFORM 4710-READ-NEXT-BP13K825 THRU 4710-EXIT                    
              PERFORM 4720-PROCESS-FS THRU 4720-EXIT                            
                  UNTIL K825-NUM-REGN > F730-NUM-REGN                           
                  OR WS-K825-EOF = 'Y'                                          
              IF WS-K825-PROCESS NOT = 'Y'                                      
                 PERFORM 4800-BROWSE-BP13K828  THRU 4800-EXIT                   
              END-IF                                                            
           ELSE                                                                 
              IF WS-K825-STATUS = 23                                            
                 DISPLAY 'BROWSE K825 NOT FND: '   K825-KEY-FLD                 
                 ADD 1         TO WS-K825-NOTFND                                
                 PERFORM 4800-BROWSE-BP13K828  THRU 4800-EXIT                   
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K825 = '   WS-K825-STATUS           
                         ', K825-KEY-FLD = '   K825-KEY-FLD                     
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                   
                                                                                
       4700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4710-READ-NEXT-BP13K825.                                                 
      ******************************************************************        
                                                                                
           READ BP13K825 NEXT RECORD                                            
             AT END MOVE 'Y' TO WS-K825-EOF.                                    
                                                                                
       4710-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4720-PROCESS-FS.                                                         
      ******************************************************************        
                                                                                
           IF K825-NUM-REGN = F730-NUM-REGN                                     
              IF K825-NUM-RELATIONSHIP = '09'                                   
                 MOVE K825-NUM-NRIC   TO WS-NUM-NRIC-K515                       
                 MOVE K825-NUM-CITIZENSHIP TO                                   
                               WS-NUM-CITIZENSHIP-SPOUSE                        
                                                                                
                 PERFORM 3300-COMPUTE-DATE-SPOUSE THRU 3300-EXIT                
                                                                                
                 EVALUATE TRUE                                                  
                 WHEN WS-NUM-CITIZENSHIP-S      = 10 AND                        
                      WS-NUM-CITIZENSHIP-SPOUSE = 10 AND                        
                      WS-NRIC-DATE-S       = 99 AND                             
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                                                                                
                      MOVE 'A'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-NRIC-DATE-S       = 99 AND                             
                      WS-SPOUSE-DATE   NOT = 99                                 
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'B'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-NRIC-DATE-S   NOT = 99 AND                             
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'B'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S      = 10 AND                        
                      WS-NUM-CITIZENSHIP-SPOUSE = 10 AND                        
                      WS-NRIC-DATE-S   NOT = 99 AND                             
                      WS-SPOUSE-DATE   NOT = 99                                 
                                                                                
                      IF WS-NRIC-DATE-S <= WS-SPOUSE-DATE                       
                         MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)          
                      ELSE                                                      
                         MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)          
                      END-IF                                                    
                      MOVE 'C'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 20 AND                       
                      WS-NRIC-DATE-S       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'D'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 20 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'D'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 20 AND                       
                      WS-NRIC-DATE-S   NOT = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'E'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 20 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-SPOUSE-DATE     NOT = 99                               
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'E'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S           = 10 AND                   
                     (WS-NUM-CITIZENSHIP-SPOUSE  NOT = 10 AND 20) AND           
                      WS-NRIC-DATE-S       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'F'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN (WS-NUM-CITIZENSHIP-S      NOT = 10 AND 20) AND           
                       WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                   
                      WS-SPOUSE-DATE         = 99                               
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'F'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S           = 10 AND                   
                     (WS-NUM-CITIZENSHIP-SPOUSE  NOT = 10 AND 20) AND           
                      WS-NRIC-DATE-S   NOT = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'G'              TO F730-TME-SYSTEM(8:1)             
                 WHEN (WS-NUM-CITIZENSHIP-S       NOT = 10 AND 20) AND          
                       WS-NUM-CITIZENSHIP-SPOUSE      = 10 AND                  
                       WS-SPOUSE-DATE   NOT = 99                                
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'G'              TO F730-TME-SYSTEM(8:1)             
                 WHEN WS-NUM-CITIZENSHIP-S           = 20 AND                   
                      WS-NUM-CITIZENSHIP-SPOUSE      = 20                       
                      MOVE 'J'              TO F730-TME-SYSTEM(8:1)             
                 WHEN OTHER                                                     
                      MOVE 'K'              TO F730-TME-SYSTEM(8:1)             
                 END-EVALUATE                                                   
                                                                                
                 PERFORM 6000-WRITE-BP13F595  THRU 6000-EXIT                    
                 PERFORM 6100-WRITE-BP13LZ26  THRU 6100-EXIT                    
                 MOVE 'Y' TO WS-K825-EOF                                        
                 GO TO 4720-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 4710-READ-NEXT-BP13K825 THRU 4710-EXIT.                      
                                                                                
       4720-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4800-BROWSE-BP13K828.                                                    
      ******************************************************************        
                                                                                
           MOVE 'N'                      TO WS-K828-EOF.                        
           MOVE SPACES                   TO K828-KEY-FLD.                       
           MOVE F730-NUM-REGN            TO K828-NUM-REGN.                      
           START BP13K828 KEY >= K828-KEY-FLD                                   
                                                                                
           IF WS-K828-STATUS = 00 OR 02                                         
              PERFORM 4810-READ-NEXT-BP13K828 THRU 4810-EXIT                    
              PERFORM 4820-PROCESS-FS THRU 4820-EXIT                            
                  UNTIL K828-NUM-REGN > F730-NUM-REGN                           
                  OR WS-K828-EOF = 'Y'                                          
           ELSE                                                                 
              IF WS-K828-STATUS = 23                                            
                 DISPLAY 'BROWSE K828 NOT FND: '   K828-KEY-FLD                 
                 ADD 1         TO WS-K828-NOTFND                                
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K828 = '   WS-K828-STATUS           
                         ', K828-KEY-FLD = '   K828-KEY-FLD                     
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                   
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4810-READ-NEXT-BP13K828.                                                 
      ******************************************************************        
                                                                                
           READ BP13K828 NEXT RECORD                                            
             AT END MOVE 'Y' TO WS-K828-EOF.                                    
                                                                                
       4810-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4820-PROCESS-FS.                                                         
      ******************************************************************        
                                                                                
           IF K828-NUM-REGN = F730-NUM-REGN                                     
              IF K828-NUM-RELATIONSHIP = '09'                                   
                 MOVE K828-NUM-NRIC   TO WS-NUM-NRIC-K515                       
                 MOVE K828-NUM-CITIZENSHIP TO                                   
                               WS-NUM-CITIZENSHIP-SPOUSE                        
                                                                                
                 PERFORM 3300-COMPUTE-DATE-SPOUSE THRU 3300-EXIT                
                                                                                
                 EVALUATE TRUE                                                  
                 WHEN WS-NUM-CITIZENSHIP-S      = 10 AND                        
                      WS-NUM-CITIZENSHIP-SPOUSE = 10 AND                        
                      WS-NRIC-DATE-S       = 99 AND                             
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                                                                                
                      MOVE 'A'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-NRIC-DATE-S       = 99 AND                             
                      WS-SPOUSE-DATE   NOT = 99                                 
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'B'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-NRIC-DATE-S   NOT = 99 AND                             
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'B'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S      = 10 AND                        
                      WS-NUM-CITIZENSHIP-SPOUSE = 10 AND                        
                      WS-NRIC-DATE-S   NOT = 99 AND                             
                      WS-SPOUSE-DATE   NOT = 99                                 
                                                                                
                      IF WS-NRIC-DATE-S <= WS-SPOUSE-DATE                       
                         MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)          
                      ELSE                                                      
                         MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)          
                      END-IF                                                    
                      MOVE 'C'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 20 AND                       
                      WS-NRIC-DATE-S       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'D'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 20 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-SPOUSE-DATE       = 99                                 
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'D'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 10 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 20 AND                       
                      WS-NRIC-DATE-S   NOT = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'E'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S       = 20 AND                       
                      WS-NUM-CITIZENSHIP-SPOUSE  = 10 AND                       
                      WS-SPOUSE-DATE     NOT = 99                               
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'E'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S           = 10 AND                   
                     (WS-NUM-CITIZENSHIP-SPOUSE  NOT = 10 AND 20) AND           
                      WS-NRIC-DATE-S       = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'F'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN (WS-NUM-CITIZENSHIP-S      NOT = 10 AND 20) AND           
                       WS-NUM-CITIZENSHIP-SPOUSE     = 10 AND                   
                      WS-SPOUSE-DATE         = 99                               
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'F'              TO F730-TME-SYSTEM(8:1)             
                                                                                
                 WHEN WS-NUM-CITIZENSHIP-S           = 10 AND                   
                     (WS-NUM-CITIZENSHIP-SPOUSE  NOT = 10 AND 20) AND           
                      WS-NRIC-DATE-S   NOT = 99                                 
                                                                                
                      MOVE WS-NRIC-DATE-S   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'G'              TO F730-TME-SYSTEM(8:1)             
                 WHEN (WS-NUM-CITIZENSHIP-S       NOT = 10 AND 20) AND          
                       WS-NUM-CITIZENSHIP-SPOUSE      = 10 AND                  
                       WS-SPOUSE-DATE   NOT = 99                                
                                                                                
                      MOVE WS-SPOUSE-DATE   TO F730-TME-SYSTEM(6:2)             
                      MOVE 'G'              TO F730-TME-SYSTEM(8:1)             
                 WHEN WS-NUM-CITIZENSHIP-S           = 20 AND                   
                      WS-NUM-CITIZENSHIP-SPOUSE      = 20                       
                      MOVE 'J'              TO F730-TME-SYSTEM(8:1)             
                 WHEN OTHER                                                     
                      MOVE 'K'              TO F730-TME-SYSTEM(8:1)             
                 END-EVALUATE                                                   
                                                                                
                 PERFORM 6000-WRITE-BP13F595  THRU 6000-EXIT                    
            DISPLAY '4820=' F730-NUM-REGN                                       
                    ' =' F595-NUM-REGN                                          
                    ' =' WS-FOUT-WRT-CTR                                        
                 PERFORM 6100-WRITE-BP13LZ26  THRU 6100-EXIT                    
                 MOVE 'Y' TO WS-K828-EOF                                        
                 GO TO 4820-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 4810-READ-NEXT-BP13K828 THRU 4810-EXIT.                      
                                                                                
       4820-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6000-WRITE-BP13F595.                                                     
      ******************************************************************        
                                                                                
            INITIALIZE BP13F595-REC                                             
                                                                                
            WRITE BP13F595-REC    FROM  BP13F730-REC.                           
            ADD   1              TO     WS-FOUT-WRT-CTR.                        
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6100-WRITE-BP13LZ26.                                                     
      ******************************************************************        
                                                                                
            INITIALIZE BP13LZ26-REC                                             
                       BP13LZ26-DETAIL.                                         
                                                                                
            ADD   1               TO    WS-SNO.                                 
                                                                                
            MOVE WS-SNO                       TO LZ26-SNO                       
            MOVE F730-NUM-REGN                TO LZ26-REGN-NO                   
            MOVE F730-NUM-NRIC1               TO LZ26-NUM-NRIC1                 
            MOVE F730-NUM-NRIC2               TO LZ26-NUM-NRIC2                 
            MOVE F730-CDE-HOUSEHOLD           TO LZ26-NUM-HOUSEHOLD             
            MOVE F730-CDE-FLAT-TYPE           TO LZ26-NUM-FLAT-TYPE             
            MOVE F730-CDE-ALLOC-SCH           TO LZ26-NUM-ALLO-SCH              
            MOVE F730-CDE-ELIG-SCH            TO LZ26-NUM-ELIG-SCH              
            MOVE F730-NUM-PPS-ELIG-TAG        TO LZ26-NUM-PPS-TAG               
            MOVE F730-NUM-YOUNG-CHILD-AGE-SC  TO LZ26-NUM-YOUNG-AGE-SC          
            MOVE F730-NUM-YOUNG-CHILD-AGE-NSC TO LZ26-NUM-YOUNG-AGE-NSC         
            MOVE F730-TME-SYSTEM(6:2)         TO LZ26-NUM-YEAR                  
            MOVE F730-TME-SYSTEM(8:1)         TO LZ26-NUM-TAG                   
            MOVE WS-NUM-NEW-TOWN              TO LZ26-NUM-TOWN.                 
            MOVE F730-NUM-ALLO-CAT            TO LZ26-ALLO-CAT.                 
                                                                                
            WRITE BP13LZ26-REC    FROM  BP13LZ26-DETAIL.                        
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************************************************            
       9000-CLOSE-ROUTINE.                                                      
      **************************************************************            
           DISPLAY ' '.                                                         
           DISPLAY ' ==== BP13CZ26 CONTROL TOTALS  ======'.                     
           DISPLAY ' '.                                                         
           DISPLAY ' F730 RECORDS READ          : ' WS-F730-READ-CTR.           
           DISPLAY ' RECORDS WRITTEN            : ' WS-FOUT-WRT-CTR.            
           DISPLAY ' K825 NOT FOUND             : ' WS-K825-NOTFND.             
           DISPLAY ' K825 NOT FOUND             : ' WS-K828-NOTFND.             
           DISPLAY ' K515 FOUND                 : ' WS-K515-FND.                
           DISPLAY ' K515 NOT FOUND             : ' WS-K515-NOTFND.             
           DISPLAY ' '.                                                         
           DISPLAY ' ====================================='.                    
                                                                                
           CLOSE BP13F730                                                       
                 BP13K825                                                       
                 BP13K813                                                       
                 BP13K515                                                       
                 BP13F595                                                       
                 BP13LZ26.                                                      
                                                                                
           IF WS-K825-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K825-STAT ' WS-K825-STATUS.            
                                                                                
           IF WS-K813-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K813-STAT ' WS-K813-STATUS.            
                                                                                
           IF WS-K515-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K515-STAT ' WS-K515-STATUS.            
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
