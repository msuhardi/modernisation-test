       IDENTIFICATION DIVISION.                                         00010054
       PROGRAM-ID.    BP13C45S.                                         00020063
      *AUTHOR.        KARL ANDRUS MAGALONA CABUG.                       00030064
      *DATE-WRITTEN.  04/11/2016.                                       00040054
      * ========================================================== *    00050054
      * OBJECTIVE    : DAILY PROGRAM TO:                           *    00060054
      *                (1) CREATE REPORT ON SELF BOOKED REGNS      *    00070054
      *                (2) UPDATE BP13KC20 ON REGNS TO BE AUTO     *    00080054
      *                    BOOKED BY SYSTEM                        *    00090054
      *                (3) CREATE BP13FC30 LIST OF UNUSED SLOTS    *    00100054
      *                    TO BE SWITCHED TO MANUAL (BP13C45H)     *    00110054
      * ========================================================== *    00120054
      * INPUT  FILES :  1.) BP13FC20                               *    00130054
      *                 2.) BP13K452                               *    00150064
      *                 3.) BP13K454                               *    00160064
      * I-O    FILES :  1.) BP13KC20                               *    00170054
      *                 2.) BP13K800                               *    00180054
      *                 3.) BP13KC30                               *    00181064
      * OUTPUT       :  1.) BP13FC30                               *    00190054
      *                 2.) BP13FC2A                               *    00200054
      * LISTING      :  1.) P13L45SA                               *    00210054
      *                 2.) P13L45SB                               *    00220054
      *                 3.) P13L45SC                               *    00230054
      *                 4.) P13L45SD                               *    00240054
      * ========================================================== *    00250054
      * CHG-NO   BY   DATE       DESCRIPTION                       *    00260054
      * -------- ---  ------     -----------                       *    00270054
      * BP138334 KAC1 16/06/2020 NEW PROGRAM SIMILAR TO BP13C45G   *    00280065
      * BP138334 KAC1 22/06/2020 MOVE UPDATED DTE-APPT TO KC20     *    00281070
      * ========================================================== *    00290054
                                                                        00300054
       ENVIRONMENT DIVISION.                                            00310054
                                                                        00320054
       CONFIGURATION SECTION.                                           00330054
       SOURCE-COMPUTER. IBM-3090.                                       00340054
       OBJECT-COMPUTER. IBM-3090.                                       00350054
                                                                        00360054
       INPUT-OUTPUT SECTION.                                            00370054
       FILE-CONTROL.                                                    00380054
                                                                        00390054
           SELECT BP13FC20  ASSIGN        TO BP13FC20.                  00400054
                                                                        00410054
           SELECT BP13KC20  ASSIGN        TO BP13KC20                   00420054
                            ACCESS MODE   IS DYNAMIC                    00430054
                            ORGANIZATION  IS INDEXED                    00440054
                            RECORD KEY    IS KC20-KEY-FLD               00450054
                            ALTERNATE KEY IS KC20-ALT-KEY               00460054
                            FILE STATUS   IS WS-KC20-STATUS.            00470054
                                                                        00480054
           SELECT BP13KC30  ASSIGN        TO BP13KC30                   00490054
                            ACCESS MODE   IS DYNAMIC                    00500054
                            ORGANIZATION  IS INDEXED                    00510054
                            RECORD KEY    IS KC30-KEY-FLD               00520054
                            ALTERNATE KEY IS KC30-ALT-KEY2              00530054
                            FILE STATUS   IS WS-KC30-STATUS.            00540054
                                                                        00550054
           SELECT BP13K452  ASSIGN        TO BP13K452                   00560054
                            ACCESS MODE   IS DYNAMIC                    00570054
                            ORGANIZATION  IS INDEXED                    00580054
                            RECORD KEY    IS K452-KEY-FLD               00590054
                            FILE STATUS   IS WS-K452-STATUS.            00600054
                                                                        00610054
           SELECT BP13K454  ASSIGN        TO BP13K454                   00620054
                            ACCESS MODE   IS DYNAMIC                    00630054
                            ORGANIZATION  IS INDEXED                    00640054
                            RECORD KEY    IS K454-KEY-FLD               00650054
                            ALTERNATE KEY IS K454-ALT1-KEY              00660054
                            FILE STATUS   IS WS-K454-STATUS.            00670054
                                                                        00680054
           SELECT BP13K800  ASSIGN        TO BP13K800                   00690054
                            ACCESS MODE   IS DYNAMIC                    00700054
                            ORGANIZATION  IS INDEXED                    00710054
                            RECORD KEY    IS K800-NUM-REGN              00720054
                            FILE STATUS   IS WS-K800-STATUS.            00730054
                                                                        00740054
           SELECT BP13K410  ASSIGN        TO BP13K410                   00750054
                            ACCESS MODE   IS DYNAMIC                    00760054
                            ORGANIZATION  IS INDEXED                    00770054
                            RECORD KEY    IS K410-NUM-REGN              00780054
                            FILE STATUS   IS WS-K410-STATUS.            00790054
                                                                        00800054
           SELECT BP13FC30  ASSIGN        TO BP13FC30.                  00810054
           SELECT P13FC30I  ASSIGN        TO P13FC30I.                  00811071
           SELECT P13FC30O  ASSIGN        TO P13FC30O.                  00812071
                                                                        00820054
           SELECT BP13FC2A  ASSIGN        TO BP13FC2A.                  00830054
                                                                        00840054
           SELECT P13L45SA  ASSIGN        TO P13L45SA.                  00850054
                                                                        00860054
           SELECT P13L45SB  ASSIGN        TO P13L45SB.                  00870054
                                                                        00880054
           SELECT P13L45SC  ASSIGN        TO P13L45SC.                  00890054
                                                                        00900054
           SELECT P13L45SD  ASSIGN        TO P13L45SD.                  00910054
                                                                        00920054
                                                                        00930054
       DATA DIVISION.                                                   00940054
       FILE SECTION.                                                    00950054
                                                                        00960054
       FD  BP13FC20                                                     00970054
           RECORDING MODE IS F                                          00980054
           RECORD CONTAINS 150 CHARACTERS.                              00990054
           COPY BP13FC20.                                               01000054
                                                                        01010054
       FD  BP13KC20                                                     01020054
           RECORD CONTAINS 150 CHARACTERS.                              01030054
           COPY BP13KC20.                                               01040054
                                                                        01050054
       FD  BP13KC30                                                     01060054
           RECORD CONTAINS 200 CHARACTERS.                              01070054
           COPY BP13KC30.                                               01080054
                                                                        01090054
       FD  BP13K452                                                     01100054
           RECORD CONTAINS 1000 CHARACTERS.                             01110054
           COPY BP13K452.                                               01120054
                                                                        01130054
       FD  BP13K454                                                     01140054
           RECORD CONTAINS 100 CHARACTERS.                              01150054
           COPY BP13K454.                                               01160054
                                                                        01170054
       FD  BP13K800                                                     01180054
           RECORD CONTAINS 2000 CHARACTERS.                             01190054
           COPY BP13K800.                                               01200054
                                                                        01210054
       FD  BP13K410                                                     01220054
           RECORD CONTAINS 2000 CHARACTERS.                             01230054
           COPY BP13K410.                                               01240054
                                                                        01250074
       FD  BP13FC30                                                     01251074
           RECORDING MODE IS F                                          01252074
           RECORD CONTAINS 200 CHARACTERS.                              01253074
           COPY BP13FC30.                                               01254074
                                                                        01255074
       FD  P13FC30I                                                     01260073
           RECORDING MODE IS F                                          01270054
           RECORD CONTAINS 200 CHARACTERS.                              01280054
       01  P13FC30I-REC                  PIC X(200).                    01281071
                                                                        01290071
       FD  P13FC30O                                                     01300171
           RECORDING MODE IS F                                          01300271
           RECORD CONTAINS 200 CHARACTERS.                              01300371
       01  P13FC30O-REC                  PIC X(200).                    01300471
                                                                        01301071
       FD  BP13FC2A                                                     01310054
           RECORDING MODE IS F                                          01320054
           RECORD CONTAINS 150 CHARACTERS.                              01330054
       01  BP13FC2A-REC                  PIC X(150).                    01340054
                                                                        01350054
       FD  P13L45SA                                                     01360054
           RECORDING MODE IS F                                          01370054
           RECORD CONTAINS 132  CHARACTERS.                             01380054
       01  P13L45SA-REC                  PIC X(132).                    01390054
                                                                        01400054
       FD  P13L45SB                                                     01410054
           RECORDING MODE IS F                                          01420054
           RECORD CONTAINS 132  CHARACTERS.                             01430054
       01  P13L45SB-REC                  PIC X(132).                    01440054
                                                                        01450054
       FD  P13L45SC                                                     01460054
           RECORDING MODE IS F                                          01470054
           RECORD CONTAINS 132  CHARACTERS.                             01480054
       01  P13L45SC-REC                  PIC X(132).                    01490054
                                                                        01500054
       FD  P13L45SD                                                     01510054
           RECORDING MODE IS F                                          01520054
           RECORD CONTAINS 132  CHARACTERS.                             01530054
       01  P13L45SD-REC                  PIC X(132).                    01540054
                                                                        01550054
                                                                        01560054
       WORKING-STORAGE SECTION.                                         01570054
      *-------------------------------------------------------------    01580054
                                                                        01590054
      *-------------------------------------------------------------    01600054
       01  WS-FILE-STATUS.                                              01610054
           05  WS-KC20-STATUS            PIC 9(2)   VALUE ZEROES.       01620054
           05  WS-KC30-STATUS            PIC 9(2)   VALUE ZEROES.       01630054
           05  WS-K452-STATUS            PIC 9(2)   VALUE ZEROES.       01640054
           05  WS-K454-STATUS            PIC 9(2)   VALUE ZEROES.       01650054
           05  WS-K800-STATUS            PIC 9(2)   VALUE ZEROES.       01660054
           05  WS-K410-STATUS            PIC 9(2)   VALUE ZEROES.       01670054
                                                                        01680054
       01  WS-COUNTERS.                                                 01690054
           05  WS-CNT-FC20-READ          PIC 9(6)   VALUE ZEROES.       01700054
           05  WS-CNT-FC20-SKIP          PIC 9(6)   VALUE ZEROES.       01710054
           05  WS-CNT-KC20-UPD           PIC 9(6)   VALUE ZEROES.       01720054
           05  WS-CNT-KC30-UPD           PIC 9(6)   VALUE ZEROES.       01730054
           05  WS-CNT-K800-UPD           PIC 9(6)   VALUE ZEROES.       01740054
           05  WS-CNT-K410-FND           PIC 9(6)   VALUE ZEROES.       01750054
           05  WS-CNT-FC30-WRITE         PIC 9(6)   VALUE ZEROES.       01760054
           05  WS-CNT-FC2A-WRITE         PIC 9(6)   VALUE ZEROES.       01770054
           05  WS-CNT-L45SA-WRITE        PIC 9(6)   VALUE ZEROES.       01780054
           05  WS-CNT-L45SB-WRITE        PIC 9(6)   VALUE ZEROES.       01790054
           05  WS-CNT-L45SC-WRITE        PIC 9(6)   VALUE ZEROES.       01800054
           05  WS-CNT-L45SD-WRITE        PIC 9(6)   VALUE ZEROES.       01810054
           05  WS-CNT-PAGE-A             PIC 9(4)   VALUE ZEROES.       01820054
           05  WS-CNT-PAGE-B             PIC 9(4)   VALUE ZEROES.       01830054
           05  WS-CNT-PAGE-C             PIC 9(4)   VALUE ZEROES.       01840054
           05  WS-CNT-PAGE-D             PIC 9(4)   VALUE ZEROES.       01850054
           05  WS-CNT-LINE-A             PIC 9(2)   VALUE 99.           01860054
           05  WS-CNT-LINE-B             PIC 9(2)   VALUE 99.           01870054
           05  WS-CNT-LINE-C             PIC 9(2)   VALUE 99.           01880054
           05  WS-CNT-LINE-D             PIC 9(2)   VALUE 99.           01890054
           05  WS-CNT-SNO-A              PIC 9(5)   VALUE ZEROES.       01900054
           05  WS-CNT-SNO-B              PIC 9(5)   VALUE ZEROES.       01910054
           05  WS-CNT-SNO-C              PIC 9(5)   VALUE ZEROES.       01920054
           05  WS-CNT-SNO-D              PIC 9(5)   VALUE ZEROES.       01930054
                                                                        01940054
       01  WS-FLAGS.                                                    01950054
           05  WS-FC20-EOF               PIC X(1)   VALUE 'N'.          01960054
           05  WS-KC20-FND               PIC X(1)   VALUE 'N'.          01970054
           05  WS-KC30-FND               PIC X(1)   VALUE 'N'.          01980054
           05  WS-KC30-EOF               PIC X(1)   VALUE 'N'.          01990054
           05  WS-K452-FND               PIC X(1)   VALUE 'N'.          02000054
           05  WS-K454-FND               PIC X(1)   VALUE 'N'.          02010054
           05  WS-K800-FND               PIC X(1)   VALUE 'N'.          02020054
           05  WS-K410-FND               PIC X(1)   VALUE 'N'.          02030054
           05  WS-PIDB-FND               PIC X(1)   VALUE 'N'.          02040054
           05  WS-DTE-FND                PIC X(1)   VALUE 'N'.          02050054
           05  WS-TME-FND                PIC X(1)   VALUE 'N'.          02060054
           05  WS-TIME-FND-FL            PIC X(1)   VALUE 'N'.          02070054
           05  WS-NUM-SBK                PIC X(1)   VALUE 'N'.          02080054
           05  WS-AUTO-APPT              PIC X(1)   VALUE 'N'.          02090054
                                                                        02100054
       01  WS-DATE.                                                     02110054
           05  WS-DTE-FMT8.                                             02120054
               10  WS-DTE-CCYY.                                         02130054
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.       02140054
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.       02150054
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.       02160054
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.       02170054
           05  WS-DTE-FMT10.                                            02180054
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.       02190054
               10  FILLER                PIC X      VALUE '/'.          02200054
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.       02210054
               10  FILLER                PIC X      VALUE '/'.          02220054
               10  WS-DTE-CCYY.                                         02230054
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.       02240054
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.       02250054
           05  WS-DTE-CURR-8             PIC 9(8)   VALUE ZEROES.       02260054
           05  WS-DTE-CURR-10            PIC X(10)  VALUE ZEROES.       02270054
           05  WS-DTE-SENT-PREV          PIC X(8)   VALUE SPACES.       02280054
           05  WS-TIME-RUN               PIC X(8)   VALUE ZEROES.       02290054
           05  WS-CURRENT-DATE           PIC X(08)  VALUE ZEROES.       02300054
                                                                        02310054
       01  WS-ARRAY-VARS.                                               02320054
           05  WS-I                      PIC 9(2)   VALUE ZEROES.       02330054
           05  WS-J                      PIC 9(2)   VALUE ZEROES.       02340054
           05  WS-K                      PIC 9(2)   VALUE ZEROES.       02350054
           05  WS-I-MAX                  PIC 9(2)   VALUE 60.           02360054
           05  WS-J-MAX                  PIC 9(2)   VALUE 18.           02370054
           05  WS-K-MAX                  PIC 9(2)   VALUE 60.           02380054
           05  FILLER OCCURS 60 TIMES.                                  02390054
               10  WS-ARR-DTE-SENT       PIC X(8)   VALUE SPACES.       02400054
               10  WS-ARR-NUM-APPT-TYPE  PIC X(4)   VALUE SPACES.       02410054
               10  WS-ARR-NUM-REGN       PIC X(8)   VALUE SPACES.       02420054
           05  FILLER OCCURS 60 TIMES.                                  02430054
               10  WS-BP13KC30-REC       PIC X(200) VALUE SPACES.       02440054
                                                                        02450054
       01  WS-KC30-WRT-LAST              PIC X(200) VALUE SPACES.       02460072
       01  WS-BP13FC30-REC.                                             02461072
           05  FILLER                    PIC X(28).                     02470054
           05  WS-FC30-CNT-REC           PIC 9(02).                     02480054
           05  FILLER                    PIC X(170).                    02490054
                                                                        02500054
       01  WS-OTHERS.                                                   02510054
           05  WS-CNT-VACANT             PIC S9(2)  VALUE ZEROES.       02520054
           05  WS-TOT-SLOT-GIVEN-AM      PIC S9(2)  VALUE ZEROES.       02521055
           05  WS-TOT-SLOT-GIVEN-PM      PIC S9(2)  VALUE ZEROES.       02522055
           05  WS-TOT-SLOT-GIVEN-OT      PIC S9(2)  VALUE ZEROES.       02523055
           05  WS-NUM-DESC               PIC X(60)  VALUE SPACES.       02530054
           05  WS-SQL-CODE               PIC 9(4)   VALUE 0.            02540054
           05  WS-DTE-1ST-AVAIL          PIC X(8)   VALUE SPACES.       02550054
           05  WS-TMP-DD                 PIC 9(2)   VALUE ZEROES.       02560054
           05  WS-DTE-OCT                PIC 9(8)   VALUE ZEROES.       02570054
           05  WS-DTE-OCT-PREV           PIC 9(8)   VALUE ZEROES.       02571055
           05  WS-IDX                    PIC 9(2)   VALUE ZEROES.       02580054
           05  WS-KC30-ALT-KEY1          PIC X(16)  VALUE SPACES.       02590054
           05  WS-KC30-KEY-FLD           PIC X(28)  VALUE SPACES.       02600054
           05  WS-KC30-ERR-FND           PIC X(1)   VALUE SPACES.       02610054
           05  WS-SAME-DTE-TME           PIC X(1)   VALUE SPACES.       02611055
           05  WS-KC30-TME-APPT-PREV     PIC X(4)   VALUE SPACES.       02612055
                                                                        02620054
                                                                        02630054
      *-------------------------------------------------------------    02640054
      *    REPORT LAYOUT - SUCCESSFUL                                   02650054
      *-------------------------------------------------------------    02660054
       01  L45SA-PR-HEAD-01.                                            02670054
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45SA'.   02680054
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.     02690054
           05  FILLER                 PIC X(25)   VALUE SPACES.         02700054
           05  FILLER                 PIC X(39)   VALUE                 02710054
               'S Y S T E M   O F   C O M M I T M E N T'.               02720054
           05  FILLER                 PIC X(13)   VALUE SPACES.         02730054
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.       02740054
           05  L45SA-CURRENT-DATE     PIC X(10)   VALUE SPACES.         02750054
           05  FILLER                 PIC X(3)    VALUE SPACES.         02760054
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.       02770054
           05  L45SA-PAGE             PIC ZZZ9.                         02780054
                                                                        02790054
       01  L45SA-PR-HEAD-02.                                            02800054
           05  FILLER                 PIC X(27)   VALUE SPACES.         02810054
           05  FILLER                 PIC X(77)   VALUE                 02820054
              'LIST OF REGNS SENT FOR SELF BOOKING WHO HAVE SUCCESSFULLY02830054
      -       ' BOOKED APPOINTMENTS'.                                   02840054
                                                                        02850054
       01  L45SA-PR-TITLE-1.                                            02860054
           05  FILLER                 PIC X(132)  VALUE                 02870054
              'S/NO     SMS DATE     REGN         APPT TYPE     APPT DAT02880054
      -       'E     APPT TIME     SBK'.                                02890054
                                                                        02900054
       01  L45SA-PR-TITLE-2.                                            02910054
           05  FILLER                 PIC X(132)  VALUE                 02920054
              '----     --------     --------     ---------     --------02930054
      -       '-     ---------     ---'.                                02940054
                                                                        02950054
       01  L45SA-PR-DTL.                                                02960054
           05  L45SA-NUM-SNO          PIC ZZZ9.                         02970054
           05  FILLER                 PIC X(5)    VALUE SPACES.         02980054
           05  L45SA-DTE-SENT         PIC X(8).                         02990054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03000054
           05  L45SA-NUM-REGN         PIC X(8).                         03010054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03020054
           05  L45SA-NUM-APPT-TYPE    PIC X(4).                         03030054
           05  FILLER                 PIC X(10)   VALUE SPACES.         03040054
           05  L45SA-DTE-APPT         PIC X(8).                         03050054
           05  FILLER                 PIC X(6)    VALUE SPACES.         03060054
           05  L45SA-TME-APPT         PIC X(5).                         03070054
           05  FILLER                 PIC X(9)    VALUE SPACES.         03080054
           05  L45SA-NUM-SBK          PIC X(1).                         03090054
                                                                        03100054
      *-------------------------------------------------------------    03110054
      *    REPORT LAYOUT - AUTO BOOKED                                  03120054
      *-------------------------------------------------------------    03130054
       01  L45SB-PR-HEAD-01.                                            03140054
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45SB'.   03150054
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.     03160054
           05  FILLER                 PIC X(25)   VALUE SPACES.         03170054
           05  FILLER                 PIC X(39)   VALUE                 03180054
               'S Y S T E M   O F   C O M M I T M E N T'.               03190054
           05  FILLER                 PIC X(13)   VALUE SPACES.         03200054
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.       03210054
           05  L45SB-CURRENT-DATE     PIC X(10)   VALUE SPACES.         03220054
           05  FILLER                 PIC X(3)    VALUE SPACES.         03230054
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.       03240054
           05  L45SB-PAGE             PIC ZZZ9.                         03250054
                                                                        03260054
       01  L45SB-PR-HEAD-02.                                            03270054
           05  FILLER                 PIC X(33)   VALUE SPACES.         03280054
           05  FILLER                 PIC X(66)   VALUE                 03290054
              'LIST OF REGNS SENT FOR SELF BOOKING WHO WERE AUTO BOOKED 03300054
      -       'BY SYSTEM'.                                              03310054
                                                                        03320054
       01  L45SB-PR-TITLE-1.                                            03330054
           05  FILLER                 PIC X(132)  VALUE                 03340054
              'S/NO     SMS DATE     REGN         APPT TYPE     APPT DAT03350054
      -       'E     APPT TIME'.                                        03360054
                                                                        03370054
       01  L45SB-PR-TITLE-2.                                            03380054
           05  FILLER                 PIC X(132)  VALUE                 03390054
              '----     --------     --------     ---------     --------03400054
      -       '-     ---------'.                                        03410054
                                                                        03420054
       01  L45SB-PR-DTL.                                                03430054
           05  L45SB-NUM-SNO          PIC ZZZ9.                         03440054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03450054
           05  L45SB-DTE-SENT         PIC X(8).                         03460054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03470054
           05  L45SB-NUM-REGN         PIC X(8).                         03480054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03490054
           05  L45SB-NUM-APPT-TYPE    PIC X(4).                         03500054
           05  FILLER                 PIC X(10)   VALUE SPACES.         03510054
           05  L45SB-DTE-APPT         PIC X(8).                         03520054
           05  FILLER                 PIC X(6)    VALUE SPACES.         03530054
           05  L45SB-TME-APPT         PIC X(5).                         03540054
                                                                        03550054
      *-------------------------------------------------------------    03560054
      *    REPORT LAYOUT - EXEPTION REPORT                              03570054
      *-------------------------------------------------------------    03580054
       01  L45SC-PR-HEAD-01.                                            03590054
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45SC'.   03600054
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.     03610054
           05  FILLER                 PIC X(25)   VALUE SPACES.         03620054
           05  FILLER                 PIC X(39)   VALUE                 03630054
               'S Y S T E M   O F   C O M M I T M E N T'.               03640054
           05  FILLER                 PIC X(13)   VALUE SPACES.         03650054
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.       03660054
           05  L45SC-CURRENT-DATE     PIC X(10)   VALUE SPACES.         03670054
           05  FILLER                 PIC X(3)    VALUE SPACES.         03680054
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.       03690054
           05  L45SC-PAGE             PIC ZZZ9.                         03700054
                                                                        03710054
       01  L45SC-PR-HEAD-02.                                            03720054
           05  FILLER                 PIC X(40)   VALUE SPACES.         03730054
           05  FILLER                 PIC X(51)   VALUE                 03740054
              'EXCEPTION REPORT FOR AUTO SCHEDULED SELF BOOK CASES'.    03750054
                                                                        03760054
       01  L45SC-PR-TITLE-1.                                            03770054
           05  FILLER                 PIC X(132)  VALUE                 03780054
              'S/NO     SENT DATE     REGN         APPT TYPE     ERROR D03790054
      -       'ESCRIPTION'.                                             03800054
                                                                        03810054
       01  L45SC-PR-TITLE-2.                                            03820054
           05  FILLER                 PIC X(132)  VALUE                 03830054
              '----     ---------     --------     ---------     -------03840054
      -       '-----------------------------------------------------'.  03850054
                                                                        03860054
       01  L45SC-PR-DTL.                                                03870054
           05  L45SC-NUM-SNO          PIC ZZZ9.                         03880054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03890054
           05  L45SC-DTE-SENT         PIC X(8).                         03900054
           05  FILLER                 PIC X(6)    VALUE SPACES.         03910054
           05  L45SC-NUM-REGN         PIC X(8).                         03920054
           05  FILLER                 PIC X(5)    VALUE SPACES.         03930054
           05  L45SC-NUM-APPT-TYPE    PIC X(4).                         03940054
           05  FILLER                 PIC X(10)   VALUE SPACES.         03950054
           05  L45SC-NUM-DESC         PIC X(60).                        03960054
                                                                        03970054
      *-------------------------------------------------------------    03980054
      *    REPORT LAYOUT - OPT-OUT                                      03990054
      *-------------------------------------------------------------    04000054
       01  L45SD-PR-HEAD-01.                                            04010054
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45SD'.   04020054
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.     04030054
           05  FILLER                 PIC X(25)   VALUE SPACES.         04040054
           05  FILLER                 PIC X(39)   VALUE                 04050054
               'S Y S T E M   O F   C O M M I T M E N T'.               04060054
           05  FILLER                 PIC X(13)   VALUE SPACES.         04070054
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.       04080054
           05  L45SD-CURRENT-DATE     PIC X(10)   VALUE SPACES.         04090054
           05  FILLER                 PIC X(3)    VALUE SPACES.         04100054
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.       04110054
           05  L45SD-PAGE             PIC ZZZ9.                         04120054
                                                                        04130054
       01  L45SD-PR-HEAD-02.                                            04140054
           05  FILLER                 PIC X(40)   VALUE SPACES.         04150054
           05  FILLER                 PIC X(52)   VALUE                 04160054
              'LIST OF REGNS SENT FOR SELF BOOKING WHO HAVE OPT-OUT'.   04170054
                                                                        04180054
       01  L45SD-PR-TITLE-1.                                            04190054
           05  FILLER                 PIC X(132)  VALUE                 04200054
              'S/NO     SMS DATE     REGN         APPT TYPE     CRM ID  04210054
      -       '     DATE         TIME'.                                 04220054
                                                                        04230054
       01  L45SD-PR-TITLE-2.                                            04240054
           05  FILLER                 PIC X(132)  VALUE                 04250054
              '----     --------     --------     ---------     --------04260054
      -       '     --------     -----'.                                04270054
                                                                        04280054
       01  L45SD-PR-DTL.                                                04290054
           05  L45SD-NUM-SNO          PIC ZZZ9.                         04300054
           05  FILLER                 PIC X(5)    VALUE SPACES.         04310054
           05  L45SD-DTE-SENT         PIC X(8).                         04320054
           05  FILLER                 PIC X(5)    VALUE SPACES.         04330054
           05  L45SD-NUM-REGN         PIC X(8).                         04340054
           05  FILLER                 PIC X(5)    VALUE SPACES.         04350054
           05  L45SD-NUM-APPT-TYPE    PIC X(4).                         04360054
           05  FILLER                 PIC X(10)   VALUE SPACES.         04370054
           05  L45SD-NUM-USERID       PIC X(8).                         04380054
           05  FILLER                 PIC X(5)    VALUE SPACES.         04390054
           05  L45SD-DTE-DEL          PIC X(8).                         04400054
           05  FILLER                 PIC X(5)    VALUE SPACES.         04410054
           05  L45SD-TME-DEL          PIC X(5).                         04420054
                                                                        04430054
                                                                        04440054
       PROCEDURE DIVISION.                                              04450054
      *=============================================================    04460054
       0000-CONTROL.                                                    04470054
      *=============================================================    04480054
           DISPLAY '**0000-CONTROL'                                     04490054
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.              04500054
           PERFORM 1100-GET-DATE           THRU 1100-EXIT.              04510054
           PERFORM 2000-BP13FC20-READ      THRU 2000-EXIT.              04520054
           PERFORM 2100-INIT-LOOP          THRU 2100-EXIT.              04530054
           PERFORM 3000-MAIN-ROUTINE       THRU 3000-EXIT               04540054
                   UNTIL WS-FC20-EOF = 'Y'.                             04550054
           PERFORM 4000-AUTO-SCHEDULE      THRU 4000-EXIT               04560054
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.              04570054
                                                                        04580054
       0000-EXIT.                                                       04590054
           EXIT.                                                        04600054
                                                                        04610054
                                                                        04620054
      *=============================================================    04630054
       1000-OPEN-ROUTINE.                                               04640054
      *=============================================================    04650054
                                                                        04660054
           OPEN INPUT  BP13FC20                                         04670054
                       BP13K452                                         04680054
                       BP13K454                                         04690054
                       BP13K410                                         04700054
                       P13FC30I                                         04701072
                I-O    BP13KC20                                         04710054
                       BP13K800                                         04720054
                       BP13KC30                                         04730054
                OUTPUT BP13FC30                                         04740054
                       P13FC30O                                         04741072
                       BP13FC2A                                         04750054
                       P13L45SA                                         04760054
                       P13L45SB                                         04770054
                       P13L45SC                                         04780054
                       P13L45SD.                                        04790054
                                                                        04800054
           IF WS-KC20-STATUS NOT = 00 AND 97                            04810054
              DISPLAY 'OPENING BP13KC20 ERROR ' WS-KC20-STATUS          04820054
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE             04830054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               04840054
           END-IF.                                                      04850054
                                                                        04860054
           IF WS-KC30-STATUS NOT = 00 AND 97                            04870054
              DISPLAY 'OPENING BP13KC30 ERROR ' WS-KC30-STATUS          04880054
              MOVE     WS-KC30-STATUS      TO   RETURN-CODE             04890054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               04900054
           END-IF.                                                      04910054
                                                                        04920054
           IF WS-K452-STATUS NOT = 00 AND 97                            04930054
              DISPLAY 'OPENING BP13K452 ERROR ' WS-K452-STATUS          04940054
              MOVE     WS-K452-STATUS      TO   RETURN-CODE             04950054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               04960054
           END-IF.                                                      04970054
                                                                        04980054
           IF WS-K454-STATUS NOT = 00 AND 97                            04990054
              DISPLAY 'OPENING BP13K454 ERROR ' WS-K454-STATUS          05000054
              MOVE     WS-K454-STATUS      TO   RETURN-CODE             05010054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               05020054
           END-IF.                                                      05030054
                                                                        05040054
           IF WS-K800-STATUS NOT = 00 AND 97                            05050054
              DISPLAY 'OPENING BP13K800 ERROR ' WS-K800-STATUS          05060054
              MOVE     WS-K800-STATUS      TO   RETURN-CODE             05070054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               05080054
           END-IF.                                                      05090054
                                                                        05100054
           IF WS-K410-STATUS NOT = 00 AND 97                            05110054
              DISPLAY 'OPENING BP13K410 ERROR ' WS-K410-STATUS          05120054
              MOVE     WS-K410-STATUS      TO   RETURN-CODE             05130054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               05140054
           END-IF.                                                      05150054
       1000-EXIT.                                                       05160054
           EXIT.                                                        05170054
                                                                        05180054
                                                                        05190054
      *=============================================================    05200054
       1100-GET-DATE.                                                   05210054
      *=============================================================    05220054
           DISPLAY '**1100-GET-DATE'                                    05230054
                                                                        05240054
      *-------------------------------------------------------------    05250054
      *    GET CURRENT DATE                                             05260054
      *-------------------------------------------------------------    05270054
           MOVE FUNCTION CURRENT-DATE(1:8) TO   WS-DTE-CURR-8.          05280054
           MOVE WS-DTE-CURR-8              TO   WS-DTE-FMT8.            05290054
           MOVE CORR WS-DTE-FMT8           TO   WS-DTE-FMT10.           05300054
           MOVE WS-DTE-FMT10               TO   WS-DTE-CURR-10.         05310054
                                                                        05320054
           MOVE WS-DTE-CURR-8              TO WS-CURRENT-DATE.          05330054
                                                                        05340054
       1100-EXIT.                                                       05350054
           EXIT.                                                        05360054
                                                                        05370054
                                                                        05380054
      *=============================================================    05390054
       2000-BP13FC20-READ.                                              05400054
      *=============================================================    05410054
           DISPLAY '**2000-BP13FC20-READ'                               05420054
                                                                        05430054
           READ BP13FC20                                                05440054
              AT END MOVE 'Y'              TO   WS-FC20-EOF.            05450054
                                                                        05460054
           IF WS-FC20-EOF NOT = 'Y'                                     05470054
              ADD 1                        TO   WS-CNT-FC20-READ        05480054
           END-IF.                                                      05490054
                                                                        05500054
           IF WS-CNT-FC20-READ = 1                                      05501072
              READ P13FC30I                                             05501172
           END-IF.                                                      05502072
       2000-EXIT.                                                       05510054
           EXIT.                                                        05520054
                                                                        05530054
                                                                        05540054
      *=============================================================    05550054
       2100-INIT-LOOP.                                                  05560054
      *=============================================================    05570054
           DISPLAY '**2100-INIT-LOOP'                                   05580054
                                                                        05590054
           MOVE FC20-DTE-SENT-SELF-BK      TO   WS-DTE-SENT-PREV.       05600054
                                                                        05610054
       2100-EXIT.                                                       05620054
           EXIT.                                                        05630054
                                                                        05640054
                                                                        05650054
      *=============================================================    05660054
       3000-MAIN-ROUTINE.                                               05670054
      *=============================================================    05680054
      *    (1) CONSOLIDATE REGNS TO AUTOBOOK (4000)                     05690054
      *    (2) CONSOLIDATE APPT DATE/TIME TO SWITCH COUNTERS (FC30)     05700054
      *-------------------------------------------------------------    05710054
                                                                        05720054
           DISPLAY '**3000-MAIN-ROUTINE'                                05730054
      *====TO SKIP IF RECORD FOUND IN BP13K410====*                     05740054
           PERFORM 3010-READ-BP13K410      THRU 3010-EXIT               05750054
           IF WS-K410-FND = 'Y'                                         05760054
              DISPLAY '*=========SKIP1=========*'                       05770054
              GO TO 3000-CONTINUE-READ-NEXT                             05780054
           END-IF.                                                      05790054
                                                                        05800054
           DISPLAY '===CHECK SKIP2===='                                 05810054
           DISPLAY ' '                                                  05820054
      *====TO SKIP IF REGN FOUND IN BP13KC30====*                       05830054
           MOVE SPACES                       TO BP13KC30-REC.           05840054
           MOVE FC20-NUM-REGN                TO KC30-NUM-REGN.          05850054
           PERFORM 3030-BP13KC30-READ      THRU 3030-EXIT.              05860054
                                                                        05870054
           IF WS-KC30-FND = 'Y'                                         05880054
              STRING FC20-NUM-REGN ' REGN FOUND IN BP13KC30'            05890054
                     DELIMITED BY SIZE INTO L45SC-NUM-DESC              05900054
              END-STRING                                                05910054
              MOVE 'Y'                        TO WS-KC30-ERR-FND        05920054
              PERFORM 7300-PRINT-ERROR      THRU 7300-EXIT              05930054
              GO TO 3000-CONTINUE-READ-NEXT                             05940054
           END-IF.                                                      05950054
      *    IF WS-KC30-FND = 'Y'                                         05960054
      *       MOVE SPACES                     TO   BP13K454-REC         05970054
      *       IF FC20-NUM-APPT-TYPE = 'SP'                              05980054
      *          MOVE FC20-NUM-APPT-TYPE      TO   K454-CDE-APPT-TYPE   05990054
      *       ELSE                                                      06000054
      **         MOVE 'TP'                    TO   K454-CDE-APPT-TYPE   06010054
      **      END-IF                                                    06020054
      *                                                                 06030054
      *       MOVE FC20-NUM-REGN              TO   K454-NUM-REGN        06040054
      *       PERFORM 3110-BP13K454-READ      THRU 3110-EXIT            06050054
      *       IF WS-K454-FND = 'Y'                                      06060054
      *          IF K454-DTE-APPT > WS-CURRENT-DATE                     06070054
      *             DISPLAY '*=========SKIP2=========*'                 06080054
      *             GO TO 3000-CONTINUE-READ-NEXT                       06090054
      *          END-IF                                                 06100054
      *       END-IF                                                    06110054
      *    END-IF.                                                      06120054
                                                                        06130054
           IF  (WS-DTE-SENT-PREV NOT = SPACES AND LOW-VALUES AND ZEROES)06140054
           AND (WS-DTE-SENT-PREV NOT = FC20-DTE-SENT-SELF-BK)           06150054
              PERFORM 4000-AUTO-SCHEDULE   THRU 4000-EXIT               06160054
                                                                        06170054
              MOVE FC20-DTE-SENT-SELF-BK   TO   WS-DTE-SENT-PREV        06180054
                                                                        06190054
              PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > WS-I-MAX    06200054
                 MOVE SPACES          TO   WS-ARR-DTE-SENT(WS-I)        06210054
                                           WS-ARR-NUM-APPT-TYPE(WS-I)   06220054
                                           WS-ARR-NUM-REGN(WS-I)        06230054
              END-PERFORM                                               06240054
                                                                        06250054
              MOVE ZEROES                  TO   WS-I                    06260054
           END-IF.                                                      06270054
                                                                        06280054
      *-------------------------------------------------------------    06290054
      *    CHECK IF CASE IS DEACTIVATED/HAS OPT OUT                     06300054
      *-------------------------------------------------------------    06310054
           IF FC20-NUM-STATUS = 'D'                                     06320054
              PERFORM 7400-PRINT-OPT-OUT   THRU 7400-EXIT               06330054
              PERFORM 3100-FREEZE-STATUS   THRU 3100-EXIT               06340054
              GO TO 3000-CONTINUE-READ-NEXT                             06350054
           END-IF.                                                      06360054
                                                                        06370054
      *-------------------------------------------------------------    06380054
      *    CHECK IF CASE IS ALREADY GIVEN AN AUTO APPT BY SYSTEM        06390054
      *-------------------------------------------------------------    06400054
           IF KC20-DTE-APPT-AUTO NOT = SPACES AND LOW-VALUES AND ZEROES 06410054
              GO TO 3000-CONTINUE-READ-NEXT.                            06420054
                                                                        06430054
      *-------------------------------------------------------------    06440054
      *    CHECK IF CASE HAS BOOKED THRU SELF BOOKING                   06450054
      *-------------------------------------------------------------    06460054
      *8334 - READING OF KC30 WAS MOVE TO BEGGINNING OF THIS PARAGH*    06470054
      *    MOVE SPACES                     TO   BP13KC30-REC.           06480054
      *    MOVE FC20-NUM-REGN              TO   KC30-NUM-REGN.          06490054
      *    PERFORM 3030-BP13KC30-READ      THRU 3030-EXIT.              06500054
                                                                        06510054
           IF WS-KC30-FND = 'Y' AND KC30-NUM-STATUS = 'B' AND           06520054
              KC30-DTE-APPT  > WS-CURRENT-DATE                          06530054
              PERFORM 7100-PRINT-SBK       THRU 7100-EXIT               06540054
              PERFORM 3100-FREEZE-STATUS   THRU 3100-EXIT               06550054
              PERFORM 3200-UPDATE-ORIG-TP  THRU 3200-EXIT               06560054
              GO TO 3000-CONTINUE-READ-NEXT                             06570054
           END-IF.                                                      06580054
                                                                        06590054
      *-------------------------------------------------------------    06600054
      *    CHECK IF REGN HAS PREVIOUS BOOKING                           06610054
      *-------------------------------------------------------------    06620054
      *KAC1 - THIS NOT NEEDED                                           06630054
      *    MOVE SPACES                     TO   BP13K454-REC.           06640054
      *    IF FC20-NUM-APPT-TYPE = 'SP'                                 06650054
      *       MOVE FC20-NUM-APPT-TYPE      TO   K454-CDE-APPT-TYPE      06660054
      *    ELSE                                                         06670054
      *       MOVE 'TP'                    TO   K454-CDE-APPT-TYPE      06680054
      *    END-IF.                                                      06690054
      *    MOVE FC20-NUM-REGN              TO   K454-NUM-REGN.          06700054
      *    PERFORM 3110-BP13K454-READ      THRU 3110-EXIT.              06710054
      *                                                                 06720054
      *    IF WS-K454-FND = 'Y'                                         06730054
      *       PERFORM 3101-FREEZE-STATUS-2 THRU 3101-EXIT               06740054
      *       GO TO 3000-CONTINUE-READ-NEXT                             06750054
      *    END-IF.                                                      06760054
                                                                        06770054
      *-------------------------------------------------------------    06780054
      *    IF ALL OK, ADD TO TABLE TO AUTO SCHEDULE                     06790054
      *-------------------------------------------------------------    06800054
           ADD 1                      TO   WS-I.                        06810054
           MOVE FC20-DTE-SENT-SELF-BK TO   WS-ARR-DTE-SENT(WS-I).       06820054
           MOVE FC20-NUM-APPT-TYPE    TO   WS-ARR-NUM-APPT-TYPE(WS-I)   06830054
           MOVE FC20-NUM-REGN         TO   WS-ARR-NUM-REGN(WS-I).       06840054
           DISPLAY ' '                                                  06850054
           DISPLAY '(WS-ARR-NUM-REGN(WS-I)=' WS-ARR-NUM-REGN(WS-I) ')'. 06860054
                                                                        06870054
       3000-CONTINUE-READ-NEXT.                                         06880054
                                                                        06890054
           PERFORM 2000-BP13FC20-READ      THRU 2000-EXIT.              06900054
                                                                        06910054
       3000-EXIT.                                                       06920054
           EXIT.                                                        06930054
                                                                        06940054
                                                                        06950054
      *=============================================================    06960054
       3010-READ-BP13K410.                                              06970054
      *=============================================================    06980054
           DISPLAY '**3010-READ-BP13K410'                               06990054
           MOVE FC20-NUM-REGN                    TO K410-NUM-REGN.      07000054
                                                                        07010054
           READ BP13K410.                                               07020054
           EVALUATE WS-K410-STATUS                                      07030054
               WHEN 00                                                  07040054
                    ADD 1                        TO WS-CNT-K410-FND     07050054
                    MOVE 'Y'                     TO WS-K410-FND         07060054
               WHEN 10                                                  07070054
               WHEN 23                                                  07080054
                    MOVE 'N'                     TO WS-K410-FND         07090054
               WHEN OTHER                                               07100054
                  DISPLAY 'READ BP13K410 ERROR '    WS-K410-STATUS      07110054
                  MOVE    WS-K410-STATUS         TO RETURN-CODE         07120054
                  PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT           07130054
           END-EVALUATE.                                                07140054
       3010-EXIT.                                                       07150054
           EXIT.                                                        07160054
                                                                        07170054
      *=============================================================    07180054
       3030-BP13KC30-READ.                                              07190054
      *=============================================================    07200054
           DISPLAY '**3030-BP13KC30-READ'                               07210054
                                                                        07220054
           READ BP13KC30 KEY IS KC30-ALT-KEY2.                          07230054
                                                                        07240054
           EVALUATE WS-KC30-STATUS                                      07250054
           WHEN 00                                                      07260054
              MOVE 'Y'                     TO   WS-KC30-FND             07270054
                                                                        07280054
           WHEN 10                                                      07290054
           WHEN 23                                                      07300054
              MOVE 'N'                     TO   WS-KC30-FND             07310054
                                                                        07320054
           WHEN OTHER                                                   07330054
              DISPLAY 'READ BP13KC30 ERROR '    WS-KC30-STATUS          07340054
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE             07350054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               07360054
           END-EVALUATE.                                                07370054
                                                                        07380054
       3030-EXIT.                                                       07390054
           EXIT.                                                        07400054
                                                                        07410054
                                                                        07420054
      *=============================================================    07430054
       3100-FREEZE-STATUS.                                              07440054
      *=============================================================    07450054
           DISPLAY '**3100-FREEZE-STATUS'                               07460054
                                                                        07470054
           MOVE BP13FC20-REC               TO   BP13KC20-REC.           07480054
                                                                        07490054
           MOVE SPACES                     TO   BP13K454-REC.           07500054
           IF FC20-NUM-APPT-TYPE = 'SP'                                 07510054
              MOVE FC20-NUM-APPT-TYPE      TO   K454-CDE-APPT-TYPE      07520054
           ELSE                                                         07530054
              MOVE 'TP'                    TO   K454-CDE-APPT-TYPE      07540054
           END-IF.                                                      07550054
           MOVE FC20-NUM-REGN              TO   K454-NUM-REGN.          07560054
           PERFORM 3110-BP13K454-READ      THRU 3110-EXIT.              07570054
                                                                        07580054
           IF WS-K454-FND = 'Y'                                         07590054
              MOVE K454-DTE-APPT           TO   KC20-DTE-APPT-CLOSE     07600054
              MOVE K454-TME-APPT           TO   KC20-TME-APPT-CLOSE     07610054
           ELSE                                                         07620054
              MOVE SPACES                  TO   KC20-DTE-APPT-CLOSE     07630054
                                                KC20-TME-APPT-CLOSE     07640054
           END-IF.                                                      07650054
                                                                        07660054
           MOVE KC20-NUM-STATUS            TO   KC20-NUM-STATUS-CLOSE.  07670054
                                                                        07680054
           PERFORM 4320-BP13KC20-REWRITE   THRU 4320-EXIT.              07690054
                                                                        07700054
       3100-EXIT.                                                       07710054
           EXIT.                                                        07720054
                                                                        07730054
                                                                        07740054
      *=============================================================    07750054
       3101-FREEZE-STATUS-2.                                            07760054
      *=============================================================    07770054
           DISPLAY '**3101-FREEZE-STATUS-2'                             07780054
                                                                        07790054
           MOVE BP13FC20-REC               TO   BP13KC20-REC.           07800054
                                                                        07810054
           MOVE 'D'                        TO   KC20-NUM-STATUS         07820054
                                                KC20-NUM-STATUS-CLOSE.  07830054
                                                                        07840054
           PERFORM 4320-BP13KC20-REWRITE   THRU 4320-EXIT.              07850054
                                                                        07860054
       3101-EXIT.                                                       07870054
           EXIT.                                                        07880054
                                                                        07890054
                                                                        07900054
      *=============================================================    07910054
       3110-BP13K454-READ.                                              07920054
      *=============================================================    07930054
           DISPLAY '**3110-BP13K454-READ'                               07940054
           DISPLAY '**K454-ALT1-KEY : ' K454-ALT1-KEY                   07950054
                                                                        07960054
           READ BP13K454 KEY IS K454-ALT1-KEY.                          07970054
                                                                        07980054
           EVALUATE WS-K454-STATUS                                      07990054
           WHEN 00                                                      08000054
              MOVE 'Y'                     TO   WS-K454-FND             08010054
                                                                        08020054
           WHEN 10                                                      08030054
           WHEN 23                                                      08040054
              MOVE 'N'                     TO   WS-K454-FND             08050054
                                                                        08060054
           WHEN OTHER                                                   08070054
              DISPLAY 'READ BP13K454 ERROR '    WS-K454-STATUS          08080054
              MOVE    WS-K454-STATUS       TO   RETURN-CODE             08090054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               08100054
           END-EVALUATE.                                                08110054
                                                                        08120054
       3110-EXIT.                                                       08130054
           EXIT.                                                        08140054
                                                                        08150054
                                                                        08160054
      *=============================================================    08170054
       3200-UPDATE-ORIG-TP.                                             08180054
      *=============================================================    08190054
           DISPLAY '**3200-UPDATE-ORIG-TP'                              08200054
                                                                        08210054
           MOVE SPACES                     TO   BP13K800-MASTER.        08220054
           MOVE FC20-NUM-REGN              TO   K800-NUM-REGN.          08230054
                                                                        08240054
           PERFORM 3210-BP13K800-READ      THRU 3210-EXIT.              08250054
                                                                        08260054
           IF WS-K800-FND = 'N'                                         08270054
              MOVE 'NOT FOUND IN SOC MASTER. ORIG TP DATE NOT SAVED'    08280054
                                           TO   WS-NUM-DESC             08290054
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT               08300054
           END-IF.                                                      08310054
                                                                        08320054
           IF K800-DTE-TP-ORIG = SPACES OR LOW-VALUES OR ZEROES         08330054
              MOVE KC30-DTE-APPT           TO   K800-DTE-TP-ORIG        08340054
           END-IF.                                                      08350054
                                                                        08360054
           PERFORM 3220-BP13K800-REWRITE   THRU 3220-EXIT.              08370054
                                                                        08380054
       3200-EXIT.                                                       08390054
           EXIT.                                                        08400054
                                                                        08410054
                                                                        08420054
      *=============================================================    08430054
       3210-BP13K800-READ.                                              08440054
      *=============================================================    08450054
           DISPLAY '**3210-BP13K800-READ'                               08460054
                                                                        08470054
           READ BP13K800.                                               08480054
                                                                        08490054
           EVALUATE WS-K800-STATUS                                      08500054
           WHEN 00                                                      08510054
              MOVE 'Y'                     TO   WS-K800-FND             08520054
                                                                        08530054
           WHEN 10                                                      08540054
           WHEN 23                                                      08550054
              MOVE 'N'                     TO   WS-K800-FND             08560054
                                                                        08570054
           WHEN OTHER                                                   08580054
              DISPLAY 'READ BP13K800 ERROR '    WS-K800-STATUS          08590054
              MOVE     WS-K800-STATUS      TO   RETURN-CODE             08600054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               08610054
           END-EVALUATE.                                                08620054
                                                                        08630054
       3210-EXIT.                                                       08640054
           EXIT.                                                        08650054
                                                                        08660054
                                                                        08670054
      *=============================================================    08680054
       3220-BP13K800-REWRITE.                                           08690054
      *=============================================================    08700054
           DISPLAY '**3220-BP13K800-REWRITE'                            08710054
                                                                        08720054
           REWRITE BP13K800-MASTER.                                     08730054
                                                                        08740054
           EVALUATE WS-K800-STATUS                                      08750054
           WHEN 00                                                      08760054
              ADD 1                        TO   WS-CNT-K800-UPD         08770054
                                                                        08780054
           WHEN OTHER                                                   08790054
              DISPLAY 'REWRITE BP13K800 ERROR '    WS-K800-STATUS       08800054
              MOVE     WS-K800-STATUS      TO   RETURN-CODE             08810054
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               08820054
           END-EVALUATE.                                                08830054
                                                                        08840054
       3220-EXIT.                                                       08850054
           EXIT.                                                        08860054
                                                                        08870054
                                                                        08880054
      *=============================================================    08890054
       4000-AUTO-SCHEDULE.                                              08900054
      *=============================================================    08910054
      *    INDEX USAGE:                                                 08920054
      *    - WS-I - REGN ARRAY         (MAX 60)                         08930054
      *    - WS-J - TIME ARRAY IN K452 (MAX 18)                         08940054
      *    - WS-K - SLOT ARRAY         (MAX 60)                         08950054
      *-------------------------------------------------------------    08960054
           DISPLAY '**4000-AUTO-SCHEDULE'                               08970054
                                                                        08980054
      *-------------------------------------------------------------    08990054
      *    CLEAR AVAILABLE SLOTS ARRAY                                  09000054
      *-------------------------------------------------------------    09010054
           PERFORM VARYING WS-K FROM 1 BY 1 UNTIL WS-K > WS-K-MAX       09020054
              MOVE SPACES                  TO   WS-BP13KC30-REC(WS-K)   09030054
           END-PERFORM.                                                 09040054
                                                                        09050054
      *-------------------------------------------------------------    09060054
      *    GET ALL AVAILABLE SLOTS                                      09070054
      *-------------------------------------------------------------    09080054
           MOVE  ZEROES                    TO   WS-K.                   09090054
           MOVE 'N'                        TO   WS-KC30-EOF.            09100054
           MOVE SPACES                     TO   BP13KC30-REC            09110054
           MOVE '20200608' TO WS-DTE-SENT-PREV                          09130054
      *****MOVE '20200608  TP  20201001'  TO KC30-KEY-FLD.              09150072
           MOVE P13FC30I-REC(1:28)        TO KC30-KEY-FLD.              09160072
                                                                        09170054
           PERFORM 4010-BP13KC30-STARTBR   THRU 4010-EXIT.              09180054
           PERFORM 4100-GET-VACANT-SLOTS   THRU 4100-EXIT               09190054
                     UNTIL (WS-K > WS-K-MAX)                            09200054
                        OR (WS-KC30-EOF = 'Y').                         09210054
                                                                        09220054
      **   SUBTRACT 1                      FROM WS-K.                   09230054
           MOVE 1                          TO   WS-I.                   09240054
                                                                        09250054
      *-------------------------------------------------------------    09260054
      *    AUTO BOOK CASES WITH NO APPTS (FROM REGN ARRAY) TO           09270054
      *    AVAILABLE SLOTS ARRAY (FROM KC30 ARRAY) WITH SLOTS READ      09280054
      *    FROM BOTTOM TO TOP                                           09290054
      *-------------------------------------------------------------    09300054
           MOVE 1  TO   WS-K.                                           09310054
           PERFORM 4200-BOOK-AVAIL-SLOT    THRU 4200-EXIT               09320054
                     UNTIL (WS-I > WS-I-MAX)                            09330054
      **                OR (WS-K = ZEROES)                              09340054
                        OR (WS-ARR-NUM-REGN(WS-I) = SPACES OR           09350054
                                                LOW-VALUES OR ZEROES).  09360054
                                                                        09370054
      *-------------------------------------------------------------    09380054
      *    IF NO SLOTS ARE AVAILABLE ANYMORE, WRITE TO REPORT           09390054
      *-------------------------------------------------------------    09400054
           IF WS-K = 0                                                  09410054
              IF WS-ARR-NUM-REGN(WS-I) NOT = SPACES AND LOW-VALUES AND  09420054
                                             ZEROES                     09430054
                 PERFORM UNTIL WS-ARR-NUM-REGN(WS-I) = SPACES OR        09440054
                                                LOW-VALUES OR ZEROES    09450054
                    MOVE 'SLOTS NOT ENOUGH TO BOOK REGN'                09460054
                                           TO   WS-NUM-DESC             09470054
                    PERFORM 7300-PRINT-ERROR    THRU 7300-EXIT          09480054
                    ADD 1                  TO   WS-I                    09490054
                 END-PERFORM                                            09500054
              END-IF                                                    09510054
           ELSE                                                         09520054
      *-------------------------------------------------------------    09530054
      *    MOVE UNUSED SLOTS IN SLOTS ARRAY TO FC30 FOR SWITCHING       09540054
      *-------------------------------------------------------------    09550054
              PERFORM UNTIL WS-K = ZEROES                               09560054
                 PERFORM 4999-SAVE-FOR-SWITCH   THRU 4999-EXIT          09570054
                 SUBTRACT 1                FROM WS-K                    09580054
              END-PERFORM                                               09590054
           END-IF.                                                      09600054
                                                                        09601072
           WRITE P13FC30O-REC              FROM WS-KC30-WRT-LAST.       09602072
                                                                        09610054
       4000-EXIT.                                                       09620054
           EXIT.                                                        09630054
                                                                        09640054
                                                                        09650054
      *=============================================================    09660054
       4010-BP13KC30-STARTBR.                                           09670054
      *=============================================================    09680054
           DISPLAY '**4010-BP13KC30-STARTBR'                            09690054
           DISPLAY 'KC30-KEY-FLD 1:' KC30-KEY-FLD                       09700075
                                                                        09710054
      *****START BP13KC30 KEY >= KC30-KEY-FLD.                          09720072
           START BP13KC30 KEY > KC30-KEY-FLD.                           09721072
                                                                        09730054
           EVALUATE WS-KC30-STATUS                                      09740054
           WHEN 00                                                      09750054
           WHEN 02                                                      09760054
              PERFORM 4020-BP13KC30-READNEXT    THRU 4020-EXIT          09770054
              DISPLAY 'BP13KC30-REC 2..:' BP13KC30-REC                  09771075
                                                                        09780054
           WHEN 10                                                      09790054
           WHEN 23                                                      09800054
              MOVE 'Y'                     TO   WS-KC30-EOF             09810054
                                                                        09820054
           WHEN OTHER                                                   09830054
              DISPLAY 'START BP13KC30 ERROR '   WS-KC30-STATUS          09840054
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE             09850054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               09860054
           END-EVALUATE.                                                09870054
                                                                        09880054
       4010-EXIT.                                                       09890054
           EXIT.                                                        09900054
                                                                        09910054
                                                                        09920054
      *=============================================================    09930054
       4020-BP13KC30-READNEXT.                                          09940054
      *=============================================================    09950054
           DISPLAY '**4020-BP13KC30-READNEXT'                           09960054
                                                                        09970054
           READ BP13KC30 NEXT RECORD.                                   09980054
                                                                        09990054
           EVALUATE WS-KC30-STATUS                                      10000054
           WHEN 00                                                      10010054
           WHEN 02                                                      10020054
              DISPLAY 'BP13KC30-REC 3..:' BP13KC30-REC                  10021075
              IF KC30-DTE-SENT-SELF-BK NOT = WS-DTE-SENT-PREV           10030054
                 MOVE 'Y'                  TO   WS-KC30-EOF             10040054
              END-IF                                                    10050054
                                                                        10060054
           WHEN 10                                                      10070054
           WHEN 23                                                      10080054
              MOVE 'Y'                     TO   WS-KC30-EOF             10090054
                                                                        10100054
           WHEN OTHER                                                   10110054
              DISPLAY 'READ BP13KC30 ERROR '    WS-KC30-STATUS          10120054
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE             10130054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               10140054
           END-EVALUATE.                                                10150054
                                                                        10160054
       4020-EXIT.                                                       10170054
           EXIT.                                                        10180054
                                                                        10190054
                                                                        10200054
      *=============================================================    10210054
       4100-GET-VACANT-SLOTS.                                           10220054
      *=============================================================    10230054
           DISPLAY '**4100-GET-VACANT-SLOTS'.                           10240054
           DISPLAY 'BP13KC30-REC ---> ' BP13KC30-REC.                   10250054
                                                                        10260054
           IF WS-DTE-1ST-AVAIL = SPACES OR LOW-VALUES OR ZEROES         10350054
              MOVE KC30-DTE-APPT           TO   WS-DTE-1ST-AVAIL        10360054
           END-IF.                                                      10370054
      *KAC1                                                             10371066
           IF  KC30-NUM-REGN(1:1) NOT = '#'                             10380066
               DISPLAY 'KC30-NUM-REGN(1:1) => ' KC30-NUM-REGN(1:1)      10380167
               GO TO 4100-CONTINUE-READ-NEXT                            10381066
           ELSE                                                         10382066
             ADD 1                        TO   WS-K                     10390068
             MOVE BP13KC30-REC            TO   WS-BP13KC30-REC(WS-K)    10400068
           END-IF.                                                      10410066
      *       DISPLAY '------------------------------'.                 10420078
      *       DISPLAY 'BP13KC30-REC          = ' BP13KC30-REC.          10430078
      *       DISPLAY 'WS-BP13KC30-REC       = ' WS-BP13KC30-REC(WS-K). 10440078
      *       DISPLAY 'WS-K                  = ' WS-K.                  10450078
      *       DISPLAY '------------------------------'.                 10460078
      *       DISPLAY ' '.                                              10470078
                                                                        10480054
       4100-CONTINUE-READ-NEXT.                                         10490054
           MOVE KC30-ALT-KEY1 TO WS-KC30-ALT-KEY1                       10500054
           PERFORM 4020-BP13KC30-READNEXT  THRU 4020-EXIT.              10510054
                                                                        10520054
       4100-EXIT.                                                       10530054
           EXIT.                                                        10540054
                                                                        10550054
                                                                        10560054
      *=============================================================    10570054
       4200-BOOK-AVAIL-SLOT.                                            10580054
      *=============================================================    10590054
           DISPLAY '**4200-BOOK-AVAIL-SLOT'                             10600054
           DISPLAY '__WS-BP13KC30-REC(WS-K) : ' WS-BP13KC30-REC(WS-K)   10610054
                                                                        10620054
           MOVE WS-BP13KC30-REC(WS-K)      TO   BP13KC30-REC.           10630054
                                                                        10640054
                                                                        10680054
      *-------------------------------------------------------------    10690054
      *    SKIP SLOT IF ALREADY BOOKED                                  10700054
      *-------------------------------------------------------------    10710054
           IF (KC30-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES) AND10720054
              (KC30-NUM-STATUS   = 'B')                                 10730054
              GO TO 4200-CONTINUE-READ-NEXT.                            10740054
                                                                        10750054
           IF (KC30-NUM-REGN(1:1) NOT = '#') AND                        10760054
              (KC30-NUM-STATUS        = 'B')                            10770054
              GO TO 4200-CONTINUE-READ-NEXT.                            10780054
                                                                        10790054
      *-------------------------------------------------------------    10800054
      *    SKIP SLOT IF SAME AS 1ST AVAILABLE APPT DATE                 10810054
      *-------------------------------------------------------------    10820054
      **KAC1                                                            10830054
      **   IF KC30-DTE-APPT = WS-DTE-1ST-AVAIL                          10840054
      **      GO TO 4200-CONTINUE-READ-NEXT.                            10850054
                                                                        10860054
      *-------------------------------------------------------------    10870054
      *    CHECK WORKPLAN FOR THE SLOT'S APPT DATE                      10880054
      *-------------------------------------------------------------    10890054
           MOVE SPACES                     TO   BP13K452-REC.           10900054
           MOVE ZEROES                     TO   WS-CNT-VACANT.          10910054
                                                                        10932055
           PERFORM VARYING WS-IDX FROM 1 BY 1 UNTIL WS-IDX > 31         10940054
              OR WS-CNT-VACANT > 0                                      10950076
              IF WS-IDX = 1                                             10960054
                 MOVE P13FC30I-REC(15:8)        TO WS-DTE-OCT           10970179
                 MOVE 1                         TO WS-IDX               10971076
              ELSE                                                      10980054
                 ADD 1                          TO WS-DTE-OCT           10990054
                                                   WS-IDX               10991076
              END-IF                                                    11000054
              MOVE WS-DTE-OCT                   TO K452-DTE-APPT        11010054
                                                                        11011055
              DISPLAY ' '                                               11020054
              DISPLAY 'WS-DTE-OCT : ' WS-DTE-OCT                        11030054
                                                                        11040054
              PERFORM 4240-BP13K452-READ      THRU 4240-EXIT            11050054
              PERFORM 4260-CHECK-AVAIL-SLOT   THRU 4260-EXIT            11060054
           END-PERFORM.                                                 11070054
                                                                        11080054
           IF WS-K452-FND NOT = 'Y'                                     11090054
              PERFORM 4999-SAVE-FOR-SWITCH THRU 4999-EXIT               11100054
              GO TO 4200-CONTINUE-READ-NEXT.                            11110054
                                                                        11120054
           MOVE 'N'                        TO   WS-TIME-FND-FL.         11130054
      ***LINE OF CODE MOVE TO 4260***                                   11140054
      *******************************                                   11150054
           IF WS-CNT-VACANT < 1                                         11160054
              PERFORM 4999-SAVE-FOR-SWITCH THRU 4999-EXIT               11170054
              GO TO 4200-CONTINUE-READ-NEXT.                            11180054
                                                                        11190054
      *-------------------------------------------------------------    11200054
      *    USE CURRENT SLOT TO BOOK REGN                                11210054
      *-------------------------------------------------------------    11220054
           PERFORM 4300-UPD-SELFLIST-APPT  THRU 4300-EXIT.              11230054
           PERFORM 7200-PRINT-AUTO         THRU 7200-EXIT.              11240054
                                                                        11250054
      *-------------------------------------------------------------    11260054
      *    INCREMENT INDEX TO BOOK NEXT REGN                            11270054
      *-------------------------------------------------------------    11280054
           ADD 1                           TO   WS-I.                   11290054
                                                                        11300054
       4200-CONTINUE-READ-NEXT.                                         11310054
                                                                        11320054
      *    MOVE KC30-TME-APPT      TO WS-KC30-TME-APPT-PREV.            11320160
      *    MOVE WS-DTE-OCT         TO WS-DTE-OCT-PREV.                  11321060
           ADD 1                             TO WS-K.                   11330054
      *    SUBTRACT 1                      FROM WS-K.                   11340054
                                                                        11350054
       4200-EXIT.                                                       11360054
           EXIT.                                                        11370054
                                                                        11380054
                                                                        11390054
      *=============================================================    11400054
       4240-BP13K452-READ.                                              11410054
      *=============================================================    11420054
           DISPLAY '**4240-BP13K452-READ'                               11430054
                                                                        11440054
           READ BP13K452.                                               11450054
                                                                        11460054
           EVALUATE WS-K452-STATUS                                      11470054
           WHEN 00                                                      11480054
              MOVE 'Y'                     TO   WS-K452-FND             11490054
                                                                        11500054
           WHEN 10                                                      11510054
           WHEN 23                                                      11520054
              MOVE 'N'                     TO   WS-K452-FND             11530054
                                                                        11540054
           WHEN OTHER                                                   11550054
              DISPLAY 'READ BP13K452 ERROR '    WS-K452-STATUS          11560054
              MOVE    WS-K452-STATUS       TO   RETURN-CODE             11570054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               11580054
           END-EVALUATE.                                                11590054
                                                                        11600054
       4240-EXIT.                                                       11610054
           EXIT.                                                        11620054
                                                                        11630054
                                                                        11640054
      *=============================================================    11650054
       4260-CHECK-AVAIL-SLOT.                                           11660054
      *=============================================================    11670054
      *-------------------------------------------------------------    11680054
      *    CHECK VACANCY FOR TIME SLOT (AM)                             11690054
      *-------------------------------------------------------------    11700054
           DISPLAY '**4260-CHECK-AVAIL-SLOT**'                          11710054
           DISPLAY '*KC30-TME-APPT : ' KC30-TME-APPT                    11720054
           DISPLAY '*K452-TME-SLOT(WS-J): ' K452-TME-SLOT(WS-J)         11730061
                                                                        11731055
      *    IF WS-DTE-OCT <= WS-DTE-OCT-PREV  AND                        11732059
      *       KC30-TME-APPT = WS-KC30-TME-APPT-PREV                     11732159
      *       MOVE 'Y'       TO WS-SAME-DTE-TME                         11732259
      *       IF WS-TOT-SLOT-GIVEN-AM > K452-NUM-MAX-CASE-SB(WS-J) OR   11732359
      *          WS-TOT-SLOT-GIVEN-PM > K452-NUM-MAX-CASE-SB(WS-J) OR   11732459
      *          WS-TOT-SLOT-GIVEN-OT > K452-NUM-MAX-CASE-SB(WS-J)      11732559
      *          MOVE 'N'       TO WS-SAME-DTE-TME                      11732659
      *          MOVE ZEROES    TO WS-TOT-SLOT-GIVEN-AM                 11732759
      *                            WS-TOT-SLOT-GIVEN-PM                 11732859
      *                            WS-TOT-SLOT-GIVEN-OT                 11732959
      *          DISPLAY '+++GO TO 4260-EXIT+++'                        11733059
      *          DISPLAY 'WS-DTE-OCT           = ' WS-DTE-OCT           11733159
      *          DISPLAY 'WS-DTE-OCT-PREV      = ' WS-DTE-OCT-PREV      11733259
      *          DISPLAY 'KC30-TME-APPT        = ' KC30-TME-APPT        11733359
      *          DISPLAY 'WS-KC30-TME-APPT-PREV=' WS-KC30-TME-APPT-PREV 11733459
      *                                                                 11733559
      *          GO TO 4260-EXIT                                        11733659
      *       END-IF                                                    11733759
      *    END-IF.                                                      11733859
                                                                        11734055
           IF KC30-TME-APPT > 0759 AND                                  11740054
              KC30-TME-APPT < 1201                                      11750054
              PERFORM VARYING WS-J FROM 1 BY 1                          11760054
                        UNTIL WS-J > WS-J-MAX                           11770054
                           OR WS-TIME-FND-FL = 'Y'                      11780054
                 IF K452-TME-SLOT(WS-J) = KC30-TME-APPT                 11790054
                    MOVE 'Y'          TO   WS-TIME-FND-FL               11800054
                                                                        11810054
                    DISPLAY '-MAX-CASE-SB:' K452-NUM-MAX-CASE-SB(WS-J)  11820054
                    IF K452-NUM-MAX-CASE-SB(WS-J) NOT NUMERIC           11830054
                       MOVE ZEROES    TO   K452-NUM-MAX-CASE-SB(WS-J)   11840054
                    END-IF                                              11850054
                                                                        11860054
                    IF K452-NUM-TOT-TP-SB(WS-J) NOT NUMERIC             11870054
                       MOVE ZEROES    TO   K452-NUM-TOT-TP-SB(WS-J)     11880054
                    END-IF                                              11890054
                                                                        11900054
                    IF K452-NUM-TOT-SA-SB(WS-J) NOT NUMERIC             11910054
                       MOVE ZEROES    TO   K452-NUM-TOT-SA-SB(WS-J)     11920054
                    END-IF                                              11930054
                                                                        11940054
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                11950054
                       COMPUTE WS-CNT-VACANT =                          11960054
                                      K452-NUM-MAX-CASE-SB(WS-J) -      11970054
                                      K452-NUM-TOT-TP-SB(WS-J)          11980054
                    ELSE                                                11990054
                       COMPUTE WS-CNT-VACANT =                          12000054
                                      K452-NUM-MAX-CASE-SB(WS-J) -      12010054
                                      K452-NUM-TOT-SA-SB(WS-J)          12020054
                    END-IF                                              12030054
                                                                        12031055
      *             IF WS-CNT-VACANT > 0 AND                            12031159
      *                WS-SAME-DTE-TME = 'Y'                            12032059
      *                ADD 1 TO WS-TOT-SLOT-GIVEN-AM                    12033059
      *             END-IF                                              12034059
                 END-IF                                                 12040054
              END-PERFORM                                               12050054
           END-IF.                                                      12060054
                                                                        12070054
      *-------------------------------------------------------------    12080054
      *    CHECK VACANCY FOR TIME SLOT (PM)                             12090054
      *-------------------------------------------------------------    12100054
           IF KC30-TME-APPT > 1200 AND                                  12110054
              KC30-TME-APPT < 1701                                      12120054
              PERFORM VARYING WS-J FROM 1 BY 1                          12130054
                        UNTIL WS-J > WS-J-MAX                           12140054
                           OR WS-TIME-FND-FL = 'Y'                      12150054
                 IF K452-PM-TME-SLOT(WS-J) = KC30-TME-APPT              12160054
                    MOVE 'Y'          TO   WS-TIME-FND-FL               12170054
                                                                        12180054
                    IF K452-PM-MAX-CASE-SB(WS-J) NOT NUMERIC            12190054
                       MOVE ZEROES    TO   K452-PM-MAX-CASE-SB(WS-J)    12200054
                    END-IF                                              12210054
                                                                        12220054
                    IF K452-PM-TOT-TP-SB(WS-J) NOT NUMERIC              12230054
                       MOVE ZEROES    TO   K452-PM-TOT-TP-SB(WS-J)      12240054
                    END-IF                                              12250054
                                                                        12260054
                    IF K452-PM-TOT-SA-SB(WS-J) NOT NUMERIC              12270054
                       MOVE ZEROES    TO   K452-PM-TOT-SA-SB(WS-J)      12280054
                    END-IF                                              12290054
                                                                        12300054
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                12310054
                       COMPUTE WS-CNT-VACANT =                          12320054
                                      K452-PM-MAX-CASE-SB(WS-J) -       12330054
                                      K452-PM-TOT-TP-SB(WS-J)           12340054
                    ELSE                                                12350054
                       COMPUTE WS-CNT-VACANT =                          12360054
                                      K452-PM-MAX-CASE-SB(WS-J) -       12370054
                                      K452-PM-TOT-SA-SB(WS-J)           12380054
                    END-IF                                              12390054
                                                                        12391055
      *             IF WS-CNT-VACANT > 0 AND                            12391159
      *                WS-SAME-DTE-TME = 'Y'                            12392059
      *                ADD 1 TO WS-TOT-SLOT-GIVEN-PM                    12393059
      *             END-IF                                              12394059
                 END-IF                                                 12400054
              END-PERFORM                                               12410054
           END-IF.                                                      12420054
                                                                        12430054
      *-------------------------------------------------------------    12440054
      *    CHECK VACANCY FOR TIME SLOT (OT)                             12450054
      *-------------------------------------------------------------    12460054
           IF KC30-TME-APPT > 1659 AND                                  12470054
              KC30-TME-APPT < 2000                                      12480054
              PERFORM VARYING WS-J FROM 1 BY 1                          12490054
                        UNTIL WS-J > WS-J-MAX                           12500054
                           OR WS-TIME-FND-FL = 'Y'                      12510054
                 IF K452-OT-TME-SLOT(WS-J) = KC30-TME-APPT              12520054
                    MOVE 'Y'          TO   WS-TIME-FND-FL               12530054
                                                                        12540054
                    IF K452-OT-MAX-CASE-SB(WS-J) NOT NUMERIC            12550054
                       MOVE ZEROES    TO   K452-OT-MAX-CASE-SB(WS-J)    12560054
                    END-IF                                              12570054
                                                                        12580054
                    IF K452-OT-TOT-TP-SB(WS-J) NOT NUMERIC              12590054
                       MOVE ZEROES    TO   K452-OT-TOT-TP-SB(WS-J)      12600054
                    END-IF                                              12610054
                                                                        12620054
                    IF K452-OT-TOT-SA-SB(WS-J) NOT NUMERIC              12630054
                       MOVE ZEROES    TO   K452-OT-TOT-SA-SB(WS-J)      12640054
                    END-IF                                              12650054
                                                                        12660054
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                12670054
                       COMPUTE WS-CNT-VACANT =                          12680054
                                      K452-OT-MAX-CASE-SB(WS-J) -       12690054
                                      K452-OT-TOT-TP-SB(WS-J)           12700054
                    ELSE                                                12710054
                       COMPUTE WS-CNT-VACANT =                          12720054
                                      K452-OT-MAX-CASE-SB(WS-J) -       12730054
                                      K452-OT-TOT-SA-SB(WS-J)           12740054
                    END-IF                                              12750054
                                                                        12751055
      *             IF WS-CNT-VACANT > 0 AND                            12752059
      **               WS-SAME-DTE-TME = 'Y'                            12753059
      *                ADD 1 TO WS-TOT-SLOT-GIVEN-OT                    12754059
      *             END-IF                                              12755059
                 END-IF                                                 12760054
              END-PERFORM                                               12770054
           END-IF.                                                      12780054
                                                                        12790054
           DISPLAY 'WS-CNT-VACANT = ' WS-CNT-VACANT.                    12800054
       4260-EXIT.                                                       12810054
           EXIT.                                                        12820054
                                                                        12830054
                                                                        12840054
      *=============================================================    12850054
       4300-UPD-SELFLIST-APPT.                                          12860054
      *=============================================================    12870054
           DISPLAY '**4300-UPD-SELFLIST-APPT'                           12880054
           DISPLAY '--WS-ARR-NUM-REGN(WS-I) : ' WS-ARR-NUM-REGN(WS-I)   12890054
                                                                        12900054
           MOVE SPACES                     TO   BP13KC20-REC.           12910054
           MOVE WS-ARR-NUM-REGN(WS-I)      TO   KC20-NUM-REGN.          12920054
                                                                        12930054
           PERFORM 4310-BP13KC20-READ      THRU 4310-EXIT.              12940054
                                                                        12950054
           IF WS-KC20-FND = 'Y'                                         12960054
              MOVE 'S'                     TO   KC20-NUM-STATUS         12970054
                                                KC20-NUM-STATUS-CLOSE   12980054
      *       MOVE KC30-DTE-APPT           TO   KC20-DTE-APPT-AUTO      12990054
      *       MOVE WS-DTE-OCT              TO   KC20-DTE-APPT-AUTO      13000069
              MOVE WS-BP13KC30-REC(WS-K) (15:8) TO KC20-DTE-APPT-AUTO   13001069
                                                   KC20-DTE-APPT-CLOSE  13010069
              MOVE WS-BP13KC30-REC(WS-K) (23:6) TO KC20-TME-APPT-AUTO   13020069
                                                   KC20-TME-APPT-CLOSE  13030069
                                                                        13040054
              PERFORM 4320-BP13KC20-REWRITE     THRU 4320-EXIT          13050054
                                                                        13060054
              WRITE BP13FC2A-REC           FROM BP13KC20-REC            13070054
              ADD 1                        TO   WS-CNT-FC2A-WRITE       13080054
                                                                        13090054
      *       MOVE BP13KC30-REC(1:28)      TO WS-KC30-KEY-FLD           13100054
              PERFORM 4400-READ-REWRITE-KC30 THRU 4400-EXIT             13110054
                                                                        13120054
           ELSE                                                         13130054
              MOVE 'REGN NOT FOUND IN SELF BOOKING LIST'                13140054
                                           TO   WS-NUM-DESC             13150054
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT               13160054
           END-IF.                                                      13170054
                                                                        13180054
       4300-EXIT.                                                       13190054
           EXIT.                                                        13200054
                                                                        13210054
                                                                        13220054
      *=============================================================    13230054
       4310-BP13KC20-READ.                                              13240054
      *=============================================================    13250054
           DISPLAY '**4310-BP13KC20-READ'                               13260054
                                                                        13270054
           READ BP13KC20 KEY IS KC20-ALT-KEY.                           13280054
                                                                        13290054
           EVALUATE WS-KC20-STATUS                                      13300054
           WHEN 00                                                      13310054
              MOVE 'Y'                     TO   WS-KC20-FND             13320054
                                                                        13330054
           WHEN 10                                                      13340054
           WHEN 23                                                      13350054
              MOVE 'N'                     TO   WS-KC20-FND             13360054
                                                                        13370054
           WHEN OTHER                                                   13380054
              DISPLAY 'READ BP13KC20 ERROR '    WS-KC20-STATUS          13390054
              MOVE    WS-KC20-STATUS       TO   RETURN-CODE             13400054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               13410054
           END-EVALUATE.                                                13420054
                                                                        13430054
       4310-EXIT.                                                       13440054
           EXIT.                                                        13450054
                                                                        13460054
                                                                        13470054
      *=============================================================    13480054
       4320-BP13KC20-REWRITE.                                           13490054
      *=============================================================    13500054
           DISPLAY '**4320-BP13KC20-REWRITE'                            13510054
                                                                        13520054
           REWRITE BP13KC20-REC.                                        13530054
                                                                        13540054
           EVALUATE WS-KC20-STATUS                                      13550054
           WHEN 00                                                      13560054
              ADD 1                        TO   WS-CNT-KC20-UPD         13570054
                                                                        13580054
           WHEN OTHER                                                   13590054
              STRING 'REWRITE ERROR ON SBK SLOT: '                      13600054
                      WS-KC20-STATUS '/' KC20-KEY-FLD                   13610054
                      DELIMITED BY SIZE    INTO WS-NUM-DESC             13620054
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT               13630054
           END-EVALUATE.                                                13640054
                                                                        13650054
       4320-EXIT.                                                       13660054
           EXIT.                                                        13670054
                                                                        13680054
                                                                        13690054
      *=============================================================    13700054
       4400-READ-REWRITE-KC30.                                          13710054
      *=============================================================    13720054
           DISPLAY '==4400-READ-REWRITE-KC30=='.                        13730054
                                                                        13740054
           MOVE WS-BP13KC30-REC(WS-K) (1:28) TO KC30-KEY-FLD.           13750054
                                                                        13760054
           READ BP13KC30.                                               13770054
                                                                        13780054
           EVALUATE WS-KC30-STATUS                                      13790054
           WHEN 00                                                      13800054
           WHEN 02                                                      13810054
              DISPLAY '--FOUND/DUP-TO WRITE, STAT: ' WS-KC30-STATUS     13820054
              PERFORM 4500-REWRITE-BP13KC30  THRU 4500-EXIT             13830054
           WHEN 10                                                      13840054
           WHEN 23                                                      13850054
                DISPLAY 'BP13KC30 - NOT FOUND TO WRITE REC'             13860054
                PERFORM 4600-WRITE-BP13KC30    THRU 4600-EXIT           13870054
           WHEN OTHER                                                   13880054
              DISPLAY 'READ BP13KC30 ERROR '    WS-KC30-STATUS          13890054
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE             13900054
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               13910054
           END-EVALUATE.                                                13920054
                                                                        13930054
                                                                        13940054
       4400-EXIT.                                                       13950054
           EXIT.                                                        13960054
                                                                        13970054
                                                                        13980054
      *=============================================================    13990054
       4500-REWRITE-BP13KC30.                                           14000054
      *=============================================================    14010054
           DISPLAY '==4500-REWRITE-BP13KC30=='.                         14020054
                                                                        14030054
           MOVE WS-BP13KC30-REC(WS-K)         TO BP13KC30-REC.          14040054
      **   MOVE WS-DTE-OCT                    TO KC30-DTE-APPT.         14050054
           MOVE WS-ARR-NUM-REGN(WS-I)         TO KC30-NUM-REGN.         14060054
           MOVE 'B'                           TO KC30-NUM-STATUS.       14070054
           DISPLAY '=BP13KC30-REC :(' BP13KC30-REC ')'                  14080054
                                                                        14090054
      *****TO USE AS STARTKEY FOR NEXT RUN****                          14090172
           MOVE BP13KC30-REC                  TO WS-KC30-WRT-LAST       14091072
                                                                        14092072
           REWRITE BP13KC30-REC.                                        14100054
                                                                        14110054
           EVALUATE WS-KC30-STATUS                                      14120054
           WHEN 00                                                      14130054
              ADD 1                        TO   WS-CNT-KC30-UPD         14140054
                                                                        14150054
           WHEN OTHER                                                   14160054
              DISPLAY 'KC30 REWRITE ERROR : ' WS-KC30-STATUS            14170054
              STRING 'BP13KC30 - REWRITE ERROR ' WS-KC30-STATUS         14180054
                      WS-KC30-STATUS '/' KC30-KEY-FLD                   14190054
                      DELIMITED BY SIZE    INTO WS-NUM-DESC             14200054
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT               14210054
           END-EVALUATE.                                                14220054
                                                                        14230054
       4500-EXIT.                                                       14240054
           EXIT.                                                        14250054
                                                                        14260054
                                                                        14270054
      *=============================================================    14280054
       4600-WRITE-BP13KC30.                                             14290054
      *=============================================================    14300054
           DISPLAY '==4600-WRITE-BP13KC30=='.                           14310054
                                                                        14320054
           MOVE WS-BP13KC30-REC(WS-K)         TO BP13KC30-REC.          14330054
           MOVE WS-ARR-NUM-REGN(WS-I)         TO KC30-NUM-REGN.         14340054
           MOVE 'B'                           TO KC30-NUM-STATUS.       14350054
           DISPLAY '=BP13KC30-REC :(' BP13KC30-REC ')'                  14360054
                                                                        14370054
           WRITE BP13KC30-REC.                                          14380054
                                                                        14390054
           EVALUATE WS-KC30-STATUS                                      14400054
           WHEN 00                                                      14410054
              ADD 1                        TO   WS-CNT-KC30-UPD         14420054
                                                                        14430054
           WHEN OTHER                                                   14440054
              DISPLAY 'KC30 WRITE ERROR : ' WS-KC30-STATUS              14450054
              STRING 'BP13KC30 - REWRITE ERROR ' WS-KC30-STATUS         14460054
                      WS-KC30-STATUS '/' KC30-KEY-FLD                   14470054
                      DELIMITED BY SIZE    INTO WS-NUM-DESC             14480054
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT               14490054
           END-EVALUATE.                                                14500054
       4600-EXIT.                                                       14510054
           EXIT.                                                        14520054
                                                                        14530054
                                                                        14540054
      *=============================================================    14550054
       4999-SAVE-FOR-SWITCH.                                            14560054
      *=============================================================    14570054
           DISPLAY '**4999-SAVE-FOR-SWITCH'                             14580054
                                                                        14590054
           MOVE WS-BP13KC30-REC(WS-K)      TO   BP13KC30-REC.           14600054
                                                                        14610054
           IF (KC30-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES) AND14620054
              (KC30-NUM-STATUS   = 'B')                                 14630054
              GO TO 4999-EXIT.                                          14640054
                                                                        14650054
           IF (KC30-NUM-REGN(1:1) NOT = '#') AND                        14660054
              (KC30-NUM-STATUS        = 'B')                            14670054
              GO TO 4999-EXIT.                                          14680054
                                                                        14690054
           MOVE BP13KC30-REC               TO   WS-BP13FC30-REC.        14700054
           MOVE 1                          TO   WS-FC30-CNT-REC.        14710054
                                                                        14720054
           WRITE BP13FC30-REC              FROM WS-BP13FC30-REC.        14730054
           ADD  1                          TO   WS-CNT-FC30-WRITE.      14740054
                                                                        14750054
       4999-EXIT.                                                       14760054
           EXIT.                                                        14770054
                                                                        14780054
                                                                        14790054
      *=============================================================    14800054
       7100-PRINT-SBK.                                                  14810054
      *=============================================================    14820054
           DISPLAY '**7100-PRINT-SBK'                                   14830054
                                                                        14840054
           IF WS-CNT-LINE-A > 55                                        14850054
              PERFORM 7101-PRINT-SBK-HDR   THRU 7101-EXIT               14860054
           END-IF.                                                      14870054
                                                                        14880054
           ADD 1                           TO   WS-CNT-SNO-A.           14890054
           MOVE WS-CNT-SNO-A               TO   L45SA-NUM-SNO.          14900054
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45SA-DTE-SENT.         14910054
           MOVE FC20-NUM-REGN              TO   L45SA-NUM-REGN.         14920054
                                                                        14930054
           IF FC20-NUM-APPT-TYPE = 'TP'                                 14940054
              MOVE 'WT'                    TO   L45SA-NUM-APPT-TYPE     14950054
           END-IF.                                                      14960054
           IF FC20-NUM-APPT-TYPE = 'SP'                                 14970054
              MOVE 'WP'                    TO   L45SA-NUM-APPT-TYPE     14980054
           END-IF.                                                      14990054
                                                                        15000054
           MOVE KC30-DTE-APPT              TO   L45SA-DTE-APPT.         15010054
                                                                        15020054
           STRING KC30-TME-APPT(1:2) ':' KC30-TME-APPT(3:2)             15030054
                  DELIMITED BY SIZE        INTO L45SA-TME-APPT.         15040054
                                                                        15050054
           MOVE 'Y'                        TO   L45SA-NUM-SBK.          15060054
                                                                        15070054
           WRITE P13L45SA-REC              FROM L45SA-PR-DTL.           15080054
                                                                        15090054
           ADD 1                           TO   WS-CNT-LINE-A.          15100054
           ADD 1                           TO   WS-CNT-L45SA-WRITE.     15110054
                                                                        15120054
       7100-EXIT.                                                       15130054
           EXIT.                                                        15140054
                                                                        15150054
                                                                        15160054
      *=============================================================    15170054
       7101-PRINT-SBK-HDR.                                              15180054
      *=============================================================    15190054
           DISPLAY '**7101-PRINT-SBK-HDR'                               15200054
                                                                        15210054
           ADD 1                           TO   WS-CNT-PAGE-A.          15220054
           MOVE WS-CNT-PAGE-A              TO   L45SA-PAGE.             15230054
           MOVE WS-DTE-CURR-10             TO   L45SA-CURRENT-DATE.     15240054
                                                                        15250054
           WRITE P13L45SA-REC FROM L45SA-PR-HEAD-01 AFTER PAGE.         15260054
           WRITE P13L45SA-REC FROM L45SA-PR-HEAD-02.                    15270054
           WRITE P13L45SA-REC FROM L45SA-PR-TITLE-1 AFTER 2.            15280054
           WRITE P13L45SA-REC FROM L45SA-PR-TITLE-2.                    15290054
                                                                        15300054
           MOVE SPACES                     TO   P13L45SA-REC.           15310054
           WRITE P13L45SA-REC.                                          15320054
                                                                        15330054
           MOVE 6                          TO   WS-CNT-LINE-A.          15340054
                                                                        15350054
       7101-EXIT.                                                       15360054
           EXIT.                                                        15370054
                                                                        15380054
                                                                        15390054
      *=============================================================    15400054
       7102-PRINT-MANUAL.                                               15410054
      *=============================================================    15420054
           DISPLAY '**7102-PRINT-MANUAL'                                15430054
                                                                        15440054
           IF WS-CNT-LINE-A > 55                                        15450054
              PERFORM 7101-PRINT-SBK-HDR   THRU 7101-EXIT               15460054
           END-IF.                                                      15470054
                                                                        15480054
           ADD 1                           TO   WS-CNT-SNO-A.           15490054
           MOVE WS-CNT-SNO-A               TO   L45SA-NUM-SNO.          15500054
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45SA-DTE-SENT.         15510054
           MOVE FC20-NUM-REGN              TO   L45SA-NUM-REGN.         15520054
                                                                        15530054
           IF FC20-NUM-APPT-TYPE = 'TP'                                 15540054
              MOVE 'WT'                    TO   L45SA-NUM-APPT-TYPE     15550054
           END-IF.                                                      15560054
           IF FC20-NUM-APPT-TYPE = 'SP'                                 15570054
              MOVE 'WP'                    TO   L45SA-NUM-APPT-TYPE     15580054
           END-IF.                                                      15590054
                                                                        15600054
           MOVE K454-DTE-APPT              TO   L45SA-DTE-APPT.         15610054
                                                                        15620054
           STRING K454-TME-APPT(1:2) ':' K454-TME-APPT(3:2)             15630054
                  DELIMITED BY SIZE        INTO L45SA-TME-APPT.         15640054
                                                                        15650054
           MOVE SPACES                     TO   L45SA-NUM-SBK.          15660054
                                                                        15670054
           WRITE P13L45SA-REC              FROM L45SA-PR-DTL.           15680054
                                                                        15690054
           ADD 1                           TO   WS-CNT-LINE-A.          15700054
           ADD 1                           TO   WS-CNT-L45SA-WRITE.     15710054
                                                                        15720054
       7102-EXIT.                                                       15730054
           EXIT.                                                        15740054
                                                                        15750054
                                                                        15760054
      *=============================================================    15770054
       7200-PRINT-AUTO.                                                 15780054
      *=============================================================    15790054
           DISPLAY '**7200-PRINT-AUTO'                                  15800054
                                                                        15810054
           IF WS-CNT-LINE-B > 55                                        15820054
              PERFORM 7201-PRINT-AUTO-HDR  THRU 7201-EXIT               15830054
           END-IF.                                                      15840054
                                                                        15850054
           ADD 1                           TO   WS-CNT-SNO-B.           15860054
           MOVE WS-CNT-SNO-B               TO   L45SB-NUM-SNO.          15870054
           MOVE KC20-DTE-SENT-SELF-BK      TO   L45SB-DTE-SENT.         15880054
           MOVE WS-ARR-NUM-REGN(WS-I)      TO   L45SB-NUM-REGN.         15890054
                                                                        15900054
           IF KC20-NUM-APPT-TYPE = 'TP'                                 15910054
              MOVE 'WT'                    TO   L45SB-NUM-APPT-TYPE     15920054
           END-IF.                                                      15930054
           IF KC20-NUM-APPT-TYPE = 'SP'                                 15940054
              MOVE 'WP'                    TO   L45SB-NUM-APPT-TYPE     15950054
           END-IF.                                                      15960054
                                                                        15970054
           MOVE WS-BP13KC30-REC(WS-K) (15:8) TO L45SB-DTE-APPT.         16033080
                                                                        16034080
           STRING WS-BP13KC30-REC(WS-K) (23:2) ':'                      16036080
                  WS-BP13KC30-REC(WS-K) (25:2)                          16037080
                  DELIMITED BY SIZE INTO     L45SB-TME-APPT.            16038080
                                                                        16040054
           WRITE P13L45SB-REC              FROM L45SB-PR-DTL.           16050054
                                                                        16060054
           ADD 1                           TO   WS-CNT-LINE-B.          16070054
           ADD 1                           TO   WS-CNT-L45SB-WRITE.     16080054
                                                                        16090054
       7200-EXIT.                                                       16100054
           EXIT.                                                        16110054
                                                                        16120054
                                                                        16130054
      *=============================================================    16140054
       7201-PRINT-AUTO-HDR.                                             16150054
      *=============================================================    16160054
           DISPLAY '**7201-PRINT-AUTO-HDR'                              16170054
                                                                        16180054
           ADD 1                           TO   WS-CNT-PAGE-B.          16190054
           MOVE WS-CNT-PAGE-B              TO   L45SB-PAGE.             16200054
           MOVE WS-DTE-CURR-10             TO   L45SB-CURRENT-DATE.     16210054
                                                                        16220054
           WRITE P13L45SB-REC FROM L45SB-PR-HEAD-01 AFTER PAGE.         16230054
           WRITE P13L45SB-REC FROM L45SB-PR-HEAD-02.                    16240054
           WRITE P13L45SB-REC FROM L45SB-PR-TITLE-1 AFTER 2.            16250054
           WRITE P13L45SB-REC FROM L45SB-PR-TITLE-2.                    16260054
                                                                        16270054
           MOVE SPACES                     TO   P13L45SB-REC.           16280054
           WRITE P13L45SB-REC.                                          16290054
                                                                        16300054
           MOVE 6                          TO   WS-CNT-LINE-B.          16310054
                                                                        16320054
       7201-EXIT.                                                       16330054
           EXIT.                                                        16340054
                                                                        16350054
                                                                        16360054
      *=============================================================    16370054
       7300-PRINT-ERROR.                                                16380054
      *=============================================================    16390054
           DISPLAY '**7300-PRINT-ERROR'                                 16400054
                                                                        16410054
           IF WS-CNT-LINE-C > 55                                        16420054
              PERFORM 7301-PRINT-ERROR-HDR THRU 7301-EXIT               16430054
           END-IF.                                                      16440054
                                                                        16450054
           ADD 1                           TO   WS-CNT-SNO-C.           16460054
           MOVE WS-CNT-SNO-C               TO   L45SC-NUM-SNO.          16470054
                                                                        16480054
           IF WS-KC30-ERR-FND = 'Y'                                     16490054
             WRITE P13L45SC-REC            FROM L45SC-PR-DTL            16500054
           ELSE                                                         16510054
             MOVE WS-ARR-DTE-SENT(WS-I)      TO   L45SC-DTE-SENT        16520054
             MOVE WS-ARR-NUM-REGN(WS-I)      TO   L45SC-NUM-REGN        16530054
             MOVE WS-ARR-NUM-APPT-TYPE(WS-I) TO   L45SC-NUM-APPT-TYPE   16540054
             MOVE WS-NUM-DESC                TO   L45SC-NUM-DESC        16550054
             WRITE P13L45SC-REC            FROM L45SC-PR-DTL            16560054
           END-IF.                                                      16570054
           ADD 1                           TO   WS-CNT-LINE-C.          16580054
           ADD 1                           TO   WS-CNT-L45SC-WRITE.     16590054
           MOVE 'N'                        TO   WS-KC30-ERR-FND.        16600054
                                                                        16610054
       7300-EXIT.                                                       16620054
           EXIT.                                                        16630054
                                                                        16640054
                                                                        16650054
      *=============================================================    16660054
       7301-PRINT-ERROR-HDR.                                            16670054
      *=============================================================    16680054
           DISPLAY '**7301-PRINT-ERROR-HDR'                             16690054
                                                                        16700054
           ADD 1                           TO   WS-CNT-PAGE-C.          16710054
           MOVE WS-CNT-PAGE-C              TO   L45SC-PAGE.             16720054
           MOVE WS-DTE-CURR-10             TO   L45SC-CURRENT-DATE.     16730054
                                                                        16740054
           WRITE P13L45SC-REC FROM L45SC-PR-HEAD-01 AFTER PAGE.         16750054
           WRITE P13L45SC-REC FROM L45SC-PR-HEAD-02.                    16760054
           WRITE P13L45SC-REC FROM L45SC-PR-TITLE-1 AFTER 2.            16770054
           WRITE P13L45SC-REC FROM L45SC-PR-TITLE-2.                    16780054
                                                                        16790054
           MOVE SPACES                     TO   P13L45SC-REC.           16800054
           WRITE P13L45SC-REC.                                          16810054
                                                                        16820054
           MOVE 6                          TO   WS-CNT-LINE-C.          16830054
                                                                        16840054
       7301-EXIT.                                                       16850054
           EXIT.                                                        16860054
                                                                        16870054
                                                                        16880054
      *=============================================================    16890054
       7400-PRINT-OPT-OUT.                                              16900054
      *=============================================================    16910054
           DISPLAY '**7400-PRINT-OPT-OUT'                               16920054
                                                                        16930054
           IF WS-CNT-LINE-D > 55                                        16940054
              PERFORM 7401-PRINT-OPT-OUT-HDR    THRU 7401-EXIT          16950054
           END-IF.                                                      16960054
                                                                        16970054
           ADD 1                           TO   WS-CNT-SNO-D.           16980054
           MOVE WS-CNT-SNO-D               TO   L45SD-NUM-SNO.          16990054
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45SD-DTE-SENT.         17000054
           MOVE FC20-NUM-REGN              TO   L45SD-NUM-REGN.         17010054
                                                                        17020054
           IF FC20-NUM-APPT-TYPE = 'TP'                                 17030054
              MOVE 'WT'                    TO   L45SD-NUM-APPT-TYPE     17040054
           END-IF.                                                      17050054
           IF FC20-NUM-APPT-TYPE = 'SP'                                 17060054
              MOVE 'WP'                    TO   L45SD-NUM-APPT-TYPE     17070054
           END-IF.                                                      17080054
                                                                        17090054
           MOVE FC20-NUM-USERID-DEL        TO   L45SD-NUM-USERID.       17100054
           MOVE FC20-DTE-UPDATE-DEL        TO   L45SD-DTE-DEL.          17110054
                                                                        17120054
           STRING FC20-TME-UPDATE-DEL(1:2)                              17130054
                  FC20-TME-UPDATE-DEL(3:2)                              17140054
                  DELIMITED BY SIZE        INTO L45SD-TME-DEL.          17150054
                                                                        17160054
           WRITE P13L45SD-REC              FROM L45SD-PR-DTL.           17170054
                                                                        17180054
           ADD 1                           TO   WS-CNT-LINE-D.          17190054
           ADD 1                           TO   WS-CNT-L45SD-WRITE.     17200054
                                                                        17210054
       7400-EXIT.                                                       17220054
           EXIT.                                                        17230054
                                                                        17240054
                                                                        17250054
      *=============================================================    17260054
       7401-PRINT-OPT-OUT-HDR.                                          17270054
      *=============================================================    17280054
           DISPLAY '**7401-PRINT-OPT-OUT-HDR'                           17290054
                                                                        17300054
           ADD 1                           TO   WS-CNT-PAGE-D.          17310054
           MOVE WS-CNT-PAGE-D              TO   L45SD-PAGE.             17320054
           MOVE WS-DTE-CURR-10             TO   L45SD-CURRENT-DATE.     17330054
                                                                        17340054
           WRITE P13L45SD-REC FROM L45SD-PR-HEAD-01 AFTER PAGE.         17350054
           WRITE P13L45SD-REC FROM L45SD-PR-HEAD-02.                    17360054
           WRITE P13L45SD-REC FROM L45SD-PR-TITLE-1 AFTER 2.            17370054
           WRITE P13L45SD-REC FROM L45SD-PR-TITLE-2.                    17380054
                                                                        17390054
           MOVE SPACES                     TO   P13L45SD-REC.           17400054
           WRITE P13L45SD-REC.                                          17410054
                                                                        17420054
           MOVE 6                          TO   WS-CNT-LINE-D.          17430054
                                                                        17440054
       7401-EXIT.                                                       17450054
           EXIT.                                                        17460054
                                                                        17470054
                                                                        17480054
      *=============================================================    17490054
       9000-CLOSE-ROUTINE.                                              17500054
      *=============================================================    17510054
           DISPLAY '**9000-CLOSE-ROUTINE'                               17520054
                                                                        17530054
           CLOSE BP13FC20                                               17540054
                 BP13KC30                                               17550054
                 BP13K452                                               17560054
                 BP13K454                                               17570054
                 BP13KC20                                               17580054
                 BP13K800                                               17590054
                 BP13FC30                                               17600054
                 P13FC30I                                               17601072
                 P13FC30O                                               17602072
                 BP13FC2A                                               17610054
                 P13L45SA                                               17620054
                 P13L45SB                                               17630054
                 P13L45SC                                               17640054
                 P13L45SD.                                              17650054
                                                                        17660054
           IF WS-KC20-STATUS NOT = 00 AND 97                            17670054
              DISPLAY 'CLOSING BP13KC20 ERROR ' WS-KC20-STATUS          17680054
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE             17690054
           END-IF.                                                      17700054
                                                                        17710054
           IF WS-KC30-STATUS NOT = 00 AND 97                            17720054
              DISPLAY 'CLOSING BP13KC30 ERROR ' WS-KC30-STATUS          17730054
              MOVE     WS-KC30-STATUS      TO   RETURN-CODE             17740054
           END-IF.                                                      17750054
                                                                        17760054
           IF WS-K452-STATUS NOT = 00 AND 97                            17770054
              DISPLAY 'CLOSING BP13K452 ERROR ' WS-K452-STATUS          17780054
              MOVE     WS-K452-STATUS      TO   RETURN-CODE             17790054
           END-IF.                                                      17800054
                                                                        17810054
           IF WS-K454-STATUS NOT = 00 AND 97                            17820054
              DISPLAY 'CLOSING BP13K454 ERROR ' WS-K454-STATUS          17830054
              MOVE     WS-K454-STATUS      TO   RETURN-CODE             17840054
           END-IF.                                                      17850054
                                                                        17860054
           IF WS-K800-STATUS NOT = 00 AND 97                            17870054
              DISPLAY 'CLOSING BP13K800 ERROR ' WS-K800-STATUS          17880054
              MOVE     WS-K454-STATUS      TO   RETURN-CODE             17890054
           END-IF.                                                      17900054
                                                                        17910054
           DISPLAY '   '.                                               17920054
           DISPLAY '*------- BP13C45S CONTROL TOTAL -------*'.          17930054
           DISPLAY '   '.                                               17940054
           DISPLAY ' 1. NO OF BP13FC20 READ      : ' WS-CNT-FC20-READ.  17950054
           DISPLAY ' 1A.NO OF K410 FOUND & SKIP  : ' WS-CNT-K410-FND.   17960054
           DISPLAY ' 2. NO OF BP13KC20 UPDATED   : ' WS-CNT-KC20-UPD.   17970054
           DISPLAY ' 3. NO OF BP13K800 UPDATED   : ' WS-CNT-K800-UPD.   17980054
           DISPLAY ' 4. NO OF BP13KC30 UPDATED   : ' WS-CNT-KC30-UPD.   17990054
           DISPLAY ' 5. NO OF BP13FC30 WRITTEN   : ' WS-CNT-FC30-WRITE. 18000054
           DISPLAY ' 6. NO OF BP13FC2A WRITTEN   : ' WS-CNT-FC2A-WRITE. 18010054
           DISPLAY ' 7. NO OF P13L45SA WRITTEN   : ' WS-CNT-L45SA-WRITE.18020054
           DISPLAY ' 8. NO OF P13L45SB WRITTEN   : ' WS-CNT-L45SB-WRITE.18030054
           DISPLAY ' 9. NO OF P13L45SC WRITTEN   : ' WS-CNT-L45SC-WRITE.18040054
           DISPLAY '10. NO OF P13L45SD WRITTEN   : ' WS-CNT-L45SD-WRITE.18050054
           DISPLAY '  '.                                                18060054
                                                                        18070054
           STOP RUN.                                                    18080054
                                                                        18090054
       9000-EXIT.                                                       18100054
           EXIT.                                                        18110054
