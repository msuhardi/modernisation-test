       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13CS03.                                         00020000
       AUTHOR.        SHARON DUMDUM.                                    00030000
      *DATE-WRITTEN.  11/07/2006.                                       00040000
                                                                        00050000
      *************************************************************     00060000
      *      SYSTEM OF COMMITMENT (BP13)                          *     00070000
      *===========================================================*     00080000
      *                                                           *     00090000
      *  OBJECTIVES:  PROGRAM TO PUT MQ MESSAGE INTO QUEUE        *     00100000
      *               WHICH CONTAINS CUSTOMER'S HANDPHONE,        *     00110000
      *               APPOINTMENT TYPE, DATE AND TIME AND THE     *     00120000
      *               MESSAGE TO BE SENT BY THE JAVA INTERFACE.   *     00130000
      *                                                           *     00140000
      *   PROGRAM LOGIC:                                          *     00150000
      *         PROCESS INPUT FILES                               *     00160000
      *         MQCONNECT TO QUEUE MANAGER                        *     00170000
      *         MQOPEN QUEUE                                      *     00180000
      *         MQPUT                                             *     00190000
      *         MQCLOSE QUEUE                                     *     00200000
      *         MQDISCONNECT FROM QUEUE MANAGER                   *     00210000
      *                                                           *     00220000
      *===========================================================*     00230000
      * MODIFICATIONS :                                           *     00240000
      *                                                           *     00250000
      * CHG REQ #  DATE         AUTHOR    REMARKS                 *     00260000
      * ---------  ------       ------    -------                 *     00270000
      * BP132943   11/07/2006    SD10     INITIAL CREATION.       *     00280000
      * BP133271   19/02/2008    CT2      TO SHOW MONTH AND YEAR  *     00290000
      *                                   OF BALLOT QTR IN BK MSG.*     00300000
      * BP133271   26/03/2008    CT2      TO CHG SER APPT TYPE TO *     00310000
      *                                   BM                      *     00320000
      * BP132988   27/06/2008    CT2      TO SHOW MONTH AS MMM FOR*     00330000
      *                                   APPT TYPE = 'BM'        *     00340000
      * BP133596   04/05/2009    PCL3     TO READ SYSIN CARD      *     00350000
      * BP133753   28/10/2009    CT2      TO cater for NPL(BL msg)*     00360000
      * BP133753   09/11/2009    CT2      TO cater for SBF(BS msg)*     00370000
      * BP134252   27/05/2011    CT2      TO cater for    (CC msg)*     00380000
      * BP134681   24/09/2012    IMC1     TO CATER FOR '91'       *     00390000
      *                                   K060-SERIAL-NO          *     00400000
      * BP135227   01/07/2014    ESA1     TO CATER FOR 'PD' FOR   *     00410000
      *                                   PENDING DOCUMENTS       *     00420000
      * BP135941   01/09/2015    FNP1     TO CATER FOR 'BI' FOR   *     00430000
      *                                   REVISED SMS MSG         *     00440000
      * BP136192   27/04/2016    ESA1     TO CATER FOR 'BN' FOR   *     00450000
      *                                   SMS LETTER              *     00460000
      * BP136431   19/09/2016    KSJ3     TO CATER FOR 'P6', 'PY' *     00470000
      *                                   FOR PCD SMS NOTIFICATION*     00480000
      * BP136580   11/11/2016    KSJ3     TO CATER FOR 'W1'       *     00490000
      *                                   FOR SELF BOOKING NOTIF  *     00500000
      * BP136580   17/01/2017    KSJ3     TO CATER FOR 'W2'       *     00510000
      * BP136757   21/08/2017    KSJ3     TO CATER FOR 'C1'       *     00520000
      * BP137144   05/01/2018    ESA1     TO CATER FOR 'DI' & 'DN'*     00530000
      * BP137208   14/03/2018    FNP1     TO CATER FOR 'BR'       *     00540000
      * BP138029   14/11/2019    EL27     ADDED BI DATE FOR 'BM'  *     00550000
      * BP138198   13/02/2020    PP11     MSG LENGTH FIELD INCREASED    00560000
      *                                   FROM 300 TO 400         *     00570000
      * BP138198   13/02/2020    PP11     MSG LENGTH FIELD INCREASED    00580000
      *                                   FROM 400 TO 480         *     00590000
      * BP138198   17/02/2020    PP11     TO CATER FOR DZ         *     00600000
      * BP138262   30/03/2020    PP11     TO CATER FOR OB APPT TYP*     00610000
      * BP138280   04/04/2020    PP11     TO CATER FOR appt type  *     00620000
      *                                   Z4, Z5, Z6, Z7          *     00630000
      * BP138299   28/04/2020    PP11     TO CATER FOR appt type  *     00640000
      *                                   V1, V2                  *     00650000
      * BP138330   28/05/2020    PP11     TO CATER FOR appt type  *     00660000
      *                                   J1 J2 J3 K1 K2 K3       *     00670000
      * BP138330   28/05/2020    PP11     TO CATER FOR appt type  *     00680000
      *                                   J4 K4 L1 L2 L3 L4       *     00690000
      * BP138744   21/05/2021    PP11     TO CATER FOR appt type  *     00691003
      *                                   BJ DJ                   *     00692002
      * BP138981   06/12/2021    MRR5     TO CATER FOR appt type  *     00693005
      *                                   K5 K6 K7 K8 L5 L6 L7 L8 *     00694003
      *************************************************************     00700000
                                                                        00710000
       ENVIRONMENT DIVISION.                                            00720000
       CONFIGURATION SECTION.                                           00730000
       SOURCE-COMPUTER. IBM-3090.                                       00740000
       OBJECT-COMPUTER. IBM-3090.                                       00750000
       SPECIAL-NAMES.                                                   00760000
           SYSIN IS PARM-INPUT.                                         00770000
                                                                        00780000
       INPUT-OUTPUT SECTION.                                            00790000
       FILE-CONTROL.                                                    00800000
      *                                                                 00810000
           SELECT BP13F203 ASSIGN TO BP13F203                           00820000
                  ORGANIZATION    IS SEQUENTIAL                         00830000
                  FILE STATUS     IS BP13F203-STAT.                     00840000
                                                                        00850000
           SELECT BP13K209 ASSIGN TO BP13K209                           00860000
                  ACCESS MODE     IS DYNAMIC                            00870000
                  ORGANIZATION    IS INDEXED                            00880000
                  RECORD KEY      IS K209-KEY-FLD                       00890000
                  FILE STATUS     IS BP13K209-STAT.                     00900000
                                                                        00910000
           SELECT BP13K060 ASSIGN TO BP13K060                           00920000
                  ACCESS MODE     IS DYNAMIC                            00930000
                  ORGANIZATION    IS INDEXED                            00940000
                  RECORD KEY      IS K060-KEY-FLD                       00950000
                  FILE STATUS     IS BP13K060-STAT.                     00960000
                                                                        00970000
       DATA DIVISION.                                                   00980000
       FILE SECTION.                                                    00990000
                                                                        01000000
       FD  BP13F203                                                     01010000
           RECORD CONTAINS 200 CHARACTERS                               01020000
           RECORDING MODE IS F.                                         01030000
       COPY BP13F203.                                                   01040000
                                                                        01050000
       FD  BP13K209                                                     01060000
           RECORD CONTAINS 500 CHARACTERS.                              01070000
       COPY BP13K209.                                                   01080000
                                                                        01090000
       FD  BP13K060                                                     01100000
           RECORD CONTAINS  25 CHARACTERS.                              01110000
       COPY BP13K060.                                                   01120000
                                                                        01130000
       WORKING-STORAGE SECTION.                                         01140000
                                                                        01150000
      *----------------------------------------------------------*      01160000
      *  IMPORTANT!                                              *      01170000
      *  FOR PRODUCTION, QUEUE MANAGER IS 'MQP1'                 *      01180000
      *  FOR TESTING,    QUEUE MANAGER IS 'MQT1'                 *      01190000
      *----------------------------------------------------------*      01200000
       01  WS-QM-NAME               PIC X(48) VALUE 'MQP1'.             01210004
      *01  WS-QM-NAME               PIC X(48) VALUE 'MQT1'.             01220004
       01  WS-BP13Q-NAME            PIC X(48) VALUE SPACES.             01230000
                                                                        01240000
      *----------------------------------------------------------*      01250000
      *  OUTPUT QUEUE NAME TO CRIMSONLOGIC                       *      01260000
      *  THE QUEUE NAME IS THE SAME FOR PRODUCTION AND TESTING   *      01270000
      *----------------------------------------------------------*      01280000
      *01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13S.SMS.MDB.REQUESTQ'.    01290003
       01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13.SMS.MDB.REQUESTQ'.     01300003
                                                                        01310000
      *----------------------------------------------------------*      01320000
      *  MESSAGE LENGTH                                          *      01330000
      *----------------------------------------------------------*      01340000
       01  WS-MESSAGE-LENGTH        PIC 9(05) VALUE 98004.              01350000
                                                                        01360000
      *----------------------------------------------------------*      01370000
      *  MESSAGE                                                 *      01380000
      *----------------------------------------------------------*      01390000
       01  WS-SEND-MESSAGE.                                             01400000
           05  WS-MSG-CTR           PIC 9(03).                          01410000
           05  WS-FILLER-01         PIC X(01).                          01420000
           05  WS-MSG OCCURS 200 TIMES.                                 01430000
               10  WS-NUM-HP        PIC 9(08).                          01440000
               10  WS-FILLER-02     PIC X(01).                          01450000
               10  WS-TXT-MSG       PIC X(480).                         01460000
               10  WS-FILLER-03     PIC X(01).                          01470000
                                                                        01480000
      *----------------------------------------------------------*      01490000
      *  OTHER VARIABLES                                         *      01500000
      *----------------------------------------------------------*      01510000
       01  WS-VARIABLES.                                                01520000
           05  WS-CTR               PIC 9(03).                          01530000
           05  WS-START             PIC 9(03).                          01540000
           05  WS-TME-APPMT         PIC X(5).                           01550000
           05  WS-DTE-APPMT         PIC X(10).                          01560000
           05  WS-DTE-APPMT-BI      PIC X(11).                          01570000
           05  WS-NEW-TOWN          PIC X(03).                          01580000
           05  WS-FLAT-TYPE         PIC X(02).                          01590000
           05  WS-ETHNIC-CDE        PIC X(03).                          01600000
           05  WS-NEW-TOWN-DESC     PIC X(20).                          01610000
           05  WS-ETHNIC            PIC X(07).                          01620000
           05  WS-DTE-BALLOT        PIC X(06).                          01630000
           05  WS-DTE-BALLOT2       PIC X(08).                          01640000
           05  WS-MTH-BALLOT        PIC X(04).                          01650000
           05  WS-DTE               PIC X(08).                          01660000
           05  WS-ALLO-MODE         PIC X(03).                          01670000
           05  WS-MSG-DETAIL        PIC X(480).                         01680000
                                                                        01690000
       01  WS-MTH-CONV.                                                 01700000
           05  FILLER               PIC X(05)    VALUE 'Jan01'.         01710000
           05  FILLER               PIC X(05)    VALUE 'Feb02'.         01720000
           05  FILLER               PIC X(05)    VALUE 'Mar03'.         01730000
           05  FILLER               PIC X(05)    VALUE 'Apr04'.         01740000
           05  FILLER               PIC X(05)    VALUE 'May05'.         01750000
           05  FILLER               PIC X(05)    VALUE 'Jun06'.         01760000
           05  FILLER               PIC X(05)    VALUE 'Jul07'.         01770000
           05  FILLER               PIC X(05)    VALUE 'Aug08'.         01780000
           05  FILLER               PIC X(05)    VALUE 'Sep09'.         01790000
           05  FILLER               PIC X(05)    VALUE 'Oct10'.         01800000
           05  FILLER               PIC X(05)    VALUE 'Nov11'.         01810000
           05  FILLER               PIC X(05)    VALUE 'Dec12'.         01820000
       01  WS-MTH-CONV-TABLE REDEFINES WS-MTH-CONV.                     01830000
           05  WS-TF-MTH    OCCURS 12 TIMES INDEXED BY WS-IDX.          01840000
               10  WS-TRAN-MM      PIC X(3).                            01850000
               10  WS-NUM-MM       PIC X(2).                            01860000
                                                                        01870000
      *-------------------------------------------------------------    01880000
      *  MQI - TEMPORARY VARIABLES FOR ERROR CODES                      01890000
      *-------------------------------------------------------------    01900000
       01  BP13CS03-REC.                                                01910000
           05 CS03-REASON             PIC 9(4).                         01920000
           05 CS03-COMPLETION-CODE    PIC 9(4).                         01930000
           05 CS03-ERR-MSG            PIC X(66).                        01940000
           05 FILLER                  PIC X(27).                        01950000
                                                                        01960000
      *----------------------------------------------------------*      01970000
      *              MQI STRUCTURE DECLARATION                   *      01980000
      *----------------------------------------------------------*      01990000
       01 MY-MQ-CONSTANTS.                                              02000000
          COPY CMQV.                                                    02010000
                                                                        02020000
       01 OBJECT-DESCRIPTOR.                                            02030000
          COPY CMQODV.                                                  02040000
                                                                        02050000
       01 MESSAGE-DESCRIPTOR.                                           02060000
          COPY CMQMDV.                                                  02070000
                                                                        02080000
      * PUT MESSAGE OPTIONS                                             02090000
       01 PMOPTIONS.                                                    02100000
          COPY CMQPMOV.                                                 02110000
                                                                        02120000
      *----------------------------------------------------------*      02130000
      * VARIABLE DESCRIPTION:                                    *      02140000
      * (1) HCONN                                                *      02150000
      *       - CONNECTION HANDLE - REPRESENTS THE CONNECTION TO *      02160000
      *         THE QUEUE MANAGER. VALUE IS RETURNED BY MQCONN   *      02170000
      *         AND SUBSEQUENTLY REFERENCED IN MQOPEN, MQPUT,    *      02180000
      *         MQCLOSE AND MQDISC                               *      02190000
      *                                                          *      02200000
      * (2) Q-HANDLE                                             *      02210000
      *       - ACCESS THAT HAS BEEN ESTABLISHED  TO THE OBJECT  *      02220000
      *         CONNECTION HANDLE - VALUE IS RETURNED BY MQOPEN  *      02230000
      *         AND SUBSEQUENTLY REFERENCED IN MQPUT AND MQCLOSE *      02240000
      *                                                          *      02250000
      * (3) OBJECT-DESCRIPTOR                                    *      02260000
      *       - THIS IDENTIFIES THE OBJECT TO BE OPENED          *      02270000
      *                                                          *      02280000
      * (4) OPTIONS                                              *      02290000
      *       WHEN USED IN MQOPEN                                *      02300000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQOPEN        *      02310000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      02320000
      *         MQOO-OUTPUT - THE QUEUE IS OPENED FOR USE WITH   *      02330000
      *                       SUBSEQUENT MQPUT CALL              *      02340000
      *         MQOO-FAIL-IF-QUIESCING - FORCES MQCALL TO FAIL   *      02350000
      *                       IF QUEUE MANAGER IS IN QUIESCING   *      02360000
      *                       STATE (I.E. PREPARING TO SHUTDOWN) *      02370000
      *                                                          *      02380000
      *       WHEN USED IN MQCLOSE                               *      02390000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQCLOSE       *      02400000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      02410000
      *         MQCO-NONE   - NO OPTIONAL CLOSE PROCESSING       *      02420000
      *                       REQUIRED                           *      02430000
      *                                                          *      02440000
      * (5) MESSAGE-DESCRIPTOR                                   *      02450000
      *       - THIS DESCRIBES THE ATTRIBUTES OF THE MESSAGE     *      02460000
      *         BEING SENT, AND RECEIVES INFO ABOUT THE MESSAGE  *      02470000
      *         AFTER THE PUT REQUEST IS COMPLETE                *      02480000
      *                                                          *      02490000
      * (6) PMOPTIONS (PUT MESSAGE OPTIONS)                      *      02500000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQPUT         *      02510000
      *       - OPTION USED IN THIS PROGRAM:                     *      02520000
      *         MQMD-EXPIRY - MESSAGE LIFETIME. THE MESSAGE      *      02530000
      *                       BECOMES ELIGIBLE TO BE DISCARDED   *      02540000
      *                       IF IT HAS NOT BEEN REMOVED FROM    *      02550000
      *                       FROM THE QUEUE BEFORE THIS PERIOD  *      02560000
      *                       OF TIME ELAPSED                    *      02570000
      *                     - MUST BE SET TO MQEI_UNLIMITED      *      02580000
      *         MQMD-PERSISTENCE = MQPER-PERSISTENT              *      02590000
      *                                                          *      02600000
      * (7) BUFFER-LENGTH                                        *      02610000
      *       - LENGTH OF THE MESSAGE IN BUFFER                  *      02620000
      *                                                          *      02630000
      * (7) BUFFER                                               *      02640000
      *       - MESSAGE DATA                                     *      02650000
      *----------------------------------------------------------*      02660000
       01 HCONN                      PIC S9(9) BINARY.                  02670000
       01 Q-HANDLE                   PIC S9(9) BINARY.                  02680000
       01 OPTIONS                    PIC S9(9) BINARY.                  02690000
       01 COMPLETION-CODE            PIC S9(9) BINARY.                  02700000
       01 OPEN-CODE                  PIC S9(9) BINARY.                  02710000
       01 CON-REASON                 PIC S9(9) BINARY.                  02720000
       01 REASON                     PIC S9(9) BINARY.                  02730000
       01 MQMSGD                     PIC S9(9) BINARY.                  02740000
       01 BUFFER-LENGTH              PIC S9(9) BINARY.                  02750000
       01 BUFFER                     PIC X(98004).                      02760000
       01 QM-NAME                    PIC X(48) VALUE SPACES.            02770000
       01 TARGET-QUEUE               PIC X(48) VALUE SPACES.            02780000
                                                                        02790000
      *-------------------------------------------------------------    02800000
      *  FILE STATUS                                                    02810000
      *-------------------------------------------------------------    02820000
       01  WS-FILE-STAT.                                                02830000
           05 BP13F203-STAT              PIC X(02)  VALUE SPACES.       02840000
           05 BP13K209-STAT              PIC X(02)  VALUE SPACES.       02850000
           05 BP13K060-STAT              PIC X(02)  VALUE SPACES.       02860000
                                                                        02870000
      *-------------------------------------------------------------    02880000
      *  FLAGS / SWITCHES                                               02890000
      *-------------------------------------------------------------    02900000
       01  WS-FLAGS.                                                    02910000
           05 F203-EOF               PIC X(01) VALUE 'N'.               02920000
           05 K209-EOF               PIC X(01) VALUE 'N'.               02930000
           05 K060-EOF               PIC X(01) VALUE 'N'.               02940000
           05 F203-EMPTY             PIC X(01) VALUE 'N'.               02950000
           05 K209-EMPTY             PIC X(01) VALUE 'N'.               02960000
                                                                        02970000
      ****************************************************************  02980000
       PROCEDURE DIVISION.                                              02990000
      ****************************************************************  03000000
                                                                        03010000
      ********************                                              03020000
       0000-MAIN-PROCESS.                                               03030000
      ********************                                              03040000
           PERFORM 0100-OPEN-FILES         THRU 0100-EXIT.              03050000
           PERFORM 0200-INITIALIZATION     THRU 0200-EXIT.              03060000
                                                                        03070000
           ACCEPT WS-BP13Q-NAME            FROM PARM-INPUT.             03080000
                                                                        03090000
           PERFORM 1000-CHECK-MESSAGE      THRU 1000-EXIT.              03100000
           PERFORM 3000-PROCESS-BP13F203   THRU 3000-EXIT               03110000
                   UNTIL F203-EOF = 'Y'.                                03120000
           DISPLAY 'WS-SEND-MESSAGE : ' WS-SEND-MESSAGE.                03130000
           PERFORM 5300-MQ-PUT-MESSAGE     THRU 5300-EXIT.              03140000
           DISPLAY ' *** APPOINTMENT NOTIFICATION SENT!'                03150000
           PERFORM 5400-MQ-CLOSE           THRU 5400-EXIT.              03160000
           PERFORM 5500-MQ-DISCONNECT      THRU 5500-EXIT.              03170000
           PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT.              03180000
                                                                        03190000
           STOP RUN.                                                    03200000
                                                                        03210000
       0000-EXIT.                                                       03220000
           EXIT.                                                        03230000
                                                                        03240000
      ********************                                              03250000
       0100-OPEN-FILES.                                                 03260000
      ********************                                              03270000
           DISPLAY ' ***** STARTING PROGRAM BP13CS03 . . . '.           03280000
           DISPLAY ' '.                                                 03290000
           OPEN    INPUT   BP13F203                                     03300000
                           BP13K060                                     03310000
                           BP13K209.                                    03320000
                                                                        03330000
           IF  BP13F203-STAT     NOT  =  00                             03340000
               DISPLAY ' OPEN ERROR BP13F203'                           03350000
               DISPLAY 'BP13F203-STAT = ' BP13F203-STAT                 03360000
               MOVE     12                   TO RETURN-CODE             03370000
               PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT.            03380000
                                                                        03390000
           IF  BP13K209-STAT     NOT  =  00                             03400000
               DISPLAY ' OPEN ERROR BP13K209'                           03410000
               DISPLAY 'BP13K209-STAT = ' BP13K209-STAT                 03420000
               MOVE     12                   TO RETURN-CODE             03430000
               PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT.            03440000
                                                                        03450000
           IF  BP13K060-STAT     NOT  =  00                             03460000
               DISPLAY ' OPEN ERROR BP13K060'                           03470000
               DISPLAY 'BP13K060-STAT = ' BP13K060-STAT                 03480000
               MOVE     12                   TO RETURN-CODE             03490000
               PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT.            03500000
                                                                        03510000
       0100-EXIT.                                                       03520000
           EXIT.                                                        03530000
                                                                        03540000
      **********************                                            03550000
       0200-INITIALIZATION.                                             03560000
      **********************                                            03570000
                                                                        03580000
           MOVE SPACES     TO WS-SEND-MESSAGE.                          03590000
           INITIALIZE         WS-SEND-MESSAGE.                          03600000
           MOVE ';'        TO WS-FILLER-01.                             03610000
           PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 200        03620000
              MOVE ';'     TO WS-FILLER-02(WS-CTR)                      03630000
                              WS-FILLER-03(WS-CTR)                      03640000
           END-PERFORM.                                                 03650000
                                                                        03660000
      *-----------------------------                                    03670000
      *  INITIAL READ OF INPUT FILES                                    03680000
      *-----------------------------                                    03690000
           READ BP13F203                                                03700000
               AT END                                                   03710000
                   MOVE 'Y' TO F203-EOF                                 03720000
                   MOVE 'Y' TO F203-EMPTY                               03730000
                   DISPLAY ' *** '                                      03740000
                   DISPLAY ' *** NO RECORDS FOUND IN SMS FILE'          03750000
                   DISPLAY ' *** '.                                     03760000
                                                                        03770000
           READ BP13K209 NEXT RECORD                                    03780000
               AT END                                                   03790000
                   MOVE 'Y' TO K209-EOF                                 03800000
                   MOVE 'Y' TO K209-EMPTY                               03810000
                   DISPLAY ' *** '                                      03820000
                   DISPLAY ' *** NO RECORDS FOUND IN SMS MESSAGES FILE' 03830000
                   DISPLAY ' *** '.                                     03840000
                                                                        03850000
       0200-EXIT.                                                       03860000
           EXIT.                                                        03870000
                                                                        03880000
      ************************                                          03890000
       1000-CHECK-MESSAGE.                                              03900000
      ************************                                          03910000
           IF F203-EMPTY = 'Y' AND K209-EMPTY = 'Y'                     03920000
               PERFORM 9000-CLOSE-FILES  THRU  9000-EXIT                03930000
           ELSE                                                         03940000
               PERFORM 5100-MQ-CONNECT   THRU  5100-EXIT                03950000
               PERFORM 5200-MQ-OPEN      THRU  5200-EXIT                03960000
           END-IF.                                                      03970000
                                                                        03980000
           MOVE SPACES                     TO BUFFER.                   03990000
                                                                        04000000
       1000-EXIT.                                                       04010000
           EXIT.                                                        04020000
                                                                        04030000
      ************************                                          04040000
       3000-PROCESS-BP13F203.                                           04050000
      ************************                                          04060000
           IF F203-NUM-HP NOT = SPACES AND LOW-VALUES AND ZEROES        04070000
              IF F203-NUM-FLAT-TYPE = 'SE'                              04080000
                 MOVE 'BM'                  TO K209-TYPE-APPMT          04090000
              ELSE                                                      04100000
                 MOVE F203-TYPE-APPMT         TO K209-TYPE-APPMT        04110000
                                                                        04120000
              END-IF                                                    04130000
              IF F203-NUM-ALLO-MODE = 'SER' AND                         04140000
                 F203-TYPE-APPMT = 'BN'                                 04150000
                 MOVE 'BR'                  TO  K209-TYPE-APPMT         04160000
               END-IF                                                   04170000
               PERFORM 3100-READ-BP13K209   THRU 3100-EXIT              04180000
           END-IF.                                                      04190000
                                                                        04200000
           READ BP13F203                                                04210000
               AT END                                                   04220000
                   MOVE 'Y' TO F203-EOF.                                04230000
                                                                        04240000
       3000-EXIT.                                                       04250000
           EXIT.                                                        04260000
                                                                        04270000
      ****************************************************************  04280000
       3100-READ-BP13K209.                                              04290000
      ****************************************************************  04300000
                                                                        04310000
           READ BP13K209.                                               04320000
           IF BP13K209-STAT = 00                                        04330000
              PERFORM 3200-PASS-MSG  THRU 3200-EXIT                     04340000
           ELSE                                                         04350000
              IF BP13K209-STAT = 23                                     04360000
                 DISPLAY 'APPOINTMENT TYPE NOT FOUND : ' K209-KEY-FLD   04370000
                 MOVE BP13K209-STAT  TO RETURN-CODE                     04380000
              END-IF                                                    04390000
           END-IF.                                                      04400000
                                                                        04410000
       3100-EXIT.                                                       04420000
           EXIT.                                                        04430000
                                                                        04440000
      ****************************************************************  04450000
       3200-PASS-MSG.                                                   04460000
      ****************************************************************  04470000
                                                                        04480000
           MOVE SPACES               TO WS-DTE-APPMT                    04490000
                                        WS-TME-APPMT                    04500000
                                        WS-NEW-TOWN                     04510000
                                        WS-FLAT-TYPE                    04520000
                                        WS-ETHNIC-CDE                   04530000
                                        WS-ETHNIC                       04540000
                                        WS-DTE-BALLOT                   04550000
                                        WS-DTE-BALLOT2.                 04560000
                                                                        04570000
           ADD 1                     TO WS-MSG-CTR.                     04580000
                                                                        04590000
           IF F203-DTE-BALLOT NOT = SPACES AND LOW-VALUES AND ZEROES    04600000
              MOVE F203-DTE-BALLOT            TO WS-DTE                 04610000
              PERFORM 3900-FORMAT-DTE         THRU 3900-EXIT            04620000
              STRING WS-MTH-BALLOT                                      04630000
                     F203-DTE-BALLOT(3:2)                               04640000
                     DELIMITED BY SIZE                                  04650000
                INTO WS-DTE-BALLOT                                      04660000
              STRING WS-MTH-BALLOT                                      04670000
                     F203-DTE-BALLOT(1:4)                               04680000
                     DELIMITED BY SIZE                                  04690000
                INTO WS-DTE-BALLOT2                                     04700000
           END-IF.                                                      04710000
                                                                        04720000
           IF F203-TYPE-APPMT = 'BK' OR 'BM' OR 'BL' OR 'BS'            04730000
               IF F203-DTE-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES 04740000
                  MOVE F203-DTE-APPMT             TO WS-DTE             04750000
                  PERFORM 3900-FORMAT-DTE         THRU 3900-EXIT        04760000
                  STRING F203-DTE-APPMT(7:2) ' '                        04770000
                         WS-MTH-BALLOT                                  04780000
                         F203-DTE-APPMT(3:2)                            04790000
                         DELIMITED BY SIZE                              04800000
                    INTO WS-DTE-APPMT                                   04810000
                  IF F203-TYPE-APPMT = 'BK' OR 'BM'                     04820000
                     STRING F203-DTE-APPMT(7:2) ' '                     04830000
                          WS-MTH-BALLOT                                 04840000
                          F203-DTE-APPMT(1:4)                           04850000
                          DELIMITED BY SIZE                             04860000
                     INTO WS-DTE-APPMT-BI                               04870000
                  END-IF                                                04880000
               END-IF                                                   04890000
           ELSE                                                         04900000
              IF F203-TYPE-APPMT = 'BI' OR 'DI' OR 'BN' OR 'DN' OR 'DZ' 04910000
                                        OR 'OB' OR 'Z4' OR 'Z5' OR 'Z6' 04920000
                                        OR 'Z7' OR 'V1' OR 'V2' OR 'J1' 04930000
                                        OR 'J2' OR 'J3' OR 'K1' OR 'K2' 04940000
                                        OR 'K3' OR 'J4' OR 'K4' OR 'L1' 04950000
                                        OR 'L2' OR 'L3' OR 'L4' OR 'BJ' 04960000
                                        OR 'DJ' OR 'K5' OR 'K6' OR 'K7' 04961003
                                        OR 'K8' OR 'L5' OR 'L6' OR 'L7' 04962003
                                        OR 'L8'                         04963003
                IF F203-DTE-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES04970000
                   MOVE F203-DTE-APPMT             TO WS-DTE            04980000
                   PERFORM 3900-FORMAT-DTE         THRU 3900-EXIT       04990000
                   STRING F203-DTE-APPMT(7:2) ' '                       05000000
                        WS-MTH-BALLOT                                   05010000
                        F203-DTE-APPMT(1:4)                             05020000
                        DELIMITED BY SIZE                               05030000
                   INTO WS-DTE-APPMT-BI                                 05040000
                END-IF                                                  05050000
              ELSE                                                      05060000
               IF F203-DTE-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES 05070000
                  STRING F203-DTE-APPMT(7:2) '/'                        05080000
                         F203-DTE-APPMT(5:2) '/'                        05090000
                         F203-DTE-APPMT(1:4)                            05100000
                         DELIMITED BY SIZE                              05110000
                    INTO WS-DTE-APPMT                                   05120000
               END-IF                                                   05130000
           END-IF.                                                      05140000
                                                                        05150000
           IF F203-TME-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES     05160000
              STRING F203-TME-APPMT(1:2) ':'                            05170000
                     F203-TME-APPMT(3:2)                                05180000
                     DELIMITED BY SIZE                                  05190000
                INTO WS-TME-APPMT                                       05200000
           END-IF.                                                      05210000
                                                                        05220000
           IF F203-NUM-ALLO-MODE NOT = SPACES AND LOW-VALUES AND ZEROES 05230000
              MOVE F203-NUM-ALLO-MODE  TO WS-ALLO-MODE                  05240000
           END-IF.                                                      05250000
                                                                        05260000
           IF F203-NUM-FLAT-TYPE NOT = SPACES AND LOW-VALUES AND ZEROES 05270000
              MOVE F203-NUM-FLAT-TYPE  TO WS-FLAT-TYPE                  05280000
           END-IF.                                                      05290000
                                                                        05300000
           IF F203-NUM-NEW-TOWN NOT = SPACES AND LOW-VALUES AND ZEROES  05310000
              MOVE F203-NUM-NEW-TOWN   TO WS-NEW-TOWN                   05320000
           END-IF.                                                      05330000
                                                                        05340000
           IF F203-NUM-ETHNIC NOT = SPACES AND LOW-VALUES AND ZEROES    05350000
              MOVE F203-NUM-ETHNIC     TO WS-ETHNIC-CDE                 05360000
           END-IF.                                                      05370000
                                                                        05380000
           MOVE K209-NUM-MSG   TO WS-MSG-DETAIL.                        05390000
                                                                        05400000
           IF F203-TYPE-APPMT = 'BK' OR 'BM'                            05410000
              PERFORM 4000-CHG-BALLOT-DTE THRU 4000-EXIT                05420000
              PERFORM 4100-CHG-SEL-TYPE THRU 4100-EXIT                  05430000
              PERFORM 3310-CHG-APPT-DTE-BK THRU 3310-EXIT               05440000
              PERFORM 3320-CHG-APPT-DTE-BI THRU 3320-EXIT               05450000
              PERFORM 3400-CHG-APPT-TME   THRU 3400-EXIT                05460000
           END-IF.                                                      05470000
                                                                        05480000
           IF F203-TYPE-APPMT = 'BL' OR 'BS'                            05490000
              PERFORM 3310-CHG-APPT-DTE-BK THRU 3310-EXIT               05500000
              PERFORM 3400-CHG-APPT-TME   THRU 3400-EXIT                05510000
           END-IF.                                                      05520000
                                                                        05530000
           IF F203-TYPE-APPMT = 'BI' OR 'DI' OR 'BN' OR 'DN' OR 'BR' OR 05540000
                                'DZ' OR 'OB' OR 'Z4' OR 'Z5' OR 'Z6' OR 05550000
                                'Z7' OR 'V1' OR 'V2' OR 'J1' OR 'J2' OR 05560000
                                'J3' OR 'K1' OR 'K2' OR 'K3' OR 'J4' OR 05570000
                                'K4' OR 'L1' OR 'L2' OR 'L3' OR 'L4' OR 05580000
                                'BJ' OR 'DJ' OR 'K5' OR 'K6' OR 'K7' OR 05581003
                                'K8' OR 'L5' OR 'L6' OR 'L7' OR 'L8'    05582003
              PERFORM 4050-CHG-BALLOT-DTE THRU 4050-EXIT                05590000
              PERFORM 4100-CHG-SEL-TYPE THRU 4100-EXIT                  05600000
              PERFORM 3320-CHG-APPT-DTE-BI THRU 3320-EXIT               05610000
              PERFORM 3325-CHG-QUEUE-NO    THRU 3325-EXIT               05620000
              PERFORM 3400-CHG-APPT-TME   THRU 3400-EXIT                05630000
           END-IF.                                                      05640000
                                                                        05650000
           IF F203-TYPE-APPMT = 'SA' OR 'TP' OR 'SP' OR 'SR' OR         05660000
                                'SE' OR 'CC' OR 'W2'                    05670000
              PERFORM 3300-CHG-APPT-DTE   THRU 3300-EXIT                05680000
              PERFORM 3400-CHG-APPT-TME   THRU 3400-EXIT                05690000
           END-IF.                                                      05700000
                                                                        05710000
           IF F203-TYPE-APPMT = 'AS' OR 'NE'                            05720000
              PERFORM 3500-CHG-NEW-TOWN   THRU 3500-EXIT                05730000
              PERFORM 3600-CHG-FLAT-TYP   THRU 3600-EXIT                05740000
              IF F203-TYPE-APPMT = 'NE'                                 05750000
                 PERFORM 3700-CHG-ETHNIC  THRU 3700-EXIT                05760000
              END-IF                                                    05770000
           END-IF.                                                      05780000
                                                                        05790000
           IF F203-TYPE-APPMT = 'PD'                                    05800000
              PERFORM 3300-CHG-APPT-DTE THRU 3300-EXIT                  05810000
           END-IF.                                                      05820000
                                                                        05830000
           IF F203-TYPE-APPMT = 'P6' OR 'PY'                            05840000
              PERFORM 4200-CHG-REGN     THRU 4200-EXIT                  05850000
           END-IF.                                                      05860000
                                                                        05870000
           IF F203-TYPE-APPMT = 'W1' or 'C1'                            05880000
              PERFORM 4300-CHG-BOOK-PD  THRU 4300-EXIT                  05890000
           END-IF.                                                      05900000
                                                                        05910000
           MOVE F203-NUM-HP(1:8)       TO WS-NUM-HP(WS-MSG-CTR).        05920000
           MOVE WS-MSG-DETAIL          TO WS-TXT-MSG(WS-MSG-CTR).       05930000
                                                                        05940000
       3200-EXIT.                                                       05950000
           EXIT.                                                        05960000
                                                                        05970000
      ****************************************************************  05980000
       3300-CHG-APPT-DTE.                                               05990000
      ****************************************************************  06000000
                                                                        06010000
           MOVE ZEROES         TO WS-START.                             06020000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06030000
              IF WS-MSG-DETAIL(WS-START:10) = 'DD/MM/CCYY'              06040000
                 MOVE WS-DTE-APPMT TO WS-MSG-DETAIL(WS-START:10)        06050000
                 MOVE 481          TO WS-START                          06060000
              END-IF                                                    06070000
           END-PERFORM.                                                 06080000
                                                                        06090000
       3300-EXIT.                                                       06100000
           EXIT.                                                        06110000
                                                                        06120000
      ****************************************************************  06130000
       3310-CHG-APPT-DTE-BK.                                            06140000
      ****************************************************************  06150000
                                                                        06160000
           MOVE ZEROES         TO WS-START.                             06170000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06180000
              IF WS-MSG-DETAIL(WS-START:9) = 'DD/MMM/YY'                06190000
                 MOVE WS-DTE-APPMT TO WS-MSG-DETAIL(WS-START:9)         06200000
                 MOVE 481          TO WS-START                          06210000
              END-IF                                                    06220000
           END-PERFORM.                                                 06230000
                                                                        06240000
       3310-EXIT.                                                       06250000
           EXIT.                                                        06260000
                                                                        06270000
                                                                        06280000
      ****************************************************************  06290000
       3320-CHG-APPT-DTE-BI.                                            06300000
      ****************************************************************  06310000
                                                                        06320000
           MOVE ZEROES         TO WS-START.                             06330000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06340000
              IF WS-MSG-DETAIL(WS-START:11) = 'DD/MMM/CCYY'             06350000
                 MOVE WS-DTE-APPMT-BI TO WS-MSG-DETAIL(WS-START:11)     06360000
                 MOVE 481          TO WS-START                          06370000
              END-IF                                                    06380000
           END-PERFORM.                                                 06390000
                                                                        06400000
       3320-EXIT.                                                       06410000
           EXIT.                                                        06420000
                                                                        06430000
      ****************************************************************  06440000
       3325-CHG-QUEUE-NO.                                               06450000
      ****************************************************************  06460000
                                                                        06470000
           MOVE ZEROES         TO WS-START.                             06480000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06490000
              IF WS-MSG-DETAIL(WS-START:04) = 'XXXX'                    06500000
                 MOVE F203-NUM-QUEUE  TO WS-MSG-DETAIL(WS-START:04)     06510000
                 MOVE 481          TO WS-START                          06520000
              END-IF                                                    06530000
           END-PERFORM.                                                 06540000
                                                                        06550000
       3325-EXIT.                                                       06560000
           EXIT.                                                        06570000
                                                                        06580000
      ****************************************************************  06590000
       3400-CHG-APPT-TME.                                               06600000
      ****************************************************************  06610000
                                                                        06620000
           MOVE ZEROES         TO WS-START.                             06630000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06640000
              IF WS-MSG-DETAIL(WS-START:5) = 'HH:MM'                    06650000
                 MOVE WS-TME-APPMT TO WS-MSG-DETAIL(WS-START:5)         06660000
                 MOVE 481          TO WS-START                          06670000
              END-IF                                                    06680000
           END-PERFORM.                                                 06690000
                                                                        06700000
       3400-EXIT.                                                       06710000
           EXIT.                                                        06720000
                                                                        06730000
      ****************************************************************  06740000
       3500-CHG-NEW-TOWN.                                               06750000
      ****************************************************************  06760000
                                                                        06770000
           MOVE SPACES                TO K060-KEY-FLD.                  06780000
                                                                        06790000
           IF F203-NUM-ALLO-MODE = 'BTO'                                06800000
              MOVE 91                    TO K060-SERIAL-NO              06810000
           ELSE                                                         06820000
              MOVE 02                    TO K060-SERIAL-NO              06830000
           END-IF                                                       06840000
                                                                        06850000
           MOVE WS-NEW-TOWN           TO K060-CODE.                     06860000
           PERFORM 3800-READ-BP13K060 THRU 3800-EXIT.                   06870000
           MOVE K060-DESC             TO WS-NEW-TOWN-DESC.              06880000
           MOVE ZEROES         TO WS-START.                             06890000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    06900000
              IF WS-MSG-DETAIL(WS-START:20) = 'N/T                 '    06910000
                 MOVE WS-NEW-TOWN-DESC  TO WS-MSG-DETAIL(WS-START:20)   06920000
                 MOVE 481          TO WS-START                          06930000
              END-IF                                                    06940000
           END-PERFORM.                                                 06950000
                                                                        06960000
       3500-EXIT.                                                       06970000
           EXIT.                                                        06980000
                                                                        06990000
      ****************************************************************  07000000
       3600-CHG-FLAT-TYP.                                               07010000
      ****************************************************************  07020000
                                                                        07030000
           MOVE ZEROES         TO WS-START.                             07040000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    07050000
              IF WS-MSG-DETAIL(WS-START:3) = 'F/T'                      07060000
                 STRING ' '                                             07070000
                        WS-FLAT-TYPE(1:1)                               07080000
                        ' '                                             07090000
                        DELIMITED BY SIZE                               07100000
                   INTO WS-MSG-DETAIL(WS-START:3)                       07110000
                 MOVE 481          TO WS-START                          07120000
              END-IF                                                    07130000
           END-PERFORM.                                                 07140000
                                                                        07150000
       3600-EXIT.                                                       07160000
           EXIT.                                                        07170000
                                                                        07180000
      ****************************************************************  07190000
       3700-CHG-ETHNIC.                                                 07200000
      ****************************************************************  07210000
                                                                        07220000
           MOVE SPACES                TO K060-KEY-FLD.                  07230000
           MOVE 09                    TO K060-SERIAL-NO.                07240000
           MOVE WS-ETHNIC-CDE         TO K060-CODE.                     07250000
           PERFORM 3800-READ-BP13K060 THRU 3800-EXIT.                   07260000
           MOVE K060-DESC             TO WS-ETHNIC.                     07270000
           MOVE ZEROES         TO WS-START.                             07280000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    07290000
              IF WS-MSG-DETAIL(WS-START:3) = 'E/T    '                  07300000
                 MOVE WS-ETHNIC    TO WS-MSG-DETAIL(WS-START:7)         07310000
                 MOVE 481          TO WS-START                          07320000
              END-IF                                                    07330000
           END-PERFORM.                                                 07340000
                                                                        07350000
       3700-EXIT.                                                       07360000
           EXIT.                                                        07370000
                                                                        07380000
      ****************************************************************  07390000
       3800-READ-BP13K060.                                              07400000
      ****************************************************************  07410000
                                                                        07420000
           READ BP13K060 KEY IS K060-KEY-FLD.                           07430000
           IF BP13K060-STAT = 00                                        07440000
              CONTINUE                                                  07450000
           ELSE                                                         07460000
              IF BP13K060-STAT = 23                                     07470000
                 DISPLAY 'APPOINTMENT TYPE NOT FOUND : ' K060-KEY-FLD   07480000
                 MOVE BP13K060-STAT  TO RETURN-CODE                     07490000
              END-IF                                                    07500000
           END-IF.                                                      07510000
                                                                        07520000
       3800-EXIT.                                                       07530000
           EXIT.                                                        07540000
                                                                        07550000
      ****************************************************************  07560000
       3900-FORMAT-DTE.                                                 07570000
      ****************************************************************  07580000
           SET WS-IDX TO 1.                                             07590000
           SEARCH WS-TF-MTH                                             07600000
               AT END                                                   07610000
                  MOVE SPACES              TO WS-MTH-BALLOT             07620000
               WHEN WS-NUM-MM (WS-IDX) = WS-DTE(5:2)                    07630000
                  MOVE WS-TRAN-MM (WS-IDX) TO WS-MTH-BALLOT             07640000
           END-SEARCH.                                                  07650000
       3900-EXIT.                                                       07660000
           EXIT.                                                        07670000
                                                                        07680000
      ****************************************************************  07690000
       4000-CHG-BALLOT-DTE.                                             07700000
      ****************************************************************  07710000
           MOVE ZEROES              TO WS-START.                        07720000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    07730000
              IF WS-MSG-DETAIL(WS-START:6) = 'BLTDTE'                   07740000
                 MOVE WS-DTE-BALLOT TO WS-MSG-DETAIL(WS-START:6)        07750000
                 MOVE 481           TO WS-START                         07760000
              END-IF                                                    07770000
           END-PERFORM.                                                 07780000
                                                                        07790000
       4000-EXIT.                                                       07800000
           EXIT.                                                        07810000
                                                                        07820000
      ****************************************************************  07830000
       4050-CHG-BALLOT-DTE.                                             07840000
      ****************************************************************  07850000
           MOVE ZEROES              TO WS-START.                        07860000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    07870000
              IF WS-MSG-DETAIL(WS-START:8) = 'BLTDCCYY'                 07880000
                 MOVE WS-DTE-BALLOT2 TO WS-MSG-DETAIL(WS-START:8)       07890000
                 MOVE 481            TO WS-START                        07900000
              END-IF                                                    07910000
           END-PERFORM.                                                 07920000
                                                                        07930000
       4050-EXIT.                                                       07940000
           EXIT.                                                        07950000
                                                                        07960000
      ****************************************************************  07970000
       4100-CHG-SEL-TYPE.                                               07980000
      ****************************************************************  07990000
           MOVE ZEROES              TO WS-START.                        08000000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    08010000
              IF WS-MSG-DETAIL(WS-START:3) = 'SEL'                      08020000
                 MOVE WS-ALLO-MODE TO WS-MSG-DETAIL(WS-START:3)         08030000
                 MOVE 481           TO WS-START                         08040000
              END-IF                                                    08050000
           END-PERFORM.                                                 08060000
                                                                        08070000
       4100-EXIT.                                                       08080000
           EXIT.                                                        08090000
                                                                        08100000
      ****************************************************************  08110000
       4200-CHG-REGN.                                                   08120000
      ****************************************************************  08130000
                                                                        08140000
           MOVE ZEROES              TO WS-START.                        08150000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    08160000
              IF WS-MSG-DETAIL(WS-START:8) = 'XXXXREGN'                 08170000
                 ADD 4              TO WS-START                         08180000
                 MOVE F203-NUM-REGN(5:4)                                08190000
                                    TO WS-MSG-DETAIL(WS-START:4)        08200000
                 MOVE 481           TO WS-START                         08210000
              END-IF                                                    08220000
           END-PERFORM.                                                 08230000
                                                                        08240000
       4200-EXIT.                                                       08250000
           EXIT.                                                        08260000
                                                                        08270000
      ****************************************************************  08280000
       4300-CHG-BOOK-PD.                                                08290000
      ****************************************************************  08300000
                                                                        08310000
           MOVE F203-DTE-BOOK-PD-END       TO   WS-DTE.                 08320000
           PERFORM 3900-FORMAT-DTE         THRU 3900-EXIT.              08330000
                                                                        08340000
           MOVE ZEROES              TO WS-START.                        08350000
           PERFORM VARYING WS-START FROM 1 BY 1 UNTIL WS-START > 480    08360000
              IF WS-MSG-DETAIL(WS-START:11) = 'DD MMM YYYY'             08370000
                 STRING F203-DTE-BOOK-PD-END(7:2) ' '                   08380000
                        WS-MTH-BALLOT                                   08390000
                        F203-DTE-BOOK-PD-END(1:4)                       08400000
                        DELIMITED BY SIZE INTO                          08410000
                                       WS-MSG-DETAIL(WS-START:11)       08420000
                 MOVE 481           TO WS-START                         08430000
              END-IF                                                    08440000
           END-PERFORM.                                                 08450000
                                                                        08460000
       4300-EXIT.                                                       08470000
           EXIT.                                                        08480000
                                                                        08490000
      ****************************************************************  08500000
       5100-MQ-CONNECT.                                                 08510000
      ****************************************************************  08520000
      *---------------------------------------------------------------  08530000
      *  SET THE QUEUE MANAGER NAME                                     08540000
      *---------------------------------------------------------------  08550000
           IF WS-BP13Q-NAME NOT = SPACES AND LOW-VALUES                 08560000
              MOVE WS-BP13Q-NAME           TO   QM-NAME                 08570000
           ELSE                                                         08580000
              MOVE WS-QM-NAME              TO   QM-NAME                 08590000
           END-IF.                                                      08600000
                                                                        08610000
      *---------------------------------------------------------------  08620000
      *   MQCONN                                                        08630000
      *---------------------------------------------------------------  08640000
           CALL 'MQCONN'                                                08650000
                USING QM-NAME, HCONN,                                   08660000
                COMPLETION-CODE, CON-REASON.                            08670000
                                                                        08680000
           IF COMPLETION-CODE  = MQCC-FAILED                            08690000
              MOVE CON-REASON              TO   CS03-REASON             08700000
              MOVE COMPLETION-CODE         TO   CS03-COMPLETION-CODE    08710000
              MOVE 'BP13CS03 MQCONN ERROR' TO   CS03-ERR-MSG            08720000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               08730000
           END-IF.                                                      08740000
                                                                        08750000
       5100-EXIT.                                                       08760000
           EXIT.                                                        08770000
                                                                        08780000
                                                                        08790000
      ****************************************************************  08800000
       5200-MQ-OPEN.                                                    08810000
      ****************************************************************  08820000
      *---------------------------------------------------------------  08830000
      *  USE DEFAULT WS-QUEUE-NAME                                      08840000
      *---------------------------------------------------------------  08850000
           MOVE  WS-QUEUE-NAME         TO MQOD-OBJECTNAME.              08860000
           ADD   MQOO-OUTPUT MQOO-FAIL-IF-QUIESCING                     08870000
                               GIVING OPTIONS.                          08880000
                                                                        08890000
      *---------------------------------------------------------------  08900000
      *   MQOPEN                                                        08910000
      *---------------------------------------------------------------  08920000
           CALL 'MQOPEN'                                                08930000
                USING HCONN, OBJECT-DESCRIPTOR,                         08940000
                OPTIONS, Q-HANDLE,                                      08950000
                OPEN-CODE, REASON.                                      08960000
                                                                        08970000
           IF REASON NOT =  MQRC-NONE                                   08980000
              MOVE REASON                     TO   CS03-REASON          08990000
              MOVE OPEN-CODE                  TO   CS03-COMPLETION-CODE 09000000
              MOVE 'MQOPEN ENDED WITH REASON CODE'                      09010000
                                              TO   CS03-ERR-MSG         09020000
              PERFORM 9100-EXIT-MQCONN        THRU 9100-EXIT            09030000
           END-IF.                                                      09040000
                                                                        09050000
       5200-EXIT.                                                       09060000
           EXIT.                                                        09070000
                                                                        09080000
      ***********************                                           09090000
       5300-MQ-PUT-MESSAGE.                                             09100000
      ***********************                                           09110000
           MOVE WS-SEND-MESSAGE     TO BUFFER.                          09120000
                                                                        09130000
      *---------------------------------------------------------------  09140000
      *  SET UP MESSAGE DESCRIPTOR                                      09150000
      *---------------------------------------------------------------  09160000
           MOVE MQEI-UNLIMITED      TO MQMD-EXPIRY.                     09170000
           MOVE MQPER-PERSISTENT    TO MQMD-PERSISTENCE.                09180000
           MOVE MQFMT-STRING        TO MQMD-FORMAT.                     09190000
           MOVE WS-MESSAGE-LENGTH   TO BUFFER-LENGTH.                   09200000
      *---------------------------------------------------------------  09210000
      *   MQPUT                                                         09220000
      *---------------------------------------------------------------  09230000
           CALL 'MQPUT'                                                 09240000
                USING HCONN, Q-HANDLE,                                  09250000
                      MESSAGE-DESCRIPTOR, PMOPTIONS,                    09260000
                      BUFFER-LENGTH, BUFFER,                            09270000
                      COMPLETION-CODE, REASON.                          09280000
                                                                        09290000
           IF REASON NOT =  MQRC-NONE                                   09300000
              MOVE REASON                  TO   CS03-REASON             09310000
              MOVE COMPLETION-CODE         TO   CS03-COMPLETION-CODE    09320000
              MOVE 'BP13CS03 MQPUT ERROR'  TO   CS03-ERR-MSG            09330000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               09340000
           END-IF.                                                      09350000
                                                                        09360000
       5300-EXIT.                                                       09370000
           EXIT.                                                        09380000
                                                                        09390000
      ****************************************************************  09400000
       5400-MQ-CLOSE.                                                   09410000
      ****************************************************************  09420000
           MOVE MQCO-NONE TO OPTIONS.                                   09430000
                                                                        09440000
      *---------------------------------------------------------------  09450000
      *   MQCLOSE                                                       09460000
      *---------------------------------------------------------------  09470000
           CALL 'MQCLOSE'                                               09480000
                USING HCONN, Q-HANDLE, OPTIONS,                         09490000
                COMPLETION-CODE, REASON.                                09500000
                                                                        09510000
           IF REASON NOT =  MQRC-NONE                                   09520000
              MOVE REASON                   TO   CS03-REASON            09530000
              MOVE COMPLETION-CODE          TO   CS03-COMPLETION-CODE   09540000
              MOVE 'BP13CS03 MQCLOSE ERROR' TO   CS03-ERR-MSG           09550000
              PERFORM 9100-EXIT-MQCONN      THRU 9100-EXIT              09560000
           END-IF.                                                      09570000
                                                                        09580000
       5400-EXIT.                                                       09590000
           EXIT.                                                        09600000
                                                                        09610000
      ****************************************************************  09620000
       5500-MQ-DISCONNECT.                                              09630000
      ****************************************************************  09640000
      *---------------------------------------------------------------  09650000
      *  DISCONNECT FROM QUEUE MANAGER                                  09660000
      *---------------------------------------------------------------  09670000
           CALL 'MQDISC'                                                09680000
           USING HCONN, COMPLETION-CODE, REASON                         09690000
                                                                        09700000
           IF REASON NOT =  MQRC-NONE                                   09710000
              MOVE REASON                  TO   CS03-REASON             09720000
              MOVE COMPLETION-CODE         TO   CS03-COMPLETION-CODE    09730000
              MOVE 'BP13CS03 MQDISC ERROR' TO   CS03-ERR-MSG            09740000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               09750000
           END-IF.                                                      09760000
                                                                        09770000
       5500-EXIT.                                                       09780000
           EXIT.                                                        09790000
                                                                        09800000
                                                                        09810000
      ****************************************************************  09820000
       9000-CLOSE-FILES.                                                09830000
      ****************************************************************  09840000
                                                                        09850000
           CLOSE BP13F203                                               09860000
                 BP13K060                                               09870000
                 BP13K209.                                              09880000
                                                                        09890000
           IF    RETURN-CODE NOT = ZERO                                 09900000
                 DISPLAY ' *** RETURN-CODE = ' RETURN-CODE ' ERROR'     09910000
           ELSE                                                         09920000
                 DISPLAY ' '                                            09930000
                 DISPLAY ' *** SUCCESSFUL EXECUTION OF BP13CS03.'       09940000
                 DISPLAY ' *** MESSAGE/S PUT INTO QUEUE SUCCESSFULLY!'  09950000
                 DISPLAY ' *** Q MANAGER : ' QM-NAME                    09960000
                 DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME              09970000
                 DISPLAY ' '                                            09980000
           END-IF.                                                      09990000
                                                                        10000000
           STOP RUN.                                                    10010000
                                                                        10020000
       9000-EXIT.                                                       10030000
           EXIT.                                                        10040000
                                                                        10050000
      ****************************************************************  10060000
       9100-EXIT-MQCONN.                                                10070000
      ****************************************************************  10080000
           DISPLAY ' *** PROGRAM ID:  BP13CS03 '.                       10090000
           DISPLAY ' *** Q MANAGER : ' QM-NAME.                         10100000
           DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME.                   10110000
           DISPLAY ' '.                                                 10120000
           IF CS03-COMPLETION-CODE NOT = ZEROES AND LOW-VALUES          10130000
              DISPLAY ' *** MQ COMPLETION CODE: ' CS03-COMPLETION-CODE  10140000
              DISPLAY ' *** MQ REASON         : ' CS03-REASON           10150000
              DISPLAY ' *** MQ ERROR MSG      : ' CS03-ERR-MSG          10160000
              MOVE 99                    TO  RETURN-CODE                10170000
           END-IF.                                                      10180000
                                                                        10190000
           PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT.                10200000
                                                                        10210000
       9100-EXIT.                                                       10220000
           EXIT.                                                        10230000
                                                                        10240000
      ****************************************************************  10250000
      **********            END OF BP13CS03                 **********  10260000
      ****************************************************************  10270000
