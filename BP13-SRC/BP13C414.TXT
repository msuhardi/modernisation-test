       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.            BP13C414.                                         
       AUTHOR.                RASM.                                             
      *DATE-WRITTEN.          28/04/1999.                                       
                                                                                
      *================================================================*        
      *                   SYSTEM OF COMMITMENT (BP13)                  *        
      *================================================================*        
      *  OBJECTIVE:  1.  TO PASS NEW SALES CASES WITH SALES TYPE '1',  *        
      *                  '2', '2B', '3', AND '3A' AND SALES AGREEMENT  *        
      *                  EXECUTION DATE IS ON OR BEFORE CURRENT DATE   *        
      *                  TO UPGRADING TAGGING SYSTEM (BR11).           *        
      *================================================================*        
      *  FILES DESCRIPTION:-                                           *        
      *                 ACCESS       REC                               *        
      *  DD NAME  I/O/E  MODE        LEN   KEY           REMARKS       *        
      *  -------  ----- ------       ---   ---           -------       *        
      * BP13F410    I   SEQ         2000                               *        
      * BR11F203    O   SEQ          300                               *        
      *================================================================*        
      *  MODIFICATIONS :                                               *        
      *  CHGE REQ #  DATE          AUTHOR         REMARKS              *        
      *  ----------  ----          ------         -------              *        
      *  BP130622    28/04/1999    RASM           JOB - BP13D400       *        
      *  BP132047    17/11/2001    MALC           FOLLOW BP13C411 IN   *        
      *                                           MOVING THE SALES-TYPE*        
      *================================================================*        
                                                                                
      *---------------------*                                                   
       ENVIRONMENT DIVISION.                                                    
      *---------------------*                                                   
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.  IBM-3090.                                              
       OBJECT-COMPUTER.  IBM-3090.                                              
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F410 ASSIGN       TO BP13F410.                            
                                                                                
           SELECT BR11F203 ASSIGN       TO BR11F203.                            
                                                                                
           SELECT BP13K800 ASSIGN       TO BP13K800                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K800-NUM-REGN                        
                           FILE STATUS  IS BP13K800-STATUS.                     
                                                                                
           SELECT BP13K820 ASSIGN       TO BP13K820                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS DYNAMIC                              
                           RECORD KEY   IS K820-KEY-FLD                         
                           FILE STATUS  IS BP13K820-STATUS.                     
                                                                                
      *---------------------*                                                   
       DATA DIVISION.                                                           
      *---------------------*                                                   
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  BP13F410        BLOCK  CONTAINS 0    RECORDS                         
                           RECORD CONTAINS 2000 CHARACTERS                      
                           LABEL  RECORD   IS   STANDARD                        
                           RECORDING MODE  IS   F.                              
       COPY BP13F410.                                                           
                                                                                
       FD  BR11F203        BLOCK  CONTAINS 0   RECORDS                          
                           RECORD CONTAINS 300 CHARACTERS                       
                           LABEL  RECORD   IS  STANDARD                         
                           RECORDING MODE  IS  F.                               
       COPY BR11F203.                                                           
                                                                                
       FD  BP13K800        RECORD CONTAINS 2000 CHARACTERS.                     
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K820        RECORD CONTAINS 400 CHARACTERS.                      
       COPY BP13K820.                                                           
                                                                                
                                                                                
      *------------------------*                                                
       WORKING-STORAGE SECTION.                                                 
      *------------------------*                                                
                                                                                
       01  WS-DTE-CCYYMMDD.                                                     
           05  WS-DTE-CC                      PIC X(2).                         
           05  WS-DTE-CURRENT.                                                  
               10  WS-DTE-YY                  PIC X(2).                         
               10  WS-DTE-MM                  PIC X(2).                         
               10  WS-DTE-DD                  PIC X(2).                         
                                                                                
       01  WS-FILE-FLAGS.                                                       
           05  BP13F410-STATUS                PIC 9(2) VALUE ZEROS.             
           05  WS-F410-EOF                    PIC X    VALUE 'N'.               
           05  BR11F203-STATUS                PIC 9(2) VALUE ZEROS.             
           05  BP13K800-STATUS                PIC 9(2) VALUE ZEROS.             
           05  WS-K800-NOT-FOUND              PIC X    VALUE 'N'.               
           05  BP13K820-STATUS                PIC 9(2) VALUE ZEROS.             
           05  WS-K820-NOT-FOUND              PIC X    VALUE 'N'.               
           05  WS-K820-EOF                    PIC X    VALUE 'N'.               
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F410-CNT-READ               PIC 9(8) VALUE ZEROS.             
           05  WS-F203-CNT-WRITE              PIC 9(8) VALUE ZEROS.             
           05  WS-K800-CNT-READ               PIC 9(8) VALUE ZEROS.             
           05  WS-K820-CNT-READ               PIC 9(8) VALUE ZEROS.             
           05  WS-K800-CNT-NOT-FOUND          PIC 9(8) VALUE ZEROS.             
           05  WS-K820-CNT-NOT-FOUND          PIC 9(8) VALUE ZEROS.             
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-SYSTEM-DTE.                                                   
               10  WS-SYS-DTE-DD              PIC X(2).                         
               10  FILLER                     PIC X    VALUE '/'.               
               10  WS-SYS-DTE-MM              PIC X(2).                         
               10  FILLER                     PIC X    VALUE '/'.               
               10  WS-SYS-DTE-CC              PIC X(2).                         
               10  WS-SYS-DTE-YY              PIC X(2).                         
           05  WS-NRIC                        PIC X(9) VALUE SPACES.            
           05  WS-OWNER-STATUS                PIC X    VALUE SPACES.            
           05  WS-SPOUSE-FLAG                 PIC X    VALUE 'N'.               
                                                                                
       01  WS-F203-VARIABLES.                                                   
           05  WS-NUM-UIN1                    PIC X(20) VALUE SPACES.           
           05  WS-NUM-UIN2                    PIC X(20) VALUE SPACES.           
           05  WS-NUM-UIN3                    PIC X(20) VALUE SPACES.           
           05  WS-NUM-UIN4                    PIC X(20) VALUE SPACES.           
           05  WS-NUM-NTNLTY1                 PIC X(2)  VALUE SPACES.           
           05  WS-NUM-NTNLTY2                 PIC X(2)  VALUE SPACES.           
           05  WS-NUM-NTNLTY3                 PIC X(2)  VALUE SPACES.           
           05  WS-NUM-NTNLTY4                 PIC X(2)  VALUE SPACES.           
           05  WS-NUM-MRTL-STATUS1            PIC X     VALUE SPACES.           
           05  WS-NUM-MRTL-STATUS2            PIC X     VALUE SPACES.           
           05  WS-NUM-MRTL-STATUS3            PIC X     VALUE SPACES.           
           05  WS-NUM-MRTL-STATUS4            PIC X     VALUE SPACES.           
           05  WS-NUM-OWNER-STATUS1           PIC X     VALUE SPACES.           
           05  WS-NUM-OWNER-STATUS2           PIC X     VALUE SPACES.           
           05  WS-NUM-OWNER-STATUS3           PIC X     VALUE SPACES.           
           05  WS-NUM-OWNER-STATUS4           PIC X     VALUE SPACES.           
           05  WS-NUM-RELATIONSHIP1           PIC X(2)  VALUE SPACES.           
           05  WS-NUM-RELATIONSHIP2           PIC X(2)  VALUE SPACES.           
           05  WS-NUM-RELATIONSHIP3           PIC X(2)  VALUE SPACES.           
           05  WS-NUM-RELATIONSHIP4           PIC X(2)  VALUE SPACES.           
                                                                                
                                                                                
      *--------------------*                                                    
       PROCEDURE DIVISION.                                                      
      *--------------------*                                                    
                                                                                
                                                                                
      ******************************************************************        
       0000-CONTROL.                                                            
      ******************************************************************        
           PERFORM 1000-OPEN-FILES    THRU 1000-EXIT.                           
           PERFORM 2000-BP13F410-READ THRU 2000-EXIT.                           
           PERFORM 3000-MAIN-ROUTINE  THRU 3000-EXIT                            
                   UNTIL (WS-F410-EOF = 'Y').                                   
           PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-FILES.                                                         
      ******************************************************************        
           OPEN INPUT  BP13F410                                                 
                       BP13K800                                                 
                       BP13K820                                                 
                OUTPUT BR11F203.                                                
                                                                                
           IF BP13F410-STATUS NOT = ZEROS                                       
              MOVE BP13F410-STATUS TO RETURN-CODE                               
              DISPLAY 'OPEN BP13F410 FAIL STATUS = ' BP13F410-STATUS            
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF BR11F203-STATUS NOT = ZEROS                                       
              MOVE BR11F203-STATUS  TO RETURN-CODE                              
              DISPLAY 'OPEN BR11F203 FAIL STATUS = ' BR11F203-STATUS            
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K800-STATUS NOT = ZEROS AND 97                                
              MOVE BP13K800-STATUS  TO RETURN-CODE                              
              DISPLAY 'OPEN BP13K800 FAIL STATUS = ' BP13K800-STATUS            
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K820-STATUS NOT = ZEROS AND 97                                
              MOVE BP13K820-STATUS  TO RETURN-CODE                              
              DISPLAY 'OPEN BP13K820 FAIL STATUS = ' BP13K820-STATUS            
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           ACCEPT WS-DTE-CCYYMMDD FROM DATE YYYYMMDD.                           
           DISPLAY WS-DTE-CCYYMMDD.                                             
           MOVE WS-DTE-DD TO WS-SYS-DTE-DD.                                     
           MOVE WS-DTE-MM TO WS-SYS-DTE-MM.                                     
           MOVE WS-DTE-CC TO WS-SYS-DTE-CC.                                     
           MOVE WS-DTE-YY TO WS-SYS-DTE-YY.                                     
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       2000-BP13F410-READ.                                                      
      ******************************************************************        
      *----------------------------------------------------------------*        
      *  PROCEDURE TO READ BP13F410 FILE.                              *        
      *----------------------------------------------------------------*        
           READ BP13F410 AT END                                                 
                         MOVE 'Y'         TO WS-F410-EOF                        
                         GO TO 2000-EXIT                                        
           END-READ.                                                            
                                                                                
           ADD 1                          TO WS-F410-CNT-READ.                  
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       3000-MAIN-ROUTINE.                                                       
      ******************************************************************        
           IF F410-DTE-ARGORDER <= WS-DTE-CCYYMMDD                              
              PERFORM 4000-BR11F203-WRITE THRU 4000-EXIT                        
           END-IF.                                                              
                                                                                
           PERFORM 2000-BP13F410-READ  THRU 2000-EXIT.                          
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       4000-BR11F203-WRITE.                                                     
      ******************************************************************        
      *----------------------------------------------------------------*        
      *  PROCEDURE TO WRITE BR11F203 FILE.                             *        
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                      TO BR11F203-REC.                    
           INITIALIZE                          BR11F203-REC.                    
                                                                                
           MOVE SPACES                      TO WS-F203-VARIABLES.               
           INITIALIZE                          WS-F203-VARIABLES.               
                                                                                
           MOVE F410-NUM-SCH-ACC            TO F203-NUM-HDB-REF.                
                                                                                
           IF (F410-CDE-SALES-TYPE = '10')                                      
              IF F410-CDE-ERL-SCH = 'A' OR 'B' OR 'C' OR 'D'                    
                 MOVE '1B'                  TO F203-NUM-SALES-TYP               
              ELSE                                                              
                 MOVE '10'                  TO F203-NUM-SALES-TYP.              
                                                                                
           IF (F410-CDE-SALES-TYPE = '01')                                      
              IF F410-CDE-ERL-SCH = 'A' OR 'B' OR 'C' OR 'D'                    
                 MOVE '1A'                  TO F203-NUM-SALES-TYP               
              ELSE                                                              
                 MOVE '1 '                  TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '02'                                        
              MOVE '2 '                     TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '2B'                                        
              MOVE '2B'                     TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '03'                                        
              MOVE '3 '                     TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '3A'                                        
              MOVE '3A'                     TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '5B' OR '5C'                                
              MOVE F410-CDE-SALES-TYPE      TO F203-NUM-SALES-TYP.              
                                                                                
           IF F410-CDE-SALES-TYPE = '13'                                        
              MOVE '13'                     TO F203-NUM-SALES-TYP.              
                                                                                
           MOVE F410-DTE-ARGORDER           TO F203-DTE-EXE-SALE-AGRMT.         
           MOVE F410-DTE-SO-EFFECTIVE       TO F203-DTE-SALE-EFF.               
           MOVE F410-DTE-KEY-ISSUE          TO F203-DTE-KEY-ISSUE.              
                                                                                
      * PROCESS HA1                                                             
           IF NOT (F410-NRIC1 = SPACES OR LOW-VALUES)                           
              MOVE F410-NUM-REGN            TO K820-NUM-REGN                    
              MOVE F410-NRIC1               TO K820-NUM-NRIC                    
              MOVE 'N'                      TO WS-K820-NOT-FOUND                
              PERFORM 6000-BP13K820-READ  THRU 6000-EXIT                        
              IF WS-K820-NOT-FOUND = 'Y'                                        
                 MOVE SPACES                   TO WS-NUM-UIN1                   
                                                  WS-NUM-RELATIONSHIP1          
                                                  WS-NUM-NTNLTY1                
                                                  WS-NUM-MRTL-STATUS1           
                                                  WS-NUM-OWNER-STATUS1          
              ELSE                                                              
                 MOVE K820-NUM-RELATIONSHIP    TO WS-NUM-RELATIONSHIP1          
                 MOVE K820-NUM-NATIONALITY     TO WS-NUM-NTNLTY1                
                 MOVE K820-NUM-MARITAL-STATUS  TO WS-NUM-MRTL-STATUS1           
                 MOVE K820-NUM-REGN            TO K800-NUM-REGN                 
                 MOVE K820-NUM-NRIC            TO WS-NRIC WS-NUM-UIN1           
                 PERFORM 5000-BP13K800-READ  THRU 5000-EXIT                     
                 MOVE WS-OWNER-STATUS          TO WS-NUM-OWNER-STATUS1          
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * PROCESS HA2                                                             
           IF NOT (F410-NRIC2 = SPACES OR LOW-VALUES)                           
              MOVE F410-NUM-REGN            TO K820-NUM-REGN                    
              MOVE F410-NRIC2               TO K820-NUM-NRIC                    
              MOVE 'N'                      TO WS-K820-NOT-FOUND                
              PERFORM 6000-BP13K820-READ  THRU 6000-EXIT                        
              IF WS-K820-NOT-FOUND = 'Y'                                        
                 MOVE SPACES                   TO WS-NUM-UIN2                   
                                                  WS-NUM-RELATIONSHIP2          
                                                  WS-NUM-NTNLTY2                
                                                  WS-NUM-MRTL-STATUS2           
                                                  WS-NUM-OWNER-STATUS2          
              ELSE                                                              
                 MOVE K820-NUM-RELATIONSHIP    TO WS-NUM-RELATIONSHIP2          
                 MOVE K820-NUM-NATIONALITY     TO WS-NUM-NTNLTY2                
                 MOVE K820-NUM-MARITAL-STATUS  TO WS-NUM-MRTL-STATUS2           
                 MOVE K820-NUM-REGN            TO K800-NUM-REGN                 
                 MOVE K820-NUM-NRIC            TO WS-NRIC WS-NUM-UIN2           
                 PERFORM 5000-BP13K800-READ  THRU 5000-EXIT                     
                 MOVE WS-OWNER-STATUS          TO WS-NUM-OWNER-STATUS2          
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * PROCESS HA3                                                             
           IF NOT (F410-NRIC3 = SPACES OR LOW-VALUES)                           
              MOVE F410-NUM-REGN            TO K820-NUM-REGN                    
              MOVE F410-NRIC3               TO K820-NUM-NRIC                    
              MOVE 'N'                      TO WS-K820-NOT-FOUND                
              PERFORM 6000-BP13K820-READ  THRU 6000-EXIT                        
              IF WS-K820-NOT-FOUND = 'Y'                                        
                 MOVE SPACES                   TO WS-NUM-UIN3                   
                                                  WS-NUM-RELATIONSHIP3          
                                                  WS-NUM-NTNLTY3                
                                                  WS-NUM-MRTL-STATUS3           
                                                  WS-NUM-OWNER-STATUS3          
              ELSE                                                              
                 MOVE K820-NUM-RELATIONSHIP    TO WS-NUM-RELATIONSHIP3          
                 MOVE K820-NUM-NATIONALITY     TO WS-NUM-NTNLTY3                
                 MOVE K820-NUM-MARITAL-STATUS  TO WS-NUM-MRTL-STATUS3           
                 MOVE K820-NUM-REGN            TO K800-NUM-REGN                 
                 MOVE K820-NUM-NRIC            TO WS-NRIC WS-NUM-UIN3           
                 PERFORM 5000-BP13K800-READ  THRU 5000-EXIT                     
                 MOVE WS-OWNER-STATUS          TO WS-NUM-OWNER-STATUS3          
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * PROCESS HA4                                                             
           IF NOT (F410-NRIC4 = SPACES OR LOW-VALUES)                           
              MOVE F410-NUM-REGN            TO K820-NUM-REGN                    
              MOVE F410-NRIC4               TO K820-NUM-NRIC                    
              MOVE 'N'                      TO WS-K820-NOT-FOUND                
              PERFORM 6000-BP13K820-READ  THRU 6000-EXIT                        
              IF WS-K820-NOT-FOUND = 'Y'                                        
                 MOVE SPACES                   TO WS-NUM-UIN4                   
                                                  WS-NUM-RELATIONSHIP4          
                                                  WS-NUM-NTNLTY4                
                                                  WS-NUM-MRTL-STATUS4           
                                                  WS-NUM-OWNER-STATUS4          
              ELSE                                                              
                 MOVE K820-NUM-RELATIONSHIP    TO WS-NUM-RELATIONSHIP4          
                 MOVE K820-NUM-NATIONALITY     TO WS-NUM-NTNLTY4                
                 MOVE K820-NUM-MARITAL-STATUS  TO WS-NUM-MRTL-STATUS4           
                 MOVE K820-NUM-REGN            TO K800-NUM-REGN                 
                 MOVE K820-NUM-NRIC            TO WS-NRIC WS-NUM-UIN4           
                 PERFORM 5000-BP13K800-READ  THRU 5000-EXIT                     
                 MOVE WS-OWNER-STATUS          TO WS-NUM-OWNER-STATUS4          
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * MAKE SURE THAT NO BLANK UIN IN BETWEEN                                  
      * THERE IS MAXIMUM OF 4 APPLICANTS AND 1 SPOUSE RECORD                    
                                                                                
           IF WS-NUM-UIN1 = SPACES OR LOW-VALUES                                
              IF WS-NUM-UIN2 = SPACES OR LOW-VALUES                             
                 IF WS-NUM-UIN3 = SPACES OR LOW-VALUES                          
                    IF WS-NUM-UIN4 = SPACES OR LOW-VALUES                       
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE WS-NUM-UIN4         TO F203-NUM-UIN1                
                       MOVE WS-NUM-NTNLTY4      TO F203-NUM-NTNLTY1             
                       MOVE WS-NUM-MRTL-STATUS4 TO F203-NUM-MRTL-STATUS1        
                       MOVE WS-NUM-OWNER-STATUS4 TO                             
                            F203-NUM-OWNER-STATUS1                              
                    END-IF                                                      
                 ELSE                                                           
                    MOVE WS-NUM-UIN3         TO F203-NUM-UIN1                   
                    MOVE WS-NUM-NTNLTY3      TO F203-NUM-NTNLTY1                
                    MOVE WS-NUM-MRTL-STATUS3 TO F203-NUM-MRTL-STATUS1           
                    MOVE WS-NUM-OWNER-STATUS3 TO F203-NUM-OWNER-STATUS1         
                 END-IF                                                         
              ELSE                                                              
                 MOVE WS-NUM-UIN2         TO F203-NUM-UIN1                      
                 MOVE WS-NUM-NTNLTY2      TO F203-NUM-NTNLTY1                   
                 MOVE WS-NUM-MRTL-STATUS2 TO F203-NUM-MRTL-STATUS1              
                 MOVE WS-NUM-OWNER-STATUS2 TO F203-NUM-OWNER-STATUS1            
              END-IF                                                            
           ELSE                                                                 
              MOVE WS-NUM-UIN1         TO F203-NUM-UIN1                         
              MOVE WS-NUM-NTNLTY1      TO F203-NUM-NTNLTY1                      
              MOVE WS-NUM-MRTL-STATUS1 TO F203-NUM-MRTL-STATUS1                 
              MOVE WS-NUM-OWNER-STATUS1 TO F203-NUM-OWNER-STATUS1               
              IF WS-NUM-UIN2 = SPACES OR LOW-VALUES                             
                 IF WS-NUM-UIN3 = SPACES OR LOW-VALUES                          
                    IF WS-NUM-UIN4 = SPACES OR LOW-VALUES                       
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE WS-NUM-UIN4         TO F203-NUM-UIN2                
                       MOVE WS-NUM-NTNLTY4      TO F203-NUM-NTNLTY2             
                       MOVE WS-NUM-MRTL-STATUS4 TO F203-NUM-MRTL-STATUS2        
                       MOVE WS-NUM-OWNER-STATUS4 TO                             
                            F203-NUM-OWNER-STATUS2                              
                    END-IF                                                      
                 ELSE                                                           
                    MOVE WS-NUM-UIN3         TO F203-NUM-UIN2                   
                    MOVE WS-NUM-NTNLTY3      TO F203-NUM-NTNLTY2                
                    MOVE WS-NUM-MRTL-STATUS3 TO F203-NUM-MRTL-STATUS2           
                    MOVE WS-NUM-OWNER-STATUS3 TO F203-NUM-OWNER-STATUS2         
                 END-IF                                                         
              ELSE                                                              
                 MOVE WS-NUM-UIN2         TO F203-NUM-UIN2                      
                 MOVE WS-NUM-NTNLTY2      TO F203-NUM-NTNLTY2                   
                 MOVE WS-NUM-MRTL-STATUS2 TO F203-NUM-MRTL-STATUS2              
                 MOVE WS-NUM-OWNER-STATUS2 TO F203-NUM-OWNER-STATUS2            
                 IF WS-NUM-UIN3 = SPACES OR LOW-VALUES                          
                    IF WS-NUM-UIN4 = SPACES OR LOW-VALUES                       
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE WS-NUM-UIN4          TO F203-NUM-UIN3               
                       MOVE WS-NUM-NTNLTY4       TO F203-NUM-NTNLTY3            
                       MOVE WS-NUM-MRTL-STATUS4  TO                             
                            F203-NUM-MRTL-STATUS3                               
                       MOVE WS-NUM-OWNER-STATUS4 TO                             
                            F203-NUM-OWNER-STATUS4                              
                    END-IF                                                      
                 ELSE                                                           
                    MOVE WS-NUM-UIN3         TO F203-NUM-UIN3                   
                    MOVE WS-NUM-NTNLTY3      TO F203-NUM-NTNLTY3                
                    MOVE WS-NUM-MRTL-STATUS3 TO F203-NUM-MRTL-STATUS3           
                    MOVE WS-NUM-OWNER-STATUS3 TO F203-NUM-OWNER-STATUS3         
                    IF WS-NUM-UIN4 = SPACES OR LOW-VALUES                       
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE WS-NUM-UIN4         TO F203-NUM-UIN4                
                       MOVE WS-NUM-NTNLTY4      TO F203-NUM-NTNLTY4             
                       MOVE WS-NUM-MRTL-STATUS4 TO F203-NUM-MRTL-STATUS4        
                       MOVE WS-NUM-OWNER-STATUS4 TO                             
                            F203-NUM-OWNER-STATUS4                              
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * CHECK FOR ANY SPOUSES IN HA1 TO HA4                                     
      * IF NONE GET FROM BP13K820                                               
           IF (WS-NUM-RELATIONSHIP1 = '20') OR                                  
              (WS-NUM-RELATIONSHIP2 = '20') OR                                  
              (WS-NUM-RELATIONSHIP3 = '20') OR                                  
              (WS-NUM-RELATIONSHIP4 = '20')                                     
              CONTINUE                                                          
           ELSE                                                                 
              MOVE 'N'                      TO WS-K820-EOF                      
              MOVE F410-NUM-REGN            TO K820-NUM-REGN                    
              MOVE SPACES                   TO K820-NUM-NRIC                    
              START BP13K820 KEY >= K820-KEY-FLD                                
              IF BP13K820-STATUS NOT = 00                                       
                 DISPLAY 'START ERROR, BP13K820-STATUS '                        
                                         BP13K820-STATUS                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
              ELSE                                                              
                 PERFORM 7000-BP13K820-READNEXT THRU 7000-EXIT                  
                         UNTIL (WS-K820-EOF = 'Y') OR                           
                               (K820-NUM-RELATIONSHIP = '20')                   
              END-IF                                                            
              IF (WS-K820-EOF = 'Y') OR                                         
                 (K820-NUM-RELATIONSHIP NOT = '20')                             
                 CONTINUE                                                       
              ELSE                                                              
                 IF NOT (F203-NUM-UIN1 = SPACES OR LOW-VALUES)                  
                    IF NOT (F203-NUM-UIN2 = SPACES OR LOW-VALUES)               
                       IF NOT (F203-NUM-UIN3 = SPACES OR LOW-VALUES)            
                          IF NOT (F203-NUM-UIN4 = SPACES OR LOW-VALUES)         
                             MOVE K820-NUM-NRIC        TO F203-NUM-UIN5         
                             MOVE K820-NUM-NATIONALITY TO                       
                                                 F203-NUM-NTNLTY5               
                             MOVE K820-NUM-MARITAL-STATUS TO                    
                                                 F203-NUM-MRTL-STATUS5          
                             MOVE 'O'                  TO                       
                                                 F203-NUM-OWNER-STATUS5         
                          ELSE                                                  
                             MOVE K820-NUM-NRIC        TO F203-NUM-UIN4         
                             MOVE K820-NUM-NATIONALITY TO                       
                                                 F203-NUM-NTNLTY4               
                             MOVE K820-NUM-MARITAL-STATUS TO                    
                                                 F203-NUM-MRTL-STATUS4          
                             MOVE 'O'                  TO                       
                                                 F203-NUM-OWNER-STATUS4         
                          END-IF                                                
                       ELSE                                                     
                          MOVE K820-NUM-NRIC           TO F203-NUM-UIN3         
                          MOVE K820-NUM-NATIONALITY    TO                       
                                                F203-NUM-NTNLTY3                
                          MOVE K820-NUM-MARITAL-STATUS TO                       
                                                F203-NUM-MRTL-STATUS3           
                          MOVE 'O'                     TO                       
                                                F203-NUM-OWNER-STATUS3          
                       END-IF                                                   
                    ELSE                                                        
                       MOVE K820-NUM-NRIC           TO F203-NUM-UIN2            
                       MOVE K820-NUM-NATIONALITY    TO F203-NUM-NTNLTY2         
                       MOVE K820-NUM-MARITAL-STATUS TO                          
                                             F203-NUM-MRTL-STATUS2              
                       MOVE 'O'                     TO                          
                                             F203-NUM-OWNER-STATUS2             
                    END-IF                                                      
                 ELSE                                                           
                    MOVE K820-NUM-NRIC           TO F203-NUM-UIN1               
                    MOVE K820-NUM-NATIONALITY    TO F203-NUM-NTNLTY1            
                    MOVE K820-NUM-MARITAL-STATUS TO                             
                                                 F203-NUM-MRTL-STATUS1          
                    MOVE 'O'                  TO F203-NUM-OWNER-STATUS1         
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           WRITE BR11F203-REC.                                                  
           ADD   1                          TO WS-F203-CNT-WRITE.               
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       5000-BP13K800-READ.                                                      
      ******************************************************************        
      *----------------------------------------------------------------*        
      *  PROCEDURE TO READ BP13K800 FILE.                              *        
      *----------------------------------------------------------------*        
           READ BP13K800.                                                       
                                                                                
           EVALUATE BP13K800-STATUS                                             
              WHEN 00                                                           
                   ADD  1                   TO WS-K800-CNT-READ                 
                   IF K800-NUM-NRIC1 = WS-NRIC                                  
                      MOVE 'L'              TO WS-OWNER-STATUS                  
                   ELSE                                                         
                      IF K800-NUM-NRIC2 = WS-NRIC                               
                         MOVE 'L'           TO WS-OWNER-STATUS                  
                      ELSE                                                      
                         IF K800-NUM-NRIC3 = WS-NRIC                            
                            MOVE 'L'        TO WS-OWNER-STATUS                  
                         ELSE                                                   
                            IF K800-NUM-NRIC4 = WS-NRIC                         
                               MOVE 'L'     TO WS-OWNER-STATUS                  
                            ELSE                                                
                               MOVE 'O'     TO WS-OWNER-STATUS                  
                            END-IF                                              
                         END-IF                                                 
                      END-IF                                                    
                   END-IF                                                       
              WHEN 23                                                           
                   ADD  1                   TO WS-K800-CNT-NOT-FOUND            
                   DISPLAY 'REC NOT FOUND IN BP13K800: ' K800-NUM-REGN          
                   GO TO 5000-EXIT                                              
              WHEN OTHER                                                        
                   MOVE BP13K800-STATUS  TO RETURN-CODE                         
                   DISPLAY 'OPEN BP13K800 FAIL STATUS = '                       
                                                BP13K800-STATUS                 
                   PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       6000-BP13K820-READ.                                                      
      ******************************************************************        
      *----------------------------------------------------------------*        
      *  PROCEDURE TO READ BP13K820 FILE.                              *        
      *----------------------------------------------------------------*        
           READ BP13K820.                                                       
                                                                                
           EVALUATE BP13K820-STATUS                                             
              WHEN 00                                                           
                   ADD  1                   TO WS-K820-CNT-READ                 
                   MOVE 'N'                 TO WS-K820-NOT-FOUND                
              WHEN 23                                                           
                   ADD  1                   TO WS-K820-CNT-NOT-FOUND            
                   MOVE 'Y'                 TO WS-K820-NOT-FOUND                
                   DISPLAY 'REC NOT FOUND IN BP13K820: ' K820-NUM-REGN          
                                                         K820-NUM-NRIC          
              WHEN OTHER                                                        
                   MOVE BP13K820-STATUS  TO RETURN-CODE                         
                   DISPLAY 'OPEN BP13K820 FAIL STATUS = '                       
                                                BP13K820-STATUS                 
                   PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
           DISPLAY '------------------------------'.                            
           DISPLAY K820-NUM-REGN.                                               
           DISPLAY K820-NUM-NRIC.                                               
           DISPLAY K820-NUM-MARITAL-STATUS.                                     
                                                                                
                                                                                
           IF WS-K820-NOT-FOUND = 'N'                                           
              IF K820-NUM-MARITAL-STATUS = '1'                                  
                 MOVE 'S' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '2'                                  
                 MOVE 'M' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '3'                                  
                 MOVE 'W' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '4'                                  
                 MOVE 'D' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '5'                                  
                 MOVE 'P' TO K820-NUM-MARITAL-STATUS                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       7000-BP13K820-READNEXT.                                                  
      ******************************************************************        
      *----------------------------------------------------------------*        
      *  PROCEDURE TO READNEXT BP13K820 FILE.                          *        
      *----------------------------------------------------------------*        
           READ BP13K820 NEXT RECORD AT END MOVE 'Y' TO WS-K820-EOF             
                              GO TO 7000-EXIT.                                  
                                                                                
           DISPLAY 'K820-NUM-REGN = ' K820-NUM-REGN.                            
           DISPLAY 'K820-NUM-NRIC = ' K820-NUM-NRIC.                            
           DISPLAY 'K820-NUM-NAT  = ' K820-NUM-NATIONALITY.                     
           DISPLAY 'WS-K820-EOF   = ' WS-K820-EOF.                              
                                                                                
           IF K820-NUM-RELATIONSHIP = '20'                                      
              IF K820-NUM-MARITAL-STATUS = '1'                                  
                 MOVE 'S' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '2'                                  
                 MOVE 'M' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '3'                                  
                 MOVE 'W' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '4'                                  
                 MOVE 'D' TO K820-NUM-MARITAL-STATUS                            
              ELSE                                                              
              IF K820-NUM-MARITAL-STATUS = '5'                                  
                 MOVE 'P' TO K820-NUM-MARITAL-STATUS                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K820-NUM-REGN NOT = F410-NUM-REGN                                 
              MOVE 'Y'                        TO WS-K820-EOF                    
              GO TO 7000-EXIT                                                   
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       9000-CLOSE-FILES.                                                        
      ******************************************************************        
           DISPLAY 'PROGRAM ID:  BP13C414'.                                     
           DISPLAY 'DATE      :  ' WS-SYSTEM-DTE.                               
           DISPLAY '*============ COUNTERS ============*'.                      
           DISPLAY 'BP13F410 RECORDS READ    : ' WS-F410-CNT-READ.              
           DISPLAY 'BP13K800 RECORDS READ    : ' WS-K800-CNT-READ.              
           DISPLAY 'BP13K820 RECORDS READ    : ' WS-K800-CNT-READ.              
           DISPLAY 'BP13K800 RECS NOT FOUND  : ' WS-K800-CNT-NOT-FOUND.         
           DISPLAY 'BP13K820 RECS NOT FOUND  : ' WS-K820-CNT-NOT-FOUND.         
           DISPLAY 'BR11F203 RECORDS WRITTEN : ' WS-F203-CNT-WRITE.             
                                                                                
           CLOSE BP13F410 BP13K800 BP13K820                                     
                 BR11F203.                                                      
                                                                                
           IF BP13F410-STATUS NOT = ZEROS                                       
              MOVE BP13F410-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSE BP13F410 FAIL STATUS = ' BP13F410-STATUS           
           END-IF.                                                              
                                                                                
           IF BR11F203-STATUS NOT = ZEROS                                       
              MOVE BR11F203-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSE BR11F203 FAIL STATUS = ' BR11F203-STATUS           
           END-IF.                                                              
                                                                                
           IF BP13K800-STATUS NOT = ZEROS                                       
              MOVE BP13K800-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSE BP13K800 FAIL STATUS = ' BP13K800-STATUS           
           END-IF.                                                              
                                                                                
           IF BP13K820-STATUS NOT = ZEROS                                       
              MOVE BP13K820-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSE BP13K820 FAIL STATUS = ' BP13K820-STATUS           
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
      *  >>>>>>>>>>>>>>>>>>>>>> END OF BP13C414 <<<<<<<<<<<<<<<<<<<<<  *        
      *----------------------------------------------------------------*        
