       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CF82.                                                 
      *AUTHOR.        ZARITA DANE SARMIENTO                                     
      *DATE-WRITTEN.  04/12/2012.                                               
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      * OBJECTIVE  : REPORT  FOR   CASES WITH HLE DEFER TAG OR     *            
      *              DATE                                          *            
      *                                                            *            
      * INPUT      : BP13F800                                      *            
      * OUTPUT     : BP13LF82                                      *            
      * ---------------------------------------------------------- *            
      * CHG REF  DATE     BY    DESCRIPTIONS                       *            
      * -------- -------- ----- ------------                       *            
      * BP134449 20121204 ZDD1  NEW PROGRAM                        *            
      * BP134974 20130710 RJE1  REMOVED TSH19 AND REPLACED WITH TH1*            
      * BP135963 20150929 zdd1  cater for other condition to bypass*            
      *                         *cancenled cases/loan tag b and    *            
      *                         *with hla expiry                   *            
      * BP136082 20160211 KVL1  TO CHANGE ALL RCPTS TO LONG NAME   *            
      *                         USING BP13CCNT & REPLACE TH1 TO    *            
      *                         KATHIJAH_BEE_ALI_MOHAMED@HDB.GOV.SG*            
      * BP136477 20161018 RJB1  TO REPLACE KIM HUAT TO YEE MIEN    *            
      * BP136851 20170620 PCL4  TO UPDATE EMAIL RECIPIENTS         *            
      * BP138047 20191125 KAC1  RECOMPILE FOR BP27 COPYBOOK UPDATE *            
      * BP138757 20210728 kav1  TO REPLACE hong HUAT TO bernice    *            
      * BP139030 20220107 ZAR7  REPLACE CHUA YEE MIEN TO LIM KOK CHUN           
      * BP139276 20240405 KAC1  REPLACEING LIM KOK CHUN BY         *            
      *                                    KATHIJAH_BEE_ALI_MOHAMED*            
      * BP139175 20240429 KAC1  REPL Bernice_JH_GAN@hdb.gov.sg WITH*            
      *                         Iris_LL_KOR@hdb.gov.sg             *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13F800 ASSIGN TO BP13F800.                                  
                                                                                
           SELECT BP13K022  ASSIGN        TO BP13K022                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K022-KEY-FLD                       
                            ALTERNATE KEY IS K022-NUM-REGN                      
                            FILE STATUS   IS BP13K022-STATUS.                   
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            ALTERNATE KEY IS K110-REGN-NO                       
                            FILE STATUS   IS BM06K110-STATUS.                   
                                                                                
           SELECT BM06K100  ASSIGN        TO BM06K100                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K100-KEY-FLD                       
                            FILE STATUS   IS BM06K100-STATUS.                   
                                                                                
           SELECT BP27K800  ASSIGN        TO BP27K800                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-HLA                       
                            FILE STATUS   IS BP27K800-STATUS.                   
                                                                                
           SELECT BP13LF82  ASSIGN TO BP13LF82.                                 
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F800                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            RECORDING MODE IS F.                                                
       COPY BP13F800.                                                           
                                                                                
       FD  BP13LF82                                                             
           RECORD CONTAINS 80  CHARACTERS                                       
           RECORDING  MODE  IS F.                                               
       01  LF82-PRTREC                       PIC X(80).                         
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS  100 CHARACTERS.                                    
       COPY BP13K022.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BM06K110.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BM06K100.                                                           
                                                                                
       FD   BP27K800                                                            
            RECORD CONTAINS 1200 CHARACTERS.                                    
       COPY BP27K800.                                                           
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01 WS-F800-EOF                    PIC X     VALUE 'N'.                   
       01 WS-BYPASS                      PIC 9(6)  VALUE ZEROS.                 
       01 WS-BYPASS-WITH-HLE-EXP         PIC 9(6)  VALUE ZEROS.                 
       01 WS-BYPASS-CANCELLED            PIC 9(6)  VALUE ZEROS.                 
       01 WS-BYPASS-LN-TAG-B             PIC 9(6)  VALUE ZEROS.                 
       01 WS-F800-READ                   PIC 9(6)  VALUE ZEROS.                 
       01 WS-WRT-LF82                    PIC 9(4)  VALUE ZEROS.                 
       01 WS-K022-FND                    PIC 9(4)  VALUE ZEROS.                 
       01 WS-K022-NFND                   PIC 9(4)  VALUE ZEROS.                 
       01 WS-K100-FND                    PIC 9(4)  VALUE ZEROS.                 
       01 WS-K100-NFND                   PIC 9(4)  VALUE ZEROS.                 
       01 WS-K110-FND                    PIC 9(4)  VALUE ZEROS.                 
       01 WS-K110-NFND                   PIC 9(4)  VALUE ZEROS.                 
       01 WS-K800-FND                    PIC 9(4)  VALUE ZEROS.                 
       01 WS-K800-NFND                   PIC 9(4)  VALUE ZEROS.                 
       01 BP13K022-STATUS                PIC X(2)  VALUE SPACES.                
       01 BM06K100-STATUS                PIC X(2)  VALUE SPACES.                
       01 BM06K110-STATUS                PIC X(2)  VALUE SPACES.                
       01 BP27K800-STATUS                PIC X(2)  VALUE SPACES.                
       01 WS-MONTH                       PIC 9(2)  VALUE ZEROS.                 
       01 WS-PAGE-CTR                    PIC 9(3)  VALUE ZEROS.                 
       01 WS-LINE-CTR                    PIC 9(2)  VALUE 51.                    
       01 WS-SNO-VAR                     PIC 9(5)  VALUE ZEROS.                 
                                                                                
       01 WS-DATE                        PIC X(8)  VALUE SPACES.                
       01 WS-DATE-TAG                    PIC X(8)  VALUE SPACES.                
       01 WS-DATE-DEF                    PIC X(8)  VALUE SPACES.                
                                                                                
       01  WS-NUM-FIELD.                                                00840001
           05  WS-REM                   PIC 9(3).                       00850001
           05  WS-YEAR                  PIC 9(4).                       00860001
                                                                        00880001
       01  WS-CURR-DATE.                                                00840001
           05  WS-CURRENT-DATE.                                                 
               10  WS-CURR-CC           PIC 99     VALUE 00.                    
               10  WS-CURR-DATE.                                                
                   15  WS-CURR-YY       PIC 99     VALUE 00.                    
                   15  WS-CURR-MM       PIC 99     VALUE 00.                    
                   15  WS-CURR-DD       PIC 99     VALUE 00.                    
                                                                                
       01  DATE-RECORD.                                                 00890001
           05  DATE-REC                   PIC X(8).                     00900001
           05  DATE-REC1 REDEFINES DATE-REC.                            00910001
               10 CAL-DATE.                                             00920001
                   15 CAL-YEAR            PIC 9(4).                     00930001
                       88 VALID-YEAR          VALUE 1900 THRU 2100.     00940001
                   15 CAL-MONTH           PIC 9(2).                     00950001
                       88 31-DAY-MONTH        VALUE 01, 03, 05, 07, 08, 00960001
                                                        10, 12.         00970001
                       88 30-DAY-MONTH        VALUE 04, 06, 09, 11.     00980001
                       88 28-29-DAY-MONTH     VALUE 02.                 00990001
                       88 VALID-MONTH         VALUE 01 THRU 12.         01000001
                   15 CAL-DAY             PIC 9(2).                     01010001
                       88 VALID-DAY           VALUE 01 THRU 31.         01020001
                                                                        01030001
                                                                                
      *-------------------------                                                
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                                 
      *-------------------------                                                
       01  WS-BP13CCNT-LINK.                                                    
           05  LINK-CNTCT-TYPE         PIC X(3)  VALUE SPACES.                  
           05  LINK-STAFF-NICK         PIC X(6)  VALUE SPACES.                  
           05  LINK-STAFF-NUM          PIC X(6)  VALUE SPACES.                  
           05  LINK-STAFF-CNTCT        PIC X(50) VALUE SPACES.                  
           05  LINK-SYSERR             PIC 9(4)  VALUE ZEROES.                  
                                                                                
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT BP13MAIL  -  DATASET FOR EMAIL                                   
      *-------------------------------------------------------------            
       01  MAIL-HDR1.                                                           
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.                 
           05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
       01  MAIL-HDR2.                                                           
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                         
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.                    
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2.                                                           
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-TO         PIC X(60)  VALUE SPACES.                         
      *    05  FILLER          PIC X(54)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2C.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CCMAILID   PIC X(60)  VALUE                                 
      *        'YSG1@HDB.GOV.SG>'.                                              
               'YEO_SIEW_GUAT@HDB.GOV.SG>'.                                     
      *    05  FILLER          PIC X(55)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2D.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CCMAILID   PIC X(60)  VALUE                                 
      *        'TH1@HDB.GOV.SG>'.                                               
               'Iris_LL_KOR@hdb.gov.sg'.                                        
      *    05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2E.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CCMAILID   PIC X(60)  VALUE                                 
      *        'LKH2@HDB.GOV.SG>'.                                              
               'KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.                          
      *    05  FILLER          PIC X(55)  VALUE SPACES.                         
                                                                                
                                                                                
      *  for testing purpose -------                                            
      *01  MAIL-HDR1.                                                           
      *    05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB3'.                 
      *    05  FILLER          PIC X(68)  VALUE SPACES.                         
      *                                                                         
      *01  MAIL-HDR2.                                                           
      *    05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
      *    05  MAIL-SENDID     PIC X(07)  VALUE 'CSXXXXX'.                      
      *    05  FILLER          PIC X(09)  VALUE '@SGPHDB3>'.                    
      *    05  FILLER          PIC X(53)  VALUE SPACES.                         
      *                                                                         
      *01  MAIL-DTL2B.                                                          
      *    05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
      *    05  FILLER          PIC X(17)  VALUE                                 
      *        'lkc13@hdb.gov.sg>'.                                             
      *    05  FILLER          PIC X(54)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL3.                                                           
           05  FILLER          PIC X(04)  VALUE 'DATA'.                         
           05  FILLER          PIC X(76)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4.                                                           
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                        
           05  MAIL-SENDMAILID PIC X(26)  VALUE                                 
               'SOC System - Email Alert'.                                      
           05  FILLER          PIC X(49)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6.                                                           
           05  FILLER          PIC X(4)   VALUE 'TO:<'.                         
           05  MAIL-TO1        PIC X(60)  VALUE SPACES.                         
      *    05  FILLER          PIC X(30)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6C.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
      *        'YSG1@HDB.GOV.SG>'.                                              
               'YEO_SIEW_GUAT@HDB.GOV.SG>'.                                     
      *    05  FILLER          PIC X(59)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6D.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
      *        'TH1@HDB.GOV.SG>'.                                               
      *        'LAU_HONG_HUAT@HDB.GOV.SG>'.                                     
               'Iris_LL_KOR@hdb.gov.sg>'.                                       
      *    05  FILLER          PIC X(61)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6E.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
      *        'LKH2@HDB.GOV.SG>'.                                              
               'KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.                          
      *    05  FILLER          PIC X(59)  VALUE SPACES.                         
                                                                                
       01  MAIL-SUBJ.                                                           
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  MAIL-SUBJECT    PIC X(39)  VALUE                                 
               'MONTHLY MONITORING  FOR HLE DEFER'.                             
           05  FILLER          PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DETAIL1           PIC X(80)  VALUE SPACES.                      
       01  MAIL-DETAIL2           PIC X(80)  VALUE SPACES.                      
       01  MAIL-DETAIL3           PIC X(80)  VALUE SPACES.                      
                                                                                
       01  MAIL-PERIOD            PIC X(80)  VALUE '.'.                         
                                                                                
       01  MAIL-SPACES.                                                         
           05 FILLER                   PIC X(80)  VALUE SPACES.                 
                                                                                
      *-------------------------------------------------------------            
      * REPORT LAYOUT                                                           
      *-------------------------------------------------------------            
       01  LF82-HD1.                                                            
           05  LF82-RPT-NAME              PIC X(10)   VALUE 'P13LF82A'.         
           05  FILLER                     PIC X(05)   VALUE                     
               'HDB3 '.                                                         
           05  FILLER                     PIC X(05)   VALUE SPACES.             
           05  FILLER                     PIC X(38)   VALUE                     
               'CASES WITH HLE DEF DATE OR HLE DEF TAG'.                        
           05  FILLER                     PIC X(05)   VALUE SPACES.             
           05  FILLER                     PIC X(07)   VALUE                     
               'DATE : '.                                                       
           05  LF82-DATE                  PIC X(10)   VALUE SPACES.             
                                                                                
       01  LF82-HD2.                                                            
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(08)   VALUE                     
               'REGN NO.'.                                                      
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(05)   VALUE                     
               'CSM '.                                                          
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(11)   VALUE                     
               'HLE DEF DTE'.                                                   
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(11)   VALUE                     
               'HLE DEF TAG'.                                                   
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(11)   VALUE                     
               'HLE EXP DTE'.                                                   
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(10)   VALUE                     
               'SOCA DTE'.                                                      
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(08)   VALUE                     
               'LOAN TAG'.                                                      
                                                                                
       01  LF82-DETAIL.                                                         
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-REGN                  PIC X(08)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-CSM                   PIC X(05)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-HLE-DEF-DATE          PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-HLE-DEF-TAG           PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-HLA-EXPIRY            PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-SOCA-DATE             PIC X(10)   VALUE SPACES.             
           05  FILLER                     PIC X(02)   VALUE SPACES.             
           05  LF82-LOAN-TAG              PIC X(08)   VALUE SPACES.             
                                                                                
       01  LF82-TRLR.                                                           
           05  FILLER                     PIC X(10)   VALUE SPACES.             
           05  FILLER                     PIC X(56)   VALUE                     
               '******************* END OF REPORT *******************'.         
                                                                                
       01  WS-DASH-LINE                   PIC X(132)  VALUE ALL '-'.            
       01  WS-BLANK-LINE                  PIC X(132)  VALUE ALL SPACES.         
                                                                                
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
            PERFORM 1000-OPEN-ROUTINE     THRU 1000-EXIT.                       
            PERFORM 2100-CHECK-DATE-MONTH THRU 2100-EXIT.                       
            PERFORM 2110-CHECK-DATE-DAY   THRU 2110-EXIT.                       
            PERFORM 2000-READ-BP13F800    THRU 2000-EXIT.                       
            PERFORM 3000-PROCESS-DETAIL   THRU 3000-EXIT                        
                    UNTIL WS-F800-EOF = 'Y'.                                    
            PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT.                       
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-ROUTINE.                                                       
      *-------------------------------------------------------------            
            OPEN  INPUT  BP13F800                                               
                         BP13K022                                               
                         BM06K100                                               
                         BM06K110                                               
                         BP27K800                                               
                  OUTPUT BP13LF82.                                              
                                                                                
           IF BP13K022-STATUS  NOT =  00 AND 97                                 
              DISPLAY 'ERROR OPENING - BP13K022 : ' BP13K022-STATUS             
              MOVE     BP13K022-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BM06K100-STATUS  NOT =  00 AND 97                                 
              DISPLAY 'ERROR OPENING - BM06K100 : ' BM06K100-STATUS             
              MOVE     BM06K100-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BM06K110-STATUS  NOT =  00 AND 97                                 
              DISPLAY 'ERROR OPENING - BM06K110 : ' BM06K110-STATUS             
              MOVE     BM06K110-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP27K800-STATUS  NOT =  00 AND 97                                 
              DISPLAY 'ERROR OPENING - BP27K800 : ' BP27K800-STATUS             
              MOVE     BP27K800-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13F800.                                                      
      *-------------------------------------------------------------            
            READ BP13F800                                                       
                 AT END MOVE 'Y' TO WS-F800-EOF                                 
                 GO TO 2000-EXIT.                                               
                                                                                
            ADD 1   TO WS-F800-READ.                                            
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2100-CHECK-DATE-MONTH.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE FUNCTION CURRENT-DATE TO    WS-CURRENT-DATE.                    
           STRING WS-CURRENT-DATE(7:2)  '/'                                     
                  WS-CURRENT-DATE(5:2)  '/'                                     
                  WS-CURRENT-DATE(1:4) DELIMITED BY SIZE INTO                   
                  LF82-DATE.                                                    
                                                                                
           MOVE WS-CURRENT-DATE       TO DATE-REC                               
           MOVE ZEROS            TO WS-NUM-FIELD.                       02570036
           ADD  3                TO CAL-MONTH.                          02610036
                                                                        02620001
           PERFORM 2200-PROCESS-DATE  THRU 2200-EXIT.                   02630001
           MOVE DATE-REC         TO WS-DATE-TAG.                                
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2110-CHECK-DATE-DAY.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE FUNCTION CURRENT-DATE TO    WS-CURRENT-DATE.                    
           MOVE WS-CURRENT-DATE       TO DATE-REC                               
           MOVE ZEROS            TO WS-NUM-FIELD.                       02570036
           ADD  42               TO CAL-DAY.                            02610036
                                                                        02620001
           PERFORM 2200-PROCESS-DATE  THRU 2200-EXIT.                   02630001
           MOVE DATE-REC         TO WS-DATE-DEF.                                
                                                                                
       2110-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2200-PROCESS-DATE.                                                       
      *-------------------------------------------------------------            
                                                                                
           IF 31-DAY-MONTH                                              02740001
               IF CAL-DAY > 31                                          02750002
               COMPUTE CAL-DAY    = CAL-DAY    - 31                     02760001
               COMPUTE CAL-MONTH  = CAL-MONTH  + 1                      02770002
               END-IF                                                   02771002
           END-IF.                                                      02772002
                                                                        02780001
           IF 30-DAY-MONTH                                              02790001
               IF CAL-DAY > 30                                          02800002
               COMPUTE CAL-DAY    = CAL-DAY    - 30                     02810001
               COMPUTE CAL-MONTH  = CAL-MONTH  + 1                      02820002
               END-IF                                                   02821002
           END-IF.                                                      02822002
                                                                        02830001
           IF 28-29-DAY-MONTH                                           02840001
               IF  CAL-DAY < 29                                         02850002
                   GO TO 2200-EXIT                                      02860001
               ELSE                                                     02870001
                   PERFORM 2300-FEBRUARY                                02880001
                      THRU 2300-EXIT                                    02890001
               END-IF                                                   02891002
           END-IF.                                                      02892002
                                                                        02910001
           IF CAL-MONTH  > 12                                           02920001
              COMPUTE WS-MONTH = WS-MONTH - 12                                  
              MOVE WS-MONTH TO CAL-MONTH                                02930001
              ADD 01 TO CAL-YEAR.                                       02940001
                                                                        02950001
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2300-FEBRUARY.                                                   03160001
      *-------------------------------------------------------------            
                                                                                
           DIVIDE 4 INTO CAL-YEAR GIVING WS-YEAR REMAINDER WS-REM.      03180001
           IF (WS-REM = ZERO) AND (CAL-DAY > 29)                        03190002
              COMPUTE CAL-DAY = CAL-DAY - 29                            03210001
              MOVE 03 TO CAL-MONTH                                      03220001
           ELSE                                                         03230001
           IF (WS-REM NOT = ZERO) AND (CAL-DAY > 28)                    03250002
              COMPUTE CAL-DAY = CAL-DAY - 28                            03270001
              MOVE 03 TO CAL-MONTH.                                     03280001
                                                                        03290001
       2300-EXIT.                                                       03300001
           EXIT.                                                        03310001
                                                                        03320001
      *-------------------------------------------------------------            
       3000-PROCESS-DETAIL.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES               TO LF82-DETAIL.                            
           IF F800-NUM-HLE-DEFER-TAG NOT = 'Y'                                  
             IF WS-DATE-DEF >=  F800-DTE-HLE-DEFERMENT                          
                CONTINUE                                                        
             ELSE                                                               
                ADD 1 TO WS-BYPASS                                              
                PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                      
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           ELSE                                                                 
              PERFORM 4100-READ-BM06K110 THRU 4100-EXIT                         
              PERFORM 4200-READ-BM06K100 THRU 4200-EXIT                         
              IF WS-DATE-TAG >=  K100-DTE-PACD                                  
                IF  K100-DTE-PACD = ZEROES OR SPACES OR LOW-VALUES              
                  ADD 1 TO WS-BYPASS                                            
                  PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                    
                  GO TO 3000-EXIT                                               
                ELSE                                                            
                  CONTINUE                                                      
                END-IF                                                          
             ELSE                                                               
                ADD 1 TO WS-BYPASS                                              
                PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                      
                GO TO 3000-EXIT                                                 
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF F800-NUM-LOAN-TAG = 'B'                                           
              ADD 1 TO WS-BYPASS-LN-TAG-B                                       
              PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                        
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F800-DTE-CANCEL NOT = SPACES AND LOW-VALUES AND ZEROES            
              ADD 1 TO WS-BYPASS-CANCELLED                                      
              PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                        
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           PERFORM 4000-READ-BP13K022     THRU 4000-EXIT.                       
           PERFORM 4300-READ-BP27K800     THRU 4300-EXIT.                       
                                                                                
           IF K800-DTE-HLA-EXPIRY           = SPACES OR LOW-VALUES              
              MOVE SPACES              TO LF82-HLA-EXPIRY                       
           ELSE                                                                 
              ADD 1 TO WS-BYPASS-WITH-HLE-EXP                                   
              PERFORM 2000-READ-BP13F800  THRU 2000-EXIT                        
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-REGN          TO LF82-REGN.                            
           MOVE K022-NUM-OIC           TO LF82-CSM                              
           MOVE F800-NUM-LOAN-TAG      TO LF82-LOAN-TAG                         
           MOVE F800-NUM-HLE-DEFER-TAG TO LF82-HLE-DEF-TAG                      
      *    STRING K022-NUM-OIC '@HDB.GOV.SG>' DELIMITED BY SPACE                
      *           INTO MAIL-TO.                                                 
                                                                                
      *    STRING K022-NUM-OIC '@HDB.GOV.SG>' DELIMITED BY SPACE                
      *           INTO MAIL-TO1.                                                
                                                                                
           IF F800-DTE-PRINCIPAL-SALES-AGMT = SPACES OR LOW-VALUES              
              MOVE SPACES              TO LF82-SOCA-DATE                        
           ELSE                                                                 
              STRING F800-DTE-PRINCIPAL-SALES-AGMT(7:2) '/'                     
                     F800-DTE-PRINCIPAL-SALES-AGMT(5:2) '/'                     
                     F800-DTE-PRINCIPAL-SALES-AGMT(1:4)                         
              DELIMITED BY SIZE INTO LF82-SOCA-DATE                             
           END-IF.                                                              
                                                                                
           PERFORM 5000-OUTPUT-REPORT   THRU 5000-EXIT.                         
                                                                                
           PERFORM 2000-READ-BP13F800  THRU 2000-EXIT.                          
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       4000-READ-BP13K022.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES           TO  BP13K022-REC.                              
           MOVE F800-NUM-REGN    TO  K022-NUM-REGN.                             
                                                                                
           READ BP13K022  KEY IS K022-NUM-REGN.                                 
                                                                                
           EVALUATE BP13K022-STATUS                                             
             WHEN 00                                                            
                 MOVE SPACES           TO WS-BP13CCNT-LINK                      
                 INITIALIZE               WS-BP13CCNT-LINK                      
                 MOVE 'EML'            TO LINK-CNTCT-TYPE                       
                 MOVE K022-NUM-OIC     TO LINK-STAFF-NICK                       
                 MOVE SPACES           TO LINK-STAFF-NUM                        
                                                                                
                 PERFORM 4400-CALL-BP13CCNT THRU 4400-EXIT                      
             WHEN 23                                                            
                 CONTINUE                                                       
             WHEN OTHER                                                         
              DISPLAY 'ERROR READING - BP13K022 : ' BP13K022-STATUS             
              MOVE     BP13K022-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4100-READ-BM06K110.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES           TO  K110-REC.                                  
           MOVE F800-NUM-REGN    TO  K110-REGN-NO.                              
                                                                                
           READ BM06K110  KEY IS K110-REGN-NO.                                  
                                                                                
           EVALUATE BM06K110-STATUS                                             
             WHEN 00                                                            
                 ADD 1 TO WS-K110-FND                                           
             WHEN 23                                                            
                 ADD 1 TO WS-K110-NFND                                          
             WHEN OTHER                                                         
              DISPLAY 'ERROR READING - BM06K110 : ' BM06K110-STATUS             
              MOVE     BM06K110-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4200-READ-BM06K100.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES           TO  K100-REC.                                  
           MOVE K110-AIX1        TO  K100-KEY-FLD.                              
                                                                                
           READ BM06K100.                                                       
                                                                                
           EVALUATE BM06K100-STATUS                                             
             WHEN 00                                                            
                 ADD 1 TO WS-K100-FND                                           
             WHEN 23                                                            
                 ADD 1 TO WS-K100-NFND                                          
             WHEN OTHER                                                         
              DISPLAY 'ERROR READING - BM06K100 : ' BM06K100-STATUS             
              MOVE     BM06K100-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4300-READ-BP27K800.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES           TO  BP27K800-MASTER.                           
           MOVE F800-NUM-HLA     TO  K800-NUM-HLA.                              
                                                                                
           READ BP27K800.                                                       
                                                                                
           EVALUATE BP27K800-STATUS                                             
             WHEN 00                                                            
                 ADD 1 TO WS-K800-FND                                           
             WHEN 23                                                            
                 ADD 1 TO WS-K800-NFND                                          
             WHEN OTHER                                                         
              DISPLAY 'ERROR READING - BP27K800 : ' BP27K800-STATUS             
              MOVE     BP27K800-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       4400-CALL-BP13CCNT.                                                      
      *----------------------------------------------------------------*        
           CALL 'BP13CCNT' USING WS-BP13CCNT-LINK.                              
                                                                                
           EVALUATE LINK-SYSERR                                                 
              WHEN ZEROS                                                        
                 STRING LINK-STAFF-CNTCT DELIMITED BY SPACE                     
                        '>' DELIMITED BY SIZE                                   
                        INTO MAIL-TO                                            
                 STRING LINK-STAFF-CNTCT DELIMITED BY SPACE                     
                        '>' DELIMITED BY SIZE                                   
                        INTO MAIL-TO1                                           
              WHEN 100                                                          
                 DISPLAY 'OIC NOT FOUND IN OFFICE_CNTCT TABLE - '               
                     K022-NUM-OIC       ' REGN : ' F800-NUM-REGN                
                 MOVE SPACES              TO MAIL-TO                            
                                             MAIL-TO1                           
              WHEN OTHER                                                        
                 MOVE '98'                  TO RETURN-CODE                      
                 DISPLAY 'ERROR READING OFFICE_CNTCT TABLE = '                  
                          LINK-SYSERR                                           
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5000-OUTPUT-REPORT.                                                      
      *-------------------------------------------------------------            
                                                                                
           WRITE LF82-PRTREC           FROM MAIL-HDR1.                          
           WRITE LF82-PRTREC           FROM MAIL-HDR2.                          
           WRITE LF82-PRTREC           FROM MAIL-DTL2.                          
      *    WRITE LF82-PRTREC           FROM MAIL-DTL2C.                         
           WRITE LF82-PRTREC           FROM MAIL-DTL2D.                         
           WRITE LF82-PRTREC           FROM MAIL-DTL2E.                         
           WRITE LF82-PRTREC           FROM MAIL-DTL3.                          
           WRITE LF82-PRTREC           FROM MAIL-DTL4.                          
           WRITE LF82-PRTREC           FROM MAIL-DTL6.                          
      *    WRITE LF82-PRTREC           FROM MAIL-DTL6C.                         
           WRITE LF82-PRTREC           FROM MAIL-DTL6D.                         
           WRITE LF82-PRTREC           FROM MAIL-DTL6E.                         
           WRITE LF82-PRTREC           FROM MAIL-SUBJ.                          
           WRITE LF82-PRTREC           FROM MAIL-SPACES.                        
                                                                                
           PERFORM 5100-PRINT-HEADER   THRU 5100-EXIT.                          
           WRITE LF82-PRTREC           FROM LF82-DETAIL.                        
           WRITE LF82-PRTREC           FROM MAIL-PERIOD.                        
           ADD  50 TO WS-LINE-CTR.                                              
                                                                                
           ADD   1 TO WS-WRT-LF82.                                              
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       5100-PRINT-HEADER.                                                       
      *-------------------------------------------------------------            
           IF WS-LINE-CTR > 50                                                  
             ADD 1                    TO WS-PAGE-CTR                            
             WRITE LF82-PRTREC      FROM LF82-HD1                               
             WRITE LF82-PRTREC      FROM LF82-HD2                               
             MOVE SPACES   TO            LF82-PRTREC                            
             WRITE LF82-PRTREC                                                  
             MOVE 4                   TO WS-LINE-CTR                            
           END-IF.                                                              
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
            DISPLAY ' '.                                                        
            DISPLAY '- BP13CF82 CONTROL LIST --'                                
            DISPLAY '---------------------------------------------'.            
            DISPLAY ' 1) TOT BP13F800 READ    : ' WS-F800-READ.                 
            DISPLAY ' 2) TOT RECORD WRITTEN   : ' WS-WRT-LF82.                  
            DISPLAY ' 3) TOT RECORD BYPASS    : ' WS-BYPASS.                    
            DISPLAY ' 4) REC WITH HLE EPX     : ' WS-BYPASS-WITH-HLE-EXP        
            DISPLAY ' 5) REC WITH LOAN TAG B  : ' WS-BYPASS-LN-TAG-B            
            DISPLAY ' 6) REC CANCELLED CASES  : ' WS-BYPASS-CANCELLED.          
            DISPLAY ' '.                                                        
                                                                                
            CLOSE  BP13F800                                                     
                   BP13K022                                                     
                   BM06K110                                                     
                   BM06K100                                                     
                   BP13LF82.                                                    
                                                                                
           IF BP13K022-STATUS  NOT =  00 AND 97                                 
              DISPLAY 'ERROR OPENING - BP13K022 : ' BP13K022-STATUS             
              MOVE     BP13K022-STATUS      TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
                                                                                
            STOP RUN.                                                           
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
