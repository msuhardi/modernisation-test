       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C776.                                                 
      *AUTHOR.        JK.                                                       
      *DATE-WRITTEN.  24/02/1993.                                               
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE    :                                            *            
      *    1.  PRINT CANCELLATION LETTERS TO APPLICANTS WHO        *            
      *        FAILED TO BOOK A FLAT AFTER ALLOCATED TIME.         *            
      *    2.  CONTROL LIST OF CANCELLATION LETTERS PRINTED        *            
      *    3.  PRINT BE / BTO CANCELLATION LETTER.                 *            
      *                                                            *            
      *  INPUT FILES :                                             *            
      *    1. BP13F310  :  CANCEL FILE (TRANSACTION)               *            
      *    2. BP13K830  :  ADDRESS FILE                            *            
      *    3. BP13K800  :  SOC MASTER FILE                         *            
      *    4. BP13K820  :  OCCUPIER FILE                           *            
      *    5. BP13K060  :  SOC CODE TABLE                          *            
      *    5. BP13K062  :  SOC CODE TABLE                          *            
      *                                                            *            
      *  LISTINGS:                                                 *            
      *    1. BP13P776 - LETTER FOR BTO REOPT NOT = '2A'           *            
      *    2. P13P776B - LETTER FOR BE                             *            
      *    3. P13P776C - LETTER FOR BTO REOPT = '2A'               *            
      *    4. BP13L776 - LIST OF CANCELLATION LETTER PRINTED       *            
      *                                                            *            
      * CHG REF  BY   ON       DESCRIPTION                         *            
      * -------- ---- -------- -----------                         *            
      * C930144  JK   24/03/93                                     *            
      * N930012  JAO  28/06/93 SOC PH8 - COBOL 2                   *            
      * C9309A1  JEP  25/10/93 CHECK FOR FOREIGN ADDRESS           *            
      * N940006  JEP    /01/94 RECOMPILE DUE TO SOC PH8            *            
      * C940936  GG   13/09/94 REFORMAT CANCEL LETTER AND DELETE   *            
      *                        ALL ACCESS TO BP13K542              *            
      * C9504B5  EG1  22/05/95 CHG INPUT FROM K548 TO F200 & F205  *            
      * C9504B5  LMS  13/07/95 CHECK DTE-BALLOT BEFORE CANCEL      *            
      * BP130109 LSB  20/05/96 CHECK EXEC-CNDO-TAG                 *            
      * BP130330 LMS  25/06/97 CATER FOR JB IN SERS                *            
      * BP130418 MPA  21/04/98 CATER FOR Y2K                       *            
      * BP130618 SRN  13/01/99 READ BP13K555 FOR OIC NAME          *            
      * BP130677 GV   22/06/99 READ BP13F310 INSTEAD OF MATCHING   *            
      *                        BP13F200 AND F205                   *            
      * BP130768 SSS  02/02/00 PRINT NEW LETTER                    *            
      * BP131059 JAM  25/08/01 PRINT NEW LETTER, BP13B2            *            
      * BP132045 LITO 25/08/01 PRINT DESIGNATION OF OIC IN BP13G2  *            
      * BP132107 SSS  02/03/02 REMOVE BP13G8                       *            
      * BP132160 SN   23/08/02 REMOVE BP13G1,BP13G2,BP13G9         *            
      * BP132293 JF4  30/01/03 PRINT 'BE' CANCELLATION LETTER      *            
      * BP132331 JF4  25/03/03 CHG BTO CANCELLATION LETTER         *            
      * BP132392 JF4  05/09/03 PRINT 'BE' CANCELLATION LETTER      *            
      *                        FOR DID NOT COME/DID NOT SELECT     *            
      *                        AND ETHNIC FULL CASES.              *            
      * BP132432 MTD  03/12/03 ADD BTO CANCELLATION LETTER         *            
      * BP132463 JF4  26/02/04 CHG FOR CANCELLATION LETTER         *            
      * BP132455 SSS2 25/03/04 CHG FOR BTO CANCELLATION LETTER     *            
      * BP132648 SSS2 16/02/05 INCL STUDIO APT FOR BE CANCEL LTR   *            
      * BP132681 SSS2 06/04/05 CATER FOR DEC 2004 BTO CANCEL LTR   *            
      * BP132716 SSS2 01/07/06 CATER FOR MAR 2005 BTO CANCEL LTR   *            
      * BP132708 GAN1 07/09/05 USE OF SERS TABLE (SERSCH)          *            
      * BP132997 SSS  05/02/07 FOR AUG 06 BE CANCELLATION          *            
      * BP133085 SSS  24/07/07 REMOVE OBSOLETE FORM                *            
      * BP133135 SSS  03/09/07 ADD DESC FOR 2-ROOM                 *            
      * BP133262 RB12 22/02/08 ADD DTE BALLOT & PROJ NAME          *            
      * BP133610 ESA1 11/05/09 TO REPLACE BP13K767 W/ BP13K816     *            
      * BP134681 IMC1 24/09/12 CATER TO '91' K060-SERIAL-NO        *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13F310  ASSIGN  TO  BP13F310.                               
                                                                                
           SELECT BP13K830  ASSIGN  TO  BP13K830                                
                  ACCESS       IS RANDOM                                        
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K830-KEY-FLD                                  
                  ALTERNATE RECORD KEY IS K830-NUM-REGN                         
                  FILE STATUS  IS WS-K830-STATUS.                               
                                                                                
           SELECT BP13K800  ASSIGN  TO  BP13K800                                
                  ACCESS       IS DYNAMIC                                       
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K800-NUM-REGN                                 
                  FILE STATUS  IS WS-K800-STATUS.                               
                                                                                
           SELECT BP13K820  ASSIGN  TO  BP13K820                                
                  ACCESS       IS DYNAMIC                                       
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K820-KEY-FLD                                  
                  FILE STATUS  IS WS-K820-STATUS.                               
                                                                                
           SELECT BP13K060  ASSIGN  TO  BP13K060                                
                  ACCESS       IS DYNAMIC                                       
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K060-KEY-FLD                                  
                  FILE STATUS  IS WS-K060-STATUS.                               
                                                                                
           SELECT BP13K062  ASSIGN  TO  BP13K062                                
                  ACCESS       IS RANDOM                                        
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K062-KEY-FLD                                  
                  FILE STATUS  IS WS-K062-STATUS.                               
                                                                                
           SELECT BP13K555  ASSIGN  TO  BP13K555                                
                  ACCESS       IS RANDOM                                        
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY   IS K555-KEY-FLD                                  
                  FILE STATUS  IS WS-K555-STATUS.                               
                                                                                
           SELECT BP13P776  ASSIGN  TO  BP13P776.                               
           SELECT P13P776B  ASSIGN  TO  P13P776B.                               
           SELECT P13P776C  ASSIGN  TO  P13P776C.                               
           SELECT BP13L776  ASSIGN  TO  BP13L776.                               
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD  BP13F310                                                             
           BLOCK  CONTAINS   0 RECORDS                                          
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL  RECORDS  ARE STANDARD                                         
           RECORDING MODE IS F.                                                 
       COPY BP13F310.                                                           
                                                                                
       FD  BP13K830                                                             
           RECORD CONTAINS 250 CHARACTERS.                                      
       COPY BP13K830.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
       COPY BP13K820.                                                           
                                                                                
       FD  BP13K060                                                             
           RECORD CONTAINS 25 CHARACTERS.                                       
       COPY BP13K060.                                                           
                                                                                
       FD  BP13K062                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13K062.                                                           
                                                                                
       FD  BP13K555                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K555.                                                           
                                                                                
       FD  BP13P776                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P776-PRTREC                 PIC X(132).                              
                                                                                
       FD  P13P776B                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P776B-PRTREC                PIC X(132).                              
                                                                                
       FD  P13P776C                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P776C-PRTREC                PIC X(132).                              
                                                                                
       FD  BP13L776                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  L776-PRTREC                 PIC X(132).                              
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  FILE-STATUS.                                                         
           03  WS-K800-STATUS             PIC 9(2)   VALUE 0.                   
           03  WS-K820-STATUS             PIC 9(2)   VALUE 0.                   
           03  WS-K060-STATUS             PIC 9(2)   VALUE 0.                   
           03  WS-K062-STATUS             PIC 9(2)   VALUE 0.                   
           03  WS-K830-STATUS             PIC 9(2)   VALUE 0.                   
           03  WS-K555-STATUS             PIC 9(2)   VALUE 0.                   
                                                                                
       01  WS-ACCUMULATORS.                                                     
           03  WS-K800-READ               PIC 9(5)    VALUE ZERO.               
           03  WS-NUM-MISS                PIC 9(5)    VALUE ZERO.               
           03  WS-F310-READ               PIC 9(5)    VALUE ZERO.               
           03  WS-K555-READ               PIC 9(5)    VALUE ZERO.               
           03  WS-BTO-PRTED               PIC 9(4)    VALUE ZERO.               
           03  WS-TOTAL-PRTED             PIC 9(4)    VALUE ZERO.               
           03  WS-BE-LTR8-PRINT           PIC 9(4)    VALUE ZERO.               
           03  WS-BE-LTR9-PRINT           PIC 9(4)    VALUE ZERO.               
           03  WS-BE-LTRN-PRINT           PIC 9(4)    VALUE ZERO.               
           03  WS-NUM-LINE-L776           PIC 9(2)    VALUE 60.                 
           03  WS-NUM-PAGE-L776           PIC 9(4)    VALUE ZERO.               
                                                                                
       01  SW-SERS-ALLO-SCHEME            PIC X(01)   VALUE SPACE.              
           88  C-SERS-ALLO-SCHEME         VALUE 'Y'.                            
                                                                                
       01  WS-SWITCHES.                                                         
           03  K800-FOUND                 PIC X VALUE 'N'.                      
           03  EOF-F310                   PIC X VALUE 'N'.                      
                                                                                
       01  WS-NAME                        PIC X(66)  VALUE SPACES.              
       01  WS-DATE                        PIC X(8)   VALUE SPACES.              
       01  WS-TMP-ZONE                    PIC X(20)  VALUE SPACES.              
                                                                                
       01  WS-DTE-LETTER.                                                       
           05  WS-YY                      PIC 9(4).                             
           05  WS-MM                      PIC 9(2).                             
           05  WS-DD                      PIC 9(2).                             
       01  WS-DTE-LETTER-9 REDEFINES WS-DTE-LETTER PIC 9(8).                    
                                                                                
       01  WS-DTE-APPT.                                                         
           03  WS-DTE-CC                  PIC XX.                               
           03  WS-DTE-YY                  PIC XX.                               
           03  WS-DTE-MM                  PIC XX.                               
           03  WS-DTE-DD                  PIC XX.                               
                                                                                
       01  WS-TME-APPT.                                                         
           03  WS-TME-HH                  PIC XX.                               
           03  WS-TME-MIN                 PIC XX.                               
                                                                                
       01  WS-ADDR-LINE1.                                                       
           03  WS-BLK-NO.                                                       
               05  WS-BLK-HDER            PIC X(4).                             
               05  WS-BLK-NUM             PIC X(4).                             
               05  WS-BLK-FILR            PIC X(1).                             
               05  WS-BLK-NUMX            PIC X(1).                             
           03  FILLER                     PIC X(6).                             
                                                                                
       01  WS-ADDR-LINE2.                                                       
           03  WS-STREET-NAME             PIC X(29).                            
           03  WS-CHAR                    PIC X(1).                             
           03  WS-LEVEL                   PIC X(2).                             
           03  WS-DASH                    PIC X(1).                             
           03  WS-HSE-NO                  PIC X(7).                             
                                                                                
       01  WS-ADDR-LINE2-R REDEFINES WS-ADDR-LINE2.                             
           03  WS-NME-STREET              PIC X(29).                            
           03  WS-NUM-FLAT.                                                     
               05  WS-NUM-LEVEL           PIC X(4).                             
               05  WS-NUM-UNIT            PIC X(7).                             
                                                                                
       01  WS-POST-CODE                   PIC X(6)   VALUE SPACES.              
       01  WS-COMP-TME                    PIC 9(2).                             
                                                                                
       01  WS-SELECT-ROOM                 PIC X(16)  VALUE SPACES.              
       01  WS-NEW-TOWN                    PIC X(20)  VALUE SPACES.              
       01  WS-BALLOT-MONTH                PIC X(3)   VALUE SPACES.              
                                                                                
      *------------------------------------------------------------*            
      *  SEND DJDE LINE TO CHANGE FORM                             *            
      *------------------------------------------------------------*            
       01  DJDE-FORM-BP13T8               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13T8,END;'.                                          
       01  DJDE-FORM-BP13T9               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13T9,END;'.                                          
       01  DJDE-FORM-BP13TN               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13TN,END;'.                                          
       01  DJDE-FORM-BP13PX               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13PX,END;'.                                          
       01  DJDE-FORM-BP13PZ               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13PZ,END;'.                                          
       01  DJDE-FORM-BP13P4               PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP13P4,END;'.                                          
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT FOR SUCCESSFUL LETTER                                            
      *-------------------------------------------------------------            
       01  P776-LINE-REGN.                                                      
           03  FILLER              PIC X(71) VALUE SPACES.                      
           03  P776-REGN-NO        PIC X(08) VALUE SPACES.                      
           03  FILLER              PIC X(10) VALUE SPACES.                      
                                                                                
       01  P776-LINE-REGN2.                                                     
           03  FILLER              PIC X(65) VALUE SPACES.                      
           03  P776-NUM-ZONE       PIC X(3)  VALUE SPACES.                      
           03  FILLER              PIC X     VALUE '/'.                         
           03  P776-FT             PIC X(2)  VALUE SPACES.                      
           03  FILLER              PIC X     VALUE '/'.                         
           03  P776-REGN-NO2       PIC X(8)  VALUE SPACES.                      
                                                                                
       01  P776-LINE-DATE.                                                      
           03  FILLER              PIC X(71) VALUE SPACES.                      
           03  P776-DATE           PIC X(10) VALUE SPACES.                      
                                                                                
       01  P776-LINE-DATE2.                                                     
           03  FILLER              PIC X(65) VALUE SPACES.                      
           03  P776-DATE2          PIC X(10) VALUE SPACES.                      
                                                                                
       01  P776-LINE-NAME1.                                                     
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  P776-NAME1          PIC X(50) VALUE SPACES.                      
                                                                                
       01  P776-LINE-NAME2.                                                     
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  P776-NAME2          PIC X(50) VALUE SPACES.                      
                                                                                
       01  P776-LINE-BLK-UNIT.                                                  
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  P776-LN4-BLK        PIC X(10) VALUE SPACES.                      
           03  FILLER              PIC X(01) VALUE SPACES.                      
           03  P776-LN4-UNIT       PIC X(11) VALUE SPACES.                      
           03  FILLER              PIC X(48) VALUE SPACES.                      
                                                                                
       01  P776-LINE-ADDR2.                                                     
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  P776-LN5-ADDR2      PIC X(29) VALUE SPACES.                      
           03  FILLER              PIC X(41) VALUE SPACES.                      
                                                                                
       01  P776-LINE-ADDR3.                                                     
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  P776-LN6-ADDR3      PIC X(20) VALUE SPACES.                      
           03  FILLER              PIC X(50) VALUE SPACES.                      
                                                                                
       01  P776-LINE-PC.                                                        
           03  FILLER              PIC X(10) VALUE SPACES.                      
           03  P776-BAR-CODE       PIC X(9)  VALUE SPACES.                      
                                                                                
       01  P776-LINE-FLAT-SOF.                                                  
           03  FILLER              PIC X(35) VALUE SPACES.                      
           03  P776-FLAT-SOF       PIC X(06) VALUE SPACES.                      
                                                                                
       01  P776-LINE-FLAT-BS.                                                   
           03  FILLER              PIC X(61) VALUE SPACES.                      
           03  P776-FLAT-BS        PIC X(6)  VALUE SPACES.                      
                                                                                
       01  P776-LINE-FLAT-BTO.                                                  
           03  FILLER              PIC X(31) VALUE SPACES.                      
           03  P776-FLAT-BTO       PIC X(06) VALUE SPACES.                      
           03  FILLER              PIC X(08) VALUE SPACES.                      
           03  P776-BTO-SITE       PIC X(20) VALUE SPACES.                      
                                                                                
       01  P776-LINE-QTR-BS.                                                    
           03  FILLER              PIC X(12) VALUE SPACES.                      
           03  P776-NEW-TOWN       PIC X(20) VALUE SPACES.                      
           03  FILLER              PIC X(21) VALUE SPACES.                      
           03  P776-QTR-BS         PIC X(3)  VALUE SPACES.                      
           03  FILLER              PIC X(09) VALUE ' QUARTER '.                 
           03  P776-QTRYY-BS       PIC X(04) VALUE SPACES.                      
                                                                                
       01  P776-LINE-APPT.                                                      
           03  FILLER              PIC X(14) VALUE SPACES.                      
           03  P776-APPT-DATE.                                                  
               05  P776-APPT-DD    PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE '/'.                         
               05  P776-APPT-MM    PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE '/'.                         
               05  P776-APPT-CC    PIC X(2)  VALUE SPACES.                      
               05  P776-APPT-YY    PIC X(2)  VALUE SPACES.                      
           03  FILLER              PIC X(9)  VALUE SPACES.                      
           03  P776-APPT-TIME.                                                  
               05  P776-APPT-HH    PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE ':'.                         
               05  P776-APPT-MIN   PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE SPACE.                       
               05  P776-APPT-AM-PM PIC X(2)  VALUE SPACES.                      
                                                                                
       01  P776-LINE-APPT2.                                                     
           03  FILLER              PIC X(57) VALUE SPACES.                      
           03  P776-APPT-DATE2.                                                 
               05  P776-APPT-DD2   PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE '/'.                         
               05  P776-APPT-MM2   PIC X(2)  VALUE SPACES.                      
               05  FILLER          PIC X     VALUE '/'.                         
               05  P776-APPT-CC2   PIC X(2)  VALUE SPACES.                      
               05  P776-APPT-YY2   PIC X(2)  VALUE SPACES.                      
           03  FILLER              PIC X(4)  VALUE SPACES.                      
                                                                                
       01  P776-LINE-APPT3.                                                     
           03  P776-APPT-TIME2.                                                 
               05  FILLER           PIC X(8) VALUE SPACES.                      
               05  P776-APPT-HH2    PIC X(2) VALUE SPACES.                      
               05  FILLER           PIC X    VALUE ':'.                         
               05  P776-APPT-MIN2   PIC X(2) VALUE SPACES.                      
               05  FILLER           PIC X    VALUE SPACE.                       
               05  P776-APPT-AM-PM2 PIC X(3) VALUE '  .'.                       
                                                                                
       01  P776-LINE-OIC-NAME.                                                  
           03  FILLER              PIC X(8)  VALUE SPACES.                      
           03  P776-OIC-NAME       PIC X(40) VALUE SPACES.                      
                                                                                
       01  P776-LINE-OIC-DESIG.                                                 
           03  FILLER              PIC X(8)  VALUE SPACES.                      
           03  P776-OIC-DESIG      PIC X(40) VALUE SPACES.                      
                                                                                
       01  P776-LINE-DTE-BALLOT.                                                
           05  FILLER              PIC X(31)  VALUE SPACES.                     
           05  P776-DTE-BALLOT     PIC X(08) VALUE SPACES.                      
                                                                                
       01  P776-LINE-PROJ-NAME.                                                 
           05  FILLER              PIC X(11)  VALUE SPACES.                     
           05  P776-NME-PROJECT    PIC X(30) VALUE SPACES.                      
                                                                                
       01  P776C-LINE-RDATE.                                                    
           03  FILLER              PIC X(65) VALUE SPACES.                      
           03  P776C-DTE-RETURN    PIC X(10) VALUE '10/04/2004'.                
                                                                                
       01  P776C-LINE-RDATE2.                                                   
           03  FILLER              PIC X(27) VALUE SPACES.                      
           03  P776C-DTE-RETURN    PIC X(10) VALUE '10/04/2004'.                
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT FOR 'BE' CANCELLATION LETTER                                     
      *-------------------------------------------------------------            
       01  P776B-LAYOUT.                                                        
                                                                                
        02  P776B-LINE01.                                                       
           05  FILLER                   PIC X(24)  VALUE SPACES.                
           05  P776B-NT                 PIC X(3)   VALUE SPACES.                
           05  P776B-ROOM               PIC X(2)   VALUE SPACES.                
           05  FILLER                   PIC X      VALUE '/'.                   
           05  P776B-REGN-NO            PIC X(8)   VALUE SPACES.                
           05  P776B-ALLOC-SCH          PIC X(7)   VALUE SPACES.                
                                                                                
        02  P776B-LINE02.                                                       
           05  FILLER                   PIC X(16)  VALUE SPACES.                
           05  P776B-DATE               PIC X(10)  VALUE SPACES.                
                                                                                
        02  P776B-LINE03A.                                                      
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-APPLN-NAME         PIC X(66)  VALUE SPACES.                
                                                                                
        02  P776B-LINE03B.                                                      
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-COAPPLN-NAME       PIC X(66)  VALUE SPACES.                
                                                                                
        02  P776B-LINE04A.                                                      
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-BLK-NO             PIC X(10)  VALUE SPACES.                
           05  FILLER                   PIC X(2)   VALUE SPACES.                
           05  P776B-NUM-FLAT           PIC X(15)  VALUE SPACES.                
                                                                                
        02  P776B-LINE04B.                                                      
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-STREET-NAME        PIC X(65)  VALUE SPACES.                
                                                                                
        02  P776B-LINE04C.                                                      
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-POSTALCODE         PIC X(17)  VALUE SPACES.                
                                                                                
        02  P776B-LINE05.                                                       
           05  FILLER                   PIC X(10) VALUE SPACES.                 
           05  P776B-BAR-CODE           PIC X(9)  VALUE SPACES.                 
                                                                                
        02  P776B-LINE06.                                                       
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  P776B-SUBJECT            PIC X(100) VALUE SPACES.                
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT FOR CONTROL LISTING                                              
      *-------------------------------------------------------------            
       01  L776-HDG1.                                                           
           03  FILLER              PIC X(14)   VALUE 'BP13L776'.                
           03  FILLER              PIC X(8)    VALUE 'HDB3'.                    
           03  FILLER              PIC X(18)   VALUE SPACES.                    
           03  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           03  FILLER              PIC X(18)   VALUE SPACES.                    
           03  FILLER              PIC X(7)    VALUE 'DATE : '.                 
           03  L776-DATE           PIC X(10)   VALUE SPACES.                    
                                                                                
       01  L776-HDG2.                                                           
           03  FILLER              PIC X(33) VALUE SPACES.                      
           03  FILLER              PIC X(64) VALUE                              
              'SUMMARY LIST FOR CANCELLATION LETTERS TO APPLICANTS'.            
           03  FILLER              PIC X(7)    VALUE 'PAGE : '.                 
           03  L776-PAGE           PIC ZZZZ9.                                   
                                                                                
       01  L776-HDG3.                                                           
           05  FILLER              PIC X(7)    VALUE '    S/N'.                 
           05  FILLER              PIC X(5)    VALUE SPACES.                    
           05  FILLER              PIC X(9)    VALUE 'NT/ZONE  '.               
           05  FILLER              PIC X(12)   VALUE SPACES.                    
           05  FILLER              PIC X(9)    VALUE 'FLAT TYPE'.               
           05  FILLER              PIC X(2)    VALUE SPACES.                    
           05  FILLER              PIC X(8)    VALUE 'REGN NO '.                
           05  FILLER              PIC X(2)    VALUE SPACES.                    
           05  FILLER              PIC X(5)    VALUE 'QUEUE'.                   
           05  FILLER              PIC X(3)    VALUE SPACES.                    
           05  FILLER              PIC X(19)   VALUE                            
               'NRIC1    / NRIC2'.                                              
           05  FILLER              PIC X(7)    VALUE SPACES.                    
           05  FILLER              PIC X(4)    VALUE 'ZONE'.                    
           05  FILLER              PIC X(5)    VALUE SPACES.                    
           05  FILLER              PIC X(12)   VALUE 'DATE BALLOT'.             
           05  FILLER              PIC X(1)    VALUE SPACES.                    
           05  FILLER              PIC X(10)   VALUE 'ALLOCN TAG'.              
                                                                                
       01  L776-DTL.                                                            
           03  L776-SNO            PIC ZZZZZZ9.                                 
           03  FILLER              PIC X(5)  VALUE SPACES.                      
           03  L776-NT-ZONE        PIC X(20) VALUE SPACES.                      
           03  FILLER              PIC X(6)  VALUE SPACES.                      
           03  L776-FT             PIC X(2)  VALUE SPACES.                      
           03  FILLER              PIC X(4)  VALUE SPACES.                      
           03  L776-REGN           PIC X(8)  VALUE SPACES.                      
           03  FILLER              PIC X(2)  VALUE SPACES.                      
           03  L776-QUEUE          PIC X(5)  VALUE SPACES.                      
           03  FILLER              PIC X(3)  VALUE SPACES.                      
           03  L776-NRIC1          PIC X(9)  VALUE SPACES.                      
           03  FILLER              PIC X(2)  VALUE '/ '.                        
           03  L776-NRIC2          PIC X(9)  VALUE SPACES.                      
           03  FILLER              PIC X(7)  VALUE SPACES.                      
           03  L776-ZONE           PIC X(2)  VALUE SPACES.                      
           03  FILLER              PIC X(7)  VALUE SPACES.                      
           03  L776-DTE-BALLOT     PIC X(6)  VALUE SPACES.                      
           03  FILLER              PIC X(7)  VALUE SPACES.                      
           03  L776-ALLOC-TAG      PIC X(6)  VALUE SPACES.                      
           03  FILLER              PIC X(2)  VALUE SPACES.                      
           03  L776-ETHNIC         PIC X(1)  VALUE SPACES.                      
                                                                                
       COPY SERSCH.                                                             
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR BP13C910, OP13K813, CP13K813                               
      *-------------------------------------------------------------            
       01  WS-LINK-REC.                                                         
           05  WS-LINK-ZONE           PIC X(03).                                
                                                                                
       COPY BP13K813.                                                           
                                                                                
       01  WS-ZONE-FND-FLAG           PIC X(01).                                
       01  WS-RETURN-CODE             PIC 9(02).                                
                                                                                
      *-------------------------------------------------------------            
      *   LINKAGE SECTION FOR AV02C015                                          
      *-------------------------------------------------------------            
       01  WS-LINK-AV02C015.                                                    
           05  AV02C015-IN-POSTCODE             PIC X(6).                       
           05  AV02C015-OUT-POSTCODE-CHKSUM     PIC X(9).                       
                                                                                
       COPY AV02COMM.                                                           
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       000-MAIN-LOGIC.                                                          
      *-------------------------------------------------------------            
           PERFORM 100-OPEN-ROUTINE THRU 100-EXIT.                              
           PERFORM 200-INIT-ROUTINE THRU 200-EXIT.                              
           PERFORM 300-READ-F310    THRU 300-EXIT.                              
           PERFORM 400-PROCESS-ROUTINE THRU 400-EXIT                            
                   UNTIL EOF-F310 = 'Y'.                                        
           PERFORM 900-CLOSE-ROUTINE.                                           
                                                                                
                                                                                
       100-OPEN-ROUTINE.                                                        
      *-------------------------------------------------------------            
           OPEN INPUT BP13F310                                                  
                      BP13K830                                                  
                      BP13K800                                                  
                      BP13K820                                                  
                      BP13K060                                                  
                      BP13K062                                                  
                      BP13K555                                                  
               OUTPUT BP13L776                                                  
                      BP13P776                                                  
                      P13P776B                                                  
                      P13P776C.                                                 
                                                                                
           IF WS-K830-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K830 ERROR ' WS-K830-STATUS                 
              MOVE WS-K830-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           IF WS-K800-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K800  ERROR ' WS-K800-STATUS                
              MOVE WS-K800-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           IF WS-K820-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K820  ERROR ' WS-K820-STATUS                
              MOVE WS-K820-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           IF WS-K060-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K060  ERROR ' WS-K060-STATUS                
              MOVE WS-K060-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           IF WS-K062-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K062  ERROR ' WS-K062-STATUS                
              MOVE WS-K062-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           IF WS-K555-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' OPENING BP13K555  ERROR ' WS-K555-STATUS                
              MOVE WS-K555-STATUS TO RETURN-CODE                                
              PERFORM 900-CLOSE-ROUTINE.                                        
                                                                                
           CALL 'OP13K813' USING WS-RETURN-CODE.                                
           IF WS-RETURN-CODE NOT = ZEROES AND 97                                
              DISPLAY 'OPENING ERROR K813 STATUS IS ' WS-RETURN-CODE            
              MOVE     WS-RETURN-CODE TO RETURN-CODE                            
              PERFORM 900-CLOSE-ROUTINE                                         
           END-IF.                                                              
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       200-INIT-ROUTINE.                                                        
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                               
           PERFORM 250-COMPUTE-LETTER-DATE THRU 250-EXIT.                       
                                                                                
           STRING WS-DD '/' WS-MM '/' WS-YY                                     
                  DELIMITED BY SIZE INTO P776-DATE.                             
           STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)                
                  DELIMITED BY SIZE INTO L776-DATE.                             
                                                                                
           MOVE P776-DATE        TO P776-DATE2.                                 
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *************************************************************             
      *  ROUTINE TO COMPUTE THE DATE OF THE POST-DATED LETTER     *             
      *  IE. 2 DAYS  AFTER THE CURRENT DATE                       *             
      *************************************************************             
       250-COMPUTE-LETTER-DATE.                                                 
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE TO WS-DTE-LETTER.                         
           COMPUTE WS-DTE-LETTER-9 =                                            
                 FUNCTION DATE-OF-INTEGER(                                      
                 FUNCTION INTEGER-OF-DATE(WS-DTE-LETTER-9) + 2) + 0.            
                                                                                
       250-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       300-READ-F310.                                                           
      *-------------------------------------------------------------            
           READ BP13F310 AT END MOVE 'Y' TO EOF-F310                            
                                GO TO 300-EXIT.                                 
           ADD  1                    TO WS-F310-READ.                           
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       400-PROCESS-ROUTINE.                                                     
      *-------------------------------------------------------------            
           PERFORM 430-PROCESS-DETAILS THRU 430-EXIT                            
           PERFORM 300-READ-F310       THRU 300-EXIT.                           
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       430-PROCESS-DETAILS.                                                     
      *-------------------------------------------------------------            
           INITIALIZE               P776B-LAYOUT.                               
           MOVE F310-REGN-NO        TO K800-NUM-REGN.                           
           PERFORM 440-READ-K800    THRU 440-EXIT.                              
                                                                                
           IF (K800-FOUND = 'Y') AND                                            
              (K800-NUM-ALLOC-TAG = 'FN' OR 'NI' OR 'NC' OR 'NF' OR             
                                   'SF' OR 'SC' OR 'SI')                        
              PERFORM 450-CHK-K800 THRU 450-EXIT                                
           ELSE                                                                 
              DISPLAY 'MISSING K800 RECORD: ' K800-NUM-REGN                     
              ADD  1 TO WS-NUM-MISS                                             
           END-IF.                                                              
                                                                                
       430-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       440-READ-K800.                                                           
      *-------------------------------------------------------------            
           MOVE 'Y'                 TO K800-FOUND.                              
           READ BP13K800 INVALID KEY                                            
                MOVE 'N'            TO K800-FOUND                               
                GO TO 440-EXIT                                                  
           END-READ.                                                            
                                                                                
           IF WS-K800-STATUS = 0                                                
              ADD 1 TO WS-K800-READ                                             
           ELSE                                                                 
              DISPLAY 'ERROR READING K800 : ' WS-K800-STATUS                    
              MOVE WS-K800-STATUS TO RETURN-CODE                                
              GO TO 900-CLOSE-ROUTINE.                                          
                                                                                
       440-EXIT.                                                                
           EXIT.                                                                
                                                                                
       450-CHK-K800.                                                            
      *-------------------------------------------------------------            
           MOVE    SPACES            TO   K830-NUM-REGN.                        
           MOVE    K800-NUM-REGN     TO   K830-NUM-REGN.                        
           PERFORM 455-READ-BP13K830 THRU 455-EXIT.                             
                                                                                
           IF K800-NUM-ALLO-CAT = 'BE'                                          
             PERFORM 500-BE-CANCEL-LETTER  THRU 500-EXIT                        
           ELSE                                                                 
             IF K800-NUM-ALLO-CAT = 'BTO'                                       
                MOVE K800-NUM-BTO-ZONE        TO K555-NUM-ZONE-NT,              
                                                 K555-NUM-FLAT-TYPE             
             ELSE                                                               
                IF K800-NUM-ZONE = SPACES OR LOW-VALUES                         
                   MOVE K800-NUM-NEW-TOWN TO K555-NUM-ZONE-NT                   
                                             K555-NUM-FLAT-TYPE                 
                ELSE                                                            
                   MOVE K800-NUM-ZONE     TO K555-NUM-ZONE-NT                   
                                             K555-NUM-FLAT-TYPE                 
                END-IF                                                          
             END-IF                                                             
             PERFORM 460-READ-BP13K555      THRU 460-EXIT                       
             PERFORM 600-CANCEL-LETTER      THRU 600-EXIT                       
           END-IF.                                                              
                                                                                
           PERFORM 800-PRINT-CONTROL-LIST THRU 800-EXIT.                        
                                                                                
       450-EXIT.                                                                
           EXIT.                                                                
                                                                                
       455-READ-BP13K830.                                                       
      *-------------------------------------------------------------            
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
           IF WS-K830-STATUS = 0                                                
              IF K830-NUM-MAIL-ADDR = SPACES OR LOW-VALUES                      
                 MOVE K830-NUM-BLK         TO WS-ADDR-LINE1                     
                                              P776B-BLK-NO                      
                 MOVE K830-NUM-FLAT        TO WS-NUM-FLAT                       
                                              P776B-NUM-FLAT                    
                 MOVE K830-NME-STREET      TO WS-NME-STREET                     
                                              P776B-STREET-NAME                 
                 MOVE K830-NUM-POSTAL      TO WS-POST-CODE                      
                                              AV02C015-IN-POSTCODE              
                 PERFORM 850-CALL-AV02C015  THRU 850-EXIT                       
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO P776B-BAR-CODE            
                 STRING 'SINGAPORE ' K830-NUM-POSTAL                            
                       DELIMITED BY SIZE INTO P776B-POSTALCODE                  
              ELSE                                                              
                 MOVE K830-NUM-MAIL-BLK    TO WS-ADDR-LINE1                     
                                              P776B-BLK-NO                      
                 MOVE K830-NUM-MAIL-FLAT   TO WS-NUM-FLAT                       
                                              P776B-NUM-FLAT                    
                 MOVE K830-NME-MAIL-STR-BLDG TO WS-NME-STREET                   
                                              P776B-STREET-NAME                 
                 MOVE K830-NUM-MAIL-POSTAL TO WS-POST-CODE                      
                                              AV02C015-IN-POSTCODE              
                 PERFORM 850-CALL-AV02C015  THRU 850-EXIT                       
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO P776B-BAR-CODE            
                 STRING 'SINGAPORE ' K830-NUM-MAIL-POSTAL                       
                       DELIMITED BY SIZE INTO P776B-POSTALCODE                  
              END-IF                                                            
           ELSE                                                                 
           IF WS-K830-STATUS = 23                                               
              DISPLAY 'MISSING REGN K830 : ' K830-NUM-REGN                      
           ELSE                                                                 
              DISPLAY 'ERROR READING K830 : ' WS-K830-STATUS                    
              MOVE WS-K830-STATUS TO RETURN-CODE                                
              GO TO 900-CLOSE-ROUTINE.                                          
                                                                                
       455-EXIT.                                                                
           EXIT.                                                                
                                                                                
       460-READ-BP13K555.                                                       
      *-------------------------------------------------------------            
           READ BP13K555.                                                       
                                                                                
           EVALUATE WS-K555-STATUS                                              
           WHEN 0                                                               
               ADD 1                     TO WS-K555-READ                        
               MOVE K555-NME-OIC         TO P776-OIC-NAME                       
               MOVE SPACES               TO P776-OIC-DESIG                      
               EVALUATE K555-NME-OIC-DESG                                       
               WHEN 'EO  '                                                      
                  MOVE 'ESTATES OFFICER          ' TO P776-OIC-DESIG            
               WHEN 'EEO '                                                      
                  MOVE 'EXECUTIVE ESTATES OFFICER' TO P776-OIC-DESIG            
               WHEN 'SEO '                                                      
                  MOVE 'SENIOR ESTATES OFFICER   ' TO P776-OIC-DESIG            
               WHEN OTHER                                                       
                  MOVE 'OTHER OFFICER            ' TO P776-OIC-DESIG            
               END-EVALUATE                                                     
           WHEN 23                                                              
               MOVE SPACES               TO P776-OIC-NAME,                      
                                            P776-OIC-DESIG                      
               DISPLAY 'REC NOT FND IN BP13K555, KEY ' K555-KEY-FLD             
                       ', REGN IS ' K800-NUM-REGN                               
           WHEN OTHER                                                           
               DISPLAY 'ERROR READING BP13K555 STATUS ' WS-K555-STATUS          
               MOVE WS-K555-STATUS       TO RETURN-CODE                         
               GO TO 900-CLOSE-ROUTINE                                          
           END-EVALUATE.                                                        
                                                                                
       460-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       500-BE-CANCEL-LETTER.                                                    
      *-------------------------------------------------------------            
           MOVE SPACES                       TO WS-SELECT-ROOM                  
                                                WS-NEW-TOWN.                    
                                                                                
           MOVE K800-NUM-REGN                TO P776B-REGN-NO.                  
           MOVE K800-NUM-NEW-TOWN            TO P776B-NT.                       
           MOVE K800-NUM-ROOM                TO P776B-ROOM.                     
                                                                                
           STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/'                             
                  WS-DATE(1:4) DELIMITED BY SIZE                                
                  INTO P776B-DATE.                                              
                                                                                
      *------> ALLOC-SCH                                                        
           PERFORM 888-CHK-SERS-ALSCH      THRU 888-EXIT.                       
           IF C-SERS-ALLO-SCHEME OR K800-NUM-ALLO-SCHEME = 'PA '                
              MOVE SPACES                    TO P776B-ALLOC-SCH                 
            ELSE                                                                
              STRING '('  K800-NUM-ALLO-SCHEME  ')'                             
                      DELIMITED BY SIZE INTO P776B-ALLOC-SCH                    
           END-IF.                                                              
                                                                                
           MOVE K800-NUM-REGN                TO K820-NUM-REGN.                  
           MOVE K800-NUM-NRIC1               TO K820-NUM-NRIC.                  
           PERFORM 705-READ-K820           THRU 705-EXIT.                       
           MOVE  WS-NAME                     TO P776B-APPLN-NAME.               
           MOVE  SPACES                      TO WS-NAME.                        
           IF (K800-NUM-NRIC2 (2:1) NOT = '#') AND                              
              (K800-NUM-NRIC2 NOT = SPACES AND LOW-VALUES)                      
               MOVE K800-NUM-NRIC2           TO K820-NUM-NRIC                   
               PERFORM 705-READ-K820       THRU 705-EXIT                        
           END-IF.                                                              
                                                                                
           MOVE  WS-NAME                     TO P776B-COAPPLN-NAME.             
                                                                                
           IF K800-NUM-FLAT-TYPE (1:1) = '2'                                    
              MOVE '2-ROOM FLAT  ' TO WS-SELECT-ROOM                            
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE (1:1) = '3'                                    
              MOVE '3-ROOM FLAT  ' TO WS-SELECT-ROOM                            
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE (1:1) = '4'                                    
              MOVE '4-ROOM FLAT  ' TO WS-SELECT-ROOM                            
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE (1:1) = '5'                                    
              MOVE '5-ROOM FLAT  ' TO WS-SELECT-ROOM                            
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE (1:1) = 'E'                                    
              MOVE 'EXECUTIVE FLAT ' TO WS-SELECT-ROOM                          
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE       = '1A'                                   
              MOVE 'STUDIO APARTMENT' TO WS-SELECT-ROOM                         
           ELSE                                                                 
           IF K800-NUM-FLAT-TYPE       = '2A'                                   
              MOVE 'STUDIO APARTMENT' TO WS-SELECT-ROOM.                        
                                                                                
           PERFORM 760-READ-K060           THRU 760-EXIT.                       
                                                                                
           STRING 'SALE OF '                                                    
                  WS-SELECT-ROOM DELIMITED BY '  '                              
                  ' IN '                                                        
                  WS-NEW-TOWN DELIMITED BY '  '                                 
                  ' ESTATE'                                                     
                  DELIMITED BY '  '                                             
                  INTO P776B-SUBJECT.                                           
                                                                                
           PERFORM 520-PRINT-BE-CANCEL-LTR THRU 520-EXIT.                       
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       520-PRINT-BE-CANCEL-LTR.                                                 
      *-------------------------------------------------------------            
           IF K800-NUM-ALLOC-TAG  =  'FN' OR 'NI' OR 'NC' OR 'NF'               
                                  OR 'SI' OR 'SC' OR 'SF'                       
                                                                                
              MOVE  SPACES             TO    P776B-PRTREC                       
              EVALUATE K800-NUM-ALLOC-TAG                                       
                WHEN 'FN'                                                       
                WHEN 'NI'                                                       
                WHEN 'SI'                                                       
                  ADD  1      TO  WS-BE-LTR8-PRINT                              
                  WRITE P776B-PRTREC FROM DJDE-FORM-BP13T8 AFTER PAGE           
                WHEN 'NC'                                                       
                WHEN 'SC'                                                       
                  ADD  1      TO  WS-BE-LTR9-PRINT                              
                  WRITE P776B-PRTREC FROM DJDE-FORM-BP13T9 AFTER PAGE           
                WHEN 'NF'                                                       
                WHEN 'SF'                                                       
                  ADD  1      TO  WS-BE-LTRN-PRINT                              
                  WRITE P776B-PRTREC FROM DJDE-FORM-BP13TN AFTER PAGE           
              END-EVALUATE                                                      
                                                                                
              MOVE  SPACES             TO    P776B-PRTREC                       
              WRITE P776B-PRTREC FROM P776B-LINE01 AFTER 5                      
              WRITE P776B-PRTREC FROM P776B-LINE02 AFTER 1                      
              WRITE P776B-PRTREC FROM P776B-LINE03A AFTER 5                     
              WRITE P776B-PRTREC FROM P776B-LINE03B AFTER 1                     
              WRITE P776B-PRTREC FROM P776B-LINE04A AFTER 1                     
              WRITE P776B-PRTREC FROM P776B-LINE04B AFTER 1                     
              WRITE P776B-PRTREC FROM P776B-LINE04C AFTER 1                     
              WRITE P776B-PRTREC FROM P776B-LINE05 AFTER 2                      
              WRITE P776B-PRTREC FROM P776B-LINE06 AFTER 6                      
                                                                                
           END-IF.                                                              
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
                                                                                
       600-CANCEL-LETTER.                                                       
      *-------------------------------------------------------------            
           MOVE  SPACES       TO P776-PRTREC                                    
                                 P776C-PRTREC.                                  
                                                                                
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
              EVALUATE K800-NUM-ALLOC-TAG                                       
                WHEN 'NC'                                                       
                WHEN 'SC'                                                       
                 WRITE P776-PRTREC FROM DJDE-FORM-BP13PZ AFTER PAGE             
                WHEN 'FN'                                                       
                WHEN 'NI'                                                       
                WHEN 'SI'                                                       
                 WRITE P776-PRTREC FROM DJDE-FORM-BP13PX AFTER PAGE             
                WHEN 'NF'                                                       
                WHEN 'SF'                                                       
                 WRITE P776-PRTREC FROM DJDE-FORM-BP13P4 AFTER PAGE             
              END-EVALUATE                                                      
              PERFORM 700-PRINT-BP13P776 THRU 700-EXIT                          
           END-IF.                                                              
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       700-PRINT-BP13P776.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE K800-NUM-REGN  TO K820-NUM-REGN.                                
                                                                                
           MOVE SPACES         TO P776-PRTREC                                   
                                  P776-NAME1                                    
                                  P776-NAME2                                    
                                  P776-NUM-ZONE                                 
                                  P776-FT                                       
                                  P776-LINE-BLK-UNIT                            
                                  P776-LINE-ADDR2                               
                                  P776-LINE-ADDR3                               
                                  P776-BAR-CODE                                 
                                  P776-LINE-FLAT-SOF                            
                                  P776-LINE-FLAT-BTO                            
                                  P776-LINE-FLAT-BS.                            
                                                                                
           MOVE K800-NUM-REGN  TO P776-REGN-NO                                  
                                  P776-REGN-NO2.                                
                                                                                
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
              MOVE K800-NUM-BTO-ZONE        TO P776-NUM-ZONE                    
           ELSE                                                                 
              MOVE K800-NUM-ZONE       TO P776-NUM-ZONE.                        
                                                                                
           MOVE K800-NUM-FLAT-TYPE  TO P776-FT.                                 
                                                                                
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
              WRITE P776-PRTREC FROM P776-LINE-REGN   AFTER 1                   
           END-IF.                                                              
                                                                                
           MOVE K800-NUM-NRIC1   TO K820-NUM-NRIC.                              
           PERFORM 705-READ-K820 THRU 705-EXIT.                                 
           MOVE  WS-NAME        TO P776-NAME1                                   
                                   P776B-APPLN-NAME.                            
                                                                                
           IF (K800-NUM-NRIC2 (2:1) NOT = '#') AND                              
              (K800-NUM-NRIC2 NOT = SPACES AND LOW-VALUES)                      
               MOVE K800-NUM-NRIC2   TO K820-NUM-NRIC                           
               PERFORM 705-READ-K820 THRU 705-EXIT                              
               MOVE  WS-NAME     TO P776-NAME2                                  
                                    P776B-COAPPLN-NAME                          
           END-IF.                                                              
                                                                                
           MOVE  WS-BLK-NO       TO P776-LN4-BLK.                               
           MOVE  WS-NUM-FLAT     TO P776-LN4-UNIT.                              
           MOVE  WS-NME-STREET   TO P776-LN5-ADDR2.                             
           IF WS-POST-CODE = SPACES OR LOW-VALUES OR ZEROES                     
              MOVE SPACES  TO P776-LN6-ADDR3                                    
           ELSE                                                                 
              STRING 'SINGAPORE '   WS-POST-CODE                                
                 DELIMITED BY SIZE  INTO P776-LN6-ADDR3                         
              MOVE WS-POST-CODE TO AV02C015-IN-POSTCODE                         
              PERFORM 850-CALL-AV02C015  THRU 850-EXIT                          
              MOVE AV02C015-OUT-POSTCODE-CHKSUM TO P776-BAR-CODE                
           END-IF.                                                              
                                                                                
           WRITE P776-PRTREC FROM P776-LINE-DATE      AFTER 2                   
                                                                                
           IF P776-NAME2 = SPACES                                               
              WRITE P776-PRTREC FROM P776-LINE-NAME1 AFTER 6                    
           ELSE                                                                 
              WRITE P776-PRTREC FROM P776-LINE-NAME1 AFTER 5                    
              WRITE P776-PRTREC FROM P776-LINE-NAME2.                           
                                                                                
           WRITE P776-PRTREC     FROM P776-LINE-BLK-UNIT.                       
           WRITE P776-PRTREC     FROM P776-LINE-ADDR2.                          
           WRITE P776-PRTREC     FROM P776-LINE-ADDR3.                          
           WRITE P776-PRTREC     FROM P776-LINE-PC AFTER 2.                     
                                                                                
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
              MOVE K800-NUM-BTO-ZONE        TO WS-LINK-ZONE                     
              PERFORM 758-READ-K813 THRU 758-EXIT                               
              PERFORM 710-FORMAT-APPT-INFO        THRU 710-EXIT                 
              MOVE SPACES           TO  P776-PRTREC                             
              ADD 1 TO WS-BTO-PRTED                                             
           ELSE                                                                 
              PERFORM 760-READ-K060 THRU 760-EXIT                               
           END-IF.                                                              
                                                                                
           EVALUATE K800-DTE-BALLOT(5:2)                                        
               WHEN '01'                                                        
                  MOVE 'JAN' TO WS-BALLOT-MONTH                                 
               WHEN '02'                                                        
                  MOVE 'FEB' TO WS-BALLOT-MONTH                                 
               WHEN '03'                                                        
                  MOVE 'MAR' TO WS-BALLOT-MONTH                                 
               WHEN '04'                                                        
                  MOVE 'APR' TO WS-BALLOT-MONTH                                 
               WHEN '05'                                                        
                  MOVE 'MAY' TO WS-BALLOT-MONTH                                 
               WHEN '06'                                                        
                  MOVE 'JUN' TO WS-BALLOT-MONTH                                 
               WHEN '07'                                                        
                  MOVE 'JUL' TO WS-BALLOT-MONTH                                 
               WHEN '08'                                                        
                  MOVE 'AUG' TO WS-BALLOT-MONTH                                 
               WHEN '09'                                                        
                  MOVE 'SEP' TO WS-BALLOT-MONTH                                 
               WHEN '10'                                                        
                  MOVE 'OCT'  TO WS-BALLOT-MONTH                                
               WHEN '11'                                                        
                  MOVE 'NOV' TO WS-BALLOT-MONTH                                 
               WHEN '12'                                                        
                  MOVE 'DEC' TO WS-BALLOT-MONTH                                 
           END-EVALUATE                                                         
                                                                                
           STRING WS-BALLOT-MONTH ' ' K800-DTE-BALLOT(1:4)                      
                      DELIMITED BY SIZE                                         
                      INTO P776-DTE-BALLOT                                      
           END-STRING.                                                          
                                                                                
           WRITE P776-PRTREC     FROM P776-LINE-DTE-BALLOT AFTER 6.             
                                                                                
           MOVE 91                       TO K062-SERIAL-NO.                     
           MOVE K800-NUM-ZONE            TO K062-CODE.                          
                                                                                
           READ BP13K062.                                                       
                                                                                
           IF WS-K062-STATUS = 00                                               
              MOVE K062-DESC-L1(1:30) TO P776-NME-PROJECT                       
           ELSE                                                                 
              MOVE SPACES             TO P776-NME-PROJECT                       
           END-IF.                                                              
                                                                                
           WRITE P776-PRTREC     FROM P776-LINE-PROJ-NAME AFTER 5.              
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
       705-READ-K820.                                                           
      *-------------------------------------------------------------            
           MOVE SPACES        TO WS-NAME.                                       
                                                                                
           READ BP13K820.                                                       
           IF WS-K820-STATUS = 0                                                
              MOVE K820-NME-OCCP TO WS-NAME                                     
           ELSE                                                                 
           IF WS-K820-STATUS = 23                                               
              MOVE SPACES TO WS-NAME                                            
              DISPLAY 'REC NOT FND IN K820 : ' K820-KEY-FLD                     
           ELSE                                                                 
              DISPLAY 'ERROR READING K820 : ' WS-K820-STATUS                    
              MOVE WS-K820-STATUS TO RETURN-CODE                                
              GO TO 900-CLOSE-ROUTINE                                           
           END-IF.                                                              
                                                                                
       705-EXIT.                                                                
           EXIT.                                                                
                                                                                
       710-FORMAT-APPT-INFO.                                                    
      *-------------------------------------------------------------            
           MOVE K800-DTE-BK-APPT  TO  WS-DTE-APPT.                              
           MOVE K800-TME-BK-APPT  TO  WS-TME-APPT.                              
           MOVE WS-DTE-CC         TO  P776-APPT-CC, P776-APPT-CC2.              
           MOVE WS-DTE-YY         TO  P776-APPT-YY, P776-APPT-YY2.              
           MOVE WS-DTE-MM         TO  P776-APPT-MM, P776-APPT-MM2.              
           MOVE WS-DTE-DD         TO  P776-APPT-DD, P776-APPT-DD2.              
           MOVE WS-TME-HH         TO  WS-COMP-TME.                              
           IF WS-TME-HH > '12'                                                  
              MOVE WS-TME-HH   TO WS-COMP-TME                                   
              COMPUTE WS-COMP-TME = WS-COMP-TME - 12                            
              MOVE 'PM' TO P776-APPT-AM-PM, P776-APPT-AM-PM2(1:2)               
           ELSE IF WS-TME-HH = '12'                                             
              MOVE 'PM' TO P776-APPT-AM-PM, P776-APPT-AM-PM2(1:2)               
           ELSE                                                                 
              MOVE 'AM' TO P776-APPT-AM-PM, P776-APPT-AM-PM2(1:2).              
           MOVE WS-COMP-TME       TO  P776-APPT-HH, P776-APPT-HH2.              
           MOVE WS-TME-MIN        TO  P776-APPT-MIN, P776-APPT-MIN2.            
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       758-READ-K813.                                                           
      *-------------------------------------------------------------            
           CALL 'BP13C910' USING WS-LINK-REC,                                   
                                 BP13K813-REC,                                  
                                 WS-ZONE-FND-FLAG                               
           IF WS-ZONE-FND-FLAG = 'Y'                                            
              MOVE K813-NME-SITE TO P776-BTO-SITE                               
           ELSE                                                                 
              MOVE SPACES        TO P776-BTO-SITE                               
           END-IF.                                                              
                                                                                
       758-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       760-READ-K060.                                                           
      *-------------------------------------------------------------            
           MOVE SPACES            TO K060-KEY-FLD.                              
           IF K800-NUM-ZONE = SPACES OR LOW-VALUES                              
              MOVE 02                TO K060-SERIAL-NO                          
              MOVE K800-NUM-NEW-TOWN TO K060-CODE                               
              READ BP13K060                                                     
              IF WS-K060-STATUS NOT = 00 AND 02                                 
                 DISPLAY 'INVALID NEW TOWN ' K800-NUM-NEW-TOWN                  
              ELSE                                                              
                 MOVE K060-DESC  TO P776-NEW-TOWN                               
                                    WS-NEW-TOWN                                 
              END-IF                                                            
           ELSE                                                                 
              MOVE 91                TO K060-SERIAL-NO                          
              MOVE K800-NUM-ZONE     TO K060-CODE                               
              READ BP13K060                                                     
              IF WS-K060-STATUS NOT = 00 AND 02                                 
                 DISPLAY 'INVALID ZONE     ' K800-NUM-ZONE                      
              ELSE                                                              
                 MOVE K060-DESC     TO WS-TMP-ZONE                              
                                       WS-NEW-TOWN                              
              END-IF                                                            
           END-IF.                                                              
                                                                                
       760-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       800-PRINT-CONTROL-LIST.                                                  
      *-------------------------------------------------------------            
           IF WS-NUM-LINE-L776 > 25                                             
              PERFORM 810-PRINT-CONTROL-HEADING THRU 810-EXIT.                  
                                                                                
           MOVE  SPACES            TO L776-PRTREC.                              
           ADD 1                   TO WS-TOTAL-PRTED                            
                                      WS-NUM-LINE-L776.                         
           MOVE WS-TOTAL-PRTED     TO L776-SNO.                                 
                                                                                
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
              MOVE P776-BTO-SITE  TO L776-NT-ZONE                               
           ELSE                                                                 
              IF K800-NUM-ZONE = SPACES OR LOW-VALUES                           
                 MOVE P776-NEW-TOWN  TO L776-NT-ZONE                            
              ELSE                                                              
                 MOVE WS-TMP-ZONE    TO L776-NT-ZONE                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K800-NUM-FLAT-TYPE TO L776-FT.                                  
           MOVE K800-NUM-REGN      TO L776-REGN.                                
           MOVE K800-NUM-NT-FT-QUEUE TO L776-QUEUE.                             
           MOVE K800-NUM-NRIC1     TO L776-NRIC1.                               
           MOVE K800-NUM-NRIC2     TO L776-NRIC2.                               
           IF K800-NUM-ALLO-CAT = 'BTO'                                         
           MOVE K800-NUM-ZONE      TO L776-ZONE.                                
           MOVE K800-DTE-BALLOT    TO L776-DTE-BALLOT.                          
                                                                                
           EVALUATE K800-NUM-ALLOC-TAG                                          
              WHEN 'NF'                                                         
                 MOVE 'G1' TO K800-NUM-CANCEL-REASON                            
              WHEN 'NC'                                                         
                 MOVE 'G2' TO K800-NUM-CANCEL-REASON                            
              WHEN 'NI'                                                         
                 MOVE 'G3' TO K800-NUM-CANCEL-REASON                            
              WHEN 'FN'                                                         
                 MOVE '27' TO K800-NUM-CANCEL-REASON                            
              WHEN 'SF'                                                         
                 MOVE 'G4' TO K800-NUM-CANCEL-REASON                            
              WHEN 'SC'                                                         
                 MOVE 'G5' TO K800-NUM-CANCEL-REASON                            
              WHEN 'SI'                                                         
                 MOVE 'G6' TO K800-NUM-CANCEL-REASON                            
           END-EVALUATE.                                                        
                                                                                
           STRING K800-NUM-ALLOC-TAG '(' K800-NUM-CANCEL-REASON ')'             
                  DELIMITED BY SIZE                                             
                  INTO L776-ALLOC-TAG.                                          
                                                                                
           IF K800-NUM-ALLOC-TAG = 'NC' OR 'SC'                                 
              MOVE K800-NUM-CAT TO L776-ETHNIC                                  
           ELSE                                                                 
              MOVE SPACES       TO L776-ETHNIC.                                 
                                                                                
           WRITE L776-PRTREC    FROM L776-DTL AFTER 1.                          
           MOVE  SPACES            TO   L776-PRTREC.                            
           WRITE L776-PRTREC.                                                   
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       810-PRINT-CONTROL-HEADING.                                               
      *-------------------------------------------------------------            
           ADD   1 TO WS-NUM-PAGE-L776.                                         
           MOVE  1 TO WS-NUM-LINE-L776.                                         
           MOVE  WS-NUM-PAGE-L776 TO   L776-PAGE.                               
                                                                                
           WRITE L776-PRTREC      FROM L776-HDG1 AFTER PAGE.                    
           WRITE L776-PRTREC      FROM L776-HDG2 AFTER 1.                       
           WRITE L776-PRTREC      FROM L776-HDG3 AFTER 2.                       
                                                                                
           MOVE  SPACES           TO   L776-PRTREC.                             
           WRITE L776-PRTREC.                                                   
                                                                                
       810-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       850-CALL-AV02C015.                                                       
      *-------------------------------------------------------------            
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
                                                                                
       850-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       888-CHK-SERS-ALSCH.                                                      
      *-------------------------------------------------------------            
      * SEARCH SERS TABLE TO CHECK ALLOC SCHEME                                 
      *-------------------------------------------------------------            
           SET WS-SERS-PTR TO 1.                                                
           SEARCH WS-SERS-SCH                                                   
              AT END                                                            
                 MOVE 'N'      TO SW-SERS-ALLO-SCHEME                           
              WHEN WS-SERS-SCHEME (WS-SERS-PTR) = K800-NUM-ALLO-SCHEME          
                 MOVE 'Y'      TO SW-SERS-ALLO-SCHEME                           
           END-SEARCH.                                                          
                                                                                
       888-EXIT.                                                                
           EXIT.                                                                
                                                                                
       900-CLOSE-ROUTINE.                                                       
      *-------------------------------------------------------------            
           CLOSE BP13F310                                                       
                 BP13K830                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K060                                                       
                 BP13K062                                                       
                 BP13K555                                                       
                 BP13L776                                                       
                 BP13P776                                                       
                 P13P776B                                                       
                 P13P776C.                                                      
                                                                                
           IF WS-K830-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K830 ERROR ' WS-K830-STATUS.                
                                                                                
           IF WS-K800-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K800 ERROR ' WS-K800-STATUS.                
                                                                                
           IF WS-K820-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K820 ERROR ' WS-K820-STATUS.                
                                                                                
           IF WS-K060-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K060 ERROR ' WS-K060-STATUS.                
                                                                                
           IF WS-K062-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K062 ERROR ' WS-K062-STATUS.                
                                                                                
           IF WS-K555-STATUS NOT = ZEROES AND 97                                
              DISPLAY ' CLOSING BP13K555 ERROR ' WS-K555-STATUS.                
                                                                                
           CALL 'CP13K813' USING WS-RETURN-CODE.                                
           IF WS-RETURN-CODE NOT = ZEROES AND 97                                
              DISPLAY 'CLOSING ERROR K813 STATUS IS ' WS-RETURN-CODE            
              MOVE     WS-RETURN-CODE TO RETURN-CODE                            
           END-IF.                                                              
                                                                                
           DISPLAY '  '.                                                        
           DISPLAY ' BP13C776 CONTROL LIST'.                                    
           DISPLAY ' -------------------------------------'.                    
           DISPLAY ' REC READ FROM F310         = ' WS-F310-READ.               
           DISPLAY ' REC READ FROM K555         = ' WS-K555-READ.               
           DISPLAY ' MISSING REC IN K800        = ' WS-NUM-MISS.                
           DISPLAY ' REC READ FROM K800         = ' WS-K800-READ.               
           DISPLAY ' LETTERS PRINTED(BTO)       = ' WS-BTO-PRTED.               
           DISPLAY ' BE LETTERS(BP13T8) PRINTED = ' WS-BE-LTR8-PRINT.           
           DISPLAY ' BE LETTERS(BP13T9) PRINTED = ' WS-BE-LTR9-PRINT.           
           DISPLAY ' BE LETTERS(BP13TN) PRINTED = ' WS-BE-LTRN-PRINT.           
           DISPLAY '  '.                                                        
                                                                                
           STOP RUN.                                                            
