       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.   BP13C073.                                                  
      *AUTHOR.       AJITH KUMAR T.                                             
      *DATE-WRITTEN. 27-04-2000.                                                
      * ============================================================            
      * SYSTEM OF COMMITMENT(SOC)                                               
      * ============================================================            
      *                                                                         
      * ***  NOTE : DO NOT CHANGE LOCATION OF BO CODE  ***                      
      *                                                                         
      * OBJECTIVE : TO PRINT QUARTERLY LISTING OF RESIDENTS FOUND IN            
      *             EXECUTIVE CONDOMINIUM AFTER TOP AND HDB FLAT FOR            
      *             MORE THAN 6 MONTHS.                                         
      *                                                                         
      * FILES :                                                                 
      * INPUT  - BP13K943                                                       
      *        - BP13F716                                                       
      *        - BP18K130                                                       
      *        - BP18K140                                                       
      *        - BE04K600                                                       
      * OUTPUT - P13L073A - HDB LESSES WHO ARE EC OWNERS                        
      *          P13L073B - HDB LESSES WHO ARE EC OWNERS/OCCUPIERS              
      * ------------------------------------------------------------            
      * CHG REF  DATE     BY   DESCRIPTION                                      
      * -------- -------- ---  -----------                                      
      * BP130816 20000727 AKT  NEW PROGRAM                                      
      * BP130816 02220801 MCC  RETRIEVE NAME                                    
      * BP131046 20010815 SN   INCLUDE ROLE, OWNER/OCCP                         
      * BP131048 20011121 ANC1 CHANGE TITLE                                     
      * BP131046 20050315 ANC1 DO NOT PRINT SUBTENANT IN REPORT                 
      * BP132699 20050526 GAN1 INCLUDE SUBMISSION APPROVAL DATE                 
      *                        AND EXPIRY DATE FROM BE04K600                    
      * BP132721 20050712 SSS2 SEPERATE REPORT INTO 2 FILE                      
      * BP136892 20170711 FNP1 ADD 2 NEW OUTPUT FILE                            
      *                        GET OIC FOR HDB FROM DATABASE                    
      * BP136980 20171107 FNP1 FIX ISSUE OF OIC NOT DISPLAYED CORRECTLY         
      * BP137365 20180706 KR13 ADDED EXPRY & APPRVL DATE TO O/P FILES           
      *                        L073C & L073D. FIX BO CODE POSITION.             
      *                        CHECK EXPIRY DT IF BE04TRAN 00102 & 00003        
      * BP138699 20210423 FP6  SEND THE REPORT P13L073B TO EMAIL                
      *          20210706 FP6  CONVERT ALL OUTPUT TO EMAIL FORMAT               
      * BP139213 20220713 PP11 CALL BE04C921 FOR OLD ROLE                       
      *                        AND  BE04C930 FOR OLD ZONE                       
      * BP139534 20230316 MRR5 PASS 'EM' TO BE04C920-IN-NUM-UNIT-ROLE           
      * ============================================================            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
                                                                                
           SELECT  BP13F716   ASSIGN          TO  BP13F716.                     
                                                                                
           SELECT BP18K130    ASSIGN          TO BP18K130                       
                  ACCESS MODE                 IS DYNAMIC                        
                  ORGANIZATION                IS INDEXED                        
                  RECORD KEY                  IS K130-KEY-FLD                   
                  ALTERNATE KEY               IS K130-NUM-REGN                  
                  FILE STATUS                 IS  BP18K130-FILE-STATUS.         
                                                                                
           SELECT BP18K140    ASSIGN          TO BP18K140                       
                  ACCESS MODE                 IS DYNAMIC                        
                  ORGANIZATION                IS INDEXED                        
                  RECORD KEY                  IS K140-KEY-FLD                   
                  ALTERNATE KEY               IS K140-ALT-KEY                   
                  FILE STATUS                 IS  BP18K140-FILE-STATUS.         
                                                                                
           SELECT BP13K943    ASSIGN          TO BP13K943                       
                  ACCESS MODE                 IS DYNAMIC                        
                  ORGANIZATION                IS INDEXED                        
                  RECORD KEY                  IS K943-KEY-FLD                   
      *           ALTERNATE KEY               IS K943-NUM-NRIC                  
                  FILE STATUS                 IS  BP13K943-FILE-STATUS.         
                                                                                
           SELECT BP13K940    ASSIGN          TO BP13K940                       
                  ACCESS MODE                 IS DYNAMIC                        
                  ORGANIZATION                IS INDEXED                        
                  RECORD KEY                  IS K940-NUM-REGN                  
                  FILE STATUS                 IS  BP13K940-FILE-STATUS.         
                                                                                
           SELECT BE04K600    ASSIGN          TO BE04K600                       
                  ACCESS MODE                 IS DYNAMIC                        
                  ORGANIZATION                IS INDEXED                        
                  RECORD KEY                  IS BE04K600-KEY                   
                  FILE STATUS                 IS  BE04K600-FILE-STATUS.         
                                                                                
           SELECT  P13L073A   ASSIGN          TO  P13L073A.                     
           SELECT  P13L073B   ASSIGN          TO  P13L073B.                     
           SELECT  P13L073C   ASSIGN          TO  P13L073C.                     
           SELECT  P13L073D   ASSIGN          TO  P13L073D.                     
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
                                                                                
       FD   BP13F716                                                            
            BLOCK  CONTAINS 0   RECORDS.                                        
       COPY BP13F716.                                                           
                                                                                
       FD   BP18K130                                                            
            RECORD     CONTAINS 150 CHARACTERS.                                 
       COPY BP18K130.                                                           
                                                                                
       FD   BP18K140                                                            
            RECORD     CONTAINS 300 CHARACTERS.                                 
       COPY BP18K140.                                                           
                                                                                
       FD   BP13K943                                                            
            RECORD     CONTAINS 200 CHARACTERS.                                 
       COPY BP13K943.                                                           
                                                                                
       FD   BP13K940                                                            
            RECORD     CONTAINS 400 CHARACTERS.                                 
       COPY BP13K940.                                                           
                                                                                
       FD   BE04K600                                                            
            RECORD     CONTAINS 400 CHARACTERS.                                 
       COPY BE04K600.                                                           
                                                                                
       FD  P13L073A                                                             
           BLOCK  CONTAINS 0   RECORDS                                          
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS  F.                                                
       01  L073A-PRTREC                PIC X(132).                              
                                                                                
       FD  P13L073B                                                             
           BLOCK  CONTAINS 0   RECORDS                                          
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS  F.                                                
       01  L073B-PRTREC                PIC X(132).                              
                                                                                
       FD  P13L073C                                                             
           BLOCK  CONTAINS 0   RECORDS                                          
           RECORD CONTAINS 300 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS  F.                                                
       01  P13L073C-REC                PIC X(300).                              
                                                                                
       FD  P13L073D                                                             
           BLOCK  CONTAINS 0   RECORDS                                          
           RECORD CONTAINS 300 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS  F.                                                
       01  P13L073D-REC                PIC X(300).                              
                                                                                
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  BP18K130-FILE-STATUS   PIC XX VALUE ZEROES.                      
           05  BP18K140-FILE-STATUS   PIC XX VALUE ZEROES.                      
           05  BP13K943-FILE-STATUS   PIC XX VALUE ZEROES.                      
           05  BP13K940-FILE-STATUS   PIC XX VALUE ZEROES.                      
           05  BE04K600-FILE-STATUS   PIC XX VALUE ZEROES.                      
                                                                                
       01  WS-EOF-VARIABLES.                                                    
           05  WS-F716-EOF            PIC X VALUE 'N'.                          
           05  WS-K130-EOF            PIC X VALUE 'N'.                          
           05  WS-K140-EOF            PIC X VALUE 'N'.                          
           05  WS-K600-EOF            PIC X VALUE 'N'.                          
           05  WS-K130-FOUND          PIC X VALUE 'N'.                          
           05  WS-K140-FOUND          PIC X VALUE 'N'.                          
           05  WS-K600-FOUND          PIC X VALUE 'N'.                          
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F716-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-K130-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-K140-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-K943-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-K940-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-K600-READ           PIC 9(05) VALUE ZEROES.                   
           05  WS-NUM-PG-REC-L073     PIC 9(08) VALUE ZEROES.                   
           05  WS-CNT-PAGE            PIC 9(05) VALUE ZEROES.                   
           05  WS-CNT-L073            PIC 9(05) VALUE ZEROES.                   
           05  WS-CNT-SN              PIC 9(05) VALUE ZEROES.                   
                                                                                
       01  WS-DATE                    PIC X(8)  VALUE SPACES.                   
       01  WS-DATE-APPRVL             PIC 9(8)  VALUE ZEROES.                   
       01  WS-DATE-BE04.                                                        
           05 WS-YY                   PIC  9(4) VALUE ZEROES.                   
           05 WS-MM                   PIC  9(2) VALUE ZEROES.                   
           05 WS-DD                   PIC  9(2) VALUE ZEROES.                   
       01  WS-RETURN-CODE             PIC  9(4) VALUE ZEROES.                   
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-NUM-NRIC.                                                     
               10  WS-PREFIX          PIC X(01) VALUE SPACES.                   
               10  WS-HIPHEN          PIC X(01) VALUE SPACES.                   
               10  WS-UIN             PIC X(08) VALUE SPACES.                   
               10  WS-BO              PIC X(02) VALUE SPACES.                   
           05  WS-NUM-OIC             PIC X(06) VALUE SPACES.                   
           05  WS-NUM-SCH-9           PIC X(09) VALUE SPACES.                   
                                                                                
       01  WS-ADDRESS.                                                          
           05  WS-BLK-CHAR            PIC X(04) VALUE SPACES.                   
           05  WS-BLK                 PIC X(06) VALUE SPACES.                   
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  WS-HASH                PIC X(01) VALUE SPACES.                   
           05  WS-LEVEL               PIC X(02) VALUE SPACES.                   
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  WS-HIPHEN4             PIC X(01) VALUE SPACES.                   
           05  WS-HSEMAIN             PIC X(04) VALUE SPACES.                   
           05  WS-HIPHEN5             PIC X(01) VALUE SPACES.                   
           05  WS-HSESUB              PIC X(03) VALUE SPACES.                   
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  WS-POSTAL              PIC X(06) VALUE SPACES.                   
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  WS-STREET              PIC X(32) VALUE SPACES.                   
                                                                                
      *---------------------------------------------------------------*         
      *        MAIL HEADER                                            *         
      *---------------------------------------------------------------*         
       01  MAIL-HDR-HELO.                                                       
           05  FILLER PIC X(132) VALUE 'HELO SGPHDB1'.                          
                                                                                
       01  MAIL-HDR-MAIL-FROM.                                                  
           05  FILLER PIC X(132) VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.              
                                                                                
       01  MAIL-HDR-MAIL-RCPT1.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<tan_geok_ging@hdb.gov.s        
      -        'g>'.                                                            
                                                                                
       01  MAIL-HDR-MAIL-RCPT1A.                                                
           05  FILLER PIC X(132) VALUE 'RCPT TO:<sam_yq_goh@hdb.gov.sg>'        
      -        .                                                                
                                                                                
       01  MAIL-HDR-MAIL-RCPT2.                                                 
           05 FILLER PIC X(132) VALUE 'RCPT TO:<tham_yi_hua@hdb.gov.sg>'        
      -        .                                                                
                                                                                
       01  MAIL-HDR-DATA.                                                       
           05  FILLER PIC X(132) VALUE 'DATA'.                                  
                                                                                
       01  MAIL-HDR-FROM.                                                       
           05  FILLER PIC X(132) VALUE 'FROM:SOC SYSTEM - EMAIL ALERT'.         
                                                                                
       01  MAIL-HDR-MAIL-TO-CC1.                                                
           05  FILLER PIC X(80)                                                 
               VALUE 'TO:<tan_geok_sing@hdb.gov.sg>'.                           
                                                                                
       01  MAIL-HDR-MAIL-TO-CC1A.                                               
           05  FILLER PIC X(80)                                                 
               VALUE 'TO:<sam_yq_goh@hdb.gov.sg>'.                              
                                                                                
       01  MAIL-HDR-MAIL-TO-CC2.                                                
           05  FILLER PIC X(80)                                                 
               VALUE 'TO:<tham_yi_hua@hdb.gov.sg>'.                             
                                                                                
       01  MAIL-SUBJECT-L073A.                                                  
           05  FILLER PIC X(132) VALUE 'SUBJECT : Quarterly Listing of H        
      -        'DB Flat Lessees/Registered Tenants Who are Owners of EC         
      -        'for more than 6mos'.                                            
                                                                                
       01  MAIL-SUBJECT-L073B.                                                  
           05  FILLER PIC X(132) VALUE 'SUBJECT : Quarterly Report of HD        
      -        'B Flat Lessees/Registered Tenants/Occupiers who are owne        
      -        'rs of EC'.                                                      
                                                                                
       01  MAIL-SUBJECT-L073C.                                                  
           05  FILLER PIC X(132) VALUE 'SUBJECT : Detailed Listing of HD        
      -        'B Flat Lessees/Registered Tenants Who are Owners of EC f        
      -        'or more than 6mos'.                                             
                                                                                
       01  MAIL-SUBJECT-L073D.                                                  
           05  FILLER PIC X(132) VALUE 'SUBJECT : Detailed listing of HD        
      -        'B Flat Lessees/Registered Tenants/Occupiers who are owne        
      -        'rs of EC'.                                                      
                                                                                
       01  MAIL-HDR-DATE.                                                       
           05  FILLER                  PIC X(6)   VALUE 'DATE: '.               
           05  MAIL-DATE               PIC X(10)  VALUE SPACES.                 
                                                                                
       01  MAIL-SPACES.                                                         
           05 FILLER                   PIC X(132) VALUE SPACES.                 
                                                                                
       01  WS-L073A-HDNG1.                                                      
           05  FILLER                 PIC X(14)  VALUE 'P13L073A'.              
           05  FILLER                 PIC X(08)  VALUE 'HDB3'.                  
           05  FILLER                 PIC X(18)  VALUE SPACES.                  
           05  FILLER                 PIC X(39)  VALUE                          
                'S Y S T E M   O F   C O M M I T M E N T'.                      
           05  FILLER                 PIC X(15)  VALUE SPACES.                  
           05  FILLER                 PIC X(07)  VALUE 'DATE: '.                
           05  WS-L073A-DATE          PIC X(11)  VALUE SPACES.                  
           05  FILLER                 PIC X(08)  VALUE SPACES.                  
           05  FILLER                 PIC X(07)  VALUE 'PAGE: '.                
           05  WS-L073A-PAGE          PIC ZZZZ9  VALUE ZERO.                    
                                                                                
       01  WS-L073A-HDNG2.                                                      
           05  FILLER                 PIC X(07) VALUE SPACES.                   
           05  FILLER                 PIC X(98) VALUE                           
                    'QUARTERLY LISTING OF HDB FLAT LESSEES/REGISTERED TE        
      -             'NANTS WHO ARE OWNERS OF EXECUTIVE CONDOMINIUM'.            
           05  FILLER                 PIC X(15) VALUE SPACES.                   
                                                                                
       01  WS-L073B-HDNG1.                                                      
           05  FILLER                 PIC X(14)  VALUE 'P13L073B'.              
           05  FILLER                 PIC X(08)  VALUE 'HDB3'.                  
           05  FILLER                 PIC X(18)  VALUE SPACES.                  
           05  FILLER                 PIC X(39)  VALUE                          
                'S Y S T E M   O F   C O M M I T M E N T'.                      
           05  FILLER                 PIC X(15)  VALUE SPACES.                  
           05  FILLER                 PIC X(07)  VALUE 'DATE: '.                
           05  WS-L073B-DATE          PIC X(11)  VALUE SPACES.                  
           05  FILLER                 PIC X(08)  VALUE SPACES.                  
           05  FILLER                 PIC X(07)  VALUE 'PAGE: '.                
           05  WS-L073B-PAGE          PIC ZZZZ9  VALUE ZERO.                    
                                                                                
       01  WS-L073B-HDNG2.                                                      
           05  FILLER                 PIC X(07) VALUE SPACES.                   
           05  FILLER                 PIC X(118) VALUE                          
            'QUARTERLY LISTING OF HDB FLAT LESSEES/REGISTERED TENANTS/OC        
      -     'CUPIERS WHO ARE OWNERS/OCCUPIERS OF EXECUTIVE CONDOMINIUM'.        
           05  FILLER                 PIC X(05) VALUE SPACES.                   
                                                                                
       01  WS-L073-HDNG3.                                                       
           05  FILLER                 PIC X(45) VALUE SPACES.                   
           05  FILLER                 PIC X(22) VALUE                           
                                      'FOR MORE THAN 6 MONTHS'.                 
                                                                                
       01  WS-L073-HDNG4.                                                       
           05  FILLER                 PIC X(04) VALUE 'S/NO'.                   
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  FILLER                 PIC X(06) VALUE 'UIN NO'.                 
           05  FILLER                 PIC X(05) VALUE SPACES.                   
           05  FILLER                 PIC X(05) VALUE 'NAME '.                  
           05  FILLER                 PIC X(16) VALUE SPACES.                   
           05  FILLER                 PIC X(07) VALUE 'MTH FR'.                 
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  FILLER                 PIC X(07) VALUE 'REGN NO'.                
           05  FILLER                 PIC X(09) VALUE SPACES.                   
           05  FILLER                 PIC X(11) VALUE 'EC  ADDRESS'.            
           05  FILLER                 PIC X(29) VALUE SPACES.                   
           05  FILLER                 PIC X(06) VALUE 'BO  : '.                 
           05  WS-L073-BO             PIC X(2)  VALUE SPACES.                   
           05  FILLER                 PIC X(14) VALUE SPACES.                   
           05  FILLER                 PIC X(10) VALUE 'APPRVL DTE'.             
                                                                                
       01  WS-L073-HDNG5.                                                       
           05  FILLER                 PIC X(37) VALUE SPACES.                   
           05  FILLER                 PIC X(07) VALUE 'TP DTE'.                 
           05  FILLER                 PIC X(01) VALUE SPACES.                   
           05  FILLER                 PIC X(09) VALUE 'SCH ACCNO'.              
           05  FILLER                 PIC X(07) VALUE SPACES.                   
           05  FILLER                 PIC X(11) VALUE 'HDB ADDRESS'.            
           05  FILLER                 PIC X(43) VALUE SPACES.                   
           05  FILLER                 PIC X(04) VALUE 'ROLE'.                   
           05  FILLER                 PIC X(04) VALUE SPACES.                   
           05  FILLER                 PIC X(10) VALUE 'EXPIRY DTE'.             
                                                                                
       01  WS-L073-LINE               PIC X(132) VALUE ALL '-'.                 
                                                                                
       01  WS-L073-DET1.                                                        
           05  WS-L073-CNT            PIC ZZ99   VALUE ZEROES.                  
           05  FILLER                 PIC X(01)  VALUE SPACES.                  
           05  WS-L073-UIN            PIC X(10)  VALUE SPACES.                  
           05  FILLER                 PIC X(01)  VALUE SPACES.                  
           05  WS-L073-NAME           PIC X(20)  VALUE SPACES.                  
           05  FILLER                 PIC X(02)  VALUE SPACES.                  
           05  WS-L073-MTH-RESIDE     PIC X(04)  VALUE SPACES.                  
           05  FILLER                 PIC X(02)  VALUE SPACES.                  
           05  WS-L073-REGNO          PIC X(08)  VALUE SPACES.                  
           05  FILLER                 PIC X(08)  VALUE SPACES.                  
           05  WS-L073-ADDRESS-1      PIC X(50)  VALUE SPACES.                  
           05  FILLER                 PIC X(04)  VALUE SPACES.                  
           05  WS-L073-ROLE-1         PIC X(07)  VALUE SPACES.                  
           05  FILLER                 PIC X(01)  VALUE SPACES.                  
           05  WS-L073-APPRVL-DTE     PIC X(10)  VALUE SPACES.                  
                                                                                
       01  WS-L073-DET2.                                                        
           05  FILLER                 PIC X(44)  VALUE SPACES.                  
           05  WS-L073-SCHACC         PIC X(14)  VALUE SPACES.                  
           05  FILLER                 PIC X(02)  VALUE SPACES.                  
           05  WS-L073-ADDRESS-2      PIC X(50)  VALUE SPACES.                  
           05  FILLER                 PIC X(04)  VALUE SPACES.                  
           05  WS-L073-ROLE-2         PIC X(07)  VALUE SPACES.                  
           05  FILLER                 PIC X(01)  VALUE SPACES.                  
           05  WS-L073-EXPIRY-DTE     PIC X(10)  VALUE SPACES.                  
                                                                                
       01  WS-L073C-HEADER.                                                     
           05  FILLER                 PIC X(05)  VALUE 'S/N'.                   
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(11)  VALUE 'IDENTITY NO'.           
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(20)  VALUE 'NAME'.                  
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(14)  VALUE                          
                                              'OLD SCH A/C NO'.                 
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(10)  VALUE 'OLD ZONE  '.            
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(50)  VALUE                          
                                              'OLD  ADDRESS (HDB)'.             
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(08)  VALUE 'OLD ROLE'.              
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(18)  VALUE                          
                                                  'OLD FUNCTIONAL OIC'.         
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(08)  VALUE 'NEW REGN'.              
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(50)  VALUE                          
                                              'NEW  ADDRESS (HDB)'.             
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(08)  VALUE 'NEW ROLE'.              
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(10)  VALUE 'TP DATE'.               
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(12)  VALUE 'MTH FR TP DT'.          
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(10)  VALUE 'APPRVL DT '.            
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(10)  VALUE 'EXPIRY DT '.            
           05  FILLER                 PIC X(01)  VALUE ';'.                     
           05  FILLER                 PIC X(40)  VALUE SPACES.                  
                                                                                
       01  WS-L073C-DETAIL.                                                     
           05  L073C-CNT              PIC ZZZZ9  VALUE ZEROES.                  
           05  FIL01                  PIC X(01)  VALUE SPACES.                  
           05  L073C-IDENT-NO         PIC X(11)  VALUE SPACES.                  
           05  FIL02                  PIC X(01)  VALUE SPACES.                  
           05  L073C-NAME             PIC X(20)  VALUE SPACES.                  
           05  FIL03                  PIC X(01)  VALUE SPACES.                  
           05  L073C-OLD-SCH          PIC X(14)  VALUE SPACES.                  
           05  FIL04                  PIC X(01)  VALUE SPACES.                  
           05  L073C-OLD-ZONE         PIC X(10)  VALUE SPACES.                  
           05  FIL05                  PIC X(01)  VALUE SPACES.                  
           05  L073C-OLD-ADDRESS      PIC X(50)  VALUE SPACES.                  
           05  FIL06                  PIC X(01)  VALUE SPACES.                  
           05  L073C-OLD-ROLE         PIC X(08)  VALUE SPACES.                  
           05  FIL07                  PIC X(01)  VALUE SPACES.                  
           05  L073C-OLD-OIC          PIC X(08)  VALUE SPACES.                  
           05  FILLER                 PIC X(10)  VALUE SPACES.                  
           05  FIL08                  PIC X(01)  VALUE SPACES.                  
           05  L073C-NEW-REGN         PIC X(08)  VALUE SPACES.                  
           05  FIL09                  PIC X(01)  VALUE SPACES.                  
           05  L073C-NEW-ADDRESS      PIC X(50)  VALUE SPACES.                  
           05  FIL10                  PIC X(01)  VALUE SPACES.                  
           05  L073C-NEW-ROLE         PIC X(08)  VALUE SPACES.                  
           05  FIL11                  PIC X(01)  VALUE SPACES.                  
           05  L073C-TP-DATE          PIC X(10)  VALUE SPACES.                  
           05  FIL12                  PIC X(01)  VALUE SPACES.                  
           05  L073C-MONTHS           PIC X(12)  VALUE SPACES.                  
           05  FIL13                  PIC X(01)  VALUE SPACES.                  
           05  L073C-APPRVL-DT        PIC X(10)  VALUE SPACES.                  
           05  FIL14                  PIC X(01)  VALUE SPACES.                  
           05  L073C-EXPRY-DT         PIC X(10)  VALUE SPACES.                  
           05  FIL15                  PIC X(01)  VALUE SPACES.                  
           05  FIL16                  PIC X(40)  VALUE SPACES.                  
                                                                                
       COPY BE04W920.                                                           
       COPY BE04W930.                                                           
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-CONTROL.                                                            
      *-------------------------------------------------------------            
                                                                                
            PERFORM 1000-OPEN-FILES   THRU 1000-EXIT.                           
            PERFORM 1400-PRINT-L073A-MAIL-HDR THRU 1400-EXIT.                   
            PERFORM 1500-PRINT-L073B-MAIL-HDR THRU 1500-EXIT.                   
            PERFORM 1600-PRINT-L073C-MAIL-HDR THRU 1600-EXIT.                   
            PERFORM 1700-PRINT-L073D-MAIL-HDR THRU 1700-EXIT.                   
            PERFORM 2000-READ-BP13F716 THRU 2000-EXIT                           
                    UNTIL WS-F716-EOF = 'Y'.                                    
            PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       1000-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
                                                                                
            OPEN INPUT     BP13F716                                             
                           BP18K130                                             
                           BP18K140                                             
                           BP13K943                                             
                           BP13K940                                             
                           BE04K600                                             
                 OUTPUT    P13L073A                                             
                           P13L073B                                             
                           P13L073C                                             
                           P13L073D.                                            
                                                                                
            IF BP18K130-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'OPENING ERROR K130-FILE-STATUS IS : '                   
                                               BP18K130-FILE-STATUS             
               MOVE BP18K130-FILE-STATUS       TO   RETURN-CODE                 
               PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT                   
            END-IF.                                                             
                                                                                
            IF BP18K140-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'OPENING ERROR K140-FILE-STATUS IS : '                   
                                               BP18K140-FILE-STATUS             
               MOVE BP18K140-FILE-STATUS       TO   RETURN-CODE                 
               PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT                   
            END-IF.                                                             
                                                                                
            IF BP13K943-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'OPENING ERROR K943-FILE-STATUS IS : '                   
                                               BP13K943-FILE-STATUS             
               MOVE BP13K943-FILE-STATUS       TO   RETURN-CODE                 
               PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT                   
            END-IF.                                                             
                                                                                
            IF BP13K940-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'OPENING ERROR K940-FILE-STATUS IS : '                   
                                               BP13K940-FILE-STATUS             
               MOVE BP13K940-FILE-STATUS       TO   RETURN-CODE                 
               PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT                   
            END-IF.                                                             
                                                                                
            IF BE04K600-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'OPENING ERROR K600-FILE-STATUS IS : '                   
                                               BE04K600-FILE-STATUS             
               MOVE BE04K600-FILE-STATUS       TO   RETURN-CODE                 
               PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT                   
            END-IF.                                                             
                                                                                
            MOVE FUNCTION CURRENT-DATE  TO   WS-DATE.                           
            STRING WS-DATE(7:2) '/'                                             
                   WS-DATE(5:2) '/'                                             
                   WS-DATE(1:4)                                                 
                   DELIMITED BY SIZE INTO WS-L073A-DATE.                        
            MOVE WS-L073A-DATE           TO  WS-L073B-DATE                      
                                             MAIL-DATE.                         
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       1400-PRINT-L073A-MAIL-HDR.                                               
      *-------------------------------------------------------------            
           MOVE 1                          TO   WS-L073A-PAGE.                  
                                                                                
           WRITE L073A-PRTREC              FROM MAIL-HDR-HELO.                  
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-FROM.             
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-RCPT1.            
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-RCPT1A.           
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-RCPT2.            
           WRITE L073A-PRTREC              FROM MAIL-HDR-DATA.                  
           WRITE L073A-PRTREC              FROM MAIL-HDR-FROM.                  
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-TO-CC1.           
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-TO-CC1A.          
           WRITE L073A-PRTREC              FROM MAIL-HDR-MAIL-TO-CC2.           
           WRITE L073A-PRTREC              FROM MAIL-SUBJECT-L073A.             
           WRITE L073A-PRTREC              FROM MAIL-HDR-DATE.                  
           WRITE L073A-PRTREC              FROM MAIL-SPACES.                    
                                                                                
       1400-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1500-PRINT-L073B-MAIL-HDR.                                               
      *-------------------------------------------------------------            
           MOVE 1                          TO   WS-L073B-PAGE.                  
                                                                                
           WRITE L073B-PRTREC              FROM MAIL-HDR-HELO.                  
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-FROM.             
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-RCPT1.            
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-RCPT1A.           
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-RCPT2.            
           WRITE L073B-PRTREC              FROM MAIL-HDR-DATA.                  
           WRITE L073B-PRTREC              FROM MAIL-HDR-FROM.                  
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-TO-CC1.           
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-TO-CC1A.          
           WRITE L073B-PRTREC              FROM MAIL-HDR-MAIL-TO-CC2.           
           WRITE L073B-PRTREC              FROM MAIL-SUBJECT-L073B.             
           WRITE L073B-PRTREC              FROM MAIL-HDR-DATE.                  
           WRITE L073B-PRTREC              FROM MAIL-SPACES.                    
                                                                                
       1500-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1600-PRINT-L073C-MAIL-HDR.                                               
      *-------------------------------------------------------------            
      *    MOVE 1                          TO   WS-L073C-PAGE.                  
                                                                                
           WRITE P13L073C-REC              FROM MAIL-HDR-HELO.                  
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-FROM.             
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-RCPT1.            
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-RCPT1A.           
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-RCPT2.            
           WRITE P13L073C-REC              FROM MAIL-HDR-DATA.                  
           WRITE P13L073C-REC              FROM MAIL-HDR-FROM.                  
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-TO-CC1.           
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-TO-CC1A.          
           WRITE P13L073C-REC              FROM MAIL-HDR-MAIL-TO-CC2.           
           WRITE P13L073C-REC              FROM MAIL-SUBJECT-L073C.             
           WRITE P13L073C-REC              FROM MAIL-HDR-DATE.                  
           WRITE P13L073C-REC              FROM MAIL-SPACES.                    
                                                                                
           WRITE P13L073C-REC              FROM WS-L073C-HEADER.                
                                                                                
       1600-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1700-PRINT-L073D-MAIL-HDR.                                               
      *-------------------------------------------------------------            
      *    MOVE 1                          TO   WS-L073D-PAGE.                  
                                                                                
           WRITE P13L073D-REC              FROM MAIL-HDR-HELO.                  
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-FROM.             
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-RCPT1.            
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-RCPT1A.           
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-RCPT2.            
           WRITE P13L073D-REC              FROM MAIL-HDR-DATA.                  
           WRITE P13L073D-REC              FROM MAIL-HDR-FROM.                  
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-TO-CC1.           
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-TO-CC1A.          
           WRITE P13L073D-REC              FROM MAIL-HDR-MAIL-TO-CC2.           
           WRITE P13L073D-REC              FROM MAIL-SUBJECT-L073D.             
           WRITE P13L073D-REC              FROM MAIL-HDR-DATE.                  
           WRITE P13L073D-REC              FROM MAIL-SPACES.                    
                                                                                
           WRITE P13L073D-REC              FROM WS-L073C-HEADER.                
                                                                                
       1700-EXIT.                                                               
           EXIT.                                                                
                                                                                
       2000-READ-BP13F716.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13F716 AT END MOVE 'Y' TO WS-F716-EOF                         
                           GO TO 2000-EXIT.                                     
                                                                                
           ADD 1 TO WS-F716-READ.                                               
                                                                                
           IF F716-NUM-HDB-REF NOT = SPACES AND ZEROES AND LOW-VALUES           
              PERFORM  3000-PROCESS-BP13F716  THRU  3000-EXIT                   
           ELSE                                                                 
              DISPLAY 'INVALID HDBREFERENCE' F716-NUM-HDB-REF                   
              GO TO 2000-EXIT                                                   
           END-IF.                                                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       3000-PROCESS-BP13F716.                                                   
      *-------------------------------------------------------------            
                                                                                
            MOVE SPACES                    TO WS-L073-DET1                      
                                              WS-L073-DET2                      
                                              WS-L073C-DETAIL.                  
                                                                                
            MOVE F716-NUM-REGN             TO K943-NUM-REGN                     
                                              K940-NUM-REGN.                    
            MOVE F716-NUM-NRIC             TO K943-NUM-NRIC.                    
                                                                                
            PERFORM 3100-READ-BP13K943     THRU 3100-EXIT.                      
            IF BP13K943-FILE-STATUS NOT EQUAL 00                                
               GO TO 3000-EXIT.                                                 
                                                                                
            PERFORM 3500-READ-BP13K940     THRU 3500-EXIT.                      
                                                                                
            IF F716-NUM-NRIC NOT = SPACES AND LOW-VALUES                        
               MOVE F716-NUM-NRIC(1:1)     TO WS-PREFIX                         
               MOVE '-'                    TO WS-HIPHEN                         
               MOVE F716-NUM-NRIC(2:8)     TO WS-UIN                            
               MOVE WS-NUM-NRIC            TO WS-L073-UIN                       
               MOVE WS-NUM-NRIC(1:10)      TO L073C-IDENT-NO                    
            ELSE                                                                
               MOVE SPACES                 TO WS-L073-UIN                       
                                              L073C-IDENT-NO                    
            END-IF.                                                             
                                                                                
            IF F716-ADDRESS NOT = SPACES AND LOW-VALUES                         
               MOVE F716-NUM-MTH-RESIDE    TO WS-L073-MTH-RESIDE                
                                              L073C-MONTHS                      
               MOVE F716-NUM-REGN          TO WS-L073-REGNO                     
               MOVE F716-NUM-BLK           TO WS-BLK                            
               MOVE 'BLK: '                TO WS-BLK-CHAR                       
               MOVE '#'                    TO WS-HASH                           
               MOVE F716-NUM-HSELVL        TO WS-LEVEL                          
               MOVE '-'                    TO WS-HIPHEN4                        
               MOVE F716-NUM-HSEMAIN       TO WS-HSEMAIN                        
               IF F716-NUM-HSESUB NOT = SPACES AND LOW-VALUES                   
                  MOVE '-'                 TO WS-HIPHEN5                        
                  MOVE F716-NUM-HSESUB     TO WS-HSESUB                         
               ELSE                                                             
                  MOVE SPACES              TO WS-HIPHEN5                        
                  MOVE SPACES              TO WS-HSESUB                         
               END-IF                                                           
               MOVE F716-NUM-POSTAL-DSTRCT TO WS-POSTAL                         
               MOVE F716-NME-STREET        TO WS-STREET                         
               MOVE WS-ADDRESS             TO WS-L073-ADDRESS-2                 
                                              L073C-OLD-ADDRESS                 
               IF F716-NUM-ROLE = '003'                                         
                  MOVE 'RT'                TO WS-L073-ROLE-2                    
                                              L073C-OLD-ROLE                    
               END-IF                                                           
               IF F716-NUM-ROLE = '023'                                         
                  MOVE 'L'                 TO WS-L073-ROLE-2                    
                                              L073C-OLD-ROLE                    
               END-IF                                                           
               IF F716-NUM-ROLE = '024'                                         
                  MOVE 'CO'                TO WS-L073-ROLE-2                    
                                              L073C-OLD-ROLE                    
               END-IF                                                           
               IF F716-NUM-ROLE = '004' OR '025'                                
                  MOVE 'OC'                TO WS-L073-ROLE-2                    
                                              L073C-OLD-ROLE                    
               END-IF                                                           
            ELSE                                                                
               MOVE SPACES                 TO WS-L073-ADDRESS-2                 
                                              L073C-OLD-ADDRESS                 
            END-IF.                                                             
                                                                                
            MOVE SPACES                    TO WS-ADDRESS.                       
                                                                                
            STRING F716-NUM-HDB-REF(1:4) '-'                                    
                   F716-NUM-HDB-REF(5:4) '-'                                    
                   F716-NUM-HDB-REF(9:1) '-'                                    
                   F716-NUM-HDB-REF(10:2)                                       
                   DELIMITED BY SIZE INTO WS-L073-SCHACC.                       
                                                                                
            MOVE WS-L073-SCHACC            TO   L073C-OLD-SCH.                  
            MOVE SPACES                    TO   WS-L073-APPRVL-DTE              
                                                WS-L073-EXPIRY-DTE              
                                                L073C-APPRVL-DT                 
                                                L073C-EXPRY-DT.                 
            MOVE 'N'                       TO   WS-K600-EOF.                    
            MOVE 'N'                       TO   WS-K600-FOUND.                  
            MOVE F716-NUM-HDB-REF          TO   BE04K600-HDBREF.                
            MOVE SPACES                    TO   BE04K600-TYP-TRANS.             
            MOVE SPACES                    TO   BE04K600-DTE-CREATION.          
            MOVE ZEROS                     TO   WS-DATE-BE04                    
                                                WS-DATE-APPRVL                  
            START BE04K600 KEY IS >= BE04K600-KEY.                              
                                                                                
            IF BE04K600-FILE-STATUS = 00                                        
               PERFORM 3450-READ-BE04K600  THRU 3450-EXIT                       
               PERFORM 3400-CHECK-APPROVAL-DATE THRU 3400-EXIT                  
                    UNTIL (BE04K600-HDBREF    NOT = F716-NUM-HDB-REF)           
                    OR     WS-K600-EOF            = 'Y'                         
            ELSE                                                                
              IF BE04K600-FILE-STATUS = 23                                      
                MOVE SPACES                TO   WS-L073-APPRVL-DTE              
                MOVE SPACES                TO   WS-L073-EXPIRY-DTE              
                                                L073C-APPRVL-DT                 
                                                L073C-EXPRY-DT                  
              ELSE                                                              
                DISPLAY 'START ERROR IN BE04K600: ' BE04K600-FILE-STATUS        
                DISPLAY '   BE04K600-KEY = ' BE04K600-KEY                       
                PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                       
              END-IF                                                            
            END-IF                                                              
                                                                                
            MOVE F716-NUM-HDB-REF(1:9)     TO WS-NUM-SCH-9.                     
            PERFORM 8000-GET-OIC           THRU 8000-EXIT.                      
                                                                                
            MOVE 'N'                       TO   WS-K130-FOUND.                  
            PERFORM 3200-READ-K130-ALTKEY  THRU 3200-EXIT.                      
                                                                                
            IF WS-K130-FOUND = 'Y'                                              
               MOVE K130-NUM-PRJCT         TO   K140-NUM-PRJCT                  
               MOVE K130-NUM-POSTAL        TO   K140-NUM-POSTAL                 
               MOVE 'N'                    TO   WS-K140-FOUND                   
               PERFORM 3300-READ-BP18K140  THRU 3300-EXIT                       
            ELSE                                                                
               GO TO 3000-EXIT                                                  
            END-IF.                                                             
                                                                                
            IF WS-K140-FOUND = 'Y'                                              
               MOVE K130-NUM-POSTAL        TO   WS-POSTAL                       
               MOVE '#'                    TO   WS-HASH                         
               MOVE K130-NUM-LEVEL         TO   WS-LEVEL                        
               MOVE '-'                    TO   WS-HIPHEN4                      
               MOVE K130-NUM-UNIT          TO   WS-HSEMAIN                      
               MOVE SPACES                 TO   WS-HIPHEN5                      
               MOVE 'BLK: '                TO   WS-BLK-CHAR                     
               MOVE K140-NUM-BLOCK         TO   WS-BLK                          
               MOVE K140-TXT-ADDR1         TO   WS-STREET                       
               MOVE WS-ADDRESS             TO   WS-L073-ADDRESS-1               
                                                L073C-NEW-ADDRESS               
               IF K943-NUM-OCPR-ROLE NOT = 'SUBT'                               
                  MOVE K943-NUM-OCPR-ROLE  TO   WS-L073-ROLE-1                  
                                                L073C-NEW-ROLE                  
               END-IF                                                           
               MOVE K130-NUM-REGN          TO   L073C-NEW-REGN                  
            ELSE                                                                
               GO TO 3000-EXIT                                                  
            END-IF.                                                             
                                                                                
            MOVE SPACES                    TO   WS-ADDRESS.                     
                                                                                
            PERFORM 4000-PRINT-RTN         THRU    4000-EXIT.                   
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3100-READ-BP13K943.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ  BP13K943.                                                      
                                                                                
           EVALUATE BP13K943-FILE-STATUS                                        
             WHEN 00                                                            
                  MOVE K943-NME-OCCP(1:20)  TO WS-L073-NAME                     
                                               L073C-NAME                       
                  ADD  1   TO WS-K943-READ                                      
             WHEN 23                                                            
                  DISPLAY 'BP13K943 RECORD NOT FOUND  = '                       
                               BP13K943-FILE-STATUS                             
                          ',  K943-KEY-FLD = '  K943-KEY-FLD                    
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP13K943 = '                           
                               BP13K943-FILE-STATUS                             
                          ',  K943-KEY-FLD = '  K943-KEY-FLD                    
                  PERFORM 9000-CLOSE-FILES   THRU  9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3200-READ-K130-ALTKEY.                                                   
      *-------------------------------------------------------------            
                                                                                
           INITIALIZE BP18K130-REC.                                             
           MOVE F716-NUM-REGN  TO K130-NUM-REGN.                                
                                                                                
           READ BP18K130                                                        
                KEY IS K130-NUM-REGN                                            
           END-READ.                                                            
                                                                                
           EVALUATE BP18K130-FILE-STATUS                                        
             WHEN 00                                                            
             WHEN 02                                                            
                  IF K130-NUM-REGN EQUAL F716-NUM-REGN                          
                     ADD   1   TO WS-K130-READ                                  
                     MOVE 'Y'  TO WS-K130-FOUND                                 
                  END-IF                                                        
             WHEN 10                                                            
                  DISPLAY 'END OF FILE  BP18K130 = '                            
                                BP18K130-FILE-STATUS                            
                          ',  K130-NUM-REGN = ' K130-NUM-REGN                   
             WHEN 23                                                            
                  DISPLAY 'REC NOT FND  BP18K130 = '                            
                                BP18K130-FILE-STATUS                            
                          ',  K130-NUM-REGN = ' K130-NUM-REGN                   
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP18K130 = '                           
                                BP18K130-FILE-STATUS                            
                          ',  K130-KEY-FLD = ' K130-KEY-FLD                     
                  PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3300-READ-BP18K140.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ  BP18K140.                                                      
                                                                                
           EVALUATE BP18K140-FILE-STATUS                                        
             WHEN 00                                                            
                  ADD   1   TO WS-K140-READ                                     
                  MOVE 'Y'  TO WS-K140-FOUND                                    
             WHEN 23                                                            
                  DISPLAY 'BP18K140 RECORD NOT FOUND  = '                       
                               BP18K140-FILE-STATUS                             
                          ',  K140-KEY-FLD = '  K140-KEY-FLD                    
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP18K140 = '                           
                               BP18K140-FILE-STATUS                             
                          ',  K140-KEY-FLD = '  K140-KEY-FLD                    
                  PERFORM 9000-CLOSE-FILES   THRU  9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       3300-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3400-CHECK-APPROVAL-DATE.                                                
      *-------------------------------------------------------------            
                                                                                
           IF  BE04K600-HDBREF  = F716-NUM-HDB-REF                              
           AND (BE04K600-TYP-TRANS = '00002' OR '00003' OR '00102')             
              IF BE04K600-DTE-APPROVAL NOT = SPACES AND ZEROS                   
                 MOVE BE04K600-DTE-APPROVAL(1:4) TO WS-YY                       
                 MOVE BE04K600-DTE-APPROVAL(6:2) TO WS-MM                       
                 MOVE BE04K600-DTE-APPROVAL(9:2) TO WS-DD                       
                                                                                
                 IF WS-DATE-BE04 > WS-DATE-APPRVL                               
                    MOVE WS-DATE-BE04          TO  WS-DATE-APPRVL               
                    STRING BE04K600-DTE-APPROVAL(9:2) '/'                       
                         BE04K600-DTE-APPROVAL(6:2) '/'                         
                         BE04K600-DTE-APPROVAL(1:4)                             
                         DELIMITED BY SIZE      INTO WS-L073-APPRVL-DTE         
                    MOVE WS-L073-APPRVL-DTE       TO L073C-APPRVL-DT            
                 END-IF                                                         
                                                                                
                 IF BE04K600-TYP-TRANS = '00003' OR '00102'                     
                    IF WS-DATE-BE04 >= '20140427'                               
                                                                                
                      COMPUTE WS-YY = WS-YY + 3                                 
                                                                                
                      STRING WS-DATE-BE04(7:2) '/'                              
                             WS-DATE-BE04(5:2) '/'                              
                             WS-DATE-BE04(1:4)                                  
                         DELIMITED BY SIZE    INTO WS-L073-EXPIRY-DTE           
                      MOVE WS-L073-EXPIRY-DTE    TO L073C-EXPRY-DT              
                    END-IF                                                      
                 ELSE                                                           
                    IF BE04K600-DTE-EXPIRY   NOT = SPACES                       
                       STRING BE04K600-DTE-EXPIRY(9:2) '/'                      
                         BE04K600-DTE-EXPIRY(6:2) '/'                           
                         BE04K600-DTE-EXPIRY(1:4)                               
                         DELIMITED BY SIZE    INTO   WS-L073-EXPIRY-DTE         
                       MOVE WS-L073-EXPIRY-DTE    TO L073C-EXPRY-DT             
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              MOVE 'Y' TO  WS-K600-EOF                                          
           END-IF.                                                              
                                                                                
           PERFORM 3450-READ-BE04K600  THRU 3450-EXIT.                          
                                                                                
       3400-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3450-READ-BE04K600.                                                      
                                                                                
           READ  BE04K600 NEXT AT END MOVE 'Y' TO WS-K600-EOF                   
                                      GO TO 3450-EXIT.                          
                                                                                
           ADD 1 TO WS-K600-READ.                                               
                                                                                
       3450-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3500-READ-BP13K940.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ  BP13K940.                                                      
                                                                                
           EVALUATE BP13K940-FILE-STATUS                                        
             WHEN 00                                                            
                  IF K940-DTE-IND-TOP(1:4) NOT = SPACES AND LOW-VALUES          
                     STRING K940-DTE-IND-TOP(1:4) '/'                           
                            K940-DTE-IND-TOP(5:2) '/'                           
                            K940-DTE-IND-TOP(7:2)                               
                         DELIMITED BY SIZE INTO L073C-TP-DATE                   
                  ELSE                                                          
                     MOVE SPACES         TO L073C-TP-DATE                       
                  END-IF                                                        
                  ADD  1   TO WS-K940-READ                                      
             WHEN 23                                                            
                  MOVE SPACES            TO L073C-TP-DATE                       
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP13K943 = '                           
                               BP13K943-FILE-STATUS                             
                          ',  K943-KEY-FLD = '  K943-KEY-FLD                    
                  PERFORM 9000-CLOSE-FILES   THRU  9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       3500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       4000-PRINT-RTN.                                                          
      *-------------------------------------------------------------            
                                                                                
           IF F716-NUM-BO-CURR = SPACES OR LOW-VALUES                           
              DISPLAY 'BO CODE NOT AVAILABLE, UIN IS ' F716-NUM-NRIC            
              GO TO 4000-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF (WS-NUM-PG-REC-L073 > 17) OR                                      
              (WS-BO NOT = F716-NUM-BO-CURR)                                    
                                                                                
              MOVE ZERO                   TO   WS-NUM-PG-REC-L073               
                                                                                
              IF WS-BO NOT = F716-NUM-BO-CURR                                   
                 MOVE   1                 TO   WS-CNT-PAGE                      
                 MOVE   ZERO              TO   WS-CNT-L073                      
              ELSE                                                              
                 ADD    1                 TO   WS-CNT-PAGE                      
              END-IF                                                            
                                                                                
              MOVE WS-CNT-PAGE            TO   WS-L073A-PAGE                    
                                               WS-L073B-PAGE                    
                                                                                
              MOVE F716-NUM-BO-CURR       TO   WS-L073-BO                       
                                                                                
              IF F716-OWNER-OCCUPIER-FLAG = 'L'                                 
                 PERFORM 5000-PRINT-L073A-HDR  THRU 5000-EXIT                   
              END-IF                                                            
              IF F716-OWNER-OCCUPIER-FLAG = 'O' OR 'K'                          
                 PERFORM 5500-PRINT-L073B-HDR  THRU 5500-EXIT                   
              END-IF                                                            
                                                                                
           END-IF.                                                              
                                                                                
           ADD    1                 TO   WS-CNT-L073                            
                                         WS-CNT-SN                              
                                         WS-NUM-PG-REC-L073.                    
           MOVE WS-CNT-L073         TO   WS-L073-CNT.                           
           MOVE WS-CNT-SN           TO   L073C-CNT.                             
           MOVE F716-NUM-BO-CURR    TO   WS-BO.                                 
           PERFORM 8500-GET-ZONE   THRU 8500-EXIT.                              
                                                                                
           IF F716-OWNER-OCCUPIER-FLAG = 'L'                                    
              PERFORM 6000-PRINT-P13L073A   THRU 6000-EXIT                      
              PERFORM 7000-PRINT-P13L073C   THRU 7000-EXIT                      
           END-IF.                                                              
           IF F716-OWNER-OCCUPIER-FLAG = 'O' OR 'K'                             
              PERFORM 6500-PRINT-P13L073B   THRU 6500-EXIT                      
              PERFORM 7500-PRINT-P13L073D   THRU 7500-EXIT                      
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5000-PRINT-L073A-HDR.                                                    
      *-------------------------------------------------------------            
           WRITE L073A-PRTREC       FROM  WS-L073A-HDNG1 AFTER PAGE.            
           WRITE L073A-PRTREC       FROM  WS-L073A-HDNG2.                       
                                                                                
           WRITE L073A-PRTREC       FROM  WS-L073-HDNG3.                        
           MOVE SPACES              TO    L073A-PRTREC.                         
           WRITE L073A-PRTREC.                                                  
           WRITE L073A-PRTREC       FROM  WS-L073-HDNG4.                        
           WRITE L073A-PRTREC       FROM  WS-L073-HDNG5.                        
           WRITE L073A-PRTREC       FROM  WS-L073-LINE.                         
           MOVE SPACES              TO    L073A-PRTREC.                         
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5500-PRINT-L073B-HDR.                                                    
      *-------------------------------------------------------------            
                                                                                
           WRITE L073B-PRTREC       FROM  WS-L073B-HDNG1 AFTER PAGE.            
           WRITE L073B-PRTREC       FROM  WS-L073B-HDNG2.                       
                                                                                
           WRITE L073B-PRTREC       FROM  WS-L073-HDNG3.                        
           MOVE SPACES              TO    L073B-PRTREC.                         
           WRITE L073B-PRTREC.                                                  
           WRITE L073B-PRTREC       FROM  WS-L073-HDNG4.                        
           WRITE L073B-PRTREC       FROM  WS-L073-HDNG5.                        
           WRITE L073B-PRTREC       FROM  WS-L073-LINE.                         
           MOVE SPACES              TO    L073B-PRTREC.                         
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       6000-PRINT-P13L073A.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE   SPACES            TO    L073A-PRTREC.                         
           WRITE  L073A-PRTREC.                                                 
           WRITE  L073A-PRTREC      FROM  WS-L073-DET1.                         
           WRITE  L073A-PRTREC      FROM  WS-L073-DET2.                         
           MOVE   SPACES            TO    L073A-PRTREC.                         
                                                                                
       6000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       6500-PRINT-P13L073B.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE   SPACES            TO    L073B-PRTREC.                         
           WRITE  L073B-PRTREC.                                                 
           WRITE  L073B-PRTREC      FROM  WS-L073-DET1.                         
           WRITE  L073B-PRTREC      FROM  WS-L073-DET2.                         
           MOVE   SPACES            TO    L073B-PRTREC.                         
                                                                                
       6500-EXIT.                                                               
            EXIT.                                                               
                                                                                
       7000-PRINT-P13L073C.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE   SPACES            TO    P13L073C-REC.                         
           MOVE ';'                 TO FIL01  FIL02  FIL03  FIL04               
                                       FIL05  FIL06  FIL07  FIL08               
                                       FIL09  FIL10  FIL11  FIL12               
                                       FIL13  FIL14  FIL15.                     
           WRITE  P13L073C-REC      FROM  WS-L073C-DETAIL.                      
           MOVE   SPACES            TO    P13L073C-REC.                         
                                                                                
       7000-EXIT.                                                               
            EXIT.                                                               
                                                                                
       7500-PRINT-P13L073D.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE   SPACES            TO    P13L073D-REC.                         
           MOVE ';'                 TO FIL01  FIL02  FIL03  FIL04               
                                       FIL05  FIL06  FIL07  FIL08               
                                       FIL09  FIL10  FIL11  FIL12               
                                       FIL13  FIL14  FIL15.                     
                                                                                
           WRITE  P13L073D-REC      FROM  WS-L073C-DETAIL.                      
           MOVE   SPACES            TO    P13L073D-REC.                         
                                                                                
       7500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
      * Getting OIC Information By Calling BE04C921                             
      *-------------------------------------------------------------            
       8000-GET-OIC.                                                            
      *-------------------------------------------------------------            
           MOVE SPACES                  TO  BE04C920-INPUT-INFO.                
           MOVE F716-NUM-HDB-REF        TO  BE04C920-IN-HDBREF.                 
           MOVE 'BP13'                  TO  BE04C920-IN-NUM-SYSTEM.             
           MOVE '10067'                 TO  BE04C920-IN-NUM-FNCTN-SRVC.         
           MOVE 'EM'                    TO  BE04C920-IN-NUM-UNIT-ROLE.          
                                                                                
           CALL 'BE04C921'   USING BE04C920-RECORD.                             
                                                                                
           IF BE04C920-OUT-RTN-MSGNO(1) = '0000'                                
              MOVE  BE04C920-OUT-NUM-OIC(1)  TO L073C-OLD-OIC                   
           ELSE                                                                 
             IF BE04C920-OUT-RTN-MSGNO(1) = '0001'                              
                DISPLAY 'NO RECORD FOUND'                                       
             END-IF                                                             
             IF BE04C920-OUT-RTN-MSGNO(1) = '0002'                              
                DISPLAY 'NO RIGHTS TO RETRIEVE THE OICS'                        
             END-IF                                                             
             IF BE04C920-OUT-RTN-MSGNO(1) = '0006'                              
              DISPLAY 'HDB REFERENCE IS INVALID OR NOT FOUND IN PIDB'           
                                                                                
             END-IF                                                             
             IF BE04C920-OUT-RTN-MSGNO(1) = '0400'                              
               DISPLAY 'HDB REF/FUNC ID/SYSTEM ID/UNIT ROLE IS MISSING'         
                                                                                
             END-IF                                                             
             IF BE04C920-OUT-RTN-MSGNO(1) = '0203'                              
               DISPLAY 'OTHER DB2 ERROR: ' BE04C920-OUT-SQLCODE(1)              
             END-IF                                                             
           END-IF.                                                              
                                                                                
       8000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8500-GET-ZONE.                                                           
      *-------------------------------------------------------------            
           MOVE SPACES                  TO  BE04C930-INPUT-INFO.                
           MOVE F716-NUM-BO-CURR        TO  BE04C930-IN-NUM-BRANCH.             
                                                                                
           CALL 'BE04C930'   USING BE04C930-RECORD.                             
                                                                                
           IF BE04C930-OUT-RTN-MSGNO(1) = '0000'                                
              MOVE  BE04C930-OUT-NUM-ZONE(1) TO L073C-OLD-ZONE                  
           ELSE                                                                 
             IF BE04C930-OUT-RTN-MSGNO(1) = '0001'                              
                DISPLAY 'NO RECORD FOUND'                                       
             END-IF                                                             
             IF BE04C930-OUT-RTN-MSGNO(1) = '0400'                              
                DISPLAY 'BAD REQUEST/ MANDATORY FIELD EMPTY'                    
             END-IF                                                             
             IF BE04C930-OUT-RTN-MSGNO(1) = '0203'                              
                DISPLAY 'OTHER DB2 ERROR: ' BE04C930-OUT-SQLCODE(1)             
             END-IF                                                             
             DISPLAY 'NUM BO CURR (BRANCH):' BE04C930-IN-NUM-BRANCH             
           END-IF.                                                              
                                                                                
       8500-EXIT.                                                               
            EXIT.                                                               
                                                                                
       9000-CLOSE-FILES.                                                        
      *-------------------------------------------------------------            
           CLOSE BP13F716                                                       
                 BP18K130                                                       
                 BP18K140                                                       
                 BP13K943                                                       
                 BP13K940                                                       
                 BE04K600                                                       
                 P13L073A                                                       
                 P13L073B                                                       
                 P13L073C                                                       
                 P13L073D.                                                      
                                                                                
            IF BP18K130-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'CLOSING ERROR K130-FILE-STATUS IS : '                   
                                               BP18K130-FILE-STATUS             
               MOVE BP18K130-FILE-STATUS       TO   RETURN-CODE                 
            END-IF.                                                             
                                                                                
            IF BP18K140-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'CLOSING ERROR K140-FILE-STATUS IS : '                   
                                               BP18K140-FILE-STATUS             
               MOVE BP18K140-FILE-STATUS       TO   RETURN-CODE                 
            END-IF.                                                             
                                                                                
            IF BP13K943-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'CLOSING ERROR K943-FILE-STATUS IS : '                   
                                               BP13K943-FILE-STATUS             
               MOVE BP13K943-FILE-STATUS       TO   RETURN-CODE                 
            END-IF.                                                             
                                                                                
            IF BP13K940-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'CLOSING ERROR K940-FILE-STATUS IS : '                   
                                               BP13K940-FILE-STATUS             
               MOVE BP13K940-FILE-STATUS       TO   RETURN-CODE                 
            END-IF.                                                             
                                                                                
            IF BE04K600-FILE-STATUS NOT = 00 AND 97                             
               DISPLAY 'CLOSING ERROR K600-FILE-STATUS IS : '                   
                                               BE04K600-FILE-STATUS             
               MOVE BE04K600-FILE-STATUS       TO   RETURN-CODE                 
            END-IF.                                                             
                                                                                
           DISPLAY ' - BP13C073 CONTROL TOTAL ---------'.                       
           DISPLAY ' BP13F716 RECORDS READ   :' WS-F716-READ.                   
           DISPLAY ' BP13K943 RECORDS READ   :' WS-K943-READ.                   
           DISPLAY ' BP18K130 RECORDS READ   :' WS-K130-READ.                   
           DISPLAY ' BP18K140 RECORDS READ   :' WS-K140-READ.                   
           DISPLAY ' BE04K600 RECORDS READ   :' WS-K600-READ.                   
           DISPLAY ' '.                                                         
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
