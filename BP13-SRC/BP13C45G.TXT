       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C45G.                                                 
      *AUTHOR.        KSJ3.                                                     
      *DATE-WRITTEN.  04/11/2016.                                               
      * ========================================================== *            
      * OBJECTIVE    : DAILY PROGRAM TO:                           *            
      *                (1) CREATE REPORT ON SELF BOOKED REGNS      *            
      *                (2) UPDATE BP13KC20 ON REGNS TO BE AUTO     *            
      *                    BOOKED BY SYSTEM                        *            
      *                (3) CREATE BP13FC30 LIST OF UNUSED SLOTS    *            
      *                    TO BE SWITCHED TO MANUAL (BP13C45H)     *            
      * ========================================================== *            
      * INPUT  FILES :  1.) BP13FC20                               *            
      *                 2.) BP13KC30                               *            
      *                 3.) BP13K452                               *            
      *                 4.) BP13K454                               *            
      * I-O    FILES :  1.) BP13KC20                               *            
      *                 2.) BP13K800                               *            
      * OUTPUT       :  1.) BP13FC30                               *            
      *                 2.) BP13FC2A                               *            
      * LISTING      :  1.) P13L45GA                               *            
      *                 2.) P13L45GB                               *            
      *                 3.) P13L45GC                               *            
      *                 4.) P13L45GD                               *            
      * ========================================================== *            
      * CHG-NO   BY   DATE       DESCRIPTION                       *            
      * -------- ---  ------     -----------                       *            
      * BP136580 KSJ3 04/11/2016 NEW PROGRAM                       *            
      * BP136561 KSJ3 13/01/2017 INCL WRITE TO BP13FC2A            *            
      * BP136574 KSJ3 03/02/2017 PROCESS 4000 EVEN IF CNT = 0      *            
      *                          MOVE STATUS, APPT DATE/TIME TO    *            
      *                          -CLOSE FIELDS FOR ONLINE DISPLAY  *            
      * BP136561 KSJ3 21/02/2017 DISALLOW AUTOBOOK FOR REGNS WITH  *            
      *                          MANUAL BOOKING                    *            
      * BP136797 KSJ3 25/05/2017 TO CATER FOR K800-DTE-TP-ORIG     *            
      * BP136980 RJB1 06/11/2017 TO CATER FOR SATP CASE (WP)       *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13FC20  ASSIGN        TO BP13FC20.                          
                                                                                
           SELECT BP13KC20  ASSIGN        TO BP13KC20                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KC20-KEY-FLD                       
                            ALTERNATE KEY IS KC20-ALT-KEY                       
                            FILE STATUS   IS WS-KC20-STATUS.                    
                                                                                
           SELECT BP13KC30  ASSIGN        TO BP13KC30                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KC30-KEY-FLD                       
                            ALTERNATE KEY IS KC30-ALT-KEY2                      
                            FILE STATUS   IS WS-KC30-STATUS.                    
                                                                                
           SELECT BP13K452  ASSIGN        TO BP13K452                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K452-KEY-FLD                       
                            FILE STATUS   IS WS-K452-STATUS.                    
                                                                                
           SELECT BP13K454  ASSIGN        TO BP13K454                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K454-KEY-FLD                       
                            ALTERNATE KEY IS K454-ALT1-KEY                      
                            FILE STATUS   IS WS-K454-STATUS.                    
                                                                                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS WS-K800-STATUS.                    
                                                                                
           SELECT BP13FC30  ASSIGN        TO BP13FC30.                          
                                                                                
           SELECT BP13FC2A  ASSIGN        TO BP13FC2A.                          
                                                                                
           SELECT P13L45GA  ASSIGN        TO P13L45GA.                          
                                                                                
           SELECT P13L45GB  ASSIGN        TO P13L45GB.                          
                                                                                
           SELECT P13L45GC  ASSIGN        TO P13L45GC.                          
                                                                                
           SELECT P13L45GD  ASSIGN        TO P13L45GD.                          
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13FC20                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 150 CHARACTERS.                                      
           COPY BP13FC20.                                                       
                                                                                
       FD  BP13KC20                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
           COPY BP13KC20.                                                       
                                                                                
       FD  BP13KC30                                                             
           RECORD CONTAINS 200 CHARACTERS.                                      
           COPY BP13KC30.                                                       
                                                                                
       FD  BP13K452                                                             
           RECORD CONTAINS 1000 CHARACTERS.                                     
           COPY BP13K452.                                                       
                                                                                
       FD  BP13K454                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
           COPY BP13K454.                                                       
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
           COPY BP13K800.                                                       
                                                                                
       FD  BP13FC30                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 200 CHARACTERS.                                      
           COPY BP13FC30.                                                       
                                                                                
       FD  BP13FC2A                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 150 CHARACTERS.                                      
       01  BP13FC2A-REC                  PIC X(150).                            
                                                                                
       FD  P13L45GA                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132  CHARACTERS.                                     
       01  P13L45GA-REC                  PIC X(132).                            
                                                                                
       FD  P13L45GB                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132  CHARACTERS.                                     
       01  P13L45GB-REC                  PIC X(132).                            
                                                                                
       FD  P13L45GC                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132  CHARACTERS.                                     
       01  P13L45GC-REC                  PIC X(132).                            
                                                                                
       FD  P13L45GD                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132  CHARACTERS.                                     
       01  P13L45GD-REC                  PIC X(132).                            
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
                                                                                
      *-------------------------------------------------------------            
       01  WS-FILE-STATUS.                                                      
           05  WS-KC20-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-KC30-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-K452-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-K454-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-K800-STATUS            PIC 9(2)   VALUE ZEROES.               
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-CNT-FC20-READ          PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-FC20-SKIP          PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-KC20-UPD           PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-K800-UPD           PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-FC30-WRITE         PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-FC2A-WRITE         PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-L45GA-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-L45GB-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-L45GC-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-L45GD-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-PAGE-A             PIC 9(4)   VALUE ZEROES.               
           05  WS-CNT-PAGE-B             PIC 9(4)   VALUE ZEROES.               
           05  WS-CNT-PAGE-C             PIC 9(4)   VALUE ZEROES.               
           05  WS-CNT-PAGE-D             PIC 9(4)   VALUE ZEROES.               
           05  WS-CNT-LINE-A             PIC 9(2)   VALUE 99.                   
           05  WS-CNT-LINE-B             PIC 9(2)   VALUE 99.                   
           05  WS-CNT-LINE-C             PIC 9(2)   VALUE 99.                   
           05  WS-CNT-LINE-D             PIC 9(2)   VALUE 99.                   
           05  WS-CNT-SNO-A              PIC 9(5)   VALUE ZEROES.               
           05  WS-CNT-SNO-B              PIC 9(5)   VALUE ZEROES.               
           05  WS-CNT-SNO-C              PIC 9(5)   VALUE ZEROES.               
           05  WS-CNT-SNO-D              PIC 9(5)   VALUE ZEROES.               
                                                                                
       01  WS-FLAGS.                                                            
           05  WS-FC20-EOF               PIC X(1)   VALUE 'N'.                  
           05  WS-KC20-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-KC30-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-KC30-EOF               PIC X(1)   VALUE 'N'.                  
           05  WS-K452-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-K454-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-K800-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-PIDB-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-DTE-FND                PIC X(1)   VALUE 'N'.                  
           05  WS-TME-FND                PIC X(1)   VALUE 'N'.                  
           05  WS-TIME-FND-FL            PIC X(1)   VALUE 'N'.                  
           05  WS-NUM-SBK                PIC X(1)   VALUE 'N'.                  
                                                                                
       01  WS-DATE.                                                             
           05  WS-DTE-FMT8.                                                     
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-FMT10.                                                    
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-CURR-8             PIC 9(8)   VALUE ZEROES.               
           05  WS-DTE-CURR-10            PIC X(10)  VALUE ZEROES.               
           05  WS-DTE-SENT-PREV          PIC X(8)   VALUE SPACES.               
           05  WS-TIME-RUN               PIC X(8)   VALUE ZEROES.               
                                                                                
       01  WS-ARRAY-VARS.                                                       
           05  WS-I                      PIC 9(2)   VALUE ZEROES.               
           05  WS-J                      PIC 9(2)   VALUE ZEROES.               
           05  WS-K                      PIC 9(2)   VALUE ZEROES.               
           05  WS-I-MAX                  PIC 9(2)   VALUE 60.                   
           05  WS-J-MAX                  PIC 9(2)   VALUE 18.                   
           05  WS-K-MAX                  PIC 9(2)   VALUE 60.                   
           05  FILLER OCCURS 60 TIMES.                                          
               10  WS-ARR-DTE-SENT       PIC X(8)   VALUE SPACES.               
               10  WS-ARR-NUM-APPT-TYPE  PIC X(4)   VALUE SPACES.               
               10  WS-ARR-NUM-REGN       PIC X(8)   VALUE SPACES.               
           05  FILLER OCCURS 60 TIMES.                                          
               10  WS-BP13KC30-REC       PIC X(200) VALUE SPACES.               
                                                                                
       01  WS-BP13FC30-REC.                                                     
           05  FILLER                    PIC X(28).                             
           05  WS-FC30-CNT-REC           PIC 9(02).                             
           05  FILLER                    PIC X(170).                            
                                                                                
       01  WS-OTHERS.                                                           
           05  WS-CNT-VACANT             PIC S9(2)  VALUE ZEROES.               
           05  WS-NUM-DESC               PIC X(60)  VALUE SPACES.               
           05  WS-SQL-CODE               PIC 9(4)   VALUE 0.                    
           05  WS-DTE-1ST-AVAIL          PIC X(8)   VALUE SPACES.               
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT - SUCCESSFUL                                           
      *-------------------------------------------------------------            
       01  L45GA-PR-HEAD-01.                                                    
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45GA'.           
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.             
           05  FILLER                 PIC X(25)   VALUE SPACES.                 
           05  FILLER                 PIC X(39)   VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                 PIC X(13)   VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.               
           05  L45GA-CURRENT-DATE     PIC X(10)   VALUE SPACES.                 
           05  FILLER                 PIC X(3)    VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.               
           05  L45GA-PAGE             PIC ZZZ9.                                 
                                                                                
       01  L45GA-PR-HEAD-02.                                                    
           05  FILLER                 PIC X(27)   VALUE SPACES.                 
           05  FILLER                 PIC X(77)   VALUE                         
              'LIST OF REGNS SENT FOR SELF BOOKING WHO HAVE SUCCESSFULLY        
      -       ' BOOKED APPOINTMENTS'.                                           
                                                                                
       01  L45GA-PR-TITLE-1.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              'S/NO     SMS DATE     REGN         APPT TYPE     APPT DAT        
      -       'E     APPT TIME     SBK'.                                        
                                                                                
       01  L45GA-PR-TITLE-2.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              '----     --------     --------     ---------     --------        
      -       '-     ---------     ---'.                                        
                                                                                
       01  L45GA-PR-DTL.                                                        
           05  L45GA-NUM-SNO          PIC ZZZ9.                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GA-DTE-SENT         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GA-NUM-REGN         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GA-NUM-APPT-TYPE    PIC X(4).                                 
           05  FILLER                 PIC X(10)   VALUE SPACES.                 
           05  L45GA-DTE-APPT         PIC X(8).                                 
           05  FILLER                 PIC X(6)    VALUE SPACES.                 
           05  L45GA-TME-APPT         PIC X(5).                                 
           05  FILLER                 PIC X(9)    VALUE SPACES.                 
           05  L45GA-NUM-SBK          PIC X(1).                                 
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT - AUTO BOOKED                                          
      *-------------------------------------------------------------            
       01  L45GB-PR-HEAD-01.                                                    
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45GB'.           
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.             
           05  FILLER                 PIC X(25)   VALUE SPACES.                 
           05  FILLER                 PIC X(39)   VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                 PIC X(13)   VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.               
           05  L45GB-CURRENT-DATE     PIC X(10)   VALUE SPACES.                 
           05  FILLER                 PIC X(3)    VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.               
           05  L45GB-PAGE             PIC ZZZ9.                                 
                                                                                
       01  L45GB-PR-HEAD-02.                                                    
           05  FILLER                 PIC X(33)   VALUE SPACES.                 
           05  FILLER                 PIC X(66)   VALUE                         
              'LIST OF REGNS SENT FOR SELF BOOKING WHO WERE AUTO BOOKED         
      -       'BY SYSTEM'.                                                      
                                                                                
       01  L45GB-PR-TITLE-1.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              'S/NO     SMS DATE     REGN         APPT TYPE     APPT DAT        
      -       'E     APPT TIME'.                                                
                                                                                
       01  L45GB-PR-TITLE-2.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              '----     --------     --------     ---------     --------        
      -       '-     ---------'.                                                
                                                                                
       01  L45GB-PR-DTL.                                                        
           05  L45GB-NUM-SNO          PIC ZZZ9.                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GB-DTE-SENT         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GB-NUM-REGN         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GB-NUM-APPT-TYPE    PIC X(4).                                 
           05  FILLER                 PIC X(10)   VALUE SPACES.                 
           05  L45GB-DTE-APPT         PIC X(8).                                 
           05  FILLER                 PIC X(6)    VALUE SPACES.                 
           05  L45GB-TME-APPT         PIC X(5).                                 
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT - EXEPTION REPORT                                      
      *-------------------------------------------------------------            
       01  L45GC-PR-HEAD-01.                                                    
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45GC'.           
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.             
           05  FILLER                 PIC X(25)   VALUE SPACES.                 
           05  FILLER                 PIC X(39)   VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                 PIC X(13)   VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.               
           05  L45GC-CURRENT-DATE     PIC X(10)   VALUE SPACES.                 
           05  FILLER                 PIC X(3)    VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.               
           05  L45GC-PAGE             PIC ZZZ9.                                 
                                                                                
       01  L45GC-PR-HEAD-02.                                                    
           05  FILLER                 PIC X(40)   VALUE SPACES.                 
           05  FILLER                 PIC X(51)   VALUE                         
              'EXCEPTION REPORT FOR AUTO SCHEDULED SELF BOOK CASES'.            
                                                                                
       01  L45GC-PR-TITLE-1.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              'S/NO     SENT DATE     REGN         APPT TYPE     ERROR D        
      -       'ESCRIPTION'.                                                     
                                                                                
       01  L45GC-PR-TITLE-2.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              '----     ---------     --------     ---------     -------        
      -       '-----------------------------------------------------'.          
                                                                                
       01  L45GC-PR-DTL.                                                        
           05  L45GC-NUM-SNO          PIC ZZZ9.                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GC-DTE-SENT         PIC X(8).                                 
           05  FILLER                 PIC X(6)    VALUE SPACES.                 
           05  L45GC-NUM-REGN         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GC-NUM-APPT-TYPE    PIC X(4).                                 
           05  FILLER                 PIC X(10)   VALUE SPACES.                 
           05  L45GC-NUM-DESC         PIC X(60).                                
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT - OPT-OUT                                              
      *-------------------------------------------------------------            
       01  L45GD-PR-HEAD-01.                                                    
           05  FILLER                 PIC X(14)   VALUE 'BP13-L45GD'.           
           05  FILLER                 PIC X(8)    VALUE 'HDB3    '.             
           05  FILLER                 PIC X(25)   VALUE SPACES.                 
           05  FILLER                 PIC X(39)   VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                 PIC X(13)   VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'DATE: '.               
           05  L45GD-CURRENT-DATE     PIC X(10)   VALUE SPACES.                 
           05  FILLER                 PIC X(3)    VALUE SPACES.                 
           05  FILLER                 PIC X(7)    VALUE 'PAGE: '.               
           05  L45GD-PAGE             PIC ZZZ9.                                 
                                                                                
       01  L45GD-PR-HEAD-02.                                                    
           05  FILLER                 PIC X(40)   VALUE SPACES.                 
           05  FILLER                 PIC X(52)   VALUE                         
              'LIST OF REGNS SENT FOR SELF BOOKING WHO HAVE OPT-OUT'.           
                                                                                
       01  L45GD-PR-TITLE-1.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              'S/NO     SMS DATE     REGN         APPT TYPE     CRM ID          
      -       '     DATE         TIME'.                                         
                                                                                
       01  L45GD-PR-TITLE-2.                                                    
           05  FILLER                 PIC X(132)  VALUE                         
              '----     --------     --------     ---------     --------        
      -       '     --------     -----'.                                        
                                                                                
       01  L45GD-PR-DTL.                                                        
           05  L45GD-NUM-SNO          PIC ZZZ9.                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GD-DTE-SENT         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GD-NUM-REGN         PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GD-NUM-APPT-TYPE    PIC X(4).                                 
           05  FILLER                 PIC X(10)   VALUE SPACES.                 
           05  L45GD-NUM-USERID       PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GD-DTE-DEL          PIC X(8).                                 
           05  FILLER                 PIC X(5)    VALUE SPACES.                 
           05  L45GD-TME-DEL          PIC X(5).                                 
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *=============================================================            
       0000-CONTROL.                                                            
      *=============================================================            
                                                                                
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                      
           PERFORM 1100-GET-DATE           THRU 1100-EXIT.                      
           PERFORM 2000-BP13FC20-READ      THRU 2000-EXIT.                      
           PERFORM 2100-INIT-LOOP          THRU 2100-EXIT.                      
           PERFORM 3000-MAIN-ROUTINE       THRU 3000-EXIT                       
                   UNTIL WS-FC20-EOF = 'Y'.                                     
           PERFORM 4000-AUTO-SCHEDULE      THRU 4000-EXIT                       
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.                      
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       1000-OPEN-ROUTINE.                                                       
      *=============================================================            
                                                                                
           OPEN INPUT  BP13FC20                                                 
                       BP13KC30                                                 
                       BP13K452                                                 
                       BP13K454                                                 
                I-O    BP13KC20                                                 
                       BP13K800                                                 
                OUTPUT BP13FC30                                                 
                       BP13FC2A                                                 
                       P13L45GA                                                 
                       P13L45GB                                                 
                       P13L45GC                                                 
                       P13L45GD.                                                
                                                                                
           IF WS-KC20-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KC20 ERROR ' WS-KC20-STATUS                  
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KC30-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KC30 ERROR ' WS-KC30-STATUS                  
              MOVE     WS-KC30-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K452-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K452 ERROR ' WS-K452-STATUS                  
              MOVE     WS-K452-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K454-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K454 ERROR ' WS-K454-STATUS                  
              MOVE     WS-K454-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K800 ERROR ' WS-K800-STATUS                  
              MOVE     WS-K800-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       1100-GET-DATE.                                                           
      *=============================================================            
                                                                                
      *-------------------------------------------------------------            
      *    GET CURRENT DATE                                                     
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE(1:8) TO   WS-DTE-CURR-8.                  
           MOVE WS-DTE-CURR-8              TO   WS-DTE-FMT8.                    
           MOVE CORR WS-DTE-FMT8           TO   WS-DTE-FMT10.                   
           MOVE WS-DTE-FMT10               TO   WS-DTE-CURR-10.                 
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       2000-BP13FC20-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13FC20                                                        
              AT END MOVE 'Y'              TO   WS-FC20-EOF.                    
                                                                                
           IF WS-FC20-EOF NOT = 'Y'                                             
              ADD 1                        TO   WS-CNT-FC20-READ                
           END-IF.                                                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       2100-INIT-LOOP.                                                          
      *=============================================================            
                                                                                
           MOVE FC20-DTE-SENT-SELF-BK      TO   WS-DTE-SENT-PREV.               
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3000-MAIN-ROUTINE.                                                       
      *=============================================================            
      *    (1) CONSOLIDATE REGNS TO AUTOBOOK (4000)                             
      *    (2) CONSOLIDATE APPT DATE/TIME TO SWITCH COUNTERS (FC30)             
      *-------------------------------------------------------------            
                                                                                
           IF  (WS-DTE-SENT-PREV NOT = SPACES AND LOW-VALUES AND ZEROES)        
           AND (WS-DTE-SENT-PREV NOT = FC20-DTE-SENT-SELF-BK)                   
              PERFORM 4000-AUTO-SCHEDULE   THRU 4000-EXIT                       
                                                                                
              MOVE FC20-DTE-SENT-SELF-BK   TO   WS-DTE-SENT-PREV                
                                                                                
              PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > WS-I-MAX            
                 MOVE SPACES          TO   WS-ARR-DTE-SENT(WS-I)                
                                           WS-ARR-NUM-APPT-TYPE(WS-I)           
                                           WS-ARR-NUM-REGN(WS-I)                
              END-PERFORM                                                       
                                                                                
              MOVE ZEROES                  TO   WS-I                            
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    CHECK IF CASE IS DEACTIVATED/HAS OPT OUT                             
      *-------------------------------------------------------------            
           IF FC20-NUM-STATUS = 'D'                                             
              PERFORM 7400-PRINT-OPT-OUT   THRU 7400-EXIT                       
              PERFORM 3100-FREEZE-STATUS   THRU 3100-EXIT                       
              GO TO 3000-CONTINUE-READ-NEXT                                     
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    CHECK IF CASE IS ALREADY GIVEN AN AUTO APPT BY SYSTEM                
      *-------------------------------------------------------------            
           IF KC20-DTE-APPT-AUTO NOT = SPACES AND LOW-VALUES AND ZEROES         
              GO TO 3000-CONTINUE-READ-NEXT.                                    
                                                                                
      *-------------------------------------------------------------            
      *    CHECK IF CASE HAS BOOKED THRU SELF BOOKING                           
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   BP13KC30-REC.                   
           MOVE FC20-NUM-REGN              TO   KC30-NUM-REGN.                  
           PERFORM 3030-BP13KC30-READ      THRU 3030-EXIT.                      
                                                                                
           IF WS-KC30-FND = 'Y' AND KC30-NUM-STATUS = 'B'                       
              PERFORM 7100-PRINT-SBK       THRU 7100-EXIT                       
              PERFORM 3100-FREEZE-STATUS   THRU 3100-EXIT                       
              PERFORM 3200-UPDATE-ORIG-TP  THRU 3200-EXIT                       
              GO TO 3000-CONTINUE-READ-NEXT                                     
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    CHECK IF REGN HAS PREVIOUS BOOKING                                   
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   BP13K454-REC.                   
           IF FC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE FC20-NUM-APPT-TYPE      TO   K454-CDE-APPT-TYPE              
           ELSE                                                                 
              MOVE 'TP'                    TO   K454-CDE-APPT-TYPE              
           END-IF.                                                              
           MOVE FC20-NUM-REGN              TO   K454-NUM-REGN.                  
           PERFORM 3110-BP13K454-READ      THRU 3110-EXIT.                      
                                                                                
           IF WS-K454-FND = 'Y'                                                 
              PERFORM 3101-FREEZE-STATUS-2 THRU 3101-EXIT                       
              GO TO 3000-CONTINUE-READ-NEXT                                     
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    IF ALL OK, ADD TO TABLE TO AUTO SCHEDULE                             
      *-------------------------------------------------------------            
           ADD 1                      TO   WS-I.                                
           MOVE FC20-DTE-SENT-SELF-BK TO   WS-ARR-DTE-SENT(WS-I).               
           MOVE FC20-NUM-APPT-TYPE    TO   WS-ARR-NUM-APPT-TYPE(WS-I)           
           MOVE FC20-NUM-REGN         TO   WS-ARR-NUM-REGN(WS-I).               
                                                                                
       3000-CONTINUE-READ-NEXT.                                                 
                                                                                
           PERFORM 2000-BP13FC20-READ      THRU 2000-EXIT.                      
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3030-BP13KC30-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13KC30 KEY IS KC30-ALT-KEY2.                                  
                                                                                
           EVALUATE WS-KC30-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-KC30-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-KC30-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13KC30 ERROR '    WS-KC30-STATUS                  
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3030-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3100-FREEZE-STATUS.                                                      
      *=============================================================            
                                                                                
           MOVE BP13FC20-REC               TO   BP13KC20-REC.                   
                                                                                
           MOVE SPACES                     TO   BP13K454-REC.                   
           IF FC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE FC20-NUM-APPT-TYPE      TO   K454-CDE-APPT-TYPE              
           ELSE                                                                 
              MOVE 'TP'                    TO   K454-CDE-APPT-TYPE              
           END-IF.                                                              
           MOVE FC20-NUM-REGN              TO   K454-NUM-REGN.                  
           PERFORM 3110-BP13K454-READ      THRU 3110-EXIT.                      
                                                                                
           IF WS-K454-FND = 'Y'                                                 
              MOVE K454-DTE-APPT           TO   KC20-DTE-APPT-CLOSE             
              MOVE K454-TME-APPT           TO   KC20-TME-APPT-CLOSE             
           ELSE                                                                 
              MOVE SPACES                  TO   KC20-DTE-APPT-CLOSE             
                                                KC20-TME-APPT-CLOSE             
           END-IF.                                                              
                                                                                
           MOVE KC20-NUM-STATUS            TO   KC20-NUM-STATUS-CLOSE.          
                                                                                
           PERFORM 4320-BP13KC20-REWRITE   THRU 4320-EXIT.                      
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3101-FREEZE-STATUS-2.                                                    
      *=============================================================            
                                                                                
           MOVE BP13FC20-REC               TO   BP13KC20-REC.                   
                                                                                
           MOVE 'D'                        TO   KC20-NUM-STATUS                 
                                                KC20-NUM-STATUS-CLOSE.          
                                                                                
           PERFORM 4320-BP13KC20-REWRITE   THRU 4320-EXIT.                      
                                                                                
       3101-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3110-BP13K454-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13K454 KEY IS K454-ALT1-KEY.                                  
                                                                                
           EVALUATE WS-K454-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-K454-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-K454-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13K454 ERROR '    WS-K454-STATUS                  
              MOVE    WS-K454-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3110-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3200-UPDATE-ORIG-TP.                                                     
      *=============================================================            
                                                                                
           MOVE SPACES                     TO   BP13K800-MASTER.                
           MOVE FC20-NUM-REGN              TO   K800-NUM-REGN.                  
                                                                                
           PERFORM 3210-BP13K800-READ      THRU 3210-EXIT.                      
                                                                                
           IF WS-K800-FND = 'N'                                                 
              MOVE 'NOT FOUND IN SOC MASTER. ORIG TP DATE NOT SAVED'            
                                           TO   WS-NUM-DESC                     
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT                       
           END-IF.                                                              
                                                                                
           IF K800-DTE-TP-ORIG = SPACES OR LOW-VALUES OR ZEROES                 
              MOVE KC30-DTE-APPT           TO   K800-DTE-TP-ORIG                
           END-IF.                                                              
                                                                                
           PERFORM 3220-BP13K800-REWRITE   THRU 3220-EXIT.                      
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3210-BP13K800-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-K800-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-K800-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-K800-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13K800 ERROR '    WS-K800-STATUS                  
              MOVE     WS-K800-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3210-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3220-BP13K800-REWRITE.                                                   
      *=============================================================            
                                                                                
           REWRITE BP13K800-MASTER.                                             
                                                                                
           EVALUATE WS-K800-STATUS                                              
           WHEN 00                                                              
              ADD 1                        TO   WS-CNT-K800-UPD                 
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'REWRITE BP13K800 ERROR '    WS-K800-STATUS               
              MOVE     WS-K800-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3220-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4000-AUTO-SCHEDULE.                                                      
      *=============================================================            
      *    INDEX USAGE:                                                         
      *    - WS-I - REGN ARRAY         (MAX 60)                                 
      *    - WS-J - TIME ARRAY IN K452 (MAX 18)                                 
      *    - WS-K - SLOT ARRAY         (MAX 60)                                 
      *-------------------------------------------------------------            
                                                                                
      *-------------------------------------------------------------            
      *    CLEAR AVAILABLE SLOTS ARRAY                                          
      *-------------------------------------------------------------            
           PERFORM VARYING WS-K FROM 1 BY 1 UNTIL WS-K > WS-K-MAX               
              MOVE SPACES                  TO   WS-BP13KC30-REC(WS-K)           
           END-PERFORM.                                                         
                                                                                
      *-------------------------------------------------------------            
      *    GET ALL AVAILABLE SLOTS                                              
      *-------------------------------------------------------------            
           MOVE  1                         TO   WS-K.                           
           MOVE 'N'                        TO   WS-KC30-EOF.                    
           MOVE SPACES                     TO   BP13KC30-REC                    
                                                WS-DTE-1ST-AVAIL.               
           MOVE WS-DTE-SENT-PREV           TO   KC30-DTE-SENT-SELF-BK.          
           PERFORM 4010-BP13KC30-STARTBR   THRU 4010-EXIT.                      
           PERFORM 4100-GET-VACANT-SLOTS   THRU 4100-EXIT                       
                     UNTIL (WS-K > WS-K-MAX)                                    
                        OR (WS-KC30-EOF = 'Y').                                 
                                                                                
           SUBTRACT 1                      FROM WS-K.                           
           MOVE 1                          TO   WS-I.                           
                                                                                
      *-------------------------------------------------------------            
      *    AUTO BOOK CASES WITH NO APPTS (FROM REGN ARRAY) TO                   
      *    AVAILABLE SLOTS ARRAY (FROM KC30 ARRAY) WITH SLOTS READ              
      *    FROM BOTTOM TO TOP                                                   
      *-------------------------------------------------------------            
           PERFORM 4200-BOOK-AVAIL-SLOT    THRU 4200-EXIT                       
                     UNTIL (WS-I > WS-I-MAX)                                    
                        OR (WS-K = ZEROES)                                      
                        OR (WS-ARR-NUM-REGN(WS-I) = SPACES OR                   
                                                LOW-VALUES OR ZEROES).          
                                                                                
      *-------------------------------------------------------------            
      *    IF NO SLOTS ARE AVAILABLE ANYMORE, WRITE TO REPORT                   
      *-------------------------------------------------------------            
           IF WS-K = ZEROES                                                     
              IF WS-ARR-NUM-REGN(WS-I) NOT = SPACES AND LOW-VALUES AND          
                                             ZEROES                             
                 PERFORM UNTIL WS-ARR-NUM-REGN(WS-I) = SPACES OR                
                                                LOW-VALUES OR ZEROES            
                    MOVE 'SLOTS NOT ENOUGH TO BOOK REGN'                        
                                           TO   WS-NUM-DESC                     
                    PERFORM 7300-PRINT-ERROR    THRU 7300-EXIT                  
                    ADD 1                  TO   WS-I                            
                 END-PERFORM                                                    
              END-IF                                                            
           ELSE                                                                 
      *-------------------------------------------------------------            
      *    MOVE UNUSED SLOTS IN SLOTS ARRAY TO FC30 FOR SWITCHING               
      *-------------------------------------------------------------            
              PERFORM UNTIL WS-K = ZEROES                                       
                 PERFORM 4999-SAVE-FOR-SWITCH   THRU 4999-EXIT                  
                 SUBTRACT 1                FROM WS-K                            
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4010-BP13KC30-STARTBR.                                                   
      *=============================================================            
                                                                                
           START BP13KC30 KEY >= KC30-KEY-FLD.                                  
                                                                                
           EVALUATE WS-KC30-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
              PERFORM 4020-BP13KC30-READNEXT    THRU 4020-EXIT                  
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'Y'                     TO   WS-KC30-EOF                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'START BP13KC30 ERROR '   WS-KC30-STATUS                  
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4010-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4020-BP13KC30-READNEXT.                                                  
      *=============================================================            
                                                                                
           READ BP13KC30 NEXT RECORD.                                           
                                                                                
           EVALUATE WS-KC30-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
              IF KC30-DTE-SENT-SELF-BK NOT = WS-DTE-SENT-PREV                   
                 MOVE 'Y'                  TO   WS-KC30-EOF                     
              END-IF                                                            
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'Y'                     TO   WS-KC30-EOF                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13KC30 ERROR '    WS-KC30-STATUS                  
              MOVE    WS-KC30-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4020-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4100-GET-VACANT-SLOTS.                                                   
      *=============================================================            
                                                                                
           IF WS-DTE-1ST-AVAIL = SPACES OR LOW-VALUES OR ZEROES                 
              MOVE KC30-DTE-APPT           TO   WS-DTE-1ST-AVAIL                
           END-IF.                                                              
                                                                                
           IF (KC30-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES) AND        
              (KC30-NUM-STATUS   = 'B')                                         
              GO TO 4100-CONTINUE-READ-NEXT.                                    
                                                                                
           IF (KC30-NUM-REGN(1:1) NOT = '#') AND                                
              (KC30-NUM-STATUS        = 'B')                                    
              GO TO 4100-CONTINUE-READ-NEXT.                                    
                                                                                
           MOVE BP13KC30-REC               TO   WS-BP13KC30-REC(WS-K).          
           ADD 1                           TO   WS-K.                           
                                                                                
       4100-CONTINUE-READ-NEXT.                                                 
                                                                                
           PERFORM 4020-BP13KC30-READNEXT  THRU 4020-EXIT.                      
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4200-BOOK-AVAIL-SLOT.                                                    
      *=============================================================            
                                                                                
           MOVE WS-BP13KC30-REC(WS-K)      TO   BP13KC30-REC.                   
                                                                                
      *-------------------------------------------------------------            
      *    SKIP SLOT IF ALREADY BOOKED                                          
      *-------------------------------------------------------------            
           IF (KC30-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES) AND        
              (KC30-NUM-STATUS   = 'B')                                         
              GO TO 4200-CONTINUE-READ-NEXT.                                    
                                                                                
           IF (KC30-NUM-REGN(1:1) NOT = '#') AND                                
              (KC30-NUM-STATUS        = 'B')                                    
              GO TO 4200-CONTINUE-READ-NEXT.                                    
                                                                                
      *-------------------------------------------------------------            
      *    SKIP SLOT IF SAME AS 1ST AVAILABLE APPT DATE                         
      *-------------------------------------------------------------            
           IF KC30-DTE-APPT = WS-DTE-1ST-AVAIL                                  
              GO TO 4200-CONTINUE-READ-NEXT.                                    
                                                                                
      *-------------------------------------------------------------            
      *    CHECK WORKPLAN FOR THE SLOT'S APPT DATE                              
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   BP13K452-REC.                   
           MOVE KC30-DTE-APPT              TO   K452-DTE-APPT.                  
                                                                                
           PERFORM 4240-BP13K452-READ      THRU 4240-EXIT.                      
                                                                                
           IF WS-K452-FND NOT = 'Y'                                             
              PERFORM 4999-SAVE-FOR-SWITCH THRU 4999-EXIT                       
              GO TO 4200-CONTINUE-READ-NEXT.                                    
                                                                                
           MOVE 'N'                        TO   WS-TIME-FND-FL.                 
                                                                                
      *-------------------------------------------------------------            
      *    CHECK VACANCY FOR TIME SLOT (AM)                                     
      *-------------------------------------------------------------            
           IF KC30-TME-APPT > 0759 AND                                          
              KC30-TME-APPT < 1201                                              
              PERFORM VARYING WS-J FROM 1 BY 1                                  
                        UNTIL WS-J > WS-J-MAX                                   
                           OR WS-TIME-FND-FL = 'Y'                              
                 IF K452-TME-SLOT(WS-J) = KC30-TME-APPT                         
                    MOVE 'Y'          TO   WS-TIME-FND-FL                       
                                                                                
                    IF K452-NUM-MAX-CASE-SB(WS-J) NOT NUMERIC                   
                       MOVE ZEROES    TO   K452-NUM-MAX-CASE-SB(WS-J)           
                    END-IF                                                      
                                                                                
                    IF K452-NUM-TOT-TP-SB(WS-J) NOT NUMERIC                     
                       MOVE ZEROES    TO   K452-NUM-TOT-TP-SB(WS-J)             
                    END-IF                                                      
                                                                                
                    IF K452-NUM-TOT-SA-SB(WS-J) NOT NUMERIC                     
                       MOVE ZEROES    TO   K452-NUM-TOT-SA-SB(WS-J)             
                    END-IF                                                      
                                                                                
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-NUM-MAX-CASE-SB(WS-J) -              
                                      K452-NUM-TOT-TP-SB(WS-J)                  
                    ELSE                                                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-NUM-MAX-CASE-SB(WS-J) -              
                                      K452-NUM-TOT-SA-SB(WS-J)                  
                    END-IF                                                      
                 END-IF                                                         
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    CHECK VACANCY FOR TIME SLOT (PM)                                     
      *-------------------------------------------------------------            
           IF KC30-TME-APPT > 1200 AND                                          
              KC30-TME-APPT < 1701                                              
              PERFORM VARYING WS-J FROM 1 BY 1                                  
                        UNTIL WS-J > WS-J-MAX                                   
                           OR WS-TIME-FND-FL = 'Y'                              
                 IF K452-PM-TME-SLOT(WS-J) = KC30-TME-APPT                      
                    MOVE 'Y'          TO   WS-TIME-FND-FL                       
                                                                                
                    IF K452-PM-MAX-CASE-SB(WS-J) NOT NUMERIC                    
                       MOVE ZEROES    TO   K452-PM-MAX-CASE-SB(WS-J)            
                    END-IF                                                      
                                                                                
                    IF K452-PM-TOT-TP-SB(WS-J) NOT NUMERIC                      
                       MOVE ZEROES    TO   K452-PM-TOT-TP-SB(WS-J)              
                    END-IF                                                      
                                                                                
                    IF K452-PM-TOT-SA-SB(WS-J) NOT NUMERIC                      
                       MOVE ZEROES    TO   K452-PM-TOT-SA-SB(WS-J)              
                    END-IF                                                      
                                                                                
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-PM-MAX-CASE-SB(WS-J) -               
                                      K452-PM-TOT-TP-SB(WS-J)                   
                    ELSE                                                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-PM-MAX-CASE-SB(WS-J) -               
                                      K452-PM-TOT-SA-SB(WS-J)                   
                    END-IF                                                      
                 END-IF                                                         
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
      *-------------------------------------------------------------            
      *    CHECK VACANCY FOR TIME SLOT (OT)                                     
      *-------------------------------------------------------------            
           IF KC30-TME-APPT > 1659 AND                                          
              KC30-TME-APPT < 2000                                              
              PERFORM VARYING WS-J FROM 1 BY 1                                  
                        UNTIL WS-J > WS-J-MAX                                   
                           OR WS-TIME-FND-FL = 'Y'                              
                 IF K452-OT-TME-SLOT(WS-J) = KC30-TME-APPT                      
                    MOVE 'Y'          TO   WS-TIME-FND-FL                       
                                                                                
                    IF K452-OT-MAX-CASE-SB(WS-J) NOT NUMERIC                    
                       MOVE ZEROES    TO   K452-OT-MAX-CASE-SB(WS-J)            
                    END-IF                                                      
                                                                                
                    IF K452-OT-TOT-TP-SB(WS-J) NOT NUMERIC                      
                       MOVE ZEROES    TO   K452-OT-TOT-TP-SB(WS-J)              
                    END-IF                                                      
                                                                                
                    IF K452-OT-TOT-SA-SB(WS-J) NOT NUMERIC                      
                       MOVE ZEROES    TO   K452-OT-TOT-SA-SB(WS-J)              
                    END-IF                                                      
                                                                                
                    IF K452-CDE-APPT-TYPE = 'TP' OR 'SP'                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-OT-MAX-CASE-SB(WS-J) -               
                                      K452-OT-TOT-TP-SB(WS-J)                   
                    ELSE                                                        
                       COMPUTE WS-CNT-VACANT =                                  
                                      K452-OT-MAX-CASE-SB(WS-J) -               
                                      K452-OT-TOT-SA-SB(WS-J)                   
                    END-IF                                                      
                 END-IF                                                         
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
           IF WS-CNT-VACANT < 1                                                 
              PERFORM 4999-SAVE-FOR-SWITCH THRU 4999-EXIT                       
              GO TO 4200-CONTINUE-READ-NEXT.                                    
                                                                                
      *-------------------------------------------------------------            
      *    USE CURRENT SLOT TO BOOK REGN                                        
      *-------------------------------------------------------------            
           PERFORM 4300-UPD-SELFLIST-APPT  THRU 4300-EXIT.                      
           PERFORM 7200-PRINT-AUTO         THRU 7200-EXIT.                      
                                                                                
      *-------------------------------------------------------------            
      *    INCREMENT INDEX TO BOOK NEXT REGN                                    
      *-------------------------------------------------------------            
           ADD 1                           TO   WS-I.                           
                                                                                
       4200-CONTINUE-READ-NEXT.                                                 
                                                                                
           SUBTRACT 1                      FROM WS-K.                           
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4240-BP13K452-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13K452.                                                       
                                                                                
           EVALUATE WS-K452-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-K452-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-K452-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13K452 ERROR '    WS-K452-STATUS                  
              MOVE    WS-K452-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4240-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4300-UPD-SELFLIST-APPT.                                                  
      *=============================================================            
                                                                                
           MOVE SPACES                     TO   BP13KC20-REC.                   
           MOVE WS-ARR-NUM-REGN(WS-I)      TO   KC20-NUM-REGN.                  
                                                                                
           PERFORM 4310-BP13KC20-READ      THRU 4310-EXIT.                      
                                                                                
           IF WS-KC20-FND = 'Y'                                                 
              MOVE 'S'                     TO   KC20-NUM-STATUS                 
                                                KC20-NUM-STATUS-CLOSE           
              MOVE KC30-DTE-APPT           TO   KC20-DTE-APPT-AUTO              
                                                KC20-DTE-APPT-CLOSE             
              MOVE KC30-TME-APPT           TO   KC20-TME-APPT-AUTO              
                                                KC20-TME-APPT-CLOSE             
                                                                                
              PERFORM 4320-BP13KC20-REWRITE     THRU 4320-EXIT                  
                                                                                
              WRITE BP13FC2A-REC           FROM BP13KC20-REC                    
              ADD 1                        TO   WS-CNT-FC2A-WRITE               
           ELSE                                                                 
              MOVE 'REGN NOT FOUND IN SELF BOOKING LIST'                        
                                           TO   WS-NUM-DESC                     
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT                       
           END-IF.                                                              
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4310-BP13KC20-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13KC20 KEY IS KC20-ALT-KEY.                                   
                                                                                
           EVALUATE WS-KC20-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-KC20-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-KC20-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13KC20 ERROR '    WS-KC20-STATUS                  
              MOVE    WS-KC20-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4310-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4320-BP13KC20-REWRITE.                                                   
      *=============================================================            
                                                                                
           REWRITE BP13KC20-REC.                                                
                                                                                
           EVALUATE WS-KC20-STATUS                                              
           WHEN 00                                                              
              ADD 1                        TO   WS-CNT-KC20-UPD                 
                                                                                
           WHEN OTHER                                                           
              STRING 'REWRITE ERROR ON SBK SLOT: '                              
                      WS-KC20-STATUS '/' KC20-KEY-FLD                           
                      DELIMITED BY SIZE    INTO WS-NUM-DESC                     
              PERFORM 7300-PRINT-ERROR     THRU 7300-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4320-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4999-SAVE-FOR-SWITCH.                                                    
      *=============================================================            
                                                                                
           MOVE WS-BP13KC30-REC(WS-K)      TO   BP13KC30-REC.                   
                                                                                
           IF (KC30-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES) AND        
              (KC30-NUM-STATUS   = 'B')                                         
              GO TO 4999-EXIT.                                                  
                                                                                
           IF (KC30-NUM-REGN(1:1) NOT = '#') AND                                
              (KC30-NUM-STATUS        = 'B')                                    
              GO TO 4999-EXIT.                                                  
                                                                                
           MOVE BP13KC30-REC               TO   WS-BP13FC30-REC.                
           MOVE 1                          TO   WS-FC30-CNT-REC.                
                                                                                
           WRITE BP13FC30-REC              FROM WS-BP13FC30-REC.                
           ADD  1                          TO   WS-CNT-FC30-WRITE.              
                                                                                
       4999-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7100-PRINT-SBK.                                                          
      *=============================================================            
                                                                                
           IF WS-CNT-LINE-A > 55                                                
              PERFORM 7101-PRINT-SBK-HDR   THRU 7101-EXIT                       
           END-IF.                                                              
                                                                                
           ADD 1                           TO   WS-CNT-SNO-A.                   
           MOVE WS-CNT-SNO-A               TO   L45GA-NUM-SNO.                  
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45GA-DTE-SENT.                 
           MOVE FC20-NUM-REGN              TO   L45GA-NUM-REGN.                 
                                                                                
           IF FC20-NUM-APPT-TYPE = 'TP'                                         
              MOVE 'WT'                    TO   L45GA-NUM-APPT-TYPE             
           END-IF.                                                              
           IF FC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE 'WP'                    TO   L45GA-NUM-APPT-TYPE             
           END-IF.                                                              
                                                                                
           MOVE KC30-DTE-APPT              TO   L45GA-DTE-APPT.                 
                                                                                
           STRING KC30-TME-APPT(1:2) ':' KC30-TME-APPT(3:2)                     
                  DELIMITED BY SIZE        INTO L45GA-TME-APPT.                 
                                                                                
           MOVE 'Y'                        TO   L45GA-NUM-SBK.                  
                                                                                
           WRITE P13L45GA-REC              FROM L45GA-PR-DTL.                   
                                                                                
           ADD 1                           TO   WS-CNT-LINE-A.                  
           ADD 1                           TO   WS-CNT-L45GA-WRITE.             
                                                                                
       7100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7101-PRINT-SBK-HDR.                                                      
      *=============================================================            
                                                                                
           ADD 1                           TO   WS-CNT-PAGE-A.                  
           MOVE WS-CNT-PAGE-A              TO   L45GA-PAGE.                     
           MOVE WS-DTE-CURR-10             TO   L45GA-CURRENT-DATE.             
                                                                                
           WRITE P13L45GA-REC FROM L45GA-PR-HEAD-01 AFTER PAGE.                 
           WRITE P13L45GA-REC FROM L45GA-PR-HEAD-02.                            
           WRITE P13L45GA-REC FROM L45GA-PR-TITLE-1 AFTER 2.                    
           WRITE P13L45GA-REC FROM L45GA-PR-TITLE-2.                            
                                                                                
           MOVE SPACES                     TO   P13L45GA-REC.                   
           WRITE P13L45GA-REC.                                                  
                                                                                
           MOVE 6                          TO   WS-CNT-LINE-A.                  
                                                                                
       7101-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7102-PRINT-MANUAL.                                                       
      *=============================================================            
                                                                                
           IF WS-CNT-LINE-A > 55                                                
              PERFORM 7101-PRINT-SBK-HDR   THRU 7101-EXIT                       
           END-IF.                                                              
                                                                                
           ADD 1                           TO   WS-CNT-SNO-A.                   
           MOVE WS-CNT-SNO-A               TO   L45GA-NUM-SNO.                  
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45GA-DTE-SENT.                 
           MOVE FC20-NUM-REGN              TO   L45GA-NUM-REGN.                 
                                                                                
           IF FC20-NUM-APPT-TYPE = 'TP'                                         
              MOVE 'WT'                    TO   L45GA-NUM-APPT-TYPE             
           END-IF.                                                              
           IF FC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE 'WP'                    TO   L45GA-NUM-APPT-TYPE             
           END-IF.                                                              
                                                                                
           MOVE K454-DTE-APPT              TO   L45GA-DTE-APPT.                 
                                                                                
           STRING K454-TME-APPT(1:2) ':' K454-TME-APPT(3:2)                     
                  DELIMITED BY SIZE        INTO L45GA-TME-APPT.                 
                                                                                
           MOVE SPACES                     TO   L45GA-NUM-SBK.                  
                                                                                
           WRITE P13L45GA-REC              FROM L45GA-PR-DTL.                   
                                                                                
           ADD 1                           TO   WS-CNT-LINE-A.                  
           ADD 1                           TO   WS-CNT-L45GA-WRITE.             
                                                                                
       7102-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7200-PRINT-AUTO.                                                         
      *=============================================================            
                                                                                
           IF WS-CNT-LINE-B > 55                                                
              PERFORM 7201-PRINT-AUTO-HDR  THRU 7201-EXIT                       
           END-IF.                                                              
                                                                                
           ADD 1                           TO   WS-CNT-SNO-B.                   
           MOVE WS-CNT-SNO-B               TO   L45GB-NUM-SNO.                  
           MOVE KC20-DTE-SENT-SELF-BK      TO   L45GB-DTE-SENT.                 
           MOVE WS-ARR-NUM-REGN(WS-I)      TO   L45GB-NUM-REGN.                 
                                                                                
           IF KC20-NUM-APPT-TYPE = 'TP'                                         
              MOVE 'WT'                    TO   L45GB-NUM-APPT-TYPE             
           END-IF.                                                              
           IF KC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE 'WP'                    TO   L45GB-NUM-APPT-TYPE             
           END-IF.                                                              
                                                                                
           MOVE KC30-DTE-APPT              TO   L45GB-DTE-APPT.                 
                                                                                
           STRING KC30-TME-APPT(1:2) ':' KC30-TME-APPT(3:2)                     
                  DELIMITED BY SIZE        INTO L45GB-TME-APPT.                 
                                                                                
           WRITE P13L45GB-REC              FROM L45GB-PR-DTL.                   
                                                                                
           ADD 1                           TO   WS-CNT-LINE-B.                  
           ADD 1                           TO   WS-CNT-L45GB-WRITE.             
                                                                                
       7200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7201-PRINT-AUTO-HDR.                                                     
      *=============================================================            
                                                                                
           ADD 1                           TO   WS-CNT-PAGE-B.                  
           MOVE WS-CNT-PAGE-B              TO   L45GB-PAGE.                     
           MOVE WS-DTE-CURR-10             TO   L45GB-CURRENT-DATE.             
                                                                                
           WRITE P13L45GB-REC FROM L45GB-PR-HEAD-01 AFTER PAGE.                 
           WRITE P13L45GB-REC FROM L45GB-PR-HEAD-02.                            
           WRITE P13L45GB-REC FROM L45GB-PR-TITLE-1 AFTER 2.                    
           WRITE P13L45GB-REC FROM L45GB-PR-TITLE-2.                            
                                                                                
           MOVE SPACES                     TO   P13L45GB-REC.                   
           WRITE P13L45GB-REC.                                                  
                                                                                
           MOVE 6                          TO   WS-CNT-LINE-B.                  
                                                                                
       7201-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7300-PRINT-ERROR.                                                        
      *=============================================================            
                                                                                
           IF WS-CNT-LINE-C > 55                                                
              PERFORM 7301-PRINT-ERROR-HDR THRU 7301-EXIT                       
           END-IF.                                                              
                                                                                
           ADD 1                           TO   WS-CNT-SNO-C.                   
           MOVE WS-CNT-SNO-C               TO   L45GC-NUM-SNO.                  
           MOVE WS-ARR-DTE-SENT(WS-I)      TO   L45GC-DTE-SENT.                 
           MOVE WS-ARR-NUM-REGN(WS-I)      TO   L45GC-NUM-REGN.                 
           MOVE WS-ARR-NUM-APPT-TYPE(WS-I) TO   L45GC-NUM-APPT-TYPE.            
           MOVE WS-NUM-DESC                TO   L45GC-NUM-DESC.                 
                                                                                
           WRITE P13L45GC-REC              FROM L45GC-PR-DTL.                   
                                                                                
           ADD 1                           TO   WS-CNT-LINE-C.                  
           ADD 1                           TO   WS-CNT-L45GC-WRITE.             
                                                                                
       7300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7301-PRINT-ERROR-HDR.                                                    
      *=============================================================            
                                                                                
           ADD 1                           TO   WS-CNT-PAGE-C.                  
           MOVE WS-CNT-PAGE-C              TO   L45GC-PAGE.                     
           MOVE WS-DTE-CURR-10             TO   L45GC-CURRENT-DATE.             
                                                                                
           WRITE P13L45GC-REC FROM L45GC-PR-HEAD-01 AFTER PAGE.                 
           WRITE P13L45GC-REC FROM L45GC-PR-HEAD-02.                            
           WRITE P13L45GC-REC FROM L45GC-PR-TITLE-1 AFTER 2.                    
           WRITE P13L45GC-REC FROM L45GC-PR-TITLE-2.                            
                                                                                
           MOVE SPACES                     TO   P13L45GC-REC.                   
           WRITE P13L45GC-REC.                                                  
                                                                                
           MOVE 6                          TO   WS-CNT-LINE-C.                  
                                                                                
       7301-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7400-PRINT-OPT-OUT.                                                      
      *=============================================================            
                                                                                
           IF WS-CNT-LINE-D > 55                                                
              PERFORM 7401-PRINT-OPT-OUT-HDR    THRU 7401-EXIT                  
           END-IF.                                                              
                                                                                
           ADD 1                           TO   WS-CNT-SNO-D.                   
           MOVE WS-CNT-SNO-D               TO   L45GD-NUM-SNO.                  
           MOVE FC20-DTE-SENT-SELF-BK      TO   L45GD-DTE-SENT.                 
           MOVE FC20-NUM-REGN              TO   L45GD-NUM-REGN.                 
                                                                                
           IF FC20-NUM-APPT-TYPE = 'TP'                                         
              MOVE 'WT'                    TO   L45GD-NUM-APPT-TYPE             
           END-IF.                                                              
           IF FC20-NUM-APPT-TYPE = 'SP'                                         
              MOVE 'WP'                    TO   L45GD-NUM-APPT-TYPE             
           END-IF.                                                              
                                                                                
           MOVE FC20-NUM-USERID-DEL        TO   L45GD-NUM-USERID.               
           MOVE FC20-DTE-UPDATE-DEL        TO   L45GD-DTE-DEL.                  
                                                                                
           STRING FC20-TME-UPDATE-DEL(1:2)                                      
                  FC20-TME-UPDATE-DEL(3:2)                                      
                  DELIMITED BY SIZE        INTO L45GD-TME-DEL.                  
                                                                                
           WRITE P13L45GD-REC              FROM L45GD-PR-DTL.                   
                                                                                
           ADD 1                           TO   WS-CNT-LINE-D.                  
           ADD 1                           TO   WS-CNT-L45GD-WRITE.             
                                                                                
       7400-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       7401-PRINT-OPT-OUT-HDR.                                                  
      *=============================================================            
                                                                                
           ADD 1                           TO   WS-CNT-PAGE-D.                  
           MOVE WS-CNT-PAGE-D              TO   L45GD-PAGE.                     
           MOVE WS-DTE-CURR-10             TO   L45GD-CURRENT-DATE.             
                                                                                
           WRITE P13L45GD-REC FROM L45GD-PR-HEAD-01 AFTER PAGE.                 
           WRITE P13L45GD-REC FROM L45GD-PR-HEAD-02.                            
           WRITE P13L45GD-REC FROM L45GD-PR-TITLE-1 AFTER 2.                    
           WRITE P13L45GD-REC FROM L45GD-PR-TITLE-2.                            
                                                                                
           MOVE SPACES                     TO   P13L45GD-REC.                   
           WRITE P13L45GD-REC.                                                  
                                                                                
           MOVE 6                          TO   WS-CNT-LINE-D.                  
                                                                                
       7401-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       9000-CLOSE-ROUTINE.                                                      
      *=============================================================            
                                                                                
           CLOSE BP13FC20                                                       
                 BP13KC30                                                       
                 BP13K452                                                       
                 BP13K454                                                       
                 BP13KC20                                                       
                 BP13K800                                                       
                 BP13FC30                                                       
                 BP13FC2A                                                       
                 P13L45GA                                                       
                 P13L45GB                                                       
                 P13L45GC                                                       
                 P13L45GD.                                                      
                                                                                
           IF WS-KC20-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13KC20 ERROR ' WS-KC20-STATUS                  
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-KC30-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13KC30 ERROR ' WS-KC30-STATUS                  
              MOVE     WS-KC30-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-K452-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13K452 ERROR ' WS-K452-STATUS                  
              MOVE     WS-K452-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-K454-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13K454 ERROR ' WS-K454-STATUS                  
              MOVE     WS-K454-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13K800 ERROR ' WS-K800-STATUS                  
              MOVE     WS-K454-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           DISPLAY '   '.                                                       
           DISPLAY '*------- BP13C45G CONTROL TOTAL -------*'.                  
           DISPLAY '   '.                                                       
           DISPLAY ' 1. NO OF BP13FC20 READ      : ' WS-CNT-FC20-READ.          
           DISPLAY ' 2. NO OF BP13KC20 UPDATED   : ' WS-CNT-KC20-UPD.           
           DISPLAY ' 3. NO OF BP13K800 UPDATED   : ' WS-CNT-K800-UPD.           
           DISPLAY ' 4. NO OF BP13FC30 WRITTEN   : ' WS-CNT-FC30-WRITE.         
           DISPLAY ' 5. NO OF BP13FC2A WRITTEN   : ' WS-CNT-FC2A-WRITE.         
           DISPLAY ' 6. NO OF P13L45GA WRITTEN   : ' WS-CNT-L45GA-WRITE.        
           DISPLAY ' 7. NO OF P13L45GB WRITTEN   : ' WS-CNT-L45GB-WRITE.        
           DISPLAY ' 8. NO OF P13L45GC WRITTEN   : ' WS-CNT-L45GC-WRITE.        
           DISPLAY ' 9. NO OF P13L45GD WRITTEN   : ' WS-CNT-L45GD-WRITE.        
           DISPLAY '  '.                                                        
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
