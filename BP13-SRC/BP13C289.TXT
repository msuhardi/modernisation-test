      ***************************                                               
       IDENTIFICATION DIVISION.                                                 
      ***************************                                               
       PROGRAM-ID.    BP13C289.                                                 
       AUTHOR.        MEL B.SOLIVA.                                             
       DATE-WRITTEN.  15/05/01.                                                 
       DATE-COMPILED.                                                           
      *================================================================*        
      *    SYSTEM NAME  :   SYSTEM OF COMMITMENT                       *        
      *    SYSTEM ID    :   BP13                                       *        
      *    OBJECTIVE    :   THIS IS A PROGRAM TO PRINT BOOKING OF      *        
      *                     FLATS AS TO FLAT TYPE, APT BLK, # OF FLATS *        
      *                     OFFERED, CAT, # OF APPLICANTS, # OF FLATS  *        
      *                     ACCEPTED, # OF FLATS NOT SELECTED.         *        
      *                                                                *        
      *    INPUT FILES  :   1.  P13F800S - APPLCN MASTER - SELECTED    *        
      *                     2.  P13F800N - APPLCN MASTER - NOT SELECT  *        
      *                     3.  BM06F800 - FLATLIST FILE               *        
      *    OUTPUT FILE  :   1.  P13L289A - REPORT FILE                 *        
      *                                                                *        
      *   CHG-NO    BY      DATE     DESCRIPTION                       *        
      *   -------   ---   --------   ------------------------------    *        
      *   BP130970  MBS   15/07/01   NEW PGM                           *        
      *   BP131049  MBS   23/08/01   CHG LREC FOR P13L289A             *        
      *   BP132031  MALC  03/10/01   CATER FOR SALE OF SERS FLAT       *        
      *                              TO SINGLES                        *        
      *   BP132278  JF4   16/04/03   CHG BM06F800 LRECL TO 800         *        
      *   BP132708  GAN1  07/09/05   USE OF SERS TABLE (SERSCH)        *        
      *   BP135533  ESA1  13/11/14   TO CATER FOR ALLOC SCHEMES        *        
      *                              'REG' & 'RNG'                     *        
      *================================================================*        
                                                                                
      ************************                                                  
       ENVIRONMENT DIVISION.                                                    
      ************************                                                  
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT P13F800S  ASSIGN TO P13F800S.                                 
           SELECT P13F800N  ASSIGN TO P13F800N.                                 
           SELECT BM06F800  ASSIGN TO BM06F800.                                 
           SELECT P13L289A  ASSIGN TO P13L289A.                                 
                                                                                
           SELECT BP13K060  ASSIGN  TO BP13K060                                 
                  ORGANIZATION      INDEXED                                     
                  ACCESS            RANDOM                                      
                  RECORD KEY        K060-KEY-FLD                                
                  FILE STATUS       WS-K060-STAT.                               
                                                                                
                                                                                
      *****************                                                         
       DATA DIVISION.                                                           
      *****************                                                         
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   P13F800S                                                            
            RECORD CONTAINS 13  CHARACTERS                                      
            BLOCK CONTAINS  0   RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORDING MODE  IS  F.                                              
       01   P13F800S-REC.                                                       
            05  F800S-FLAT-TYP       PIC X(2).                                  
            05  F800S-ALLO-SCH       PIC X(3).                                  
            05  F800S-REC-CNT        PIC 9(8).                                  
                                                                                
       FD   P13F800N                                                            
            RECORD CONTAINS 13  CHARACTERS                                      
            BLOCK CONTAINS  0   RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORDING MODE  IS  F.                                              
       01   P13F800N-REC.                                                       
            05  F800N-FLAT-TYP       PIC X(2).                                  
            05  F800N-ALLO-SCH       PIC X(3).                                  
            05  F800N-REC-CNT        PIC 9(8).                                  
                                                                                
       FD   BM06F800                                                            
            RECORD CONTAINS 800 CHARACTERS                                      
            BLOCK CONTAINS  0   RECORDS                                         
            LABEL RECORDS   ARE STANDARD                                        
            RECORDING MODE  IS  F.                                              
       COPY BM06F800.                                                           
                                                                                
       FD  BP13K060                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 25 CHARACTERS                                        
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K060.                                                           
                                                                                
       FD   P13L289A                                                            
            BLOCK CONTAINS  0   RECORDS                                         
            RECORD CONTAINS  99  CHARACTERS                                     
            LABEL RECORDS   ARE OMITTED                                         
            RECORDING MODE  IS  F.                                              
       01   L289-REC                      PIC X(99).                            
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  PRINT-AREA.                                                          
           05  HEADING1.                                                        
               10  FILLER               PIC X(8)B(3) VALUE                      
                   'BP13L289'.                                                  
               10  FILLER               PIC X(4)B(4) VALUE                      
                   'HDB3'.                                                      
               10  FILLER               PIC X(39)B(4) VALUE                     
                   'S Y S T E M   O F   C O M M I T M E N T'.                   
               10  FILLER               PIC X(7) VALUE                          
                   'DATE : '.                                                   
               10  RUNDATE.                                                     
                   15  RUN-DD           PIC 9(2).                               
                   15  FILLER           PIC X VALUE '/'.                        
                   15  RUN-MM           PIC 9(2).                               
                   15  FILLER           PIC X VALUE '/'.                        
                   15  RUN-CC           PIC 9(2).                               
                   15  RUN-YY           PIC 9(2).                               
                                                                                
           05  HEADING2.                                                        
               10  FILLER               PIC X(62) VALUE SPACES.                 
               10  FILLER               PIC X(7)  VALUE                         
                   'PAGE : '.                                                   
               10  PAGE-NO              PIC ZZZ9.                               
                                                                                
           05  HEADING3.                                                        
               10  FILLER               PIC X(32) VALUE SPACES.                 
               10  FILLER               PIC X(16) VALUE                         
                   'BOOKING OF FLATS'.                                          
                                                                                
           05  COL-HEAD1.                                                       
               10 FILLER                PIC X(73) VALUE SPACES.                 
               10 FILLER                PIC X(5)  VALUE                         
                  'NO OF'.                                                      
                                                                                
           05  COL-HEAD2.                                                       
               10 FILLER                PIC X(30) VALUE SPACES.                 
               10 FILLER                PIC X(6)  VALUE                         
                  'NO OF '.                                                     
               10 FILLER                PIC X(30) VALUE SPACES.                 
               10 FILLER                PIC X(7)  VALUE                         
                  'NO OF  '.                                                    
               10 FILLER                PIC X(5)  VALUE                         
                  'FLATS'.                                                      
                                                                                
           05  COL-HEAD3.                                                       
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 FILLER                PIC X(5)  VALUE                         
                  'FLAT '.                                                      
               10 FILLER                PIC X(23) VALUE                         
                  '        APT BLK        '.                                    
               10 FILLER                PIC X(6)  VALUE                         
                  ' FLATS'.                                                     
               10 FILLER                PIC X(24) VALUE                         
                  '        CATEGORY        '.                                   
               10 FILLER                PIC X(7)  VALUE                         
                  'NO OF  '.                                                    
               10 FILLER                PIC X(7)  VALUE                         
                  'FLATS  '.                                                    
               10 FILLER                PIC X(4)  VALUE                         
                  'NOT '.                                                       
                                                                                
           05  COL-HEAD4.                                                       
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 FILLER                PIC X(5)  VALUE                         
                  'TYPE '.                                                      
               10 FILLER                PIC X(24) VALUE SPACES.                 
               10 FILLER                PIC X(7)  VALUE                         
                  'OFFERED'.                                                    
               10 FILLER                PIC X(22) VALUE SPACES.                 
               10 FILLER                PIC X(6)  VALUE                         
                  'APLCNT'.                                                     
               10 FILLER                PIC X(7)  VALUE                         
                  ' ACCEPT'.                                                    
               10 FILLER                PIC X(6)  VALUE                         
                  ' SLECT'.                                                     
                                                                                
           05  COL-HEAD5.                                                       
               10 FILLER                PIC X(80) VALUE ALL '-'.                
                                                                                
           05  DETAIL-LINE1.                                                    
               10 DETAIL-FTYPE          PIC X(6)  VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-CD-NT          PIC X(23) VALUE SPACES.                 
               10 FILLER                PIC X(48) VALUE SPACES.                 
                                                                                
           05  DETAIL-LINE2.                                                    
               10 FILLER                PIC X(7)  VALUE SPACES.                 
               10 DETAIL-BLK1           PIC X(5)  VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-BLK2           PIC X(5)  VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-BLK3           PIC X(5)  VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-BLK4           PIC X(5)  VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-TOTL-FLAT      PIC ZZZ9.                               
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-CAT            PIC X(25) VALUE SPACES.                 
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-TOTL-APPLCNT   PIC ZZZ9.                               
               10 DETAIL-TOTL-APPLCNT-X REDEFINES DETAIL-TOTL-APPLCNT           
                                        PIC X(4).                               
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-FLAT-SEL       PIC ZZZ9.                               
               10 DETAIL-FLAT-SEL-X REDEFINES DETAIL-FLAT-SEL                   
                                        PIC X(4).                               
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 DETAIL-FLAT-NOT-SEL   PIC ZZZ9.                               
               10 DETAIL-FLAT-NOT-SEL-X REDEFINES DETAIL-FLAT-NOT-SEL           
                                        PIC X(4).                               
                                                                                
           05  FOOTER-LINE.                                                     
               10 FILLER                PIC X(36) VALUE SPACES.                 
               10 FILLER                PIC X(22) VALUE                         
                  'SUB-TOTAL             '.                                     
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 FOOTER-APLCNT-TOTL    PIC ZZZZ9.                              
               10 FOOTER-APLCNT-TOTL-X REDEFINES FOOTER-APLCNT-TOTL             
                                        PIC X(5).                               
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 FOOTER-SEL-TOTL       PIC ZZZZ9.                              
               10 FOOTER-SEL-TOTL-X REDEFINES FOOTER-SEL-TOTL                   
                                        PIC X(5).                               
               10 FILLER                PIC X(1)  VALUE SPACES.                 
               10 FOOTER-NOT-SEL-TOTL   PIC ZZZZ9.                              
               10 FOOTER-NOT-SEL-TOTL-X REDEFINES FOOTER-NOT-SEL-TOTL           
                                        PIC X(5).                               
                                                                                
       01  WS-DETAIL-VAR.                                                       
           05 WS-DET-FTYPE                PIC X(6)  VALUE SPACES.               
           05 WS-DET-CD-NT                PIC X(23) VALUE SPACES.               
           05 WS-DET-BLK1                 PIC X(5)  VALUE SPACES.               
           05 WS-DET-BLK2                 PIC X(5)  VALUE SPACES.               
           05 WS-DET-BLK3                 PIC X(5)  VALUE SPACES.               
           05 WS-DET-BLK4                 PIC X(5)  VALUE SPACES.               
           05 WS-DET-TOTL-FLAT            PIC 9(4)  VALUE 0.                    
           05 WS-DET-CAT                  PIC X(25) VALUE SPACES.               
           05 WS-DET-CAT-F800S            PIC X(03) VALUE SPACES.               
           05 WS-DET-CAT-F800N            PIC X(03) VALUE SPACES.               
           05 WS-ALSCH-CODE               PIC X(03) VALUE SPACES.               
           05 WS-PRIO-ALSCH               PIC X(03) VALUE SPACES.               
           05 WS-DET-TOTL-APPLCNT         PIC 9(4)  VALUE 0.                    
           05 WS-DET-FLAT-SEL             PIC 9(4)  VALUE 0.                    
           05 WS-DET-FLAT-NOT-SEL         PIC 9(4)  VALUE 0.                    
                                                                                
       01  SW-SERS-ALLO-SCHEME            PIC X(01) VALUE SPACES.               
           88  C-SERS-ALLO-SCHEME         VALUE 'Y'.                            
                                                                                
       01  WS-FOOTER-VAR.                                                       
           05 WS-FOOT-TOTL-APLCNT         PIC 9(5)  VALUE 0.                    
           05 WS-FOOT-FLAT-SEL            PIC 9(5)  VALUE 0.                    
           05 WS-FOOT-NOT-SEL             PIC 9(5)  VALUE 0.                    
                                                                                
       01  WS-INDICATORS.                                                       
           05 WS-END-IND.                                                       
              10 WS-F800S-END                PIC X(01) VALUE 'N'.               
              10 WS-F800N-END                PIC X(01) VALUE 'N'.               
              10 WS-F800S-ARR-END            PIC X(01) VALUE 'N'.               
              10 WS-F800N-ARR-END            PIC X(01) VALUE 'N'.               
              10 WS-BM06F800-END             PIC X(01) VALUE 'N'.               
              10 WS-END-FILE                 PIC X(01) VALUE 'N'.               
                                                                                
           05 WS-SWITCH-IND.                                                    
              10 WS-FT-SW                    PIC X(01) VALUE 'Y'.               
              10 WS-NT-SW                    PIC X(01) VALUE 'Y'.               
              10 WS-FT-PRT-SW                PIC X(01) VALUE 'Y'.               
              10 WS-NT-PRT-SW                PIC X(01) VALUE 'Y'.               
              10 WS-FRST-F800                PIC X(01) VALUE 'N'.               
              10 WS-BM06F800-SW              PIC X(01) VALUE 'N'.               
                                                                                
           05 WS-COUNT-IND.                                                     
              10 WS-CNT-F800S                PIC 9(07) VALUE ZEROS.             
              10 WS-CNT-F800N                PIC 9(07) VALUE ZEROS.             
              10 WS-CNT-BM06F800             PIC 9(07) VALUE ZEROS.             
              10 WS-CNT-TOTL-F800            PIC 9(07) VALUE ZEROS.             
              10 WS-CNT-FTYPE                PIC 9(07) VALUE ZEROS.             
              10 WS-PAGE-CNT                 PIC 9(04) VALUE ZEROS.             
              10 WS-LINE-CNT                 PIC 9(02) VALUE 60.                
                                                                                
           05 WS-SAVE-IND.                                                      
              10 WS-F800S-FTYP-SV            PIC X(02) VALUE SPACES.            
              10 WS-F800N-FTYP-SV            PIC X(02) VALUE SPACES.            
              10 WS-CDE-TYP-SV               PIC X(02) VALUE SPACES.            
              10 WS-CDE-NT-SV                PIC X(03) VALUE SPACES.            
                                                                                
       01  WS-ARRAY-PTR.                                                        
           05 WS-REC-BM06F800-FT-PTR         PIC 9(03) VALUE ZEROS.             
           05 WS-REC-F800S-PTR               PIC 9(03) VALUE ZEROS.             
           05 WS-REC-F800N-PTR               PIC 9(03) VALUE ZEROS.             
                                                                                
       01  OTHER-VAR.                                                           
           05 WS-CDE-TYP                     PIC X(02) VALUE SPACES.            
           05 WS-CDE-NT                      PIC X(03) VALUE SPACES.            
           05 WS-F800S-FTYP                  PIC X(02) VALUE SPACES.            
           05 WS-F800N-FTYP                  PIC X(02) VALUE SPACES.            
           05 WS-K060-STAT                   PIC 9(02).                         
              88 WS-K060-OK                  VALUE 00 97.                       
           05 WS-SERIAL-NO                   PIC 9(02) VALUE 0.                 
           05 WS-K060-CODE                   PIC X(03) VALUE SPACES.            
                                                                                
       COPY PRIOSCH.                                                            
       COPY SERSCH.                                                             
                                                                                
       01  WS-RUN-DATE.                                                         
           05 WS-RUN-DATE-CC                 PIC X(02) VALUE SPACES.            
           05 WS-RUN-DATE-YY                 PIC X(02) VALUE SPACES.            
           05 WS-RUN-DATE-MM                 PIC X(02) VALUE SPACES.            
           05 WS-RUN-DATE-DD                 PIC X(02) VALUE SPACES.            
                                                                                
       01  WS-F800S-SAVE-ARRAYS.                                                
           05 WS-F800S-INDEX              PIC S9(4) COMP.                       
           05 WS-F800S-ARRAY              OCCURS 1  TO 105 TIMES                
                                          DEPENDING ON WS-F800S-INDEX.          
              10 WS-F800S-FTYPE           PIC X(02) VALUE SPACES.               
              10 WS-F800S-ALSCH           PIC X(03) VALUE SPACES.               
              10 WS-F800S-CNT             PIC 9(07) VALUE ZEROES.               
                                                                                
       01  WS-F800N-SAVE-ARRAYS.                                                
           05 WS-F800N-INDEX              PIC S9(4) COMP.                       
           05 WS-F800N-ARRAY              OCCURS 1  TO 105 TIMES                
                                          DEPENDING ON WS-F800N-INDEX.          
              10 WS-F800N-FTYPE           PIC X(02) VALUE SPACES.               
              10 WS-F800N-ALSCH           PIC X(03) VALUE SPACES.               
              10 WS-F800N-CNT             PIC 9(07) VALUE ZEROES.               
                                                                                
       01  WS-BM06F800-FT-ARRAYS.                                               
           05 WS-BM06F800-FT-IDX          PIC S9(4) COMP.                       
           05 WS-BM06F800-FT-ARRAY        OCCURS 1  TO 20 TIMES                 
                                       DEPENDING ON WS-BM06F800-FT-IDX.         
              10 WS-BM06F800-FT           PIC X(02) VALUE SPACES.               
              10 WS-BM06F800-TOTL-FT      PIC 9(7)  VALUE 0.                    
                                                                                
                                                                                
      **********************                                                    
       PROCEDURE DIVISION.                                                      
      **********************                                                    
                                                                                
      *-----------------*                                                       
       000-MAIN-ROUTINE.                                                        
      *-----------------*                                                       
                                                                                
           PERFORM  100-OPEN-ROUTINE        THRU    100-EXIT.                   
           PERFORM  200-READ-P13F800S       THRU    200-EXIT.                   
           PERFORM  300-READ-P13F800N       THRU    300-EXIT.                   
           PERFORM  400-COUNT-BM06F800      THRU    400-EXIT.                   
           IF WS-BM06F800-END NOT = 'Y'                                         
              PERFORM  410-READ-BM06F800    THRU    410-EXIT                    
           END-IF.                                                              
                                                                                
           IF WS-F800S-END = 'Y' AND WS-F800N-END = 'Y'                         
             AND WS-BM06F800-END = 'Y'                                          
             MOVE 'Y' TO WS-END-FILE                                            
           END-IF.                                                              
                                                                                
           PERFORM  500-GENERAL-PROCESS     THRU    500-EXIT                    
                        UNTIL WS-END-FILE = 'Y'.                                
                                                                                
           PERFORM  800-DISPLAY-STATISTICS  THRU    800-EXIT.                   
           PERFORM  999-CLOSE-FILE          THRU    999-EXIT.                   
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *------------------*                                                      
       100-OPEN-ROUTINE.                                                        
      *------------------*                                                      
                                                                                
           OPEN INPUT  P13F800S                                                 
                       P13F800N                                                 
                       BM06F800                                                 
                       BP13K060                                                 
                OUTPUT P13L289A.                                                
                                                                                
           IF NOT WS-K060-OK                                                    
             DISPLAY 'FILE OPEN ERROR => BP13C289'                              
             PERFORM 900-FILE-ERROR THRU 900-EXIT                               
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-RUN-DATE.                           
           MOVE   WS-RUN-DATE-CC  TO   RUN-CC.                                  
           MOVE   WS-RUN-DATE-YY  TO   RUN-YY.                                  
           MOVE   WS-RUN-DATE-MM  TO   RUN-MM.                                  
           MOVE   WS-RUN-DATE-DD  TO   RUN-DD.                                  
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       200-READ-P13F800S.                                                       
      *-------------------*                                                     
                                                                                
           READ P13F800S                                                        
               AT END MOVE 'Y'   TO  WS-F800S-END                               
               MOVE HIGH-VALUES  TO  WS-F800S-FTYP                              
               GO TO 200-EXIT.                                                  
                                                                                
           ADD 1 TO WS-CNT-F800S.                                               
                                                                                
           MOVE F800S-FLAT-TYP TO WS-F800S-FTYP.                                
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       300-READ-P13F800N.                                                       
      *-------------------*                                                     
                                                                                
           READ P13F800N                                                        
               AT END MOVE 'Y'   TO  WS-F800N-END                               
               MOVE HIGH-VALUES  TO  WS-F800N-FTYP                              
               GO TO 300-EXIT.                                                  
                                                                                
           ADD 1 TO WS-CNT-F800N.                                               
                                                                                
           MOVE F800N-FLAT-TYP TO WS-F800N-FTYP.                                
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *------------------*                                                      
       400-COUNT-BM06F800.                                                      
      *------------------*                                                      
                                                                                
           MOVE  ZEROES  TO  WS-REC-BM06F800-FT-PTR                             
                             WS-BM06F800-FT-IDX.                                
                                                                                
           PERFORM VARYING WS-REC-BM06F800-FT-PTR FROM 1 BY 1                   
                   UNTIL   WS-REC-BM06F800-FT-PTR > WS-BM06F800-FT-IDX          
                                                                                
             MOVE ZEROES  TO  WS-BM06F800-TOTL-FT                               
                              (WS-REC-BM06F800-FT-PTR)                          
             MOVE SPACES  TO  WS-BM06F800-FT (WS-REC-BM06F800-FT-PTR)           
                                                                                
           END-PERFORM.                                                         
                                                                                
           MOVE  ZEROES  TO  WS-REC-BM06F800-FT-PTR.                            
                                                                                
           MOVE 'Y'      TO  WS-FRST-F800.                                      
           READ BM06F800                                                        
               AT END MOVE 'Y'  TO  WS-BM06F800-END                             
               MOVE HIGH-VALUES TO  WS-CDE-TYP                                  
               GO TO 400-EXIT.                                                  
                                                                                
           ADD 1 TO WS-CNT-FTYPE.                                               
                                                                                
           MOVE F800-CDE-TYP-ACTUSE TO WS-CDE-TYP                               
                                       WS-CDE-TYP-SV.                           
                                                                                
           PERFORM 401-ACCUM-FT-TOTL THRU 401-EXIT                              
               UNTIL WS-BM06F800-END = 'Y'.                                     
                                                                                
           CLOSE BM06F800.                                                      
                                                                                
           MOVE ZEROS  TO  WS-CNT-BM06F800.                                     
           MOVE ZEROS  TO  WS-CNT-FTYPE.                                        
           MOVE ZEROS  TO  WS-REC-BM06F800-FT-PTR.                              
           MOVE 'N'    TO  WS-BM06F800-END.                                     
           MOVE 'N'    TO  WS-FRST-F800.                                        
                                                                                
           OPEN INPUT BM06F800.                                                 
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       401-ACCUM-FT-TOTL.                                                       
      *-------------------*                                                     
                                                                                
           PERFORM 410-READ-BM06F800 THRU 410-EXIT                              
               UNTIL F800-CDE-TYP-ACTUSE NOT = WS-CDE-TYP-SV                    
               OR    WS-BM06F800-END = 'Y'.                                     
                                                                                
           ADD 1 TO WS-REC-BM06F800-FT-PTR.                                     
           ADD 1 TO WS-BM06F800-FT-IDX.                                         
                                                                                
           MOVE WS-CDE-TYP-SV    TO  WS-BM06F800-FT                             
                                     (WS-REC-BM06F800-FT-PTR).                  
           MOVE WS-CNT-FTYPE     TO  WS-BM06F800-TOTL-FT                        
                                     (WS-REC-BM06F800-FT-PTR).                  
                                                                                
           MOVE F800-CDE-TYP-ACTUSE  TO  WS-CDE-TYP-SV.                         
           MOVE ZEROES               TO  WS-CNT-FTYPE.                          
           ADD  1                    TO  WS-CNT-FTYPE.                          
                                                                                
       401-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       410-READ-BM06F800.                                                       
      *-------------------*                                                     
                                                                                
           READ BM06F800                                                        
               AT END MOVE 'Y'   TO  WS-BM06F800-END                            
               MOVE HIGH-VALUES  TO  WS-CDE-TYP                                 
               GO TO 410-EXIT.                                                  
                                                                                
           IF WS-FRST-F800 = 'Y'                                                
             IF F800-CDE-TYP-ACTUSE = WS-CDE-TYP-SV                             
                ADD 1 TO WS-CNT-FTYPE                                           
             END-IF                                                             
           ELSE                                                                 
             MOVE F800-CDE-TYP-ACTUSE TO WS-CDE-TYP                             
             MOVE F800-CDE-NT         TO WS-CDE-NT                              
             ADD  1                   TO WS-CNT-BM06F800                        
             ADD  1                   TO WS-CNT-TOTL-F800                       
           END-IF.                                                              
                                                                                
       410-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       500-GENERAL-PROCESS.                                                     
      *-------------------*                                                     
                                                                                
           PERFORM 501-INIT-ARRAY THRU 501-EXIT.                                
                                                                                
           MOVE WS-F800S-FTYP  TO    WS-F800S-FTYP-SV.                          
           MOVE WS-F800N-FTYP  TO    WS-F800N-FTYP-SV.                          
           MOVE WS-CDE-TYP     TO    WS-CDE-TYP-SV.                             
           MOVE WS-CDE-NT      TO    WS-CDE-NT-SV                               
                                                                                
           MOVE 'Y'            TO    WS-FT-SW.                                  
           MOVE 'Y'            TO    WS-NT-SW.                                  
           MOVE 'Y'            TO    WS-NT-PRT-SW.                              
           MOVE 'N'            TO    WS-F800S-ARR-END.                          
           MOVE 'N'            TO    WS-F800N-ARR-END.                          
           MOVE 'N'            TO    WS-BM06F800-SW.                            
           MOVE  1             TO    WS-CNT-BM06F800.                           
                                                                                
           PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT.                          
                                                                                
           IF   WS-F800S-FTYP = WS-F800N-FTYP                                   
               PERFORM 510-SAME-F800       THRU   510-EXIT                      
           ELSE                                                                 
            IF  WS-F800S-FTYP > WS-F800N-FTYP                                   
               PERFORM 520-F800N-FIRST     THRU   520-EXIT                      
            ELSE                                                                
             IF WS-F800S-FTYP < WS-F800N-FTYP                                   
               PERFORM 530-F800S-FIRST     THRU   530-EXIT                      
             END-IF                                                             
            END-IF                                                              
           END-IF.                                                              
                                                                                
           IF WS-F800S-END = 'Y' AND WS-F800N-END = 'Y'                         
             AND WS-BM06F800-END = 'Y'                                          
             MOVE 'Y' TO WS-END-FILE                                            
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       501-INIT-ARRAY.                                                          
      *--------------------*                                                    
                                                                                
           PERFORM VARYING WS-REC-F800N-PTR FROM 1 BY 1                         
                   UNTIL   WS-REC-F800N-PTR > WS-F800N-INDEX                    
             MOVE  ZEROS  TO  WS-F800N-CNT   (WS-REC-F800N-PTR)                 
             MOVE  SPACES TO  WS-F800N-FTYPE (WS-REC-F800N-PTR)                 
             MOVE  SPACES TO  WS-F800N-ALSCH (WS-REC-F800N-PTR)                 
           END-PERFORM.                                                         
                                                                                
           PERFORM VARYING WS-REC-F800S-PTR FROM 1 BY 1                         
                   UNTIL   WS-REC-F800S-PTR > WS-F800S-INDEX                    
             MOVE  ZEROS  TO  WS-F800S-CNT   (WS-REC-F800S-PTR)                 
             MOVE  SPACES TO  WS-F800S-FTYPE (WS-REC-F800S-PTR)                 
             MOVE  SPACES TO  WS-F800S-ALSCH (WS-REC-F800S-PTR)                 
           END-PERFORM.                                                         
                                                                                
           MOVE ZEROS TO WS-F800N-INDEX                                         
                         WS-F800S-INDEX                                         
                         WS-REC-F800N-PTR                                       
                         WS-REC-F800S-PTR.                                      
                                                                                
       501-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       510-SAME-F800.                                                           
      *--------------------*                                                    
                                                                                
           IF WS-CDE-TYP(2:1)  = WS-F800S-FTYP                                  
                                                                                
             PERFORM 540-F800S-SAME-FTYP THRU 540-EXIT                          
               UNTIL WS-F800S-FTYP NOT = WS-F800S-FTYP-SV                       
               OR    WS-F800S-END      = 'Y'                                    
             MOVE  1              TO  WS-REC-F800S-PTR                          
                                                                                
             PERFORM 550-F800N-SAME-FTYP THRU 550-EXIT                          
               UNTIL WS-F800N-FTYP NOT = WS-F800N-FTYP-SV                       
               OR    WS-F800N-END      = 'Y'                                    
             MOVE  1              TO  WS-REC-F800N-PTR                          
                                                                                
             PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                         
               UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                             
               OR    WS-BM06F800-END     =     'Y'                              
                                                                                
           ELSE                                                                 
             IF WS-CDE-TYP(2:1) > WS-F800S-FTYP                                 
                                                                                
               PERFORM 540-F800S-SAME-FTYP THRU 540-EXIT                        
                 UNTIL WS-F800S-FTYP NOT = WS-F800S-FTYP-SV                     
                 OR    WS-F800S-END      = 'Y'                                  
               MOVE  1              TO  WS-REC-F800S-PTR                        
                                                                                
               PERFORM 550-F800N-SAME-FTYP THRU 550-EXIT                        
                 UNTIL WS-F800N-FTYP NOT = WS-F800N-FTYP-SV                     
                 OR    WS-F800N-END      = 'Y'                                  
               MOVE  1              TO  WS-REC-F800N-PTR                        
                                                                                
               MOVE     WS-F800S-FTYP-SV   TO    WS-K060-CODE                   
               MOVE     '34'               TO    WS-SERIAL-NO                   
               PERFORM  570-READ-K060      THRU  570-EXIT                       
               MOVE     WS-DET-FTYPE       TO    DETAIL-FTYPE                   
               PERFORM  620-ALL-ALSCH      THRU  620-EXIT                       
                 UNTIL WS-F800S-ARR-END = 'Y' AND                               
                       WS-F800N-ARR-END = 'Y'                                   
               PERFORM 730-PRINT-FOOTER    THRU  730-EXIT                       
               PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT                       
             ELSE                                                               
               IF WS-CDE-TYP(2:1) < WS-F800S-FTYP                               
                 MOVE 'Y' TO WS-BM06F800-SW                                     
                 PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                     
                  UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                          
                  OR    WS-BM06F800-END     =     'Y'                           
               END-IF                                                           
             END-IF                                                             
           END-IF.                                                              
                                                                                
       510-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       520-F800N-FIRST.                                                         
      *--------------------*                                                    
                                                                                
           IF WS-CDE-TYP(2:1) = WS-F800N-FTYP                                   
                                                                                
             PERFORM 550-F800N-SAME-FTYP THRU 550-EXIT                          
               UNTIL WS-F800N-FTYP NOT = WS-F800N-FTYP-SV                       
               OR    WS-F800N-END      = 'Y'                                    
             MOVE  1              TO  WS-REC-F800N-PTR                          
             MOVE  1              TO  WS-REC-F800S-PTR                          
                                                                                
             PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                         
               UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                             
               OR    WS-BM06F800-END     =     'Y'                              
                                                                                
           ELSE                                                                 
             IF WS-CDE-TYP(2:1) > WS-F800N-FTYP                                 
                                                                                
               PERFORM 550-F800N-SAME-FTYP THRU 550-EXIT                        
                 UNTIL WS-F800N-FTYP NOT = WS-F800N-FTYP-SV                     
                 OR    WS-F800N-END      = 'Y'                                  
               MOVE  1              TO  WS-REC-F800N-PTR                        
               MOVE  1              TO  WS-REC-F800S-PTR                        
                                                                                
               MOVE     WS-F800N-FTYP-SV   TO    WS-K060-CODE                   
               MOVE     '34'               TO    WS-SERIAL-NO                   
               PERFORM  570-READ-K060      THRU  570-EXIT                       
               MOVE     WS-DET-FTYPE       TO    DETAIL-FTYPE                   
               PERFORM  620-ALL-ALSCH      THRU  620-EXIT                       
                 UNTIL WS-F800N-ARR-END = 'Y'                                   
                                                                                
               PERFORM 730-PRINT-FOOTER    THRU  730-EXIT                       
               PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT                       
             ELSE                                                               
               IF WS-CDE-TYP(2:1) < WS-F800N-FTYP                               
                 MOVE 'Y' TO WS-BM06F800-SW                                     
                 PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                     
                  UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                          
                  OR    WS-BM06F800-END     =     'Y'                           
               END-IF                                                           
             END-IF                                                             
           END-IF.                                                              
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       530-F800S-FIRST.                                                         
      *--------------------*                                                    
                                                                                
           IF WS-CDE-TYP(2:1) = WS-F800S-FTYP                                   
                                                                                
             PERFORM 540-F800S-SAME-FTYP THRU 540-EXIT                          
               UNTIL WS-F800S-FTYP NOT = WS-F800S-FTYP-SV                       
               OR    WS-F800S-END      = 'Y'                                    
             MOVE  1              TO  WS-REC-F800S-PTR                          
             MOVE  1              TO  WS-REC-F800N-PTR                          
                                                                                
             PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                         
               UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                             
               OR    WS-BM06F800-END     =     'Y'                              
                                                                                
           ELSE                                                                 
             IF WS-CDE-TYP(2:1) > WS-F800S-FTYP                                 
               PERFORM 540-F800S-SAME-FTYP THRU 540-EXIT                        
                 UNTIL WS-F800S-FTYP NOT = WS-F800S-FTYP-SV                     
                 OR    WS-F800S-END      = 'Y'                                  
               MOVE  1              TO  WS-REC-F800S-PTR                        
               MOVE  1              TO  WS-REC-F800N-PTR                        
                                                                                
               MOVE     WS-F800S-FTYP-SV   TO    WS-K060-CODE                   
               MOVE     '34'               TO    WS-SERIAL-NO                   
               PERFORM  570-READ-K060      THRU  570-EXIT                       
               MOVE     WS-DET-FTYPE       TO    DETAIL-FTYPE                   
               PERFORM  620-ALL-ALSCH      THRU  620-EXIT                       
                 UNTIL WS-F800S-ARR-END = 'Y'                                   
                                                                                
               PERFORM 730-PRINT-FOOTER    THRU  730-EXIT                       
               PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT                       
             ELSE                                                               
               IF WS-CDE-TYP(2:1) < WS-F800S-FTYP                               
                 MOVE 'Y' TO WS-BM06F800-SW                                     
                 PERFORM 560-PROCESS-BM06F800 THRU 560-EXIT                     
                  UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                          
                  OR    WS-BM06F800-END     =     'Y'                           
               END-IF                                                           
             END-IF                                                             
           END-IF.                                                              
                                                                                
       530-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       540-F800S-SAME-FTYP.                                                     
      *-------------------*                                                     
                                                                                
           ADD 1 TO WS-REC-F800S-PTR.                                           
           ADD 1 TO WS-F800S-INDEX.                                             
           MOVE F800S-FLAT-TYP TO WS-F800S-FTYPE (WS-REC-F800S-PTR).            
           MOVE F800S-ALLO-SCH TO WS-F800S-ALSCH (WS-REC-F800S-PTR).            
           MOVE F800S-REC-CNT  TO WS-F800S-CNT   (WS-REC-F800S-PTR).            
                                                                                
           PERFORM  200-READ-P13F800S  THRU  200-EXIT.                          
                                                                                
       540-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       550-F800N-SAME-FTYP.                                                     
      *-------------------*                                                     
                                                                                
           ADD 1 TO WS-REC-F800N-PTR.                                           
           ADD 1 TO WS-F800N-INDEX.                                             
           MOVE F800N-FLAT-TYP TO WS-F800N-FTYPE (WS-REC-F800N-PTR).            
           MOVE F800N-ALLO-SCH TO WS-F800N-ALSCH (WS-REC-F800N-PTR).            
           MOVE F800N-REC-CNT  TO WS-F800N-CNT   (WS-REC-F800N-PTR).            
                                                                                
           PERFORM  300-READ-P13F800N  THRU  300-EXIT.                          
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       560-PROCESS-BM06F800.                                                    
      *-------------------*                                                     
                                                                                
           IF WS-FT-SW = 'Y'                                                    
             MOVE     WS-CDE-TYP-SV(2:1) TO    WS-K060-CODE                     
             MOVE     '34'               TO    WS-SERIAL-NO                     
             PERFORM  570-READ-K060      THRU  570-EXIT                         
             PERFORM  610-F800-FT-ARRAY  THRU  610-EXIT                         
                      UNTIL WS-BM06F800-FT (WS-REC-BM06F800-FT-PTR)             
                            = WS-CDE-TYP-SV                                     
             MOVE     WS-DET-TOTL-FLAT   TO    DETAIL-TOTL-FLAT                 
             MOVE     ZEROS    TO   WS-REC-BM06F800-FT-PTR                      
           END-IF.                                                              
                                                                                
           PERFORM 565-PROCESS-BLOCK     THRU 565-EXIT                          
             UNTIL WS-CDE-TYP NOT = WS-CDE-TYP-SV                               
             OR    WS-CDE-NT  NOT = WS-CDE-NT-SV                                
             OR    WS-CNT-BM06F800     >     4                                  
             OR    WS-BM06F800-END     =     'Y'.                               
                                                                                
           PERFORM 600-MOVE-TO-PRINT THRU 600-EXIT.                             
                                                                                
           IF WS-CDE-NT NOT = WS-CDE-NT-SV                                      
              MOVE  WS-CDE-NT  TO  WS-CDE-NT-SV                                 
              MOVE  1          TO  WS-CNT-BM06F800                              
              MOVE 'Y'         TO  WS-NT-SW                                     
              MOVE 'Y'         TO  WS-NT-PRT-SW                                 
           ELSE                                                                 
              IF WS-CNT-BM06F800 > 4                                            
              MOVE 1 TO WS-CNT-BM06F800                                         
           END-IF.                                                              
                                                                                
       560-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       565-PROCESS-BLOCK.                                                       
      *-------------------*                                                     
                                                                                
           IF WS-NT-SW = 'Y'                                                    
             MOVE     WS-CDE-NT-SV         TO    WS-K060-CODE                   
             MOVE     '02'                 TO    WS-SERIAL-NO                   
             PERFORM  570-READ-K060        THRU  570-EXIT                       
           END-IF.                                                              
                                                                                
           EVALUATE WS-CNT-BM06F800                                             
             WHEN 1                                                             
              MOVE F800-BLK-NO       TO  WS-DET-BLK1                            
             WHEN 2                                                             
              MOVE F800-BLK-NO       TO  WS-DET-BLK2                            
             WHEN 3                                                             
              MOVE F800-BLK-NO       TO  WS-DET-BLK3                            
             WHEN 4                                                             
              MOVE F800-BLK-NO       TO  WS-DET-BLK4                            
           END-EVALUATE.                                                        
                                                                                
           PERFORM 410-READ-BM06F800 THRU 410-EXIT.                             
                                                                                
       565-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       570-READ-K060.                                                           
      *-------------------*                                                     
                                                                                
           MOVE SPACES                 TO K060-KEY-FLD.                         
           INITIALIZE                     K060-KEY-FLD.                         
           MOVE WS-SERIAL-NO           TO K060-SERIAL-NO.                       
           MOVE WS-K060-CODE           TO K060-CODE.                            
                                                                                
           READ BP13K060.                                                       
                                                                                
           EVALUATE WS-K060-STAT                                                
                                                                                
           WHEN 00                                                              
             IF K060-SERIAL-NO =   '34'                                         
               MOVE K060-DESC            TO  WS-DET-FTYPE                       
               MOVE 'N'                  TO  WS-FT-SW                           
      *      ELSE                                                               
      *       IF K060-SERIAL-NO =  '05'                                         
      *          MOVE K060-DESC          TO  WS-DET-CAT                         
              ELSE                                                              
               IF K060-SERIAL-NO = '02'                                         
                  MOVE K060-DESC         TO  WS-DET-CD-NT                       
                  MOVE 'N'               TO  WS-NT-SW                           
               END-IF                                                           
      *       END-IF                                                            
             END-IF                                                             
                                                                                
           WHEN 23                                                              
             IF K060-SERIAL-NO =     '34'                                       
               MOVE SPACES                 TO  WS-DET-FTYPE                     
               MOVE 'N'                    TO  WS-FT-SW                         
      *      ELSE                                                               
      *        IF K060-SERIAL-NO =   '05'                                       
      *          MOVE SPACES               TO  WS-DET-CAT                       
               ELSE                                                             
                 IF K060-SERIAL-NO = '02'                                       
                   MOVE SPACES             TO  WS-DET-CD-NT                     
                   MOVE 'N'                TO  WS-NT-SW                         
                 END-IF                                                         
      *        END-IF                                                           
             END-IF                                                             
                                                                                
             DISPLAY 'BP13K060 RECORD NOT FOUND :' K060-KEY-FLD                 
                                                                                
           WHEN OTHER                                                           
             DISPLAY 'FILE READ ERROR => BP13C289'                              
             PERFORM 900-FILE-ERROR THRU 900-EXIT                               
                                                                                
           END-EVALUATE.                                                        
                                                                                
       570-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *----------------------*                                                  
       599-INIT-PRINT-VAR.                                                      
      *----------------------*                                                  
                                                                                
           MOVE  SPACES  TO  WS-DET-FTYPE                                       
                             WS-DET-CD-NT                                       
                             WS-DET-BLK1                                        
                             WS-DET-BLK2                                        
                             WS-DET-BLK3                                        
                             WS-DET-BLK4                                        
                             WS-DET-CAT                                         
                             WS-DET-CAT-F800S                                   
                             WS-DET-CAT-F800N                                   
                             DETAIL-LINE1                                       
                             DETAIL-LINE2.                                      
           MOVE  ZEROES  TO  WS-DET-TOTL-FLAT                                   
                             WS-DET-TOTL-APPLCNT                                
                             WS-DET-FLAT-SEL                                    
                             WS-DET-FLAT-NOT-SEL.                               
                                                                                
       599-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       600-MOVE-TO-PRINT.                                                       
      *-------------------*                                                     
                                                                                
           MOVE  WS-DET-FTYPE      TO  DETAIL-FTYPE.                            
           MOVE  WS-DET-CD-NT      TO  DETAIL-CD-NT.                            
           MOVE  WS-DET-BLK1       TO  DETAIL-BLK1.                             
           MOVE  WS-DET-BLK2       TO  DETAIL-BLK2.                             
           MOVE  WS-DET-BLK3       TO  DETAIL-BLK3.                             
           MOVE  WS-DET-BLK4       TO  DETAIL-BLK4.                             
                                                                                
           IF WS-BM06F800-SW = 'N'                                              
             IF  WS-CDE-TYP NOT = WS-CDE-TYP-SV                                 
                 OR  WS-BM06F800-END = 'Y'                                      
                                                                                
                IF WS-F800S-ARR-END = 'Y' AND                                   
                   WS-F800N-ARR-END = 'Y'                                       
                   PERFORM 700-PRINT-REPORT THRU 700-EXIT                       
                   GO TO 600-EXIT                                               
                ELSE                                                            
                 PERFORM 620-ALL-ALSCH THRU 620-EXIT                            
                UNTIL WS-F800S-ARR-END = 'Y' AND WS-F800N-ARR-END = 'Y'         
                 PERFORM 730-PRINT-FOOTER THRU 730-EXIT                         
                 PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT                     
                 GO TO 600-EXIT                                                 
                END-IF                                                          
                                                                                
             ELSE                                                               
               IF WS-F800S-ARR-END = 'N'                                        
                 PERFORM 630-F800S-ARRAY   THRU 630-EXIT                        
               END-IF                                                           
                                                                                
               IF WS-F800N-ARR-END = 'N'                                        
                 PERFORM 640-F800N-ARRAY   THRU 640-EXIT                        
               END-IF                                                           
             END-IF                                                             
             PERFORM 650-MOVE-ALSCH    THRU  650-EXIT                           
           END-IF.                                                              
                                                                                
           PERFORM 700-PRINT-REPORT  THRU  700-EXIT.                            
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       610-F800-FT-ARRAY.                                                       
      *-------------------*                                                     
                                                                                
           ADD 1 TO WS-REC-BM06F800-FT-PTR.                                     
           IF WS-BM06F800-FT (WS-REC-BM06F800-FT-PTR)                           
              = WS-CDE-TYP-SV                                                   
              MOVE WS-BM06F800-TOTL-FT (WS-REC-BM06F800-FT-PTR)                 
                   TO  WS-DET-TOTL-FLAT                                         
           END-IF.                                                              
                                                                                
       610-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       620-ALL-ALSCH.                                                           
      *-------------------*                                                     
                                                                                
           IF WS-F800S-ARR-END = 'N'                                            
             PERFORM 630-F800S-ARRAY   THRU 630-EXIT                            
           END-IF.                                                              
                                                                                
           IF WS-F800N-ARR-END = 'N'                                            
             PERFORM 640-F800N-ARRAY   THRU 640-EXIT                            
           END-IF.                                                              
                                                                                
           PERFORM 650-MOVE-ALSCH      THRU 650-EXIT.                           
                                                                                
           IF WS-F800S-ARR-END NOT = 'Y' OR                                     
              WS-F800N-ARR-END NOT = 'Y'                                        
             PERFORM 700-PRINT-REPORT  THRU 700-EXIT                            
           END-IF.                                                              
                                                                                
       620-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       630-F800S-ARRAY.                                                         
      *-------------------*                                                     
                                                                                
           IF WS-REC-F800S-PTR  <=  WS-F800S-INDEX                              
             MOVE  WS-F800S-ALSCH (WS-REC-F800S-PTR)                            
              TO   WS-DET-CAT-F800S                                             
             MOVE  WS-F800S-CNT (WS-REC-F800S-PTR)                              
              TO   WS-DET-FLAT-SEL                                              
           ELSE                                                                 
             MOVE 'Y'  TO  WS-F800S-ARR-END                                     
           END-IF.                                                              
                                                                                
       630-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       640-F800N-ARRAY.                                                         
      *-------------------*                                                     
                                                                                
           IF WS-REC-F800N-PTR  <=  WS-F800N-INDEX                              
             MOVE  WS-F800N-ALSCH (WS-REC-F800N-PTR)                            
              TO   WS-DET-CAT-F800N                                             
             MOVE  WS-F800N-CNT (WS-REC-F800N-PTR)                              
              TO   WS-DET-FLAT-NOT-SEL                                          
           ELSE                                                                 
             MOVE 'Y'  TO  WS-F800N-ARR-END                                     
           END-IF.                                                              
                                                                                
       640-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       650-MOVE-ALSCH.                                                          
      *-------------------*                                                     
                                                                                
           IF WS-DET-CAT-F800S NOT = SPACES AND                                 
              WS-DET-CAT-F800N NOT = SPACES                                     
            IF WS-DET-CAT-F800S = WS-DET-CAT-F800N                              
              MOVE     WS-DET-CAT-F800S   TO    WS-PRIO-ALSCH                   
              PERFORM  777-CHK-SERS-ALSCH THRU  777-EXIT                        
              IF C-SERS-ALLO-SCHEME OR WS-PRIO-ALSCH = 'RED'                    
                 MOVE  'SERS'             TO    WS-DET-CAT                      
              ELSE                                                              
               PERFORM  651-DECODE-ALSCH  THRU  651-EXIT                        
              END-IF                                                            
      *       MOVE     WS-DET-CAT-F800S   TO    WS-K060-CODE                    
      *       MOVE    '05'                TO    WS-SERIAL-NO                    
      *       PERFORM  570-READ-K060      THRU  570-EXIT                        
              COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-FLAT-SEL                     
                                          + WS-DET-FLAT-NOT-SEL                 
                                                                                
              COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT                 
                                          + WS-DET-TOTL-APPLCNT                 
              COMPUTE WS-FOOT-FLAT-SEL    = WS-FOOT-FLAT-SEL                    
                                          + WS-DET-FLAT-SEL                     
              COMPUTE WS-FOOT-NOT-SEL     = WS-FOOT-NOT-SEL                     
                                          + WS-DET-FLAT-NOT-SEL                 
              MOVE WS-DET-CAT           TO  DETAIL-CAT                          
              MOVE WS-DET-TOTL-APPLCNT  TO  DETAIL-TOTL-APPLCNT                 
              MOVE WS-DET-FLAT-SEL      TO  DETAIL-FLAT-SEL                     
              MOVE WS-DET-FLAT-NOT-SEL  TO  DETAIL-FLAT-NOT-SEL                 
                                                                                
              ADD   1  TO  WS-REC-F800S-PTR                                     
              ADD   1  TO  WS-REC-F800N-PTR                                     
            ELSE                                                                
             IF WS-DET-CAT-F800S > WS-DET-CAT-F800N                             
                MOVE     WS-DET-CAT-F800N   TO    WS-PRIO-ALSCH                 
                PERFORM  777-CHK-SERS-ALSCH THRU  777-EXIT                      
                IF C-SERS-ALLO-SCHEME OR WS-PRIO-ALSCH = 'RED'                  
                  MOVE   'SERS'             TO    WS-DET-CAT                    
                ELSE                                                            
                  PERFORM  651-DECODE-ALSCH THRU  651-EXIT                      
                END-IF                                                          
      *         MOVE WS-DET-CAT-F800N     TO    WS-K060-CODE                    
      *         MOVE    '05'              TO    WS-SERIAL-NO                    
      *         PERFORM  570-READ-K060    THRU  570-EXIT                        
                COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT               
                                            + WS-DET-FLAT-NOT-SEL               
                COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT               
                                            + WS-DET-TOTL-APPLCNT               
                COMPUTE WS-FOOT-NOT-SEL     = WS-FOOT-NOT-SEL                   
                                            + WS-DET-FLAT-NOT-SEL               
                MOVE WS-DET-CAT           TO    DETAIL-CAT                      
                MOVE WS-DET-FLAT-NOT-SEL  TO    DETAIL-TOTL-APPLCNT             
                                                DETAIL-FLAT-NOT-SEL             
                MOVE SPACES               TO    DETAIL-FLAT-SEL-X               
                ADD 1 TO WS-REC-F800N-PTR                                       
             ELSE                                                               
               IF WS-DET-CAT-F800S < WS-DET-CAT-F800N                           
                  MOVE     WS-DET-CAT-F800S   TO    WS-PRIO-ALSCH               
                  PERFORM  777-CHK-SERS-ALSCH THRU  777-EXIT                    
                  IF C-SERS-ALLO-SCHEME OR WS-PRIO-ALSCH = 'RED'                
                    MOVE   'SERS'             TO    WS-DET-CAT                  
                  ELSE                                                          
                    PERFORM  651-DECODE-ALSCH THRU  651-EXIT                    
                  END-IF                                                        
      *           MOVE WS-DET-CAT-F800S   TO    WS-K060-CODE                    
      *           MOVE    '05'            TO    WS-SERIAL-NO                    
      *           PERFORM  570-READ-K060  THRU  570-EXIT                        
                  COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT             
                                              + WS-DET-FLAT-SEL                 
                  COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT             
                                              + WS-DET-TOTL-APPLCNT             
                  COMPUTE WS-FOOT-FLAT-SEL    = WS-FOOT-FLAT-SEL                
                                              + WS-DET-FLAT-SEL                 
                  MOVE WS-DET-CAT         TO    DETAIL-CAT                      
                  MOVE WS-DET-FLAT-SEL    TO    DETAIL-TOTL-APPLCNT             
                                                DETAIL-FLAT-SEL                 
                  MOVE SPACES             TO    DETAIL-FLAT-NOT-SEL-X           
                  ADD 1 TO WS-REC-F800S-PTR                                     
               END-IF                                                           
             END-IF                                                             
            END-IF                                                              
           ELSE                                                                 
            IF WS-DET-CAT-F800S = SPACES AND                                    
               WS-DET-CAT-F800N NOT = SPACES                                    
                IF WS-F800S-ARR-END NOT = 'Y'                                   
                  MOVE SPACES             TO    DETAIL-CAT                      
                  COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT             
                                              + WS-DET-FLAT-SEL                 
                  COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT             
                                              + WS-DET-TOTL-APPLCNT             
                  COMPUTE WS-FOOT-FLAT-SEL    = WS-FOOT-FLAT-SEL                
                                              + WS-DET-FLAT-SEL                 
                  MOVE WS-DET-FLAT-SEL    TO    DETAIL-TOTL-APPLCNT             
                                                DETAIL-FLAT-SEL                 
                  MOVE SPACES             TO    DETAIL-FLAT-NOT-SEL-X           
                  ADD 1 TO WS-REC-F800S-PTR                                     
                ELSE                                                            
                 MOVE     WS-DET-CAT-F800N   TO    WS-PRIO-ALSCH                
                 PERFORM  777-CHK-SERS-ALSCH THRU  777-EXIT                     
                 IF C-SERS-ALLO-SCHEME OR WS-PRIO-ALSCH = 'RED'                 
                   MOVE   'SERS'             TO    WS-DET-CAT                   
                 ELSE                                                           
                   PERFORM  651-DECODE-ALSCH THRU  651-EXIT                     
                 END-IF                                                         
      *          MOVE WS-DET-CAT-F800N     TO    WS-K060-CODE                   
      *          MOVE    '05'              TO    WS-SERIAL-NO                   
      *          PERFORM  570-READ-K060    THRU  570-EXIT                       
                 COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT              
                                             + WS-DET-FLAT-NOT-SEL              
                 COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT              
                                             + WS-DET-TOTL-APPLCNT              
                 COMPUTE WS-FOOT-NOT-SEL     = WS-FOOT-NOT-SEL                  
                                             + WS-DET-FLAT-NOT-SEL              
                 MOVE WS-DET-CAT           TO    DETAIL-CAT                     
                 MOVE WS-DET-FLAT-NOT-SEL  TO    DETAIL-TOTL-APPLCNT            
                                                 DETAIL-FLAT-NOT-SEL            
                 MOVE SPACES               TO    DETAIL-FLAT-SEL-X              
                 ADD 1 TO WS-REC-F800N-PTR                                      
                END-IF                                                          
            ELSE                                                                
             IF WS-DET-CAT-F800S NOT = SPACES AND                               
                WS-DET-CAT-F800N = SPACES                                       
                IF WS-F800N-ARR-END NOT = 'Y'                                   
                  MOVE SPACES               TO    DETAIL-CAT                    
                  COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT             
                                              + WS-DET-FLAT-NOT-SEL             
                  COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT             
                                              + WS-DET-TOTL-APPLCNT             
                  COMPUTE WS-FOOT-NOT-SEL     = WS-FOOT-NOT-SEL                 
                                              + WS-DET-FLAT-NOT-SEL             
                  MOVE WS-DET-FLAT-NOT-SEL  TO    DETAIL-TOTL-APPLCNT           
                                                  DETAIL-FLAT-NOT-SEL           
                  MOVE SPACES               TO    DETAIL-FLAT-SEL-X             
                  ADD 1 TO WS-REC-F800N-PTR                                     
                ELSE                                                            
                  MOVE     WS-DET-CAT-F800S   TO    WS-PRIO-ALSCH               
                  PERFORM  777-CHK-SERS-ALSCH THRU  777-EXIT                    
                  IF C-SERS-ALLO-SCHEME OR WS-PRIO-ALSCH = 'RED'                
                    MOVE   'SERS'             TO    WS-DET-CAT                  
                  ELSE                                                          
                    PERFORM  651-DECODE-ALSCH THRU  651-EXIT                    
                  END-IF                                                        
      *           MOVE WS-DET-CAT-F800S   TO    WS-K060-CODE                    
      *           MOVE    '05'            TO    WS-SERIAL-NO                    
      *           PERFORM  570-READ-K060  THRU  570-EXIT                        
                  COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-TOTL-APPLCNT             
                                              + WS-DET-FLAT-SEL                 
                  COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT             
                                              + WS-DET-TOTL-APPLCNT             
                  COMPUTE WS-FOOT-FLAT-SEL    = WS-FOOT-FLAT-SEL                
                                              + WS-DET-FLAT-SEL                 
                  MOVE WS-DET-CAT         TO    DETAIL-CAT                      
                  MOVE WS-DET-FLAT-SEL    TO    DETAIL-TOTL-APPLCNT             
                                                DETAIL-FLAT-SEL                 
                  MOVE SPACES             TO    DETAIL-FLAT-NOT-SEL-X           
                  ADD 1 TO WS-REC-F800S-PTR                                     
                END-IF                                                          
             ELSE                                                               
              IF (WS-DET-CAT-F800S = SPACES   AND                               
                  WS-DET-CAT-F800N = SPACES)                                    
               COMPUTE WS-DET-TOTL-APPLCNT = WS-DET-FLAT-SEL                    
                                           + WS-DET-FLAT-NOT-SEL                
                                                                                
               COMPUTE WS-FOOT-TOTL-APLCNT = WS-FOOT-TOTL-APLCNT                
                                           + WS-DET-TOTL-APPLCNT                
               COMPUTE WS-FOOT-FLAT-SEL    = WS-FOOT-FLAT-SEL                   
                                           + WS-DET-FLAT-SEL                    
               COMPUTE WS-FOOT-NOT-SEL     = WS-FOOT-NOT-SEL                    
                                           + WS-DET-FLAT-NOT-SEL                
                                                                                
               MOVE SPACES               TO  DETAIL-CAT                         
               MOVE WS-DET-TOTL-APPLCNT  TO  DETAIL-TOTL-APPLCNT                
               MOVE WS-DET-FLAT-SEL      TO  DETAIL-FLAT-SEL                    
               MOVE WS-DET-FLAT-NOT-SEL  TO  DETAIL-FLAT-NOT-SEL                
                                                                                
               IF WS-DET-TOTL-APPLCNT = 0                                       
                 MOVE SPACES             TO  DETAIL-TOTL-APPLCNT-X              
               END-IF                                                           
                                                                                
               IF WS-DET-FLAT-SEL = 0                                           
                 MOVE SPACES             TO  DETAIL-FLAT-SEL-X                  
               END-IF                                                           
                                                                                
               IF WS-DET-FLAT-NOT-SEL = 0                                       
                 MOVE SPACES             TO  DETAIL-FLAT-NOT-SEL-X              
               END-IF                                                           
                                                                                
               ADD   1  TO  WS-REC-F800S-PTR                                    
               ADD   1  TO  WS-REC-F800N-PTR                                    
              END-IF                                                            
             END-IF                                                             
            END-IF                                                              
           END-IF.                                                              
                                                                                
       650-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       651-DECODE-ALSCH.                                                        
      *-------------------*                                                     
                                                                                
           SET WS-ALLOC-PTR TO 1.                                               
                                                                                
           SEARCH WS-ALLOC-SCH                                                  
              AT END MOVE SPACES TO WS-ALSCH-CODE                               
              WHEN WS-PRIO-ALSCH =                                              
                                WS-ALLOC-SCH-DESP(WS-ALLOC-PTR)                 
              MOVE WS-MAIN-SCH-CD(WS-ALLOC-PTR) TO                              
                                      WS-ALSCH-CODE.                            
                                                                                
           EVALUATE WS-ALSCH-CODE                                               
             WHEN  'JB '  MOVE  'JOINT SELECTION'      TO  WS-DET-CAT           
             WHEN  'CCC'  MOVE  'GRO'                  TO  WS-DET-CAT           
             WHEN  'REN'  MOVE  'RELOCATION'           TO  WS-DET-CAT           
             WHEN  'REG'  MOVE  'RELOCATION'           TO  WS-DET-CAT           
             WHEN  'RNG'  MOVE  'RELOCATION'           TO  WS-DET-CAT           
             WHEN  'MTF'  MOVE  'MULTI-TIER FAMILY'    TO  WS-DET-CAT           
             WHEN  'TCP'  MOVE  'THIRD CHILD PRIORITY' TO  WS-DET-CAT           
             WHEN  'PA'   MOVE  'PUBLIC'               TO  WS-DET-CAT           
             WHEN  'RH'   MOVE  'RESETTLEMENT'         TO  WS-DET-CAT           
             WHEN  'RDC'  MOVE  'RENT DE-CONTROL'      TO  WS-DET-CAT           
             WHEN  '   '  MOVE  SPACES                 TO  WS-DET-CAT           
           END-EVALUATE.                                                        
                                                                                
       651-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       700-PRINT-REPORT.                                                        
      *-------------------*                                                     
                                                                                
           IF WS-LINE-CNT > 57                                                  
             PERFORM 710-PRINT-HEADING THRU  710-EXIT                           
           END-IF.                                                              
           PERFORM 720-PRINT-DETAIL    THRU  720-EXIT.                          
                                                                                
           IF  (WS-CDE-TYP NOT = WS-CDE-TYP-SV                                  
                OR  WS-BM06F800-END = 'Y')          AND                         
                (WS-F800S-ARR-END = 'Y' AND WS-F800N-ARR-END = 'Y')             
               PERFORM 730-PRINT-FOOTER THRU 730-EXIT                           
           END-IF.                                                              
                                                                                
           PERFORM 599-INIT-PRINT-VAR  THRU  599-EXIT.                          
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       710-PRINT-HEADING.                                                       
      *-------------------*                                                     
                                                                                
           ADD 1 TO WS-PAGE-CNT.                                                
           MOVE WS-PAGE-CNT TO PAGE-NO.                                         
           WRITE L289-REC FROM HEADING1 AFTER PAGE.                             
           WRITE L289-REC FROM HEADING2.                                        
           WRITE L289-REC FROM HEADING3.                                        
           WRITE L289-REC FROM COL-HEAD1 AFTER 2.                               
           WRITE L289-REC FROM COL-HEAD2.                                       
           WRITE L289-REC FROM COL-HEAD3.                                       
           WRITE L289-REC FROM COL-HEAD4.                                       
           WRITE L289-REC FROM COL-HEAD5.                                       
           MOVE  9  TO WS-LINE-CNT.                                             
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       720-PRINT-DETAIL.                                                        
      *-------------------*                                                     
                                                                                
           IF  WS-NT-PRT-SW = 'Y'                                               
             MOVE  SPACES TO L289-REC                                           
             WRITE L289-REC                                                     
             ADD 1 TO WS-LINE-CNT                                               
             IF WS-LINE-CNT > 57                                                
               PERFORM 710-PRINT-HEADING THRU  710-EXIT                         
             END-IF                                                             
                                                                                
             WRITE L289-REC FROM DETAIL-LINE1                                   
             ADD 1 TO WS-LINE-CNT                                               
             IF WS-LINE-CNT > 57                                                
               PERFORM 710-PRINT-HEADING THRU  710-EXIT                         
             END-IF                                                             
                                                                                
             WRITE L289-REC FROM DETAIL-LINE2                                   
             ADD 1 TO WS-LINE-CNT                                               
             MOVE 'N' TO WS-NT-PRT-SW                                           
           ELSE                                                                 
             IF  WS-NT-PRT-SW = 'N'                                             
               WRITE L289-REC FROM DETAIL-LINE2                                 
               ADD 1 TO WS-LINE-CNT                                             
             END-IF                                                             
           END-IF.                                                              
                                                                                
       720-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *----------------------*                                                  
       730-PRINT-FOOTER.                                                        
      *----------------------*                                                  
                                                                                
           MOVE  SPACES TO L289-REC.                                            
           WRITE L289-REC.                                                      
           ADD 1 TO WS-LINE-CNT.                                                
           IF WS-LINE-CNT > 57                                                  
             PERFORM 710-PRINT-HEADING THRU  710-EXIT                           
           END-IF.                                                              
                                                                                
           MOVE  WS-FOOT-TOTL-APLCNT  TO    FOOTER-APLCNT-TOTL.                 
           MOVE  WS-FOOT-FLAT-SEL     TO    FOOTER-SEL-TOTL.                    
           MOVE  WS-FOOT-NOT-SEL      TO    FOOTER-NOT-SEL-TOTL.                
                                                                                
           IF WS-FOOT-FLAT-SEL = 0                                              
             MOVE SPACES              TO    FOOTER-SEL-TOTL-X                   
           END-IF.                                                              
                                                                                
           IF WS-FOOT-NOT-SEL = 0                                               
             MOVE SPACES              TO    FOOTER-NOT-SEL-TOTL-X               
           END-IF.                                                              
                                                                                
           WRITE L289-REC             FROM  FOOTER-LINE.                        
           ADD 1 TO WS-LINE-CNT.                                                
                                                                                
           MOVE ZEROES                TO    WS-FOOT-TOTL-APLCNT                 
                                            WS-FOOT-FLAT-SEL                    
                                            WS-FOOT-NOT-SEL.                    
                                                                                
       730-EXIT.                                                                
           EXIT.                                                                
                                                                                
       777-CHK-SERS-ALSCH.                                                      
      *-------------------------------------------------------------            
      *----------------------------------------------------------------         
      * SEARCH SERS TABLE TO CHECK ALLOC SCHEME                                 
      *----------------------------------------------------------------         
           SET WS-SERS-PTR TO 1.                                                
           SEARCH WS-SERS-SCH                                                   
              AT END                                                            
                 MOVE 'N'      TO SW-SERS-ALLO-SCHEME                           
              WHEN WS-SERS-SCHEME (WS-SERS-PTR) = WS-PRIO-ALSCH                 
                 MOVE 'Y'      TO SW-SERS-ALLO-SCHEME                           
           END-SEARCH.                                                          
                                                                                
       777-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------*                                                  
       800-DISPLAY-STATISTICS.                                                  
      *----------------------*                                                  
                                                                                
           DISPLAY '***********  BP13C289 SUCCESSFUL **************  '.         
           DISPLAY '                                                 '.         
           DISPLAY '***********  BP13C289 CONTROL LIST  ***********  '.         
           DISPLAY '                                                 '.         
           DISPLAY 'P13F800S READ    RECORDS    = ' WS-CNT-F800S.               
           DISPLAY 'P13F800N READ    RECORDS    = ' WS-CNT-F800N.               
           DISPLAY 'BM06F800 READ    RECORDS    = ' WS-CNT-TOTL-F800.           
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       900-FILE-ERROR.                                                          
      *-----------------*                                                       
                                                                                
           DISPLAY 'BP13K060 STATUS = ' WS-K060-STAT.                           
           MOVE    WS-K060-STAT     TO    RETURN-CODE.                          
           PERFORM  999-CLOSE-FILE  THRU  999-EXIT.                             
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       999-CLOSE-FILE.                                                          
      *-----------------*                                                       
                                                                                
           CLOSE  P13F800S                                                      
                  P13F800N                                                      
                  BM06F800                                                      
                  BP13K060                                                      
                  P13L289A.                                                     
                                                                                
           STOP RUN.                                                            
                                                                                
       999-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
