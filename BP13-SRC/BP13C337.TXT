      *-------------------------*                                               
       IDENTIFICATION DIVISION.                                                 
      *-------------------------*                                               
       PROGRAM-ID.    BP13C337.                                                 
      *AUTHOR.        MALC.                                                     
      *DATE-WRITTEN.  20/05/2003.                                               
                                                                                
      *****************************************************************         
      *                                                               *         
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                         *         
      *                                                               *         
      *    SYSTEM ID : BP13                                           *         
      *                                                               *         
      *    OBJECTIVE  : TO CREATE CPF TRANSACTION ON SOC CPF          *         
      *                 FOR BANK CONVERSION STAMP FEE, CAVEAT FEE,    *         
      *                 MORTGAGE CONVEY FEE AND SALE CONVEY FEE       *         
      *                                                               *         
      *    INPUT FILES:                                               *         
      *           1. BP13F671 - (BANK ORIGINATION FILE)               *         
      *           2. SY02F001 - (BANK ORIGINATION FILE)               *         
      *                                                               *         
      *    INPUT-OUTPUT FILES:                                        *         
      *           1. BP13K671 - I-O (BANK ORIGINATION FILE)           *         
      *                                                               *         
      *    OUTPUT FILES:                                              *         
      *           1. BP13F121 (CPF TRANSACTIONS FILE)                 *         
      *                                                               *         
      *---------------------------------------------------------------*         
      * CHG-NO  BY     DATE   DESCRIPTION                             *         
      *======== ==== ======== ========================================*         
      *BP132341 MCC  20052003 NEW PROGRAM                             *         
      *BP132526 SK   18062004 INCREASE BP13K671 TO 3000               *         
      *BP139211 KAC1 02012023 TO IMPLEMENT 8% GST                     *         
      *                          REPLACED BP13C90C BY AV02C025        *         
      *BP139485 KAC1 02012024 TO IMPLEMENT 9% GST                     *         
      *                          REPLACED BP13C90C BY AV02C025        *         
      *****************************************************************         
                                                                                
      *--------------------------------------------------------*                
       ENVIRONMENT DIVISION.                                                    
      *--------------------------------------------------------*                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F671 ASSIGN TO BP13F671.                                  
                                                                                
           SELECT SY02F001 ASSIGN TO SY02F001.                                  
                                                                                
           SELECT BP13K671 ASSIGN TO BP13K671                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K671-NUM-REGN                              
                  FILE STATUS     IS WS-K671-STATUS.                            
                                                                                
           SELECT BP13F121 ASSIGN TO BP13F121.                                  
                                                                                
      *-------------------------*                                               
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------*                                               
                                                                                
       FD  BP13F671                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 3000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F.                                                 
       COPY BP13F671.                                                           
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13K671                                                            
            RECORD CONTAINS 3000 CHARACTERS.                                    
       COPY BP13K671.                                                           
                                                                                
       FD  BP13F121                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       COPY BP13F121.                                                           
                                                                                
      *-------------------------*                                               
       WORKING-STORAGE SECTION.                                                 
      *-------------------------*                                               
                                                                                
       01  WS-STATUS-FLAGS.                                                     
           05  WS-F671-EOF                PIC X       VALUE 'N'.                
           05  WS-K671-STATUS             PIC 99      VALUE ZEROES.             
           05  WS-CNVRS-FEE-PROCESSED     PIC X       VALUE 'N'.                
           05  WS-CPF-TYPE                PIC X       VALUE SPACES.             
           05  WS-F001-EOF                PIC X       VALUE 'N'.                
               88  EOF-F001                           VALUE 'Y'.                
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F671-READ               PIC 9(5)    VALUE ZEROES.             
           05  WS-F671-SKIP               PIC 9(5)    VALUE ZEROES.             
           05  WS-K671-READ               PIC 9(5)    VALUE ZEROES.             
           05  WS-K671-REWR               PIC 9(5)    VALUE ZEROES.             
           05  WS-F121-WRITE              PIC 9(5)    VALUE ZEROES.             
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-CDE-APPLT-CPF           PIC X(1)    VALUE SPACES.             
           05  WS-AMOUNT-RECEIPT          PIC 9(7)V99 VALUE ZEROES.             
           05  WS-TOTAL-AMOUNT            PIC 9(7)V99 VALUE ZEROES.             
           05  WS-AMT-BASE-FEE            PIC 9(7)V99 VALUE ZEROES.             
           05  WS-AMT-GST-RATE            PIC 9(7)V99 VALUE ZEROES.             
                                                                                
       01  WS-DTE-VARIABLES.                                                    
           05  WS-DTE-CPF1                PIC X(8)    VALUE SPACES.             
           05  WS-DTE-CPF2                PIC X(8)    VALUE SPACES.             
           05  WS-DTE-CPF3                PIC X(8)    VALUE SPACES.             
           05  WS-DTE-CPF4                PIC X(8)    VALUE SPACES.             
           05  WS-SYSTEM-DATE             PIC X(8).                             
                                                                                
       01  C025-AREA.                                                           
           05  C025-DTE-EFF.                                                    
               10  C025-DTE-CCYY          PIC 9(4).                             
               10  C025-DTE-MM            PIC 9(2).                             
               10  C025-DTE-DD            PIC 9(2).                             
           05  FILLER                     PIC X(34).                            
           05  C025-NUM-GST-RATE          PIC 9(2)V99.                          
           05  C025-NUM-ERROR             PIC X(4).                             
                                                                                
      *-----------------------------------------------------------*             
      *    WS VARIABLES PASSED TO SUB-PROGRAM "AV02C021"          *             
      *-----------------------------------------------------------*             
       COPY P13GST01.                                                           
                                                                                
      *-----------------------------------------------------------*             
      *    WS VARIABLES PASSED TO SUB-PROGRAM "BP13C90B"          *             
      *-----------------------------------------------------------*             
       COPY P13GST02.                                                           
                                                                                
                                                                                
      **********************************************************                
       PROCEDURE DIVISION.                                                      
      **********************************************************                
                                                                                
      *--------------------------------------------------------*                
       0000-MAIN.                                                               
      *--------------------------------------------------------*                
           PERFORM 1000-OPEN-FILE       THRU 1000-EXIT.                         
           PERFORM 2000-READ-BP13F671   THRU 2000-EXIT.                         
           PERFORM 3000-PROCESS-REC     THRU 3000-EXIT                          
                   UNTIL WS-F671-EOF = 'Y'.                                     
           PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                         
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       1000-OPEN-FILE.                                                          
      *--------------------------------------------------------*                
           OPEN INPUT  BP13F671                                                 
                       SY02F001                                                 
                I-O    BP13K671                                                 
                OUTPUT BP13F121.                                                
                                                                                
           IF WS-K671-STATUS NOT = 00 AND 97                                    
              MOVE WS-K671-STATUS      TO RETURN-CODE                           
              DISPLAY 'ERROR OPENING BP13K671. STATUS ' WS-K671-STATUS          
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           READ SY02F001 AT END MOVE 'Y'  TO WS-F001-EOF.                       
           IF EOF-F001                                                          
              DISPLAY 'RECORD NOT FOUND IN SY01F001 '                           
              DISPLAY 'PROCESSING TERMINATED '                                  
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           ELSE                                                                 
              MOVE F001-DTE-CURRENT      TO   WS-SYSTEM-DATE                    
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       2000-READ-BP13F671.                                                      
      *--------------------------------------------------------*                
           READ BP13F671                                                        
                AT END  MOVE 'Y' TO WS-F671-EOF                                 
                GO TO 2000-EXIT                                                 
           END-READ.                                                            
                                                                                
           ADD 1 TO WS-F671-READ.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3000-PROCESS-REC.                                                        
      *--------------------------------------------------------*                
           MOVE SPACES TO WS-CPF-TYPE.                                          
           MOVE ZEROS  TO WS-AMOUNT-RECEIPT WS-AMT-GST-RATE                     
                          WS-TOTAL-AMOUNT.                                      
           MOVE 'N'    TO WS-CNVRS-FEE-PROCESSED.                               
                                                                                
           PERFORM 4000-GET-CPF-POST-DATE   THRU 4000-EXIT.                     
           PERFORM 3100-INIT-BP13F671       THRU 3100-EXIT.                     
           PERFORM 3500-MOVE-GST-RATE       THRU 3500-EXIT.                     
           PERFORM 3200-PROCESS-LSE-STMP    THRU 3200-EXIT.                     
           PERFORM 3300-PROCESS-SALE-CONVEY THRU 3300-EXIT.                     
           PERFORM 3400-PROCESS-MORT-CONVEY THRU 3400-EXIT.                     
                                                                                
           IF WS-CNVRS-FEE-PROCESSED = 'Y'                                      
              PERFORM 6000-READ-BP13K671 THRU 6000-EXIT                         
           ELSE                                                                 
              ADD 1 TO WS-F671-SKIP                                             
              DISPLAY 'SKIP RECORD REGN = ' F671-NUM-REGN                       
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP13F671    THRU 2000-EXIT.                        
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3100-INIT-BP13F671.                                                      
      *--------------------------------------------------------*                
           IF F671-AMT-LSE-STMP-CPF1-PAID NOT NUMERIC                           
              MOVE ZEROS  TO F671-AMT-LSE-STMP-CPF1-PAID                        
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF2-PAID NOT NUMERIC                           
              MOVE ZEROS  TO F671-AMT-LSE-STMP-CPF2-PAID                        
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF3-PAID NOT NUMERIC                           
              MOVE ZEROS  TO F671-AMT-LSE-STMP-CPF3-PAID                        
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF4-PAID NOT NUMERIC                           
              MOVE ZEROS  TO F671-AMT-LSE-STMP-CPF4-PAID                        
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF1-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-SALE-CONVY-CPF1-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF2-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-SALE-CONVY-CPF2-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF3-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-SALE-CONVY-CPF3-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF4-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-SALE-CONVY-CPF4-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF1-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-MORT-CONVY-CPF1-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF2-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-MORT-CONVY-CPF2-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF3-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-MORT-CONVY-CPF3-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF4-PAID NOT NUMERIC                         
              MOVE ZEROS  TO F671-AMT-MORT-CONVY-CPF4-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-CAVEAT-REGN-CPF1-PAID NOT NUMERIC                        
              MOVE ZEROS  TO F671-AMT-CAVEAT-REGN-CPF1-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-CAVEAT-REGN-CPF2-PAID NOT NUMERIC                        
              MOVE ZEROS  TO F671-AMT-CAVEAT-REGN-CPF2-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-CAVEAT-REGN-CPF3-PAID NOT NUMERIC                        
              MOVE ZEROS  TO F671-AMT-CAVEAT-REGN-CPF3-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-CAVEAT-REGN-CPF4-PAID NOT NUMERIC                        
              MOVE ZEROS  TO F671-AMT-CAVEAT-REGN-CPF4-PAID                     
           END-IF.                                                              
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3200-PROCESS-LSE-STMP.                                                   
      *--------------------------------------------------------*                
           IF F671-AMT-LSE-STMP-CPF1-PAID    > 0 OR                             
              F671-AMT-LSE-STMP-CPF2-PAID    > 0 OR                             
              F671-AMT-LSE-STMP-CPF3-PAID    > 0 OR                             
              F671-AMT-LSE-STMP-CPF4-PAID    > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF1-PAID > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF2-PAID > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF3-PAID > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF4-PAID > 0                                
              MOVE '1'                         TO   WS-CPF-TYPE                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF1-PAID    > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF1-PAID > 0                                
              MOVE '1'                         TO   WS-CDE-APPLT-CPF            
              COMPUTE WS-AMOUNT-RECEIPT = F671-AMT-LSE-STMP-CPF1-PAID +         
                                          F671-AMT-CAVEAT-REGN-CPF1-PAID        
              PERFORM 5000-WRITE-BP13F121      THRU 5000-EXIT                   
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF2-PAID    > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF2-PAID > 0                                
              MOVE '2'                         TO   WS-CDE-APPLT-CPF            
              COMPUTE WS-AMOUNT-RECEIPT = F671-AMT-LSE-STMP-CPF2-PAID +         
                                          F671-AMT-CAVEAT-REGN-CPF2-PAID        
              PERFORM 5000-WRITE-BP13F121      THRU 5000-EXIT                   
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF3-PAID    > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF3-PAID > 0                                
              MOVE '3'                         TO   WS-CDE-APPLT-CPF            
              COMPUTE WS-AMOUNT-RECEIPT = F671-AMT-LSE-STMP-CPF3-PAID +         
                                          F671-AMT-CAVEAT-REGN-CPF3-PAID        
              PERFORM 5000-WRITE-BP13F121      THRU 5000-EXIT                   
           END-IF.                                                              
                                                                                
           IF F671-AMT-LSE-STMP-CPF4-PAID    > 0 OR                             
              F671-AMT-CAVEAT-REGN-CPF4-PAID > 0                                
              MOVE '4'                         TO   WS-CDE-APPLT-CPF            
              COMPUTE WS-AMOUNT-RECEIPT = F671-AMT-LSE-STMP-CPF4-PAID +         
                                          F671-AMT-CAVEAT-REGN-CPF4-PAID        
              PERFORM 5000-WRITE-BP13F121      THRU 5000-EXIT                   
           END-IF.                                                              
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3300-PROCESS-SALE-CONVEY.                                                
      *--------------------------------------------------------*                
           IF F671-AMT-SALE-CONVY-CPF1-PAID > 0                                 
              MOVE '1'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-SALE-CONVY-CPF1-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF2-PAID > 0                                 
              MOVE '2'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-SALE-CONVY-CPF2-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF3-PAID > 0                                 
              MOVE '3'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-SALE-CONVY-CPF3-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-SALE-CONVY-CPF4-PAID > 0                                 
              MOVE '4'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-SALE-CONVY-CPF4-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3400-PROCESS-MORT-CONVEY.                                                
      *--------------------------------------------------------*                
           IF F671-AMT-MORT-CONVY-CPF1-PAID > 0                                 
              MOVE '1'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-MORT-CONVY-CPF1-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF2-PAID > 0                                 
              MOVE '2'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-MORT-CONVY-CPF2-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF3-PAID > 0                                 
              MOVE '3'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-MORT-CONVY-CPF3-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
           IF F671-AMT-MORT-CONVY-CPF4-PAID > 0                                 
              MOVE '4'                           TO   WS-CDE-APPLT-CPF          
              MOVE F671-AMT-MORT-CONVY-CPF4-PAID TO   WS-TOTAL-AMOUNT           
              PERFORM 3600-GET-BASE-GST-FEE      THRU 3600-EXIT                 
                                                                                
              MOVE '2'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-BASE-FEE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
                                                                                
              MOVE '3'                           TO   WS-CPF-TYPE               
              MOVE WS-AMT-GST-RATE               TO   WS-AMOUNT-RECEIPT         
              PERFORM 5000-WRITE-BP13F121        THRU 5000-EXIT                 
           END-IF.                                                              
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3500-MOVE-GST-RATE.                                                      
      *--------------------------------------------------------*                
      *-----------------------------------------------------------*             
      *    CALL AV02C025 TO GET GST-RATE                          *             
      *-----------------------------------------------------------*             
           MOVE SPACES                     TO C025-AREA.                        
           INITIALIZE                         C025-AREA.                        
           MOVE FUNCTION CURRENT-DATE(1:8) TO C025-DTE-EFF.                     
           CALL 'AV02C025'           USING C025-AREA.                           
                                                                                
           MOVE C025-NUM-GST-RATE          TO WS-NUM-GST-RATE.                  
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       3600-GET-BASE-GST-FEE.                                                   
      *--------------------------------------------------------*                
      *-----------------------------------------------------------*             
      *    CALL AV02C021 TO GET GST AMT                           *             
      *-----------------------------------------------------------*             
           MOVE  WS-TOTAL-AMOUNT        TO    WS-AMT-NETT.                      
           CALL 'AV02C021'              USING WS-COMM-AREA-GST.                 
           MOVE  WS-AMT-GST-103-104-105 TO WS-AMT-GST-RATE                      
           COMPUTE WS-AMT-BASE-FEE  =   WS-TOTAL-AMOUNT -                       
                                        WS-AMT-GST-RATE.                        
                                                                                
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       4000-GET-CPF-POST-DATE.                                                  
      *--------------------------------------------------------*                
           MOVE WS-SYSTEM-DATE      TO WS-DTE-CPF1,                             
                                       WS-DTE-CPF2,                             
                                       WS-DTE-CPF3,                             
                                       WS-DTE-CPF4.                             
                                                                                
           IF F671-DTE-VALUE-CPF1 NOT = SPACES AND LOW-VALUES AND ZEROES        
               MOVE F671-DTE-VALUE-CPF1 TO WS-DTE-CPF1                          
           END-IF.                                                              
                                                                                
           IF F671-DTE-VALUE-CPF2 NOT = SPACES AND LOW-VALUES AND ZEROES        
               MOVE F671-DTE-VALUE-CPF2 TO WS-DTE-CPF2                          
           END-IF.                                                              
                                                                                
           IF F671-DTE-VALUE-CPF3 NOT = SPACES AND LOW-VALUES AND ZEROES        
               MOVE F671-DTE-VALUE-CPF3 TO WS-DTE-CPF3                          
           END-IF.                                                              
                                                                                
           IF F671-DTE-VALUE-CPF4 NOT = SPACES AND LOW-VALUES AND ZEROES        
               MOVE F671-DTE-VALUE-CPF4 TO WS-DTE-CPF4                          
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       5000-WRITE-BP13F121.                                                     
      *--------------------------------------------------------*                
           MOVE SPACES                TO BP13F121-CPFTRAN.                      
           INITIALIZE                    BP13F121-CPFTRAN.                      
                                                                                
           MOVE F671-NUM-REGN         TO F121-NUM-REGN.                         
           MOVE WS-SYSTEM-DATE        TO F121-DTE-POST.                         
           MOVE ZEROS                 TO F121-COUNT-HISTORY.                    
           MOVE F671-NUM-SCH-ACC      TO F121-NUM-SCH-ACCT.                     
           MOVE '23'                  TO F121-CDE-TRANS-TYPE.                   
           MOVE WS-CDE-APPLT-CPF      TO F121-CDE-APPLT-CPF.                    
           MOVE WS-AMOUNT-RECEIPT     TO F121-AMT-RECIEPT.                      
           MOVE 'C'                   TO F121-CDE-CRDR.                         
                                                                                
           IF F671-NUM-HBL-TYP = '2'                                            
              MOVE 'BANK LOAN CPF2'   TO F121-NUM-RECPT-JRNO                    
           ELSE                                                                 
              MOVE 'BANK LOAN CPF1'   TO F121-NUM-RECPT-JRNO                    
           END-IF.                                                              
                                                                                
           EVALUATE WS-CDE-APPLT-CPF                                            
           WHEN '1'                                                             
              MOVE WS-DTE-CPF1        TO F121-DTE-TRANS                         
              MOVE F671-NUM-CPF1-NO   TO F121-NUM-NRIC                          
                                         F121-NUM-CPF-APPL                      
           WHEN '2'                                                             
              MOVE WS-DTE-CPF2        TO F121-DTE-TRANS                         
              MOVE F671-NUM-CPF2-NO   TO F121-NUM-NRIC                          
                                         F121-NUM-CPF-APPL                      
           WHEN '3'                                                             
              MOVE WS-DTE-CPF3        TO F121-DTE-TRANS                         
              MOVE F671-NUM-CPF3-NO   TO F121-NUM-NRIC                          
                                         F121-NUM-CPF-APPL                      
           WHEN '4'                                                             
              MOVE WS-DTE-CPF4        TO F121-DTE-TRANS                         
              MOVE F671-NUM-CPF4-NO   TO F121-NUM-NRIC                          
                                         F121-NUM-CPF-APPL                      
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-CPF-TYPE                                                 
           WHEN '1'                                                             
                MOVE 'LSE'            TO F121-CDE-PAYMENT-TYPE                  
           WHEN '2'                                                             
                MOVE 'CON'            TO F121-CDE-PAYMENT-TYPE                  
           WHEN '3'                                                             
                MOVE 'CST'            TO F121-CDE-PAYMENT-TYPE                  
           END-EVALUATE.                                                        
                                                                                
           WRITE BP13F121-CPFTRAN.                                              
                                                                                
           ADD 1    TO WS-F121-WRITE.                                           
           MOVE 'Y' TO WS-CNVRS-FEE-PROCESSED.                                  
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       6000-READ-BP13K671.                                                      
      *--------------------------------------------------------*                
           MOVE SPACES           TO BP13K671-REC.                               
           MOVE F671-NUM-REGN    TO K671-NUM-REGN.                              
                                                                                
           READ BP13K671.                                                       
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
                 ADD 1 TO WS-K671-READ                                          
                 PERFORM 7000-REWRITE-K671 THRU 7000-EXIT                       
              WHEN 23                                                           
                 DISPLAY 'BP13K671 NOT FOUND REGN = ' F671-NUM-REGN             
              WHEN OTHER                                                        
                 MOVE WS-K671-STATUS     TO RETURN-CODE                         
                 DISPLAY 'ERROR READING BP13K671, STATUS = '                    
                                        WS-K671-STATUS                          
                 PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       7000-REWRITE-K671.                                                       
      *--------------------------------------------------------*                
           PERFORM 7100-MOVE-ZEROES-BAL THRU 7100-EXIT.                         
                                                                                
           MOVE WS-CNVRS-FEE-PROCESSED  TO                                      
                K671-NUM-CNVRS-FEE-PROCESSED.                                   
                                                                                
           REWRITE BP13K671-REC.                                                
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
                 ADD 1 TO WS-K671-REWR                                          
              WHEN 23                                                           
                 DISPLAY 'REC NOTFND BP13K671. REGN ' F671-NUM-REGN             
              WHEN OTHER                                                        
                 MOVE WS-K671-STATUS     TO RETURN-CODE                         
                 DISPLAY 'ERROR REWRITING BP13K671, STATUS = '                  
                                        WS-K671-STATUS                          
                 PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       7100-MOVE-ZEROES-BAL.                                                    
      *--------------------------------------------------------*                
           MOVE ZEROES TO K671-AMT-LSE-STMP-CPF1-BAL                            
                          K671-AMT-LSE-STMP-CPF2-BAL                            
                          K671-AMT-LSE-STMP-CPF3-BAL                            
                          K671-AMT-LSE-STMP-CPF4-BAL                            
                          K671-AMT-SALE-CONVY-CPF1-BAL                          
                          K671-AMT-SALE-CONVY-CPF2-BAL                          
                          K671-AMT-SALE-CONVY-CPF3-BAL                          
                          K671-AMT-SALE-CONVY-CPF4-BAL                          
                          K671-AMT-MORT-CONVY-CPF1-BAL                          
                          K671-AMT-MORT-CONVY-CPF2-BAL                          
                          K671-AMT-MORT-CONVY-CPF3-BAL                          
                          K671-AMT-MORT-CONVY-CPF4-BAL                          
                          K671-AMT-CAVEAT-REGN-CPF1-BAL                         
                          K671-AMT-CAVEAT-REGN-CPF2-BAL                         
                          K671-AMT-CAVEAT-REGN-CPF3-BAL                         
                          K671-AMT-CAVEAT-REGN-CPF4-BAL.                        
       7100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------*                
       9000-CLOSE-ROUTINE.                                                      
      *--------------------------------------------------------*                
           DISPLAY '******  BP13C337 *************'.                            
           DISPLAY SPACE.                                                       
           DISPLAY 'NO OF F671 READ     : ' WS-F671-READ.                       
           DISPLAY 'NO OF F671 SKIP     : ' WS-F671-SKIP.                       
           DISPLAY 'NO OF K671 READ     : ' WS-K671-READ.                       
           DISPLAY 'NO OF K671 REWRITE  : ' WS-K671-REWR.                       
           DISPLAY 'NO OF F121 WRITE    : ' WS-F121-WRITE.                      
                                                                                
           CLOSE BP13F671                                                       
                 BP13K671                                                       
                 SY02F001                                                       
                 BP13F121.                                                      
                                                                                
           IF WS-K671-STATUS NOT = 00 AND 97                                    
              MOVE WS-K671-STATUS      TO RETURN-CODE                           
              DISPLAY 'ERROR CLOSING BP13K671. STATUS ' WS-K671-STATUS          
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
