      *===============================================================* 00010000
       IDENTIFICATION DIVISION.                                         00020000
      *===============================================================* 00030000
       PROGRAM-ID.    BP13C38V.                                         00040000
       AUTHOR.        PAULO CAMIA LEGASPI.                              00050000
       DATE-WRITTEN.  AUGUST 31, 2016.                                  00060000
      *===============================================================* 00070000
      * OBJECTIVE  :  PRINT NOTIFICATION/WAIVE CASES OF CASH PROCEED  * 00080000
      *===============================================================* 00090000
      *                                                               * 00100000
      * INPUT FILE :                                                  * 00110000
      *               1. BP13F800                                     * 00120000
      *               1. BP13F38V                                     * 00130000
      *               2. BP27K025                                     * 00140000
      *               3. BP27K800                                     * 00150000
      *                                                               * 00160000
      * OUTPUT FILE:  1. BP13L38V                                     * 00170000
      *                                                               * 00180000
      *===============================================================* 00190000
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              * 00200000
      *---------------------------------------------------------------* 00210000
      * BP136461 31/08/2016 PCL4 NEW PROGRAM.                         * 00220000
      * BP136461 14/10/2016 PCL4 TO DISPLAY NO HLES CASES WHICH NEEDS * 00230000
      *                          REASSESSMENT WHEN NO RECORD FOUND    * 00240000
      * BP136925 10/08/2017 PCL4 TO CATER FOR BC/BL                   * 00250000
      * BP137328 11/05/2018 PCL4 TO UPDATE EMAIL RECIPIENTS           * 00260000
      * BP137769 09/04/2019 KV5  TO UPDATE EMAIL RECIPIENTS           * 00270000
      * BP137769 10/05/2019 KV5  TO REVERT BACK THE EMAIL ADDRESS     * 00280000
      * BP138047 25/11/2019 KAC1 RECOMPILE FOR BP27 COPYBOOK UPDATE   * 00281003
      *===============================================================* 00290000
                                                                        00300000
                                                                        00310000
      **********************                                            00320000
       ENVIRONMENT DIVISION.                                            00330000
      **********************                                            00340000
                                                                        00350000
       CONFIGURATION SECTION.                                           00360000
       SOURCE-COMPUTER. IBM-3090.                                       00370000
       OBJECT-COMPUTER. IBM-3090.                                       00380000
       INPUT-OUTPUT SECTION.                                            00390000
       FILE-CONTROL.                                                    00400000
                                                                        00410000
           SELECT  BP13F800  ASSIGN        TO BP13F800.                 00420000
           SELECT  BP13F38V  ASSIGN        TO BP13F38V.                 00430000
                                                                        00440000
           SELECT  BM06K110  ASSIGN        TO BM06K110                  00450000
                             ACCESS MODE   IS RANDOM                    00460000
                             ORGANIZATION  IS INDEXED                   00470000
                     RECORD KEY IS K110-KEY-FLD OF K110-REC             00480000
                             FILE STATUS   IS WS-K110-STATUS.           00490000
                                                                        00500000
           SELECT  BP27K800  ASSIGN        TO BP27K800                  00510000
                             ACCESS MODE   IS RANDOM                    00520000
                             ORGANIZATION  IS INDEXED                   00530000
                     RECORD KEY IS K800-NUM-HLA OF BP27K800-MASTER      00540000
                             FILE STATUS   IS WS-K800-STATUS.           00550000
                                                                        00560000
           SELECT  BP27K025  ASSIGN        TO BP27K025                  00570000
                             ACCESS MODE   IS RANDOM                    00580000
                             ORGANIZATION  IS INDEXED                   00590000
                             RECORD KEY    IS K025-KEY-FLD              00600000
                             ALTERNATE RECORD KEY IS K025-NUM-HLA       00610000
                             FILE STATUS   IS WS-K025-STATUS.           00620000
                                                                        00630000
           SELECT  BP13K022  ASSIGN        TO BP13K022                  00640000
                             ACCESS MODE   IS DYNAMIC                   00650000
                             ORGANIZATION  IS INDEXED                   00660000
                             RECORD KEY    IS K022-KEY-FLD              00670000
                             ALTERNATE RECORD KEY IS K022-NUM-REGN      00680000
                             FILE STATUS   IS WS-K022-STATUS.           00690000
                                                                        00700000
                                                                        00710000
           SELECT  BP13L38V  ASSIGN        TO BP13L38V.                 00720000
           SELECT  MAILC38V  ASSIGN        TO MAILC38V.                 00730000
                                                                        00740000
      ***************                                                   00750000
       DATA DIVISION.                                                   00760000
      ***************                                                   00770000
                                                                        00780000
       FILE SECTION.                                                    00790000
                                                                        00800000
       FD   BP13F800                                                    00810000
            BLOCK CONTAINS 0 RECORDS                                    00820000
            RECORD CONTAINS 2000 CHARACTERS                             00830000
            LABEL RECORDS ARE STANDARD                                  00840000
            RECORDING MODE IS F.                                        00850000
       COPY BP13F800.                                                   00860000
                                                                        00870000
       FD   BP13F38V                                                    00880000
            BLOCK CONTAINS 0 RECORDS                                    00890000
            RECORD CONTAINS 50 CHARACTERS                               00900000
            LABEL RECORDS ARE STANDARD                                  00910000
            RECORDING MODE IS F.                                        00920000
       01   BP13F38V-REC.                                               00930000
            05 F38V-OIC    PIC X(5).                                    00940000
            05 F38V-REGN   PIC X(8).                                    00950000
            05 FILLER      PIC X(33).                                   00960000
                                                                        00970000
       FD   BM06K110                                                    00980000
            RECORD CONTAINS 500 CHARACTERS.                             00990000
       COPY BM06K110.                                                   01000000
                                                                        01010000
       FD   BP27K800                                                    01020000
            RECORD CONTAINS 1200 CHARACTERS.                            01030000
       COPY BP27K800.                                                   01040000
                                                                        01050000
       FD   BP27K025                                                    01060000
            RECORD CONTAINS 100 CHARACTERS.                             01070000
       COPY BP27K025.                                                   01080000
                                                                        01090000
       FD   BP13K022                                                    01100000
            RECORD CONTAINS 100 CHARACTERS.                             01110000
       COPY BP13K022.                                                   01120000
                                                                        01130000
       FD   BP13L38V                                                    01140000
            BLOCK  CONTAINS 0 RECORDS                                   01150000
            RECORD CONTAINS 110 CHARACTERS                              01160000
            LABEL RECORD IS OMITTED                                     01170000
            RECORDING MODE IS F.                                        01180000
       01   BP13L38V-REC               PIC X(110).                      01190000
                                                                        01200000
       FD   MAILC38V                                                    01210000
            RECORDING MODE IS F                                         01220000
            RECORD CONTAINS  110 CHARACTERS.                            01230000
       01   MAILC38V-REC               PIC X(110).                      01240000
                                                                        01250000
       WORKING-STORAGE SECTION.                                         01260000
      ******************************************************************01270000
      *                   WORKING-STORAGE AREA                         *01280000
      ******************************************************************01290000
       01  FILE-VARIABLES.                                              01300000
           05  WS-EOF-F38V             PIC X(1)  VALUE 'N'.             01310000
           05  WS-EOF-F800             PIC X(1)  VALUE 'N'.             01320000
           05  WS-K800-STATUS          PIC 9(02) VALUE ZEROES.          01330000
           05  WS-K110-STATUS          PIC 9(02) VALUE ZEROES.          01340000
           05  WS-K025-STATUS          PIC 9(02) VALUE ZEROES.          01350000
           05  WS-K022-STATUS          PIC 9(02) VALUE ZEROES.          01360000
                                                                        01370000
       01  WS-COUNTERS.                                                 01380000
           05  WS-I                    PIC 9(3)  VALUE ZEROES.          01390000
           05  WS-CNT                  PIC 9(3)  VALUE ZEROES.          01400000
           05  WS-HA                   PIC 9(1)  VALUE ZEROES.          01410000
           05  WS-F800-READ            PIC 9(7)  VALUE ZEROES.          01420000
           05  WS-SNO                  PIC 9(7)  VALUE ZEROES.          01430000
           05  WS-LINE-CTR             PIC 9(2)  VALUE ZEROES.          01440000
           05  WS-PAGE-CTR             PIC 9(4)  VALUE ZEROES.          01450000
           05  WS-CNT-L38V-WRITE       PIC 9(7)  VALUE ZEROES.          01460000
           05  WS-CNT-WRITE            PIC 9(1)  VALUE 2.               01470000
           05  WS-MAX-LINE             PIC 9(2)  VALUE 55.              01480000
                                                                        01490000
       01  WS-VARIABLES.                                                01500000
           05 WS-EMAIL                 PIC X(50) VALUE SPACES.          01510000
           05 WS-EMAIL-RPT             PIC X(50) VALUE SPACES.          01520000
           05 WS-EMAIL-RPT1            PIC X(70) VALUE SPACES.          01530000
           05 WS-PRIOR-DTE             PIC 9(08) VALUE ZEROES.          01540000
           05 WS-NUM-DTE-APPT          PIC 9(07) VALUE ZEROES.          01550000
           05 WS-SYSTEM-DATE           PIC 9(8)  VALUE ZEROES.          01560000
           05 WS-NUM-RELN              PIC X(20) VALUE SPACES.          01570000
           05 WS-SNO-ZZZZ9             PIC ZZZZ9 VALUE ZEROES.          01580000
           05 WS-FIRST-WRITE           PIC X(1)  VALUE 'Y'.             01590000
           05 WS-K800-FOUND            PIC X(1)  VALUE 'N'.             01600000
           05 WS-NUM-OIC               PIC X(5)  VALUE SPACES.          01610000
                                                                        01620000
       01  WS-DTE-REGN.                                                 01630000
           05 WS-DTE-CCYY                   PIC 9(4).                   01640000
           05 WS-DTE-MM                     PIC 9(2).                   01650000
           05 WS-DTE-DD                     PIC 9(2).                   01660000
                                                                        01670000
       01 WS-PRIO-DTE.                                                  01680000
          05  WS-PRIO-CCYY                 PIC 9(04).                   01690000
          05  WS-PRIO-MM                   PIC 9(02).                   01700000
          05  WS-PRIO-DD                   PIC 9(02).                   01710000
                                                                        01720000
       01 WS-CURR-DATE.                                                 01730000
          05  WS-CURR-CCYY                 PIC 9(04).                   01740000
          05  WS-CURR-MM                   PIC 9(02).                   01750000
          05  WS-CURR-DD                   PIC 9(02).                   01760000
                                                                        01770000
       01 WS-MAIL-REC.                                                  01780000
          05  WS-MAIL-INFO.                                             01790000
              10 MAIL-INFO OCCURS 100 TIMES.                            01800000
                 20  MAIL-RCPT     PIC X(50)     VALUE SPACES.          01810000
          05  WS-MAILRCPT-REC      PIC X(70)     VALUE SPACES.          01820000
                                                                        01830000
       01  L38V-HEADER01.                                               01840000
           05  FILLER              PIC X(8)      VALUE 'BP13L38V'.      01850000
           05  FILLER              PIC X(4)      VALUE SPACES.          01860000
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.      01870000
           05  FILLER              PIC X(02)     VALUE SPACES.          01880000
           05  FILLER              PIC X(20)     VALUE                  01890000
                                  'S Y S T E M   O F   '.               01900000
           05  FILLER              PIC X(19) VALUE                      01910000
                                  'C O M M I T M E N T'.                01920000
           05  FILLER              PIC X(02)     VALUE SPACES.          01930000
           05  FILLER              PIC X(07)     VALUE 'DATE : '.       01940000
           05  L38V-DATE-HDR       PIC X(10)     VALUE SPACES.          01950000
           05  FILLER              PIC X(04)     VALUE SPACES.          01960000
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.       01970000
           05  L38V-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.          01980000
                                                                        01990000
                                                                        02000000
       01  L38V-HEADER02.                                               02010000
           05  FILLER              PIC X(17)     VALUE SPACES.          02020000
           05  L38V-HDR02          PIC X(80)     VALUE SPACES.          02030000
                                                                        02040000
       01  L38V-HEADER2A.                                               02050000
           05  FILLER              PIC X(01)     VALUE SPACES.          02060000
           05  L38V-HDR2A          PIC X(100)    VALUE SPACES.          02070000
                                                                        02080000
       01  L38V-HEADER03.                                               02090000
           05  FILLER              PIC X(01)  VALUE SPACES.             02100000
           05  FILLER              PIC X(05)  VALUE '  S/N'.            02110000
           05  FILLER              PIC X(01)  VALUE SPACES.             02120000
           05  FILLER              PIC X(09)  VALUE 'SALES CRM'.        02130000
           05  FILLER              PIC X(01)  VALUE SPACES.             02140000
           05  FILLER              PIC X(08)  VALUE 'REGN NO '.         02150000
           05  FILLER              PIC X(01)  VALUE SPACES.             02160000
           05  FILLER              PIC X(10)  VALUE 'HLE NUMBER'.       02170000
           05  FILLER              PIC X(01)  VALUE SPACES.             02180000
           05  FILLER              PIC X(06)  VALUE 'CA OIC'.           02190000
           05  FILLER              PIC X(01)  VALUE SPACES.             02200000
                                                                        02210000
       01  L38V-DETAIL01.                                               02220000
           05  FILLER              PIC X(01)  VALUE SPACES.             02230000
           05  L38V-SN             PIC X(05)  VALUE SPACES.             02240000
           05  FILLER              PIC X(03)  VALUE SPACES.             02250000
           05  L38V-CRM-OIC        PIC X(05)  VALUE SPACES.             02260000
           05  FILLER              PIC X(03)  VALUE SPACES.             02270000
           05  L38V-REGN           PIC X(08)  VALUE SPACES.             02280000
           05  FILLER              PIC X(01)  VALUE SPACES.             02290000
           05  L38V-HLENO          PIC X(10)  VALUE SPACES.             02300000
           05  FILLER              PIC X(02)  VALUE SPACES.             02310000
           05  L38V-CA-OIC         PIC X(05)  VALUE SPACES.             02320000
           05  FILLER              PIC X(01)  VALUE SPACES.             02330000
                                                                        02340000
       01  WS-REPORT-DTL.                                               02350000
           05  WS-EMPTY-RPT.                                            02360000
               10 FILLER                  PIC X(30) VALUE SPACES.       02370000
               10 FILLER                  PIC X(21)                     02380000
                                          VALUE '<   EMPTY  REPORT   >'.02390000
           05  WS-DATE-RPT-DTL.                                         02400000
               10 FILLER                PIC X(6)  VALUE 'DATE: '.       02410000
               10 WS-DATE-RPT           PIC X(10) VALUE SPACES.         02420000
           05  WS-MAIL-RPT1             PIC X(12) VALUE 'HELO SGPHDB1'. 02430000
           05  WS-MAIL-RPT2             PIC X(27)                       02440000
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                        02450000
           05  WS-MAIL-RPT3             PIC X(50)                       02460000
               VALUE 'RCPT TO:<COSMAIL@HDB.GOV.SG>'.                    02470000
           05  WS-MAIL-RPT4             PIC X(4)                        02480000
               VALUE 'DATA'.                                            02490000
           05  WS-MAIL-RPT5             PIC X(29)                       02500000
               VALUE 'FROM:Soc System - Email Alert'.                   02510000
           05  WS-MAIL-RPT6             PIC X(50)                       02520000
               VALUE 'TO:<COSMAIL@HDB.GOV.SG>'.                         02530000
           05  WS-MAIL-RPT7             PIC X(80)                       02540000
               VALUE 'SUBJECT: APPROVAL FOR ADJUSTMENT IN CASH'.        02550000
                                                                        02560000
      *----------------------------------------------------------------*02570000
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                        *02580000
      *----------------------------------------------------------------*02590000
       01  WS-BP13CCNT-LINK.                                            02600000
           05  LINK-CNTCT-TYPE         PIC X(3).                        02610000
           05  LINK-STAFF-NICK         PIC X(6).                        02620000
           05  LINK-STAFF-NUM          PIC X(6).                        02630000
           05  LINK-STAFF-CNTCT        PIC X(50).                       02640000
           05  LINK-SYSERR             PIC X(4).                        02650000
                                                                        02660000
      ******************************************************************02670000
      *                   P R O G R A M     B O D Y                    *02680000
      ******************************************************************02690000
                                                                        02700000
      ********************                                              02710000
       PROCEDURE DIVISION.                                              02720000
      ********************                                              02730000
                                                                        02740000
      ******************************************************************02750000
       0000-MAIN.                                                       02760000
      ******************************************************************02770000
                                                                        02780000
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.              02790000
                                                                        02800000
           PERFORM 1100-READ-BP13F38V      THRU 1100-EXIT.              02810000
           PERFORM 1200-PROCESS-BP13F38V   THRU 1200-EXIT               02820000
             UNTIL WS-EOF-F38V = 'Y'.                                   02830000
                                                                        02840000
           PERFORM 5001-HEADER02-EMAIL     THRU 5001-EXIT.              02850000
           PERFORM 1500-PROCESS-RCPT       THRU 1500-EXIT.              02860000
           PERFORM 5002-HEADER03-EMAIL     THRU 5002-EXIT.              02870000
                                                                        02880000
           PERFORM 2000-READ-BP13F800      THRU 2000-EXIT.              02890000
                                                                        02900000
           PERFORM 3000-PROCESS-RECORDS    THRU 3000-EXIT               02910000
             UNTIL WS-EOF-F800 = 'Y'.                                   02920000
                                                                        02930000
           PERFORM 9999-CLOSE-ROUTINE      THRU 9999-EXIT.              02940000
                                                                        02950000
       0000-EXIT.                                                       02960000
           EXIT.                                                        02970000
                                                                        02980000
      ******************************************************************02990000
       1000-OPEN-ROUTINE.                                               03000000
      ******************************************************************03010000
                                                                        03020000
           OPEN INPUT  BP13F800                                         03030000
                       BP13F38V                                         03040000
                       BP27K800                                         03050000
                       BP27K025                                         03060000
                       BP13K022                                         03070000
                       BM06K110                                         03080000
              OUTPUT   BP13L38V                                         03090000
                       MAILC38V.                                        03100000
                                                                        03110000
                                                                        03120000
           IF WS-K800-STATUS NOT = 00 AND 97                            03130000
              DISPLAY 'BP27K800 - ERROR OPENING : ' WS-K800-STATUS      03140000
              MOVE WS-K800-STATUS                   TO RETURN-CODE      03150000
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03160000
           END-IF.                                                      03170000
                                                                        03180000
           IF WS-K110-STATUS NOT = 00 AND 97                            03190000
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K110-STATUS      03200000
              MOVE WS-K110-STATUS                   TO RETURN-CODE      03210000
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03220000
           END-IF.                                                      03230000
                                                                        03240000
           IF WS-K025-STATUS NOT = 00 AND 97                            03250000
              DISPLAY 'BP27K025 - ERROR OPENING : ' WS-K025-STATUS      03260000
              MOVE WS-K025-STATUS                   TO RETURN-CODE      03270000
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03280000
           END-IF.                                                      03290000
                                                                        03300000
           IF WS-K022-STATUS NOT = 00 AND 97                            03310000
              DISPLAY 'BP13K022 - ERROR OPENING : ' WS-K022-STATUS      03320000
              MOVE WS-K025-STATUS                   TO RETURN-CODE      03330000
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03340000
           END-IF.                                                      03350000
                                                                        03360000
           PERFORM 7000-PRINT-HEADER       THRU 7000-EXIT.              03370000
                                                                        03380000
       1000-EXIT.                                                       03390000
           EXIT.                                                        03400000
                                                                        03410000
      ******************************************************************03420000
       1100-READ-BP13F38V.                                              03430000
      ******************************************************************03440000
                                                                        03450000
           READ BP13F38V           AT   END                             03460000
                MOVE 'Y'           TO   WS-EOF-F38V                     03470000
                GO                 TO   1100-EXIT.                      03480000
                                                                        03490000
       1100-EXIT.                                                       03500000
           EXIT.                                                        03510000
                                                                        03520000
      ******************************************************************03530000
       1200-PROCESS-BP13F38V.                                           03540000
      ******************************************************************03550000
                                                                        03560000
           IF F38V-OIC NOT = SPACES AND LOW-VALUES                      03570000
              IF WS-NUM-OIC NOT = F38V-OIC                              03580000
                 MOVE F38V-OIC                    TO WS-NUM-OIC         03590000
                 PERFORM 1300-PROCESS-MAILRCPT  THRU 1300-EXIT          03600000
              END-IF                                                    03610000
           END-IF.                                                      03620000
                                                                        03630000
           PERFORM 1100-READ-BP13F38V           THRU 1100-EXIT.         03640000
                                                                        03650000
       1200-EXIT.                                                       03660000
           EXIT.                                                        03670000
                                                                        03680000
      ******************************************************************03690000
       1300-PROCESS-MAILRCPT.                                           03700000
      ******************************************************************03710000
                                                                        03720000
           PERFORM 1400-CALL-BP13CCNT       THRU 1400-EXIT.             03730000
                                                                        03740000
           IF WS-EMAIL NOT = SPACES AND LOW-VALUES                      03750000
              MOVE SPACES               TO WS-MAILRCPT-REC              03760000
                                           WS-EMAIL-RPT1                03770000
                                                                        03780000
              STRING WS-EMAIL DELIMITED BY SIZE                         03790000
                                   INTO WS-EMAIL-RPT                    03800000
                                                                        03810000
              ADD 1                     TO WS-CNT                       03820000
              MOVE WS-EMAIL-RPT         TO MAIL-RCPT(WS-CNT)            03830000
                                                                        03840000
              STRING '<' WS-EMAIL-RPT '>'                               03850000
                  DELIMITED BY ' ' INTO WS-EMAIL-RPT1                   03860000
                                                                        03870000
              STRING 'RCPT TO:' WS-EMAIL-RPT1                           03880000
                  DELIMITED BY SIZE INTO WS-MAILRCPT-REC                03890000
                                                                        03900000
              WRITE MAILC38V-REC  FROM WS-MAILRCPT-REC                  03910000
           END-IF.                                                      03920000
                                                                        03930000
       1300-EXIT.                                                       03940000
           EXIT.                                                        03950000
                                                                        03960000
      ******************************************************************03970000
       1400-CALL-BP13CCNT.                                              03980000
      ******************************************************************03990000
                                                                        04000000
           MOVE SPACES                     TO WS-EMAIL.                 04010000
           MOVE 'EML'                      TO LINK-CNTCT-TYPE.          04020000
           MOVE WS-NUM-OIC                 TO LINK-STAFF-NICK.          04030000
           MOVE SPACES                     TO LINK-STAFF-NUM.           04040000
                                                                        04050000
           CALL 'BP13CCNT' USING WS-BP13CCNT-LINK.                      04060000
                                                                        04070000
           EVALUATE LINK-SYSERR                                         04080000
           WHEN ZEROS                                                   04090000
              MOVE LINK-STAFF-CNTCT        TO WS-EMAIL                  04100000
           WHEN 100                                                     04110000
              DISPLAY 'OIC NOT FOUND IN OFFICE_CNTCT TABLE - '          04120000
                         WS-NUM-OIC                                     04130000
              MOVE  SPACES                 TO WS-EMAIL                  04140000
           WHEN OTHER                                                   04150000
              DISPLAY 'ERROR READING OFFICE_CNTCT TABLE = '             04160000
                       LINK-SYSERR                                      04170000
              MOVE  SPACES                 TO WS-EMAIL                  04180000
           END-EVALUATE.                                                04190000
                                                                        04200000
       1400-EXIT.                                                       04210000
           EXIT.                                                        04220000
                                                                        04230000
      ******************************************************************04240000
       1500-PROCESS-RCPT.                                               04250000
      ******************************************************************04260000
                                                                        04270000
                                                                        04280000
           PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > WS-CNT         04290000
                                                                        04300000
             IF MAIL-RCPT(WS-I) NOT = SPACES AND LOW-VALUES             04310000
                                                                        04320000
                MOVE SPACES           TO WS-MAILRCPT-REC                04330000
                                                                        04340000
                STRING 'TO:<' MAIL-RCPT(WS-I) '>'                       04350000
                  DELIMITED BY ' '  INTO WS-MAILRCPT-REC                04360000
                                                                        04370000
                WRITE MAILC38V-REC  FROM WS-MAILRCPT-REC                04380000
             END-IF                                                     04390000
           END-PERFORM.                                                 04400000
                                                                        04410000
       1500-EXIT.                                                       04420000
           EXIT.                                                        04430000
                                                                        04440000
                                                                        04450000
      ******************************************************************04460000
       2000-READ-BP13F800.                                              04470000
      ******************************************************************04480000
                                                                        04490000
           READ BP13F800           AT   END                             04500000
                MOVE 'Y'           TO   WS-EOF-F800                     04510000
                GO                 TO   2000-EXIT.                      04520000
                                                                        04530000
           ADD  1                  TO WS-F800-READ.                     04540000
                                                                        04550000
       2000-EXIT.                                                       04560000
           EXIT.                                                        04570000
                                                                        04580000
                                                                        04590000
      *************************************************************     04600000
       2100-READ-BP27K800.                                              04610000
      *************************************************************     04620000
                                                                        04630000
           MOVE SPACES                   TO BP27K800-MASTER.            04640000
           INITIALIZE                       BP27K800-MASTER.            04650000
                                                                        04660000
           MOVE SPACES            TO WS-K800-FOUND.                     04670000
           MOVE F800-NUM-HLA      TO K800-NUM-HLA OF BP27K800-MASTER.   04680000
                                                                        04690000
           READ BP27K800.                                               04700000
                                                                        04710000
           EVALUATE WS-K800-STATUS                                      04720000
               WHEN 00                                                  04730000
                    MOVE 'Y'    TO WS-K800-FOUND                        04740000
                                                                        04750000
               WHEN 10                                                  04760000
               WHEN 23                                                  04770000
                    MOVE 'N'    TO WS-K800-FOUND                        04780000
                                                                        04790000
               WHEN OTHER                                               04800000
                    DISPLAY 'BP27K800 READ ERROR ' WS-K800-STATUS       04810000
                    DISPLAY 'K800 KEY: ' F800-NUM-HLA                   04820000
                    MOVE WS-K800-STATUS  TO RETURN-CODE                 04830000
                                                                        04840000
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT           04850000
           END-EVALUATE.                                                04860000
                                                                        04870000
       2100-EXIT.                                                       04880000
            EXIT.                                                       04890000
                                                                        04900000
      *************************************************************     04910000
       2200-READ-BM06K110.                                              04920000
      *************************************************************     04930000
                                                                        04940000
           MOVE SPACES                   TO K110-REC.                   04950000
           INITIALIZE                       K110-REC.                   04960000
                                                                        04970000
           MOVE F800-NUM-SCH-ACC         TO K110-KEY-FLD OF K110-REC.   04980000
                                                                        04990000
           READ BM06K110.                                               05000000
                                                                        05010000
           EVALUATE WS-K110-STATUS                                      05020000
               WHEN 00                                                  05030000
                    CONTINUE                                            05040000
                                                                        05050000
               WHEN 10                                                  05060000
               WHEN 23                                                  05070000
                    MOVE SPACES  TO K110-REC                            05080000
                    INITIALIZE      K110-REC                            05090000
                                                                        05100000
               WHEN OTHER                                               05110000
                    DISPLAY 'BM06K110 READ ERROR ' WS-K110-STATUS       05120000
                    DISPLAY 'K110 KEY: ' F800-NUM-SCH-ACC               05130000
                    MOVE WS-K110-STATUS  TO RETURN-CODE                 05140000
                                                                        05150000
                    PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT           05160000
           END-EVALUATE.                                                05170000
                                                                        05180000
       2200-EXIT.                                                       05190000
            EXIT.                                                       05200000
                                                                        05210000
                                                                        05220000
      ******************************************************************05230000
       3000-PROCESS-RECORDS.                                            05240000
      ******************************************************************05250000
                                                                        05260000
           IF (F800-DTE-UPDATE-SUBTAG = WS-SYSTEM-DATE OR WS-PRIO-DTE)  05270000
              PERFORM 2100-READ-BP27K800        THRU 2100-EXIT          05280000
                                                                        05290000
              IF WS-K800-FOUND = 'Y'                                    05300000
                 IF F800-TAG-SUB-APPRV = 'BC' OR 'BL'                   05310000
                    PERFORM 2200-READ-BM06K110  THRU 2200-EXIT          05320000
                                                                        05330000
                    IF (F800-NUM-BUY-SELL-TAG  = 'S' )  AND             05340000
                       (K110-DTE-KEY-AVAIL NOT = SPACES AND             05350000
                                 LOW-VALUES AND ZEROES) AND             05360000
                       (F800-DTE-2ND-CA-SENT = SPACES OR                05370000
                                     ZEROES OR LOW-VALUES)              05380000
                       PERFORM 4000-PROCESS-RECORDS   THRU 4000-EXIT    05390000
                    END-IF                                              05400000
                 ELSE                                                   05410000
                    PERFORM 4000-PROCESS-RECORDS      THRU 4000-EXIT    05420000
                 END-IF                                                 05430000
              END-IF                                                    05440000
           END-IF.                                                      05450000
                                                                        05460000
           PERFORM 2000-READ-BP13F800           THRU 2000-EXIT.         05470000
                                                                        05480000
       3000-EXIT.                                                       05490000
           EXIT.                                                        05500000
                                                                        05510000
      ******************************************************************05520000
       3100-GET-CRM-OIC.                                                05530000
      ******************************************************************05540000
                                                                        05550000
            MOVE SPACES                           TO BP27K025-REC.      05560000
            INITIALIZE                               BP27K025-REC.      05570000
                                                                        05580000
            MOVE F800-NUM-HLA                     TO K025-NUM-HLA.      05590000
                                                                        05600000
            READ BP27K025 KEY IS K025-NUM-HLA.                          05610000
                                                                        05620000
            EVALUATE WS-K025-STATUS                                     05630000
                WHEN 00                                                 05640000
                WHEN 02                                                 05650000
                     CONTINUE                                           05660000
                                                                        05670000
                WHEN 23                                                 05680000
                     MOVE SPACES                  TO BP27K025-REC       05690000
                     INITIALIZE                      BP27K025-REC       05700000
                                                                        05710000
                WHEN OTHER                                              05720000
                     DISPLAY 'ERROR READING BP27K025 : ' WS-K025-STATUS 05730000
                             ' HLE NO = ' K025-NUM-HLA                  05740000
                     PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT    05750000
            END-EVALUATE.                                               05760000
                                                                        05770000
       3100-EXIT.                                                       05780000
           EXIT.                                                        05790000
                                                                        05800000
      ******************************************************************05810000
       3200-GET-CSM-OIC.                                                05820000
      ******************************************************************05830000
                                                                        05840000
            MOVE SPACES                           TO BP13K022-REC.      05850000
            INITIALIZE                               BP13K022-REC.      05860000
                                                                        05870000
            MOVE F800-NUM-REGN                    TO K022-NUM-REGN.     05880000
                                                                        05890000
            READ BP13K022 KEY IS K022-NUM-REGN.                         05900000
                                                                        05910000
            EVALUATE WS-K022-STATUS                                     05920000
                WHEN 00                                                 05930000
                WHEN 02                                                 05940000
                     CONTINUE                                           05950000
                                                                        05960000
                WHEN 23                                                 05970000
                     MOVE SPACES                  TO BP13K022-REC       05980000
                     INITIALIZE                      BP13K022-REC       05990000
                                                                        06000000
                WHEN OTHER                                              06010000
                     DISPLAY 'ERROR READING BP13K022 : ' WS-K022-STATUS 06020000
                             ' HLE NO = ' K022-NUM-REGN                 06030000
                     PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT    06040000
            END-EVALUATE.                                               06050000
                                                                        06060000
       3200-EXIT.                                                       06070000
           EXIT.                                                        06080000
                                                                        06090000
      ******************************************************************06100000
       4000-PROCESS-RECORDS.                                            06110000
      ******************************************************************06120000
                                                                        06130000
           MOVE SPACES                    TO L38V-DETAIL01              06140000
           INITIALIZE                        L38V-DETAIL01.             06150000
                                                                        06160000
           PERFORM 3100-GET-CRM-OIC     THRU 3100-EXIT.                 06170000
           PERFORM 3200-GET-CSM-OIC     THRU 3200-EXIT.                 06180000
                                                                        06190000
           ADD 1                          TO WS-SNO.                    06200000
           MOVE WS-SNO                    TO WS-SNO-ZZZZ9.              06210000
           MOVE WS-SNO-ZZZZ9              TO L38V-SN.                   06220000
                                                                        06230000
           MOVE K025-NUM-OIC              TO L38V-CA-OIC.               06240000
           MOVE K022-NUM-OIC              TO L38V-CRM-OIC.              06250000
           MOVE F800-NUM-REGN             TO L38V-REGN.                 06260000
           MOVE F800-NUM-HLA              TO L38V-HLENO.                06270000
                                                                        06280000
           PERFORM 6000-PRINT-REPORT            THRU 6000-EXIT.         06290000
                                                                        06300000
       4000-EXIT.                                                       06310000
           EXIT.                                                        06320000
                                                                        06330000
                                                                        06340000
      ******************************************************************06350000
       5000-HEADER01-EMAIL.                                             06360000
      ******************************************************************06370000
                                                                        06380000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT1.                       06390000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT2.                       06400000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT3.                       06410000
                                                                        06420000
       5000-EXIT.                                                       06430000
            EXIT.                                                       06440000
                                                                        06450000
      ******************************************************************06460000
       5001-HEADER02-EMAIL.                                             06470000
      ******************************************************************06480000
                                                                        06490000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT4.                       06500000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT5.                       06510000
                                                                        06520000
       5001-EXIT.                                                       06530000
            EXIT.                                                       06540000
                                                                        06550000
      ******************************************************************06560000
       5002-HEADER03-EMAIL.                                             06570000
      ******************************************************************06580000
                                                                        06590000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT6.                       06600000
                                                                        06610000
            STRING WS-CURR-DD '/' WS-CURR-MM '/' WS-CURR-CCYY           06620000
                    DELIMITED BY SIZE INTO WS-DATE-RPT.                 06630000
                                                                        06640000
            WRITE MAILC38V-REC FROM WS-DATE-RPT-DTL.                    06650000
                                                                        06660000
            STRING 'Approval for adjustment in cash '                   06670000
                   'proceeds and loan amounts '                         06680000
               DELIMITED BY SIZE INTO L38V-HDR02.                       06690000
                                                                        06700000
            STRING 'SUBJECT: Approval for adjustment in cash '          06710000
                   'proceeds and loan amounts - '                       06720000
                    WS-DATE-RPT                                         06730000
              DELIMITED BY SIZE INTO WS-MAIL-RPT7.                      06740000
                                                                        06750000
            WRITE MAILC38V-REC FROM WS-MAIL-RPT7.                       06760000
                                                                        06770000
            MOVE SPACES TO MAILC38V-REC.                                06780000
            WRITE MAILC38V-REC.                                         06790000
                                                                        06800000
            WRITE MAILC38V-REC FROM L38V-HEADER01.                      06810000
            WRITE MAILC38V-REC FROM L38V-HEADER02.                      06820000
                                                                        06830000
            MOVE SPACES TO MAILC38V-REC.                                06840000
            WRITE MAILC38V-REC.                                         06850000
                                                                        06860000
            STRING 'Please check the Sales submission database and '    06870000
                   'update the cash proceeds and loan amount '          06880000
                   'accordingly. '                                      06890000
               DELIMITED BY SIZE INTO L38V-HDR2A.                       06900000
                                                                        06910000
            WRITE MAILC38V-REC FROM L38V-HEADER2A.                      06920000
                                                                        06930000
            MOVE SPACES TO MAILC38V-REC.                                06940000
            WRITE MAILC38V-REC.                                         06950000
                                                                        06960000
            MOVE SPACES TO MAILC38V-REC.                                06970000
            WRITE MAILC38V-REC.                                         06980000
                                                                        06990000
            WRITE MAILC38V-REC FROM L38V-HEADER03.                      07000000
                                                                        07010000
       5002-EXIT.                                                       07020000
            EXIT.                                                       07030000
                                                                        07040000
      ******************************************************************07050000
       6000-PRINT-REPORT.                                               07060000
      ******************************************************************07070000
                                                                        07080000
           WRITE BP13L38V-REC               FROM L38V-DETAIL01.         07090000
           WRITE MAILC38V-REC               FROM L38V-DETAIL01.         07100000
           ADD 1                              TO WS-CNT-L38V-WRITE.     07110000
                                                                        07120000
       6000-EXIT.                                                       07130000
           EXIT.                                                        07140000
                                                                        07150000
      ******************************************************************07160000
       7000-PRINT-HEADER.                                               07170000
      ******************************************************************07180000
                                                                        07190000
           MOVE FUNCTION CURRENT-DATE(1:8)      TO WS-SYSTEM-DATE       07200000
                                                   WS-CURR-DATE         07210000
                                                   WS-PRIOR-DTE.        07220000
           COMPUTE WS-NUM-DTE-APPT =                                    07230000
                   FUNCTION INTEGER-OF-DATE(WS-PRIOR-DTE).              07240000
                                                                        07250000
           SUBTRACT 1 FROM  WS-NUM-DTE-APPT.                            07260000
                                                                        07270000
           COMPUTE  WS-PRIOR-DTE =                                      07280000
                    FUNCTION DATE-OF-INTEGER(WS-NUM-DTE-APPT).          07290000
                                                                        07300000
           MOVE WS-PRIOR-DTE        TO WS-PRIO-DTE.                     07310000
                                                                        07320000
           STRING WS-SYSTEM-DATE(7:2) '/'                               07330000
                  WS-SYSTEM-DATE(5:2) '/'                               07340000
                  WS-SYSTEM-DATE(1:4)                                   07350000
              DELIMITED BY SIZE INTO L38V-DATE-HDR.                     07360000
                                                                        07370000
                                                                        07380000
           ADD 1                               TO WS-PAGE-CTR.          07390000
           MOVE ZEROES                         TO L38V-PAGE-HDR.        07400000
           MOVE WS-PAGE-CTR                    TO L38V-PAGE-HDR.        07410000
                                                                        07420000
           WRITE BP13L38V-REC    FROM L38V-HEADER01 AFTER PAGE.         07430000
           WRITE BP13L38V-REC    FROM L38V-HEADER02.                    07440000
           WRITE BP13L38V-REC    FROM L38V-HEADER03 AFTER 2.            07450000
                                                                        07460000
           INITIALIZE WS-LINE-CTR.                                      07470000
           MOVE 5  TO WS-LINE-CTR.                                      07480000
                                                                        07490000
           PERFORM 5000-HEADER01-EMAIL         THRU 5000-EXIT.          07500000
                                                                        07510000
       7000-EXIT.                                                       07520000
           EXIT.                                                        07530000
                                                                        07540000
      ******************************************************************07550000
       9999-CLOSE-ROUTINE.                                              07560000
      ******************************************************************07570000
                                                                        07580000
           DISPLAY '*************** CONTROL    TOTALS ***************'. 07590000
           DISPLAY 'PROGRAM-ID : BP13C38V'.                             07600000
           DISPLAY '-------------------------------------------------'. 07610000
           DISPLAY '(1) NO OF BP13F800 RECORDS READ............. : '    07620000
                    WS-F800-READ.                                       07630000
           DISPLAY '(2) NO OF BP13L38V RECORDS WRITTEN.......... : '    07640000
                    WS-CNT-L38V-WRITE.                                  07650000
                                                                        07660000
           IF WS-CNT-L38V-WRITE = ZEROES                                07670000
              MOVE SPACES         TO MAILC38V-REC                       07680000
              WRITE                  MAILC38V-REC                       07690000
                                                                        07700000
              MOVE SPACES         TO MAILC38V-REC                       07710000
              MOVE 'There are no HLEs cases which needs reassessment.'  07720000
                                  TO MAILC38V-REC                       07730000
              WRITE MAILC38V-REC                                        07740000
           END-IF.                                                      07750000
                                                                        07760000
           CLOSE    BP13F800                                            07770000
                    BP13F38V                                            07780000
                    BM06K110                                            07790000
                    BP27K800                                            07800000
                    BP27K025                                            07810000
                    BP13K022                                            07820000
                    BP13L38V                                            07830000
                    MAILC38V.                                           07840000
                                                                        07850000
           IF WS-K025-STATUS NOT = 00 AND 97                            07860000
              DISPLAY 'BP27K025 - ERROR CLOSING : ' WS-K025-STATUS      07870000
           END-IF.                                                      07880000
                                                                        07890000
           IF WS-K022-STATUS NOT = 00 AND 97                            07900000
              DISPLAY 'BP13K022 - ERROR CLOSING : ' WS-K022-STATUS      07910000
           END-IF.                                                      07920000
                                                                        07930000
           IF WS-K800-STATUS NOT = 00 AND 97                            07940000
              DISPLAY 'BP27K800 - ERROR CLOSING : ' WS-K800-STATUS      07950000
              MOVE WS-K800-STATUS                   TO RETURN-CODE      07960000
           END-IF.                                                      07970000
                                                                        07980000
           IF WS-K110-STATUS NOT = 00 AND 97                            07990000
              DISPLAY 'BM06K110 - ERROR CLOSING : ' WS-K110-STATUS      08000000
              MOVE WS-K110-STATUS                   TO RETURN-CODE      08010000
           END-IF.                                                      08020000
                                                                        08030000
           STOP RUN.                                                    08040000
                                                                        08050000
       9999-EXIT.                                                       08060000
           EXIT.                                                        08070000
