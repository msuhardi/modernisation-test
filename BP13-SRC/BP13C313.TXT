      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID.    BP13C313.                                                 
      *AUTHOR.        TEREZA SALONGA.                                           
                                                                                
      * ========================================================== *            
      *               SYSTEM OF COMMITMENT (BP13)                  *            
      * ========================================================== *            
      *  OBJECTIVES :                                              *            
      *                                                            *            
      *    1.  WRITE INCOMPLETE/COMPLETE FLATS REPORT              *            
      *                                                            *            
      *    INPUT FILES : BP27F310 - TRANSACTION FILE               *            
      *                  BM06K110 - BM06.K110.FLATINV              *            
      *                  BP13K800 - SOC MASTER FILE                *            
      *                  BP27K800 - LEAS MASTER FILE               *            
      *    OUTPUT FILES: P13L313A - COMPLETE FLATS REPORT          *            
      *                  P13L313B - INCOMPLETE FLATS REPORT        *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * CHG REF  BY    DATE        DESCRIPTION                     *            
      * -------- ----  ----------  ----------------------------    *            
      * BP132998 MTSR1 06/03/07    NEW PROGRAM                     *            
      * BP133667 ESD1  18/08/10    CATER P13L313A P13L313B LISTING *            
      *                            FOR 2ND CA REPORT.              *            
      * BP137150 PCL4  04/01/18    TO ADD CHECK FOR K800-DTE-SALE-AGMT          
      * BP138047 KAC1  25/11/19  RECOMPILE FOR BP27 COPYBOOK UPDATE*            
      * ========================================================== *            
                                                                                
      *---------------------------*                                             
       ENVIRONMENT DIVISION.                                                    
      *---------------------------*                                             
       CONFIGURATION SECTION.                                                   
      *---------------------------*                                             
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *---------------------------*                                             
           SELECT BP27F310 ASSIGN    TO BP27F310.                               
                                                                                
           SELECT BP13K800 ASSIGN    TO BP13K800                                
                ACCESS MODE          IS RANDOM                                  
                ORGANIZATION         IS INDEXED                                 
                RECORD KEY           IS K800-NUM-REGN                           
                FILE STATUS          IS WS-BP13K800-STATUS.                     
                                                                                
           SELECT BP27K800 ASSIGN    TO BP27K800                                
                ACCESS MODE          IS RANDOM                                  
                ORGANIZATION         IS INDEXED                                 
                RECORD KEY           IS K800-NUM-HLA OF BP27K800-MASTER         
                FILE STATUS          IS WS-BP27K800-STATUS.                     
                                                                                
           SELECT BM06K110 ASSIGN    TO BM06K110                                
                ACCESS MODE          IS RANDOM                                  
                ORGANIZATION         IS INDEXED                                 
                RECORD KEY           IS K110-KEY-FLD                            
                ALTERNATE RECORD KEY IS K110-REGN-NO                            
                                        WITH DUPLICATES                         
                FILE STATUS          IS WS-BM06K110-STATUS.                     
                                                                                
           SELECT P13L313A ASSIGN    TO P13L313A.                               
           SELECT P13L313B ASSIGN    TO P13L313B.                               
                                                                                
                                                                                
      *---------------------------*                                             
       DATA DIVISION.                                                           
      *---------------------------*                                             
       FILE SECTION.                                                            
      *---------------------------*                                             
                                                                                
       FD   BP27F310                                                            
            BLOCK      CONTAINS 0    RECORDS                                    
            RECORD     CONTAINS 50   CHARACTERS                                 
            LABEL      RECORDS  ARE  STANDARD                                   
            RECORDING  MODE     IS   F.                                         
       COPY BP27F310.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP27K800                                                            
            RECORD CONTAINS 1200 CHARACTERS.                                    
       COPY BP27K800.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500  CHARACTERS.                                    
       COPY BM06K110.                                                           
                                                                                
       FD   P13L313A                                                            
            BLOCK      CONTAINS 0    RECORDS                                    
            RECORD     CONTAINS 132  CHARACTERS                                 
            LABEL      RECORDS  ARE  OMITTED                                    
            RECORDING  MODE     IS   F.                                         
       01  P13L313A-REC                   PIC X(132).                           
                                                                                
       FD   P13L313B                                                            
            BLOCK      CONTAINS 0    RECORDS                                    
            RECORD     CONTAINS 132  CHARACTERS                                 
            LABEL      RECORDS  ARE  OMITTED                                    
            RECORDING  MODE     IS   F.                                         
       01  P13L313B-REC                   PIC X(132).                           
                                                                                
                                                                                
      *---------------------------*                                             
       WORKING-STORAGE SECTION.                                                 
      *---------------------------*                                             
       01  WS-FILE-CONTROLS.                                                    
           05  WS-BP27F310-EOF            PIC X(1)    VALUE 'N'.                
           05  WS-BM06K110-STATUS         PIC 9(2)    VALUE ZEROES.             
           05  WS-BP13K800-STATUS         PIC 9(2)    VALUE ZEROES.             
           05  WS-BP27K800-STATUS         PIC 9(2)    VALUE ZEROES.             
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-SYSTEM-DATE             PIC X(8)    VALUE SPACES.             
           05  WS-HEADER-PRINT-A          PIC X(1)    VALUE 'N'.                
           05  WS-HEADER-PRINT-B          PIC X(1)    VALUE 'N'.                
           05  WS-END-OF-RPT-A            PIC X(1)    VALUE 'N'.                
           05  WS-END-OF-RPT-B            PIC X(1)    VALUE 'N'.                
           05  WS-SNO-A                   PIC 9(4)    VALUE ZEROES.             
           05  WS-SNO-B                   PIC 9(4)    VALUE ZEROES.             
           05  WS-BM06K110-FOUND          PIC X(1)    VALUE 'N'.                
           05  WS-BP13K800-FOUND          PIC X(1)    VALUE 'N'.                
           05  WS-BP27K800-FOUND          PIC X(1)    VALUE 'N'.                
           05  WS-PIDB-FOUND              PIC X(1)    VALUE 'N'.                
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F310A-READ-CTR          PIC 9(4)    VALUE ZEROES.             
           05  WS-AO-DATE-CTR             PIC 9(4)    VALUE ZEROES.             
           05  WS-K110-NTFOUND-CTR        PIC 9(4)    VALUE ZEROES.             
           05  WS-L313A-WRITE-CTR         PIC 9(4)    VALUE ZEROES.             
           05  WS-L313B-WRITE-CTR         PIC 9(4)    VALUE ZEROES.             
           05  WS-PAGE-CTR-A              PIC 9(3)    VALUE ZEROES.             
           05  WS-PAGE-CTR-B              PIC 9(3)    VALUE ZEROES.             
           05  WS-LINE-CTR-A              PIC 9(2)    VALUE ZEROES.             
           05  WS-LINE-CTR-B              PIC 9(2)    VALUE ZEROES.             
                                                                                
       01  WS-DASH-LINE                   PIC X(132)  VALUE ALL '-'.            
                                                                                
      *---------------------------*                                             
      * REPORT LAYOUT             *                                             
      *---------------------------*                                             
                                                                                
       01  L313-HD1.                                                            
           05  L313-RPT                   PIC X(08)   VALUE SPACES.             
           05  FILLER                     PIC X(24)   VALUE                     
               '  HDB3                  '.                                      
           05  FILLER                     PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(41)   VALUE                     
               ' S Y S T E M   O F   C O M M I T M E N T '.                     
           05  FILLER                     PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(26)   VALUE                     
               '                   DATE : '.                                    
           05  L313-DATE                  PIC X(10)   VALUE SPACES.             
                                                                                
       01  L313A-HD2.                                                           
           05  FILLER                     PIC X(38)   VALUE SPACES.             
           05  FILLER                     PIC X(51)   VALUE                     
               'DAILY REPORT ON COU UPDATE OF HLE (KEY AVAILABLE)  '.           
           05  FILLER                     PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(21)   VALUE                     
               '              PAGE : '.                                         
           05  L313-PAGE-A                PIC ZZ9     VALUE ZEROES.             
                                                                                
       01  L313B-HD2.                                                           
           05  FILLER                     PIC X(36)   VALUE SPACES.             
           05  FILLER                     PIC X(53)   VALUE                     
               'DAILY REPORT ON COU UPDATE OF HLE (KEY NOT AVAILABLE)'.         
           05  FILLER                     PIC X(11)   VALUE SPACES.             
           05  FILLER                     PIC X(21)   VALUE                     
               '              PAGE : '.                                         
           05  L313-PAGE-B                PIC ZZ9     VALUE ZEROES.             
                                                                                
       01  L313-HD3.                                                            
           05  FILLER                     PIC X(08)   VALUE                     
               'S/NO    '.                                                      
           05  FILLER                     PIC X(12)   VALUE                     
               'REGN        '.                                                  
           05  FILLER                     PIC X(09)   VALUE                     
               'BLK      '.                                                     
           05  FILLER                     PIC X(36)   VALUE                     
               'STREET NAME                         '.                          
           05  FILLER                     PIC X(10)   VALUE                     
               'UNIT NO   '.                                                    
           05  FILLER                     PIC X(05)   VALUE                     
               'RM   '.                                                         
           05  FILLER                     PIC X(05)   VALUE                     
               'LOAN '.                                                         
           05  FILLER                     PIC X(13)   VALUE                     
               'ACCEPT DTE   '.                                                 
           05  FILLER                     PIC X(10)   VALUE                     
               'FLAT STAT '.                                                    
           05  FILLER                     PIC X(10)   VALUE                     
               'BUY/SELL  '.                                                    
           05  FILLER                     PIC X(11)   VALUE                     
               'FR DATE    '.                                                   
                                                                                
       01  L313-HD3-2.                                                          
           05  FILLER                     PIC X(75)   VALUE SPACES.             
           05  FILLER                     PIC X(05)   VALUE                     
               'TYPE '.                                                         
           05  FILLER                     PIC X(05)   VALUE                     
               'TAG  '.                                                         
           05  FILLER                     PIC X(13)   VALUE                     
               'AO DTE       '.                                                 
           05  FILLER                     PIC X(12)   VALUE SPACES.             
           05  FILLER                     PIC X(08)   VALUE                     
               'TAG     '.                                                      
           05  FILLER                     PIC X(13)   VALUE                     
               'KEY AVAIL DTE'.                                                 
                                                                                
       01  L313-HD3-3.                                                          
           05  FILLER                     PIC X(75)   VALUE SPACES.             
           05  FILLER                     PIC X(05)   VALUE                     
               'TYPE '.                                                         
           05  FILLER                     PIC X(05)   VALUE                     
               'TAG  '.                                                         
           05  FILLER                     PIC X(13)   VALUE                     
               'AO DTE       '.                                                 
           05  FILLER                     PIC X(12)   VALUE SPACES.             
           05  FILLER                     PIC X(08)   VALUE                     
               'TAG     '.                                                      
                                                                                
       01  L313-DETAIL.                                                         
           05  L313-SNO                   PIC ZZZ9    VALUE ZEROES.             
           05  FILLER                     PIC X(04)   VALUE SPACES.             
           05  L313-REGNO                 PIC X(08)   VALUE SPACES.             
           05  FILLER                     PIC X(04)   VALUE SPACES.             
           05  L313-BLK                   PIC X(05)   VALUE SPACES.             
           05  FILLER                     PIC X(04)   VALUE SPACES.             
           05  L313-STR-NAME              PIC X(32)   VALUE SPACES.             
           05  FILLER                     PIC X(04)   VALUE SPACES.             
           05  L313-UNIT-NO               PIC X(07)   VALUE SPACES.             
           05  FILLER                     PIC X(03)   VALUE SPACES.             
           05  L313-RM-TYPE               PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(03)   VALUE SPACES.             
           05  L313-LOAN-TAG              PIC X(01)   VALUE SPACES.             
           05  FILLER                     PIC X(04)   VALUE SPACES.             
           05  L313-ACCEPT-DTE            PIC X(10)   VALUE SPACES.             
           05  FILLER                     PIC X(03)   VALUE SPACES.             
           05  L313-FLAT-STAT             PIC X(02)   VALUE SPACES.             
           05  FILLER                     PIC X(08)   VALUE SPACES.             
           05  L313-BUY-SELL              PIC X(05)   VALUE SPACES.             
           05  FILLER                     PIC X(05)   VALUE SPACES.             
           05  L313-FR-DTE                PIC X(10)   VALUE SPACES.             
                                                                                
       01  L313-DTL-2.                                                          
           05  FILLER                     PIC X(85)   VALUE SPACES.             
           05  L313-AO-DTE                PIC X(10)   VALUE SPACES.             
           05  FILLER                     PIC X(23)   VALUE SPACES.             
           05  L313-KEY-AVAIL-DTE         PIC X(10)   VALUE SPACES.             
                                                                                
       01  L313-TRLR.                                                           
           05  FILLER                     PIC X(26)   VALUE SPACES.             
           05  FILLER                     PIC X(53)   VALUE                     
               '******************* END OF REPORT *******************'.         
                                                                                
       01  L313-TRLR2.                                                          
           05  FILLER                     PIC X(38)   VALUE SPACES.             
           05  FILLER                     PIC X(53)   VALUE                     
               '******************** NIL REPORT *********************'.         
                                                                                
                                                                                
      *---------------------------*                                             
      *   LINKAGE SECTION FOR BP13C913                                          
      *---------------------------*                                             
       01  WS-LINK-BP13C913.                                                    
           05  LINK-NUM-SCH-ACC.                                                
               10  LINK-NUM-SCH           PIC X(4).                             
               10  LINK-NUM-ACC           PIC X(5).                             
       COPY P13COMM8.                                                           
                                                                                
                                                                                
      *---------------------------*                                             
       PROCEDURE DIVISION.                                                      
      *---------------------------*                                             
       0000-CONTROL.                                                            
      *---------------------------*                                             
           PERFORM  1000-OPEN-FILES         THRU 1000-EXIT.                     
           PERFORM  2000-MAIN-ROUTINE       THRU 2000-EXIT                      
              UNTIL WS-BP27F310-EOF = 'Y'.                                      
                                                                                
           MOVE     'Y'                     TO   WS-END-OF-RPT-A.               
           PERFORM  6000-WRITE-RPT-A        THRU 6000-EXIT.                     
           MOVE     'Y'                     TO   WS-END-OF-RPT-B.               
           PERFORM  6500-WRITE-RPT-B        THRU 6500-EXIT.                     
                                                                                
           PERFORM  9000-CLOSE-FILES        THRU 9000-EXIT.                     
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       1000-OPEN-FILES.                                                         
      *---------------------------*                                             
           OPEN INPUT  BP27F310                                                 
                       BP13K800                                                 
                       BP27K800                                                 
                       BM06K110                                                 
                OUTPUT P13L313A                                                 
                       P13L313B.                                                
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)     TO   WS-SYSTEM-DATE.             
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO L313-DATE.                                 
                                                                                
           IF WS-BP13K800-STATUS NOT = 00 AND 97                                
              DISPLAY 'BP13K800 OPEN ERROR - ' WS-BP13K800-STATUS               
              MOVE    WS-BP13K800-STATUS  TO   RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF WS-BP27K800-STATUS NOT = 00 AND 97                                
              DISPLAY 'BP27K800 OPEN ERROR - ' WS-BP27K800-STATUS               
              MOVE    WS-BP27K800-STATUS  TO   RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF WS-BM06K110-STATUS NOT = 00 AND 97                                
              DISPLAY 'BM06K110 OPEN ERROR - ' WS-BM06K110-STATUS               
              MOVE    WS-BM06K110-STATUS  TO   RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           MOVE 56                        TO   WS-LINE-CTR-A.                   
           MOVE 56                        TO   WS-LINE-CTR-B.                   
                                                                                
           PERFORM 3000-READ-BP27F310     THRU 3000-EXIT.                       
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       2000-MAIN-ROUTINE.                                                       
      *---------------------------*                                             
           PERFORM 3100-READ-BM06K110        THRU 3100-EXIT.                    
                                                                                
           IF WS-BM06K110-FOUND = 'Y'                                           
              PERFORM 3200-READ-BP13K800     THRU 3200-EXIT                     
              PERFORM 3300-READ-BP27K800     THRU 3300-EXIT                     
                                                                                
              IF WS-BP13K800-FOUND = 'Y'                                        
                 PERFORM 7000-GET-PIDB-INFO  THRU 7000-EXIT                     
                                                                                
                 IF K110-DTE-KEY-AVAIL = SPACES OR LOW-VALUES OR                
                                         '00000000'                             
                    IF K800-DTE-SALE-AGMT NOT = SPACES AND LOW-VALUES           
                                                       AND ZEROES               
                                                                                
                       ADD 1                    TO WS-AO-DATE-CTR               
                    ELSE                                                        
                       PERFORM 6500-WRITE-RPT-B THRU 6500-EXIT                  
                    END-IF                                                      
                 ELSE                                                           
                    PERFORM 6000-WRITE-RPT-A THRU 6000-EXIT                     
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 3000-READ-BP27F310        THRU 3000-EXIT.                    
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       3000-READ-BP27F310.                                                      
      *---------------------------*                                             
           READ BP27F310                                                        
              AT END MOVE 'Y'              TO   WS-BP27F310-EOF                 
              GO TO  3000-EXIT                                                  
           END-READ.                                                            
                                                                                
           ADD 1                           TO   WS-F310A-READ-CTR.              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       3100-READ-BM06K110.                                                      
      *---------------------------*                                             
           MOVE SPACES                     TO   K110-REC.                       
           INITIALIZE                           K110-REC.                       
           MOVE 'N'                        TO   WS-BM06K110-FOUND.              
                                                                                
           MOVE F310-NUM-REGN              TO   K110-REGN-NO.                   
                                                                                
           READ BM06K110 KEY IS K110-REGN-NO.                                   
                                                                                
           EVALUATE WS-BM06K110-STATUS                                          
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-BM06K110-FOUND               
           WHEN 23                                                              
              DISPLAY 'BM06K110 REC NOT FOUND - ' F310-NUM-REGN                 
              ADD 1                        TO   WS-K110-NTFOUND-CTR             
           WHEN OTHER                                                           
              DISPLAY 'BM06K110 READ ERROR - '  WS-BM06K110-STATUS              
              MOVE    WS-BM06K110-STATUS   TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       3200-READ-BP13K800.                                                      
      *---------------------------*                                             
           MOVE SPACES                      TO   BP13K800-MASTER.               
           INITIALIZE                            BP13K800-MASTER.               
           MOVE 'N'                         TO   WS-BP13K800-FOUND.             
                                                                                
           MOVE F310-NUM-REGN               TO   K800-NUM-REGN.                 
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-BP13K800-STATUS                                          
           WHEN 00                                                              
              IF K800-DTE-FILE-RECEIVED = SPACES OR LOW-VALUES OR ZEROES        
                 CONTINUE                                                       
              ELSE                                                              
                 MOVE 'Y'                   TO   WS-BP13K800-FOUND              
              END-IF                                                            
           WHEN 23                                                              
              DISPLAY 'BP13K800 REC NOT FOUND - '  F310-NUM-REGN                
           WHEN OTHER                                                           
              DISPLAY 'BP13K800 READ ERROR - '   WS-BP13K800-STATUS             
              MOVE    WS-BP13K800-STATUS    TO   RETURN-CODE                    
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       3300-READ-BP27K800.                                                      
      *---------------------------*                                             
           MOVE SPACES                      TO   BP27K800-MASTER.               
           INITIALIZE                            BP27K800-MASTER.               
           MOVE 'N'                         TO   WS-BP27K800-FOUND.             
                                                                                
           MOVE F310-NUM-HLA                TO   K800-NUM-HLA OF                
                                                 BP27K800-MASTER.               
                                                                                
           READ BP27K800.                                                       
                                                                                
           EVALUATE WS-BP27K800-STATUS                                          
           WHEN 00                                                              
              MOVE 'Y'                      TO   WS-BP27K800-FOUND              
           WHEN 23                                                              
              DISPLAY 'BP27K800 REC NOT FOUND - '  F310-NUM-HLA                 
           WHEN OTHER                                                           
              DISPLAY 'BP27K800 READ ERROR - '   WS-BP27K800-STATUS             
              MOVE    WS-BP27K800-STATUS    TO   RETURN-CODE                    
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       6000-WRITE-RPT-A.                                                        
      *---------------------------*                                             
           MOVE SPACES  TO   P13L313A-REC.                                      
           INITIALIZE        P13L313A-REC.                                      
                                                                                
           IF WS-END-OF-RPT-A = 'Y'                                             
              IF WS-HEADER-PRINT-A = 'Y'                                        
                 IF WS-SNO-A > 0                                                
                    WRITE P13L313A-REC FROM L313-TRLR  AFTER 2                  
                 ELSE                                                           
                    WRITE P13L313A-REC FROM L313-TRLR2 AFTER 2                  
                 END-IF                                                         
                 GO TO 6000-EXIT                                                
              ELSE                                                              
                 PERFORM 6300-WRITE-HEADING-A THRU 6300-EXIT                    
                 IF WS-SNO-A > 0                                                
                    WRITE P13L313A-REC FROM L313-TRLR AFTER 2                   
                 ELSE                                                           
                    WRITE P13L313A-REC FROM L313-TRLR2 AFTER 2                  
                 END-IF                                                         
                 GO TO 6000-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF WS-LINE-CTR-A > 55                                                
              PERFORM 6300-WRITE-HEADING-A  THRU 6300-EXIT                      
           END-IF.                                                              
                                                                                
           MOVE SPACES                      TO   L313-DETAIL                    
                                                 L313-DTL-2.                    
           INITIALIZE                            L313-DETAIL                    
                                                 L313-DTL-2.                    
                                                                                
           ADD  1                           TO   WS-SNO-A.                      
           MOVE WS-SNO-A                    TO   L313-SNO.                      
                                                                                
           IF WS-PIDB-FOUND = 'Y'                                               
              MOVE COMM8-NUM-BLK            TO   L313-BLK                       
              MOVE COMM8-NME-STREET         TO   L313-STR-NAME                  
              MOVE COMM8-RM-TYPE            TO   L313-RM-TYPE                   
                                                                                
              IF COMM8-NUM-UNIT-SUB NOT = SPACES AND LOW-VALUES                 
                 STRING COMM8-NUM-UNIT-MAIN '-' COMM8-NUM-UNIT-SUB              
                    DELIMITED BY SIZE       INTO L313-UNIT-NO                   
              ELSE                                                              
                 MOVE COMM8-NUM-UNIT-MAIN   TO   L313-UNIT-NO                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF WS-BP13K800-FOUND = 'Y'                                           
              MOVE K800-NUM-REGN            TO   L313-REGNO                     
              MOVE K800-NUM-LOAN-TAG OF BP13K800-MASTER                         
                                            TO   L313-LOAN-TAG                  
                                                                                
              IF K800-DTE-FILE-RECEIVED NOT = SPACES AND LOW-VALUES             
                                                     AND ZEROES                 
                 STRING K800-DTE-FILE-RECEIVED(7:2) '/'                         
                        K800-DTE-FILE-RECEIVED(5:2) '/'                         
                        K800-DTE-FILE-RECEIVED(1:4)                             
                    DELIMITED BY SIZE INTO L313-FR-DTE                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K110-FLAT-STATUS            TO   L313-FLAT-STAT.                
                                                                                
           STRING '('                                                           
                  K800-NUM-BUY-SELL-TAG                                         
                  '/'                                                           
                  K800-NUM-PROPERTY-TAG                                         
                  ')'                                                           
                  DELIMITED BY SIZE INTO L313-BUY-SELL                          
           END-STRING                                                           
                                                                                
           IF K110-DTE-ACCEPTANCE NOT = SPACES AND LOW-VALUES AND ZEROES        
              STRING K110-DTE-ACCEPTANCE(7:2) '/'                               
                     K110-DTE-ACCEPTANCE(5:2) '/'                               
                     K110-DTE-ACCEPTANCE(1:4)                                   
                 DELIMITED BY SIZE INTO L313-ACCEPT-DTE                         
           END-IF.                                                              
                                                                                
           IF K110-DTE-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND ZEROES         
              STRING K110-DTE-KEY-AVAIL(7:2) '/'                                
                     K110-DTE-KEY-AVAIL(5:2) '/'                                
                     K110-DTE-KEY-AVAIL(1:4)                                    
                 DELIMITED BY SIZE INTO L313-KEY-AVAIL-DTE                      
           END-IF.                                                              
                                                                                
           IF K800-DTE-SALE-AGMT  NOT = SPACES AND LOW-VALUES AND ZEROES        
              STRING K800-DTE-SALE-AGMT(7:2) '/'                                
                     K800-DTE-SALE-AGMT(5:2) '/'                                
                     K800-DTE-SALE-AGMT(1:4)                                    
                 DELIMITED BY SIZE INTO L313-AO-DTE                             
           END-IF.                                                              
                                                                                
           WRITE P13L313A-REC               FROM L313-DETAIL.                   
           WRITE P13L313A-REC               FROM L313-DTL-2.                    
           MOVE SPACES TO   P13L313A-REC                                        
           WRITE P13L313A-REC                                                   
                                                                                
           ADD 1                            TO   WS-L313A-WRITE-CTR.            
           ADD 3                            TO   WS-LINE-CTR-A.                 
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       6300-WRITE-HEADING-A.                                                    
      *---------------------------*                                             
           ADD 1               TO   WS-PAGE-CTR-A.                              
                                                                                
           MOVE  WS-PAGE-CTR-A TO   L313-PAGE-A.                                
           MOVE  SPACES        TO   L313-RPT.                                   
           MOVE  'P13L313A'    TO   L313-RPT.                                   
           WRITE P13L313A-REC  FROM L313-HD1 AFTER PAGE.                        
           WRITE P13L313A-REC  FROM L313A-HD2.                                  
           WRITE P13L313A-REC  FROM L313-HD3 AFTER 2.                           
           WRITE P13L313A-REC  FROM L313-HD3-2.                                 
           WRITE P13L313A-REC  FROM WS-DASH-LINE.                               
                                                                                
           MOVE 5              TO   WS-LINE-CTR-A.                              
           MOVE 'Y'            TO   WS-HEADER-PRINT-A.                          
                                                                                
       6300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       6500-WRITE-RPT-B.                                                        
      *---------------------------*                                             
           MOVE SPACES    TO   P13L313B-REC.                                    
           INITIALIZE          P13L313B-REC.                                    
                                                                                
           IF WS-END-OF-RPT-B = 'Y'                                             
              IF WS-HEADER-PRINT-B = 'Y'                                        
                 IF WS-SNO-B > 0                                                
                    WRITE P13L313B-REC FROM L313-TRLR AFTER 2                   
                 ELSE                                                           
                    WRITE P13L313B-REC FROM L313-TRLR2 AFTER 2                  
                 END-IF                                                         
                 GO TO 6500-EXIT                                                
              ELSE                                                              
                 PERFORM 6700-WRITE-HEADING-B THRU 6700-EXIT                    
                 IF WS-SNO-B > 0                                                
                    WRITE P13L313B-REC FROM L313-TRLR AFTER 2                   
                 ELSE                                                           
                    WRITE P13L313B-REC FROM L313-TRLR2 AFTER 2                  
                 END-IF                                                         
                 GO TO 6500-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF WS-LINE-CTR-B > 55                                                
              PERFORM 6700-WRITE-HEADING-B THRU 6700-EXIT                       
           END-IF.                                                              
                                                                                
           MOVE SPACES                      TO   L313-DETAIL                    
                                                 L313-DTL-2.                    
           INITIALIZE                            L313-DETAIL                    
                                                 L313-DTL-2.                    
                                                                                
           ADD  1                           TO   WS-SNO-B.                      
           MOVE WS-SNO-B                    TO   L313-SNO.                      
                                                                                
           IF WS-PIDB-FOUND = 'Y'                                               
              MOVE COMM8-NUM-BLK            TO   L313-BLK                       
              MOVE COMM8-NME-STREET         TO   L313-STR-NAME                  
              MOVE COMM8-RM-TYPE            TO   L313-RM-TYPE                   
                                                                                
              IF COMM8-NUM-UNIT-SUB NOT = SPACES AND LOW-VALUES                 
                 STRING COMM8-NUM-UNIT-MAIN '-' COMM8-NUM-UNIT-SUB              
                    DELIMITED BY SIZE       INTO   L313-UNIT-NO                 
              ELSE                                                              
                 MOVE COMM8-NUM-UNIT-MAIN   TO   L313-UNIT-NO                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF WS-BP13K800-FOUND = 'Y'                                           
              MOVE K800-NUM-REGN            TO   L313-REGNO                     
              MOVE K800-NUM-LOAN-TAG OF BP13K800-MASTER                         
                                            TO   L313-LOAN-TAG                  
                                                                                
              IF K800-DTE-FILE-RECEIVED NOT = SPACES AND LOW-VALUES             
                                                     AND ZEROES                 
                 STRING K800-DTE-FILE-RECEIVED(7:2) '/'                         
                        K800-DTE-FILE-RECEIVED(5:2) '/'                         
                        K800-DTE-FILE-RECEIVED(1:4)                             
                    DELIMITED BY SIZE INTO L313-FR-DTE                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K110-FLAT-STATUS            TO   L313-FLAT-STAT.                
                                                                                
           STRING '('                                                           
                  K800-NUM-BUY-SELL-TAG                                         
                  '/'                                                           
                  K800-NUM-PROPERTY-TAG                                         
                  ')'                                                           
                  DELIMITED BY SIZE INTO L313-BUY-SELL                          
           END-STRING                                                           
                                                                                
           IF K110-DTE-ACCEPTANCE NOT = SPACES AND LOW-VALUES AND ZEROES        
              STRING K110-DTE-ACCEPTANCE(7:2) '/'                               
                     K110-DTE-ACCEPTANCE(5:2) '/'                               
                     K110-DTE-ACCEPTANCE(1:4)                                   
                 DELIMITED BY SIZE INTO L313-ACCEPT-DTE                         
           END-IF.                                                              
                                                                                
           IF K800-DTE-SALE-AGMT NOT = SPACES AND LOW-VALUES AND ZEROES         
              STRING K800-DTE-SALE-AGMT(7:2) '/'                                
                     K800-DTE-SALE-AGMT(5:2) '/'                                
                     K800-DTE-SALE-AGMT(1:4)                                    
                 DELIMITED BY SIZE INTO L313-AO-DTE                             
           END-IF.                                                              
                                                                                
           WRITE P13L313B-REC              FROM L313-DETAIL.                    
           WRITE P13L313B-REC              FROM L313-DTL-2.                     
           MOVE SPACES TO P13L313B-REC                                          
           WRITE P13L313B-REC                                                   
                                                                                
           ADD 1                           TO   WS-L313B-WRITE-CTR.             
           ADD 3                           TO   WS-LINE-CTR-B.                  
                                                                                
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       6700-WRITE-HEADING-B.                                                    
      *---------------------------*                                             
           ADD 1               TO   WS-PAGE-CTR-B.                              
                                                                                
           MOVE  WS-PAGE-CTR-B TO   L313-PAGE-B.                                
           MOVE  SPACES        TO   L313-RPT.                                   
           MOVE  'P13L313B'    TO   L313-RPT.                                   
           WRITE P13L313B-REC  FROM L313-HD1 AFTER PAGE.                        
           WRITE P13L313B-REC  FROM L313B-HD2.                                  
           WRITE P13L313B-REC  FROM L313-HD3 AFTER 2.                           
           WRITE P13L313B-REC  FROM L313-HD3-3.                                 
           WRITE P13L313B-REC  FROM WS-DASH-LINE.                               
                                                                                
           MOVE 5              TO   WS-LINE-CTR-B.                              
           MOVE 'Y'            TO   WS-HEADER-PRINT-B.                          
                                                                                
       6700-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------*                                             
       7000-GET-PIDB-INFO.                                                      
      *---------------------------*                                             
           MOVE SPACES                      TO   BP13COMM8-REC.                 
           INITIALIZE                            BP13COMM8-REC.                 
           MOVE 'Y'                         TO   WS-PIDB-FOUND                  
                                                                                
           MOVE K800-NUM-SCH-ACC            TO   LINK-NUM-SCH-ACC.              
                                                                                
           CALL 'BP13C913' USING WS-LINK-BP13C913,                              
                                 BP13COMM8-REC.                                 
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0                                          
              IF COMM8-CDE-SYSERR = 100                                         
                 CONTINUE                                                       
              ELSE                                                              
                 DISPLAY 'ERROR READING PBF TABLE ' COMM8-CDE-SYSERR            
                 MOVE COMM8-CDE-SYSERR      TO   RETURN-CODE                    
              END-IF                                                            
              MOVE 'N'                      TO   WS-PIDB-FOUND                  
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *---------------------------*                                             
       9000-CLOSE-FILES.                                                        
      *---------------------------*                                             
           CLOSE BP27F310                                                       
                 BP13K800                                                       
                 BP27K800                                                       
                 BM06K110                                                       
                 P13L313A                                                       
                 P13L313B.                                                      
                                                                                
           IF WS-BP13K800-STATUS NOT = 00                                       
              DISPLAY 'BP13K800 CLOSE ERROR - ' WS-BP13K800-STATUS              
              MOVE    WS-BP13K800-STATUS  TO    RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-BP27K800-STATUS NOT = 00                                       
              DISPLAY 'BP13K800 CLOSE ERROR - ' WS-BP13K800-STATUS              
              MOVE    WS-BP13K800-STATUS  TO    RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-BM06K110-STATUS NOT = 00                                       
              DISPLAY 'BM06K110 CLOSE ERROR - ' WS-BM06K110-STATUS              
              MOVE    WS-BM06K110-STATUS  TO    RETURN-CODE                     
           END-IF.                                                              
                                                                                
           DISPLAY '------------------------------------------'.                
           DISPLAY 'BP13C313 CONTROL TOTAL                    '.                
           DISPLAY 'DATE: ' WS-SYSTEM-DATE                                      
           DISPLAY '------------------------------------------'.                
           DISPLAY 'NO. OF RECS READ FROM F310A : ' WS-F310A-READ-CTR.          
           DISPLAY 'NO. OF RECS WRITTEN IN L313A: ' WS-L313A-WRITE-CTR.         
           DISPLAY 'NO. OF RECS WRITTEN IN L313B: ' WS-L313B-WRITE-CTR.         
           DISPLAY 'NO. OF RECS NOT PROCESSED   : ' WS-K110-NTFOUND-CTR.        
           DISPLAY 'NO. OF RECS WITH AO DATE    : ' WS-AO-DATE-CTR.             
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
