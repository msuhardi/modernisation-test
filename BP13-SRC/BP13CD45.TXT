       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CD45.                                                 
      *AUTHOR.        JB8.                                                      
      *DATE-WRITTEN.  03/07/2008.                                               
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      *                                                            *            
      * OBJECTIVES: DBSS REPORT.                                   *            
      *    HOUSEHOLD INFORMATION OF DBSS APPLICANTS BY PROJECT,    *            
      *    THS REPORT IS REQUESTED BY BO.                          *            
      *                                                            *            
      *  INPUT FILE : BP13FD00                                     *            
      *               BM06F120                                     *            
      *               BP13K800                                     *            
      *               BP13K820                                     *            
      *               BP13K060                                     *            
      * OUTPUT FILE : BP13FOUT                                     *            
      * ---------------------------------------------------------- *            
      * CHG REF   BY    DATE      DETAILS                          *            
      * -------   ====  ========= ================================ *            
      * BP133323  JB8   20080703  NEW PGM                          *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13FD00  ASSIGN        TO BP13FD00.                          
                                                                                
           SELECT BP13FOUT  ASSIGN        TO BP13FOUT.                          
                                                                                
           SELECT BM06F120  ASSIGN        TO BM06F120.                          
                                                                                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ORGANIZATION  IS INDEXED                            
                            ACCESS MODE   IS RANDOM                             
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS WS-K800-STATUS.                    
                                                                                
           SELECT BP13K820  ASSIGN        TO BP13K820                           
                            ORGANIZATION  IS INDEXED                            
                            ACCESS MODE   IS DYNAMIC                            
                            RECORD KEY    IS K820-KEY-FLD                       
                            FILE STATUS   IS WS-K820-STATUS.                    
                                                                                
           SELECT BP13K060  ASSIGN        TO BP13K060                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K060-KEY-FLD                       
                            FILE STATUS   IS WS-K060-STATUS.                    
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13FD00                                                            
            RECORD CONTAINS 1600 CHARACTERS                                     
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13FD00.                                                           
                                                                                
       FD   BM06F120                                                            
            RECORD CONTAINS 700 CHARACTERS                                      
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BM06F120.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K060                                                            
            RECORD CONTAINS 25 CHARACTERS.                                      
       COPY BP13K060.                                                           
                                                                                
       FD   BP13FOUT                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 600 CHARACTERS                                      
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       01   BP13FOUT-REC                 PIC X(600).                            
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-FILE-STATUS.                                                      
           05 WS-K800-STATUS             PIC 9(02)    VALUE ZEROES.             
           05 WS-K820-STATUS             PIC 9(02)    VALUE ZEROES.             
           05 WS-K060-STATUS             PIC 9(02)    VALUE ZEROES.             
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-FD00-READ               PIC 9(08)    VALUE ZEROES.             
           05 WS-F120-READ               PIC 9(08)    VALUE ZEROES.             
           05 WS-MATCH                   PIC 9(08)    VALUE ZEROES.             
           05 WS-NOTFD-F120              PIC 9(08)    VALUE ZEROES.             
           05 WS-NOTFD-FD00              PIC 9(08)    VALUE ZEROES.             
           05 WS-FOUT-WRITE              PIC 9(08)    VALUE ZEROES.             
           05 WS-REC-SN                  PIC 9(08)    VALUE ZEROES.             
           05 WS-IC-CTR                  PIC 9(01)    VALUE ZEROES.             
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-AMT-INCOME              PIC 9(05)    VALUE ZEROES.             
           05 WS-TITLE-REC               PIC X(600)   VALUE ZEROES.             
                                                                                
       01  WS-FOUT-REC.                                                         
            05  FOUT-NUM-SN              PIC ZZZZZZ9.                           
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-BLK             PIC X(05).                             
            05  FILLER                   PIC X(04)  VALUE '   #'.               
            05  FOUT-NUM-FLOOR           PIC X(02).                             
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-UNIT            PIC X(07).                             
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-SCH-ACC         PIC X(11).                             
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-ELIG-SCH        PIC X(03).                             
            05  FILLER                   PIC X(02)  VALUE SPACES.               
            05  FOUT-NUM-ALLO-SCH        PIC X(03).                             
            05  FILLER                   PIC X(02)  VALUE SPACES.               
            05  FOUT-NUM-FLAT-TYPE       PIC X(02).                             
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-FLOOR-AREA      PIC ZZ,ZZ9.99.                         
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-INTL-AREA       PIC ZZ,ZZ9.99.                         
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-SELLING-PRICE   PIC ZZ,ZZZ,ZZ9.                        
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-HH-INCOME       PIC ZZ,ZZ9.                            
            05  FILLER                   PIC X(03)  VALUE SPACES.               
            05  FOUT-NUM-LOAN-POLICY     PIC X(02).                             
            05  FILLER                   PIC X(03)  VALUE SPACES.               
            05  FOUT-NUM-MORTAGE-LOAN    PIC Z,ZZZ,ZZ9.99.                      
            05  FILLER                   PIC X(02)  VALUE SPACES.               
            05  FOUT-NUM-REPYMT-PERIOD   PIC Z9.                                
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-NUM-MONTHLY-INSTAL  PIC ZZZ,ZZ9.99.                        
            05  FILLER                   PIC X(01)  VALUE SPACE.                
            05  FOUT-CDE-MODE-REPAYMENT  PIC X(04).                             
            05  FILLER                   PIC X(02)  VALUE SPACES.               
            05  FOUT-HA OCCURS 4 TIMES.                                         
                10  FOUT-NME-OCCP        PIC X(40).                             
                10  FILLER               PIC X(01)  VALUE SPACE.                
                10  FOUT-NUM-NRIC        PIC X(09).                             
                10  FILLER               PIC X(03)  VALUE SPACES.               
                10  FOUT-NUM-NTNLTY      PIC X(02).                             
                10  FILLER               PIC X(04)  VALUE SPACES.               
                10  FOUT-NUM-SEX         PIC X(01).                             
                10  FILLER               PIC X(02)  VALUE SPACES.               
                10  FOUT-DTE-BIRTH       PIC X(10).                             
                10  FILLER               PIC X(01)  VALUE SPACE.                
                10  FOUT-NUM-MS          PIC X(01).                             
                10  FILLER               PIC X(04)  VALUE SPACES.               
                10  FOUT-NUM-ETHNIC      PIC X(01).                             
                10  FILLER               PIC X(04)  VALUE SPACES.               
                10  FOUT-NUM-RELATION    PIC X(20).                             
                10  FILLER               PIC X(01)  VALUE SPACE.                
            05  FILLER                   PIC X(52)  VALUE SPACES.               
                                                                                
       01  WS-SWITCHES.                                                         
           05 WS-FD00-EOF                PIC X(01)    VALUE 'N'.                
           05 WS-K820-EOF                PIC X(01)    VALUE 'N'.                
                                                                                
       01  WS-HEAD-MAIN.                                                        
           05  FILLER                    PIC X(28)  VALUE SPACES.               
           05  FILLER                    PIC X(11)  VALUE 'SCHEME'.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(04)  VALUE 'ELIG'.               
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(04)  VALUE 'ALLO'.               
           05  FILLER                    PIC X(04)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE '    FLOOR'.          
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE ' INTERNAL'.          
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE '   SELLING'.         
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(06)  VALUE '  HH  '.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(06)  VALUE 'LOAN  '.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(12)  VALUE                       
                                                     '     MORTAGE'.            
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(03)  VALUE 'RPY'.                
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE '   MONTHLY'.         
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE 'REPAY'.              
           05  FILLER                    PIC X(01)  VALUE '|'.                  
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(03)  VALUE 'HA1'.                
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(01)  VALUE '|'.                  
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(03)  VALUE 'HA2'.                
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(01)  VALUE '|'.                  
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(03)  VALUE 'HA3'.                
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(01)  VALUE '|'.                  
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(03)  VALUE 'HA4'.                
           05  FILLER                    PIC X(50)  VALUE ALL '-'.              
           05  FILLER                    PIC X(01)  VALUE '|'.                  
           05  FILLER                    PIC X(52)  VALUE SPACES.               
                                                                                
       01  WS-HEAD-SUB.                                                         
           05  FILLER                    PIC X(07)  VALUE '   S/N '.            
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE 'BLOCK'.              
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE 'FLOOR'.              
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(07)  VALUE 'UNIT'.               
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(11)  VALUE 'ACCOUT'.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(03)  VALUE 'SCH'.                
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  FILLER                    PIC X(03)  VALUE 'SCH'.                
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  FILLER                    PIC X(02)  VALUE 'FT'.                 
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE '     AREA'.          
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE ' FLR AREA'.          
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE '     PRICE'.         
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(06)  VALUE 'INCOME'.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(06)  VALUE 'POLICY'.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(12)  VALUE                       
                                                    '        LOAN'.             
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(03)  VALUE 'PRD'.                
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE '    INSTAL'.         
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE 'MODE '.              
           05  FILLER                    PIC X(01)  VALUE SPACES.               
           05  WS-HA OCCURS 4 TIMES.                                            
               15  FILLER                PIC X(40)    VALUE 'NAME'.             
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(09)    VALUE 'NRIC'.             
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(06)    VALUE 'NTNLTY'.           
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(03)    VALUE 'SEX'.              
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(10)    VALUE 'DOB'.              
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(02)    VALUE 'MS'.               
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(06)    VALUE 'ETHNIC'.           
               15  FILLER                PIC X(01)    VALUE SPACES.             
               15  FILLER                PIC X(20)                              
                                         VALUE 'RELATIONSHIP'.                  
               15  FILLER                PIC X(01)    VALUE SPACES.             
           05  FILLER                    PIC X(52)    VALUE SPACES.             
                                                                                
      *-------------------------------------------------------------            
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
                                                                                
           PERFORM 1000-OPEN-FILES     THRU 1000-EXIT.                          
                                                                                
           PERFORM 3500-WRITE-HEADER   THRU 3500-EXIT.                          
                                                                                
           PERFORM 2000-READ-BP13FD00  THRU 2000-EXIT.                          
           PERFORM 2500-READ-BM06F120  THRU 2500-EXIT.                          
                                                                                
           PERFORM 3000-PROCESS-DATA   THRU 3000-EXIT                           
              UNTIL FD00-NUM-SCH-ACCNT = HIGH-VALUES AND                        
                    F120-SCH-ACC-NO = HIGH-VALUES.                              
                                                                                
           PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT.                          
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
                                                                                
           OPEN INPUT  BP13FD00                                                 
                       BM06F120                                                 
                       BP13K800                                                 
                       BP13K820                                                 
                       BP13K060                                                 
                OUTPUT BP13FOUT.                                                
                                                                                
           IF WS-K060-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K060 : ' WS-K060-STATUS              
              MOVE WS-K060-STATUS                TO RETURN-CODE                 
              PERFORM  9000-CLOSE-ROUTINE      THRU 9000-EXIT                   
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K800 : ' WS-K800-STATUS              
              MOVE WS-K800-STATUS                TO RETURN-CODE                 
              PERFORM  9000-CLOSE-ROUTINE      THRU 9000-EXIT                   
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K820 : ' WS-K820-STATUS              
              MOVE WS-K820-STATUS                TO RETURN-CODE                 
              PERFORM  9000-CLOSE-ROUTINE      THRU 9000-EXIT                   
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13FD00.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13FD00                                                        
             AT END                                                             
                MOVE HIGH-VALUES         TO FD00-NUM-SCH-ACCNT                  
                GO                       TO 9000-CLOSE-ROUTINE                  
           END-READ.                                                            
                                                                                
           ADD 1                         TO WS-FD00-READ.                       
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2500-READ-BM06F120.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BM06F120                                                        
             AT END                                                             
                MOVE HIGH-VALUE          TO F120-SCH-ACC-NO                     
                GO                       TO 9000-CLOSE-ROUTINE                  
           END-READ.                                                            
                                                                                
           ADD 1                         TO WS-F120-READ.                       
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-PROCESS-DATA.                                                       
      *-------------------------------------------------------------            
                                                                                
           IF FD00-NUM-SCH-ACCNT = F120-SCH-ACC-NO                              
              MOVE SPACES                        TO WS-FOUT-REC                 
              INITIALIZE                            WS-FOUT-REC                 
                                                                                
              PERFORM 4000-READ-BP13K800       THRU 4000-EXIT                   
              PERFORM 4200-START-BP13K820      THRU 4200-EXIT                   
              PERFORM 4500-MOVE-BP13F120       THRU 4500-EXIT                   
              PERFORM 5000-WRITE-BP13FOUT      THRU 5000-EXIT                   
                                                                                
              PERFORM 2000-READ-BP13FD00       THRU 2000-EXIT                   
              PERFORM 2500-READ-BM06F120       THRU 2500-EXIT                   
                                                                                
           ELSE                                                                 
              IF FD00-NUM-SCH-ACCNT > F120-SCH-ACC-NO                           
                 ADD 1 TO WS-NOTFD-FD00                                         
                 PERFORM 2500-READ-BM06F120    THRU 2500-EXIT                   
              ELSE                                                              
                 ADD 1 TO WS-NOTFD-F120                                         
                 PERFORM 2000-READ-BP13FD00    THRU 2000-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3500-WRITE-HEADER.                                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE 'HOUSEHOLD INFORMATION OF DBSS APPLICANTS'                      
                                                 TO WS-TITLE-REC.               
           WRITE BP13FOUT-REC FROM WS-TITLE-REC.                                
           ADD 1                TO WS-FOUT-WRITE.                               
                                                                                
           INITIALIZE WS-HEAD-MAIN.                                             
           MOVE WS-HEAD-MAIN    TO BP13FOUT-REC.                                
           WRITE BP13FOUT-REC.                                                  
           ADD 1                TO WS-FOUT-WRITE.                               
                                                                                
           INITIALIZE WS-HEAD-SUB.                                              
           MOVE WS-HEAD-SUB     TO BP13FOUT-REC.                                
           WRITE BP13FOUT-REC.                                                  
           ADD 1                TO WS-FOUT-WRITE.                               
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4000-READ-BP13K800.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                           TO BP13K800-MASTER.            
           INITIALIZE                               BP13K800-MASTER.            
                                                                                
           MOVE FD00-NUM-REGN                    TO K800-NUM-REGN.              
                                                                                
           READ BP13K800.                                                       
                                                                                
           IF WS-K800-STATUS = 00                                               
              PERFORM 4100-MOVE-BP13K800       THRU 4100-EXIT                   
           ELSE                                                                 
              IF WS-K800-STATUS = 23                                            
                 DISPLAY 'RECORD NOT FOUND IN BP13K800, KEY: '                  
                         K800-NUM-REGN                                          
              ELSE                                                              
                 DISPLAY 'ERROR WITH READING BP13K800, STATUS '                 
                          WS-K800-STATUS                                        
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4100-MOVE-BP13K800.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE K800-NUM-ELIG-SCHEME           TO FOUT-NUM-ELIG-SCH.            
           MOVE K800-NUM-ALLO-SCHEME           TO FOUT-NUM-ALLO-SCH.            
           MOVE K800-NUM-FLAT-TYPE             TO FOUT-NUM-FLAT-TYPE.           
           MOVE K800-AMT-HSE-INCOME            TO FOUT-NUM-HH-INCOME.           
           MOVE K800-NUM-MORT-LOAN-POLICY      TO FOUT-NUM-LOAN-POLICY.         
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4200-START-BP13K820.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                           TO BP13K820-REC.               
           INITIALIZE                               BP13K820-REC.               
                                                                                
           MOVE FD00-NUM-REGN                    TO K820-NUM-REGN.              
           MOVE 'N'                              TO WS-K820-EOF.                
           MOVE ZEROES                           TO WS-AMT-INCOME.              
                                                                                
           START BP13K820 KEY >= K820-KEY-FLD.                                  
                                                                                
           IF WS-K820-STATUS = 00                                               
              PERFORM 4300-READNEXT-BP13K820   THRU 4300-EXIT                   
                UNTIL K820-NUM-REGN NOT = FD00-NUM-REGN                         
                   OR WS-K820-EOF = 'Y'                                         
           ELSE                                                                 
              IF WS-K820-STATUS = 23 OR 10                                      
                 MOVE 'Y'                        TO WS-K820-EOF                 
              ELSE                                                              
                 DISPLAY 'ERROR WITH READING BP13K820, STATUS '                 
                          WS-K820-STATUS                                        
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4300-READNEXT-BP13K820.                                                  
      *-------------------------------------------------------------            
                                                                                
           READ BP13K820 NEXT RECORD                                            
             AT END MOVE 'Y'  TO WS-K820-EOF                                    
           END-READ.                                                            
                                                                                
           IF WS-K820-STATUS = 00                                               
              IF K820-NUM-REGN = FD00-NUM-REGN                                  
                 IF K820-NUM-NRIC = K800-NUM-NRIC1                              
                    MOVE '1'                     TO WS-IC-CTR                   
                    PERFORM 4350-MOVE-BP13K820 THRU 4350-EXIT                   
                 END-IF                                                         
                 IF K820-NUM-NRIC = K800-NUM-NRIC2                              
                    MOVE '2'                     TO WS-IC-CTR                   
                    PERFORM 4350-MOVE-BP13K820 THRU 4350-EXIT                   
                 END-IF                                                         
                 IF K820-NUM-NRIC = K800-NUM-NRIC3                              
                    MOVE '3'                     TO WS-IC-CTR                   
                    PERFORM 4350-MOVE-BP13K820 THRU 4350-EXIT                   
                 END-IF                                                         
                 IF K820-NUM-NRIC = K800-NUM-NRIC4                              
                    MOVE '4'                     TO WS-IC-CTR                   
                    PERFORM 4350-MOVE-BP13K820 THRU 4350-EXIT                   
                 END-IF                                                         
              ELSE                                                              
                 MOVE 'Y'                        TO WS-K820-EOF                 
              END-IF                                                            
           ELSE                                                                 
              IF WS-K820-STATUS = 10 OR 23                                      
                 MOVE 'Y'                        TO WS-K820-EOF                 
              ELSE                                                              
                 DISPLAY 'ERROR READING NEXT - BP13K820 : '                     
                         WS-K820-STATUS                                         
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4350-MOVE-BP13K820.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE K820-NME-OCCP           TO FOUT-NME-OCCP(WS-IC-CTR).            
           MOVE K820-NUM-NRIC           TO FOUT-NUM-NRIC(WS-IC-CTR).            
           MOVE K820-NUM-NATIONALITY    TO FOUT-NUM-NTNLTY(WS-IC-CTR).          
           MOVE K820-DTE-BIRTH          TO FOUT-DTE-BIRTH(WS-IC-CTR).           
                                                                                
           MOVE SPACES                           TO K060-KEY-FLD.               
           MOVE 35                               TO K060-SERIAL-NO.             
           MOVE K820-NUM-RELATIONSHIP            TO K060-CODE.                  
           PERFORM 7000-READ-BP13K060          THRU 7000-EXIT.                  
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC            TO FOUT-NUM-RELATION(WS-IC-CTR)         
           END-IF.                                                              
                                                                                
           MOVE SPACES                           TO K060-KEY-FLD.               
           MOVE 42                               TO K060-SERIAL-NO.             
           MOVE K820-NUM-ETHNIC                  TO K060-CODE.                  
           PERFORM 7000-READ-BP13K060          THRU 7000-EXIT.                  
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC(1:1)       TO FOUT-NUM-ETHNIC(WS-IC-CTR)           
           END-IF.                                                              
                                                                                
           MOVE SPACES                           TO K060-KEY-FLD.               
           MOVE 43                               TO K060-SERIAL-NO.             
           MOVE K820-NUM-SEX                     TO K060-CODE.                  
           PERFORM 7000-READ-BP13K060          THRU 7000-EXIT.                  
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC(1:1)       TO FOUT-NUM-SEX(WS-IC-CTR)              
           END-IF.                                                              
                                                                                
           MOVE SPACES                           TO K060-KEY-FLD.               
           MOVE 44                               TO K060-SERIAL-NO.             
           MOVE K820-NUM-MARITAL-STATUS          TO K060-CODE.                  
           PERFORM 7000-READ-BP13K060          THRU 7000-EXIT.                  
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC(1:1)       TO FOUT-NUM-MS(WS-IC-CTR)               
           END-IF.                                                              
                                                                                
       4350-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4500-MOVE-BP13F120.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE F120-BLK-NO                      TO FOUT-NUM-BLK.               
           MOVE F120-LEVEL-NO                    TO FOUT-NUM-FLOOR.             
           STRING F120-MAIN-UNIT F120-SUB-UNIT                                  
              DELIMITED BY SIZE INTO FOUT-NUM-UNIT.                             
           MOVE F120-FLOOR-AREA                  TO FOUT-NUM-FLOOR-AREA.        
           MOVE F120-NUM-ORIG-AREA               TO FOUT-NUM-INTL-AREA.         
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5000-WRITE-BP13FOUT.                                                     
      *-------------------------------------------------------------            
                                                                                
           ADD 1                            TO WS-REC-SN.                       
                                                                                
           MOVE WS-REC-SN                   TO FOUT-NUM-SN.                     
           MOVE FD00-NUM-SCH-ACCNT          TO FOUT-NUM-SCH-ACC.                
           MOVE FD00-AMT-SELL-PRICE         TO FOUT-NUM-SELLING-PRICE.          
           MOVE FD00-AMT-LOAN-GRANTED       TO FOUT-NUM-MORTAGE-LOAN.           
           MOVE FD00-NUM-LOAN-REPYMT-PERIOD TO FOUT-NUM-REPYMT-PERIOD.          
           MOVE FD00-AMT-INSTAL             TO FOUT-NUM-MONTHLY-INSTAL.         
                                                                                
           IF FD00-AMT-INSTAL-CASH > ZEROES                                     
              IF FD00-AMT-INSTAL-CPF1 > ZEROES OR                               
                 FD00-AMT-INSTAL-CPF2 > ZEROES OR                               
                 FD00-AMT-INSTAL-CPF3 > ZEROES OR                               
                 FD00-AMT-INSTAL-CPF4 > ZEROES                                  
                 MOVE 'BOTH'                TO FOUT-CDE-MODE-REPAYMENT          
              ELSE                                                              
                 MOVE 'CASH'                TO FOUT-CDE-MODE-REPAYMENT          
              END-IF                                                            
           ELSE                                                                 
              MOVE 'CPF '                   TO FOUT-CDE-MODE-REPAYMENT          
           END-IF.                                                              
                                                                                
           WRITE BP13FOUT-REC FROM WS-FOUT-REC.                                 
           ADD 1                            TO WS-FOUT-WRITE.                   
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7000-READ-BP13K060.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13K060.                                                       
                                                                                
           IF WS-K060-STATUS = 00                                               
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-K060-STATUS = 23                                            
                 DISPLAY 'RECORD NOT FOUND IN BP13K060, KEY: '                  
                         K060-KEY-FLD ' ' K060-KEY-FLD                          
              ELSE                                                              
                 DISPLAY 'ERROR WITH READING BP13K060, STATUS : '               
                          WS-K060-STATUS ', KEY: ' K060-KEY-FLD                 
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
                                                                                
           DISPLAY ' BP13CD45 CONTROL TOTAL '.                                  
           DISPLAY '------------------------------------------'.                
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECS READ FROM BP13FD00  : ' WS-FD00-READ.            
           DISPLAY 'NO OF RECS NOTFD IN BM06F120   : ' WS-NOTFD-F120.           
           DISPLAY 'NO OF RECS NOTFD IN BM06FD00   : ' WS-NOTFD-FD00.           
           DISPLAY 'NO OF RECS WRITE TO  BP13FOUT  : ' WS-FOUT-WRITE.           
           DISPLAY 'NO OF RECS PROCEED             : ' WS-REC-SN.               
                                                                                
           CLOSE BP13FD00                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BM06F120                                                       
                 BP13K060                                                       
                 BP13FOUT.                                                      
                                                                                
           IF WS-K060-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K060 : ' WS-K060-STATUS              
              MOVE WS-K060-STATUS                TO RETURN-CODE                 
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR CLOSING - BP13K800 : ' WS-K800-STATUS              
              MOVE WS-K800-STATUS                TO RETURN-CODE                 
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT =  00 AND 97                                   
              DISPLAY 'ERROR CLOSING - BP13K820 : ' WS-K820-STATUS              
              MOVE WS-K820-STATUS                TO RETURN-CODE                 
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
