       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.         BP13C03A.                                            
      *AUTHOR.             ZARITA SARMIENTO.                                    
      *DATE-WRITTEN.       07 APR 2009.                                         
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (SOC)                                 *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE  :  TO READ BP13F757 (SORTED OUT BY ALLOC SCHEME*            
      *                OF 'P', OR 'C'    ) AND WRITE THE RECORD TO *            
      *                BP13K853                                    *            
      *                                                            *            
      *  INPUT FILE :  1. BP13F757, BP13K853                       *            
      *  OUTPUT FILE:  1. BP13F853                                 *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * BP133410 ZDD1 07042009 NEW PROGRAM                         *            
      * BP133410 ZDD1 13072009 TO CATER FOR 'M' ALLOC-SCHEME       *            
      * BP133936 PCL3 29072010 TO WRITE APPLICANT AND SPOUSE TO    *            
      *                        BP13K853.                           *            
      * BP134229 MRN1 20052011 CONVERT WRITING FROM VSAM TO SEQTL  *            
      *                        FROM BP13K853 TO BP13F853           *            
      * BP139280 EAA2 03112023 EXPAND BP13K757 FROM 3000 TO 4000   *            
      *                        INCLUDE OCCUPIER 6                  *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.   IBM-3090.                                             
       OBJECT-COMPUTER.   IBM-3090.                                             
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
            SELECT BP13F757 ASSIGN TO BP13F757                                  
                      FILE STATUS IS WS-BP13F757-STAT.                          
                                                                                
            SELECT BP13K853 ASSIGN TO BP13K853                                  
                      ORGANIZATION IS INDEXED                                   
                      RECORD KEY IS K853-KEY-FLD                                
                      FILE STATUS IS WS-BP13K853-STAT                           
                      ACCESS MODE IS RANDOM.                                    
                                                                                
            SELECT BP13F853 ASSIGN TO BP13F853.                                 
                                                                                
            SELECT BP13K825 ASSIGN TO BP13K825                                  
                      ORGANIZATION IS INDEXED                                   
                      RECORD KEY IS K825-KEY-FLD                                
                      FILE STATUS IS WS-BP13K825-STAT                           
                      ACCESS MODE IS RANDOM.                                    
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
       FD   BP13F757   RECORD CONTAINS 4000 CHARACTERS.                         
       COPY BP13K757.                                                           
                                                                                
       FD   BP13K853   RECORD CONTAINS 250  CHARACTERS.                         
       COPY BP13K853.                                                           
                                                                                
       FD   BP13F853                                                            
            BLOCK      CONTAINS 0   RECORDS                                     
            RECORD     CONTAINS 250 CHARACTERS                                  
            LABEL      RECORDS  ARE STANDARD                                    
            RECORDING  MODE     IS  F.                                          
       COPY BP13F853.                                                           
                                                                                
       FD   BP13K825   RECORD CONTAINS 200  CHARACTERS.                         
       COPY BP13K825.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01 WS-VARIABLES.                                                         
          05 WS-BP13K853-STAT            PIC X(02) VALUE SPACES.                
          05 WS-BP13K825-STAT            PIC X(02) VALUE SPACES.                
          05 WS-BP13F757-STAT            PIC X(02) VALUE SPACES.                
          05 EOF-FLAG-BP13F757           PIC X(01) VALUE 'N'.                   
          05 EOF-FLAG-BP13K853           PIC X(01) VALUE 'N'.                   
          05 WS-WRITE                    PIC X(01) VALUE 'N'.                   
          05 WS-K825-FOUND               PIC X(01) VALUE 'N'.                   
          05 WS-WRITE-APP-SP             PIC X(01) VALUE 'N'.                   
          05 WS-SUB                      PIC 9(01) VALUE ZERO.                  
          05 WS-NRIC                     PIC X(09) VALUE SPACES.                
          05 WS-K757-READ                PIC 9(06) VALUE ZEROES.                
          05 WS-K853-EXIST               PIC 9(06) VALUE ZEROES.                
          05 WS-K825-FND                 PIC 9(06) VALUE ZEROES.                
          05 WS-K825-NFND                PIC 9(06) VALUE ZEROES.                
          05 WS-K853-WRITTEN-PC          PIC 9(06) VALUE ZEROES.                
          05 WS-K853-WRITTEN-M           PIC 9(06) VALUE ZEROES.                
          05 WS-K853-WRITTEN             PIC 9(06) VALUE ZEROES.                
          05 WS-K853-WRITTEN-S           PIC 9(06) VALUE ZEROES.                
          05 WS-PROCESS-M                PIC 9(06) VALUE ZEROES.                
          05 WS-PROCESS-PC               PIC 9(06) VALUE ZEROES.                
                                                                                
       PROCEDURE DIVISION.                                                      
      ****************************                                              
       0000-MAIN-CONTROL.                                                       
      ****************************                                              
                                                                                
           PERFORM 1000-OPEN-FILES        THRU 1000-EXIT.                       
           PERFORM 2000-MAIN-PROCESS      THRU 2000-EXIT                        
                   UNTIL EOF-FLAG-BP13F757 = 'Y'.                               
           PERFORM 9999-CLOSE-FILES       THRU 9999-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       1000-OPEN-FILES.                                                         
      ****************************                                              
                                                                                
           OPEN INPUT   BP13F757                                                
                        BP13K825                                                
                        BP13K853                                                
                OUTPUT  BP13F853.                                               
                                                                                
           IF WS-BP13K853-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN OPENING BP13K853   STATUS - '                   
              WS-BP13K853-STAT                                                  
              MOVE WS-BP13K853-STAT             TO RETURN-CODE                  
              PERFORM 9999-CLOSE-FILES          THRU 9999-EXIT                  
           END-IF.                                                              
                                                                                
           IF WS-BP13K825-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN OPENING BP13K825   STATUS - '                   
              WS-BP13K825-STAT                                                  
              MOVE WS-BP13K825-STAT             TO RETURN-CODE                  
              PERFORM 9999-CLOSE-FILES          THRU 9999-EXIT                  
           END-IF.                                                              
                                                                                
           IF WS-BP13F757-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN OPENING BP13F757   STATUS - '                   
              WS-BP13F757-STAT                                                  
              MOVE WS-BP13F757-STAT             TO RETURN-CODE                  
              PERFORM 9999-CLOSE-FILES          THRU 9999-EXIT                  
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       2000-MAIN-PROCESS.                                                       
      ****************************                                              
                                                                                
           READ BP13F757 AT END                                                 
                MOVE 'Y' TO EOF-FLAG-BP13F757                                   
                GO TO 2000-EXIT.                                                
                                                                                
           ADD 1            TO WS-K757-READ.                                    
                                                                                
           MOVE SPACES      TO BP13K853-REC                                     
                               BP13K853-REC.                                    
           INITIALIZE          BP13K853-REC                                     
                               BP13F853-REC.                                    
                                                                                
           IF K757-NUM-SPEC-SCHEME =  'P' OR 'C'                                
             ADD 1 TO WS-PROCESS-PC                                             
             PERFORM 3000-PROCESS-NRIC     THRU 3000-EXIT                       
                 VARYING WS-SUB FROM 1 BY 1                                     
                   UNTIL WS-SUB > 2                                             
           ELSE                                                                 
             IF K757-NUM-SPEC-SCHEME = 'M'                                      
               ADD 1 TO WS-PROCESS-M                                            
               PERFORM 3500-PROCESS-HA2-OCCP  THRU 3500-EXIT                    
             END-IF                                                             
           END-IF.                                                              
                                                                                
           PERFORM 2100-CHECK-APPL-SP-NRIC    THRU 2100-EXIT.                   
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       2100-CHECK-APPL-SP-NRIC.                                                 
      ****************************                                              
                                                                                
           IF K757-NUM-APPLT1-UIN NOT = SPACES AND LOW-VALUES                   
              MOVE SPACES                      TO BP13K853-REC                  
                                                  BP13F853-REC                  
              INITIALIZE                          BP13K853-REC                  
                                                  BP13F853-REC                  
              MOVE K757-NUM-REGN               TO K853-NUM-REGN                 
              MOVE K757-NUM-APPLT1-UIN         TO K853-NUM-NRIC                 
              MOVE 'N'                         TO WS-WRITE                      
              MOVE 'Y'                         TO WS-WRITE-APP-SP               
              PERFORM 4000-READ-BP13K853     THRU 4000-EXIT                     
              MOVE 'N'                         TO WS-WRITE-APP-SP               
              IF WS-WRITE = 'Y'                                                 
                 MOVE K757-NUM-REGN            TO F853-NUM-REGN                 
                 MOVE K757-NUM-APPLT1-UIN      TO F853-NUM-NRIC                 
                 MOVE K757-NME-APPLT1          TO F853-NME-OCCP                 
                 MOVE K757-NUM-APPLT1-MARITAL-STATUS TO                         
                                                  F853-NUM-OCCP-MT              
                 PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                     
                 ADD 1                         TO WS-K853-WRITTEN               
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT2-UIN NOT = SPACES AND LOW-VALUES                   
              MOVE SPACES                      TO BP13K853-REC                  
                                                  BP13F853-REC                  
              INITIALIZE                          BP13K853-REC                  
                                                  BP13F853-REC                  
              MOVE K757-NUM-REGN               TO K853-NUM-REGN                 
              MOVE K757-NUM-APPLT2-UIN         TO K853-NUM-NRIC                 
              MOVE 'N'                         TO WS-WRITE                      
              MOVE 'Y'                         TO WS-WRITE-APP-SP               
              PERFORM 4000-READ-BP13K853     THRU 4000-EXIT                     
              MOVE 'N'                         TO WS-WRITE-APP-SP               
              IF WS-WRITE = 'Y'                                                 
                 MOVE K757-NUM-REGN            TO F853-NUM-REGN                 
                 MOVE K757-NUM-APPLT2-UIN      TO F853-NUM-NRIC                 
                 MOVE K757-NME-APPLT2          TO F853-NME-OCCP                 
                 MOVE K757-NUM-APPLT2-MARITAL-STATUS TO                         
                                                  F853-NUM-OCCP-MT              
                 PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                     
                 ADD 1                         TO WS-K853-WRITTEN               
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT3-UIN NOT = SPACES AND LOW-VALUES                   
              MOVE SPACES                      TO BP13K853-REC                  
                                                  BP13F853-REC                  
              INITIALIZE                          BP13K853-REC                  
                                                  BP13F853-REC                  
              MOVE K757-NUM-REGN               TO K853-NUM-REGN                 
              MOVE K757-NUM-APPLT3-UIN         TO K853-NUM-NRIC                 
              MOVE 'N'                         TO WS-WRITE                      
              MOVE 'Y'                         TO WS-WRITE-APP-SP               
              PERFORM 4000-READ-BP13K853     THRU 4000-EXIT                     
              MOVE 'N'                         TO WS-WRITE-APP-SP               
              IF WS-WRITE = 'Y'                                                 
                 MOVE K757-NUM-REGN            TO F853-NUM-REGN                 
                 MOVE K757-NUM-APPLT3-UIN      TO F853-NUM-NRIC                 
                 MOVE K757-NME-APPLT3          TO F853-NME-OCCP                 
                 MOVE K757-NUM-APPLT3-MARITAL-STATUS TO                         
                                                  F853-NUM-OCCP-MT              
                 PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                     
                 ADD 1                         TO WS-K853-WRITTEN               
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT4-UIN NOT = SPACES AND LOW-VALUES                   
              MOVE SPACES                      TO BP13K853-REC                  
                                                  BP13F853-REC                  
              INITIALIZE                          BP13K853-REC                  
                                                  BP13F853-REC                  
              MOVE K757-NUM-REGN               TO K853-NUM-REGN                 
              MOVE K757-NUM-APPLT4-UIN         TO K853-NUM-NRIC                 
              MOVE 'N'                         TO WS-WRITE                      
              MOVE 'Y'                         TO WS-WRITE-APP-SP               
              PERFORM 4000-READ-BP13K853     THRU 4000-EXIT                     
              MOVE 'N'                         TO WS-WRITE-APP-SP               
              IF WS-WRITE = 'Y'                                                 
                 MOVE K757-NUM-REGN            TO F853-NUM-REGN                 
                 MOVE K757-NUM-APPLT4-UIN      TO F853-NUM-NRIC                 
                 MOVE K757-NME-APPLT4          TO F853-NME-OCCP                 
                 MOVE K757-NUM-APPLT4-MARITAL-STATUS TO                         
                                                  F853-NUM-OCCP-MT              
                 PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                     
                 ADD 1                         TO WS-K853-WRITTEN               
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT1-SPOUSE-UIN NOT = SPACES AND LOW-VALUES            
              MOVE SPACES                           TO BP13K825-REC             
              INITIALIZE                               BP13K825-REC             
              MOVE K757-NUM-REGN                    TO K825-NUM-REGN            
              MOVE K757-NUM-APPLT1-SPOUSE-UIN       TO K825-NUM-NRIC            
              MOVE 'N'                              TO WS-K825-FOUND            
              PERFORM 2200-READ-BP13K825          THRU 2200-EXIT                
                                                                                
              IF WS-K825-FOUND = 'Y'                                            
                 MOVE SPACES                        TO BP13K853-REC             
                                                       BP13F853-REC             
                 INITIALIZE                            BP13K853-REC             
                                                       BP13F853-REC             
                 MOVE K757-NUM-REGN                 TO K853-NUM-REGN            
                 MOVE K757-NUM-APPLT1-SPOUSE-UIN    TO K853-NUM-NRIC            
                 MOVE 'N'                           TO WS-WRITE                 
                 MOVE 'Y'                           TO WS-WRITE-APP-SP          
                 PERFORM 4000-READ-BP13K853       THRU 4000-EXIT                
                 MOVE 'N'                           TO WS-WRITE-APP-SP          
                 IF WS-WRITE = 'Y'                                              
                    IF K757-NUM-APPLT1-SPOUSE-UIN =                             
                          K757-NUM-APPLT1-UIN                                   
                       OR K757-NUM-APPLT2-UIN                                   
                       OR K757-NUM-APPLT3-UIN                                   
                       OR K757-NUM-APPLT4-UIN                                   
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE K757-NUM-REGN              TO F853-NUM-REGN         
                       MOVE K757-NUM-APPLT1-SPOUSE-UIN TO F853-NUM-NRIC         
                       MOVE K825-NME-OCCP              TO F853-NME-OCCP         
                       MOVE K757-NUM-APPLT1-MARITAL-STATUS TO                   
                                                    F853-NUM-OCCP-MT            
                       PERFORM 6000-WRITE-BP13F853   THRU 6000-EXIT             
                       ADD 1                   TO WS-K853-WRITTEN-S             
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT2-SPOUSE-UIN NOT = SPACES AND LOW-VALUES            
              MOVE SPACES                           TO BP13K825-REC             
              INITIALIZE                               BP13K825-REC             
              MOVE K757-NUM-REGN                    TO K825-NUM-REGN            
              MOVE K757-NUM-APPLT2-SPOUSE-UIN       TO K825-NUM-NRIC            
              MOVE 'N'                              TO WS-K825-FOUND            
              PERFORM 2200-READ-BP13K825          THRU 2200-EXIT                
                                                                                
              IF WS-K825-FOUND = 'Y'                                            
                 MOVE SPACES                        TO BP13K853-REC             
                                                       BP13F853-REC             
                 INITIALIZE                            BP13K853-REC             
                                                       BP13F853-REC             
                 MOVE K757-NUM-REGN                 TO K853-NUM-REGN            
                 MOVE K757-NUM-APPLT2-SPOUSE-UIN    TO K853-NUM-NRIC            
                 MOVE 'N'                           TO WS-WRITE                 
                 MOVE 'Y'                           TO WS-WRITE-APP-SP          
                 PERFORM 4000-READ-BP13K853       THRU 4000-EXIT                
                 MOVE 'N'                           TO WS-WRITE-APP-SP          
                                                                                
                 IF WS-WRITE = 'Y'                                              
                    IF K757-NUM-APPLT2-SPOUSE-UIN =                             
                          K757-NUM-APPLT1-UIN                                   
                       OR K757-NUM-APPLT2-UIN                                   
                       OR K757-NUM-APPLT3-UIN                                   
                       OR K757-NUM-APPLT4-UIN                                   
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE K757-NUM-REGN              TO F853-NUM-REGN         
                       MOVE K757-NUM-APPLT2-SPOUSE-UIN TO F853-NUM-NRIC         
                       MOVE K825-NME-OCCP              TO F853-NME-OCCP         
                       MOVE K757-NUM-APPLT2-MARITAL-STATUS TO                   
                                                    F853-NUM-OCCP-MT            
                       PERFORM 6000-WRITE-BP13F853   THRU 6000-EXIT             
                       ADD 1                     TO WS-K853-WRITTEN-S           
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT3-SPOUSE-UIN NOT = SPACES AND LOW-VALUES            
              MOVE SPACES                           TO BP13K825-REC             
              INITIALIZE                               BP13K825-REC             
              MOVE K757-NUM-REGN                    TO K825-NUM-REGN            
              MOVE K757-NUM-APPLT3-SPOUSE-UIN       TO K825-NUM-NRIC            
              MOVE 'N'                              TO WS-K825-FOUND            
              PERFORM 2200-READ-BP13K825          THRU 2200-EXIT                
                                                                                
              IF WS-K825-FOUND = 'Y'                                            
                 MOVE SPACES                        TO BP13K853-REC             
                                                       BP13F853-REC             
                 INITIALIZE                            BP13K853-REC             
                                                       BP13F853-REC             
                 MOVE K757-NUM-REGN                 TO K853-NUM-REGN            
                 MOVE K757-NUM-APPLT3-SPOUSE-UIN    TO K853-NUM-NRIC            
                 MOVE 'N'                           TO WS-WRITE                 
                 MOVE 'Y'                           TO WS-WRITE-APP-SP          
                 PERFORM 4000-READ-BP13K853       THRU 4000-EXIT                
                 MOVE 'N'                           TO WS-WRITE-APP-SP          
                                                                                
                 IF WS-WRITE = 'Y'                                              
                    IF K757-NUM-APPLT3-SPOUSE-UIN =                             
                          K757-NUM-APPLT1-UIN                                   
                       OR K757-NUM-APPLT2-UIN                                   
                       OR K757-NUM-APPLT3-UIN                                   
                       OR K757-NUM-APPLT4-UIN                                   
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE K757-NUM-REGN              TO F853-NUM-REGN         
                       MOVE K757-NUM-APPLT3-SPOUSE-UIN TO F853-NUM-NRIC         
                       MOVE K825-NME-OCCP              TO F853-NME-OCCP         
                       MOVE K757-NUM-APPLT3-MARITAL-STATUS TO                   
                                                    F853-NUM-OCCP-MT            
                       PERFORM 6000-WRITE-BP13F853   THRU 6000-EXIT             
                       ADD 1                    TO WS-K853-WRITTEN-S            
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT4-SPOUSE-UIN NOT = SPACES AND LOW-VALUES            
              MOVE SPACES                           TO BP13K825-REC             
              INITIALIZE                               BP13K825-REC             
              MOVE K757-NUM-REGN                    TO K825-NUM-REGN            
              MOVE K757-NUM-APPLT4-SPOUSE-UIN       TO K825-NUM-NRIC            
              MOVE 'N'                              TO WS-K825-FOUND            
              PERFORM 2200-READ-BP13K825          THRU 2200-EXIT                
                                                                                
              IF WS-K825-FOUND = 'Y'                                            
                 MOVE SPACES                        TO BP13K853-REC             
                                                       BP13F853-REC             
                 INITIALIZE                            BP13K853-REC             
                                                       BP13F853-REC             
                 MOVE K757-NUM-REGN                 TO K853-NUM-REGN            
                 MOVE K757-NUM-APPLT4-SPOUSE-UIN    TO K853-NUM-NRIC            
                 MOVE 'N'                           TO WS-WRITE                 
                 MOVE 'Y'                           TO WS-WRITE-APP-SP          
                 PERFORM 4000-READ-BP13K853       THRU 4000-EXIT                
                 MOVE 'N'                           TO WS-WRITE-APP-SP          
                                                                                
                 IF WS-WRITE = 'Y'                                              
                    IF K757-NUM-APPLT4-SPOUSE-UIN =                             
                          K757-NUM-APPLT1-UIN                                   
                       OR K757-NUM-APPLT2-UIN                                   
                       OR K757-NUM-APPLT3-UIN                                   
                       OR K757-NUM-APPLT4-UIN                                   
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE K757-NUM-REGN              TO F853-NUM-REGN         
                       MOVE K757-NUM-APPLT4-SPOUSE-UIN TO F853-NUM-NRIC         
                       MOVE K825-NME-OCCP              TO F853-NME-OCCP         
                       MOVE K757-NUM-APPLT4-MARITAL-STATUS TO                   
                                                       F853-NUM-OCCP-MT         
                       PERFORM 6000-WRITE-BP13F853   THRU 6000-EXIT             
                       ADD 1                      TO WS-K853-WRITTEN-S          
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       2200-READ-BP13K825.                                                      
      ****************************                                              
                                                                                
           READ BP13K825.                                                       
                                                                                
           EVALUATE WS-BP13K825-STAT                                            
               WHEN 00                                                          
               WHEN 02                                                          
                    ADD 1                             TO WS-K825-FND            
                    MOVE 'Y'                          TO WS-K825-FOUND          
               WHEN 23                                                          
                    ADD 1                             TO WS-K825-NFND           
                                                                                
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K825 :' WS-BP13K825-STAT         
                            ' KEY : ' K825-KEY-FLD                              
                    MOVE WS-BP13K825-STAT             TO RETURN-CODE            
                    PERFORM 9999-CLOSE-FILES        THRU 9999-EXIT              
           END-EVALUATE.                                                        
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       3000-PROCESS-NRIC.                                                       
      ****************************                                              
                                                                                
           MOVE SPACES                    TO BP13K853-REC                       
                                             BP13F853-REC.                      
           MOVE SPACES                    TO WS-NRIC.                           
                                                                                
           IF WS-SUB = 1                                                        
             MOVE K757-NUM-REGN           TO K853-NUM-REGN                      
                                             F853-NUM-REGN                      
             MOVE K757-NUM-PRSN1-UIN      TO WS-NRIC                            
           ELSE                                                                 
             IF WS-SUB = 2                                                      
                 MOVE K757-NUM-REGN       TO K853-NUM-REGN                      
                                             F853-NUM-REGN                      
                 MOVE K757-NUM-PRSN2-UIN  TO WS-NRIC                            
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF WS-NRIC NOT      = SPACES AND LOW-VALUES                          
             MOVE WS-NRIC                 TO K853-NUM-NRIC                      
                                             F853-NUM-NRIC                      
             PERFORM 4000-READ-BP13K853 THRU 4000-EXIT                          
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       3500-PROCESS-HA2-OCCP.                                                   
      ****************************                                              
                                                                                
           IF K757-NUM-APPLT2-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-APPLT2-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-APPLT2-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-APPLT2-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-APPLT2        TO F853-NME-OCCP                  
                  MOVE K757-NUM-APPLT2-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT3-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-APPLT3-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-APPLT3-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-APPLT3-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-APPLT3        TO F853-NME-OCCP                  
                  MOVE K757-NUM-APPLT3-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-APPLT4-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-APPLT4-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-APPLT4-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-APPLT4-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-APPLT4        TO F853-NME-OCCP                  
                  MOVE K757-NUM-APPLT4-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP1-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP1-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP1-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP1-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP1        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP1-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP2-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP2-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP2-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP2-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP2        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP2-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP3-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP3-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP3-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP3-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP3        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP3-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP4-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP4-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP4-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP4-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP4        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP4-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP5-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP5-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP5-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP5-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP5        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP5-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
           IF K757-NUM-OCCUP6-UIN NOT = SPACES AND LOW-VALUES                   
             IF K757-NUM-OCCUP6-RLTNSP-APPLT1 = '12' OR '02' OR '22' OR         
                                                '32' OR '19' OR '38'            
                MOVE SPACES                   TO BP13K853-REC                   
                                                 BP13F853-REC                   
                MOVE K757-NUM-REGN            TO K853-NUM-REGN                  
                MOVE K757-NUM-OCCUP6-UIN      TO K853-NUM-NRIC                  
                MOVE 'N'                      TO WS-WRITE                       
                PERFORM 4000-READ-BP13K853    THRU 4000-EXIT                    
                IF WS-WRITE = 'Y'                                               
                  MOVE K757-NUM-REGN          TO F853-NUM-REGN                  
                  MOVE K757-NUM-OCCUP6-UIN    TO F853-NUM-NRIC                  
                  MOVE K757-NME-OCCUP6        TO F853-NME-OCCP                  
                  MOVE K757-NUM-OCCUP6-MARITAL-STATUS TO                        
                                                 F853-NUM-OCCP-MT               
                  PERFORM 6000-WRITE-BP13F853 THRU 6000-EXIT                    
                  ADD 1                       TO WS-K853-WRITTEN-M              
                END-IF                                                          
             END-IF                                                             
           END-IF.                                                              
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       4000-READ-BP13K853.                                                      
      ****************************                                              
                                                                                
           READ BP13K853.                                                       
                                                                                
           EVALUATE WS-BP13K853-STAT                                            
             WHEN 00                                                            
             WHEN 02                                                            
                 ADD 1           TO WS-K853-EXIST                               
                 MOVE 'N'        TO WS-WRITE                                    
             WHEN 23                                                            
               IF WS-WRITE-APP-SP  = 'Y'                                        
                  MOVE 'Y'       TO WS-WRITE                                    
               ELSE                                                             
                  IF K757-NUM-SPEC-SCHEME =  'P' OR 'C'                         
                     PERFORM 5000-PROCESS-RECORDS  THRU 5000-EXIT               
                     ADD 1       TO WS-K853-WRITTEN-PC                          
                  ELSE                                                          
                     IF K757-NUM-SPEC-SCHEME =  'M'                             
                        MOVE 'Y' TO WS-WRITE                                    
                     END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP13K853..' WS-BP13K853-STAT           
                  PERFORM 9999-CLOSE-FILES          THRU 9999-EXIT              
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       5000-PROCESS-RECORDS.                                                    
      ****************************                                              
                                                                                
           IF WS-SUB = 1                                                        
               MOVE K757-NME-PRSN1          TO F853-NME-OCCP                    
               MOVE K757-NUM-PRSN1-UIN      TO F853-NUM-NRIC                    
      *        MOVE K757-NUM-PRSN1-RLTNSP   TO F853-NUM-RELATIONSHIP            
               MOVE K757-NUM-PRSN1-MARSTAT  TO F853-NUM-OCCP-MT                 
           ELSE                                                                 
              IF WS-SUB = 2                                                     
               MOVE K757-NME-PRSN2          TO F853-NME-OCCP                    
               MOVE K757-NUM-PRSN2-UIN      TO F853-NUM-NRIC                    
      *        MOVE K757-NUM-PRSN2-RLTNSP   TO F853-NUM-RELATIONSHIP            
               MOVE K757-NUM-PRSN2-MARSTAT  TO F853-NUM-OCCP-MT                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
           PERFORM 6000-WRITE-BP13F853   THRU 6000-EXIT.                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       6000-WRITE-BP13F853.                                                     
      ****************************                                              
                                                                                
           MOVE K757-NUM-ESTATE-ZONE     TO  F853-NUM-NEW-TOWN.                 
           MOVE K757-NUM-FLAT-TYPE       TO  F853-NUM-FLAT-TYPE.                
           MOVE K757-DTE-BALLOT          TO  F853-DTE-BALLOT.                   
           MOVE FUNCTION CURRENT-DATE    TO  F853-DTE-UPDATE.                   
           MOVE 'BP13C03A'               TO  F853-NUM-USERID.                   
                                                                                
           WRITE BP13F853-REC.                                                  
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ****************************                                              
       9999-CLOSE-FILES.                                                        
      ****************************                                              
                                                                                
           DISPLAY '9999-CLOSE-FILES'.                                          
           DISPLAY SPACES.                                                      
           DISPLAY 'REPORT DESCRIPTION'.                                        
           DISPLAY '------------------'.                                        
           DISPLAY SPACES.                                                      
           DISPLAY 'NO BP13F757 READ          :' WS-K757-READ.                  
           DISPLAY 'NO BP13F757 P/C CASES     :' WS-PROCESS-PC.                 
           DISPLAY 'NO BP13F757 M   CASES     :' WS-PROCESS-M.                  
           DISPLAY 'NO BP13K853 REC EXIST     :' WS-K853-EXIST.                 
           DISPLAY 'NO BP13K825 REC FOUND     :' WS-K825-FND.                   
           DISPLAY 'NO BP13K825 REC NOT FOUND :' WS-K825-NFND.                  
           DISPLAY 'NO BP13K853 WRITTEN-PC    :' WS-K853-WRITTEN-PC.            
           DISPLAY 'NO BP13K853 WRITTEN-M     :' WS-K853-WRITTEN-M.             
           DISPLAY 'NO BP13K853 WRITTEN       :' WS-K853-WRITTEN.               
           DISPLAY 'NO BP13K853 WRITTEN-S     :' WS-K853-WRITTEN-S.             
           DISPLAY ' '.                                                         
           CLOSE BP13K853                                                       
                 BP13K825                                                       
                 BP13F853                                                       
                 BP13F757.                                                      
                                                                                
           IF WS-BP13K853-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN CLOSING BP13K853   STATUS - '                   
              WS-BP13K853-STAT                                                  
              MOVE WS-BP13K853-STAT             TO RETURN-CODE                  
           END-IF.                                                              
                                                                                
           IF WS-BP13K825-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN CLOSING BP13K825   STATUS - '                   
              WS-BP13K825-STAT                                                  
              MOVE WS-BP13K825-STAT             TO RETURN-CODE                  
           END-IF.                                                              
                                                                                
           IF WS-BP13F757-STAT  NOT = '00' AND '97'                             
              DISPLAY 'ERROR IN CLOSING BP13F757   STATUS - '                   
              WS-BP13F757-STAT                                                  
              MOVE WS-BP13F757-STAT             TO RETURN-CODE                  
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
       9999-EXIT.                                                               
           EXIT.                                                                
