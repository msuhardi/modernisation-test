       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CF5A.                                                 
       AUTHOR.        IMC1.                                                     
       DATE-WRITTEN.  09/05/2012.                                               
      * ====================================================== *                
      *                                                        *                
      *    SYSTEM NAME : SOC                                   *                
      *    SYSTEM ID   : BP13                                  *                
      *    OBJECTIVE   : FOR SILVER HOUSING BONUS (SBF)        *                
      *                : TO COMPUTE APPLICANT'S PROFILE, UNIT  *                
      *                : INFORMATION, LECS INFORMATIO, EMAIL   *                
      *                : ADDRESS                               *                
      *                                                        *                
      *    INPUT FILES : BP13F800                              *                
      *                : BP13K820                              *                
      *                : BP13K830                              *                
      *                : BP13K857                              *                
      *                : BP13K895                              *                
      *                                                        *                
      *    OUTPUT      : P13F800A (REPORT)                     *                
      *                                                        *                
      *--------------------------------------------------------*                
      * CHG-NO    BY     DATE      DESCRIPTION                 *                
      * ------    --     ----      -----------                 *                
      * BP134526  IMC   20120508   NEW PGM                     *                
      * BP136164  FNP   20160413   DTE ACCEPTANCE, SALE-AGMT,  *                
      *                            SO-APPT, PACD QTR, KEY-AVAIL*                
      * ====================================================== *                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F800 ASSIGN       TO BP13F800.                            
                                                                                
           SELECT BP13K895 ASSIGN       TO BP13K895                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS DYNAMIC                              
                           RECORD KEY   IS K895-KEY-FLD                         
                           FILE STATUS  IS K895-STATUS.                         
                                                                                
           SELECT BP13K820 ASSIGN       TO BP13K820                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K820-KEY-FLD                         
                           FILE STATUS  IS K820-STATUS.                         
                                                                                
           SELECT BP13K857 ASSIGN       TO BP13K857                             
                           ACCESS MODE  IS RANDOM                               
                           ORGANIZATION IS INDEXED                              
                           RECORD KEY   IS K857-KEY-FLD                         
                           FILE STATUS  IS K857-STATUS.                         
                                                                                
           SELECT BP13K830  ASSIGN       TO BP13K830                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K830-KEY-FLD                        
                            ALTERNATE RECORD KEY IS  K830-NUM-REGN              
                            FILE STATUS  IS K830-STATUS.                        
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            ACCESS MODE   IS RANDOM                             
                            FILE STATUS   IS K110-STATUS.                       
                                                                                
           SELECT BM06K100  ASSIGN        TO BM06K100                           
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K100-KEY-FLD                       
                            ACCESS MODE   IS RANDOM                             
                            FILE STATUS   IS K100-STATUS.                       
                                                                                
           SELECT P13F800A ASSIGN       TO P13F800A.                            
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13K895                                                             
           RECORD CONTAINS 450 CHARACTERS.                                      
       COPY BP13K895.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD  BP13F800                                                             
           RECORD CONTAINS 2000 CHARACTERS                                      
           RECORDING MODE IS F.                                                 
       COPY BP13F800.                                                           
                                                                                
       FD   BP13K857                                                            
            RECORD CONTAINS  200 CHARACTERS.                                    
       COPY BP13K857.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K100.                                                           
                                                                                
       FD  P13F800A                                                             
           RECORD CONTAINS 800 CHARACTERS                                       
           RECORDING MODE IS F.                                                 
       01  P13F800A-REC.                                                        
            05 F800A-SN                  PIC 9(5).                              
            05 FILLER1                   PIC X(1).                              
            05 F800A-NUM-REGNO           PIC X(8).                              
            05 FILLER2                   PIC X(1).                              
            05 F800A-NUM-SCH-ACC         PIC X(11).                             
            05 FILLER3                   PIC X(1).                              
            05 F800A-NUM-NRIC1           PIC X(9).                              
            05 FILLER4                   PIC X(1).                              
            05 F800A-NME-OCCP1           PIC X(66).                             
            05 FILLER5                   PIC X(1).                              
            05 F800A-DTE-BIRTH1          PIC X(8).                              
            05 FILLER6                   PIC X(1).                              
            05 F800A-AGE1                PIC 9(3).                              
            05 FILLER7                   PIC X(1).                              
            05 F800A-NUM-ETHNIC1         PIC X(1).                              
            05 FILLER8                   PIC X(1).                              
            05 F800A-NUM-HP-PGR1         PIC X(9).                              
            05 FILLER9                   PIC X(1).                              
            05 F800A-NUM-PHONE1          PIC X(9).                              
            05 FILLER10                  PIC X(1).                              
            05 F800A-NUM-NRIC2           PIC X(9).                              
            05 FILLER11                  PIC X(1).                              
            05 F800A-NME-OCCP2           PIC X(66).                             
            05 FILLER12                  PIC X(1).                              
            05 F800A-DTE-BIRTH2          PIC X(8).                              
            05 FILLER13                  PIC X(1).                              
            05 F800A-AGE2                PIC 9(3).                              
            05 FILLER14                  PIC X(1).                              
            05 F800A-NUM-ETHNIC2         PIC X(1).                              
            05 FILLER15                  PIC X(1).                              
            05 F800A-NUM-HP-PGR2         PIC X(9).                              
            05 FILLER16                  PIC X(1).                              
            05 F800A-NUM-PHONE2          PIC X(9).                              
            05 FILLER17                  PIC X(1).                              
            05 F800A-NUM-NRIC3           PIC X(9).                              
            05 FILLER18                  PIC X(1).                              
            05 F800A-NME-OCCP3           PIC X(66).                             
            05 FILLER19                  PIC X(1).                              
            05 F800A-DTE-BIRTH3          PIC X(8).                              
            05 FILLER20                  PIC X(1).                              
            05 F800A-AGE3                PIC 9(3).                              
            05 FILLER21                  PIC X(1).                              
            05 F800A-NUM-ETHNIC3         PIC X(1).                              
            05 FILLER22                  PIC X(1).                              
            05 F800A-NUM-HP-PGR3         PIC X(9).                              
            05 FILLER23                  PIC X(1).                              
            05 F800A-NUM-PHONE3          PIC X(9).                              
            05 FILLER24                  PIC X(1).                              
            05 F800A-NUM-NRIC4           PIC X(9).                              
            05 FILLER25                  PIC X(1).                              
            05 F800A-NME-OCCP4           PIC X(66).                             
            05 FILLER26                  PIC X(1).                              
            05 F800A-DTE-BIRTH4          PIC X(8).                              
            05 FILLER27                  PIC X(1).                              
            05 F800A-AGE4                PIC 9(3).                              
            05 FILLER28                  PIC X(1).                              
            05 F800A-NUM-ETHNIC4         PIC X(1).                              
            05 FILLER29                  PIC X(1).                              
            05 F800A-NUM-HP-PGR4         PIC X(9).                              
            05 FILLER30                  PIC X(1).                              
            05 F800A-NUM-PHONE4          PIC X(9).                              
            05 FILLER31                  PIC X(1).                              
            05 F800A-DTE-BALLOT          PIC X(6).                              
            05 FILLER32                  PIC X(1).                              
            05 F800A-DTE-BK-APPT         PIC X(8).                              
            05 FILLER33                  PIC X(1).                              
            05 F800A-NUM-NT-FT-QUEUE     PIC X(5).                              
            05 FILLER34                  PIC X(1).                              
            05 F800A-NUM-HOUSEHOLD       PIC X(1).                              
            05 FILLER35                  PIC X(1).                              
            05 F800A-NUM-NEW-TOWN        PIC X(3).                              
            05 FILLER36                  PIC X(1).                              
            05 F800A-NUM-IDP-SCHEME      PIC X(3).                              
            05 FILLER37                  PIC X(1).                              
            05 F800A-NUM-ALLO-SCHEME     PIC X(3).                              
            05 FILLER38                  PIC X(1).                              
            05 F800A-NUM-FLAT-TYPE.                                             
              10  F800A-NUM-ROOM         PIC X(1).                              
              10  F800A-NUM-ROOM-TYPE    PIC X(1).                              
            05 FILLER39                  PIC X(1).                              
            05 F800A-AMT-HSE-INCOME      PIC 9(5).                              
            05 FILLER40                  PIC X(1).                              
            05 F800A-NUM-SMS-STATUS      PIC X(1).                              
            05 FILLER41                  PIC X(1).                              
            05 F800A-NUM-SMS-FT          PIC X(2).                              
            05 FILLER42                  PIC X(1).                              
            05 F800A-NUM-RSL-STATUS      PIC X(1).                              
            05 FILLER43                  PIC X(1).                              
            05 F800A-NUM-RSL-FT          PIC X(2).                              
            05 FILLER44                  PIC X(1).                              
            05 F800A-NUM-EMAIL           PIC X(50).                             
            05 FILLER45                  PIC X(1).                              
            05 F800A-NUM-MAIL-ADDR.                                             
               10  F800A-NUM-MAIL-ADDR-TYPE    PIC X(1).                        
               10  F800A-NUM-MAIL-BLK.                                          
                   15 F800A-NUM-MAIL-BLK-HDR   PIC X(4).                        
                   15 F800A-NUM-MAIL-MAIN-BLK  PIC X(4).                        
                   15 F800A-NUM-MAIL-BLK-DASH  PIC X(1).                        
                   15 F800A-NUM-MAIL-SUB-BLK   PIC X(1).                        
                   15 FILLER                   PIC X(6).                        
               10  F800A-NUM-MAIL-FLAT.                                         
                   15 F800A-NUM-MAIL-HSELVL.                                    
                      20 F800A-NUM-MAIL-LVL-CHAR PIC X(1).                      
                      20 F800A-NUM-MAIL-LVL-NUM PIC X(2).                       
                      20 F800A-NUM-MAIL-LVL-DASH PIC X(1).                      
                   15 F800A-NUM-MAIL-HSEMAIN    PIC X(4).                       
                   15 F800A-NUM-MAIL-HSESUB     PIC X(3).                       
               10  F800A-NME-MAIL-STR-BLDG.                                     
                   15  F800A-NME-MAIL-STREET    PIC X(32).                      
                   15  F800A-NME-MAIL-BLDG      PIC X(33).                      
               10  F800A-NUM-MAIL-POSTAL        PIC X(6).                       
            05 FILLER46                  PIC X(1).                              
            05 F800A-DTE-ACCEPTANCE      PIC X(8).                              
            05 FILLER47                  PIC X(1).                              
            05 F800A-DTE-SALE-AGMT       PIC X(8).                              
            05 FILLER48                  PIC X(1).                              
            05 F800A-DTE-SO-APPT         PIC X(8).                              
            05 FILLER49                  PIC X(1).                              
            05 F800A-DTE-PACD-QTR        PIC X(6).                              
            05 FILLER50                  PIC X(1).                              
            05 F800A-DTE-KEY-AVAIL       PIC X(8).                              
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-CURR-DATE                   PIC X(8)  VALUE SPACES.               
                                                                                
       01  K895-STATUS                    PIC 9(2)  VALUE ZERO.                 
       01  K857-STATUS                    PIC 9(2)  VALUE ZERO.                 
       01  K820-STATUS                    PIC 9(2)  VALUE ZERO.                 
       01  K830-STATUS                    PIC 9(2)  VALUE ZERO.                 
       01  K100-STATUS                    PIC 9(2)  VALUE ZERO.                 
       01  K110-STATUS                    PIC 9(2)  VALUE ZERO.                 
                                                                                
       01  WS-F800-READ                   PIC 9(5)  VALUE ZERO.                 
       01  WS-K895-READ                   PIC 9(5)  VALUE ZERO.                 
       01  WS-K820-READ                   PIC 9(5)  VALUE ZERO.                 
       01  WS-K100-READ                   PIC 9(5)  VALUE ZERO.                 
       01  WS-K110-READ                   PIC 9(5)  VALUE ZERO.                 
       01  WS-BYPASS                      PIC 9(5)  VALUE ZERO.                 
       01  WS-NOTFND                      PIC 9(5)  VALUE ZERO.                 
       01  WS-SMS-GT-FT                   PIC 9(5)  VALUE ZERO.                 
       01  WS-SMS-LTE-FT                  PIC 9(5)  VALUE ZERO.                 
       01  WS-RSL-GT-FT                   PIC 9(5)  VALUE ZERO.                 
       01  WS-RSL-LTE-FT                  PIC 9(5)  VALUE ZERO.                 
       01  WS-NO-SMS-RSL                  PIC 9(5)  VALUE ZERO.                 
       01  WS-F800A-WRITE                 PIC 9(5)  VALUE ZERO.                 
       01  WS-CNT                         PIC 9(1)  VALUE ZERO.                 
       01  WS-SN                          PIC 9(5)  VALUE ZERO.                 
       01  WS-NRIC-CNT                    PIC 9(1)  VALUE ZERO.                 
       01  WS-NUM-SMS-FT                  PIC 9(2)  VALUE ZERO.                 
       01  WS-NUM-RSL-FT                  PIC 9(3)  VALUE ZERO.                 
                                                                                
       01 WS-AGEX                 PIC 9(6)  VALUE ZEROES.                       
       01 WS-NUM-AGE  REDEFINES WS-AGEX.                                        
          05 WS-APPLN-AGEX        PIC 9(4).                                     
          05 WS-NUM-REMNGX        PIC 9(2).                                     
                                                                                
       01 WS-REGN-DATE            PIC X(8)  VALUE ZEROES.                       
       01 WS-NUM-REGN-DATE  REDEFINES WS-REGN-DATE.                             
          05 WS-REGN-CCYYMM       PIC 9(6).                                     
          05 WS-REGN-DD           PIC 9(2).                                     
       01 WS-BIRTH-DATE.                                                        
          05 WS-BIRTH-CCYYMM      PIC 9(6).                                     
          05 WS-BIRTH-DD          PIC 9(2).                                     
                                                                                
       01 WS-WORK-VARIABLES.                                                    
          03 WS-NRIC-AGE             PIC X(432)  VALUE ZEROES.                  
          03 WS-NRIC-AGE-RED   REDEFINES WS-NRIC-AGE  OCCURS 4.                 
             05 WS-NRIC              PIC X(9).                                  
             05 WS-AGE               PIC 9(6).                                  
             05 WS-NUM-AGE-RED  REDEFINES WS-AGE.                               
                07 WS-APPLN-AGE      PIC 9(4).                                  
                07 WS-NUM-REMNG      PIC 9(2).                                  
             05 WS-NME-OCCP          PIC X(66).                                 
             05 WS-DTE-BIRTH         PIC X(8).                                  
             05 WS-NUM-ETHNIC        PIC X(1).                                  
             05 WS-NUM-HP-PGR        PIC X(9).                                  
             05 WS-NUM-PHONE         PIC X(9).                                  
                                                                                
          03 WS-NUM-ROOM             PIC X(2)  VALUE ZEROES.                    
          03 WS-NUM-ROOM-RED   REDEFINES WS-NUM-ROOM.                           
             05 WS-NUM-ROOM-N        PIC 9(1).                                  
             05 FILLER               PIC 9(1).                                  
                                                                                
                                                                                
       01  WS-K820-FND                    PIC X     VALUE 'N'.                  
       01  WS-K895-EOF                    PIC X     VALUE 'N'.                  
                                                                                
       01  WS-EOF-F800                    PIC X     VALUE SPACE.                
           88 EOF-F800                    VALUE 'Y'.                            
                                                                                
       01  WS-EOF-K820                    PIC X     VALUE SPACE.                
           88 EOF-K820                    VALUE 'Y'.                            
                                                                                
       01  P13F800A-HEADER.                                                     
            05 FILLER                    PIC X(5) VALUE 'S/N '.                 
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'REGNO'.                
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(11) VALUE 'SCH-ADD'.             
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'NRIC1  '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(66) VALUE 'NAME1  '.             
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'BIRTH1 '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'AGE'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'E'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'HP NUM'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'PHONE NUM'.            
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'NRIC2  '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(66) VALUE 'NAME2  '.             
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'BIRTH2 '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'AGE'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'E'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'HP NUM'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'PHONE NUM'.            
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'NRIC3  '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(66) VALUE 'NAME3  '.             
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'BIRTH3 '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'AGE'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'E'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'HP NUM'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'PHONE NUM'.            
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'NRIC4  '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(66) VALUE 'NAME4  '.             
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'BIRTH4 '.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'AGE'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'E'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'HP NUM'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(9) VALUE 'PHONE NUM'.            
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(6) VALUE 'BALLOT'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(8) VALUE 'BK APPT'.              
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(5) VALUE 'NT-FT'.                
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'H'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'NT'.                   
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'IDP'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(3) VALUE 'SCH'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(2) VALUE 'FT'.                   
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(5) VALUE 'INC'.                  
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'S'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(2) VALUE 'FT'.                   
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(1) VALUE 'R'.                    
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(2) VALUE 'FT'.                   
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(50) VALUE 'EMAIL'.               
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(50) VALUE 'ADDR'.                
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(10) VALUE 'DTE ACCEPT'.          
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(11) VALUE 'DTE SL AGMT'.         
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(10) VALUE 'DTE SO APT'.          
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(08) VALUE 'DTE PACD'.            
            05 FILLER                    PIC X(1) VALUE ';'.                    
            05 FILLER                    PIC X(11) VALUE 'DTE KEY AVL'.         
                                                                                
       PROCEDURE DIVISION.                                                      
      *---------------------------------------------------------------*         
       0000-CONTROL.                                                            
      *---------------------------------------------------------------*         
           PERFORM 1000-OPEN-FILES       THRU 1000-EXIT.                        
           MOVE FUNCTION CURRENT-DATE    TO  WS-CURR-DATE.                      
           PERFORM 2000-READ-BP13F800    THRU 2000-EXIT.                        
           PERFORM 3000-PROCESS-REC      THRU 3000-EXIT                         
             UNTIL EOF-F800.                                                    
           PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT.                        
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       1000-OPEN-FILES.                                                         
      *---------------------------------------------------------------*         
           OPEN INPUT  BP13F800                                                 
                       BP13K820                                                 
                       BP13K830                                                 
                       BP13K895                                                 
                       BP13K857                                                 
                       BM06K100                                                 
                       BM06K110                                                 
               OUTPUT  P13F800A.                                                
                                                                                
           IF K895-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K895-STATUS ' K895-STATUS                    
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K820-STATUS ' K820-STATUS                    
           END-IF.                                                              
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K830-STATUS ' K830-STATUS                    
           END-IF.                                                              
                                                                                
           IF K857-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K857-STATUS ' K857-STATUS                    
           END-IF.                                                              
                                                                                
           IF K110-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K110-STATUS ' K110-STATUS                    
           END-IF.                                                              
                                                                                
           IF K100-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR, K100-STATUS ' K100-STATUS                    
           END-IF.                                                              
                                                                                
           WRITE P13F800A-REC FROM P13F800A-HEADER.                             
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       2000-READ-BP13F800.                                                      
      *---------------------------------------------------------------*         
           READ BP13F800 AT END                                                 
                MOVE 'Y' TO WS-EOF-F800                                         
                GO TO 2000-EXIT.                                                
           ADD 1 TO WS-F800-READ.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3000-PROCESS-REC.                                                        
      *---------------------------------------------------------------*         
                                                                                
           MOVE  0              TO WS-NUM-REGN-DATE                             
                                   WS-NRIC-CNT                                  
           INITIALIZE P13F800A-REC                                              
           MOVE ';'             TO FILLER1  FILLER2  FILLER3  FILLER4           
                                   FILLER5  FILLER6  FILLER7  FILLER8           
                                   FILLER9  FILLER10 FILLER11 FILLER12          
                                   FILLER13 FILLER14 FILLER15 FILLER16          
                                   FILLER17 FILLER18 FILLER19 FILLER20          
                                   FILLER21 FILLER22 FILLER23 FILLER24          
                                   FILLER25 FILLER26 FILLER27 FILLER28          
                                   FILLER29 FILLER30 FILLER31 FILLER32          
                                   FILLER33 FILLER34 FILLER35 FILLER36          
                                   FILLER37 FILLER38 FILLER39 FILLER40          
                                   FILLER41 FILLER42 FILLER43 FILLER44          
                                   FILLER45 FILLER46 FILLER47 FILLER48          
                                   FILLER49 FILLER50                            
                                                                                
           IF F800-DTE-REGN IS NOT NUMERIC                                      
              PERFORM 2000-READ-BP13F800    THRU 2000-EXIT                      
              ADD 1 TO WS-BYPASS                                                
              GO TO 3000-EXIT                                                   
           ELSE                                                                 
              MOVE F800-DTE-REGN TO WS-REGN-DATE                                
           END-IF.                                                              
                                                                                
           MOVE 1                       TO WS-CNT                               
                                                                                
           PERFORM VARYING WS-CNT FROM 1 BY 1 UNTIL WS-CNT > 4                  
               MOVE SPACES              TO WS-NRIC(WS-CNT)                      
               MOVE ZEROES              TO WS-AGE (WS-CNT)                      
               MOVE SPACES              TO WS-NME-OCCP(WS-CNT)                  
               MOVE SPACES              TO WS-DTE-BIRTH(WS-CNT)                 
               MOVE SPACES              TO WS-NUM-ETHNIC(WS-CNT)                
               MOVE SPACES              TO WS-NUM-HP-PGR(WS-CNT)                
               MOVE SPACES              TO WS-NUM-PHONE(WS-CNT)                 
           END-PERFORM                                                          
                                                                                
           PERFORM 3200-GET-AGE           THRU 3200-EXIT                        
                                                                                
           PERFORM 3300-VALIDATE-CRITERIA THRU 3300-EXIT                        
                                                                                
                                                                                
           PERFORM 2000-READ-BP13F800     THRU 2000-EXIT.                       
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       3100-BROWSE-BP13K820.                                                    
      *---------------------------------------------------------------*         
           MOVE SPACES             TO K820-KEY-FLD.                             
           MOVE F800-NUM-REGN      TO K820-NUM-REGN.                            
           MOVE WS-NRIC(WS-CNT)    TO K820-NUM-NRIC.                            
                                                                                
           READ  BP13K820.                                                      
                                                                                
           EVALUATE K820-STATUS                                                 
           WHEN 00                                                              
                MOVE 'Y' TO WS-K820-FND                                         
                IF K820-DTE-BIRTH IS NUMERIC                                    
                   MOVE K820-DTE-BIRTH       TO WS-BIRTH-DATE                   
                   PERFORM 4000-COMPUTE-AGE THRU 4000-EXIT                      
                ELSE                                                            
                   MOVE 0                    TO WS-AGE(WS-CNT)                  
                END-IF                                                          
                                                                                
                MOVE K820-NME-OCCP       TO WS-NME-OCCP(WS-CNT)                 
                MOVE K820-DTE-BIRTH      TO WS-DTE-BIRTH(WS-CNT)                
                EVALUATE K820-NUM-ETHNIC                                        
                WHEN '0'                                                        
                     MOVE 'C'            TO WS-NUM-ETHNIC(WS-CNT)               
                WHEN '6'                                                        
                     MOVE 'I'            TO WS-NUM-ETHNIC(WS-CNT)               
                WHEN '5'                                                        
                     MOVE 'M'            TO WS-NUM-ETHNIC(WS-CNT)               
                WHEN '7'                                                        
                     MOVE 'O'            TO WS-NUM-ETHNIC(WS-CNT)               
                END-EVALUATE                                                    
                MOVE K820-NUM-HP-PGR     TO WS-NUM-HP-PGR(WS-CNT)               
                MOVE K820-NUM-PHONE      TO WS-NUM-PHONE(WS-CNT)                
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K820, KEY IS '                 
                         K820-KEY-FLD                                           
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING IN BP13K820, STATUS IS '                 
                         K820-STATUS                                            
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3200-GET-AGE.                                                            
                                                                                
           MOVE 1                       TO WS-CNT                               
           MOVE F800-NUM-NRIC1          TO WS-NRIC(1)                           
           MOVE F800-NUM-NRIC2          TO WS-NRIC(2)                           
           MOVE F800-NUM-NRIC3          TO WS-NRIC(3)                           
           MOVE F800-NUM-NRIC4          TO WS-NRIC(4)                           
                                                                                
           PERFORM VARYING WS-CNT FROM 1 BY 1 UNTIL WS-CNT > 4 OR               
                         WS-NRIC(WS-CNT) = SPACES                               
                                                                                
              MOVE 'N'             TO WS-K820-FND                               
              MOVE  0              TO WS-BIRTH-DATE                             
                                                                                
              PERFORM 3100-BROWSE-BP13K820 THRU 3100-EXIT                       
                                                                                
              IF WS-K820-FND = 'N'                                              
                 PERFORM 5000-STARTBR-BP13K895 THRU 5000-EXIT                   
              END-IF                                                            
                                                                                
              ADD  1 TO WS-NRIC-CNT                                             
                                                                                
           END-PERFORM.                                                         
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3300-VALIDATE-CRITERIA.                                                  
                                                                                
           EVALUATE TRUE                                                        
           WHEN WS-NRIC-CNT = 1                                                 
                                                                                
              IF (WS-APPLN-AGE(1) >= 55 AND WS-APPLN-AGE(1) <= 62) AND          
                  F800-AMT-HSE-INCOME <= 3000                                   
                                                                                
                  PERFORM 3400-TALLY-TRANS       THRU 3400-EXIT                 
                  PERFORM 3500-WRITE-F800A       THRU 3500-EXIT                 
                                                                                
              END-IF                                                            
           WHEN WS-NRIC-CNT = 2                                                 
                                                                                
              IF (WS-APPLN-AGE(1) >= 55 AND WS-APPLN-AGE(1) <= 62) AND          
                 (WS-APPLN-AGE(2) >= 55 AND WS-APPLN-AGE(2) <= 62) AND          
                  F800-AMT-HSE-INCOME <= 3000                                   
                                                                                
                  PERFORM 3400-TALLY-TRANS       THRU 3400-EXIT                 
                  PERFORM 3500-WRITE-F800A       THRU 3500-EXIT                 
                                                                                
              END-IF                                                            
           WHEN WS-NRIC-CNT = 3                                                 
                                                                                
              IF (WS-APPLN-AGE(1) >= 55 AND WS-APPLN-AGE(1) <= 62) AND          
                 (WS-APPLN-AGE(2) >= 55 AND WS-APPLN-AGE(2) <= 62) AND          
                 (WS-APPLN-AGE(3) >= 55 AND WS-APPLN-AGE(3) <= 62) AND          
                  F800-AMT-HSE-INCOME <= 3000                                   
                                                                                
                  PERFORM 3400-TALLY-TRANS       THRU 3400-EXIT                 
                  PERFORM 3500-WRITE-F800A       THRU 3500-EXIT                 
                                                                                
              END-IF                                                            
                                                                                
           WHEN WS-NRIC-CNT = 4                                                 
                                                                                
              IF (WS-APPLN-AGE(1) >= 55 AND WS-APPLN-AGE(1) <= 62) AND          
                 (WS-APPLN-AGE(2) >= 55 AND WS-APPLN-AGE(2) <= 62) AND          
                 (WS-APPLN-AGE(3) >= 55 AND WS-APPLN-AGE(3) <= 62) AND          
                 (WS-APPLN-AGE(4) >= 55 AND WS-APPLN-AGE(4) <= 62) AND          
                  F800-AMT-HSE-INCOME <= 3000                                   
                                                                                
                  PERFORM 3400-TALLY-TRANS       THRU 3400-EXIT                 
                  PERFORM 3500-WRITE-F800A       THRU 3500-EXIT                 
                                                                                
              END-IF                                                            
           END-EVALUATE.                                                        
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3400-TALLY-TRANS.                                                        
                                                                                
           MOVE F800-NUM-ROOM      TO WS-NUM-ROOM                               
           IF F800-NUM-SMS-FT NOT NUMERIC                                       
              MOVE ZEROES          TO WS-NUM-SMS-FT                             
           ELSE                                                                 
              MOVE F800-NUM-SMS-FT TO WS-NUM-SMS-FT                             
           END-IF                                                               
                                                                                
           IF F800-NUM-SMS-FT NOT NUMERIC                                       
              MOVE ZEROES          TO WS-NUM-RSL-FT                             
           ELSE                                                                 
              MOVE F800-NUM-RSL-FT TO WS-NUM-RSL-FT                             
           END-IF                                                               
                                                                                
           EVALUATE TRUE                                                        
           WHEN F800-NUM-SMS-FT NOT = SPACES AND                                
                WS-NUM-SMS-FT       > WS-NUM-ROOM-N                             
                                                                                
                ADD 1           TO WS-SMS-GT-FT                                 
           WHEN F800-NUM-SMS-FT NOT = SPACES AND                                
                WS-NUM-SMS-FT      <= WS-NUM-ROOM-N                             
                                                                                
                ADD 1           TO WS-SMS-LTE-FT                                
           WHEN F800-NUM-RSL-FT NOT = SPACES AND                                
                WS-NUM-RSL-FT       > WS-NUM-ROOM-N                             
                                                                                
                ADD 1           TO WS-RSL-GT-FT                                 
           WHEN F800-NUM-RSL-FT NOT = SPACES AND                                
                WS-NUM-RSL-FT      <= WS-NUM-ROOM-N                             
                                                                                
                ADD 1           TO WS-RSL-LTE-FT                                
                                                                                
           WHEN F800-NUM-SMS-FT     = SPACES AND                                
                F800-NUM-RSL-FT     = SPACES                                    
                                                                                
                ADD 1           TO WS-NO-SMS-RSL                                
                                                                                
           END-EVALUATE.                                                        
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3500-WRITE-F800A.                                                        
           ADD  1 TO WS-SN                                                      
                                                                                
           MOVE WS-SN                TO F800A-SN                                
           MOVE F800-NUM-REGN        TO F800A-NUM-REGNO                         
           MOVE F800-NUM-SCH-ACC     TO F800A-NUM-SCH-ACC                       
           MOVE F800-DTE-BALLOT      TO F800A-DTE-BALLOT                        
           MOVE F800-DTE-BK-APPT     TO F800A-DTE-BK-APPT                       
           MOVE F800-NUM-NT-FT-QUEUE TO F800A-NUM-NT-FT-QUEUE                   
           MOVE F800-NUM-HOUSEHOLD   TO F800A-NUM-HOUSEHOLD                     
           MOVE F800-NUM-NEW-TOWN    TO F800A-NUM-NEW-TOWN                      
           MOVE F800-NUM-IDP-SCHEME  TO F800A-NUM-IDP-SCHEME                    
           MOVE F800-NUM-ALLO-SCHEME TO F800A-NUM-ALLO-SCHEME                   
           MOVE F800-NUM-FLAT-TYPE   TO F800A-NUM-FLAT-TYPE                     
           MOVE F800-NUM-SMS-STATUS  TO F800A-NUM-SMS-STATUS                    
           MOVE F800-NUM-SMS-FT      TO F800A-NUM-SMS-FT                        
           MOVE F800-NUM-RSL-STATUS  TO F800A-NUM-RSL-STATUS                    
           MOVE F800-NUM-RSL-FT      TO F800A-NUM-RSL-FT                        
           MOVE F800-AMT-HSE-INCOME  TO F800A-AMT-HSE-INCOME                    
                                                                                
           MOVE WS-NRIC      (1)     TO F800A-NUM-NRIC1                         
           MOVE WS-NME-OCCP  (1)     TO F800A-NME-OCCP1                         
           MOVE WS-DTE-BIRTH (1)     TO F800A-DTE-BIRTH1                        
           MOVE WS-APPLN-AGE (1)     TO F800A-AGE1                              
           MOVE WS-NUM-ETHNIC(1)     TO F800A-NUM-ETHNIC1                       
           MOVE WS-NUM-HP-PGR(1)     TO F800A-NUM-HP-PGR1                       
           MOVE WS-NUM-PHONE (1)     TO F800A-NUM-PHONE1                        
                                                                                
           MOVE WS-NRIC      (2)     TO F800A-NUM-NRIC2                         
           MOVE WS-NME-OCCP  (2)     TO F800A-NME-OCCP2                         
           MOVE WS-DTE-BIRTH (2)     TO F800A-DTE-BIRTH2                        
           MOVE WS-APPLN-AGE (2)     TO F800A-AGE2                              
           MOVE WS-NUM-ETHNIC(2)     TO F800A-NUM-ETHNIC2                       
           MOVE WS-NUM-HP-PGR(2)     TO F800A-NUM-HP-PGR2                       
           MOVE WS-NUM-PHONE (2)     TO F800A-NUM-PHONE2                        
                                                                                
           MOVE WS-NRIC      (3)     TO F800A-NUM-NRIC3                         
           MOVE WS-NME-OCCP  (3)     TO F800A-NME-OCCP3                         
           MOVE WS-DTE-BIRTH (3)     TO F800A-DTE-BIRTH3                        
           MOVE WS-APPLN-AGE (3)     TO F800A-AGE3                              
           MOVE WS-NUM-ETHNIC(3)     TO F800A-NUM-ETHNIC3                       
           MOVE WS-NUM-HP-PGR(3)     TO F800A-NUM-HP-PGR3                       
           MOVE WS-NUM-PHONE (3)     TO F800A-NUM-PHONE3                        
                                                                                
           MOVE WS-NRIC      (4)     TO F800A-NUM-NRIC4                         
           MOVE WS-NME-OCCP  (4)     TO F800A-NME-OCCP4                         
           MOVE WS-DTE-BIRTH (4)     TO F800A-DTE-BIRTH4                        
           MOVE WS-APPLN-AGE (4)     TO F800A-AGE4                              
           MOVE WS-NUM-ETHNIC(4)     TO F800A-NUM-ETHNIC4                       
           MOVE WS-NUM-HP-PGR(4)     TO F800A-NUM-HP-PGR4                       
           MOVE WS-NUM-PHONE (4)     TO F800A-NUM-PHONE4                        
                                                                                
           MOVE F800-DTE-ACCEPTANCE  TO F800A-DTE-ACCEPTANCE                    
           MOVE F800-DTE-SALE-AGMT   TO F800A-DTE-SALE-AGMT                     
           MOVE F800-DTE-SO-APPT     TO F800A-DTE-SO-APPT                       
                                                                                
           PERFORM 3600-GET-EMAIL    THRU 3600-EXIT                             
                                                                                
           MOVE K857-NUM-EMAIL       TO F800A-NUM-EMAIL                         
                                                                                
           PERFORM 3700-GET-ADDRESS  THRU 3700-EXIT                             
                                                                                
           PERFORM 4500-GET-OTH-DATES THRU 4500-EXIT.                           
                                                                                
           WRITE                   P13F800A-REC                                 
           ADD  1 TO WS-F800A-WRITE.                                            
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       3600-GET-EMAIL.                                                          
      *-------------------*                                                     
                                                                                
           MOVE SPACES             TO K857-NUM-EMAIL.                           
                                                                                
           MOVE F800-NUM-REGN      TO K857-NUM-REGN.                            
                                                                                
           READ BP13K857 KEY IS K857-KEY-FLD.                                   
                                                                                
            EVALUATE K857-STATUS                                                
               WHEN ZERO                                                        
                 CONTINUE                                                       
               WHEN 23                                                          
                 DISPLAY 'RECORD NOT FOUND IN BP13K895 ' K895-KEY-FLD           
               WHEN OTHER                                                       
                 DISPLAY 'READ ERROR, K895-STATUS ' K895-STATUS                 
                      ' KEY ' K895-KEY-FLD                                      
            END-EVALUATE.                                                       
                                                                                
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3700-GET-ADDRESS.                                                        
           MOVE F800-NUM-REGN     TO    K830-NUM-REGN.                          
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
                                                                                
           EVALUATE K830-STATUS                                                 
           WHEN 00                                                              
              IF (K830-NUM-MAIL-ADDR =  SPACES OR LOW-VALUES) OR                
                 ((K830-NUM-MAIL-LVL-CHAR =  '#') AND                           
                 (K830-NUM-MAIL-LVL-NUM =  SPACES OR LOW-VALUES))               
                  MOVE K830-NUM-RESIDENT-ADDR   TO F800A-NUM-MAIL-ADDR          
              ELSE                                                              
                  MOVE K830-NUM-MAIL-ADDR       TO F800A-NUM-MAIL-ADDR          
              END-IF                                                            
           WHEN 23                                                              
              MOVE SPACES                       TO F800A-NUM-MAIL-ADDR          
              DISPLAY 'BP13K830 RECORD NOT FOUND = ' K830-STATUS                
                      ', KEY ' K830-KEY-FLD                                     
           WHEN OTHER                                                           
              DISPLAY 'ERROR READING BP13K830, STATUS ' K830-STATUS             
                      ', KEY ' K830-KEY-FLD                                     
           END-EVALUATE.                                                        
                                                                                
       3700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       4000-COMPUTE-AGE.                                                        
      *---------------------------------------------------------------*         
           COMPUTE WS-AGE(WS-CNT)  =  WS-REGN-CCYYMM - WS-BIRTH-CCYYMM.         
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       4500-GET-OTH-DATES.                                                      
      *---------------------------------------------------------------*         
           PERFORM 4550-READ-BM06K110   THRU 4550-EXIT.                         
           PERFORM 4600-READ-BM06K100   THRU 4600-EXIT.                         
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4550-READ-BM06K110.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE    K110-REC.                                              
           MOVE F800-NUM-SCH-ACC   TO K110-SCH-ACC-NO.                          
                                                                                
           READ BM06K110.                                                       
           EVALUATE K110-STATUS                                                 
               WHEN ZERO                                                        
                 MOVE K110-DTE-KEY-AVAIL TO F800A-DTE-KEY-AVAIL                 
               WHEN 23                                                          
                 MOVE SPACES             TO F800A-DTE-KEY-AVAIL                 
                 DISPLAY 'RECORD NOT FOUND IN BM06K110 ' K110-SCH-ACC-NO        
               WHEN OTHER                                                       
                 DISPLAY 'READ ERROR, K110-STATUS ' K110-STATUS                 
                      ' KEY ' K110-SCH-ACC-NO                                   
            END-EVALUATE.                                                       
                                                                                
       4550-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4600-READ-BM06K100.                                                      
      *---------------------------------------------------------------*         
           MOVE SPACES             TO K100-KEY-FLD.                             
           MOVE K110-AIX1          TO K100-KEY-FLD.                             
                                                                                
           READ BM06K100.                                                       
           EVALUATE K100-STATUS                                                 
               WHEN ZERO                                                        
                 MOVE K100-DTE-PACD-QTR  TO F800A-DTE-PACD-QTR                  
               WHEN 23                                                          
                 MOVE SPACES             TO F800A-DTE-PACD-QTR                  
                 DISPLAY 'RECORD NOT FOUND IN BM06K100 ' K100-KEY-FLD           
               WHEN OTHER                                                       
                 DISPLAY 'READ ERROR, K100-STATUS ' K100-STATUS                 
                      ' KEY ' K100-KEY-FLD                                      
            END-EVALUATE.                                                       
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
      *---------------------------------------------------------------*         
       5000-STARTBR-BP13K895.                                                   
      *---------------------------------------------------------------*         
            MOVE 'N'             TO  WS-K895-EOF.                               
            MOVE SPACES          TO  K895-KEY-FLD.                              
            MOVE F800-NUM-REGN   TO  K895-NUM-REGN-HIST.                        
            MOVE WS-NRIC(WS-CNT) TO  K895-NUM-NRIC-HIST.                        
                                                                                
            START BP13K895 KEY >= K895-KEY-FLD.                                 
                                                                                
            EVALUATE K895-STATUS                                                
               WHEN ZERO                                                        
                 PERFORM 5100-READNXT-K895     THRU 5100-EXIT                   
               WHEN 23                                                          
                 ADD 1 TO WS-NOTFND                                             
                 DISPLAY 'RECORD NOT FOUND IN BP13K895 ' K895-KEY-FLD           
               WHEN OTHER                                                       
                 DISPLAY 'READ ERROR, K895-STATUS ' K895-STATUS                 
                      ' KEY ' K895-KEY-FLD                                      
            END-EVALUATE.                                                       
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       5100-READNXT-K895.                                                       
      *---------------------------------------------------------------*         
           READ BP13K895 NEXT AT END                                            
                MOVE 'Y' TO WS-K895-EOF.                                        
                                                                                
            EVALUATE K895-STATUS                                                
               WHEN ZERO                                                        
               WHEN 02                                                          
                 IF K895-NUM-REGN-HIST = F800-NUM-REGN AND                      
                    K895-NUM-NRIC-HIST = WS-NRIC(WS-CNT)                        
                     IF K895-DTE-BIRTH IS NUMERIC                               
                        MOVE K895-DTE-BIRTH       TO WS-BIRTH-DATE              
                        PERFORM 4000-COMPUTE-AGE THRU 4000-EXIT                 
                        MOVE 'Y' TO WS-K895-EOF                                 
                     ELSE                                                       
                        MOVE 'Y' TO WS-K895-EOF                                 
                        MOVE  0  TO WS-AGE(WS-CNT)                              
                     END-IF                                                     
                                                                                
                     MOVE K895-NME-OCCP       TO WS-NME-OCCP(WS-CNT)            
                     MOVE K895-DTE-BIRTH      TO WS-DTE-BIRTH(WS-CNT)           
                     EVALUATE K895-NUM-ETHNIC                                   
                     WHEN '0'                                                   
                         MOVE 'C'             TO WS-NUM-ETHNIC(WS-CNT)          
                     WHEN '6'                                                   
                         MOVE 'I'             TO WS-NUM-ETHNIC(WS-CNT)          
                     WHEN '5'                                                   
                         MOVE 'M'             TO WS-NUM-ETHNIC(WS-CNT)          
                     WHEN '7'                                                   
                         MOVE 'O'             TO WS-NUM-ETHNIC(WS-CNT)          
                     END-EVALUATE                                               
                     MOVE K895-NUM-HP-PGR     TO WS-NUM-HP-PGR(WS-CNT)          
                     MOVE K895-NUM-PHONE      TO WS-NUM-PHONE(WS-CNT)           
                 ELSE                                                           
                    MOVE 'Y' TO WS-K895-EOF                                     
                 END-IF                                                         
                                                                                
               WHEN 23                                                          
                 ADD 1 TO WS-NOTFND                                             
                 DISPLAY 'RECORD NOT FOUND IN BP13K895 ' K895-KEY-FLD           
               WHEN OTHER                                                       
                 DISPLAY 'READ ERROR, K895-STATUS ' K895-STATUS                 
                      ' REGN = ' K895-NUM-REGN                                  
            END-EVALUATE.                                                       
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       9000-CLOSE-FILES.                                                        
      *---------------------------------------------------------------*         
           CLOSE BP13F800                                                       
                 BP13K895                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 BP13K857                                                       
                 P13F800A.                                                      
                                                                                
           IF K895-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR, K895-STATUS ' K895-STATUS                   
              MOVE K895-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR, K820-STATUS ' K820-STATUS                   
              MOVE K820-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR, K830-STATUS ' K830-STATUS                   
              MOVE K820-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K857-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR, K857-STATUS ' K857-STATUS                   
              MOVE K820-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '*================ EDTK800O ================*'.              
           DISPLAY '   NO. OF F800 RECORDS READ    = ' WS-F800-READ.            
           DISPLAY '   NO. OF F800A RECS WRITTEN   = ' WS-F800A-WRITE.          
           DISPLAY '   NO. OF RECS BYPASSED        = ' WS-BYPASS.               
           DISPLAY '   NO. OF RECS NOT FOUND       = ' WS-NOTFND.               
           DISPLAY '   NO. OF RECS SMS <  ROOM     = ' WS-SMS-GT-FT.            
           DISPLAY '   NO. OF RECS SMS >= ROOM     = ' WS-SMS-LTE-FT.           
           DISPLAY '   NO. OF RECS RSL <  ROOM     = ' WS-RSL-GT-FT.            
           DISPLAY '   NO. OF RECS RSL >= ROOM     = ' WS-RSL-LTE-FT.           
           DISPLAY '   NO. OF RECS NO SMS/RSL      = ' WS-NO-SMS-RSL.           
           DISPLAY '*==========================================*'.              
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
