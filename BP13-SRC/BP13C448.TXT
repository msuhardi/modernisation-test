       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C448.                                         00020000
      *AUTHOR.        NOR.                                              00030000
      *DATE-WRITTEN.  30/04/1999.                                       00040000
      *DATE-COMPILED.                                                   00050000
                                                                        00060000
      * ====================================================== *        00070000
      *                                                        *        00080000
      *    SYSTEM NAME : ALLOCATION OF FLATS.                  *        00090000
      *    SYSTEM ID : BP13                                    *        00100000
      *                                                        *        00110000
      *    OBJECTIVE  :                                        *        00120000
      *        1.  TO REFORMAT FROM THE DAILY SALES ORDER      *        00130000
      *            FILE (BP13F410) INTO A FORMAT FOR RDBII     *        00140000
      *                                                        *        00150000
      *     INPUT FILES:                                       *        00160000
      *           1. BP13F410 (SALES ORDER FILE)               *        00170000
      *                                                        *        00180000
      *     OUTPUT FILES:                                      *        00190000
      *           1. BE03F222 (TO RDB II SYSTEM)               *        00200000
      *                                                        *        00210000
      *  CHG NO.    BY   DATE    DESCRIPTION                   *        00220000
      *  =======    ==   ====    ===========                   *        00230000
      *                                                        *        00240000
      * ====================================================== *        00250000
      *                                                        *        00260000
      *    SIMILAR PROGRAM : BP13C401                          *        00270000
      *                                                        *        00280000
      *  CHG  REQ   BY   DATE     DESCRIPTION                  *        00290000
      *  ========  ====  ======== ============================ *        00300000
      *  BP130558  NOR   19990430 NEW PGM                      *        00310000
      *  BP130558  NOR   19991117 ADD SPOUSE-NRIC,BYPASS FS SCH*        00320000
      *  BP130998  CLT   11062001 CATER FOR SALES TYPE 13      *        00330000
      *  BP133505  PCL3  20012009 CATER FOR F410-CDE-SALES-TYPE*        00340000
      *                           14 & 15                      *        00350000
      * BP136098  LJL1 29012016  TO CATER FOR 2 ROOM FLEXI     *        00360000
      *                          SALES TYPE = 18               *        00370000
      * BP137181  PCL4 06092018  TO CATER FOR SALES TYPE = 19  *        00380000
      * BP137725  KR13 09052019  UPDT DEFER-DT IN BP13K399.    *        00390000
      * BP137850  KV6  03072019  TO CATER FOR WRITE IN BP13K399*        00400000
      * BP138971  KR13 21122021  CATER FOR NEW FIN SERIES 'M'  *        00401002
      * ====================================================== *        00410000
                                                                        00420000
       ENVIRONMENT DIVISION.                                            00430000
       CONFIGURATION SECTION.                                           00440000
       SOURCE-COMPUTER. IBM-3900.                                       00450000
       OBJECT-COMPUTER. IBM-3900.                                       00460000
       INPUT-OUTPUT SECTION.                                            00470000
       FILE-CONTROL.                                                    00480000
           SELECT BP13F410 ASSIGN TO BP13F410.                          00490000
                                                                        00500000
           SELECT BE03F222 ASSIGN TO BE03F222.                          00510000
                                                                        00520000
           SELECT BP13K800 ASSIGN TO BP13K800                           00530000
                           ORGANIZATION IS INDEXED                      00540000
                           ACCESS MODE IS DYNAMIC                       00550000
                           RECORD KEY IS K800-NUM-REGN                  00560000
                           FILE STATUS IS WS-K800-STATUS.               00570000
                                                                        00580000
           SELECT BP13K820 ASSIGN TO BP13K820                           00590000
                           ORGANIZATION IS INDEXED                      00600000
                           ACCESS MODE IS DYNAMIC                       00610000
                           RECORD KEY IS K820-KEY-FLD                   00620000
                           FILE STATUS IS WS-K820-STATUS.               00630000
                                                                        00640000
           SELECT BP13K399 ASSIGN TO BP13K399                           00650000
                           ACCESS MODE   IS RANDOM                      00660000
                           ORGANIZATION  IS INDEXED                     00670000
                           RECORD KEY    IS K399-KEY-FLD                00680000
                           FILE STATUS   IS WS-K399-STATUS.             00690000
                                                                        00700000
           SELECT BM06K110 ASSIGN TO BM06K110                           00710000
                           ORGANIZATION  IS INDEXED                     00720000
                           RECORD KEY    IS K110-KEY-FLD                00730000
                           ACCESS MODE   IS RANDOM                      00740000
                           FILE STATUS   IS WS-K110-STATUS.             00750000
                                                                        00760000
       DATA DIVISION.                                                   00770000
       FILE SECTION.                                                    00780000
       FD  BP13F410                                                     00790000
           BLOCK  CONTAINS   0 CHARACTERS                               00800000
           RECORD CONTAINS 2000 CHARACTERS                              00810000
           LABEL RECORDS ARE STANDARD.                                  00820000
       COPY BP13F410.                                                   00830000
                                                                        00840000
       FD  BE03F222                                                     00850000
           BLOCK  CONTAINS   0 CHARACTERS                               00860000
           RECORD CONTAINS 350 CHARACTERS                               00870000
           LABEL RECORDS ARE STANDARD.                                  00880000
       COPY BE03F222.                                                   00890000
                                                                        00900000
       FD  BP13K800                                                     00910000
           RECORD CONTAINS 2000 CHARACTERS.                             00920000
       COPY BP13K800.                                                   00930000
                                                                        00940000
       FD  BP13K820                                                     00950000
           RECORD CONTAINS 400 CHARACTERS.                              00960000
       COPY BP13K820.                                                   00970000
                                                                        00980000
       FD  BP13K399                                                     00990000
           RECORD CONTAINS 800 CHARACTERS.                              01000000
       COPY BP13K399.                                                   01010000
                                                                        01020000
       FD  BM06K110                                                     01030000
           RECORD CONTAINS 500 CHARACTERS.                              01040000
       COPY BM06K110.                                                   01050000
                                                                        01060000
       WORKING-STORAGE SECTION.                                         01070000
                                                                        01080000
       01  WS-PROGRAM-SWITCHES.                                         01090000
           03  WS-EOF-F410-IND          PIC X(2)  VALUE 'N'.            01100000
               88  WS-EOF-F410          VALUE 'Y'.                      01110000
           03  WS-K820-EOF-SW           PIC X(01)  VALUE 'N'.           01120000
               88  WS-K820-EOF          VALUE 'Y'.                      01130000
           03 WS-K399-FND               PIC X(1)  VALUE 'N'.            01140000
           03 WS-K399-WRITE             PIC X(1)  VALUE 'N'.            01150000
                                                                        01160000
       01  WS-FILE-STATUS.                                              01170000
           05  WS-K800-STATUS           PIC 9(02)  VALUE ZEROS.         01180000
           05  WS-K820-STATUS           PIC 9(02)  VALUE ZEROS.         01190000
           05  WS-K399-STATUS           PIC 9(02)  VALUE ZEROS.         01200000
           05  WS-K110-STATUS           PIC 9(02)  VALUE ZEROS.         01210000
                                                                        01220000
       01  WS-COUNTERS.                                                 01230000
           05  WS-F410-READ-CNT         PIC 9(06)  VALUE ZEROS.         01240000
           05  WS-F410-BYPASS-CNT       PIC 9(06)  VALUE ZEROS.         01250000
           05  WS-K800-READ-CNT         PIC 9(06)  VALUE ZEROS.         01260000
           05  WS-K820-READ-CNT         PIC 9(06)  VALUE ZEROS.         01270000
           05  WS-K399-UPDT-CNT         PIC 9(06)  VALUE ZEROS.         01280000
           05  WS-K399-WRIT-CNT         PIC 9(06)  VALUE ZEROS.         01290000
           05  WS-F222-WRITE-CNT        PIC 9(06)  VALUE ZEROS.         01300000
           05  WS-OCC-REGN              PIC 9(06)  VALUE ZEROS.         01310000
           05  WS-CNT-NOTFND            PIC 9(06)  VALUE ZEROS.         01320000
           05  WS-K820-REGN             PIC X(08)  VALUE SPACES.        01330000
                                                                        01340000
       01  WS-PREV-REGN                 PIC X(08)  VALUE SPACES.        01350000
                                                                        01360000
       01  WS-DATE-BIRTH-K820.                                          01370000
           05  WS-BIRTH-YY          PIC X(4).                           01380000
           05  WS-BIRTH-MM          PIC X(2).                           01390000
           05  WS-BIRTH-DD          PIC X(2).                           01400000
                                                                        01410000
       01  WS-DATE-STAMPED.                                             01420000
           05  WS-DTE-CREATED       PIC X(8).                           01430000
           05  WS-TME-CREATED       PIC X(6).                           01440000
                                                                        01450000
       01  WS-NRIC.                                                     01460000
           05  WS-NRIC1             PIC X(9)  VALUE SPACES.             01470000
           05  WS-NRIC2             PIC X(9)  VALUE SPACES.             01480000
           05  WS-NRIC3             PIC X(9)  VALUE SPACES.             01490000
           05  WS-NRIC4             PIC X(9)  VALUE SPACES.             01500000
                                                                        01510000
       01  WS-NRIC-ARRAY.                                               01520000
           05  WS-K820-REC     OCCURS 15 TIMES.                         01530000
               10  WS-K820-NRIC               PIC X(9).                 01540000
               10  WS-K820-NRIC-SPOUSE        PIC X(9).                 01550000
                                                                        01560000
       01  WS-NME-SPOUSE       PIC X(66).                               01570000
       01  WS-REC-CNT          PIC 9(2).                                01580000
       01  WS-WRITE-CNT        PIC 9(2).                                01590000
                                                                        01600000
       01  WS-SYSTEM-DATE.                                              01610000
           03  WS-YY           PIC 9(4).                                01620000
           03  WS-MM           PIC 9(2).                                01630000
           03  WS-DD           PIC 9(2).                                01640000
                                                                        01650000
       01  WS-FOUND-FLAG           PIC X(2).                            01660000
           88 WS-FOUND                             VALUE '01'.          01670000
                                                                        01680000
       01  WS-ADDR-TYPE                  PIC X       VALUE SPACE.       01690000
       01  WS-STREET-CODE                PIC X(06)   VALUE SPACES.      01700000
                                                                        01710000
       01  WS-SCH-ACC-NO.                                               01720000
           03  WS-SCH-ACC-9               PIC X(9).                     01730000
           03  FILLER                     PIC XX.                       01740000
                                                                        01750000
       PROCEDURE DIVISION.                                              01760000
       100-MAIN.                                                        01770000
                                                                        01780000
           PERFORM 200-OPENING-ROUTINE    THRU 200-EXIT.                01790000
           PERFORM 300-READ-F410-REC      THRU 300-EXIT.                01800000
           PERFORM 400-OUTPUT-TO-MAF      THRU 400-EXIT                 01810000
                   UNTIL WS-EOF-F410.                                   01820000
           PERFORM 600-CLOSING-ROUTINE    THRU 600-EXIT.                01830000
                                                                        01840000
       100-EXIT.                                                        01850000
           EXIT.                                                        01860000
                                                                        01870000
       200-OPENING-ROUTINE.                                             01880000
            OPEN INPUT BP13F410                                         01890000
                       BP13K820                                         01900000
                       BP13K800                                         01910000
                       BM06K110                                         01920000
                   I-O BP13K399                                         01930000
                OUTPUT BE03F222.                                        01940000
                                                                        01950000
           MOVE FUNCTION CURRENT-DATE(1:8)   TO  WS-SYSTEM-DATE.        01960000
                                                                        01970000
           IF WS-K820-STATUS NOT = ZEROS AND 97                         01980000
              MOVE WS-K820-STATUS        TO  RETURN-CODE                01990000
              DISPLAY 'ERROR OPENING BP13K820! FILE STATUS IS '         02000000
                       WS-K820-STATUS '.'                               02010000
              GO TO 600-CLOSING-ROUTINE.                                02020000
                                                                        02030000
           IF WS-K800-STATUS NOT = ZEROS AND 97                         02040000
              MOVE WS-K800-STATUS        TO  RETURN-CODE                02050000
              DISPLAY 'ERROR OPENING BP13K800! FILE STATUS IS '         02060000
                       WS-K800-STATUS '.'                               02070000
              GO TO 600-CLOSING-ROUTINE.                                02080000
                                                                        02090000
           IF WS-K110-STATUS NOT = ZEROS AND 97                         02100000
              MOVE WS-K110-STATUS        TO  RETURN-CODE                02110000
              DISPLAY 'ERROR OPENING BM06K110! FILE STATUS IS '         02120000
                       WS-K110-STATUS '.'                               02130000
              GO TO 600-CLOSING-ROUTINE.                                02140000
                                                                        02150000
           IF WS-K399-STATUS NOT = ZEROS AND 97                         02160000
              MOVE WS-K399-STATUS        TO  RETURN-CODE                02170000
              DISPLAY 'ERROR OPENING BP13K399! FILE STATUS IS '         02180000
                       WS-K399-STATUS '.'                               02190000
              GO TO 600-CLOSING-ROUTINE.                                02200000
                                                                        02210000
       200-EXIT.                                                        02220000
           EXIT.                                                        02230000
                                                                        02240000
      ******************************************************************02250000
      *                                                                *02260000
      *              READING OF BP13F410 FILE                          *02270000
      *                                                                *02280000
      ******************************************************************02290000
                                                                        02300000
       300-READ-F410-REC.                                               02310000
                                                                        02320000
           READ BP13F410 AT END                                         02330000
                MOVE 'Y' TO WS-EOF-F410-IND                             02340000
                NOT AT END                                              02350000
                ADD 1    TO WS-F410-READ-CNT                            02360000
           END-READ.                                                    02370000
                                                                        02380000
       300-EXIT.                                                        02390000
           EXIT.                                                        02400000
                                                                        02410000
       310-START-BP13K820.                                              02420000
           MOVE 'N'           TO  WS-K820-EOF-SW.                       02430000
           MOVE F410-NUM-REGN TO  K820-NUM-REGN.                        02440000
           MOVE SPACES        TO  K820-NUM-NRIC.                        02450000
                                                                        02460000
           START BP13K820 KEY >= K820-KEY-FLD                           02470000
           IF WS-K820-STATUS = ZEROS OR 02                              02480000
              PERFORM 320-READ-BP13K820    THRU 320-EXIT                02490000
           ELSE                                                         02500000
              DISPLAY 'START BROWSE ERROR, BP13K820 STATUS IS '         02510000
                      WS-K820-STATUS                                    02520000
              MOVE WS-K820-STATUS           TO RETURN-CODE              02530000
              PERFORM 600-CLOSING-ROUTINE  THRU 600-EXIT                02540000
           END-IF.                                                      02550000
                                                                        02560000
       310-EXIT.                                                        02570000
           EXIT.                                                        02580000
                                                                        02590000
       320-READ-BP13K820.                                               02600000
           READ BP13K820 NEXT AT END                                    02610000
                MOVE 'Y'      TO WS-K820-EOF-SW                         02620000
                NOT AT END                                              02630000
                IF WS-PREV-REGN NOT = F410-NUM-REGN                     02640000
                   MOVE F410-NUM-REGN      TO  WS-PREV-REGN             02650000
                   ADD  1                  TO  WS-OCC-REGN              02660000
                END-IF                                                  02670000
           END-READ.                                                    02680000
           MOVE K820-NUM-REGN      TO  WS-K820-REGN.                    02690000
                                                                        02700000
       320-EXIT.                                                        02710000
           EXIT.                                                        02720000
                                                                        02730000
       330-BROWSE-BP13K820.                                             02740000
                                                                        02750000
           IF F410-NUM-REGN  = K820-NUM-REGN                            02760000
              ADD  1       TO  WS-K820-READ-CNT                         02770000
              PERFORM 360-TRANSFER-TO-ARRAY THRU 360-EXIT               02780000
           END-IF.                                                      02790000
                                                                        02800000
           PERFORM 320-READ-BP13K820   THRU 320-EXIT.                   02810000
                                                                        02820000
       330-EXIT.                                                        02830000
           EXIT.                                                        02840000
                                                                        02850000
       340-WRITE-BP13F222.                                              02860000
                                                                        02870000
           MOVE SPACES                    TO F222-SALE-REC              02880000
                                             BP13K820-REC.              02890000
           INITIALIZE                        F222-SALE-REC              02900000
                                             BP13K820-REC.              02910000
                                                                        02920000
           MOVE F410-NUM-REGN              TO K820-NUM-REGN.            02930000
           MOVE WS-K820-NRIC(WS-WRITE-CNT) TO K820-NUM-NRIC.            02940000
                                                                        02950000
           PERFORM 345-READ-BP13K820     THRU 345-EXIT.                 02960000
                                                                        02970000
      **** SALES INFO...                                                02980000
           MOVE K800-NUM-SCH-ACC          TO F222-NUM-HDBREF.           02990000
           MOVE F410-CDE-SALES-TYPE       TO F222-NUM-SALES-TYPE.       03000000
           MOVE F410-DTE-SO-EFFECTIVE     TO F222-DTE-SALES-EFF.        03010000
           MOVE F410-DTE-KEY-ISSUE        TO F222-DTE-KEY-COLLECTION.   03020000
                                                                        03030000
      **** RESIDENT ID...                                               03040000
           MOVE 'P'                       TO F222-NUM-CSTMR-TYPE.       03050000
           MOVE K820-NUM-NRIC             TO F222-NUM-IDNTY-NO.         03060000
           IF K820-NUM-NRIC(1:1) = 'S' OR 'T'                           03070000
              MOVE 'UIN'                  TO F222-NUM-IDNTY-NO-TYPE     03080000
           ELSE                                                         03090000
              IF K820-NUM-NRIC(1:1) = 'F' OR 'G' OR 'M'                 03100001
                 MOVE 'FIN'               TO F222-NUM-IDNTY-NO-TYPE     03110000
              ELSE                                                      03120000
                 MOVE 'XIN'               TO F222-NUM-IDNTY-NO-TYPE     03130000
              END-IF                                                    03140000
           END-IF.                                                      03150000
                                                                        03160000
      **** PERSON PARTICULARS...                                        03170000
           MOVE K820-NME-OCCP             TO F222-NME-PERSON.           03180000
           MOVE K820-NUM-NATIONALITY      TO F222-NUM-NTNLTY.           03190000
           MOVE K820-NUM-CITIZENSHIP      TO F222-NUM-CITIZENSHIP.      03200000
           MOVE K820-NUM-MARITAL-STATUS   TO F222-NUM-MRTL-STATUS.      03210000
           MOVE K820-NUM-SEX              TO F222-NUM-SEX.              03220000
           MOVE K820-NUM-ETHNIC           TO F222-NUM-ETHNIC-GROUP.     03230000
           MOVE K820-DTE-BIRTH            TO F222-DTE-BIRTH.            03240000
           IF K820-AMT-INCOME-TP = SPACES OR LOW-VALUES OR ZEROS        03250000
              COMPUTE F222-AMT-INCOME = K820-AMT-INCOME                 03260000
           ELSE                                                         03270000
              COMPUTE F222-AMT-INCOME = K820-AMT-INCOME-TP              03280000
           END-IF.                                                      03290000
                                                                        03300000
           MOVE K820-NUM-RELATIONSHIP     TO F222-NUM-RLTNSP.           03310000
                                                                        03320000
      **** ROLE INFORMATION...                                          03330000
           EVALUATE TRUE                                                03340000
           WHEN K820-NUM-NRIC = WS-NRIC1                                03350000
              MOVE '1'                    TO F222-NUM-RSDNT-PSTN        03360000
           WHEN K820-NUM-NRIC = WS-NRIC2                                03370000
              MOVE '2'                    TO F222-NUM-RSDNT-PSTN        03380000
           WHEN K820-NUM-NRIC = WS-NRIC3                                03390000
              MOVE '3'                    TO F222-NUM-RSDNT-PSTN        03400000
           WHEN K820-NUM-NRIC = WS-NRIC4                                03410000
              MOVE '4'                    TO F222-NUM-RSDNT-PSTN        03420000
           END-EVALUATE.                                                03430000
                                                                        03440000
           IF K820-NUM-NRIC = WS-NRIC1                                  03450000
               MOVE '0'                   TO F222-NUM-ROLE              03460000
           ELSE                                                         03470000
           IF (K820-NUM-NRIC = WS-NRIC2) OR                             03480000
              (K820-NUM-NRIC = WS-NRIC3) OR                             03490000
              (K820-NUM-NRIC = WS-NRIC4)                                03500000
               MOVE '1'                   TO F222-NUM-ROLE              03510000
           ELSE                                                         03520000
               MOVE '2'                   TO F222-NUM-ROLE              03530000
           END-IF.                                                      03540000
                                                                        03550000
      **** RECORD CREATION INFORMATION...                               03560000
           MOVE FUNCTION CURRENT-DATE       TO WS-DATE-STAMPED.         03570000
           MOVE WS-DTE-CREATED              TO F222-DTE-REC-CREATION.   03580000
           MOVE WS-TME-CREATED              TO F222-TME-REC-CREATION.   03590000
           MOVE 'BP13'                      TO F222-NUM-SYSTEM-ID.      03600000
                                                                        03610000
      **** SPOUSE INFORMATION...                                        03620000
           IF (K820-NUM-NRIC-SPOUSE = SPACES OR LOW-VALUES) OR          03630000
              (K820-NUM-MARITAL-STATUS = '1')                           03640000
              MOVE SPACES               TO F222-NUM-IDNTY-NO-SPOUSE     03650000
                                           F222-NUM-IDNTY-TYPE-SPOUSE   03660000
                                           F222-NME-SPOUSE              03670000
                                           F222-DTE-MARRIAGE            03680000
           ELSE                                                         03690000
              MOVE K820-NUM-NRIC-SPOUSE TO F222-NUM-IDNTY-NO-SPOUSE     03700000
              IF K820-NUM-NRIC-SPOUSE(1:1) = 'S' OR 'T'                 03710000
                 MOVE 'UIN'             TO F222-NUM-IDNTY-TYPE-SPOUSE   03720000
              ELSE                                                      03730000
                 IF K820-NUM-NRIC-SPOUSE(1:1) = 'F' OR 'G' OR 'M'       03740001
                    MOVE 'FIN'          TO F222-NUM-IDNTY-TYPE-SPOUSE   03750000
                 ELSE                                                   03760000
                    MOVE 'XIN'          TO F222-NUM-IDNTY-TYPE-SPOUSE   03770000
                 END-IF                                                 03780000
              END-IF                                                    03790000
                                                                        03800000
              MOVE SPACES                            TO BP13K820-REC    03810000
              INITIALIZE                                BP13K820-REC    03820000
                                                                        03830000
              MOVE F410-NUM-REGN                     TO K820-NUM-REGN   03840000
              MOVE WS-K820-NRIC-SPOUSE(WS-WRITE-CNT) TO K820-NUM-NRIC   03850000
                                                                        03860000
              PERFORM 345-READ-BP13K820    THRU 345-EXIT                03870000
                                                                        03880000
              IF K820-NME-OCCP = SPACES OR LOW-VALUES                   03890000
                 MOVE SPACES         TO F222-NME-SPOUSE                 03900000
              ELSE                                                      03910000
                 MOVE K820-NME-OCCP  TO F222-NME-SPOUSE                 03920000
              END-IF                                                    03930000
                                                                        03940000
              MOVE '00010101'        TO F222-DTE-MARRIAGE               03950000
                                                                        03960000
           END-IF.                                                      03970000
                                                                        03980000
                                                                        03990000
           WRITE F222-SALE-REC.                                         04000000
           ADD 1 TO WS-F222-WRITE-CNT.                                  04010000
                                                                        04020000
                                                                        04030000
       340-EXIT.                                                        04040000
           EXIT.                                                        04050000
                                                                        04060000
       345-READ-BP13K820.                                               04070000
                                                                        04080000
           READ BP13K820                                                04090000
           IF WS-K820-STATUS = ZEROS                                    04100000
              CONTINUE                                                  04110000
           ELSE                                                         04120000
              DISPLAY 'RECORD NOT FOUND IN BP13K820'                    04130000
              DISPLAY 'K820-KEY-FLD : ' K820-KEY-FLD                    04140000
           END-IF.                                                      04150000
                                                                        04160000
       345-EXIT.                                                        04170000
           EXIT.                                                        04180000
                                                                        04190000
       350-READ-BP13K800.                                               04200000
           MOVE F410-NUM-REGN  TO K800-NUM-REGN.                        04210000
           READ BP13K800.                                               04220000
                                                                        04230000
           IF WS-K800-STATUS = ZEROS OR 02                              04240000
              ADD  1                 TO WS-K800-READ-CNT                04250000
              MOVE K800-NUM-NRIC1    TO WS-NRIC1                        04260000
              MOVE K800-NUM-NRIC2    TO WS-NRIC2                        04270000
              MOVE K800-NUM-NRIC3    TO WS-NRIC3                        04280000
              MOVE K800-NUM-NRIC4    TO WS-NRIC4                        04290000
           ELSE                                                         04300000
           IF WS-K800-STATUS  = 23                                      04310000
              DISPLAY 'RECORD NOT FOUND IN BP13K800'                    04320000
              DISPLAY 'K800-REG-NO = ' K800-NUM-REGN                    04330000
           ELSE                                                         04340000
              DISPLAY 'READ ERROR, BP13K800 STATUS = ' WS-K800-STATUS   04350000
              MOVE WS-K800-STATUS TO RETURN-CODE                        04360000
              PERFORM 600-CLOSING-ROUTINE THRU 600-EXIT.                04370000
                                                                        04380000
       350-EXIT.                                                        04390000
           EXIT.                                                        04400000
                                                                        04410000
       360-TRANSFER-TO-ARRAY.                                           04420000
                                                                        04430000
           ADD  1                    TO WS-REC-CNT.                     04440000
           MOVE K820-NUM-NRIC        TO WS-K820-NRIC(WS-REC-CNT).       04450000
                                                                        04460000
           IF K820-NUM-NRIC-SPOUSE = SPACES OR LOW-VALUES               04470000
              MOVE SPACES                                               04480000
                                     TO WS-K820-NRIC-SPOUSE(WS-REC-CNT) 04490000
           ELSE                                                         04500000
              MOVE K820-NUM-NRIC-SPOUSE                                 04510000
                                     TO WS-K820-NRIC-SPOUSE(WS-REC-CNT) 04520000
           END-IF.                                                      04530000
                                                                        04540000
       360-EXIT.                                                        04550000
           EXIT.                                                        04560000
                                                                        04570000
       400-OUTPUT-TO-MAF.                                               04580000
                                                                        04590000
      ************                                                      04600000
      * BP133505 *                                                      04610000
      ************                                                      04620000
           IF F410-CDE-SALES-TYPE = '01' OR '10' OR '5B' OR '5C' OR     04630000
                                    '02' OR '03' OR '2B' OR '3A' OR     04640000
                                    '13' OR '14' OR '15' OR '18' OR     04650000
                                    '19'                                04660000
              NEXT SENTENCE                                             04670000
           ELSE                                                         04680000
              ADD 1                 TO  WS-F410-BYPASS-CNT              04690000
              PERFORM 300-READ-F410-REC THRU 300-EXIT                   04700000
              GO TO 400-EXIT.                                           04710000
                                                                        04720000
      **** START ROUTINE FOR BP13F222 OUTPUT....                        04730000
           MOVE SPACES                       TO  WS-NRIC-ARRAY.         04740000
           MOVE ZEROES                       TO  WS-REC-CNT.            04750000
                                                                        04760000
           PERFORM 350-READ-BP13K800         THRU 350-EXIT.             04770000
                                                                        04780000
           IF WS-K800-STATUS = ZEROS                                    04790000
                                                                        04800000
              IF K800-NUM-ELIG-SCHEME = 'FS'                            04810000
                 PERFORM 410-UPDATE-BP13K399 THRU 410-EXIT              04820000
              END-IF                                                    04830000
                                                                        04840000
              PERFORM 310-START-BP13K820     THRU 310-EXIT              04850000
              PERFORM 330-BROWSE-BP13K820    THRU 330-EXIT              04860000
                 UNTIL WS-K820-EOF OR                                   04870000
                       (WS-K820-REGN NOT = F410-NUM-REGN)               04880000
              PERFORM 340-WRITE-BP13F222     THRU 340-EXIT              04890000
                 VARYING WS-WRITE-CNT FROM 1 BY 1                       04900000
                 UNTIL (WS-WRITE-CNT > WS-REC-CNT)                      04910000
           END-IF.                                                      04920000
      **** END ROUTINE FOR BP13F222 OUTPUT...                           04930000
                                                                        04940000
           PERFORM 300-READ-F410-REC THRU 300-EXIT.                     04950000
                                                                        04960000
       400-EXIT.                                                        04970000
           EXIT.                                                        04980000
                                                                        04990000
      *-----------------------------------------------------------------05000000
       410-UPDATE-BP13K399.                                             05010000
      *-----------------------------------------------------------------05020000
                                                                        05030000
           MOVE SPACES                      TO BP13K399-REC             05040000
                                               WS-K399-FND.             05050000
           INITIALIZE BP13K399-REC.                                     05060000
                                                                        05070000
           MOVE F410-NUM-REGN               TO K399-NUM-REGN            05080000
           MOVE F410-NRIC1                  TO K399-NUM-NRIC            05090000
                                                                        05100000
           READ BP13K399                                                05110000
                                                                        05120000
           EVALUATE WS-K399-STATUS                                      05130000
               WHEN 00                                                  05140000
                    MOVE 'Y'                TO WS-K399-FND              05150000
               WHEN 23                                                  05160000
                    MOVE 'N'                TO WS-K399-FND              05170000
               WHEN OTHER                                               05180000
                    DISPLAY 'READ ERROR, BP13K399 STATUS = '            05190000
                                              WS-K399-STATUS            05200000
           END-EVALUATE.                                                05210000
                                                                        05220000
           IF WS-K399-FND = 'Y'                                         05230000
              IF K399-DTE-MC-DEFER =  SPACES OR ZEROES OR LOW-VALUES    05240000
                                                                        05250000
                 PERFORM 415-CHK-DEFER-DT   THRU 415-EXIT               05260000
                                                                        05270000
                 IF WS-K399-WRITE = 'Y'                                 05280000
                                                                        05290000
                    MOVE WS-SYSTEM-DATE        TO K399-DTE-UPDATE       05300000
                    MOVE 'P13C448'             TO K399-NUM-USERID       05310000
                                                                        05320000
                    REWRITE BP13K399-REC                                05330000
                                                                        05340000
                    IF WS-K399-STATUS = 00                              05350000
                       ADD 1                   TO WS-K399-UPDT-CNT      05360000
                    ELSE                                                05370000
                       DISPLAY 'RE-WRITE ERROR IN BP13K399, KEY: '      05380000
                            K399-KEY-FLD ' RETURN CODE: ' WS-K399-STATUS05390000
                       MOVE WS-K399-STATUS     TO RETURN-CODE           05400000
                       PERFORM 600-CLOSING-ROUTINE THRU 600-EXIT        05410000
                    END-IF                                              05420000
                 END-IF                                                 05430000
              END-IF                                                    05440000
           END-IF                                                       05450000
                                                                        05460000
           IF WS-K399-FND = 'N'                                         05470000
              MOVE SPACES                   TO BP13K399-REC             05480000
              INITIALIZE BP13K399-REC                                   05490000
                                                                        05500000
              MOVE F410-NUM-REGN            TO K399-NUM-REGN            05510000
              MOVE F410-NRIC1               TO K399-NUM-NRIC            05520000
              MOVE F410-NAME1               TO K399-NME-OCCP            05530000
                                                                        05540000
              PERFORM 415-CHK-DEFER-DT      THRU 415-EXIT               05550000
                                                                        05560000
              IF WS-K399-WRITE = 'Y'                                    05570000
                                                                        05580000
                 MOVE WS-SYSTEM-DATE        TO K399-DTE-UPDATE          05590000
                 MOVE 'P13C448'             TO K399-NUM-USERID          05600000
                                                                        05610000
                 WRITE BP13K399-REC                                     05620000
                                                                        05630000
                 IF WS-K399-STATUS  = 00                                05640000
                    ADD 1                   TO WS-K399-WRIT-CNT         05650000
                 ELSE                                                   05660000
                    DISPLAY 'WRITE ERROR IN BP13K399, KEY: '            05670000
                                                           K399-KEY-FLD 05680000
                    MOVE WS-K399-STATUS     TO RETURN-CODE              05690000
                    PERFORM 600-CLOSING-ROUTINE THRU 600-EXIT           05700000
                 END-IF                                                 05710000
              END-IF                                                    05720000
           END-IF.                                                      05730000
                                                                        05740000
       410-EXIT.                                                        05750000
           EXIT.                                                        05760000
                                                                        05770000
      *---------------------------------------------------------------- 05780000
       415-CHK-DEFER-DT.                                                05790000
      *---------------------------------------------------------------- 05800000
                                                                        05810000
           IF K800-DTE-AHG-PROCESS NOT NUMERIC                          05820000
              MOVE ZEROES                   TO K800-DTE-AHG-PROCESS.    05830000
           IF K800-DTE-DELIVERY-POSSN NOT NUMERIC                       05840000
              MOVE ZEROES                   TO K800-DTE-DELIVERY-POSSN. 05850000
                                                                        05860000
           MOVE 'N'                         TO WS-K399-WRITE.           05870000
                                                                        05880000
           IF K800-DTE-BALLOT(1:6) < '201805'                           05890000
              IF K800-DTE-AHG-PROCESS = ZEROES                          05900000
                                                                        05910000
                 PERFORM 416-READ-BM06K110  THRU 416-EXIT               05920000
                                                                        05930000
                 IF K110-DTE-ACCEPTANCE < K110-DTE-KEY-AVAIL            05940000
                    MOVE 'Y'                     TO WS-K399-WRITE       05950000
                    MOVE K800-DTE-DELIVERY-POSSN TO K399-DTE-MC-DEFER   05960000
                 END-IF                                                 05970000
              END-IF                                                    05980000
           END-IF.                                                      05990000
                                                                        06000000
       415-EXIT.                                                        06010000
           EXIT.                                                        06020000
                                                                        06030000
      *-----------------------------------------------------------------06040000
       416-READ-BM06K110.                                               06050000
      *-----------------------------------------------------------------06060000
                                                                        06070000
           INITIALIZE K110-REC.                                         06080000
           MOVE K800-NUM-SCH-ACC            TO K110-SCH-ACC-NO          06090000
                                                                        06100000
           READ BM06K110.                                               06110000
                                                                        06120000
           EVALUATE WS-K110-STATUS                                      06130000
               WHEN 00                                                  06140000
                    CONTINUE                                            06150000
               WHEN 23                                                  06160000
                    DISPLAY 'RECORD NOT FOUND IN BM06K110, KEY: '       06170000
                                                          K110-KEY-FLD  06180000
               WHEN OTHER                                               06190000
                    DISPLAY 'READ ERROR, BM06K110 STATUS = '            06200000
                                              WS-K110-STATUS            06210000
                    MOVE WS-K110-STATUS     TO RETURN-CODE              06220000
                    PERFORM 600-CLOSING-ROUTINE THRU 600-EXIT           06230000
           END-EVALUATE.                                                06240000
                                                                        06250000
           IF K110-DTE-ACCEPTANCE  NOT NUMERIC                          06260000
              MOVE ZEROES                   TO K110-DTE-ACCEPTANCE.     06270000
           IF K110-DTE-KEY-AVAIL   NOT NUMERIC                          06280000
              MOVE ZEROES                   TO K110-DTE-KEY-AVAIL.      06290000
                                                                        06300000
       416-EXIT.                                                        06310000
           EXIT.                                                        06320000
                                                                        06330000
       600-CLOSING-ROUTINE.                                             06340000
           DISPLAY '******************* BP13C448 *********************'.06350000
           DISPLAY 'RUN DATE : ' WS-DD '/' WS-MM '/' WS-YY.             06360000
           DISPLAY SPACES.                                              06370000
           DISPLAY ' NO. OF BP13F410 RECORDS READ    : '                06380000
                     WS-F410-READ-CNT.                                  06390000
           DISPLAY ' NO. OF BP13F410 RECORDS BYPASS  : '                06400000
                     WS-F410-BYPASS-CNT.                                06410000
           DISPLAY ' NO. OF BP13K800 RECORDS READ    : '                06420000
                     WS-K800-READ-CNT.                                  06430000
           DISPLAY ' NO. OF BP13K820 RECORDS READ    : '                06440000
                     WS-K820-READ-CNT.                                  06450000
           DISPLAY ' NO. OF BP13F222 RECORDS WRITTEN : '                06460000
                     WS-F222-WRITE-CNT.                                 06470000
           DISPLAY ' NO. OF BP13K399 RECORDS UPDATED : '                06480000
                     WS-K399-UPDT-CNT.                                  06490000
           DISPLAY ' NO. OF BP13K399 RECORDS WRITTEN : '                06500000
                     WS-K399-WRIT-CNT.                                  06510000
           DISPLAY '******************* -------- *********************'.06520000
           CLOSE BP13F410                                               06530000
                 BP13K820                                               06540000
                 BP13K800                                               06550000
                 BP13K399                                               06560000
                 BM06K110                                               06570000
                 BE03F222.                                              06580000
                                                                        06590000
           IF WS-K820-STATUS NOT = ZEROS AND 97                         06600000
              MOVE WS-K820-STATUS        TO  RETURN-CODE                06610000
              DISPLAY 'ERROR CLOSING BP13K820!  FILE STATUS IS '        06620000
                       WS-K820-STATUS '.'.                              06630000
                                                                        06640000
           IF WS-K800-STATUS NOT = ZEROS AND 97                         06650000
              MOVE WS-K800-STATUS        TO  RETURN-CODE                06660000
              DISPLAY 'ERROR CLOSING BP13K800!  FILE STATUS IS '        06670000
                       WS-K800-STATUS '.'.                              06680000
                                                                        06690000
           IF WS-K399-STATUS NOT = ZEROS AND 97                         06700000
              MOVE WS-K399-STATUS        TO  RETURN-CODE                06710000
              DISPLAY 'ERROR CLOSING BP13K399!  FILE STATUS IS '        06720000
                       WS-K399-STATUS '.'.                              06730000
                                                                        06740000
           IF WS-K110-STATUS NOT = ZEROS AND 97                         06750000
              MOVE WS-K110-STATUS        TO  RETURN-CODE                06760000
              DISPLAY 'ERROR CLOSING BM06K110!  FILE STATUS IS '        06770000
                       WS-K110-STATUS '.'.                              06780000
                                                                        06790000
           STOP RUN.                                                    06800000
                                                                        06810000
       600-EXIT.                                                        06820000
           EXIT.                                                        06830000
                                                                        06840000
