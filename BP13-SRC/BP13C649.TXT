       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    BP13C649.                                                 
       AUTHOR.        RAYATHATHA ASHOK.                                         
      *DATE-WRITTEN.  30/03/92.                                                 
      **********************************************************                
      *   OBJECTIVE    :                                       *                
      *      TO PRINT LIST OF SA-TP CASES WHEN THE CPF PAYMENT *                
      *      HAS COME IN THROUGH SMS.                          *                
      *                                                        *                
      *    INPUT FILE :                                        *                
      *        1. BP13T.F650.PREPVRCH (BP13F650)               *                
      *        2. BP13T.K410.         (BP13F410)               *                
      *        3. AB03T.K045.TXHIST1  (AB03K045)               *                
      *        4. AB03T.K046.TXHIST2  (AB03K046)               *                
      *        5. AB03T.K047.TXHIST3  (AB03K047)               *                
      *        6. BP13T.K650.PREPVRCH (BP13K650)               *                
      *    REPORT :                                            *                
      *        1. BP13L649   - 'SOC INTERFACE WITH VOUCHER     *                
      *                     SYSTEM DETAILED RECORD OF REFUND'  *                
      *                     FOR SA & TP CASES                  *                
      * CHG REQ   OIC   DATE   DESCRIPTION                     *                
      * =======   ===   ====   ===========                     *                
      * C930317   LMS  040893  TO CHANGE B01K084 TO AB03K045   *                
      *                                  B01K085 TO AB03K046   *                
      *                                  B01K086 TO AB03K047   *                
      *                        DUE TO SMS CHANGES              *                
      * SOC-PH8   RML  080593  EXPAND REGN AND NRIC            *                
      * C950330   LJL  240395  TO CATER FOR BK FEE REFUND FOR  *                
      *                        AA CASES.                       *                
      * BP130415  LJL  080198  TO CATER FOR SERS CASES.        *                
      * BP130418  SGK  290898  TO CATER FOR Y2K.               *                
      * BP135230  PCL4 050314  TO ADD ICP CASH                 *                
      * BP135230  PCL4 110314  TO TAG '*' WHEN ICP-CASH + CPF-L*                
      *                                                 = ICP  *                
      * BP135616  JGO1 090315  CHANGE LENGTH OF F/K650 TO 500  *                
      * BP136994  PCL4 061017  TO ADD NEW FIELDS FOR BP13L649  *                
      * BP137937  KV5  250719  WRITE '*' RECORDS TO BP13L649 & *                
      *                        ' ' RECORDS TO P13L649A.        *                
      **********************************************************                
       ENVIRONMENT    DIVISION.                                                 
      *-----------------------*                                                 
       CONFIGURATION  SECTION.                                                  
      *-----------------------*                                                 
       SOURCE-COMPUTER.   IBM-3090.                                             
       OBJECT-COMPUTER.   IBM-3090.                                             
                                                                                
                                                                                
       INPUT-OUTPUT SECTION.                                                    
      *-----------------------*                                                 
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F650 ASSIGN       TO BP13F650.                            
           SELECT BP13K650 ASSIGN       TO BP13K650                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE IS DYNAMIC                               
                           RECORD KEY IS K650-KEY-FLD                           
                           FILE STATUS IS WS-K650-STATUS.                       
                                                                                
           SELECT BP13K800 ASSIGN       TO BP13K800                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K800-NUM-REGN                        
                           FILE STATUS  IS WS-K800-STATUS.                      
                                                                                
           SELECT BP13K893 ASSIGN       TO BP13K893                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS DYNAMIC                              
                           RECORD KEY   IS K893-KEY-FLD                         
                           FILE STATUS  IS WS-K893-STATUS.                      
                                                                                
           SELECT BP13K410 ASSIGN       TO BP13K410                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE IS DYNAMIC                               
                           RECORD KEY IS K410-KEY-FLD                           
                           FILE STATUS IS WS-K410-STATUS.                       
                                                                                
           SELECT AB03K045 ASSIGN       TO AB03K045                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE IS DYNAMIC                               
                           RECORD KEY IS K045-KEY                               
                           FILE STATUS IS WS-K045-STATUS.                       
                                                                                
           SELECT AB03K046 ASSIGN       TO AB03K046                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE IS DYNAMIC                               
                           RECORD KEY IS K046-KEY                               
                           FILE STATUS IS WS-K046-STATUS.                       
                                                                                
           SELECT AB03K047 ASSIGN       TO AB03K047                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE IS DYNAMIC                               
                           RECORD KEY IS K047-KEY                               
                           FILE STATUS IS WS-K047-STATUS.                       
                                                                                
           SELECT BP13L649 ASSIGN       TO BP13L649.                            
           SELECT P13L649A ASSIGN       TO P13L649A.                            
                                                                                
                                                                                
       DATA DIVISION.                                                           
      *-----------------------*                                                 
       FILE SECTION.                                                            
      *-----------------------*                                                 
       FD   BP13F650          BLOCK  CONTAINS    0 RECORDS                      
                              RECORD CONTAINS  500 CHARACTERS                   
                              LABEL  RECORDS STANDARD                           
                              RECORDING MODE IS F.                              
       COPY BP13F650.                                                           
                                                                                
       FD   BP13K650          RECORD CONTAINS 500 CHARACTERS.                   
       COPY BP13K650.                                                           
                                                                                
       FD   BP13K800          RECORD CONTAINS 2000 CHARACTERS.                  
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K893          RECORD CONTAINS 2050 CHARACTERS.                  
       COPY BP13K893.                                                           
                                                                                
       FD   BP13K410          RECORD CONTAINS 2000 CHARACTERS.                  
       COPY BP13K410.                                                           
                                                                                
       FD   AB03K045          RECORD CONTAINS 57 CHARACTERS.                    
       COPY AB03K045.                                                           
                                                                                
       FD   AB03K046          RECORD CONTAINS 57 CHARACTERS.                    
       COPY AB03K046.                                                           
                                                                                
       FD   AB03K047          RECORD CONTAINS 57 CHARACTERS.                    
       COPY AB03K047.                                                           
                                                                                
       FD   BP13L649          BLOCK  CONTAINS   0 RECORDS                       
                              RECORD CONTAINS 132 CHARACTERS                    
                              LABEL RECORDS  OMITTED                            
                              RECORDING MODE IS F.                              
       01  BP13L649-REC       PIC X(132).                                       
                                                                                
       FD   P13L649A          BLOCK  CONTAINS   0 RECORDS                       
                              RECORD CONTAINS 132 CHARACTERS                    
                              LABEL RECORDS  OMITTED                            
                              RECORDING MODE IS F.                              
       01  P13L649A-REC       PIC X(132).                                       
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *------------------------*                                                
       01  WS-FLG.                                                              
           05  WS-EOF-F650          PIC X(3)     VALUE 'NO '.                   
               88  END-OF-F650                   VALUE 'YES'.                   
                                                                                
           05  WS-EOF-K045          PIC X(3)     VALUE 'NO '.                   
               88  END-OF-K045                   VALUE 'YES'.                   
                                                                                
           05  WS-EOF-K046          PIC X(3)     VALUE 'NO '.                   
               88  END-OF-K046                   VALUE 'YES'.                   
                                                                                
           05  WS-EOF-K047          PIC X(3)     VALUE 'NO '.                   
               88  END-OF-K047                   VALUE 'YES'.                   
                                                                                
       01  WS-K650-KEY.                                                         
           05  WS-K650-RESERVE     PIC X         VALUE SPACE.                   
           05  WS-K650-REGN        PIC X(8)      VALUE SPACES.                  
                                                                                
       01  WS-CNT.                                                              
           05  WS-SNO              PIC 9(7)      VALUE ZEROES.                  
           05  WS-SNO1             PIC 9(7)      VALUE ZEROES.                  
           05  WS-COUNT            PIC 9(5)      VALUE ZERO.                    
           05  WS-COUNTA           PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-F650         PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-K650         PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-K045         PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-K046         PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-K047         PIC 9(5)      VALUE ZERO.                    
           05  WS-CNT-K410         PIC 9(5)      VALUE ZERO.                    
           05  WS-K045-READ        PIC 9(5)      VALUE ZERO.                    
           05  WS-K046-READ        PIC 9(5)      VALUE ZERO.                    
           05  WS-K047-READ        PIC 9(5)      VALUE ZERO.                    
           05  WS-LINE             PIC 9(2)      VALUE 60.                      
           05  WS-TAG              PIC X         VALUE SPACE.                   
           05  WS-PAGE             PIC 9(4)      VALUE ZEROES.                  
           05  WS-K800-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K893-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K410-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K650-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K045-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K046-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-K047-STATUS      PIC 99        VALUE ZEROES.                  
           05  WS-ICP-TOT          PIC 9(7)V99   VALUE ZEROES.                  
           05  WS-ICP              PIC 9(7)V99   VALUE ZEROES.                  
           05  WS-ICP-CASH         PIC 9(7)V99   VALUE ZEROES.                  
           05  WS-CPF-L            PIC 9(7)V99   VALUE ZEROES.                  
           05  WS-SNO-ZZZZ9        PIC ZZZZ9     VALUE ZEROES.                  
           05  WS-SNO1-ZZZZ9       PIC ZZZZ9     VALUE ZEROES.                  
           05  WS-SCH-ACCT.                                                     
               10 WS-NUM-SCH-ACCT  PIC X(11).                                   
                                                                                
       01  WS-CURR-DATE.                                                        
           05  WS-CURR-YYYY        PIC X(4)      VALUE SPACES.                  
           05  WS-CURR-MM          PIC X(2)      VALUE SPACES.                  
           05  WS-CURR-DD          PIC X(2)      VALUE SPACES.                  
                                                                                
       01  WS-EDITED-DATE.                                                      
           05  WS-EDITED-DD        PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X         VALUE '/'.                     
           05  WS-EDITED-MM        PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X         VALUE '/'.                     
           05  WS-EDITED-YYYY      PIC X(4)      VALUE SPACES.                  
                                                                                
       01  WS-NUM-STUDIO           PIC X(1)      VALUE SPACES.                  
                                                                                
       01  WS-ADDRESS.                                                          
                                                                                
           05  FILLER              PIC X(4)      VALUE 'BLK '.                  
           05  WS-BLK              PIC X(5)      VALUE SPACES.                  
           05  FILLER              PIC X(2)      VALUE ' #'.                    
           05  WS-LEVEL            PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X         VALUE '-'.                     
           05  WS-MAIN             PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X         VALUE SPACE.                   
           05  WS-STREET           PIC X(20)     VALUE SPACES.                  
                                                                                
                                                                                
      *----------------------------------------*                                
      *   FORMAT OF THE VOUCHER LISTING        *                                
      *----------------------------------------*                                
                                                                                
       01  WS-L649-HDG1.                                                        
           05  FILLER              PIC X(8)      VALUE 'BP13L649'.              
           05  FILLER              PIC X(39)     VALUE SPACES.                  
           05  FILLER              PIC X(39)     VALUE                          
           'S Y S T E M   O F   C O M M I T M E N T'.                           
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE : '.               
           05  L649-DATE           PIC X(10).                                   
           05  FILLER              PIC X(3)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  L649-PAGE           PIC 9(3).                                    
                                                                                
       01  WS-L649-HDG1A.                                                       
           05  FILLER              PIC X(8)      VALUE 'P13L649A'.              
           05  FILLER              PIC X(39)     VALUE SPACES.                  
           05  FILLER              PIC X(39)     VALUE                          
           'S Y S T E M   O F   C O M M I T M E N T'.                           
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE : '.               
           05  L649-DATEA          PIC X(10).                                   
           05  FILLER              PIC X(3)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  L649-PAGEA          PIC 9(3).                                    
                                                                                
       01  WS-L649-HDG2.                                                        
           05  FILLER              PIC X(33)     VALUE SPACES.                  
           05  FILLER              PIC X(67)     VALUE                          
                 'SOC INTERFACE WITH VOUCHER SYSTEM - DETAILED RECORD OF        
      -          ' REFUND CASES'.                                               
                                                                                
       01  WS-L649-HDG3.                                                        
           05  FILLER              PIC X(49)     VALUE SPACES.                  
           05  FILLER              PIC X(35)     VALUE                          
           'FOR SA & TP CASES ( ICP HAS COMEIN)'.                               
                                                                                
       01  WS-L649-HDG3A.                                                       
           05  FILLER              PIC X(49)     VALUE SPACES.                  
           05  FILLER              PIC X(35)     VALUE                          
           'FOR AA      CASES ( ICP HAS COMEIN)'.                               
                                                                                
       01  WS-L649-HDG4.                                                        
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(5)      VALUE '  S/N'.                 
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(6)      VALUE 'REGN  '.                
           05  FILLER              PIC X(3)      VALUE SPACES.                  
           05  FILLER              PIC X(2)      VALUE 'FT'.                    
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(4)      VALUE 'NAME'.                  
           05  FILLER              PIC X(28)     VALUE SPACES.                  
           05  FILLER              PIC X(4)      VALUE 'NRIC'.                  
           05  FILLER              PIC X(7)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'ICP-CASH'.              
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  FILLER              PIC X(6)      VALUE 'BK-FEE'.                
           05  FILLER              PIC X(5)      VALUE SPACES.                  
           05  FILLER              PIC X(5)      VALUE 'CPF-L'.                 
           05  FILLER              PIC X(5)      VALUE SPACES.                  
           05  FILLER              PIC X(3)      VALUE 'ICP'.                   
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'SO-DATE'.               
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X(3)      VALUE 'TAG'.                   
                                                                                
       01  WS-L649-DTL.                                                         
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-SN             PIC X(5).                                    
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-REGNO          PIC X(8).                                    
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-FT             PIC X(2).                                    
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-NAME           PIC X(31).                                   
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-NRIC           PIC X(9).                                    
           05  FILLER              PIC X(1)      VALUE SPACES.                  
      *    05  L649-ADDRESS        PIC X(41).                                   
      *    05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-ICP-CASH       PIC ZZZZZ9.99.                               
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-BKFEE          PIC ZZZ9.99.                                 
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-CPF            PIC ZZZZZ9.99.                               
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-ICP            PIC ZZZZZ9.99.                               
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  L649-SOCA-DATE      PIC X(10).                                   
      *    05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L649-TAG            PIC X.                                       
                                                                                
       PROCEDURE      DIVISION.                                                 
      *-----------------------*                                                 
                                                                                
       000-CONTROL.                                                             
                                                                                
           PERFORM 100-OPEN-FILES      THRU 100-EXIT.                           
           PERFORM 200-READ-F650       THRU 200-EXIT.                           
           PERFORM 300-MAIN-ROUTINE    THRU 300-EXIT UNTIL                      
                   END-OF-F650.                                                 
           PERFORM 9999-WRAP-UP.                                                
                                                                                
       000-EXIT.                                                                
           STOP RUN.                                                            
                                                                                
      ***-----------***                                                         
       100-OPEN-FILES.                                                          
      ***-----------***                                                         
                                                                                
           OPEN INPUT BP13F650                                                  
                      AB03K045                                                  
                      AB03K046                                                  
                      AB03K047                                                  
                      BP13K410                                                  
                      BP13K800                                                  
                      BP13K893                                                  
                      BP13K650                                                  
               OUTPUT BP13L649                                                  
                      P13L649A.                                                 
                                                                                
                                                                                
           IF  WS-K650-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF BP13K650 - STATUS CODE'                   
                        WS-K650-STATUS                                          
               MOVE     WS-K650-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K800-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF BP13K800 - STATUS CODE'                   
                        WS-K800-STATUS                                          
               MOVE     WS-K800-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K893-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF BP13K893 - STATUS CODE'                   
                        WS-K893-STATUS                                          
               MOVE     WS-K893-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K410-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF BP13K410 - STATUS CODE'                   
                        WS-K410-STATUS                                          
               MOVE     WS-K410-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K045-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF AB03K045 - STATUS CODE'                   
                        WS-K045-STATUS                                          
               MOVE     WS-K045-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K046-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF AB03K046 - STATUS CODE'                   
                        WS-K046-STATUS                                          
               MOVE     WS-K046-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           IF  WS-K047-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR OPEN OF AB03K047 - STATUS CODE'                   
                        WS-K047-STATUS                                          
               MOVE     WS-K047-STATUS TO RETURN-CODE                           
               GO TO 9999-WRAP-UP.                                              
                                                                                
           MOVE  'NO'          TO WS-EOF-F650.                                  
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***-----------***                                                         
       200-READ-F650.                                                           
      ***-----------***                                                         
                                                                                
           READ BP13F650 AT END                                                 
                MOVE  'YES' TO WS-EOF-F650                                      
               GO TO 200-EXIT.                                                  
                                                                                
           ADD 1 TO WS-CNT-F650.                                                
                                                                                
           MOVE  ZEROS                   TO  WS-CPF-L                           
                                             WS-ICP                             
                                             WS-ICP-CASH.                       
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***--------------***                                                      
       300-MAIN-ROUTINE.                                                        
      ***--------------***                                                      
                                                                                
      *    MOVE F650-NUM-REGN     TO WS-K650-REGN.                              
           MOVE F650-KEY-FLD   TO K650-KEY-FLD.                                 
           MOVE F650-NUM-REGN     TO K410-KEY-FLD.                              
                                                                                
           PERFORM 400-READ-K410  THRU 400-EXIT.                                
           PERFORM 401-READ-K800  THRU 401-EXIT.                                
           PERFORM 500-READ-K650  THRU 500-EXIT.                                
                                                                                
           IF K410-SCHEME < '7680'                                              
              PERFORM 600-READ-K045  THRU 600-EXIT                              
           ELSE                                                                 
           IF K410-SCHEME < '8344'                                              
              PERFORM 620-READ-K046  THRU 620-EXIT                              
           ELSE                                                                 
              PERFORM 640-READ-K047  THRU 640-EXIT.                             
                                                                                
                                                                                
           IF WS-ICP = ZEROS                                                    
              NEXT SENTENCE                                                     
           ELSE                                                                 
              PERFORM 700-PROCESS-UPDATE THRU 700-EXIT.                         
                                                                                
           PERFORM 200-READ-F650     THRU 200-EXIT.                             
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       400-READ-K410.                                                           
      ***------------***                                                        
                                                                                
           READ BP13K410.                                                       
                                                                                
           IF WS-K410-STATUS NOT = 00 AND 02                                    
              DISPLAY 'ERROR READING BP13K410 ' WS-K410-STATUS                  
              CONTINUE                                                          
      *       MOVE WS-K410-STATUS TO RETURN-CODE                                
      *       GO TO 9999-WRAP-UP                                                
           ELSE                                                                 
              COMPUTE WS-ICP-CASH = K410-AMT-ICP-CASH                           
                                                                                
              COMPUTE WS-ICP = K410-AMT-ICP-CASH + K410-AMT-ICP-CPF1 +          
                               K410-AMT-ICP-CPF2 + K410-AMT-ICP-CPF3 +          
                               K410-AMT-ICP-CPF4                                
                                                                                
              ADD 1 TO WS-CNT-K410.                                             
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       401-READ-K800.                                                           
      ***------------***                                                        
                                                                                
           MOVE SPACES          TO BP13K800-MASTER.                             
           INITIALIZE              BP13K800-MASTER.                             
                                                                                
           MOVE F650-NUM-REGN   TO K800-NUM-REGN.                               
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-K800-STATUS                                              
               WHEN 00                                                          
                    CONTINUE                                                    
                                                                                
               WHEN 10                                                          
               WHEN 23                                                          
                    PERFORM 402-START-K893       THRU 402-EXIT                  
                                                                                
               WHEN OTHER                                                       
                    MOVE SPACES                    TO BP13K800-MASTER           
                    DISPLAY 'BP13K800 READ ERROR ' WS-K800-STATUS               
           END-EVALUATE.                                                        
                                                                                
                                                                                
       401-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       402-START-K893.                                                          
      ***------------***                                                        
                                                                                
           MOVE SPACES          TO BP13K893-MASTER.                             
           INITIALIZE              BP13K893-MASTER.                             
                                                                                
           MOVE SPACES          TO K893-KEY-FLD.                                
           MOVE F650-NUM-REGN   TO K893-NUM-REGN-HIST.                          
                                                                                
           START BP13K893 KEY >= K893-KEY-FLD.                                  
                                                                                
           EVALUATE WS-K893-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 403-READ-K893       THRU 403-EXIT                   
                                                                                
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    MOVE SPACES                   TO BP13K800-MASTER            
                    DISPLAY 'ERROR STARTING BP13K893: ' WS-K893-STATUS          
           END-EVALUATE.                                                        
                                                                                
                                                                                
       402-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       403-READ-K893.                                                           
      ***------------***                                                        
                                                                                
            READ  BP13K893 NEXT AT END                                          
                  MOVE SPACES               TO K893-KEY-FLD.                    
                                                                                
            EVALUATE WS-K893-STATUS                                             
                WHEN 00                                                         
                WHEN 02                                                         
                     IF K893-NUM-REGN-HIST = F650-NUM-REGN                      
                        MOVE BP13K893-MASTER(1:2000) TO BP13K800-MASTER         
                     END-IF                                                     
                WHEN 23                                                         
                     CONTINUE                                                   
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP13K893 : ' WS-K893-STATUS         
            END-EVALUATE.                                                       
                                                                                
       403-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       500-READ-K650.                                                           
      ***------------***                                                        
                                                                                
           READ BP13K650.                                                       
                                                                                
           IF WS-K650-STATUS = 00 OR 02                                         
              ADD 1 TO WS-CNT-K650                                              
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K650 ' WS-K650-STATUS                  
              MOVE WS-K650-STATUS TO RETURN-CODE                                
              GO TO 9999-WRAP-UP.                                               
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       600-READ-K045.                                                           
      ***------------***                                                        
                                                                                
           MOVE SPACES     TO K045-KEY.                                         
           MOVE K410-NUM-SCH-ACC TO K045-NUM-HDB-REF                            
                                    WS-SCH-ACCT.                                
           START AB03K045 KEY >= K045-KEY                                       
                 INVALID KEY                                                    
                  DISPLAY 'K045 INVALID KEY = ' K045-KEY                        
                  GO TO 600-EXIT.                                               
                                                                                
           READ AB03K045 NEXT AT END MOVE 'YES' TO WS-EOF-K045                  
                GO TO 600-EXIT.                                                 
           ADD 1 TO WS-K045-READ.                                               
                                                                                
           IF WS-K045-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K045 ' WS-K045-STATUS                  
              MOVE WS-K045-STATUS  TO RETURN-CODE                               
              GO TO 9999-WRAP-UP.                                               
                                                                                
           PERFORM 601-MATCH-K045 THRU 601-EXIT UNTIL                           
                   K045-NUM-HDB-REF NOT = WS-SCH-ACCT.                          
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       601-MATCH-K045.                                                          
      ***------------***                                                        
                                                                                
           DISPLAY 'SCHEME ACC NO OF K410 ' K410-NUM-SCH-ACC.                   
           IF K045-TXT-DESC = 'CPF-L' OR 'PR-L' OR 'CPF-ICP'                    
              ADD  K045-AMT-TOTL TO WS-CPF-L                                    
              IF K045-TXT-DESC = 'CPF-L' OR 'PR-L'                              
                 DISPLAY ' CPF-L  045    ' K045-AMT-TOTL                        
              ELSE                                                              
                 DISPLAY K045-TXT-DESC ' 045    ' K045-AMT-TOTL                 
              END-IF                                                            
              ADD 1 TO WS-CNT-K045.                                             
                                                                                
           READ AB03K045 NEXT                                                   
           AT END MOVE HIGH-VALUES TO K045-NUM-HDB-REF                          
              GO TO 601-EXIT.                                                   
                                                                                
           IF WS-K045-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K045 ' WS-K045-STATUS                  
              MOVE WS-K045-STATUS TO RETURN-CODE                                
              GO TO 9999-WRAP-UP.                                               
                                                                                
       601-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       620-READ-K046.                                                           
      ***------------***                                                        
                                                                                
           MOVE SPACES     TO K046-KEY.                                         
           MOVE K410-NUM-SCH-ACC TO K046-NUM-HDB-REF                            
                                    WS-SCH-ACCT.                                
           START AB03K046 KEY >= K046-KEY                                       
                 INVALID KEY                                                    
                  DISPLAY 'K046 INVALID KEY = ' K046-KEY                        
                  GO TO 620-EXIT.                                               
                                                                                
           READ AB03K046 NEXT AT END MOVE 'YES' TO WS-EOF-K046                  
                GO TO 620-EXIT.                                                 
           ADD 1 TO WS-K046-READ.                                               
                                                                                
           IF WS-K046-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K046 ' WS-K046-STATUS                  
              MOVE WS-K046-STATUS  TO RETURN-CODE                               
              GO TO 9999-WRAP-UP.                                               
                                                                                
           PERFORM 621-MATCH-K046 THRU 621-EXIT UNTIL                           
                   K046-NUM-HDB-REF NOT = WS-SCH-ACCT.                          
                                                                                
       620-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       621-MATCH-K046.                                                          
      ***------------***                                                        
                                                                                
           DISPLAY 'SCHEME ACC NO OF K410 ' K410-NUM-SCH-ACC.                   
           IF K046-TXT-DESC = 'CPF-L'  OR 'PR-L' OR 'CPF-ICP'                   
              ADD  K046-AMT-TOTL TO WS-CPF-L                                    
              IF K046-TXT-DESC = 'CPF-L' OR 'PR-L'                              
                 DISPLAY ' CPF-L  046    ' K046-AMT-TOTL                        
              ELSE                                                              
                 DISPLAY K046-TXT-DESC ' 046    ' K046-AMT-TOTL                 
              END-IF                                                            
              ADD 1 TO WS-CNT-K046.                                             
                                                                                
           READ AB03K046 NEXT                                                   
           AT END MOVE HIGH-VALUES TO K046-NUM-HDB-REF                          
              GO TO 621-EXIT.                                                   
                                                                                
           IF WS-K046-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K046 ' WS-K046-STATUS                  
              MOVE WS-K046-STATUS TO RETURN-CODE                                
              GO TO 9999-WRAP-UP.                                               
                                                                                
       621-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       640-READ-K047.                                                           
      ***------------***                                                        
                                                                                
           MOVE SPACES     TO K047-KEY.                                         
           MOVE K410-NUM-SCH-ACC TO K047-NUM-HDB-REF                            
                                    WS-SCH-ACCT.                                
           START AB03K047 KEY >= K047-KEY                                       
                 INVALID KEY                                                    
                  DISPLAY 'K047 INVALID KEY = ' K047-KEY                        
                  GO TO 640-EXIT.                                               
                                                                                
           READ AB03K047 NEXT AT END MOVE 'YES' TO WS-EOF-K047                  
                GO TO 640-EXIT.                                                 
           ADD 1 TO WS-K047-READ.                                               
                                                                                
           IF WS-K047-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K047 ' WS-K047-STATUS                  
              MOVE WS-K047-STATUS  TO RETURN-CODE                               
              GO TO 9999-WRAP-UP.                                               
                                                                                
           PERFORM 641-MATCH-K047 THRU 641-EXIT UNTIL                           
                   K047-NUM-HDB-REF NOT = WS-SCH-ACCT.                          
                                                                                
       640-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       641-MATCH-K047.                                                          
      ***------------***                                                        
                                                                                
           DISPLAY 'SCHEME ACC NO OF K410 ' K410-NUM-SCH-ACC.                   
           IF K047-TXT-DESC = 'CPF-L'  OR 'PR-L' OR 'CPF-ICP'                   
              ADD  K047-AMT-TOTL TO WS-CPF-L                                    
              IF K047-TXT-DESC = 'CPF-L' OR 'PR-L'                              
                 DISPLAY ' CPF-L  047    ' K047-AMT-TOTL                        
              ELSE                                                              
                 DISPLAY K047-TXT-DESC ' 047    ' K047-AMT-TOTL                 
              END-IF                                                            
              ADD 1 TO WS-CNT-K047.                                             
                                                                                
           READ AB03K047 NEXT                                                   
           AT END MOVE HIGH-VALUES TO K047-NUM-HDB-REF                          
              GO TO 641-EXIT.                                                   
                                                                                
           IF WS-K047-STATUS NOT = 00                                           
              DISPLAY 'ERROR READING AB03K047 ' WS-K047-STATUS                  
              MOVE WS-K047-STATUS  TO RETURN-CODE                               
              GO TO 9999-WRAP-UP.                                               
                                                                                
       641-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***----------------***                                                    
       700-PROCESS-UPDATE.                                                      
      ***----------------***                                                    
                                                                                
           MOVE 'N'                   TO WS-NUM-STUDIO.                         
                                                                                
           IF WS-CPF-L = ZEROS                                                  
              IF (K800-NUM-IDP-SCHEME = 'SA ')       OR                         
                 (K800-NUM-FLAT-TYPE  = '1A' OR '2A' OR '2F')                   
                  MOVE 'Y'            TO WS-NUM-STUDIO                          
                                                                                
                  COMPUTE WS-CPF-L = K800-AMT-CPF1-PAID +                       
                                     K800-AMT-CPF2-PAID +                       
                                     K800-AMT-CPF3-PAID +                       
                                     K800-AMT-CPF4-PAID                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           COMPUTE WS-ICP-TOT  = WS-ICP-CASH + WS-CPF-L.                        
                                                                                
           IF WS-ICP  = WS-CPF-L                                                
              MOVE '*'    TO WS-TAG                                             
           ELSE                                                                 
           IF WS-ICP <     WS-CPF-L                                             
              MOVE '*'    TO WS-TAG                                             
           ELSE                                                                 
           IF WS-ICP = WS-ICP-TOT                                               
              MOVE '*'    TO WS-TAG                                             
           ELSE                                                                 
              MOVE SPACES TO WS-TAG.                                            
                                                                                
           IF (WS-CPF-L =  ZEROS) AND (WS-NUM-STUDIO = 'N')                     
              NEXT SENTENCE                                                     
              ELSE                                                              
           PERFORM 750-PROCESS-PRINT THRU 750-EXIT.                             
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***----------------***                                                    
       750-PROCESS-PRINT.                                                       
      ***----------------***                                                    
                                                                                
           IF WS-LINE > 55                                                      
             PERFORM 800-PRINT-HEADING THRU 800-EXIT.                           
                                                                                
                                                                                
                                                                                
           ADD     1                     TO WS-LINE.                            
           MOVE  F650-BLK                TO WS-BLK.                             
           MOVE  F650-HSE-MAIN           TO WS-MAIN.                            
           MOVE  F650-HSE-LVL            TO WS-LEVEL.                           
           MOVE  F650-STREET-NAME        TO WS-STREET.                          
           MOVE  F650-NUM-REGN           TO L649-REGNO.                         
           MOVE  K800-NUM-FLAT-TYPE      TO L649-FT.                            
           MOVE  F650-PAYABLE-NAME1      TO L649-NAME.                          
           MOVE  F650-PAYABLE-NRIC1      TO L649-NRIC.                          
      *    MOVE  WS-ADDRESS              TO L649-ADDRESS.                       
           MOVE  WS-ICP-CASH             TO L649-ICP-CASH.                      
           MOVE  F650-AMT-REFUND         TO L649-BKFEE.                         
           MOVE  F650-DTE-SALES-AGREEMENT TO L649-SOCA-DATE.                    
           MOVE  WS-TAG                  TO L649-TAG.                           
           MOVE  WS-CPF-L                TO L649-CPF.                           
           MOVE  WS-ICP                  TO L649-ICP.                           
           IF WS-TAG = '*'                                                      
              ADD 1                      TO WS-SNO                              
              MOVE WS-SNO                TO WS-SNO-ZZZZ9                        
              MOVE  WS-SNO-ZZZZ9         TO L649-SN                             
              WRITE   BP13L649-REC    FROM WS-L649-DTL AFTER 1                  
              MOVE SPACES TO BP13L649-REC                                       
              ADD 1 TO WS-COUNT                                                 
           ELSE                                                                 
              ADD 1                      TO WS-SNO1                             
              MOVE WS-SNO1               TO WS-SNO1-ZZZZ9                       
              MOVE  WS-SNO1-ZZZZ9        TO L649-SN                             
              WRITE   P13L649A-REC    FROM WS-L649-DTL AFTER 1                  
              MOVE SPACES TO P13L649A-REC                                       
              ADD 1 TO WS-COUNTA                                                
           END-IF                                                               
           MOVE  ZEROS                   TO  WS-CPF-L.                          
       750-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***----------------***                                                    
       800-PRINT-HEADING.                                                       
      ***----------------***                                                    
                                                                                
           ADD     1               TO   WS-PAGE.                                
           MOVE    WS-PAGE         TO   L649-PAGE                               
                                        L649-PAGEA.                             
                                                                                
           MOVE    FUNCTION CURRENT-DATE(1:8)   TO   WS-CURR-DATE.              
           MOVE    WS-CURR-YYYY    TO WS-EDITED-YYYY.                           
           MOVE    WS-CURR-MM      TO WS-EDITED-MM.                             
           MOVE    WS-CURR-DD      TO WS-EDITED-DD.                             
           MOVE    WS-EDITED-DATE  TO L649-DATE                                 
                                      L649-DATEA.                               
           WRITE   BP13L649-REC FROM    WS-L649-HDG1 AFTER PAGE.                
           WRITE   P13L649A-REC FROM    WS-L649-HDG1A AFTER PAGE.               
           WRITE   BP13L649-REC FROM    WS-L649-HDG2 AFTER 1.                   
           WRITE   P13L649A-REC FROM    WS-L649-HDG2 AFTER 1.                   
           WRITE   BP13L649-REC FROM    WS-L649-HDG3 AFTER 1.                   
           WRITE   P13L649A-REC FROM    WS-L649-HDG3 AFTER 1.                   
           IF      F650-CDE-SALES-PROCESS = 'AA'                                
           WRITE   BP13L649-REC FROM    WS-L649-HDG3A AFTER 1                   
           WRITE   P13L649A-REC FROM    WS-L649-HDG3A AFTER 1                   
           ELSE                                                                 
           WRITE   BP13L649-REC FROM    WS-L649-HDG3 AFTER 1                    
           WRITE   P13L649A-REC FROM    WS-L649-HDG3 AFTER 1.                   
           WRITE   BP13L649-REC FROM    WS-L649-HDG4 AFTER 2.                   
           WRITE   P13L649A-REC FROM    WS-L649-HDG4 AFTER 2.                   
           MOVE    SPACES          TO   BP13L649-REC.                           
           MOVE    SPACES          TO   P13L649A-REC.                           
           WRITE   BP13L649-REC                   AFTER  1.                     
           WRITE   P13L649A-REC                   AFTER  1.                     
           MOVE    6               TO   WS-LINE.                                
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***------------***                                                        
       9999-WRAP-UP.                                                            
      ***------------***                                                        
                                                                                
           DISPLAY  'PROGRAM ID  :  BP13C649'.                                  
           DISPLAY  ' '.                                                        
           DISPLAY                                                              
           'NO OF RECORDS READ FROM BP13F650   = ' WS-CNT-F650.                 
           DISPLAY                                                              
           'NO OF RECORDS READ FROM AB03K045   = ' WS-CNT-K045.                 
           DISPLAY                                                              
           'NO OF RECORDS READ FROM AB03K046   = ' WS-CNT-K046.                 
           DISPLAY                                                              
           'NO OF RECORDS READ FROM AB03K047   = ' WS-CNT-K047.                 
           DISPLAY                                                              
           'NO OF RECORDS READ FROM BP13K410   = ' WS-CNT-K410.                 
           DISPLAY                                                              
           'NO OF RECORDS PRINTED "*"          = ' WS-COUNT.                    
           DISPLAY                                                              
           'NO OF RECORDS PRINTED              = ' WS-COUNTA.                   
                                                                                
           CLOSE BP13F650                                                       
                 BP13K650                                                       
                 BP13K410                                                       
                 BP13K800                                                       
                 BP13K893                                                       
                 AB03K045                                                       
                 AB03K046                                                       
                 AB03K047                                                       
                 BP13L649                                                       
                 P13L649A.                                                      
                                                                                
           IF  WS-K650-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING BP13K650 - STATUS CODE'                
                        WS-K650-STATUS                                          
               MOVE     WS-K650-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K800-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING BP13K800 - STATUS CODE'                
                        WS-K800-STATUS                                          
               MOVE     WS-K800-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K893-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING BP13K893 - STATUS CODE'                
                        WS-K893-STATUS                                          
               MOVE     WS-K893-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K410-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING BP13K410 - STATUS CODE'                
                        WS-K410-STATUS                                          
               MOVE     WS-K410-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K045-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING AB03K045 - STATUS CODE'                
                        WS-K045-STATUS                                          
               MOVE     WS-K045-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K046-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING AB03K046 - STATUS CODE'                
                        WS-K046-STATUS                                          
               MOVE     WS-K046-STATUS TO RETURN-CODE.                          
                                                                                
           IF  WS-K047-STATUS NOT = 0 AND 97                                    
               DISPLAY 'ERROR IN CLOSING AB03K047 - STATUS CODE'                
                        WS-K047-STATUS                                          
               MOVE     WS-K047-STATUS TO RETURN-CODE.                          
                                                                                
           STOP RUN.                                                            
                                                                                
