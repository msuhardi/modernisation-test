      **************************                                        00010000
       IDENTIFICATION DIVISION.                                         00020000
      **************************                                        00030000
       PROGRAM-ID.    BP13CB0Q.                                         00040000
      *AUTHOR.        PRAKASH.                                          00050000
      *DATE-WRITTEN.  15/05/2020.                                       00060000
                                                                        00070000
      * =========================================================== *   00080000
      * SYSTEM OF COMMITMENT (BP13)                                 *   00090000
      * =========================================================== *   00100000
      *   OBJECTIVE   : THIS PROGRAM CREATES REPORT BASE FILES      *   00110000
      *                 FROM BP13F136 FOR AHG, SHG, AND SUG         *   00120000
      *                 - DO NOT INCLUDE SHORT LEASE FLATS          *   00130000
      *                                                             *   00140000
      *   INPUT FILES :                                             *   00150000
      *   1.  BP13F136                                              *   00160000
      *   2.  BP13K410 - USED TO GET KEY ISSUE DATE                 *   00170000
      *   3.  BP13K800 - USED TO GET SCHACCT, DATE CANCEL,          *   00180000
      *                  CHECK IF NOT SHORT LEASE FLAT              *   00190000
      *   4.  BP13K893 - USED TO GET DATE CANCEL                    *   00200000
      *                  CHECK IF NOT SHORT LEASE FLAT              *   00210000
      *   5.  BP13K130 - USED TO GET RECOVERY                       *   00220000
      *                                                             *   00230000
      *   OUTPUT FILES: REPORT TYPE + BP13F136                      *   00240000
      *   1.  BP13RPT1  - DISBURSEMENTS FOR THE MONTH               *   00250000
      *   2.  BP13RPT2  - RECOVERIES OF GRANTS FOR THE MONTH        *   00260000
      *   3.  BP13RPT3  - KEY ISSUED CASES FOR THE MONTH            *   00270000
      *   4.  BP13RPT5A - CANCELLED CASES                           *   00280000
      *   5.  BP13RPT5B - NON-CANCELLED CASES                       *   00290000
      *                                                             *   00300000
      * CHQ REQ     DATE     BY  DESCRIPTIONS                       *   00310000
      * -------- ---------- ---- ---------------------------------- *   00320000
      * BP138252 15/05/2020 PP11 NEW PROGRAM, REPORTS 1, 2, 3, 5A, 5B   00330000
      * BP138380 26/09/2020 PP11 CATER FOR LEASE TENURE 99 AND SHORT*   00340000
      *                          LEASE 2F, THIS CASE WILL WRITE INTO*   00350000
      *                          REPORT                             *   00360000
      * BP138380 29/09/2020 PP11 CATER FOR NON-CANCELLED CASE, IF   *   00370000
      *                          NUM STATUS IS  NOT 'C' EVEN THOUGH *   00380000
      *                          HAVING CANCELL DATE                *   00390000
      * BP138333 04/11/2020 PP11 CATER FOR NON-CANCELLED CASE, IF   *   00400000
      *                          NUM STATUS IS  NOT 'C' EVEN THOUGH *   00410000
      *                          HAVING CANCELL DATE                *   00420000
      * BP139018 05/01/2022 PP11 CATER FOR LHG CHANGES              *   00430000
      * BP139021 07/01/2022 PP11 SKIP TO WRITE 1 ROOM FLAT IN THE   *   00440000
      *                          REPORT                             *   00450000
      * BP139274 15/09/2022 PP11 SKIP TO WRITE CANCELLED SHORT LEASE*   00460000
      *                          CASES IN REPORT 5A                 *   00470000
      *                                                             *   00480000
      * BP139498 09/02/2023 PP11 CATER TO APPEAR THE LONG LEASE CASE*   00481003
      *                          IN REPROT 5B                       *   00482003
      *                                                             *   00483003
      * =========================================================== *   00490000
                                                                        00500000
       ENVIRONMENT DIVISION.                                            00510000
                                                                        00520000
       CONFIGURATION SECTION.                                           00530000
                                                                        00540000
       SOURCE-COMPUTER. IBM-3090.                                       00550000
       OBJECT-COMPUTER. IBM-3090.                                       00560000
                                                                        00570000
       INPUT-OUTPUT SECTION.                                            00580000
                                                                        00590000
       FILE-CONTROL.                                                    00600000
                                                                        00610000
           SELECT BP13K410 ASSIGN TO BP13K410                           00620000
                  ACCESS MODE     IS RANDOM                             00630000
                  ORGANIZATION    IS INDEXED                            00640000
                  RECORD KEY      IS K410-KEY-FLD                       00650000
                  FILE STATUS     IS K410-STATUS.                       00660000
                                                                        00670000
           SELECT BP13K893 ASSIGN TO BP13K893                           00680000
                  ACCESS MODE     IS DYNAMIC                            00690000
                  ORGANIZATION    IS INDEXED                            00700000
                  RECORD KEY      IS K893-KEY-FLD                       00710000
                  FILE STATUS     IS K893-STATUS.                       00720000
                                                                        00730000
           SELECT BP13K800 ASSIGN TO BP13K800                           00740000
                  ACCESS MODE     IS DYNAMIC                            00750000
                  ORGANIZATION    IS INDEXED                            00760000
                  RECORD KEY      IS K800-NUM-REGN                      00770000
                  FILE STATUS     IS K800-STATUS.                       00780000
                                                                        00790000
           SELECT BP13K130 ASSIGN TO BP13K130                           00800000
                  ACCESS MODE     IS DYNAMIC                            00810000
                  ORGANIZATION    IS INDEXED                            00820000
                  RECORD KEY      IS K130-KEY-FLD                       00830000
                  FILE STATUS     IS K130-STATUS.                       00840000
                                                                        00850000
           SELECT BP13K840 ASSIGN TO BP13K840                           00860000
                  ACCESS MODE     IS RANDOM                             00870000
                  ORGANIZATION    IS INDEXED                            00880000
                  RECORD KEY      IS K840-KEY-FLD                       00890000
                  FILE STATUS     IS K840-STATUS.                       00900000
                                                                        00910000
           SELECT BP13K736 ASSIGN TO BP13K736                           00920000
                  ACCESS MODE     IS RANDOM                             00930000
                  ORGANIZATION    IS INDEXED                            00940000
                  RECORD KEY      IS K736-KEY-FLD                       00950000
                  FILE STATUS     IS K736-STATUS.                       00960000
                                                                        00970000
           SELECT BP13F136   ASSIGN       TO BP13F136.                  00980000
                                                                        00990000
           SELECT BP13RPT1   ASSIGN       TO BP13RPT1.                  01000000
                                                                        01010000
           SELECT BP13RPT2   ASSIGN       TO BP13RPT2.                  01020000
                                                                        01030000
           SELECT BP13RPT3   ASSIGN       TO BP13RPT3.                  01040000
                                                                        01050000
           SELECT BP13RP5A   ASSIGN       TO BP13RP5A.                  01060000
                                                                        01070000
           SELECT BP13RP5B   ASSIGN       TO BP13RP5B.                  01080000
                                                                        01090000
       DATA DIVISION.                                                   01100000
                                                                        01110000
       FILE SECTION.                                                    01120000
                                                                        01130000
       FD   BP13K410                                                    01140000
            RECORD CONTAINS 2000 CHARACTERS.                            01150000
       COPY BP13K410.                                                   01160000
                                                                        01170000
       FD   BP13K800                                                    01180000
            RECORD CONTAINS 2000 CHARACTERS.                            01190000
       COPY BP13K800.                                                   01200000
                                                                        01210000
       FD   BP13K893                                                    01220000
            RECORD CONTAINS 2050 CHARACTERS.                            01230000
       COPY BP13K893.                                                   01240000
                                                                        01250000
       FD   BP13K130                                                    01260000
            RECORD    CONTAINS 150 CHARACTERS.                          01270000
       COPY BP13K130.                                                   01280000
                                                                        01290000
       FD   BP13K840                                                    01300000
            RECORD    CONTAINS 500 CHARACTERS.                          01310000
       COPY BP13K840.                                                   01320000
                                                                        01330000
       FD   BP13K736                                                    01340000
            RECORD    CONTAINS 1000 CHARACTERS.                         01350000
       COPY BP13K736.                                                   01360000
                                                                        01370000
       FD   BP13F136                                                    01380000
            BLOCK CONTAINS 0 RECORDS                                    01390000
            RECORD CONTAINS 150 CHARACTERS                              01400000
            LABEL RECORDS ARE STANDARD                                  01410000
            RECORDING MODE IS F.                                        01420000
       COPY BP13F136.                                                   01430000
                                                                        01440000
       FD   BP13RPT1                                                    01450000
            BLOCK CONTAINS 0 RECORDS                                    01460000
            RECORD CONTAINS 200 CHARACTERS                              01470000
            LABEL RECORDS ARE STANDARD                                  01480000
            RECORDING MODE IS F.                                        01490000
       01  WS-BP13RPT1-REC          PIC X(200).                         01500000
                                                                        01510000
       FD   BP13RPT2                                                    01520000
            BLOCK CONTAINS 0 RECORDS                                    01530000
            RECORD CONTAINS 200 CHARACTERS                              01540000
            LABEL RECORDS ARE STANDARD                                  01550000
            RECORDING MODE IS F.                                        01560000
       01  WS-BP13RPT2-REC          PIC X(200).                         01570000
                                                                        01580000
       FD   BP13RPT3                                                    01590000
            BLOCK CONTAINS 0 RECORDS                                    01600000
            RECORD CONTAINS 200 CHARACTERS                              01610000
            LABEL RECORDS ARE STANDARD                                  01620000
            RECORDING MODE IS F.                                        01630000
       01  WS-BP13RPT3-REC          PIC X(200).                         01640000
                                                                        01650000
       FD   BP13RP5A                                                    01660000
            BLOCK CONTAINS 0 RECORDS                                    01670000
            RECORD CONTAINS 200 CHARACTERS                              01680000
            LABEL RECORDS ARE STANDARD                                  01690000
            RECORDING MODE IS F.                                        01700000
       01  WS-BP13RP5A-REC          PIC X(200).                         01710000
                                                                        01720000
       FD   BP13RP5B                                                    01730000
            BLOCK CONTAINS 0 RECORDS                                    01740000
            RECORD CONTAINS 200 CHARACTERS                              01750000
            LABEL RECORDS ARE STANDARD                                  01760000
            RECORDING MODE IS F.                                        01770000
       01  WS-BP13RP5B-REC          PIC X(200).                         01780000
                                                                        01790000
      ************************                                          01800000
       WORKING-STORAGE SECTION.                                         01810000
      ************************                                          01820000
                                                                        01830000
       01  CNT-F136-READ            PIC 9(05) VALUE ZEROES.             01840000
       01  WS-K130-FOUND            PIC X(1)  VALUE 'N'.                01850000
       01  WS-RPT1-CNT              PIC 9(05) VALUE ZEROES.             01860000
       01  WS-RPT2-CNT              PIC 9(05) VALUE ZEROES.             01870000
       01  WS-RPT3-CNT              PIC 9(05) VALUE ZEROES.             01880000
       01  WS-RP5A-CNT              PIC 9(05) VALUE ZEROES.             01890000
       01  WS-RP5B-CNT              PIC 9(05) VALUE ZEROES.             01900000
       01  K893-STATUS              PIC 9(02) VALUE ZEROES.             01910000
       01  K800-STATUS              PIC 9(02) VALUE ZEROES.             01920000
       01  K410-STATUS              PIC 9(02) VALUE ZEROES.             01930000
       01  K130-STATUS              PIC 9(02) VALUE ZEROES.             01940000
       01  K840-STATUS              PIC 9(02) VALUE ZEROES.             01950000
       01  K736-STATUS              PIC 9(02) VALUE ZEROES.             01960000
       01  WS-CTR                   PIC 9(02) VALUE ZEROES.             01970000
       01  WS-K893-EOF              PIC X(01) VALUE 'N'.                01980000
       01  WS-EOF-K130              PIC X(1)  VALUE 'N'.                01990000
       01  WS-F136-EOF              PIC X(01) VALUE 'N'.                02000000
       01  WS-RCVRY                 PIC X(01) VALUE 'N'.                02010000
       01  WS-LIVE                  PIC X(01) VALUE 'N'.                02020000
       01  WS-PREV-RCVRY            PIC X(01) VALUE 'N'.                02030000
       01  WS-PREV-LIVE             PIC X(01) VALUE 'N'.                02040000
       01  WS-FINCL-YEAR            PIC X(01) VALUE 'N'.                02050000
       01  WS-DTE-CANCEL            PIC X(08) VALUE SPACES.             02060000
       01  WS-NUM-STATUS            PIC X(01) VALUE SPACES.             02070000
       01  WS-DTE-REINST            PIC X(08) VALUE SPACES.             02080000
       01  WS-DATE                  PIC X(08) VALUE SPACES.             02090000
       01  WS-NUM-REGN              PIC X(08).                          02100000
       01  WS-DTE-POST-RCVRY        PIC X(08) VALUE SPACES.             02110000
       01  WS-PREV-DTE-RCVRY        PIC X(08) VALUE SPACES.             02120000
       01  WS-NUM-RECPT-RCVRY       PIC X(14).                          02130000
       01  WS-RETURN-CODE           PIC 9(02) VALUE ZEROES.             02140000
       01  WS-AMT-RECOVERY          PIC S9(7)V9(2) VALUE ZEROES.        02150000
       01  WS-TOT-RECOVERY          PIC S9(7)V9(2) VALUE ZEROES.        02160000
       01  WS-TOT-GRANT             PIC S9(7)V9(2) VALUE ZEROES.        02170000
       01  WS-TOT-AMT3              PIC S9(6)V99 VALUE ZEROES.          02180000
       01  WS-GRANT-AMT5            PIC S9(6)V99 VALUE ZEROES.          02190000
       01  WS-AMT-GRANT             PIC S9(6)V99 VALUE ZEROES.          02200000
       01  WS-PREV-TOT-AMT          PIC S9(6)V99 VALUE ZEROES.          02210000
       01  WS-GRANT-KEY-AMT         PIC S9(6)V99 VALUE ZEROES.          02220000
       01  WS-PREV-TOT-LIVE         PIC S9(6)V99 VALUE ZEROES.          02230000
       01  WS-PREV-TOT-RECOVERY     PIC S9(7)V9(2) VALUE ZEROES.        02240000
       01  WS-TOT-BAL               PIC S9(6)V99 VALUE ZEROES.          02250000
       01  WS-MTH-END-BAL           PIC S9(6)V99 VALUE ZEROES.          02260000
       01  WS-LIVE-AMT              PIC S9(6)V99 VALUE ZEROES.          02270000
       01  WS-PREV-LIVE-AMT         PIC S9(6)V99 VALUE ZEROES.          02280000
       01  WS-SUM-RECOVERY          PIC S9(7)V9(2) USAGE COMP-3.        02290000
       01  WS-SUM-GRANT             PIC S9(7)V9(2) USAGE COMP-3.        02300000
       01  WS-SUM-RECOVERY-INDNULL  PIC S9(4) COMP.                     02310000
       01  WS-SUM-GRANT-INDNULL     PIC S9(4) COMP.                     02320000
       01  WS-NUM-RGSTRN            PIC X(8).                           02330000
       01  WS-NUM-GRANT-TYPE        PIC X(6).                           02340000
       01  WS-NUM-SCHACCT           PIC X(11).                          02350000
       01  WS-NUM-IDNTY-NO          PIC X(9).                           02360000
       01  WS-FLAT-TYPE             PIC X(2).                           02370000
       01  WS-LEASE-TENURE          PIC X(2).                           02380000
                                                                        02390000
       01  WS-DTE-CCYYMMDD.                                             02400000
           05 WS-DTE-CCYY           PIC 9(04).                          02410000
           05 WS-DTE-MM             PIC 9(02).                          02420000
           05 WS-DTE-DD             PIC 9(02).                          02430000
       01  WS-TIME-HHMMSS.                                              02440000
           05 WS-TIME-HH            PIC X(02) VALUE SPACES.             02450000
           05 WS-TIME-MM            PIC X(02) VALUE SPACES.             02460000
           05 WS-TIME-SS            PIC X(02) VALUE SPACES.             02470000
           05 WS-TIME-MS            PIC X(02) VALUE SPACES.             02480000
                                                                        02490000
       01  WS-DTE-FINCL-CCYYMM      PIC X(06).                          02500000
       01  WS-YEAR                  PIC 9(04).                          02510000
       01  WS-YEAR-PREV             PIC 9(04).                          02520000
       01  WS-YEAR-NEXT             PIC 9(04).                          02530000
                                                                        02540000
       01  WS-LAST-MONTH.                                               02550000
           05 WS-LAST-CCYY          PIC 9(04).                          02560000
           05 WS-LAST-MM            PIC 9(02).                          02570000
                                                                        02580000
       01  WS-PREV-F136-REC.                                            02590000
           05 FILLER                PIC X(04) VALUE SPACES.             02600000
           05 WS-PREV-NUM-REGN      PIC X(08) VALUE SPACES.             02610000
           05 WS-PREV-DTE-POST      PIC X(08) VALUE SPACES.             02620000
           05 FILLER                PIC X(04) VALUE SPACES.             02630000
           05 WS-PREV-NUM-NRIC      PIC X(09) VALUE SPACES.             02640000
           05 FILLER                PIC X(57) VALUE SPACES.             02650000
           05 WS-PREV-DTE-TRANS     PIC X(08) VALUE SPACES.             02660000
           05 WS-PREV-PAYMENT-TYPE  PIC X(03) VALUE SPACES.             02670000
           05 WS-PREV-NUM-SCH       PIC X(11) VALUE SPACES.             02680000
           05 FILLER                PIC X(38) VALUE SPACES.             02690000
                                                                        02700000
       01  WS-BP13REPT-REC.                                             02710000
           05  WS-REPT-TYPE         PIC X(02).                          02720000
           05  FILLER               PIC X(01).                          02730000
           05  WS-REPT-REGN-NO      PIC X(08).                          02740000
           05  WS-REPT-NRIC         PIC X(09).                          02750000
           05  WS-REPT-GRANT-TYPE   PIC X(03).                          02760000
           05  WS-REPT-RECEIPT      PIC X(14).                          02770000
           05  WS-REPT-SCHACCT      PIC X(11).                          02780000
           05  WS-REPT-DTE-KEYISSUE PIC X(08).                          02790000
           05  WS-REPT-GRANT-AMT    PIC S9(7)V99.                       02800000
           05  WS-REPT-RCVRY-AMT    PIC S9(7)V99.                       02810000
           05  WS-REPT-DTE-POST     PIC X(08).                          02820000
           05  WS-REPT-DTE-TRANS    PIC X(08).                          02830000
           05  WS-REPT-MTH-BAL      PIC S9(8)V99.                       02840000
           05  WS-REPT-DTE-CANCEL   PIC X(08).                          02850000
           05  WS-REPT-ROOM-TYPE    PIC X(02).                          02860000
           05  FILLER               PIC X(90).                          02870000
                                                                        02880000
       01  WS-SQLCODE             PIC ---9.                             02890000
       01  WS-SQL-STATUS.                                               02900000
           05 WS-SQL-OK                PIC S9(03) VALUE +000.           02910000
           05 WS-SQL-NFND              PIC S9(03) VALUE +100.           02920000
           05 WS-SQL-DUPREC            PIC S9(03) VALUE -803.           02930000
                                                                        02940000
      *--------------------------------------------------------------*  02950000
      *                          SQLCA                               *  02960000
      *--------------------------------------------------------------*  02970000
           EXEC SQL INCLUDE SQLCA          END-EXEC.                    02980000
           EXEC SQL INCLUDE P13VGAPN       END-EXEC.                    02990000
           EXEC SQL INCLUDE P13VGXAP       END-EXEC.                    03000000
           EXEC SQL INCLUDE P13VGRCV       END-EXEC.                    03010000
                                                                        03020000
      ********************                                              03030000
       PROCEDURE DIVISION.                                              03040000
      ********************                                              03050000
                                                                        03060000
      *----------*                                                      03070000
       0000-MAIN.                                                       03080000
      *----------*                                                      03090000
                                                                        03100000
           PERFORM 1000-OPEN-FILES   THRU 1000-EXIT.                    03110000
           PERFORM 2000-READ-F136    THRU 2000-EXIT.                    03120000
           PERFORM 3000-PROCESS-REC  THRU 3000-EXIT                     03130000
                   UNTIL WS-F136-EOF = 'Y'.                             03140000
           PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT.                    03150000
                                                                        03160000
       0000-EXIT.                                                       03170000
           EXIT.                                                        03180000
                                                                        03190000
      *----------------*                                                03200000
       1000-OPEN-FILES.                                                 03210000
      *----------------*                                                03220000
                                                                        03230000
           OPEN INPUT  BP13F136                                         03240000
                       BP13K410                                         03250000
                       BP13K800                                         03260000
                       BP13K893                                         03270000
                       BP13K130                                         03280000
                       BP13K840                                         03290000
                       BP13K736                                         03300000
                OUTPUT BP13RPT1                                         03310000
                       BP13RPT2                                         03320000
                       BP13RPT3                                         03330000
                       BP13RP5A                                         03340000
                       BP13RP5B.                                        03350000
                                                                        03360000
           IF K893-STATUS NOT = 0 AND 97                                03370000
              DISPLAY 'ERROR OPENING - BP13K893 : ' K893-STATUS         03380000
              MOVE K893-STATUS TO RETURN-CODE                           03390000
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                   03400000
           END-IF.                                                      03410000
                                                                        03420000
           IF K410-STATUS NOT = 00 AND 97                               03430000
              DISPLAY 'ERROR OPENING - BP13K410 : ' K410-STATUS         03440000
              MOVE     K410-STATUS       TO    RETURN-CODE              03450000
              PERFORM  9000-CLOSE-FILES  THRU  9000-EXIT                03460000
           END-IF.                                                      03470000
                                                                        03480000
           IF K800-STATUS NOT = 00 AND 97                               03490000
              DISPLAY 'ERROR OPENING - BP13K800 : ' K800-STATUS         03500000
              MOVE     K800-STATUS       TO    RETURN-CODE              03510000
              PERFORM  9000-CLOSE-FILES  THRU  9000-EXIT                03520000
           END-IF.                                                      03530000
                                                                        03540000
           IF K130-STATUS NOT = 00 AND 97                               03550000
              DISPLAY 'BP13K130 - ERROR OPENING : ' K130-STATUS         03560000
              MOVE K130-STATUS                      TO RETURN-CODE      03570000
              PERFORM  9000-CLOSE-FILES    THRU 9000-EXIT               03580000
           END-IF.                                                      03590000
                                                                        03600000
           IF K840-STATUS NOT = 00 AND 97                               03610000
              DISPLAY 'BP13K840 - ERROR OPENING : ' K840-STATUS         03620000
              MOVE K840-STATUS                      TO RETURN-CODE      03630000
              PERFORM  9000-CLOSE-FILES    THRU 9000-EXIT               03640000
           END-IF.                                                      03650000
                                                                        03660000
           IF K736-STATUS NOT = 00 AND 97                               03670000
              DISPLAY 'BP13K736 - ERROR OPENING : ' K736-STATUS         03680000
              MOVE K736-STATUS                      TO RETURN-CODE      03690000
              PERFORM  9000-CLOSE-FILES    THRU 9000-EXIT               03700000
           END-IF.                                                      03710000
                                                                        03720000
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                       03730000
                                                                        03740000
           ACCEPT WS-DTE-CCYYMMDD   FROM   DATE YYYYMMDD.               03750000
      *    MOVE  '20190829'  TO WS-DTE-CCYYMMDD.                        03760000
           ACCEPT WS-TIME-HHMMSS    FROM   TIME.                        03770000
                                                                        03780000
           IF WS-DTE-MM = 01                                            03790000
              MOVE 12 TO WS-LAST-MM                                     03800000
              COMPUTE WS-LAST-CCYY = WS-DTE-CCYY - 1                    03810000
           ELSE                                                         03820000
              COMPUTE WS-LAST-MM = WS-DTE-MM - 1                        03830000
              MOVE WS-DTE-CCYY TO WS-LAST-CCYY                          03840000
           END-IF.                                                      03850000
                                                                        03860000
           MOVE SPACES TO WS-BP13REPT-REC.                              03870000
                                                                        03880000
       1000-EXIT.                                                       03890000
           EXIT.                                                        03900000
                                                                        03910000
      *---------------*                                                 03920000
       2000-READ-F136.                                                  03930000
      *---------------*                                                 03940000
                                                                        03950000
           READ BP13F136 AT END                                         03960000
              PERFORM 2500-PROCESS-LAST-REC THRU 2500-EXIT              03970000
              MOVE HIGH-VALUES TO BP13F136-CASHTRAN                     03980000
              MOVE 'Y' TO WS-F136-EOF                                   03990000
              GO TO 2000-EXIT.                                          04000000
                                                                        04010000
           ADD 1 TO CNT-F136-READ.                                      04020000
                                                                        04030000
       2000-EXIT.                                                       04040000
           EXIT.                                                        04050000
                                                                        04060000
      *----------------------*                                          04070000
       2500-PROCESS-LAST-REC.                                           04080000
      *----------------------*                                          04090000
           MOVE F136-NUM-REGN         TO WS-NUM-REGN.                   04100000
           PERFORM 6000-READ-BP13K800 THRU 6000-EXIT.                   04110000
           PERFORM 3500-READ-BP13K130     THRU 3500-EXIT.               04120000
           PERFORM 3800-READ-RECOVERY-TBL THRU 3800-EXIT.               04130000
           PERFORM 3900-READ-LIVE-PERSON-TBL THRU 3900-EXIT.            04140000
                                                                        04150000
                                                                        04160000
           PERFORM 5250-READ-BP13K840 THRU 5250-EXIT.                   04170000
      *TO NOT INCLUDE SHORT LEASE IN THE REPORTS                        04180000
           IF (WS-FLAT-TYPE = '2F' OR '1F') AND                         04190000
              (WS-LEASE-TENURE NOT = SPACES AND LOW-VALUES)             04200000
             IF WS-LEASE-TENURE NOT = 99                                04210000
              GO TO 2500-EXIT                                           04220000
             END-IF                                                     04230000
           ELSE                                                         04240000
             IF WS-LEASE-TENURE = SPACES OR LOW-VALUES                  04250000
      *TO NOT INCLUDE CANCELLED SHORT LEASE IN THE REPORTS              04260000
                PERFORM 6050-READ-BP13K736   THRU 6050-EXIT             04270000
                IF K736-NUM-SHORTLEASE-TAG = 'Y'                        04280000
                   GO TO 2500-EXIT                                      04290000
                END-IF                                                  04300000
             END-IF                                                     04310000
           END-IF.                                                      04320000
                                                                        04330000
           PERFORM 5200-READ-BP13K410 THRU 5200-EXIT.                   04340000
                                                                        04350000
           IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                     04360000
              MOVE K410-NUM-SCH-ACC   TO WS-NUM-SCHACCT                 04370000
           END-IF.                                                      04380000
                                                                        04390000
           IF (K410-DTE-KEY-ISSUE = SPACES OR                           04400000
                                    LOW-VALUES OR '00000000') OR        04410000
              ((K410-DTE-KEY-ISSUE(1:4) = WS-DTE-CCYY) AND              04420000
               (K410-DTE-KEY-ISSUE(5:2) = WS-DTE-MM))                   04430000
              CONTINUE                                                  04440000
           ELSE                                                         04450000
              IF WS-RCVRY = 'Y' AND WS-LIVE = 'Y'                       04460000
                 MOVE WS-LIVE-AMT TO WS-TOT-AMT3                        04470000
              END-IF                                                    04480000
              PERFORM 6300-CREATE-REP3-REC THRU 6300-EXIT               04490000
           END-IF.                                                      04500000
                                                                        04510000
           IF (WS-RCVRY = 'Y') AND                                      04520000
              (K410-DTE-KEY-ISSUE = SPACES OR LOW-VALUES OR '00000000') 04530000
              IF WS-TOT-RECOVERY < ZEROES                               04540000
                COMPUTE WS-TOT-RECOVERY = WS-TOT-RECOVERY * -1          04550000
              END-IF                                                    04560000
              COMPUTE WS-MTH-END-BAL = WS-TOT-GRANT -                   04570000
                                       WS-TOT-RECOVERY                  04580000
              MOVE WS-DTE-POST-RCVRY(1:6) TO WS-DTE-FINCL-CCYYMM        04590000
              PERFORM 7000-CHECK-FINCL-YEAR THRU 7000-EXIT              04600000
                                                                        04610000
              MOVE F136-NUM-REGN          TO WS-REPT-REGN-NO            04620000
              MOVE SPACES                 TO WS-REPT-NRIC               04630000
              MOVE SPACES                 TO WS-REPT-RECEIPT            04640000
              MOVE WS-NUM-SCHACCT         TO WS-REPT-SCHACCT            04650000
              MOVE F136-DTE-TRANS         TO WS-REPT-DTE-TRANS          04660000
              MOVE F136-CDE-PAYMENT-TYPE  TO WS-REPT-GRANT-TYPE         04670000
              MOVE SPACES                 TO WS-REPT-DTE-KEYISSUE       04680000
              MOVE WS-TOT-GRANT           TO WS-REPT-GRANT-AMT          04690000
      *       MOVE WS-TOT-BAL             TO WS-REPT-GRANT-AMT          04700000
              MOVE WS-TOT-RECOVERY        TO WS-REPT-RCVRY-AMT          04710000
              MOVE WS-DTE-POST-RCVRY      TO WS-REPT-DTE-POST           04720000
              MOVE WS-MTH-END-BAL         TO WS-REPT-MTH-BAL            04730000
              MOVE WS-DTE-CANCEL          TO WS-REPT-DTE-CANCEL         04740000
              MOVE WS-FLAT-TYPE           TO WS-REPT-ROOM-TYPE          04750000
                                                                        04760000
      *       IF WS-FINCL-YEAR = 'Y'                                    04770000
                 IF WS-DTE-POST-RCVRY(1:6) NOT = WS-DTE-CCYYMMDD(1:6)   04780000
                  IF ((F136-NUM-REGN(1:1) NOT = '5' AND '6') AND        04790000
                     (WS-MTH-END-BAL NOT = ZERO))                       04800000
                    IF (WS-DTE-CANCEL NOT = SPACES AND LOW-VALUES       04810000
                                                   AND ZEROES)          04820000
                       IF WS-DTE-REINST < WS-DTE-CANCEL                 04830000
                         IF WS-NUM-STATUS = 'C'                         04840000
                          MOVE '5A'                TO WS-REPT-TYPE      04850000
                          WRITE WS-BP13RP5A-REC FROM WS-BP13REPT-REC    04860000
                          ADD 1 TO WS-RP5A-CNT                          04870000
                         ELSE                                           04880000
                          MOVE '5B'                TO WS-REPT-TYPE      04890000
                          WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC    04900000
                          ADD 1 TO WS-RP5B-CNT                          04910000
                         END-IF                                         04920000
                                                                        04930000
                       ELSE                                             04940000
                          MOVE '5B'                TO WS-REPT-TYPE      04950000
                          WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC    04960000
                          ADD 1 TO WS-RP5B-CNT                          04970000
                       END-IF                                           04980000
                    ELSE                                                04990000
                       MOVE '5B'                TO WS-REPT-TYPE         05000000
                       WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC       05010000
                       ADD 1 TO WS-RP5B-CNT                             05020000
                    END-IF                                              05030000
                  END-IF                                                05040000
                 END-IF                                                 05050000
              END-IF.                                                   05060000
      *    END-IF.                                                      05070000
                                                                        05080000
       2500-EXIT.                                                       05090000
           EXIT.                                                        05100000
                                                                        05110000
      *-----------------*                                               05120000
       3000-PROCESS-REC.                                                05130000
      *-----------------*                                               05140000
           MOVE F136-NUM-REGN TO WS-NUM-REGN.                           05150000
           PERFORM 6000-READ-BP13K800   THRU 6000-EXIT.                 05160000
           PERFORM 3500-READ-BP13K130     THRU 3500-EXIT.               05170000
           PERFORM 3800-READ-RECOVERY-TBL THRU 3800-EXIT.               05180000
           PERFORM 3900-READ-LIVE-PERSON-TBL THRU 3900-EXIT.            05190000
                                                                        05200000
           PERFORM 5250-READ-BP13K840   THRU 5250-EXIT.                 05210000
                                                                        05220000
      *TO NOT INCLUDE SHORT LEASE IN THE REPORTS                        05230000
      *    IF (WS-FLAT-TYPE = '2F') AND                                 05240000
      *       (WS-LEASE-TENURE NOT = SPACES AND LOW-VALUES)             05250000
      *        IF WS-NUM-REGN = '3262928H' OR '3262896F' OR '3262934B'  05260000
      *                          OR '3262930Z'                          05270000
      *          DISPLAY '2F FLAT1' WS-NUM-REGN                         05280000
      *        END-IF                                                   05290000
      *        MOVE BP13F136-CASHTRAN TO WS-PREV-F136-REC               05300000
      *        MOVE WS-RCVRY          TO WS-PREV-RCVRY                  05310000
      *        MOVE WS-LIVE           TO WS-PREV-LIVE                   05320000
      *        MOVE WS-DTE-POST-RCVRY TO WS-PREV-DTE-RCVRY              05330000
      *        PERFORM 2000-READ-F136 THRU 2000-EXIT                    05340000
      *        GO TO 3000-EXIT                                          05350000
      *    END-IF.                                                      05360000
                                                                        05370000
           IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                     05380000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 05390000
              MOVE K410-NUM-SCH-ACC      TO WS-NUM-SCHACCT              05400000
           END-IF.                                                      05410000
                                                                        05420000
           PERFORM 6100-CREATE-REP1-REC THRU 6100-EXIT.                 05430000
      *       PERFORM 6200-CREATE-REP2-REC THRU 6200-EXIT               05440000
           IF F136-NUM-REGN = WS-PREV-NUM-REGN AND                      05450000
              F136-CDE-PAYMENT-TYPE = WS-PREV-PAYMENT-TYPE              05460000
              ADD  WS-AMT-RECOVERY      TO WS-TOT-RECOVERY              05470000
              ADD  WS-AMT-GRANT         TO WS-TOT-GRANT                 05480000
           ELSE                                                         05490000
              MOVE WS-AMT-RECOVERY      TO WS-TOT-RECOVERY              05500000
              MOVE WS-AMT-GRANT         TO WS-TOT-GRANT                 05510000
           END-IF.                                                      05520000
                                                                        05530000
           IF (F136-NUM-REGN = WS-PREV-NUM-REGN AND                     05540000
               F136-CDE-PAYMENT-TYPE = WS-PREV-PAYMENT-TYPE) OR         05550000
               WS-PREV-NUM-REGN = SPACES                                05560000
              MOVE F136-NUM-REGN         TO WS-NUM-REGN                 05570000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 05580000
              IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND           05590000
                 (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM)                 05600000
                 COMPUTE WS-TOT-AMT3 = WS-TOT-AMT3 + F136-AMT-RECEIPT   05610000
              END-IF                                                    05620000
              COMPUTE WS-TOT-BAL = WS-TOT-BAL + F136-AMT-RECEIPT        05630000
              ADD  WS-LIVE-AMT           TO WS-PREV-LIVE-AMT            05640000
              MOVE ZEROES                TO WS-LIVE-AMT                 05650000
           ELSE                                                         05660000
              MOVE WS-PREV-NUM-REGN       TO WS-NUM-REGN                05670000
              PERFORM 5250-READ-BP13K840  THRU 5250-EXIT                05680000
              PERFORM 6000-READ-BP13K800  THRU 6000-EXIT                05690000
      *TO NOT INCLUDE SHORT LEASE IN THE REPORTS                        05700000
              IF (WS-FLAT-TYPE = '2F' OR '1F') AND                      05710000
                 (WS-LEASE-TENURE NOT = SPACES AND LOW-VALUES)          05720000
                 IF WS-LEASE-TENURE NOT = 99                            05730000
                  MOVE BP13F136-CASHTRAN TO WS-PREV-F136-REC            05740000
                  MOVE WS-RCVRY          TO WS-PREV-RCVRY               05750000
                  MOVE WS-LIVE           TO WS-PREV-LIVE                05760000
                  MOVE WS-DTE-POST-RCVRY TO WS-PREV-DTE-RCVRY           05770000
                  MOVE WS-TOT-RECOVERY   TO WS-PREV-TOT-RECOVERY        05780000
                  MOVE WS-PREV-LIVE-AMT  TO WS-PREV-TOT-LIVE            05790000
                  MOVE WS-TOT-GRANT      TO WS-PREV-TOT-AMT             05800000
                  PERFORM 2000-READ-F136 THRU 2000-EXIT                 05810000
                  GO TO 3000-EXIT                                       05820000
                 END-IF                                                 05830000
              ELSE                                                      05840000
               IF WS-LEASE-TENURE = SPACES OR LOW-VALUES                05850000
      *TO NOT INCLUDE CANCELLED SHORT LEASE IN THE REPORTS              05860000
                  PERFORM 6050-READ-BP13K736   THRU 6050-EXIT           05870000
                  IF K736-NUM-SHORTLEASE-TAG = 'Y'                      05880000
                    MOVE BP13F136-CASHTRAN TO WS-PREV-F136-REC          05900000
                    MOVE WS-RCVRY          TO WS-PREV-RCVRY             05910000
                    MOVE WS-LIVE           TO WS-PREV-LIVE              05920000
                    MOVE WS-DTE-POST-RCVRY TO WS-PREV-DTE-RCVRY         05930000
                    MOVE WS-TOT-RECOVERY   TO WS-PREV-TOT-RECOVERY      05940000
                    MOVE WS-PREV-LIVE-AMT  TO WS-PREV-TOT-LIVE          05950000
                    MOVE WS-TOT-GRANT      TO WS-PREV-TOT-AMT           05960000
                    PERFORM 2000-READ-F136 THRU 2000-EXIT               05970000
                    GO TO 3000-EXIT                                     05980000
                  END-IF                                                05990000
               END-IF                                                   05991002
              END-IF                                                    06000000
              PERFORM 5200-READ-BP13K410  THRU 5200-EXIT                06010000
              IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                  06020000
                 MOVE K410-NUM-SCH-ACC      TO WS-NUM-SCHACCT           06030000
              END-IF                                                    06040000
              IF (K410-DTE-KEY-ISSUE = SPACES OR                        06050000
                                       LOW-VALUES OR '00000000') OR     06060000
                 ((K410-DTE-KEY-ISSUE(1:4) = WS-DTE-CCYY) AND           06070000
                  (K410-DTE-KEY-ISSUE(5:2) = WS-DTE-MM))                06080000
                 CONTINUE                                               06090000
              ELSE                                                      06100000
                 IF WS-PREV-RCVRY = 'Y' AND WS-PREV-LIVE = 'Y'          06110000
                    MOVE WS-PREV-LIVE-AMT TO WS-TOT-AMT3                06120000
                 END-IF                                                 06130000
                 PERFORM 6300-CREATE-REP3-REC THRU 6300-EXIT            06140000
              END-IF                                                    06150000
      *       IF (WS-PREV-RCVRY = 'Y') AND                              06160000
              IF (K410-DTE-KEY-ISSUE = SPACES OR LOW-VALUES             06170000
                                              OR '00000000')            06180000
                 PERFORM 6500-CREATE-REP5-REC THRU 6500-EXIT            06190000
              END-IF                                                    06200000
              MOVE WS-LIVE-AMT           TO WS-PREV-LIVE-AMT            06210000
              MOVE ZEROES                TO WS-LIVE-AMT                 06220000
              MOVE F136-NUM-REGN         TO WS-NUM-REGN                 06230000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 06240000
              IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND           06250000
                 (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM)                 06260000
                 MOVE F136-AMT-RECEIPT TO WS-TOT-AMT3                   06270000
              END-IF                                                    06280000
              MOVE F136-AMT-RECEIPT TO WS-TOT-BAL                       06290000
           END-IF.                                                      06300000
                                                                        06310000
           MOVE BP13F136-CASHTRAN TO WS-PREV-F136-REC.                  06320000
           MOVE WS-RCVRY          TO WS-PREV-RCVRY.                     06330000
           MOVE WS-LIVE           TO WS-PREV-LIVE.                      06340000
           MOVE WS-DTE-POST-RCVRY TO WS-PREV-DTE-RCVRY.                 06350000
           MOVE WS-TOT-RECOVERY   TO WS-PREV-TOT-RECOVERY.              06360000
           MOVE WS-PREV-LIVE-AMT  TO WS-PREV-TOT-LIVE.                  06370000
           MOVE WS-TOT-GRANT      TO WS-PREV-TOT-AMT.                   06380000
           PERFORM 2000-READ-F136 THRU 2000-EXIT.                       06390000
                                                                        06400000
       3000-EXIT.                                                       06410000
           EXIT.                                                        06420000
                                                                        06430000
      *-----------------------*                                         06440000
       3500-READ-BP13K130.                                              06450000
      *-----------------------*                                         06460000
                                                                        06470000
           MOVE SPACES                TO BP13K130-CDHIST.               06480000
           INITIALIZE                    BP13K130-CDHIST.               06490000
           MOVE ZEROES                TO WS-AMT-RECOVERY                06500000
                                         WS-AMT-GRANT.                  06510000
                                                                        06520000
           MOVE 'N'                   TO WS-EOF-K130                    06530000
                                         WS-RCVRY.                      06540000
           MOVE SPACES                TO WS-DTE-POST-RCVRY.             06550000
                                                                        06560000
           MOVE F136-NUM-REGN         TO K130-NUM-ORIG-REGN.            06570000
                                                                        06580000
           START BP13K130 KEY = K130-NUM-ORIG-REGN.                     06590000
                                                                        06600000
           EVALUATE K130-STATUS                                         06610000
               WHEN 00                                                  06620000
               WHEN 02                                                  06630000
                    PERFORM 3600-READNEXT-BP13K130 THRU 3600-EXIT       06640000
                    PERFORM 3700-PROCESS-BP13K130  THRU 3700-EXIT       06650000
                            UNTIL WS-EOF-K130 = 'Y'                     06660000
               WHEN 20                                                  06670000
               WHEN 23                                                  06680000
                    MOVE ZEROES                      TO WS-AMT-RECOVERY 06690000
               WHEN OTHER                                               06700000
                  DISPLAY 'START ERROR BP13K130 : ' K130-STATUS         06710000
                          ' REGN : ' K130-NUM-ORIG-REGN                 06720000
                  PERFORM 9000-CLOSE-FILES         THRU 9000-EXIT       06730000
           END-EVALUATE.                                                06740000
                                                                        06750000
       3500-EXIT.                                                       06760000
           EXIT.                                                        06770000
                                                                        06780000
      ******************************************************************06790000
       3600-READNEXT-BP13K130.                                          06800000
      ******************************************************************06810000
                                                                        06820000
           READ BP13K130 NEXT RECORD                                    06830000
                         AT END MOVE 'Y' TO WS-EOF-K130.                06840000
                                                                        06850000
       3600-EXIT.                                                       06860000
           EXIT.                                                        06870000
                                                                        06880000
      ******************************************************************06890000
       3700-PROCESS-BP13K130.                                           06900000
      ******************************************************************06910000
                                                                        06920000
           IF (F136-NUM-REGN     = K130-NUM-ORIG-REGN)                  06930000
              IF (F136-NUM-NRIC  = K130-NUM-NRIC OR                     06940000
                  K130-NUM-NRIC  = SPACES OR LOW-VALUES) AND            06950000
                 (F136-CDE-PAYMENT-TYPE = K130-PAYMENT-TYPE) AND        06960000
                 (F136-CDE-PAYMENT-TYPE = 'AHG' OR 'SHG' OR 'SUG' OR    06970000
                                          'LHG' OR 'REG' OR 'EHG') AND  06980000
                 (K130-NUM-RECPT-JRNO NOT = SPACES OR LOW-VALUES)       06990000
                  IF ((K130-NUM-NRIC  = WS-PREV-NUM-NRIC) OR            07000000
                     (K130-NUM-NRIC  = SPACES OR LOW-VALUES)) AND       07010000
                     (F136-NUM-REGN = WS-PREV-NUM-REGN) AND             07020000
                     (K130-PAYMENT-TYPE = WS-PREV-PAYMENT-TYPE)         07030000
                     CONTINUE                                           07040000
                  ELSE                                                  07050000
                     IF K130-AMT-CASH < ZEROES                          07060000
                        IF K130-DTE-POST(1:6) NOT = WS-DTE-CCYYMMDD(1:6)07070000
                           MOVE 'Y'                  TO WS-RCVRY        07080000
                           ADD K130-AMT-CASH         TO WS-AMT-RECOVERY 07090000
      *                    ADD K130-AMT-CASH         TO WS-AMT-GRANT    07100000
                           IF K130-DTE-POST > WS-DTE-POST-RCVRY         07110000
                              MOVE K130-DTE-POST   TO WS-DTE-POST-RCVRY 07120000
                              MOVE K130-NUM-RECPT-JRNO                  07130000
                                                   TO WS-NUM-RECPT-RCVRY07140000
                           END-IF                                       07150000
                           PERFORM 6200-CREATE-REP2-REC THRU 6200-EXIT  07160000
                        END-IF                                          07170000
                     ELSE                                               07180000
                        ADD  K130-AMT-CASH              TO WS-AMT-GRANT 07190000
                     END-IF                                             07200000
                  END-IF                                                07210000
              END-IF                                                    07220000
              PERFORM 3600-READNEXT-BP13K130        THRU 3600-EXIT      07230000
           ELSE                                                         07240000
               MOVE 'Y'                             TO WS-EOF-K130      07250000
           END-IF.                                                      07260000
                                                                        07270000
       3700-EXIT.                                                       07280000
           EXIT.                                                        07290000
                                                                        07300000
      *-----------------------*                                         07310000
       3800-READ-RECOVERY-TBL.                                          07320000
      *-----------------------*                                         07330000
           MOVE F136-NUM-REGN            TO WS-NUM-RGSTRN.              07340000
           MOVE F136-CDE-PAYMENT-TYPE    TO WS-NUM-GRANT-TYPE.          07350000
           MOVE F136-NUM-NRIC            TO WS-NUM-IDNTY-NO.            07360000
           MOVE ZEROES                   TO WS-SUM-RECOVERY             07370000
                                            WS-SUM-GRANT.               07380000
                                                                        07390000
           EXEC SQL                                                     07400000
              SELECT SUM(T2.AMT_GRANT_RCVR),                            07410000
                     SUM(T1.AMT_GRANT)                                  07420000
              INTO   :WS-SUM-RECOVERY:WS-SUM-RECOVERY-INDNULL,          07430000
                     :WS-SUM-GRANT:WS-SUM-GRANT-INDNULL                 07440000
              FROM                                                      07450000
                EX_GRANT_ASMNT_PERSON T1,                               07460000
                GRANT_RCVRY T2                                          07470000
              WHERE                                                     07480000
                T1.NUM_RGSTRN        = :WS-NUM-RGSTRN       AND         07490000
                T1.NUM_GRANT_TYPE    = :WS-NUM-GRANT-TYPE   AND         07500000
                T1.NUM_IDNTY_NO      = :WS-NUM-IDNTY-NO     AND         07510000
                T1.NUM_RGSTRN        = T2.NUM_RGSTRN        AND         07520000
                T1.NUM_GRANT_TYPE    = T2.NUM_GRANT_TYPE    AND         07530000
                T1.NUM_IDNTY_NO      = T2.NUM_IDNTY_NO      AND         07540000
                T1.NUM_IDNTY_NO_TYPE = T2.NUM_IDNTY_NO_TYPE AND         07550000
                T1.TME_CREATE        = T2.TME_CREATE AND                07560000
                (T1.NUM_RCVRY = 'Y' OR                                  07570000
                 T2.DTE_RCV_RCVR_GRANT NOT IN ('0001-01-01') OR         07580000
                 T2.AMT_GRANT_RCVR > 0)                                 07590000
           END-EXEC.                                                    07600000
                                                                        07610000
           EVALUATE SQLCODE                                             07620000
           WHEN WS-SQL-OK                                               07630000
                IF WS-SUM-RECOVERY IS NOT NUMERIC                       07640000
                   MOVE ZEROES TO WS-SUM-RECOVERY                       07650000
                END-IF                                                  07660000
                IF WS-SUM-GRANT IS NOT NUMERIC                          07670000
                   MOVE ZEROES TO WS-SUM-GRANT                          07680000
                END-IF                                                  07690000
                IF WS-SUM-GRANT > ZEROES OR WS-SUM-RECOVERY > ZEROES    07700000
                   MOVE 'Y' TO WS-RCVRY                                 07710000
                   MOVE WS-SUM-GRANT TO WS-GRANT-AMT5                   07720000
                ELSE                                                    07730000
                   MOVE ZEROES       TO WS-GRANT-AMT5                   07740000
                END-IF                                                  07750000
           WHEN WS-SQL-NFND                                             07760000
                CONTINUE                                                07770000
           WHEN OTHER                                                   07780000
                MOVE SQLCODE   TO WS-SQLCODE                            07790000
                DISPLAY 'ERROR READING GRANT_RCVRY'                     07800000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07810000
                DISPLAY 'REGNO : ' WS-NUM-RGSTRN ' '                    07820000
                DISPLAY 'GRNT TYPE : ' WS-NUM-GRANT-TYPE ' '            07830000
                DISPLAY 'NRIC NUM: ' WS-NUM-IDNTY-NO                    07840000
                DISPLAY SPACES                                          07850000
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              07860000
           END-EVALUATE.                                                07870000
                                                                        07880000
       3800-EXIT.                                                       07890000
           EXIT.                                                        07900000
                                                                        07910000
      *--------------------------*                                      07920000
       3900-READ-LIVE-PERSON-TBL.                                       07930000
      *--------------------------*                                      07940000
           MOVE F136-NUM-REGN            TO WS-NUM-RGSTRN.              07950000
           MOVE F136-CDE-PAYMENT-TYPE    TO WS-NUM-GRANT-TYPE.          07960000
           MOVE F136-NUM-NRIC            TO WS-NUM-IDNTY-NO.            07970000
           MOVE 'N'                      TO WS-LIVE.                    07980000
                                                                        07990000
           EXEC SQL                                                     08000000
              SELECT NUM_RGSTRN,                                        08010000
                     NUM_GRANT_TYPE,                                    08020000
                     NUM_IDNTY_NO,                                      08030000
                     AMT_GRANT                                          08040000
              INTO   :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN,                 08050000
                     :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE,             08060000
                     :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO,               08070000
                     :DCLGRANT-ASMNT-PERSON.AMT-GRANT                   08080000
              FROM                                                      08090000
                GRANT_ASMNT_PERSON                                      08100000
              WHERE                                                     08110000
                NUM_RGSTRN        = :WS-NUM-RGSTRN       AND            08120000
                NUM_GRANT_TYPE    = :WS-NUM-GRANT-TYPE   AND            08130000
                NUM_IDNTY_NO      = :WS-NUM-IDNTY-NO                    08140000
           END-EXEC.                                                    08150000
                                                                        08160000
           EVALUATE SQLCODE                                             08170000
           WHEN WS-SQL-OK                                               08180000
                MOVE 'Y' TO WS-LIVE                                     08190000
                ADD AMT-GRANT OF DCLGRANT-ASMNT-PERSON TO WS-LIVE-AMT   08200000
           WHEN WS-SQL-NFND                                             08210000
                CONTINUE                                                08220000
           WHEN OTHER                                                   08230000
                MOVE SQLCODE   TO WS-SQLCODE                            08240000
                DISPLAY 'ERROR READING GRANT_ASMNT_PERSON'              08250000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      08260000
                DISPLAY 'REGNO : ' WS-NUM-RGSTRN ' '                    08270000
                DISPLAY 'GRNT TYPE : ' WS-NUM-GRANT-TYPE ' '            08280000
                DISPLAY 'NRIC NUM: ' WS-NUM-IDNTY-NO                    08290000
                DISPLAY SPACES                                          08300000
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              08310000
           END-EVALUATE.                                                08320000
                                                                        08330000
       3900-EXIT.                                                       08340000
           EXIT.                                                        08350000
                                                                        08360000
      *===============================================================* 08370000
       4250-READ-BP13K893.                                              08380000
      *===============================================================* 08390000
                                                                        08400000
           MOVE SPACES                   TO BP13K893-MASTER.            08410000
           INITIALIZE                       BP13K893-MASTER.            08420000
                                                                        08430000
           MOVE WS-NUM-REGN               TO K893-NUM-REGN-HIST.        08440000
           MOVE 'N'                      TO WS-K893-EOF.                08450000
                                                                        08460000
           START BP13K893 KEY >= K893-KEY-FLD                           08470000
                                                                        08480000
           EVALUATE K893-STATUS                                         08490000
               WHEN 00                                                  08500000
                    PERFORM 4260-READNEXT-BP13K893 THRU 4260-EXIT       08510000
                      UNTIL WS-NUM-REGN NOT = K893-NUM-REGN-HIST        08520000
                         OR WS-K893-EOF   = 'Y'                         08530000
               WHEN 10                                                  08540000
               WHEN 23                                                  08550000
                    CONTINUE                                            08560000
               WHEN OTHER                                               08570000
                    DISPLAY 'BP13K893 START ERROR ' K893-STATUS         08580000
                    DISPLAY 'K893 KEY: ' K893-KEY-FLD                   08590000
                    MOVE K893-STATUS        TO RETURN-CODE              08600000
                                                                        08610000
                    PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT           08620000
           END-EVALUATE.                                                08630000
                                                                        08640000
       4250-EXIT.                                                       08650000
            EXIT.                                                       08660000
                                                                        08670000
      *===============================================================* 08680000
       4260-READNEXT-BP13K893.                                          08690000
      *===============================================================* 08700000
                                                                        08710000
           READ BP13K893 NEXT RECORD                                    08720000
             AT END                                                     08730000
                MOVE 'Y'                 TO WS-K893-EOF                 08740000
           END-READ.                                                    08750000
                                                                        08760000
           EVALUATE K893-STATUS                                         08770000
               WHEN 00                                                  08780000
               WHEN 02                                                  08790000
                    IF K893-NUM-REGN-HIST = WS-NUM-REGN                 08800000
                       MOVE K893-NUM-SCH-ACC      TO WS-NUM-SCHACCT     08810000
                       MOVE K893-DTE-CANCEL       TO WS-DTE-CANCEL      08820000
                       MOVE K893-NUM-STATUS       TO WS-NUM-STATUS      08830000
                       MOVE K893-NUM-FLAT-TYPE    TO WS-FLAT-TYPE       08840000
                       MOVE K893-NUM-LEASE-TENURE TO WS-LEASE-TENURE    08850000
                       MOVE 'Y'              TO WS-K893-EOF             08860000
                    ELSE                                                08870000
                       MOVE 'Y'              TO WS-K893-EOF             08880000
                    END-IF                                              08890000
                                                                        08900000
               WHEN 10                                                  08910000
               WHEN 23                                                  08920000
                    CONTINUE                                            08930000
                                                                        08940000
               WHEN OTHER                                               08950000
                    DISPLAY 'BP13K893 READ NEXT ERROR ' K893-STATUS     08960000
                    DISPLAY 'K893 KEY: ' K893-KEY-FLD                   08970000
                    MOVE K893-STATUS                   TO RETURN-CODE   08980000
                                                                        08990000
                    PERFORM 9000-CLOSE-FILES         THRU 9000-EXIT     09000000
           END-EVALUATE.                                                09010000
                                                                        09020000
       4260-EXIT.                                                       09030000
            EXIT.                                                       09040000
                                                                        09050000
      ***************************************************************** 09060000
       5200-READ-BP13K410.                                              09070000
      ***************************************************************** 09080000
           MOVE SPACES                      TO BP13K410-REC.            09090000
           INITIALIZE                          BP13K410-REC.            09100000
           MOVE SPACES                      TO K410-NUM-REGN.           09110000
           MOVE WS-NUM-REGN                 TO K410-NUM-REGN.           09120000
                                                                        09130000
           READ BP13K410.                                               09140000
                                                                        09150000
           EVALUATE K410-STATUS                                         09160000
               WHEN 00                                                  09170000
               WHEN 23                                                  09180000
                    CONTINUE                                            09190000
               WHEN OTHER                                               09200000
                    DISPLAY 'ERROR READING BP13K410 : ' K410-STATUS     09210000
                            ' REGN = ' K410-NUM-REGN                    09220000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      09230000
           END-EVALUATE.                                                09240000
                                                                        09250000
       5200-EXIT.                                                       09260000
           EXIT.                                                        09270000
                                                                        09280000
      *===============================================================* 09290000
       5250-READ-BP13K840.                                              09300000
      *===============================================================* 09310000
                                                                        09320000
           MOVE SPACES                      TO BP13K840-REC.            09330000
           INITIALIZE                          BP13K840-REC.            09340000
           MOVE SPACES                      TO K840-NUM-REGN.           09350000
           MOVE WS-NUM-REGN                 TO K840-NUM-REGN.           09360000
           READ BP13K840.                                               09370000
                                                                        09380000
           EVALUATE K840-STATUS                                         09390000
               WHEN 00                                                  09400000
                    MOVE K840-DTE-REINSTATE TO WS-DTE-REINST            09410000
               WHEN 23                                                  09420000
                    MOVE SPACES    TO BP13K840-REC                      09430000
               WHEN OTHER                                               09440000
                    DISPLAY 'ERROR READING BP13K410 : ' K410-STATUS     09450000
                            ' REGN = ' K840-KEY-FLD                     09460000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      09470000
           END-EVALUATE.                                                09480000
                                                                        09490000
       5250-EXIT.                                                       09500000
            EXIT.                                                       09510000
                                                                        09520000
      ***************************************************************** 09530000
       6000-READ-BP13K800.                                              09540000
      ***************************************************************** 09550000
           MOVE SPACES                      TO BP13K800-MASTER.         09560000
           INITIALIZE                          BP13K800-MASTER.         09570000
           MOVE SPACES                      TO K800-NUM-REGN            09580000
                                               WS-NUM-SCHACCT           09590000
                                               WS-DTE-CANCEL            09600000
                                               WS-NUM-STATUS            09610000
                                               WS-FLAT-TYPE             09620000
                                               WS-LEASE-TENURE.         09630000
           MOVE WS-NUM-REGN                 TO K800-NUM-REGN.           09640000
                                                                        09650000
           READ BP13K800.                                               09660000
                                                                        09670000
           EVALUATE K800-STATUS                                         09680000
               WHEN 00                                                  09690000
                    MOVE K800-NUM-SCH-ACC      TO WS-NUM-SCHACCT        09700000
                    MOVE K800-DTE-CANCEL       TO WS-DTE-CANCEL         09710000
                    MOVE K800-NUM-STATUS       TO WS-NUM-STATUS         09720000
                    MOVE K800-NUM-FLAT-TYPE    TO WS-FLAT-TYPE          09730000
                    MOVE K800-NUM-LEASE-TENURE TO WS-LEASE-TENURE       09740000
               WHEN 23                                                  09750000
                    PERFORM 4250-READ-BP13K893 THRU 4250-EXIT           09760000
               WHEN OTHER                                               09770000
                    DISPLAY 'ERROR READING BP13K800 : ' K800-STATUS     09780000
                            ' REGN = ' K800-NUM-REGN                    09790000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      09800000
           END-EVALUATE.                                                09810000
                                                                        09820000
       6000-EXIT.                                                       09830000
           EXIT.                                                        09840000
                                                                        09850000
      *===============================================================* 09860000
       6050-READ-BP13K736.                                              09870000
      *===============================================================* 09880000
                                                                        09890000
           MOVE SPACES                      TO BP13K736-REC.            09900000
           INITIALIZE                          BP13K736-REC.            09910000
           MOVE SPACES                      TO K736-KEY-FLD.            09920000
           MOVE F136-NUM-REGN               TO K736-NUM-REGN.           09930000
           MOVE F136-NUM-NRIC               TO K736-NUM-NRIC.           09940000
           READ BP13K736.                                               09950000
                                                                        09960000
           EVALUATE K736-STATUS                                         09970000
               WHEN 00                                                  09980000
               WHEN 23                                                  09990000
                    CONTINUE                                            10000000
               WHEN OTHER                                               10010000
                    DISPLAY 'ERROR READING BP13K736 : ' K736-STATUS     10020000
                            ' REGN = ' K736-KEY-FLD                     10030000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      10040000
           END-EVALUATE.                                                10050000
                                                                        10060000
       6050-EXIT.                                                       10070000
            EXIT.                                                       10080000
                                                                        10090000
      ***************************************************************** 10100000
       6100-CREATE-REP1-REC.                                            10110000
      ***************************************************************** 10120000
                                                                        10130000
           MOVE '1 '                        TO WS-REPT-TYPE.            10140000
           MOVE F136-NUM-REGN               TO WS-REPT-REGN-NO.         10150000
           MOVE F136-NUM-NRIC               TO WS-REPT-NRIC.            10160000
           MOVE F136-CDE-PAYMENT-TYPE       TO WS-REPT-GRANT-TYPE       10170000
           MOVE F136-NUM-RECPT-JRNO         TO WS-REPT-RECEIPT.         10180000
           MOVE WS-NUM-SCHACCT              TO WS-REPT-SCHACCT.         10190000
           MOVE F136-DTE-TRANS              TO WS-REPT-DTE-TRANS.       10200000
           MOVE SPACES                      TO WS-REPT-DTE-KEYISSUE.    10210000
           MOVE F136-AMT-RECEIPT            TO WS-REPT-GRANT-AMT.       10220000
           MOVE F136-DTE-POST               TO WS-REPT-DTE-POST.        10230000
           MOVE WS-FLAT-TYPE                TO WS-REPT-ROOM-TYPE.       10240000
                                                                        10250000
           IF (F136-DTE-POST(1:4) = WS-LAST-CCYY) AND                   10260000
              (F136-DTE-POST(5:2) = WS-LAST-MM)                         10270000
              IF (WS-FLAT-TYPE = '2F' OR '1F') AND                      10280000
                 (WS-LEASE-TENURE NOT = SPACES AND LOW-VALUES)          10290000
                 CONTINUE                                               10300000
              ELSE                                                      10310000
                WRITE WS-BP13RPT1-REC FROM WS-BP13REPT-REC              10320000
                ADD 1 TO WS-RPT1-CNT                                    10330000
              END-IF                                                    10340000
           END-IF.                                                      10350000
                                                                        10360000
           MOVE SPACES TO WS-BP13REPT-REC.                              10370000
                                                                        10380000
       6100-EXIT.                                                       10390000
            EXIT.                                                       10400000
                                                                        10410000
      ***************************************************************** 10420000
       6200-CREATE-REP2-REC.                                            10430000
      ***************************************************************** 10440000
                                                                        10450000
           MOVE '2 '                    TO WS-REPT-TYPE.                10460000
           MOVE F136-NUM-REGN           TO WS-REPT-REGN-NO.             10470000
           MOVE F136-NUM-NRIC           TO WS-REPT-NRIC.                10480000
           MOVE F136-CDE-PAYMENT-TYPE   TO WS-REPT-GRANT-TYPE.          10490000
           MOVE WS-NUM-RECPT-RCVRY      TO WS-REPT-RECEIPT.             10500000
           MOVE WS-NUM-SCHACCT          TO WS-REPT-SCHACCT.             10510000
           MOVE F136-DTE-TRANS          TO WS-REPT-DTE-TRANS.           10520000
           MOVE SPACES                  TO WS-REPT-DTE-KEYISSUE.        10530000
           MOVE F136-AMT-RECEIPT        TO WS-REPT-GRANT-AMT.           10540000
      *    IF WS-AMT-RECOVERY < ZEROES                                  10550000
      *       COMPUTE WS-AMT-RECOVERY = WS-AMT-RECOVERY * -1            10560000
      *    END-IF.                                                      10570000
      *    MOVE WS-AMT-RECOVERY         TO WS-REPT-RCVRY-AMT.           10580000
           IF K130-AMT-CASH < ZEROES                                    10590000
              COMPUTE K130-AMT-CASH = K130-AMT-CASH * -1                10600000
           END-IF.                                                      10610000
           MOVE K130-AMT-CASH           TO WS-REPT-RCVRY-AMT.           10620000
           MOVE WS-DTE-POST-RCVRY       TO WS-REPT-DTE-POST.            10630000
           MOVE WS-FLAT-TYPE            TO WS-REPT-ROOM-TYPE.           10640000
                                                                        10650000
           IF (WS-DTE-POST-RCVRY(1:4) = WS-LAST-CCYY) AND               10660000
              (WS-DTE-POST-RCVRY(5:2) = WS-LAST-MM)                     10670000
              IF (WS-FLAT-TYPE = '2F' OR '1F') AND                      10680000
                 (WS-LEASE-TENURE NOT = SPACES AND LOW-VALUES)          10690000
                 CONTINUE                                               10700000
              ELSE                                                      10710000
               WRITE WS-BP13RPT2-REC FROM WS-BP13REPT-REC               10720000
               ADD 1 TO WS-RPT2-CNT                                     10730000
              END-IF                                                    10740000
           END-IF.                                                      10750000
                                                                        10760000
           MOVE SPACES TO WS-BP13REPT-REC.                              10770000
                                                                        10780000
       6200-EXIT.                                                       10790000
            EXIT.                                                       10800000
                                                                        10810000
      ***************************************************************** 10820000
       6300-CREATE-REP3-REC.                                            10830000
      ***************************************************************** 10840000
           MOVE ZEROES  TO WS-GRANT-KEY-AMT.                            10850000
           IF WS-PREV-TOT-RECOVERY < ZEROES                             10860000
              COMPUTE WS-PREV-TOT-RECOVERY = WS-PREV-TOT-RECOVERY * -1  10870000
           END-IF.                                                      10880000
           COMPUTE WS-GRANT-KEY-AMT = WS-PREV-TOT-AMT -                 10890000
                                      WS-PREV-TOT-RECOVERY.             10900000
                                                                        10910000
           MOVE '3 '                     TO WS-REPT-TYPE.               10920000
           MOVE WS-PREV-NUM-REGN         TO WS-REPT-REGN-NO.            10930000
           MOVE SPACES                   TO WS-REPT-NRIC.               10940000
           MOVE SPACES                   TO WS-REPT-RECEIPT.            10950000
           MOVE WS-NUM-SCHACCT           TO WS-REPT-SCHACCT.            10960000
           MOVE WS-PREV-DTE-TRANS        TO WS-REPT-DTE-TRANS.          10970000
           MOVE WS-PREV-PAYMENT-TYPE     TO WS-REPT-GRANT-TYPE          10980000
           MOVE K410-DTE-KEY-ISSUE       TO WS-REPT-DTE-KEYISSUE.       10990000
      *    MOVE WS-TOT-AMT3              TO WS-REPT-GRANT-AMT.          11000000
           MOVE WS-GRANT-KEY-AMT         TO WS-REPT-GRANT-AMT.          11010000
           MOVE WS-PREV-DTE-POST         TO WS-REPT-DTE-POST.           11020000
           MOVE WS-FLAT-TYPE             TO WS-REPT-ROOM-TYPE.          11030000
                                                                        11040000
           IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND              11050000
              (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM) AND                11060000
              (WS-PREV-TOT-AMT NOT = ZEROES)                            11070000
               WRITE WS-BP13RPT3-REC FROM WS-BP13REPT-REC               11080000
               ADD 1 TO WS-RPT3-CNT                                     11090000
           END-IF.                                                      11100000
                                                                        11110000
           MOVE SPACES TO WS-BP13REPT-REC.                              11120000
                                                                        11130000
       6300-EXIT.                                                       11140000
            EXIT.                                                       11150000
                                                                        11160000
      ***************************************************************** 11170000
       6500-CREATE-REP5-REC.                                            11180000
      ***************************************************************** 11190000
           IF WS-PREV-TOT-RECOVERY < ZEROES                             11200000
              COMPUTE WS-PREV-TOT-RECOVERY = WS-PREV-TOT-RECOVERY * -1  11210000
           END-IF.                                                      11220000
                                                                        11223002
           COMPUTE WS-MTH-END-BAL = WS-PREV-TOT-AMT -                   11230000
                                    WS-PREV-TOT-RECOVERY.               11240000
           MOVE WS-PREV-DTE-RCVRY(1:6) TO WS-DTE-FINCL-CCYYMM.          11250000
           PERFORM 7000-CHECK-FINCL-YEAR THRU 7000-EXIT.                11260000
                                                                        11270000
           MOVE WS-PREV-NUM-REGN       TO WS-REPT-REGN-NO.              11280000
           MOVE SPACES                 TO WS-REPT-NRIC.                 11290000
           MOVE SPACES                 TO WS-REPT-RECEIPT.              11300000
           MOVE WS-NUM-SCHACCT         TO WS-REPT-SCHACCT.              11310000
           MOVE WS-PREV-DTE-TRANS      TO WS-REPT-DTE-TRANS.            11320000
           MOVE WS-PREV-PAYMENT-TYPE   TO WS-REPT-GRANT-TYPE.           11330000
           MOVE SPACES                 TO WS-REPT-DTE-KEYISSUE.         11340000
           MOVE WS-PREV-TOT-AMT        TO WS-REPT-GRANT-AMT.            11350000
           MOVE WS-PREV-TOT-RECOVERY   TO WS-REPT-RCVRY-AMT.            11360000
           MOVE WS-PREV-DTE-RCVRY      TO WS-REPT-DTE-POST.             11370000
           MOVE WS-MTH-END-BAL         TO WS-REPT-MTH-BAL.              11380000
           MOVE WS-DTE-CANCEL          TO WS-REPT-DTE-CANCEL.           11390000
           MOVE WS-FLAT-TYPE           TO WS-REPT-ROOM-TYPE.            11400000
                                                                        11410000
                                                                        11420000
      *    IF WS-FINCL-YEAR = 'Y'                                       11430000
              IF WS-PREV-DTE-RCVRY(1:6) NOT = WS-DTE-CCYYMMDD(1:6)      11440000
                IF ((WS-PREV-NUM-REGN(1:1) NOT = '5' AND '6') AND       11450000
                     (WS-MTH-END-BAL NOT = ZERO))                       11460000
                 IF (WS-DTE-CANCEL NOT = SPACES AND LOW-VALUES          11470000
                                                AND ZEROES)             11480000
                    IF WS-DTE-REINST < WS-DTE-CANCEL                    11490000
                      IF WS-NUM-STATUS = 'C'                            11500000
                       MOVE '5A'                TO WS-REPT-TYPE         11510000
                       WRITE WS-BP13RP5A-REC FROM WS-BP13REPT-REC       11520000
                       ADD 1 TO WS-RP5A-CNT                             11530000
                      ELSE                                              11540000
                       MOVE '5B'                TO WS-REPT-TYPE         11550000
                       WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC       11560000
                       ADD 1 TO WS-RP5B-CNT                             11570000
                      END-IF                                            11580000
                    ELSE                                                11590000
                       MOVE '5B'                TO WS-REPT-TYPE         11600000
                       WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC       11610000
                       ADD 1 TO WS-RP5B-CNT                             11620000
                    END-IF                                              11630000
                                                                        11640000
                 ELSE                                                   11650000
                    MOVE '5B'                TO WS-REPT-TYPE            11660000
                    WRITE WS-BP13RP5B-REC FROM WS-BP13REPT-REC          11670000
                    ADD 1 TO WS-RP5B-CNT                                11680000
                 END-IF                                                 11690000
                END-IF                                                  11700000
              END-IF.                                                   11710000
      *    END-IF.                                                      11720000
                                                                        11730000
           MOVE SPACES TO WS-BP13REPT-REC.                              11740000
           MOVE ZEROES TO WS-PREV-TOT-RECOVERY                          11750000
                          WS-AMT-GRANT                                  11760000
                          WS-GRANT-AMT5.                                11770000
       6500-EXIT.                                                       11780000
            EXIT.                                                       11790000
                                                                        11800000
      ***************************************************************** 11810000
       7000-CHECK-FINCL-YEAR.                                           11820000
      ***************************************************************** 11830000
           MOVE 'N' TO WS-FINCL-YEAR.                                   11840000
           MOVE WS-LAST-CCYY TO WS-YEAR.                                11850000
           COMPUTE WS-YEAR-PREV = WS-YEAR - 1.                          11860000
           COMPUTE WS-YEAR-NEXT = WS-YEAR + 1.                          11870000
                                                                        11880000
           IF WS-LAST-MM = 01 OR 02 OR 03                               11890000
              IF ((WS-DTE-FINCL-CCYYMM(5:2) = '01' OR '02' OR '03') AND 11900000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR)) OR              11910000
                 ((WS-DTE-FINCL-CCYYMM(5:2) = '04' OR '05' OR '06' OR   11920000
                                             '07' OR '08' OR '09' OR    11930000
                                             '10' OR '11' OR '12') AND  11940000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR-PREV))            11950000
                 MOVE 'Y' TO WS-FINCL-YEAR                              11960000
              END-IF                                                    11970000
           END-IF.                                                      11980000
                                                                        11990000
           IF WS-LAST-MM = 04 OR 05 OR 06 OR 07 OR                      12000000
                          08 OR 09 OR 10 OR 11 OR 12                    12010000
              IF ((WS-DTE-FINCL-CCYYMM(5:2) = '01' OR '02' OR '03') AND 12020000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR-NEXT)) OR         12030000
                 ((WS-DTE-FINCL-CCYYMM(5:2) = '04' OR '05' OR '06' OR   12040000
                                             '07' OR '08' OR '09' OR    12050000
                                             '10' OR '11' OR '12') AND  12060000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR))                 12070000
                 MOVE 'Y' TO WS-FINCL-YEAR                              12080000
              END-IF                                                    12090000
           END-IF.                                                      12100000
                                                                        12110000
       7000-EXIT.                                                       12120000
            EXIT.                                                       12130000
                                                                        12140000
      *-----------------*                                               12150000
       9000-CLOSE-FILES.                                                12160000
      *-----------------*                                               12170000
                                                                        12180000
           DISPLAY '******  BP13CB0Q *************'.                    12190000
           DISPLAY 'NO OF RECS READ FROM  BP13F136  : ' CNT-F136-READ.  12200000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 1 : ' WS-RPT1-CNT.    12210000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 2 : ' WS-RPT2-CNT.    12220000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 3 : ' WS-RPT3-CNT.    12230000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 5A: ' WS-RP5A-CNT.    12240000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 5B: ' WS-RP5B-CNT.    12250000
                                                                        12260000
           CLOSE BP13F136                                               12270000
                 BP13K410                                               12280000
                 BP13K800                                               12290000
                 BP13K893                                               12300000
                 BP13K130                                               12310000
                 BP13K840                                               12320000
                 BP13RPT1                                               12330000
                 BP13RPT2                                               12340000
                 BP13RPT3                                               12350000
                 BP13RP5A                                               12360000
                 BP13RP5B.                                              12370000
                                                                        12380000
           IF K893-STATUS NOT = 0 AND 97                                12390000
              DISPLAY ' CLOSING ERROR, K893-STATUS ' K893-STATUS        12400000
              MOVE K893-STATUS TO RETURN-CODE.                          12410000
                                                                        12420000
           IF K800-STATUS NOT = 0 AND 97                                12430000
              DISPLAY ' CLOSING ERROR, K800-STATUS ' K800-STATUS        12440000
              MOVE K800-STATUS TO RETURN-CODE.                          12450000
                                                                        12460000
           IF K410-STATUS NOT = 0 AND 97                                12470000
              DISPLAY ' CLOSING ERROR, K410-STATUS ' K410-STATUS        12480000
              MOVE K410-STATUS TO RETURN-CODE.                          12490000
                                                                        12500000
           STOP RUN.                                                    12510000
                                                                        12520000
       9000-EXIT.                                                       12530000
            EXIT.                                                       12540000
                                                                        12550000
      *---------------------------------------------------------------- 12560000
       9999-SQL-ERROR.                                                  12570000
      *---------------------------------------------------------------- 12580000
           CALL 'DBATIAR'  USING SQLCA.                                 12590000
           EXEC SQL ROLLBACK               END-EXEC.                    12600000
           MOVE 99                         TO    WS-RETURN-CODE.        12610000
           PERFORM 9000-CLOSE-FILES        THRU  9000-EXIT.             12620000
                                                                        12630000
       9999-EXIT.                                                       12640000
           EXIT.                                                        12650000
