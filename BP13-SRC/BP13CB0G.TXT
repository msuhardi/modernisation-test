       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CB0G.                                                 
      *AUTHOR.        MRN1.                                                     
      *DATE-WRITTEN.  15/11/2016.                                               
      * =========================================================== *           
      * SYSTEM OF COMMITMENT  (SOC)                                 *           
      * =========================================================== *           
      *                                                             *           
      *  OBJECTIVE  : REPORTS FOR NOTIFICATION LETTER TYPES         *           
      *               1-DP, 2-QN, 3-LN, 4-SN, BLANK                 *           
      *               BASED ON BP13FB50                             *           
      *                                                             *           
      *  INPUT      :  BP13FB50                                     *           
      *                - MATCH WITH DEBARMENT (P04K010)             *           
      *                - MATCH WITH RESALE (BB24K500)               *           
      *                - MATCH WITH RESALE (BB24K590)               *           
      *                - MATCH WITH SALES  (AB03K030)               *           
      *  OUTPUT     :  REPORT1 - LETTER TYPE 1                      *           
      *                REPORT2A- LETTER TYPE 2 WITH DEBARMENT       *           
      *                REPORT2B- LETTER TYPE 2 WITHOUT DEBARMENT    *           
      *                REPORT3 - LETTER TYPE 3                      *           
      *                REPORT4 - LETTER TYPE 4                      *           
      *                                                             *           
      * ----------------------------------------------------------- *           
      * CHG REF  BY   ON       DESCRIPTION                          *           
      * -------- ---- -------- -----------                          *           
      * BP136905 MRN1 20160614 NEW PROGRAM                          *           
      * BP137663 MRN1 20171025 ADD AMT-PAID, PYMT-DTE, LOCATION     *           
      * BP138252 PP11 20200505 ADD OPTION DATE AND IND TP DATE      *           
      * =========================================================== *           
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
                                                                                
           SELECT BP13FB50 ASSIGN       TO BP13FB50.                            
                                                                                
           SELECT BB24F590  ASSIGN      TO BB24F590.                            
                                                                                
           SELECT BP13KD15 ASSIGN TO BP13KD15                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS KD15-KEY-FLD                               
                  ALTERNATE RECORD KEY IS KD15-ALT-KEY1                         
                  FILE STATUS     IS WS-KD15-STATUS.                            
                                                                                
           SELECT BP13KB20 ASSIGN TO BP13KB20                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS KB20-KEY-FLD                               
                  FILE STATUS     IS WS-KB20-STATUS.                            
                                                                                
           SELECT  P04K010   ASSIGN        TO P04K010                           
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K010-PRIME-KEY                    
                             FILE STATUS   IS WS-K010-STATUS.                   
                                                                                
           SELECT BB24K510   ASSIGN        TO BB24K510                          
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K510-KEY-FLD                      
                             FILE STATUS   IS WS-K510-STATUS.                   
                                                                                
           SELECT BB24K500   ASSIGN        TO BB24K500                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K500-KEY-FLD                      
                             FILE STATUS   IS WS-K500-STATUS.                   
                                                                                
           SELECT AB03K080     ASSIGN        TO AB03K080                        
                               ACCESS MODE   IS DYNAMIC                         
                               ORGANIZATION  IS INDEXED                         
                               RECORD KEY    IS K080-KEY                        
                               FILE STATUS   IS WS-K080-STATUS.                 
                                                                                
           SELECT AB03K030     ASSIGN        TO AB03K030                        
                               ACCESS MODE   IS RANDOM                          
                               ORGANIZATION  IS INDEXED                         
                               RECORD KEY    IS K030-NUM-HDB-REF                
                               FILE STATUS   IS WS-K030-STATUS.                 
                                                                                
           SELECT  BP18K300  ASSIGN        TO BP18K300                          
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K300-NUM-REGN                     
                             FILE STATUS   IS WS-K300-STATUS.                   
                                                                                
           SELECT  BP18K440  ASSIGN        TO BP18K440                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K440-KEY-FLD                      
                             FILE STATUS   IS WS-K440-STATUS.                   
                                                                                
           SELECT REPORT1 ASSIGN        TO REPORT1.                             
                                                                                
           SELECT REPORT2A ASSIGN       TO REPORT2A.                            
                                                                                
           SELECT REPORT2B ASSIGN       TO REPORT2B.                            
                                                                                
           SELECT REPORT3 ASSIGN        TO REPORT3.                             
                                                                                
           SELECT REPORT4 ASSIGN        TO REPORT4.                             
                                                                                
           SELECT REPORTB ASSIGN        TO REPORTB.                             
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
                                                                                
       FD  BP13FB50                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 1000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13KB50.                                                           
                                                                                
       FD  BB24F590                                                             
           RECORD CONTAINS 350 CHARACTERS                                       
           RECORDING MODE IS F.                                                 
       COPY BB24F590.                                                           
                                                                                
       FD   BP13KB20                                                            
            RECORD CONTAINS 3300 CHARACTERS.                                    
       COPY BP13KB20.                                                           
                                                                                
       FD   BP13KD15                                                            
            RECORD CONTAINS  300 CHARACTERS.                                    
       COPY BP13KD15.                                                           
                                                                                
       FD   BP18K300                                                            
            RECORD CONTAINS 800 CHARACTERS.                                     
       COPY BP18K300.                                                           
                                                                                
       FD   BP18K440                                                            
            RECORD CONTAINS 800 CHARACTERS.                                     
       COPY BP18K440.                                                           
                                                                                
       FD   P04K010                                                             
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY P04K010.                                                            
                                                                                
       FD   BB24K510                                                            
            RECORD CONTAINS 50 CHARACTERS.                                      
       COPY BB24K510.                                                           
                                                                                
       FD   BB24K500                                                            
            RECORD CONTAINS 1700 CHARACTERS.                                    
       COPY BB24K500.                                                           
                                                                                
       FD  AB03K080                                                             
                               RECORD CONTAINS 50 CHARACTERS.                   
       COPY AB03K080.                                                           
                                                                                
       FD  AB03K030                                                             
                               RECORD CONTAINS 800 CHARACTERS.                  
       COPY AB03K030.                                                           
                                                                                
       FD  REPORT1                                                              
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORT1-REC      PIC X(200).                                         
                                                                                
       FD  REPORT2A                                                             
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORT2A-REC      PIC X(200).                                        
                                                                                
       FD  REPORT2B                                                             
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORT2B-REC      PIC X(200).                                        
                                                                                
       FD  REPORT3                                                              
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORT3-REC      PIC X(200).                                         
                                                                                
       FD  REPORT4                                                              
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORT4-REC      PIC X(200).                                         
                                                                                
       FD  REPORTB                                                              
           RECORD CONTAINS   200 CHARACTERS                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  REPORTB-REC      PIC X(200).                                         
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01 WS-K010-STATUS             PIC 9(02) VALUE ZEROES.                    
       01 WS-K500-STATUS             PIC 9(02) VALUE ZEROES.                    
       01 WS-K510-STATUS             PIC 9(02) VALUE ZEROES.                    
       01 WS-KB20-STATUS             PIC 9(02) VALUE ZEROES.                    
       01 WS-KD15-STATUS             PIC 9(02) VALUE ZEROES.                    
       01 WS-K080-STATUS             PIC 9(2)  VALUE ZEROES.                    
       01 WS-K030-STATUS             PIC 9(2)  VALUE ZEROES.                    
       01 WS-K300-STATUS             PIC 9(2)    VALUE  0.                      
       01 WS-K440-STATUS             PIC 9(2)    VALUE  0.                      
       01 WS-K300-FND                PIC X(01) VALUE 'N'.                       
       01 WS-K440-FND                PIC X(01) VALUE 'N'.                       
       01 EOF-P04K010                PIC X(1)  VALUE 'N'.                       
       01 EOF-BB24K510               PIC X(1)  VALUE 'N'.                       
       01 EOF-BB24K500               PIC X(1)  VALUE 'N'.                       
       01 EOF-BP13FB50               PIC X(1)  VALUE 'N'.                       
       01 EOF-BB24F590               PIC X(1)  VALUE 'N'.                       
       01 EOF-P13FB50B               PIC X(1)  VALUE 'N'.                       
       01 WS-K080-EOF                PIC X     VALUE 'N'.                       
       01 WS-NRIC-FOUND              PIC X     VALUE 'N'.                       
       01 WS-RECHECK-RSL             PIC X     VALUE 'N'.                       
       01 WS-DISPLAY-STAT            PIC X     VALUE 'N'.                       
       01 WS-DEB-VALID               PIC X     VALUE 'N'.                       
       01 WS-RSL-VALID               PIC X     VALUE 'N'.                       
       01 WS-NRIC-NOTFND             PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPT1-CNT                PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPT2A-CNT               PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPT2B-CNT               PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPT3-CNT                PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPT4-CNT                PIC 9(7)  VALUE ZEROES.                    
       01 WS-RPTB-CNT                PIC 9(7)  VALUE ZEROES.                    
       01 WS-DEB-INVALID-CNT         PIC 9(2)  VALUE ZEROES.                    
       01 WS-RSL-INVALID-CNT         PIC 9(2)  VALUE ZEROES.                    
       01 WS-AMT-RCPT                PIC 9(8)V99 VALUE ZEROES.                  
       01 WS-DTE-SEND                PIC X(8)  VALUE SPACES.                    
       01 WS-CDE-LOC                 PIC X(2)  VALUE SPACES.                    
                                                                                
       01  WS-HEADER-LINE1-RSL.                                                 
           05  FILLER                 PIC X(45) VALUE                           
               '  REG   ;   NRIC   ; SMS; RESL ; CURRENT RESL'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '; S&P DATE;LEVY AMT PAYABLE;RESL COMPLETION D'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'ATE ;PROJECT ;DTE OPTION;DTE INDVDL TOP      '.                 
                                                                                
       01  WS-HEADER-LINE2-RSL.                                                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------  ---------  ---  ----   ------------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '  --------  ----------- ----------------   --'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------------------                         '.                 
                                                                                
       01  WS-HEADER-LINE1-RSL234.                                              
           05  FILLER                 PIC X(45) VALUE                           
               '  REG   ;   NRIC   ; SMS; RESL;  CURRENT RESL'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '; S&P DATE;  LEVY AMT PAYABLE;  AMT PAID; PYM'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'T DATE;LOCATION   ;PROJECT; DTE OPTION; DTE I'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'NDVDL TOP                                    '.                 
                                                                                
       01  WS-HEADER-LINE2-RSL234.                                              
           05  FILLER                 PIC X(45) VALUE                           
               '--------  ---------  ---  ----   ------------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '  --------   ----------------  --------  ----'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '----- -------- ------------ ----------- -----'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------------                               '.                 
                                                                                
       01  WS-HEADER-LINE1-DEB.                                                 
           05  FILLER                 PIC X(45) VALUE                           
               '  REG   ;   NRIC   ; SMS; EC DEBAR; CURRENT E'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'C DEBAR; S&P DATE; LEVY AMT PAYABLE; AMT PAID'.                 
           05  FILLER                 PIC X(45) VALUE                           
               ' ;PYMT DATE ;LOCATION;PROJECT; DTE OPTION; DT'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'E INDVDL TOP                                 '.                 
                                                                                
       01  WS-HEADER-LINE2-DEB.                                                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------  ---------  ---  --------  ---------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '-------  --------  ----------------  --------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '  --------- -------- -------------- ---------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------                                     '.                 
                                                                                
       01  WS-HEADER-LINE1-BLANK.                                               
           05  FILLER                 PIC X(45) VALUE                           
               '  REG   ;   NRIC   ; SMS; RESL;  S&P DATE; LE'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'VY AMT PAYABLE;PROJECT; DTE OPTION; INDVDL  T'.                 
           05  FILLER                 PIC X(45) VALUE                           
               'OP                                           '.                 
                                                                                
       01  WS-HEADER-LINE2-BLANK.                                               
           05  FILLER                 PIC X(45) VALUE                           
               '--------  ---------  ---  ----   --------  --'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------------   --------- --------- --------'.                 
           05  FILLER                 PIC X(45) VALUE                           
               '--------------                               '.                 
                                                                                
       01  WS-RPT-DTL-RSL.                                                      
           05 WS-RPT1-REGNO                 PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-NRIC                  PIC X(09) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-ASS-SMS-FT            PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPT1-ASS-RSL-STAT          PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(05) VALUE SPACES.             
           05 WS-RPT1-CURR-RSL-STAT         PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-CURR-RSL-STAT2        PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-DTE-SNP               PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(03) VALUE SPACES.             
           05 WS-RPT1-AMT-LEVY              PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(07) VALUE SPACES.             
           05 WS-RPT1-DTE-RESL              PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(06) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-PROJECT               PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(04) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-DTE-OPTION            PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT1-INDVDL-TOP            PIC X(08) VALUE SPACES.             
                                                                                
       01  WS-RPT-DTL-RSL234.                                                   
           05 WS-RPT234-REGNO               PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-NRIC                PIC X(09) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-ASS-SMS-FT          PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPT234-ASS-RSL-STAT        PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(05) VALUE SPACES.             
           05 WS-RPT234-CURR-RSL-STAT       PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-CURR-RSL-STAT2      PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-DTE-SNP             PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(06) VALUE SPACES.             
           05 WS-RPT234-AMT-LEVY            PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPT234-AMT-PAID            PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPT234-DTE-PAYMENT         PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(03) VALUE SPACES.             
           05 WS-RPT234-LOCATION            PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPT234-PROJECT             PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(04) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-DTE-OPTION          PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT234-INDVDL-TOP          PIC X(08) VALUE SPACES.             
                                                                                
       01  WS-RPT-DTL-DEB.                                                      
           05 WS-RPT-REGNO                  PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT-NRIC                   PIC X(09) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT-ASS-SMS-FT             PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(04) VALUE SPACES.             
           05 WS-RPT-ASS-DEB-CDE            PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(08) VALUE SPACES.             
           05 WS-RPT-CURR-DEB-CDE           PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(07) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT-DTE-SNP                PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPT-AMT-LEVY               PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(05) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPT-AMT-PAID               PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPT-DTE-PAYMENT            PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPT-LOCATION               PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPT-PROJECT                PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(04) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT-DTE-OPTION             PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPT-INDVDL-TOP             PIC X(08) VALUE SPACES.             
                                                                                
       01  WS-RPT-DTL-BLANK.                                                    
           05 WS-RPTB-REGNO                 PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPTB-NRIC                  PIC X(09) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPTB-ASS-SMS-FT            PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPTB-ASS-RSL-STAT          PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 WS-RPTB-DTE-SNP               PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(05) VALUE SPACES.             
           05 WS-RPTB-AMT-LEVY              PIC ZZZZZZ9.99 VALUE ZEROES.        
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 WS-RPTB-PROJECT               PIC X(03) VALUE SPACES.             
           05 FILLER                        PIC X(04) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPTB-DTE-OPTION            PIC X(08) VALUE SPACES.             
           05 FILLER                        PIC X(02) VALUE SPACES.             
           05 FILLER                        PIC X(01) VALUE ';'.                
           05 FILLER                        PIC X(01) VALUE SPACES.             
           05 WS-RPTB-INDVDL-TOP            PIC X(08) VALUE SPACES.             
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
           PERFORM 1000-OPENING-ROUTINE  THRU 1000-EXIT.                        
           PERFORM 1100-READ-BP13FB50    THRU 1100-EXIT.                        
           PERFORM 1150-READ-BB24F590    THRU 1150-EXIT.                        
           PERFORM 1200-PROCESS-BP13FB50 THRU 1200-EXIT                         
                   UNTIL EOF-BP13FB50 = 'Y'.                                    
           PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                         
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-OPENING-ROUTINE.                                                    
      *-------------------------------------------------------------            
           OPEN INPUT  BP13FB50                                                 
                       BB24F590                                                 
                       BP13KB20                                                 
                       BP13KD15                                                 
                       P04K010                                                  
                       BB24K510                                                 
                       BB24K500                                                 
                       AB03K080                                                 
                       AB03K030                                                 
                       BP18K300                                                 
                       BP18K440                                                 
               OUTPUT  REPORT1                                                  
                       REPORT2A                                                 
                       REPORT2B                                                 
                       REPORT3                                                  
                       REPORT4                                                  
                       REPORTB.                                                 
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'P04K010 - ERROR OPENING : ' WS-K010-STATUS               
              MOVE WS-K010-STATUS                   TO RETURN-CODE              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K510-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BB24K510 - ERROR OPENING : ' WS-K510-STATUS              
              MOVE WS-K510-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K500-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BB24K500 - ERROR OPENING : ' WS-K500-STATUS              
              MOVE WS-K500-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KB20-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KB20 - ERROR OPENING : ' WS-KB20-STATUS              
              MOVE WS-KB20-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KD15-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD15 - ERROR OPENING : ' WS-KD15-STATUS              
              MOVE WS-KD15-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K080-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K080 - ERROR OPENING : ' WS-K080-STATUS              
              MOVE WS-K080-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K030-STATUS NOT = 00 AND 97                                    
              DISPLAY 'AB03K030 - ERROR OPENING : ' WS-K030-STATUS              
              MOVE WS-K030-STATUS                    TO RETURN-CODE             
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K300-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP18K300 - ERROR OPENING : ' WS-K300-STATUS              
              MOVE     WS-K300-STATUS      TO RETURN-CODE                       
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K440-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP18K440 - ERROR OPENING : ' WS-K440-STATUS              
              MOVE     WS-K440-STATUS      TO RETURN-CODE                       
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           WRITE REPORT1-REC FROM WS-HEADER-LINE1-RSL.                          
                                                                                
           WRITE REPORT2A-REC FROM WS-HEADER-LINE1-DEB.                         
                                                                                
           WRITE REPORT2B-REC FROM WS-HEADER-LINE1-RSL234.                      
                                                                                
           WRITE REPORT3-REC FROM WS-HEADER-LINE1-RSL234.                       
                                                                                
           WRITE REPORT4-REC FROM WS-HEADER-LINE1-RSL234.                       
                                                                                
           WRITE REPORTB-REC FROM WS-HEADER-LINE1-BLANK.                        
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1100-READ-BP13FB50.                                                      
      *-------------------------------------------------------------            
           READ BP13FB50 AT END                                                 
                         MOVE 'Y' TO EOF-BP13FB50                               
                         GO TO 1100-EXIT.                                       
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1150-READ-BB24F590.                                                      
      *-------------------------------------------------------------            
           READ BB24F590 AT END                                                 
                         MOVE 'Y' TO EOF-BB24F590                               
                         GO TO 1150-EXIT.                                       
                                                                                
           IF KB50-KEY-FLD = BB24F590-REC(81:17)                                
              MOVE F590-AMT-RCPT      TO WS-AMT-RCPT                            
              MOVE F590-DTE-SEND      TO WS-DTE-SEND                            
              MOVE F590-NUM-RCPT(1:2) TO WS-CDE-LOC                             
           END-IF.                                                              
                                                                                
       1150-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1200-PROCESS-BP13FB50.                                                   
      ******************************************************************        
           MOVE SPACES                           TO P04K010-REC.                
           INITIALIZE                            P04K010-REC.                   
                                                                                
           MOVE KB50-NUM-REGN                    TO KB20-NUM-REGN.              
           PERFORM 1250-READ-BP13KB20            THRU 1250-EXIT.                
           MOVE KB20-NUM-PROJECT                 TO KD15-NUM-PRJCT-KEY1.        
           MOVE KB50-NUM-REGN                    TO KD15-NUM-REGN.              
           PERFORM 1270-READ-BP13KD15            THRU 1270-EXIT.                
                                                                                
           PERFORM 2000-READ-BP18K300            THRU 2000-EXIT.                
           PERFORM 2100-READ-BP18K440            THRU 2100-EXIT.                
                                                                                
           MOVE 'N'    TO  WS-RSL-VALID.                                        
           MOVE ZEROES TO  WS-RSL-INVALID-CNT.                                  
                                                                                
           IF KB50-KEY-FLD = BB24F590-REC(81:17)                                
              MOVE F590-AMT-RCPT      TO WS-AMT-RCPT                            
              MOVE F590-DTE-SEND      TO WS-DTE-SEND                            
              MOVE F590-NUM-RCPT(1:2) TO WS-CDE-LOC                             
           ELSE                                                                 
              PERFORM 1150-READ-BB24F590 THRU 1150-EXIT UNTIL                   
                BB24F590-REC(81:17) > KB50-KEY-FLD OR EOF-BB24F590 = 'Y'        
           END-IF.                                                              
                                                                                
           IF KB50-LETTER-TYPE = ' '                                            
              PERFORM 2700-WRITE-REPORT-BLANK   THRU 2700-EXIT                  
           END-IF.                                                              
                                                                                
           IF KB50-LETTER-TYPE = '1'                                            
              MOVE 'N' TO  WS-NRIC-FOUND                                        
                           WS-RECHECK-RSL                                       
              PERFORM 3000-CHECK-SMS THRU 3000-EXIT                             
              IF WS-NRIC-FOUND = 'N'                                            
                 MOVE 'Y' TO WS-RECHECK-RSL                                     
                 PERFORM 2200-RETRIEVE-RSL THRU 2200-EXIT                       
              END-IF                                                            
              IF (WS-RSL-VALID = 'N') AND                                       
                 (WS-RSL-INVALID-CNT > 0)                                       
                  PERFORM 2500-WRITE-REPORT1   THRU 2500-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF WS-K300-FND = 'Y' OR WS-K440-FND = 'Y'                            
              IF KB50-LETTER-TYPE = '2'                                         
                 IF KB50-CDE-DEBAR = SPACES OR LOW-VALUES                       
                    PERFORM 2200-RETRIEVE-RSL THRU 2200-EXIT                    
                    IF (WS-RSL-VALID = 'N') AND                                 
                       (WS-RSL-INVALID-CNT > 0)                                 
                       PERFORM 2600-WRITE-REPORT234 THRU 2600-EXIT              
                    END-IF                                                      
                 ELSE                                                           
                    IF KB50-CDE-DEBAR NOT = 'EJ'                                
                       PERFORM 1280-RETRIEVE-DEB THRU 1280-EXIT                 
                       IF (WS-DEB-VALID = 'N') AND                              
                          (WS-DEB-INVALID-CNT > 0)                              
                          MOVE KB50-NUM-REGN   TO WS-RPT-REGNO                  
                          MOVE KB50-NUM-NRIC   TO WS-RPT-NRIC                   
                          MOVE KB50-CDE-DEBAR  TO WS-RPT-ASS-DEB-CDE            
                          MOVE SPACES          TO WS-RPT-CURR-DEB-CDE           
                          MOVE KD15-DTE-SNP    TO WS-RPT-DTE-SNP                
                          MOVE KB50-AMT-LEVY   TO WS-RPT-AMT-LEVY               
                          MOVE WS-AMT-RCPT     TO WS-RPT-AMT-PAID               
                          MOVE WS-DTE-SEND     TO WS-RPT-DTE-PAYMENT            
                          MOVE WS-CDE-LOC      TO WS-RPT-LOCATION               
                          MOVE KB20-NUM-PROJECT  TO WS-RPT-PROJECT              
                          IF WS-K300-FND = 'Y'                                  
                             MOVE K300-DTE-OPTION TO WS-RPT-DTE-OPTION          
                             MOVE K300-DTE-INDVDL-TOP                           
                                                  TO WS-RPT-INDVDL-TOP          
                          END-IF                                                
                          IF WS-K440-FND = 'Y'                                  
                             MOVE K440-DTE-OPTION TO WS-RPT-DTE-OPTION          
                             MOVE K440-DTE-INDVDL-TOP                           
                                                  TO WS-RPT-INDVDL-TOP          
                          END-IF                                                
                                                                                
                          WRITE REPORT2A-REC FROM WS-RPT-DTL-DEB                
                          ADD 1 TO WS-RPT2A-CNT                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
              IF KB50-LETTER-TYPE = '3' OR '4'                                  
                 PERFORM 2200-RETRIEVE-RSL THRU 2200-EXIT                       
                 IF (WS-RSL-VALID = 'N') AND                                    
                    (WS-RSL-INVALID-CNT > 0)                                    
                    PERFORM 2600-WRITE-REPORT234 THRU 2600-EXIT                 
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE ZEROES        TO WS-AMT-RCPT.                                   
           MOVE SPACES        TO WS-DTE-SEND                                    
                                 WS-CDE-LOC.                                    
                                                                                
           PERFORM 1100-READ-BP13FB50 THRU 1100-EXIT.                           
                                                                                
       1200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------*                                                     
       1250-READ-BP13KB20.                                                      
      *-------------------*                                                     
                                                                                
           MOVE SPACES TO KB20-NUM-PROJECT.                                     
                                                                                
           READ BP13KB20.                                                       
                                                                                
           IF WS-KB20-STATUS = 00                                               
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-KB20-STATUS = 23                                            
                 MOVE SPACES              TO KB20-NUM-PROJECT                   
                 DISPLAY 'BP13KB20 - REC NOT FND, KEY ' KB20-NUM-REGN           
              ELSE                                                              
                 DISPLAY 'ERROR READING - BP13KB20 : ' WS-KB20-STATUS           
                 MOVE WS-KB20-STATUS      TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
       1250-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       1270-READ-BP13KD15.                                                      
      *-------------------*                                                     
                                                                                
           READ BP13KD15 KEY IS KD15-ALT-KEY1.                                  
                                                                                
           IF WS-KD15-STATUS = 00                                               
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-KD15-STATUS = 23                                            
                 MOVE SPACES              TO KD15-DTE-SNP                       
                 DISPLAY 'BP13KD15 - REC NOT FND, KEY ' KD15-ALT-KEY1           
              ELSE                                                              
                 DISPLAY 'ERROR READING - BP13KD15 : ' WS-KD15-STATUS           
                 MOVE WS-KD15-STATUS      TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
       1270-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1280-RETRIEVE-DEB.                                                       
      *-------------------------------------------------------------            
           MOVE 'N'                              TO EOF-P04K010                 
                                                    WS-DEB-VALID.               
           MOVE ZEROES                           TO WS-DEB-INVALID-CNT.         
           MOVE SPACES                           TO K010-PRIME-KEY.             
           MOVE KB50-NUM-NRIC                    TO K010-NUM-UINFIN.            
                                                                                
           START P04K010  KEY = K010-NUM-UINFIN.                                
                                                                                
           EVALUATE WS-K010-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 1300-READNEXT-P04K010  THRU 1300-EXIT               
                    PERFORM 1400-PROCESS-P04K010   THRU 1400-EXIT               
                            UNTIL EOF-P04K010 = 'Y'                             
               WHEN 20                                                          
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    DISPLAY 'START ERROR P04K010 : ' WS-K010-STATUS             
                            ' NRIC : ' K010-NUM-UINFIN                          
                    PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT               
            END-EVALUATE.                                                       
                                                                                
       1280-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       1300-READNEXT-P04K010.                                                   
      ******************************************************************        
                                                                                
           READ P04K010 NEXT RECORD                                             
                         AT END MOVE 'Y' TO EOF-P04K010.                        
                                                                                
       1300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1400-PROCESS-P04K010.                                                    
      ******************************************************************        
                                                                                
           IF (K010-NUM-UINFIN = KB50-NUM-NRIC)                                 
              INITIALIZE WS-RPT-DTL-DEB                                         
              IF K010-REASON-CODE = 'RP'                                        
                 MOVE KB50-NUM-REGN       TO WS-RPT-REGNO                       
                 MOVE KB50-NUM-NRIC       TO WS-RPT-NRIC                        
                 MOVE KB50-CDE-DEBAR      TO WS-RPT-ASS-DEB-CDE                 
                 MOVE K010-REASON-CODE    TO WS-RPT-CURR-DEB-CDE                
                 MOVE KD15-DTE-SNP        TO WS-RPT-DTE-SNP                     
                 MOVE KB50-AMT-LEVY       TO WS-RPT-AMT-LEVY                    
                 MOVE WS-AMT-RCPT         TO WS-RPT-AMT-PAID                    
                 MOVE WS-DTE-SEND         TO WS-RPT-DTE-PAYMENT                 
                 MOVE WS-CDE-LOC          TO WS-RPT-LOCATION                    
                 MOVE KB20-NUM-PROJECT    TO WS-RPT-PROJECT                     
                 IF WS-K300-FND = 'Y'                                           
                    MOVE K300-DTE-OPTION TO WS-RPT-DTE-OPTION                   
                    MOVE K300-DTE-INDVDL-TOP                                    
                                         TO WS-RPT-INDVDL-TOP                   
                 END-IF                                                         
                 IF WS-K440-FND = 'Y'                                           
                    MOVE K440-DTE-OPTION TO WS-RPT-DTE-OPTION                   
                    MOVE K440-DTE-INDVDL-TOP                                    
                                         TO WS-RPT-INDVDL-TOP                   
                 END-IF                                                         
                                                                                
                 WRITE REPORT2A-REC FROM WS-RPT-DTL-DEB                         
                 ADD 1 TO WS-RPT2A-CNT                                          
                 MOVE 'Y' TO WS-DEB-VALID                                       
              ELSE                                                              
                 ADD 1 TO WS-DEB-INVALID-CNT                                    
              END-IF                                                            
           ELSE                                                                 
               MOVE 'Y' TO EOF-P04K010                                          
           END-IF.                                                              
                                                                                
           PERFORM 1300-READNEXT-P04K010  THRU 1300-EXIT.                       
                                                                                
       1400-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       2000-READ-BP18K300.                                                      
      ******************************************************************        
                                                                                
            MOVE 'N'                     TO WS-K300-FND.                        
            MOVE KB50-NUM-REGN           TO K300-NUM-REGN.                      
                                                                                
            READ BP18K300.                                                      
                                                                                
            EVALUATE WS-K300-STATUS                                             
                WHEN 00                                                         
                     MOVE 'Y'                 TO WS-K300-FND                    
                WHEN 23                                                         
                     MOVE 'N'                 TO WS-K300-FND                    
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP18K300 : ' WS-K300-STATUS         
                             ' REGN NO = ' K300-NUM-REGN                        
                     PERFORM  9000-CLOSE-ROUTINE    THRU 9000-EXIT              
            END-EVALUATE.                                                       
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       2100-READ-BP18K440.                                                      
      ******************************************************************        
                                                                                
            MOVE 'N'                     TO WS-K440-FND.                        
            MOVE KB50-NUM-REGN           TO K440-NUM-REGN.                      
                                                                                
            READ BP18K440.                                                      
                                                                                
            EVALUATE WS-K440-STATUS                                             
                WHEN 00                                                         
                     MOVE 'Y'                 TO WS-K440-FND                    
                WHEN 23                                                         
                     MOVE 'N'                 TO WS-K440-FND                    
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP18K440 : ' WS-K440-STATUS         
                             ' REGN NO = ' K440-NUM-REGN                        
                     PERFORM  9000-CLOSE-ROUTINE    THRU 9000-EXIT              
            END-EVALUATE.                                                       
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2200-RETRIEVE-RSL.                                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES         TO K510-KEY-FLD.                                 
           MOVE KB50-NUM-NRIC  TO K510-NUM-UIN.                                 
                                                                                
           START BB24K510 KEY >=  K510-KEY-FLD.                                 
                                                                                
           IF  WS-K510-STATUS = ZEROES                                          
               PERFORM 2300-READ-BB24K510 THRU 2300-EXIT                        
                  UNTIL K510-NUM-UIN NOT = KB50-NUM-NRIC                        
           END-IF.                                                              
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2300-READ-BB24K510.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BB24K510 NEXT AT END MOVE HIGH-VALUE TO K510-KEY-FLD            
                                     GO TO 2300-EXIT.                           
                                                                                
           IF K510-NUM-UIN = KB50-NUM-NRIC                                      
              PERFORM 2400-READ-BB24K500 THRU 2400-EXIT                         
           END-IF.                                                              
                                                                                
       2300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2400-READ-BB24K500.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE K510-NUM-HDB-REF   TO K500-NUM-HDB-REF.                         
           MOVE K510-DTE-APPROVAL  TO K500-DTE-APPROVAL.                        
                                                                                
           READ BB24K500.                                                       
                                                                                
           IF WS-K500-STATUS = ZEROES                                           
            MOVE 'N' TO WS-DISPLAY-STAT                                         
            IF K500-CDE-RESALE-STATUS = 'SL ' OR 'LO ' OR 'LI ' OR '2LI'        
                   OR 'QO ' OR 'CL ' OR '2L ' OR 'OL ' OR 'PO ' OR 'PI '        
                   OR 'FO ' OR 'FI ' OR 'LOH' OR 'LIH' OR 'LOT' OR 'LIT'        
                   OR 'FOH' OR 'FIH' OR 'FOT' OR 'FIT' OR 'QOH' OR 'FOQ'        
                   OR 'POQ' OR 'QOP' OR 'QHP' OR 'FQP' OR 'PQP' OR 'HOQ'        
                   OR 'HQP' OR 'ESL' OR 'ELI' OR 'EQO' OR 'BQO' OR 'BQP'        
                   OR 'BHO' OR 'BHP' OR 'SP ' OR '   '                          
              MOVE 'Y' TO WS-DISPLAY-STAT                                       
            END-IF                                                              
            IF K500-CDE-RESALE-STATUS2 = 'SL ' OR 'LO ' OR 'LI '                
                   OR 'QO ' OR 'CL ' OR '2L ' OR 'OL ' OR 'PO ' OR 'PI '        
                   OR 'FO ' OR 'FI ' OR 'LOH' OR 'LIH' OR 'LOT' OR 'LIT'        
                   OR 'FOH' OR 'FIH' OR 'FOT' OR 'FIT' OR 'QOH' OR 'FOQ'        
                   OR 'POQ' OR 'QOP' OR 'QHP' OR 'FQP' OR 'PQP' OR 'HOQ'        
                   OR 'HQP' OR 'ESL' OR 'ELI' OR 'EQO' OR 'BQO' OR 'BQP'        
                   OR 'BHO' OR 'BHP' OR 'SP ' OR '2LI'                          
              MOVE 'Y' TO WS-DISPLAY-STAT                                       
            END-IF                                                              
            IF WS-DISPLAY-STAT = 'Y'                                            
               IF KB50-LETTER-TYPE = '1'                                        
                 IF (WS-RECHECK-RSL = 'N' AND                                   
                     K500-NUM-HDB-REF = K030-NUM-HDB-REF) OR                    
                     WS-RECHECK-RSL = 'Y'                                       
                      PERFORM 2500-WRITE-REPORT1 THRU 2500-EXIT                 
                      MOVE 'Y' TO WS-NRIC-FOUND                                 
                                  WS-RSL-VALID                                  
                 END-IF                                                         
               ELSE                                                             
                 IF K500-NUM-HDB-REF = KB50-RSL-SCH-ACC                         
                    PERFORM 2600-WRITE-REPORT234 THRU 2600-EXIT                 
                    MOVE 'Y' TO WS-RSL-VALID                                    
                 END-IF                                                         
               END-IF                                                           
            ELSE                                                                
               ADD 1 TO WS-RSL-INVALID-CNT                                      
            END-IF                                                              
           ELSE                                                                 
              DISPLAY 'RECORD NOT FOUND IN BB24K500 ' KB50-NUM-NRIC             
                      '--> ' K510-DTE-APPROVAL                                  
                      '--> ' K510-NUM-HDB-REF                                   
           END-IF.                                                              
                                                                                
       2400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************************************************             
       2500-WRITE-REPORT1.                                                      
      *************************************************************             
                                                                                
           INITIALIZE WS-RPT-DTL-RSL.                                           
           MOVE KB50-NUM-REGN              TO WS-RPT1-REGNO.                    
           MOVE KB50-NUM-NRIC              TO WS-RPT1-NRIC.                     
           MOVE KB50-CDE-RESALE-STATUS     TO WS-RPT1-ASS-RSL-STAT.             
           MOVE KB50-SMS-FLAT-TYPE         TO WS-RPT1-ASS-SMS-FT.               
                                                                                
           IF WS-DISPLAY-STAT = 'Y'                                             
              MOVE K500-CDE-RESALE-STATUS  TO WS-RPT1-CURR-RSL-STAT             
              MOVE K500-CDE-RESALE-STATUS2 TO WS-RPT1-CURR-RSL-STAT2            
           ELSE                                                                 
              MOVE SPACES                  TO WS-RPT1-CURR-RSL-STAT             
                                              WS-RPT1-CURR-RSL-STAT2            
           END-IF.                                                              
                                                                                
           MOVE KD15-DTE-SNP               TO WS-RPT1-DTE-SNP.                  
           MOVE KB50-AMT-LEVY              TO WS-RPT1-AMT-LEVY.                 
           MOVE KB20-NUM-PROJECT           TO WS-RPT1-PROJECT.                  
           IF WS-RPT1-CURR-RSL-STAT = 'QO' OR                                   
              WS-RPT1-CURR-RSL-STAT2 = 'QO'                                     
              MOVE K500-DTE-RESL-EFF       TO WS-RPT1-DTE-RESL                  
           ELSE                                                                 
              MOVE SPACES                  TO WS-RPT1-DTE-RESL                  
           END-IF.                                                              
                                                                                
           IF WS-K300-FND = 'Y'                                                 
              MOVE K300-DTE-OPTION         TO WS-RPT1-DTE-OPTION                
              MOVE K300-DTE-INDVDL-TOP     TO WS-RPT1-INDVDL-TOP                
           END-IF.                                                              
                                                                                
           IF WS-K440-FND = 'Y'                                                 
              MOVE K440-DTE-OPTION         TO WS-RPT1-DTE-OPTION                
              MOVE K440-DTE-INDVDL-TOP     TO WS-RPT1-INDVDL-TOP                
           END-IF.                                                              
                                                                                
           WRITE REPORT1-REC FROM WS-RPT-DTL-RSL.                               
           ADD 1 TO WS-RPT1-CNT.                                                
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************************************************             
       2600-WRITE-REPORT234.                                                    
      *************************************************************             
                                                                                
           INITIALIZE WS-RPT-DTL-RSL234.                                        
           MOVE KB50-NUM-REGN              TO WS-RPT234-REGNO.                  
           MOVE KB50-NUM-NRIC              TO WS-RPT234-NRIC.                   
           MOVE KB50-CDE-RESALE-STATUS     TO WS-RPT234-ASS-RSL-STAT.           
           MOVE KB50-SMS-FLAT-TYPE         TO WS-RPT234-ASS-SMS-FT.             
                                                                                
           IF WS-DISPLAY-STAT = 'Y'                                             
              MOVE K500-CDE-RESALE-STATUS  TO WS-RPT234-CURR-RSL-STAT           
              MOVE K500-CDE-RESALE-STATUS2 TO WS-RPT234-CURR-RSL-STAT2          
           ELSE                                                                 
              MOVE SPACES                  TO WS-RPT234-CURR-RSL-STAT           
                                              WS-RPT234-CURR-RSL-STAT2          
           END-IF.                                                              
                                                                                
           MOVE KD15-DTE-SNP               TO WS-RPT234-DTE-SNP.                
           MOVE KB50-AMT-LEVY              TO WS-RPT234-AMT-LEVY.               
           MOVE WS-AMT-RCPT                TO WS-RPT234-AMT-PAID.               
           MOVE WS-DTE-SEND                TO WS-RPT234-DTE-PAYMENT.            
           MOVE WS-CDE-LOC                 TO WS-RPT234-LOCATION.               
           MOVE KB20-NUM-PROJECT           TO WS-RPT234-PROJECT.                
                                                                                
           IF WS-K300-FND = 'Y'                                                 
              MOVE K300-DTE-OPTION         TO WS-RPT234-DTE-OPTION              
              MOVE K300-DTE-INDVDL-TOP     TO WS-RPT234-INDVDL-TOP              
           END-IF.                                                              
                                                                                
           IF WS-K440-FND = 'Y'                                                 
              MOVE K440-DTE-OPTION         TO WS-RPT234-DTE-OPTION              
              MOVE K440-DTE-INDVDL-TOP     TO WS-RPT234-INDVDL-TOP              
           END-IF.                                                              
                                                                                
           IF KB50-LETTER-TYPE = '2'                                            
              WRITE REPORT2B-REC FROM WS-RPT-DTL-RSL234                         
              ADD 1 TO WS-RPT2B-CNT                                             
           END-IF.                                                              
                                                                                
           IF KB50-LETTER-TYPE = '3'                                            
              WRITE REPORT3-REC FROM WS-RPT-DTL-RSL234                          
              ADD 1 TO WS-RPT3-CNT                                              
           END-IF.                                                              
                                                                                
           IF KB50-LETTER-TYPE = '4'                                            
              WRITE REPORT4-REC FROM WS-RPT-DTL-RSL234                          
              ADD 1 TO WS-RPT4-CNT                                              
           END-IF.                                                              
                                                                                
       2600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************************************************             
       2700-WRITE-REPORT-BLANK.                                                 
      *************************************************************             
                                                                                
           INITIALIZE WS-RPT-DTL-RSL.                                           
           MOVE KB50-NUM-REGN              TO WS-RPTB-REGNO.                    
           MOVE KB50-NUM-NRIC              TO WS-RPTB-NRIC.                     
           MOVE KB50-CDE-RESALE-STATUS     TO WS-RPTB-ASS-RSL-STAT.             
           MOVE KB50-SMS-FLAT-TYPE         TO WS-RPTB-ASS-SMS-FT.               
                                                                                
           MOVE KD15-DTE-SNP               TO WS-RPTB-DTE-SNP.                  
           MOVE KB50-AMT-LEVY              TO WS-RPTB-AMT-LEVY.                 
           MOVE KB20-NUM-PROJECT           TO WS-RPTB-PROJECT.                  
                                                                                
           IF WS-K300-FND = 'Y'                                                 
              MOVE K300-DTE-OPTION         TO WS-RPTB-DTE-OPTION                
              MOVE K300-DTE-INDVDL-TOP     TO WS-RPTB-INDVDL-TOP                
           END-IF.                                                              
                                                                                
           IF WS-K440-FND = 'Y'                                                 
              MOVE K440-DTE-OPTION         TO WS-RPTB-DTE-OPTION                
              MOVE K440-DTE-INDVDL-TOP     TO WS-RPTB-INDVDL-TOP                
           END-IF.                                                              
                                                                                
           WRITE REPORTB-REC FROM WS-RPT-DTL-BLANK.                             
           ADD 1 TO WS-RPTB-CNT.                                                
                                                                                
       2700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *************************************************************             
       3000-CHECK-SMS.                                                          
      *************************************************************             
           MOVE SPACES                   TO AB03K080-REC.                       
           INITIALIZE                       AB03K080-REC.                       
                                                                                
           MOVE KB50-NUM-NRIC            TO K080-NUM-UIN.                       
           MOVE 'N'                      TO WS-K080-EOF.                        
                                                                                
           START AB03K080 KEY >= K080-KEY.                                      
                                                                                
           EVALUATE WS-K080-STATUS                                              
               WHEN 00                                                          
                    PERFORM 3100-READNEXT-AB03K080 THRU 3100-EXIT               
                      UNTIL K080-NUM-UIN NOT = KB50-NUM-NRIC                    
                         OR WS-K080-EOF = 'Y'                                   
                         OR WS-NRIC-FOUND = 'Y'                                 
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD 1 TO WS-NRIC-NOTFND                                     
               WHEN OTHER                                                       
                    DISPLAY 'AB03K080 START ERROR ' WS-K080-STATUS              
                    DISPLAY 'K080 KEY: ' K080-KEY                               
                    MOVE WS-K080-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *************************************************************             
       3100-READNEXT-AB03K080.                                                  
      *************************************************************             
           READ AB03K080 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'                 TO WS-K080-EOF                         
           END-READ.                                                            
                                                                                
           EVALUATE WS-K080-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    IF K080-NUM-UIN = KB50-NUM-NRIC                             
                       PERFORM 3500-READ-AB03K030 THRU 3500-EXIT                
                    END-IF                                                      
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD 1 TO WS-NRIC-NOTFND                                     
               WHEN OTHER                                                       
                    DISPLAY 'AB03K080 READ NEXT ERROR ' WS-K080-STATUS          
                    DISPLAY 'K080 KEY: ' K080-KEY                               
                    MOVE WS-K080-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *************************************************************             
       3500-READ-AB03K030.                                                      
      *************************************************************             
           MOVE SPACES                   TO AB03K030-REC.                       
           INITIALIZE                       AB03K030-REC.                       
                                                                                
           MOVE K080-NUM-HDB-REF         TO K030-NUM-HDB-REF.                   
                                                                                
           READ AB03K030.                                                       
                                                                                
           EVALUATE WS-K030-STATUS                                              
               WHEN 00                                                          
                    IF K030-CDE-SALES-TYP = '1 ' OR '3 ' OR '6 ' OR             
                                            '8 ' OR '10' OR '15'                
                       PERFORM 2200-RETRIEVE-RSL THRU 2200-EXIT                 
                    END-IF                                                      
               WHEN 10                                                          
               WHEN 23                                                          
                    DISPLAY 'REF NOT FOUND IN AB03K030: '                       
                    K030-NUM-HDB-REF                                            
               WHEN OTHER                                                       
                    DISPLAY 'AB03K030 READ ERROR ' WS-K030-STATUS               
                    DISPLAY 'K030 KEY: ' K030-NUM-HDB-REF                       
                    MOVE WS-K030-STATUS  TO RETURN-CODE                         
                                                                                
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
           DISPLAY '------- BP13CB0G -----------'.                              
           DISPLAY ' LETTER TYPE 1 (DP):  ' WS-RPT1-CNT.                        
           DISPLAY ' LETTER TYPE 2A (QN): ' WS-RPT2A-CNT.                       
           DISPLAY ' LETTER TYPE 2B (QN): ' WS-RPT2B-CNT.                       
           DISPLAY ' LETTER TYPE 3 (LN):  ' WS-RPT3-CNT.                        
           DISPLAY ' LETTER TYPE 4 (SN):  ' WS-RPT4-CNT.                        
           DISPLAY ' LETTER TYPE BLANK :  ' WS-RPTB-CNT.                        
           DISPLAY ' '.                                                         
                                                                                
           CLOSE BP13FB50                                                       
                 BB24F590                                                       
                 BP13KB20                                                       
                 BP13KD15                                                       
                 P04K010                                                        
                 BB24K510                                                       
                 BB24K500                                                       
                 AB03K080                                                       
                 AB03K030                                                       
                 BP18K300                                                       
                 BP18K440                                                       
                 REPORT1                                                        
                 REPORT2A                                                       
                 REPORT2B                                                       
                 REPORT3                                                        
                 REPORT4                                                        
                 REPORTB.                                                       
                                                                                
           IF WS-K010-STATUS NOT = 0                                            
              DISPLAY 'P04K010 CLOSE ERROR, STATUS: '                           
                      WS-K010-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-K510-STATUS NOT = 0                                            
              DISPLAY 'BB24K510 CLOSE ERROR, STATUS: '                          
                      WS-K510-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-K500-STATUS NOT = 0                                            
              DISPLAY 'BB24K500 CLOSE ERROR, STATUS: '                          
                      WS-K500-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-KD15-STATUS NOT = 0                                            
              DISPLAY 'BP13KD15 CLOSE ERROR, STATUS: '                          
                      WS-KD15-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-KB20-STATUS NOT = 0                                            
              DISPLAY 'BP13KB20 CLOSE ERROR, STATUS: '                          
                      WS-KB20-STATUS                                            
                                                                                
           IF WS-K080-STATUS NOT = 0                                            
              DISPLAY 'AB03K080 CLOSE ERROR, STATUS: '                          
                      WS-K080-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-K030-STATUS NOT = 0                                            
              DISPLAY 'AB03K030 CLOSE ERROR, STATUS: '                          
                      WS-K030-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-K300-STATUS NOT = 0                                            
              DISPLAY 'BP18K300 CLOSE ERROR, STATUS: '                          
                      WS-K300-STATUS                                            
           END-IF.                                                              
                                                                                
           IF WS-K440-STATUS NOT = 0                                            
              DISPLAY 'BP18K440 CLOSE ERROR, STATUS: '                          
                      WS-K440-STATUS                                            
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
