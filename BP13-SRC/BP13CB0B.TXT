      **************************                                        00010000
       IDENTIFICATION DIVISION.                                         00020000
      **************************                                        00030000
       PROGRAM-ID.    BP13CB0B.                                         00040000
      *AUTHOR.        MARGE LAM KO.                                     00050000
      *DATE-WRITTEN.  15 SEP 2015.                                      00060000
                                                                        00070000
      * =========================================================== *   00080000
      * SYSTEM OF COMMITMENT (BP13)                                 *   00090000
      * =========================================================== *   00100000
      *   OBJECTIVE   : THIS PROGRAM CREATES SERS REPORT BASE FILES *   00110000
      *                 FROM BP13F136 AND BP13FD10 GL ACCT          *   00120000
      *                                                             *   00130000
      *   INPUT FILES :                                             *   00140000
      *   1.  BP13F136                                              *   00150000
      *   2.  BP13FD10                                              *   00160000
      *   3.  BP13K410 - USED TO GET KEY ISSUE DATE                 *   00170000
      *   4.  BP13K800 - USED TO GET SCHACCT                        *   00180000
      *   5.  BP13K893 - USED TO GET DATE CANCEL                    *   00190000
      *   6.  BP13K130 - USED TO GET RECOVERY                       *   00200000
      *                                                             *   00210000
      *   OUTPUT FILES: GL ACCT + REPORT TYPE + BP13F136            *   00220000
      *   1.  BP13RPT1                                              *   00230000
      *   2.  BP13RPT2                                              *   00240000
      *   3.  BP13RPT3                                              *   00250000
      *   4.  BP13RPT4                                              *   00260000
      *   5.  BP13RPT5                                              *   00270000
      *   6.  BP13RPT7                                              *   00280000
      *                                                             *   00290000
      * CHQ REQ     DATE     BY  DESCRIPTIONS                       *   00300000
      * -------- ---------- ---- ---------------------------------- *   00310000
      * BP135922 14/08/2015 MRN1 NEW PROGRAM, REPORTS 1, 3, 4       *   00320000
      * BP135980 19/10/2015 MRN1 REPORTS 2, 5, 7                    *   00330000
      * BP136171 22/03/2016 MRN1 CHANGE OF LOGIC FOR RPT 7          *   00340000
      * BP136127 05/04/2016 MRN1 USE LAST MONTH INSTEAD OF CURRDATE *   00350000
      *                          FOR COMPUTATION OF FINANCIAL YEAR  *   00360000
      * BP136148 06/05/2016 MRN1 REMOVE CHECKING OF FINCL YR FOR RPT4   00370000
      * BP136492 23/11/2016 MRN1 CHECK LIVE TABLE EVEN IF THERE IS RCVRY00380000
      * BP136586 10/01/2017 MRN1 CHECK LIVE TABLE FOR REPORT 3          00390000
      * BP137861 10/07/2019 PP11 RECOVER CASE NOT WRITTEN IN REPORT 4   00400000
      * BP138100 27/12/2019 PP11 RECOVER CASE NOT WRITTEN IN REPORT 4   00410000
      * BP138569 10/02/2021 PP11 RECOVER CASE WRITTEN IN REPORT2 WHEN   00420000
      *                          TRANS TYPE IS 35                       00430000
      * BP138783 08/07/2021 PP11 CATER TO REFLECT CASE 1557114D INTO    00440000
      *                          REPORT 4 AND 7                         00450000
      * BP138787 15/07/2021 PP11 CATER TO POPULATE THE CORRECT          00460000
      *                          MONTH END BALANCE                      00470000
      * BP138962 13/12/2021 PP11 CATER TO POPULATE THE CORRECT          00480000
      *                          RECOVERIES OF SERS GRANT 1ST TIME RCVRY00490000
      * BP138984 24/12/2021 PP11 CATER TO POPULATE THE CORRECT          00500000
      *                          DISBURSEMENTS OF SERS GRANT (REPORT1)  00510000
      * BP138962 30/12/2021 PP11 CATER TO POPULATE THE CORRECT GL VOUCH 00520000
      *                          NO IN REPORT1 AND REPORT2              00530000
      * BP139021 11/01/2022 PP11 CATER FOR REPORT1, 3 AND 4             00540000
      * BP139018 13/01/2022 PP11 CATER FOR REPORT1, 3 AND 4             00550000
      * BP139010 24/01/2022 PP11 CATER FOR REPORT1, 3 AND 4             00560000
      * BP139010 27/01/2022 PP11 CATER FOR REPORT 3                     00570000
      * BP139534 17/04/2023 PP11 CATER FOR REPORT 3 AND 4               00571000
      *                                                                 00580000
      * =========================================================== *   00590000
                                                                        00600000
       ENVIRONMENT DIVISION.                                            00610000
                                                                        00620000
       CONFIGURATION SECTION.                                           00630000
                                                                        00640000
       SOURCE-COMPUTER. IBM-3090.                                       00650000
       OBJECT-COMPUTER. IBM-3090.                                       00660000
                                                                        00670000
       INPUT-OUTPUT SECTION.                                            00680000
                                                                        00690000
       FILE-CONTROL.                                                    00700000
                                                                        00710000
           SELECT BP13K410 ASSIGN TO BP13K410                           00720000
                  ACCESS MODE     IS RANDOM                             00730000
                  ORGANIZATION    IS INDEXED                            00740000
                  RECORD KEY      IS K410-KEY-FLD                       00750000
                  FILE STATUS     IS WS-K410-STATUS.                    00760000
                                                                        00770000
           SELECT BP13K893 ASSIGN TO BP13K893                           00780000
                  ACCESS MODE     IS DYNAMIC                            00790000
                  ORGANIZATION    IS INDEXED                            00800000
                  RECORD KEY      IS K893-KEY-FLD                       00810000
                  FILE STATUS     IS WS-K893-STATUS.                    00820000
                                                                        00830000
           SELECT BP13K800 ASSIGN TO BP13K800                           00840000
                  ACCESS MODE     IS DYNAMIC                            00850000
                  ORGANIZATION    IS INDEXED                            00860000
                  RECORD KEY      IS K800-NUM-REGN                      00870000
                  FILE STATUS     IS WS-K800-STATUS.                    00880000
                                                                        00890000
           SELECT BP13K130 ASSIGN TO BP13K130                           00900000
                  ACCESS MODE     IS DYNAMIC                            00910000
                  ORGANIZATION    IS INDEXED                            00920000
                  RECORD KEY      IS K130-KEY-FLD                       00930000
                  FILE STATUS     IS WS-K130-STATUS.                    00940000
                                                                        00950000
           SELECT BP13F136   ASSIGN       TO BP13F136.                  00960000
                                                                        00970000
           SELECT BP13FD10   ASSIGN       TO BP13FD10.                  00980000
                                                                        00990000
           SELECT BP13RPT1   ASSIGN       TO BP13RPT1.                  01000000
                                                                        01010000
           SELECT BP13RPT2   ASSIGN       TO BP13RPT2.                  01020000
                                                                        01030000
           SELECT BP13RPT3   ASSIGN       TO BP13RPT3.                  01040000
                                                                        01050000
           SELECT BP13RPT4   ASSIGN       TO BP13RPT4.                  01060000
                                                                        01070000
           SELECT BP13RPT5   ASSIGN       TO BP13RPT5.                  01080000
                                                                        01090000
           SELECT BP13RPT7   ASSIGN       TO BP13RPT7.                  01100000
                                                                        01110000
       DATA DIVISION.                                                   01120000
                                                                        01130000
       FILE SECTION.                                                    01140000
                                                                        01150000
       FD   BP13K410                                                    01160000
            RECORD CONTAINS 2000 CHARACTERS.                            01170000
       COPY BP13K410.                                                   01180000
                                                                        01190000
       FD   BP13K800                                                    01200000
            RECORD CONTAINS 2000 CHARACTERS.                            01210000
       COPY BP13K800.                                                   01220000
                                                                        01230000
       FD   BP13K893                                                    01240000
            RECORD CONTAINS 2050 CHARACTERS.                            01250000
       COPY BP13K893.                                                   01260000
                                                                        01270000
       FD   BP13K130                                                    01280000
            RECORD    CONTAINS 150 CHARACTERS.                          01290000
       COPY BP13K130.                                                   01300000
                                                                        01310000
       FD   BP13F136                                                    01320000
            BLOCK CONTAINS 0 RECORDS                                    01330000
            RECORD CONTAINS 150 CHARACTERS                              01340000
            LABEL RECORDS ARE STANDARD                                  01350000
            RECORDING MODE IS F.                                        01360000
       COPY BP13F136.                                                   01370000
                                                                        01380000
       FD   BP13FD10                                                    01390000
            BLOCK CONTAINS 0 RECORDS                                    01400000
            RECORD CONTAINS 1400 CHARACTERS                             01410000
            LABEL RECORDS ARE STANDARD                                  01420000
            RECORDING MODE IS F.                                        01430000
       COPY BP13FD10.                                                   01440000
                                                                        01450000
       FD   BP13RPT1                                                    01460000
            BLOCK CONTAINS 0 RECORDS                                    01470000
            RECORD CONTAINS 200 CHARACTERS                              01480000
            LABEL RECORDS ARE STANDARD                                  01490000
            RECORDING MODE IS F.                                        01500000
       01  WS-BP13RPT1-REC          PIC X(200).                         01510000
                                                                        01520000
       FD   BP13RPT2                                                    01530000
            BLOCK CONTAINS 0 RECORDS                                    01540000
            RECORD CONTAINS 200 CHARACTERS                              01550000
            LABEL RECORDS ARE STANDARD                                  01560000
            RECORDING MODE IS F.                                        01570000
       01  WS-BP13RPT2-REC          PIC X(200).                         01580000
                                                                        01590000
       FD   BP13RPT3                                                    01600000
            BLOCK CONTAINS 0 RECORDS                                    01610000
            RECORD CONTAINS 200 CHARACTERS                              01620000
            LABEL RECORDS ARE STANDARD                                  01630000
            RECORDING MODE IS F.                                        01640000
       01  WS-BP13RPT3-REC          PIC X(200).                         01650000
                                                                        01660000
       FD   BP13RPT4                                                    01670000
            BLOCK CONTAINS 0 RECORDS                                    01680000
            RECORD CONTAINS 200 CHARACTERS                              01690000
            LABEL RECORDS ARE STANDARD                                  01700000
            RECORDING MODE IS F.                                        01710000
       01  WS-BP13RPT4-REC          PIC X(200).                         01720000
                                                                        01730000
       FD   BP13RPT5                                                    01740000
            BLOCK CONTAINS 0 RECORDS                                    01750000
            RECORD CONTAINS 200 CHARACTERS                              01760000
            LABEL RECORDS ARE STANDARD                                  01770000
            RECORDING MODE IS F.                                        01780000
       01  WS-BP13RPT5-REC          PIC X(200).                         01790000
                                                                        01800000
       FD   BP13RPT7                                                    01810000
            BLOCK CONTAINS 0 RECORDS                                    01820000
            RECORD CONTAINS 200 CHARACTERS                              01830000
            LABEL RECORDS ARE STANDARD                                  01840000
            RECORDING MODE IS F.                                        01850000
       01  WS-BP13RPT7-REC          PIC X(200).                         01860000
                                                                        01870000
      ************************                                          01880000
       WORKING-STORAGE SECTION.                                         01890000
      ************************                                          01900000
                                                                        01910000
       01  CNT-F136-READ            PIC 9(05) VALUE ZEROES.             01920000
       01  CNT-FD10-READ            PIC 9(05) VALUE ZEROES.             01930000
       01  WS-K130-FOUND            PIC X(1)  VALUE 'N'.                01940000
       01  WS-REP1-FLAG             PIC X(1)  VALUE 'N'.                01950000
       01  WS-RPT1-CNT              PIC 9(05) VALUE ZEROES.             01960000
       01  WS-RPT2-CNT              PIC 9(05) VALUE ZEROES.             01970000
       01  WS-RPT3-CNT              PIC 9(05) VALUE ZEROES.             01980000
       01  WS-RPT4-CNT              PIC 9(05) VALUE ZEROES.             01990000
       01  WS-RPT5-CNT              PIC 9(05) VALUE ZEROES.             02000000
       01  WS-RPT7-CNT              PIC 9(05) VALUE ZEROES.             02010000
       01  WS-K893-STATUS           PIC 9(02) VALUE ZEROES.             02020000
       01  WS-K800-STATUS           PIC 9(02) VALUE ZEROES.             02030000
       01  WS-K410-STATUS           PIC 9(02) VALUE ZEROES.             02040000
       01  WS-K130-STATUS           PIC 9(02) VALUE ZEROES.             02050000
       01  WS-CTR                   PIC 9(02) VALUE ZEROES.             02060000
       01  WS-K893-EOF              PIC X(01) VALUE 'N'.                02070000
       01  WS-EOF-K130              PIC X(1)  VALUE 'N'.                02080000
       01  WS-F136-EOF              PIC X(01) VALUE 'N'.                02090000
       01  WS-FD10-EOF              PIC X(01) VALUE 'N'.                02100000
       01  WS-RCVRY                 PIC X(01) VALUE 'N'.                02110000
       01  WS-LIVE                  PIC X(01) VALUE 'N'.                02120000
       01  WS-PREV-RCVRY            PIC X(01) VALUE 'N'.                02130000
       01  WS-PREV-REPT2-RECVRY     PIC X(01) VALUE 'N'.                02140000
       01  WS-REPT2-RECVRY          PIC X(01) VALUE 'N'.                02150000
       01  WS-PREV-LIVE             PIC X(01) VALUE 'N'.                02160000
       01  WS-FINCL-YEAR            PIC X(01) VALUE 'N'.                02170000
       01  WS-LAST-FLAG             PIC X(01) VALUE 'N'.                02180000
       01  WS-DTE-CANCEL            PIC X(08) VALUE SPACES.             02190000
       01  WS-DATE                  PIC X(08) VALUE SPACES.             02200000
       01  WS-NUM-REGN              PIC X(08).                          02210000
       01  WS-DTE-POST-RCVRY        PIC X(08) VALUE SPACES.             02220000
       01  WS-PREV-DTE-RCVRY        PIC X(08) VALUE SPACES.             02230000
       01  WS-NUM-RECPT-RCVRY       PIC X(14).                          02240000
       01  WS-RETURN-CODE           PIC 9(02) VALUE ZEROES.             02250000
       01  WS-AMT-RECOVERY          PIC S9(7)V9(2) VALUE ZEROES.        02260000
       01  WS-TOT-RECOVERY          PIC S9(7)V9(2) VALUE ZEROES.        02270000
       01  WS-TOT-AMT3              PIC S9(6)V99 VALUE ZEROES.          02280000
       01  WS-TOT-AMT5              PIC S9(6)V99 VALUE ZEROES.          02290000
       01  WS-PREV-TOT-AMT5         PIC S9(6)V99 VALUE ZEROES.          02300000
       01  WS-TOT-AMT7              PIC S9(6)V99 VALUE ZEROES.          02310000
       01  WS-TOT-BAL               PIC S9(6)V99 VALUE ZEROES.          02320000
       01  WS-MTH-END-BAL           PIC S9(6)V99 VALUE ZEROES.          02330000
       01  WS-LIVE-AMT              PIC S9(6)V99 VALUE ZEROES.          02340000
       01  WS-PREV-LIVE-AMT         PIC S9(6)V99 VALUE ZEROES.          02350000
       01  WS-NUM-RGSTRN            PIC X(8).                           02360000
       01  WS-NUM-GRANT-TYPE        PIC X(6).                           02370000
       01  WS-NUM-GL                PIC X(13).                          02380000
       01  WS-PREV-NUM-GL           PIC X(13).                          02390000
       01  WS-NUM-SCHACCT           PIC X(11).                          02400000
       01  WS-NUM-IDNTY-NO          PIC X(9).                           02410000
       01  WS-REPT2-RCVRY-REGN-NO   PIC X(08) VALUE SPACES.             02420000
       01  WS-REPT2-RCVRY-NRIC-NO   PIC X(09) VALUE SPACES.             02430000
                                                                        02440000
       01  WS-DTE-CCYYMMDD.                                             02450000
           05 WS-DTE-CCYY           PIC 9(04).                          02460000
           05 WS-DTE-MM             PIC 9(02).                          02470000
           05 WS-DTE-DD             PIC 9(02).                          02480000
       01  WS-TIME-HHMMSS.                                              02490000
           05 WS-TIME-HH            PIC X(02) VALUE SPACES.             02500000
           05 WS-TIME-MM            PIC X(02) VALUE SPACES.             02510000
           05 WS-TIME-SS            PIC X(02) VALUE SPACES.             02520000
           05 WS-TIME-MS            PIC X(02) VALUE SPACES.             02530000
                                                                        02540000
       01  WS-DTE-FINCL-CCYYMM      PIC X(06).                          02550000
       01  WS-YEAR                  PIC 9(04).                          02560000
       01  WS-YEAR-PREV             PIC 9(04).                          02570000
       01  WS-YEAR-NEXT             PIC 9(04).                          02580000
                                                                        02590000
       01  WS-LAST-MONTH.                                               02600000
           05 WS-LAST-CCYY          PIC 9(04).                          02610000
           05 WS-LAST-MM            PIC 9(02).                          02620000
                                                                        02630000
       01  WS-PREV-F136-REC.                                            02640000
           05 FILLER                PIC X(04) VALUE SPACES.             02650000
           05 WS-PREV-NUM-REGN      PIC X(08) VALUE SPACES.             02660000
           05 WS-PREV-DTE-POST      PIC X(08) VALUE SPACES.             02670000
           05 FILLER                PIC X(04) VALUE SPACES.             02680000
           05 WS-PREV-NUM-NRIC      PIC X(09) VALUE SPACES.             02690000
           05 FILLER                PIC X(65) VALUE SPACES.             02700000
           05 WS-PREV-PAYMENT-TYPE  PIC X(03) VALUE SPACES.             02710000
           05 WS-PREV-NUM-SCH       PIC X(11) VALUE SPACES.             02720000
           05 FILLER                PIC X(38) VALUE SPACES.             02730000
                                                                        02740000
       01  WS-BP13FD10-REC.                                             02750000
           05 FILLER                            PIC X(3).               02760000
           05 WS-FD10-NUM-REGN                  PIC X(8).               02770000
           05 FILLER                            PIC X(439).             02780000
           05 WS-FD10-EWPC-DETAIL OCCURS 16 TIMES.                      02790000
              10 WS-FD10-NUM-VOUCH-SYS          PIC X(2).               02800000
              10 WS-FD10-NUM-VOUCH-PAYMT        PIC X(3).               02810000
              10 WS-FD10-NUM-VOUCH-CR-DR        PIC X(1).               02820000
              10 WS-FD10-NUM-VOUCH-NRIC         PIC X(9).               02830000
              10 WS-FD10-NUM-VOUCH-GL           PIC X(13).              02840000
              10 WS-FD10-AMT-VOUCH              PIC S9(6)V99.           02850000
              10 WS-FD10-AMT-VOUCH-GST          PIC S9(5)V99.           02860000
              10 WS-FD10-NUM-GST-TYP            PIC X(1).               02870000
           05 FILLER                            PIC X(246).             02880000
                                                                        02890000
       01  WS-BP13REPT-REC.                                             02900000
           05  WS-REPT-GL-ACCT      PIC X(13).                          02910000
           05  FILLER               PIC X(01).                          02920000
           05  WS-REPT-TYPE         PIC X(02).                          02930000
           05  FILLER               PIC X(01).                          02940000
           05  WS-REPT-REGN-NO      PIC X(08).                          02950000
           05  WS-REPT-NRIC         PIC X(09).                          02960000
           05  WS-REPT-RECEIPT      PIC X(14).                          02970000
           05  WS-REPT-SCHACCT      PIC X(11).                          02980000
           05  WS-REPT-DTE-KEYISSUE PIC X(08).                          02990000
           05  WS-REPT-GRANT-AMT    PIC S9(7)V99.                       03000000
           05  WS-REPT-RCVRY-AMT    PIC S9(7)V99.                       03010000
           05  WS-REPT-DTE-POST     PIC X(08).                          03020000
           05  WS-REPT-MTH-BAL      PIC S9(8)V99.                       03030000
           05  WS-REPT-DTE-CANCEL   PIC X(08).                          03040000
           05  FILLER               PIC X(89).                          03050000
                                                                        03060000
       01  WS-SQLCODE             PIC ---9.                             03070000
       01  WS-SQL-STATUS.                                               03080000
           05 WS-SQL-OK                PIC S9(03) VALUE +000.           03090000
           05 WS-SQL-NFND              PIC S9(03) VALUE +100.           03100000
           05 WS-SQL-DUPREC            PIC S9(03) VALUE -803.           03110000
                                                                        03120000
      *--------------------------------------------------------------*  03130000
      *                          SQLCA                               *  03140000
      *--------------------------------------------------------------*  03150000
           EXEC SQL INCLUDE SQLCA          END-EXEC.                    03160000
           EXEC SQL INCLUDE P13VGAPN       END-EXEC.                    03170000
           EXEC SQL INCLUDE P13VGXAP       END-EXEC.                    03180000
           EXEC SQL INCLUDE P13VGRCV       END-EXEC.                    03190000
                                                                        03200000
      ********************                                              03210000
       PROCEDURE DIVISION.                                              03220000
      ********************                                              03230000
                                                                        03240000
      *----------*                                                      03250000
       0000-MAIN.                                                       03260000
      *----------*                                                      03270000
                                                                        03280000
           PERFORM 1000-OPEN-FILES   THRU 1000-EXIT.                    03290000
           PERFORM 2000-READ-F136    THRU 2000-EXIT.                    03300000
           PERFORM 3000-PROCESS-REC  THRU 3000-EXIT                     03310000
                   UNTIL WS-F136-EOF = 'Y'.                             03320000
           PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT.                    03330000
                                                                        03340000
       0000-EXIT.                                                       03350000
           EXIT.                                                        03360000
                                                                        03370000
      *----------------*                                                03380000
       1000-OPEN-FILES.                                                 03390000
      *----------------*                                                03400000
                                                                        03410000
           OPEN INPUT  BP13F136                                         03420000
                       BP13FD10                                         03430000
                       BP13K410                                         03440000
                       BP13K800                                         03450000
                       BP13K893                                         03460000
                       BP13K130                                         03470000
                OUTPUT BP13RPT1                                         03480000
                       BP13RPT2                                         03490000
                       BP13RPT3                                         03500000
                       BP13RPT4                                         03510000
                       BP13RPT5                                         03520000
                       BP13RPT7.                                        03530000
                                                                        03540000
           IF WS-K893-STATUS NOT = 0 AND 97                             03550000
              DISPLAY 'ERROR OPENING - BP13K893 : ' WS-K893-STATUS      03560000
              MOVE WS-K893-STATUS TO RETURN-CODE                        03570000
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                   03580000
           END-IF.                                                      03590000
                                                                        03600000
           IF WS-K410-STATUS NOT = 00 AND 97                            03610000
              DISPLAY 'ERROR OPENING - BP13K410 : ' WS-K410-STATUS      03620000
              MOVE     WS-K410-STATUS    TO    RETURN-CODE              03630000
              PERFORM  9000-CLOSE-FILES  THRU  9000-EXIT                03640000
           END-IF.                                                      03650000
                                                                        03660000
           IF WS-K800-STATUS NOT = 00 AND 97                            03670000
              DISPLAY 'ERROR OPENING - BP13K800 : ' WS-K800-STATUS      03680000
              MOVE     WS-K800-STATUS    TO    RETURN-CODE              03690000
              PERFORM  9000-CLOSE-FILES  THRU  9000-EXIT                03700000
           END-IF.                                                      03710000
                                                                        03720000
           IF WS-K130-STATUS NOT = 00 AND 97                            03730000
              DISPLAY 'BP13K130 - ERROR OPENING : ' WS-K130-STATUS      03740000
              MOVE WS-K130-STATUS                   TO RETURN-CODE      03750000
              PERFORM  9000-CLOSE-FILES    THRU 9000-EXIT               03760000
           END-IF.                                                      03770000
                                                                        03780000
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                       03790000
                                                                        03800000
           ACCEPT WS-DTE-CCYYMMDD   FROM   DATE YYYYMMDD.               03810000
           ACCEPT WS-TIME-HHMMSS    FROM   TIME.                        03820000
                                                                        03830000
           IF WS-DTE-MM = 01                                            03840000
              MOVE 12 TO WS-LAST-MM                                     03850000
              COMPUTE WS-LAST-CCYY = WS-DTE-CCYY - 1                    03860000
           ELSE                                                         03870000
              COMPUTE WS-LAST-MM = WS-DTE-MM - 1                        03880000
              MOVE WS-DTE-CCYY TO WS-LAST-CCYY                          03890000
           END-IF.                                                      03900000
                                                                        03910000
           MOVE SPACES TO WS-BP13REPT-REC.                              03920000
                                                                        03930000
       1000-EXIT.                                                       03940000
           EXIT.                                                        03950000
                                                                        03960000
      *---------------*                                                 03970000
       2000-READ-F136.                                                  03980000
      *---------------*                                                 03990000
           INITIALIZE BP13F136-CASHTRAN.                                03991000
           MOVE SPACES TO BP13F136-CASHTRAN.                            04000000
           READ BP13F136 AT END                                         04010000
              PERFORM 2500-PROCESS-LAST-REC THRU 2500-EXIT              04020000
              MOVE HIGH-VALUES TO BP13F136-CASHTRAN                     04030000
              MOVE 'Y' TO WS-F136-EOF                                   04040000
              GO TO 2000-EXIT.                                          04050000
                                                                        04060000
           ADD 1 TO CNT-F136-READ.                                      04070000
                                                                        04080000
       2000-EXIT.                                                       04090000
           EXIT.                                                        04100000
                                                                        04110000
      *----------------------*                                          04120000
       2500-PROCESS-LAST-REC.                                           04130000
      *----------------------*                                          04140000
           MOVE 'Y'        TO  WS-LAST-FLAG.                            04150000
           PERFORM 3500-CHECK-RECOVERY    THRU 3500-EXIT                04160000
           PERFORM 3800-READ-RECOVERY-TBL THRU 3800-EXIT                04170000
           PERFORM 3900-READ-LIVE-PERSON-TBL THRU 3900-EXIT             04180000
           MOVE F136-NUM-REGN        TO WS-NUM-REGN                     04190000
           PERFORM 6000-GET-SCHACCT   THRU 6000-EXIT                    04200000
           PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                    04210000
           IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                     04220000
              MOVE K410-NUM-SCH-ACC   TO WS-NUM-SCHACCT                 04230000
           END-IF                                                       04240000
           IF (K410-DTE-KEY-ISSUE = SPACES OR                           04250000
                                    LOW-VALUES OR '00000000') OR        04260000
              ((K410-DTE-KEY-ISSUE(1:4) = WS-DTE-CCYY) AND              04270000
               (K410-DTE-KEY-ISSUE(5:2) = WS-DTE-MM))                   04280000
              IF WS-RCVRY = 'N'                                         04290000
                 PERFORM 6400-CREATE-REP4-REC THRU 6400-EXIT            04300000
              ELSE                                                      04310000
                 IF WS-RCVRY = 'Y' AND WS-LIVE = 'Y'                    04320000
                    MOVE WS-LIVE-AMT TO WS-TOT-BAL                      04330000
                    PERFORM 6400-CREATE-REP4-REC THRU 6400-EXIT         04340000
                 END-IF                                                 04350000
              END-IF                                                    04360000
           ELSE                                                         04370000
              IF WS-RCVRY = 'Y' AND WS-LIVE = 'N'                       04380000
                 CONTINUE                                               04390000
              ELSE                                                      04400000
                IF WS-RCVRY = 'Y' AND WS-LIVE = 'Y'                     04410000
                   MOVE WS-LIVE-AMT TO WS-TOT-AMT3                      04420000
                END-IF                                                  04430000
                PERFORM 6300-CREATE-REP3-REC THRU 6300-EXIT             04440000
              END-IF                                                    04450000
           END-IF                                                       04460000
           IF WS-RCVRY = 'Y'                                            04470000
              PERFORM 6500-CREATE-REP5-REC THRU 6500-EXIT               04480000
           END-IF                                                       04490000
           IF WS-RCVRY = 'N'                                            04500000
              PERFORM 6700-CREATE-REP7-REC THRU 6700-EXIT               04510000
           ELSE                                                         04520000
              IF WS-RCVRY = 'Y' AND WS-LIVE = 'Y'                       04530000
                 MOVE WS-LIVE-AMT TO WS-TOT-AMT7                        04540000
                 PERFORM 6700-CREATE-REP7-REC THRU 6700-EXIT            04550000
              END-IF                                                    04560000
           END-IF.                                                      04570000
                                                                        04580000
       2500-EXIT.                                                       04590000
           EXIT.                                                        04600000
                                                                        04610000
      *-----------------*                                               04620000
       3000-PROCESS-REC.                                                04630000
      *-----------------*                                               04640000
           MOVE 'N'     TO   WS-LAST-FLAG                               04650000
                             WS-REPT2-RECVRY.                           04660000
           PERFORM 3500-CHECK-RECOVERY    THRU 3500-EXIT.               04670000
           PERFORM 3800-READ-RECOVERY-TBL THRU 3800-EXIT.               04680000
           PERFORM 3900-READ-LIVE-PERSON-TBL THRU 3900-EXIT.            04690000
                                                                        04700000
           IF FD10-NUM-REGN = F136-NUM-REGN                             04710000
              MOVE BP13FD10-REC  TO WS-BP13FD10-REC.                    04720000
                                                                        04730000
           PERFORM 5000-READ-FD10     THRU 5000-EXIT                    04740000
                   UNTIL FD10-NUM-REGN > F136-NUM-REGN OR               04750000
                           WS-FD10-EOF = 'Y'.                           04760000
                                                                        04770000
           IF WS-FD10-NUM-REGN = F136-NUM-REGN                          04780000
              MOVE 'N'    TO WS-REP1-FLAG                               04790000
              PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 16      04800000
                 IF F136-NUM-NRIC = WS-FD10-NUM-VOUCH-NRIC(WS-CTR)      04810000
                    IF WS-FD10-NUM-VOUCH-CR-DR(WS-CTR) = 'D'            04820000
                       MOVE WS-FD10-NUM-VOUCH-GL(WS-CTR) TO WS-NUM-GL   04830000
                       MOVE F136-NUM-REGN TO WS-NUM-REGN                04840000
                       PERFORM 6000-GET-SCHACCT     THRU 6000-EXIT      04850000
                       IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES         04860000
                          PERFORM 5200-READ-BP13K410 THRU 5200-EXIT     04870000
                          MOVE K410-NUM-SCH-ACC      TO WS-NUM-SCHACCT  04880000
                       END-IF                                           04890000
                       PERFORM 6100-CREATE-REP1-REC THRU 6100-EXIT      04900000
                       MOVE 'Y' TO WS-REP1-FLAG                         04910000
                    END-IF                                              04920000
                 END-IF                                                 04930000
              END-PERFORM                                               04940000
              IF F136-CDE-TRANS-TYPE = '60' AND                         04950000
                 WS-REP1-FLAG = 'N'                                     04960000
                 PERFORM 3750-GET-SCHACCT-INFO THRU 3750-EXIT           04970000
                 PERFORM 6100-CREATE-REP1-REC THRU 6100-EXIT            04980000
              END-IF                                                    04990000
           ELSE                                                         05000000
              MOVE SPACES TO WS-NUM-GL                                  05010000
           END-IF.                                                      05020000
                                                                        05030000
           IF F136-NUM-REGN = WS-PREV-NUM-REGN OR                       05040000
              WS-PREV-NUM-REGN = SPACES                                 05050000
              MOVE F136-NUM-REGN         TO WS-NUM-REGN                 05060000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 05070000
              IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND           05080000
                 (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM)                 05090000
      * if case has disbursed and key issued on same month,have recovery05090100
                 IF ((WS-PREV-RCVRY = 'Y') AND                          05091000
                     (WS-PREV-NUM-NRIC NOT = F136-NUM-NRIC))            05092000
                      CONTINUE                                          05093000
                 ELSE                                                   05094000
                   COMPUTE WS-TOT-AMT3 = WS-TOT-AMT3 + F136-AMT-RECEIPT 05100000
                 END-IF                                                 05100100
              END-IF                                                    05110000
                                                                        05120000
              IF (WS-RCVRY = 'N') OR                                    05130000
                 (WS-RCVRY = 'Y' AND WS-LIVE = 'Y')                     05140000
                 COMPUTE WS-TOT-AMT7 = WS-TOT-AMT7 + F136-AMT-RECEIPT   05150000
              END-IF                                                    05160000
              ADD  WS-TOT-AMT5           TO WS-PREV-TOT-AMT5            05170000
              ADD  WS-LIVE-AMT           TO WS-PREV-LIVE-AMT            05180000
              MOVE ZEROES                TO WS-TOT-AMT5                 05190000
                                            WS-LIVE-AMT                 05200000
              IF (WS-RCVRY = 'Y' AND WS-LIVE = 'N')                     05210000
                  PERFORM 2000-READ-F136 THRU 2000-EXIT                 05220000
                  GO TO 3000-EXIT                                       05230000
              END-IF                                                    05240000
                                                                        05250000
              COMPUTE WS-TOT-BAL = WS-TOT-BAL + F136-AMT-RECEIPT        05260000
                                                                        05270000
           ELSE                                                         05280000
              MOVE WS-PREV-NUM-REGN       TO WS-NUM-REGN                05290000
              PERFORM 4250-GET-DTE-CANCEL THRU 4250-EXIT                05300000
              PERFORM 6000-GET-SCHACCT    THRU 6000-EXIT                05310000
              PERFORM 5200-READ-BP13K410  THRU 5200-EXIT                05320000
              IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                  05330000
                 MOVE K410-NUM-SCH-ACC      TO WS-NUM-SCHACCT           05340000
              END-IF                                                    05350000
                                                                        05350100
                                                                        05355000
              IF (K410-DTE-KEY-ISSUE = SPACES OR                        05360000
                                       LOW-VALUES OR '00000000') OR     05370000
                 ((K410-DTE-KEY-ISSUE(1:4) = WS-DTE-CCYY) AND           05380000
                  (K410-DTE-KEY-ISSUE(5:2) = WS-DTE-MM))                05390000
                 IF WS-PREV-RCVRY = 'N'                                 05400000
                    PERFORM 6400-CREATE-REP4-REC THRU 6400-EXIT         05410000
                 ELSE                                                   05420000
                    IF WS-PREV-RCVRY = 'Y' AND WS-PREV-LIVE = 'Y'       05430000
                       MOVE WS-PREV-LIVE-AMT TO WS-TOT-BAL              05440000
                       PERFORM 6400-CREATE-REP4-REC THRU 6400-EXIT      05450000
                    END-IF                                              05460000
                 END-IF                                                 05470000
              ELSE                                                      05480000
                IF WS-PREV-RCVRY = 'Y' AND WS-PREV-LIVE = 'N'           05490000
                   CONTINUE                                             05500000
                ELSE                                                    05510000
                   IF WS-PREV-RCVRY = 'Y' AND WS-PREV-LIVE = 'Y'        05520000
                      MOVE WS-PREV-LIVE-AMT TO WS-TOT-AMT3              05530000
                   END-IF                                               05540000
                   PERFORM 6300-CREATE-REP3-REC THRU 6300-EXIT          05550000
                END-IF                                                  05560000
              END-IF                                                    05570000
              IF WS-PREV-RCVRY = 'Y'                                    05580000
                 PERFORM 6500-CREATE-REP5-REC THRU 6500-EXIT            05590000
              END-IF                                                    05600000
              IF WS-PREV-RCVRY = 'N'                                    05610000
                 PERFORM 6700-CREATE-REP7-REC THRU 6700-EXIT            05620000
              ELSE                                                      05630000
                 IF WS-PREV-RCVRY = 'Y' AND WS-PREV-LIVE = 'Y'          05640000
                    MOVE WS-PREV-LIVE-AMT TO WS-TOT-AMT7                05650000
                    PERFORM 6700-CREATE-REP7-REC THRU 6700-EXIT         05660000
                 END-IF                                                 05670000
              END-IF                                                    05680000
              MOVE WS-TOT-AMT5           TO WS-PREV-TOT-AMT5            05690000
              MOVE WS-LIVE-AMT           TO WS-PREV-LIVE-AMT            05700000
              MOVE ZEROES                TO WS-TOT-AMT5                 05710000
                                            WS-LIVE-AMT                 05720000
                                            WS-TOT-AMT7                 05721000
              MOVE F136-NUM-REGN         TO WS-NUM-REGN                 05730000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 05740000
              IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND           05750000
                 (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM)                 05760000
                 MOVE F136-AMT-RECEIPT TO WS-TOT-AMT3                   05770000
              END-IF                                                    05780000
              MOVE F136-AMT-RECEIPT TO WS-TOT-BAL                       05790000
              IF (WS-RCVRY = 'N') OR                                    05800000
                 (WS-RCVRY = 'Y' AND WS-LIVE = 'Y')                     05810000
                 MOVE F136-AMT-RECEIPT TO WS-TOT-AMT7                   05820000
                                                                        05821000
              END-IF                                                    05830000
           END-IF.                                                      05840000
                                                                        05850000
           MOVE BP13F136-CASHTRAN TO WS-PREV-F136-REC.                  05860000
           MOVE WS-RCVRY          TO WS-PREV-RCVRY.                     05870000
           MOVE WS-LIVE           TO WS-PREV-LIVE.                      05880000
           MOVE WS-NUM-GL         TO WS-PREV-NUM-GL.                    05890000
           MOVE WS-DTE-POST-RCVRY TO WS-PREV-DTE-RCVRY.                 05900000
           MOVE WS-REPT2-RECVRY   TO WS-PREV-REPT2-RECVRY.              05910000
           PERFORM 2000-READ-F136 THRU 2000-EXIT.                       05920000
                                                                        05930000
       3000-EXIT.                                                       05940000
           EXIT.                                                        05950000
                                                                        05960000
      *-----------------------*                                         05970000
       3500-CHECK-RECOVERY.                                             05980000
      *-----------------------*                                         05990000
                                                                        06000000
           MOVE SPACES                TO BP13K130-CDHIST.               06010000
           INITIALIZE                    BP13K130-CDHIST.               06020000
           MOVE ZEROES                TO WS-AMT-RECOVERY.               06030000
           MOVE 'N'                   TO WS-EOF-K130                    06040000
                                         WS-RCVRY.                      06050000
                                                                        06060000
           MOVE F136-NUM-REGN         TO K130-NUM-ORIG-REGN.            06070000
                                                                        06080000
           START BP13K130 KEY = K130-NUM-ORIG-REGN.                     06090000
                                                                        06100000
           EVALUATE WS-K130-STATUS                                      06110000
               WHEN 00                                                  06120000
               WHEN 02                                                  06130000
                    PERFORM 3600-READNEXT-BP13K130 THRU 3600-EXIT       06140000
                    PERFORM 3700-PROCESS-BP13K130  THRU 3700-EXIT       06150000
                            UNTIL WS-EOF-K130 = 'Y'                     06160000
               WHEN 20                                                  06170000
               WHEN 23                                                  06180000
                    MOVE ZEROES                      TO WS-AMT-RECOVERY 06190000
               WHEN OTHER                                               06200000
                  DISPLAY 'START ERROR BP13K130 : ' WS-K130-STATUS      06210000
                          ' REGN : ' K130-NUM-ORIG-REGN                 06220000
                  PERFORM 9000-CLOSE-FILES         THRU 9000-EXIT       06230000
           END-EVALUATE.                                                06240000
                                                                        06250000
       3500-EXIT.                                                       06260000
           EXIT.                                                        06270000
                                                                        06280000
      ******************************************************************06290000
       3600-READNEXT-BP13K130.                                          06300000
      ******************************************************************06310000
                                                                        06320000
           READ BP13K130 NEXT RECORD                                    06330000
                         AT END MOVE 'Y' TO WS-EOF-K130.                06340000
                                                                        06350000
       3600-EXIT.                                                       06360000
           EXIT.                                                        06370000
                                                                        06380000
      ******************************************************************06390000
       3700-PROCESS-BP13K130.                                           06400000
      ******************************************************************06410000
           MOVE 'N'  TO  WS-REP1-FLAG.                                  06420000
           IF (F136-NUM-REGN     = K130-NUM-ORIG-REGN)                  06430000
              IF (F136-NUM-NRIC  = K130-NUM-NRIC OR                     06440000
                  K130-NUM-NRIC  = SPACES OR LOW-VALUES) AND            06450000
                 (F136-CDE-PAYMENT-TYPE = K130-PAYMENT-TYPE)            06460000
                 IF K130-TRANS-TYPE = '11' OR '35'                      06470000
                    MOVE 'Y'                     TO WS-RCVRY            06480000
                    ADD K130-AMT-CASH            TO WS-AMT-RECOVERY     06490000
                    MOVE K130-DTE-POST           TO WS-DTE-POST-RCVRY   06500000
                    MOVE K130-NUM-RECPT-JRNO     TO WS-NUM-RECPT-RCVRY  06510000
                                                                        06511000
                    IF WS-RCVRY = 'Y' AND                               06520000
                       WS-LAST-FLAG = 'N'                               06530000
                       PERFORM 3750-GET-SCHACCT-INFO THRU 3750-EXIT     06540000
                       PERFORM 6200-CREATE-REP2-REC THRU 6200-EXIT      06550000
                    END-IF                                              06560000
                 END-IF                                                 06570000
                                                                        06580000
      *-- IF DISBURSED RECORD RECOVERED ON THE SAME MONTH AND DISBURSED 06590000
      *-- AGAIN BUT THE PREVIOUS DISBURSED RECORD NOT POPULATED ON THE  06600000
      *---REPORT THE BELOW CHANGES DONE.                                06610000
                                                                        06620000
                 IF K130-TRANS-TYPE = '60' AND                          06630000
                    K130-DTE-POST NOT = F136-DTE-POST AND               06640000
                    WS-LAST-FLAG = 'N'                                  06650000
                    MOVE 'Y'   TO WS-REP1-FLAG                          06660000
                    PERFORM 3750-GET-SCHACCT-INFO THRU 3750-EXIT        06670000
                    PERFORM 6100-CREATE-REP1-REC THRU 6100-EXIT         06680000
                 END-IF                                                 06690000
              END-IF                                                    06700000
              PERFORM 3600-READNEXT-BP13K130        THRU 3600-EXIT      06710000
           ELSE                                                         06720000
               MOVE 'Y'                             TO WS-EOF-K130      06730000
           END-IF.                                                      06740000
                                                                        06750000
       3700-EXIT.                                                       06760000
           EXIT.                                                        06770000
                                                                        06780000
      *-----------------------*                                         06790000
       3750-GET-SCHACCT-INFO.                                           06800000
      *-----------------------*                                         06810000
           MOVE F136-NUM-REGN TO WS-NUM-REGN.                           06820000
                                                                        06830000
           PERFORM 6000-GET-SCHACCT     THRU 6000-EXIT.                 06840000
                                                                        06850000
           IF WS-NUM-SCHACCT = SPACES OR LOW-VALUES                     06860000
              PERFORM 5200-READ-BP13K410 THRU 5200-EXIT                 06870000
              MOVE K410-NUM-SCH-ACC      TO WS-NUM-SCHACCT              06880000
           END-IF.                                                      06890000
                                                                        06900000
       3750-EXIT.                                                       06910000
           EXIT.                                                        06920000
                                                                        06930000
      *-----------------------*                                         06940000
       3800-READ-RECOVERY-TBL.                                          06950000
      *-----------------------*                                         06960000
           MOVE F136-NUM-REGN            TO WS-NUM-RGSTRN.              06970000
           MOVE F136-CDE-PAYMENT-TYPE    TO WS-NUM-GRANT-TYPE.          06980000
           MOVE F136-NUM-NRIC            TO WS-NUM-IDNTY-NO.            06990000
                                                                        07000000
           EXEC SQL                                                     07010000
              SELECT DISTINCT                                           07020000
                     T2.NUM_IDNTY_NO,                                   07030000
                     T1.AMT_GRANT                                       07040000
              INTO   :DCLGRANT-RCVRY.NUM-IDNTY-NO,                      07050000
                     :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT                07060000
              FROM                                                      07070000
                EX_GRANT_ASMNT_PERSON T1,                               07080000
                GRANT_RCVRY T2                                          07090000
              WHERE                                                     07100000
                T1.NUM_RGSTRN        = :WS-NUM-RGSTRN       AND         07110000
                T1.NUM_GRANT_TYPE    = :WS-NUM-GRANT-TYPE   AND         07120000
                T1.NUM_IDNTY_NO      = :WS-NUM-IDNTY-NO     AND         07130000
                T1.NUM_RGSTRN        = T2.NUM_RGSTRN        AND         07140000
                T1.NUM_GRANT_TYPE    = T2.NUM_GRANT_TYPE    AND         07150000
                T1.NUM_IDNTY_NO      = T2.NUM_IDNTY_NO      AND         07160000
                T1.NUM_IDNTY_NO_TYPE = T2.NUM_IDNTY_NO_TYPE AND         07170000
                T1.TME_CREATE        = T2.TME_CREATE        AND         07180000
                T2.DTE_RCV_RCVR_GRANT NOT IN ('0001-01-01')             07190000
           END-EXEC.                                                    07200000
                                                                        07210000
           EVALUATE SQLCODE                                             07220000
           WHEN WS-SQL-OK                                               07230000
                IF NUM-IDNTY-NO OF DCLGRANT-RCVRY NOT = SPACES AND      07240000
                                                        LOW-VALUES      07250000
                   MOVE 'Y' TO WS-RCVRY                                 07260000
                   ADD AMT-GRANT OF DCLEX-GRANT-ASMNT-PERSON TO         07270000
                                                       WS-TOT-AMT5      07280000
                END-IF                                                  07290000
           WHEN WS-SQL-NFND                                             07300000
                MOVE SQLCODE   TO WS-SQLCODE                            07310000
                DISPLAY 'CASE NOTFND IN GRANT_RCVRY'                    07320000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07330000
                DISPLAY 'REGNO : ' NUM-RGSTRN OF DCLGRANT-RCVRY         07340000
                DISPLAY 'GRNT TYPE : ' NUM-GRANT-TYPE OF DCLGRANT-RCVRY 07350000
                DISPLAY SPACES                                          07360000
           WHEN OTHER                                                   07370000
                MOVE SQLCODE   TO WS-SQLCODE                            07380000
                DISPLAY 'ERROR READING GRANT_RCVRY'                     07390000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07400000
                DISPLAY SPACES                                          07410000
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              07420000
           END-EVALUATE.                                                07430000
                                                                        07440000
       3800-EXIT.                                                       07450000
           EXIT.                                                        07460000
                                                                        07470000
      *--------------------------*                                      07480000
       3900-READ-LIVE-PERSON-TBL.                                       07490000
      *--------------------------*                                      07500000
           MOVE F136-NUM-REGN            TO WS-NUM-RGSTRN.              07510000
           MOVE F136-CDE-PAYMENT-TYPE    TO WS-NUM-GRANT-TYPE.          07520000
           MOVE F136-NUM-NRIC            TO WS-NUM-IDNTY-NO.            07530000
           MOVE 'N'                      TO WS-LIVE.                    07540000
                                                                        07550000
           EXEC SQL                                                     07560000
              SELECT NUM_RGSTRN,                                        07570000
                     NUM_GRANT_TYPE,                                    07580000
                     NUM_IDNTY_NO,                                      07590000
                     AMT_GRANT                                          07600000
              INTO   :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN,                 07610000
                     :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE,             07620000
                     :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO,               07630000
                     :DCLGRANT-ASMNT-PERSON.AMT-GRANT                   07640000
              FROM                                                      07650000
                GRANT_ASMNT_PERSON                                      07660000
              WHERE                                                     07670000
                NUM_RGSTRN        = :WS-NUM-RGSTRN       AND            07680000
                NUM_GRANT_TYPE    = :WS-NUM-GRANT-TYPE   AND            07690000
                NUM_IDNTY_NO      = :WS-NUM-IDNTY-NO                    07700000
           END-EXEC.                                                    07710000
                                                                        07720000
           EVALUATE SQLCODE                                             07730000
           WHEN WS-SQL-OK                                               07740000
                MOVE 'Y' TO WS-LIVE                                     07750000
                ADD AMT-GRANT OF DCLGRANT-ASMNT-PERSON TO WS-LIVE-AMT   07760000
           WHEN WS-SQL-NFND                                             07770000
                MOVE SQLCODE   TO WS-SQLCODE                            07780000
                DISPLAY 'CASE NOTFND IN GRANT_ASMNT_PERSON'             07790000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07800000
                DISPLAY 'REGNO : ' NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON  07810000
                DISPLAY 'GRNT TYPE : '                                  07820000
                               NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON  07830000
                DISPLAY 'IDNTY NO : '                                   07840000
                               NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON    07850000
                DISPLAY SPACES                                          07860000
           WHEN OTHER                                                   07870000
                MOVE SQLCODE   TO WS-SQLCODE                            07880000
                DISPLAY 'ERROR READING GRANT_ASMNT_PERSON'              07890000
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07900000
                DISPLAY SPACES                                          07910000
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              07920000
           END-EVALUATE.                                                07930000
                                                                        07940000
       3900-EXIT.                                                       07950000
           EXIT.                                                        07960000
                                                                        07970000
      *===============================================================* 07980000
       4250-GET-DTE-CANCEL.                                             07990000
      *===============================================================* 08000000
                                                                        08010000
           MOVE SPACES                   TO BP13K893-MASTER.            08020000
           INITIALIZE                       BP13K893-MASTER.            08030000
                                                                        08040000
           MOVE WS-NUM-REGN               TO K893-NUM-REGN-HIST.        08050000
           MOVE 'N'                      TO WS-K893-EOF.                08060000
                                                                        08070000
           START BP13K893 KEY >= K893-KEY-FLD                           08080000
                                                                        08090000
           EVALUATE WS-K893-STATUS                                      08100000
               WHEN 00                                                  08110000
                    PERFORM 4260-READNEXT-BP13K893 THRU 4260-EXIT       08120000
                      UNTIL WS-PREV-NUM-REGN NOT = K893-NUM-REGN-HIST   08130000
                         OR WS-K893-EOF   = 'Y'                         08140000
               WHEN 10                                                  08150000
               WHEN 23                                                  08160000
                    CONTINUE                                            08170000
               WHEN OTHER                                               08180000
                    DISPLAY 'BP13K893 START ERROR ' WS-K893-STATUS      08190000
                    DISPLAY 'K893 KEY: ' K893-KEY-FLD                   08200000
                    MOVE WS-K893-STATUS     TO RETURN-CODE              08210000
                                                                        08220000
                    PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT           08230000
           END-EVALUATE.                                                08240000
                                                                        08250000
       4250-EXIT.                                                       08260000
            EXIT.                                                       08270000
                                                                        08280000
      *===============================================================* 08290000
       4260-READNEXT-BP13K893.                                          08300000
      *===============================================================* 08310000
                                                                        08320000
           READ BP13K893 NEXT RECORD                                    08330000
             AT END                                                     08340000
                MOVE 'Y'                 TO WS-K893-EOF                 08350000
           END-READ.                                                    08360000
                                                                        08370000
           EVALUATE WS-K893-STATUS                                      08380000
               WHEN 00                                                  08390000
               WHEN 02                                                  08400000
                    IF K893-NUM-REGN-HIST = WS-PREV-NUM-REGN            08410000
                       MOVE K893-DTE-CANCEL TO WS-DTE-CANCEL            08420000
                       MOVE 'Y'              TO WS-K893-EOF             08430000
                    ELSE                                                08440000
                       MOVE 'Y'              TO WS-K893-EOF             08450000
                    END-IF                                              08460000
                                                                        08470000
               WHEN 10                                                  08480000
               WHEN 23                                                  08490000
                    CONTINUE                                            08500000
                                                                        08510000
               WHEN OTHER                                               08520000
                    DISPLAY 'BP13K893 READ NEXT ERROR ' WS-K893-STATUS  08530000
                    DISPLAY 'K893 KEY: ' K893-KEY-FLD                   08540000
                    MOVE WS-K893-STATUS                TO RETURN-CODE   08550000
                                                                        08560000
                    PERFORM 9000-CLOSE-FILES         THRU 9000-EXIT     08570000
           END-EVALUATE.                                                08580000
                                                                        08590000
       4260-EXIT.                                                       08600000
            EXIT.                                                       08610000
                                                                        08620000
      *---------------*                                                 08630000
       5000-READ-FD10.                                                  08640000
      *---------------*                                                 08650000
                                                                        08660000
           READ BP13FD10 AT END                                         08670000
                MOVE HIGH-VALUES TO BP13FD10-REC                        08680000
                MOVE 'Y' TO WS-FD10-EOF                                 08690000
                GO TO 5000-EXIT.                                        08700000
                                                                        08710000
           ADD 1 TO CNT-FD10-READ.                                      08720000
                                                                        08730000
           IF FD10-NUM-REGN = F136-NUM-REGN                             08740000
              MOVE BP13FD10-REC  TO WS-BP13FD10-REC.                    08750000
                                                                        08760000
       5000-EXIT.                                                       08770000
           EXIT.                                                        08780000
                                                                        08790000
      ***************************************************************** 08800000
       5200-READ-BP13K410.                                              08810000
      ***************************************************************** 08820000
           MOVE SPACES                      TO BP13K410-REC.            08830000
           INITIALIZE                          BP13K410-REC.            08840000
           MOVE SPACES                      TO K410-NUM-REGN.           08850000
           MOVE WS-NUM-REGN                 TO K410-NUM-REGN.           08860000
                                                                        08870000
           READ BP13K410.                                               08880000
                                                                        08890000
           EVALUATE WS-K410-STATUS                                      08900000
               WHEN 00                                                  08910000
               WHEN 23                                                  08920000
                    CONTINUE                                            08930000
               WHEN OTHER                                               08940000
                    DISPLAY 'ERROR READING BP13K410 : ' WS-K410-STATUS  08950000
                            ' REGN = ' K410-NUM-REGN                    08960000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      08970000
           END-EVALUATE.                                                08980000
                                                                        08990000
       5200-EXIT.                                                       09000000
           EXIT.                                                        09010000
                                                                        09020000
      ***************************************************************** 09030000
       6000-GET-SCHACCT.                                                09040000
      ***************************************************************** 09050000
           MOVE SPACES                      TO BP13K800-MASTER.         09060000
           INITIALIZE                          BP13K800-MASTER.         09070000
           MOVE SPACES                      TO K800-NUM-REGN            09080000
                                               WS-NUM-SCHACCT.          09090000
           MOVE WS-NUM-REGN                 TO K800-NUM-REGN.           09100000
                                                                        09110000
           READ BP13K800.                                               09120000
                                                                        09130000
           EVALUATE WS-K800-STATUS                                      09140000
               WHEN 00                                                  09150000
                    MOVE K800-NUM-SCH-ACC   TO WS-NUM-SCHACCT           09160000
               WHEN 23                                                  09170000
                    MOVE SPACES             TO WS-NUM-SCHACCT           09180000
               WHEN OTHER                                               09190000
                    DISPLAY 'ERROR READING BP13K800 : ' WS-K800-STATUS  09200000
                            ' REGN = ' K800-NUM-REGN                    09210000
                    PERFORM  9000-CLOSE-FILES       THRU 9000-EXIT      09220000
           END-EVALUATE.                                                09230000
                                                                        09240000
       6000-EXIT.                                                       09250000
           EXIT.                                                        09260000
                                                                        09270000
      ***************************************************************** 09280000
       6100-CREATE-REP1-REC.                                            09290000
      ***************************************************************** 09300000
                                                                        09310000
           MOVE '1 '                        TO WS-REPT-TYPE.            09320000
           MOVE F136-NUM-REGN               TO WS-REPT-REGN-NO.         09330000
           MOVE F136-NUM-NRIC               TO WS-REPT-NRIC.            09340000
           MOVE F136-NUM-RECPT-JRNO         TO WS-REPT-RECEIPT.         09350000
           MOVE WS-NUM-SCHACCT              TO WS-REPT-SCHACCT.         09360000
           MOVE SPACES                      TO WS-REPT-DTE-KEYISSUE.    09370000
           IF WS-REP1-FLAG = 'Y'                                        09380000
             MOVE K130-AMT-CASH               TO WS-REPT-GRANT-AMT      09390000
             MOVE K130-DTE-POST               TO WS-REPT-DTE-POST       09400000
           ELSE                                                         09410000
             MOVE F136-AMT-RECEIPT            TO WS-REPT-GRANT-AMT      09420000
             MOVE F136-DTE-POST               TO WS-REPT-DTE-POST       09430000
           END-IF.                                                      09440000
           MOVE WS-NUM-GL                   TO WS-REPT-GL-ACCT.         09450000
                                                                        09460000
           IF (WS-REPT-DTE-POST(1:4) = WS-LAST-CCYY) AND                09470000
              (WS-REPT-DTE-POST(5:2) = WS-LAST-MM)                      09480000
              WRITE WS-BP13RPT1-REC FROM WS-BP13REPT-REC                09490000
              ADD 1 TO WS-RPT1-CNT                                      09500000
           END-IF.                                                      09510000
                                                                        09520000
           MOVE SPACES TO WS-BP13REPT-REC.                              09530000
                                                                        09540000
       6100-EXIT.                                                       09550000
            EXIT.                                                       09560000
                                                                        09570000
      ***************************************************************** 09580000
       6200-CREATE-REP2-REC.                                            09590000
      ***************************************************************** 09600000
                                                                        09610000
           MOVE '2 '                        TO WS-REPT-TYPE.            09620000
           MOVE F136-NUM-REGN               TO WS-REPT-REGN-NO.         09630000
           MOVE F136-NUM-NRIC               TO WS-REPT-NRIC.            09640000
           MOVE WS-NUM-RECPT-RCVRY          TO WS-REPT-RECEIPT.         09650000
           MOVE WS-NUM-SCHACCT              TO WS-REPT-SCHACCT.         09660000
           MOVE SPACES                      TO WS-REPT-DTE-KEYISSUE.    09670000
           MOVE F136-AMT-RECEIPT            TO WS-REPT-GRANT-AMT.       09680000
           MOVE WS-AMT-RECOVERY             TO WS-REPT-RCVRY-AMT.       09690000
           ADD  WS-AMT-RECOVERY             TO WS-TOT-RECOVERY.         09700000
           MOVE WS-DTE-POST-RCVRY           TO WS-REPT-DTE-POST.        09710000
           MOVE WS-NUM-GL                   TO WS-REPT-GL-ACCT.         09720000
                                                                        09730000
           IF (WS-DTE-POST-RCVRY(1:4) = WS-LAST-CCYY) AND               09740000
              (WS-DTE-POST-RCVRY(5:2) = WS-LAST-MM)                     09750000
              WRITE WS-BP13RPT2-REC FROM WS-BP13REPT-REC                09760000
              ADD 1 TO WS-RPT2-CNT                                      09770000
              MOVE F136-NUM-REGN            TO WS-REPT2-RCVRY-REGN-NO   09780000
              MOVE F136-NUM-NRIC            TO WS-REPT2-RCVRY-NRIC-NO   09790000
              MOVE 'Y'                      TO WS-REPT2-RECVRY          09800000
           END-IF.                                                      09810000
                                                                        09820000
           MOVE SPACES TO WS-BP13REPT-REC.                              09830000
                                                                        09840000
       6200-EXIT.                                                       09850000
            EXIT.                                                       09860000
                                                                        09870000
      ***************************************************************** 09880000
       6300-CREATE-REP3-REC.                                            09890000
      ***************************************************************** 09900000
                                                                        09910000
           MOVE '3 '                     TO WS-REPT-TYPE.               09920000
           MOVE WS-PREV-NUM-REGN         TO WS-REPT-REGN-NO.            09930000
           MOVE SPACES                   TO WS-REPT-NRIC.               09940000
           MOVE SPACES                   TO WS-REPT-RECEIPT.            09950000
           MOVE WS-NUM-SCHACCT           TO WS-REPT-SCHACCT.            09960000
           MOVE K410-DTE-KEY-ISSUE       TO WS-REPT-DTE-KEYISSUE.       09970000
           MOVE WS-TOT-AMT3              TO WS-REPT-GRANT-AMT.          09980000
           MOVE WS-PREV-DTE-POST         TO WS-REPT-DTE-POST.           09990000
           MOVE WS-PREV-NUM-GL           TO WS-REPT-GL-ACCT.            10000000
                                                                        10010000
           IF WS-PREV-NUM-GL NOT = SPACES AND LOW-VALUES                10020000
              IF (K410-DTE-KEY-ISSUE(1:4) = WS-LAST-CCYY) AND           10030000
                 (K410-DTE-KEY-ISSUE(5:2) = WS-LAST-MM)                 10040000
                IF WS-PREV-REPT2-RECVRY = 'Y' AND                       10050000
                   WS-REP1-FLAG = 'N'                                   10060000
                   CONTINUE                                             10070000
                ELSE                                                    10080000
                  WRITE WS-BP13RPT3-REC FROM WS-BP13REPT-REC            10090000
                  ADD 1 TO WS-RPT3-CNT                                  10100000
                END-IF                                                  10110000
              END-IF                                                    10120000
           END-IF.                                                      10130000
                                                                        10140000
           MOVE SPACES TO WS-BP13REPT-REC.                              10150000
                                                                        10160000
       6300-EXIT.                                                       10170000
            EXIT.                                                       10180000
                                                                        10190000
      ***************************************************************** 10200000
       6400-CREATE-REP4-REC.                                            10210000
      ***************************************************************** 10220000
                                                                        10230000
           MOVE '4 '                        TO WS-REPT-TYPE.            10240000
           MOVE WS-PREV-NUM-REGN            TO WS-REPT-REGN-NO.         10250000
           MOVE SPACES                      TO WS-REPT-NRIC.            10260000
           MOVE SPACES                      TO WS-REPT-RECEIPT.         10270000
           MOVE WS-NUM-SCHACCT              TO WS-REPT-SCHACCT.         10280000
           MOVE SPACES                      TO WS-REPT-DTE-KEYISSUE.    10290000
           MOVE WS-PREV-DTE-POST            TO WS-REPT-DTE-POST.        10300000
           MOVE WS-TOT-BAL                  TO WS-REPT-MTH-BAL.         10310000
           MOVE WS-PREV-NUM-GL              TO WS-REPT-GL-ACCT.         10320000
                                                                        10330000
           IF WS-PREV-NUM-GL NOT = SPACES AND LOW-VALUES                10340000
              IF WS-PREV-DTE-POST(1:6) NOT = WS-DTE-CCYYMMDD(1:6)       10350000
                IF WS-REPT2-RCVRY-REGN-NO = WS-PREV-NUM-REGN AND        10360000
                   WS-REPT2-RCVRY-NRIC-NO = WS-PREV-NUM-NRIC            10370000
                   IF WS-REP1-FLAG = 'Y'                                10380000
                      WRITE WS-BP13RPT4-REC FROM WS-BP13REPT-REC        10390000
                      ADD 1 TO WS-RPT4-CNT                              10400000
                   ELSE                                                 10410000
                     CONTINUE                                           10420000
                   END-IF                                               10430000
                ELSE                                                    10440000
                 WRITE WS-BP13RPT4-REC FROM WS-BP13REPT-REC             10450000
                 ADD 1 TO WS-RPT4-CNT                                   10460000
                END-IF                                                  10470000
              END-IF                                                    10480000
           END-IF.                                                      10490000
                                                                        10500000
           MOVE SPACES TO WS-BP13REPT-REC.                              10510000
                                                                        10520000
       6400-EXIT.                                                       10530000
            EXIT.                                                       10540000
                                                                        10550000
      ***************************************************************** 10560000
       6500-CREATE-REP5-REC.                                            10570000
      ***************************************************************** 10580000
      * WS-TOT-RECOVERY IS ALREADY NEGATIVE                             10590000
           COMPUTE WS-MTH-END-BAL = WS-PREV-TOT-AMT5 + WS-TOT-RECOVERY. 10600000
                                                                        10610000
           MOVE WS-PREV-DTE-RCVRY(1:6) TO WS-DTE-FINCL-CCYYMM.          10620000
           PERFORM 7000-CHECK-FINCL-YEAR THRU 7000-EXIT.                10630000
                                                                        10640000
           MOVE WS-PREV-NUM-GL         TO WS-REPT-GL-ACCT.              10650000
           MOVE '5 '                   TO WS-REPT-TYPE.                 10660000
           MOVE WS-PREV-NUM-REGN       TO WS-REPT-REGN-NO.              10670000
           MOVE SPACES                 TO WS-REPT-NRIC.                 10680000
           MOVE SPACES                 TO WS-REPT-RECEIPT.              10690000
           MOVE WS-NUM-SCHACCT         TO WS-REPT-SCHACCT.              10700000
           MOVE SPACES                 TO WS-REPT-DTE-KEYISSUE.         10710000
           MOVE WS-PREV-TOT-AMT5       TO WS-REPT-GRANT-AMT.            10720000
           MOVE WS-TOT-RECOVERY        TO WS-REPT-RCVRY-AMT.            10730000
           MOVE WS-PREV-DTE-RCVRY      TO WS-REPT-DTE-POST.             10740000
           MOVE WS-MTH-END-BAL         TO WS-REPT-MTH-BAL.              10750000
           MOVE WS-DTE-CANCEL          TO WS-REPT-DTE-CANCEL.           10760000
                                                                        10770000
           IF WS-FINCL-YEAR = 'Y'                                       10780000
              IF WS-PREV-NUM-GL NOT = SPACES AND LOW-VALUES             10790000
                 IF WS-PREV-DTE-RCVRY(1:6) NOT = WS-DTE-CCYYMMDD(1:6)   10800000
                    WRITE WS-BP13RPT5-REC FROM WS-BP13REPT-REC          10810000
                    ADD 1 TO WS-RPT5-CNT                                10820000
                 END-IF                                                 10830000
              END-IF                                                    10840000
           END-IF.                                                      10850000
                                                                        10860000
           MOVE SPACES TO WS-BP13REPT-REC.                              10870000
           MOVE ZEROES TO WS-TOT-RECOVERY                               10880000
                          WS-TOT-AMT5.                                  10890000
       6500-EXIT.                                                       10900000
            EXIT.                                                       10910000
                                                                        10920000
      ***************************************************************** 10930000
       6700-CREATE-REP7-REC.                                            10940000
      ***************************************************************** 10950000
                                                                        10960000
           MOVE WS-PREV-DTE-POST(1:6) TO WS-DTE-FINCL-CCYYMM.           10970000
           PERFORM 7000-CHECK-FINCL-YEAR THRU 7000-EXIT.                10980000
                                                                        10990000
           MOVE WS-PREV-NUM-GL         TO WS-REPT-GL-ACCT.              11000000
           MOVE '7 '                   TO WS-REPT-TYPE.                 11010000
           MOVE WS-PREV-NUM-REGN       TO WS-REPT-REGN-NO.              11020000
           MOVE SPACES                 TO WS-REPT-NRIC.                 11030000
           MOVE SPACES                 TO WS-REPT-RECEIPT.              11040000
           MOVE WS-NUM-SCHACCT         TO WS-REPT-SCHACCT.              11050000
           MOVE SPACES                 TO WS-REPT-DTE-KEYISSUE.         11060000
           MOVE WS-TOT-AMT7            TO WS-REPT-GRANT-AMT.            11070000
           MOVE WS-PREV-DTE-POST       TO WS-REPT-DTE-POST.             11080000
                                                                        11090000
           IF WS-FINCL-YEAR = 'Y'                                       11100000
              IF WS-PREV-NUM-GL NOT = SPACES AND LOW-VALUES             11110000
                 IF WS-PREV-DTE-POST(1:6) NOT = WS-DTE-CCYYMMDD(1:6)    11120000
                    WRITE WS-BP13RPT7-REC FROM WS-BP13REPT-REC          11130000
                    ADD 1 TO WS-RPT7-CNT                                11140000
                 END-IF                                                 11150000
              END-IF                                                    11160000
           END-IF.                                                      11170000
                                                                        11180000
           MOVE SPACES TO WS-BP13REPT-REC.                              11190000
                                                                        11200000
       6700-EXIT.                                                       11210000
            EXIT.                                                       11220000
                                                                        11230000
      ***************************************************************** 11240000
       7000-CHECK-FINCL-YEAR.                                           11250000
      ***************************************************************** 11260000
           MOVE 'N' TO WS-FINCL-YEAR.                                   11270000
           MOVE WS-LAST-CCYY TO WS-YEAR.                                11280000
           COMPUTE WS-YEAR-PREV = WS-YEAR - 1.                          11290000
           COMPUTE WS-YEAR-NEXT = WS-YEAR + 1.                          11300000
                                                                        11310000
           IF WS-LAST-MM = 01 OR 02 OR 03                               11320000
              IF ((WS-DTE-FINCL-CCYYMM(5:2) = '01' OR '02' OR '03') AND 11330000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR)) OR              11340000
                 ((WS-DTE-FINCL-CCYYMM(5:2) = '04' OR '05' OR '06' OR   11350000
                                             '07' OR '08' OR '09' OR    11360000
                                             '10' OR '11' OR '12') AND  11370000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR-PREV))            11380000
                 MOVE 'Y' TO WS-FINCL-YEAR                              11390000
              END-IF                                                    11400000
           END-IF.                                                      11410000
                                                                        11420000
           IF WS-LAST-MM = 04 OR 05 OR 06 OR 07 OR                      11430000
                          08 OR 09 OR 10 OR 11 OR 12                    11440000
              IF ((WS-DTE-FINCL-CCYYMM(5:2) = '01' OR '02' OR '03') AND 11450000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR-NEXT)) OR         11460000
                 ((WS-DTE-FINCL-CCYYMM(5:2) = '04' OR '05' OR '06' OR   11470000
                                             '07' OR '08' OR '09' OR    11480000
                                             '10' OR '11' OR '12') AND  11490000
                  (WS-DTE-FINCL-CCYYMM(1:4) = WS-YEAR))                 11500000
                 MOVE 'Y' TO WS-FINCL-YEAR                              11510000
              END-IF                                                    11520000
           END-IF.                                                      11530000
                                                                        11540000
       7000-EXIT.                                                       11550000
            EXIT.                                                       11560000
                                                                        11570000
      *-----------------*                                               11580000
       9000-CLOSE-FILES.                                                11590000
      *-----------------*                                               11600000
                                                                        11610000
           DISPLAY '******  BP13CB0B *************'.                    11620000
           DISPLAY 'NO OF RECS READ FROM  BP13F136  : ' CNT-F136-READ.  11630000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 1 : ' WS-RPT1-CNT.    11640000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 2 : ' WS-RPT2-CNT.    11650000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 3 : ' WS-RPT3-CNT.    11660000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 4 : ' WS-RPT4-CNT.    11670000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 5 : ' WS-RPT5-CNT.    11680000
           DISPLAY 'NO OF RECS WRITTEN FOR REPORT 7 : ' WS-RPT7-CNT.    11690000
                                                                        11700000
           CLOSE BP13F136                                               11710000
                 BP13FD10                                               11720000
                 BP13K410                                               11730000
                 BP13K800                                               11740000
                 BP13K893                                               11750000
                 BP13K130                                               11760000
                 BP13RPT1                                               11770000
                 BP13RPT2                                               11780000
                 BP13RPT3                                               11790000
                 BP13RPT4                                               11800000
                 BP13RPT5                                               11810000
                 BP13RPT7.                                              11820000
                                                                        11830000
           IF WS-K893-STATUS NOT = 0 AND 97                             11840000
              DISPLAY ' CLOSING ERROR, WS-K893-STATUS ' WS-K893-STATUS  11850000
              MOVE WS-K893-STATUS TO RETURN-CODE.                       11860000
                                                                        11870000
           IF WS-K800-STATUS NOT = 0 AND 97                             11880000
              DISPLAY ' CLOSING ERROR, WS-K800-STATUS ' WS-K800-STATUS  11890000
              MOVE WS-K800-STATUS TO RETURN-CODE.                       11900000
                                                                        11910000
           IF WS-K410-STATUS NOT = 0 AND 97                             11920000
              DISPLAY ' CLOSING ERROR, WS-K410-STATUS ' WS-K410-STATUS  11930000
              MOVE WS-K410-STATUS TO RETURN-CODE.                       11940000
                                                                        11950000
           STOP RUN.                                                    11960000
                                                                        11970000
       9000-EXIT.                                                       11980000
            EXIT.                                                       11990000
                                                                        12000000
      *---------------------------------------------------------------- 12010000
       9999-SQL-ERROR.                                                  12020000
      *---------------------------------------------------------------- 12030000
           CALL 'DBATIAR'  USING SQLCA.                                 12040000
           EXEC SQL ROLLBACK               END-EXEC.                    12050000
           MOVE 99                         TO    WS-RETURN-CODE.        12060000
           PERFORM 9000-CLOSE-FILES        THRU  9000-EXIT.             12070000
                                                                        12080000
       9999-EXIT.                                                       12090000
           EXIT.                                                        12100000
