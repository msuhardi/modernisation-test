       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CC55.                                                 
      *AUTHOR.        SAUL SIO.                                                 
      *DATE-WRITTEN.  04/09/2006.                                               
      * =========================================================== *           
      * SYSTEM OF COMMITMENT (BP13)                                 *           
      * =========================================================== *           
      * OBJECTIVE    :  PRINT INVITATION LETTERS TO APPLICANT       *           
      *                 WHO WERE SUCESSFULLY BALLOTED               *           
      *                                                             *           
      * INPUT FILES  :  1.  BP13F200                                *           
      *                 4.  BP13K740 - SOC APPLICATION MASTER       *           
      *                 5.  BP13K820 - SOC OCCUPIER FILE            *           
      *                 6.  BP13K830 - SOC CORR ADDRESS FILE        *           
      *                                                             *           
      * OUTPUT LISTS :  1.  P13PC55A - NON-GRO                      *           
      *                 2.  P13PC55B - NON-GRO (2X)                 *           
      *                 3.  P13PC55C - GRO                          *           
      *                                                             *           
      * ----------------------------------------------------------- *           
      * CHG REF  OIC  DATE     DESCRIPTION                          *           
      * -------- ---  -------- ------------------------------------ *           
      * BP132927 SSS  20060904 NEW PROGRAM                          *           
      * BP133157 SSS  20071219 TO CATER FOR D02                     *           
      * BP133425 DW5  20081211 TO CATER FOR D04                     *           
      * BP134400 ESA1 20111109 TO CATER FOR NEW ALIGNMENT           *           
      * =========================================================== *           
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13F200  ASSIGN       TO BP13F200.                           
                                                                                
           SELECT BP13K740  ASSIGN       TO BP13K740                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K740-KEY-FLD                        
                            ALTERNATE KEY IS K740-NUM-REGN                      
                            FILE STATUS  IS WS-K740-STATUS.                     
                                                                                
           SELECT BP13K820  ASSIGN       TO BP13K820                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K820-KEY-FLD                        
                            FILE STATUS  IS WS-K820-STATUS.                     
                                                                                
           SELECT BP13K830  ASSIGN       TO BP13K830                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K830-KEY-FLD                        
                            ALTERNATE RECORD KEY IS  K830-NUM-REGN              
                            FILE STATUS  IS WS-K830-STATUS.                     
                                                                                
           SELECT P13PC55A  ASSIGN       TO P13PC55A.                           
           SELECT P13PC55B  ASSIGN       TO P13PC55B.                           
           SELECT P13PC55C  ASSIGN       TO P13PC55C.                           
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F200                                                            
            RECORDING MODE  F                                                   
            LABEL RECORDS   ARE STANDARD                                        
            BLOCK CONTAINS  0   RECORDS                                         
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY BP13F200.                                                           
                                                                                
       FD   BP13K740                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K740.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   P13PC55A                                                            
            RECORD CONTAINS 90 CHARACTERS                                       
            RECORDING MODE  IS  F.                                              
       01   PC55A-PRTREC                PIC X(90).                              
                                                                                
       FD   P13PC55B                                                            
            RECORD CONTAINS 90 CHARACTERS                                       
            RECORDING MODE  IS  F.                                              
       01   PC55B-PRTREC                PIC X(90).                              
                                                                                
       FD   P13PC55C                                                            
            RECORD CONTAINS 90 CHARACTERS                                       
            RECORDING MODE  IS  F.                                              
       01   PC55C-PRTREC                PIC X(90).                              
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-INDICATORS.                                                       
           05  WS-K740-STATUS           PIC 99     VALUE 00.                    
           05  WS-K820-STATUS           PIC 99     VALUE 00.                    
           05  WS-K830-STATUS           PIC 99     VALUE 00.                    
           05  WS-EOF-F200              PIC X      VALUE 'N'.                   
                                                                                
       01  WS-COUNTERS-POINTERS.                                                
           05  WS-F200-READ             PIC 9(6)   VALUE ZEROS.                 
           05  WS-K740-READ             PIC 9(6)   VALUE ZEROS.                 
           05  WS-LETTER-PRINTED        PIC 9(6)   VALUE ZEROS.                 
                                                                                
       01  WS-DATE                      PIC X(8)   VALUE SPACES.                
       01  WS-NAME                      PIC X(66)  VALUE SPACES.                
                                                                                
       01  WS-APPMT-TIME.                                                       
           05  WS-APPMT-HR          PIC 9(2)   VALUE 00.                        
           05  WS-APPMT-MM          PIC 9(2)   VALUE 00.                        
                                                                                
       01  WS-ARRIV-TIME.                                                       
           05  WS-ARRIV-HR          PIC 9(2)   VALUE 00.                        
           05  WS-ARRIV-MM          PIC 9(2)   VALUE 00.                        
                                                                                
                                                                                
      *-------------------------------------------------------------            
      * FORMAT LETTER (COMMON FIELDS)                                           
      *-------------------------------------------------------------            
       01  PC55-LINE01.                                                         
           05  FILLER               PIC X(72) VALUE SPACES.                     
           05  PC55-OUR-REF         PIC X(8)  VALUE SPACES.                     
                                                                                
       01  PC55-LINE02.                                                         
           05  FILLER               PIC X(72) VALUE SPACES.                     
           05  PC55-DATE            PIC X(10) VALUE SPACES.                     
                                                                                
       01  PC55-LINE03.                                                         
           05  FILLER               PIC X(12) VALUE SPACES.                     
           05  PC55-NAME1           PIC X(66) VALUE SPACES.                     
                                                                                
       01  PC55-LINE03B.                                                        
           05  FILLER               PIC X(12) VALUE SPACES.                     
           05  PC55-NAME2           PIC X(66) VALUE SPACES.                     
                                                                                
      *01  PC55-LINE03C.                                                        
      *    05  FILLER               PIC X(12) VALUE SPACES.                     
      *    05  PC55-NAME3           PIC X(66) VALUE SPACES.                     
      *                                                                         
      *01  PC55-LINE03D.                                                        
      *    05  FILLER               PIC X(12) VALUE SPACES.                     
      *    05  PC55-NAME4           PIC X(66) VALUE SPACES.                     
                                                                                
       01  PC55-LINE04.                                                         
           05  FILLER               PIC X(12) VALUE SPACES.                     
           05  PC55-BLK             PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(01) VALUE SPACES.                     
           05  PC55-UNIT            PIC X(11) VALUE SPACES.                     
                                                                                
       01  PC55-LINE04B.                                                        
           05  FILLER               PIC X(12) VALUE SPACES.                     
           05  PC55-ADDR-L2         PIC X(47) VALUE SPACES.                     
                                                                                
       01  PC55-LINE04C.                                                        
           05  FILLER               PIC X(12) VALUE SPACES.                     
           05  PC55-ADDR-L3         PIC X(20) VALUE SPACES.                     
                                                                                
       01  PC55-LINE05.                                                         
           05  FILLER               PIC X(10) VALUE SPACES.                     
           05  PC55-BAR-CODE        PIC X(09) VALUE SPACES.                     
                                                                                
       01  PC55-LINE06.                                                         
           05  FILLER               PIC X(77) VALUE SPACES.                     
           05  PC55-TME-COME-HH     PIC Z9    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE ':'.                        
           05  PC55-TME-COME-MM     PIC 99    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE SPACES.                     
           05  PC55-TME-COME-AMPM   PIC X(2)  VALUE SPACES.                     
                                                                                
      *-------------------------------------------------------------            
      * FOR BP13DA (NON-GRO & 100%)                                             
      *-------------------------------------------------------------            
       01  PC55A-LINE01.                                                        
           05  FILLER               PIC X(52) VALUE SPACES.                     
           05  PC55-ALLO-SCH        PIC X(22) VALUE SPACES.                     
                                                                                
       01  PC55A-LINE02.                                                        
           05  FILLER               PIC X(64) VALUE SPACES.                     
           05  PC55-NUM-QUEUE       PIC X(6)  VALUE SPACES.                     
                                                                                
       01  PC55A-LINE03.                                                        
           05  FILLER               PIC X(10) VALUE SPACES.                     
           05  PC55-DTE-APPT        PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(3)  VALUE SPACES.                     
           05  PC55-TME-APPT-HH     PIC Z9    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE ':'.                        
           05  PC55-TME-APPT-MM     PIC 99    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE SPACES.                     
           05  PC55-TME-APPT-AMPM   PIC X(2)  VALUE SPACES.                     
                                                                                
      *-------------------------------------------------------------            
      * FOR BP13DB (NON-GRO & 101 - 200%)                                       
      *-------------------------------------------------------------            
       01  PC55B-LINE01.                                                        
           05  FILLER               PIC X(65) VALUE SPACES.                     
           05  PC55B-NUM-QUEUE      PIC X(6)  VALUE SPACES.                     
                                                                                
       01  PC55B-LINE02.                                                        
           05  FILLER               PIC X(58) VALUE SPACES.                     
           05  PC55B-DTE-APPT       PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(6)  VALUE SPACES.                     
           05  PC55B-TME-APPT-HH    PIC Z9    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE ':'.                        
           05  PC55B-TME-APPT-MM    PIC 99    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE SPACES.                     
           05  PC55B-TME-APPT-AMPM  PIC X(2)  VALUE SPACES.                     
                                                                                
      *-------------------------------------------------------------            
      * FOR BP13DD & BP13DE (GRO)                                               
      *-------------------------------------------------------------            
       01  PC55C-LINE01.                                                        
           05  FILLER               PIC X(83) VALUE SPACES.                     
           05  PC55C-NUM-QUEUE      PIC X(6)  VALUE SPACES.                     
                                                                                
       01  PC55C-LINE02.                                                        
           05  FILLER               PIC X(39) VALUE SPACES.                     
           05  PC55C-DTE-APPT       PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(8)  VALUE SPACES.                     
           05  PC55C-TME-APPT-HH    PIC Z9    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE ':'.                        
           05  PC55C-TME-APPT-MM    PIC 99    VALUE ZEROS.                      
           05  FILLER               PIC X     VALUE SPACES.                     
           05  PC55C-TME-APPT-AMPM  PIC X(2)  VALUE SPACES.                     
                                                                                
      *------------------------------------------------------------*            
      *  DJDE LINE FOR NON-GRO LETTER (100% SUCCESSFUL)            *            
      *------------------------------------------------------------*            
        01  DJDE-LINE-A                   PIC X(80)  VALUE                      
            '$DJDE$ JDE=13CC5A,FORMS=BP13DA,END;'.                              
                                                                                
        01  DJDE-PAGE2                     PIC X(80)  VALUE                     
            '$DJDE$ FORMS=BP13DZ,END;'.                                         
                                                                                
      *------------------------------------------------------------*            
      *  DJDE LINE FOR NON-GRO LETTER (101 - 200% SUCCESSFUL)      *            
      *------------------------------------------------------------*            
        01  DJDE-LINE-B                   PIC X(80)  VALUE                      
            '$DJDE$ JDE=13CC5B,FORMS=BP13DB,END;'.                              
                                                                                
      *------------------------------------------------------------*            
      *  DJDE LINE FOR GRO LETTER (100% SUCCESSFUL)                *            
      *------------------------------------------------------------*            
        01  DJDE-LINE-C                   PIC X(80)  VALUE                      
            '$DJDE$ JDE=13CC5C,FORMS=BP13DD,END;'.                              
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR AV02C015                                                   
      *-------------------------------------------------------------            
        01  WS-LINK-AV02C015.                                                   
            05  AV02C015-IN-POSTCODE          PIC X(6).                         
            05  AV02C015-OUT-POSTCODE-CHKSUM  PIC X(9).                         
                                                                                
       COPY AV02COMM.                                                           
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN-ROUTINE.                                                       
      *-------------------------------------------------------------            
            PERFORM 1000-OPEN-FILES-ROUTINE   THRU  1000-EXIT.                  
            PERFORM 2000-READ-BP13F200        THRU  2000-EXIT.                  
            PERFORM 3000-PROCESS-RECORD       THRU  3000-EXIT                   
                    UNTIL WS-EOF-F200 =  'Y'.                                   
            PERFORM 9000-CLOSE-ROUTINE        THRU  9000-EXIT.                  
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-FILES-ROUTINE.                                                 
      *-------------------------------------------------------------            
            OPEN INPUT  BP13F200                                                
                        BP13K740                                                
                        BP13K820                                                
                        BP13K830                                                
                 OUTPUT P13PC55A                                                
                        P13PC55B                                                
                        P13PC55C.                                               
                                                                                
           IF WS-K740-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR, WS-K740-STATUS ' WS-K740-STATUS           
              MOVE     WS-K740-STATUS   TO  RETURN-CODE                         
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.                       
                                                                                
           IF WS-K820-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR, WS-K820-STATUS ' WS-K820-STATUS           
              MOVE     WS-K820-STATUS TO RETURN-CODE                            
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.                       
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR, WS-K830-STATUS ' WS-K830-STATUS           
              MOVE     WS-K830-STATUS   TO RETURN-CODE                          
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.                       
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)    TO WS-DATE.                       
           STRING  WS-DATE(7:2) '/'                                             
                   WS-DATE(5:2) '/'                                             
                   WS-DATE(1:4)                                                 
                   DELIMITED BY SIZE INTO PC55-DATE                             
           END-STRING.                                                          
           MOVE '11/11/2011' TO PC55-DATE.                                      
                                                                                
           MOVE SPACES TO PC55A-PRTREC.                                         
           WRITE PC55A-PRTREC       AFTER PAGE.                                 
           MOVE SPACES TO PC55B-PRTREC.                                         
           WRITE PC55B-PRTREC       AFTER PAGE.                                 
           MOVE SPACES TO PC55C-PRTREC.                                         
           WRITE PC55C-PRTREC       AFTER PAGE.                                 
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13F200.                                                      
      *-------------------------------------------------------------            
           READ BP13F200                                                        
                AT END MOVE 'Y' TO WS-EOF-F200                                  
                GO TO  2000-EXIT.                                               
                                                                                
           ADD  1  TO   WS-F200-READ.                                           
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-PROCESS-RECORD.                                                     
      *-------------------------------------------------------------            
           MOVE SPACES TO  PC55-OUR-REF                                         
                           PC55-NAME1                                           
                           PC55-NAME2                                           
                           PC55-BLK                                             
                           PC55-UNIT                                            
                           PC55-ADDR-L2                                         
                           PC55-ADDR-L3                                         
                           PC55-BAR-CODE                                        
                           PC55-ALLO-SCH                                        
                           PC55-NUM-QUEUE                                       
                           PC55B-NUM-QUEUE                                      
                           PC55C-NUM-QUEUE                                      
                           PC55-DTE-APPT                                        
                           PC55-TME-APPT-AMPM                                   
                           PC55B-DTE-APPT                                       
                           PC55C-DTE-APPT                                       
                           PC55B-TME-APPT-AMPM                                  
                           PC55C-TME-APPT-AMPM                                  
                           PC55-TME-COME-AMPM.                                  
                                                                                
           MOVE ZEROS   TO PC55-TME-APPT-HH                                     
                           PC55-TME-APPT-MM                                     
                           PC55B-TME-APPT-HH                                    
                           PC55B-TME-APPT-MM                                    
                           PC55C-TME-APPT-HH                                    
                           PC55C-TME-APPT-MM                                    
                           PC55-TME-COME-HH                                     
                           PC55-TME-COME-MM                                     
                           WS-APPMT-TIME                                        
                           WS-ARRIV-TIME.                                       
                                                                                
           PERFORM 4000-READ-BP13K740    THRU 4000-EXIT.                        
           PERFORM 7000-PRINT-LETTER     THRU 7000-EXIT.                        
                                                                                
           PERFORM 2000-READ-BP13F200    THRU 2000-EXIT.                        
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
       4000-READ-BP13K740.                                                      
      *-------------------------------------------------------------            
           MOVE F200-NUM-REGN TO K740-NUM-REGN.                                 
           READ BP13K740 KEY IS K740-NUM-REGN.                                  
                                                                                
           READ BP13K740.                                                       
           EVALUATE WS-K740-STATUS                                              
           WHEN 00                                                              
                ADD  1  TO   WS-K740-READ                                       
                PERFORM 5000-GET-NAMES     THRU 5000-EXIT                       
                PERFORM 6000-GET-ADDRESS   THRU 6000-EXIT                       
           WHEN 23                                                              
                DISPLAY 'BP13K740 REC NOTFND, KEY ' K740-NUM-REGN               
           WHEN OTHER                                                           
                DISPLAY 'BP13K740 READ ERR, STATUS ' WS-K740-STATUS             
                MOVE WS-K740-STATUS           TO RETURN-CODE                    
                PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5000-GET-NAMES.                                                          
      *-------------------------------------------------------------            
            MOVE    K740-NUM-NRIC1          TO   K820-NUM-NRIC.                 
            PERFORM 5500-READ-BP13K820      THRU 5500-EXIT.                     
            MOVE    WS-NAME                 TO   PC55-NAME1.                    
                                                                                
            IF K740-NUM-NRIC2 NOT =  SPACES AND  LOW-VALUES                     
               MOVE     K740-NUM-NRIC2       TO  K820-NUM-NRIC                  
               PERFORM  5500-READ-BP13K820   THRU 5500-EXIT                     
               MOVE     WS-NAME              TO  PC55-NAME2                     
            ELSE                                                                
               MOVE     SPACES               TO  PC55-NAME2                     
            END-IF.                                                             
                                                                                
      *     IF K740-NUM-NRIC3 NOT =  SPACES AND  LOW-VALUES                     
      *        MOVE     K740-NUM-NRIC3       TO  K820-NUM-NRIC                  
      *        PERFORM  5500-READ-BP13K820   THRU 5500-EXIT                     
      *        MOVE     WS-NAME              TO  PC55-NAME3                     
      *     ELSE                                                                
      *        MOVE     SPACES               TO  PC55-NAME3                     
      *     END-IF.                                                             
      *                                                                         
      *     IF K740-NUM-NRIC4 NOT =  SPACES AND  LOW-VALUES                     
      *        MOVE     K740-NUM-NRIC4       TO  K820-NUM-NRIC                  
      *        PERFORM  5500-READ-BP13K820   THRU 5500-EXIT                     
      *        MOVE     WS-NAME              TO  PC55-NAME4                     
      *     ELSE                                                                
      *        MOVE     SPACES               TO  PC55-NAME4                     
      *     END-IF.                                                             
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5500-READ-BP13K820.                                                      
      *-------------------------------------------------------------            
            MOVE SPACES        TO WS-NAME.                                      
            MOVE K740-NUM-REGN TO K820-NUM-REGN.                                
            READ BP13K820.                                                      
                                                                                
            IF WS-K820-STATUS = 00                                              
               MOVE  K820-NME-OCCP           TO    WS-NAME                      
            ELSE                                                                
            IF WS-K820-STATUS = 23                                              
               DISPLAY 'RECORD NOTFND IN BP13K820 = ' WS-K820-STATUS            
                       ', KEY-FLD = ' K820-KEY-FLD                              
            ELSE                                                                
               DISPLAY 'ERROR READING BP13K820, STAT ' WS-K820-STATUS           
                       ', KEY-FLD = ' K820-KEY-FLD.                             
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
       6000-GET-ADDRESS.                                                        
      *-------------------------------------------------------------            
           MOVE F200-NUM-REGN     TO    K830-NUM-REGN.                          
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
                                                                                
           EVALUATE WS-K830-STATUS                                              
           WHEN 00                                                              
              IF (K830-NUM-MAIL-ADDR =  SPACES OR LOW-VALUES) OR                
                 ((K830-NUM-MAIL-LVL-CHAR =  '#') AND                           
                 (K830-NUM-MAIL-LVL-NUM =  SPACES OR LOW-VALUES))               
                 MOVE K830-NUM-BLK         TO PC55-BLK                          
                 MOVE K830-NUM-FLAT        TO PC55-UNIT                         
                 MOVE K830-NME-STREET-BLDG(1:47) TO PC55-ADDR-L2                
                 IF K830-NUM-POSTAL  = SPACES OR LOW-VALUES OR ZEROES           
                    MOVE SPACES            TO PC55-ADDR-L3                      
                 ELSE                                                           
                    STRING 'SINGAPORE '  K830-NUM-POSTAL                        
                       DELIMITED BY SIZE    INTO PC55-ADDR-L3                   
                                                                                
                    MOVE SPACES          TO WS-LINK-AV02C015                    
                    MOVE K830-NUM-POSTAL TO AV02C015-IN-POSTCODE                
                    PERFORM 6500-CALL-AV02C015     THRU 6500-EXIT               
                    MOVE AV02C015-OUT-POSTCODE-CHKSUM TO PC55-BAR-CODE          
                 END-IF                                                         
              ELSE                                                              
                 MOVE K830-NUM-MAIL-BLK        TO PC55-BLK                      
                 MOVE K830-NUM-MAIL-FLAT       TO PC55-UNIT                     
                 MOVE K830-NME-MAIL-STR-BLDG(1:47) TO PC55-ADDR-L2              
                 IF K830-NUM-MAIL-POSTAL = SPACES OR LOW-VALUES OR ZEROS        
                    MOVE SPACES                TO PC55-ADDR-L3                  
                 ELSE                                                           
                    STRING 'SINGAPORE '      K830-NUM-MAIL-POSTAL               
                           DELIMITED BY SIZE INTO PC55-ADDR-L3                  
                                                                                
                    MOVE SPACES          TO WS-LINK-AV02C015                    
                    MOVE K830-NUM-MAIL-POSTAL TO AV02C015-IN-POSTCODE           
                    PERFORM 6500-CALL-AV02C015     THRU 6500-EXIT               
                    MOVE AV02C015-OUT-POSTCODE-CHKSUM TO PC55-BAR-CODE          
                 END-IF                                                         
              END-IF                                                            
           WHEN 23                                                              
              MOVE SPACES TO PC55-BLK                                           
                             PC55-UNIT                                          
                             PC55-ADDR-L2                                       
                             PC55-ADDR-L3                                       
              DISPLAY 'BP13K830 RECORD NOT FOUND = ' WS-K830-STATUS             
                      ', KEY ' K830-KEY-FLD                                     
           WHEN OTHER                                                           
              DISPLAY 'ERROR READING BP13K830, STATUS ' WS-K830-STATUS          
                      ', KEY ' K830-KEY-FLD                                     
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       6000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       6500-CALL-AV02C015.                                                      
      *-------------------------------------------------------------            
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       7000-PRINT-LETTER.                                                       
      *-------------------------------------------------------------            
           MOVE  F200-NUM-REGN           TO PC55-OUR-REF.                       
           MOVE  F200-NUM-HHTY-QUEUE     TO PC55-NUM-QUEUE                      
                                            PC55B-NUM-QUEUE                     
                                            PC55C-NUM-QUEUE.                    
                                                                                
           STRING F200-DTE-BKAPPMT-DATE(7:2) '/'                                
                  F200-DTE-BKAPPMT-DATE(5:2) '/'                                
                  F200-DTE-BKAPPMT-DATE(1:4)                                    
                  DELIMITED BY SIZE INTO PC55-DTE-APPT.                         
                                                                                
           MOVE PC55-DTE-APPT TO PC55B-DTE-APPT                                 
                                 PC55C-DTE-APPT.                                
                                                                                
           EVALUATE K740-CDE-ALLOC-SCH                                          
              WHEN 'TCP'                                                        
                   MOVE ' THIRD-CHILD PRIORITY ' TO PC55-ALLO-SCH               
              WHEN 'PA '                                                        
                   MOVE '    PUBLIC            ' TO PC55-ALLO-SCH               
           END-EVALUATE.                                                        
                                                                                
           IF K740-CDE-ALLOC-SCH = 'MCP'                                        
              MOVE 'MARRIED CHILD PRIORITY' TO PC55-ALLO-SCH                    
           END-IF.                                                              
                                                                                
           MOVE F200-TME-BKAPPMT TO WS-ARRIV-TIME                               
                                    WS-APPMT-TIME.                              
                                                                                
           IF WS-APPMT-HR > 12                                                  
              COMPUTE WS-APPMT-HR = WS-APPMT-HR - 12                            
              MOVE 'PM'                  TO PC55-TME-APPT-AMPM                  
                                            PC55B-TME-APPT-AMPM                 
                                            PC55C-TME-APPT-AMPM                 
           ELSE                                                                 
              MOVE 'AM'                  TO PC55-TME-APPT-AMPM                  
                                            PC55B-TME-APPT-AMPM                 
                                            PC55C-TME-APPT-AMPM                 
              IF WS-APPMT-HR = 12                                               
                 MOVE 'PM'               TO PC55-TME-APPT-AMPM                  
                                            PC55B-TME-APPT-AMPM                 
                                            PC55C-TME-APPT-AMPM                 
              END-IF                                                            
           END-IF.                                                              
           MOVE WS-APPMT-HR              TO PC55-TME-APPT-HH                    
                                            PC55B-TME-APPT-HH                   
                                            PC55C-TME-APPT-HH.                  
           MOVE WS-APPMT-MM              TO PC55-TME-APPT-MM                    
                                            PC55B-TME-APPT-MM                   
                                            PC55C-TME-APPT-MM.                  
                                                                                
           COMPUTE WS-ARRIV-HR = WS-ARRIV-HR - 1.                               
           IF WS-ARRIV-HR > 12                                                  
              COMPUTE WS-ARRIV-HR = WS-ARRIV-HR - 12                            
              MOVE 'PM'                  TO PC55-TME-COME-AMPM                  
           ELSE                                                                 
              MOVE 'AM'                  TO PC55-TME-COME-AMPM                  
              IF WS-ARRIV-HR = 12                                               
                 MOVE 'PM'               TO PC55-TME-COME-AMPM                  
              END-IF                                                            
           END-IF.                                                              
           MOVE WS-ARRIV-HR              TO PC55-TME-COME-HH.                   
           MOVE WS-ARRIV-MM              TO PC55-TME-COME-MM.                   
                                                                                
      *    EVALUATE K740-NUM-GRO-RANK  ALSO K740-CDE-REQUEST-STATUS             
      *       WHEN  '  '              ALSO 'S'                                  
      *       WHEN  '  '              ALSO 'S'                                  
      *       WHEN  '  '              ALSO 'S'                                  
      *          PERFORM 8000-PRINT-NGRO         THRU 8000-EXIT                 
      *       WHEN  '  '              ALSO 'R'                                  
      *       WHEN  '  '              ALSO 'R'                                  
      *       WHEN  '  '              ALSO 'R'                                  
      *          PERFORM 8200-PRINT-NGRO-TIME2   THRU 8200-EXIT                 
      *       WHEN  NOT '  '          ALSO 'S'                                  
      *       WHEN  NOT '  '          ALSO 'S'                                  
      *       WHEN  NOT '  '          ALSO 'S'                                  
      *          PERFORM 8400-PRINT-GRO          THRU 8400-EXIT                 
      *    END-EVALUATE.                                                        
                                                                                
           IF K740-NUM-GRO-RANK NOT = '  ' AND                                  
              K740-CDE-REQUEST-STATUS = 'S'                                     
              PERFORM 8400-PRINT-GRO          THRU 8400-EXIT                    
           ELSE                                                                 
              IF K740-NUM-NT-FT-QUEUE <= '00682'                                
                 PERFORM 8000-PRINT-NGRO         THRU 8000-EXIT                 
              ELSE                                                              
                 PERFORM 8200-PRINT-NGRO-TIME2   THRU 8200-EXIT                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8000-PRINT-NGRO.                                                         
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO PC55A-PRTREC.                                         
           WRITE PC55A-PRTREC FROM DJDE-LINE-A  AFTER PAGE.                     
           MOVE SPACES TO PC55A-PRTREC.                                         
           WRITE PC55A-PRTREC AFTER PAGE.                                       
           WRITE PC55A-PRTREC       FROM PC55-LINE01 AFTER 5.                   
           WRITE PC55A-PRTREC       FROM PC55-LINE02.                           
           WRITE PC55A-PRTREC       FROM PC55-LINE03 AFTER 2.                   
           WRITE PC55A-PRTREC       FROM PC55-LINE03B.                          
      *    WRITE PC55A-PRTREC       FROM PC55-LINE03C.                          
      *    WRITE PC55A-PRTREC       FROM PC55-LINE03D.                          
           WRITE PC55A-PRTREC       FROM PC55-LINE04.                           
           WRITE PC55A-PRTREC       FROM PC55-LINE04B.                          
           WRITE PC55A-PRTREC       FROM PC55-LINE04C.                          
           WRITE PC55A-PRTREC       FROM PC55-LINE05 AFTER 2.                   
           WRITE PC55A-PRTREC       FROM PC55A-LINE01 AFTER 10.                 
           WRITE PC55A-PRTREC       FROM PC55A-LINE02.                          
           WRITE PC55A-PRTREC       FROM PC55A-LINE03 AFTER 2.                  
           WRITE PC55A-PRTREC       FROM PC55-LINE06 AFTER 3.                   
                                                                                
           MOVE SPACES TO PC55A-PRTREC.                                         
           WRITE PC55A-PRTREC FROM DJDE-PAGE2 AFTER PAGE.                       
           WRITE PC55A-PRTREC AFTER 5.                                          
                                                                                
       8000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8200-PRINT-NGRO-TIME2.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO PC55B-PRTREC.                                         
           WRITE PC55B-PRTREC FROM DJDE-LINE-B  AFTER PAGE.                     
           MOVE SPACES TO PC55B-PRTREC.                                         
           WRITE PC55B-PRTREC AFTER PAGE.                                       
           WRITE PC55B-PRTREC       FROM PC55-LINE01 AFTER 5.                   
           WRITE PC55B-PRTREC       FROM PC55-LINE02.                           
           WRITE PC55B-PRTREC       FROM PC55-LINE03 AFTER 2.                   
           WRITE PC55B-PRTREC       FROM PC55-LINE03B.                          
      *    WRITE PC55B-PRTREC       FROM PC55-LINE03C.                          
      *    WRITE PC55B-PRTREC       FROM PC55-LINE03D.                          
           WRITE PC55B-PRTREC       FROM PC55-LINE04.                           
           WRITE PC55B-PRTREC       FROM PC55-LINE04B.                          
           WRITE PC55B-PRTREC       FROM PC55-LINE04C.                          
           WRITE PC55B-PRTREC       FROM PC55-LINE05 AFTER 2.                   
           WRITE PC55B-PRTREC       FROM PC55B-LINE01 AFTER 9.                  
           WRITE PC55B-PRTREC       FROM PC55B-LINE02 AFTER 6.                  
           WRITE PC55B-PRTREC       FROM PC55-LINE06 AFTER 4.                   
                                                                                
           MOVE SPACES TO PC55B-PRTREC.                                         
           WRITE PC55B-PRTREC FROM DJDE-PAGE2 AFTER PAGE.                       
           WRITE PC55B-PRTREC AFTER 5.                                          
                                                                                
       8200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8400-PRINT-GRO.                                                          
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO PC55C-PRTREC.                                         
           WRITE PC55C-PRTREC FROM DJDE-LINE-C  AFTER PAGE.                     
           MOVE SPACES TO PC55C-PRTREC.                                         
           WRITE PC55C-PRTREC AFTER PAGE.                                       
           WRITE PC55C-PRTREC       FROM PC55-LINE01 AFTER 5.                   
           WRITE PC55C-PRTREC       FROM PC55-LINE02.                           
           WRITE PC55C-PRTREC       FROM PC55-LINE03 AFTER 2.                   
           WRITE PC55C-PRTREC       FROM PC55-LINE03B.                          
      *    WRITE PC55C-PRTREC       FROM PC55-LINE03C.                          
      *    WRITE PC55C-PRTREC       FROM PC55-LINE03D.                          
           WRITE PC55C-PRTREC       FROM PC55-LINE04.                           
           WRITE PC55C-PRTREC       FROM PC55-LINE04B.                          
           WRITE PC55C-PRTREC       FROM PC55-LINE04C.                          
           WRITE PC55C-PRTREC       FROM PC55-LINE05 AFTER 2.                   
           WRITE PC55C-PRTREC       FROM PC55C-LINE01 AFTER 14.                 
           WRITE PC55C-PRTREC       FROM PC55C-LINE02 AFTER 2.                  
           WRITE PC55C-PRTREC       FROM PC55-LINE06 AFTER 3.                   
                                                                                
           MOVE SPACES TO PC55C-PRTREC.                                         
           WRITE PC55C-PRTREC FROM DJDE-PAGE2 AFTER PAGE.                       
           WRITE PC55C-PRTREC AFTER 5.                                          
                                                                                
       8400-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
            CLOSE BP13F200                                                      
                  BP13K740                                                      
                  BP13K820                                                      
                  BP13K830                                                      
                  P13PC55A                                                      
                  P13PC55B                                                      
                  P13PC55C.                                                     
                                                                                
            IF WS-K740-STATUS   NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K740, STAT ' WS-K740-STATUS.          
                                                                                
            IF WS-K820-STATUS   NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K820, STAT ' WS-K820-STATUS.          
                                                                                
            IF WS-K830-STATUS   NOT = 00 AND 97                                 
               DISPLAY 'CLOSING ERROR BP13K830, STAT ' WS-K830-STATUS.          
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
