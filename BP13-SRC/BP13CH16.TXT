       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CH16.                                                 
      *AUTHOR.        PAULO CAMIA LEGASPI.                                      
      *DATE-WRITTEN.  11/03/2009.                                               
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                             
      * ========================================================== *            
      *                                                            *            
      * OBJECTIVES: MATCHING PROGRAM OF BP13F800 AND BP13FH15      *            
      *             FOR ALL CASES W/OUT BOOKING APPOINTMENT THAT   *            
      *             HAVE BEEN CANCELED.                            *            
      * ---------------------------------------------------------- *            
      * CHG REF   BY    DATE      DETAILS                          *            
      * -------   ====  ========= ================================ *            
      * BP133555  PCL3  11032009  NEW PROGRAM                      *            
      * BP133601  PCL3  01062009  ADD 'WF' FOR NON-SELECTION       *            
      * BP133172  PCL3  11062009  MOVE DTE-BK-APPMT FROM BP13FH15  *            
      * BP134303  PCL3  18082011  TO CHECK QUEUE IF ALPHANUMERIC   *            
      * BP134388  ZDD1  13102011  TO CATER FOR HH=G                *            
      * BP135039  IMC1  20130916  NON-SELECTION FOR FT2T, 2T, FTS  *            
      * BP135039  IMC1  20131008  MOVE FT2T FIELD                  *            
      * BP135039  IMC1  20131111  REMOVE CAT FROM MAIN-KEY         *            
      *                           TAKE NEW TOWN FROM BP13F800      *            
      * BP135237  IMC1  20140304  INITIALIZE ALPHANUMERIC QUEUE NO *            
      * BP136467  FNP1  20160923  INCLUDE OTHER TAG IN UPDATING NON*            
      *                           SELN, PASS UPDATED ALLO-TAG AND  *            
      *                           WITHIN-LIMIT TAG TO F800         *            
      * BP136656  FNP1  20170222  CATER FOR SAP CASES              *            
      * BP138220  FP6   20200707  INITIALIZE TEMP VARS FOR UINS    *            
      * BP138148  KR13  06102020  CATER FOR ELIG-SCH 'PAC'         *            
      * BP139545  JM23  03112023  POLICY CHANGE STARTING FROM      *            
      *                           202310                           *            
      * BP139545  JM23  29022024  TO FIX NON-SELECTION START AND   *            
      *                           EXPIRY DATES NOT POPULATED FOR   *            
      *                           FT, H(G), ST AND FTS WITH 202310 *            
      *                           POLICY CHANGE. REF TO PARA 7780. *            
      *                           PACKAGE BP13015530.              *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
      *-------------------------------------------------------------            
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
                                                                                
           SELECT SY02F001  ASSIGN        TO SY02F001.                          
           SELECT BP13F800  ASSIGN        TO BP13F800.                          
           SELECT P13F800A  ASSIGN        TO P13F800A.                          
           SELECT BP13FH15  ASSIGN        TO BP13FH15.                          
           SELECT BP13LH16  ASSIGN        TO BP13LH16.                          
                                                                                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS WS-K800-STATUS.                    
                                                                                
           SELECT BP13K595  ASSIGN        TO BP13K595                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K595-KEY-FLD                       
                            FILE STATUS   IS WS-K595-STATUS.                    
                                                                                
           SELECT BP13K820  ASSIGN        TO BP13K820                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K820-KEY-FLD                       
                            FILE STATUS   IS BP13K820-STATUS.                   
                                                                                
           SELECT BP13K895  ASSIGN        TO BP13K895                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K895-KEY-FLD                       
                            FILE STATUS   IS BP13K895-STATUS.                   
                                                                                
           SELECT BP13KH10  ASSIGN        TO BP13KH10                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KH10-KEY-FLD                       
                            FILE STATUS   IS BP13KH10-STATUS.                   
                                                                                
      *-------------------------------------------------------------            
       DATA DIVISION.                                                           
      *-------------------------------------------------------------            
                                                                                
       FILE SECTION.                                                            
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13F800                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13F800.                                                           
                                                                                
       FD   BP13FH15                                                            
            RECORD CONTAINS 200 CHARACTERS                                      
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13FH15.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K595                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K595.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K895                                                            
            RECORD CONTAINS 450 CHARACTERS.                                     
       COPY BP13K895.                                                           
                                                                                
       FD   BP13KH10                                                            
            RECORD CONTAINS  2000 CHARACTERS.                                   
       COPY BP13KH10.                                                           
                                                                                
       FD   P13F800A                                                            
            RECORDING MODE IS F.                                                
       01 P13F800A-REC                 PIC X(2000).                             
                                                                                
       FD   BP13LH16                                                            
            BLOCK  CONTAINS 0 RECORDS                                           
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORD IS OMITTED                                             
            RECORDING MODE IS F.                                                
       01   BP13LH16-REC               PIC X(132).                              
                                                                                
      *-------------------------------------------------------------            
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
                                                                                
       01 WS-VARIABLES.                                                         
          05 WS-SYSTEM-DATE       PIC 9(8)  VALUE ZEROES.                       
          05 WS-NUM-UNIT-AVAIL    PIC 9(04) VALUE ZEROES.                       
          05 WS-NUM-QUOTA-AVAIL   PIC 9(04) VALUE ZEROES.                       
          05 WS-ALLOCSCH-TYPE     PIC X(03) VALUE SPACES.                       
          05 WS-CDE-HH            PIC X(01) VALUE SPACE.                        
          05 WS-CDE-B-HH          PIC X(01) VALUE SPACE.                        
          05 WS-NUM-UIN           PIC X(09) VALUE SPACES.                       
          05 WS-SPS-UIN1          PIC X(09) VALUE SPACES.                       
          05 WS-SPS-UIN2          PIC X(09) VALUE SPACES.                       
          05 WS-SPS-UIN3          PIC X(09) VALUE SPACES.                       
          05 WS-SPS-UIN4          PIC X(09) VALUE SPACES.                       
          05 WS-NON-SEL1          PIC X(02) VALUE SPACES.                       
          05 WS-NON-SEL2          PIC X(02) VALUE SPACES.                       
          05 WS-NON-SEL3          PIC X(02) VALUE SPACES.                       
          05 WS-NON-SEL4          PIC X(02) VALUE SPACES.                       
          05 WS-NUM-NRIC-FIANCE   PIC X(09).                                    
          05 WS-TEMP-2-DIGIT-NO-FT       PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-NO-FT REDEFINES WS-TEMP-2-DIGIT-NO-FT.         
             10 WS-NUM-2-DIGIT-NO-FT     PIC 9(02).                             
                                                                                
          05 WS-TEMP-2-DIGIT-NO-ST       PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-NO-ST REDEFINES WS-TEMP-2-DIGIT-NO-ST.         
             10 WS-NUM-2-DIGIT-NO-ST     PIC 9(02).                             
                                                                                
          05 WS-TEMP-2-DIGIT-NO-FTS      PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-NO-FTS REDEFINES                               
             WS-TEMP-2-DIGIT-NO-FTS.                                            
             10 WS-NUM-2-DIGIT-NO-FTS    PIC 9(02).                             
                                                                                
          05 WS-TEMP-2-DIGIT-YES-FT      PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-YES-FT REDEFINES                               
             WS-TEMP-2-DIGIT-YES-FT.                                            
             10 WS-NUM-2-DIGIT-YES-FT       PIC 9(02).                          
                                                                                
          05 WS-TEMP-2-DIGIT-YES-ST      PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-YES-ST REDEFINES                               
             WS-TEMP-2-DIGIT-YES-ST.                                            
             10 WS-NUM-2-DIGIT-YES-ST    PIC 9(02).                             
                                                                                
          05 WS-TEMP-2-DIGIT-YES-FTS     PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-YES-FTS REDEFINES                              
             WS-TEMP-2-DIGIT-YES-FTS.                                           
             10 WS-NUM-2-DIGIT-YES-FTS   PIC 9(02).                             
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
          05 WS-NUM-FTPMC                PIC X VALUE SPACES.                    
          05 WS-TEMP-2-DIGIT-NO-FTPMC    PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-NO-FTPMC REDEFINES                             
             WS-TEMP-2-DIGIT-NO-FTPMC.                                          
             10 WS-NUM-2-DIGIT-NO-FTPMC  PIC 9(02).                             
          05 WS-TEMP-2-DIGIT-YES-FTPMC   PIC X(02).                             
          05 WS-TEMP-2-DIGIT-FMT-YES-FTPMC REDEFINES                            
             WS-TEMP-2-DIGIT-YES-FTPMC.                                         
             10 WS-NUM-2-DIGIT-YES-FTPMC PIC 9(02).                             
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
          05 WS-CURRENT-DATE             PIC X(8).                              
          05 WS-CURRENT-TIME             PIC 9(08) VALUE ZEROES.                
          05 WS-CURRENT-DATE1            PIC X(8).                              
          05 FILLER REDEFINES WS-CURRENT-DATE1.                                 
             10 WS-DTE-DEB-EXP-YR        PIC 9(4).                              
             10 WS-DTE-DEB-EXP-MM        PIC 9(2).                              
             10 WS-DTE-DEB-EXP-DD        PIC 9(2).                              
          05 WS-QUOTIENT                 PIC 9(4)  VALUE ZEROES.                
          05 WS-REMAINDER                PIC 9(4)  VALUE ZEROES.                
          05 WS-TME-APPMT-CHR            PIC X(7).                              
          05 FILLER REDEFINES WS-TME-APPMT-CHR.                                 
             10 WS-TME-APPMT-HHMM        PIC X(4).                              
             10 WS-TME-APPMT-SEC.                                               
                15 WS-TME-APPMT-MS       PIC 9(1).                              
                15 WS-TME-APPMT-MMS      PIC 9(2).                              
          05 WS-WITHIN-LIMIT             PIC X(5).                              
                                                                                
      ***   BP139545 BP13015530 STARTS BY JM23                                  
          05 WS-EXTEND-DEBAR             PIC X(01) VALUE SPACES.                
      ***   BP139545 BP13015530 ENDS   BY JM23                                  
                                                                                
       01 WS-FILE-STATUS.                                                       
          05 BP13K820-STATUS      PIC 9(02) VALUE ZEROES.                       
          05 BP13K895-STATUS      PIC 9(02) VALUE ZEROES.                       
          05 BP13KH10-STATUS      PIC 9(02) VALUE ZEROES.                       
          05 WS-K800-STATUS       PIC 9(02) VALUE ZEROES.                       
          05 WS-K595-STATUS       PIC 9(02) VALUE ZEROES.                       
          05 WS-F001-EOF          PIC X(1)  VALUE 'N'.                          
             88 EOF-F001                    VALUE 'Y'.                          
                                                                                
       01 WS-COUNTERS.                                                          
          05 WS-SUB               PIC 9(02) VALUE 01.                           
          05 WS-SUB2              PIC 9(03) VALUE 01.                           
          05 WS-KH10-UPD          PIC 9(08) VALUE ZEROES.                       
          05 WS-KH10-WRITE        PIC 9(08) VALUE ZEROES.                       
          05 WS-F800-READ         PIC 9(08) VALUE ZEROES.                       
          05 WS-FH15-READ         PIC 9(08) VALUE ZEROES.                       
          05 WS-FH15-ALC-TAG      PIC 9(08) VALUE ZEROES.                       
          05 WS-MATCHED           PIC 9(08) VALUE ZEROES.                       
          05 WS-FH15-NOTFD        PIC 9(08) VALUE ZEROES.                       
          05 WS-F800-NOTFD        PIC 9(08) VALUE ZEROES.                       
          05 WS-K800-NOTFD        PIC 9(08) VALUE ZEROES.                       
          05 WS-K800-UPD          PIC 9(08) VALUE ZEROES.                       
          05 WS-K800-NOUPD        PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-NOTFD        PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-READ         PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-FND          PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-UPDATE       PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-NOUPD        PIC 9(08) VALUE ZEROES.                       
          05 WS-K595-BOOK-STATUS  PIC X(02) VALUE SPACES.                       
          05 WS-F800-WRITE        PIC 9(08) VALUE ZEROES.                       
          05 WS-KH15-WRITE        PIC 9(08) VALUE ZEROES.                       
          05 WS-SNO               PIC 9(08) VALUE ZEROES.                       
          05 WS-LINE-CTR          PIC 9(02) VALUE ZEROES.                       
          05 WS-PAGE-CTR          PIC 9(04) VALUE ZEROES.                       
          05 WS-MAX-LINE          PIC 9(02) VALUE 55.                           
          05 WS-PRT-REGN          PIC X(08) VALUE SPACES.                       
          05 WS-PRT-QUEUE         PIC X(05) VALUE SPACES.                       
          05 WS-PREV-REGN         PIC X(08) VALUE SPACES.                       
          05 WS-FH15-REGN         PIC X(08) VALUE SPACES.                       
                                                                                
       01 WS-SWITCHES.                                                          
          05 WS-F800-EOF                 PIC X(1) VALUE 'N'.                    
          05 WS-FH15-EOF                 PIC X(1) VALUE 'N'.                    
          05 WS-K820-EOF                 PIC X(1) VALUE 'N'.                    
          05 WS-K895-EOF                 PIC X(1) VALUE 'N'.                    
          05 WS-K595-EOF                 PIC X(1) VALUE 'N'.                    
          05 WS-K820-FOUND               PIC X(1) VALUE 'N'.                    
          05 WS-QUEUE-FOUND              PIC X(1) VALUE 'N'.                    
          05 WS-MAIN-KEY-MATCHED         PIC X(1) VALUE 'N'.                    
          05 WS-KH10-FND                 PIC X(1) VALUE 'N'.                    
          05 WS-END-OF-TABLE             PIC X(1) VALUE 'N'.                    
             88 END-OF-TABLE                      VALUE 'Y'.                    
          05 WS-PROCESS-K895             PIC X(1) VALUE 'F'.                    
             88 READ-FIANCE                       VALUE 'F'.                    
             88 READ-SPOUSE                       VALUE 'S'.                    
          05 WS-WRITE-SUCCESFUL          PIC X(1) VALUE 'N'.                    
             88 WRITE-SUCCESFUL                   VALUE 'Y'.                    
                                                                                
       01 WS-F800-KEY.                                                          
          10 WS-F800-MAIN-KEY.                                                  
             15 WS-F800-ALLO-CAT              PIC X(3).                         
             15 WS-F800-DTE-BALLOT            PIC X(6).                         
             15 WS-F800-NUM-NEW-TOWN          PIC X(3).                         
             15 WS-F800-NUM-FLAT-TYPE         PIC X(2).                         
          10 WS-F800-QUEUE                    PIC X(5).                         
                                                                                
       01 WS-FH15-KEY.                                                          
          10 WS-FH15-MAIN-KEY.                                                  
             15 WS-FH15-NUM-SELECTION         PIC X(3).                         
             15 WS-FH15-DTE-BALLOT            PIC X(6).                         
             15 WS-FH15-NUM-NT                PIC X(3).                         
             15 WS-FH15-NUM-FT                PIC X(2).                         
          10 WS-FH15-QUEUE                    PIC X(5).                         
                                                                                
       01 WS-PREV-KEY.                                                          
          10 WS-PREV-MAIN-KEY.                                                  
             15 WS-PREV-NUM-SELECTION         PIC X(3).                         
             15 WS-PREV-DTE-BALLOT            PIC X(6).                         
             15 WS-PREV-NUM-NT                PIC X(3).                         
             15 WS-PREV-NUM-FT                PIC X(2).                         
             15 WS-PREV-NUM-ETHNIC            PIC X(1).                         
          10 WS-PREV-QUEUE                    PIC X(5).                         
       01 WS-PREV-ALLOC-TAG                   PIC X(2).                         
       01 WS-PREV-FH15-NUM-REGN               PIC X(8).                         
                                                                                
       01 WS-FH15-UPDATE.                                                       
          05 WS-FH15-NUM-ALLOC-TAG            PIC X(2).                         
          05 WS-FH15-NUM-REGN                 PIC X(8).                         
          05 WS-FH15-NUM-QUEUE                PIC X(5).                         
                                                                                
       01 WS-ALLOC-TAG.                                                         
          05 WS-K800-TAG-UPDATE               PIC X(2).                         
          05 WS-K595-TAG-UPDATE               PIC X(2).                         
          05 WS-K595-TAG-PREV                 PIC X(2).                         
          05 WS-KH15-ALLOC-TAG                PIC X(2).                         
                                                                                
       01  CH16-HEADER01.                                                       
           05  FILLER              PIC X(8)      VALUE 'BP13CH16'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                  'S Y S T E M   O F   '.                       
           05  FILLER              PIC X(19) VALUE                              
                                  'C O M M I T M E N T'.                        
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE : '.               
           05  CH16-DATE-HDR       PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.               
           05  CH16-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.                  
                                                                                
       01  CH16-HEADER02.                                                       
           05  FILLER              PIC X(38)     VALUE SPACES.                  
           05  FILLER              PIC X(55)     VALUE                          
              'UPDATE ALLOC-TAG AND BOOK-STATUS FOR CANCELLATION CASE'.         
                                                                                
       01  CH16-HEADER03.                                                       
           05  FILLER              PIC X(07)     VALUE SPACES.                  
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(11)     VALUE 'SOC MASTER'.            
           05  FILLER              PIC X(09)     VALUE 'SOC MAST'.              
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(05)     VALUE 'MODE '.                 
           05  FILLER              PIC X(04)     VALUE 'DATE'.                  
           05  FILLER              PIC X(14)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'DATE-BK'.               
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'CAN'.                   
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'DATE'.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE 'QUEUE'.                 
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'ALLO'.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(04)     VALUE 'UPD'.                   
           05  FILLER              PIC X(03)     VALUE 'UPD'.                   
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(14)     VALUE 'TAG-TO-NEAREST'.        
           05  FILLER              PIC X(01)     VALUE '-'.                     
           05  FILLER              PIC X(04)     VALUE 'REGN'.                  
           05  FILLER              PIC X(01)     VALUE SPACE.                   
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(09)     VALUE 'BOOK-STAT'.             
           05  FILLER              PIC X(08)     VALUE 'BOOK-STS'.              
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(03)     VALUE 'NUM'.                   
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(03)     VALUE 'BAL'.                   
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(10)     VALUE 'NON-SELECT'.            
      ***   BP139545 STARTS BY JM23   ***                                       
           05  FILLER              PIC X(02)     VALUE SPACE.                   
           05  FILLER              PIC X(02)     VALUE 'FT'.                    
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
       01  CH16-HEADER04.                                                       
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE '  S/N'.                 
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'REGN NO '.              
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(04)     VALUE 'SALE'.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(06)     VALUE 'BALLOT'.                
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'NT '.                   
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'FT'.                    
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'CAT'.                   
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'APPT   '.               
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'RSN'.                   
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'CANCELED'.              
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE 'NO.  '.                 
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'TAG'.                   
           05  FILLER              PIC X(01)     VALUE SPACES.                  
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(04)     VALUE 'TAG'.                   
           05  FILLER              PIC X(03)     VALUE 'TAG'.                   
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(06)     VALUE 'REGN'.                  
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE 'QUEUE'.                 
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'TAG'.                   
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(04)     VALUE 'PREV'.                  
           05  FILLER              PIC X(01)     VALUE SPACE.                   
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(04)     VALUE 'UPD'.                   
           05  FILLER              PIC X(03)     VALUE 'UPD'.                   
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(03)     VALUE 'HH '.                   
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(03)     VALUE 'HH '.                   
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(02)     VALUE 'N1'.                    
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(02)     VALUE 'N2'.                    
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(02)     VALUE 'N3'.                    
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(02)     VALUE 'N4'.                    
      ***   BP139545 STARTS BY JM23   ***                                       
           05  FILLER              PIC X(01)     VALUE SPACE.                   
           05  FILLER              PIC X(03)     VALUE 'PMC'.                   
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
       01  CH16-DETAIL01.                                                       
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-SN             PIC ZZZZ9        VALUE ZEROES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-REGN           PIC X(08)        VALUE SPACES.               
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  FILLER              PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  CH16-ALLOC-CAT      PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-DTE-BALLOT     PIC X(06)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-NT             PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-FT             PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-CAT            PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-BK-APPT        PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-REASON         PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-DATE-CANCEL    PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-QUEUE-NO       PIC X(05)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-ALLOC-PREV     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  CH16-ALLOC-UPDATE   PIC X(04)        VALUE SPACES.               
           05  CH16-ALLOC-UPDATE   PIC X(03)        VALUE SPACES.               
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-REFER-REGN     PIC X(08)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  CH16-REFER-QUEUE    PIC X(05)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  CH16-ALLOC-UPD      PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-BOOK-PREV      PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
      ***   BP139545 STARTS BY JM23   ***                                       
      *    05  CH16-BOOK-UPD       PIC X(04)        VALUE SPACES.               
           05  CH16-BOOK-UPD       PIC X(03)        VALUE SPACES.               
      ***   BP139545 ENDS   BY JM23   ***                                       
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-NUM-HH         PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-BAL-HH         PIC X(03)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-NON-SEL1       PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-NON-SEL2       PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-NON-SEL3       PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-NON-SEL4       PIC X(02)        VALUE SPACES.               
      ***   BP139545 STARTS BY JM23   ***                                       
           05  FILLER              PIC X(01)        VALUE SPACE.                
           05  CH16-FTPMC          PIC X(01)        VALUE SPACES.               
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
       COPY PRIOSCH.                                                            
                                                                                
      *-------------------------------------------------------------            
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
                                                                                
           PERFORM 1000-OPEN-FILES     THRU 1000-EXIT.                          
           PERFORM 2000-READ-BP13F800  THRU 2000-EXIT.                          
           PERFORM 3000-READ-BP13FH15  THRU 3000-EXIT.                          
           PERFORM 4000-PROCESS-DATA   THRU 4000-EXIT                           
              UNTIL WS-F800-EOF = 'Y'                                           
               AND  WS-FH15-EOF = 'Y'.                                          
           PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT.                          
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
                                                                                
           OPEN INPUT  BP13F800                                                 
                       SY02F001                                                 
                       BP13FH15                                                 
                       BP13K820                                                 
                       BP13K895                                                 
                I-O    BP13KH10                                                 
                       BP13K800                                                 
                       BP13K595                                                 
              OUTPUT   P13F800A                                                 
                       BP13LH16.                                                
                                                                                
           IF WS-K800-STATUS  NOT = 00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K800 : ' WS-K800-STATUS              
              MOVE     WS-K800-STATUS       TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13K820-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR OPENING - BP13K820 : ' BP13K820-STATUS             
              MOVE     BP13K820-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13K895-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR OPENING - BP13K895 : ' BP13K895-STATUS             
              MOVE     BP13K895-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13KH10-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR OPENING - BP13KH10 : ' BP13KH10-STATUS             
              MOVE     BP13KH10-STATUS      TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF WS-K595-STATUS  NOT = 00 AND 97                                   
              DISPLAY 'ERROR OPENING - BP13K595 : ' WS-K595-STATUS              
              MOVE     WS-K595-STATUS       TO RETURN-CODE                      
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           READ SY02F001 AT END MOVE 'Y'  TO WS-F001-EOF.                       
                                                                                
           IF EOF-F001                                                          
              DISPLAY 'RECORD NOT FOUND IN SY01F001 '                           
              DISPLAY 'PROCESSING TERMINATED '                                  
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           ELSE                                                                 
              MOVE F001-DTE-CURRENT          TO WS-SYSTEM-DATE                  
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE        TO WS-CURRENT-DATE.                
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13F800.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13F800 AT END                                                 
             MOVE 'Y'                TO WS-F800-EOF                             
             MOVE HIGH-VALUES        TO WS-F800-KEY                             
             GO TO 2000-EXIT.                                                   
                                                                                
           ADD 1                     TO WS-F800-READ.                           
                                                                                
           MOVE F800-NUM-ALLO-CAT    TO WS-F800-ALLO-CAT.                       
           MOVE F800-DTE-BALLOT      TO WS-F800-DTE-BALLOT.                     
           MOVE F800-NUM-NEW-TOWN    TO WS-F800-NUM-NEW-TOWN.                   
                                                                                
           IF F800-NUM-FLAT-TYPE   = '1A'                                       
               MOVE '1 '                 TO WS-F800-NUM-FLAT-TYPE               
           ELSE                                                                 
               MOVE F800-NUM-FLAT-TYPE   TO WS-F800-NUM-FLAT-TYPE               
           END-IF.                                                              
                                                                                
           IF F800-NUM-NT-FT-QUEUE(1:1) NOT NUMERIC                             
              MOVE ZEROS             TO F800-NUM-NT-FT-QUEUE(1:1)               
           END-IF.                                                              
                                                                                
           IF F800-NUM-NT-FT-QUEUE(2:1) NOT NUMERIC                             
              MOVE ZEROS             TO F800-NUM-NT-FT-QUEUE(2:1)               
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-NT-FT-QUEUE TO WS-F800-QUEUE.                          
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-READ-BP13FH15.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13FH15 AT END                                                 
             MOVE 'Y'         TO WS-FH15-EOF                                    
             MOVE HIGH-VALUES TO WS-FH15-KEY                                    
             GO TO 3000-EXIT.                                                   
                                                                                
           ADD 1                   TO WS-FH15-READ.                             
                                                                                
           MOVE FH15-NUM-SELECTION TO WS-FH15-NUM-SELECTION.                    
           MOVE FH15-DTE-BALLOT    TO WS-FH15-DTE-BALLOT.                       
           MOVE FH15-NUM-NT        TO WS-FH15-NUM-NT.                           
                                                                                
           IF FH15-NUM-FT = '1A'                                                
              MOVE '1 '            TO WS-FH15-NUM-FT                            
           ELSE                                                                 
              MOVE FH15-NUM-FT     TO WS-FH15-NUM-FT                            
           END-IF.                                                              
                                                                                
           IF FH15-NUM-QUEUE(1:1) NOT NUMERIC                                   
              MOVE ZEROS             TO FH15-NUM-QUEUE(1:1)                     
           END-IF.                                                              
                                                                                
           IF FH15-NUM-QUEUE(2:1) NOT NUMERIC                                   
              MOVE ZEROS             TO FH15-NUM-QUEUE(2:1)                     
           END-IF.                                                              
                                                                                
           MOVE FH15-NUM-QUEUE     TO WS-FH15-QUEUE.                            
           MOVE FH15-NUM-REGN      TO WS-FH15-REGN.                             
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4000-PROCESS-DATA.                                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                       TO WS-PRT-REGN                     
                                                WS-PRT-QUEUE                    
                                                WS-PREV-REGN                    
                                                WS-FH15-NUM-ALLOC-TAG           
                                                WS-FH15-NUM-REGN                
                                                WS-FH15-NUM-QUEUE               
                                                WS-K800-TAG-UPDATE              
                                                WS-K595-TAG-UPDATE.             
           MOVE ZEROES                       TO WS-TEMP-2-DIGIT-NO-FT           
                                                WS-TEMP-2-DIGIT-NO-ST           
                                                WS-TEMP-2-DIGIT-NO-FTS          
                                                WS-TEMP-2-DIGIT-YES-FT          
                                                WS-TEMP-2-DIGIT-YES-ST          
                                                WS-TEMP-2-DIGIT-YES-FTS         
      ***   BP139545 STARTS BY JM23   ***                                       
                                             WS-TEMP-2-DIGIT-NO-FTPMC           
                                             WS-TEMP-2-DIGIT-YES-FTPMC.         
      ***   BP139545 ENDS   BY JM23   ***                                       
           MOVE SPACES                       TO WS-NUM-UIN                      
                                                WS-SPS-UIN1                     
                                                WS-SPS-UIN2                     
                                                WS-SPS-UIN3                     
                                                WS-SPS-UIN4.                    
                                                                                
           IF WS-F800-KEY = WS-FH15-KEY                                         
              ADD 1                                   TO WS-MATCHED             
              PERFORM 5100-MOVE-FH15-FIELDS         THRU 5100-EXIT              
      *       PERFORM 6000-UPDATE-ALLOC-TAG         THRU 6000-EXIT              
              PERFORM 7300-GET-BOOK-STATUS          THRU 7300-EXIT              
              PERFORM 6000-UPDATE-ALLOC-TAG         THRU 6000-EXIT              
              PERFORM 8000-PRINT-REPORT             THRU 8000-EXIT              
              PERFORM 2000-READ-BP13F800            THRU 2000-EXIT              
              PERFORM 3000-READ-BP13FH15            THRU 3000-EXIT              
           ELSE                                                                 
           IF WS-F800-KEY  <  WS-FH15-KEY                                       
              MOVE 'N'                           TO WS-MAIN-KEY-MATCHED         
              PERFORM 5000-CHECK-QUEUE-NO           THRU 5000-EXIT              
              PERFORM 2000-READ-BP13F800            THRU 2000-EXIT              
           ELSE                                                                 
              ADD 1                              TO WS-F800-NOTFD               
              MOVE WS-FH15-KEY                   TO WS-PREV-KEY                 
              MOVE FH15-NUM-ALLOC-TAG            TO WS-PREV-ALLOC-TAG           
              MOVE FH15-NUM-REGN               TO WS-PREV-FH15-NUM-REGN         
              PERFORM 3000-READ-BP13FH15     THRU 3000-EXIT                     
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5000-CHECK-QUEUE-NO.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE 'N'                              TO WS-QUEUE-FOUND.             
                                                                                
           IF WS-F800-MAIN-KEY = WS-FH15-MAIN-KEY                               
              MOVE 'Y'                           TO WS-MAIN-KEY-MATCHED         
              PERFORM 5200-CHECK-FH15-QUEUE-NO THRU 5200-EXIT                   
           ELSE                                                                 
              ADD 1                              TO WS-FH15-NOTFD               
                                                                                
              IF (WS-F800-MAIN-KEY = WS-PREV-MAIN-KEY)                          
                  PERFORM 5300-CHECK-PREV-QUEUE-NO THRU 5300-EXIT               
              ELSE                                                              
                  ADD 1                          TO WS-K800-NOUPD               
              END-IF                                                            
           END-IF.                                                              
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5100-MOVE-FH15-FIELDS.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE FH15-NUM-ALLOC-TAG            TO WS-FH15-NUM-ALLOC-TAG.         
           MOVE FH15-NUM-REGN                 TO WS-FH15-NUM-REGN.              
           MOVE FH15-NUM-QUEUE                TO WS-FH15-NUM-QUEUE.             
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5200-CHECK-FH15-QUEUE-NO.                                                
      *-------------------------------------------------------------            
                                                                                
           IF WS-F800-QUEUE < WS-FH15-QUEUE                                     
              IF FH15-NUM-ALLOC-TAG NOT = SPACES AND LOW-VALUES                 
                 PERFORM 5100-MOVE-FH15-FIELDS      THRU 5100-EXIT              
      *          PERFORM 6000-UPDATE-ALLOC-TAG      THRU 6000-EXIT              
                 PERFORM 7300-GET-BOOK-STATUS       THRU 7300-EXIT              
                 PERFORM 6000-UPDATE-ALLOC-TAG      THRU 6000-EXIT              
                 PERFORM 8000-PRINT-REPORT          THRU 8000-EXIT              
              ELSE                                                              
                 ADD 1                              TO WS-FH15-ALC-TAG          
              END-IF                                                            
           END-IF.                                                              
                                                                                
           ADD 1                                    TO WS-FH15-NOTFD.           
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5300-CHECK-PREV-QUEUE-NO.                                                
      *-------------------------------------------------------------            
                                                                                
           IF WS-F800-MAIN-KEY = WS-PREV-MAIN-KEY                               
              IF FH15-NUM-ALLOC-TAG NOT = SPACES AND LOW-VALUES                 
                 MOVE WS-PREV-ALLOC-TAG      TO WS-FH15-NUM-ALLOC-TAG           
                 MOVE WS-PREV-FH15-NUM-REGN  TO WS-FH15-NUM-REGN                
                 MOVE WS-PREV-QUEUE          TO WS-FH15-NUM-QUEUE               
      *          PERFORM 6000-UPDATE-ALLOC-TAG      THRU 6000-EXIT              
                 PERFORM 7300-GET-BOOK-STATUS       THRU 7300-EXIT              
                 PERFORM 6000-UPDATE-ALLOC-TAG      THRU 6000-EXIT              
                 PERFORM 8000-PRINT-REPORT          THRU 8000-EXIT              
              ELSE                                                              
                 ADD 1                       TO WS-FH15-ALC-TAG                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       6000-UPDATE-ALLOC-TAG.                                                   
      *-------------------------------------------------------------            
                                                                                
           MOVE 'Y'                         TO WS-QUEUE-FOUND.                  
           PERFORM 7000-READ-BP13K800     THRU 7000-EXIT.                       
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       6100-GET-NON-SELN-TAG.                                                   
      *-------------------------------------------------------------            
           IF FH15-NUM-WITHIN-LIMIT = 'Y'                                       
      * FTS                                                                     
              EVALUATE TRUE                                                     
                 WHEN (F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                
                     ((F800-NUM-ALLO-SCHEME = 'SAP') AND                        
                     (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR         
                                             'SSE' OR 'JSE' OR 'NSE'))          
                    MOVE 'LB'              TO K595-NUM-BOOK-STATUS              
                                                                                
                 WHEN (F800-NUM-ALLO-SCHEME = 'PA ' AND                         
                       F800-NUM-ELIG-SCHEME = 'PAC')                            
                    MOVE 'LB'              TO K595-NUM-BOOK-STATUS              
      * FT2T                                                                    
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'F' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                       MOVE 'LF'        TO K595-NUM-BOOK-STATUS                 
                                                                                
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'LG'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'LS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
      * FT/FT                                                                   
                                                                                
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'H'                     
                       MOVE 'LF'        TO K595-NUM-BOOK-STATUS                 
                                                                                
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'G'                     
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'LG'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'LS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
      * ST                                                                      
                                                                                
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G'                     
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'LA'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'LS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
                                                                                
                 WHEN OTHER                                                     
                    DISPLAY 'DBR COMBINATION NOT FND: ' F800-NUM-REGN           
                            ' HH ' WS-CDE-HH ' BHH ' WS-CDE-B-HH                
                            ' FT2T ' F800-NUM-FT2T                              
              END-EVALUATE                                                      
      * NOT WITHIN LIMIT                                                        
           ELSE                                                                 
              EVALUATE TRUE                                                     
                 WHEN (F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                
                     ((F800-NUM-ALLO-SCHEME = 'SAP') AND                        
                     (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR         
                                             'SSE' OR 'JSE' OR 'NSE'))          
                    MOVE 'WB'              TO K595-NUM-BOOK-STATUS              
                                                                                
                 WHEN (F800-NUM-ALLO-SCHEME = 'PA '  AND                        
                       F800-NUM-ELIG-SCHEME = 'PAC')                            
                    MOVE 'WB'              TO K595-NUM-BOOK-STATUS              
                                                                                
      * FT2T                                                                    
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'F' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                       MOVE 'WF'        TO K595-NUM-BOOK-STATUS                 
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'WG'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'WS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
                                                                                
      * FTFT                                                                    
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'H'                     
                       MOVE 'WF'        TO K595-NUM-BOOK-STATUS                 
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'G'                     
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'WG'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'WS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
                                                                                
      * ST                                                                      
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G'                     
                    IF F800-DTE-BALLOT >= '201307'                              
                       MOVE 'WA'        TO K595-NUM-BOOK-STATUS                 
                    ELSE                                                        
                       MOVE 'WS'        TO K595-NUM-BOOK-STATUS                 
                    END-IF                                                      
                 WHEN OTHER                                                     
                    DISPLAY 'DBR COMBINATION NOT FND: ' F800-NUM-REGN           
                            ' HH ' WS-CDE-HH ' BHH ' WS-CDE-B-HH                
                            ' FT2T ' F800-NUM-FT2T                              
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
      ***PASS THE UPDATED ALLOC-TAG TO F800A                                    
           MOVE K595-NUM-BOOK-STATUS  TO WS-KH15-ALLOC-TAG.                     
                                                                                
      ***USE THIS LIMIT FOR CH07 FOR CASES WITHOUT KH15 RECORDS                 
           STRING 'CH16' FH15-NUM-WITHIN-LIMIT                                  
               DELIMITED BY SIZE INTO WS-WITHIN-LIMIT.                          
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
      *-------------------------------------------------------------            
       6110-GET-NON-SELN-TAG-202310.                                            
      *-------------------------------------------------------------            
           IF FH15-NUM-WITHIN-LIMIT = 'Y'                                       
      * FTS                                                                     
              EVALUATE TRUE                                                     
                 WHEN (F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                
                     ((F800-NUM-ALLO-SCHEME = 'SAP') AND                        
                     (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR         
                                             'SSE' OR 'JSE' OR 'NSE'))          
                      MOVE 'LL'           TO K595-NUM-BOOK-STATUS               
                                                                                
                 WHEN (F800-NUM-ALLO-SCHEME = 'PA ' AND                         
                       F800-NUM-ELIG-SCHEME = 'PAC')                            
                      MOVE 'LL'           TO K595-NUM-BOOK-STATUS               
                                                                                
      * FT2T                                                                    
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'F' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                      IF F800-NUM-FTPMC NOT = 'N' AND SPACE                     
                         MOVE 'LI'        TO K595-NUM-BOOK-STATUS               
                      ELSE                                                      
                         MOVE 'LH'        TO K595-NUM-BOOK-STATUS               
                      END-IF                                                    
                                                                                
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                      MOVE 'LJ'           TO K595-NUM-BOOK-STATUS               
      * FT/FT                                                                   
                                                                                
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'H'                     
                      IF F800-NUM-FTPMC NOT = 'N' AND SPACE                     
                         MOVE 'LI'        TO K595-NUM-BOOK-STATUS               
                      ELSE                                                      
                         MOVE 'LH'        TO K595-NUM-BOOK-STATUS               
                      END-IF                                                    
                                                                                
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'G'                     
                      MOVE 'LJ'           TO K595-NUM-BOOK-STATUS               
      * ST                                                                      
                                                                                
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G'                     
                      MOVE 'LK'           TO K595-NUM-BOOK-STATUS               
                                                                                
                 WHEN OTHER                                                     
                    DISPLAY 'DBR COMBINATION NOT FND: ' F800-NUM-REGN           
                            ' HH ' WS-CDE-HH ' BHH ' WS-CDE-B-HH                
                            ' FT2T ' F800-NUM-FT2T                              
              END-EVALUATE                                                      
      * NOT WITHIN LIMIT                                                        
           ELSE                                                                 
              EVALUATE TRUE                                                     
                 WHEN (F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                
                     ((F800-NUM-ALLO-SCHEME = 'SAP') AND                        
                     (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR         
                                             'SSE' OR 'JSE' OR 'NSE'))          
                      MOVE 'WL'          TO K595-NUM-BOOK-STATUS                
                                                                                
                 WHEN (F800-NUM-ALLO-SCHEME = 'PA '  AND                        
                       F800-NUM-ELIG-SCHEME = 'PAC')                            
                      MOVE 'WL'          TO K595-NUM-BOOK-STATUS                
                                                                                
      * FT2T                                                                    
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'F' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                      IF F800-NUM-FTPMC NOT = 'N' AND SPACE                     
                         MOVE 'WI'       TO K595-NUM-BOOK-STATUS                
                      ELSE                                                      
                         MOVE 'WH'       TO K595-NUM-BOOK-STATUS                
                      END-IF                                                    
                                                                                
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G' AND                 
                      F800-NUM-FT2T =  'Y'                                      
                      MOVE 'WJ'          TO K595-NUM-BOOK-STATUS                
                                                                                
      * FTFT                                                                    
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'H'                     
                      IF F800-NUM-FTPMC NOT = 'N' AND SPACE                     
                         MOVE 'WI'       TO K595-NUM-BOOK-STATUS                
                      ELSE                                                      
                         MOVE 'WH'       TO K595-NUM-BOOK-STATUS                
                      END-IF                                                    
                                                                                
                 WHEN WS-CDE-HH = 'H' AND WS-CDE-B-HH = 'G'                     
                      MOVE 'WJ'          TO K595-NUM-BOOK-STATUS                
                                                                                
      * ST                                                                      
                 WHEN WS-CDE-HH = 'G' AND WS-CDE-B-HH = 'G'                     
                      MOVE 'WK'          TO K595-NUM-BOOK-STATUS                
                                                                                
                 WHEN OTHER                                                     
                    DISPLAY 'DBR COMBINATION NOT FND: ' F800-NUM-REGN           
                            ' HH ' WS-CDE-HH ' BHH ' WS-CDE-B-HH                
                            ' FT2T ' F800-NUM-FT2T                              
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
      ***PASS THE UPDATED ALLOC-TAG TO F800A                                    
           MOVE K595-NUM-BOOK-STATUS  TO WS-KH15-ALLOC-TAG.                     
                                                                                
      ***USE THIS LIMIT FOR CH07 FOR CASES WITHOUT KH15 RECORDS                 
           STRING 'CH16' FH15-NUM-WITHIN-LIMIT                                  
               DELIMITED BY SIZE INTO WS-WITHIN-LIMIT.                          
                                                                                
       6110-EXIT.                                                               
           EXIT.                                                                
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
      *-------------------------------------------------------------            
       7000-READ-BP13K800.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE F800-NUM-REGN                         TO K800-NUM-REGN.         
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-K800-STATUS                                              
               WHEN 00                                                          
                    PERFORM 7200-REWRITE-BP13K800   THRU 7200-EXIT              
               WHEN 23                                                          
                    ADD 1                             TO WS-K800-NOTFD          
                    DISPLAY 'REGN NO. NOT IN BP13K800 :' F800-NUM-REGN          
                                                                                
               WHEN OTHER                                                       
                    MOVE WS-K800-STATUS               TO RETURN-CODE            
                    DISPLAY 'ERROR READING BP13K800:' WS-K800-STATUS            
                            ' KEY : ' K800-NUM-REGN                             
                    PERFORM  9000-CLOSE-ROUTINE     THRU 9000-EXIT              
           END-EVALUATE.                                                        
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7200-REWRITE-BP13K800.                                                   
      *-------------------------------------------------------------            
                                                                                
           IF WS-FH15-NUM-ALLOC-TAG  = 'NC' OR 'NF' OR 'SC' OR 'SF' OR          
                                       'NV'                                     
              MOVE F800-NUM-ALLOC-TAG       TO K800-NUM-ALLOC-TAG-PREV          
              MOVE WS-FH15-NUM-ALLOC-TAG    TO K800-NUM-ALLOC-TAG               
                                                                                
              REWRITE BP13K800-MASTER                                           
                                                                                
              EVALUATE WS-K800-STATUS                                           
                 WHEN 00                                                        
                    ADD 1                         TO WS-K800-UPD                
                    MOVE K800-NUM-ALLOC-TAG       TO WS-K800-TAG-UPDATE         
                 WHEN 23                                                        
                    ADD 1                         TO WS-K800-NOTFD              
                    DISPLAY 'REGN NO. NOT IN BP13K800 :' F800-NUM-REGN          
                                                                                
                 WHEN OTHER                                                     
                    MOVE WS-K800-STATUS           TO RETURN-CODE                
                    DISPLAY 'ERROR REWRITING BP13K800: ' WS-K800-STATUS         
                            ' KEY : ' K800-NUM-REGN                             
                    PERFORM  9000-CLOSE-ROUTINE   THRU 9000-EXIT                
              END-EVALUATE                                                      
           ELSE                                                                 
              ADD 1                               TO WS-K800-NOUPD              
           END-IF.                                                              
                                                                                
           PERFORM 7250-WRITE-P13F800A            THRU 7250-EXIT.               
                                                                                
       7200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7250-WRITE-P13F800A.                                                     
      *-------------------------------------------------------------            
                                                                                
           MOVE    F800-NUM-ALLOC-TAG       TO F800-NUM-ALLOC-TAG-PREV.         
      *    MOVE    WS-FH15-NUM-ALLOC-TAG    TO F800-NUM-ALLOC-TAG.              
           MOVE    WS-KH15-ALLOC-TAG        TO F800-NUM-ALLOC-TAG.              
           MOVE    WS-WITHIN-LIMIT          TO BP13F800-MASTER(37:5).           
           WRITE   P13F800A-REC           FROM BP13F800-MASTER.                 
           ADD 1                            TO WS-F800-WRITE.                   
                                                                                
       7250-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7300-GET-BOOK-STATUS.                                                    
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                         TO  K595-KEY-FLD.                
           MOVE F800-NUM-REGN                  TO  K595-NUM-REGN-REF.           
           MOVE SPACES                         TO  WS-K595-BOOK-STATUS          
                                                   WS-K595-TAG-PREV             
                                                   WS-K595-TAG-UPDATE           
                                                   WS-NON-SEL1                  
                                                   WS-NON-SEL2                  
                                                   WS-NON-SEL3                  
                                                   WS-NON-SEL4.                 
                                                                                
           MOVE 'N'                            TO  WS-K595-EOF.                 
                                                                                
           START BP13K595 KEY >= K595-KEY-FLD.                                  
           EVALUATE WS-K595-STATUS                                              
           WHEN 00                                                              
                PERFORM 7350-READNEXT-BP13K595 THRU 7350-EXIT                   
                   UNTIL K595-NUM-REGN-REF NOT = F800-NUM-REGN                  
                      OR WS-K595-EOF = 'Y'                                      
           WHEN 10                                                              
           WHEN 23                                                              
                ADD  1       TO WS-K595-NOTFD                                   
                DISPLAY 'BP13K595 RECORD NOT FOUND  = ' K595-KEY-FLD            
           WHEN OTHER                                                           
                DISPLAY 'ERROR START BP13K595, STATUS  '                        
                        WS-K595-STATUS                                          
                        ',  REGN ' K595-NUM-REGN-REF                            
                MOVE WS-K595-STATUS TO RETURN-CODE                              
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       7300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7350-READNEXT-BP13K595.                                                  
      *-------------------------------------------------------------            
                                                                                
           READ BP13K595 NEXT RECORD                                            
                AT END MOVE 'Y' TO WS-K595-EOF.                                 
                                                                                
           EVALUATE WS-K595-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
                IF K595-NUM-REGN-REF = F800-NUM-REGN                            
                   IF (K595-CDE-REQUEST-STATUS NOT = SPACES AND                 
                                                     LOW-VALUES) AND            
                      (K595-NUM-NT-FT-QUEUE NOT = SPACES AND LOW-VALUES)        
                      MOVE  K595-NUM-BOOK-STATUS TO WS-K595-BOOK-STATUS         
                      PERFORM 7400-REWRITE-BP13K595      THRU 7400-EXIT         
                      ADD  1       TO WS-K595-FND                               
                   ELSE                                                         
                      ADD  1       TO WS-K595-NOTFD                             
                   END-IF                                                       
                ELSE                                                            
                   MOVE 'Y'      TO WS-K595-EOF                                 
                END-IF                                                          
           WHEN 10                                                              
           WHEN 23                                                              
                MOVE 'Y'         TO WS-K595-EOF                                 
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K595, STATUS '                       
                        WS-K595-STATUS ',  REGN ' K595-NUM-REGN-REF             
                MOVE WS-K595-STATUS             TO RETURN-CODE                  
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       7350-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7400-REWRITE-BP13K595.                                                   
      *-------------------------------------------------------------            
                                                                                
           IF F800-NUM-HOUSEHOLD = 'H' OR 'T'                                   
              MOVE 'H'                        TO WS-CDE-HH                      
           ELSE                                                                 
              MOVE F800-NUM-HOUSEHOLD         TO WS-CDE-HH                      
           END-IF                                                               
                                                                                
           IF F800-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                            
              MOVE 'H'                        TO WS-CDE-B-HH                    
           ELSE                                                                 
              MOVE F800-CDE-BALLOT-HOUSEHOLD  TO WS-CDE-B-HH                    
           END-IF                                                               
                                                                                
           MOVE K595-NUM-BOOK-STATUS    TO WS-K595-TAG-PREV.                    
                                                                                
           IF FH15-NUM-BOOK = 'N'                                               
              IF WS-FH15-NUM-ALLOC-TAG = 'NF' OR 'NC' OR 'NV' OR                
                                         'SF' OR 'SC'                           
                 MOVE WS-FH15-NUM-ALLOC-TAG     TO K595-NUM-BOOK-STATUS         
              ELSE                                                              
      ***   BP139545 STARTS BY JM23   ***                                       
      *          PERFORM 6100-GET-NON-SELN-TAG  THRU 6100-EXIT                  
                 IF F800-DTE-BALLOT < '202310'                                  
                    PERFORM 6100-GET-NON-SELN-TAG  THRU 6100-EXIT               
                 ELSE                                                           
                    PERFORM 6110-GET-NON-SELN-TAG-202310                        
                       THRU 6110-EXIT                                           
                 END-IF                                                         
      ***   BP139545 ENDS   BY JM23   ***                                       
              END-IF                                                            
           ELSE                                                                 
              MOVE 'BF'            TO K595-NUM-BOOK-STATUS                      
           END-IF.                                                              
                                                                                
           IF K595-NUM-BOOK-STATUS NOT = WS-K595-BOOK-STATUS                    
              PERFORM 7450-REWRITE-BALLOT-LOG        THRU 7450-EXIT             
      ***   BP139545 STARTS BY JM23   ***                                       
              IF K595-NUM-BOOK-STATUS = 'LF' OR 'WF' OR 'LB' OR 'WB' OR         
                                        'LG' OR 'WG' OR 'LS' OR 'WS' OR         
                                        'LA' OR 'WA' OR 'LH' OR 'LI' OR         
                                        'LJ' OR 'LK' OR 'LL' OR 'WH' OR         
                                        'WI' OR 'WJ' OR 'WK' OR 'WL'            
      ***   BP139545 ENDS   BY JM23   ***                                       
                 PERFORM 7500-UPD-NON-SELECTION-KH10 THRU 7500-EXIT             
              END-IF                                                            
           ELSE                                                                 
               ADD   1                                 TO WS-K595-NOUPD         
           END-IF.                                                              
                                                                                
       7400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7450-REWRITE-BALLOT-LOG.                                                 
      *-------------------------------------------------------------            
                                                                                
              REWRITE BP13K595-REC.                                             
                                                                                
              EVALUATE WS-K595-STATUS                                           
              WHEN 00                                                           
                 ADD   1                         TO WS-K595-UPDATE              
                 MOVE K595-NUM-BOOK-STATUS       TO WS-K595-TAG-UPDATE          
              WHEN OTHER                                                        
                 DISPLAY 'BP13K595 REWRITE ERR-STATUS ' WS-K595-STATUS          
                       ' KEY IS ' K595-KEY-FLD                                  
                 MOVE WS-K595-STATUS             TO RETURN-CODE                 
                 PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                   
              END-EVALUATE.                                                     
                                                                                
       7450-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7500-UPD-NON-SELECTION-KH10.                                             
      *-------------------------------------------------------------            
                                                                                
           PERFORM 7600-GET-ALLO-SCH                  THRU 7600-EXIT.           
                                                                                
           IF (WS-ALLOCSCH-TYPE  = 'CCC')   OR                                  
              (F800-NUM-ALLOC-TAG = 'NE')   OR                                  
              (F800-NUM-FLAT-TYPE  = '1A' OR '2A')                              
              GO TO 7500-EXIT.                                                  
                                                                                
           IF F800-NUM-NRIC1 NOT = SPACES AND LOW-VALUES                        
              MOVE F800-NUM-NRIC1            TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
                                                                                
              IF WS-K820-FOUND = 'Y'                                            
                 MOVE K820-NUM-NRIC-SPOUSE   TO WS-SPS-UIN1                     
              ELSE                                                              
                 MOVE K895-NUM-NRIC-SPOUSE   TO WS-SPS-UIN1                     
              END-IF                                                            
                                                                                
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT                       
              EVALUATE TRUE                                                     
              WHEN (F800-NUM-ALLO-SCHEME  = 'FTS' OR 'STS') OR                  
                   ((F800-NUM-ALLO-SCHEME = 'SAP') AND                          
                   (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR           
                                           'SSE' OR 'JSE' OR 'NSE'))            
              WHEN (F800-NUM-ALLO-SCHEME = 'PA ' AND                            
                    F800-NUM-ELIG-SCHEME = 'PAC')                               
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL1                 
              WHEN WS-CDE-HH     = 'H' OR 'T' OR                                
                   F800-NUM-FT2T = 'Y'                                          
      ***   BP139545 STARTS BY JM23   ***                                       
      *           MOVE KH10-NUM-NON-SELN-FT      TO WS-NON-SEL1                 
                   IF F800-DTE-BALLOT >= '202310' AND                           
                      F800-NUM-FTPMC NOT = 'N' AND SPACE                        
                      MOVE KH10-NUM-NON-SELN-FTPMC TO WS-NON-SEL1               
                   ELSE                                                         
                      MOVE KH10-NUM-NON-SELN-FT    TO WS-NON-SEL1               
                   END-IF                                                       
      ***   BP139545 ENDS   BY JM23   ***                                       
              WHEN WS-CDE-HH     = 'G'                                          
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL1                 
              END-EVALUATE.                                                     
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES AND LOW-VALUES                        
              MOVE F800-NUM-NRIC2            TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
                                                                                
              IF WS-K820-FOUND = 'Y'                                            
                 MOVE K820-NUM-NRIC-SPOUSE   TO WS-SPS-UIN2                     
              ELSE                                                              
                 MOVE K895-NUM-NRIC-SPOUSE   TO WS-SPS-UIN2                     
              END-IF                                                            
                                                                                
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT                       
              EVALUATE TRUE                                                     
              WHEN (F800-NUM-ALLO-SCHEME  = 'FTS' OR 'STS') OR                  
                   ((F800-NUM-ALLO-SCHEME = 'SAP') AND                          
                   (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR           
                                           'SSE' OR 'JSE' OR 'NSE'))            
              WHEN (F800-NUM-ALLO-SCHEME = 'PA '  AND                           
                    F800-NUM-ELIG-SCHEME = 'PAC')                               
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL2                 
              WHEN WS-CDE-HH     = 'H' OR 'T' OR                                
                   F800-NUM-FT2T = 'Y'                                          
      ***   BP139545 STARTS BY JM23   ***                                       
      *           MOVE KH10-NUM-NON-SELN-FT      TO WS-NON-SEL2                 
                   IF F800-DTE-BALLOT >= '202310' AND                           
                      F800-NUM-FTPMC NOT = 'N' AND SPACE                        
                      MOVE KH10-NUM-NON-SELN-FTPMC TO WS-NON-SEL2               
                   ELSE                                                         
                      MOVE KH10-NUM-NON-SELN-FT    TO WS-NON-SEL2               
                   END-IF                                                       
      ***   BP139545 ENDS   BY JM23   ***                                       
              WHEN WS-CDE-HH     = 'G'                                          
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL2                 
              END-EVALUATE.                                                     
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES AND LOW-VALUES                        
              MOVE F800-NUM-NRIC3            TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
                                                                                
              IF WS-K820-FOUND = 'Y'                                            
                 MOVE K820-NUM-NRIC-SPOUSE   TO WS-SPS-UIN3                     
              ELSE                                                              
                 MOVE K895-NUM-NRIC-SPOUSE   TO WS-SPS-UIN3                     
              END-IF                                                            
                                                                                
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT                       
              EVALUATE TRUE                                                     
              WHEN (F800-NUM-ALLO-SCHEME  = 'FTS' OR 'STS') OR                  
                   ((F800-NUM-ALLO-SCHEME = 'SAP') AND                          
                   (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR           
                                           'SSE' OR 'JSE' OR 'NSE'))            
              WHEN (F800-NUM-ALLO-SCHEME = 'PA ' AND                            
                    F800-NUM-ELIG-SCHEME = 'PAC')                               
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL3                 
              WHEN WS-CDE-HH     = 'H' OR 'T' OR                                
                   F800-NUM-FT2T = 'Y'                                          
      ***   BP139545 STARTS BY JM23   ***                                       
      *           MOVE KH10-NUM-NON-SELN-FT      TO WS-NON-SEL3                 
                   IF F800-DTE-BALLOT >= '202310' AND                           
                      F800-NUM-FTPMC NOT = 'N' AND SPACE                        
                      MOVE KH10-NUM-NON-SELN-FTPMC TO WS-NON-SEL3               
                   ELSE                                                         
                      MOVE KH10-NUM-NON-SELN-FT    TO WS-NON-SEL3               
                   END-IF                                                       
      ***   BP139545 ENDS   BY JM23   ***                                       
              WHEN WS-CDE-HH     = 'G'                                          
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL3                 
              END-EVALUATE.                                                     
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES AND LOW-VALUES                        
              MOVE F800-NUM-NRIC4            TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
                                                                                
              IF WS-K820-FOUND = 'Y'                                            
                 MOVE K820-NUM-NRIC-SPOUSE   TO WS-SPS-UIN4                     
              ELSE                                                              
                 MOVE K895-NUM-NRIC-SPOUSE   TO WS-SPS-UIN4                     
              END-IF                                                            
                                                                                
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT                       
              EVALUATE TRUE                                                     
              WHEN (F800-NUM-ALLO-SCHEME  = 'FTS' OR 'STS') OR                  
                   ((F800-NUM-ALLO-SCHEME = 'SAP') AND                          
                   (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR           
                                           'SSE' OR 'JSE' OR 'NSE'))            
              WHEN (F800-NUM-ALLO-SCHEME = 'PA ' AND                            
                    F800-NUM-ELIG-SCHEME = 'PAC')                               
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL4                 
              WHEN WS-CDE-HH     = 'H' OR 'T' OR                                
                   F800-NUM-FT2T = 'Y'                                          
      ***   BP139545 STARTS BY JM23   ***                                       
      *           MOVE KH10-NUM-NON-SELN-FT      TO WS-NON-SEL4                 
                   IF F800-DTE-BALLOT >= '202310' AND                           
                      F800-NUM-FTPMC NOT = 'N' AND SPACE                        
                      MOVE KH10-NUM-NON-SELN-FTPMC TO WS-NON-SEL4               
                   ELSE                                                         
                      MOVE KH10-NUM-NON-SELN-FT    TO WS-NON-SEL4               
                   END-IF                                                       
      ***   BP139545 ENDS   BY JM23   ***                                       
              WHEN WS-CDE-HH     = 'G'                                          
                  MOVE KH10-NUM-NON-SELN-FTS     TO WS-NON-SEL4                 
              END-EVALUATE.                                                     
                                                                                
           IF WS-SPS-UIN1 NOT = SPACES AND LOW-VALUES AND                       
              F800-NUM-NRIC1 AND F800-NUM-NRIC2 AND                             
              F800-NUM-NRIC3 AND F800-NUM-NRIC4                                 
              MOVE WS-SPS-UIN1               TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT.                      
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT.                      
                                                                                
           IF WS-SPS-UIN2 NOT = SPACES AND LOW-VALUES AND                       
              F800-NUM-NRIC1 AND F800-NUM-NRIC2 AND                             
              F800-NUM-NRIC3 AND F800-NUM-NRIC4                                 
              MOVE WS-SPS-UIN2               TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT.                      
                                                                                
           IF WS-SPS-UIN3 NOT = SPACES AND LOW-VALUES AND                       
              F800-NUM-NRIC1 AND F800-NUM-NRIC2 AND                             
              F800-NUM-NRIC3 AND F800-NUM-NRIC4                                 
              MOVE WS-SPS-UIN3               TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT.                      
                                                                                
           IF WS-SPS-UIN4 NOT = SPACES AND LOW-VALUES AND                       
              F800-NUM-NRIC1 AND F800-NUM-NRIC2 AND                             
              F800-NUM-NRIC3 AND F800-NUM-NRIC4                                 
              MOVE WS-SPS-UIN4               TO WS-NUM-UIN                      
              MOVE 'S'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT                       
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT.                      
                                                                                
           IF F800-NUM-ELIG-SCHEME = 'FS ' OR ' FS'                             
              PERFORM 7550-BROWSE-BP13K820 THRU 7550-EXIT                       
              IF WS-NUM-NRIC-FIANCE NOT = SPACES AND                            
              F800-NUM-NRIC1 AND F800-NUM-NRIC2 AND                             
              F800-NUM-NRIC3 AND F800-NUM-NRIC4                                 
              MOVE WS-NUM-NRIC-FIANCE        TO WS-NUM-UIN                      
              MOVE 'F'                       TO WS-PROCESS-K895                 
              PERFORM 7700-POPULATE-HEADER THRU 7700-EXIT                       
              PERFORM 7800-POPULATE-DETAIL THRU 7800-EXIT.                      
              PERFORM 7900-UPDATE-BP13KH10 THRU 7900-EXIT.                      
                                                                                
       7500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7550-BROWSE-BP13K820.                                                    
      *-------------------------------------------------------------            
                                                                                
           MOVE 'N'               TO  WS-K820-EOF.                              
           MOVE SPACES            TO  WS-NUM-NRIC-FIANCE.                       
                                                                                
           MOVE SPACES            TO  K820-KEY-FLD                              
           MOVE F800-NUM-REGN     TO  K820-NUM-REGN.                            
                                                                                
           START BP13K820 KEY >= K820-KEY-FLD.                                  
           EVALUATE BP13K820-STATUS                                             
           WHEN 00                                                              
                PERFORM 7560-READNEXT-BP13K820 THRU 7560-EXIT                   
                  UNTIL K820-NUM-REGN NOT = F800-NUM-REGN                       
                     OR WS-K820-EOF = 'Y'                                       
           WHEN 10                                                              
           WHEN 23                                                              
                DISPLAY 'BP13K820 RECORD NOT FOUND  = ' K820-KEY-FLD            
           WHEN OTHER                                                           
                DISPLAY 'ERROR START BP13K820, STATUS  '                        
                         BP13K820-STATUS                                        
                        ',  REGN ' K820-NUM-REGN                                
                MOVE BP13K820-STATUS            TO RETURN-CODE                  
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
           IF WS-NUM-NRIC-FIANCE = SPACES                                       
              MOVE 'F'                          TO WS-PROCESS-K895              
              PERFORM 7570-BROWSE-BP13K895    THRU 7570-EXIT                    
           END-IF.                                                              
                                                                                
                                                                                
       7550-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7560-READNEXT-BP13K820.                                                  
      *-------------------------------------------------------------            
                                                                                
           READ BP13K820 NEXT RECORD.                                           
                                                                                
           EVALUATE BP13K820-STATUS                                             
           WHEN 00                                                              
           WHEN 02                                                              
                IF K820-NUM-REGN = F800-NUM-REGN AND                            
                   K820-NUM-RELATIONSHIP = '09'                                 
                   MOVE K820-NUM-NRIC         TO WS-NUM-NRIC-FIANCE             
                   MOVE K820-NME-OCCP         TO KH10-NME-APPLT                 
                   MOVE 'Y'                   TO WS-K820-EOF                    
                END-IF                                                          
           WHEN 10                                                              
           WHEN 23                                                              
                MOVE 'Y'                      TO WS-K820-EOF                    
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K820, STATUS '                       
                        BP13K820-STATUS ',  REGN ' K820-NUM-REGN                
                MOVE BP13K820-STATUS          TO RETURN-CODE                    
                PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       7560-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7570-BROWSE-BP13K895.                                                    
      *-------------------------------------------------------------            
                                                                                
           MOVE 'N'               TO  WS-K895-EOF.                              
           MOVE SPACES            TO  WS-NUM-NRIC-FIANCE.                       
                                                                                
           MOVE SPACES            TO  K895-KEY-FLD.                             
           MOVE F800-NUM-REGN     TO  K895-NUM-REGN-HIST.                       
                                                                                
           IF READ-SPOUSE                                                       
              MOVE WS-NUM-UIN     TO K895-NUM-NRIC-HIST                         
           END-IF.                                                              
                                                                                
           START BP13K895 KEY >= K895-KEY-FLD.                                  
           EVALUATE BP13K895-STATUS                                             
           WHEN 00                                                              
                IF READ-SPOUSE                                                  
                   PERFORM 7580-READNEXT-BP13K895 THRU 7580-EXIT                
                     UNTIL (K895-NUM-REGN-HIST NOT = F800-NUM-REGN AND          
                            K895-NUM-NRIC-HIST NOT = WS-NUM-UIN)                
                        OR WS-K895-EOF = 'Y'                                    
                ELSE                                                            
                   PERFORM 7580-READNEXT-BP13K895 THRU 7580-EXIT                
                     UNTIL (K895-NUM-REGN-HIST NOT = F800-NUM-REGN)             
                        OR WS-K895-EOF = 'Y'                                    
                END-IF                                                          
           WHEN 10                                                              
           WHEN 23                                                              
                DISPLAY 'BP13K895 RECORD NOT FOUND  = ' K895-KEY-FLD            
           WHEN OTHER                                                           
                DISPLAY 'ERROR START BP13K895, STATUS  '                        
                         BP13K895-STATUS                                        
                        ',  REGN ' K895-NUM-REGN-HIST                           
                MOVE BP13K895-STATUS            TO RETURN-CODE                  
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       7570-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7580-READNEXT-BP13K895.                                                  
      *-------------------------------------------------------------            
                                                                                
           READ BP13K895 NEXT RECORD.                                           
                                                                                
           EVALUATE BP13K895-STATUS                                             
           WHEN 00                                                              
           WHEN 02                                                              
                IF READ-FIANCE                                                  
                   IF K895-NUM-REGN-HIST = F800-NUM-REGN AND                    
                      K895-NUM-RELATIONSHIP = '09'                              
                      MOVE K895-NUM-NRIC-HIST    TO WS-NUM-NRIC-FIANCE          
                      MOVE K895-NME-OCCP         TO KH10-NME-APPLT              
                      MOVE 'Y'                   TO WS-K895-EOF                 
                   END-IF                                                       
                ELSE                                                            
                   IF K895-NUM-REGN-HIST = F800-NUM-REGN AND                    
                      K895-NUM-NRIC-HIST = WS-NUM-UIN                           
                      MOVE K895-NME-OCCP         TO KH10-NME-APPLT              
                      MOVE 'Y'                   TO WS-K895-EOF                 
                   END-IF                                                       
                END-IF                                                          
           WHEN 10                                                              
           WHEN 23                                                              
                MOVE 'Y'                         TO WS-K895-EOF                 
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K895, STATUS '                       
                        BP13K895-STATUS ',  REGN ' K895-NUM-REGN-HIST           
                MOVE BP13K895-STATUS          TO RETURN-CODE                    
                PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       7580-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7600-GET-ALLO-SCH.                                                       
      *-------------------------------------------------------------            
                                                                                
           SET WS-ALLOC-PTR TO 1.                                               
                                                                                
           SEARCH WS-ALLOC-SCH                                                  
              AT END MOVE 'XXX' TO WS-ALLOCSCH-TYPE                             
              WHEN F800-NUM-ALLO-SCHEME =                                       
                                WS-ALLOC-SCH-DESP(WS-ALLOC-PTR)                 
              MOVE WS-MAIN-SCH-CD(WS-ALLOC-PTR) TO                              
                                      WS-ALLOCSCH-TYPE.                         
                                                                                
       7600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7700-POPULATE-HEADER.                                                    
      *-------------------------------------------------------------            
                                                                                
      ***   BP139545 BP13015530 STARTS BY JM23                                  
           MOVE 'N'            TO WS-EXTEND-DEBAR                               
      ***   BP139545 BP13015530 ENDS   BY JM23                                  
                                                                                
           PERFORM 7710-READ-BP13KH10      THRU 7710-EXIT.                      
           IF F800-DTE-BALLOT < '201307'                                        
              PERFORM 7701-POLICY-BEFORE-2013 THRU 7701-EXIT                    
           ELSE                                                                 
              PERFORM 7702-POLICY-AFTER-2013 THRU 7702-EXIT                     
           END-IF.                                                              
                                                                                
           PERFORM 7720-GET-APLT-NAME      THRU 7720-EXIT.                      
                                                                                
           IF KH10-DTE-DEBAR-EXPIRY-FT-HH = 'CCYYMMDD' OR ZEROES OR             
                                         LOW-VALUES                             
              MOVE SPACES                TO KH10-DTE-DEBAR-EXPIRY-FT-HH         
           END-IF.                                                              
                                                                                
           IF KH10-DTE-DEBAR-EXPIRY-FT-HG = 'CCYYMMDD' OR ZEROES OR             
                                         LOW-VALUES                             
              MOVE SPACES                TO KH10-DTE-DEBAR-EXPIRY-FT-HG         
           END-IF.                                                              
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
           IF KH10-DTE-DEBAR-EXPIRY-FTPMC = 'CCYYMMDD' OR ZEROES OR             
                                         LOW-VALUES                             
              MOVE SPACES                TO KH10-DTE-DEBAR-EXPIRY-FTPMC         
           END-IF.                                                              
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
      ***   BP139545 BP13015530 STARTS BY JM23 ***                              
                                                                                
      *    IF (WS-NUM-2-DIGIT-YES-FT       =  02  AND                           
      *        KH10-DTE-DEBAR-EXPIRY-FT-HH =  SPACES)                           
      *       PERFORM 7730-COMPUTE-DEB-EXP-FT02 THRU 7750-EXIT                  
      *    END-IF.                                                              
      *                                                                         
      *    IF (WS-NUM-2-DIGIT-YES-FT       =  04  AND                           
      *        KH10-DTE-DEBAR-EXPIRY-FT-HG =  SPACES)                           
      *       PERFORM 7760-COMPUTE-DEB-EXP-FT04 THRU 7760-EXIT                  
      *    END-IF.                                                              
      *                                                                         
      *    IF (WS-NUM-2-DIGIT-YES-ST    =  02  AND                              
      *        KH10-DTE-DEBAR-EXPIRY-ST =  SPACES)                              
      *       PERFORM 7740-COMPUTE-DEB-EXP-ST   THRU 7750-EXIT                  
      *    END-IF.                                                              
      *                                                                         
      *    IF (WS-NUM-2-DIGIT-YES-FTS    =  02  AND                             
      *        KH10-DTE-DEBAR-EXPIRY-FTS =  SPACES)                             
      *       PERFORM 7750-COMPUTE-DEB-EXP-FTS  THRU 7750-EXIT                  
      *    END-IF.                                                              
      *                                                                         
      ***   BP139545 STARTS BY JM23   ***                                       
      *    IF (WS-NUM-2-DIGIT-YES-FTPMC  =  01  AND                             
      *        KH10-DTE-DEBAR-EXPIRY-FTPMC = SPACES)                            
      *       PERFORM 7770-COMPUTE-DEB-EXP-FTPMC THRU 7770-EXIT                 
      *    END-IF.                                                              
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
           IF F800-DTE-BALLOT >= '202310'                                       
              PERFORM 7780-DET-NS-DATES-202310 THRU 7780-EXIT                   
           ELSE                                                                 
              IF (WS-NUM-2-DIGIT-YES-FT = 02  AND                               
                  KH10-DTE-DEBAR-EXPIRY-FT-HH =  SPACES)                        
      *           PERFORM 7730-COMPUTE-DEB-EXP-FT02 THRU 7750-EXIT              
                  PERFORM 7730-COMPUTE-DEB-EXP-FT02 THRU 7730-EXIT              
              END-IF                                                            
                                                                                
              IF (WS-NUM-2-DIGIT-YES-FT       =  04  AND                        
                 KH10-DTE-DEBAR-EXPIRY-FT-HG =  SPACES)                         
                 PERFORM 7760-COMPUTE-DEB-EXP-FT04 THRU 7760-EXIT               
              END-IF                                                            
                                                                                
              IF (WS-NUM-2-DIGIT-YES-ST    =  02  AND                           
                 KH10-DTE-DEBAR-EXPIRY-ST =  SPACES)                            
      *          PERFORM 7740-COMPUTE-DEB-EXP-ST   THRU 7750-EXIT               
                 PERFORM 7740-COMPUTE-DEB-EXP-ST   THRU 7740-EXIT               
              END-IF                                                            
                                                                                
              IF (WS-NUM-2-DIGIT-YES-FTS    =  02  AND                          
                 KH10-DTE-DEBAR-EXPIRY-FTS =  SPACES)                           
                 PERFORM 7750-COMPUTE-DEB-EXP-FTS  THRU 7750-EXIT               
              END-IF                                                            
           END-IF.                                                              
      ***   BP139545 BP13015530 ENDS BY JM23   ***                              
                                                                                
       7700-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7701-POLICY-BEFORE-2013.                                                 
                                                                                
           IF FH15-NUM-WITHIN-LIMIT  =  'Y'                                     
              IF (WS-CDE-B-HH = 'H' OR 'T') OR                                  
                 F800-NUM-FT2T = 'Y'                                            
                 MOVE KH10-NUM-NON-SELN-FT   TO WS-TEMP-2-DIGIT-YES-FT          
                 ADD   1                     TO WS-NUM-2-DIGIT-YES-FT           
                 MOVE WS-TEMP-2-DIGIT-YES-FT TO KH10-NUM-NON-SELN-FT            
              END-IF                                                            
           ELSE                                                                 
              IF (WS-CDE-B-HH = 'H' OR 'T')                                     
                   MOVE KH10-NUM-NOTBK-WAIVE-FT TO WS-TEMP-2-DIGIT-NO-FT        
                   ADD   1                    TO WS-NUM-2-DIGIT-NO-FT           
                   MOVE WS-TEMP-2-DIGIT-NO-FT TO KH10-NUM-NOTBK-WAIVE-FT        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7701-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7702-POLICY-AFTER-2013.                                                  
                                                                                
           IF FH15-NUM-WITHIN-LIMIT  =  'Y'                                     
              IF ((F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                    
                 ((F800-NUM-ALLO-SCHEME = 'SAP') AND                            
                 (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR             
                                         'SSE' OR 'JSE' OR 'NSE'))              
              OR (F800-NUM-ALLO-SCHEME = 'PA ' AND                              
                  F800-NUM-ELIG-SCHEME = 'PAC'))                                
                 MOVE KH10-NUM-NON-SELN-FTS   TO WS-TEMP-2-DIGIT-YES-FTS        
                 ADD   1                      TO WS-NUM-2-DIGIT-YES-FTS         
                 MOVE WS-TEMP-2-DIGIT-YES-FTS TO KH10-NUM-NON-SELN-FTS          
              ELSE                                                              
                IF (WS-CDE-HH = 'H' OR 'T') OR                                  
                   F800-NUM-FT2T = 'Y'                                          
      ***   BP139545 STARTS BY JM23   ***                                       
                   IF F800-DTE-BALLOT >= '202310'                               
                      IF F800-NUM-FTPMC NOT = 'N' AND SPACE                     
                         MOVE KH10-NUM-NON-SELN-FTPMC   TO                      
                                          WS-TEMP-2-DIGIT-YES-FTPMC             
                         ADD 1 TO         WS-NUM-2-DIGIT-YES-FTPMC              
                         MOVE WS-TEMP-2-DIGIT-YES-FTPMC TO                      
                                          KH10-NUM-NON-SELN-FTPMC               
                      ELSE                                                      
                         MOVE KH10-NUM-NON-SELN-FT      TO                      
                                          WS-TEMP-2-DIGIT-YES-FT                
                         ADD 1 TO         WS-NUM-2-DIGIT-YES-FT                 
                         MOVE WS-TEMP-2-DIGIT-YES-FT    TO                      
                                          KH10-NUM-NON-SELN-FT                  
                      END-IF                                                    
                   ELSE                                                         
                      MOVE KH10-NUM-NON-SELN-FT         TO                      
                                          WS-TEMP-2-DIGIT-YES-FT                
                      ADD   1          TO WS-NUM-2-DIGIT-YES-FT                 
                      MOVE WS-TEMP-2-DIGIT-YES-FT       TO                      
                                          KH10-NUM-NON-SELN-FT                  
                   END-IF                                                       
      ***   BP139545 ENDS   BY JM23   ***                                       
                ELSE                                                            
                   MOVE KH10-NUM-NON-SELN-ST   TO WS-TEMP-2-DIGIT-YES-ST        
                   ADD   1                     TO WS-NUM-2-DIGIT-YES-ST         
                   MOVE WS-TEMP-2-DIGIT-YES-ST TO KH10-NUM-NON-SELN-ST          
                END-IF                                                          
              END-IF                                                            
           ELSE                                                                 
              IF ((F800-NUM-ALLO-SCHEME = 'FTS' OR 'STS') OR                    
                 ((F800-NUM-ALLO-SCHEME = 'SAP') AND                            
                 (F800-NUM-ELIG-SCHEME = 'SSC' OR 'JSS' OR 'NCS' OR             
                                         'SSE' OR 'JSE' OR 'NSE'))              
              OR (F800-NUM-ALLO-SCHEME = 'PA ' AND                              
                  F800-NUM-ELIG-SCHEME = 'PAC'))                                
                 MOVE KH10-NUM-NOTBK-WAIVE-FTS TO WS-TEMP-2-DIGIT-NO-FTS        
                 ADD   1                     TO WS-NUM-2-DIGIT-NO-FTS           
                 MOVE WS-TEMP-2-DIGIT-NO-FTS TO KH10-NUM-NOTBK-WAIVE-FTS        
              ELSE                                                              
                  IF (WS-CDE-HH = 'H' OR 'T') OR                                
                      F800-NUM-FT2T = 'Y'                                       
      ***   BP139545 STARTS BY JM23   ***                                       
                     IF F800-DTE-BALLOT >= '202310'                             
                        IF F800-NUM-FTPMC NOT = 'N' AND SPACE                   
                           MOVE KH10-NUM-NON-SELN-FTPMC  TO                     
                                          WS-TEMP-2-DIGIT-NO-FTPMC              
                           ADD 1 TO       WS-NUM-2-DIGIT-NO-FTPMC               
                           MOVE WS-TEMP-2-DIGIT-NO-FTPMC TO                     
                                          KH10-NUM-NON-SELN-FTPMC               
                        ELSE                                                    
                           MOVE KH10-NUM-NOTBK-WAIVE-FT  TO                     
                                          WS-TEMP-2-DIGIT-NO-FT                 
                           ADD 1 TO       WS-NUM-2-DIGIT-NO-FT                  
                           MOVE WS-TEMP-2-DIGIT-NO-FT    TO                     
                                          KH10-NUM-NOTBK-WAIVE-FT               
                        END-IF                                                  
                     ELSE                                                       
                        MOVE KH10-NUM-NOTBK-WAIVE-FT TO                         
                                          WS-TEMP-2-DIGIT-NO-FT                 
                        ADD 1          TO WS-NUM-2-DIGIT-NO-FT                  
                        MOVE WS-TEMP-2-DIGIT-NO-FT  TO                          
                                          KH10-NUM-NOTBK-WAIVE-FT               
                     END-IF                                                     
      ***   BP139545 ENDS   BY JM23   ***                                       
                 ELSE                                                           
                   MOVE KH10-NUM-NOTBK-WAIVE-ST TO WS-TEMP-2-DIGIT-NO-ST        
                   ADD   1                    TO WS-NUM-2-DIGIT-NO-ST           
                   MOVE WS-TEMP-2-DIGIT-NO-ST TO KH10-NUM-NOTBK-WAIVE-ST        
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7702-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7710-READ-BP13KH10.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                       TO BP13KH10-REC                    
           INITIALIZE                           BP13KH10-REC                    
                                                                                
           MOVE WS-NUM-UIN                   TO KH10-NUM-UIN.                   
                                                                                
           READ BP13KH10 KEY IS KH10-KEY-FLD.                                   
                                                                                
           EVALUATE BP13KH10-STATUS                                             
           WHEN 00                                                              
                MOVE 'Y'                     TO WS-KH10-FND                     
           WHEN 23                                                              
                MOVE 'N'                     TO WS-KH10-FND                     
                MOVE ZEROES                  TO KH10-NUM-NON-SELN-FT            
                                                KH10-NUM-NON-SELN-ST            
                                                KH10-NUM-NON-SELN-FTS           
                                                KH10-NUM-NOTBK-WAIVE-FT         
                                                KH10-NUM-NOTBK-WAIVE-ST         
                                                KH10-NUM-NOTBK-WAIVE-FTS        
      ***   BP139545 STARTS BY JM23   ***                                       
                                             KH10-NUM-NON-SELN-FTPMC            
                                             KH10-NUM-NOTBK-WAIVE-FTPMC         
      ***   BP139545 ENDS   BY JM23   ***                                       
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13KH10, STATUS  '                      
                         BP13KH10-STATUS ',  NRIC ' KH10-NUM-UIN                
                MOVE BP13KH10-STATUS         TO RETURN-CODE                     
                PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
           IF KH10-NUM-NON-SELN-FTS NOT NUMERIC                                 
              MOVE ZEROES           TO  KH10-NUM-NON-SELN-FTS                   
           END-IF.                                                              
           IF KH10-NUM-NON-SELN-FT NOT NUMERIC                                  
             MOVE ZEROES          TO  KH10-NUM-NON-SELN-FT                      
           END-IF.                                                              
           IF KH10-NUM-NON-SELN-ST NOT NUMERIC                                  
              MOVE ZEROES          TO  KH10-NUM-NON-SELN-ST                     
           END-IF.                                                              
           IF KH10-NUM-NOTBK-WAIVE-FTS  NOT NUMERIC                             
              MOVE ZEROES              TO KH10-NUM-NOTBK-WAIVE-FTS              
           END-IF.                                                              
           IF KH10-NUM-NOTBK-WAIVE-FT   NOT NUMERIC                             
              MOVE ZEROES             TO KH10-NUM-NOTBK-WAIVE-FT                
           END-IF.                                                              
           IF KH10-NUM-NOTBK-WAIVE-ST   NOT NUMERIC                             
              MOVE ZEROES             TO KH10-NUM-NOTBK-WAIVE-ST                
           END-IF.                                                              
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
           IF KH10-NUM-NON-SELN-FTPMC NOT NUMERIC                               
              MOVE ZEROES             TO  KH10-NUM-NON-SELN-FTPMC               
           END-IF.                                                              
                                                                                
           IF KH10-NUM-NOTBK-WAIVE-FTPMC NOT NUMERIC                            
              MOVE ZEROES             TO KH10-NUM-NOTBK-WAIVE-FTPMC             
           END-IF.                                                              
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
       7710-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7720-GET-APLT-NAME.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                               TO BP13K820-REC.           
           INITIALIZE                                   BP13K820-REC.           
                                                                                
           MOVE F800-NUM-REGN                        TO K820-NUM-REGN.          
           MOVE KH10-NUM-UIN                         TO K820-NUM-NRIC.          
           MOVE 'N'                                  TO WS-K820-FOUND.          
                                                                                
           READ BP13K820.                                                       
                                                                                
           EVALUATE BP13K820-STATUS                                             
              WHEN 00                                                           
                   MOVE 'Y'                          TO WS-K820-FOUND           
                   MOVE K820-NME-OCCP                TO KH10-NME-APPLT          
              WHEN 23                                                           
                   IF READ-SPOUSE                                               
                      PERFORM 7570-BROWSE-BP13K895   THRU 7570-EXIT             
                   END-IF                                                       
              WHEN OTHER                                                        
                   DISPLAY 'ERROR READING BP13K820, STAT = '                    
                   BP13K820-STATUS  ', K820-KEY-FLD = ' K820-KEY-FLD            
                   MOVE BP13K820-STATUS        TO RETURN-CODE                   
                   PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       7720-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7730-COMPUTE-DEB-EXP-FT02.                                               
      *-------------------------------------------------------------            
                                                                                
           IF FH15-DTE-BK-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES          
                                             AND 'CCYYMMDD'                     
              MOVE FH15-DTE-BK-APPMT    TO KH10-DTE-DEBAR-FT-HH                 
                                           WS-CURRENT-DATE1                     
           ELSE                                                                 
              MOVE WS-CURRENT-DATE      TO KH10-DTE-DEBAR-FT-HH                 
                                           WS-CURRENT-DATE1                     
           END-IF.                                                              
                                                                                
           ADD 1                        TO WS-DTE-DEB-EXP-YR.                   
           SUBTRACT 1                 FROM WS-DTE-DEB-EXP-MM.                   
                                                                                
           IF WS-DTE-DEB-EXP-MM = 0                                             
              MOVE 12                   TO WS-DTE-DEB-EXP-MM                    
              SUBTRACT 1              FROM WS-DTE-DEB-EXP-YR                    
           END-IF.                                                              
                                                                                
           IF WS-DTE-DEB-EXP-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12             
              MOVE 31                   TO WS-DTE-DEB-EXP-DD                    
           ELSE                                                                 
              IF WS-DTE-DEB-EXP-MM = 4 OR 6 OR 9 OR 11                          
                 MOVE 30                TO WS-DTE-DEB-EXP-DD                    
              ELSE                                                              
                 DIVIDE WS-DTE-DEB-EXP-YR BY 4 GIVING  WS-QUOTIENT              
                                             REMAINDER WS-REMAINDER             
                 IF WS-REMAINDER = 0                                            
                    MOVE 29             TO WS-DTE-DEB-EXP-DD                    
                 ELSE                                                           
                    MOVE 28             TO WS-DTE-DEB-EXP-DD.                   
                                                                                
           MOVE WS-CURRENT-DATE1        TO KH10-DTE-DEBAR-EXPIRY-FT-HH.         
                                                                                
       7730-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7740-COMPUTE-DEB-EXP-ST.                                                 
                                                                                
           MOVE WS-CURRENT-DATE         TO KH10-DTE-DEBAR-ST                    
                                           WS-CURRENT-DATE1.                    
           ADD 1                        TO WS-DTE-DEB-EXP-YR.                   
           SUBTRACT 1                 FROM WS-DTE-DEB-EXP-MM.                   
                                                                                
           IF WS-DTE-DEB-EXP-MM = 0                                             
              MOVE 12 TO WS-DTE-DEB-EXP-MM                                      
              SUBTRACT 1 FROM WS-DTE-DEB-EXP-YR                                 
           END-IF.                                                              
                                                                                
           IF WS-DTE-DEB-EXP-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12             
              MOVE 31                   TO WS-DTE-DEB-EXP-DD                    
           ELSE                                                                 
              IF WS-DTE-DEB-EXP-MM = 4 OR 6 OR 9 OR 11                          
                 MOVE 30                TO WS-DTE-DEB-EXP-DD                    
              ELSE                                                              
                 DIVIDE WS-DTE-DEB-EXP-YR BY 4 GIVING  WS-QUOTIENT              
                                             REMAINDER WS-REMAINDER             
                 IF WS-REMAINDER = 0                                            
                    MOVE 29             TO WS-DTE-DEB-EXP-DD                    
                 ELSE                                                           
                    MOVE 28             TO WS-DTE-DEB-EXP-DD.                   
           MOVE WS-CURRENT-DATE1        TO KH10-DTE-DEBAR-EXPIRY-ST.            
       7740-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7750-COMPUTE-DEB-EXP-FTS.                                                
                                                                                
           MOVE WS-CURRENT-DATE         TO KH10-DTE-DEBAR-FTS                   
                                           WS-CURRENT-DATE1.                    
           ADD 1                        TO WS-DTE-DEB-EXP-YR.                   
           SUBTRACT 1                 FROM WS-DTE-DEB-EXP-MM.                   
                                                                                
           IF WS-DTE-DEB-EXP-MM = 0                                             
              MOVE 12 TO WS-DTE-DEB-EXP-MM                                      
              SUBTRACT 1 FROM WS-DTE-DEB-EXP-YR                                 
           END-IF.                                                              
                                                                                
           IF WS-DTE-DEB-EXP-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12             
              MOVE 31                   TO WS-DTE-DEB-EXP-DD                    
           ELSE                                                                 
              IF WS-DTE-DEB-EXP-MM = 4 OR 6 OR 9 OR 11                          
                 MOVE 30                TO WS-DTE-DEB-EXP-DD                    
              ELSE                                                              
                 DIVIDE WS-DTE-DEB-EXP-YR BY 4 GIVING  WS-QUOTIENT              
                                             REMAINDER WS-REMAINDER             
                 IF WS-REMAINDER = 0                                            
                    MOVE 29             TO WS-DTE-DEB-EXP-DD                    
                 ELSE                                                           
                    MOVE 28             TO WS-DTE-DEB-EXP-DD.                   
           MOVE WS-CURRENT-DATE1        TO KH10-DTE-DEBAR-EXPIRY-FTS.           
                                                                                
       7750-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7760-COMPUTE-DEB-EXP-FT04.                                               
                                                                                
           MOVE WS-CURRENT-DATE         TO KH10-DTE-DEBAR-FT-HG                 
                                           WS-CURRENT-DATE1.                    
           ADD 1                        TO WS-DTE-DEB-EXP-YR.                   
           SUBTRACT 1                 FROM WS-DTE-DEB-EXP-MM.                   
                                                                                
           IF WS-DTE-DEB-EXP-MM = 0                                             
              MOVE 12 TO WS-DTE-DEB-EXP-MM                                      
              SUBTRACT 1 FROM WS-DTE-DEB-EXP-YR                                 
           END-IF.                                                              
                                                                                
           IF WS-DTE-DEB-EXP-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12             
              MOVE 31                   TO WS-DTE-DEB-EXP-DD                    
           ELSE                                                                 
              IF WS-DTE-DEB-EXP-MM = 4 OR 6 OR 9 OR 11                          
                 MOVE 30                TO WS-DTE-DEB-EXP-DD                    
              ELSE                                                              
                 DIVIDE WS-DTE-DEB-EXP-YR BY 4 GIVING  WS-QUOTIENT              
                                             REMAINDER WS-REMAINDER             
                 IF WS-REMAINDER = 0                                            
                    MOVE 29             TO WS-DTE-DEB-EXP-DD                    
                 ELSE                                                           
                    MOVE 28             TO WS-DTE-DEB-EXP-DD.                   
           MOVE WS-CURRENT-DATE1        TO KH10-DTE-DEBAR-EXPIRY-FT-HG.         
       7760-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
      *-------------------------------------------------------------            
       7770-COMPUTE-DEB-EXP-FTPMC.                                              
      *-------------------------------------------------------------            
           MOVE WS-CURRENT-DATE         TO KH10-DTE-DEBAR-FTPMC                 
                                           WS-CURRENT-DATE1.                    
           ADD 1                        TO WS-DTE-DEB-EXP-YR.                   
           SUBTRACT 1                 FROM WS-DTE-DEB-EXP-MM.                   
                                                                                
           IF WS-DTE-DEB-EXP-MM = 0                                             
              MOVE 12                   TO WS-DTE-DEB-EXP-MM                    
              SUBTRACT 1              FROM WS-DTE-DEB-EXP-YR                    
           END-IF.                                                              
                                                                                
           IF WS-DTE-DEB-EXP-MM = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12             
              MOVE 31                   TO WS-DTE-DEB-EXP-DD                    
           ELSE                                                                 
              IF WS-DTE-DEB-EXP-MM = 4 OR 6 OR 9 OR 11                          
                 MOVE 30                TO WS-DTE-DEB-EXP-DD                    
              ELSE                                                              
                 DIVIDE WS-DTE-DEB-EXP-YR BY 4 GIVING  WS-QUOTIENT              
                                             REMAINDER WS-REMAINDER             
                 IF WS-REMAINDER = 0                                            
                    MOVE 29             TO WS-DTE-DEB-EXP-DD                    
                 ELSE                                                           
                    MOVE 28             TO WS-DTE-DEB-EXP-DD.                   
           MOVE WS-CURRENT-DATE1        TO KH10-DTE-DEBAR-EXPIRY-FTPMC.         
           .                                                                    
       7770-EXIT.                                                               
           EXIT.                                                                
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
      ***   BP139545 BP13015530 STARTS BY JM23 ***                              
      *-------------------------------------------------------------            
       7780-DET-NS-DATES-202310.                                                
      *-------------------------------------------------------------            
           IF (WS-NUM-2-DIGIT-YES-FTPMC > 00  AND                               
              KH10-DTE-DEBAR-EXPIRY-FTPMC = SPACES)                             
              PERFORM 7770-COMPUTE-DEB-EXP-FTPMC THRU 7770-EXIT                 
           END-IF                                                               
                                                                                
           IF WS-NUM-2-DIGIT-YES-FT = 01                                        
              IF (WS-CDE-B-HH = 'H' AND                                         
                 KH10-DTE-DEBAR-EXPIRY-FT-HH =  SPACES)                         
                 PERFORM 7730-COMPUTE-DEB-EXP-FT02 THRU 7730-EXIT               
              END-IF                                                            
                                                                                
              IF WS-CDE-B-HH = 'G'                                              
                 PERFORM 7760-COMPUTE-DEB-EXP-FT04 THRU 7760-EXIT               
                 MOVE 'Y'             TO WS-EXTEND-DEBAR                        
              END-IF                                                            
           END-IF                                                               
                                                                                
           IF WS-NUM-2-DIGIT-YES-FT > 01                                        
              IF WS-CDE-B-HH = 'H'                                              
                 PERFORM 7730-COMPUTE-DEB-EXP-FT02 THRU 7730-EXIT               
                 IF WS-NUM-2-DIGIT-YES-FT > 02                                  
                    MOVE 'Y'             TO WS-EXTEND-DEBAR                     
                 END-IF                                                         
              END-IF                                                            
                                                                                
              IF WS-CDE-B-HH = 'G'                                              
                 PERFORM 7760-COMPUTE-DEB-EXP-FT04 THRU 7760-EXIT               
                 MOVE 'Y'             TO WS-EXTEND-DEBAR                        
              END-IF                                                            
           END-IF                                                               
                                                                                
           IF (WS-NUM-2-DIGIT-YES-ST > 00 AND                                   
              KH10-DTE-DEBAR-EXPIRY-ST =  SPACES)                               
              PERFORM 7740-COMPUTE-DEB-EXP-ST   THRU 7740-EXIT                  
           END-IF                                                               
                                                                                
           IF (WS-NUM-2-DIGIT-YES-FTS > 00 AND                                  
              KH10-DTE-DEBAR-EXPIRY-FTS =  SPACES)                              
              PERFORM 7750-COMPUTE-DEB-EXP-FTS  THRU 7750-EXIT                  
           END-IF                                                               
           .                                                                    
       7780-EXIT.                                                               
           EXIT.                                                                
      ***   BP139545 BP13015530 ENDS BY JM23   ***                              
                                                                                
      *-------------------------------------------------------------            
       7800-POPULATE-DETAIL.                                                    
      *-------------------------------------------------------------            
                                                                                
           MOVE 'N'                          TO WS-END-OF-TABLE.                
           PERFORM VARYING WS-SUB FROM 1 BY 1 UNTIL END-OF-TABLE                
              IF KH10-NUM-REGN (WS-SUB) = SPACES OR  LOW-VALUES                 
                 SET END-OF-TABLE      TO TRUE                                  
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
           SUBTRACT 1                FROM WS-SUB.                               
                                                                                
           MOVE F800-NUM-REGN          TO KH10-NUM-REGN(WS-SUB).                
           MOVE F800-DTE-BALLOT        TO KH10-DTE-BALLOT(WS-SUB).              
           MOVE F800-NUM-ALLO-CAT      TO KH10-NUM-ALLO-CAT(WS-SUB).            
           MOVE F800-NUM-NEW-TOWN      TO KH10-NUM-NT(WS-SUB).                  
           MOVE F800-NUM-FLAT-TYPE     TO KH10-NUM-FT(WS-SUB).                  
           MOVE F800-NUM-CAT           TO KH10-NUM-CATEGORY(WS-SUB).            
           MOVE F800-NUM-HOUSEHOLD     TO KH10-NUM-HOUSEHOLD(WS-SUB).           
           MOVE F800-CDE-BALLOT-HOUSEHOLD                                       
                                  TO KH10-NUM-BALLOT-HOUSEHOLD(WS-SUB).         
           MOVE F800-NUM-FT2T          TO KH10-NUM-FT2T(WS-SUB).                
           MOVE F800-NUM-BALLOT-STATUS TO KH10-NUM-RESULT(WS-SUB).              
           MOVE F800-NUM-NT-FT-QUEUE   TO KH10-NUM-QUEUE(WS-SUB).               
           MOVE F800-NUM-NRIC1         TO KH10-NUM-NRIC1(WS-SUB).               
           MOVE F800-NUM-NRIC2         TO KH10-NUM-NRIC2(WS-SUB).               
           MOVE F800-NUM-NRIC3         TO KH10-NUM-NRIC3(WS-SUB).               
           MOVE F800-NUM-NRIC4         TO KH10-NUM-NRIC4(WS-SUB).               
                                                                                
           IF FH15-DTE-BK-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES          
                                             AND 'CCYYMMDD'                     
              MOVE FH15-DTE-BK-APPMT   TO KH10-DTE-APPT(WS-SUB)                 
              MOVE FH15-TME-BK-APPMT   TO KH10-TME-APPT(WS-SUB)                 
           ELSE                                                                 
              MOVE WS-CURRENT-DATE     TO KH10-DTE-APPT(WS-SUB)                 
              MOVE WS-CURRENT-TIME     TO KH10-TME-APPT(WS-SUB)                 
           END-IF.                                                              
                                                                                
           IF FH15-NUM-UNIT-AVAIL1 NOT NUMERIC                                  
              MOVE ZEROES              TO FH15-NUM-UNIT-AVAIL1                  
           END-IF.                                                              
                                                                                
           IF FH15-NUM-UNIT-AVAIL2 NOT NUMERIC                                  
              MOVE ZEROES              TO FH15-NUM-UNIT-AVAIL2                  
           END-IF.                                                              
                                                                                
           IF FH15-NUM-UNIT-AVAIL3 NOT NUMERIC                                  
              MOVE ZEROES              TO FH15-NUM-UNIT-AVAIL3                  
           END-IF.                                                              
                                                                                
           IF FH15-NUM-QUOTA-AVAIL1 NOT NUMERIC                                 
              MOVE ZEROES              TO FH15-NUM-QUOTA-AVAIL1                 
           END-IF.                                                              
                                                                                
           IF FH15-NUM-QUOTA-AVAIL2 NOT NUMERIC                                 
              MOVE ZEROES              TO FH15-NUM-QUOTA-AVAIL2                 
           END-IF.                                                              
                                                                                
           IF FH15-NUM-QUOTA-AVAIL3 NOT NUMERIC                                 
              MOVE ZEROES              TO FH15-NUM-QUOTA-AVAIL3                 
           END-IF.                                                              
                                                                                
           EVALUATE F800-NUM-CAT                                                
           WHEN '1'                                                             
              MOVE FH15-NUM-UNIT-AVAIL1  TO WS-NUM-UNIT-AVAIL                   
              MOVE FH15-NUM-QUOTA-AVAIL1 TO WS-NUM-QUOTA-AVAIL                  
           WHEN '2'                                                             
              MOVE FH15-NUM-UNIT-AVAIL2  TO WS-NUM-UNIT-AVAIL                   
              MOVE FH15-NUM-QUOTA-AVAIL2 TO WS-NUM-QUOTA-AVAIL                  
           WHEN '3'                                                             
              MOVE FH15-NUM-UNIT-AVAIL3  TO WS-NUM-UNIT-AVAIL                   
              MOVE FH15-NUM-QUOTA-AVAIL3 TO WS-NUM-QUOTA-AVAIL                  
           END-EVALUATE                                                         
                                                                                
           MOVE FH15-NUM-WITHIN-LIMIT  TO KH10-NUM-WITHIN-LIMIT(WS-SUB).        
           MOVE WS-NUM-UNIT-AVAIL      TO KH10-NUM-UNIT-AVAIL(WS-SUB).          
           MOVE WS-NUM-QUOTA-AVAIL     TO KH10-NUM-FLAT-QUOTA(WS-SUB).          
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
           MOVE F800-NUM-FTPMC         TO KH10-NUM-FTPMC(WS-SUB).               
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
      ***   BP139545 BP13015530 STARTS BY JM23                                  
           IF WS-EXTEND-DEBAR = 'Y'                                             
              MOVE 'Y'           TO KH10-NUM-EXTEND-DEBAR-DATE(WS-SUB)          
           END-IF.                                                              
      ***   BP139545 BP13015530 ENDS   BY JM23                                  
                                                                                
       7800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7900-UPDATE-BP13KH10.                                                    
      *-------------------------------------------------------------            
                                                                                
           MOVE WS-CURRENT-DATE              TO KH10-DTE-UPDATE.                
           MOVE WS-CURRENT-TIME              TO KH10-TME-UPDATE.                
                                                                                
           REWRITE BP13KH10-REC.                                                
                                                                                
           EVALUATE BP13KH10-STATUS                                             
           WHEN 00                                                              
               ADD   1                       TO WS-KH10-UPD                     
           WHEN 23                                                              
               PERFORM 7910-WRITE-BP13KH10 THRU 7910-EXIT                       
           WHEN OTHER                                                           
               DISPLAY "BP13KH10 REWRITE ERROR STATUS " BP13KH10-STATUS         
                                  " KEY IS " KH10-NUM-UIN                       
               MOVE BP13KH10-STATUS          TO RETURN-CODE                     
               PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       7900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7910-WRITE-BP13KH10.                                                     
      *-------------------------------------------------------------            
                                                                                
           WRITE BP13KH10-REC.                                                  
                                                                                
           EVALUATE BP13KH10-STATUS                                             
           WHEN 00                                                              
              DISPLAY 'RECORD WRITTEN TO KH10: ' KH10-NUM-UIN                   
              ADD 1                         TO WS-KH10-WRITE                    
           WHEN OTHER                                                           
              DISPLAY 'WRITE ERROR, BP13KH10 STATUS : ' BP13KH10-STATUS         
                      ' KEY : ' KH10-KEY-FLD                                    
              MOVE BP13KH10-STATUS          TO RETURN-CODE                      
              PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       7910-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       8000-PRINT-REPORT.                                                       
      *-------------------------------------------------------------            
                                                                                
           PERFORM 8100-MOVE-FIELDS                THRU 8100-EXIT.              
                                                                                
           ADD 1                                     TO WS-SNO.                 
           MOVE WS-SNO                               TO CH16-SN.                
           PERFORM  8200-CHECK-WRITE-HEADER        THRU 8200-EXIT.              
                                                                                
           WRITE BP13LH16-REC                      FROM CH16-DETAIL01.          
           ADD 1                                     TO WS-LINE-CTR.            
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       8100-MOVE-FIELDS.                                                        
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO CH16-DETAIL01.                                        
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO CH16-DATE-HDR.                             
                                                                                
           MOVE F800-NUM-REGN                      TO CH16-REGN.                
           MOVE F800-NUM-ALLO-CAT                  TO CH16-ALLOC-CAT.           
           MOVE F800-DTE-BALLOT                    TO CH16-DTE-BALLOT.          
                                                                                
           MOVE F800-NUM-NEW-TOWN                  TO CH16-NT.                  
           MOVE F800-NUM-FLAT-TYPE                 TO CH16-FT.                  
           MOVE F800-NUM-CAT                       TO CH16-CAT.                 
                                                                                
           IF F800-DTE-BK-APPT NOT = SPACES AND LOW-VALUES AND ZEROES           
              STRING F800-DTE-BK-APPT(7:2) '/'                                  
                     F800-DTE-BK-APPT(5:2) '/'                                  
                     F800-DTE-BK-APPT(1:4)                                      
                 DELIMITED BY SIZE INTO CH16-BK-APPT                            
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-NT-FT-QUEUE             TO CH16-QUEUE-NO.              
           MOVE F800-NUM-ALLOC-TAG-PREV          TO CH16-ALLOC-PREV.            
           MOVE WS-K800-TAG-UPDATE               TO CH16-ALLOC-UPDATE.          
           MOVE WS-FH15-NUM-ALLOC-TAG            TO CH16-ALLOC-UPD.             
                                                                                
           MOVE WS-K595-TAG-PREV                 TO CH16-BOOK-PREV.             
           MOVE WS-K595-TAG-UPDATE               TO CH16-BOOK-UPD.              
                                                                                
           MOVE F800-NUM-HOUSEHOLD               TO CH16-NUM-HH.                
           MOVE F800-CDE-BALLOT-HOUSEHOLD        TO CH16-BAL-HH.                
                                                                                
           IF F800-DTE-CANCEL NOT = SPACES AND LOW-VALUES AND ZEROES            
              STRING F800-DTE-CANCEL(7:2) '/'                                   
                     F800-DTE-CANCEL(5:2) '/'                                   
                     F800-DTE-CANCEL(1:4)                                       
                 DELIMITED BY SIZE INTO CH16-DATE-CANCEL                        
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-CANCEL-REASON           TO CH16-REASON.                
           MOVE WS-FH15-NUM-REGN                 TO CH16-REFER-REGN.            
           MOVE WS-FH15-NUM-QUEUE                TO CH16-REFER-QUEUE.           
           MOVE WS-NON-SEL1                      TO CH16-NON-SEL1.              
           MOVE WS-NON-SEL2                      TO CH16-NON-SEL2.              
           MOVE WS-NON-SEL3                      TO CH16-NON-SEL3.              
           MOVE WS-NON-SEL4                      TO CH16-NON-SEL4.              
                                                                                
      ***   BP139545 STARTS BY JM23   ***                                       
           MOVE F800-NUM-FTPMC                   TO CH16-FTPMC.                 
      ***   BP139545 ENDS   BY JM23   ***                                       
                                                                                
       8100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       8200-CHECK-WRITE-HEADER.                                                 
      ******************************************************************        
                                                                                
           IF (WS-LINE-CTR  >  WS-MAX-LINE) OR (WS-SNO = 1)                     
              PERFORM 8300-PRINT-HEADER      THRU 8300-EXIT                     
           END-IF.                                                              
                                                                                
       8200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       8300-PRINT-HEADER.                                                       
      ******************************************************************        
                                                                                
           ADD 1                               TO WS-PAGE-CTR.                  
           MOVE ZEROES                         TO CH16-PAGE-HDR.                
           MOVE WS-PAGE-CTR                    TO CH16-PAGE-HDR.                
                                                                                
           WRITE BP13LH16-REC    FROM CH16-HEADER01 AFTER PAGE.                 
           WRITE BP13LH16-REC    FROM CH16-HEADER02.                            
           WRITE BP13LH16-REC    FROM CH16-HEADER03 AFTER 2.                    
           WRITE BP13LH16-REC    FROM CH16-HEADER04.                            
                                                                                
           INITIALIZE WS-LINE-CTR.                                              
           MOVE 5  TO WS-LINE-CTR.                                              
                                                                                
       8300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
                                                                                
           DISPLAY ' BP13CH16 CONTROL TOTAL '.                                  
           DISPLAY '------------------------------------------'.                
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECS READ FROM F800    : ' WS-F800-READ.              
           DISPLAY 'NO OF RECS NOT FOUND F800    : ' WS-F800-NOTFD.             
           DISPLAY 'NO OF RECS READ FROM FH15    : ' WS-FH15-READ.              
           DISPLAY 'NO OF RECS NOT FOUND FH15    : ' WS-FH15-NOTFD.             
           DISPLAY 'NO OF RECS MATCHED           : ' WS-MATCHED.                
           DISPLAY 'NO OF RECS W/ NULL FH15 TAG  : ' WS-FH15-ALC-TAG.           
           DISPLAY ' '.                                                         
           DISPLAY 'NO OF RECS UPDATED BP13K800  : ' WS-K800-UPD.               
           DISPLAY 'NO OF RECS NO UPDATE TO K800 : ' WS-K800-NOUPD.             
           DISPLAY 'NO OF RECS NOT FOUND BP13K800: ' WS-K800-NOTFD.             
           DISPLAY 'NO OF RECS WRITTEN P13F800A  : ' WS-F800-WRITE.             
           DISPLAY ' '.                                                         
           DISPLAY 'NO OF RECS FOUND BP13K595    : ' WS-K595-FND.               
           DISPLAY 'NO OF RECS NOT FOUND BP13K595: ' WS-K595-NOTFD.             
           DISPLAY 'NO OF RECS UPDATED BP13K595  : ' WS-K595-UPDATE.            
           DISPLAY 'NO OF RECS NO UPDATE TO K595 : ' WS-K595-NOUPD.             
           DISPLAY ' '.                                                         
           DISPLAY 'NO OF RECS UPDATED BP13KH10  : ' WS-KH10-UPD.               
           DISPLAY 'NO OF RECS WRITTEN BP13KH10  : ' WS-KH10-WRITE.             
           DISPLAY ' '.                                                         
                                                                                
           CLOSE BP13F800                                                       
                 SY02F001                                                       
                 P13F800A                                                       
                 BP13K800                                                       
                 BP13K595                                                       
                 BP13FH15                                                       
                 BP13LH16                                                       
                 BP13K820                                                       
                 BP13K895                                                       
                 BP13KH10.                                                      
                                                                                
           IF WS-K800-STATUS  NOT = 00 AND 97                                   
              DISPLAY 'ERROR CLOSING - BP13K800 : ' WS-K800-STATUS              
              MOVE WS-K800-STATUS                TO RETURN-CODE                 
           END-IF.                                                              
                                                                                
           IF WS-K595-STATUS  NOT = 00 AND 97                                   
              DISPLAY 'ERROR CLOSING - BP13K595 : ' WS-K595-STATUS              
              MOVE WS-K595-STATUS                TO RETURN-CODE                 
           END-IF.                                                              
                                                                                
           IF BP13K820-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR CLOSING - BP13K820 : ' BP13K820-STATUS             
              MOVE     BP13K820-STATUS      TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF BP13K895-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR CLOSING - BP13K895 : ' BP13K895-STATUS             
              MOVE     BP13K895-STATUS      TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF BP13KH10-STATUS  NOT = 00 AND 97                                  
              DISPLAY 'ERROR CLOSING - BP13KH10 : ' BP13KH10-STATUS             
              MOVE     BP13KH10-STATUS      TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
