      ***************************                                       00010000
       IDENTIFICATION DIVISION.                                         00020000
      ***************************                                       00030000
       PROGRAM-ID.    BP13CA05.                                         00040000
      *AUTHOR.        ALWYN BENNY.                                      00050000
      *DATE-WRITTEN.  31-08-2011.                                       00060000
      ***************************************************************** 00070000
      * SYSTEM OF COMMITMENT  (BP13)                                  * 00080000
      ***************************************************************** 00090000
      *  OBJECTIVE   :  REPORT ON ACCEPTED AMR VOUCHER CASES          * 00100000
      *---------------------------------------------------------------* 00110000
      *  INPUT FILES : 1.  BP13F130 - BP13T.F130.AMR                  * 00120000
      *                                                               * 00130000
      *  OUPUT FILES : 1.  BP13F13A                                   * 00140000
      *                2.  BP13F13B                                   * 00150000
      *---------------------------------------------------------------* 00160000
      * CHANGE   BY    DATE      DESCRIPTION                          * 00170000
      * -------- ---- --------   -------------------------------------* 00180000
      * BP134355 AB9  31/08/2011 PRINT REPORT FOR STUDIO & AMR        * 00190000
      * BP134355 AB9  21/11/2011 CORECT THE ADDR DISPLAY ON THE REPORT* 00191000
      * BP135294 PCL4 09/06/2014 TO ADD NUM-CANCEL-REASON             * 00192000
      * BP136686 KVL1 06/03/2017 TO SHIFT 2F ROOM TYPE CASES IN       * 00200000
      *                          BP13K350 TO REPORT BP13F13B          * 00201000
      * BP136779 KVL1 02/06/2017 TO ADD LONG LEASE TENURE TO FILTER 2F* 00202000
      * BP137159 RJB1 30/01/2018 TO READ BP13K893 AFTER READING K410 &* 00203005
      *                          TO ADD MOVING OF FLAT TYPE AND LEASE * 00203105
      *                          TENURE FROM APPL HISTORY FILE        * 00204000
      ***************************************************************** 00210000
      *---------------------------------------------------------------* 00220000
       ENVIRONMENT DIVISION.                                            00230000
      *---------------------------------------------------------------* 00240000
       CONFIGURATION SECTION.                                           00250000
       SOURCE-COMPUTER. IBM-3090.                                       00260000
       OBJECT-COMPUTER. IBM-3090.                                       00270000
                                                                        00280000
       INPUT-OUTPUT SECTION.                                            00290000
       FILE-CONTROL.                                                    00300000
                                                                        00310000
           SELECT BP13K350 ASSIGN         TO BP13K350                   00311000
                           ACCESS MODE       IS RANDOM                  00312000
                           ORGANIZATION      IS INDEXED                 00313000
                           RECORD KEY        IS K350-KEY-FLD            00314000
                           FILE STATUS       IS BP13K350-STATUS.        00315000
                                                                        00316000
           SELECT BM06K110 ASSIGN TO BM06K110                           00317000
                           ACCESS MODE     IS RANDOM                    00318000
                           ORGANIZATION    IS INDEXED                   00319000
                           RECORD KEY      IS K110-KEY-FLD              00319100
                           ALTERNATE KEY   IS K110-REGN-NO              00319200
                           FILE STATUS     IS BM06K110-STATUS.          00319300
                                                                        00319400
           SELECT BM06K115 ASSIGN TO BM06K115                           00319500
                           ACCESS MODE     IS RANDOM                    00319600
                           ORGANIZATION    IS INDEXED                   00319700
                           RECORD KEY      IS K115-KEY-FLD              00319800
                           FILE STATUS     IS BM06K115-STATUS.          00320000
                                                                        00320100
           SELECT BM06K100  ASSIGN        TO BM06K100                   00320200
                            ACCESS MODE   IS RANDOM                     00320300
                            ORGANIZATION  IS INDEXED                    00320400
                            RECORD KEY    IS K100-KEY-FLD               00320500
                            FILE STATUS   IS BM06K100-STATUS.           00320600
                                                                        00320700
                                                                        00320800
           SELECT BP13K410  ASSIGN        TO BP13K410                   00320900
                            ACCESS MODE   IS RANDOM                     00321000
                            ORGANIZATION  IS INDEXED                    00321100
                            RECORD KEY    IS K410-NUM-REGN              00321200
                            FILE STATUS   IS BP13K410-STATUS.           00321300
                                                                        00321400
           SELECT BP13K800  ASSIGN        TO BP13K800                   00321500
                            ACCESS MODE   IS RANDOM                     00321600
                            ORGANIZATION  IS INDEXED                    00321700
                            RECORD KEY    IS K800-NUM-REGN              00321800
                            FILE STATUS   IS BP13K800-STATUS.           00321900
                                                                        00322000
           SELECT  BP13K893  ASSIGN        TO BP13K893                  00322100
                             ACCESS MODE   IS DYNAMIC                   00322200
                             ORGANIZATION  IS INDEXED                   00322300
                             RECORD KEY    IS K893-KEY-FLD              00322400
                             FILE STATUS   IS BP13K893-STATUS.          00322500
                                                                        00322600
           SELECT BP13F130 ASSIGN         TO BP13F130.                  00322700
           SELECT BP13F13A ASSIGN         TO BP13F13A.                  00322800
           SELECT BP13F13B ASSIGN         TO BP13F13B.                  00323000
                                                                        00360000
      *---------------------------------------------------------------* 00370000
       DATA DIVISION.                                                   00380000
      *---------------------------------------------------------------* 00390000
       FILE SECTION.                                                    00400000
                                                                        00410000
       FD BP13F130                                                      00420000
            RECORD CONTAINS  150  CHARACTERS                            00430000
            LABEL RECORD IS STANDARD                                    00440000
            RECORDING MODE IS F.                                        00450000
       COPY BP13F130.                                                   00460000
                                                                        00460100
       FD BP13F13A                                                      00461000
            RECORD CONTAINS  270  CHARACTERS                            00462000
            LABEL RECORD IS STANDARD                                    00463000
            RECORDING MODE IS F.                                        00464000
       COPY BP13F13A.                                                   00465000
                                                                        00465100
       FD BP13F13B                                                      00466000
            RECORD CONTAINS  270  CHARACTERS                            00467000
            LABEL RECORD IS STANDARD                                    00468000
            RECORDING MODE IS F.                                        00469000
       COPY BP13F13B.                                                   00469100
                                                                        00470000
       FD  BP13K350                                                     00480000
           RECORD CONTAINS 600 CHARACTERS.                              00490000
       COPY BP13K350.                                                   00500000
                                                                        00510000
       FD   BP13K410                                                    00511000
            RECORD CONTAINS 2000 CHARACTERS.                            00512000
       COPY BP13K410.                                                   00513000
                                                                        00514000
       FD  BM06K110                                                     00520000
           RECORD    CONTAINS 500  CHARACTERS.                          00530000
       COPY BM06K110.                                                   00540000
                                                                        00541000
       FD  BM06K115                                                     00542000
           RECORD    CONTAINS 500  CHARACTERS.                          00543000
       COPY BM06K115.                                                   00544000
                                                                        00550000
       FD  BM06K100                                                     00560000
           RECORD    CONTAINS 500  CHARACTERS.                          00570000
       COPY BM06K100.                                                   00580000
                                                                        00590000
       FD   BP13K800                                                    00600000
            RECORD CONTAINS 2000 CHARACTERS.                            00601000
       COPY BP13K800.                                                   00602000
                                                                        00603000
       FD   BP13K893                                                    00604000
            RECORD CONTAINS 2050 CHARACTERS.                            00605000
       COPY BP13K893.                                                   00606000
                                                                        00607000
      *------------------------*                                        00610000
       WORKING-STORAGE SECTION.                                         00620000
      *------------------------*                                        00630000
                                                                        00640000
       01  WS-SWITCHES.                                                 00650000
           05  WS-F130-EOF                PIC X          VALUE 'N'.     00660000
           05  WS-K893-EOF                PIC X          VALUE 'N'.     00660100
           05  WS-K893-FND                PIC X          VALUE 'N'.     00661000
           05  WS-K800-FND                PIC X          VALUE 'N'.     00662000
           05  WS-K410-FND                PIC X          VALUE 'N'.     00663000
                                                                        00670000
       01  WS-COUNTERS.                                                 00680000
           05  WS-CNT-F130-READ           PIC 9(5)       VALUE ZEROES.  00690000
           05  WS-CNT-K110-READ           PIC 9(5)       VALUE ZEROES.  00690100
           05  WS-CNT-K100-READ           PIC 9(5)       VALUE ZEROES.  00690200
           05  WS-CNT-K115-READ           PIC 9(5)       VALUE ZEROES.  00690300
           05  WS-CNT-K893-READ           PIC 9(5)       VALUE ZEROES.  00690400
           05  WS-CNT-K410-READ           PIC 9(5)       VALUE ZEROES.  00690500
           05  WS-CNT-K410-NOTFND         PIC 9(5)       VALUE ZEROES.  00690600
           05  WS-CNT-K350-READ           PIC 9(5)       VALUE ZEROES.  00690700
           05  WS-CNT-K800-READ           PIC 9(5)       VALUE ZEROES.  00690800
           05  WS-F13A-WRITE              PIC 9(5)       VALUE ZEROES.  00691000
           05  WS-F13B-WRITE              PIC 9(5)       VALUE ZEROES.  00692000
                                                                        00700000
                                                                        00770000
       01  WS-DTE-CUR.                                                  00780000
           05  WS-CC                      PIC 99.                       00790000
           05  WS-YY                      PIC 99.                       00800000
           05  WS-MM                      PIC 99.                       00810000
           05  WS-DD                      PIC 99.                       00820000
                                                                        00821000
       01  WS-KEY-ISSUE                   PIC X(8)   VALUE   SPACES.    00830000
       01  WS-KEY-AVAIL                   PIC X(8)   VALUE   SPACES.    00831000
       01  WS-PCD-DATE                    PIC X(8)   VALUE   SPACES.    00840000
       01  WS-FLAT-ADDRESS                PIC X(70)  VALUE   SPACES.    00850000
       01  WS-NUM-FLAT-TYPE               PIC X(2)   VALUE   SPACES.    00851000
       01  WS-NUM-LEASE-TENURE            PIC X(2)   VALUE   SPACES.    00852000
                                                                        00860000
       01  WS-FILE-STATUS.                                              00870000
           05  BP13K350-STATUS            PIC 9(2)       VALUE ZEROES.  01760000
           05  BP13K800-STATUS            PIC 9(2)       VALUE ZEROES.  01760100
           05  BP13K893-STATUS            PIC 9(2)       VALUE ZEROES.  01760200
           05  BP13K410-STATUS            PIC 9(2)       VALUE ZEROES.  01760300
           05  BM06K110-STATUS            PIC 9(2)       VALUE ZEROES.  01760400
           05  BM06K100-STATUS            PIC 9(2)       VALUE ZEROES.  01760500
           05  BM06K115-STATUS            PIC 9(2)       VALUE ZEROES.  01760600
                                                                        01760700
       01  WS-FLAG-STUD                   PIC X          VALUE SPACE.   01760800
                                                                        01760900
      *----------------------------------------------------------------*01761000
      *        LINKAGE FOR SUB-PROGRAM BP13C913                        *01761100
      *----------------------------------------------------------------*01761200
       01  WS-LINK-REC.                                                 01761300
           05  WS-LINK-NUM-SCH-ACC.                                     01761400
               10  WS-LINK-NUM-SCH     PIC X(4).                        01761500
               10  WS-LINK-NUM-ACC     PIC X(5).                        01761600
                                                                        01761700
       COPY P13COMM8.                                                   01761800
                                                                        01761900
      *---------------------------------------------------------------* 01762000
       PROCEDURE DIVISION.                                              01770000
      *---------------------------------------------------------------* 01780000
      *-------------------*                                             01790000
       0000-MAIN-ROUTINE.                                               01800000
      *-------------------*                                             01810000
           PERFORM 1000-OPEN-FILES             THRU 1000-EXIT.          01820000
           PERFORM 2000-READ-F130              THRU 2000-EXIT.          01830000
           PERFORM 3000-PROCESS-RECORDS        THRU 3000-EXIT           01840000
             UNTIL WS-F130-EOF = 'Y'.                                   01850000
           PERFORM 9000-CLOSE-FILES            THRU 9000-EXIT.          01860000
                                                                        01870000
       0000-EXIT.                                                       01880000
           EXIT.                                                        01890000
                                                                        01900000
      *-----------------*                                               01910000
       1000-OPEN-FILES.                                                 01920000
      *-----------------*                                               01930000
                                                                        01940000
           OPEN INPUT BP13F130                                          01950000
                      BP13K350                                          01951000
                      BP13K800                                          01951100
                      BP13K893                                          01951200
                      BM06K110                                          01952000
                      BM06K115                                          01952100
                      BM06K100                                          01952200
                      BP13K410                                          01953000
               OUTPUT BP13F13A                                          01960000
                      BP13F13B.                                         01970000
           MOVE FUNCTION CURRENT-DATE TO WS-DTE-CUR.                    01980000
                                                                        02020000
           IF BP13K350-STATUS NOT = 0   AND  97                         02021000
               DISPLAY 'ERROR OPENING - BP13K350 : ' BP13K350-STATUS    02022000
               MOVE BP13K350-STATUS TO RETURN-CODE                      02023000
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02024000
                                                                        02025000
           IF BM06K110-STATUS NOT = 0   AND  97                         02026000
               DISPLAY 'ERROR OPENING - BM06K110 : ' BM06K110-STATUS    02027000
               MOVE BM06K110-STATUS TO RETURN-CODE                      02028000
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02029000
                                                                        02029100
           IF BM06K115-STATUS NOT = 0   AND  97                         02029200
               DISPLAY 'ERROR OPENING - BM06K115 : ' BM06K115-STATUS    02029300
               MOVE BM06K115-STATUS TO RETURN-CODE                      02029400
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02029500
                                                                        02029600
           IF BM06K100-STATUS NOT = 0   AND  97                         02029700
               DISPLAY 'ERROR OPENING - BM06K100 : ' BM06K100-STATUS    02029800
               MOVE BM06K100-STATUS TO RETURN-CODE                      02029900
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02030000
                                                                        02030100
           IF BP13K410-STATUS NOT = 0   AND  97                         02030200
               DISPLAY 'ERROR OPENING - BP13K410 : ' BP13K410-STATUS    02030300
               MOVE BP13K410-STATUS TO RETURN-CODE                      02030400
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02030500
                                                                        02030600
           IF BP13K800-STATUS NOT = 0   AND  97                         02030700
               DISPLAY 'ERROR OPENING - BP13K800 : ' BP13K800-STATUS    02030800
               MOVE BP13K800-STATUS TO RETURN-CODE                      02030900
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02031000
                                                                        02031100
           IF BP13K893-STATUS NOT = 0   AND  97                         02031200
               DISPLAY 'ERROR OPENING - BP13K893 : ' BP13K893-STATUS    02031300
               MOVE BP13K893-STATUS TO RETURN-CODE                      02031400
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             02031500
                                                                        02031600
       1000-EXIT.                                                       02032000
           EXIT.                                                        02040000
                                                                        02050000
      *-------------------------------------------------------------    02060000
       2000-READ-F130.                                                  02070000
      *-------------------------------------------------------------    02080000
           READ BP13F130                                                02090000
                AT END                                                  02100000
                MOVE HIGH-VALUES TO  BP13F130-REC                       02110000
                MOVE 'Y' TO  WS-F130-EOF                                02120000
                GO TO 2000-EXIT.                                        02130000
           ADD 1 TO WS-CNT-F130-READ.                                   02140000
                                                                        02150000
       2000-EXIT.                                                       02160000
           EXIT.                                                        02170000
                                                                        02180000
      *-------------------------------------------------------------*   02190000
       3000-PROCESS-RECORDS.                                            02200000
      *-------------------------------------------------------------*   02210000
                                                                        02220000
           PERFORM 4000-READ-K350              THRU 4000-EXIT.          02310000
           PERFORM 2000-READ-F130              THRU 2000-EXIT.          02311000
                                                                        02320000
       3000-EXIT.                                                       02330000
           EXIT.                                                        02340000
                                                                        02350000
                                                                        03450000
      *-------------------------------------------------------------*   03451000
       4000-READ-K350.                                                  03452000
      *-------------------------------------------------------------*   03453000
                                                                        03454000
                MOVE F130-NUM-REGN TO K350-NUM-REGN                     03455000
                                      K110-REGN-NO K800-NUM-REGN.       03456000
                MOVE SPACES             TO  WS-KEY-ISSUE WS-KEY-AVAIL.  03456100
                MOVE SPACES             TO  WS-PCD-DATE WS-FLAG-STUD    03456200
                                            WS-NUM-FLAT-TYPE            03456300
                                            WS-NUM-LEASE-TENURE         03456400
                                            WS-FLAT-ADDRESS.            03456500
                READ BP13K350.                                          03456600
                EVALUATE BP13K350-STATUS                                03457000
                WHEN '00'                                               03457100
                     MOVE       'Y'              TO  WS-FLAG-STUD       03457200
                     ADD      1                  TO  WS-CNT-K350-READ   03457300
                     PERFORM 4300-READ-K800      THRU   4300-EXIT       03457400
                     PERFORM 4100-READ-K110      THRU   4100-EXIT       03457500
                     IF WS-NUM-FLAT-TYPE       = '2F'                   03457600
                        IF WS-NUM-LEASE-TENURE = SPACES                 03457700
                           PERFORM 4600-WRITE-F13B                      03457800
                                                 THRU   4600-EXIT       03457900
                        END-IF                                          03458000
                     ELSE                                               03458100
                        PERFORM 4500-WRITE-F13A  THRU   4500-EXIT       03458200
                     END-IF                                             03458300
                WHEN '23'                                               03458400
                     MOVE      'N'               TO   WS-FLAG-STUD      03458500
                     PERFORM 4300-READ-K800      THRU   4300-EXIT       03458600
                     PERFORM 4100-READ-K110      THRU   4100-EXIT       03458700
                     PERFORM 4600-WRITE-F13B     THRU   4600-EXIT       03458800
                WHEN OTHER                                              03458900
                      DISPLAY 'ERROR READING - BP13K350 : '             03459000
                                                   BP13K350-STATUS      03459100
                      MOVE  BP13K350-STATUS TO RETURN-CODE              03459200
                      PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT         03459300
                END-EVALUATE.                                           03459400
                                                                        03459500
                                                                        03459600
       4000-EXIT.                                                       03459700
           EXIT.                                                        03459800
                                                                        03459900
                                                                        03460000
      *-------------------------------------------------------------    03460100
       4100-READ-K110.                                                  03460200
      *-------------------------------------------------------------    03460300
                                                                        03460400
           READ BM06K110 KEY IS K110-REGN-NO.                           03460500
                                                                        03460600
           EVALUATE BM06K110-STATUS                                     03461200
              WHEN 00                                                   03461300
              WHEN 02                                                   03461400
                   ADD       1     TO              WS-CNT-K110-READ     03461500
                   PERFORM   4110-CHK-DATE         THRU   4110-EXIT     03461600
              WHEN 23                                                   03461700
                   IF WS-FLAG-STUD = 'Y'                                03461800
                      PERFORM   4120-READ-K410        THRU   4120-EXIT  03461900
                   ELSE                                                 03462000
                      IF WS-FLAG-STUD = 'N'                             03462100
                       IF F130-NUM-SCH-ACCT NOT = SPACES AND LOW-VALUES 03462200
                                             AND ZEROS                  03462300
                        MOVE  F130-NUM-SCH-ACCT    TO  K115-SCH-ACC-NO  03462400
                        PERFORM 4200-READ-K115      THRU   4200-EXIT    03462500
                       END-IF                                           03462600
                      END-IF                                            03462700
                   END-IF                                               03462800
              WHEN OTHER                                                03462900
                 DISPLAY ' ERROR READING BM06K110 REC '                 03463000
                         ' STATUS ' BM06K110-STATUS                     03463100
                 DISPLAY ' KEY IS ' K110-REGN-NO                        03463200
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT              03463300
           END-EVALUATE.                                                03463400
                                                                        03463500
       4100-EXIT.                                                       03463600
           EXIT.                                                        03463700
                                                                        03463800
      *-------------------------------------------------------------*   03463900
       4110-CHK-DATE.                                                   03464000
      *-------------------------------------------------------------*   03464100
             IF  K110-DTE-KEY-ISSUED NOT = SPACES AND LOW-VALUES AND    03464200
                                           ZEROS                        03464300
                 MOVE K110-DTE-KEY-ISSUED  TO  WS-KEY-ISSUE             03464400
                                                                        03464500
             ELSE                                                       03464600
                 IF  K110-DTE-KEY-AVAIL  NOT = SPACES AND LOW-VALUES AND03464700
                                               ZEROS                    03464800
                     MOVE K110-DTE-KEY-AVAIL   TO  WS-KEY-AVAIL         03464900
             ELSE                                                       03465000
                 MOVE SPACES               TO  WS-KEY-ISSUE WS-KEY-AVAIL03465100
                 MOVE SPACES               TO  WS-PCD-DATE              03465200
                 MOVE K110-ESTATE             TO K100-ESTATE            03465300
                 MOVE K110-NEIGHBOURHOOD      TO K100-NEIGHBOURHOOD     03465400
                 MOVE K110-CONTRACT-NO        TO K100-CONTRACT-NO       03465500
                 MOVE K110-BLK-NO             TO K100-BLK-NO            03465600
                 PERFORM   4115-READ-K100        THRU   4115-EXIT       03465700
             END-IF                                                     03465800
             END-IF.                                                    03465900
                                                                        03466000
                                                                        03466100
                                                                        03466200
                                                                        03466300
       4110-EXIT.                                                       03466400
            EXIT.                                                       03466500
                                                                        03466600
      *-------------------------------------------------------------*   03466700
       4115-READ-K100.                                                  03466800
      *-------------------------------------------------------------*   03466900
                                                                        03467000
           READ BM06K100 KEY IS K100-KEY-FLD.                           03467100
           EVALUATE BM06K100-STATUS                                     03467200
                 WHEN 00                                                03467300
                      ADD       1     TO              WS-CNT-K100-READ  03467400
                      IF K100-DTE-PACD NOT = SPACES AND LOW-VALUES AND  03467500
                                             ZEROS                      03467600
                         MOVE  K100-DTE-PACD        TO  WS-PCD-DATE     03467700
                      ELSE                                              03467800
                         MOVE  SPACES               TO  WS-PCD-DATE     03467900
                      END-IF                                            03468000
                 WHEN 23                                                03468100
                       MOVE SPACES               TO  WS-PCD-DATE        03468200
                 WHEN  OTHER                                            03468300
                      DISPLAY ' ERROR READING BM06K100 REC '            03468400
                         ' STATUS ' BM06K100-STATUS                     03468500
                      PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT         03468600
            END-EVALUATE.                                               03468700
                                                                        03468800
       4115-EXIT.                                                       03468900
           EXIT.                                                        03469000
                                                                        03469100
      *-------------------------------------------------------------*   03469200
       4120-READ-K410.                                                  03469300
      *-------------------------------------------------------------*   03469400
                                                                        03469500
              MOVE F130-NUM-REGN  TO    K410-NUM-REGN.                  03469600
              READ BP13K410.                                            03469700
              EVALUATE BP13K410-STATUS                                  03470200
                 WHEN 00                                                03470300
                      ADD       1     TO              WS-CNT-K410-READ  03470400
                      PERFORM   4125-CHK-DATE         THRU   4125-EXIT  03470500
                 WHEN 23                                                03470600
                       MOVE SPACES               TO  WS-KEY-ISSUE       03470700
                       MOVE SPACES               TO  WS-PCD-DATE        03470800
                       ADD 1                     TO  WS-CNT-K410-NOTFND 03470900
                 WHEN  OTHER                                            03471000
                      DISPLAY ' ERROR READING BP13K410 REC '            03471100
                         ' STATUS ' BP13K410-STATUS                     03471200
                      DISPLAY ' KEY IS ' F130-NUM-REGN                  03471300
                      PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT         03471400
              END-EVALUATE.                                             03471500
                                                                        03471600
       4120-EXIT.                                                       03471700
           EXIT.                                                        03471800
                                                                        03471900
      *-------------------------------------------------------------*   03472000
       4125-CHK-DATE.                                                   03472100
      *-------------------------------------------------------------*   03472200
             IF  K410-DTE-KEY-ISSUE  NOT = SPACES AND LOW-VALUES AND    03472300
                                           ZEROS                        03472400
                 MOVE K410-DTE-KEY-ISSUE   TO  WS-KEY-ISSUE             03472500
             ELSE                                                       03472600
                 MOVE SPACES               TO  WS-KEY-ISSUE             03472700
                 MOVE SPACES               TO  WS-PCD-DATE              03472800
             END-IF.                                                    03472900
                                                                        03473000
                                                                        03473100
       4125-EXIT.                                                       03473200
            EXIT.                                                       03473300
                                                                        03473400
      *-------------------------------------------------------------*   03473500
       4130-READ-K410.                                                  03473600
      *-------------------------------------------------------------*   03473700
              MOVE 'N'            TO    WS-K410-FND.                    03473800
              MOVE F130-NUM-REGN  TO    K410-NUM-REGN.                  03473900
              READ BP13K410.                                            03474000
              EVALUATE BP13K410-STATUS                                  03474600
                 WHEN 00                                                03474700
                      MOVE 'Y'           TO WS-K410-FND                 03474800
                      PERFORM 4400-READ-K893     THRU 4400-EXIT         03474904
                 WHEN 23                                                03475000
                      MOVE 'N'           TO WS-K410-FND                 03475100
                      PERFORM 4400-READ-K893     THRU 4400-EXIT         03475204
                 WHEN  OTHER                                            03475300
                      DISPLAY ' ERROR READING BP13K410 REC '            03475400
                         ' STATUS ' BP13K410-STATUS                     03475500
                      DISPLAY ' KEY IS ' F130-NUM-REGN                  03475600
                      PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT         03475700
              END-EVALUATE.                                             03475800
                                                                        03475900
       4130-EXIT.                                                       03476000
           EXIT.                                                        03476100
      *-------------------------------------------------------------    03476200
       4200-READ-K115.                                                  03476300
      *-------------------------------------------------------------    03476400
           READ BM06K115.                                               03476500
                                                                        03476600
           EVALUATE BM06K115-STATUS                                     03476700
              WHEN 00                                                   03476800
              WHEN 02                                                   03476900
                   ADD       1     TO              WS-CNT-K115-READ     03477000
                   PERFORM   4210-CHK-DATE         THRU   4210-EXIT     03477100
              WHEN 23                                                   03477200
                   MOVE SPACES           TO  WS-KEY-ISSUE WS-KEY-AVAIL  03477300
                   MOVE SPACES           TO  WS-PCD-DATE                03477400
      *            PERFORM   4120-READ-K410        THRU   4120-EXIT     03477500
              WHEN OTHER                                                03477600
                 DISPLAY ' ERROR READING BM06K115 REC '                 03477700
                         ' STATUS ' BM06K115-STATUS                     03477800
                 DISPLAY ' KEY IS ' K115-REGN-NO                        03477900
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT              03478000
           END-EVALUATE.                                                03478100
                                                                        03478200
       4200-EXIT.                                                       03478300
           EXIT.                                                        03478400
                                                                        03478500
      *-------------------------------------------------------------*   03478600
       4210-CHK-DATE.                                                   03478700
      *-------------------------------------------------------------*   03478800
             IF  K115-DTE-KEY-ISSUED NOT = SPACES AND LOW-VALUES AND    03478900
                                           ZEROS                        03479000
                 MOVE K115-DTE-KEY-ISSUED  TO  WS-KEY-ISSUE             03479100
             ELSE                                                       03479200
             IF  K115-DTE-KEY-AVAIL  NOT = SPACES AND LOW-VALUES AND    03479300
                                           ZEROS                        03479400
                 MOVE K115-DTE-KEY-AVAIL   TO  WS-KEY-AVAIL             03479500
             ELSE                                                       03479600
                 MOVE SPACES               TO  WS-KEY-ISSUE WS-KEY-AVAIL03479700
                 MOVE SPACES               TO  WS-PCD-DATE              03479800
                 MOVE K115-ESTATE             TO K100-ESTATE            03479900
                 MOVE K115-NEIGHBOURHOOD      TO K100-NEIGHBOURHOOD     03480000
                 MOVE K115-CONTRACT-NO        TO K100-CONTRACT-NO       03480100
                 MOVE K115-BLK-NO             TO K100-BLK-NO            03480200
                 PERFORM   4115-READ-K100        THRU   4115-EXIT       03480300
             END-IF.                                                    03480400
                                                                        03480500
                                                                        03480600
       4210-EXIT.                                                       03480700
            EXIT.                                                       03480800
                                                                        03480900
      *-------------------------------------------------------------*   03481000
       4300-READ-K800.                                                  03481100
      *-------------------------------------------------------------*   03481200
            MOVE   'N'            TO   WS-K800-FND WS-K893-FND.         03481300
            READ BP13K800.                                              03481400
            EVALUATE BP13K800-STATUS                                    03481800
            WHEN '00'                                                   03481900
                  ADD 1      TO      WS-CNT-K800-READ                   03482000
                  MOVE     'Y'       TO WS-K800-FND                     03482100
                  MOVE K800-NUM-FLAT-TYPE TO WS-NUM-FLAT-TYPE           03482200
                  MOVE K800-NUM-LEASE-TENURE                            03482300
                                          TO WS-NUM-LEASE-TENURE        03482400
                  CONTINUE                                              03482500
            WHEN '23'                                                   03482600
                  IF WS-FLAG-STUD = 'Y'                                 03482700
                     PERFORM   4130-READ-K410        THRU   4130-EXIT   03482800
                  ELSE                                                  03482900
                   IF WS-FLAG-STUD = 'N'                                03483000
                     PERFORM     4400-READ-K893   THRU   4400-EXIT      03483100
                   END-IF                                               03483200
                  END-IF                                                03483300
            WHEN  OTHER                                                 03483400
                   DISPLAY 'BP13K800-READ ERROR: '                      03483500
                                              BP13K800-STATUS           03483600
                   DISPLAY ' KEY IS ' K800-NUM-REGN                     03483700
                   PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT            03483800
            END-EVALUATE.                                               03483900
                                                                        03484000
       4300-EXIT.                                                       03484100
           EXIT.                                                        03484200
                                                                        03484300
      *-------------------------------------------------------------*   03484400
       4400-READ-K893.                                                  03484500
      *-------------------------------------------------------------*   03484600
                                                                        03484700
           MOVE SPACES                           TO BP13K893-MASTER.    03484800
           INITIALIZE                               BP13K893-MASTER.    03484900
                                                                        03485000
           MOVE F130-NUM-REGN                    TO K893-NUM-REGN-HIST  03485100
           MOVE 'N'                              TO WS-K893-EOF         03485200
                                                    WS-K893-FND         03485300
                                                                        03485400
           START BP13K893 KEY >= K893-KEY-FLD.                          03485500
                                                                        03485600
           EVALUATE BP13K893-STATUS                                     03485700
              WHEN 00                                                   03485800
                 PERFORM 4410-READNEXT-BP13K893 THRU 4410-EXIT          03485900
                   UNTIL K893-NUM-REGN-HIST NOT = F130-NUM-REGN         03486000
                      OR WS-K893-EOF = 'Y'                              03486100
              WHEN 10                                                   03486200
              WHEN 23                                                   03486300
                 DISPLAY 'REGN NOT FOUND IN K893: '                     03486400
                          F130-NUM-REGN                                 03486500
              WHEN OTHER                                                03486600
                 DISPLAY 'BP13K893 START ERROR ' BP13K893-STATUS        03486700
                 DISPLAY 'K893 KEY: ' K893-KEY-FLD                      03486800
                 MOVE BP13K893-STATUS             TO RETURN-CODE        03486900
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT              03487000
                                                                        03487100
           END-EVALUATE.                                                03487200
                                                                        03487300
                                                                        03487400
       4400-EXIT.                                                       03487500
           EXIT.                                                        03487600
                                                                        03487700
      *-------------------------------------------------------------*   03487800
       4410-READNEXT-BP13K893.                                          03487900
      *-------------------------------------------------------------*   03488000
                                                                        03488100
           READ BP13K893 NEXT RECORD                                    03488200
             AT END                                                     03488300
                MOVE 'Y'                         TO WS-K893-EOF         03488400
           END-READ.                                                    03488500
                                                                        03488600
           EVALUATE BP13K893-STATUS                                     03488700
              WHEN 00                                                   03488800
              WHEN 02                                                   03488900
                 IF K893-NUM-REGN-HIST = F130-NUM-REGN                  03489000
                    MOVE K893-NUM-FLAT-TYPE                             03489103
                               TO      WS-NUM-FLAT-TYPE                 03489203
                    MOVE K893-NUM-LEASE-TENURE                          03489303
                               TO      WS-NUM-LEASE-TENURE              03489403
                    ADD 1      TO      WS-CNT-K893-READ                 03489500
                    MOVE 'Y'   TO      WS-K893-FND                      03489600
                    MOVE 'Y'   TO      WS-K893-EOF                      03489700
                 ELSE                                                   03489800
                    MOVE 'Y'                     TO WS-K893-EOF         03489900
                 END-IF                                                 03490000
              WHEN 10                                                   03490100
              WHEN 23                                                   03490200
                 MOVE 'Y'                        TO WS-K893-EOF         03490300
                 DISPLAY 'RECORD NOT FOUND IN K893' F130-NUM-REGN       03490400
              WHEN OTHER                                                03490500
                 DISPLAY 'BP13K893 READ NEXT ERROR ' BP13K893-STATUS    03490600
                 DISPLAY 'K893 KEY: ' K893-KEY-FLD                      03490700
                 MOVE BP13K893-STATUS             TO RETURN-CODE        03490800
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT              03490900
                                                                        03491000
           END-EVALUATE.                                                03491100
                                                                        03491200
       4410-EXIT.                                                       03491300
            EXIT.                                                       03491400
                                                                        03491500
      *-------------------------------------------------------------*   03491600
       4500-WRITE-F13A.                                                 03491700
      *-------------------------------------------------------------*   03491800
                                                                        03491900
           MOVE  SPACES                TO    BP13F13A-REC.              03492000
           INITIALIZE                        BP13F13A-REC.              03492100
           IF F130-NUM-RECPT-JRNO = SPACES OR LOW-VALUES                03492200
              MOVE 'SOC'               TO F130-NUM-RECPT-JRNO           03492300
           END-IF.                                                      03492400
           MOVE F130-TRANS-TYPE        TO    F13A-TRANS-TYPE.           03492500
           MOVE F130-NUM-REGN          TO    F13A-NUM-REGN.             03492600
           MOVE F130-DTE-POST          TO    F13A-DTE-POST.             03492700
           MOVE F130-NUM-NRIC          TO    F13A-NUM-NRIC.             03492800
           MOVE F130-NUM-RECPT-JRNO    TO    F13A-NUM-RECPT-JRNO.       03492900
           MOVE F130-AMT-RECEIPT       TO    F13A-AMT-RECEIPT.          03493000
           MOVE F130-CDE-AMT-TYPE       TO   F13A-CDE-AMT-TYPE.         03493100
           MOVE F130-DTE-TRANS          TO   F13A-DTE-TRANS.            03493200
           MOVE F130-CDE-PAYMENT-TYPE   TO   F13A-CDE-PAYMENT-TYPE.     03493300
           MOVE F130-NUM-SCH-ACCT       TO   F13A-NUM-SCH-ACCT.         03493400
           MOVE F130-CDE-ERROR          TO   F13A-CDE-ERROR.            03493500
           IF WS-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND ZEROS        03493600
              MOVE WS-KEY-AVAIL            TO   F13A-DTE-KEY-AVAIL      03493700
           ELSE                                                         03493800
              MOVE SPACES                  TO   F13A-DTE-KEY-AVAIL      03493900
           END-IF.                                                      03494000
           IF WS-KEY-ISSUE NOT = SPACES AND LOW-VALUES AND ZEROS        03494100
              MOVE WS-KEY-ISSUE            TO   F13A-DTE-KEY-ISSUE      03494200
           ELSE                                                         03494300
              MOVE SPACES                  TO   F13A-DTE-KEY-ISSUE      03494400
           END-IF.                                                      03494500
           IF WS-PCD-DATE NOT = SPACES AND LOW-VALUES AND ZEROS         03494600
              MOVE WS-PCD-DATE             TO   F13A-DTE-PCD            03494700
           ELSE                                                         03494800
              MOVE SPACES                  TO   F13A-DTE-PCD            03494900
           END-IF.                                                      03495000
           IF WS-K800-FND = 'Y'                                         03495100
              PERFORM   4550-GET-K800-DAT     THRU   4550-EXIT          03495200
           ELSE                                                         03495300
              IF  WS-K410-FND = 'Y'                                     03495400
                  PERFORM   4565-GET-K410-DAT     THRU   4565-EXIT      03495500
              END-IF                                                    03495600
           END-IF.                                                      03495700
           IF F130-NUM-SCH-ACCT NOT = SPACES AND LOW-VALUES             03495800
             PERFORM 4700-CALL-BP13C913    THRU   4700-EXIT             03495900
             MOVE      WS-FLAT-ADDRESS     TO  F13A-FLAT-ADDR           03496000
           ELSE                                                         03496100
             MOVE SPACES                  TO   F13A-FLAT-ADDR           03496200
           END-IF.                                                      03496300
           WRITE BP13F13A-REC.                                          03496400
           ADD 1                       TO  WS-F13A-WRITE.               03496500
                                                                        03496600
       4500-EXIT.                                                       03496700
           EXIT.                                                        03496800
                                                                        03496900
      *-------------------------------------------------------------*   03497000
       4550-GET-K800-DAT.                                               03497100
      *-------------------------------------------------------------*   03497200
                                                                        03497300
           IF K800-NUM-ALLO-CAT NOT = SPACES AND LOW-VALUES             03497400
              MOVE K800-NUM-ALLO-CAT       TO   F13A-NUM-ALLO-CAT       03497500
           ELSE                                                         03497600
              MOVE SPACES                  TO  F13A-NUM-ALLO-CAT        03497700
           END-IF.                                                      03497800
           IF K800-NUM-IDP-SCHEME = 'SA' OR                             03497900
              (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                      03498000
              MOVE  'SA'                TO  F13A-NUM-FLAT-TYPE-SA       03498100
           ELSE                                                         03498200
              IF K800-NUM-FLAT-TYPE = '2 ' OR '2R'                      03498300
                 MOVE '2R'              TO  F13A-NUM-FLAT-TYPE-SA       03498400
              ELSE                                                      03498500
                 IF K800-NUM-FLAT-TYPE = '3 ' OR '3R'                   03498600
                    MOVE '3R'              TO  F13A-NUM-FLAT-TYPE-SA    03498700
                 ELSE                                                   03498800
                    MOVE K800-NUM-FLAT-TYPE                             03498900
                                           TO  F13A-NUM-FLAT-TYPE-SA    03499000
                 END-IF                                                 03499100
              END-IF                                                    03499200
           END-IF.                                                      03499300
                                                                        03499400
                                                                        03499500
       4550-EXIT.                                                       03499600
           EXIT.                                                        03499700
                                                                        03499800
                                                                        03499900
      *-------------------------------------------------------------*   03500000
       4560-GET-K893-DAT.                                               03500100
      *-------------------------------------------------------------*   03500200
                                                                        03500300
           IF K893-NUM-ALLO-CAT NOT = SPACES AND LOW-VALUES             03500400
              MOVE K893-NUM-ALLO-CAT       TO   F13A-NUM-ALLO-CAT       03500500
           ELSE                                                         03500600
              MOVE SPACES                  TO  F13A-NUM-ALLO-CAT        03500700
           END-IF.                                                      03500800
           IF K893-NUM-IDP-SCHEME = 'SA' OR                             03500900
              (K893-NUM-FLAT-TYPE  = '1A' OR '2A')                      03501000
              MOVE  'SA'                TO  F13A-NUM-FLAT-TYPE-SA       03501100
           ELSE                                                         03501200
              IF K893-NUM-FLAT-TYPE = '2 ' OR '2R'                      03501300
                 MOVE '2R'              TO  F13A-NUM-FLAT-TYPE-SA       03501400
              ELSE                                                      03501500
                 IF K893-NUM-FLAT-TYPE = '3 ' OR '3R'                   03501600
                    MOVE '3R'              TO  F13A-NUM-FLAT-TYPE-SA    03501700
                 ELSE                                                   03501800
                    MOVE K893-NUM-FLAT-TYPE                             03501900
                                           TO  F13A-NUM-FLAT-TYPE-SA    03502000
                 END-IF                                                 03502100
              END-IF                                                    03502200
           END-IF.                                                      03502300
                                                                        03502400
                                                                        03502500
       4560-EXIT.                                                       03502600
           EXIT.                                                        03502700
                                                                        03502800
                                                                        03502900
      *-------------------------------------------------------------*   03503000
       4565-GET-K410-DAT.                                               03503100
      *-------------------------------------------------------------*   03503200
                                                                        03503300
           IF K410-NUM-ALLO-CAT NOT = SPACES AND LOW-VALUES             03503400
              MOVE K410-NUM-ALLO-CAT       TO   F13A-NUM-ALLO-CAT       03503500
           ELSE                                                         03503600
              MOVE SPACES                  TO  F13A-NUM-ALLO-CAT        03503700
           END-IF.                                                      03503800
           IF K410-CDE-IDP-SCH = 'SA'                                   03503900
              MOVE  'SA'                TO  F13A-NUM-FLAT-TYPE-SA       03504000
           ELSE                                                         03504100
                 MOVE SPACES           TO  F13A-NUM-FLAT-TYPE-SA        03504200
           END-IF.                                                      03504300
                                                                        03504400
                                                                        03504500
       4565-EXIT.                                                       03504600
           EXIT.                                                        03504700
                                                                        03504800
      *-------------------------------------------------------------*   03504900
       4600-WRITE-F13B.                                                 03505000
      *-------------------------------------------------------------*   03505100
                                                                        03505200
           MOVE  SPACES                TO    BP13F13B-REC.              03505300
           INITIALIZE                        BP13F13B-REC.              03505400
           IF F130-NUM-RECPT-JRNO = SPACES OR LOW-VALUES                03505500
              MOVE 'SOC'               TO F130-NUM-RECPT-JRNO           03505600
           END-IF.                                                      03505700
           MOVE F130-TRANS-TYPE        TO    F13B-TRANS-TYPE.           03505800
           MOVE F130-NUM-REGN          TO    F13B-NUM-REGN.             03505900
           MOVE F130-DTE-POST          TO    F13B-DTE-POST.             03506000
           MOVE F130-NUM-NRIC          TO    F13B-NUM-NRIC.             03506100
           MOVE F130-NUM-RECPT-JRNO    TO    F13B-NUM-RECPT-JRNO.       03506200
           MOVE F130-AMT-RECEIPT       TO    F13B-AMT-RECEIPT.          03506300
           MOVE F130-CDE-AMT-TYPE       TO   F13B-CDE-AMT-TYPE.         03506400
           MOVE F130-DTE-TRANS          TO   F13B-DTE-TRANS.            03506500
           MOVE F130-CDE-PAYMENT-TYPE   TO   F13B-CDE-PAYMENT-TYPE.     03506600
           MOVE F130-NUM-SCH-ACCT       TO   F13B-NUM-SCH-ACCT.         03506700
           MOVE F130-CDE-ERROR          TO   F13B-CDE-ERROR.            03506800
           IF WS-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND ZEROS        03506900
              MOVE WS-KEY-AVAIL            TO   F13B-DTE-KEY-AVAIL      03507000
           ELSE                                                         03507100
              MOVE SPACES                  TO   F13B-DTE-KEY-AVAIL      03507200
           END-IF.                                                      03507300
           IF WS-KEY-ISSUE NOT = SPACES AND LOW-VALUES AND ZEROS        03507400
              MOVE WS-KEY-ISSUE            TO   F13B-DTE-KEY-ISSUE      03507500
           ELSE                                                         03507600
              MOVE SPACES                  TO   F13B-DTE-KEY-ISSUE      03507700
           END-IF.                                                      03507800
           IF WS-PCD-DATE NOT = SPACES AND LOW-VALUES AND ZEROS         03507900
              MOVE WS-PCD-DATE             TO   F13B-DTE-PCD            03508000
           ELSE                                                         03508100
              MOVE SPACES                  TO   F13B-DTE-PCD            03508200
           END-IF.                                                      03508300
           IF WS-K800-FND = 'Y'                                         03508400
              PERFORM   4650-GET-K800-DAT     THRU   4650-EXIT          03508500
           ELSE                                                         03508600
              IF  WS-K893-FND = 'Y'                                     03508700
                  PERFORM   4660-GET-K893-DAT     THRU   4660-EXIT      03508800
              END-IF                                                    03508900
           END-IF.                                                      03509000
           IF F130-NUM-SCH-ACCT NOT = SPACES AND LOW-VALUES             03509100
             PERFORM 4700-CALL-BP13C913    THRU   4700-EXIT             03509200
             MOVE      WS-FLAT-ADDRESS     TO  F13B-FLAT-ADDR           03509300
           ELSE                                                         03509400
             MOVE SPACES                  TO   F13B-FLAT-ADDR           03509500
           END-IF.                                                      03509600
           WRITE BP13F13B-REC.                                          03509700
           ADD 1                       TO  WS-F13B-WRITE.               03509800
                                                                        03509900
       4600-EXIT.                                                       03510000
           EXIT.                                                        03510100
                                                                        03510200
      *-------------------------------------------------------------*   03510300
       4650-GET-K800-DAT.                                               03510400
      *-------------------------------------------------------------*   03510500
                                                                        03510600
           IF K800-NUM-ALLO-CAT NOT = SPACES AND LOW-VALUES             03510700
              MOVE K800-NUM-ALLO-CAT       TO   F13B-NUM-ALLO-CAT       03510800
           ELSE                                                         03510900
              MOVE SPACES                  TO  F13B-NUM-ALLO-CAT        03511000
           END-IF.                                                      03511100
           IF K800-NUM-IDP-SCHEME = 'SA' OR                             03511200
              (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                      03511300
              MOVE  'SA'                TO  F13B-NUM-FLAT-TYPE-SA       03511400
           ELSE                                                         03511500
              IF K800-NUM-FLAT-TYPE = '2 ' OR '2R'                      03511600
                 MOVE '2R'              TO  F13B-NUM-FLAT-TYPE-SA       03511700
              ELSE                                                      03511800
                 IF K800-NUM-FLAT-TYPE = '3 ' OR '3R'                   03511900
                    MOVE '3R'              TO  F13B-NUM-FLAT-TYPE-SA    03512000
                 ELSE                                                   03512100
                    MOVE K800-NUM-FLAT-TYPE                             03512200
                                           TO  F13B-NUM-FLAT-TYPE-SA    03512300
                 END-IF                                                 03512400
              END-IF                                                    03512500
           END-IF.                                                      03512600
                                                                        03512700
           MOVE K800-NUM-CANCEL-REASON     TO F13B-NUM-CANCEL-REASON.   03512800
                                                                        03512900
       4650-EXIT.                                                       03513000
           EXIT.                                                        03513100
                                                                        03513200
                                                                        03513300
      *-------------------------------------------------------------*   03513400
       4660-GET-K893-DAT.                                               03513500
      *-------------------------------------------------------------*   03513600
                                                                        03513700
           IF K893-NUM-ALLO-CAT NOT = SPACES AND LOW-VALUES             03513800
              MOVE K893-NUM-ALLO-CAT       TO   F13B-NUM-ALLO-CAT       03513900
           ELSE                                                         03514000
              MOVE SPACES                  TO  F13B-NUM-ALLO-CAT        03514100
           END-IF.                                                      03514200
           IF K893-NUM-IDP-SCHEME = 'SA' OR                             03514300
              (K893-NUM-FLAT-TYPE  = '1A' OR '2A')                      03514400
              MOVE  'SA'                TO  F13B-NUM-FLAT-TYPE-SA       03514500
           ELSE                                                         03514600
              IF K893-NUM-FLAT-TYPE = '2 ' OR '2R'                      03514700
                 MOVE '2R'              TO  F13B-NUM-FLAT-TYPE-SA       03514800
              ELSE                                                      03514900
                 IF K893-NUM-FLAT-TYPE = '3 ' OR '3R'                   03515000
                    MOVE '3R'              TO  F13B-NUM-FLAT-TYPE-SA    03515100
                 ELSE                                                   03515200
                    MOVE K893-NUM-FLAT-TYPE                             03515300
                                           TO  F13B-NUM-FLAT-TYPE-SA    03515400
                 END-IF                                                 03515500
              END-IF                                                    03515600
           END-IF.                                                      03515700
                                                                        03515800
           MOVE K893-NUM-CANCEL-REASON     TO F13B-NUM-CANCEL-REASON.   03515900
                                                                        03516000
       4660-EXIT.                                                       03516100
           EXIT.                                                        03516200
                                                                        03516300
                                                                        03516400
      *-------------------------------------------------------------*   03516500
       4700-CALL-BP13C913.                                              03516600
      *-------------------------------------------------------------*   03516700
           MOVE F130-NUM-SCH-ACCT    TO WS-LINK-REC.                    03516800
                                                                        03516900
           CALL 'BP13C913' USING WS-LINK-REC, BP13COMM8-REC.            03517000
                                                                        03517100
           EVALUATE COMM8-CDE-SYSERR                                    03517200
             WHEN 000                                                   03517300
                STRING 'BLK '  COMM8-NUM-BLK  '  '                      03517400
                       '#'  COMM8-NUM-LEVEL   '-'                       03517500
                       COMM8-NUM-UNIT-MAIN    '  ' DELIMITED BY SIZE    03517600
                       COMM8-NME-STREET       DELIMITED BY '   '        03517700
                   ' S('  COMM8-NUM-POSTAL-CODE ')'   DELIMITED BY SIZE 03517800
                       INTO  WS-FLAT-ADDRESS                            03517900
                                                                        03518000
             WHEN 100                                                   03518100
                DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE - '             03518200
                         F130-NUM-SCH-ACCT ', REGN : ' F130-NUM-REGN    03518300
                MOVE  SPACES                    TO  WS-FLAT-ADDRESS     03518400
             WHEN OTHER                                                 03518500
                DISPLAY 'ERROR READING PBF TABLE' COMM8-CDE-SYSERR      03518600
                MOVE  SPACES                    TO  WS-FLAT-ADDRESS     03518700
           END-EVALUATE.                                                03518800
                                                                        03518900
                                                                        03519000
       4700-EXIT.                                                       03519100
           EXIT.                                                        03519200
                                                                        03519300
      *--------------------*                                            03519400
       9000-CLOSE-FILES.                                                03519500
      *--------------------*                                            03519600
                                                                        03519700
           DISPLAY 'PROGRAM ID   : BP13CA05' .                          03519800
           DISPLAY 'CURRENT DATE : ' WS-DTE-CUR.                        03519900
           DISPLAY SPACES.                                              03520000
           DISPLAY '*--------------- COUNTERS ---------------*'.        03530000
           DISPLAY 'NUMBER OF BP13F130 RECORDS  : ' WS-CNT-F130-READ.   03540000
           DISPLAY 'NUMBER OF BM06K110 RECORDS  : ' WS-CNT-K110-READ.   03540100
           DISPLAY 'NUMBER OF BM06K115 RECORDS  : ' WS-CNT-K115-READ.   03540200
           DISPLAY 'NUMBER OF BP13K800 RECORDS  : ' WS-CNT-K800-READ.   03540300
           DISPLAY 'NUMBER OF BP13K893 RECORDS  : ' WS-CNT-K893-READ.   03540400
           DISPLAY 'NUMBER OF BM06K100 RECORDS  : ' WS-CNT-K100-READ.   03540500
           DISPLAY 'NUMBER OF BP13K410 RECORDS  : ' WS-CNT-K410-READ.   03540600
           DISPLAY 'NUMBER OF BP13K410 NOT FND  : ' WS-CNT-K410-NOTFND. 03540700
           DISPLAY 'NUMBER OF STUDIO   RECORDS  : ' WS-F13A-WRITE.      03540800
           DISPLAY 'NUMBER OF AMR      RECORDS  : ' WS-F13B-WRITE.      03541000
                                                                        03570000
            CLOSE  BP13F130                                             03580000
                   BP13K350                                             03590000
                   BM06K110                                             03590100
                   BM06K115                                             03590200
                   BM06K100                                             03590300
                   BP13K800                                             03590400
                   BP13K893                                             03590500
                   BP13K410                                             03590600
                   BP13F13A                                             03591000
                   BP13F13B.                                            03600000
                                                                        03600100
           IF BP13K350-STATUS NOT = 0   AND  97                         03601000
               DISPLAY 'ERROR CLOSING - BP13K350 : ' BP13K350-STATUS    03602000
               MOVE BP13K350-STATUS TO RETURN-CODE                      03603000
               PERFORM 9000-CLOSE-FILES    THRU   9000-EXIT.            03604000
                                                                        03604100
           IF BM06K110-STATUS NOT = 0   AND  97                         03605000
               DISPLAY 'ERROR CLOSING - BM06K110 : ' BM06K110-STATUS    03606000
               MOVE BM06K110-STATUS TO RETURN-CODE                      03607000
               PERFORM 9000-CLOSE-FILES    THRU   9000-EXIT.            03608000
                                                                        03608100
           IF BM06K115-STATUS NOT = 0   AND  97                         03608200
               DISPLAY 'ERROR CLOSING - BM06K115 : ' BM06K115-STATUS    03608300
               MOVE BM06K115-STATUS TO RETURN-CODE                      03608400
               PERFORM 9000-CLOSE-FILES    THRU   9000-EXIT.            03608500
                                                                        03608600
           IF BM06K100-STATUS NOT = 0   AND  97                         03608700
               DISPLAY 'ERROR CLOSING - BM06K100 : ' BM06K100-STATUS    03608800
               MOVE BM06K100-STATUS TO RETURN-CODE                      03608900
               PERFORM 9000-CLOSE-FILES    THRU   9000-EXIT.            03609000
                                                                        03609100
           IF BP13K410-STATUS NOT = 0   AND  97                         03609200
               DISPLAY 'ERROR CLOSING - BP13K410 : ' BP13K410-STATUS    03609300
               MOVE BP13K410-STATUS TO RETURN-CODE                      03609400
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             03609500
                                                                        03609600
           IF BP13K800-STATUS NOT = 0   AND  97                         03609700
               DISPLAY 'ERROR CLOSING - BP13K800 : ' BP13K800-STATUS    03609800
               MOVE BP13K800-STATUS TO RETURN-CODE                      03609900
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             03610000
                                                                        03610100
           IF BP13K893-STATUS NOT = 0   AND  97                         03610200
               DISPLAY 'ERROR CLOSING - BP13K893 : ' BP13K893-STATUS    03610300
               MOVE BP13K893-STATUS TO RETURN-CODE                      03610400
               PERFORM 9000-CLOSE-FILES    THRU  9000-EXIT.             03610500
                                                                        03610600
            STOP RUN.                                                   03611000
                                                                        03620000
       9000-EXIT.                                                       03630000
            EXIT.                                                       03640000
