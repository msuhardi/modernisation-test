       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C127.                                                 
      *AUTHOR.        LKH.                                                      
      *DATE-WRITTEN.  29/03/90.                                                 
      *DATE-COMPILED.                                                           
      **********************************************************                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *                                                        *                
      *    SYSTEM ID : BP13                                    *                
      *                                                        *                
      *    OBJECTIVE :                                         *                
      *      1.  THIS IS A PROGRAM TO PRINT A LIST OF          *                
      *          SOC - AUDIT TRAIL FOR SA ON PAYMENT TYPE 'CD' *                
      *                                                        *                
      *     INPUT FILES:                                       *                
      *      1. CASH TRANS FILE FOR VALIDATED CASES FROM       *                
      *         FIRST SYSTEM                                   *                
      *                                                        *                
      *     LISTING:                                           *                
      *     1. CONTROL LISTING (BP13L127)                      *                
      *     2. MISMATCHED LISTING (L27A)                       *                
      *                                                        *                
      * CHG-NO   BY  ON       DESCRIPTION                      *                
      * -------- --- ------   ------------                     *                
      * SOC-PH8  LSB 230793 - COBOL II                         *                
      * BP130015 SSS 130995 - CONVERT TO LASER PRINT REPORT    *                
      *                       CHG HEADING TO ROW 1 AFTER PAGE  *                
      * BP130418 RHB 250898 - TO CATER FOR Y2000.              *                
      * BP134034 ESA1110211 - TO CATER FOR NEW ERP GL ACCOUNT  *                
      **********************************************************                
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *                                                                         
       INPUT-OUTPUT SECTION.                                                    
      *                                                                         
       FILE-CONTROL.                                                            
           SELECT BP13F120   ASSIGN TO BP13F120.                                
           SELECT BP13L127   ASSIGN TO BP13L127.                                
           SELECT BP13L27A   ASSIGN TO BP13L27A.                                
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD   BP13F120                                                            
            BLOCK  CONTAINS   0 RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            LABEL  RECORD IS STANDARD.                                          
       COPY BP13F120.                                                           
      *                                                                 00630000
      *                                                                         
       FD  BP13L127                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL  RECORDS  ARE OMITTED.                                         
       01  L127-PRINT-REC              PIC X(132).                              
      *                                                                         
       FD  BP13L27A                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL  RECORDS  ARE OMITTED.                                         
       01  L27A-PRINT-REC              PIC X(132).                              
                                                                                
      *                                                                         
       WORKING-STORAGE SECTION.                                                 
      *                                                                         
       01  WS2-COUNTERS.                                                        
           05  WS2-CNT-F120-READ       PIC 9(5)    VALUE ZEROS.                 
           05  WS2-CNT-K020-READ       PIC 9(5)    VALUE ZEROS.                 
           05  WS2-CNT-PRINT-L127      PIC 9(3)    VALUE ZEROS.                 
           05  WS2-CNT-PRINT-L27A      PIC 9(3)    VALUE ZEROS.                 
           05  WS2-CNT-LINE-ON-L127    PIC 9(2)    VALUE 66.                    
           05  WS2-CNT-LINE-ON-L27A    PIC 9(2)    VALUE 66.                    
           05  WS2-CNT-L127-PAGE       PIC 9(5)    VALUE ZEROS.                 
           05  WS2-CNT-L27A-PAGE       PIC 9(5)    VALUE ZEROS.                 
      *                                                                         
       01  WS3-ACCUM-FIELDS.                                                    
           05  WS3-SUBTOT-DRCR-AMT     PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-SUBTOT-DR-AMT       PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-SUBTOT-CR-AMT       PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-TOT-DRCR-AMT        PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-TOT-CR-AMT          PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-TOT-DR-AMT          PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-JR-DRCR-AMT         PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-JR-CR-AMT           PIC S9(9)V99 COMP-3 VALUE +0.            
           05  WS3-JR-DR-AMT           PIC S9(9)V99 COMP-3 VALUE +0.            
      *                                                                         
       01  WS4-SWITCHES-N-RANGE.                                                
           05  WS4-EOF-IND           PIC X(01)   VALUE SPACES.                  
               88 WS4-EOF            VALUE 'Y'.                                 
      *                                                                         
       01  WS5-DATES-VARIABLES.                                                 
           05  WS5-CURRENT-DATE.                                                
               10 WS5-CUR-CC       PIC 99.                                      
               10 WS5-CUR-YY       PIC 99.                                      
               10 WS5-CUR-MM       PIC 99.                                      
               10 WS5-CUR-DD       PIC 99.                                      
           05  WS5-PRT-DATE.                                                    
               10 WS5-PRT-DD       PIC XX.                                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-PRT-MM       PIC XX.                                      
               10 FILLER           PIC X      VALUE '/'.                        
               10 WS5-PRT-CC       PIC XX.                                      
               10 WS5-PRT-YY       PIC XX.                                      
           05  WS5-TRAN-DATE.                                                   
               10  WS5-TRAN-CC     PIC X(02).                                   
               10  WS5-TRAN-YY     PIC X(02).                                   
               10  WS5-TRAN-MM     PIC X(02).                                   
               10  WS5-TRAN-DD     PIC X(02).                                   
                                                                                
       01  WS6-DEFAULT-VALUES.                                                  
           05  WS6-MAX-LINES          PIC 9(02)   VALUE  60.                    
           05  WS6-SR-SLASH           PIC X(01)   VALUE  '/'.                   
           05  WS6-L127-RPT-ID        PIC X(14)   VALUE 'BP13L127'.             
           05  WS6-L27A-RPT-ID        PIC X(14)   VALUE 'BP13L27A'.             
                                                                                
       01  WS7-SCHEME-ACCT.                                                     
           05  WS7-SCH-ACC.                                                     
               10  WS7-SCH-1-4     PIC X(4)    VALUE SPACES.                    
               10  WS7-SCH-5-8     PIC X(4)    VALUE SPACES.                    
               10  WS7-SCH-9-9     PIC X(1)    VALUE SPACES.                    
               10  WS7-SCH-10-11   PIC X(2)    VALUE SPACES.                    
                                                                                
           05  WS7-SCH-ACC-2.                                                   
               10  WS7-SCH-1-4     PIC X(4)    VALUE SPACES.                    
               10  FILLER          PIC X(01)   VALUE '-'.                       
               10  WS7-SCH-5-8     PIC X(4)    VALUE SPACES.                    
               10  FILLER          PIC X(01)   VALUE '-'.                       
               10  WS7-SCH-9-9     PIC X(1)    VALUE SPACES.                    
               10  FILLER          PIC X(01)   VALUE '-'.                       
               10  WS7-SCH-10-11   PIC X(2)    VALUE SPACES.                    
                                                                                
      *------------------------------------------------*                        
      *  GL ACCOUNT CONVERSION BASED ON PAYMENT TYPE   *                        
      *------------------------------------------------*                        
       01  WS8-GL-ACC-DESCRIPTION.                                              
           05  FILLER          PIC X(21) VALUE                                  
              'CD 0 00 00 00 10 4517'.                                          
           05  FILLER          PIC X(21) VALUE                                  
              'MTL0 00 00 00 54 0810'.                                          
       01  WS8-GL-ACC-TABLE REDEFINES WS8-GL-ACC-DESCRIPTION.                   
           05  WS8-GL-ACC      OCCURS 2 TIMES INDEXED BY WS8-IDX.               
               10  WS8-GL-PAYT     PIC X(3).                                    
               10  WS8-GL-ACC-DESC PIC X(18).                                   
                                                                                
       01  WS30-MISCLLANEOUS.                                                   
           05  WS30-PREV-POST-DATE     PIC X(08)   VALUE SPACES.                
           05  WS30-PREV-JRNO          PIC X(09)   VALUE SPACES.                
                                                                                
                                                                                
      **********************************************************                
      *         REPORT LAY-OUT  FOR L127                       *                
      **********************************************************                
                                                                                
      *========================================================*                
      *           FORMAT  FOR  HEADING  OF L127                *                
      *========================================================*                
       01  L127-PRT-HEAD-1.                                                     
           05  L127-HD1-RPT-ID     PIC X(14)   VALUE 'BP13L127'.                
           05  FILLER              PIC X(8)    VALUE 'HDBCAT 3'.                
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'DATE: '.                  
           05  L127-HD1-DATE       PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(1)    VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'PAGE: '.                  
           05  L127-HD1-PAGE-NO    PIC ZZZZ9.                                   
                                                                                
       01  L127-PRT-HEAD-2.                                                     
           05  FILLER              PIC X(30)   VALUE SPACES.                    
           05  FILLER              PIC X(46)   VALUE                            
               'SOC - AUDIT TRAIL FOR POSTED TRANSACTIONS FOR '.                
           05  FILLER              PIC X(30)   VALUE                            
               'ISSUED OF KEY'.                                                 
                                                                                
       01  L127-PRT-HEAD-3.                                                     
           05  FILLER              PIC X(51)   VALUE SPACES.                    
           05  FILLER              PIC X(17)   VALUE                            
              'FOR POSTING DATE '.                                              
           05  L127-HD3-DATE       PIC X(10)   VALUE SPACES.                    
                                                                                
       01  L127-PRT-HEAD-4.                                                     
           05  FILLER              PIC X(48)   VALUE SPACES.                    
           05  FILLER              PIC X(25)   VALUE                            
              'JOURNAL NUMBER ISSUED = '.                                       
           05  L127-HD4-JOURNAL-NO PIC X(09)   VALUE SPACES.                    
                                                                                
       01  L127-PRT-HEAD-5.                                                     
           05  FILLER              PIC X(13)   VALUE SPACES.                    
           05  FILLER              PIC X(11)   VALUE SPACES.                    
           05  FILLER              PIC X(05)   VALUE SPACES.                    
      *    05  FILLER              PIC X(12)   VALUE 'SALES'.                   
           05  FILLER              PIC X(44)   VALUE SPACES.                    
           05  FILLER              PIC X(04)   VALUE 'PAYT'.                    
                                                                                
       01  L127-PRT-HEAD-6.                                                     
           05  FILLER              PIC X(05)   VALUE SPACES.                    
           05  FILLER              PIC X(10)   VALUE 'DATE'.                    
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  FILLER              PIC X(07)   VALUE 'REGN NO'.                 
           05  FILLER              PIC X(05)   VALUE SPACES.                    
      *    05  FILLER              PIC X(12)   VALUE 'REF NO'.                  
           05  FILLER              PIC X(05)   VALUE SPACES.                    
           05  FILLER              PIC X(13)   VALUE 'GL ACCOUNT'.              
           05  FILLER              PIC X(05)   VALUE SPACES.                    
           05  FILLER              PIC X(12)   VALUE 'SCHEME-AC-NO'.            
           05  FILLER              PIC X(09)   VALUE SPACES.                    
           05  FILLER              PIC X(04)   VALUE 'TYPE'.                    
           05  FILLER              PIC X(13)   VALUE SPACES.                    
           05  FILLER              PIC X(16)   VALUE '       AMOUNT'.           
                                                                                
      *========================================================*                
      *           FORMAT  FOR DETAIL LINE                      *                
      *========================================================*                
       01  L127-PRT-DETAIL-1.                                                   
           05  FILLER              PIC X(05)   VALUE SPACES.                    
           05  L127-DATE           PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L127-REGN           PIC X(08)   VALUE SPACES.                    
           05  FILLER              PIC X(05)   VALUE SPACES.                    
      *    05  L127-SALES-REF      PIC X(12)   VALUE SPACES.                    
           05  FILLER              PIC X(02)   VALUE SPACES.                    
           05  L127-GL-ACC         PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(03)   VALUE SPACES.                    
           05  L127-SCH-ACC        PIC X(14)   VALUE SPACES.                    
           05  FILLER              PIC X(07)   VALUE SPACES.                    
           05  L127-PAYT-TYPE      PIC X(03)   VALUE SPACES.                    
           05  FILLER              PIC X(13)   VALUE SPACES.                    
           05  L127-AMOUNT         PIC ZZZ,ZZZ,ZZ9.99.                          
           05  L127-DRCR           PIC X(02).                                   
                                                                                
      *====================================================*                    
      *       FORMAT FOR SUBTOTAL HEADING, DETAIL          *                    
      *====================================================*                    
       01  L127-PRT-SUBTOT-HEAD.                                                
           05  FILLER              PIC X(21)   VALUE SPACES.                    
           05  FILLER              PIC X(25)   VALUE                            
              'SUB TOTAL FOR GL ACCOUNT '.                                      
           05  L127-PRT-SUBTOT-LINE.                                            
               10  L127-SUBTOT-GL-ACC   PIC X(18)   VALUE SPACES.               
               10  FILLER               PIC X(25)   VALUE SPACES.               
               10  L127-SUBTOT-DRCR-AMT PIC ZZZ,ZZZ,ZZ9.99.                     
               10  L127-SUBTOT-DRCR     PIC X(02)   VALUE SPACES.               
                                                                                
       01  L127-PRT-SUBTOT-DASH.                                                
           05  FILLER              PIC X(87)   VALUE SPACES.                    
           05  FILLER              PIC X(18)   VALUE ALL '-'.                   
                                                                                
       01  L127-PRT-JRTOT-HEAD.                                                 
           05  FILLER               PIC X(21)   VALUE SPACES.                   
           05  FILLER               PIC X(29)   VALUE                           
               'SUB TOTAL FOR JOURNAL NUMBER '.                                 
           05  L127-JRNO            PIC X(9).                                   
           05  FILLER               PIC X(30)   VALUE SPACES.                   
           05  L127-JRTOT-DRCR-AMT  PIC ZZZ,ZZZ,ZZ9.99.                         
           05  L127-JRTOT-DRCR      PIC X(02)   VALUE SPACES.                   
                                                                                
      *====================================================*                    
      *        FORMAT FOR TOTAL HEADING AND DETAIL         *                    
      *====================================================*                    
       01  L127-PRT-TOTAL-HEAD.                                                 
           05  FILLER              PIC X(25)   VALUE SPACES.                    
           05  FILLER              PIC X(21)   VALUE                            
              'TOTAL FOR GL ACCOUNT '.                                          
           05  L127-PRT-TOTAL-LINE.                                             
               10  L127-TOTAL-GL-ACC   PIC X(18)   VALUE SPACES.                
               10  FILLER               PIC X(25)   VALUE SPACES.               
               10  L127-TOTAL-DRCR-AMT PIC ZZZ,ZZZ,ZZ9.99.                      
               10  L127-TOTAL-DRCR     PIC X(02)   VALUE SPACES.                
                                                                                
       01  L127-PRT-TOT-HEAD.                                                   
           05  FILLER              PIC X(22)   VALUE SPACES.                    
           05  FILLER              PIC X(24)   VALUE                            
              'TOTAL FOR PYMT TRANS CD '.                                       
           05  L127-PRT-TOT-LINE.                                               
               10  FILLER               PIC X(43)   VALUE SPACES.               
               10  L127-TOT-DRCR-AMT    PIC ZZZ,ZZZ,ZZ9.99.                     
               10  L127-TOT-DRCR        PIC X(02)   VALUE SPACES.               
                                                                                
       01  L127-PRT-GRAND-TOTAL-HEAD-1.                                         
           05  FILLER                  PIC X(30)   VALUE SPACES.                
           05  FILLER                  PIC X(23)   VALUE                        
              'TOTAL DEBITS       =   '.                                        
           05  L127-TOT-DR-AMT         PIC ZZZ,ZZZ,ZZ9.99.                      
                                                                                
       01  L127-PRT-GRAND-TOTAL-HEAD-2.                                         
           05  FILLER                  PIC X(30)   VALUE SPACES.                
           05  FILLER                  PIC X(23)   VALUE                        
              'TOTAL CREDITS      =   '.                                        
           05  L127-TOT-CR-AMT         PIC ZZZ,ZZZ,ZZ9.99.                      
                                                                                
                                                                                
      **********************************************************                
      *         LAY-OUT FOR MISMATCHED LISTING L27A            *                
      **********************************************************                
       01  L27A-PRT-HEAD-4.                                             02740000
           05  FILLER              PIC X(42)   VALUE SPACES.            02750000
           05  FILLER              PIC X(90)   VALUE                    02760000
              ' UNMATCHED LISTING FOR PAYMENT TYPE '.                   02770001
                                                                        02780000
       01  L27A-PRT-HEAD-5.                                             02790000
           05  FILLER              PIC X(02)   VALUE SPACES.            02800000
           05  FILLER              PIC X(06)   VALUE 'SEQ'.             02810001
           05  FILLER              PIC X(03)   VALUE SPACES.            02820001
           05  FILLER              PIC X(13)   VALUE 'PAY TYPE'.        02830001
           05  FILLER              PIC X(10)   VALUE SPACES.            02878001
           05  FILLER              PIC X(10)   VALUE 'REMARKS'.         02879001
                                                                        02880000
       01  L27A-PRT-HEAD-7.                                             02890001
           05  FILLER              PIC X(02)   VALUE SPACES.            02900000
           05  FILLER              PIC X(130)  VALUE ALL '-'.           02910000
                                                                        02920000
       01  L27A-PRT-DETAIL-1.                                           02930000
           05  FILLER              PIC X(02)   VALUE SPACES.            02940000
           05  L27A-NO             PIC ZZZ9.                            02950000
           05  FILLER              PIC X(05)   VALUE SPACES.            02960000
           05  L27A-PAYT-TYPE      PIC X(03)   VALUE SPACES.            02970001
           05  FILLER              PIC X(17)   VALUE SPACES.            03050000
           05  L27A-REMARKS        PIC X(60)   VALUE                    03080000
               'NO MATCHING PAYMENT TYPE IN TABLE OF BP13C127'.         03090001
                                                                                
      *                                                                         
      **********************************************************                
       PROCEDURE DIVISION.                                                      
      **********************************************************                
      *                                                                         
       MAIN-ROUTINE.                                                            
      *=============*                                                           
           PERFORM A-100-OPEN-FILES THRU A-100-EXIT.                            
           PERFORM B-100-READ-BP13F120 THRU B-100-EXIT UNTIL WS4-EOF.           
           PERFORM C-500-PRINT-JR-TOTAL THRU C-500-EXIT.                        
           PERFORM C-600-PRINT-TOTAL THRU C-600-EXIT.                           
           PERFORM D-100-CLOSE-ROUTINE THRU D-100-EXIT.                         
       MAIN-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *                                                                         
       A-100-OPEN-FILES.                                                        
      *=================*                                                       
           OPEN INPUT  BP13F120                                                 
                OUTPUT BP13L127  BP13L27A.                                      
      *                                                                         
           MOVE FUNCTION CURRENT-DATE TO WS5-CURRENT-DATE.                      
           MOVE ZEROS  TO WS30-PREV-POST-DATE.                                  
           MOVE SPACES TO WS30-PREV-JRNO.                                       
      *                                                                         
       A-100-EXIT.                                                              
           EXIT.                                                                
                                                                                
      *                                                                         
       B-100-READ-BP13F120.                                                     
      *====================*                                                    
      **************************************************************            
      *                                                            *            
      *   1. READ FILE BP13F120.                                   *            
      *   2. PROCESS NECESSARY DETAILS FOR PRINTING.               *            
      *   3. CALL ROUTINE TO PRINT REPORT.                         *            
      *                                                            *            
      **************************************************************            
           READ BP13F120                                                        
                AT END MOVE 'Y' TO WS4-EOF-IND                                  
                GO TO B-100-EXIT.                                               
                                                                                
           ADD 1 TO WS2-CNT-F120-READ.                                          
                                                                                
           PERFORM B-200-MOVE-PRT-L127 THRU B-200-EXIT.                         
      *                                                                         
       B-100-EXIT.                                                              
           EXIT.                                                                
                                                                                
                                                                                
      *                                                                         
       B-200-MOVE-PRT-L127.                                                     
      *====================*                                                    
      **********************************************************                
      *                                                        *                
      *   MOVE NECESSARY DETAILS TO REPORT AND PRINT           *                
      *                                                        *                
      **********************************************************                
           MOVE F120-NUM-REGN         TO  L127-REGN.                            
           MOVE F120-DTE-POST         TO  WS5-TRAN-DATE.                        
           MOVE WS5-TRAN-CC           TO  WS5-PRT-CC.                           
           MOVE WS5-TRAN-YY           TO  WS5-PRT-YY.                           
           MOVE WS5-TRAN-MM           TO  WS5-PRT-MM.                           
           MOVE WS5-TRAN-DD           TO  WS5-PRT-DD.                           
           MOVE WS5-PRT-DATE          TO  L127-DATE.                            
           MOVE F120-NUM-SCH-ACCT     TO  WS7-SCH-ACC.                          
           MOVE CORR WS7-SCH-ACC      TO  WS7-SCH-ACC-2.                        
           MOVE WS7-SCH-ACC-2         TO  L127-SCH-ACC.                         
           MOVE F120-CDE-PAYMENT-TYPE TO  L127-PAYT-TYPE.                       
           INSPECT F120-AMT-RECEIPT REPLACING ALL LOW-VALUE                     
                   BY ZEROS.                                                    
           MOVE F120-AMT-RECEIPT      TO  L127-AMOUNT.                          
                                                                                
           MOVE F120-NUM-JRNO TO L127-HD4-JOURNAL-NO.                           
                                                                                
      *--------------------------------------------*                            
      * GET GL ACCOUNT FROM  PAYMENT TYPE          *                            
      *--------------------------------------------*                            
           SET WS8-IDX TO 1.                                                    
           SEARCH WS8-GL-ACC                                                    
                AT END  MOVE SPACES TO L127-GL-ACC                              
                        PERFORM B-300-MOVE-PRT-L27A THRU B-300-EXIT             
             WHEN  WS8-GL-PAYT(WS8-IDX) = F120-CDE-PAYMENT-TYPE                 
                MOVE WS8-GL-ACC-DESC(WS8-IDX) TO L127-GL-ACC.                   
                                                                                
      *-------------------------------------------------------------*           
      * NEGATIVE AMOUNT MEANS DEBIT AND POSITIVE MEANS CREDIT                   
      *   FOR ALL PAYMENT TYPES EXCEPT FOR 'SOC'                                
      * SOC - NEGATIVE AMT MEANS CREDIT AND POSITIVE AMT MEANS DEBIT            
      *-------------------------------------------------------------*           
           IF F120-AMT-RECEIPT > 0                                              
              MOVE 'CR'            TO L127-DRCR                                 
              ADD F120-AMT-RECEIPT TO WS3-SUBTOT-CR-AMT                         
                                      WS3-TOT-CR-AMT                            
           ELSE                                                                 
              MOVE 'DR'            TO L127-DRCR                                 
              ADD F120-AMT-RECEIPT TO WS3-SUBTOT-DR-AMT                         
                                      WS3-TOT-DR-AMT.                           
      *                                                                         
           PERFORM C-100-PRINT THRU C-100-PRINT.                                
      *                                                                         
                                                                                
       B-200-EXIT.                                                              
           EXIT.                                                                
                                                                                
                                                                                
      *                                                                         
       B-300-MOVE-PRT-L27A.                                                     
      *====================*                                                    
      **************************************************************    04670000
      *                                                            *    04680000
      *      PRINT MISTMATCHED LISTING.                            *    04690000
      *                                                            *    04700000
      **************************************************************    04710000
           MOVE WS6-L27A-RPT-ID TO L127-HD1-RPT-ID.                     04720000
      *                                                                 04730000
           PERFORM C-200-CHECK-LINECT THRU C-200-EXIT.                  04740000
      *                                                                 04750000
           ADD 1  TO WS2-CNT-PRINT-L27A                                 04760000
                     WS2-CNT-LINE-ON-L27A.                              04770000
           MOVE WS2-CNT-PRINT-L27A TO L27A-NO.                          04840000
           WRITE L27A-PRINT-REC    FROM L27A-PRT-DETAIL-1 AFTER 1.      04850000
           MOVE SPACES             TO L27A-PRINT-REC.                   04860000
       B-300-EXIT.                                                      04870000
           EXIT.                                                        04880000
                                                                        04890000
                                                                                
      *                                                                         
       C-100-PRINT.                                                             
      *============*                                                            
      ******************************************************************        
      *                                                                *        
      *       PRINT DETAIL LINE FOR REPORT L127                        *        
      *                                                                *        
      ******************************************************************        
           MOVE WS6-L127-RPT-ID       TO L127-HD1-RPT-ID.               04980000
      *                                                                         
           PERFORM C-200-CHECK-LINECT THRU C-200-EXIT.                          
      *                                                                         
           IF F120-AMT-RECEIPT > 0                                              
              ADD F120-AMT-RECEIPT TO WS3-JR-CR-AMT                             
           ELSE                                                                 
              ADD F120-AMT-RECEIPT TO WS3-JR-DR-AMT.                            
      *                                                                         
           ADD 1                   TO WS2-CNT-PRINT-L127                        
                                      WS2-CNT-LINE-ON-L127.                     
           WRITE L127-PRINT-REC    FROM L127-PRT-DETAIL-1 AFTER 1.              
           MOVE SPACES             TO L127-PRINT-REC.                           
      *                                                                         
           ADD 1                   TO WS2-CNT-LINE-ON-L127.                     
                                                                                
       C-100-EXIT.                                                              
           EXIT.                                                                
                                                                                
                                                                                
      *                                                                         
       C-200-CHECK-LINECT.                                                      
      *===================*                                                     
      ******************************************************************        
      *                                                                *        
      *          CHECK LINE COUNT TO DETERMINE PAGE THROW              *        
      *                FOR REPORT                                      *        
      *                                                                *        
      ******************************************************************        
           IF (WS30-PREV-POST-DATE NOT = F120-DTE-POST)                         
              IF (WS30-PREV-POST-DATE NOT = ZEROS)                              
                 PERFORM C-500-PRINT-JR-TOTAL THRU C-500-EXIT                   
                 PERFORM C-400-PRINT-RPT-HEADING THRU C-400-EXIT        05330000
                 MOVE 1 TO WS2-CNT-LINE-ON-L127                         05340000
                 MOVE F120-DTE-POST TO WS30-PREV-POST-DATE                      
                 MOVE F120-NUM-JRNO TO WS30-PREV-JRNO                           
                 MOVE ZEROS TO WS3-JR-DRCR-AMT                                  
                 MOVE ZEROS TO WS3-JR-DR-AMT                                    
                 MOVE ZEROS TO WS3-JR-CR-AMT                                    
              ELSE                                                              
                 MOVE F120-DTE-POST TO WS30-PREV-POST-DATE                      
                 MOVE F120-NUM-JRNO TO WS30-PREV-JRNO.                          
      *                                                                         
           IF (L127-HD1-RPT-ID = WS6-L127-RPT-ID)                       05310000
              IF (WS2-CNT-LINE-ON-L127 > WS6-MAX-LINES)                 05320000
                 PERFORM C-400-PRINT-RPT-HEADING THRU C-400-EXIT        05330000
                 MOVE 1 TO WS2-CNT-LINE-ON-L127.                        05340000
      *                                                                         
                                                                        05300000
           IF (L127-HD1-RPT-ID = WS6-L27A-RPT-ID) AND                   05260000
              (WS2-CNT-LINE-ON-L27A > WS6-MAX-LINES)                    05270000
                PERFORM C-400-PRINT-RPT-HEADING THRU C-400-EXIT         05280000
                MOVE 1 TO WS2-CNT-LINE-ON-L27A.                         05290000
                                                                        05300000
      *                                                                         
       C-200-EXIT.                                                              
           EXIT.                                                                
                                                                                
      *                                                                         
       C-300-PRINT-SUBTOT.                                                      
      *===================*                                                     
      ******************************************************************        
      *                                                                *        
      *       PRINT SUB-TOTAL FOR EACH PAYMENT TYPE                    *        
      *                                                                *        
      ******************************************************************        
           MOVE WS8-GL-ACC-DESC(1) TO   L127-SUBTOT-GL-ACC.                     
           ADD 3                 TO   WS2-CNT-LINE-ON-L127.                     
           WRITE L127-PRINT-REC  FROM L127-PRT-SUBTOT-DASH AFTER 2.             
           MOVE SPACES           TO   L127-PRINT-REC.                           
      *                                                                         
           COMPUTE WS3-SUBTOT-DRCR-AMT = WS3-SUBTOT-DR-AMT +                    
                                         WS3-SUBTOT-CR-AMT.                     
      *                                                                         
           MOVE WS3-SUBTOT-DRCR-AMT TO  L127-SUBTOT-DRCR-AMT.                   
           IF WS3-SUBTOT-DRCR-AMT > 0                                           
              MOVE 'CR' TO L127-SUBTOT-DRCR                                     
           ELSE                                                                 
              MOVE 'DR' TO L127-SUBTOT-DRCR.                                    
                                                                                
           WRITE L127-PRINT-REC   FROM  L127-PRT-SUBTOT-HEAD AFTER 1.           
           ADD 4                  TO    WS2-CNT-LINE-ON-L127.                   
           MOVE SPACES            TO    L127-PRINT-REC.                         
           WRITE L127-PRINT-REC AFTER 2.                                        
                                                                                
      *                                                                         
       C-300-EXIT.                                                              
           EXIT.                                                                
                                                                                
      *                                                                 05660000
       C-400-PRINT-RPT-HEADING.                                         05670000
      *========================*                                        05680000
      ****************************************************************  05690000
      *                                                              *  05700000
      * PRINT HEADING EITHER FOR L127 OR L27A DEPENDING ON INDICATOR *  05710000
      *                                                              *  05720000
      ****************************************************************  05730000
           MOVE WS5-CUR-DD            TO WS5-PRT-DD.                    05760000
           MOVE WS5-CUR-MM            TO WS5-PRT-MM.                    05770000
           MOVE WS5-CUR-CC            TO WS5-PRT-CC.                    05780000
           MOVE WS5-CUR-YY            TO WS5-PRT-YY.                    05780000
                                                                                
           MOVE WS5-PRT-DATE          TO L127-HD1-DATE.                         
                                                                                
           MOVE F120-DTE-POST         TO WS5-TRAN-DATE.                         
           MOVE WS5-TRAN-DD           TO WS5-PRT-DD.                            
           MOVE WS5-TRAN-MM           TO WS5-PRT-MM.                            
           MOVE WS5-TRAN-YY           TO WS5-PRT-YY.                            
           MOVE WS5-TRAN-CC           TO WS5-PRT-CC.                            
           MOVE WS5-PRT-DATE          TO L127-HD3-DATE.                         
      *                                                                 05800000
           IF L127-HD1-RPT-ID = WS6-L127-RPT-ID                         05810000
              MOVE SPACES                TO L127-PRINT-REC              05820001
              ADD  1                     TO WS2-CNT-L127-PAGE           05740000
              MOVE WS2-CNT-L127-PAGE     TO L127-HD1-PAGE-NO            05750000
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-1 AFTER PAGE     05840001
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-2 AFTER 2        05850001
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-3 AFTER 3        05860001
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-4 AFTER 2        05870001
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-5 AFTER 2        05880001
              WRITE L127-PRINT-REC FROM  L127-PRT-HEAD-6 AFTER 1        05881001
              MOVE SPACES          TO    L127-PRINT-REC                 05890001
                                         L127-HD1-RPT-ID                05900001
              WRITE L127-PRINT-REC AFTER 2                              05910000
           ELSE                                                         05920000
              ADD  1                     TO WS2-CNT-L27A-PAGE           05740000
              MOVE WS2-CNT-L127-PAGE     TO L127-HD1-PAGE-NO            05750000
              MOVE SPACES          TO    L27A-PRINT-REC                 05930001
              WRITE L27A-PRINT-REC FROM  L127-PRT-HEAD-1 AFTER PAGE     05950001
              WRITE L27A-PRINT-REC FROM  L127-PRT-HEAD-2 AFTER 2        05960001
              WRITE L27A-PRINT-REC FROM  L127-PRT-HEAD-3 AFTER 3        05970001
              WRITE L27A-PRINT-REC FROM  L27A-PRT-HEAD-4 AFTER 2        05980001
              WRITE L27A-PRINT-REC FROM  L27A-PRT-HEAD-5 AFTER 2        05990001
              MOVE SPACES          TO    L27A-PRINT-REC                 06010001
                                         L127-HD1-RPT-ID                06020001
              WRITE L27A-PRINT-REC AFTER 2.                             06030000
                                                                        06040000
       C-400-EXIT.                                                      06050000
           EXIT.                                                        06060000
                                                                                
       C-500-PRINT-JR-TOTAL.                                                    
            MOVE SPACES TO L127-PRINT-REC.                                      
            WRITE L127-PRINT-REC FROM L127-PRT-SUBTOT-DASH AFTER 2.             
                                                                                
            MOVE SPACES TO L127-PRINT-REC.                                      
            MOVE WS30-PREV-JRNO TO L127-JRNO.                                   
            COMPUTE WS3-JR-DRCR-AMT = WS3-JR-DR-AMT +                           
                                         WS3-JR-CR-AMT.                         
                                                                                
            MOVE WS3-JR-DRCR-AMT TO L127-JRTOT-DRCR-AMT.                        
            IF WS3-JR-DRCR-AMT > 0                                              
               MOVE 'CR' TO L127-JRTOT-DRCR                                     
            ELSE                                                                
               MOVE 'DR' TO L127-JRTOT-DRCR.                                    
                                                                                
            WRITE L127-PRINT-REC FROM L127-PRT-JRTOT-HEAD.                      
                                                                                
       C-500-EXIT.                                                              
           EXIT.                                                                
      *                                                                         
       C-600-PRINT-TOTAL.                                                       
      *==================*                                                      
      ******************************************************************        
      *                                                                *        
      *       PRINT TOTAL FOR ALL TRANSACTIONS AND GRAND TOTAL         *        
      *         FOR DEBTI AND CREDIT AMOUNTS.                          *        
      *                                                                *        
      ******************************************************************        
           PERFORM C-300-PRINT-SUBTOT THRU C-300-EXIT.                          
           PERFORM C-200-CHECK-LINECT THRU C-200-EXIT.                          
      *                                                                         
           MOVE WS8-GL-ACC-DESC(2) TO   L127-TOTAL-GL-ACC.                      
           ADD 3                 TO   WS2-CNT-LINE-ON-L127.                     
           MOVE SPACES           TO   L127-PRINT-REC.                           
      *                                                                         
           COMPUTE WS3-SUBTOT-DRCR-AMT = WS3-SUBTOT-DR-AMT +                    
                                         WS3-SUBTOT-CR-AMT.                     
      *                                                                         
           MOVE WS3-SUBTOT-DRCR-AMT TO  L127-TOTAL-DRCR-AMT.                    
           IF WS3-SUBTOT-DRCR-AMT < 0                                           
              MOVE 'CR' TO L127-TOTAL-DRCR                                      
           ELSE                                                                 
              MOVE 'DR' TO L127-TOTAL-DRCR.                                     
                                                                                
           WRITE L127-PRINT-REC FROM L127-PRT-TOTAL-HEAD.                       
                                                                                
      *                                                                         
      * PRINT TOTAL FOR ALL TRANSACTIONS *                                      
      *                                                                         
           COMPUTE WS3-TOT-DRCR-AMT = WS3-TOT-DR-AMT +                          
                                      WS3-TOT-CR-AMT.                           
           IF WS3-TOT-DRCR-AMT > 0                                              
              MOVE 'CR' TO L127-TOT-DRCR                                        
           ELSE                                                                 
              MOVE 'DR' TO L127-TOT-DRCR.                                       
                                                                                
           MOVE WS3-TOT-DRCR-AMT TO  L127-TOT-DRCR-AMT.                         
           ADD 3                 TO  WS2-CNT-LINE-ON-L127.                      
      *    WRITE L127-PRINT-REC FROM L127-PRT-TOT-HEAD                  .       
      *                              AFTER 2.                           .       
           MOVE SPACES          TO   L127-PRINT-REC.                            
      *                                                                         
      * PRINT GRAND TOTAL FOR DEBIT AND CREDIT AMOUNTS *                        
      *                                                                         
           ADD 4                TO   WS2-CNT-LINE-ON-L127.                      
           MOVE WS3-TOT-DR-AMT  TO   L127-TOT-DR-AMT.                           
           WRITE L127-PRINT-REC FROM L127-PRT-GRAND-TOTAL-HEAD-1        .       
                                     AFTER 3.                           .       
           MOVE SPACES          TO   L127-PRINT-REC.                            
      *    MOVE WS3-TOT-CR-AMT  TO   L127-TOT-CR-AMT.                           
           MOVE WS3-TOT-DR-AMT  TO   L127-TOT-CR-AMT.                           
           WRITE L127-PRINT-REC FROM L127-PRT-GRAND-TOTAL-HEAD-2        .       
                                     AFTER 1.                           .       
           MOVE SPACES          TO   L127-PRINT-REC.                            
                                                                                
      *                                                                         
       C-600-EXIT.                                                              
           EXIT.                                                                
                                                                                
      *                                                                         
       D-100-CLOSE-ROUTINE.                                                     
      *====================*                                                    
      ****************************************************************          
      *                                                              *          
      *            CLOSE FILES AND END PROCESSING                    *          
      *                                                              *          
      ****************************************************************          
           CLOSE BP13F120                                                       
                 BP13L127                                                       
                 BP13L27A.                                                      
      *                                                                         
           DISPLAY ' ** BP13C127 ** '.                                          
           DISPLAY 'NO OF RECORDS READ FROM FILE (BP13F120)  = '                
                   WS2-CNT-F120-READ.                                           
           DISPLAY 'NO OF RECORDS PRINTED (BP13L127) = '                        
                   WS2-CNT-PRINT-L127.                                          
           DISPLAY 'NO OF RECORDS PRINTED (BP13L27A) = '                        
                   WS2-CNT-PRINT-L27A.                                          
           STOP RUN.                                                            
       D-100-EXIT.                                                              
           EXIT.                                                                
