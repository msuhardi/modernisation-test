       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CB01.                                                 
      *AUTHOR.        RACHELLE SAN BUENAVENTURA.                                
      *DATE-WRITTEN.  07/01/2008.                                               
                                                                                
      *================================================================*        
      *               SYSTEM OF COMMITEMENT (BP13)                     *        
      *================================================================*        
      * OBJECTIVES : UPDATE ELIGIBILITY & ALLOCATION SCHEMES.          *        
      *================================================================*        
      * NOTE : BP13SR76 SUBROUTINE IS REFERED THIS PRG, CHANGES SHOULD *        
      * BE REFLECTED THERE.                                            *        
      *                                                                *        
      * FILE DESCRIPTION :-                                            *        
      *                                                                *        
      * DD NAME   I/O/E ACCESSMODE  RECLEN KEY          REMARKS        *        
      *----------------------------------------------------------------*        
      * BP13FB78  I     SEQUENTIAL  3300                               *        
      * P13FB78A  O     SEQUENTIAL  3300                               *        
      *================================================================*        
      * CHGE REF #       DATE       AUTHOR  REMARKS                    *        
      *----------------------------------------------------------------*        
      * BP133158         07/01/2008 RB12    NEW PROGRAM                *        
      *================================================================*        
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13FB78 ASSIGN TO BP13FB78.                                  
                                                                                
           SELECT BP13K730 ASSIGN    TO BP13K730                                
                  ACCESS MODE        IS RANDOM                                  
                  ORGANIZATION       IS INDEXED                                 
                  RECORD KEY         IS K730-NUM-REGN                           
                  FILE STATUS        IS WS-K730-STATUS.                         
                                                                                
                                                                                
      ****************************************************************          
       DATA DIVISION.                                                           
      ****************************************************************          
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   BP13FB78     BLOCK CONTAINS 0 RECORDS                               
                         RECORD CONTAINS 3300 CHARACTERS                        
                         LABEL RECORDS ARE STANDARD                             
                         RECORDING MODE IS F.                                   
       COPY BP13FB78.                                                           
                                                                                
       FD   BP13K730                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K730.                                                           
                                                                                
      ****************************************************************          
       WORKING-STORAGE SECTION.                                                 
      ****************************************************************          
                                                                                
       01  WS-CUR-DATE.                                                         
           05  WS-CUR-CCYY                PIC 9(04).                            
           05  WS-CUR-MM                  PIC 9(02).                            
           05  WS-CUR-DD                  PIC 9(02).                            
                                                                                
       01  WS-EDT-DATE.                                                         
           05  WS-EDT-DD                  PIC 9(02).                            
           05  FILLER                     PIC X(01) VALUE '/'.                  
           05  WS-EDT-MM                  PIC 9(02).                            
           05  FILLER                     PIC X(01) VALUE '/'.                  
           05  WS-EDT-CCYY                PIC 9(04).                            
                                                                                
       01  WS-TMP-YEAR                    PIC 9(04).                            
                                                                                
       01  FILE-COUNTERS.                                                       
           05  BP13FB78-READ              PIC 9(08) VALUE ZEROES.               
           05  BP13K730-FOUND             PIC 9(08) VALUE ZEROES.               
           05  BP13K730-SKIPPED           PIC 9(08) VALUE ZEROES.               
           05  BP13K730-NOT-FOUND         PIC 9(08) VALUE ZEROES.               
           05  BP13K730-REWRITE           PIC 9(08) VALUE ZEROES.               
                                                                                
       01  FILE-STATUS.                                                         
           05  WS-K730-STATUS             PIC 9(02) VALUE ZEROES.               
                                                                                
      *    FILE-FLAGS.                                                          
       01  BP13FB78-FLAG                  PIC X(01).                            
           88  BP13FB78-EOF               VALUE 'Y'.                            
                                                                                
      *    FILE-FLAGS.                                                          
       01  BP13K730-REWRITE-FLAG          PIC X(01) VALUE SPACES.               
                                                                                
      *---------------------------------------------------------------*         
      * FLAGS TO DETERMINED THE SCHEME                                *         
      *---------------------------------------------------------------*         
                                                                                
       01  SINGLE-APP2-OCC-FIANCE-FLAG    PIC X(01).                            
           88  SINGLE-APP2-OCC-FIANCE     VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-SINGLE-SIB-FLAG       PIC X(01).                            
           88  APP2-OCC-SINGLE-SIB        VALUE 'Y'.                            
                                                                                
       01  YES-PARENT-IN-APPS-FLAG        PIC X(01).                            
           88  YES-PARENT-IN-APPS         VALUE 'Y'.                            
                                                                                
       01  CHILD-IN-OCC-FLAG              PIC X(01).                            
           88  CHILD-IN-OCC               VALUE 'Y'.                            
                                                                                
       01  APP1-CHILD-GRANDCH-SINGLE-FLAG PIC X(01).                            
           88  APP1-CHILD-GRANDCH-SINGLE  VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-CHILD-SINGLE-FLAG     PIC X(01).                            
           88  APP2-OCC-CHILD-SINGLE      VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-CHILD-SINGLE-B21-FLAG PIC X(01).                            
           88  APP2-OCC-CHILD-SINGLE-B21  VALUE 'Y'.                            
                                                                                
       01  APP1-SINGLE-CHILD-FLAG         PIC X(01).                            
           88  APP1-SINGLE-CHILD          VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-SINGLE-PARENT-FLAG    PIC X(01).                            
           88  APP2-OCC-SINGLE-PARENT     VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-ADOPT-PARENTS-FLAG    PIC X(01).                            
           88  APP2-OCC-ADOPT-PARENTS     VALUE 'Y'.                            
                                                                                
       01  APP2-OCC-ADOPT-CHILD-FLAG      PIC X(01).                            
           88  APP2-OCC-ADOPT-CHILD       VALUE 'Y'.                            
                                                                                
       01  OCC-MARRIED-NON-CITIZEN-FLAG   PIC X(01).                            
           88  OCC-MARRIED-NON-CITIZEN    VALUE 'Y'.                            
                                                                                
      * FREQUENTLY USED FLAGS.                                                  
       01  APP1-MARITAL-FLAG              PIC X(01).                            
           88  APP1-SINGLE                VALUE '1', 'S',                       
                                                '3', 'W',                       
                                                '4', 'D',                       
                                                '5', 'P'.                       
           88  APP1-SINGLE-PAS            VALUE '1', 'S'.                       
           88  APP1-MARRIED               VALUE '2', 'M'.                       
           88  APP1-OTHERS                VALUE '3', 'W',                       
                                                '4', 'D',                       
                                                '5', 'P'.                       
           88 APP1-ORPHAN                 VALUE 'O'.                            
                                                                                
       01  SPOUSE-YES-FLAG                PIC X(01).                            
           88  SPOUSE-YES                 VALUE 'Y'.                            
                                                                                
       01  NON-CITI-SPOUSE-FLAG           PIC X(01).                            
           88 NON-CITI-SPOUSE             VALUE 'Y'.                            
                                                                                
       01  PARENTS-YES-FLAG               PIC X(01).                            
           88  PARENTS-YES                VALUE 'Y'.                            
                                                                                
       01  NON-CITI-PARENT-FLAG           PIC X(01).                            
           88 NON-CITI-PARENT             VALUE 'Y'.                            
                                                                                
       01  CITIZEN-PARENT-FLAG            PIC X(01).                            
           88 CITIZEN-PARENT              VALUE 'Y'.                            
                                                                                
       01  BRO-SIS-YES-FLAG               PIC X(01).                            
           88  BRO-SIS-YES                VALUE 'Y'.                            
                                                                                
       01  CITIZEN-BRO-SIS-FLAG           PIC X(01).                            
           88 CITIZEN-BRO-SIS             VALUE 'Y'.                            
                                                                                
       01  CHILD-YES-FLAG                 PIC X(01).                            
           88  CHILD-YES                  VALUE 'Y'.                            
                                                                                
       01  CITIZEN-CHILD-FLAG             PIC X(01).                            
           88 CITIZEN-CHILD               VALUE 'Y'.                            
                                                                                
       01  GCHILD-YES-FLAG                PIC X(01).                            
           88  GCHILD-YES                 VALUE 'Y'.                            
                                                                                
       01  ABOVE-21-FLAG                  PIC X(01).                            
           88  ABOVE-21                   VALUE 'Y'.                            
                                                                                
      * VARIABLES FOR CALCULATING THE AGE.                                      
       01  WS-AGE-VARS.                                                         
           05  WS-CNT-MONTHS              PIC 9(04) VALUE ZEROES.               
           05  WS-CONTROL-MONTH           PIC 9(03) VALUE 252.                  
           05  WS-DOB                     PIC X(08) VALUE SPACES.               
           05  WS-NUM-DOB REDEFINES WS-DOB.                                     
               10 WS-DOB-CCYY             PIC 9(04).                            
               10 WS-DOB-MM               PIC 9(02).                            
               10 WS-DOB-DD               PIC 9(02).                            
                                                                                
      * VARIABLES TO STORE THE SCHEME BEFORE MOVING TO FB78A.                   
       01  WS-DETERMINED-SCHEME.                                                
           05  WS-ELIG-SCH                PIC X(03).                            
           05  WS-ALLO-SCH                PIC X(03).                            
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-CNT-CHILD               PIC 9(02) VALUE ZEROES.               
           05  WS-CNT-PARENT              PIC 9(02) VALUE ZEROES.               
           05  WS-CNT-SPOUSE              PIC 9(02) VALUE ZEROES.               
           05  WS-CNT                     PIC 9(01) VALUE ZEROES.               
           05  WS-CNT-OUTOF-CRIT          PIC 9(01) VALUE ZEROES.               
                                                                                
       01  WS-TAB-OCCUP-DET.                                                    
           05  WS-REL-AGE OCCURS 8 TIMES.                                       
               10 WS-REL                  PIC X(02) VALUE SPACES.               
               10 WS-DTE-BIRTH.                                                 
                  15 WS-DTE-CCYY          PIC 9(04) VALUE ZEROES.               
                  15 WS-DTE-MM            PIC 9(02) VALUE ZEROES.               
                  15 WS-DTE-DD            PIC 9(02) VALUE ZEROES.               
               10 WS-MRTL                 PIC X(01) VALUE SPACES.               
                                                                                
       01  WS-OTHERS.                                                           
           05  WS-EDT-VAR                 PIC ZZ,ZZZ,ZZ9.                       
           05  WS-DTE-TCP-CONTROL         PIC X(08) VALUE '19870101'.           
           05  WS-CNT-APPLT               PIC 9(02) VALUE ZEROES.               
           05  WS-SA-IND                  PIC X(01) VALUE 'N'.                  
                                                                                
      ****************************************************************          
       PROCEDURE DIVISION.                                                      
      ****************************************************************          
                                                                                
      *==============================================================*          
       0000-MAIN.                                                               
      *==============================================================*          
                                                                                
           PERFORM 1000-OPEN-FILES        THRU 1000-EXIT.                       
                                                                                
           PERFORM 2000-MAIN-ROUTINE      THRU 2000-EXIT                        
                   UNTIL BP13FB78-EOF.                                          
                                                                                
           PERFORM 9000-CLOSE-FILES       THRU 9000-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       1000-OPEN-FILES.                                                         
      *==============================================================*          
                                                                                
           OPEN INPUT  BP13FB78                                                 
                I-O    BP13K730.                                                
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K730 - OPEN ERROR ' WS-K730-STATUS                   
              MOVE    WS-K730-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CUR-DATE.                      
                                                                                
           MOVE WS-CUR-CCYY TO WS-EDT-CCYY.                                     
           MOVE WS-CUR-MM   TO WS-EDT-MM.                                       
           MOVE WS-CUR-DD   TO WS-EDT-DD.                                       
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       2000-MAIN-ROUTINE.                                                       
      *==============================================================*          
                                                                                
           MOVE SPACES TO BP13FB78-REC.                                         
                                                                                
           READ BP13FB78 AT END                                                 
                MOVE 'Y' TO BP13FB78-FLAG                                       
                GO TO 2000-EXIT.                                                
                                                                                
           IF FB78-NUM-REGN = SPACES OR LOW-VALUES                              
              GO TO 2000-EXIT                                                   
           END-IF.                                                              
                                                                                
           ADD 1 TO BP13FB78-READ.                                              
                                                                                
           PERFORM 3000-PROCESS-REC       THRU 3000-EXIT.                       
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       3000-PROCESS-REC.                                                        
      *==============================================================*          
      *--------------------------------------------------------------*          
      * 1. READ BP13FB78.                                            *          
      * 2. DETERMINE THE ELIGIBILITY/ALLOCATION SCHEME.              *          
      * 3. WRITE BP13FB78 REC WITH ELIG/ALLOC SCHEME.                *          
      *--------------------------------------------------------------*          
      *--  *CONTROL GOES THRU ALL CHECKING PARAS. START FROM 4000 .             
      *--  *INITIALIZE THE VARIABLES.                                           
           MOVE SPACES TO WS-ELIG-SCH WS-ALLO-SCH.                              
                                                                                
           PERFORM 3100-STORE-STATUS      THRU 3100-EXIT.                       
      *** IMPORTANT NOTE 4120-EXIT SHOULD BE END OF ALL CRITERIA.               
           PERFORM 4000-DETERMINE-SCHEMES THRU 4120-EXIT.                       
                                                                                
      * +------------------+-----------------------------------------+          
      * ¦ MARITAL STATUS   ¦ RELATIONSHIP                            ¦          
      * +------------------+-----------------------------------------+          
      * ¦ 1 OR S - SINGLE  ¦ 06 - BROTHER/SISTERS                    ¦          
      * ¦ 2 OR M - MARRIED ¦ 09 - FIANCE                             ¦          
      * ¦                  ¦ 02 - FATHER  12 - MOTHER                ¦          
      * ¦                  ¦ 41 - CHILD                              ¦          
      * +------------------+-----------------------------------------+          
           EVALUATE TRUE                                                        
      *         ~ NON CITIZEN SPOUSE ~                                          
      *         ~ WITH CITIZEN CHILD ~                                          
           WHEN APP1-MARRIED AND NON-CITI-SPOUSE AND CITIZEN-CHILD              
             MOVE 'PA ' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ NON CITIZEN SPOUSE ~                                          
           WHEN APP1-MARRIED AND NON-CITI-SPOUSE AND CITIZEN-PARENT             
           WHEN APP1-MARRIED AND NON-CITI-SPOUSE AND CITIZEN-BRO-SIS            
           WHEN OCC-MARRIED-NON-CITIZEN AND CITIZEN-BRO-SIS AND                 
                APP1-SINGLE                                                     
             MOVE 'NCS' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ NON CITIZEN PARENT ~                                          
      *  **THERE IS 1 NON-CITIZEN PARENT OR BOTH NON-CITIZEN PARENTS**          
           WHEN APP1-SINGLE AND APP2-OCC-SINGLE-SIB AND NON-CITI-PARENT         
                            AND NOT CITIZEN-PARENT                              
             MOVE 'NCP' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ PUBLIC APPLICATION WITH SINGLE CHILD ~                        
           WHEN APP1-SINGLE-PAS   AND APP2-OCC-CHILD-SINGLE                     
           WHEN APP1-SINGLE-CHILD AND APP2-OCC-SINGLE-PARENT                    
             MOVE 'PAS' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ SINGLE MOTHER WITH PARENT ~                                   
           WHEN APP1-SINGLE-PAS AND CITIZEN-PARENT AND                          
                APP2-OCC-CHILD-SINGLE-B21                                       
           WHEN APP1-CHILD-GRANDCH-SINGLE                                       
             MOVE 'SMP' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ PUBLIC APPLICATION WITH ADOPTIVE CHILD ~                      
           WHEN APP1-SINGLE AND APP2-OCC-ADOPT-PARENTS                          
           WHEN APP1-SINGLE AND APP2-OCC-ADOPT-CHILD                            
             MOVE 'PAA' TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ ORPHAN SCHEME ~                                               
           WHEN APP1-ORPHAN                                                     
             MOVE 'OR'  TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ FIANCE/FIANCEE SCHEME ~                                       
           WHEN APP1-SINGLE AND SINGLE-APP2-OCC-FIANCE                          
             MOVE 'FS'  TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
      *         ~ PUBLIC APPLICATION ~                                          
           WHEN APP1-MARRIED AND SPOUSE-YES                                     
           WHEN APP1-SINGLE  AND PARENTS-YES AND BRO-SIS-YES                    
           WHEN APP1-SINGLE  AND PARENTS-YES AND NOT CHILD-YES                  
           WHEN APP1-OTHERS  AND CHILD-YES                                      
             MOVE 'PA'  TO WS-ELIG-SCH                                          
             MOVE 'PA'  TO WS-ALLO-SCH                                          
                                                                                
           END-EVALUATE.                                                        
                                                                                
           IF FB78-NUM-FLAT-TYPE = '1A'                                         
              PERFORM 3020-CNT-APPLTS THRU 3020-EXIT                            
              IF WS-CNT-APPLT = 1                                               
                 MOVE 'SS'            TO   WS-ELIG-SCH                          
                 MOVE 'PA'            TO   WS-ALLO-SCH                          
              ELSE                                                              
                 IF WS-SA-IND = 'Y'                                             
                    MOVE 'PA'         TO   WS-ELIG-SCH                          
                    MOVE 'PA'         TO   WS-ALLO-SCH                          
                 ELSE                                                           
                    MOVE 'SS'         TO   WS-ELIG-SCH                          
                    MOVE 'PA'         TO   WS-ALLO-SCH                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 5500-UPDATE-BP13K730   THRU 5500-EXIT.                       
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       3020-CNT-APPLTS.                                                         
      *==============================================================*          
           INITIALIZE            WS-CNT-APPLT.                                  
           MOVE 'N'           TO WS-SA-IND.                                     
                                                                                
           IF FB78-NUM-APPLT1-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-APPLT2-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-APPLT3-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-APPLT4-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-OCCUP1-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-OCCUP2-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-OCCUP3-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-OCCUP4-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF FB78-NUM-OCCUP5-UIN NOT = SPACES AND LOW-VALUES                   
              ADD 1           TO WS-CNT-APPLT                                   
           END-IF.                                                              
                                                                                
           IF WS-CNT-APPLT > 1                                                  
              IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '20' OR                      
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39') OR               
                 (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '20' OR                       
                 '41' OR '09' OR '02' OR '12' OR '38' OR '39'))                 
                    MOVE 'Y' TO WS-SA-IND                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3020-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       3100-STORE-STATUS.                                                       
      *==============================================================*          
      *--------------------------------------------------------------*          
      * STORE THE REL IN ARRAY, EASY TO CHECK FOR A PARTICULAR REL   *          
      *--------------------------------------------------------------*          
                                                                                
           INITIALIZE WS-TAB-OCCUP-DET.                                         
                                                                                
           MOVE FB78-NUM-OCCUP1-RLTNSP-APPLT1 TO WS-REL(1).                     
           MOVE FB78-NUM-OCCUP2-RLTNSP-APPLT1 TO WS-REL(2).                     
           MOVE FB78-NUM-OCCUP3-RLTNSP-APPLT1 TO WS-REL(3).                     
           MOVE FB78-NUM-OCCUP4-RLTNSP-APPLT1 TO WS-REL(4).                     
           MOVE FB78-NUM-OCCUP5-RLTNSP-APPLT1 TO WS-REL(5).                     
           MOVE FB78-NUM-OCCUP6-RLTNSP-APPLT1 TO WS-REL(6).                     
           MOVE FB78-NUM-OCCUP7-RLTNSP-APPLT1 TO WS-REL(7).                     
           MOVE FB78-NUM-OCCUP8-RLTNSP-APPLT1 TO WS-REL(8).                     
                                                                                
           MOVE FB78-DTE-OCCUP1-BIRTH         TO WS-DTE-BIRTH(1).               
           MOVE FB78-DTE-OCCUP2-BIRTH         TO WS-DTE-BIRTH(2).               
           MOVE FB78-DTE-OCCUP3-BIRTH         TO WS-DTE-BIRTH(3).               
           MOVE FB78-DTE-OCCUP4-BIRTH         TO WS-DTE-BIRTH(4).               
           MOVE FB78-DTE-OCCUP5-BIRTH         TO WS-DTE-BIRTH(5).               
           MOVE FB78-DTE-OCCUP6-BIRTH         TO WS-DTE-BIRTH(6).               
           MOVE FB78-DTE-OCCUP7-BIRTH         TO WS-DTE-BIRTH(7).               
           MOVE FB78-DTE-OCCUP8-BIRTH         TO WS-DTE-BIRTH(8).               
                                                                                
           MOVE FB78-NUM-OCCUP1-MARITAL-STATUS TO WS-MRTL(1)                    
           MOVE FB78-NUM-OCCUP2-MARITAL-STATUS TO WS-MRTL(2)                    
           MOVE FB78-NUM-OCCUP3-MARITAL-STATUS TO WS-MRTL(3)                    
           MOVE FB78-NUM-OCCUP4-MARITAL-STATUS TO WS-MRTL(4)                    
           MOVE FB78-NUM-OCCUP5-MARITAL-STATUS TO WS-MRTL(5)                    
           MOVE FB78-NUM-OCCUP6-MARITAL-STATUS TO WS-MRTL(6)                    
           MOVE FB78-NUM-OCCUP7-MARITAL-STATUS TO WS-MRTL(7)                    
           MOVE FB78-NUM-OCCUP8-MARITAL-STATUS TO WS-MRTL(8)                    
                                                                                
           MOVE SPACES TO APP1-MARITAL-FLAG.                                    
      **   DETERMINE WHETHER APP1 IS SINGLE OR MARRIED OR WIDOW                 
      **                      - OR DIVORCED OR SEPERATED.                       
           MOVE FB78-NUM-APPLT1-MARITAL-STATUS                                  
                                          TO APP1-MARITAL-FLAG.                 
                                                                                
      **   DETERMINE WHETHER APP1 HAS SPOUSE.                                   
           MOVE SPACES TO SPOUSE-YES-FLAG                                       
           IF FB78-NUM-APPLT2-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-APPLT3-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-APPLT4-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '20' OR                           
              FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '20'                              
              MOVE 'Y' TO SPOUSE-YES-FLAG                                       
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS NON CITIZEN SPOUSE.                       
           MOVE SPACES TO NON-CITI-SPOUSE-FLAG                                  
           IF ((FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '20' AND                        
               (FB78-NUM-OCCUP1-CITIZENSHIP NOT = '10' AND '20')) OR            
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '20' AND                        
               (FB78-NUM-OCCUP2-CITIZENSHIP NOT = '10' AND '20')) OR            
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '20' AND                        
               (FB78-NUM-OCCUP3-CITIZENSHIP NOT = '10' AND '20')) OR            
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '20' AND                        
               (FB78-NUM-OCCUP4-CITIZENSHIP NOT = '10' AND '20')) OR            
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '20' AND                        
               (FB78-NUM-OCCUP5-CITIZENSHIP NOT = '10' AND '20')))              
              MOVE 'Y' TO NON-CITI-SPOUSE-FLAG                                  
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS PARENT.                                   
           MOVE SPACES TO PARENTS-YES-FLAG                                      
           IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '02' OR  '12'))                 
              MOVE 'Y' TO PARENTS-YES-FLAG                                      
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS NON CITIZEN PARENT AS AN                  
      **   OCCUPIER.                                                            
           MOVE SPACES TO NON-CITI-PARENT-FLAG.                                 
           IF (((FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP1-CITIZENSHIP NOT = '10' AND '20'))  OR          
               ((FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP2-CITIZENSHIP NOT = '10' AND '20'))  OR          
               ((FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP3-CITIZENSHIP NOT = '10' AND '20'))  OR          
               ((FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP4-CITIZENSHIP NOT = '10' AND '20'))  OR          
               ((FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP5-CITIZENSHIP NOT = '10' AND '20')))             
                 MOVE 'Y' TO NON-CITI-PARENT-FLAG                               
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS CITIZEN PARENT.                           
           MOVE SPACES TO CITIZEN-PARENT-FLAG.                                  
           IF (((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-APPLT2-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-APPLT3-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-APPLT3-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-APPLT4-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-APPLT4-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP1-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP2-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP3-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP4-CITIZENSHIP   = '10' OR  '20'))  OR            
               ((FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '02' OR  '12') AND             
                (FB78-NUM-OCCUP5-CITIZENSHIP   = '10' OR  '20')))               
                 MOVE 'Y' TO CITIZEN-PARENT-FLAG                                
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS BROTHER/SISTER.                           
           MOVE SPACES TO BRO-SIS-YES-FLAG.                                     
           IF FB78-NUM-APPLT2-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-APPLT3-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-APPLT4-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '06' OR                           
              FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '06'                              
              MOVE 'Y' TO BRO-SIS-YES-FLAG                                      
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS CITIZEN BROTHER/SISTER.                   
           MOVE SPACES TO CITIZEN-BRO-SIS-FLAG.                                 
           IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-APPLT2-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-APPLT3-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-APPLT4-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-OCCUP1-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-OCCUP2-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-OCCUP3-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-OCCUP4-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '06' AND                        
               (FB78-NUM-OCCUP5-CITIZENSHIP  = '10' OR '20')))                  
              MOVE 'Y' TO CITIZEN-BRO-SIS-FLAG                                  
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS CHILD.                                    
           MOVE SPACES TO CHILD-YES-FLAG.                                       
           IF FB78-NUM-APPLT2-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-APPLT3-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-APPLT4-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '41' OR                           
              FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '41'                              
              MOVE 'Y' TO CHILD-YES-FLAG                                        
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS CITIZEN CHILD.                            
           MOVE SPACES TO CITIZEN-CHILD-FLAG.                                   
           IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-APPLT2-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-APPLT3-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-APPLT4-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-OCCUP1-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-OCCUP2-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-OCCUP3-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-OCCUP4-CITIZENSHIP  = '10' OR '20')) OR                
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '41' AND                        
               (FB78-NUM-OCCUP5-CITIZENSHIP  = '10' OR '20')))                  
              MOVE 'Y' TO CITIZEN-CHILD-FLAG                                    
           END-IF.                                                              
                                                                                
      **   DETERMINE WHETHER APP1 HAS GRAND CHILD.                              
           MOVE SPACES TO GCHILD-YES-FLAG.                                      
           IF FB78-NUM-APPLT2-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-APPLT3-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-APPLT4-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '43' OR                           
              FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '43'                              
              MOVE 'Y' TO GCHILD-YES-FLAG                                       
           END-IF.                                                              
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4000-DETERMINE-SCHEMES.                                                  
      *==============================================================*          
      *--------------------------------------------------------------*          
      * JUST START THE CHECKING TO DETERMINE THE ELIG,ALLO                      
      *--------------------------------------------------------------*          
           EXIT.                                                                
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4010-SINGLE-APP2-OR-OCC-FIANCE.                                          
      *==============================================================*          
      *--------------------------------------------------------------*          
      * APP2 OR OCCUPIER SHOULD BE SINGLE WHERE THE REL IS FIANCE.   *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO SINGLE-APP2-OCC-FIANCE-FLAG.                          
                                                                                
           IF ((FB78-NUM-APPLT2-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-APPLT2-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-APPLT3-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-APPLT3-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-APPLT4-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-APPLT4-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP1-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP1-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP2-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP2-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP3-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP3-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP4-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP4-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP5-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP5-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP6-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP6-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP7-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP7-RLTNSP-APPLT1  = '09')) OR               
              ((FB78-NUM-OCCUP8-MARITAL-STATUS = '1' OR 'S'                     
                  OR '3' OR 'W' OR '4' OR 'D' OR '5' OR 'P')                    
                  AND (FB78-NUM-OCCUP8-RLTNSP-APPLT1  = '09'))                  
              MOVE 'Y' TO SINGLE-APP2-OCC-FIANCE-FLAG                           
           END-IF.                                                              
                                                                                
       4010-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4020-APP2-OR-OCC-SINGLE-SIB.                                             
      *==============================================================*          
      *--------------------------------------------------------------*          
      * APPL2 OR OCCUPIER SHOULD BE SINGLE WHERE THE REL IS SIBILING *          
      * CODE BROTHER/SISTER                                          *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP2-OCC-SINGLE-SIB-FLAG.                             
                                                                                
           IF ((FB78-NUM-APPLT2-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-APPLT2-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-APPLT3-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-APPLT3-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-APPLT4-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-APPLT4-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP1-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP1-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP2-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP2-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP3-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP3-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP4-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP4-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP5-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP5-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP6-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP6-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP7-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP7-RLTNSP-APPLT1  = '06')) OR               
              ((FB78-NUM-OCCUP8-MARITAL-STATUS = '1' OR 'S')                    
                  AND (FB78-NUM-OCCUP8-RLTNSP-APPLT1  = '06'))                  
              MOVE 'Y' TO APP2-OCC-SINGLE-SIB-FLAG                              
           END-IF.                                                              
                                                                                
       4020-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4030-YES-PARENT-IN-APP.                                                  
      *==============================================================*          
      *--------------------------------------------------------------*          
      * IF THERE ARE PARENTS IN APPLICATIONS.                        *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO YES-PARENT-IN-APPS-FLAG.                              
                                                                                
           IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '02' OR  '12') OR               
               (FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '02' OR  '12'))                 
              MOVE 'Y' TO YES-PARENT-IN-APPS-FLAG                               
           END-IF.                                                              
                                                                                
       4030-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4050-CHILD-IN-OCC.                                                       
      *==============================================================*          
      *--------------------------------------------------------------*          
      * LOOK FOR IS THERE ANY CHILD ONLY IN OCCUPIERS.               *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO CHILD-IN-OCC-FLAG.                                    
                                                                                
           IF (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP6-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP7-RLTNSP-APPLT1 = '41') OR                         
              (FB78-NUM-OCCUP8-RLTNSP-APPLT1 = '41')                            
              MOVE 'Y' TO CHILD-IN-OCC-FLAG                                     
           END-IF.                                                              
                                                                                
       4050-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4060-APP2-OR-OCC-CHILD-SINGLE.                                           
      *==============================================================*          
      *--------------------------------------------------------------*          
      * APP2 OR OCCUPIER IS SINGLE CHILD ABOVE 21 YEARS OLD          *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP2-OCC-CHILD-SINGLE-FLAG.                           
           MOVE SPACES TO APP2-OCC-CHILD-SINGLE-B21-FLAG.                       
                                                                                
           IF NOT CHILD-YES                                                     
              GO TO 4060-EXIT                                                   
           END-IF.                                                              
                                                                                
      **   * CHECK WHETHER APP2 IS SINGLE AND AGE IS ABOVE 21.                  
           IF (FB78-NUM-APPLT2-MARITAL-STATUS = '1' OR 'S') AND                 
               FB78-NUM-APPLT2-RLTNSP-APPLT1 = '41'                             
              MOVE FB78-DTE-APPLT2-BIRTH     TO WS-DOB                          
              PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT                     
                                                                                
              IF ABOVE-21                                                       
                 MOVE 'Y' TO APP2-OCC-CHILD-SINGLE-FLAG                         
                 GO TO 4060-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      **   * CHECK WHETHER APP3 IS SINGLE AND AGE IS ABOVE 21.                  
           IF (FB78-NUM-APPLT3-MARITAL-STATUS = '1' OR 'S') AND                 
               FB78-NUM-APPLT2-RLTNSP-APPLT1 = '41'                             
              MOVE FB78-DTE-APPLT3-BIRTH     TO WS-DOB                          
                                                                                
              PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT                     
                                                                                
              IF ABOVE-21                                                       
                 MOVE 'Y' TO APP2-OCC-CHILD-SINGLE-FLAG                         
                 GO TO 4060-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      **   * CHECK WHETHER APP4 IS SINGLE AND AGE IS ABOVE 21.                  
           IF (FB78-NUM-APPLT4-MARITAL-STATUS = '1' OR 'S') AND                 
               FB78-NUM-APPLT2-RLTNSP-APPLT1 = '41'                             
              MOVE FB78-DTE-APPLT4-BIRTH     TO WS-DOB                          
              PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT                     
                                                                                
              IF ABOVE-21                                                       
                 MOVE 'Y' TO APP2-OCC-CHILD-SINGLE-FLAG                         
                 GO TO 4060-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
      **   * CHECK WHETHER OCCP IS SINGLE AND AGE IS ABOVE 21.                  
           PERFORM VARYING WS-CNT FROM 1 BY 1 UNTIL WS-CNT > 8                  
              IF WS-REL(WS-CNT) = '41' AND                                      
                 ( WS-MRTL(WS-CNT) = 'S' OR '1')                                
                 MOVE WS-DTE-BIRTH(WS-CNT)      TO WS-DOB                       
                 PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT                  
                                                                                
                 IF ABOVE-21                                                    
                    MOVE 'Y' TO APP2-OCC-CHILD-SINGLE-FLAG                      
                    GO TO 4060-EXIT                                             
                 ELSE                                                           
                    MOVE 'Y' TO APP2-OCC-CHILD-SINGLE-B21-FLAG                  
                    GO TO 4060-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
       4060-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4070-APP1-SINGLE-CHILD.                                                  
      *==============================================================*          
      *--------------------------------------------------------------*          
      * APPLICANT 1 IS SINGLE CHILD ABOVE 21 YEARS OLD.              *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP1-SINGLE-CHILD-FLAG.                               
                                                                                
           MOVE FB78-DTE-APPLT1-BIRTH     TO WS-DOB.                            
           PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT.                       
                                                                                
           IF APP1-SINGLE AND ABOVE-21                                          
              MOVE 'Y' TO APP1-SINGLE-CHILD-FLAG                                
           END-IF.                                                              
                                                                                
       4070-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==============================================================*          
       4080-APP2-OR-OCC-SINGLE-PARENT.                                          
      *==============================================================*          
      *--------------------------------------------------------------*          
      * SINGLE PARENT OF APPLICANT1 IN APP2 OR OCCUPIERS.            *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP2-OCC-SINGLE-PARENT-FLAG.                          
                                                                                
           IF ((FB78-NUM-APPLT2-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-APPLT2-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-APPLT3-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-APPLT3-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-APPLT4-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-APPLT4-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP1-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP1-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP2-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP2-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP3-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP3-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP4-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP4-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP5-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP5-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP6-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP6-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP7-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP7-RLTNSP-APPLT1  = '02' OR '12')) OR         
              ((FB78-NUM-OCCUP8-MARITAL-STATUS = '1' OR 'S')                    
                AND (FB78-NUM-OCCUP8-RLTNSP-APPLT1  = '02' OR '12'))            
              MOVE 'Y' TO APP2-OCC-SINGLE-PARENT-FLAG                           
           END-IF.                                                              
                                                                                
       4080-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4090-APP1-CHILD-GRANDCH-SINGLE.                                          
      *==============================================================*          
                                                                                
      * HA1     - APP1 MARRIED/WIDOW/DIVERSED,IF MARRIED SPOUSE SHOULD          
      *           NOT BE THERE. THATS MEEN SINGLE PARENT OF HA2/OCC.            
      * HA2/OCC - CHILD OF HA1                                                  
      * OCCUPIER- CHILD OF HA2 / GRAND CHILD OF HA1.                            
                                                                                
      * NOTE : THIS PARA SHOULD BE AFTER 4060                                   
      *        LOOKING FOR APP2-OCC-CHILD-SINGLE-FLAG = YES                     
           MOVE SPACES TO APP1-CHILD-GRANDCH-SINGLE-FLAG.                       
                                                                                
           MOVE FB78-DTE-APPLT1-BIRTH     TO WS-DOB.                            
           PERFORM 5000-COMPUTE-AGE       THRU 5000-EXIT.                       
                                                                                
           IF (FB78-NUM-APPLT1-MARITAL-STATUS = '2' OR 'M'                      
                                             OR '3' OR 'W'                      
                                             OR '4' OR 'D'                      
                                             OR '5' OR 'P') AND                 
                                             ABOVE-21                           
                                                                                
              IF GCHILD-YES AND APP2-OCC-CHILD-SINGLE                           
                 MOVE 'Y' TO APP1-CHILD-GRANDCH-SINGLE-FLAG                     
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4090-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4100-APP2-OCC-ADOPT-PARENTS.                                             
      *==============================================================*          
      *--------------------------------------------------------------*          
      * IF THERE ARE ADOPTIVE PARENTS IN APPLICATIONS.               *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP2-OCC-ADOPT-PARENTS-FLAG.                          
                                                                                
           IF ((FB78-NUM-APPLT2-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '38') OR                        
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '38'))                          
              MOVE 'Y' TO APP2-OCC-ADOPT-PARENTS-FLAG                           
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       4110-APP2-OCC-ADOPT-CHILD.                                               
      *==============================================================*          
      *--------------------------------------------------------------*          
      * IF THERE ARE ADOPTIVE CHILD IN APPLICATIONS.                 *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO APP2-OCC-ADOPT-CHILD-FLAG.                            
                                                                                
           IF (((FB78-NUM-APPLT2-MARITAL-STATUS = '1' OR 'S') AND               
               (FB78-NUM-APPLT2-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-APPLT3-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-APPLT3-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-APPLT4-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-APPLT4-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-OCCUP1-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-OCCUP1-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-OCCUP2-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-OCCUP2-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-OCCUP3-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-OCCUP3-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-OCCUP4-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-OCCUP4-RLTNSP-APPLT1 = '39'))       OR                 
              ((FB78-NUM-OCCUP5-MARITAL-STATUS = '1' OR 'S') AND                
               (FB78-NUM-OCCUP5-RLTNSP-APPLT1 = '39')))                         
              MOVE 'Y' TO APP2-OCC-ADOPT-CHILD-FLAG                             
           END-IF.                                                              
                                                                                
       4110-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==============================================================*          
       4120-OCC-MARRIED-NON-CITIZEN.                                            
      *==============================================================*          
      *--------------------------------------------------------------*          
      * IF THERE ARE MARRIED NON CITIZENS IN APPLICATION.            *          
      *--------------------------------------------------------------*          
           MOVE SPACES TO OCC-MARRIED-NON-CITIZEN-FLAG.                         
                                                                                
           IF (((FB78-NUM-OCCUP1-MARITAL-STATUS = '2' OR 'M') AND               
                (FB78-NUM-OCCUP1-CITIZENSHIP NOT = '10' AND '20')) OR           
               ((FB78-NUM-OCCUP2-MARITAL-STATUS = '2' OR 'M') AND               
                (FB78-NUM-OCCUP2-CITIZENSHIP NOT = '10' AND '20')) OR           
               ((FB78-NUM-OCCUP3-MARITAL-STATUS = '2' OR 'M') AND               
                (FB78-NUM-OCCUP3-CITIZENSHIP NOT = '10' AND '20')) OR           
               ((FB78-NUM-OCCUP4-MARITAL-STATUS = '2' OR 'M') AND               
                (FB78-NUM-OCCUP4-CITIZENSHIP NOT = '10' AND '20')) OR           
               ((FB78-NUM-OCCUP5-MARITAL-STATUS = '2' OR 'M') AND               
                (FB78-NUM-OCCUP5-CITIZENSHIP NOT = '10' AND '20')))             
              MOVE 'Y' TO OCC-MARRIED-NON-CITIZEN-FLAG                          
           END-IF.                                                              
                                                                                
       4120-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       5000-COMPUTE-AGE.                                                        
      *==============================================================*          
                                                                                
           IF WS-NUM-DOB IS NOT NUMERIC                                         
              MOVE ZEROES TO WS-NUM-DOB                                         
              DISPLAY "INVALID DATE OF BIRTH,REGN " FB78-NUM-REGN               
              GO TO 5000-EXIT                                                   
           END-IF.                                                              
                                                                                
           MOVE SPACES TO ABOVE-21-FLAG.                                        
           MOVE ZEROES TO WS-CNT-MONTHS.                                        
                                                                                
           COMPUTE WS-CNT-MONTHS = (WS-CUR-CCYY - WS-DOB-CCYY) * 12 +           
                                         (WS-CUR-MM - WS-DOB-MM).               
                                                                                
                                                                                
           IF WS-CUR-DD <= WS-DOB-DD                                            
              SUBTRACT 1 FROM WS-CNT-MONTHS                                     
           ELSE                                                                 
              ADD      1 TO   WS-CNT-MONTHS                                     
           END-IF.                                                              
                                                                                
           IF WS-CNT-MONTHS > WS-CONTROL-MONTH                                  
              MOVE 'Y' TO ABOVE-21-FLAG                                         
           END-IF.                                                              
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       5500-UPDATE-BP13K730.                                                    
      *==============================================================*          
      *--------------------------------------------------------------*          
      * READ BP13K730 USING REGN NO                                  *          
      *--------------------------------------------------------------*          
           MOVE FB78-NUM-REGN    TO K730-NUM-REGN.                              
                                                                                
           READ BP13K730.                                                       
                                                                                
           EVALUATE WS-K730-STATUS                                              
           WHEN 00                                                              
                ADD 1 TO BP13K730-FOUND                                         
           WHEN 23                                                              
                DISPLAY 'BP13K730 - REC NOT FOUND  ' K730-NUM-REGN              
                ADD 1 TO BP13K730-NOT-FOUND                                     
                GO TO 5500-EXIT                                                 
           WHEN OTHER                                                           
                DISPLAY 'BP13K730 - READ ERROR FOR ' K730-NUM-REGN              
                MOVE    WS-K730-STATUS       TO   RETURN-CODE                   
                PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT                     
           END-EVALUATE.                                                        
                                                                                
      *--------------------------------------------------------------*          
      * REWRITE BP13K730 RECORD WITH ELIG/ALLO SCHEME.               *          
      *--------------------------------------------------------------*          
           MOVE SPACES           TO BP13K730-REWRITE-FLAG.                      
                                                                                
           IF K730-CDE-ELIG-SCH = SPACES OR LOW-VALUES                          
              MOVE WS-ELIG-SCH   TO K730-CDE-ELIG-SCH                           
              MOVE 'Y'           TO BP13K730-REWRITE-FLAG                       
           END-IF.                                                              
                                                                                
           IF K730-CDE-ALLOC-SCH = SPACES OR LOW-VALUES                         
              MOVE WS-ALLO-SCH   TO K730-CDE-ALLOC-SCH                          
              MOVE 'Y'           TO BP13K730-REWRITE-FLAG                       
           END-IF.                                                              
                                                                                
           IF BP13K730-REWRITE-FLAG NOT = 'Y'                                   
              ADD 1 TO BP13K730-SKIPPED                                         
              GO TO 5500-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF WS-ELIG-SCH = SPACES OR LOW-VALUES                                
              ADD 1 TO WS-CNT-OUTOF-CRIT                                        
              DISPLAY 'REC OUT OF CRITERIA: ' K730-NUM-REGN ', '                
                      'WS-ELIG-SCH: ' WS-ELIG-SCH                               
           ELSE                                                                 
              IF WS-ALLO-SCH = SPACES OR LOW-VALUES                             
                 ADD 1 TO WS-CNT-OUTOF-CRIT                                     
                 DISPLAY 'REC OUT OF CRITERIA: ' K730-NUM-REGN                  
                         'WS-ALLO-SCH: ' WS-ALLO-SCH                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           REWRITE BP13K730-REC.                                                
                                                                                
           EVALUATE WS-K730-STATUS                                              
           WHEN 00                                                              
                ADD 1 TO BP13K730-REWRITE                                       
           WHEN OTHER                                                           
                DISPLAY "BP13K730 REWRITE ERROR STATUS " WS-K730-STATUS         
                                    " KEY IS " K730-NUM-REGN                    
                MOVE WS-K730-STATUS TO RETURN-CODE                              
                PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       5500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============================================================*          
       9000-CLOSE-FILES.                                                        
      *==============================================================*          
                                                                                
           DISPLAY '================================================='.         
           DISPLAY ' PROGRAM-ID : BP13CB01         DATE : ' WS-EDT-DATE.        
           DISPLAY '================================================='.         
           DISPLAY ' '.                                                         
           MOVE BP13FB78-READ      TO WS-EDT-VAR.                               
           DISPLAY 'NO OF RECORDS READ FROM BP13FB78    : ' WS-EDT-VAR.         
           MOVE BP13K730-FOUND     TO WS-EDT-VAR.                               
           DISPLAY 'NO OF RECORDS FOUND IN BP13K730     : ' WS-EDT-VAR.         
           MOVE BP13K730-NOT-FOUND TO WS-EDT-VAR.                               
           DISPLAY 'NO OF RECORDS NOT FOUND IN BP13K730 : ' WS-EDT-VAR.         
           MOVE BP13K730-SKIPPED   TO WS-EDT-VAR.                               
           DISPLAY 'NO OF RECORDS SKIPPED IN BP13K730   : ' WS-EDT-VAR.         
           MOVE BP13K730-REWRITE   TO WS-EDT-VAR.                               
           DISPLAY 'NO OF RECORDS UPDATED INTO BP13K730 : ' WS-EDT-VAR.         
           MOVE WS-CNT-OUTOF-CRIT  TO WS-EDT-VAR.                               
           DISPLAY 'NO OF OUT OF CRITERIA RECORDS       : ' WS-EDT-VAR.         
           DISPLAY ' '.                                                         
           DISPLAY '================================================='          
                                                                                
           CLOSE BP13K730                                                       
                 BP13FB78.                                                      
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
