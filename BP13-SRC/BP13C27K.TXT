       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C27K.                                                 
      *AUTHOR.        KARL MAGALONA CABUG.                                      
      *DATE-WRITTEN.  29 SEPT 2017.                                             
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      * OBJECTIVE  : OUTPUT HLE REPORT                             *            
      *                                                            *            
      * INPUT      : BP27F800                                      *            
      *            : BP13K800                                      *            
      *            : BP13K820                                      *            
      *            : BP13K022                                      *            
      *            : BP13K024                                      *            
      * OUTPUT     : BP13F00A - HLE NOT EXPIRED WITH PROV-TAG ='Y' *            
      *            : BP13F00B - HLE NOT EXPIRED WITH PROV-TAG!='Y' *            
      *            : BP13F00C - HLE EXPIRED WITH PROV-TAG ='Y'     *            
      *            : BP13F00D - HLE EXPIRED WITH PROV-TAG!='Y'     *            
      * ---------------------------------------------------------- *            
      * CHG REF  DATE     BY    DESCRIPTIONS                       *            
      * -------- -------- ----- ------------                       *            
      * BP136951 04102017 KAM4  NEW PROGRAM                        *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP27F800 ASSIGN               TO BP27F800.                    
                                                                                
           SELECT BP13K800 ASSIGN               TO BP13K800                     
                           ORGANIZATION         IS INDEXED                      
                           ACCESS MODE          IS RANDOM                       
                           RECORD KEY           IS K800-NUM-REGN                
                           FILE STATUS          IS K800-STATUS.                 
                                                                                
           SELECT BP13K022 ASSIGN               TO BP13K022                     
                           ACCESS MODE          IS RANDOM                       
                           ORGANIZATION         IS INDEXED                      
                           RECORD KEY           IS K022-KEY-FLD                 
                           ALTERNATE RECORD KEY IS K022-NUM-REGN                
                           FILE STATUS          IS K022-STATUS.                 
                                                                                
           SELECT BP13K820 ASSIGN               TO BP13K820                     
                           ACCESS MODE          IS DYNAMIC                      
                           ORGANIZATION         IS INDEXED                      
                           RECORD KEY           IS K820-KEY-FLD                 
                           ALTERNATE RECORD KEY IS K820-NUM-NRIC                
                           FILE STATUS          IS K820-STATUS.                 
                                                                                
           SELECT BP13K024 ASSIGN               TO BP13K024                     
                           ACCESS MODE          IS RANDOM                       
                           ORGANIZATION         IS INDEXED                      
                           RECORD KEY           IS K024-KEY-FLD                 
                           FILE STATUS          IS K024-STATUS.                 
                                                                                
           SELECT BP13F00A ASSIGN               TO BP13F00A.                    
           SELECT BP13F00B ASSIGN               TO BP13F00B.                    
           SELECT BP13F00C ASSIGN               TO BP13F00C.                    
           SELECT BP13F00D ASSIGN               TO BP13F00D.                    
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP27F800                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 1200 CHARACTERS                                     
            RECORDING MODE IS F.                                                
       COPY BP27F800.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K022                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K022.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
       COPY BP13K820.                                                           
                                                                                
       FD  BP13K024                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K024.                                                           
                                                                                
       FD   BP13F00A                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 80 CHARACTERS                                       
            RECORDING MODE IS F.                                                
       01 BP13F00A-RECORD                     PIC X(80).                        
                                                                                
       FD   BP13F00B                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 80 CHARACTERS                                       
            RECORDING MODE IS F.                                                
       01 BP13F00B-RECORD                     PIC X(80).                        
                                                                                
       FD   BP13F00C                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 80 CHARACTERS                                       
            RECORDING MODE IS F.                                                
       01 BP13F00C-RECORD                     PIC X(80).                        
                                                                                
       FD   BP13F00D                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 80 CHARACTERS                                       
            RECORDING MODE IS F.                                                
       01 BP13F00D-RECORD                     PIC X(80).                        
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01 WS-VARIABLES.                                                         
          05 WS-F800-EOF                    PIC X     VALUE 'N'.                
          05 WS-K820-EOF                    PIC X     VALUE 'N'.                
          05 WS-K800-FOUND                  PIC X     VALUE 'N'.                
          05 WS-K820-FOUND                  PIC X     VALUE 'N'.                
          05 WS-F800-READ                   PIC 9(6)  VALUE ZEROS.              
          05 WS-K800-FND-CNT                PIC 9(6)  VALUE ZEROS.              
          05 WS-K800-NTFND-CNT              PIC 9(6)  VALUE ZEROS.              
          05 WS-K820-NTFND-CNT              PIC 9(6)  VALUE ZEROS.              
          05 WS-F001-REC-CNT                PIC 9(6)  VALUE ZEROS.              
          05 WS-DUP-HLA-CNT                 PIC 9(6)  VALUE ZEROS.              
          05 WS-F001-WRITE                  PIC 9(6)  VALUE ZEROS.              
          05 WS-F002-WRITE                  PIC 9(6)  VALUE ZEROS.              
          05 WS-F003-WRITE                  PIC 9(6)  VALUE ZEROS.              
          05 WS-F004-WRITE                  PIC 9(6)  VALUE ZEROS.              
          05 WS-NUM-SERIAL1                 PIC 9(6)  VALUE ZEROS.              
          05 WS-NUM-SERIAL2                 PIC 9(6)  VALUE ZEROS.              
          05 WS-NUM-SERIAL3                 PIC 9(6)  VALUE ZEROS.              
          05 WS-NUM-SERIAL4                 PIC 9(6)  VALUE ZEROS.              
          05 WS-EDIT-SERIAL                 PIC Z(6)  VALUE SPACES.             
          05 WS-NME-SALES-CRM               PIC X(30) VALUE SPACES.             
          05 WS-PREV-HLA-SAVE               PIC X(09) VALUE SPACES.             
                                                                                
       01 WS-FILE-STATUS.                                                       
          05 K800-STATUS                     PIC X(2)  VALUE SPACES.            
          05 K820-STATUS                     PIC X(2)  VALUE SPACES.            
          05 K022-STATUS                     PIC X(2)  VALUE SPACES.            
          05 K024-STATUS                     PIC X(2)  VALUE SPACES.            
                                                                                
      *---------------------------------------------------------*               
      *                       EMAIL HEADERS                     *               
      *---------------------------------------------------------*               
                                                                                
       01  HEADER1.                                                             
      *----PRODUCTION USAGE                                                     
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.                 
           05  FILLER          PIC X(68)  VALUE SPACES.                         
      *  for testing usage                                                      
      *    05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB3'.                 
      *    05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
      *----FOR PRODUCTION USAGE                                                 
       01  HEADER2.                                                             
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
           05  SEND-ID         PIC X(04)  VALUE 'OPCP'.                         
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.                    
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
      *  For TESTING usage                                                      
      *    05  SEND-ID         PIC X(07)  VALUE 'CS93388'.                      
      *    05  FILLER          PIC X(09)  VALUE '@SGPHDB3>'.                    
      *    05  FILLER          PIC X(53)  VALUE SPACES.                         
                                                                                
       01  HEADER-DTL1-TO.                                                      
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  TO-MAIL-ID-A    PIC X(26)  VALUE SPACES.                         
           05 FILLER           PIC X(45).                                       
                                                                                
       01  HEADER-DTL3.                                                         
           05  FILLER          PIC X(04)  VALUE 'DATA'.                         
           05  FILLER          PIC X(76)  VALUE SPACES.                         
       01  HEADER-DTL4.                                                         
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                        
           05  FROM-MAIL-ID    PIC X(26)  VALUE                                 
               'SOC SYSTEM - EMAIL ALERT'.                                      
           05  FILLER          PIC X(49)  VALUE SPACES.                         
                                                                                
       01  HEADER-DTL5-TOA.                                                     
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  TO-MAIL-ID-B    PIC X(26)  VALUE SPACES.                         
           05  FILLER          PIC X(50)  VALUE SPACES.                         
                                                                                
       01  HEADER-DTL7-SUBJECT-A.                                               
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  SUBJECT-1       PIC X(58)  VALUE SPACES.                         
      *     'EMAIL SUBJECT HERE                                       '.        
           05  FILLER          PIC X(12)  VALUE SPACES.                         
                                                                                
                                                                                
       01 BODY-BLANK-LINE.                                                      
          05 FILLER          PIC X(80)   VALUE SPACES.                          
       01 FOOTER-DTL2-END.                                                      
          05 FILLER          PIC X       VALUE '.'.                             
      *---------------------------------------------------------*               
       01 BP13F001-HEADER.                                                      
          05  F001-SERIAL-HDR                 PIC X(06) VALUE                   
                              'SERIAL'.                                         
          05  FILLER                          PIC X(04) VALUE SPACES.           
          05  F001-REGN-HDR                   PIC X(04) VALUE                   
                              'REGN'.                                           
          05  FILLER                          PIC X(08) VALUE SPACES.           
          05  F001-HLE-NUM-HDR                PIC X(03) VALUE                   
                              'HLE'.                                            
          05  FILLER                          PIC X(12) VALUE SPACES.           
          05  F001-NME-SALES-CRM-HDR          PIC X(09) VALUE                   
                              'SALES CRM'.                                      
          05  FILLER                          PIC X(17) VALUE SPACES.           
          05  F001-LN-TAG-HDR                 PIC X(08) VALUE                   
                              'LOAN TAG'.                                       
          05  FILLER                          PIC X(09) VALUE SPACES.           
                                                                                
       01 BP13F001-HEADER-LINE.                                                 
          05  F001-LINE-SEP                   PIC X(72) VALUE                   
              ALL '='.                                                          
          05  FILLER                          PIC X(08) VALUE SPACES.           
                                                                                
       01 BP13F001-DETAILS.                                                     
          05  F001-NUM-SERIAL                 PIC X(06).                        
          05  FILLER                          PIC X(03).                        
          05  F001-NUM-REGN                   PIC X(08).                        
          05  FILLER                          PIC X(03).                        
          05  F001-NUM-HLE                    PIC X(09).                        
          05  FILLER                          PIC X(03).                        
          05  F001-NME-SALES-CRM              PIC X(30).                        
          05  FILLER                          PIC X(05).                        
          05  F001-LOAN-TAG                   PIC X(01).                        
          05  FILLER                          PIC X(12).                        
                                                                                
      *-------------------------------------------------------------            
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
            PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                     
            PERFORM 2000-READ-BP27F800      THRU 2000-EXIT.                     
            PERFORM 3000-PROCESS-RTN        THRU 3000-EXIT                      
                    UNTIL WS-F800-EOF = 'Y'.                                    
            PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.                     
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-ROUTINE.                                                       
      *-------------------------------------------------------------            
            OPEN  INPUT  BP27F800                                               
                         BP13K800                                               
                         BP13K820                                               
                         BP13K022                                               
                         BP13K024                                               
                  OUTPUT BP13F00A                                               
                         BP13F00B                                               
                         BP13F00C                                               
                         BP13F00D.                                              
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR FILE BP13K800 ' K800-STATUS                   
              MOVE K800-STATUS                 TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR FILE BP13K820 ' K820-STATUS                   
              MOVE K820-STATUS                 TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-IF.                                                              
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR FILE BP13K024 ' K024-STATUS                   
              MOVE K024-STATUS                 TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-IF.                                                              
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'OPEN ERROR FILE BP13K022 ' K022-STATUS                   
              MOVE K022-STATUS                 TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-IF.                                                              
                                                                                
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP27F800.                                                      
      *-------------------------------------------------------------            
           READ BP27F800                                                        
                 AT END MOVE 'Y' TO WS-F800-EOF                                 
                 GO TO 2000-EXIT.                                               
                                                                                
           ADD 1   TO WS-F800-READ.                                             
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3000-PROCESS-RTN.                                                        
      *-------------------------------------------------------------            
           MOVE 'N'                              TO WS-K820-FOUND               
                                                    WS-K800-FOUND               
                                                    WS-K820-EOF.                
           IF F800-NUM-HLA NOT = WS-PREV-HLA-SAVE                               
              MOVE F800-NUM-HLA                   TO WS-PREV-HLA-SAVE           
              PERFORM 4000-READ-BP13K820             THRU 4000-EXIT             
                                                                                
              IF WS-K820-FOUND = 'Y'                                            
                 PERFORM 4200-READ-K800              THRU 4200-EXIT             
              ELSE                                                              
                 ADD 1                             TO WS-K820-NTFND-CNT         
              END-IF                                                            
                                                                                
              IF WS-K800-FOUND = 'Y'                                            
                 PERFORM 4500-READ-BP13K022           THRU 4500-EXIT            
                                                                                
                 IF F800-NUM-CASE-STATUS NOT = 'EXP'                            
                    IF K800-NUM-PROV-TAG = 'Y'                                  
                       PERFORM 5000-PREPARE-REPORT-A  THRU 5000-EXIT            
                    ELSE                                                        
                       PERFORM 5100-PREPARE-REPORT-B  THRU 5100-EXIT            
                    END-IF                                                      
                 ELSE                                                           
                   IF F800-NUM-CASE-STATUS = 'EXP'                              
                      IF K800-NUM-PROV-TAG = 'Y'                                
                         PERFORM 5200-PREPARE-REPORT-C THRU 5200-EXIT           
                      ELSE                                                      
                         PERFORM 5300-PREPARE-REPORT-D THRU 5300-EXIT           
                      END-IF                                                    
                   END-IF                                                       
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              ADD 1        TO WS-DUP-HLA-CNT                                    
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP27F800  THRU 2000-EXIT.                          
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       4000-READ-BP13K820.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES                           TO BP13K820-REC.               
           MOVE F800-NUM-NRIC1                   TO K820-NUM-NRIC.              
                                                                                
           START BP13K820 KEY >= K820-NUM-NRIC                                  
           EVALUATE K820-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 4100-READNXT-K820  THRU 4100-EXIT                   
                       UNTIL WS-K820-FOUND = 'Y'                                
                          OR WS-K820-EOF   = 'Y'                                
               WHEN 10                                                          
               WHEN 23                                                          
                    MOVE 'N'                     TO WS-K820-FOUND               
               WHEN OTHER                                                       
                    DISPLAY 'BP13K820 - STARTREAD ERROR.'                       
                            ' READ KEY : ' K820-NUM-NRIC                        
                            ' FILE STATUS : ' K820-STATUS                       
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4100-READNXT-K820.                                                       
      *-------------------------------------------------------------            
           READ BP13K820 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'   TO WS-K820-EOF                                       
                GO         TO 4100-EXIT                                         
           END-READ.                                                            
                                                                                
           EVALUATE K820-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    IF K820-NUM-NRIC = F800-NUM-NRIC1 OR                        
                                       F800-NUM-NRIC2 OR                        
                                       F800-NUM-NRIC3 OR                        
                                       F800-NUM-NRIC4                           
                       MOVE 'Y'                  TO WS-K820-FOUND               
                    ELSE                                                        
                       MOVE 'N'                  TO WS-K820-FOUND               
                       MOVE 'Y'                  TO WS-K820-EOF                 
                    END-IF                                                      
               WHEN 23                                                          
               WHEN 10                                                          
                       MOVE 'Y'                  TO WS-K820-EOF                 
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K820 ' K820-STATUS               
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4200-READ-K800.                                                          
      *-------------------------------------------------------------            
           MOVE SPACES                           TO BP13K800-MASTER.            
           MOVE K820-NUM-REGN                    TO K800-NUM-REGN.              
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE K800-STATUS                                                 
               WHEN 00                                                          
                    MOVE 'Y'                     TO WS-K800-FOUND               
                    ADD 1                        TO WS-K800-FND-CNT             
               WHEN 23                                                          
                    MOVE 'N'                     TO WS-K800-FOUND               
                    ADD 1                        TO WS-K800-NTFND-CNT           
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K800 ' K800-STATUS               
                    PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT               
           END-EVALUATE.                                                        
                                                                                
       4200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------*                                                   
       4500-READ-BP13K022.                                                      
      *---------------------*                                                   
           MOVE SPACES                           TO BP13K022-REC                
                                                    WS-NME-SALES-CRM.           
           MOVE K800-NUM-REGN                    TO K022-NUM-REGN.              
                                                                                
           READ BP13K022 KEY IS K022-NUM-REGN.                                  
                                                                                
           EVALUATE K022-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    MOVE K022-NUM-OIC            TO K024-NUM-OIC                
                    PERFORM 4600-READ-BP13K024 THRU 4600-EXIT                   
               WHEN 23                                                          
                    DISPLAY 'NO REC FOUND IN K022 : ' K800-NUM-REGN             
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K022 ' K022-STATUS               
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       4600-READ-BP13K024.                                                      
      *---------------------*                                                   
           READ BP13K024 KEY IS K024-KEY-FLD.                                   
                                                                                
           EVALUATE K024-STATUS                                                 
             WHEN 00                                                            
                  MOVE K024-NME-OIC              TO WS-NME-SALES-CRM            
             WHEN 23                                                            
                  DISPLAY 'NO REC FOUND IN K024 : ' K024-KEY-FLD                
             WHEN OTHER                                                         
                  DISPLAY 'ERROR READING BP13K024 ' K800-STATUS                 
                  PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                   
           END-EVALUATE.                                                        
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       5000-PREPARE-REPORT-A.                                                   
      *---------------------*                                                   
           IF WS-NUM-SERIAL1 = ZERO                                             
              WRITE BP13F00A-RECORD FROM HEADER1                                
              WRITE BP13F00A-RECORD FROM HEADER2                                
                                                                                
              MOVE 'HDB-HLEREPORT1@HDB.GOV.SG>' TO TO-MAIL-ID-A                 
              WRITE BP13F00A-RECORD FROM HEADER-DTL1-TO                         
                                                                                
              WRITE BP13F00A-RECORD FROM HEADER-DTL3                            
              WRITE BP13F00A-RECORD FROM HEADER-DTL4                            
                                                                                
              MOVE TO-MAIL-ID-A            TO TO-MAIL-ID-B                      
              WRITE BP13F00A-RECORD FROM HEADER-DTL5-TOA                        
                                                                                
              MOVE SPACES                  TO SUBJECT-1                         
              MOVE 'HLE not expired with provi tag' to SUBJECT-1                
              WRITE BP13F00A-RECORD FROM HEADER-DTL7-SUBJECT-A                  
                                                                                
              WRITE BP13F00A-RECORD FROM BP13F001-HEADER                        
              WRITE BP13F00A-RECORD FROM F001-LINE-SEP                          
           END-IF.                                                              
                                                                                
           MOVE SPACES                     TO BP13F001-DETAILS.                 
           ADD 1                           TO WS-NUM-SERIAL1                    
                                              WS-F001-WRITE.                    
           MOVE WS-NUM-SERIAL1             TO WS-EDIT-SERIAL.                   
                                                                                
           MOVE WS-EDIT-SERIAL             TO F001-NUM-SERIAL.                  
           MOVE K800-NUM-REGN              TO F001-NUM-REGN.                    
           MOVE F800-NUM-HLA               TO F001-NUM-HLE.                     
           MOVE WS-NME-SALES-CRM           TO F001-NME-SALES-CRM.               
           MOVE K800-NUM-LOAN-TAG          TO F001-LOAN-TAG.                    
                                                                                
           WRITE BP13F00A-RECORD         FROM BP13F001-DETAILS.                 
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------*                                                   
       5100-PREPARE-REPORT-B.                                                   
      *---------------------*                                                   
           IF WS-NUM-SERIAL2 = ZERO                                             
              WRITE BP13F00B-RECORD FROM HEADER1                                
              WRITE BP13F00B-RECORD FROM HEADER2                                
                                                                                
              MOVE 'HDB-HLEREPORT2@HDB.GOV.SG>' TO TO-MAIL-ID-A                 
              WRITE BP13F00B-RECORD FROM HEADER-DTL1-TO                         
                                                                                
              WRITE BP13F00B-RECORD FROM HEADER-DTL3                            
              WRITE BP13F00B-RECORD FROM HEADER-DTL4                            
                                                                                
              MOVE TO-MAIL-ID-A            TO TO-MAIL-ID-B                      
              WRITE BP13F00B-RECORD FROM HEADER-DTL5-TOA                        
                                                                                
              MOVE SPACES                  TO SUBJECT-1                         
              MOVE 'HLE not expired without provi tag' To SUBJECT-1             
              WRITE BP13F00B-RECORD FROM HEADER-DTL7-SUBJECT-A                  
                                                                                
              WRITE BP13F00B-RECORD FROM BP13F001-HEADER                        
              WRITE BP13F00B-RECORD FROM F001-LINE-SEP                          
           END-IF.                                                              
                                                                                
           MOVE SPACES                     TO BP13F001-DETAILS.                 
           ADD 1                           TO WS-NUM-SERIAL2                    
                                              WS-F002-WRITE.                    
           MOVE WS-NUM-SERIAL2             TO WS-EDIT-SERIAL.                   
                                                                                
           MOVE WS-EDIT-SERIAL             TO F001-NUM-SERIAL.                  
           MOVE K800-NUM-REGN              TO F001-NUM-REGN.                    
           MOVE F800-NUM-HLA               TO F001-NUM-HLE.                     
           MOVE WS-NME-SALES-CRM           TO F001-NME-SALES-CRM.               
           MOVE K800-NUM-LOAN-TAG          TO F001-LOAN-TAG.                    
                                                                                
           WRITE BP13F00B-RECORD         FROM BP13F001-DETAILS.                 
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       5200-PREPARE-REPORT-C.                                                   
      *---------------------*                                                   
           IF WS-NUM-SERIAL3 = ZERO                                             
              WRITE BP13F00C-RECORD FROM HEADER1                                
              WRITE BP13F00C-RECORD FROM HEADER2                                
                                                                                
              MOVE 'HDB-HLEREPORT1@HDB.GOV.SG>' TO TO-MAIL-ID-A                 
              WRITE BP13F00C-RECORD FROM HEADER-DTL1-TO                         
                                                                                
              WRITE BP13F00C-RECORD FROM HEADER-DTL3                            
              WRITE BP13F00C-RECORD FROM HEADER-DTL4                            
                                                                                
              MOVE TO-MAIL-ID-A            TO TO-MAIL-ID-B                      
              WRITE BP13F00C-RECORD FROM HEADER-DTL5-TOA                        
                                                                                
              MOVE SPACES                              TO SUBJECT-1             
              MOVE 'HLE expired with provi tag'        TO SUBJECT-1             
              WRITE BP13F00C-RECORD FROM HEADER-DTL7-SUBJECT-A                  
                                                                                
              WRITE BP13F00C-RECORD FROM BP13F001-HEADER                        
              WRITE BP13F00C-RECORD FROM F001-LINE-SEP                          
           END-IF.                                                              
                                                                                
           MOVE SPACES                     TO BP13F001-DETAILS.                 
           ADD 1                           TO WS-NUM-SERIAL3                    
                                              WS-F003-WRITE.                    
           MOVE WS-NUM-SERIAL3             TO WS-EDIT-SERIAL.                   
                                                                                
           MOVE WS-EDIT-SERIAL             TO F001-NUM-SERIAL.                  
           MOVE K800-NUM-REGN              TO F001-NUM-REGN.                    
           MOVE F800-NUM-HLA               TO F001-NUM-HLE.                     
           MOVE WS-NME-SALES-CRM           TO F001-NME-SALES-CRM.               
           MOVE K800-NUM-LOAN-TAG          TO F001-LOAN-TAG.                    
                                                                                
           WRITE BP13F00C-RECORD         FROM BP13F001-DETAILS.                 
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       5300-PREPARE-REPORT-D.                                                   
      *---------------------*                                                   
           IF WS-NUM-SERIAL4 = ZERO                                             
              WRITE BP13F00D-RECORD FROM HEADER1                                
              WRITE BP13F00D-RECORD FROM HEADER2                                
                                                                                
              MOVE 'HDB-HLEREPORT1@HDB.GOV.SG>' TO TO-MAIL-ID-A                 
              WRITE BP13F00D-RECORD FROM HEADER-DTL1-TO                         
                                                                                
              WRITE BP13F00D-RECORD FROM HEADER-DTL3                            
              WRITE BP13F00D-RECORD FROM HEADER-DTL4                            
                                                                                
              MOVE TO-MAIL-ID-A            TO TO-MAIL-ID-B                      
              WRITE BP13F00D-RECORD FROM HEADER-DTL5-TOA                        
                                                                                
              MOVE SPACES                          TO SUBJECT-1                 
              MOVE 'HLE expired without provi tag' TO SUBJECT-1                 
              WRITE BP13F00D-RECORD FROM HEADER-DTL7-SUBJECT-A                  
                                                                                
              WRITE BP13F00D-RECORD FROM BP13F001-HEADER                        
              WRITE BP13F00D-RECORD FROM F001-LINE-SEP                          
           END-IF.                                                              
                                                                                
           MOVE SPACES                     TO BP13F001-DETAILS.                 
           ADD 1                           TO WS-NUM-SERIAL4                    
                                              WS-F004-WRITE.                    
           MOVE WS-NUM-SERIAL4             TO WS-EDIT-SERIAL.                   
                                                                                
           MOVE WS-EDIT-SERIAL             TO F001-NUM-SERIAL.                  
           MOVE K800-NUM-REGN              TO F001-NUM-REGN.                    
           MOVE F800-NUM-HLA               TO F001-NUM-HLE.                     
           MOVE WS-NME-SALES-CRM           TO F001-NME-SALES-CRM.               
           MOVE K800-NUM-LOAN-TAG          TO F001-LOAN-TAG.                    
                                                                                
           WRITE BP13F00D-RECORD         FROM BP13F001-DETAILS.                 
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
           IF WS-NUM-SERIAL1 > ZEROES                                           
              WRITE BP13F00A-RECORD FROM BODY-BLANK-LINE                        
              WRITE BP13F00A-RECORD FROM FOOTER-DTL2-END                        
           END-IF.                                                              
                                                                                
           IF WS-NUM-SERIAL2 > ZEROES                                           
              WRITE BP13F00B-RECORD FROM BODY-BLANK-LINE                        
              WRITE BP13F00B-RECORD FROM FOOTER-DTL2-END                        
           END-IF.                                                              
                                                                                
           IF WS-NUM-SERIAL3 > ZEROES                                           
              WRITE BP13F00C-RECORD FROM BODY-BLANK-LINE                        
              WRITE BP13F00C-RECORD FROM FOOTER-DTL2-END                        
           END-IF.                                                              
                                                                                
           IF WS-NUM-SERIAL4 > ZEROES                                           
              WRITE BP13F00D-RECORD FROM BODY-BLANK-LINE                        
              WRITE BP13F00D-RECORD FROM FOOTER-DTL2-END                        
           END-IF.                                                              
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '- BP13C27K CONTROL LIST --'                                 
           DISPLAY '---------------------------------------------'.             
           DISPLAY ' 1) TOT BP27F800 READ  : ' WS-F800-READ.                    
           DISPLAY ' 2) TOT BP13F001 WRITE : ' WS-F001-WRITE.                   
           DISPLAY ' 3) TOT BP13F002 WRITE : ' WS-F002-WRITE.                   
           DISPLAY ' 4) TOT BP13F003 WRITE : ' WS-F003-WRITE.                   
           DISPLAY ' 5) TOT BP13F004 WRITE : ' WS-F004-WRITE.                   
           DISPLAY ' '.                                                         
           DISPLAY ' 6) TOT BP13K820 NTFND   : ' WS-K820-NTFND-CNT.             
           DISPLAY ' 7) TOT BP13K800 FOUND   : ' WS-K800-FND-CNT.               
           DISPLAY ' 8) TOT BP13K800 NTFND   : ' WS-K800-NTFND-CNT.             
           DISPLAY ' 9) TOT DUPLICATE(HLA)   : ' WS-DUP-HLA-CNT.                
           DISPLAY ' '.                                                         
                                                                                
           CLOSE  BP27F800                                                      
                  BP13K800                                                      
                  BP13K820                                                      
                  BP13K022                                                      
                  BP13K024                                                      
                  BP13F00A                                                      
                  BP13F00B                                                      
                  BP13F00C                                                      
                  BP13F00D.                                                     
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR FILE BP13K800 ' K800-STATUS                  
              MOVE K800-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR FILE BP13K820 ' K820-STATUS                  
              MOVE K820-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR FILE BP13K022 ' K022-STATUS                  
              MOVE K022-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE ERROR FILE BP13K024 ' K024-STATUS                  
              MOVE K024-STATUS TO RETURN-CODE                                   
           END-IF.                                                              
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
