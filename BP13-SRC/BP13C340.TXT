       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C340.                                                 
      *AUTHOR.        JAI.                                                      
      *DATE-WRITTEN.  29/04/95.                                                 
      *DATE-COMPILED.                                                           
      *========================================================*                
      *               SYSTEM OF COMMITMENT (BP13)              *                
      *========================================================*                
      *    OBJECTIVE :                                         *                
      *      1.  THIS IS A PROGRAM TO PRINT LETTERS.           *                
      *          LIST AFTER SIGNING SALES AGREEMENT.           *                
      *     INPUT FILES:                                       *                
      *      1. SORTED BP13K310 "RY"                           *                
      *      2. BM06K110                                       *                
      *      3. BP13K820                                       *                
      *      4. BM06K100                                       *                
      *     OUTPUT FILE :                                      *                
      *      1. BP13L340                                       *                
      *      2. BP13P340                                       *                
      *                                                        *                
      *     LISTING:                                           *                
      *     1. CONTROL LISTING (BP13L340)                      *                
      *     2. LETTERS         (BP13P340)                      *                
      * CHG NO.  BY  DATE    DESCRIPTION                       *                
      * =======  === ====    ===========                       *                
      * C950642  EG1 950721  ADDED OCS-TAG CHECK BEF PROCESS   *                
      * SOC 8G   SSS 960304  REMOVE DISPLAY STATEMENT FOR K110 *                
      * BP130418 SGK 980604  TO CATER FOR Y2K.                 *                
      * BP130488 LMS 981021  TO CATER FOR OCS AT BOOKING.      *                
      * BP132127 CKK 020603  TO CHANGE LETTER LAYOUT           *                
      *========================================================*                
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F310 ASSIGN TO BP13F310.                                  
                                                                                
           SELECT BM06K110 ASSIGN TO BM06K110                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K110-KEY-FLD                               
                  FILE STATUS     IS BM06K110-STATUS.                           
                                                                                
           SELECT BM06K100 ASSIGN TO BM06K100                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K100-KEY-FLD                               
                  FILE STATUS     IS BM06K100-STATUS.                           
                                                                                
           SELECT BM06K510 ASSIGN TO BM06K510                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K510-ESTCDE                                
                  FILE STATUS     IS BM06K510-STATUS.                           
                                                                                
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K800-NUM-REGN                              
                  FILE STATUS     IS BP13K800-STATUS.                           
                                                                                
           SELECT BP13K820 ASSIGN TO BP13K820                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K820-KEY-FLD                               
                  FILE STATUS     IS BP13K820-STATUS.                           
                                                                                
           SELECT BP13L340 ASSIGN TO BP13L340.                                  
                                                                                
           SELECT BP13P340 ASSIGN TO BP13P340.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F310                                                            
            BLOCK CONTAINS  0   RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F.                                                
       COPY BP13F310.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K100.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BM06K510                                                            
            RECORD CONTAINS 60 CHARACTERS.                                      
       COPY BM06K510.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD  BP13L340                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  L340-PRINT-REC                  PIC X(132).                          
                                                                                
       FD  BP13P340                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  P340-PRINT-REC                  PIC X(80).                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS1-FILE-ACCESS-STATUS.                                              
           05 BM06K100-STATUS              PIC 9(02) VALUE ZEROS.               
           05 BM06K110-STATUS              PIC 9(02) VALUE ZEROS.               
           05 BM06K510-STATUS              PIC 9(02) VALUE ZEROS.               
           05 BP13K800-STATUS              PIC 9(02) VALUE ZEROS.               
           05 BP13K820-STATUS              PIC 9(02) VALUE ZEROS.               
                                                                                
       01  WS2-COUNTERS.                                                        
           05 WS2-CNT-F310-READ            PIC 9(03) VALUE ZEROS.               
           05 WS2-CNT-K110-READ            PIC 9(03) VALUE ZEROS.               
           05 WS2-CNT-K820-READ            PIC 9(03) VALUE ZEROS.               
           05 WS2-CNT-L340-WRITE           PIC 9(03) VALUE ZEROS.               
           05 WS2-CNT-P340-WRITE           PIC 9(03) VALUE ZEROS.               
           05 WS2-CNT-PRINT-L340           PIC 9(04) VALUE ZEROS.               
           05 WS2-CNT-PRINT-P340           PIC 9(04) VALUE ZEROS.               
           05 WS2-CNT-LINE-ON-PAGE         PIC 9(02) VALUE 66.                  
           05 WS2-CNT-NO-PAGE              PIC 9(05) VALUE ZEROS.               
                                                                                
       01  WS4-SWITCHES.                                                        
           05 WS4-F310-EOF-IND             PIC X(01) VALUE 'N'.                 
              88 WS4-F310-EOF                  VALUE 'Y'.                       
                                                                                
       01  WS5-DATES-VARIABLES.                                                 
           05  WS5-DATE.                                                        
               10 WS5-CCYY                 PIC 9(04).                           
               10 WS5-MM                   PIC 9(02).                           
               10 WS5-DD                   PIC 9(02).                           
           05  WS5-PRT-DATE.                                                    
               10 WS5-PRT-DD               PIC 9(02).                           
               10 FILLER                   PIC X(01) VALUE '/'.                 
               10 WS5-PRT-MM               PIC 9(02).                           
               10 FILLER                   PIC X(01) VALUE '/'.                 
               10 WS5-PRT-CCYY             PIC 9(04).                           
           05  WS5-CURRENT-DATE.                                                
               10 WS5-CUR-CCYY             PIC 9(04).                           
               10 WS5-CUR-MM               PIC 9(02).                           
               10 WS5-CUR-DD               PIC 9(02).                           
           05  WS5-SYSTEM-DATE.                                                 
               10 WS5-SYS-DD               PIC X(02).                           
               10 FILLER                   PIC X(01) VALUE '/'.                 
               10 WS5-SYS-MM               PIC X(02).                           
               10 FILLER                   PIC X(01) VALUE '/'.                 
               10 WS5-SYS-CCYY             PIC X(04).                           
                                                                                
       01  WS6-DEFAULT-VALUES.                                                  
           05 WS6-DEF-DUP-LEASE            PIC 9(02) VALUE 2.                   
           05 WS6-MAX-LINES                PIC 9(02) VALUE 60.                  
                                                                                
       01  WS7-SCH-ACC.                                                         
           05 WS7-SCH-1-4                  PIC X(04).                           
           05 WS7-SCH-5-8                  PIC X(04).                           
           05 WS7-SCH-9-9                  PIC X(01).                           
           05 WS7-SCH-10-11                PIC X(02).                           
                                                                                
      **********************************************************                
      *  WS FOR LIST OF REJECTED CASES AFTER SIGNING SALES AGR *                
      **********************************************************                
                                                                                
       01  DJDE-LETTER-AGR                 PIC X(80) VALUE                      
           '$DJDE$ FORMS=BP1333,DUPLEX=NO,END;'.                                
                                                                                
       01  DJDE-LETTER-BK                  PIC X(80) VALUE                      
           '$DJDE$ FORMS=BP1301,DUPLEX=NO,END;'.                                
                                                                                
       01  P340-LINE1.                                                          
           05 FILLER                       PIC X(61) VALUE SPACES.              
           05 P340-DATE                    PIC X(10) VALUE SPACES.              
                                                                                
       01  P340-LINE2.                                                          
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 FILLER                       PIC X(08) VALUE                      
             'TO    : '.                                                        
           05 FILLER                       PIC X(40) VALUE                      
             'MRS. LOH-CHIAM SHOCK YUEN'.                                       
                                                                                
       01  P340-LINE3.                                                          
           05 FILLER                       PIC X(16) VALUE SPACES.              
           05 FILLER                       PIC X(40) VALUE                      
             'PRINCIPAL PROJECT MANAGER'.                                       
                                                                                
       01  P340-LINE4.                                                          
           05 FILLER                       PIC X(16) VALUE SPACES.              
           05 FILLER                       PIC X(40) VALUE                      
             'BUILDING PROJECT MANAGEMENT DEPT'.                                
                                                                                
       01  P340-LINE5.                                                          
           05 FILLER                       PIC X(16) VALUE SPACES.              
           05 FILLER                       PIC X(40) VALUE                      
             'BUILDING & DEVELOPMENT DIVISION '.                                
                                                                                
       01  P340-LINE6.                                                          
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 P340-NT-NEIGH-CONT           PIC X(60).                           
                                                                                
       01  P340-LINE7.                                                          
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 FILLER                       PIC X(08) VALUE 'APT BLK '.          
           05 P340-BLK-NO                  PIC X(05).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 P340-STREET                  PIC X(20).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
                                                                                
       01  P340-LINE8.                                                          
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 P340-FLAT-NO.                                                     
              10 FILLER                    PIC X(01) VALUE '#'.                 
              10 P340-LEVEL-NO             PIC X(02).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 P340-UNIT-NO              PIC X(04).                           
                                                                                
       01  P340-LINE9.                                                          
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 FILLER                       PIC X(15) VALUE                      
             'OCS DUE DATE : '.                                                 
           05 P340-DUE-DATE.                                                    
              10 P340-DUE-DAY              PIC X(02) VALUE SPACES.              
              10 FILLER                    PIC X(01) VALUE SPACES.              
              10 P340-DUE-MON              PIC X(03) VALUE SPACES.              
              10 FILLER                    PIC X(01) VALUE SPACES.              
              10 P340-DUE-YEAR             PIC X(04) VALUE SPACES.              
                                                                                
       01  P340-LINE10.                                                         
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 FILLER                       PIC X(15) VALUE                      
             'ACCOUNT NO   : '.                                                 
           05 P340-SCH-ACC.                                                     
              10 P340-SCH-1-4              PIC X(04).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 P340-SCH-5-8              PIC X(04).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 P340-SCH-9-9              PIC X(01).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 P340-SCH-10-11            PIC X(02).                           
                                                                                
       01  P340-LINE11.                                                         
           05 FILLER                       PIC X(59) VALUE SPACES.              
           05 P340-SALE-REGN-NO            PIC X(08) VALUE SPACES.              
                                                                                
       01  P340-LINE12.                                                         
           05 FILLER                       PIC X(04) VALUE SPACES.              
           05 FILLER                       PIC X(04) VALUE 'CC: '.              
           05 P340-NEW-TOWN                PIC X(03) VALUE SPACES.              
           05 FILLER                       PIC X(01) VALUE '/'.                 
           05 P340-FLAT-TYPE               PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(01) VALUE '/'.                 
           05 P340-REGN-NO                 PIC X(08) VALUE SPACES.              
                                                                                
       01  P340-LINE13.                                                         
           05 FILLER                       PIC X(08) VALUE SPACES.              
           05 P340-OIC                     PIC X(30) VALUE SPACES.              
                                                                                
       01  L340-PRT-HEAD-01.                                                    
           05 L340-HEADER                  PIC X(14) VALUE SPACES.              
           05 FILLER                       PIC X(08) VALUE 'HDB3    '.          
           05 FILLER                       PIC X(25) VALUE SPACES.              
           05 FILLER                       PIC X(39) VALUE                      
             'S Y S T E M   O F   C O M M I T M E N T'.                         
           05 FILLER                       PIC X(13) VALUE SPACES.              
           05 FILLER                       PIC X(07) VALUE 'DATE: '.            
           05 L340-PRINT-DATE              PIC X(10) VALUE SPACES.              
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 FILLER                       PIC X(07) VALUE 'PAGE: '.            
           05 L340-PRINT-PAGE              PIC ZZZZ9.                           
                                                                                
       01  L340-PRT-HEAD-02-AGR.                                                
           05 FILLER                       PIC X(36) VALUE SPACES.              
           05 FILLER                       PIC X(42) VALUE                      
             'CONTROL LIST OF LETTERS TO INFORM BPMD OF '.                      
           05 FILLER                       PIC X(18) VALUE                      
             'REJECTED OCS UNITS'.                                              
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 FILLER                       PIC X(30) VALUE                      
             'USER : AGREEMENT TEAM'.                                           
                                                                                
       01  L340-PRT-HEAD-02-BK.                                                 
           05 FILLER                       PIC X(36) VALUE SPACES.              
           05 FILLER                       PIC X(42) VALUE                      
             'CONTROL LIST OF LETTERS TO INFORM BPMD OF '.                      
           05 FILLER                       PIC X(18) VALUE                      
             'REJECTED OCS UNITS'.                                              
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 FILLER                       PIC X(30) VALUE                      
             'USER : ALLOCATION TEAM'.                                          
                                                                                
       01  P340-PRT-HEAD-02.                                                    
           05 FILLER                       PIC X(26) VALUE SPACES.              
           05 FILLER                       PIC X(80) VALUE                      
             'DETAIL LIST OF APPLICANTS WITH KEY ISSUE DATE'.                   
                                                                                
       01  L340-PRT-HEAD-03.                                                    
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 FILLER                       PIC X(03) VALUE 'NO.'.               
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 FILLER                       PIC X(07) VALUE 'REGN-NO'.           
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(04) VALUE 'FLAT'.              
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(15) VALUE                      
             'NAME(TRUNCATED)'.                                                 
           05 FILLER                       PIC X(07) VALUE SPACES.              
           05 FILLER                       PIC X(11) VALUE                      
             'SCH-ACCT-NO'.                                                     
           05 FILLER                       PIC X(04) VALUE SPACES.              
           05 FILLER                       PIC X(03) VALUE 'BLK'.               
           05 FILLER                       PIC X(06) VALUE SPACES.              
           05 FILLER                       PIC X(11) VALUE                      
             'STREET NAME'.                                                     
           05 FILLER                       PIC X(06) VALUE SPACES.              
           05 FILLER                       PIC X(07) VALUE 'UNIT NO'.           
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(06) VALUE 'REJECT'.            
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-HEADER-A                PIC X(07) VALUE '  ALLOC'.           
           05 L340-HEADER-B                PIC X(06) VALUE ' ALLOC'.            
           05 L340-HEADER-FLEXI-PRICE.                                          
              10 L340-HEADER-1             PIC X(05) VALUE SPACES.              
              10 L340-SPACE1               PIC X(04) VALUE SPACES.              
              10 L340-HEADER-2             PIC X(06) VALUE SPACES.              
           05 L340-HEADER-REMARKS REDEFINES L340-HEADER-FLEXI-PRICE.            
              10 FILLER                    PIC X(15).                           
                                                                                
       01  L340-PRT-HEAD-04.                                                    
           05 FILLER                       PIC X(16) VALUE SPACES.              
           05 FILLER                       PIC X(04) VALUE 'TYPE'.              
           05 FILLER                       PIC X(75) VALUE SPACES.              
           05 FILLER                       PIC X(04) VALUE 'DATE'.              
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 L340-HEADER-AA               PIC X(06) VALUE '  TYPE'.            
           05 L340-HEADER-BA               PIC X(06) VALUE '   SCH'.            
           05 L340-HEADER-1A               PIC X(05) VALUE SPACES.              
           05 FILLER                       PIC X(04) VALUE SPACES.              
           05 L340-HEADER-2A               PIC X(03) VALUE SPACES.              
                                                                                
       01  L340-PRT-DETAIL.                                                     
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-NO                      PIC ZZZ9.                            
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 L340-REG                     PIC X(08).                           
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 L340-FLAT-TYPE               PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 L340-NAME                    PIC X(22).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-SCH-ACC.                                                     
              10 L340-SCH-1-4              PIC X(04).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 L340-SCH-5-8              PIC X(04).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 L340-SCH-9-9              PIC X(01).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 L340-SCH-10-11            PIC X(02).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-BLK-NO                  PIC X(05).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-STREET                  PIC X(20).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-FLAT-NO.                                                     
              10 FILLER                    PIC X(01) VALUE '#'.                 
              10 L340-LEVEL-NO             PIC X(02).                           
              10 FILLER                    PIC X(01) VALUE '-'.                 
              10 L340-UNIT-NO              PIC X(04).                           
           05 FILLER                       PIC X(01) VALUE SPACES.              
           05 L340-REJECT-DATE             PIC X(10) VALUE SPACES.              
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 L340-ALLOC-TYPE              PIC X(01) VALUE SPACES.              
           05 FILLER                       PIC X(03) VALUE SPACES.              
           05 L340-ALLOC-SCH               PIC X(02) VALUE SPACES.              
           05 FILLER                       PIC X(02) VALUE SPACES.              
           05 L340-FLEXI-PRICE.                                                 
              10 L340-FLEXI-DUE            PIC X(10) VALUE SPACES.              
              10 FILLER                    PIC X(01) VALUE SPACES.              
              10 L340-COMP-PR              PIC ZZZZ99 VALUE ZEROS.              
              10 L340-COMP-PR-D REDEFINES L340-COMP-PR.                         
                 15 L340-COMP-PR-CHAR      PIC X(06).                           
           05 L340-REMARKS REDEFINES L340-FLEXI-PRICE.                          
               10 L340-REM                 PIC X(17).                           
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      **********************                                                    
       MAIN-ROUTINE SECTION.                                                    
      **********************                                                    
                                                                                
           PERFORM 100-OPEN-FILES.                                              
           PERFORM 200-MAIN-ROUTINE THRU 200-EXIT UNTIL WS4-F310-EOF.           
           PERFORM 500-CLOSE-ROUTINE.                                           
                                                                                
       MAIN-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************                                                         
       100-OPEN-FILES.                                                          
      *****************                                                         
                                                                                
           OPEN INPUT  BP13F310                                                 
                       BM06K100                                                 
                       BM06K110                                                 
                       BM06K510                                                 
                       BP13K800                                                 
                       BP13K820                                                 
                OUTPUT BP13L340                                                 
                       BP13P340.                                                
                                                                                
           IF BM06K100-STATUS NOT = 0 AND NOT = 97                              
              DISPLAY ' OPENING ERROR,BM06K100-STATUS ' BM06K100-STATUS         
              MOVE BM06K100-STATUS TO RETURN-CODE                               
              PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                           
           END-IF.                                                              
                                                                                
           IF BM06K110-STATUS NOT = 0 AND NOT = 97                              
              DISPLAY ' OPENING ERROR,BM06K110-STATUS ' BM06K110-STATUS         
              MOVE BM06K110-STATUS TO RETURN-CODE                               
              PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                           
           END-IF.                                                              
                                                                                
           IF BM06K510-STATUS NOT = 0 AND NOT = 97                              
              DISPLAY ' OPENING ERROR,BM06K510-STATUS ' BM06K510-STATUS         
              MOVE BM06K510-STATUS TO RETURN-CODE                               
              PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K800-STATUS NOT = 0 AND NOT = 97                              
              DISPLAY ' OPENING ERROR, BP13K800-STATUS ' BP13K800-STATUS        
              MOVE BP13K800-STATUS TO RETURN-CODE                               
              PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K820-STATUS NOT = 0 AND NOT = 97                              
              DISPLAY ' OPENING ERROR, BP13K820-STATUS ' BP13K820-STATUS        
              MOVE BP13K820-STATUS TO RETURN-CODE                               
              PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                           
           END-IF.                                                              
           MOVE FUNCTION CURRENT-DATE(1:8)                                      
                                      TO WS5-CURRENT-DATE.                      
           MOVE WS5-CUR-DD            TO WS5-SYS-DD.                            
           MOVE WS5-CUR-MM            TO WS5-SYS-MM.                            
           MOVE WS5-CUR-CCYY          TO WS5-SYS-CCYY.                          
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************                                                        
       200-MAIN-ROUTINE.                                                        
      **************************************************************            
      *   1. READ FILE BP13F310.                                   *            
      *   2. MOVE F310-SCH-ACC TO K110-KEY-FLD.                    *            
      *   3. READ BM06K110 TO RETRIEVE NECESSARY DETAILS.          *            
      *   4. READ BP13K820 TO RETRIEVE APPLICANT NAME.             *            
      *   5. PRINT LIST OF REJECTION AFTER SIGNING SALES AGREEMENT *            
      **************************************************************            
                                                                                
           READ BP13F310                                                        
                AT END MOVE 'Y' TO WS4-F310-EOF-IND                             
                GO TO 200-EXIT                                                  
                END-READ.                                                       
           ADD  1                         TO WS2-CNT-F310-READ.                 
                                                                                
           IF F310-CDE-OCS-TAG NOT = 'N'                                        
              GO TO 200-EXIT.                                                   
                                                                                
           IF F310-CDE-TRANS  = 'RY'                                            
              MOVE 'MRS YEO-SOH LAY MUI'     TO P340-OIC                        
           ELSE                                                                 
              MOVE 'VICKRUM MUTHSAMY P'      TO P340-OIC                        
           END-IF.                                                              
                                                                                
           MOVE F310-SCH-ACC              TO WS7-SCH-ACC.                       
           MOVE WS7-SCH-1-4               TO L340-SCH-1-4                       
                                             P340-SCH-1-4.                      
           MOVE WS7-SCH-5-8               TO L340-SCH-5-8                       
                                             P340-SCH-5-8.                      
           MOVE WS7-SCH-9-9               TO L340-SCH-9-9                       
                                             P340-SCH-9-9.                      
           MOVE WS7-SCH-10-11             TO L340-SCH-10-11                     
                                             P340-SCH-10-11.                    
           MOVE F310-REGN-NO              TO L340-REG P340-SALE-REGN-NO         
                                             P340-REGN-NO.                      
           MOVE SPACES                    TO L340-BLK-NO.                       
           MOVE SPACES                    TO L340-STREET.                       
           MOVE SPACES                    TO L340-UNIT-NO.                      
           MOVE SPACES                    TO L340-LEVEL-NO.                     
           MOVE SPACES                    TO L340-FLAT-TYPE.                    
           MOVE SPACES                    TO L340-REJECT-DATE.                  
           MOVE SPACES                    TO L340-ALLOC-TYPE.                   
           MOVE SPACES                    TO L340-ALLOC-SCH.                    
           MOVE SPACES                    TO L340-FLEXI-DUE.                    
           MOVE SPACES                    TO L340-COMP-PR-D.                    
                                                                                
           MOVE F310-SCH-ACC              TO K110-KEY-FLD.                      
           PERFORM 210-READ-BM06K110      THRU 210-EXIT.                        
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************                                                        
       210-READ-BM06K110.                                                       
      **********************************************************                
      *  READ K110 FLAT INVENTORY TO GET FLAT'S DETAILS        *                
      **********************************************************                
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE BM06K110-STATUS                                             
               WHEN 00                                                          
                    ADD  1                   TO WS2-CNT-K110-READ               
                    MOVE F310-NUM-BLK        TO L340-BLK-NO                     
                                                P340-BLK-NO                     
                    MOVE F310-NME-STREET     TO L340-STREET                     
                                                P340-STREET                     
                    MOVE F310-NUM-MAIN       TO L340-UNIT-NO                    
                                                P340-UNIT-NO                    
                    MOVE F310-NUM-LEVEL      TO L340-LEVEL-NO                   
                                                P340-LEVEL-NO                   
                    MOVE F310-CDE-FLAT-TYPE  TO L340-FLAT-TYPE                  
                                                P340-FLAT-TYPE                  
                    MOVE F310-CDE-NT         TO P340-NEW-TOWN                   
                    MOVE WS5-SYSTEM-DATE     TO P340-DATE                       
                    MOVE F310-DTE-DD         TO WS5-PRT-DD                      
                    MOVE F310-DTE-MM         TO WS5-PRT-MM                      
                    STRING F310-DTE-CC F310-DTE-YY                              
                           DELIMITED BY SIZE INTO WS5-PRT-CCYY                  
                    MOVE WS5-PRT-DATE        TO L340-REJECT-DATE                
                    MOVE K110-ALLOCN-TYPE    TO L340-ALLOC-TYPE                 
                    MOVE K110-ALLOC-SCH      TO L340-ALLOC-SCH                  
                    MOVE K110-COLOUR-SCHEME  TO L340-ALLOC-TYPE                 
                    MOVE K110-NUM-BEDROOM    TO L340-ALLOC-SCH                  
                    IF K110-CURR-SELLING-PRICE IS NOT NUMERIC                   
                       MOVE  ZERO   TO   K110-CURR-SELLING-PRICE                
                    END-IF                                                      
                    MOVE K110-CURR-SELLING-PRICE                                
                                             TO L340-COMP-PR                    
                    MOVE K110-AIX1           TO K100-KEY-FLD                    
                    PERFORM 215-READ-BM06K510       THRU 215-EXIT               
                    PERFORM 220-READ-BM06K100-BLOCK THRU 220-EXIT               
               WHEN 23                                                          
                    MOVE 'RECORD NOT FOUND IN FIS' TO L340-STREET               
                    PERFORM 300-PRINT THRU 300-EXIT                             
               WHEN OTHER                                                       
                    DISPLAY ' ERROR READING, BM06K110' BM06K110-STATUS          
                    MOVE BM06K110-STATUS TO RETURN-CODE                         
                    PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       210-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
      *  215-CHECK-PRICE-CHANGE IS USED FOR REJECTION OF FLAT                   
      *  IN 718 N4 RC3 ONLY. SOME FLATS UNDER THIS CONTRACT WERE                
      *  SOLD AT A PRICE BASED ON WRONGLY COMPUTED FLOOR AREA.                  
      *  SELLING PRICE NEEDS TO BE REVISED ACCORDINGLY.                         
      *------------------------------------------------------------*            
                                                                                
      *******************                                                       
       215-READ-BM06K510.                                                       
      *******************                                                       
                                                                                
           MOVE SPACES      TO K510-REC.                                        
           MOVE K110-ESTATE TO K510-ESTCDE.                                     
                                                                                
           READ BM06K510.                                                       
                                                                                
           EVALUATE BM06K510-STATUS                                             
               WHEN 00                                                          
                    CONTINUE                                                    
               WHEN 23                                                          
                    DISPLAY 'ESTATE NOT FOUND IN BM06K510 '                     
                             K510-ESTCDE                                        
               WHEN OTHER                                                       
                    DISPLAY ' ERROR READING, BM06K510' BM06K510-STATUS          
                    MOVE BM06K510-STATUS TO RETURN-CODE                         
                    PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                     
           END-EVALUATE.                                                        
                                                                                
           STRING K510-ESTATE-NAME   DELIMITED BY SIZE                          
                  ' '                                                           
                  K110-NEIGHBOURHOOD DELIMITED BY SIZE                          
                  ' '                                                           
                  K110-CONTRACT-NO   DELIMITED BY SIZE                          
                  INTO P340-NT-NEIGH-CONT                                       
                  END-STRING.                                                   
                                                                                
       215-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *************************                                                 
       220-READ-BM06K100-BLOCK.                                                 
      *************************                                                 
                                                                                
           READ BM06K100.                                                       
                                                                                
           EVALUATE BM06K100-STATUS                                             
               WHEN 00                                                          
                    MOVE K100-DTE-OCS-DUE  TO WS5-DATE                          
                    MOVE WS5-CCYY          TO P340-DUE-YEAR                     
                    MOVE WS5-DD            TO P340-DUE-DAY                      
                    PERFORM 230-GET-MONTH  THRU 230-EXIT                        
                    MOVE WS5-CCYY          TO WS5-PRT-CCYY                      
                    MOVE WS5-MM            TO WS5-PRT-MM                        
                    MOVE WS5-DD            TO WS5-PRT-DD                        
                    MOVE WS5-PRT-DATE      TO L340-FLEXI-DUE                    
                    PERFORM 250-READ-BP13K820 THRU 250-EXIT                     
               WHEN 23                                                          
                    MOVE SPACES TO L340-FLEXI-DUE                               
                    MOVE 'ESTATE,NEIGHBOURHOOD NOT FND' TO L340-REMARKS         
                    PERFORM 300-PRINT THRU 300-EXIT                             
               WHEN OTHER                                                       
                    DISPLAY ' ERROR READING, BM06K100' BM06K100-STATUS          
                    MOVE BM06K100-STATUS TO RETURN-CODE                         
                    PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       220-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***************                                                           
       230-GET-MONTH.                                                           
      ***************                                                           
                                                                                
           EVALUATE WS5-MM                                                      
               WHEN 01                                                          
                    MOVE 'JAN'  TO P340-DUE-MON                                 
               WHEN 02                                                          
                    MOVE 'FEB'  TO P340-DUE-MON                                 
               WHEN 03                                                          
                    MOVE 'MAR'  TO P340-DUE-MON                                 
               WHEN 04                                                          
                    MOVE 'APR'  TO P340-DUE-MON                                 
               WHEN 05                                                          
                    MOVE 'MAY'  TO P340-DUE-MON                                 
               WHEN 06                                                          
                    MOVE 'JUN'  TO P340-DUE-MON                                 
               WHEN 07                                                          
                    MOVE 'JUL'  TO P340-DUE-MON                                 
               WHEN 08                                                          
                    MOVE 'AUG'  TO P340-DUE-MON                                 
               WHEN 09                                                          
                    MOVE 'SEP'  TO P340-DUE-MON                                 
               WHEN 10                                                          
                    MOVE 'OCT'  TO P340-DUE-MON                                 
               WHEN 11                                                          
                    MOVE 'NOV'  TO P340-DUE-MON                                 
               WHEN 12                                                          
                    MOVE 'DEC'  TO P340-DUE-MON                                 
           END-EVALUATE.                                                        
                                                                                
       230-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *******************                                                       
       250-READ-BP13K820.                                                       
      **********************************************************                
      *  READ K820 OCCUPIER FILE TO GET NAME OF APPLICANT      *                
      **********************************************************                
                                                                                
           MOVE F310-REGN-NO            TO K800-NUM-REGN.                       
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE BP13K800-STATUS                                             
               WHEN 00                                                          
                                                                                
                    MOVE F310-REGN-NO   TO K820-NUM-REGN                        
                    MOVE K800-NUM-NRIC1 TO K820-NUM-NRIC                        
                                                                                
                    READ BP13K820                                               
                                                                                
                    EVALUATE BP13K820-STATUS                                    
                        WHEN 00                                                 
                             MOVE K820-NME-OCCP  TO L340-NAME                   
                             ADD  1              TO WS2-CNT-K820-READ           
                             PERFORM 300-PRINT        THRU 300-EXIT             
                             PERFORM 400-PRINT-LETTER THRU 400-EXIT             
                        WHEN 23                                                 
                             MOVE SPACES         TO L340-NAME                   
                             MOVE 'OCCUPIER NOT FOUND' TO L340-REMARKS          
                             PERFORM 300-PRINT THRU 300-EXIT                    
                        WHEN OTHER                                              
                             DISPLAY ' ERROR READING, BP13K820'                 
                                       BP13K820-STATUS                          
                             MOVE BP13K820-STATUS TO RETURN-CODE                
                             PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT            
                    END-EVALUATE                                                
               WHEN 23                                                          
                    MOVE 'RECORD NOT IN SOC MASTER' TO L340-REMARKS             
                    PERFORM 300-PRINT THRU 300-EXIT                             
               WHEN OTHER                                                       
                    DISPLAY ' ERROR READING, BP13K800' BP13K800-STATUS          
                    MOVE BP13K800-STATUS TO RETURN-CODE                         
                    PERFORM 500-CLOSE-ROUTINE THRU 500-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       250-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********                                                               
       300-PRINT.                                                               
      ***********                                                               
                                                                                
           IF WS2-CNT-LINE-ON-PAGE > WS6-MAX-LINES                              
              PERFORM 320-PRINT-HEADING THRU 320-EXIT                           
           END-IF.                                                              
                                                                                
           ADD 1  TO WS2-CNT-PRINT-L340                                         
                     WS2-CNT-LINE-ON-PAGE                                       
                     WS2-CNT-L340-WRITE.                                        
                                                                                
           MOVE WS2-CNT-PRINT-L340 TO L340-NO.                                  
           WRITE L340-PRINT-REC FROM L340-PRT-DETAIL AFTER 1.                   
           MOVE SPACES TO L340-PRINT-REC.                                       
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *******************                                                       
       320-PRINT-HEADING.                                                       
      *******************                                                       
                                                                                
           MOVE SPACES                TO L340-PRINT-REC.                        
           MOVE '    REMARKS    '      TO L340-HEADER-REMARKS.                  
           MOVE SPACES                TO L340-HEADER-1A                         
                                         L340-HEADER-2A.                        
           ADD  1                     TO WS2-CNT-NO-PAGE.                       
           MOVE 'BP13L340      '      TO L340-HEADER.                           
           MOVE WS2-CNT-NO-PAGE       TO L340-PRINT-PAGE.                       
           MOVE FUNCTION CURRENT-DATE(1:8) TO  WS5-CURRENT-DATE.                
           MOVE WS5-CUR-DD            TO WS5-PRT-DD.                            
           MOVE WS5-CUR-MM            TO WS5-PRT-MM.                            
           MOVE WS5-CUR-CCYY          TO WS5-PRT-CCYY.                          
           MOVE WS5-PRT-DATE          TO L340-PRINT-DATE.                       
                                                                                
           WRITE L340-PRINT-REC AFTER PAGE.                                     
           WRITE L340-PRINT-REC FROM L340-PRT-HEAD-01 AFTER 4.                  
                                                                                
           IF F310-CDE-TRANS = 'RY'                                             
              WRITE L340-PRINT-REC FROM L340-PRT-HEAD-02-AGR AFTER 2            
           ELSE                                                                 
              WRITE L340-PRINT-REC FROM L340-PRT-HEAD-02-BK AFTER 2             
           END-IF.                                                              
                                                                                
           WRITE L340-PRINT-REC FROM L340-PRT-HEAD-03 AFTER 2.                  
           WRITE L340-PRINT-REC FROM L340-PRT-HEAD-04 AFTER 2.                  
                                                                                
           MOVE SPACES                TO L340-PRINT-REC.                        
           WRITE L340-PRINT-REC AFTER 1.                                        
                                                                                
           MOVE 1 TO WS2-CNT-LINE-ON-PAGE.                                      
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************                                                         
       400-PRINT-LETTER.                                                        
      *****************                                                         
                                                                                
           ADD 1  TO WS2-CNT-P340-WRITE.                                        
                                                                                
           IF F310-CDE-TRANS = 'RY'                                             
              WRITE P340-PRINT-REC FROM DJDE-LETTER-AGR                         
                    AFTER ADVANCING PAGE                                        
           ELSE                                                                 
              WRITE P340-PRINT-REC FROM DJDE-LETTER-BK                          
                    AFTER ADVANCING PAGE                                        
           END-IF.                                                              
                                                                                
           MOVE SPACES TO P340-PRINT-REC.                                       
           WRITE P340-PRINT-REC AFTER ADVANCING PAGE.                           
                                                                                
           WRITE P340-PRINT-REC FROM P340-LINE1  AFTER 3.                       
           WRITE P340-PRINT-REC FROM P340-LINE2  AFTER 5.                       
           WRITE P340-PRINT-REC FROM P340-LINE3  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE4  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE5  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE6  AFTER 3.                       
           WRITE P340-PRINT-REC FROM P340-LINE7  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE8  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE9  AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE10 AFTER 1.                       
           WRITE P340-PRINT-REC FROM P340-LINE11 AFTER 6.                       
           WRITE P340-PRINT-REC FROM P340-LINE13 AFTER 22.                      
           WRITE P340-PRINT-REC FROM P340-LINE12 AFTER 8.                       
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      **************************                                                
       500-CLOSE-ROUTINE SECTION.                                               
      ************************************                                      
      *  CLOSE FILES AND END PROCESSING  *                                      
      ************************************                                      
                                                                                
           CLOSE BP13F310                                                       
                 BM06K100                                                       
                 BM06K110                                                       
                 BM06K510                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13L340                                                       
                 BP13P340.                                                      
                                                                                
           DISPLAY ' ** BP13C340 ** '.                                          
           DISPLAY 'NO OF RECORDS READ FROM DAILY TRANS (BP13F310)   = '        
                   WS2-CNT-F310-READ.                                           
           DISPLAY 'NO OF RECORDS READ FROM FIS (BM06K110)           = '        
                   WS2-CNT-K110-READ.                                           
           DISPLAY 'NO OF RECORDS READ FROM OCCUPIER (BP13K820)      = '        
                   WS2-CNT-K820-READ.                                           
           DISPLAY 'NO OF REJECTED CASES PRINTED (BP13L340)          = '        
                   WS2-CNT-L340-WRITE.                                          
           DISPLAY 'NO OF LETTERS PRINTED        (BP13P340)          = '        
                   WS2-CNT-P340-WRITE.                                          
                                                                                
           STOP RUN.                                                            
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
