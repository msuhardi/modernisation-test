       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CB87.                                                 
      *AUTHOR.        ZDD1.                                                     
      *DATE-WRITTEN.  10FEB2010.                                                
      * ========================================================== *            
      * SYSTEM OF COMMITMENT  (BP13)                               *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE   : PRINT SUCC OR UNSUCC LETTER FOR BTO         *            
      *                                                            *            
      *  INPUT FILES : 1.  BP13F740  -  SOC REQ FILE               *            
      *                2.  BP13K816                                *            
      *                3.  BP13K825  -  OCCUPIER FILE              *            
      *                4.  BP13K830  -  ADDRESS FILE               *            
      *                                                            *            
      *  LISTINGS    : 1.  P13LB87A                                *            
      *                2.  P13LB87B                                *            
      *                3.  P13LB87C                                *            
      *                4.  P13LB87D                                *            
      *                5.  P13LB87E                                *            
      *                6.  P13LB87F                                *            
      *                7.  P13LB87G                                *            
      *                7.  P13LB87H                                *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * CHG REF  BY    DATE    DESCRIPTION                         *            
      * -------- ---  ------   -----------                         *            
      * BP133832 ZDD  20100210 NEW PROGRAM.                        *            
      * BP135254 SMR2 20140417 TO REPLACE BP13K816 W/ BP13K813     *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
      *-------------------------------------------------------------            
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F740  ASSIGN        TO BP13F740.                          
                                                                                
           SELECT BP13K740  ASSIGN        TO BP13K740                           
                            ORGANIZATION  IS INDEXED                            
                            ACCESS MODE   IS RANDOM                             
                            RECORD KEY    IS K740-KEY-FLD                       
                            ALTERNATE KEY IS K740-NUM-REGN                      
                            FILE STATUS   IS BP13K740-STATUS.                   
                                                                                
           SELECT BP13K825  ASSIGN        TO BP13K825                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K825-KEY-FLD                       
                            FILE STATUS   IS WS-K825-STATUS.                    
                                                                                
           SELECT BP13K830  ASSIGN        TO BP13K830                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K830-KEY-FLD                       
                            ALTERNATE RECORD KEY IS  K830-NUM-REGN              
                            FILE STATUS   IS WS-K830-STATUS.                    
                                                                                
           SELECT BP13K813  ASSIGN        TO BP13K813                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K813-KEY-FLD                       
                            FILE STATUS   IS WS-K813-STATUS.                    
                                                                                
           SELECT P13LB87A  ASSIGN        TO P13LB87A.                          
           SELECT P13LB87B  ASSIGN        TO P13LB87B.                          
           SELECT P13LB87C  ASSIGN        TO P13LB87C.                          
           SELECT P13LB87D  ASSIGN        TO P13LB87D.                          
           SELECT P13LB87E  ASSIGN        TO P13LB87E.                          
           SELECT P13LB87F  ASSIGN        TO P13LB87F.                          
           SELECT P13LB87G  ASSIGN        TO P13LB87G.                          
           SELECT P13LB87H  ASSIGN        TO P13LB87H.                          
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F740                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13F740.                                                           
                                                                                
       FD   BP13K740                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K740.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   BP13K813                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K813.                                                           
                                                                                
       FD  P13LB87A                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 90  CHARACTERS.                                      
       01  LB87A-PRT-REC                    PIC X(90).                          
                                                                                
       FD  P13LB87B                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 90  CHARACTERS.                                      
       01  LB87B-PRT-REC                    PIC X(90).                          
                                                                                
       FD  P13LB87C                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87C-PRT-REC                    PIC X(90).                          
                                                                                
       FD  P13LB87D                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87D-PRTREC                     PIC X(132).                         
                                                                                
       FD  P13LB87E                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87E-PRTREC                     PIC X(132).                         
                                                                                
                                                                                
       FD  P13LB87F                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87F-PRTREC                     PIC X(132).                         
                                                                                
       FD  P13LB87G                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87G-PRT-REC                    PIC X(90).                          
                                                                                
       FD  P13LB87H                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  LB87H-PRT-REC                    PIC X(90).                          
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       COPY PRIOSCH.                                                            
                                                                                
       01  WS-STATUS.                                                           
           05  BP13F740-STATUS              PIC 99    VALUE ZEROS.              
           05  BP13K740-STATUS              PIC 99    VALUE ZEROS.              
           05  WS-K825-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K830-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K813-STATUS               PIC 99    VALUE ZEROS.              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F740-NOT-FND              PIC 9(06)  VALUE ZEROS.             
           05  WS-NOT-FND-K740              PIC X     VALUE 'N'.                
           05  WS-K740-NOT-FND              PIC 9(06)  VALUE ZEROS.             
           05  WS-F740-READ-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87A-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87B-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87C-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87D-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87E-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87F-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87G-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-LB87H-WRT-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-LETTERS-SUCC          PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-LETTERS-GRO           PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-LETTERS-UNSUCC        PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-PAGE-LB87E            PIC 9(04)  VALUE ZEROS.             
           05  WS-CNT-LINE-LB87E            PIC 9(06)  VALUE 60.                
           05  WS-CNT-PAGE-LB87D            PIC 9(04)  VALUE ZEROS.             
           05  WS-CNT-LINE-LB87D            PIC 9(06)  VALUE 60.                
           05  WS-CNT-PAGE-LB87F            PIC 9(04)  VALUE ZEROS.             
           05  WS-CNT-LINE-LB87F            PIC 9(06)  VALUE 60.                
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-F740-EOF                  PIC X     VALUE 'N'.                
           05  WS-K740-EOF                  PIC X     VALUE 'N'.                
           05  WS-BALLOT-SW                 PIC X(2)  VALUE SPACES.             
           05  WS-K825-NME-OCCP             PIC X(66) VALUE SPACES.             
           05  WS-ALLOCSCH-TYPE             PIC X(3)  VALUE SPACES.             
           05  WS-FLAT-TYPE                 PIC X(02) VALUE SPACES.             
           05  WS-NEW-TOWN                  PIC X(03) VALUE SPACES.             
           05  WS-MONTH                     PIC X(03) VALUE SPACES.             
           05  WS-IDX-X                     PIC 99    VALUE 01.                 
                                                                                
       01  WS-DATE-VARIABLES.                                                   
           05  WS-DATE.                                                         
               10  WS-CCYY                  PIC 9(4)  VALUE 0000.               
               10  WS-MM                    PIC 99    VALUE 00.                 
               10  WS-DD                    PIC 99    VALUE 00.                 
           05  WS-CURR-DATE                 PIC 9(8)  VALUE ZEROES.             
           05  WS-SENT-DATE                 PIC 9(8)  VALUE ZEROES.             
           05  WS-SENT-DATE-X REDEFINES WS-SENT-DATE PIC X(8).                  
           05  WS-DAYS                      PIC 9(7)  VALUE ZEROES.             
           05  WS-APPMT-TIME.                                                   
               10  WS-APPMT-HR              PIC 9(2)  VALUE 00.                 
               10  WS-APPMT-MIN             PIC 9(2)  VALUE 00.                 
           05  WS-DTE-BALLOT                PIC X(6)  VALUE SPACES.             
           05  WS-MTH-BE                    PIC X(9)  VALUE SPACES.             
                                                                                
       01  WS2-DEFAULT.                                                         
           05  WS2-MAX-LINES-LB87C          PIC 9(2)   VALUE 37.                
           05  WS2-MAX-LINES-LB87D          PIC 9(2)   VALUE 45.                
           05  WS2-MAX-LINES-LB87F          PIC 9(2)   VALUE 45.                
                                                                                
       01  WS-MTH-CONV.                                                         
           05  FILLER                  PIC X(5)    VALUE 'JAN01'.               
           05  FILLER                  PIC X(5)    VALUE 'FEB02'.               
           05  FILLER                  PIC X(5)    VALUE 'MAR03'.               
           05  FILLER                  PIC X(5)    VALUE 'APR04'.               
           05  FILLER                  PIC X(5)    VALUE 'MAY05'.               
           05  FILLER                  PIC X(5)    VALUE 'JUN06'.               
           05  FILLER                  PIC X(5)    VALUE 'JUL07'.               
           05  FILLER                  PIC X(5)    VALUE 'AUG08'.               
           05  FILLER                  PIC X(5)    VALUE 'SEP09'.               
           05  FILLER                  PIC X(5)    VALUE 'OCT10'.               
           05  FILLER                  PIC X(5)    VALUE 'NOV11'.               
           05  FILLER                  PIC X(5)    VALUE 'DEC12'.               
       01  WS-MTH-CONV-TABLE REDEFINES WS-MTH-CONV.                             
           05  WS-TF-MTH       OCCURS 12 TIMES INDEXED BY WS-IDX.               
               10  WS-TRAN-MM          PIC X(3).                                
               10  WS-NUM-MM           PIC X(2).                                
                                                                                
       01  WS-MONTHS-IN-DIGITS-AND-WORDS.                                       
           05 FILLER                   PIC X(12) VALUE                          
             '01  JANUARY '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '02  FEBRUARY'.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '03   MARCH  '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '04   APRIL  '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '05    MAY   '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '06   JUNE   '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '07   JULY   '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '08   AUGUST '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '09 SEPTEMBER'.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '10  OCTOBER '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '11 NOVEMBER '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '12 DECEMBER '.                                                    
       01  FILLER  REDEFINES  WS-MONTHS-IN-DIGITS-AND-WORDS.                    
           05 WS-MONTH-TABLE               OCCURS 12                            
                                           INDEXED BY WS-MTH-IND.               
              10 WS-MONTH-IN-DIGITS    PIC X(02).                               
              10 FILLER                PIC X(01).                               
              10 WS-MONTH-IN-WORDS     PIC X(09).                               
                                                                                
       01  WS-TIME-DATES.                                                       
           05  WS-SYSTEM-DATE.                                                  
               10  WS-SYS-CCYY.                                                 
                   15  WS-SYS-CC              PIC 9(2).                         
                   15  WS-SYS-YY              PIC 9(2).                         
               10  WS-SYS-MM                  PIC 9(2).                         
               10  WS-SYS-DD                  PIC 9(2).                         
           05  WS-EDITED-DATE.                                                  
               10  WS-EDITED-DD               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-MM               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-YY               PIC 9(4).                         
      *===============================                                          
      *   LINKAGE SECTION FOR AV02C015                                          
      *===============================                                          
       01  WS-LINK-AV02C015.                                                    
           05  AV02C015-IN-POSTCODE             PIC X(6).                       
           05  AV02C015-OUT-POSTCODE-CHKSUM     PIC X(9).                       
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR LETTER TO APPLICANT                     *            
      *------------------------------------------------------------*            
       01  LB87-LINE-01.                                                        
           05  FILLER                   PIC X(72) VALUE SPACES.                 
           05  LB87-REF                 PIC X(15) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-02.                                                        
           05  FILLER                   PIC X(72) VALUE SPACES.                 
           05  LB87-DATE                PIC X(13) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-03.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  LB87-NAME01              PIC X(66) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-04.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  LB87-NAME02              PIC X(66) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-05.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  LB87-BLK                 PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(01) VALUE SPACES.                 
           05  LB87-UNIT                PIC X(11) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-06.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  LB87-ADDR-L2             PIC X(47) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-07.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  LB87-ADDR-L3             PIC X(20) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-08.                                                        
           05  FILLER                   PIC X(10) VALUE SPACES.                 
           05  LB87-BAR-CODE            PIC X(09) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-FILECOPY.                                                  
           05  FILLER                   PIC X(70) VALUE SPACES.                 
           05  LB87-FILE-COPY           PIC X(09) VALUE 'FILE COPY'.            
                                                                                
       01  LB87-LINE-8C.                                                        
           05  FILLER                   PIC X(22) VALUE SPACES.                 
           05  LB87-MTH-BE              PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87-YEAR-BE             PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  LB87-EXERCISE            PIC X(35) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-8D.                                                        
           05  FILLER                   PIC X(20) VALUE SPACES.                 
           05  LB87-NME-EXERCISE        PIC X(45) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-09.                                                        
           05  FILLER                   PIC X(52) VALUE SPACES.                 
           05  LB87-ROOM-4P5P           PIC X(12) VALUE SPACES.                 
           05  FILLER                   PIC X(05) VALUE SPACES.                 
           05  LB87-ROOM-SP             PIC X(28) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-10.                                                        
           05  FILLER                   PIC X(10) VALUE SPACES.                 
           05  LB87-ESTATE              PIC X(20) VALUE SPACES.                 
           05  FILLER                   PIC X(08) VALUE SPACES.                 
           05  LB87-BALLOT-DTE          PIC X(28) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-11.                                                        
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  LB87-REGNUM              PIC X(10) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-12.                                                        
           05  FILLER                   PIC X(75) VALUE SPACES.                 
           05  LB87-QUEUE-POS           PIC X(08) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-13.                                                        
           05  FILLER                   PIC X(70) VALUE SPACES.                 
           05  LB87-OUTCOME             PIC X(15) VALUE SPACES.                 
                                                                                
       01  LB87-LINE-13-J1.                                                     
           05  FILLER                   PIC X(44) VALUE SPACES.                 
           05  LB87-OUTCOME-J1          PIC X(15) VALUE SPACES.                 
                                                                                
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR CONTROL LISTING                         *            
      *------------------------------------------------------------*            
       01  LB87A-HDG1.                                                          
           05  LB87A-LISTING            PIC X(14) VALUE 'P13LB87C'.             
           05  FILLER                   PIC X(8)  VALUE 'HDB3'.                 
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(39) VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'DATE: '.               
           05  LB87A-DATE               PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE ' PAGE: '.              
           05  LB87A-PAGE               PIC ZZZZ9.                              
                                                                                
       01  LB87A-HDG2.                                                          
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  LB87A-LISTING-TYPE       PIC X(50) VALUE                         
              'CONTROL LIST FOR SUCCESSFUL LETTER '.                            
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  FILLER                   PIC X(32) VALUE                         
               'SALES UNIT (APPLICATION TEAM)'.                                 
                                                                                
       01  LB87A-HDG4.                                                          
           05  FILLER                   PIC X(7)  VALUE ' S/N   '.              
           05  FILLER                   PIC X(9)  VALUE 'REF-NO   '.            
           05  FILLER                   PIC X(15) VALUE                         
               'APPLICANT NAMES'.                                               
           05  FILLER                   PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE '  UIN  '.              
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE 'CAT  '.                
           05  FILLER                   PIC X(5)  VALUE 'ALLOC'.                
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'FLAT'.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'HHTY   '.              
           05  FILLER                   PIC X(4)  VALUE 'MCPS'.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'RES-HA1'.              
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'SUCC'.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'NT1   '.               
           05  FILLER                   PIC X(6)  VALUE 'UNSUCC'.               
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'BALLOT'.               
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(2)  VALUE 'ZE'.                   
                                                                                
       01  LB87A-HDG5.                                                          
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE 'REGN-NO'.              
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'SCH'.                  
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'TYPE'.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE '    '.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE '       '.              
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE '     '.                
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'ZONE   '.              
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE '   '.                  
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'ZONE'.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'POS'.                  
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'Q-POS'.                
                                                                                
       01  LB87A-HDG6.                                                          
           05  FILLER                   PIC X(7)  VALUE '       '.              
           05  FILLER                   PIC X(9)  VALUE 'LOAN-TAG '.            
           05  FILLER                   PIC X(15) VALUE                         
               'REQ-STATUS     '.                                               
                                                                                
       01  LB87A-DTL-1.                                                         
           05  LB87A-SERIAL-NO          PIC ZZZ9.                               
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-REF-NO             PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-NAME-1             PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-NRIC-1             PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-CAT                PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-ALLOC              PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  LB87A-FLAT               PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  LB87A-HHTY               PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  LB87A-MCPS               PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(9)  VALUE SPACES.                 
           05  LB87A-RES-HA1            PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  LB87A-SUCC               PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  LB87A-NT1                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  LB87A-UNSUCC             PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  LB87A-BALLOT-POS         PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-ZONE               PIC X(2)  VALUE SPACES.                 
                                                                                
       01  LB87A-DTL-2.                                                         
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  LB87A-REGN-NO            PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-NAME-2             PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-NRIC-2             PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(79) VALUE SPACES.                 
           05  LB87A-QUEUE              PIC X(5)  VALUE SPACES.                 
                                                                                
       01  LB87A-DTL-3.                                                         
           05  FILLER                   PIC X(16) VALUE SPACES.                 
           05  LB87A-BLK                PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-UNIT               PIC X(11) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  LB87A-ADDR2              PIC X(65) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-ADDR3              PIC X(20) VALUE SPACES.                 
                                                                                
       01  LB87A-DTL-4.                                                         
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-LOAN-TAG           PIC X(6)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  LB87A-REQ-STATUS         PIC X(22) VALUE SPACES.                 
                                                                                
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
       0000-MAIN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-FILES             THRU 1000-EXIT.                  
           PERFORM 3500-READ-BP13F740          THRU 3500-EXIT.                  
           PERFORM 3000-PROCESS-RECORDS        THRU 3000-EXIT                   
                   UNTIL WS-F740-EOF = 'Y'.                                     
           PERFORM 9000-CLOSE-ROUTINE          THRU 9000-EXIT.                  
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-FILES.                                                         
      ******************************************************************        
           OPEN INPUT BP13F740                                                  
                      BP13K740                                                  
                      BP13K825                                                  
                      BP13K830                                                  
                      BP13K813                                                  
               OUTPUT P13LB87A                                                  
                      P13LB87B                                                  
                      P13LB87C                                                  
                      P13LB87D                                                  
                      P13LB87E                                                  
                      P13LB87F                                                  
                      P13LB87G                                                  
                      P13LB87H.                                                 
                                                                                
           IF BP13K740-STATUS NOT = 00 AND 97                                   
              DISPLAY 'OPENING ERROR-BP13K740-STATUS ' BP13K740-STATUS          
              MOVE     BP13K740-STATUS TO RETURN-CODE                           
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K825 STATUS IS ' WS-K825-STATUS            
              MOVE     WS-K825-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K830 STATUS IS ' WS-K830-STATUS            
              MOVE     WS-K830-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K813-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K813 STATUS IS ' WS-K813-STATUS            
              MOVE     WS-K813-STATUS TO RETURN-CODE                            
              PERFORM  9000-CLOSE-ROUTINE.                                      
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO  WS-SYSTEM-DATE.                 
                                                                                
           MOVE   WS-SYS-DD           TO WS-EDITED-DD.                          
           MOVE   WS-SYS-MM           TO WS-EDITED-MM.                          
           MOVE   WS-SYS-CCYY         TO WS-EDITED-YY.                          
           MOVE   WS-EDITED-DATE      TO LB87A-DATE.                            
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           IF F740-DTE-BALLOT  NOT = SPACES AND LOW-VALUES                      
             IF F740-CDE-FLAT-TYPE = 'SP'                                       
               MOVE SPACES                     TO   BP13K740-REC                
               MOVE F740-NUM-JB-REGN           TO   K740-NUM-REGN               
               PERFORM 4000-READ-BP13K740      THRU 4000-EXIT                   
               MOVE K740-CDE-FLAT-TYPE         TO   WS-FLAT-TYPE                
             END-IF                                                             
             MOVE SPACES                       TO   BP13K740-REC                
             MOVE F740-NUM-REGN                TO   K740-NUM-REGN               
                                                    LB87-REF                    
              PERFORM 4000-READ-BP13K740       THRU 4000-EXIT                   
              IF WS-NOT-FND-K740 = 'N'                                          
                PERFORM 5300-READ-K813         THRU 5300-EXIT                   
                PERFORM 4500-MOVE-DETAILS      THRU 4500-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 3500-READ-BP13F740     THRU 3500-EXIT.                       
                                                                                
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      ******************************************************************        
       3500-READ-BP13F740.                                                      
      ******************************************************************        
                                                                                
           READ BP13F740                                                        
                AT END MOVE 'Y' TO WS-F740-EOF                                  
                       GO TO 3500-EXIT.                                         
                                                                                
           ADD  1   TO  WS-F740-READ-CTR.                                       
           MOVE 'N' TO  WS-NOT-FND-K740.                                        
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4000-READ-BP13K740.                                                      
      ******************************************************************        
                                                                                
            MOVE 'N' TO WS-NOT-FND-K740.                                        
            READ BP13K740 KEY IS K740-NUM-REGN.                                 
                                                                                
            EVALUATE BP13K740-STATUS                                            
               WHEN '00'                                                        
                  CONTINUE                                                      
               WHEN '23'                                                        
                  ADD 1     TO WS-K740-NOT-FND                                  
                  DISPLAY 'RECORD NOT FOUND IN BP13K740, KEY IS '               
                  F740-NUM-REGN                                                 
                  MOVE 'Y' TO WS-NOT-FND-K740                                   
               WHEN OTHER                                                       
                  DISPLAY 'ERROR IN READING BP13K740, STATUS - '                
                  BP13K740-STATUS                                               
                  PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                     
            END-EVALUATE.                                                       
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4500-MOVE-DETAILS.                                                       
      ******************************************************************        
                                                                                
           MOVE F740-DTE-BALLOT  TO WS-DTE-BALLOT.                              
                                                                                
           EVALUATE WS-DTE-BALLOT(5:2)                                          
           WHEN 01                                                              
             STRING 'JANUARY '    F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 02                                                              
             STRING 'FEBRUARY '   F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
                                                                                
           WHEN 03                                                              
             STRING 'MARCH '      F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 04                                                              
             STRING 'APRIL '      F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
                                                                                
           WHEN 05                                                              
             STRING 'MAY '        F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 06                                                              
             STRING 'JUNE '       F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 07                                                              
             STRING 'JULY '       F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 08                                                              
             STRING 'AUGUST '     F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 09                                                              
             STRING 'SEPTEMBER '  F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 10                                                              
             STRING 'OCTOBER '    F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 11                                                              
             STRING 'NOVEMBER '   F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
                                                                                
           WHEN 12                                                              
             STRING 'DECEMBER '   F740-DTE-BALLOT(1:4)                          
                      ' BUILD-TO-ORDER (BTO) EXERCISE '                         
               DELIMITED BY SIZE INTO       LB87-NME-EXERCISE                   
           END-EVALUATE.                                                        
                                                                                
                                                                                
           MOVE SPACES                     TO LB87-ROOM-4P5P                    
                                              LB87-ROOM-SP                      
                                                                                
                                                                                
           MOVE 'Studio Apartment'      TO LB87-ROOM-SP                         
                                                                                
           IF F740-CDE-FLAT-TYPE = 'SP'                                         
             STRING WS-FLAT-TYPE(1:1)       '-room flat'                        
                  DELIMITED BY '  ' INTO LB87-ROOM-4P5P                         
           ELSE                                                                 
             STRING F740-CDE-FLAT-TYPE(1:1) '-room flat'                        
                  DELIMITED BY '  ' INTO LB87-ROOM-4P5P                         
           END-IF.                                                              
                                                                                
                                                                                
           IF F740-CDE-FLAT-TYPE = 'SP'                                         
              MOVE F740-NUM-JB-REGN  TO LB87-REGNUM                             
           ELSE                                                                 
              MOVE F740-NUM-REGN     TO LB87-REGNUM                             
           END-IF                                                               
                                                                                
                                                                                
           MOVE LB87-NME-EXERCISE(1:3) TO WS-MONTH.                             
                                                                                
           STRING WS-MONTH    ' '                                               
                  F740-DTE-BALLOT(1:4) ' '                                      
                  DELIMITED BY '  ' INTO LB87-BALLOT-DTE.                       
                                                                                
           MOVE K740-NUM-NT-FT-QUEUE      TO LB87-QUEUE-POS                     
                                                                                
           MOVE SPACES                    TO K825-KEY-FLD.                      
           MOVE K740-NUM-REGN             TO K825-NUM-REGN.                     
           MOVE K740-NUM-NRIC1            TO K825-NUM-NRIC.                     
                                                                                
           PERFORM  4600-READ-K825      THRU 4600-EXIT.                         
           MOVE     WS-K825-NME-OCCP      TO LB87-NAME01.                       
                                                                                
           IF K740-NUM-NRIC2 (2:1) = '#' OR SPACES OR LOW-VALUES                
              MOVE SPACES                 TO    LB87-NAME02                     
           ELSE                                                                 
              MOVE SPACES                    TO K825-KEY-FLD                    
              MOVE K740-NUM-REGN             TO K825-NUM-REGN                   
              MOVE K740-NUM-NRIC2            TO K825-NUM-NRIC                   
              PERFORM  4600-READ-K825        THRU 4600-EXIT                     
              MOVE     WS-K825-NME-OCCP      TO LB87-NAME02                     
           END-IF.                                                              
                                                                                
           PERFORM  7000-CHECK-SCH   THRU  7000-EXIT.                           
           PERFORM  4800-GET-ADDR    THRU  4800-EXIT.                           
                                                                                
                                                                                
             IF F740-NUM-NT-FT-QUEUE >= K813-NUM-QUEUE-START                    
                AND F740-NUM-NT-FT-QUEUE <= K813-NUM-QUEUE-MID                  
                IF F740-CDE-FLAT-TYPE = 'SP'                                    
                   PERFORM 6010-PRT-BP13J3    THRU 6010-EXIT                    
                ELSE                                                            
                   PERFORM 6000-PRT-BP13J0    THRU 6000-EXIT                    
                END-IF                                                          
             END-IF                                                             
                                                                                
             IF F740-NUM-NT-FT-QUEUE > K813-NUM-QUEUE-MID                       
                 AND F740-NUM-NT-FT-QUEUE <= K813-NUM-QUEUE-END                 
                IF F740-CDE-FLAT-TYPE = 'SP'                                    
                   PERFORM 6210-PRT-BP13J4     THRU 6210-EXIT                   
                ELSE                                                            
                   PERFORM 6200-PRT-BP13J1     THRU 6200-EXIT                   
                END-IF                                                          
             END-IF                                                             
                                                                                
             IF F740-NUM-NT-FT-QUEUE > K813-NUM-QUEUE-END                       
                   PERFORM 6250-PRT-BP13J2 THRU 6250-EXIT                       
             END-IF                                                             
                                                                                
                                                                                
           PERFORM 6500-PRINT-CONTROL-LIST  THRU 6500-EXIT.                     
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4600-READ-K825.                                                          
      ******************************************************************        
                                                                                
           MOVE    SPACES                TO  WS-K825-NME-OCCP                   
           READ BP13K825.                                                       
                                                                                
           IF WS-K825-STATUS = 00 OR 02                                         
              MOVE    K825-NME-OCCP      TO  WS-K825-NME-OCCP                   
           ELSE                                                                 
           IF WS-K825-STATUS = 23                                               
              DISPLAY 'K825 REC NOT FOUND : '   K825-KEY-FLD                    
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K825 = '   WS-K825-STATUS              
                      ', K825-KEY-FLD = '   K825-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4800-GET-ADDR.                                                           
      ******************************************************************        
                                                                                
           MOVE SPACES TO LB87-LINE-06 LB87-LINE-07 LB87-LINE-08.               
           MOVE SPACES TO LB87-LINE-05.                                         
           MOVE SPACES            TO    K830-KEY-FLD.                           
                                                                                
           MOVE F740-NUM-REGN     TO    K830-KEY-FLD.                           
           READ BP13K830.                                                       
                                                                                
           IF WS-K830-STATUS = 00                                               
              IF ((K830-NUM-MAIL-ADDR =  SPACES OR LOW-VALUES) OR               
                 (K830-NME-MAIL-STR-BLDG(1:47) = SPACES))                       
                 MOVE K830-NUM-BLK         TO LB87-BLK                          
                 IF K830-NUM-LVL-NUM = SPACES AND                               
                    K830-NUM-HSEMAIN = SPACES                                   
                    MOVE SPACES            TO LB87-UNIT                         
                 ELSE                                                           
                    MOVE K830-NUM-FLAT     TO LB87-UNIT                         
                 END-IF                                                         
                 MOVE K830-NME-STREET-BLDG(1:47) TO LB87-ADDR-L2                
                 IF K830-NUM-POSTAL  = SPACES OR LOW-VALUES OR ZEROES           
                    MOVE SPACES            TO LB87-ADDR-L3                      
                 ELSE                                                           
                    STRING 'SINGAPORE '  K830-NUM-POSTAL                        
                       DELIMITED BY SIZE INTO LB87-ADDR-L3                      
                 END-IF                                                         
      *------ TO GET THE BAR CODE ------                                        
                                                                                
                 MOVE SPACES                    TO WS-LINK-AV02C015             
                 MOVE K830-NUM-POSTAL           TO AV02C015-IN-POSTCODE         
                 PERFORM 4950-CALL-AV02C015     THRU 4950-EXIT                  
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO LB87-BAR-CODE             
              ELSE                                                              
                 MOVE K830-NUM-MAIL-BLK         TO LB87-BLK                     
                 IF K830-NUM-MAIL-LVL-NUM = SPACES AND                          
                    K830-NUM-MAIL-HSEMAIN = SPACES                              
                    MOVE SPACES                 TO LB87-UNIT                    
                 ELSE                                                           
                    MOVE K830-NUM-MAIL-FLAT     TO LB87-UNIT                    
                 END-IF                                                         
                 MOVE K830-NME-MAIL-STR-BLDG(1:47) TO LB87-ADDR-L2              
                 IF K830-NUM-MAIL-POSTAL = SPACES OR LOW-VALUES OR ZEROS        
                    MOVE SPACES                TO LB87-ADDR-L3                  
                 ELSE                                                           
                    STRING 'SINGAPORE '      K830-NUM-MAIL-POSTAL               
                           DELIMITED BY SIZE INTO LB87-ADDR-L3                  
                 END-IF                                                         
      *------ TO GET THE BAR CODE ------                                        
                                                                                
                 MOVE SPACES                    TO WS-LINK-AV02C015             
                 MOVE K830-NUM-MAIL-POSTAL      TO AV02C015-IN-POSTCODE         
                 PERFORM 4950-CALL-AV02C015     THRU 4950-EXIT                  
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO LB87-BAR-CODE             
              END-IF                                                            
           ELSE                                                                 
           IF WS-K830-STATUS = 23                                               
              MOVE SPACES TO LB87-LINE-06 LB87-LINE-07 LB87-LINE-08             
              MOVE SPACES TO LB87-LINE-05                                       
              DISPLAY 'BP13K830 RECORD NOT FOUND = ' WS-K830-STATUS             
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K830 = ' WS-K830-STATUS                
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT.                        
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4950-CALL-AV02C015.                                                      
      ******************************************************************        
                                                                                
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
       4950-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5300-READ-K813.                                                          
      ******************************************************************        
                                                                                
           MOVE SPACES                      TO BP13K813-REC.                    
           INITIALIZE                          BP13K813-REC.                    
           MOVE F740-CDE-NT1                TO K813-NUM-ZONE.                   
           MOVE F740-CDE-FLAT-TYPE          TO K813-NUM-FLAT-TYPE.              
           MOVE F740-DTE-BALLOT             TO K813-DTE-BALLOT.                 
                                                                                
           READ BP13K813.                                                       
                                                                                
           EVALUATE WS-K813-STATUS                                              
             WHEN 00                                                            
               MOVE K813-TXT-SEL-PERIOD-LTR    TO LB87-OUTCOME                  
                                                  LB87-OUTCOME-J1               
               MOVE K813-NME-PROJECT-LTR TO LB87-ESTATE                         
                                                                                
               STRING K813-DTE-LETTER-PRINT(7:2) '/'                            
                      K813-DTE-LETTER-PRINT(5:2) '/'                            
                      K813-DTE-LETTER-PRINT(1:4) DELIMITED BY SIZE              
                 INTO LB87-DATE                                                 
                                                                                
             WHEN 23                                                            
               MOVE K740-CDE-NT1         TO LB87-ESTATE                         
               MOVE SPACES               TO LB87-OUTCOME                        
                                            LB87-OUTCOME-J1                     
                                            LB87-DATE                           
               DISPLAY 'RECORD NOT FOUND IN BP13K813, KEY IS '                  
                '02' K740-CDE-NT1                                               
             WHEN OTHER                                                         
                  DISPLAY 'ERROR IN READING BP13K813, STATUS - '                
                  WS-K813-STATUS                                                
           END-EVALUATE.                                                        
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6050-PRINT-CONTROL-GRO.                                                  
      ******************************************************************        
                                                                                
           MOVE 'P13LB87F'             TO   LB87A-LISTING.                      
           MOVE 'CONTROL LIST FOR SUCCESSFUL GRO CASES.'                        
                                       TO   LB87A-LISTING-TYPE.                 
           ADD    1                    TO   WS-CNT-LETTERS-GRO.                 
           MOVE   WS-CNT-LETTERS-GRO   TO   LB87A-SERIAL-NO.                    
                                                                                
           IF WS-CNT-LINE-LB87F > WS2-MAX-LINES-LB87F                           
              ADD   1                  TO   WS-CNT-PAGE-LB87F                   
              MOVE  1                  TO   WS-CNT-LINE-LB87F                   
              MOVE  WS-CNT-PAGE-LB87F  TO   LB87A-PAGE                          
              WRITE LB87F-PRTREC       FROM LB87A-HDG1 AFTER PAGE               
                                                                                
              WRITE LB87F-PRTREC       FROM LB87A-HDG2 AFTER 1                  
              WRITE LB87F-PRTREC       FROM LB87A-HDG4 AFTER 2                  
              WRITE LB87F-PRTREC       FROM LB87A-HDG5 AFTER 1                  
              WRITE LB87F-PRTREC       FROM LB87A-HDG6 AFTER 1                  
                                                                                
              MOVE  SPACES             TO   LB87F-PRTREC                        
              WRITE LB87F-PRTREC                                                
           END-IF.                                                              
                                                                                
           WRITE   LB87F-PRTREC         FROM  LB87A-DTL-1 AFTER 1.              
           WRITE   LB87F-PRTREC         FROM  LB87A-DTL-2 AFTER 1.              
           WRITE   LB87F-PRTREC         FROM  LB87A-DTL-3 AFTER 1.              
           WRITE   LB87F-PRTREC         FROM  LB87A-DTL-4 AFTER 1.              
           MOVE    SPACES               TO    LB87F-PRTREC.                     
           WRITE   LB87F-PRTREC.                                                
           ADD     4                    TO    WS-CNT-LINE-LB87F.                
           ADD     1                    TO    WS-LB87F-WRT-CTR.                 
                                                                                
       6050-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6000-PRT-BP13J0.                                                         
      ******************************************************************        
                                                                                
            MOVE  SPACES         TO    LB87A-PRT-REC.                           
            WRITE LB87A-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-01  AFTER 1.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-02.                           
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-03  AFTER 5.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-04.                           
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-05.                           
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-06.                           
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-07.                           
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-08  AFTER 3.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-8D  AFTER 6.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-09  AFTER 3.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-10  AFTER 1.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-11  AFTER 1.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-12  AFTER 2.                  
            WRITE LB87A-PRT-REC   FROM  LB87-LINE-13  AFTER 1.                  
            ADD   1              TO    WS-LB87A-WRT-CTR.                        
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6010-PRT-BP13J3.                                                         
      ******************************************************************        
                                                                                
            MOVE  SPACES         TO    LB87G-PRT-REC.                           
            WRITE LB87G-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-01  AFTER 1.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-02.                           
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-03  AFTER 5.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-04.                           
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-05.                           
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-06.                           
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-07.                           
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-08  AFTER 3.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-8D  AFTER 6.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-09  AFTER 3.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-10  AFTER 1.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-11  AFTER 1.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-12  AFTER 2.                  
            WRITE LB87G-PRT-REC   FROM  LB87-LINE-13  AFTER 1.                  
            ADD   1              TO    WS-LB87G-WRT-CTR.                        
                                                                                
       6010-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       6200-PRT-BP13J1.                                                         
      ******************************************************************        
                                                                                
            MOVE  SPACES         TO    LB87B-PRT-REC.                           
            WRITE LB87B-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-01  AFTER 1.                  
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-02.                           
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-03  AFTER 5.                  
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-04.                           
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-05.                           
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-06.                           
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-07.                           
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-08    AFTER 3.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-8D    AFTER 6.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-09    AFTER 3.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-10    AFTER 1.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-11    AFTER 1.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-12    AFTER 2.                
            WRITE LB87B-PRT-REC   FROM  LB87-LINE-13-J1 AFTER 3.                
            ADD   1               TO    WS-LB87B-WRT-CTR.                       
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6210-PRT-BP13J4.                                                         
      ******************************************************************        
                                                                                
            MOVE  SPACES         TO    LB87H-PRT-REC.                           
            WRITE LB87H-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-01  AFTER 1.                  
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-02.                           
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-03  AFTER 5.                  
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-04.                           
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-05.                           
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-06.                           
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-07.                           
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-08    AFTER 3.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-8D    AFTER 6.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-09    AFTER 3.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-10    AFTER 1.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-11    AFTER 1.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-12    AFTER 2.                
            WRITE LB87H-PRT-REC   FROM  LB87-LINE-13-J1 AFTER 3.                
            ADD   1               TO    WS-LB87H-WRT-CTR.                       
                                                                                
       6210-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      ******************************************************************        
       6250-PRT-BP13J2.                                                         
      ******************************************************************        
                                                                                
            MOVE  SPACES         TO    LB87C-PRT-REC.                           
            WRITE LB87C-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-01  AFTER 1.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-02.                           
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-03  AFTER 5.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-04.                           
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-05.                           
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-06.                           
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-07.                           
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-08  AFTER 3.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-8D  AFTER 6.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-09  AFTER 3.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-10  AFTER 1.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-11  AFTER 1.                  
            WRITE LB87C-PRT-REC   FROM  LB87-LINE-12  AFTER 2.                  
            ADD   1              TO    WS-LB87C-WRT-CTR.                        
                                                                                
       6250-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       6500-PRINT-CONTROL-LIST.                                                 
      ******************************************************************        
      *    PRINT CONTROL LISTING FOR SUCCESSFUL APPLICANTS                      
      *-------------------------------------------------------------            
                                                                                
           MOVE F740-NUM-REF              TO    LB87A-REF-NO.                   
           MOVE F740-NUM-REGN             TO    LB87A-REGN-NO.                  
           MOVE LB87-NAME01               TO    LB87A-NAME-1.                   
           MOVE F740-NUM-NRIC1            TO    LB87A-NRIC-1.                   
           MOVE F740-CDE-NT1              TO    LB87A-NT1.                      
           MOVE F740-CDE-HOUSEHOLD        TO    LB87A-HHTY.                     
           MOVE F740-NUM-MCPS             TO    LB87A-MCPS.                     
           MOVE F740-CDE-RESIDENT-HA1     TO    LB87A-RES-HA1.                  
           MOVE F740-CDE-FLAT-TYPE        TO    LB87A-FLAT.                     
           MOVE F740-CDE-ALLOC-SCH        TO    LB87A-ALLOC.                    
           MOVE F740-CDE-UNSUCC           TO    LB87A-UNSUCC.                   
           MOVE F740-CDE-CATEGORY         TO    LB87A-CAT.                      
           MOVE F740-CDE-SUCC-NT-ZONE     TO    LB87A-SUCC.                     
           MOVE F740-CDE-ZONE             TO    LB87A-ZONE.                     
           MOVE LB87-NAME02               TO    LB87A-NAME-2.                   
           IF F740-NUM-NRIC2 (2:1) NOT = '#'                                    
              MOVE F740-NUM-NRIC2         TO    LB87A-NRIC-2                    
           ELSE                                                                 
              MOVE SPACES                 TO    LB87A-NRIC-2.                   
           MOVE F740-NUM-NT-FT-QUEUE      TO    LB87A-QUEUE.                    
           MOVE F740-NUM-BALLOT-POSITION  TO    LB87A-BALLOT-POS.               
           MOVE F740-NUM-LOAN-TAG         TO    LB87A-LOAN-TAG.                 
           MOVE F740-CDE-REQUEST-STATUS   TO    LB87A-REQ-STATUS.               
                                                                                
      *-----------> PREPARE ADDRESS FOR BP13LB87A CONTROL LIST                  
           MOVE SPACES                    TO    LB87A-DTL-3.                    
           MOVE LB87-BLK                  TO    LB87A-BLK.                      
           MOVE LB87-UNIT                 TO    LB87A-UNIT.                     
           MOVE LB87-ADDR-L2              TO    LB87A-ADDR2.                    
           MOVE LB87-ADDR-L3              TO    LB87A-ADDR3.                    
           MOVE LB87-ADDR-L3              TO    LB87A-ADDR3.                    
                                                                                
           IF F740-NUM-NT-FT-QUEUE >= K813-NUM-QUEUE-START                      
              AND F740-NUM-NT-FT-QUEUE <= K813-NUM-QUEUE-MID                    
                 PERFORM 6600-PRINT-CONTROL-SUCC THRU  6600-EXIT                
           END-IF.                                                              
                                                                                
           IF F740-NUM-NT-FT-QUEUE > K813-NUM-QUEUE-MID                         
               AND F740-NUM-NT-FT-QUEUE <= K813-NUM-QUEUE-END                   
                PERFORM 6600-PRINT-CONTROL-SUCC THRU  6600-EXIT                 
           END-IF.                                                              
                                                                                
           IF F740-NUM-NT-FT-QUEUE > K813-NUM-QUEUE-END                         
                 PERFORM 6700-PRINT-CONTROL-UNSUCC THRU  6700-EXIT              
           END-IF.                                                              
                                                                                
                                                                                
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************************************************            
       6600-PRINT-CONTROL-SUCC.                                                 
      **************************************************************            
                                                                                
           MOVE 'P13LB87E'             TO LB87A-LISTING.                        
           MOVE 'CONTROL LIST FOR SUCCESSFUL LETTER '                           
                                       TO LB87A-LISTING-TYPE.                   
           ADD    1                    TO    WS-CNT-LETTERS-SUCC.               
           MOVE   WS-CNT-LETTERS-SUCC  TO    LB87A-SERIAL-NO.                   
                                                                                
           IF WS-CNT-LINE-LB87E > WS2-MAX-LINES-LB87C                           
              ADD   1                  TO   WS-CNT-PAGE-LB87E                   
              MOVE  1                  TO   WS-CNT-LINE-LB87E                   
              MOVE  WS-CNT-PAGE-LB87E  TO   LB87A-PAGE                          
              WRITE LB87E-PRTREC       FROM LB87A-HDG1 AFTER PAGE               
                                                                                
              WRITE LB87E-PRTREC       FROM LB87A-HDG2 AFTER 1                  
              WRITE LB87E-PRTREC       FROM LB87A-HDG4 AFTER 2                  
              WRITE LB87E-PRTREC       FROM LB87A-HDG5 AFTER 1                  
              WRITE LB87E-PRTREC       FROM LB87A-HDG6 AFTER 1                  
                                                                                
              MOVE  SPACES             TO   LB87E-PRTREC                        
              WRITE LB87E-PRTREC                                                
           END-IF.                                                              
                                                                                
           WRITE   LB87E-PRTREC         FROM  LB87A-DTL-1 AFTER 1.              
           WRITE   LB87E-PRTREC         FROM  LB87A-DTL-2 AFTER 1.              
           WRITE   LB87E-PRTREC         FROM  LB87A-DTL-3 AFTER 1.              
           WRITE   LB87E-PRTREC         FROM  LB87A-DTL-4 AFTER 1.              
           MOVE    SPACES               TO    LB87E-PRTREC.                     
           WRITE   LB87E-PRTREC.                                                
           ADD     4                    TO    WS-CNT-LINE-LB87E.                
                                                                                
       6600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************************************************            
       6700-PRINT-CONTROL-UNSUCC.                                               
      **************************************************************            
                                                                                
           MOVE 'P13LB87D'             TO LB87A-LISTING.                        
           MOVE 'CONTROL LIST FOR SUCCESSFUL LETTER (>200%) '                   
                                       TO LB87A-LISTING-TYPE.                   
           ADD    1                    TO    WS-CNT-LETTERS-UNSUCC.             
           MOVE   WS-CNT-LETTERS-UNSUCC  TO    LB87A-SERIAL-NO.                 
                                                                                
           IF WS-CNT-LINE-LB87D > WS2-MAX-LINES-LB87D                           
              ADD   1                  TO   WS-CNT-PAGE-LB87D                   
              MOVE  1                  TO   WS-CNT-LINE-LB87D                   
              MOVE  WS-CNT-PAGE-LB87D  TO   LB87A-PAGE                          
              WRITE LB87D-PRTREC       FROM LB87A-HDG1 AFTER PAGE               
                                                                                
              WRITE LB87D-PRTREC       FROM LB87A-HDG2 AFTER 1                  
              WRITE LB87D-PRTREC       FROM LB87A-HDG4 AFTER 2                  
              WRITE LB87D-PRTREC       FROM LB87A-HDG5 AFTER 1                  
                                                                                
              MOVE  SPACES             TO   LB87D-PRTREC                        
              WRITE LB87D-PRTREC                                                
           END-IF.                                                              
                                                                                
           WRITE   LB87D-PRTREC         FROM  LB87A-DTL-1 AFTER 1.              
           WRITE   LB87D-PRTREC         FROM  LB87A-DTL-2 AFTER 1.              
           WRITE   LB87D-PRTREC         FROM  LB87A-DTL-3 AFTER 1.              
           MOVE    SPACES               TO    LB87D-PRTREC.                     
           WRITE   LB87D-PRTREC.                                                
           ADD     4                    TO    WS-CNT-LINE-LB87D.                
                                                                                
       6700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************************************************            
       7000-CHECK-SCH.                                                          
      **************************************************************            
                                                                                
           SET WS-ALLOC-PTR TO 1.                                               
                                                                                
           SEARCH WS-ALLOC-SCH                                                  
               AT END MOVE 'XXX' TO WS-ALLOCSCH-TYPE                            
             WHEN F740-CDE-ALLOC-SCH = WS-ALLOC-SCH-DESP(WS-ALLOC-PTR)          
             MOVE WS-MAIN-SCH-CD(WS-ALLOC-PTR) TO WS-ALLOCSCH-TYPE.             
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************************************************            
       9000-CLOSE-ROUTINE.                                                      
      **************************************************************            
           DISPLAY ' '.                                                         
           DISPLAY ' ====  BP13CB87 CONTROL TOTALS  ======'.                    
           DISPLAY ' '.                                                         
           DISPLAY ' F740 RECORDS READ          : ' WS-F740-READ-CTR.           
           DISPLAY ' LETTER PRINTED (BP13J0)    : ' WS-LB87A-WRT-CTR.           
           DISPLAY ' LETTER PRINTED (BP13J1)    : ' WS-LB87B-WRT-CTR.           
           DISPLAY ' LETTER PRINTED (BP13J2)    : ' WS-LB87C-WRT-CTR.           
           DISPLAY ' LETTER PRINTED (BP13J3)    : ' WS-LB87G-WRT-CTR.           
           DISPLAY ' LETTER PRINTED (BP13J4)    : ' WS-LB87H-WRT-CTR.           
           DISPLAY ' '.                                                         
           DISPLAY ' ====================================='.                    
                                                                                
           CLOSE BP13F740                                                       
                 BP13K825                                                       
                 BP13K830                                                       
                 BP13K813                                                       
                 P13LB87A                                                       
                 P13LB87B                                                       
                 P13LB87C                                                       
                 P13LB87D                                                       
                 P13LB87E                                                       
                 P13LB87F                                                       
                 P13LB87G                                                       
                 P13LB87H.                                                      
                                                                                
           IF WS-K825-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K825-STAT ' WS-K825-STATUS.            
                                                                                
           IF WS-K830-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K830-STAT ' WS-K830-STATUS.            
                                                                                
           IF WS-K813-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K813-STAT ' WS-K813-STATUS.            
                                                                                
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
