       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13CFA4.                                         00020000
       AUTHOR.        ZDD1.                                             00030000
       DATE-WRITTEN.  28 JUNE 2017.                                     00040000
                                                                        00050000
      *************************************************************     00060000
      *        SYSTEM OF COMMITMENT               (BP13)          *     00070000
      *===========================================================*     00080000
      *                                                           *     00090000
      *  OBJECTIVE   : Generate XML files for FTP to send         *     00100000
      *                automated SMS                              *     00110000
      *                                                           *     00120000
      *  INPUT FILES  : BP13F203                                  *     00130000
      *               : SY02F001                                  *     00140000
      *                                                           *     00150000
      *                                                           *     00160000
      *                                                           *     00170000
      *  OUTPUT FILE  : BP13F203                                  *     00180000
      *                                                           *     00190000
      *-----------------------------------------------------------*     00200000
      *                                                           *     00210000
      * CHGE REQ #   DATE       AUTHOR    REMARKS                 *     00220000
      * ----------   --------   ------    -------                 *     00230000
      * BP136992     28062017   zdd1      NEW PROGRAM             *     00240000
      * BP137216     20022018   zdd1      changes on sms content  *     00250000
      * BP137420     08082018   srg1      changes on sms content  *     00260000
      * BP137602     27022019   MRN1      date ballot to get from *     00270000
      *                                   BP13F203                *     00280000
      * BP137934     23092019   PP11      changes on sms content  *     00281003
      *                                                           *     00290000
      *************************************************************     00300000
                                                                        00310000
       ENVIRONMENT DIVISION.                                            00320000
                                                                        00330000
       CONFIGURATION SECTION.                                           00340000
                                                                        00350000
       SOURCE-COMPUTER. IBM-3090.                                       00360000
       OBJECT-COMPUTER. IBM-3090.                                       00370000
                                                                        00380000
       INPUT-OUTPUT SECTION.                                            00390000
                                                                        00400000
       FILE-CONTROL.                                                    00410000
                                                                        00420000
           SELECT SY02F001  ASSIGN        TO  SY02F001.                 00430000
                                                                        00440000
           SELECT B13DUMMY  ASSIGN        TO  B13DUMMY.                 00450000
                                                                        00460000
           SELECT BP13F203  ASSIGN        TO  BP13F203.                 00470000
                                                                        00480000
           SELECT B13F203A  ASSIGN        TO  B13F203A.                 00490000
           SELECT B13F203B  ASSIGN        TO  B13F203B.                 00500000
           SELECT B13F203C  ASSIGN        TO  B13F203C.                 00510000
           SELECT B13F203D  ASSIGN        TO  B13F203D.                 00520000
           SELECT B13F203E  ASSIGN        TO  B13F203E.                 00530000
                                                                        00540000
       DATA DIVISION.                                                   00550000
                                                                        00560000
       FILE SECTION.                                                    00570000
                                                                        00580000
       FD   B13F203A                    RECORD CONTAINS 500 CHARACTERS  00590000
                                        RECORDING MODE IS F.            00600000
       01   B13F203A-REC                PIC X(500).                     00610000
                                                                        00620000
       FD   B13F203B                    RECORD CONTAINS 500 CHARACTERS  00630000
                                        RECORDING MODE IS F.            00640000
       01   B13F203B-REC                PIC X(500).                     00650000
                                                                        00660000
       FD   B13F203C                    RECORD CONTAINS 500 CHARACTERS  00670000
                                        RECORDING MODE IS F.            00680000
       01   B13F203C-REC                PIC X(500).                     00690000
                                                                        00700000
       FD   B13F203D                    RECORD CONTAINS 500 CHARACTERS  00710000
                                        RECORDING MODE IS F.            00720000
       01   B13F203D-REC                PIC X(500).                     00730000
                                                                        00740000
       FD   B13F203E                    RECORD CONTAINS 500 CHARACTERS  00750000
                                        RECORDING MODE IS F.            00760000
       01   B13F203E-REC                PIC X(500).                     00770000
                                                                        00780000
       FD   B13DUMMY                    RECORD CONTAINS 20  CHARACTERS  00790000
                                        RECORDING MODE IS F.            00800000
       01   B13DUMMY-REC.                                               00810000
            05 B13DUMMY-NUM-MOBILE      PIC X(8).                       00820000
            05 FILLER                   PIC X(12).                      00830000
                                                                        00840000
       FD   BP13F203                    RECORD CONTAINS 200 CHARACTERS  00850000
                                        RECORDING MODE IS F.            00860000
       COPY BP13F203.                                                   00870000
                                                                        00880000
       COPY SY02F001.                                                   00890000
                                                                        00900000
       WORKING-STORAGE SECTION.                                         00910000
                                                                        00920000
       01  WS-COUNTERS.                                                 00930000
           05  WS-CTR-BP13F203-READ      PIC 9(07) VALUE 0.             00940000
           05  WS-B13F203A-WRT           PIC 9(07) VALUE 0.             00950000
           05  WS-B13F203B-WRT           PIC 9(07) VALUE 0.             00960000
           05  WS-B13F203C-WRT           PIC 9(07) VALUE 0.             00970000
           05  WS-B13F203D-WRT           PIC 9(07) VALUE 0.             00980000
           05  WS-B13F203E-WRT           PIC 9(07) VALUE 0.             00990000
                                                                        01000000
       01  WS-VARIABLES.                                                01010000
           05  WS-BP13K993-STATUS        PIC 9(2)  VALUE 0.             01020000
           05  WS-BP13F203-EOF           PIC X(1)  VALUE  'N'.          01030000
           05  WS-B13DUMMY-EOF           PIC X(1)  VALUE  'N'.          01040000
           05  WS-DTE-CURRENT            PIC X(08).                     01050000
           05  WS-DAY-OF-WEEK            PIC X(3)  VALUE SPACES.        01060000
           05  WS-HOLIDAY                PIC X(3)  VALUE SPACES.        01070000
           05  WS-DTE-PROP-SEND.                                        01080000
               10 WS-DTE-PROP-SEND-CY    PIC X(4)  VALUE SPACES.        01090000
               10 WS-DTE-PROP-SEND-MM    PIC X(2)  VALUE SPACES.        01100000
               10 WS-DTE-PROP-SEND-DD    PIC X(2)  VALUE '15'.          01110000
           05  WS-NUM-TYPE               PIC X(12) VALUE '1STREM2TO4'.  01120000
           05  WS-SEND-LESSEE            PIC X     VALUE 'N'.           01130000
                                                                        01140000
       01  WS-BP13F203-REC.                                             01150000
           05  FILLER                    PIC X(5)                       01160000
                                         VALUE '<SMS>'.                 01170000
           05  FILLER                    PIC X(11)                      01180000
                                         VALUE '<AGENCYREF>'.           01190000
           05  WS-NUM-SMS                PIC 9(16)                      01200000
                                         VALUE ZEROES.                  01210000
           05  FILLER                    PIC X(12)                      01220000
                                         VALUE '</AGENCYREF>'.          01230000
           05  FILLER                    PIC X(06)                      01240000
                                         VALUE '<DEST>'.                01250000
           05  WS-NUM-MOBILE             PIC X(8)                       01260000
                                         VALUE SPACES.                  01270000
           05  FILLER                    PIC X(07)                      01280000
                                         VALUE '</DEST>'.               01290000
           05  FILLER                    PIC X(05)                      01300000
                                         VALUE '<MSG>'.                 01310000
           05  WS-SMS                    PIC X(324).                    01320004
           05  FILLER                    PIC X(06)                      01330000
                                         VALUE '</MSG>'.                01340000
           05  FILLER                    PIC X(06)                      01350000
                                         VALUE '</SMS>'.                01360000
           05  FILLER                    PIC X(34)    VALUE SPACES.     01370000
                                                                        01380000
       01  WS-BP13F203-REC-A.                                           01390000
           05  FILLER                    PIC X(5)                       01400000
                                         VALUE '<SMS>'.                 01410000
           05  FILLER                    PIC X(11)                      01420000
                                         VALUE '<AGENCYREF>'.           01430000
           05  WS-NUM-SMS-A              PIC 9(16)                      01440000
                                         VALUE ZEROES.                  01450000
           05  FILLER                    PIC X(12)                      01460000
                                         VALUE '</AGENCYREF>'.          01470000
           05  FILLER                    PIC X(06)                      01480000
                                         VALUE '<DEST>'.                01490000
           05  WS-NUM-MOBILE-A           PIC X(8)                       01500000
                                         VALUE SPACES.                  01510000
           05  FILLER                    PIC X(07)                      01520000
                                         VALUE '</DEST>'.               01530000
           05  FILLER                    PIC X(05)                      01540000
                                         VALUE '<MSG>'.                 01550000
           05  WS-SMS-A                  PIC X(324).                    01560004
           05  FILLER                    PIC X(06)                      01570000
                                         VALUE '</MSG>'.                01580000
           05  FILLER                    PIC X(06)                      01590000
                                         VALUE '</SMS>'.                01600000
           05  FILLER                    PIC X(263)     VALUE SPACES.   01610000
                                                                        01620000
       01  WS-MESSAGES.                                                 01630000
           05  WS-LESSEE-MSG.                                           01640000
               10 FILLER                 PIC X(033) VALUE               01650000
               'Your balloted queue position for '.                     01660000
               10 WS-BALLOT-MONTH        PIC X(003) VALUE SPACES.       01670000
               10 FILLER                 PIC X(001) VALUE SPACES.       01680000
               10 WS-BALLOT-YEAR         PIC X(004) VALUE SPACES.       01690000
               10 FILLER                 PIC X(013) VALUE               01700000
               ' ROF exercise'.                                         01710000
               10 FILLER                 PIC X(004) VALUE               01720000
               ' is '.                                                  01730000
               10 WS-QUEUE-MSG           PIC X(005) VALUE SPACES.       01740000
               10 FILLER                 PIC X(054) VALUE               01750000
               '. More details will be provided at a later date. If yo'.01760000
               10 FILLER                 PIC X(054) VALUE               01770000
               'u have yet to book a flat, you may continue to partici'.01780000
               10 FILLER                 PIC X(054) VALUE               01781000
               'pate in our BTO, SBF, ROF exercise or the open booking'.01782004
               10 FILLER                 PIC X(054) VALUE               01783000
               ' of flats. Please visit HDB InfoWEB at www.hdb.gov.sg '.01784004
               10 FILLER                 PIC X(045) VALUE               01785004
               'for the details when there is a sales launch.'.         01786004
                                                                        01850000
           05  WS-START-SMS-MSG          PIC X(500) VALUE               01860000
               'Automated SMS sending has started.'.                    01870000
           05  WS-END-SMS-MSG            PIC X(500) VALUE               01880000
               'Automated SMS sending is finished.'.                    01890000
                                                                        01900000
       01  WS-XML-HEADER                 PIC X(500) VALUE               01910000
               "<?xml version='1.0' encoding='UTF-8'?>".                01920000
       01  WS-XML-START                  PIC X(500) VALUE               01930000
               '<SENDSMSBROADCASTREQ>'.                                 01940000
       01  WS-END-XML                    PIC X(500) VALUE               01950000
               '</SENDSMSBROADCASTREQ>'.                                01960000
                                                                        01970000
       PROCEDURE DIVISION.                                              01980000
                                                                        01990000
      ***************************************************************   02000000
       0000-CONTROL.                                                    02010000
      ***************************************************************   02020000
                                                                        02030000
           PERFORM 1000-START-UP           THRU 1000-EXIT.              02040000
           PERFORM 4000-MAIN-ROUTINE       THRU 4000-EXIT               02050000
                   UNTIL WS-BP13F203-EOF = 'Y'.                         02060000
                                                                        02070000
           PERFORM 9999-WRAP-UP.                                        02080000
                                                                        02090000
                                                                        02100000
      ***************************************************************   02110000
       1000-START-UP.                                                   02120000
      ***************************************************************   02130000
                                                                        02140000
           OPEN INPUT  BP13F203                                         02150000
                       SY02F001                                         02160000
                OUTPUT B13F203A                                         02170000
                       B13F203B                                         02180000
                       B13F203C                                         02190000
                       B13F203D                                         02200000
                       B13F203E.                                        02210000
                                                                        02220000
      *----------------------------------                               02230000
      * Read current date from SY02F001                                 02240000
      *----------------------------------                               02250000
                                                                        02260000
           READ SY02F001.                                               02270000
           MOVE F001-DTE-CURRENT          TO  WS-DTE-CURRENT.           02280000
                                                                        02290000
           MOVE F001-DTE-CURRENT(1:4)     TO  WS-DTE-PROP-SEND-CY.      02300000
           MOVE F001-DTE-CURRENT(5:2)     TO  WS-DTE-PROP-SEND-MM.      02310000
                                                                        02320000
       1000-EXIT.                                                       02330000
            EXIT.                                                       02340000
                                                                        02350000
      ***************************************************************   02360000
       4000-MAIN-ROUTINE.                                               02370000
      ***************************************************************   02380000
                                                                        02390000
           PERFORM 5000-BP13F203-READ    THRU 5000-EXIT.                02400000
           PERFORM 6000-WRITE-XML-FILE   THRU 6000-EXIT.                02410000
                                                                        02420000
       4000-EXIT.                                                       02430000
            EXIT.                                                       02440000
                                                                        02450000
      ***************************************************************   02460000
       5000-BP13F203-READ.                                              02470000
      ***************************************************************   02480000
                                                                        02490000
           READ BP13F203                                                02500000
                AT END                                                  02510000
                   MOVE 'Y'           TO   WS-BP13F203-EOF              02520000
                NOT AT END                                              02530000
                   ADD  1                  TO WS-CTR-BP13F203-READ      02540000
                                              WS-NUM-SMS                02550000
                   MOVE F203-NUM-HP        TO WS-NUM-MOBILE.            02560000
                   MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG.           02570000
                   MOVE F203-DTE-BALLOT(1:4) TO WS-BALLOT-YEAR.         02580000
                   EVALUATE F203-DTE-BALLOT(5:2)                        02590000
                    WHEN '01'                                           02600000
                      MOVE 'Jan'             TO WS-BALLOT-MONTH         02610000
                    WHEN '02'                                           02620000
                      MOVE 'Feb'             TO WS-BALLOT-MONTH         02630000
                    WHEN '03'                                           02640000
                      MOVE 'Mar'             TO WS-BALLOT-MONTH         02650000
                    WHEN '04'                                           02660000
                      MOVE 'Apr'             TO WS-BALLOT-MONTH         02670000
                    WHEN '05'                                           02680000
                      MOVE 'May'             TO WS-BALLOT-MONTH         02690000
                    WHEN '06'                                           02700000
                      MOVE 'Jun'             TO WS-BALLOT-MONTH         02710000
                    WHEN '07'                                           02720000
                      MOVE 'Jul'             TO WS-BALLOT-MONTH         02730000
                    WHEN '08'                                           02740000
                      MOVE 'Aug'             TO WS-BALLOT-MONTH         02750000
                    WHEN '09'                                           02760000
                      MOVE 'Sep'             TO WS-BALLOT-MONTH         02770000
                    WHEN '10'                                           02780000
                      MOVE 'Oct'             TO WS-BALLOT-MONTH         02790000
                    WHEN '11'                                           02800000
                      MOVE 'Nov'             TO WS-BALLOT-MONTH         02810000
                    WHEN '12'                                           02820000
                      MOVE 'Dec'             TO WS-BALLOT-MONTH         02830000
                   END-EVALUATE.                                        02840000
                                                                        02850000
       5000-EXIT.                                                       02860000
            EXIT.                                                       02870000
                                                                        02880000
      ****************************************************************  02890000
       6000-WRITE-XML-FILE.                                             02900000
      ****************************************************************  02910000
                                                                        02920000
                 IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000          02930000
               PERFORM 6100-WRITE-B13F203A      THRU 6100-EXIT          02940000
            ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000          02950000
               PERFORM 6200-WRITE-B13F203B      THRU 6200-EXIT          02960000
            ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000          02970000
               PERFORM 6300-WRITE-B13F203C      THRU 6300-EXIT          02980000
            ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000          02990000
               PERFORM 6400-WRITE-B13F203D      THRU 6400-EXIT          03000000
            ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000          03010000
               PERFORM 6500-WRITE-B13F203E      THRU 6500-EXIT          03020000
            END-IF.                                                     03030000
                                                                        03040000
       6000-EXIT.                                                       03050000
            EXIT.                                                       03060000
                                                                        03070000
      ****************************************************************  03080000
       6100-WRITE-B13F203A.                                             03090000
      ****************************************************************  03100000
                                                                        03110000
           IF WS-BP13F203-EOF = 'Y'                                     03120000
              IF WS-NUM-SMS > 0                                         03130000
                 ADD 1                     TO WS-NUM-SMS                03140000
                 MOVE 'N'                  TO WS-SEND-LESSEE            03150000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  03160000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             03170000
                 WRITE B13F203A-REC        FROM WS-END-XML              03180000
              END-IF                                                    03190000
              GO TO 6100-EXIT                                           03200000
           END-IF.                                                      03210000
                                                                        03220000
           IF WS-B13F203A-WRT = 0                                       03230000
              WRITE B13F203A-REC        FROM WS-XML-HEADER              03240000
              WRITE B13F203A-REC        FROM WS-XML-START               03250000
                                                                        03260000
      *-------------------------------*                                 03270000
      * WRITE DUMMY RECORD            *                                 03280000
      *-------------------------------*                                 03290000
      * Notify start of sms sending   *                                 03300000
      *-------------------------------*                                 03310000
              MOVE 'N'                  TO WS-SEND-LESSEE               03320000
              MOVE WS-START-SMS-MSG     TO WS-SMS-A                     03330000
              PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT                03340000
                                                                        03350000
      *-------------------------------*                                 03360000
      * Send text msg sent to lessees *                                 03370000
      *-------------------------------*                                 03380000
              MOVE 'Y'                  TO WS-SEND-LESSEE               03390000
              MOVE WS-LESSEE-MSG        TO WS-SMS                       03400000
              PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT                03410000
                                                                        03420000
              MOVE F203-NUM-HP          TO WS-NUM-MOBILE                03430000
              MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG                 03440000
           END-IF.                                                      03450000
                                                                        03460000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          03470000
           WRITE B13F203A-REC        FROM WS-BP13F203-REC               03480000
           ADD 1                     TO WS-B13F203A-WRT.                03490000
                                                                        03500000
           IF WS-B13F203A-WRT = 2000                                    03510000
              WRITE B13F203A-REC        FROM WS-END-XML.                03520000
                                                                        03530000
       6100-EXIT.                                                       03540000
           EXIT.                                                        03550000
                                                                        03560000
      ****************************************************************  03570000
       6200-WRITE-B13F203B.                                             03580000
      ****************************************************************  03590000
                                                                        03600000
           IF WS-BP13F203-EOF = 'Y'                                     03610000
              IF WS-NUM-SMS > 0                                         03620000
                 ADD 1                     TO WS-NUM-SMS                03630000
                 MOVE 'N'                  TO WS-SEND-LESSEE            03640000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  03650000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             03660000
                 MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE             03670000
                 WRITE B13F203B-REC        FROM WS-END-XML              03680000
              END-IF                                                    03690000
              GO TO 6200-EXIT                                           03700000
           END-IF.                                                      03710000
                                                                        03720000
           IF WS-B13F203B-WRT = 0                                       03730000
              WRITE B13F203B-REC        FROM WS-XML-HEADER              03740000
              WRITE B13F203B-REC        FROM WS-XML-START               03750000
           END-IF.                                                      03760000
                                                                        03770000
           MOVE F203-NUM-HP          TO WS-NUM-MOBILE                   03780000
           MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG                    03790000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          03800000
           WRITE B13F203B-REC        FROM WS-BP13F203-REC               03810000
           ADD 1                     TO WS-B13F203B-WRT.                03820000
                                                                        03830000
           IF WS-B13F203B-WRT = 2000                                    03840000
              WRITE B13F203B-REC        FROM WS-END-XML.                03850000
                                                                        03860000
       6200-EXIT.                                                       03870000
           EXIT.                                                        03880000
                                                                        03890000
      ****************************************************************  03900000
       6300-WRITE-B13F203C.                                             03910000
      ****************************************************************  03920000
                                                                        03930000
           IF WS-BP13F203-EOF = 'Y'                                     03940000
              IF WS-NUM-SMS > 0                                         03950000
                 ADD 1                     TO WS-NUM-SMS                03960000
                 MOVE 'N'                  TO WS-SEND-LESSEE            03970000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  03980000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             03990000
                 WRITE B13F203C-REC        FROM WS-END-XML              04000000
              END-IF                                                    04010000
              GO TO 6300-EXIT                                           04020000
           END-IF.                                                      04030000
                                                                        04040000
           IF WS-B13F203C-WRT = 0                                       04050000
              WRITE B13F203C-REC        FROM WS-XML-HEADER              04060000
              WRITE B13F203C-REC        FROM WS-XML-START               04070000
           END-IF.                                                      04080000
                                                                        04090000
           MOVE F203-NUM-HP          TO WS-NUM-MOBILE                   04100000
           MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG                    04110000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04120000
           WRITE B13F203C-REC        FROM WS-BP13F203-REC               04130000
           ADD 1                     TO WS-B13F203C-WRT.                04140000
                                                                        04150000
           IF WS-B13F203C-WRT = 2000                                    04160000
              WRITE B13F203C-REC        FROM WS-END-XML.                04170000
                                                                        04180000
       6300-EXIT.                                                       04190000
           EXIT.                                                        04200000
                                                                        04210000
      ****************************************************************  04220000
       6400-WRITE-B13F203D.                                             04230000
      ****************************************************************  04240000
                                                                        04250000
           IF WS-BP13F203-EOF = 'Y'                                     04260000
              IF WS-NUM-SMS > 0                                         04270000
                 ADD 1                     TO WS-NUM-SMS                04280000
                 MOVE 'N'                  TO WS-SEND-LESSEE            04290000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  04300000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             04310000
                 WRITE B13F203D-REC        FROM WS-END-XML              04320000
              END-IF                                                    04330000
              GO TO 6400-EXIT                                           04340000
           END-IF.                                                      04350000
                                                                        04360000
           IF WS-B13F203D-WRT = 0                                       04370000
              WRITE B13F203D-REC        FROM WS-XML-HEADER              04380000
              WRITE B13F203D-REC        FROM WS-XML-START               04390000
           END-IF.                                                      04400000
                                                                        04410000
           MOVE F203-NUM-HP          TO WS-NUM-MOBILE                   04420000
           MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG                    04430000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04440000
           WRITE B13F203D-REC        FROM WS-BP13F203-REC               04450000
           ADD 1                     TO WS-B13F203D-WRT.                04460000
                                                                        04470000
           IF WS-B13F203D-WRT = 2000                                    04480000
              WRITE B13F203D-REC        FROM WS-END-XML.                04490000
                                                                        04500000
       6400-EXIT.                                                       04510000
           EXIT.                                                        04520000
                                                                        04530000
      ****************************************************************  04540000
       6500-WRITE-B13F203E.                                             04550000
      ****************************************************************  04560000
                                                                        04570000
           IF WS-BP13F203-EOF = 'Y'                                     04580000
              IF WS-NUM-SMS > 0                                         04590000
                 ADD 1                     TO WS-NUM-SMS                04600000
                 MOVE 'N'                  TO WS-SEND-LESSEE            04610000
                 MOVE WS-END-SMS-MSG       TO WS-SMS-A                  04620000
                 PERFORM 6700-WRITE-DUMMY-HP THRU 6700-EXIT             04630000
                 WRITE B13F203E-REC        FROM WS-END-XML              04640000
              END-IF                                                    04650000
              GO TO 6500-EXIT                                           04660000
           END-IF.                                                      04670000
                                                                        04680000
           IF WS-B13F203E-WRT = 0                                       04690000
              WRITE B13F203E-REC        FROM WS-XML-HEADER              04700000
              WRITE B13F203E-REC        FROM WS-XML-START               04710000
           END-IF.                                                      04720000
                                                                        04730000
           MOVE F203-NUM-HP          TO WS-NUM-MOBILE                   04740000
           MOVE F203-NUM-QUEUE       TO WS-QUEUE-MSG                    04750000
           MOVE WS-LESSEE-MSG        TO WS-SMS                          04760000
           WRITE B13F203E-REC        FROM WS-BP13F203-REC               04770000
           ADD 1                     TO WS-B13F203E-WRT.                04780000
                                                                        04790000
           IF WS-B13F203E-WRT = 2000                                    04800000
              WRITE B13F203E-REC        FROM WS-END-XML.                04810000
                                                                        04820000
       6500-EXIT.                                                       04830000
           EXIT.                                                        04840000
                                                                        04850000
      ****************************************************************  04860000
       6700-WRITE-DUMMY-HP.                                             04870000
      ****************************************************************  04880000
                                                                        04890000
           MOVE 'N'                     TO WS-B13DUMMY-EOF.             04900000
           OPEN INPUT B13DUMMY.                                         04910000
                                                                        04920000
           PERFORM 6710-WRITE-DUMMY          THRU 6710-EXIT             04930000
                   UNTIL WS-B13DUMMY-EOF = 'Y'.                         04940000
                                                                        04950000
           CLOSE B13DUMMY.                                              04960000
                                                                        04970000
       6700-EXIT.                                                       04980000
           EXIT.                                                        04990000
                                                                        05000000
      ****************************************************************  05010000
       6710-WRITE-DUMMY.                                                05020000
      ****************************************************************  05030000
                                                                        05040000
           READ B13DUMMY                                                05050000
                AT END                                                  05060000
                   MOVE 'Y'            TO WS-B13DUMMY-EOF               05070000
                   GO TO 6710-EXIT.                                     05080000
                                                                        05090000
                                                                        05100000
           IF WS-SEND-LESSEE = 'N'                                      05110000
              MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE-A              05120000
           ELSE                                                         05130000
              MOVE B13DUMMY-NUM-MOBILE  TO WS-NUM-MOBILE                05140000
           END-IF.                                                      05150000
                                                                        05160000
           IF WS-SEND-LESSEE = 'N'                                      05170000
              IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000             05180000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05190000
                  WRITE B13F203A-REC    FROM WS-BP13F203-REC-A          05200000
                  ADD 1                 TO WS-B13F203A-WRT              05210000
              ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000        05220000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05230000
                  WRITE B13F203B-REC    FROM WS-BP13F203-REC-A          05240000
                  ADD 1                 TO WS-B13F203B-WRT              05250000
              ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000        05260000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05270000
                  WRITE B13F203C-REC    FROM WS-BP13F203-REC-A          05280000
                  ADD 1                 TO WS-B13F203C-WRT              05290000
              ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000        05300000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05310000
                  WRITE B13F203D-REC    FROM WS-BP13F203-REC-A          05320000
                  ADD 1                 TO WS-B13F203D-WRT              05330000
              ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000        05340000
                  MOVE WS-NUM-SMS       TO WS-NUM-SMS-A                 05350000
                  WRITE B13F203E-REC    FROM WS-BP13F203-REC-A          05360000
                  ADD 1                 TO WS-B13F203E-WRT              05370000
              END-IF                                                    05380000
           ELSE                                                         05390000
              IF WS-NUM-SMS >     0 AND WS-NUM-SMS <=  2000             05400000
                  WRITE B13F203A-REC    FROM WS-BP13F203-REC            05410000
                  ADD 1                 TO WS-B13F203A-WRT              05420000
              ELSE IF WS-NUM-SMS >  2000 AND WS-NUM-SMS <=  4000        05430000
                  WRITE B13F203B-REC    FROM WS-BP13F203-REC            05440000
                  ADD 1                 TO WS-B13F203B-WRT              05450000
              ELSE IF WS-NUM-SMS >  4000 AND WS-NUM-SMS <=  6000        05460000
                  WRITE B13F203C-REC    FROM WS-BP13F203-REC            05470000
                  ADD 1                 TO WS-B13F203C-WRT              05480000
              ELSE IF WS-NUM-SMS >  6000 AND WS-NUM-SMS <=  8000        05490000
                  WRITE B13F203D-REC    FROM WS-BP13F203-REC            05500000
                  ADD 1                 TO WS-B13F203D-WRT              05510000
              ELSE IF WS-NUM-SMS >  8000 AND WS-NUM-SMS <= 10000        05520000
                  WRITE B13F203E-REC    FROM WS-BP13F203-REC            05530000
                  ADD 1                 TO WS-B13F203E-WRT              05540000
              END-IF                                                    05550000
           END-IF.                                                      05560000
                                                                        05570000
           ADD 1                     TO WS-NUM-SMS.                     05580000
                                                                        05590000
       6710-EXIT.                                                       05600000
           EXIT.                                                        05610000
                                                                        05620000
      ***************************************************************   05630000
       9999-WRAP-UP.                                                    05640000
      ***************************************************************   05650000
                                                                        05660000
           DISPLAY SPACES.                                              05670000
           DISPLAY '********** CONTROL TOTALS *************'.           05680000
           DISPLAY ' PROGRAM ID                 : BP13CFA4'.            05690000
           DISPLAY '----------------------------------------'.          05700000
           DISPLAY 'CURRENT DATE :                            : '       05710000
                                        WS-DTE-CURRENT.                 05720000
           DISPLAY 'TOTAL BP13F203 RECS READ                  : '       05730000
                                        WS-CTR-BP13F203-READ.           05740000
           DISPLAY 'TOTAL CASES B13F203A WRITTEN              : '       05750000
                                        WS-B13F203A-WRT.                05760000
           DISPLAY 'TOTAL CASES B13F203B WRITTEN              : '       05770000
                                        WS-B13F203B-WRT.                05780000
           DISPLAY 'TOTAL CASES B13F203C WRITTEN              : '       05790000
                                        WS-B13F203C-WRT.                05800000
           DISPLAY 'TOTAL CASES B13F203D WRITTEN              : '       05810000
                                        WS-B13F203D-WRT.                05820000
           DISPLAY 'TOTAL CASES B13F203E WRITTEN              : '       05830000
                                        WS-B13F203E-WRT.                05840000
           DISPLAY 'Note : The first and last record written are dummy  05850000
      -            'records'.                                           05860000
           DISPLAY SPACES.                                              05870000
                                                                        05880000
           IF WS-NUM-SMS = 0                                            05890000
               MOVE 01                              TO RETURN-CODE.     05900000
                                                                        05910000
           CLOSE B13F203A                                               05920000
                 B13F203B                                               05930000
                 B13F203C                                               05940000
                 B13F203D                                               05950000
                 B13F203E                                               05960000
                 SY02F001                                               05970000
                 BP13F203.                                              05980000
                                                                        05990000
                                                                        06000000
           STOP RUN.                                                    06010000
                                                                        06020000
       9999-EXIT.                                                       06030000
            EXIT.                                                       06040000
                                                                        06050000
