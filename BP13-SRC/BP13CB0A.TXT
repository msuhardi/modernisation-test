      **************************                                        00010004
       IDENTIFICATION DIVISION.                                         00020004
      **************************                                        00030004
       PROGRAM-ID.    BP13CB0A.                                         00040004
      *AUTHOR.        MARGE LAM KO.                                     00050004
      *DATE-WRITTEN.  14 MAY 2015.                                      00060004
                                                                        00070004
      * =========================================================== *   00080004
      * SYSTEM OF COMMITMENT (BP13)                                 *   00090004
      * =========================================================== *   00100004
      *   OBJECTIVE   : THIS PROGRAM VALIDATES TRANSACTIONS PASSED  *   00110004
      *                 FROM PAYMENT SYSTEM TO PROCESS SERS GRANT.  *   00120004
      *                                                             *   00130004
      *   INPUT FILES :                                             *   00140004
      *   1.  AG07F630 -- VOUCHER TRANSACTION FILE                  *   00150004
      *   2.  P13FD10A -- SORTED SOC VOUCHER OIC FILE               *   00160004
      *   3.  BP13KD10 -- SOC SRG VOUCHER OIC FILE                  *   00170004
      *   4.  SY08K010 -- TO GET STAFFID FOR IN-TRAY                *   00180004
      *   3.  BP17K001 -- TO GET SCHACCT FOR IN-TRAY                *   00190004
      *                                                             *   00200004
      *   OUTPUT FILES:                                             *   00210004
      *   1.  BP13F125 -- EDITED FIRST TRANSACTION FILE             *   00220004
      *   2.  P13FD10B -- EDITED SOC SRG VOUCHER OIC FILE           *   00230004
      *   3.  BP13LB0A -- CONTROL LISTING                           *   00240004
      *                                                             *   00250004
      * CHQ REQ     DATE     BY  DESCRIPTIONS                       *   00260004
      * -------- ---------- ---- ---------------------------------- *   00270004
      * BP135762 14/05/2015 MRN1 NEW PROGRAM SIMILAR TO BP13CB04    *   00280004
      * BP135922 01/10/2015 MRN1 IF DTE-PAYMENT NOT '0001-01-01',   *   00290004
      *                          DO NOT PROCESS                     *   00300004
      * BP135978 06/10/2015 MRN1 INSERT TO IN-TRAY AFTER PROCESSING *   00310004
      * BP136028 25/11/2015 MRN1 CATER FOR RELOCATION GRANT (REG)   *   00320004
      * BP136147 01/12/2015 MRN1 CATER FOR AHG/SHG (ASG)            *   00330004
      * BP136148 03/05/2016 MRN1 NEW TABLE FOR UPD LOG                  00340004
      * BP136285 07/06/2016 MRN1 WHEN ASG, MOVE BOTH AHG/SHG IN F125*   00350004
      *                          USING VR DTLS INSTEAD OF PAYEE DTLS*   00360004
      * BP13XXXX 19/09/2016 MRN1 CATER FOR NEW GL ACCTS FOR 2F      *   00370004
      *                          AND WHEN ASG BUT ONLY AHG EXISTS   *   00380004
      * BP136884 26/01/2018 MRN1 FIX LOGIC ON DISPLAYING ERROR REPORT   00390004
      * BP136884 05/02/2021 PP11 CATER TO UPDATE THE PAYMENT        *   00391007
      *                          RELEASE DATE ON BP13K800 FILE      *   00392007
      * =========================================================== *   00400004
                                                                        00410004
       ENVIRONMENT DIVISION.                                            00420004
                                                                        00430004
       CONFIGURATION SECTION.                                           00440004
                                                                        00450004
       SOURCE-COMPUTER. IBM-3090.                                       00460004
       OBJECT-COMPUTER. IBM-3090.                                       00470004
                                                                        00480004
       INPUT-OUTPUT SECTION.                                            00490004
                                                                        00500004
       FILE-CONTROL.                                                    00510004
                                                                        00520004
           SELECT BP13KD10 ASSIGN TO BP13KD10                           00530004
                  ACCESS MODE     IS DYNAMIC                            00540004
                  ORGANIZATION    IS INDEXED                            00550004
                  RECORD KEY      IS KD10-KEY-FLD                       00560004
                  FILE STATUS     IS BP13KD10-STATUS.                   00570004
                                                                        00580004
           SELECT SY08K010 ASSIGN TO SY08K010                           00590004
                  ORGANIZATION    IS INDEXED                            00600004
                  ACCESS MODE     IS RANDOM                             00610004
                  RECORD KEY      IS K010-NUM-USERID                    00620004
                  ALTERNATE KEY   IS K010-NUM-LOTUS-NCKNM               00630004
                  FILE STATUS     IS WS-K010-STATUS.                    00640004
                                                                        00650004
           SELECT BP17K001 ASSIGN TO BP17K001                           00660004
                  ACCESS MODE     IS RANDOM                             00670004
                  ORGANIZATION    IS INDEXED                            00680004
                  RECORD KEY      IS K000-NUM-REGNO                     00690004
                  FILE STATUS     IS WS-K001-STATUS.                    00700004
                                                                        00710004
           SELECT BP13K800 ASSIGN TO BP13K800                           00711005
                  ACCESS MODE     IS DYNAMIC                            00712005
                  ORGANIZATION    IS INDEXED                            00713005
                  RECORD KEY      IS K800-NUM-REGN                      00714005
                  FILE STATUS     IS BP13K800-STATUS.                   00715005
                                                                        00716005
           SELECT AG07F630   ASSIGN       TO AG07F630.                  00720004
                                                                        00730004
           SELECT P13FD10A   ASSIGN       TO P13FD10A.                  00740004
                                                                        00750004
           SELECT P13FD10B   ASSIGN       TO P13FD10B.                  00760004
                                                                        00770004
           SELECT BP13F125   ASSIGN       TO BP13F125.                  00780004
                                                                        00790004
           SELECT BP13LB0A   ASSIGN       TO BP13LB0A.                  00800004
                                                                        00810004
                                                                        00820004
       DATA DIVISION.                                                   00830004
                                                                        00840004
       FILE SECTION.                                                    00850004
                                                                        00860004
       FD   BP13KD10                                                    00870004
            RECORD CONTAINS  1400 CHARACTERS.                           00880004
       COPY BP13KD10.                                                   00890004
                                                                        00900004
       FD   AG07F630                                                    00910004
            BLOCK CONTAINS     0 RECORDS                                00920004
            RECORD CONTAINS  130 CHARACTERS                             00930004
            LABEL RECORD IS STANDARD                                    00940004
            RECORDING MODE IS F.                                        00950004
       COPY AG07F630.                                                   00960004
                                                                        00970004
       FD   P13FD10A                                                    00980004
            BLOCK CONTAINS     0 RECORDS                                00990004
            RECORD CONTAINS  1400 CHARACTERS                            01000004
            LABEL RECORD IS STANDARD                                    01010004
            RECORDING MODE IS F.                                        01020004
       COPY BP13FD10.                                                   01030004
                                                                        01040004
       FD  SY08K010                                                     01050004
           RECORD CONTAINS 100 CHARACTERS.                              01060004
       COPY SY08K010.                                                   01070004
                                                                        01080004
       FD   BP17K001                                                    01090004
            RECORD CONTAINS 200 CHARACTERS.                             01100004
       COPY BP17K000.                                                   01110004
                                                                        01120004
       FD   BP13K800                                                    01121005
            RECORD CONTAINS 2000 CHARACTERS.                            01122005
       COPY BP13K800.                                                   01123005
                                                                        01124005
       FD   P13FD10B                                                    01130004
            BLOCK CONTAINS     0 RECORDS                                01140004
            RECORD CONTAINS  1400 CHARACTERS                            01150004
            LABEL RECORD IS STANDARD                                    01160004
            RECORDING MODE IS F.                                        01170004
       01   WS-BP13FD10-REC       PIC X(1400).                          01180004
                                                                        01190004
       FD   BP13F125                                                    01200004
            BLOCK CONTAINS     0 RECORDS                                01210004
            RECORD CONTAINS  150 CHARACTERS                             01220004
            LABEL RECORD IS STANDARD                                    01230004
            RECORDING MODE IS F.                                        01240004
       COPY BP13F125.                                                   01250004
                                                                        01260004
       FD   BP13LB0A                                                    01270004
            RECORD CONTAINS   132 CHARACTERS                            01280004
            LABEL RECORDS ARE OMITTED                                   01290004
            RECORDING MODE IS F.                                        01300004
       01   PRINT-REC             PIC X(132).                           01310004
                                                                        01320004
                                                                        01330004
      *************************                                         01340004
       WORKING-STORAGE SECTION.                                         01350004
      *************************                                         01360004
                                                                        01370004
       01  WS-AMT-RECEIPT         PIC S9(7)V99 VALUE ZEROES.            01380004
       01  WS-NRIC                PIC X(09) VALUE SPACES.               01390004
       01  WS-NUM-GRANT           PIC X(03) VALUE SPACES.               01400004
       01  WS-CTR                 PIC 9(02) VALUE ZEROES.               01410004
       01  WS-NUM-CPF-PAYEE       PIC X(09) VALUE SPACES.               01420004
       01  CNT-LINE-ON-PAGE       PIC 9(02) VALUE 66.                   01430004
       01  CNT-F125-WRITE         PIC 9(05) VALUE ZEROES.               01440004
       01  CNT-F630-READ          PIC 9(05) VALUE ZEROES.               01450004
       01  CNT-FD10-WRITE         PIC 9(05) VALUE ZEROES.               01460004
       01  CNT-KD10-READ          PIC 9(05) VALUE ZEROES.               01470004
       01  CNT-PRT-CASES          PIC 9(05) VALUE ZEROES.               01480004
       01  CNT-FD10-READ          PIC 9(05) VALUE ZEROES.               01490004
       01  WS-MATCH-REC           PIC 9(05) VALUE ZEROES.               01500004
       01  WS-ASMNT-UPDATE        PIC 9(05) VALUE ZEROES.               01510004
       01  WS-GRNT-UPD-LOG        PIC 9(05) VALUE ZEROES.               01520004
       01  CNT-PAGE               PIC 9(03) VALUE ZEROES.               01530004
       01  WS-F630-EOF            PIC X     VALUE SPACE.                01540004
       01  WS-FD10-EOF            PIC X     VALUE SPACE.                01550004
       01  BP13KD10-STATUS        PIC 9(02) VALUE ZEROES.               01560004
       01  WS-K010-STATUS         PIC 9(02) VALUE ZEROES.               01570004
       01  BP13K800-STATUS        PIC 9(02) VALUE ZEROES.               01571005
       01  WS-KD10-REGN-FND       PIC X     VALUE SPACE.                01580004
       01  WS-VOUCHER-NOTFND      PIC X     VALUE SPACE.                01590004
       01  WS-PROCESSED           PIC X     VALUE SPACE.                01600004
       01  WS-GRANT-ASMNT-FND     PIC X     VALUE SPACE.                01610004
       01  CNT-K800-READ          PIC 9(05) VALUE ZEROES.               01611005
       01  CNT-K800-UPDATE        PIC 9(05) VALUE ZEROES.               01612005
       01  WS-DATE                PIC X(08) VALUE SPACES.               01620004
       01  WS-TME-SYSTEM          PIC X(08).                            01630004
       01  WS-SYSTEM-DATE.                                              01640004
           05  WS-SYS-DATE        PIC 9(08).                            01650004
           05  FILLER             PIC X(13) VALUE SPACES.               01660004
       01  WS-DTE-DUE             PIC 9(8).                             01670004
       01  WS-INTEGER             PIC 9(7).                             01680004
       01  WS-INBOX-WRITE         PIC 9(05) VALUE ZEROES.               01690004
       01  NO-MORE-TX             PIC X(01) VALUE 'N'.                  01700004
       01  WS-AHG-DB2             PIC X(01) VALUE 'N'.                  01710004
       01  WS-SHG-DB2             PIC X(01) VALUE 'N'.                  01720004
       01  WS-K001-STATUS         PIC 9(02) VALUE ZEROES.               01730004
       01  WS-DEBIT-CNT           PIC 9(02) VALUE ZEROES.               01740004
       01  WS-CREDIT-CNT          PIC 9(02) VALUE ZEROES.               01750004
       01  WS-SQLCODE             PIC ---9.                             01760004
       01  WS-RETURN-CODE         PIC 9(02) VALUE ZEROES.               01770004
       01  WS-DTE-CCYYMMDD.                                             01780004
           05 WS-DTE-CCYY                   PIC X(04) VALUE SPACES.     01790004
           05 WS-DTE-MM                     PIC X(02) VALUE SPACES.     01800004
           05 WS-DTE-DD                     PIC X(02) VALUE SPACES.     01810004
       01  WS-TIME-HHMMSS.                                              01820004
           05 WS-TIME-HH                    PIC X(02) VALUE SPACES.     01830004
           05 WS-TIME-MM                    PIC X(02) VALUE SPACES.     01840004
           05 WS-TIME-SS                    PIC X(02) VALUE SPACES.     01850004
           05 WS-TIME-MS                    PIC X(02) VALUE SPACES.     01860004
                                                                        01870004
       01  WS-SCHEDULE-NO.                                              01880004
           05  WS-SCHEDULE-NUM    PIC X(08).                            01890004
           05  WS-DOC-NO          PIC X(06).                            01900004
                                                                        01910004
       01  WS-LOG-VARIABLE.                                             01920004
           05  WS-BEFORE-IMAGE        PIC X(600).                       01930004
           05  WS-BEFORE-IMAGE-AHG    PIC X(600).                       01940004
           05  WS-BEFORE-IMAGE-SHG    PIC X(600).                       01950004
           05  WS-AFTER-IMAGE         PIC X(600).                       01960004
           05  WS-SOURCE              PIC X(30).                        01970004
           05  WS-RGSTRN              PIC X(8).                         01980004
           05  WS-ACTION              PIC X(1).                         01990004
           05  WS-GRNT-TYPE           PIC X(6).                         02000004
           05  WS-TIMESTAMP-LOG       PIC X(26) VALUE SPACES.           02010004
                                                                        02020004
       01  WS-SQL-STATUS.                                               02030004
           05 WS-SQL-OK                PIC S9(03) VALUE +000.           02040004
           05 WS-SQL-NFND              PIC S9(03) VALUE +100.           02050004
           05 WS-SQL-DUPREC            PIC S9(03) VALUE -803.           02060004
                                                                        02070004
       01  WS-TXT-TARGET-URL.                                           02080004
      *TEST05 FILLER                  PIC X(111) VALUE                  02090004
      *TEST'http://portald2.hdb.gov.sg/wps/myportal/be10/home/redevelopm02100004
      *TEST'ent/sers/sgrantvr/paymentSchGrant?HDBHA_sersSchAcc='.       02110004
           05 FILLER                  PIC X(109) VALUE                  02120004
           'http://portal.hdb.gov.sg/wps/myportal/be10/home/redevelopmen02130004
      -    't/sers/sgrantvr/paymentSchGrant?HDBHA_sersSchAcc='.         02140004
           05 WS-SCHACCT        PIC X(9).                               02150004
           05 FILLER            PIC X(12) VALUE '&HDBHA_regn='.         02160004
           05 WS-REGNO          PIC X(8).                               02170004
           05 FILLER            PIC X(20) VALUE '&HDBHA_grantType=SRG'. 02180004
           05 FILLER            PIC X(11) VALUE '&HDBHA_OIC='.          02190004
           05 WS-STAFFID        PIC X(6).                               02200004
           05 FILLER           PIC X(22) VALUE '&HDBHA_propInfoClear=Y'.02210004
                                                                        02220004
       01  LB0A-PR-HEAD-01.                                             02230004
           05  FILLER             PIC X(08) VALUE 'BP13LB0A'.           02240004
           05  FILLER             PIC X(05) VALUE SPACES.               02250004
           05  FILLER             PIC X(08) VALUE 'HDBCAT 3'.           02260004
           05  FILLER             PIC X(24) VALUE SPACES.               02270004
           05  FILLER             PIC X(39) VALUE                       02280004
               'S Y S T E M   O F   C O M M I T M E N T'.               02290004
           05  FILLER             PIC X(17) VALUE SPACES.               02300004
           05  FILLER             PIC X(06) VALUE 'DATE: '.             02310004
           05  LB0A-DATE          PIC X(10).                            02320004
           05  FILLER             PIC X(03) VALUE SPACES.               02330004
           05  FILLER             PIC X(06) VALUE 'PAGE :'.             02340004
           05  LB0A-PAGE          PIC ZZ9 .                             02350004
                                                                        02360004
       01  LB0A-PR-HEAD-02.                                             02370004
           05  FILLER             PIC X(40) VALUE SPACES.               02380004
           05  FILLER             PIC X(47) VALUE                       02390004
               '  LIST OF TRANSACTIONS PASSED FROM VOUCHER FILE'.       02400004
           05  FILLER             PIC X(33) VALUE SPACES.               02410004
                                                                        02420004
       01  LB0A-PR-HEAD-03.                                             02430004
           05  FILLER             PIC X(24)                             02440004
                  VALUE '    S/NO  VOUCHER NO'.                         02450004
           05  FILLER             PIC X(43)                             02460004
                  VALUE 'REGN NO        AMOUNT       RECEIPT NO'.       02470004
           05  FILLER             PIC X(42)                             02480004
                  VALUE 'PAYMT RELEASE DTE     PAYMT TYPE'.             02490004
           05  FILLER             PIC X(06)                             02500004
                  VALUE 'REMARK'.                                       02510004
           05  FILLER             PIC X(17) VALUE SPACES.               02520004
                                                                        02530004
       01  LB0A-PR-DETAILS.                                             02540004
           05  FILLER             PIC X(01) VALUE SPACES.               02550004
           05  LB0A-SNO           PIC ZZZZZ9 .                          02560004
           05  FILLER             PIC X(03) VALUE SPACES.               02570004
           05  LB0A-VOUCHER-NO    PIC X(11).                            02580004
           05  FILLER             PIC X(03) VALUE SPACES.               02590004
           05  LB0A-REG-NO        PIC X(08).                            02600004
           05  FILLER             PIC X(03) VALUE SPACES.               02610004
           05  LB0A-AMT           PIC $$$$$$$9.99DB.                    02620004
           05  FILLER             PIC X(02) VALUE SPACES.               02630004
           05  LB0A-NUM-RECEIPT   PIC X(14).                            02640004
           05  FILLER             PIC X(08) VALUE SPACES.               02650004
           05  LB0A-DTE-POST      PIC X(08).                            02660004
           05  FILLER             PIC X(09) VALUE SPACES.               02670004
           05  LB0A-PAYMENT-TYPE  PIC X(09).                            02680004
           05  FILLER             PIC X(08) VALUE SPACES.               02690004
           05  LB0A-REMARK        PIC X(20).                            02700004
                                                                        02710004
       01  LB0A-CONTROL-LINE.                                           02720004
           05  FILLER             PIC X(20) VALUE  SPACES.              02730004
           05  CNTL-ITEM          PIC X(30) VALUE  SPACES.              02740004
           05  CNTL-CNT           PIC ZZZZ9 .                           02750004
           05  FILLER             PIC X(58) VALUE  SPACES.              02760004
                                                                        02770004
      *------------------------------------------------------------*    02780004
      *  BE08C001 PARAMETERS                                       *    02790004
      *------------------------------------------------------------*    02800004
       COPY BE08W001.                                                   02810004
                                                                        02820004
      *------------------------------------------------------------*    02830004
      *  AV02C001 PARAMETERS                                       *    02840004
      *------------------------------------------------------------*    02850004
       COPY AV02COMM.                                                   02860004
                                                                        02870004
      *--------------------------------------------------------------*  02880004
      *                          SQLCA                               *  02890004
      *--------------------------------------------------------------*  02900004
           EXEC SQL INCLUDE SQLCA          END-EXEC.                    02910004
           EXEC SQL INCLUDE P13VGASM       END-EXEC.                    02920004
           EXEC SQL INCLUDE P13VGUPD       END-EXEC.                    02930004
                                                                        02940004
      ********************                                              02950004
       PROCEDURE DIVISION.                                              02960004
      ********************                                              02970004
                                                                        02980004
      *----------*                                                      02990004
       0000-MAIN.                                                       03000004
      *----------*                                                      03010004
                                                                        03020004
           PERFORM 1000-OPEN-FILES   THRU 1000-EXIT.                    03030004
           PERFORM 2000-READ-F630    THRU 2000-EXIT.                    03040004
           PERFORM 2100-READ-FD10    THRU 2100-EXIT.                    03050004
           PERFORM 3000-PROCESS-REC  THRU 3000-EXIT                     03060004
                   UNTIL WS-F630-EOF = 'Y'.                             03070004
           PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT.                    03080004
                                                                        03090004
       0000-EXIT.                                                       03100004
           EXIT.                                                        03110004
                                                                        03120004
      *----------------*                                                03130004
       1000-OPEN-FILES.                                                 03140004
      *----------------*                                                03150004
                                                                        03160004
           OPEN INPUT  AG07F630                                         03170004
                       P13FD10A                                         03180004
                       BP17K001                                         03190004
                       SY08K010                                         03200004
                       BP13KD10                                         03210004
                  I-O  BP13K800                                         03211005
                OUTPUT BP13F125                                         03220004
                       P13FD10B                                         03230004
                       BP13LB0A.                                        03240004
                                                                        03250004
           IF BP13KD10-STATUS NOT = 0 AND 97                            03260004
              DISPLAY 'ERROR OPENING - BP13KD10 : ' BP13KD10-STATUS     03270004
              MOVE BP13KD10-STATUS TO RETURN-CODE                       03280004
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                   03290004
           END-IF.                                                      03300004
                                                                        03310004
           IF BP13K800-STATUS NOT = 0 AND 97                            03311005
              DISPLAY 'ERROR OPENING - BP13K800 : ' BP13K800-STATUS     03312005
              MOVE BP13K800-STATUS TO RETURN-CODE                       03313005
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                   03314005
           END-IF.                                                      03315005
                                                                        03316005
           IF WS-K001-STATUS  NOT = 00 AND 97                           03320004
              DISPLAY 'ERROR OPENING - BP17K000 : ' WS-K001-STATUS      03330004
              PERFORM  9000-CLOSE-FILES   THRU 9000-EXIT                03340004
           END-IF.                                                      03350004
                                                                        03360004
           MOVE FUNCTION CURRENT-DATE  TO WS-SYSTEM-DATE.               03370004
                                                                        03380004
           COMPUTE WS-INTEGER =                                         03390004
                   FUNCTION INTEGER-OF-DATE(WS-SYS-DATE).               03400004
           ADD 14 TO WS-INTEGER.                                        03410004
           COMPUTE WS-DTE-DUE =                                         03420004
                   FUNCTION DATE-OF-INTEGER(WS-INTEGER).                03430004
                                                                        03440004
           MOVE WS-DTE-DUE                TO WS-IN-DATE.                03450004
           MOVE 'CD'                      TO WS-IN-OPTION.              03460004
           CALL 'AV02C001' USING LINK-REC.                              03470004
                                                                        03480004
           IF WS-RETURN NOT = '000'                                     03490004
              DISPLAY ' INVALID DATE: ' WS-IN-DATE                      03500004
              PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT                  03510004
           END-IF.                                                      03520004
                                                                        03530004
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                       03540004
           STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)        03550004
              DELIMITED BY SIZE INTO LB0A-DATE.                         03560004
                                                                        03570004
           ACCEPT WS-DTE-CCYYMMDD   FROM   DATE YYYYMMDD.               03580004
           ACCEPT WS-TIME-HHMMSS    FROM   TIME.                        03590004
                                                                        03600004
           STRING WS-DTE-CCYYMMDD(1:4) '-'                              03610004
                  WS-DTE-CCYYMMDD(5:2) '-'                              03620004
                  WS-DTE-CCYYMMDD(7:2)                                  03630004
                  DELIMITED BY SIZE INTO DTE-UPDATE OF DCLGRANT-ASMNT.  03640004
                                                                        03650004
           STRING WS-TIME-HHMMSS(1:2) '.'                               03660004
                  WS-TIME-HHMMSS(3:2) '.'                               03670004
                  WS-TIME-HHMMSS(5:2)                                   03680004
                  DELIMITED BY SIZE INTO TME-UPDATE OF DCLGRANT-ASMNT.  03690004
       1000-EXIT.                                                       03700004
           EXIT.                                                        03710004
                                                                        03720004
      *---------------*                                                 03730004
       2000-READ-F630.                                                  03740004
      *---------------*                                                 03750004
                                                                        03760004
           READ AG07F630 AT END                                         03770004
                MOVE HIGH-VALUES TO AG07F630-REC                        03780004
                MOVE 'Y' TO WS-F630-EOF                                 03790004
                GO TO 2000-EXIT.                                        03800004
           ADD 1 TO CNT-F630-READ.                                      03810004
                                                                        03820004
       2000-EXIT.                                                       03830004
           EXIT.                                                        03840004
                                                                        03850004
      *---------------*                                                 03860004
       2100-READ-FD10.                                                  03870004
      *---------------*                                                 03880004
                                                                        03890004
           READ P13FD10A AT END                                         03900004
                MOVE HIGH-VALUES TO BP13FD10-REC                        03910004
                MOVE 'Y' TO WS-FD10-EOF                                 03920004
                GO TO 2100-EXIT.                                        03930004
           ADD 1 TO CNT-FD10-READ.                                      03940004
                                                                        03950004
       2100-EXIT.                                                       03960004
           EXIT.                                                        03970004
                                                                        03980004
      *-----------------*                                               03990004
       3000-PROCESS-REC.                                                04000004
      *-----------------*                                               04010004
                                                                        04020004
           MOVE SPACES                  TO WS-VOUCHER-NOTFND.           04030004
           IF F630-NUM-VR = FD10-NUM-VR                                 04040004
              ADD  1                    TO WS-MATCH-REC                 04050004
              MOVE 'N'                  TO WS-AHG-DB2,  WS-SHG-DB2      04060004
              PERFORM 3100-PROCESS-REC  THRU 3100-EXIT                  04070004
              MOVE SPACES               TO LB0A-PR-DETAILS              04080004
                                           LB0A-REMARK                  04090004
              PERFORM 4000-PRINT-REPORT THRU 4000-EXIT                  04100004
              PERFORM 2000-READ-F630    THRU 2000-EXIT                  04110004
              PERFORM 2100-READ-FD10    THRU 2100-EXIT                  04120004
           ELSE                                                         04130004
              IF F630-NUM-VR > FD10-NUM-VR                              04140004
                 PERFORM 2100-READ-FD10    THRU 2100-EXIT               04150004
              ELSE                                                      04160004
                 MOVE SPACES   TO LB0A-PR-DETAILS                       04170004
                                  LB0A-REMARK                           04180004
                                  BP13KD10-REC                          04190004
                 INITIALIZE       BP13KD10-REC                          04200004
                 MOVE 'VOUCHER NO NOT FOUND'    TO LB0A-REMARK          04210004
                 MOVE 'Y'      TO WS-VOUCHER-NOTFND                     04220004
                 PERFORM 4000-PRINT-REPORT THRU 4000-EXIT               04230004
                 PERFORM 2000-READ-F630    THRU 2000-EXIT               04240004
              END-IF                                                    04250004
           END-IF.                                                      04260004
                                                                        04270004
       3000-EXIT.                                                       04280004
           EXIT.                                                        04290004
                                                                        04300004
      *-----------------*                                               04310004
       3100-PROCESS-REC.                                                04320004
      *-----------------*                                               04330004
                                                                        04340004
           MOVE 'N'              TO WS-PROCESSED                        04350004
                                    WS-GRANT-ASMNT-FND.                 04360004
                                                                        04370004
           IF FD10-NUM-TRANS = 'ASG'                                    04380004
              MOVE 'AHG' TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT            04390004
              PERFORM 4200-CHECK-DTE-PYMNT THRU 4200-EXIT               04400004
              MOVE 'SHG' TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT            04410004
              PERFORM 4200-CHECK-DTE-PYMNT THRU 4200-EXIT               04420004
           ELSE                                                         04430004
              MOVE FD10-NUM-TRANS TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT   04440004
              PERFORM 4200-CHECK-DTE-PYMNT THRU 4200-EXIT               04450004
           END-IF.                                                      04460004
                                                                        04470004
           IF WS-PROCESSED = 'N'                                        04480004
              MOVE SPACES                TO KD10-KEY-FLD                04490004
              MOVE FD10-NUM-TRANS        TO KD10-NUM-TRANS              04500004
              MOVE FD10-NUM-REGN         TO KD10-NUM-REGN               04510004
              PERFORM 3200-READ-BP13KD10 THRU 3200-EXIT                 04520004
              MOVE FD10-NUM-OIC          TO KD10-NUM-OIC                04530004
              MOVE SPACES                TO WS-BP13FD10-REC             04540004
              MOVE BP13KD10-REC          TO WS-BP13FD10-REC             04550004
              WRITE WS-BP13FD10-REC                                     04560004
              ADD 1                      TO CNT-FD10-WRITE              04570004
              IF FD10-NUM-TRANS = 'ASG'                                 04580004
                 PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 16   04590004
                  IF KD10-NUM-VOUCH-CR-DR(WS-CTR) = 'D'                 04600004
                     IF KD10-NUM-VOUCH-GL(WS-CTR) = '0407600403488' OR  04610004
                                                    '8407600408785' OR  04620004
                                                    '0407000573488'     04630004
                        MOVE 'AHG'                  TO WS-NUM-GRANT     04640004
                     END-IF                                             04650004
                     IF KD10-NUM-VOUCH-GL(WS-CTR) = '0407000403488' OR  04660004
                                                    '8407000408785' or  04670004
                                                    '0407800573488'     04680004
                        MOVE 'SHG'                  TO WS-NUM-GRANT     04690004
                     END-IF                                             04700004
                     MOVE KD10-NUM-VOUCH-NRIC(WS-CTR) TO WS-NRIC        04710004
                                                        WS-NUM-CPF-PAYEE04720004
                     MOVE KD10-AMT-VOUCH(WS-CTR)      TO WS-AMT-RECEIPT 04730004
                     PERFORM 3300-MOVE-DATA-BP13F125  THRU 3300-EXIT    04740004
                     MOVE SPACES TO WS-NRIC                             04750004
                  END-IF                                                04760004
                 END-PERFORM                                            04770004
              ELSE                                                      04780004
                 PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 4    04790004
                  IF KD10-NUM-CPF-PAYEE(WS-CTR) NOT = SPACES            04800004
                                               AND LOW-VALUES           04810004
                                               AND ZEROES               04820004
                    MOVE KD10-NUM-GRANT(WS-CTR)     TO WS-NUM-GRANT     04830004
                    MOVE KD10-NUM-CPF-PAYEE(WS-CTR) TO WS-NRIC          04840004
                                                       WS-NUM-CPF-PAYEE 04850004
                    MOVE ZEROES                     TO WS-AMT-RECEIPT   04860004
                    IF KD10-AMT-CPF-GRANT-PAYEE(WS-CTR) IS NUMERIC      04870004
                       MOVE KD10-AMT-CPF-GRANT-PAYEE(WS-CTR)            04880004
                                                    TO WS-AMT-RECEIPT   04890004
                    ELSE                                                04900004
                       MOVE ZEROES                  TO WS-AMT-RECEIPT   04910004
                    END-IF                                              04920004
                    PERFORM 3300-MOVE-DATA-BP13F125  THRU 3300-EXIT     04930004
                    MOVE SPACES TO WS-NRIC                              04940004
                  END-IF                                                04950004
                 END-PERFORM                                            04960004
              END-IF                                                    04970004
              IF FD10-NUM-TRANS = 'ASG'                                 04980004
                 IF WS-AHG-DB2 = 'Y'                                    04990004
                    MOVE 'AHG' TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT      05000004
                    MOVE WS-BEFORE-IMAGE-AHG TO WS-BEFORE-IMAGE         05010004
                    PERFORM 4400-UPDATE-GRANT-ASMNT THRU 4400-EXIT      05020004
                 END-IF                                                 05030004
                 IF WS-SHG-DB2 = 'Y'                                    05040004
                    MOVE 'SHG' TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT      05050004
                    MOVE WS-BEFORE-IMAGE-SHG TO WS-BEFORE-IMAGE         05060004
                    PERFORM 4400-UPDATE-GRANT-ASMNT THRU 4400-EXIT      05070004
                 END-IF                                                 05080004
              ELSE                                                      05090004
                 IF WS-GRANT-ASMNT-FND = 'Y'                            05100004
                    MOVE FD10-NUM-TRANS                                 05110004
                               TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT      05120004
                    PERFORM 4400-UPDATE-GRANT-ASMNT THRU 4400-EXIT      05130004
                 END-IF                                                 05140004
              END-IF                                                    05150004
              IF FD10-NUM-TRANS = 'SRG'                                 05160004
                 PERFORM 5500-MOVE-TO-INTRAY THRU 5500-EXIT             05170004
                 CALL 'BE08C001'    USING BE08W001-COMMAREA             05180004
                 IF W001-OUT-RTN-MSGCDE = ZEROES                        05190004
                    ADD 1 TO WS-INBOX-WRITE                             05200004
                 ELSE                                                   05210004
                    DISPLAY 'ERROR IN BE08C001 ' FD10-NUM-REGN ' '      05220004
                    DISPLAY W001-OUT-RTN-MSGNO '-' W001-OUT-RTN-DESC    05230004
                    MOVE 99 TO RETURN-CODE                              05240004
                 END-IF                                                 05250004
              END-IF                                                    05260004
           END-IF.                                                      05270004
                                                                        05280004
       3100-EXIT.                                                       05290004
           EXIT.                                                        05300004
                                                                        05310004
      *-------------------*                                             05320004
       3200-READ-BP13KD10.                                              05330004
      *-------------------*                                             05340004
                                                                        05350004
           READ BP13KD10.                                               05360004
           IF BP13KD10-STATUS = 0                                       05370004
              MOVE 'Y'    TO WS-KD10-REGN-FND                           05380004
           ELSE                                                         05390004
              IF BP13KD10-STATUS = 23                                   05400004
                 MOVE 'N' TO WS-KD10-REGN-FND                           05410004
                 DISPLAY 'REGNO NOT FOUND IN BP13KD10 : ' KD10-NUM-REGN 05420004
                 MOVE BP13KD10-STATUS     TO RETURN-CODE                05430004
              ELSE                                                      05440004
                 DISPLAY 'ERROR READING - BP13KD10 : ' BP13KD10-STATUS  05450004
                 MOVE BP13KD10-STATUS     TO RETURN-CODE                05460004
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                05470004
              END-IF                                                    05480004
           END-IF.                                                      05490004
                                                                        05500004
       3200-EXIT.                                                       05510004
           EXIT.                                                        05520004
                                                                        05530004
      *------------------------*                                        05540004
       3300-MOVE-DATA-BP13F125.                                         05550004
      *------------------------*                                        05560004
                                                                        05570004
           MOVE SPACES              TO BP13F125-CASHTRAN.               05580004
                                                                        05590004
           MOVE '60'                TO F125-CDE-TRANS-TYPE.             05600004
           MOVE WS-AMT-RECEIPT      TO F125-AMT-RECEIPT.                05610004
           MOVE FD10-NUM-REGN       TO F125-NUM-REGN.                   05620004
           MOVE WS-NUM-GRANT        TO F125-CDE-PAYMENT-TYPE.           05630004
           MOVE FD10-NUM-SCH-ACC    TO F125-NUM-SCH-ACCT.               05640004
           MOVE WS-NRIC             TO F125-NUM-NRIC.                   05650004
           MOVE SPACES              TO F125-NME-NAME.                   05660004
           MOVE WS-NUM-CPF-PAYEE    TO F125-CDE-CPF-APPL.               05670004
           MOVE F630-NUM-BATCH      TO WS-SCHEDULE-NUM.                 05680004
           MOVE F630-NUM-VR-SERIAL  TO WS-DOC-NO.                       05690004
           MOVE WS-SCHEDULE-NO      TO F125-NUM-RECPT-JRNO.             05700004
           MOVE F630-NUM-VR-DDD     TO F125-NUM-VR-DDD.                 05710004
           MOVE F630-NUM-VR-YY      TO F125-NUM-VR-YY.                  05720004
           MOVE F630-DTE-TRANS      TO F125-DTE-TRANS                   05730004
                                       F125-DTE-POST.                   05740004
           MOVE SPACES              TO F125-CDE-APPLT-CPF.              05750004
           MOVE ZERO                TO F125-COUNT-HISTORY.              05760004
                                                                        05770004
           PERFORM 3400-WRITE-BP13F125 THRU 3400-EXIT.                  05780004
                                                                        05790004
       3300-EXIT.                                                       05800004
           EXIT.                                                        05810004
                                                                        05820004
      *---------------------*                                           05830004
       3400-WRITE-BP13F125.                                             05840004
      *---------------------*                                           05850004
                                                                        05860004
           WRITE BP13F125-CASHTRAN.                                     05870004
           ADD 1       TO CNT-F125-WRITE.                               05880004
                                                                        05890004
       3400-EXIT.                                                       05900004
           EXIT.                                                        05910004
                                                                        05920004
      *------------------*                                              05930004
       4000-PRINT-REPORT.                                               05940004
      *------------------*                                              05950004
                                                                        05960004
           IF CNT-LINE-ON-PAGE > 46                                     05970004
              MOVE 1 TO CNT-LINE-ON-PAGE                                05980004
              PERFORM 4100-REPORT-HEADING THRU 4100-EXIT                05990004
           ELSE                                                         06000004
              ADD 1 TO CNT-LINE-ON-PAGE                                 06010004
           END-IF.                                                      06020004
                                                                        06030004
           ADD 1 TO CNT-PRT-CASES.                                      06040004
                                                                        06050004
           MOVE CNT-PRT-CASES         TO LB0A-SNO.                      06060004
                                                                        06070004
           IF WS-VOUCHER-NOTFND = 'Y'                                   06080004
              MOVE F630-NUM-REGN         TO LB0A-REG-NO                 06090004
              MOVE F630-NUM-VR           TO LB0A-VOUCHER-NO             06100004
              MOVE F630-AMT-TRANS        TO LB0A-AMT                    06110004
           ELSE                                                         06120004
              IF FD10-NUM-REGN NOT = SPACES AND LOW-VALUES AND ZEROES   06130004
                 MOVE FD10-NUM-REGN      TO LB0A-REG-NO                 06140004
              ELSE                                                      06150004
                 MOVE F630-NUM-REGN      TO LB0A-REG-NO                 06160004
              END-IF                                                    06170004
                                                                        06180004
              IF FD10-NUM-VR NOT = SPACES AND LOW-VALUES AND ZEROES     06190004
                 MOVE FD10-NUM-VR        TO LB0A-VOUCHER-NO             06200004
              ELSE                                                      06210004
                 MOVE F630-NUM-VR        TO LB0A-VOUCHER-NO             06220004
              END-IF                                                    06230004
              MOVE ZEROES                TO WS-AMT-RECEIPT              06240004
              PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 4       06250004
                 IF KD10-AMT-CPF-GRANT-PAYEE(WS-CTR) NOT NUMERIC        06260004
                    MOVE ZEROES     TO KD10-AMT-CPF-GRANT-PAYEE(WS-CTR) 06270004
                 END-IF                                                 06280004
              END-PERFORM                                               06290004
                                                                        06300004
              MOVE FD10-NUM-TRANS    TO LB0A-PAYMENT-TYPE               06310004
                                                                        06320004
              COMPUTE WS-AMT-RECEIPT = KD10-AMT-CPF-GRANT-PAYEE(1) +    06330004
                                       KD10-AMT-CPF-GRANT-PAYEE(2) +    06340004
                                       KD10-AMT-CPF-GRANT-PAYEE(3) +    06350004
                                       KD10-AMT-CPF-GRANT-PAYEE(4)      06360004
              MOVE WS-AMT-RECEIPT    TO LB0A-AMT                        06370004
           END-IF.                                                      06380004
                                                                        06390004
           MOVE F630-DTE-TRANS        TO LB0A-DTE-POST.                 06400004
           MOVE F630-NUM-BATCH        TO WS-SCHEDULE-NUM.               06410004
           MOVE F630-NUM-VR-SERIAL    TO WS-DOC-NO.                     06420004
           MOVE WS-SCHEDULE-NO        TO LB0A-NUM-RECEIPT.              06430004
           WRITE PRINT-REC          FROM LB0A-PR-DETAILS.               06440004
                                                                        06450004
       4000-EXIT.                                                       06460004
           EXIT.                                                        06470004
                                                                        06480004
      *--------------------*                                            06490004
       4100-REPORT-HEADING.                                             06500004
      *--------------------*                                            06510004
                                                                        06520004
            ADD 1           TO CNT-PAGE.                                06530004
            MOVE CNT-PAGE   TO LB0A-PAGE.                               06540004
            MOVE SPACES     TO PRINT-REC.                               06550004
            WRITE PRINT-REC AFTER PAGE.                                 06560004
            WRITE PRINT-REC FROM LB0A-PR-HEAD-01 AFTER 2.               06570004
            WRITE PRINT-REC FROM LB0A-PR-HEAD-02 AFTER 3.               06580004
            WRITE PRINT-REC FROM LB0A-PR-HEAD-03 AFTER 3.               06590004
            MOVE ALL '-'    TO PRINT-REC.                               06600004
            WRITE PRINT-REC.                                            06610004
            MOVE SPACES     TO PRINT-REC.                               06620004
            WRITE PRINT-REC AFTER 1.                                    06630004
                                                                        06640004
       4100-EXIT.                                                       06650004
           EXIT.                                                        06660004
                                                                        06670004
      *--------------------*                                            06680004
       4200-CHECK-DTE-PYMNT.                                            06690004
      *--------------------*                                            06700004
           MOVE FD10-NUM-REGN    TO NUM-RGSTRN OF DCLGRANT-ASMNT.       06710004
                                                                        06720004
           EXEC SQL                                                     06730004
              SELECT NUM_RGSTRN,                                        06740004
                     NUM_GRANT_TYPE,                                    06750004
                     NUM_ELGBL_GRANT,                                   06760004
                     NUM_GRANT_AMOUNT_ELGBL,                            06770004
                     NUM_GRANT_STATUS,                                  06780004
                     DTE_APRV,                                          06790004
                     DTE_CANCEL,                                        06800004
                     DTE_REJECT,                                        06810004
                     DTE_SUBMIT,                                        06820004
                     DTE_WTHDRW,                                        06830004
                     NUM_RJCTN_REASON,                                  06840004
                     NUM_WTDRWL_REASON,                                 06850004
                     TXT_CNCLTN_REASON,                                 06860004
                     DTE_GRANT_RQST,                                    06870004
                     NUM_GRANT_DOC_RCV,                                 06880004
                     DTE_ACK,                                           06890004
                     DTE_GRANT_FORM_ISSUE,                              06900004
                     DTE_GRANT_OPT_OUT_FORM_ISSUE,                      06910004
                     NUM_GRANT_OPT_OUT_REASON,                          06920004
                     DTE_GRANT_OPT_OUT_REASON,                          06930004
                     NUM_ALCTN_SCHEME,                                  06940004
                     NUM_HSHLD_CTZNSP,                                  06950004
                     NUM_WRKNG_CHILD_ASMNT,                             06960004
                     QTY_MONTH_WORK,                                    06970004
                     NUM_APPEAL_ATCHMT,                                 06980004
                     NUM_PARENT_ADRS_BLDNG,                             06990004
                     NUM_PARENT_ADRS_LEVEL,                             07000004
                     NUM_PARENT_ADRS_UNIT,                              07010004
                     TXT_PARENT_ADRS1,                                  07020004
                     TXT_PARENT_ADRS2,                                  07030004
                     NUM_PARENT_ADRS_POSTAL,                            07040004
                     DTE_PYMNT,                                         07050004
                     DTE_CPF_ACK_GRANT_RCV,                             07060004
                     NUM_GRANT_CREDIT,                                  07070004
                     TME_APNTMT,                                        07080004
                     DTE_APNTMT,                                        07090004
                     TME_CREATE_ASMNT,                                  07100004
                     NUM_UPDATE_USERID,                                 07110004
                     TME_UPDATE,                                        07120004
                     DTE_UPDATE,                                        07130004
                     NUM_SOURCE_SYSTEM,                                 07140004
                     NUM_ACNT,                                          07150004
                     NUM_SCHEME,                                        07160004
                     NUM_TNCY,                                          07170004
                     NUM_HALF_GRANT                                     07180004
              INTO  :DCLGRANT-ASMNT.NUM-RGSTRN,                         07190004
                    :DCLGRANT-ASMNT.NUM-GRANT-TYPE,                     07200004
                    :DCLGRANT-ASMNT.NUM-ELGBL-GRANT,                    07210004
                    :DCLGRANT-ASMNT.NUM-GRANT-AMOUNT-ELGBL,             07220004
                    :DCLGRANT-ASMNT.NUM-GRANT-STATUS,                   07230004
                    :DCLGRANT-ASMNT.DTE-APRV,                           07240004
                    :DCLGRANT-ASMNT.DTE-CANCEL,                         07250004
                    :DCLGRANT-ASMNT.DTE-REJECT,                         07260004
                    :DCLGRANT-ASMNT.DTE-SUBMIT,                         07270004
                    :DCLGRANT-ASMNT.DTE-WTHDRW,                         07280004
                    :DCLGRANT-ASMNT.NUM-RJCTN-REASON,                   07290004
                    :DCLGRANT-ASMNT.NUM-WTDRWL-REASON,                  07300004
                    :DCLGRANT-ASMNT.TXT-CNCLTN-REASON,                  07310004
                    :DCLGRANT-ASMNT.DTE-GRANT-RQST,                     07320004
                    :DCLGRANT-ASMNT.NUM-GRANT-DOC-RCV,                  07330004
                    :DCLGRANT-ASMNT.DTE-ACK,                            07340004
                    :DCLGRANT-ASMNT.DTE-GRANT-FORM-ISSUE,               07350004
                    :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-FORM-ISSUE,       07360004
                    :DCLGRANT-ASMNT.NUM-GRANT-OPT-OUT-REASON,           07370004
                    :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-REASON,           07380004
                    :DCLGRANT-ASMNT.NUM-ALCTN-SCHEME,                   07390004
                    :DCLGRANT-ASMNT.NUM-HSHLD-CTZNSP,                   07400004
                    :DCLGRANT-ASMNT.NUM-WRKNG-CHILD-ASMNT,              07410004
                    :DCLGRANT-ASMNT.QTY-MONTH-WORK,                     07420004
                    :DCLGRANT-ASMNT.NUM-APPEAL-ATCHMT,                  07430004
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-BLDNG,              07440004
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-LEVEL,              07450004
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-UNIT,               07460004
                    :DCLGRANT-ASMNT.TXT-PARENT-ADRS1,                   07470004
                    :DCLGRANT-ASMNT.TXT-PARENT-ADRS2,                   07480004
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-POSTAL,             07490004
                    :DCLGRANT-ASMNT.DTE-PYMNT,                          07500004
                    :DCLGRANT-ASMNT.DTE-CPF-ACK-GRANT-RCV,              07510004
                    :DCLGRANT-ASMNT.NUM-GRANT-CREDIT,                   07520004
                    :DCLGRANT-ASMNT.TME-APNTMT,                         07530004
                    :DCLGRANT-ASMNT.DTE-APNTMT,                         07540004
                    :DCLGRANT-ASMNT.TME-CREATE-ASMNT,                   07550004
                    :DCLGRANT-ASMNT.NUM-UPDATE-USERID,                  07560004
                    :DCLGRANT-ASMNT.TME-UPDATE,                         07570004
                    :DCLGRANT-ASMNT.DTE-UPDATE,                         07580004
                    :DCLGRANT-ASMNT.NUM-SOURCE-SYSTEM,                  07590004
                    :DCLGRANT-ASMNT.NUM-ACNT,                           07600004
                    :DCLGRANT-ASMNT.NUM-SCHEME,                         07610004
                    :DCLGRANT-ASMNT.NUM-TNCY,                           07620004
                    :DCLGRANT-ASMNT.NUM-HALF-GRANT                      07630004
              FROM                                                      07640004
                GRANT_ASMNT                                             07650004
              WHERE NUM_RGSTRN       = :DCLGRANT-ASMNT.NUM-RGSTRN       07660004
               AND  NUM_GRANT_TYPE   = :DCLGRANT-ASMNT.NUM-GRANT-TYPE   07670004
           END-EXEC.                                                    07680004
                                                                        07690004
           EVALUATE SQLCODE                                             07700004
           WHEN WS-SQL-OK                                               07710004
                IF DTE-PYMNT = '0001-01-01'                             07720004
                   MOVE 'N' TO WS-PROCESSED                             07730004
                ELSE                                                    07740004
                   MOVE 'Y' TO WS-PROCESSED                             07750004
                END-IF                                                  07760004
                MOVE 'Y' TO WS-GRANT-ASMNT-FND                          07770004
                IF FD10-NUM-TRANS = 'ASG'                               07780004
                   IF NUM-GRANT-TYPE OF DCLGRANT-ASMNT = 'AHG'          07790004
                      MOVE DCLGRANT-ASMNT TO WS-BEFORE-IMAGE-AHG        07800004
                      MOVE 'Y' TO WS-AHG-DB2                            07810004
                   END-IF                                               07820004
                   IF NUM-GRANT-TYPE OF DCLGRANT-ASMNT = 'SHG'          07830004
                      MOVE DCLGRANT-ASMNT TO WS-BEFORE-IMAGE-SHG        07840004
                      MOVE 'Y' TO WS-SHG-DB2                            07850004
                   END-IF                                               07860004
                ELSE                                                    07870004
                   MOVE DCLGRANT-ASMNT TO WS-BEFORE-IMAGE               07880004
                END-IF                                                  07890004
                PERFORM 4220-READ-BP13K800    THRU 4220-EXIT            07891005
           WHEN WS-SQL-NFND                                             07900004
                MOVE SQLCODE   TO WS-SQLCODE                            07910004
                DISPLAY 'CASE NOTFND IN GRANT_ASMNT'                    07920004
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      07930004
                DISPLAY 'REGNO : ' NUM-RGSTRN OF DCLGRANT-ASMNT         07940004
                DISPLAY 'GRANT TYPE: ' NUM-GRANT-TYPE OF DCLGRANT-ASMNT 07950004
                DISPLAY SPACES                                          07960004
                                                                        07970004
           WHEN OTHER                                                   07980004
                MOVE SQLCODE   TO WS-SQLCODE                            07990004
                DISPLAY 'ERROR READING GRANT_ASMNT'                     08000004
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      08010004
                DISPLAY SPACES                                          08020004
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              08030004
           END-EVALUATE.                                                08040004
                                                                        08050004
       4200-EXIT.                                                       08060004
           EXIT.                                                        08070004
                                                                        08080004
      *---------------------*                                           08081005
       4220-READ-BP13K800.                                              08082005
      *---------------------*                                           08083005
                                                                        08084005
           MOVE SPACES           TO BP13K800-MASTER.                    08085005
           MOVE FD10-NUM-REGN    TO K800-NUM-REGN.                      08086006
                                                                        08087005
           READ BP13K800.                                               08088005
           IF BP13K800-STATUS = 0                                       08089005
              ADD 1    TO CNT-K800-READ                                 08089105
              PERFORM 4250-REWRITE-BP13K800   THRU 4250-EXIT            08089205
           ELSE                                                         08089305
             IF BP13K800-STATUS = 23                                    08089405
                DISPLAY 'RECORD NOT FOUND BP13K800: ' K800-NUM-REGN     08089505
             ELSE                                                       08089705
                DISPLAY 'ERROR READING - BP13K800 : ' BP13K800-STATUS   08089805
                MOVE BP13K800-STATUS     TO RETURN-CODE                 08089905
                PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                 08090005
             END-IF                                                     08090105
           END-IF.                                                      08090505
                                                                        08090605
       4220-EXIT.                                                       08090705
           EXIT.                                                        08090805
                                                                        08090905
      *----------------------*                                          08091005
       4250-REWRITE-BP13K800.                                           08091105
      *----------------------*                                          08091205
                                                                        08091305
           MOVE WS-SYSTEM-DATE      TO K800-DTE-UPDATE                  08091405
                                       K800-DTE-AHG-PAYMENT.            08091505
           MOVE 'BP13CB0A'          TO K800-NUM-USERID.                 08091605
           REWRITE BP13K800-MASTER.                                     08091705
                                                                        08091805
           IF BP13K800-STATUS = 0                                       08091905
              ADD 1    TO CNT-K800-UPDATE                               08092005
           ELSE                                                         08092105
              DISPLAY 'ERROR UPDATING- BP13K800 : ' BP13K800-STATUS     08092605
              MOVE BP13K800-STATUS     TO RETURN-CODE                   08092705
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                   08092805
           END-IF.                                                      08092905
                                                                        08093005
       4250-EXIT.                                                       08093105
           EXIT.                                                        08093205
                                                                        08093305
      *----------------------*                                          08094004
       4400-UPDATE-GRANT-ASMNT.                                         08100004
      *----------------------*                                          08110004
           MOVE FD10-NUM-REGN      TO NUM-RGSTRN OF DCLGRANT-ASMNT.     08120004
                                                                        08130004
           STRING F630-DTE-TRANS(1:4) '-'                               08140004
                  F630-DTE-TRANS(5:2) '-'                               08150004
                  F630-DTE-TRANS(7:2)                                   08160004
              DELIMITED BY SIZE INTO DTE-PYMNT OF DCLGRANT-ASMNT.       08170004
           MOVE 'BP13CB0A ' TO NUM-UPDATE-USERID OF DCLGRANT-ASMNT.     08180004
                                                                        08190004
           EXEC SQL                                                     08200004
              UPDATE GRANT_ASMNT                                        08210004
              SET DTE_PYMNT         = :DCLGRANT-ASMNT.DTE-PYMNT,        08220004
                  NUM_UPDATE_USERID = :DCLGRANT-ASMNT.NUM-UPDATE-USERID,08230004
                  TME_UPDATE        = :DCLGRANT-ASMNT.TME-UPDATE,       08240004
                  DTE_UPDATE        = :DCLGRANT-ASMNT.DTE-UPDATE        08250004
              WHERE NUM_RGSTRN      = :DCLGRANT-ASMNT.NUM-RGSTRN        08260004
               AND  NUM_GRANT_TYPE  = :DCLGRANT-ASMNT.NUM-GRANT-TYPE    08270004
           END-EXEC.                                                    08280004
                                                                        08290004
           EVALUATE SQLCODE                                             08300004
           WHEN WS-SQL-OK                                               08310004
                ADD 1          TO WS-ASMNT-UPDATE                       08320004
                MOVE 'GRANT_ASMNT'  TO WS-SOURCE                        08330004
                MOVE 'U'            TO WS-ACTION                        08340004
                MOVE NUM-RGSTRN OF DCLGRANT-ASMNT     TO WS-RGSTRN      08350004
                MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT TO WS-GRNT-TYPE   08360004
                MOVE DCLGRANT-ASMNT TO WS-AFTER-IMAGE                   08370004
                PERFORM 6400-INSERT-TO-LOG     THRU 6400-EXIT           08380004
           WHEN WS-SQL-NFND                                             08390004
                MOVE SQLCODE   TO WS-SQLCODE                            08400004
                DISPLAY 'CASE NOTFND IN GRANT_ASMNT'                    08410004
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      08420004
                DISPLAY 'REGNO : ' NUM-RGSTRN OF DCLGRANT-ASMNT         08430004
                DISPLAY 'GRANT TYPE: ' NUM-GRANT-TYPE OF DCLGRANT-ASMNT 08440004
                DISPLAY SPACES                                          08450004
           WHEN OTHER                                                   08460004
                MOVE SQLCODE   TO WS-SQLCODE                            08470004
                DISPLAY 'ERROR UPDATING GRANT_ASMNT'                    08480004
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                      08490004
                DISPLAY SPACES                                          08500004
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT              08510004
                                                                        08520004
                                                                        08530004
           END-EVALUATE.                                                08540004
                                                                        08550004
       4400-EXIT.                                                       08560004
           EXIT.                                                        08570004
                                                                        08580004
      *--------------------*                                            08590004
       5500-MOVE-TO-INTRAY.                                             08600004
      *--------------------*                                            08610004
           MOVE SPACES                    TO BE08W001-COMMAREA.         08620004
           INITIALIZE                        BE08W001-COMMAREA.         08630004
           MOVE 'C'                       TO W001-IN-TXN-TYPE.          08640004
           MOVE 'BP13'                    TO W001-IN-SYSTEM-ID.         08650004
           MOVE '0068'                    TO W001-IN-NUM-PRCS-CTGRY.    08660004
           MOVE FD10-NUM-REGN             TO W001-IN-NUM-CASE-REF.      08670004
           MOVE '000001'                  TO W001-IN-NUM-BRNCH.         08680004
           STRING WS-DTE-CCYYMMDD(1:4) '-'                              08690004
                  WS-DTE-CCYYMMDD(5:2) '-'                              08700004
                  WS-DTE-CCYYMMDD(7:2)                                  08710004
                  DELIMITED BY SIZE     INTO W001-IN-DTE-INBOX.         08720004
           STRING WS-TIME-HHMMSS(1:2) '.'                               08730004
                  WS-TIME-HHMMSS(3:2) '.'                               08740004
                  WS-TIME-HHMMSS(5:2)                                   08750004
                  DELIMITED BY SIZE     INTO W001-IN-TME-INBOX.         08760004
      *    MOVE FD10-NUM-OIC              TO K010-NUM-USERID.           08770004
           MOVE FD10-NUM-USERID           TO K010-NUM-USERID.           08780004
           PERFORM 6000-GET-STAFF-ID      THRU 6000-EXIT.               08790004
           MOVE K010-NUM-HDB-STAFF-ID     TO W001-IN-NUM-STAFF          08800004
                                             WS-STAFFID.                08810004
      *    MOVE K010-NUM-LOTUS-NCKNM      TO W001-IN-NUM-NCKNME.        08820004
           PERFORM 6100-GET-SCH-ACCT      THRU 6100-EXIT.               08830004
           MOVE K000-NUM-SCH-ACC          TO WS-SCHACCT.                08840004
           MOVE FD10-NUM-REGN             TO W001-IN-HDBREF             08850004
                                             WS-REGNO.                  08860004
           STRING WS-DTE-DUE(1:4) '-'                                   08870004
                  WS-DTE-DUE(5:2) '-'                                   08880004
                  WS-DTE-DUE(7:2)                                       08890004
                  DELIMITED BY SIZE     INTO W001-IN-DUE-DATE.          08900004
           MOVE WS-TXT-TARGET-URL         TO W001-IN-TXT-TARGET-URL.    08910004
           STRING 'SERS Grant Processed - ' K000-NUM-SCH-ACC            08920004
                  DELIMITED BY SIZE     INTO W001-IN-TXT-REMARK.        08930004
                                                                        08940004
      *    MOVE                           TO W001-IN-NUM-BLDNG-GL.      08950004
      *    MOVE                           TO W001-IN-NUM-UNIT-ID.       08960004
                                                                        08970004
           MOVE ZEROES TO WS-DEBIT-CNT                                  08980004
                          WS-CREDIT-CNT.                                08990004
           MOVE 'N'    TO NO-MORE-TX.                                   09000004
           PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 16         09010004
                                                 OR NO-MORE-TX = 'Y'    09020004
            IF (FD10-NUM-VOUCH-SYS(WS-CTR)   = SPACES OR LOW-VALUE) AND 09030004
               (FD10-NUM-VOUCH-CR-DR(WS-CTR) = SPACES OR LOW-VALUE) AND 09040004
               (FD10-NUM-VOUCH-GL(WS-CTR)    = SPACES OR LOW-VALUE)     09050004
                MOVE 'Y'               TO   NO-MORE-TX                  09060004
            END-IF                                                      09070004
            IF FD10-NUM-VOUCH-CR-DR(WS-CTR) = 'D'                       09080004
               ADD 1 TO WS-DEBIT-CNT                                    09090004
            END-IF                                                      09100004
            IF FD10-NUM-VOUCH-CR-DR(WS-CTR) = 'C'                       09110004
               ADD 1 TO WS-CREDIT-CNT                                   09120004
            END-IF                                                      09130004
           END-PERFORM.                                                 09140004
                                                                        09150004
           IF WS-DEBIT-CNT NOT = ZEROES                                 09160004
              IF WS-CREDIT-CNT = ZEROES                                 09170004
                 STRING '(PV) VR ' FD10-NUM-VR                          09180004
                      DELIMITED BY SIZE INTO W001-IN-TXT-MORE-INFO      09190004
              ELSE                                                      09200004
                 STRING '(JV) VR ' FD10-NUM-VR                          09210004
                      DELIMITED BY SIZE INTO W001-IN-TXT-MORE-INFO      09220004
              END-IF                                                    09230004
           END-IF.                                                      09240004
                                                                        09250004
       5500-EXIT.                                                       09260004
           EXIT.                                                        09270004
                                                                        09280004
      *---------------------------------------------------------------* 09290004
       6000-GET-STAFF-ID.                                               09300004
      *---------------------------------------------------------------* 09310004
           READ SY08K010 KEY IS K010-NUM-USERID.                        09320004
           EVALUATE WS-K010-STATUS                                      09330004
           WHEN 00                                                      09340004
                CONTINUE                                                09350004
           WHEN 10                                                      09360004
           WHEN 23                                                      09370004
                DISPLAY 'SY08K010 RECORD NOT FOUND: '                   09380004
                         K010-NUM-USERID                                09390004
           WHEN OTHER                                                   09400004
                DISPLAY 'SY08K010 READ ERROR: ' WS-K010-STATUS          09410004
                MOVE WS-K010-STATUS       TO RETURN-CODE                09420004
                PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT             09430004
           END-EVALUATE.                                                09440004
                                                                        09450004
       6000-EXIT.                                                       09460004
           EXIT.                                                        09470004
                                                                        09480004
      *-------------------------------------------------------------    09490004
       6100-GET-SCH-ACCT.                                               09500004
      *-------------------------------------------------------------    09510004
           MOVE FD10-NUM-REGN TO K000-NUM-REGNO.                        09520004
           READ BP17K001 KEY IS K000-NUM-REGNO.                         09530004
           EVALUATE WS-K001-STATUS                                      09540004
           WHEN 00                                                      09550004
           WHEN 02                                                      09560004
           WHEN 23                                                      09570004
                CONTINUE                                                09580004
           WHEN OTHER                                                   09590004
                DISPLAY 'READ BP17K001 ERROR     :' K000-NUM-REGNO      09600004
           END-EVALUATE.                                                09610004
                                                                        09620004
       6100-EXIT.                                                       09630004
           EXIT.                                                        09640004
                                                                        09650004
      *--------------------*                                            09660004
       6400-INSERT-TO-LOG.                                              09670004
      *--------------------*                                            09680004
            EXEC SQL                                                    09690004
                 SET :WS-TIMESTAMP-LOG = CURRENT TIMESTAMP              09700004
            END-EXEC.                                                   09710004
            IF SQLCODE NOT = 000                                        09720004
               MOVE SQLCODE          TO WS-SQLCODE                      09730004
               DISPLAY 'SQL ERROR SET DB2 TIMESTAMP'                    09740004
               DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                 09750004
               PERFORM 9999-SQL-ERROR THRU 9999-EXIT                    09760004
            END-IF.                                                     09770004
                                                                        09780004
           MOVE WS-TIMESTAMP-LOG TO TME-UPDATE OF DCLGRANT-UPDATE-LOG.  09790004
           MOVE 'BP13CB0A'  TO NUM-UPDATE-USERID OF DCLGRANT-UPDATE-LOG.09800004
           MOVE WS-SOURCE   TO NUM-SOURCE-RECORD OF DCLGRANT-UPDATE-LOG.09810004
           MOVE WS-ACTION     TO NUM-ACTION OF DCLGRANT-UPDATE-LOG.     09820004
           MOVE WS-RGSTRN     TO NUM-RGSTRN OF DCLGRANT-UPDATE-LOG.     09830004
           MOVE WS-GRNT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-UPDATE-LOG.  09840004
           MOVE WS-BEFORE-IMAGE TO TXT-BEFORE-IMAGE-TEXT                09850004
                                              OF DCLGRANT-UPDATE-LOG.   09860004
           MOVE LENGTH OF WS-BEFORE-IMAGE TO TXT-BEFORE-IMAGE-LEN       09870004
                                              OF DCLGRANT-UPDATE-LOG.   09880004
           MOVE WS-AFTER-IMAGE TO TXT-AFTER-IMAGE-TEXT                  09890004
                                              OF DCLGRANT-UPDATE-LOG.   09900004
           MOVE LENGTH OF WS-AFTER-IMAGE TO TXT-AFTER-IMAGE-LEN         09910004
                                              OF DCLGRANT-UPDATE-LOG.   09920004
            EXEC SQL                                                    09930004
                 INSERT INTO GRANT_UPDATE_LOG                           09940004
                        ( TME_UPDATE,                                   09950004
                          NUM_UPDATE_USERID,                            09960004
                          NUM_SOURCE_RECORD,                            09970004
                          NUM_ACTION,                                   09980004
                          NUM_RGSTRN,                                   09990004
                          NUM_GRANT_TYPE,                               10000004
                          TXT_BEFORE_IMAGE,                             10010004
                          TXT_AFTER_IMAGE )                             10020004
                 VALUES ( :DCLGRANT-UPDATE-LOG.TME-UPDATE,              10030004
                          :DCLGRANT-UPDATE-LOG.NUM-UPDATE-USERID,       10040004
                          :DCLGRANT-UPDATE-LOG.NUM-SOURCE-RECORD,       10050004
                          :DCLGRANT-UPDATE-LOG.NUM-ACTION,              10060004
                          :DCLGRANT-UPDATE-LOG.NUM-RGSTRN,              10070004
                          :DCLGRANT-UPDATE-LOG.NUM-GRANT-TYPE,          10080004
                          :DCLGRANT-UPDATE-LOG.TXT-BEFORE-IMAGE,        10090004
                          :DCLGRANT-UPDATE-LOG.TXT-AFTER-IMAGE )        10100004
            END-EXEC.                                                   10110004
                                                                        10120004
            EVALUATE SQLCODE                                            10130004
               WHEN 000                                                 10140004
                    ADD 1                 TO WS-GRNT-UPD-LOG            10150004
                                                                        10160004
               WHEN -803                                                10170004
                    CONTINUE                                            10180004
                                                                        10190004
               WHEN OTHER                                               10200004
                    MOVE SQLCODE          TO WS-SQLCODE                 10210004
                    DISPLAY 'SQL ERROR (INSERT) IN GRANT_UPDATE_LOG'    10220004
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE            10230004
                    PERFORM 9999-SQL-ERROR      THRU 9999-EXIT          10240004
            END-EVALUATE.                                               10250004
                                                                        10260004
       6400-EXIT.                                                       10270004
           EXIT.                                                        10280004
                                                                        10290004
      *-----------------*                                               10300004
       9000-CLOSE-FILES.                                                10310004
      *-----------------*                                               10320004
                                                                        10330004
           DISPLAY '******  BP13CB0A *************'.                    10340004
           DISPLAY 'NO OF RECS MATCHED F630/FD10    : ' WS-MATCH-REC.   10350004
           DISPLAY 'NO OF RECS WRITTEN TO BP13F125  : ' CNT-F125-WRITE. 10360004
           DISPLAY 'NO OF FD10 WRITTEN TO BP13FD10  : ' CNT-FD10-WRITE. 10370004
           DISPLAY 'NO OF RECS READ FROM  AG07F630  : ' CNT-F630-READ.  10380004
           DISPLAY 'NO OF RECS READ FROM  BP13KD10  : ' CNT-KD10-READ.  10390004
           DISPLAY 'NO OF RECS READ FROM  BP13FD10  : ' CNT-FD10-READ.  10400004
           DISPLAY 'NO OF RECS READ FROM  BP13K800  : ' CNT-K800-READ.  10401005
           DISPLAY 'NO OF RECS UPDATED FROM BP13K800: ' CNT-K800-UPDATE.10402005
           DISPLAY 'NO OF RECS UPDATED IN ASMNT TBLE: ' WS-ASMNT-UPDATE.10410004
           DISPLAY 'NO OF RECS CREATED TO GRANT LOG : ' WS-GRNT-UPD-LOG.10420004
           DISPLAY 'NO OF RECS SENT TO INTRAY       : ' WS-INBOX-WRITE. 10430004
           DISPLAY 'NO OF RECS WRITTEN TO BP13LB0A  : ' CNT-PRT-CASES.  10440004
                                                                        10450004
           CLOSE BP13KD10                                               10460004
                 AG07F630                                               10470004
                 P13FD10A                                               10480004
                 BP17K001                                               10490004
                 BP13K800                                               10491005
                 SY08K010                                               10500004
                 P13FD10B                                               10510004
                 BP13F125                                               10520004
                 BP13LB0A.                                              10530004
                                                                        10540004
           IF BP13KD10-STATUS NOT = 0 AND 97                            10550004
              DISPLAY ' CLOSING ERROR, BP13KD10-STATUS ' BP13KD10-STATUS10560004
              MOVE BP13KD10-STATUS TO RETURN-CODE.                      10570004
                                                                        10580004
           STOP RUN.                                                    10590004
                                                                        10600004
       9000-EXIT.                                                       10610004
            EXIT.                                                       10620004
                                                                        10630004
      *---------------------------------------------------------------- 10640004
       9999-SQL-ERROR.                                                  10650004
      *---------------------------------------------------------------- 10660004
           CALL 'DBATIAR'  USING SQLCA.                                 10670004
           EXEC SQL ROLLBACK               END-EXEC.                    10680004
           MOVE 99                         TO    WS-RETURN-CODE.        10690004
           PERFORM 9000-CLOSE-FILES        THRU  9000-EXIT.             10700004
                                                                        10710004
       9999-EXIT.                                                       10720004
           EXIT.                                                        10730004
