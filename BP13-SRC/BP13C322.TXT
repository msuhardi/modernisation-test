      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID.    BP13C322.                                                 
       AUTHOR.        LKH.                                                      
       DATE-WRITTEN.  13/07/90.                                                 
                                                                                
      **********************************************************                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMENCEMENT                *                
      *                                                        *                
      *    SYSTEM ID : BP13                                    *                
      *                                                        *                
      *    OBJECTIVE  :                                        *                
      *        1.  THIS IS THE PROGRAM TO PRINT OUT REPORTS    *                
      *            WHERE DELIVERY POSSESSION DATE IS DUE IN 2  *                
      *            MONTH'S TIME FOR KEYS AVAILABLE AND KEY NOT *                
      *            AVAILABLE CASES.                            *                
      *                                                        *                
      *     INPUT FILES:                                       *                
      *           1. BP13K330                                  *                
      *           2. BB14K500                                  *                
      *           3. BM06K110                                  *                
      *           4. BP13K800                                  *                
      *                                                        *                
      *     LISTING:                                           *                
      *           1. REPORT FOR KEYS NOT AVAILABLE (P13L322A)  *                
      *           2. REPORT FOR KEYS AVAILABLE     (P13L322B)  *                
      *                                                        *                
      * SOC-PH8B NEIL 27/07/93 CHANGE SOURCE OF PROPERTY INFO  *                
      *                        BM06K110 TO DB2 TABLES(N930012) *                
      * BP130418 SIA  05/98/08 CHGE BM06K211 TO BM06K110       *                
      *                        Y2K COMPLIANCE CHANGES          *                
      * BP130883 RAS  07/08/02 TO CHANGE BP13C904 TO BP13C913  *                
      * BP132208 MALC 11/09/02 TO VERIFY IF CASE NOT YET CANCEL*                
      *                        GET SCH-ACCT IN BP13K800        *                
      **********************************************************                
                                                                                
                                                                                
      *------------------------*                                                
       ENVIRONMENT DIVISION.                                                    
      *------------------------*                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3900.                                               
       OBJECT-COMPUTER. IBM-3900.                                               
                                                                                
      *------------------------*                                                
       INPUT-OUTPUT SECTION.                                                    
      *------------------------*                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K330 ASSIGN TO BP13K330                                   
                ACCESS MODE   IS DYNAMIC                                        
                ORGANIZATION  IS INDEXED                                        
                RECORD KEY    IS K330-KEY-FLD                                   
                FILE STATUS   IS K330-STATUS.                                   
                                                                                
           SELECT BB14K500 ASSIGN TO BB14K500                                   
                ACCESS MODE   IS DYNAMIC                                        
                ORGANIZATION  IS INDEXED                                        
                RECORD KEY    IS K500-KEY-FLD                                   
                ALTERNATE KEY IS K500-ALTX-KEY                                  
                FILE STATUS   IS K500-STATUS.                                   
                                                                                
           SELECT BM06K110 ASSIGN TO BM06K110                                   
                ACCESS MODE   IS DYNAMIC                                        
                ORGANIZATION  IS INDEXED                                        
                RECORD KEY    IS K110-KEY-FLD                                   
                FILE STATUS   IS K110-STATUS.                                   
                                                                                
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                ACCESS MODE   IS RANDOM                                         
                ORGANIZATION  IS INDEXED                                        
                RECORD KEY    IS K800-NUM-REGN                                  
                FILE STATUS   IS K800-STATUS.                                   
                                                                                
           SELECT P13L322A ASSIGN TO P13L322A.                                  
           SELECT P13L322B ASSIGN TO P13L322B.                                  
                                                                                
                                                                                
      *------------------------*                                                
       DATA DIVISION.                                                           
      *------------------------*                                                
       FILE SECTION.                                                            
       FD  BP13K330          BLOCK CONTAINS 0 RECORDS                           
                             RECORD CONTAINS 2000 CHARACTERS                    
                             LABEL RECORDS ARE STANDARD.                        
       COPY BP13K330.                                                           
                                                                                
       FD  BB14K500          BLOCK CONTAINS 0 RECORDS                           
                             RECORD CONTAINS 400 CHARACTERS                     
                             LABEL RECORDS ARE STANDARD.                        
       COPY BB14K500.                                                           
                                                                                
       FD  BM06K110          BLOCK CONTAINS 0 RECORDS                           
                             RECORD CONTAINS 500 CHARACTERS                     
                             LABEL RECORDS ARE STANDARD.                        
       COPY BM06K110.                                                           
                                                                                
       FD  BP13K800          BLOCK CONTAINS 0 RECORDS                           
                             RECORD CONTAINS 2000 CHARACTERS                    
                             LABEL RECORDS ARE STANDARD.                        
       COPY BP13K800.                                                           
                                                                                
       FD  P13L322A                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED.                                           
       01  PRINT-REC-1                 PIC X(132).                              
                                                                                
       FD  P13L322B                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE OMITTED.                                           
       01  PRINT-REC-2                 PIC X(132).                              
                                                                                
                                                                                
      *------------------------*                                                
       WORKING-STORAGE SECTION.                                                 
      *------------------------*                                                
                                                                                
       COPY P13COMM8.                                                           
                                                                                
       01  WS-LINK-REC.                                                         
           05  WS-LINK-SCH-ACC.                                                 
               10 LINK-NUM-SCH     PIC X(4)    VALUE SPACES.                    
               10 LINK-NUM-ACC     PIC X(5)    VALUE SPACES.                    
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  K330-STATUS         PIC 99      VALUE ZEROS.                     
           05  K500-STATUS         PIC 99      VALUE ZEROS.                     
           05  K110-STATUS         PIC 99      VALUE ZEROS.                     
           05  K800-STATUS         PIC 99      VALUE ZEROS.                     
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-PAGE1            PIC 9(4)    VALUE ZEROS.                     
           05  WS-PAGE2            PIC 9(4)    VALUE ZEROS.                     
           05  WS-REC-CNT1         PIC 99      VALUE ZEROS.                     
           05  WS-REC-CNT2         PIC 99      VALUE ZEROS.                     
           05  WS-SEQ-CNT1         PIC 9(4)    VALUE ZEROS.                     
           05  WS-SEQ-CNT2         PIC 9(4)    VALUE ZEROS.                     
           05  WS-INDEX            PIC 99      VALUE ZEROS.                     
           05  WS-DIFF-DAY         PIC S9(6)   VALUE ZEROS.                     
           05  WS-ED-DIFF-DAY      PIC ZZZZZ9- VALUE ZEROS.                     
           05  WS-READ-K330-CNT    PIC 9(5)    VALUE ZEROS.                     
           05  WS-READ-K550-CNT    PIC 9(5)    VALUE ZEROS.                     
           05  WS-READ-K110-CNT    PIC 9(5)    VALUE ZEROS.                     
           05  WS-READ-K800-CNT    PIC 9(5)    VALUE ZEROS.                     
           05  WS-READ-K500-CNT    PIC 9(5)    VALUE ZEROS.                     
           05  WS-K800-NOTFND-CNT  PIC 9(5)    VALUE ZEROS.                     
           05  WS-K110-NOTFND-CNT  PIC 9(5)    VALUE ZEROS.                     
           05  WS-K500-NOTFND-CNT  PIC 9(5)    VALUE ZEROS.                     
           05  WS-NO-POSDATE-CNT   PIC 9(5)    VALUE ZEROS.                     
           05  WS-MORE60-CNT       PIC 9(5)    VALUE ZEROS.                     
           05  WS-NOT-MORE60-CNT   PIC 9(5)    VALUE ZEROS.                     
           05  WS-KEY-NOT-AVAIL-CNT PIC 9(5)   VALUE ZEROS.                     
           05  WS-REM              PIC 9(2)    VALUE ZEROS.                     
           05  WS-PREV-MTH         PIC 9(2)    VALUE ZEROS.                     
           05  WS-CUR-MTH-DAY      PIC 9(2)    VALUE ZEROS.                     
           05  WS-ACC-DAY          PIC 9(2)    VALUE ZEROS.                     
           05  WS-NUM-LEAP-YR      PIC 9(3)    VALUE ZEROS.                     
           05  WS-NUM-NON-LEAP-YR  PIC 9(3)    VALUE ZEROS.                     
           05  WS-NUM-DAY-CURR-YR  PIC 9(3)    VALUE ZEROS.                     
           05  WS-TOT-NUM-DAY      PIC 9(6)    VALUE ZEROS.                     
           05  WS-DEL-POSS-DAY     PIC 9(6)    VALUE ZEROS.                     
           05  WS-SYS-DAY          PIC 9(6)    VALUE ZEROS.                     
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-EOF              PIC X(1)    VALUE 'N'.                       
                                                                                
       01  FOUND-FLAG.                                                          
           05  K500-REC-FOUND      PIC X       VALUE 'Y'.                       
           05  K110-REC-FOUND      PIC X       VALUE 'Y'.                       
           05  K800-REC-FOUND      PIC X       VALUE 'Y'.                       
                                                                                
       01  WS-ED-COMM-DATE.                                                     
           05  WS-COMM-CCYY        PIC 9(4).                                    
           05  WS-COMM-MM          PIC 9(2).                                    
           05  WS-COMM-DD          PIC 9(2).                                    
                                                                                
       01  WS-CURRENT-DATE.                                                     
           05  WS-CURR-CC          PIC 99    VALUE ZEROS.                       
           05  WS-CURR-DATE.                                                    
               10  WS-CURR-YY      PIC 99    VALUE ZEROS.                       
               10  WS-CURR-MM      PIC 99    VALUE ZEROS.                       
               10  WS-CURR-DD      PIC 99    VALUE ZEROS.                       
                                                                                
       01  WS-UNIT-NO.                                                          
           05  WS-LEVEL            PIC X(2).                                    
           05  FILLER              PIC X      VALUE '-'.                        
           05  WS-MAIN-UNIT        PIC X(4).                                    
           05  WS-SLASH1           PIC X      VALUE '-'.                        
           05  WS-SUB-UNIT         PIC X(3).                                    
                                                                                
       01  WS-SCH-ACC-NO.                                                       
           05  WS-SCHEME            PIC X(4).                                   
           05  WS-ACCOUNT           PIC X(4).                                   
           05  WS-CHK               PIC X.                                      
           05  WS-LESSEE            PIC X(2).                                   
                                                                                
       01  WS-DATE-REC.                                                         
           05  WS-DAY-CHAR          PIC X(24)   VALUE                           
               '312831303130313130313031'.                                      
           05  WS-DAY-NUM           REDEFINES WS-DAY-CHAR.                      
               10  WS-DAY-PER-MTH   PIC 9(2)    OCCURS 12.                      
                                                                                
      **  COMMON HEADER USE FOR BOTH REPORTS.                                   
                                                                                
       01  L322-HDG1.                                                           
           05  PRT-ID              PIC X(9)   VALUE SPACES.                     
           05  FILLER              PIC X(20)  VALUE SPACES.                     
           05  FILLER              PIC X(75)  VALUE                             
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(7)   VALUE 'DATE :'.                   
           05  PRT-DATE            PIC X(10).                                   
                                                                                
       01  L322-HDG2.                                                           
           05  FILLER              PIC X(20)  VALUE SPACES.                     
           05  FILLER              PIC X(52)  VALUE                             
               'LIST OF CASES WHERE DELIVERY POSSESSION DATE IS DUE'.           
           05  FILLER              PIC X(32)  VALUE                             
               'IN 2 MONTHS TIME'.                                              
           05  FILLER              PIC X(7)   VALUE 'PAGE : '.                  
           05  PRT-PAGE            PIC ZZZ9.                                    
                                                                                
       01  L322-HDG3.                                                           
           05  FILLER              PIC X(38)   VALUE SPACES.                    
           05  PRT-DESC            PIC X(66).                                   
           05  FILLER              PIC X(25)   VALUE                            
               'USER : AGMT TEAM'.                                              
                                                                                
       01  L322-HDG4.                                                           
           05  FILLER              PIC X(25)   VALUE SPACES.                    
           05  FILLER              PIC X(55)   VALUE                            
               'CURR     ORIG'.                                                 
           05  FILLER              PIC X(52)   VALUE                            
               'AGREEMENT       LATEST       DELIVERY'.                         
                                                                                
       01  L322-HDG4A.                                                          
           05  FILLER              PIC X(25)   VALUE SPACES.                    
           05  FILLER              PIC X(55)   VALUE                            
               'CURR     ORIG'.                                                 
           05  FILLER              PIC X(52)   VALUE                            
               'AGREEMENT        KEYS        DELIVERY'.                         
                                                                                
       01  L322-HDG5.                                                           
           05  FILLER              PIC X(80)    VALUE                           
               ' S/NO  SCH-ACC-NO      REGN NO  REGN NO  FLAT ADDRESS'.         
           05  FILLER              PIC X(52)    VALUE                           
               '  ORDER       COMPLETION    POSSESSION'.                        
                                                                                
       01  L322-HDG5A.                                                          
           05  FILLER              PIC X(80)    VALUE                           
               ' S/NO  SCH-ACC-NO      REGN NO  REGN NO  FLAT ADDRESS'.         
           05  FILLER              PIC X(52)    VALUE                           
               '  ORDER       AVAILABLE     POSSESSION'.                        
                                                                                
       01  L322-HDG6.                                                           
           05  FILLER              PIC X(82)   VALUE SPACES.                    
           05  FILLER              PIC X(50)   VALUE                            
               'DATE          DATE           DATE   '.                          
                                                                                
       01  L322-HDG7.                                                           
           05  FILLER               PIC X(132)  VALUE ALL '-'.                  
                                                                                
      ** DETAIL RECORD FOR KEY NOT AVAILABLE/KEY AVAILABLE CASES.               
       01  L322-DTL1.                                                           
           05  FILLER              PIC X      VALUE SPACES.                     
           05  PRT-SEQ-CNT         PIC ZZZ9   VALUE ZEROS.                      
           05  FILLER              PIC X(2)   VALUE SPACES.                     
           05  PRT-SCH-ACC-NO      PIC X(14).                                   
           05  FILLER              PIC X(2)   VALUE SPACES.                     
           05  PRT-CURR-REGN-NO    PIC X(8).                                    
           05  FILLER              PIC X(1)   VALUE SPACES.                     
           05  PRT-ORIG-REGN-NO    PIC X(8).                                    
           05  FILLER              PIC X(5)   VALUE '  BLK'.                    
           05  PRT-BLOCK           PIC X(5).                                    
           05  FILLER              PIC X(2)   VALUE ' #'.                       
           05  PRT-HOUSE-NO        PIC X(11).                                   
           05  FILLER              PIC X(17)  VALUE SPACES.                     
           05  PRT-DTE-AGMT-ORDER  PIC X(10).                                   
           05  FILLER              PIC X(4)   VALUE SPACES.                     
           05  PRT-DTE-LAST-COMP   PIC X(10).                                   
           05  FILLER              PIC X(4)   VALUE SPACES.                     
           05  PRT-DTE-DEL-POSSN   PIC X(10).                                   
                                                                                
       01  L322-DTL2.                                                           
           05  FILLER               PIC X(41)  VALUE SPACES.                    
           05  PRT-STREET           PIC X(30).                                  
           05  FILLER               PIC X(2)   VALUE ' ('.                      
           05  PRT-POSTAL-CODE      PIC X(6).                                   
           05  FILLER               PIC X(50)  VALUE ')'.                       
                                                                                
                                                                                
      *------------------------*                                                
       PROCEDURE DIVISION.                                                      
      *------------------------*                                                
                                                                                
      *------------------------*                                                
       000-MAIN.                                                                
      *------------------------*                                                
           PERFORM 100-OPEN-ROUTINE   THRU 100-EXIT.                            
           PERFORM 150-START-K330     THRU 150-EXIT.                            
           PERFORM 200-READ-K330      THRU 200-EXIT.                            
                                                                                
           IF WS-EOF NOT = 'Y'                                                  
              PERFORM 250-CAL-SYS-DAY THRU 250-EXIT.                            
                                                                                
           PERFORM 300-PROCESS-REPORT THRU 300-EXIT                             
                   UNTIL WS-EOF = 'Y'.                                          
           PERFORM 999-CLOSE-ROUTINE  THRU 999-EXIT.                            
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       100-OPEN-ROUTINE.                                                        
      *------------------------*                                                
           OPEN INPUT BP13K330                                                  
                      BB14K500                                                  
                      BM06K110                                                  
                      BP13K800                                                  
               OUTPUT P13L322A                                                  
                      P13L322B.                                                 
                                                                                
           IF K330-STATUS NOT = 0 AND 97                                        
               DISPLAY 'OPENING ERROR, K330-STATUS ' K330-STATUS                
               MOVE K330-STATUS TO RETURN-CODE                                  
               PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                         
           IF K500-STATUS NOT = 0 AND 97                                        
               DISPLAY 'OPENING ERROR, K500-STATUS ' K500-STATUS                
               MOVE K500-STATUS TO RETURN-CODE                                  
               PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                         
           IF K110-STATUS NOT = 0 AND 97                                        
               DISPLAY 'OPENING ERROR,K110-STATUS ' K110-STATUS                 
               MOVE K110-STATUS TO RETURN-CODE                                  
               PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                         
                                                                                
           IF K800-STATUS NOT = 0 AND 97                                        
               DISPLAY 'OPENING ERROR,K800-STATUS ' K800-STATUS                 
               MOVE K800-STATUS TO RETURN-CODE                                  
               PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                         
                                                                                
           MOVE ZEROS TO WS-COUNTERS.                                           
           MOVE 50                    TO  WS-REC-CNT1 WS-REC-CNT2.              
           MOVE FUNCTION CURRENT-DATE TO  WS-CURRENT-DATE.                      
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       150-START-K330.                                                          
      *------------------------*                                                
           MOVE LOW-VALUES TO K330-KEY-FLD.                                     
           START BP13K330 KEY NOT < K330-KEY-FLD INVALID                        
                 DISPLAY 'START ERROR, BP13K330-STATUS ' K330-STATUS            
                 MOVE K330-STATUS TO RETURN-CODE                                
                 PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                       
                                                                                
       150-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       200-READ-K330.                                                           
      *------------------------*                                                
            MOVE SPACES   TO WS-EOF.                                            
            READ BP13K330 NEXT AT END MOVE 'Y' TO WS-EOF                        
                        GO TO 200-EXIT.                                         
                                                                                
            ADD 1 TO WS-READ-K330-CNT.                                          
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       250-CAL-SYS-DAY.                                                         
      *------------------------*                                                
           MOVE WS-CURRENT-DATE TO WS-ED-COMM-DATE                              
           PERFORM 450-CAL-DAY THRU 450-EXIT.                                   
           MOVE WS-TOT-NUM-DAY  TO WS-SYS-DAY.                                  
                                                                                
       250-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       300-PROCESS-REPORT.                                                      
      *------------------------*                                                
      **   TO CHECK WHETHER THE DELIVERY POSSESSION IS ZEROS.                   
                                                                                
           MOVE K330-DTE-DELIVERY-POSSN TO WS-ED-COMM-DATE.                     
           IF WS-ED-COMM-DATE NOT NUMERIC                                       
              MOVE ZEROS TO WS-ED-COMM-DATE.                                    
                                                                                
           IF WS-ED-COMM-DATE > ZEROS                                           
              NEXT SENTENCE                                                     
           ELSE                                                                 
              ADD 1 TO WS-NO-POSDATE-CNT                                        
              PERFORM 200-READ-K330 THRU 200-EXIT                               
              GO TO 300-EXIT.                                                   
                                                                                
           PERFORM 400-COMPARE-DATES THRU 400-EXIT.                             
                                                                                
           IF WS-DIFF-DAY > 60                                                  
              ADD 1 TO WS-MORE60-CNT                                            
              PERFORM 200-READ-K330 THRU 200-EXIT                               
              GO TO 300-EXIT.                                                   
                                                                                
           ADD 1 TO WS-NOT-MORE60-CNT.                                          
           PERFORM 475-READ-K800 THRU 475-EXIT.                                 
           IF K800-REC-FOUND = 'Y'                                              
              NEXT SENTENCE                                                     
           ELSE                                                                 
              PERFORM 200-READ-K330 THRU 200-EXIT                               
              GO TO 300-EXIT.                                                   
                                                                                
           PERFORM 500-READ-K110 THRU 500-EXIT.                                 
           IF K110-REC-FOUND = 'Y'                                              
              NEXT SENTENCE                                                     
           ELSE                                                                 
              PERFORM 200-READ-K330 THRU 200-EXIT                               
              GO TO 300-EXIT.                                                   
                                                                                
           MOVE SPACES              TO BP13COMM8-REC.                           
           INITIALIZE                  BP13COMM8-REC.                           
                                                                                
           MOVE K330-SCH-ACC        TO WS-LINK-REC.                             
                                                                                
           CALL 'BP13C913'      USING WS-LINK-REC,                              
                                      BP13COMM8-REC .                           
                                                                                
           IF K110-DTE-KEY-AVAIL = SPACES OR LOW-VALUES OR ZEROS                
              ADD 1 TO WS-KEY-NOT-AVAIL-CNT                                     
              PERFORM 600-READ-K500         THRU 600-EXIT                       
              PERFORM 700-PRT-KEY-NOT-AVAIL THRU 700-EXIT                       
            ELSE                                                                
               PERFORM 710-PRT-KEY-AVAIL    THRU 710-EXIT.                      
                                                                                
            PERFORM 200-READ-K330           THRU 200-EXIT.                      
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       400-COMPARE-DATES.                                                       
      *------------------------*                                                
      **   TO CALCULATE THE DELIVERY POSSESSION DATE                            
           MOVE K330-DTE-DELIVERY-POSSN TO WS-ED-COMM-DATE.                     
           PERFORM 450-CAL-DAY THRU 450-EXIT.                                   
           MOVE WS-TOT-NUM-DAY TO WS-DEL-POSS-DAY.                              
                                                                                
           COMPUTE WS-DIFF-DAY = WS-DEL-POSS-DAY - WS-SYS-DAY.                  
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      **  COMPUTE THE GIVEN DATES IN TERM OF DAYS                               
      *------------------------*                                                
       450-CAL-DAY.                                                             
      *------------------------*                                                
           MOVE ZEROS TO WS-NUM-DAY-CURR-YR.                                    
                                                                                
           DIVIDE WS-COMM-CCYY BY 4 GIVING WS-NUM-LEAP-YR                       
                  REMAINDER WS-REM.                                             
                                                                                
      ** TO SUBTRACT 1 IN ORDER TO GET THE PREV YEAR                            
           COMPUTE WS-NUM-NON-LEAP-YR = WS-COMM-CCYY -                          
                                        WS-NUM-LEAP-YR - 1.                     
                                                                                
           MOVE 1 TO WS-INDEX.                                                  
           COMPUTE WS-PREV-MTH = WS-COMM-MM - 1.                                
           IF WS-PREV-MTH = 0                                                   
              NEXT SENTENCE                                                     
            ELSE                                                                
               PERFORM 455-CAL-CUR-YR-DAY THRU 455-EXIT                         
                       UNTIL WS-INDEX > WS-PREV-MTH.                            
                                                                                
            COMPUTE WS-NUM-DAY-CURR-YR = WS-NUM-DAY-CURR-YR +                   
                                         WS-COMM-DD.                            
                                                                                
            COMPUTE WS-TOT-NUM-DAY = (WS-NUM-LEAP-YR * 366) +                   
                                     (WS-NUM-NON-LEAP-YR * 365) +               
                                     (WS-NUM-DAY-CURR-YR).                      
                                                                                
       450-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       455-CAL-CUR-YR-DAY.                                                      
      *------------------------*                                                
           IF WS-COMM-MM = 2                                                    
              IF WS-REM = 0                                                     
                 MOVE 28     TO WS-ACC-DAY                                      
              ELSE                                                              
                 MOVE 29     TO WS-ACC-DAY                                      
           ELSE                                                                 
              MOVE WS-DAY-PER-MTH(WS-INDEX) TO WS-ACC-DAY.                      
                                                                                
           COMPUTE WS-NUM-DAY-CURR-YR = WS-NUM-DAY-CURR-YR +                    
                                        WS-ACC-DAY.                             
                                                                                
           ADD 1 TO WS-INDEX.                                                   
                                                                                
       455-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       475-READ-K800.                                                           
      *------------------------*                                                
           MOVE 'Y'           TO K800-REC-FOUND.                                
           MOVE K330-CURR-REG TO K800-NUM-REGN.                                 
                                                                                
           READ BP13K800.                                                       
           IF   K800-STATUS = ZEROS                                             
                MOVE 'Y' TO K800-REC-FOUND                                      
                ADD   1  TO WS-READ-K800-CNT                                    
           ELSE                                                                 
           IF   K800-STATUS = 23                                                
                DISPLAY 'REC NOT FOUND IN BP13K800 ' K800-NUM-REGN              
                MOVE 'N' TO K800-REC-FOUND                                      
                ADD   1  TO WS-K800-NOTFND-CNT                                  
           ELSE                                                                 
                DISPLAY 'READ ERROR, BP13K800-STATUS ' K800-STATUS              
                DISPLAY 'K800-NUM-REGN ' K800-NUM-REGN                          
                MOVE 'N'         TO K800-REC-FOUND                              
                MOVE K800-STATUS TO RETURN-CODE                                 
                PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                        
                                                                                
       475-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       500-READ-K110.                                                           
      *------------------------*                                                
           MOVE 'Y' TO K110-REC-FOUND.                                          
           MOVE K800-NUM-SCH-ACC TO K110-KEY-FLD.                               
                                                                                
           READ BM06K110.                                                       
           IF   K110-STATUS = ZEROS                                             
                ADD   1  TO WS-READ-K110-CNT                                    
           ELSE                                                                 
           IF   K110-STATUS = 23                                                
                DISPLAY 'REC NOT FOUND IN BM06K110 ' K110-KEY-FLD               
                        ' REGN = ' K330-CURR-REG                                
                MOVE 'N' TO K110-REC-FOUND                                      
                ADD   1  TO WS-K110-NOTFND-CNT                                  
           ELSE                                                                 
                DISPLAY 'READ ERROR, BM06K110-STATUS ' K110-STATUS              
                DISPLAY 'K110-KEY-FLD ' K110-KEY-FLD                            
                        ' REGN = ' K330-CURR-REG                                
                MOVE 'N'         TO K110-REC-FOUND                              
                MOVE K110-STATUS TO RETURN-CODE                                 
                PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                        
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       600-READ-K500.                                                           
      *------------------------*                                                
           MOVE 'Y'           TO K500-REC-FOUND.                                
           MOVE K110-SCHEME   TO K500-NUM-SCH.                                  
           MOVE COMM8-NUM-BLK TO K500-NUM-BLK.                                  
                                                                                
           READ BB14K500 KEY IS K500-ALTX-KEY.                                  
           IF   K500-STATUS = ZEROS                                             
                ADD   1  TO WS-READ-K500-CNT                                    
           ELSE                                                                 
           IF   K500-STATUS = 23                                                
                DISPLAY 'REC NOT FOUND IN BB14K500 ' K500-ALTX-KEY              
                MOVE 'N' TO K500-REC-FOUND                                      
                ADD   1  TO WS-K500-NOTFND-CNT                                  
           ELSE                                                                 
                DISPLAY 'READ ERROR, BB14K500-STATUS ' K500-STATUS              
                DISPLAY 'K500-ALTX-KEY ' K500-ALTX-KEY                          
                MOVE 'N' TO K500-REC-FOUND                                      
                PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                        
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       700-PRT-KEY-NOT-AVAIL.                                                   
      *------------------------*                                                
           IF WS-REC-CNT1 > 16                                                  
              PERFORM 800-KEY-NOT-AVAIL-HDG THRU 800-EXIT.                      
                                                                                
            MOVE SPACES          TO PRINT-REC-1.                                
            ADD  1               TO WS-SEQ-CNT1.                                
            MOVE WS-SEQ-CNT1     TO PRT-SEQ-CNT.                                
            MOVE K330-SCH-ACC    TO WS-SCH-ACC-NO.                              
            STRING WS-SCHEME '-' WS-ACCOUNT '-' WS-CHK '-' WS-LESSEE            
                   DELIMITED BY SIZE INTO PRT-SCH-ACC-NO.                       
            MOVE K330-KEY-FLD    TO PRT-CURR-REGN-NO.                           
            MOVE K330-CUR-REG    TO PRT-ORIG-REGN-NO.                           
                                                                                
            MOVE COMM8-NUM-BLK       TO PRT-BLOCK.                              
            MOVE COMM8-NUM-LEVEL     TO WS-LEVEL.                               
            MOVE COMM8-NUM-UNIT-MAIN TO WS-MAIN-UNIT.                           
                                                                                
            IF   COMM8-NUM-UNIT-SUB = SPACES OR LOW-VALUES                      
                 MOVE SPACES             TO WS-SLASH1                           
                 MOVE SPACES             TO WS-SUB-UNIT                         
            ELSE                                                                
                 MOVE '-'                TO WS-SLASH1                           
                 MOVE COMM8-NUM-UNIT-SUB TO WS-SUB-UNIT.                        
                                                                                
            MOVE WS-UNIT-NO              TO PRT-HOUSE-NO.                       
                                                                                
            STRING K330-AGRORDER-DTE-DD '/' K330-AGRORDER-DTE-MM '/'            
                   K330-AGRORDER-DTE-CC                                         
                   K330-AGRORDER-DTE-YY DELIMITED BY SIZE INTO                  
                   PRT-DTE-AGMT-ORDER.                                          
                                                                                
            IF K500-REC-FOUND = 'N'                                             
               MOVE SPACES TO PRT-DTE-LAST-COMP                                 
            ELSE                                                                
               MOVE K500-DTE-BLDG-COMPLETE TO WS-ED-COMM-DATE                   
               STRING WS-COMM-DD '/' WS-COMM-MM '/' WS-COMM-CCYY                
                      DELIMITED BY SIZE INTO PRT-DTE-LAST-COMP.                 
                                                                                
            MOVE K330-DTE-DELIVERY-POSSN TO WS-ED-COMM-DATE.                    
            STRING WS-COMM-DD '/' WS-COMM-MM '/' WS-COMM-CCYY                   
                  DELIMITED BY SIZE INTO PRT-DTE-DEL-POSSN.                     
            WRITE PRINT-REC-1 FROM L322-DTL1 AFTER 2.                           
                                                                                
            MOVE SPACES                TO PRINT-REC-1.                          
            MOVE COMM8-NME-STREET      TO PRT-STREET.                           
            MOVE COMM8-NUM-POSTAL-CODE TO PRT-POSTAL-CODE.                      
            WRITE PRINT-REC-1 FROM L322-DTL2 AFTER 1.                           
            ADD 1 TO WS-REC-CNT1.                                               
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       710-PRT-KEY-AVAIL.                                                       
      *------------------------*                                                
           IF WS-REC-CNT2 > 16                                                  
              PERFORM 810-KEY-AVAIL-HDG THRU 810-EXIT.                          
                                                                                
            MOVE SPACES          TO PRINT-REC-2.                                
            ADD  1               TO WS-SEQ-CNT2.                                
            MOVE WS-SEQ-CNT2     TO PRT-SEQ-CNT.                                
            MOVE K330-SCH-ACC    TO WS-SCH-ACC-NO.                              
            STRING WS-SCHEME '-' WS-ACCOUNT '-' WS-CHK '-' WS-LESSEE            
                   DELIMITED BY SIZE INTO PRT-SCH-ACC-NO.                       
            MOVE K330-KEY-FLD    TO PRT-CURR-REGN-NO.                           
            MOVE K330-CUR-REG    TO PRT-ORIG-REGN-NO.                           
                                                                                
            MOVE COMM8-NUM-BLK       TO PRT-BLOCK.                              
            MOVE COMM8-NUM-LEVEL     TO WS-LEVEL.                               
            MOVE COMM8-NUM-UNIT-MAIN TO WS-MAIN-UNIT.                           
                                                                                
            IF   COMM8-NUM-UNIT-SUB = SPACES OR LOW-VALUES                      
                 MOVE SPACES             TO WS-SLASH1                           
                 MOVE SPACES             TO WS-SUB-UNIT                         
            ELSE                                                                
                 MOVE '-'                TO WS-SLASH1                           
                 MOVE COMM8-NUM-UNIT-SUB TO WS-SUB-UNIT.                        
                                                                                
            MOVE WS-UNIT-NO          TO PRT-HOUSE-NO.                           
                                                                                
            STRING K330-AGRORDER-DTE-DD '/' K330-AGRORDER-DTE-MM '/'            
                   K330-AGRORDER-DTE-CC                                         
                   K330-AGRORDER-DTE-YY DELIMITED BY SIZE INTO                  
                   PRT-DTE-AGMT-ORDER.                                          
                                                                                
            MOVE K110-DTE-KEY-AVAIL TO WS-ED-COMM-DATE.                         
            STRING WS-COMM-DD '/' WS-COMM-MM '/' WS-COMM-CCYY                   
                   DELIMITED BY SIZE INTO PRT-DTE-LAST-COMP.                    
                                                                                
            MOVE K330-DTE-DELIVERY-POSSN TO WS-ED-COMM-DATE.                    
            STRING WS-COMM-DD '/' WS-COMM-MM '/' WS-COMM-CCYY                   
                  DELIMITED BY SIZE INTO PRT-DTE-DEL-POSSN.                     
            WRITE PRINT-REC-2 FROM L322-DTL1 AFTER 2.                           
                                                                                
            MOVE SPACES                TO PRINT-REC-2.                          
            MOVE COMM8-NME-STREET      TO PRT-STREET.                           
            MOVE COMM8-NUM-POSTAL-CODE TO PRT-POSTAL-CODE.                      
            WRITE PRINT-REC-2 FROM L322-DTL2 AFTER 1.                           
            ADD 1 TO WS-REC-CNT2.                                               
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       800-KEY-NOT-AVAIL-HDG.                                                   
      *------------------------*                                                
           ADD 1 TO WS-PAGE1.                                                   
           MOVE WS-PAGE1 TO PRT-PAGE.                                           
           STRING WS-CURR-DD '/' WS-CURR-MM '/' WS-CURR-CC                      
                  WS-CURR-YY DELIMITED BY SIZE INTO                             
                  PRT-DATE.                                                     
           MOVE 'BP13L322A' TO PRT-ID.                                          
           MOVE '(KEY NOT AVAILABLE)' TO PRT-DESC.                              
                                                                                
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG1 AFTER PAGE.                         
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG2 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG3 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG4 AFTER 2.                            
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG5 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1 FROM L322-HDG6 AFTER 1.                            
           WRITE PRINT-REC-1 FROM L322-HDG7 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-1.                                          
           WRITE PRINT-REC-1.                                                   
           MOVE ZEROS  TO WS-REC-CNT1.                                          
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       810-KEY-AVAIL-HDG.                                                       
      *------------------------*                                                
           ADD 1 TO WS-PAGE2.                                                   
           MOVE WS-PAGE2 TO PRT-PAGE.                                           
           STRING WS-CURR-DD '/' WS-CURR-MM '/' WS-CURR-CC                      
                  WS-CURR-YY DELIMITED BY SIZE INTO                             
                  PRT-DATE.                                                     
           MOVE 'BP13L322B' TO PRT-ID.                                          
           MOVE '  (KEY AVALIABLE)  ' TO PRT-DESC.                              
                                                                                
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG1 AFTER PAGE.                         
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG2 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG3 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG4A AFTER 2.                           
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG5A AFTER 1.                           
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2 FROM L322-HDG6 AFTER 1.                            
           WRITE PRINT-REC-2 FROM L322-HDG7 AFTER 1.                            
           MOVE SPACES TO PRINT-REC-2.                                          
           WRITE PRINT-REC-2.                                                   
           MOVE ZEROS  TO WS-REC-CNT2.                                          
                                                                                
       810-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       999-CLOSE-ROUTINE.                                                       
      *------------------------*                                                
           DISPLAY '****** BP13C322 CONTROL TOTALS ******'.                     
           DISPLAY 'BP13K330 READ          = ' WS-READ-K330-CNT.                
           DISPLAY 'BP13K800 FOUND         = ' WS-READ-K800-CNT.                
           DISPLAY 'BM06K110 FOUND         = ' WS-READ-K110-CNT.                
           DISPLAY 'BB14K500 FOUND         = ' WS-READ-K500-CNT.                
           DISPLAY 'BP13K800 NOT FOUND     = ' WS-K800-NOTFND-CNT.              
           DISPLAY 'BM06K110 NOT FOUND     = ' WS-K110-NOTFND-CNT.              
           DISPLAY 'BB14K500 NOT FOUND     = ' WS-K500-NOTFND-CNT.              
           DISPLAY 'NO POSESSION DATE      = ' WS-NO-POSDATE-CNT.               
           DISPLAY 'DIFF > 60 DAYS         = ' WS-MORE60-CNT.                   
           DISPLAY 'DIFF NOT > 60 DAYS     = ' WS-NOT-MORE60-CNT.               
           DISPLAY 'KEY NOT AVAIL          = ' WS-KEY-NOT-AVAIL-CNT.            
           DISPLAY 'BP13L322A PRINTED      = ' WS-SEQ-CNT1.                     
      *    DISPLAY 'BP13L322B PRINTED      = ' WS-SEQ-CNT2.                     
                                                                                
           CLOSE BP13K330                                                       
                 BB14K500                                                       
                 BM06K110                                                       
                 BP13K800                                                       
                 P13L322A                                                       
                 P13L322B.                                                      
                                                                                
           IF K330-STATUS NOT = 0 AND 97                                        
            DISPLAY 'CLOSING ERROR, BP13K330-STATUS ' K330-STATUS.              
                                                                                
           IF K500-STATUS NOT = 0 AND 97                                        
            DISPLAY 'CLOSING ERROR, K500-STATUS ' K500-STATUS.                  
                                                                                
           IF K110-STATUS NOT = 0 AND 97                                        
            DISPLAY 'CLOSING ERROR, K110-STATUS ' K110-STATUS.                  
                                                                                
           IF K800-STATUS NOT = 0 AND 97                                        
            DISPLAY 'CLOSING ERROR, K800-STATUS ' K800-STATUS.                  
                                                                                
           STOP RUN.                                                            
                                                                                
       999-EXIT.                                                                
           EXIT.                                                                
