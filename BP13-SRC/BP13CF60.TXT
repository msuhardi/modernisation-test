      *===============================================================*         
       IDENTIFICATION DIVISION.                                                 
      *===============================================================*         
       PROGRAM-ID.    BP13CF60.                                                 
      *AUTHOR.        ZARITA DANE SARMIENTO.                                    
      *DATE-WRITTEN.  FEBRUARY 06, 2012.                                        
      *===============================================================*         
      *   OBJECTIVE:  PRINT EC   CASES WITH GRANT APPROVAL DATE AND   *         
      *               ENSURE ALL GRANT CASES ARE DEBARRED CORRECTLY.  *         
      *===============================================================*         
      *                                                               *         
      *     INPUT FILE :                                              *         
      *                  1. BP13FD07 - REPLACED WITH GRANT_ASMNT      *         
      *                  2. SY02F001                                  *         
      *                  3. BP13KD05 - REPLACED WITH GRANT_ASMNT_PERSON         
      *                  4. BP13K730                                  *         
      *                  5. P04K010                                   *         
      *                  6. BP13K022                                  *         
      *                  7. BP13K024                                  *         
      *                  8. BP13K425                                  *         
      *                                                               *         
      *     OUTPUT FILE: 1. P13LF60A   - WITH OUT DEBARMENT REC       *         
      *                  2. P13LF60B   - WITH DEBAR                   *         
      *                                                               *         
      *===============================================================*         
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              *         
      *---------------------------------------------------------------*         
      * BP13XXXX 06/02/2012 ZDD1 NEW PROGRAM - FOR EC                 *         
      * BP136562 13/12/2016 MRN1 REPLACE BP13FD07 WITH GRANT_ASMNT    *         
      *                          BP13KD05 WITH GRANT_ASMNT_PERSON     *         
      *===============================================================*         
                                                                                
                                                                                
      **********************                                                    
       ENVIRONMENT DIVISION.                                                    
      **********************                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT  SY02F001  ASSIGN        TO SY02F001.                         
           SELECT  BP13K730  ASSIGN        TO BP13K730                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K730-NUM-REGN                     
                             FILE STATUS   IS WS-K730-STATUS.                   
           SELECT  BP13K800  ASSIGN        TO BP13K800                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K800-NUM-REGN                     
                             FILE STATUS   IS WS-K800-STATUS.                   
           SELECT  P04K010   ASSIGN        TO P04K010                           
                             ACCESS MODE  IS DYNAMIC                            
                             ORGANIZATION IS INDEXED                            
                             RECORD KEY   IS K010-PRIME-KEY                     
                             FILE STATUS  IS WS-K010-STATUS.                    
           SELECT  BP13K022  ASSIGN       TO BP13K022                           
                             ACCESS MODE  IS RANDOM                             
                             ORGANIZATION IS INDEXED                            
                             RECORD KEY   IS K022-KEY-FLD                       
                             ALTERNATE RECORD KEY IS K022-NUM-REGN              
                             FILE STATUS  IS WS-K022-STATUS.                    
           SELECT  BP13K024  ASSIGN        TO BP13K024                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K024-KEY-FLD                      
                             FILE STATUS   IS WS-K024-STATUS.                   
           SELECT  BP13K425  ASSIGN        TO BP13K425                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K425-KEY-FLD                      
                             FILE STATUS   IS WS-K425-STATUS.                   
           SELECT  P13LF60A  ASSIGN        TO P13LF60A.                         
           SELECT  P13LF60B  ASSIGN        TO P13LF60B.                         
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13K730                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K730.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K024                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K024.                                                           
                                                                                
       FD   BP13K425                                                            
            RECORD CONTAINS 20 CHARACTERS.                                      
       COPY BP13K425.                                                           
                                                                                
       FD   P04K010                                                             
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY P04K010.                                                            
                                                                                
       FD   P13LF60A                                                            
            BLOCK  CONTAINS 0 RECORDS                                           
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORD IS OMITTED                                             
            RECORDING MODE IS F.                                                
       01   P13LF60A-REC               PIC X(132).                              
                                                                                
       FD   P13LF60B                                                            
            BLOCK  CONTAINS 0 RECORDS                                           
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORD IS OMITTED                                             
            RECORDING MODE IS F.                                                
       01   P13LF60B-REC               PIC X(132).                              
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                   WORKING-STORAGE AREA                         *        
      ******************************************************************        
       01  FILE-VARIABLES.                                                      
           05  WS-F001-EOF             PIC X(1)  VALUE 'N'.                     
               88 EOF-F001                       VALUE 'Y'.                     
           05  WS-EOF-K010             PIC X(1)  VALUE 'N'.                     
           05  WS-K730-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K010-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K022-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K024-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K425-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K800-STATUS          PIC 9(02) VALUE ZEROES.                  
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-ASMT-READ            PIC 9(7)  VALUE ZEROES.                  
           05  WS-ASMT-SPACE           PIC 9(7)  VALUE ZEROES.                  
           05  WS-ASMT-DATE            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K730-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K800-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-P04KCODE-NFND        PIC 9(7)  VALUE ZEROES.                  
           05  WS-P04KCODE-NFND-A      PIC 9(7)  VALUE ZEROES.                  
           05  WS-REGN-BYPASS          PIC 9(7)  VALUE ZEROES.                  
           05  WS-REGN-PROC-TOT        PIC 9(7)  VALUE ZEROES.                  
           05  WS-SNO                  PIC 9(7)  VALUE ZEROES.                  
           05  WS-LINE-CTR             PIC 9(2)  VALUE ZEROES.                  
           05  WS-PAGE-CTR             PIC 9(4)  VALUE ZEROES.                  
           05  WS-CNT-LF60-WRITE       PIC 9(7)  VALUE ZEROES.                  
           05  WS-CNT-P04K             PIC 9(7)  VALUE ZEROES.                  
           05  WS-CNT-WRITE            PIC 9(1)  VALUE 2.                       
           05  WS-MAX-LINE             PIC 9(2)  VALUE 55.                      
           05  WS-SNO-B                PIC 9(7)  VALUE ZEROES.                  
           05  WS-LINE-CTR-B           PIC 9(2)  VALUE ZEROES.                  
           05  WS-PAGE-CTR-B           PIC 9(4)  VALUE ZEROES.                  
           05  WS-CNT-LF60-WRITE-B     PIC 9(7)  VALUE ZEROES.                  
           05  WS-CNT-WRITE-B          PIC 9(1)  VALUE 2.                       
           05  WS-MAX-LINE-B           PIC 9(2)  VALUE 55.                      
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-SYSTEM-DATE           PIC 9(8)  VALUE ZEROES.                  
           05 WS-HA                    PIC X(1)  VALUE SPACE.                   
           05 WS-AHG-CODE              PIC X(2)  VALUE SPACES.                  
           05 WS-CPF-CODE              PIC X(2)  VALUE SPACES.                  
           05 WS-REGN-NO               PIC X(8)  VALUE SPACES.                  
           05 WS-REGN-NO-B             PIC X(8)  VALUE SPACES.                  
           05 WS-SNO-ZZZZ9             PIC ZZZZ9 VALUE ZEROES.                  
           05 WS-FIRST-WRITE           PIC X(1)  VALUE 'Y'.                     
           05 WS-FIRST-WRITE-B         PIC X(1)  VALUE 'Y'.                     
           05 WS-NUM-PROJECT           PIC X(3)  VALUE SPACES.                  
           05 WS-DTE-LAST-WK           PIC 9(08) VALUE ZEROES.                  
           05 WS-DTE-NUM               PIC 9(07) VALUE ZEROES.                  
           05 WS-DAYS                  PIC 9     VALUE ZERO.                    
           05 WS-P04K010-REC           PIC X(300) VALUE SPACES.                 
           05 WS-VALID-CPF             PIC X(1)  VALUE 'N'.                     
           05 WS-PROCESS               PIC X(1)  VALUE 'N'.                     
           05 WS-REGN-PROC             PIC X(1)  VALUE 'N'.                     
           05 WS-CTZN-HH               PIC X(3)  VALUE SPACES.                  
           05 WS-QUERY-NO              PIC X(02) VALUE SPACES.                  
           05 WS-END-CURSOR1           PIC X(01) VALUE 'N'.                     
           05 WS-END-CURSOR2           PIC X(01) VALUE 'N'.                     
                                                                                
       01  WS-DATE.                                                             
           05  WS-CCYY                 PIC X(04) VALUE SPACES.                  
           05  WS-MM                   PIC X(02) VALUE SPACES.                  
           05  WS-DD                   PIC X(02) VALUE SPACES.                  
                                                                                
       01  WS-DTE-APRV.                                                         
           05  WS-APRV-CCYY            PIC X(04) VALUE SPACES.                  
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  WS-APRV-MM              PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  WS-APRV-DD              PIC X(02) VALUE SPACES.                  
                                                                                
       01  WS-DTE-APPROVE              PIC X(08) VALUE SPACES.                  
                                                                                
       01  WS-DEBT-SERIAL              PIC 9(07) VALUE ZEROES.                  
       01  WS-DEBT-YEARS.                                                       
           05 WS-DEBT-CC               PIC X(2)  VALUE SPACES.                  
           05 WS-DEBT-YY               PIC X(2)  VALUE SPACES.                  
                                                                                
       01  WS-DEB-REF-NO.                                                       
           05 WS-DEBREF-AO             PIC X(2)  VALUE SPACES.                  
           05 WS-DEBREF-ID             PIC X(7)  VALUE SPACES.                  
           05 WS-DEBREF-YR             PIC X(4)  VALUE SPACES.                  
                                                                                
       01  WS-DEBAR-CODE               PIC X(02).                               
           88 VALID-CPF-CODE     VALUE 'SC' 'SP' 'CG' 'EJ'                      
                                       'CQ' 'SD' 'SE' 'SB'.                     
                                                                                
                                                                                
       01  LF60-HEADER01.                                                       
           05  FILLER              PIC X(8)      VALUE 'P13LF60A'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                  'S Y S T E M   O F   '.                       
           05  FILLER              PIC X(19) VALUE                              
                                  'C O M M I T M E N T'.                        
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE : '.               
           05  LF60-DATE-HDR       PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.               
           05  LF60-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.                  
                                                                                
       01  LF60-HEADER02.                                                       
           05  FILLER              PIC X(45)     VALUE SPACES.                  
           05  FILLER              PIC X(52)     VALUE                          
               'REPORT ON EC CASES WITH GRANT APPROVAL DATE'.                   
                                                                                
       01  LF60-HEADER01-B.                                                     
           05  FILLER              PIC X(8)      VALUE 'P13LF60B'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                  'S Y S T E M   O F   '.                       
           05  FILLER              PIC X(19) VALUE                              
                                  'C O M M I T M E N T'.                        
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE : '.               
           05  LF60-DATE-HDR-B     PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.               
           05  LF60-PAGE-HDR-B     PIC ZZZ9      VALUE ZEROES.                  
                                                                                
       01  LF60-HEADER02-B.                                                     
           05  FILLER              PIC X(45)     VALUE SPACES.                  
           05  FILLER              PIC X(55)     VALUE                          
              'REPORT ON EC CASES WITH GRANT APPROVAL DATE(W/O DEBAR)'.         
                                                                                
       01  LF60-HEADER03.                                                       
           05  LF60-NME-PRJCT      PIC X(08)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'REGN NO '.              
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(11)     VALUE 'DEBAR      '.           
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'GRNT'.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'P04K'.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(06)     VALUE 'CHG   '.                
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(27)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'NAME'.                  
           05  FILLER              PIC X(20)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'CTZ'.                   
                                                                                
       01  LF60-HEADER04.                                                       
           05  FILLER              PIC X(01)    VALUE SPACES.                   
           05  FILLER              PIC X(05)    VALUE '  S/N'.                  
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(11)    VALUE 'APPRV DATE'.             
           05  FILLER              PIC X(09)    VALUE 'NRIC NO  '.              
           05  FILLER              PIC X(01)    VALUE SPACES.                   
           05  FILLER              PIC X(11)    VALUE 'REFERENCE  '.            
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(04)    VALUE 'TYPE'.                   
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(04)    VALUE 'CODE'.                   
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(06)    VALUE 'AMOUNT'.                 
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(06)    VALUE 'AMOUNT'.                 
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(22)                                    
                                       VALUE 'BLK/HSE NO/POSTAL CODE'.          
           05  FILLER              PIC X(07)    VALUE SPACES.                   
           05  FILLER              PIC X(03)    VALUE 'CSM'.                    
           05  FILLER              PIC X(21)    VALUE SPACES.                   
           05  FILLER              PIC X(03)    VALUE 'HH '.                    
                                                                                
       01  LF60-DETAIL01.                                                       
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LF60-SN             PIC X(05)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-REGN           PIC X(08)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-NRIC           PIC X(09)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-DEB-REF-NO     PIC X(11)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-GRNT-TYP       PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-P04-CODE       PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-HG-AMT         PIC ZZ,ZZ9       VALUE ZEROES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-AHG-AMT        PIC ZZ,ZZ9       VALUE ZEROES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-ADDRESS        PIC X(27)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-CSM            PIC X(22)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-CTZ-HH         PIC X(03)        VALUE SPACES.               
                                                                                
       01  LF60-DETAIL02.                                                       
           05  FILLER              PIC X(08)        VALUE SPACES.               
           05  LF60-APPRV-DTE-2    PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(24)        VALUE SPACES.               
           05  LF60-GRNT-TYP-2     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LF60-P04-CODE-2     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(18)        VALUE SPACES.               
           05  LF60-ADDRESS-2      PIC X(27)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
      *    05  LF60-CSM            PIC X(22)        VALUE SPACES.               
                                                                                
       COPY AV02COMM.                                                           
                                                                                
       01  WS-SQL-STATUS.                                                       
           05 WS-SQL-OK                PIC S9(03) VALUE +000.                   
           05 WS-SQL-NFND              PIC S9(03) VALUE +100.                   
           05 WS-SQL-DUPREC            PIC S9(03) VALUE -803.                   
                                                                                
      *--------------------------------------------------------------*          
      *                          SQLCA                               *          
      *--------------------------------------------------------------*          
           EXEC SQL INCLUDE SQLCA          END-EXEC.                            
           EXEC SQL INCLUDE P13VGASM       END-EXEC.                            
           EXEC SQL INCLUDE P13VGAPN       END-EXEC.                            
                                                                                
      *===============================================================          
      *     CURSOR TO EXTRACT GRANT_ASMNT                                       
      *===============================================================          
           EXEC SQL                                                             
              DECLARE CURSOR1 CURSOR WITH HOLD FOR                              
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      NUM_ELGBL_GRANT,                                          
                      NUM_GRANT_AMOUNT_ELGBL,                                   
                      NUM_GRANT_STATUS,                                         
                      DTE_APRV,                                                 
                      DTE_CANCEL,                                               
                      DTE_REJECT,                                               
                      DTE_SUBMIT,                                               
                      DTE_WTHDRW,                                               
                      NUM_RJCTN_REASON,                                         
                      NUM_WTDRWL_REASON,                                        
                      TXT_CNCLTN_REASON,                                        
                      DTE_GRANT_RQST,                                           
                      NUM_GRANT_DOC_RCV,                                        
                      DTE_ACK,                                                  
                      DTE_GRANT_FORM_ISSUE,                                     
                      DTE_GRANT_OPT_OUT_FORM_ISSUE,                             
                      NUM_GRANT_OPT_OUT_REASON,                                 
                      DTE_GRANT_OPT_OUT_REASON,                                 
                      NUM_ALCTN_SCHEME,                                         
                      NUM_HSHLD_CTZNSP,                                         
                      NUM_WRKNG_CHILD_ASMNT,                                    
                      QTY_MONTH_WORK,                                           
                      NUM_APPEAL_ATCHMT,                                        
                      NUM_PARENT_ADRS_BLDNG,                                    
                      NUM_PARENT_ADRS_LEVEL,                                    
                      NUM_PARENT_ADRS_UNIT,                                     
                      TXT_PARENT_ADRS1,                                         
                      TXT_PARENT_ADRS2,                                         
                      NUM_PARENT_ADRS_POSTAL,                                   
                      DTE_PYMNT,                                                
                      DTE_CPF_ACK_GRANT_RCV,                                    
                      NUM_GRANT_CREDIT,                                         
                      TME_APNTMT,                                               
                      DTE_APNTMT,                                               
                      TME_CREATE_ASMNT,                                         
                      NUM_UPDATE_USERID,                                        
                      TME_UPDATE,                                               
                      DTE_UPDATE,                                               
                      NUM_SOURCE_SYSTEM,                                        
                      NUM_ACNT,                                                 
                      NUM_SCHEME,                                               
                      NUM_TNCY,                                                 
                      NUM_HALF_GRANT                                            
                FROM  GRANT_ASMNT                                               
                WHERE                                                           
                  NUM_RGSTRN > '60000000' AND                                   
                  NUM_RGSTRN < '70000000' AND                                   
                  NUM_GRANT_STATUS = 'A'                                        
           END-EXEC.                                                            
                                                                                
      *===============================================================          
      *     CURSOR TO EXTRACT GRANT_ASMNT_PERSON                                
      *===============================================================          
           EXEC SQL                                                             
              DECLARE CURSOR2 CURSOR WITH HOLD FOR                              
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      NUM_IDNTY_NO,                                             
                      NUM_IDNTY_NO_TYPE,                                        
                      NUM_CSTMR_SOURCE,                                         
                      NUM_CPF_ACNT,                                             
                      AMT_GRANT,                                                
                      AMT_GRANT_USE,                                            
                      NUM_ROLE_TAG,                                             
                      NUM_RLTNSP,                                               
                      NME_PERSON,                                               
                      NUM_GENDER,                                               
                      NUM_CTZNSP,                                               
                      NUM_MRTL_STATUS,                                          
                      AMT_INCOME,                                               
                      NUM_1YR_CNTNS_EMPLY,                                      
                      NUM_DEBAR,                                                
                      NUM_DEBAR_REASON,                                         
                      NUM_RCVRY,                                                
                      NUM_UPDATE_USERID,                                        
                      DTE_UPDATE,                                               
                      TME_UPDATE,                                               
                      AMT_GRANT_THRSHD                                          
                FROM  GRANT_ASMNT_PERSON                                        
                WHERE                                                           
                  NUM_RGSTRN = :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN AND            
                  NUM_GRANT_TYPE = :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE        
                ORDER BY NUM_IDNTY_NO                                           
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *                   P R O G R A M     B O D Y                    *        
      ******************************************************************        
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      ******************************************************************        
       0000-MAIN.                                                               
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                      
           PERFORM 2000-PROCESS-GRANT-ASMNT THRU 2000-EXIT.                     
           PERFORM 9000-CLOSE-ROUTINE      THRU  9000-EXIT.                     
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           OPEN INPUT  SY02F001                                                 
                       P04K010                                                  
                       BP13K730                                                 
                       BP13K800                                                 
                       BP13K022                                                 
                       BP13K024                                                 
                       BP13K425                                                 
              OUTPUT   P13LF60A                                                 
                       P13LF60B.                                                
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K730 - ERROR OPENING : ' WS-K730-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR OPENING : ' WS-K800-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'P04K010  - ERROR OPENING : ' WS-K010-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 - ERROR OPENING : ' WS-K022-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K024-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K024 - ERROR OPENING : ' WS-K024-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K425-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K425 - ERROR OPENING : ' WS-K425-STATUS              
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           READ SY02F001 AT END MOVE 'Y'  TO WS-F001-EOF.                       
           IF EOF-F001                                                          
              DISPLAY 'RECORD NOT FOUND IN SY01F001 '                           
              DISPLAY 'PROCESSING TERMINATED '                                  
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           ELSE                                                                 
              MOVE F001-DTE-CURRENT      TO   WS-SYSTEM-DATE                    
           END-IF.                                                              
                                                                                
           PERFORM 1100-CHECK-DATE      THRU 1100-EXIT.                         
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1100-CHECK-DATE.                                                         
      ******************************************************************        
                                                                                
           MOVE WS-SYSTEM-DATE                    TO WS-DTE-LAST-WK.            
                                                                                
           COMPUTE WS-DAYS = 0.                                                 
           PERFORM UNTIL WS-DAYS = 7                                            
                   COMPUTE WS-DTE-NUM =                                         
                           FUNCTION INTEGER-OF-DATE (WS-DTE-LAST-WK)            
                   COMPUTE WS-DTE-NUM = WS-DTE-NUM - 1                          
                   COMPUTE WS-DTE-LAST-WK =                                     
                           FUNCTION DATE-OF-INTEGER (WS-DTE-NUM)                
                                                                                
                   MOVE WS-DTE-LAST-WK            TO WS-IN-DATE                 
                   PERFORM 1200-VALIDATE-DATE   THRU 1200-EXIT                  
                                                                                
           END-PERFORM.                                                         
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1200-VALIDATE-DATE.                                                      
      ******************************************************************        
                                                                                
           MOVE 'DW'                   TO WS-IN-OPTION.                         
           MOVE '000'                  TO WS-RETURN.                            
                                                                                
           CALL 'AV02C001'          USING LINK-REC.                             
                                                                                
           IF WS-RETURN = 'SUN' OR 'MON' OR 'TUE' OR 'WED' OR                   
                          'THU' OR 'FRI' OR 'SAT'                               
              ADD 1                                    TO WS-DAYS               
           END-IF.                                                              
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ***************************************************************           
       2000-PROCESS-GRANT-ASMNT.                                                
      ***************************************************************           
                                                                                
           PERFORM 2100-OPEN-CURSOR1  THRU 2100-EXIT.                           
           MOVE 'N'                   TO WS-END-CURSOR1.                        
           PERFORM 2200-FETCH-CURSOR1 THRU 2200-EXIT                            
                   UNTIL WS-END-CURSOR1 = 'Y'                                   
           PERFORM 2300-CLOSE-CURSOR1 THRU 2300-EXIT.                           
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       2100-OPEN-CURSOR1.                                                       
      ***************************************************************           
                                                                                
           MOVE '1A'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                OPEN CURSOR1                                                    
           END-EXEC.                                                            
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                CONTINUE                                                        
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       2200-FETCH-CURSOR1.                                                      
      ***************************************************************           
                                                                                
           MOVE SPACES         TO WS-QUERY-NO                                   
                                                                                
           MOVE '1B'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                FETCH CURSOR1                                                   
                INTO  :DCLGRANT-ASMNT.NUM-RGSTRN,                               
                      :DCLGRANT-ASMNT.NUM-GRANT-TYPE,                           
                      :DCLGRANT-ASMNT.NUM-ELGBL-GRANT,                          
                      :DCLGRANT-ASMNT.NUM-GRANT-AMOUNT-ELGBL,                   
                      :DCLGRANT-ASMNT.NUM-GRANT-STATUS,                         
                      :DCLGRANT-ASMNT.DTE-APRV,                                 
                      :DCLGRANT-ASMNT.DTE-CANCEL,                               
                      :DCLGRANT-ASMNT.DTE-REJECT,                               
                      :DCLGRANT-ASMNT.DTE-SUBMIT,                               
                      :DCLGRANT-ASMNT.DTE-WTHDRW,                               
                      :DCLGRANT-ASMNT.NUM-RJCTN-REASON,                         
                      :DCLGRANT-ASMNT.NUM-WTDRWL-REASON,                        
                      :DCLGRANT-ASMNT.TXT-CNCLTN-REASON,                        
                      :DCLGRANT-ASMNT.DTE-GRANT-RQST,                           
                      :DCLGRANT-ASMNT.NUM-GRANT-DOC-RCV,                        
                      :DCLGRANT-ASMNT.DTE-ACK,                                  
                      :DCLGRANT-ASMNT.DTE-GRANT-FORM-ISSUE,                     
                      :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-FORM-ISSUE,             
                      :DCLGRANT-ASMNT.NUM-GRANT-OPT-OUT-REASON,                 
                      :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-REASON,                 
                      :DCLGRANT-ASMNT.NUM-ALCTN-SCHEME,                         
                      :DCLGRANT-ASMNT.NUM-HSHLD-CTZNSP,                         
                      :DCLGRANT-ASMNT.NUM-WRKNG-CHILD-ASMNT,                    
                      :DCLGRANT-ASMNT.QTY-MONTH-WORK,                           
                      :DCLGRANT-ASMNT.NUM-APPEAL-ATCHMT,                        
                      :DCLGRANT-ASMNT.NUM-PARENT-ADRS-BLDNG,                    
                      :DCLGRANT-ASMNT.NUM-PARENT-ADRS-LEVEL,                    
                      :DCLGRANT-ASMNT.NUM-PARENT-ADRS-UNIT,                     
                      :DCLGRANT-ASMNT.TXT-PARENT-ADRS1,                         
                      :DCLGRANT-ASMNT.TXT-PARENT-ADRS2,                         
                      :DCLGRANT-ASMNT.NUM-PARENT-ADRS-POSTAL,                   
                      :DCLGRANT-ASMNT.DTE-PYMNT,                                
                      :DCLGRANT-ASMNT.DTE-CPF-ACK-GRANT-RCV,                    
                      :DCLGRANT-ASMNT.NUM-GRANT-CREDIT,                         
                      :DCLGRANT-ASMNT.TME-APNTMT,                               
                      :DCLGRANT-ASMNT.DTE-APNTMT,                               
                      :DCLGRANT-ASMNT.TME-CREATE-ASMNT,                         
                      :DCLGRANT-ASMNT.NUM-UPDATE-USERID,                        
                      :DCLGRANT-ASMNT.TME-UPDATE,                               
                      :DCLGRANT-ASMNT.DTE-UPDATE,                               
                      :DCLGRANT-ASMNT.NUM-SOURCE-SYSTEM,                        
                      :DCLGRANT-ASMNT.NUM-ACNT,                                 
                      :DCLGRANT-ASMNT.NUM-SCHEME,                               
                      :DCLGRANT-ASMNT.NUM-TNCY,                                 
                      :DCLGRANT-ASMNT.NUM-HALF-GRANT                            
           END-EXEC                                                             
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                MOVE 'N' TO WS-REGN-PROC                                        
                MOVE DTE-APRV OF DCLGRANT-ASMNT TO WS-DTE-APRV                  
                MOVE WS-APRV-CCYY TO WS-DTE-APPROVE(1:4)                        
                MOVE WS-APRV-MM   TO WS-DTE-APPROVE(5:2)                        
                MOVE WS-APRV-DD   TO WS-DTE-APPROVE(7:2)                        
                PERFORM 3000-PROCESS-RECORDS THRU 3000-EXIT                     
           WHEN 100                                                             
                MOVE 'Y'  TO WS-END-CURSOR1                                     
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       2300-CLOSE-CURSOR1.                                                      
      ***************************************************************           
                                                                                
           MOVE '1C'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                CLOSE CURSOR1                                                   
           END-EXEC.                                                            
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                CONTINUE                                                        
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       2300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           IF NUM-RGSTRN OF DCLGRANT-ASMNT > SPACES                             
               IF DTE-APRV OF DCLGRANT-ASMNT NOT = '0001-01-01'                 
                 IF (WS-DTE-APPROVE >= WS-DTE-LAST-WK) AND                      
                    (WS-DTE-APPROVE <= WS-SYSTEM-DATE)                          
                     PERFORM 3200-READ-BP13K730    THRU 3200-EXIT               
                  ELSE                                                          
                     ADD 1                           TO WS-ASMT-DATE            
                  END-IF                                                        
               ELSE                                                             
                  ADD 1                              TO WS-ASMT-SPACE           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF WS-REGN-PROC = 'N'                                                
              ADD 1 TO    WS-REGN-BYPASS                                        
              DISPLAY 'REGN NOT PRINTED ON THE REPORT - '                       
                                       NUM-RGSTRN OF DCLGRANT-ASMNT             
           ELSE                                                                 
              ADD 1 TO WS-REGN-PROC-TOT                                         
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       3200-READ-BP13K730.                                                      
      ******************************************************************        
                                                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT TO K730-NUM-REGN.                  
                                                                                
           READ BP13K730.                                                       
                                                                                
           EVALUATE WS-K730-STATUS                                              
               WHEN 00                                                          
                    MOVE K730-CDE-CITIZENSHIP-HOUSEHOLD TO                      
                                      WS-CTZN-HH                                
                    PERFORM 4000-PROCESS-PERSON   THRU 4000-EXIT                
               WHEN 23                                                          
                    PERFORM 3410-READ-BP13K800    THRU 3410-EXIT                
                    ADD 1                           TO WS-K730-NFND             
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K730 : ' WS-K730-STATUS          
                            ' REGN = ' K730-NUM-REGN                            
                    PERFORM  9000-CLOSE-ROUTINE   THRU 9000-EXIT                
           END-EVALUATE.                                                        
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       3410-READ-BP13K800.                                                      
      ******************************************************************        
                                                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT TO K800-NUM-REGN                   
           READ BP13K800                                                        
                                                                                
           EVALUATE WS-K800-STATUS                                              
               WHEN 00                                                          
                    PERFORM 4000-PROCESS-PERSON   THRU 4000-EXIT                
                    MOVE K800-CDE-CITIZENSHIP-HOUSEHOLD                         
                                                  TO WS-CTZN-HH                 
               WHEN 23                                                          
                    ADD 1                           TO WS-K730-NFND             
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K800 : ' WS-K800-STATUS          
                            ' REG NUM     = ' K800-NUM-REGN                     
                    PERFORM  9000-CLOSE-ROUTINE    THRU 9000-EXIT               
           END-EVALUATE.                                                        
                                                                                
                                                                                
       3410-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       4000-PROCESS-PERSON.                                                     
      ***************************************************************           
                                                                                
           PERFORM 4200-OPEN-CURSOR2  THRU 4200-EXIT.                           
           MOVE 'N'                   TO WS-END-CURSOR2.                        
           PERFORM 4300-FETCH-CURSOR2 THRU 4300-EXIT                            
                   UNTIL WS-END-CURSOR2 = 'Y'                                   
           PERFORM 4500-CLOSE-CURSOR2 THRU 4500-EXIT.                           
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       4200-OPEN-CURSOR2.                                                       
      ***************************************************************           
                                                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT                                    
                      TO NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON.                   
           MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT                                
                      TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON.               
                                                                                
           MOVE '2A'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                OPEN CURSOR2                                                    
           END-EXEC.                                                            
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                CONTINUE                                                        
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       4300-FETCH-CURSOR2.                                                      
      ***************************************************************           
                                                                                
           MOVE SPACES         TO WS-QUERY-NO                                   
                                                                                
           MOVE '2B'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                FETCH CURSOR2                                                   
                INTO  :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN,                        
                      :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE,                    
                      :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO,                      
                      :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO-TYPE,                 
                      :DCLGRANT-ASMNT-PERSON.NUM-CSTMR-SOURCE,                  
                      :DCLGRANT-ASMNT-PERSON.NUM-CPF-ACNT,                      
                      :DCLGRANT-ASMNT-PERSON.AMT-GRANT,                         
                      :DCLGRANT-ASMNT-PERSON.AMT-GRANT-USE,                     
                      :DCLGRANT-ASMNT-PERSON.NUM-ROLE-TAG,                      
                      :DCLGRANT-ASMNT-PERSON.NUM-RLTNSP,                        
                      :DCLGRANT-ASMNT-PERSON.NME-PERSON,                        
                      :DCLGRANT-ASMNT-PERSON.NUM-GENDER,                        
                      :DCLGRANT-ASMNT-PERSON.NUM-CTZNSP,                        
                      :DCLGRANT-ASMNT-PERSON.NUM-MRTL-STATUS,                   
                      :DCLGRANT-ASMNT-PERSON.AMT-INCOME,                        
                      :DCLGRANT-ASMNT-PERSON.NUM-1YR-CNTNS-EMPLY,               
                      :DCLGRANT-ASMNT-PERSON.NUM-DEBAR,                         
                      :DCLGRANT-ASMNT-PERSON.NUM-DEBAR-REASON,                  
                      :DCLGRANT-ASMNT-PERSON.NUM-RCVRY,                         
                      :DCLGRANT-ASMNT-PERSON.NUM-UPDATE-USERID,                 
                      :DCLGRANT-ASMNT-PERSON.DTE-UPDATE,                        
                      :DCLGRANT-ASMNT-PERSON.TME-UPDATE,                        
                      :DCLGRANT-ASMNT-PERSON.AMT-GRANT-THRSHD                   
           END-EXEC                                                             
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
      ********* IF KD05-NUM-AHG-DEBAR = 'Y' OR KD05-NUM-CHG-DEBAR = 'Y'         
                IF NUM-DEBAR OF DCLGRANT-ASMNT-PERSON = 'Y'                     
                   PERFORM 4600-DETERMINE-CPF-CODE THRU 4600-EXIT               
                END-IF                                                          
                PERFORM 4700-START-P04K010            THRU 4700-EXIT            
           WHEN 100                                                             
                MOVE 'Y'  TO WS-END-CURSOR2                                     
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       4500-CLOSE-CURSOR2.                                                      
      ***************************************************************           
                                                                                
           MOVE '2C'           TO WS-QUERY-NO                                   
           EXEC SQL                                                             
                CLOSE CURSOR2                                                   
           END-EXEC.                                                            
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                CONTINUE                                                        
           WHEN OTHER                                                           
                PERFORM 9999-DB2-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4600-DETERMINE-CPF-CODE.                                                 
      ******************************************************************        
                                                                                
           IF AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT NUMERIC                    
              MOVE ZEROES TO AMT-GRANT OF DCLGRANT-ASMNT-PERSON                 
           END-IF.                                                              
                                                                                
           IF NUM-ROLE-TAG OF DCLGRANT-ASMNT-PERSON  = '5' OR '6'               
              MOVE '71'   TO WS-CPF-CODE                                        
           ELSE                                                                 
           IF NUM-RLTNSP OF DCLGRANT-ASMNT-PERSON  = '20'                       
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F' AND                
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F' AND                
               (NUM-CTZNSP OF DCLGRANT-ASMNT-PERSON = '20' OR 'SP') AND         
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0                     
                     MOVE 'GI' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M') AND              
               (NUM-CTZNSP OF DCLGRANT-ASMNT-PERSON = '20' OR 'SP') AND         
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0                     
                     MOVE 'GJ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M')              
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')                  
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')              
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F'                    
                     AND AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0                 
                     MOVE 'GK' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0   AND               
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M')                  
                     MOVE 'GL' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'T'                    
                     MOVE 'GM' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'L' OR 'K'             
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           ELSE                                                                 
           IF NUM-RLTNSP OF DCLGRANT-ASMNT-PERSON = '09'                        
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F' AND                
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M')              
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')                  
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')              
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F' AND                
                (NUM-CTZNSP OF DCLGRANT-ASMNT-PERSON = '20' OR 'SP') AND        
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0                     
                     MOVE 'GI' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M') AND              
                (NUM-CTZNSP OF DCLGRANT-ASMNT-PERSON = '20' OR 'SP') AND        
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0                     
                     MOVE 'GJ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON = 0 AND                 
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M')                  
                     MOVE 'GL' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'L' OR 'K'             
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           ELSE                                                                 
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'M')              
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')                  
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     AND (NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'H')              
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'F' AND                
                     AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT = 0                 
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'S'                    
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'T'                    
                     MOVE 'GG' TO WS-CPF-CODE                                   
                                                                                
                WHEN NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'L' OR 'K'             
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       4610-CHECK-DEBAR-HHG.                                                    
      ******************************************************************        
                                                                                
           IF NUM-RLTNSP OF DCLGRANT-ASMNT-PERSON = '00' OR '20' OR '09'        
              IF NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'L'                        
                 IF AMT-GRANT OF DCLGRANT-ASMNT-PERSON > 0                      
                    MOVE 'GQ'    TO WS-CPF-CODE                                 
                 ELSE                                                           
                    IF WS-HA = 'Y'                                              
                       MOVE 'GS' TO WS-CPF-CODE                                 
                    ELSE                                                        
                       MOVE 'GU' TO WS-CPF-CODE                                 
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
                                                                                
              IF NUM-ELGBL-GRANT OF DCLGRANT-ASMNT = 'K'                        
                 IF AMT-GRANT OF DCLGRANT-ASMNT-PERSON > 0                      
                    MOVE 'GQ'    TO WS-CPF-CODE                                 
                 ELSE                                                           
                    IF WS-HA = 'Y'                                              
                       MOVE 'GT' TO WS-CPF-CODE                                 
                    ELSE                                                        
                       MOVE 'GV' TO WS-CPF-CODE                                 
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4610-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4700-START-P04K010.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                              TO P04K010-REC.             
           INITIALIZE                                  P04K010-REC.             
           MOVE 0                         TO WS-CNT-P04K                        
                                             WS-P04KCODE-NFND                   
                                                                                
           MOVE 'N'                                 TO WS-EOF-K010.             
           MOVE 'N'                                 TO WS-VALID-CPF.            
           MOVE 'N'                                 TO WS-PROCESS.              
           MOVE SPACES                              TO WS-DEBAR-CODE.           
           MOVE NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON                           
                                                    TO K010-NUM-UINFIN.         
           START P04K010  KEY = K010-NUM-UINFIN.                                
                                                                                
           EVALUATE WS-K010-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 4800-READNEXT-P04K010  THRU 4800-EXIT               
                    PERFORM 4900-PROCESS-P04K010   THRU 4900-EXIT               
                            UNTIL WS-EOF-K010 = 'Y'                             
                    MOVE 'Y'  TO WS-REGN-PROC                                   
               WHEN 20                                                          
               WHEN 23                                                          
                    ADD 1                      TO WS-P04KCODE-NFND-A            
                    MOVE SPACES                    TO K010-REASON-CODE          
                    PERFORM 5001-GET-FIELDS-1      THRU 5001-EXIT               
                    PERFORM 6001-PRINT-REPORT-1 THRU 6001-EXIT                  
               WHEN OTHER                                                       
                    DISPLAY 'START ERROR P04K010 : ' WS-K010-STATUS             
                            ' NRIC : ' K010-NUM-UINFIN                          
                    PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT               
            END-EVALUATE.                                                       
                                                                                
       4700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       4800-READNEXT-P04K010.                                                   
      ******************************************************************        
                                                                                
           READ P04K010 NEXT RECORD                                             
                         AT END MOVE 'Y' TO WS-EOF-K010.                        
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4900-PROCESS-P04K010.                                                    
      ******************************************************************        
                                                                                
           IF (K010-NUM-UINFIN = NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON)         
               MOVE K010-REASON-CODE          TO WS-DEBAR-CODE                  
                                                                                
               IF  VALID-CPF-CODE                                               
                   ADD 1                      TO WS-CNT-P04K                    
                   PERFORM 5000-GET-FIELDS    THRU 5000-EXIT                    
                   MOVE 'Y' TO WS-VALID-CPF                                     
                   MOVE 'Y' TO WS-PROCESS                                       
               ELSE                                                             
                 IF WS-VALID-CPF = 'N'                                          
                   ADD 1                      TO WS-P04KCODE-NFND               
                   ADD 1                      TO WS-P04KCODE-NFND-A             
                   MOVE P04K010-REC   TO WS-P04K010-REC                         
                 END-IF                                                         
               END-IF                                                           
                   PERFORM 4800-READNEXT-P04K010  THRU 4800-EXIT                
                                                                                
           ELSE                                                                 
               IF WS-P04KCODE-NFND >= 1 AND WS-PROCESS = 'N'                    
                 PERFORM 5001-GET-FIELDS-1  THRU 5001-EXIT                      
                 PERFORM 6001-PRINT-REPORT-1 THRU 6001-EXIT                     
               END-IF                                                           
                                                                                
               MOVE 0                         TO WS-CNT-P04K                    
                                                 WS-P04KCODE-NFND               
               MOVE 'Y' TO WS-EOF-K010                                          
           END-IF.                                                              
                                                                                
                                                                                
       4900-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5000-GET-FIELDS.                                                         
      ******************************************************************        
                                                                                
           MOVE SPACES                                TO LF60-DETAIL01          
                                                         LF60-DETAIL02.         
           INITIALIZE                                    LF60-DETAIL01          
                                                         LF60-DETAIL02.         
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO LF60-DATE-HDR.                             
                                                                                
                                                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT   TO LF60-REGN.                    
           MOVE NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON TO LF60-NRIC.             
                                                                                
      **** IF KD05-AMT-AHG-GRANT NOT NUMERIC                                    
      ****    MOVE ZEROES                      TO KD05-AMT-AHG-GRANT            
      **** END-IF.                                                              
      **** MOVE KD05-AMT-AHG-GRANT             TO LF60-AHG-AMT.                 
           MOVE ZEROES                         TO LF60-AHG-AMT.                 
                                                                                
           IF AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT NUMERIC                    
              MOVE ZEROES       TO AMT-GRANT OF DCLGRANT-ASMNT-PERSON           
           END-IF.                                                              
           MOVE AMT-GRANT OF DCLGRANT-ASMNT-PERSON TO LF60-HG-AMT.              
                                                                                
           MOVE NUM-ELGBL-GRANT OF DCLGRANT-ASMNT TO LF60-GRNT-TYP.             
           MOVE WS-DEBAR-CODE                  TO LF60-P04-CODE.                
           MOVE K730-CDE-CITIZENSHIP-HOUSEHOLD TO LF60-CTZ-HH.                  
                                                                                
           STRING K010-BLOCK ' #'                                               
                  K010-HOUSE-NO 'S('                                            
                  K010-POSTCODE ')'                                             
              DELIMITED BY SIZE INTO LF60-ADDRESS.                              
                                                                                
           IF WS-CNT-P04K > 1                                                   
              MOVE LF60-P04-CODE               TO LF60-P04-CODE-2               
              MOVE LF60-ADDRESS                TO LF60-ADDRESS-2                
           END-IF.                                                              
                                                                                
           PERFORM 6000-PRINT-REPORT         THRU 6000-EXIT.                    
                                                                                
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5001-GET-FIELDS-1.                                                       
      ******************************************************************        
                                                                                
           MOVE SPACES                                TO LF60-DETAIL01          
                                                         LF60-DETAIL02.         
           INITIALIZE                                    LF60-DETAIL01          
                                                         LF60-DETAIL02.         
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO LF60-DATE-HDR.                             
                                                                                
                                                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT   TO LF60-REGN.                    
           MOVE NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON TO LF60-NRIC.             
                                                                                
      **** IF KD05-AMT-AHG-GRANT NOT NUMERIC                                    
      ****    MOVE ZEROES                      TO KD05-AMT-AHG-GRANT            
      **** END-IF.                                                              
      **** MOVE KD05-AMT-AHG-GRANT             TO LF60-AHG-AMT.                 
           MOVE ZEROES                         TO LF60-AHG-AMT.                 
                                                                                
           IF AMT-GRANT OF DCLGRANT-ASMNT-PERSON NOT NUMERIC                    
              MOVE ZEROES       TO AMT-GRANT OF DCLGRANT-ASMNT-PERSON           
           END-IF.                                                              
           MOVE AMT-GRANT OF DCLGRANT-ASMNT-PERSON TO LF60-HG-AMT.              
                                                                                
           MOVE NUM-ELGBL-GRANT OF DCLGRANT-ASMNT TO LF60-GRNT-TYP.             
           MOVE WS-DEBAR-CODE                  TO LF60-P04-CODE.                
           MOVE WS-CTZN-HH                     TO LF60-CTZ-HH.                  
                                                                                
           STRING K010-BLOCK ' #'                                               
                  K010-HOUSE-NO 'S('                                            
                  K010-POSTCODE ')'                                             
              DELIMITED BY SIZE INTO LF60-ADDRESS.                              
                                                                                
           IF WS-P04KCODE-NFND > 1                                              
              MOVE LF60-P04-CODE               TO LF60-P04-CODE-2               
              MOVE LF60-ADDRESS                TO LF60-ADDRESS-2                
           END-IF.                                                              
                                                                                
                                                                                
       5001-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5200-GET-CSM-NAME.                                                       
      ******************************************************************        
                                                                                
            MOVE SPACES                                TO BP13K022-REC.         
            INITIALIZE                                    BP13K022-REC.         
                                                                                
            MOVE NUM-RGSTRN OF DCLGRANT-ASMNT TO K022-NUM-REGN.                 
                                                                                
            READ BP13K022 KEY IS K022-NUM-REGN.                                 
                                                                                
            EVALUATE WS-K022-STATUS                                             
                WHEN 00                                                         
                     PERFORM 5400-READ-BP13K024       THRU 5400-EXIT            
                WHEN 23                                                         
                     MOVE SPACES                        TO LF60-CSM             
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP13K022 : ' WS-K022-STATUS         
                             ' REGN NO = ' K022-NUM-REGN                        
                     PERFORM  9000-CLOSE-ROUTINE      THRU 9000-EXIT            
            END-EVALUATE.                                                       
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5300-GET-DEBAR-REF-NO.                                                   
      ******************************************************************        
                                                                                
           MOVE 'SL'                               TO K425-CDE-DEPT.            
                                                                                
           READ BP13K425.                                                       
                                                                                
           EVALUATE WS-K425-STATUS                                              
               WHEN 00                                                          
                    PERFORM 5500-PROCESS-DEB-REF THRU 5500-EXIT                 
               WHEN 23                                                          
                    MOVE SPACES                    TO LF60-DEB-REF-NO           
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K425: ' WS-K425-STATUS           
                            ' CODE = ' K425-CDE-DEPT                            
                    PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                 
           END-EVALUATE.                                                        
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5400-READ-BP13K024.                                                      
      ******************************************************************        
                                                                                
            MOVE SPACES                                TO BP13K024-REC.         
            INITIALIZE                                    BP13K024-REC.         
                                                                                
            MOVE K022-NUM-OIC                          TO K024-NUM-OIC.         
                                                                                
            READ BP13K024.                                                      
                                                                                
            EVALUATE WS-K024-STATUS                                             
                WHEN 00                                                         
                     MOVE K024-NME-OIC                 TO LF60-CSM              
                WHEN 23                                                         
                     MOVE SPACES                       TO LF60-CSM              
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP13K024 : ' WS-K024-STATUS         
                             ' OIC  = ' K024-NUM-OIC                            
                     PERFORM  9000-CLOSE-ROUTINE     THRU 9000-EXIT             
            END-EVALUATE.                                                       
                                                                                
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5500-PROCESS-DEB-REF.                                                    
      ******************************************************************        
                                                                                
            MOVE WS-DTE-APPROVE          TO WS-DATE.                            
            MOVE K425-NUM-CC             TO WS-DEBT-CC.                         
            MOVE K425-NUM-YEAR           TO WS-DEBT-YY.                         
                                                                                
            IF WS-CCYY NOT = WS-DEBT-YEARS                                      
               MOVE ZEROES               TO K425-NUM-SERIAL                     
               COMPUTE WS-DEBT-SERIAL  = K425-NUM-SERIAL + 1                    
               MOVE WS-CCYY              TO WS-DEBT-YEARS                       
               MOVE WS-DEBT-CC           TO K425-NUM-CC                         
               MOVE WS-DEBT-YY           TO K425-NUM-YEAR                       
            ELSE                                                                
               COMPUTE WS-DEBT-SERIAL  = K425-NUM-SERIAL + 1                    
            END-IF.                                                             
                                                                                
            MOVE WS-DEBT-SERIAL          TO K425-NUM-SERIAL.                    
                                                                                
            MOVE K425-NUM-SERIAL         TO WS-DEBREF-ID.                       
            MOVE K425-CDE-DEPT           TO WS-DEBREF-AO.                       
            MOVE WS-DEBT-YEARS           TO WS-DEBREF-YR.                       
            MOVE WS-DEB-REF-NO           TO LF60-DEB-REF-NO.                    
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       6000-PRINT-REPORT.                                                       
      ******************************************************************        
                                                                                
           PERFORM 6100-CHECK-WRITE-HEADER      THRU 6100-EXIT.                 
                                                                                
           IF WS-FIRST-WRITE = 'Y'                                              
              MOVE 'N'                            TO WS-FIRST-WRITE             
           END-IF.                                                              
                                                                                
           IF (NUM-RGSTRN OF DCLGRANT-ASMNT = WS-REGN-NO)                       
               MOVE SPACES                        TO LF60-SN                    
                                                     LF60-REGN                  
           ELSE                                                                 
               ADD 1                              TO WS-SNO                     
               MOVE WS-SNO                        TO WS-SNO-ZZZZ9               
               MOVE WS-SNO-ZZZZ9                  TO LF60-SN                    
               MOVE NUM-RGSTRN OF DCLGRANT-ASMNT  TO WS-REGN-NO                 
           END-IF.                                                              
                                                                                
           STRING WS-DTE-APPROVE(7:2) '/'                                       
                  WS-DTE-APPROVE(5:2) '/'                                       
                  WS-DTE-APPROVE(1:4)                                           
                  DELIMITED BY SIZE INTO LF60-APPRV-DTE-2.                      
                                                                                
           PERFORM 5200-GET-CSM-NAME            THRU 5200-EXIT.                 
           PERFORM 5300-GET-DEBAR-REF-NO        THRU 5300-EXIT.                 
                                                                                
           IF (WS-CNT-P04K = 0 OR 1) AND WS-EOF-K010 = 'N'                      
               WRITE P13LF60A-REC               FROM LF60-DETAIL01              
           END-IF.                                                              
                                                                                
           IF WS-EOF-K010 = 'Y' OR WS-CNT-P04K = 0                              
              WRITE P13LF60A-REC                FROM LF60-DETAIL02              
           END-IF.                                                              
                                                                                
           IF WS-CNT-P04K > 1                                                   
              IF WS-CNT-P04K > 2                                                
                 MOVE SPACES                      TO LF60-CSM                   
              END-IF                                                            
              WRITE P13LF60A-REC                FROM LF60-DETAIL02              
           END-IF.                                                              
                                                                                
           ADD 1                                  TO WS-LINE-CTR.               
           ADD 1                                  TO WS-CNT-LF60-WRITE.         
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6001-PRINT-REPORT-1.                                                     
      ******************************************************************        
                                                                                
           PERFORM 6101-CHECK-WRITE-HEADER      THRU 6101-EXIT.                 
                                                                                
           IF WS-FIRST-WRITE-B = 'Y'                                            
              MOVE 'N'                            TO WS-FIRST-WRITE-B           
           END-IF.                                                              
                                                                                
           IF (NUM-RGSTRN OF DCLGRANT-ASMNT = WS-REGN-NO-B)                     
               MOVE SPACES                        TO LF60-SN                    
                                                     LF60-REGN                  
           ELSE                                                                 
               ADD 1                              TO WS-SNO-B                   
               MOVE WS-SNO-B                      TO WS-SNO-ZZZZ9               
               MOVE WS-SNO-ZZZZ9                  TO LF60-SN                    
               MOVE NUM-RGSTRN OF DCLGRANT-ASMNT  TO WS-REGN-NO-B               
           END-IF.                                                              
                                                                                
           STRING WS-DTE-APPROVE(7:2) '/'                                       
                  WS-DTE-APPROVE(5:2) '/'                                       
                  WS-DTE-APPROVE(1:4)                                           
                  DELIMITED BY SIZE INTO LF60-APPRV-DTE-2.                      
                                                                                
           PERFORM 5200-GET-CSM-NAME            THRU 5200-EXIT.                 
           PERFORM 5300-GET-DEBAR-REF-NO        THRU 5300-EXIT.                 
                                                                                
           IF (WS-P04KCODE-NFND >= 0  ) AND WS-EOF-K010 = 'N'                   
               WRITE P13LF60B-REC               FROM LF60-DETAIL01              
           END-IF.                                                              
                                                                                
           IF WS-EOF-K010 = 'Y' OR WS-P04KCODE-NFND = 0                         
              WRITE P13LF60B-REC                FROM LF60-DETAIL02              
           END-IF.                                                              
                                                                                
           IF WS-P04KCODE-NFND > 1                                              
              IF WS-P04KCODE-NFND > 2                                           
                 MOVE SPACES                      TO LF60-CSM                   
              END-IF                                                            
              WRITE P13LF60B-REC                FROM LF60-DETAIL02              
           END-IF.                                                              
                                                                                
           ADD 1                                TO WS-LINE-CTR-B.               
           ADD 1                                TO WS-CNT-LF60-WRITE-B.         
                                                                                
       6001-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6100-CHECK-WRITE-HEADER.                                                 
      ******************************************************************        
                                                                                
           IF (WS-LINE-CTR + WS-CNT-WRITE) > WS-MAX-LINE OR                     
                                             WS-FIRST-WRITE = 'Y'               
              PERFORM 7000-PRINT-HEADER      THRU 7000-EXIT                     
           END-IF.                                                              
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6101-CHECK-WRITE-HEADER.                                                 
      ******************************************************************        
                                                                                
           IF (WS-LINE-CTR-B + WS-CNT-WRITE-B) > WS-MAX-LINE-B OR               
                                             WS-FIRST-WRITE-B = 'Y'             
              PERFORM 7001-PRINT-HEADER      THRU 7001-EXIT                     
           END-IF.                                                              
                                                                                
       6101-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       7000-PRINT-HEADER.                                                       
      ******************************************************************        
                                                                                
           ADD 1                               TO WS-PAGE-CTR.                  
           MOVE ZEROES                         TO LF60-PAGE-HDR.                
           MOVE WS-PAGE-CTR                    TO LF60-PAGE-HDR.                
                                                                                
           WRITE P13LF60A-REC    FROM LF60-HEADER01 AFTER PAGE.                 
           WRITE P13LF60A-REC    FROM LF60-HEADER02.                            
           WRITE P13LF60A-REC    FROM LF60-HEADER03 AFTER 2.                    
           WRITE P13LF60A-REC    FROM LF60-HEADER04.                            
                                                                                
           INITIALIZE WS-LINE-CTR.                                              
           MOVE 5  TO WS-LINE-CTR.                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       7001-PRINT-HEADER.                                                       
      ******************************************************************        
                                                                                
           ADD 1                               TO WS-PAGE-CTR.                  
           MOVE ZEROES                         TO LF60-PAGE-HDR-B               
           MOVE WS-PAGE-CTR                    TO LF60-PAGE-HDR-B.              
                                                                                
           WRITE P13LF60B-REC    FROM LF60-HEADER01-B AFTER PAGE.               
           WRITE P13LF60B-REC    FROM LF60-HEADER02-B.                          
           WRITE P13LF60B-REC    FROM LF60-HEADER03 AFTER 2.                    
           WRITE P13LF60B-REC    FROM LF60-HEADER04.                            
                                                                                
           INITIALIZE WS-LINE-CTR-B.                                            
           MOVE 5  TO WS-LINE-CTR-B.                                            
                                                                                
       7001-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       9000-CLOSE-ROUTINE.                                                      
      ******************************************************************        
                                                                                
           DISPLAY '*************** CONTROL    TOTALS ***************'.         
           DISPLAY 'PROGRAM-ID : BP13CF60'.                                     
           DISPLAY '-------------------------------------------------'.         
           DISPLAY '(1) NO OF GRANT_ASMNT RECORDS READ.......... : '            
                    WS-ASMT-READ.                                               
           DISPLAY '(2) NO OF BP13K730 RECORDS NOT FOUND........ : '            
                    WS-K730-NFND.                                               
           DISPLAY '(3)NO OF BP13K800 RECORDS NOT FOUND......... : '            
                    WS-K800-NFND.                                               
           DISPLAY '(4) NO OF GRANT_ASMNT RECORDS READ............ '.           
           DISPLAY '    WHERE DATE-HSGNT-APPROVE = SPACES....... : '            
                    WS-ASMT-SPACE.                                              
           DISPLAY '(5) NO OF GRANT_ASMNT RECORDS READ............ '.           
           DISPLAY '    OUTSIDE PREV WEEK DATE ................. : '            
                    WS-ASMT-DATE.                                               
           DISPLAY '(6) NO OF P04K0100 RECORDS READ..............  '.           
           DISPLAY '    WHERE CODES NOT FOUND..................  : '            
                    WS-P04KCODE-NFND-A.                                         
           DISPLAY '(7) NO OF S/N ROWS FOUND FOR REPORT1........ : '            
                    WS-SNO.                                                     
           DISPLAY '(8) NO OF S/N ROWS FOUND FOR REPORT2........ : '            
                    WS-SNO-B.                                                   
           DISPLAY '(9) NO OF P13LF60A RECORDS WRITTEN.......... : '            
                    WS-CNT-LF60-WRITE.                                          
           DISPLAY '(10)NO OF P04K010  RECORDS NOT FOUND ....... : '            
                    WS-CNT-LF60-WRITE.                                          
           DISPLAY '(11)NO OF REGN  NOT WRITTEN IN ANY ON THE REPT :'           
                    WS-REGN-BYPASS.                                             
           DISPLAY '(12)NO OF REGN      WRITTEN IN ANY ON THE REPT :'           
                    WS-REGN-PROC-TOT.                                           
                                                                                
           CLOSE    SY02F001                                                    
                    P04K010                                                     
                    BP13K730                                                    
                    BP13K800                                                    
                    BP13K022                                                    
                    BP13K024                                                    
                    BP13K425                                                    
                    P13LF60A                                                    
                    P13LF60B.                                                   
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K730 - ERROR CLOSING : ' WS-K730-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR CLOSING : ' WS-K800-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'P04K010  - ERROR CLOSING : ' WS-K010-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 - ERROR CLOSING : ' WS-K022-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K024-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K024 - ERROR CLOSING : ' WS-K024-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K425-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K425 - ERROR CLOSING : ' WS-K425-STATUS              
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *****************************************************************         
       9999-DB2-ERROR.                                                          
      *****************************************************************         
           CALL 'DBATIAR' USING SQLCA.                                          
           DISPLAY 'QUERY NO. THAT CAUSED ABEND = ' WS-QUERY-NO                 
           PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                            
           MOVE 12 TO RETURN-CODE                                               
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
                                                                                
