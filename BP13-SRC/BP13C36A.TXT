      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    BP13C36A.                                                 
       AUTHOR.        AB9.                                                      
       DATE-WRITTEN.  16/06/11.                                                 
                                                                                
      ************************************************************              
      *                                                          *              
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                    *              
      *                                                          *              
      *    SYSTEM ID   : BP13                                    *              
      *                                                          *              
      *    OBJECTIVE   :                                         *              
      *    TO PROCESS COLLECTION SYSTEM CASH INTERFACE AND       *              
      *    UPDATE TO BP13K130.                                   *              
      *                                                          *              
      *     INPUT FILE :                                         *              
      *                  1. AC28F526 (COLL SYS INTERFACE FILE)   *              
      *                  2. BM06K110 (FIS FILE)                  *              
      *                  3. BP13K800 (SOC MASTER FILE)           *              
      *                                                          *              
      *     OUTPUT FILE:                                         *              
      *                  1. BP13K130 (SOCHIST   FILE)            *              
      *                  2. BP13K140 (KIVTRAN   FILE)            *              
      *                  3. BP13K350 (STUDIO APARTMENT FILE)     *              
      *                  4. BP13K352 (AMR APT DET FOR 2R/3R)     *              
      *                                                          *              
      *  CHG-NO   BY   ON        DESCRIPTION                     *              
      *  -------- ---  --------  ------------------------------  *              
      *  BP134228 AB9  16/06/11  NEW PROGRAM                     *              
      *  BP134302 AB9  26/08/11  CHK K140-AMT FIELD IS NUMERIC   *              
      *  BP134355 AB9  08/09/11  CATER FOR MIS-MATCHED CASES     *              
      *  BP134355 AB9  10/10/11  CATER FOR RECOVERY OF HOUSING   *              
      *                          GRANT- REVERSE SIGN WHILE       *              
      *                          UPDATING BP13K130               *              
      *  BP134641 MDT2 10/08/12  CHANGE THE LRECL OF BP13KD05    *              
      *                          FROM 300 TO 500 IN FD           *              
      *  BP134643 AB9  21/09/12  CATER FOR NEW RECIPT CODE-      *              
      *                          FOR AHG/SHG/INT                 *              
      *  BP134408 AB9  10/09/12  CATER FOR SHG                   *              
      *  BP135291 ESD1 03/09/14  CATER FOR SUG                   *              
      *  BP135683 RJB1 06/04/15  TO HANDLE CASE DROPPED FROM SOC *              
      *                          BUT FOUND / NOT FOUND IN KD05   *              
      *  BP136285 ZDD1 19/08/16  REMOVED 0520C                   *              
      *  BP136512 RJB1 02/11/16  CATER FOR RM TYP 2F FOR 6088Z   *              
      *  BP136585 MRN1 09/03/17  CATER FOR NEW RECEIPTING CODES  *              
      *                          6014J(AHG), 6021Z(SHG), 6254D(INT)             
      *  BP138668 LJL1 24/03/21  CATER FOR NEW RECEIPTING CODES  *              
      *                          6095I FOR CASES UNDER ALLOCATION               
      *                                SCHEME SHS"              **              
      ************************************************************              
                                                                                
      *-----------------------*                                                 
       ENVIRONMENT DIVISION.                                                    
      *-----------------------*                                                 
       CONFIGURATION SECTION.                                                   
      *-----------------------*                                                 
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
      *-----------------------*                                                 
       INPUT-OUTPUT SECTION.                                                    
      *-----------------------*                                                 
       FILE-CONTROL.                                                            
                                                                                
           SELECT AC28F526 ASSIGN       TO AC28F526.                            
                                                                                
           SELECT BP13K130 ASSIGN         TO BP13K130                           
                           ACCESS MODE    IS DYNAMIC                            
                           ORGANIZATION   IS INDEXED                            
                           RECORD KEY     IS K130-KEY-FLD                       
                           FILE STATUS    IS WS-K130-STATUS.                    
                                                                                
           SELECT BP13K140 ASSIGN         TO BP13K140                           
                           ACCESS MODE       IS RANDOM                          
                           ORGANIZATION      IS INDEXED                         
                           RECORD KEY        IS K140-KEY-FLD                    
                           FILE STATUS       IS WS-K140-STATUS.                 
                                                                                
           SELECT BP13K350 ASSIGN         TO BP13K350                           
                           ACCESS MODE       IS RANDOM                          
                           ORGANIZATION      IS INDEXED                         
                           RECORD KEY        IS K350-KEY-FLD                    
                           FILE STATUS       IS WS-K350-STATUS.                 
                                                                                
           SELECT BP13K352 ASSIGN         TO BP13K352                           
                           ACCESS MODE       IS RANDOM                          
                           ORGANIZATION      IS INDEXED                         
                           RECORD KEY        IS K352-KEY-FLD                    
                           FILE STATUS       IS WS-K352-STATUS.                 
                                                                                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS WS-K800-STATUS.                    
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            FILE STATUS   IS WS-K110-STATUS.                    
                                                                                
           SELECT BP13KD05  ASSIGN        TO BP13KD05                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KD05-KEY-FLD                       
                            FILE STATUS   IS WS-KD05-STATUS.                    
                                                                                
           SELECT BP13L36A ASSIGN TO BP13L36A.                                  
           SELECT BP13F52A ASSIGN TO BP13F52A.                                  
                                                                                
                                                                                
      *-----------------------*                                                 
       DATA DIVISION.                                                           
      *-----------------------*                                                 
       FILE SECTION.                                                            
      *-----------------------*                                                 
                                                                                
       FD  AC28F526                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 130 CHARACTERS.                                      
       COPY AC28F526.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
                                                                                
       FD  BP13K130                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13K130.                                                           
                                                                                
       FD  BP13K140                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13K140.                                                           
                                                                                
       FD  BP13K350                                                             
           RECORD CONTAINS 600 CHARACTERS.                                      
       COPY BP13K350.                                                           
                                                                                
       FD  BP13K352                                                             
           RECORD CONTAINS 600 CHARACTERS.                                      
       COPY BP13K352.                                                           
                                                                                
       FD  BP13KD05                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
       COPY BP13KD05.                                                           
                                                                                
       FD  BP13F52A                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 130 CHARACTERS.                                      
       COPY BP13F52A.                                                           
                                                                                
       FD  BP13L36A                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  PRINT-REC                      PIC X(132).                           
                                                                                
      *--------------------------------------------------------------*          
       WORKING-STORAGE SECTION.                                                 
      *--------------------------------------------------------------*          
       01  WS-VARIABLES.                                                        
           05  WS-COUNT-HISTORY           PIC 9(3)       VALUE ZEROS.           
           05  WS-CDE-ERROR               PIC X          VALUE SPACES.          
       01  WS-LINE-CNT                    PIC 99         VALUE 66.              
       01  WS-PAGE-CNT                    PIC 9(5)       VALUE ZERO.            
       01  CNT-KIV-CASES                  PIC 9(4)       VALUE ZERO.            
       01  WS-AMT-KIV-TOTAL               PIC 9(6)V99    VALUE ZEROES.          
       01  WS-DTE-CUR.                                                          
           05  WS-CC               PIC 99.                                      
           05  WS-YY               PIC 99.                                      
           05  WS-MM               PIC 99.                                      
           05  WS-DD               PIC 99.                                      
                                                                                
       01  WS-TRANS-DATE.                                                       
           05  WS-TRANS-YYYY       PIC 9(4).                                    
           05  WS-TRANS-MM         PIC 9(2).                                    
           05  WS-TRANS-DD         PIC 9(2).                                    
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  WS-K130-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-K140-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-K350-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-KD05-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-K352-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-K110-STATUS             PIC 9(2)       VALUE ZEROES.          
           05  WS-K800-STATUS             PIC 9(2)       VALUE ZEROES.          
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-K130-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K140-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K350-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K352-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-KD05-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-F52A-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K110-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K110-NOTFD              PIC 9(5)       VALUE ZEROES.          
           05  WS-K800-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-KD05-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K800-NOTFD              PIC 9(5)       VALUE ZEROES.          
           05  WS-F526-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-CNT-HIST                PIC 9(2)       VALUE ZEROES.          
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-F526-EOF                PIC X          VALUE 'N'.             
           05  WS-KD05-EOF                PIC X          VALUE 'N'.             
           05  WS-KD05-FND                PIC X          VALUE 'N'.             
           05  WS-KD05-TAG                PIC X          VALUE 'N'.             
           05  WS-K130-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K140-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K350-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K352-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K800-REC-FND            PIC X          VALUE SPACES.          
                                                                                
       01  WS-AMT-TXN                     PIC 9(8)V99    VALUE ZEROS.           
       01  WS-BAL-TXN                     PIC 9(8)V99    VALUE ZEROS.           
                                                                                
       01  L003-PR-HEAD-01.                                                     
           05  FILLER              PIC X(8)      VALUE 'BP13L36A'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                    'S Y S T E M   O F   '.                     
           05  FILLER              PIC X(19)     VALUE                          
                                    'C O M M I T M E N T'.                      
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE :'.                
           05  13S1-DATE           PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  13S1-PAGENO         PIC ZZZZ9 .                                  
                                                                                
       01  L003-PR-HEAD-02.                                                     
           05  FILLER              PIC X(39)     VALUE SPACES .                 
           05  FILLER              PIC X(53)     VALUE                          
               ' ERROR LIST OF TRANSACTIONS IN THE COLLN-TRANS FILE'.           
           05  FILLER              PIC X(40)     VALUE                          
               '      (SALES - AGREEMENT/APPLICATION)'.                         
                                                                                
       01  L003-PR-HEAD-03.                                                     
           05  FILLER              PIC X(28)                                    
                  VALUE '   S/NO     SCH-ACCNT NO    '.                         
           05  FILLER              PIC X(34)                                    
                  VALUE 'REGN NO       AMOUNT    RECEIPT NO'.                   
           05  FILLER              PIC X(39)                                    
                  VALUE '      DATE POST   PAY TYPE       REMARK'.              
           05  FILLER              PIC X(25)     VALUE SPACES.                  
           05  FILLER              PIC X(6)     VALUE 'H-CNT '.                 
                                                                                
       01  L003-PR-DETAILS.                                                     
           05  13S1-SNO            PIC ZZZZZ9 .                                 
           05  FILLER              PIC X(06)     VALUE SPACES .                 
           05  13S1-NUM-SCHACCNT   PIC X(11).                                   
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  13S1-ORIG-REG-NO    PIC X(8).                                    
           05  FILLER              PIC X(4)      VALUE SPACES .                 
           05  13S1-AMT            PIC $$$$$$9.99DB.                            
           05  FILLER              PIC X(02)     VALUE SPACES .                 
           05  13S1-NUM-RECEIPT    PIC X(12) .                                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  13S1-DTE-POST.                                                   
               10  13S1-POST-DD    PIC X(2)      VALUE SPACES.                  
               10  13S1-POST-FIL1  PIC X         VALUE '/'.                     
               10  13S1-POST-MM    PIC X(2)      VALUE SPACES.                  
               10  13S1-POST-FIL2  PIC X         VALUE '/'.                     
               10  13S1-POST-YYYY  PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(05)     VALUE SPACES .                 
           05  13S1-PAYMENT-TYPE   PIC X(03).                                   
           05  FILLER              PIC X(03)     VALUE SPACES .                 
           05  13S1-REMARK         PIC X(35).                                   
           05  FILLER              PIC X(3)      VALUE SPACES.                  
           05  13S1-CDE-HIST       PIC X(1)      VALUE SPACES.                  
           05  13S1-CNT-HIST       PIC X(2)      VALUE SPACES.                  
                                                                                
       01  L003-CONTROL-LINE.                                                   
           05  FILLER              PIC X(19)     VALUE SPACES.                  
           05  CNTL-ITEM           PIC X(30)     VALUE SPACES.                  
           05  CNTL-CNT            PIC ZZZZ9 .                                  
           05  FILLER              PIC X(58)     VALUE SPACES.                  
                                                                                
                                                                                
      *-----------------------*                                                 
       PROCEDURE DIVISION.                                                      
      *-----------------------*                                                 
                                                                                
      ******************************************************************        
       000-MAIN.                                                                
      ******************************************************************        
                                                                                
           PERFORM 100-OPEN-FILES       THRU 100-EXIT.                          
           MOVE FUNCTION CURRENT-DATE   TO WS-DTE-CUR.                          
           PERFORM 200-READ-AC28F526    THRU 200-EXIT.                          
           PERFORM 300-PROCESS-AC28F526 THRU 300-EXIT                           
                   UNTIL WS-F526-EOF = 'Y'.                                     
           PERFORM 900-CLOSE-FILES      THRU 900-EXIT.                          
                                                                                
           MOVE 1                       TO WS-LINE-CNT                          
           PERFORM 1100-ERROR-HEADING   THRU 1100-EXIT.                         
                                                                                
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       100-OPEN-FILES.                                                          
      ******************************************************************        
                                                                                
           OPEN INPUT  AC28F526                                                 
                       BM06K110                                                 
                       BP13K800                                                 
                I-O    BP13K130                                                 
                       BP13K140                                                 
                       BP13K350                                                 
                       BP13K352                                                 
                       BP13KD05                                                 
                OUTPUT BP13L36A                                                 
                       BP13F52A.                                                
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BM06K110. STATUS : ' WS-K110-STATUS        
              MOVE WS-K110-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13K800. STATUS : ' WS-K800-STATUS        
              MOVE WS-K800-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
                                                                                
           IF WS-K130-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13K130. STATUS : ' WS-K130-STATUS        
              MOVE WS-K130-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
           IF WS-K140-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13K140. STATUS : ' WS-K140-STATUS        
              MOVE WS-K140-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
           IF WS-K350-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13K350. STATUS : ' WS-K350-STATUS        
              MOVE WS-K350-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
           IF WS-K352-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13K352. STATUS : ' WS-K352-STATUS        
              MOVE WS-K352-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
           IF WS-KD05-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR BP13KD05. STATUS : ' WS-KD05-STATUS        
              MOVE WS-KD05-STATUS       TO   RETURN-CODE                        
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       200-READ-AC28F526.                                                       
      ******************************************************************        
                                                                                
           READ AC28F526    AT END                                              
                MOVE 'Y'    TO WS-F526-EOF                                      
                GO TO 200-EXIT.                                                 
                                                                                
           ADD 1            TO WS-F526-READ.                                    
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       300-PROCESS-AC28F526.                                                    
      ******************************************************************        
                                                                                
           MOVE ZEROS                   TO WS-BAL-TXN                           
                                           WS-AMT-TXN.                          
           MOVE 'N'                     TO WS-KD05-TAG.                         
           MOVE SPACES                  TO WS-CDE-ERROR.                        
                                                                                
           IF F526-NUM-RCPTCD = '1279J' OR '1277G' OR '0520C' OR                
                                 '6011E' OR '6020H' OR '1224I' OR               
                                '6015B' OR '6014J' OR '6021Z' OR '6254D'        
              MOVE F526-NUM-REF         TO   K800-NUM-REGN                      
              PERFORM 455-READ-K800     THRU 455-EXIT                           
           ELSE                                                                 
              PERFORM 400-READ-BM06K110 THRU 400-EXIT                           
           END-IF.                                                              
                                                                                
           PERFORM 200-READ-AC28F526    THRU 200-EXIT.                          
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       400-READ-BM06K110.                                                       
      ******************************************************************        
                                                                                
           IF F526-AMT-TXN  IS NOT NUMERIC                                      
              MOVE ZEROS                  TO  F526-AMT-TXN                      
           END-IF.                                                              
           MOVE SPACES                    TO  K110-REC.                         
           MOVE F526-NUM-HDBREF           TO  K110-KEY-FLD.                     
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE WS-K110-STATUS                                              
              WHEN 00                                                           
                   PERFORM 450-READ-K800  THRU  450-EXIT                        
              WHEN 23                                                           
                   ADD  1                 TO WS-K110-NOTFD                      
                   DISPLAY 'REC NOTFD IN BM06K110. KEY ' K110-KEY-FLD           
                   MOVE 'A'           TO WS-CDE-ERROR                           
                   PERFORM 555-WRITE-BP13F52A  THRU  555-EXIT                   
                   PERFORM 550-WRITE-BP13K140  THRU  550-EXIT                   
                   PERFORM 1000-ERROR-LIST     THRU 1000-EXIT                   
              WHEN OTHER                                                        
                   MOVE WS-K110-STATUS         TO RETURN-CODE                   
                   DISPLAY 'ERROR READING BM06K110, STATUS = '                  
                                          WS-K110-STATUS                        
                   PERFORM 900-CLOSE-FILES     THRU 900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       450-READ-K800.                                                           
      ******************************************************************        
                                                                                
                 IF (K110-REGN-NO NOT = SPACES AND LOW-VALUES AND               
                                        ALL 'X') AND                            
                    (K110-REGN-NO(1:2) NOT = '##')                              
                    ADD  1                       TO WS-K110-READ                
                    MOVE K110-REGN-NO            TO F526-NUM-REF                
                                                    K800-NUM-REGN               
                    PERFORM 455-READ-K800        THRU    455-EXIT               
                  ELSE                                                          
                      ADD  1                     TO WS-K110-READ                
                      DISPLAY 'INVALID REGN-BM06K110: ' K110-REGN-NO            
                      MOVE 'R'                   TO WS-CDE-ERROR                
                      PERFORM 555-WRITE-BP13F52A THRU  555-EXIT                 
                      PERFORM 550-WRITE-BP13K140 THRU  550-EXIT                 
                      PERFORM 1000-ERROR-LIST    THRU 1000-EXIT                 
                   END-IF.                                                      
                                                                                
       450-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       455-READ-K800.                                                           
      ******************************************************************        
                                                                                
                                                                                
           IF F526-AMT-TXN  IS NOT NUMERIC                                      
              MOVE ZEROS                  TO  F526-AMT-TXN                      
           END-IF.                                                              
                                                                                
           READ BP13K800.                                                       
           EVALUATE WS-K800-STATUS                                              
                    WHEN '00'                                                   
                          MOVE 'Y'                  TO  WS-K800-REC-FND         
                          ADD  1                    TO  WS-K800-READ            
                          PERFORM 475-VALID-RECEIPT THRU 475-EXIT               
                    WHEN  '23'                                                  
                           MOVE 'N'                 TO  WS-K800-REC-FND         
                           ADD 1                    TO  WS-K800-NOTFD           
                           MOVE 'S'                    TO  WS-CDE-ERROR         
                           DISPLAY 'BP13K800-RECORD NOT FOUND  '                
                                           K800-NUM-REGN                        
                           PERFORM 475-VALID-RECEIPT THRU 475-EXIT              
                                                                                
                    WHEN  OTHER                                                 
                           MOVE 'N'                 TO  WS-K800-REC-FND         
                           DISPLAY 'BP13K800-READ ERROR: '                      
                                                        WS-K800-STATUS          
                           MOVE WS-K800-STATUS TO RETURN-CODE                   
                           PERFORM 900-CLOSE-FILES     THRU 900-EXIT            
             END-EVALUATE .                                                     
                                                                                
       455-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       475-VALID-RECEIPT.                                                       
      ******************************************************************        
                                                                                
           EVALUATE F526-NUM-RCPTCD                                             
              WHEN '1279J'                                                      
              WHEN '1277G'                                                      
              WHEN '0520C'                                                      
              WHEN '1224I'                                                      
              WHEN '6011E'                                                      
              WHEN '6020H'                                                      
              WHEN '6015B'                                                      
              WHEN '6014J'                                                      
              WHEN '6021Z'                                                      
              WHEN '6254D'                                                      
                   PERFORM 651-READ-KD05     THRU 651-EXIT                      
                   PERFORM 651A-PROCESS-K140 THRU 651A-EXIT                     
              WHEN '6154A'                                                      
                   PERFORM 651B-PROCESS-ADV  THRU 651B-EXIT                     
              WHEN '6088Z'                                                      
              WHEN '6095I'                                                      
                   PERFORM 651C-PROCESS-ADV  THRU 651C-EXIT                     
              WHEN OTHER                                                        
                    DISPLAY 'RECEIPT CODE DOESNNOT MATCH'                       
                    PERFORM 555-WRITE-BP13F52A    THRU  555-EXIT                
                    PERFORM 550-WRITE-BP13K140 THRU 550-EXIT                    
                    PERFORM 1000-ERROR-LIST  THRU 1000-EXIT                     
             END-EVALUATE.                                                      
                                                                                
       475-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       480-WRITE-K350.                                                          
      ******************************************************************        
                                                                                
             MOVE F526-NUM-REF                TO    K350-NUM-REGN.              
             READ BP13K350.                                                     
             IF WS-K350-STATUS = '00'                                           
                PERFORM 485-MOVE-FIELDS       THRU  485-EXIT                    
                REWRITE BP13K350-REC                                            
                DISPLAY 'REWRITE REC IN K350: ' K350-NUM-REGN                   
             ELSE                                                               
               IF WS-K350-STATUS = '23'                                         
                MOVE   SPACES                  TO    BP13K350-REC               
                INITIALIZE                        BP13K350-REC                  
                PERFORM 485-MOVE-FIELDS        THRU  485-EXIT                   
                WRITE BP13K350-REC                                              
               ELSE                                                             
                 MOVE WS-K350-STATUS            TO RETURN-CODE                  
                 DISPLAY 'ERROR WRITING BP13K350. STATUS : '                    
                                                  WS-K350-STATUS                
                 PERFORM 900-CLOSE-FILES          THRU 900-EXIT                 
               END-IF                                                           
             END-IF.                                                            
             IF WS-K350-STATUS = '00'                                           
                ADD 1 TO WS-K350-WRITE                                          
              ELSE                                                              
                 MOVE WS-K350-STATUS            TO RETURN-CODE                  
                 DISPLAY 'ERROR WRITING BP13K350. STATUS : '                    
                                                  WS-K350-STATUS                
                 PERFORM 900-CLOSE-FILES          THRU 900-EXIT.                
                                                                                
                                                                                
       480-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       485-MOVE-FIELDS.                                                         
      ******************************************************************        
                                                                                
             MOVE F526-NUM-REF           TO    K350-NUM-REGN.                   
             MOVE F526-NUM-HDBREF        TO    K350-NUM-SCH-ACC.                
             IF F526-AMT-TXN    IS NOT NUMERIC                                  
                MOVE ZEROS               TO    F526-AMT-TXN                     
             END-IF.                                                            
             MOVE F526-AMT-TXN           TO    K350-AMT-ADV-COLLECTION.         
             MOVE F526-DTE-TXN           TO    K350-DTE-POST.                   
             MOVE F526-NUM-RCPT          TO    K350-NUM-RECPT-JRNO.             
             MOVE WS-DTE-CUR             TO    K350-DTE-UPDATE.                 
             MOVE 'BP13C36A'             TO    K350-NUM-USERID.                 
                                                                                
       485-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       490-WRITE-K352.                                                          
      ******************************************************************        
                                                                                
             MOVE F526-NUM-REF           TO    K352-NUM-REGN.                   
             READ BP13K352.                                                     
             IF WS-K352-STATUS = '00'                                           
                PERFORM 495-MOVE-FIELDS    THRU  495-EXIT                       
                REWRITE BP13K352-REC                                            
                DISPLAY 'REWRITE REC IN K352: ' K352-NUM-REGN                   
             ELSE                                                               
                IF WS-K352-STATUS = '23'                                        
                   MOVE   SPACES               TO    BP13K352-REC               
                   INITIALIZE                        BP13K352-REC               
                   PERFORM 495-MOVE-FIELDS    THRU  495-EXIT                    
                   WRITE BP13K352-REC                                           
                ELSE                                                            
                 MOVE WS-K352-STATUS    TO RETURN-CODE                          
                 DISPLAY 'ERROR WRITING BP13K352. STATUS : '                    
                                                  WS-K352-STATUS                
                 PERFORM 900-CLOSE-FILES THRU 900-EXIT                          
             END-IF.                                                            
             IF WS-K352-STATUS = '00'                                           
                ADD 1 TO WS-K352-WRITE                                          
              ELSE                                                              
                 MOVE WS-K352-STATUS    TO RETURN-CODE                          
                 DISPLAY 'ERROR WRITING BP13K352. STATUS : '                    
                                                  WS-K352-STATUS                
                 PERFORM 900-CLOSE-FILES THRU 900-EXIT.                         
                                                                                
                                                                                
       490-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       495-MOVE-FIELDS.                                                         
      ******************************************************************        
                                                                                
             MOVE F526-NUM-REF           TO    K352-NUM-REGN.                   
             MOVE F526-NUM-HDBREF        TO    K352-NUM-SCH-ACC.                
             IF F526-AMT-TXN             IS    NOT NUMERIC                      
                MOVE ZEROS               TO    F526-AMT-TXN                     
             END-IF.                                                            
             MOVE F526-AMT-TXN           TO    K352-AMT-ADV-COLLECTION.         
             MOVE F526-DTE-TXN           TO    K352-DTE-POST.                   
             MOVE F526-NUM-RCPT          TO    K352-NUM-RECPT-JRNO.             
             MOVE WS-DTE-CUR             TO    K352-DTE-UPDATE.                 
             MOVE 'BP13C36A'             TO    K352-NUM-USERID.                 
                                                                                
       495-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       500-WRITE-FILES.                                                         
      ******************************************************************        
                                                                                
           IF F526-NUM-RCPTCD = '6154A' OR '6088Z' OR '1279J' OR                
                                '1277G' OR            '6011E' OR                
                                '6020H' OR '1224I' OR '6015B' OR                
                                '6014J' OR '6021Z' OR '6254D'                   
              MOVE  1  TO WS-COUNT-HISTORY                                      
              PERFORM 600-WRITE-BP13K130     THRU  600-EXIT                     
           ELSE                                                                 
             IF F526-NUM-RCPTCD NOT = '0520C'                                   
               PERFORM 550-WRITE-BP13K140     THRU  550-EXIT                    
               PERFORM 1000-ERROR-LIST       THRU 1000-EXIT                     
             END-IF                                                             
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       550-WRITE-BP13K140.                                                      
      ******************************************************************        
                                                                                
           PERFORM 750-MOVE-VALUES-TO-K140 THRU 750-EXIT.                       
                                                                                
                                                                                
           WRITE BP13K140-KIVTRAN.                                              
           IF WS-K140-STATUS = '00' OR '02'                                     
              ADD 1 TO WS-K140-WRITE                                            
           ELSE                                                                 
              IF WS-K140-STATUS = '22'                                          
                 ADD 1 TO  WS-CNT-HIST                                          
                 MOVE WS-CNT-HIST TO  K140-COUNT-HIST-NUM                       
                 WRITE BP13K140-KIVTRAN                                         
                 ADD 1 TO WS-K140-WRITE                                         
                 DISPLAY ' DUPLICATE RECORDS AT BP13K140 '                      
                                                                                
              ELSE                                                              
                 MOVE WS-K140-STATUS    TO RETURN-CODE                          
                 DISPLAY 'ERROR WRITING BP13K140. STATUS : '                    
                                                  WS-K140-STATUS                
                 PERFORM 900-CLOSE-FILES          THRU 900-EXIT.                
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       555-WRITE-BP13F52A.                                                      
      ******************************************************************        
                                                                                
           PERFORM 565-MOVE-VALUES-F52A    THRU 565-EXIT.                       
           WRITE BP13F52A-REC.                                                  
           ADD 1 TO WS-F52A-WRITE.                                              
                                                                                
       555-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       565-MOVE-VALUES-F52A.                                                    
      ******************************************************************        
                                                                                
           MOVE  SPACES                TO    BP13F52A-REC.                      
           INITIALIZE                        BP13F52A-REC.                      
           MOVE F526-NUM-HDBREF        TO    F52A-NUM-HDBREF.                   
           MOVE F526-DTE-TXN           TO    F52A-DTE-TXN.                      
           MOVE F526-NUM-TXN-ID        TO    F52A-NUM-TXN-ID.                   
           MOVE F526-NUM-RCPT          TO    F52A-NUM-RCPT.                     
           MOVE F526-AMT-TXN           TO    F52A-AMT-TXN.                      
           MOVE F526-NUM-CRDR          TO    F52A-NUM-CRDR.                     
           MOVE F526-TXT-DESC-1        TO    F52A-TXT-DESC-1.                   
           MOVE F526-NUM-GL-REF        TO    F52A-NUM-GL-REF.                   
           MOVE F526-NUM-REF           TO    F52A-NUM-REF.                      
                                                                                
       565-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       600-WRITE-BP13K130.                                                      
      ******************************************************************        
                                                                                
           PERFORM 700-MOVE-VALUES-TO-K130 THRU 700-EXIT.                       
                                                                                
           WRITE BP13K130-CDHIST.                                               
                                                                                
           IF WS-K130-STATUS = '00'                                             
              ADD 1                        TO   WS-K130-WRITE                   
           ELSE                                                                 
              IF WS-K130-STATUS = '22'                                          
                 MOVE 'N' TO WS-K130-WRITTEN                                    
                 PERFORM 800-READ-BP13K130 THRU  800-EXIT UNTIL                 
                             WS-K130-WRITTEN = 'Y'                              
              ELSE                                                              
                 MOVE WS-K130-STATUS       TO    RETURN-CODE                    
                 DISPLAY 'ERROR READING BP13K130. STATUS : '                    
                                                  WS-K130-STATUS                
                 PERFORM 900-CLOSE-FILES   THRU  900-EXIT.                      
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       651-READ-KD05.                                                           
      ******************************************************************        
                                                                                
           IF F526-NUM-RCPTCD = '0520C' OR '1224I' OR '6254D'                   
              PERFORM 500-WRITE-FILES        THRU 500-EXIT                      
           GO TO 651-EXIT.                                                      
                                                                                
           MOVE SPACES                       TO KD05-KEY-FLD.                   
           INITIALIZE                           KD05-KEY-FLD.                   
           MOVE F526-NUM-REF                 TO KD05-NUM-REGN.                  
           MOVE F526-NUM-UIN                 TO KD05-NUM-NRIC.                  
           MOVE 'N'                          TO WS-KD05-EOF                     
                                                WS-KD05-FND.                    
           READ BP13KD05 KEY IS KD05-KEY-FLD.                                   
                                                                                
           EVALUATE WS-KD05-STATUS                                              
                WHEN 00                                                         
                     PERFORM 652-READ-UPD-KD05  THRU 652-EXIT                   
                WHEN 10                                                         
                WHEN 23                                                         
                   DISPLAY 'RECORD NOT FOUND IN BP13KD05 ' KD05-KEY-FLD         
                WHEN OTHER                                                      
                      DISPLAY 'ERROR READING BP13KD05, STATUS '                 
                      DISPLAY WS-KD05-STATUS                                    
                      PERFORM 900-CLOSE-FILES THRU 900-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       651-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       651A-PROCESS-K140.                                                       
      ******************************************************************        
                                                                                
               IF WS-KD05-TAG = 'Y'                                             
                  PERFORM 500-WRITE-FILES THRU 500-EXIT                         
               ELSE                                                             
                  IF F526-NUM-RCPTCD NOT = '0520C' AND '1224I'                  
                                                   AND '6254D'                  
                    EVALUATE WS-CDE-ERROR                                       
                     WHEN 'G'                                                   
                        DISPLAY 'GRANT RECOVERY > GRANT ' KD05-KEY-FLD          
                     WHEN 'H'                                                   
                        DISPLAY 'NO AHG GRANT > ' KD05-KEY-FLD                  
                     WHEN 'C'                                                   
                        DISPLAY 'NO CHG GRANT > ' KD05-KEY-FLD                  
                     WHEN 'Z'                                                   
                        DISPLAY 'NO SHG GRANT > ' KD05-KEY-FLD                  
                     WHEN 'U'                                                   
                        DISPLAY 'NO SUG GRANT > ' KD05-KEY-FLD                  
                     WHEN OTHER                                                 
                       MOVE 'D'            TO WS-CDE-ERROR                      
                    END-EVALUATE                                                
                   PERFORM 555-WRITE-BP13F52A    THRU  555-EXIT                 
                   PERFORM 550-WRITE-BP13K140 THRU  550-EXIT                    
                   PERFORM 1000-ERROR-LIST    THRU 1000-EXIT                    
              END-IF.                                                           
                                                                                
       651A-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       651B-PROCESS-ADV.                                                        
      ******************************************************************        
                                                                                
            IF (K800-NUM-IDP-SCHEME = 'SA ' OR                                  
                K800-NUM-FLAT-TYPE  = '1A' OR '2A') AND                         
                (K800-NUM-ALLO-CAT = 'NPL')                                     
                PERFORM 480-WRITE-K350  THRU 480-EXIT                           
                PERFORM 500-WRITE-FILES THRU 500-EXIT                           
            ELSE                                                                
               DISPLAY 'RECEIPT CODE DOESNOT MATCH: ' K800-NUM-REGN             
                PERFORM 555-WRITE-BP13F52A    THRU  555-EXIT                    
                PERFORM 550-WRITE-BP13K140 THRU  550-EXIT                       
                PERFORM 1000-ERROR-LIST    THRU 1000-EXIT                       
             END-IF.                                                            
                                                                                
       651B-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       651C-PROCESS-ADV.                                                        
      ******************************************************************        
                                                                                
             IF (K800-NUM-FLAT-TYPE = '2 ' OR '3 ' OR '2R'                      
                                           OR '3R')  AND                        
                (K800-NUM-ALLO-CAT = 'NPL' OR 'SHS')                            
                 PERFORM 490-WRITE-K352  THRU 490-EXIT                          
                 PERFORM 500-WRITE-FILES THRU 500-EXIT                          
             ELSE                                                               
             IF (K800-NUM-FLAT-TYPE = '2F') AND                                 
                (K800-NUM-ALLO-CAT = 'NPL' OR 'SHS')                            
                 PERFORM 480-WRITE-K350  THRU 480-EXIT                          
                 PERFORM 500-WRITE-FILES THRU 500-EXIT                          
             ELSE                                                               
                    DISPLAY 'RECEIPT CODE DOESNOT MATCH: '                      
                                                  K800-NUM-REGN                 
                    PERFORM 555-WRITE-BP13F52A    THRU  555-EXIT                
                    PERFORM 550-WRITE-BP13K140 THRU 550-EXIT                    
                    PERFORM 1000-ERROR-LIST  THRU 1000-EXIT                     
              END-IF.                                                           
                                                                                
       651C-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       652-READ-UPD-KD05.                                                       
      ******************************************************************        
                                                                                
            MOVE F526-AMT-TXN       TO      WS-BAL-TXN.                         
            MOVE 'Y'                TO      WS-KD05-FND.                        
            ADD 1                   TO      WS-KD05-READ.                       
            PERFORM 653-UPD-KD05   THRU     653-EXIT.                           
                                                                                
       652-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       653-UPD-KD05.                                                            
      ******************************************************************        
                                                                                
           IF F526-AMT-TXN IS NOT NUMERIC                                       
              MOVE ZERO                    TO F526-AMT-TXN                      
           END-IF.                                                              
           IF KD05-AMT-AHG-GRANT IS NOT NUMERIC                                 
              MOVE ZERO                    TO KD05-AMT-AHG-GRANT                
           END-IF.                                                              
           IF KD05-AMT-HSGNT IS NOT NUMERIC                                     
              MOVE ZERO                    TO KD05-AMT-HSGNT                    
           END-IF.                                                              
           IF KD05-AMT-SHG-GRANT IS NOT NUMERIC                                 
              MOVE ZERO                    TO KD05-AMT-SHG-GRANT                
           END-IF.                                                              
           IF KD05-AMT-SUG-GRANT IS NOT NUMERIC                                 
              MOVE ZERO                    TO KD05-AMT-SUG-GRANT                
           END-IF.                                                              
                                                                                
           EVALUATE F526-NUM-RCPTCD                                             
                                                                                
             WHEN '1277G'                                                       
             WHEN '6020H'                                                       
             WHEN '6014J'                                                       
                 PERFORM 655-CHK-AHG-RECOVERY     THRU 655-EXIT                 
                                                                                
             WHEN '1279J'                                                       
                 PERFORM 656-CHK-CHG-RECOVERY     THRU 656-EXIT                 
                                                                                
             WHEN '6011E'                                                       
             WHEN '6021Z'                                                       
                 PERFORM 657-CHK-SHG-RECOVERY     THRU 657-EXIT                 
                                                                                
             WHEN '6015B'                                                       
                 PERFORM 658-CHK-SUG-RECOVERY     THRU 658-EXIT                 
                                                                                
           END-EVALUATE.                                                        
                                                                                
       653-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       654-REWRITE-KD05.                                                        
      ******************************************************************        
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO KD05-DTE-UPDATE.                  
           MOVE FUNCTION CURRENT-DATE(9:8) TO KD05-TME-UPDATE.                  
           MOVE 'P13C36A'                  TO KD05-NUM-USERID.                  
           REWRITE BP13KD05-REC.                                                
                                                                                
           IF WS-KD05-STATUS = 00                                               
              ADD             1              TO WS-KD05-WRITE                   
              MOVE 'Y'                       TO WS-KD05-TAG                     
              MOVE KD05-NUM-NRIC             TO K800-NUM-NRIC1                  
           ELSE                                                                 
              MOVE 'N'                       TO WS-KD05-TAG                     
              MOVE WS-KD05-STATUS    TO RETURN-CODE                             
              DISPLAY 'ERROR WRITING BP13KD05. STATUS : '                       
                                               WS-KD05-STATUS                   
              PERFORM 900-CLOSE-FILES THRU 900-EXIT.                            
                                                                                
       654-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       655-CHK-AHG-RECOVERY.                                                    
      ******************************************************************        
                                                                                
             MOVE ZEROS                          TO  WS-AMT-TXN.                
             IF KD05-AMT-AHG-GRANT > 0 AND                                      
                F526-AMT-TXN       > 0                                          
                COMPUTE  WS-AMT-TXN = KD05-AMT-AHG-GRANT-RECOVER                
                                    + F526-AMT-TXN                              
                IF (KD05-AMT-AHG-GRANT-RECOVER  =  KD05-AMT-AHG-GRANT)          
                                               OR                               
                               (  WS-AMT-TXN   > KD05-AMT-AHG-GRANT )           
                   MOVE 'G'                    TO  WS-CDE-ERROR                 
                ELSE                                                            
                   COMPUTE  KD05-AMT-AHG-GRANT-RECOVER =                        
                            KD05-AMT-AHG-GRANT-RECOVER +                        
                            F526-AMT-TXN                                        
                   MOVE  F526-DTE-TXN     TO KD05-DTE-AHG-GRANT-RECOVER         
                   PERFORM    654-REWRITE-KD05      THRU     654-EXIT           
                END-IF                                                          
             ELSE                                                               
                       MOVE 'H'              TO WS-CDE-ERROR                    
             END-IF.                                                            
                                                                                
                                                                                
       655-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       656-CHK-CHG-RECOVERY.                                                    
      ******************************************************************        
                                                                                
             MOVE ZEROS                          TO  WS-AMT-TXN.                
             IF KD05-AMT-HSGNT     > 0 AND                                      
                F526-AMT-TXN       > 0                                          
                COMPUTE  WS-AMT-TXN = KD05-AMT-HSGNT-RECOVER                    
                                    + F526-AMT-TXN                              
                IF (KD05-AMT-HSGNT-RECOVER      =  KD05-AMT-HSGNT    )          
                                               OR                               
                               (  WS-AMT-TXN   > KD05-AMT-HSGNT     )           
                   MOVE 'G'                    TO  WS-CDE-ERROR                 
                ELSE                                                            
                   COMPUTE  KD05-AMT-HSGNT-RECOVER     =                        
                            KD05-AMT-HSGNT-RECOVER     +                        
                            F526-AMT-TXN                                        
                   MOVE  F526-DTE-TXN     TO KD05-DTE-HSGNT-RECOVER             
                   PERFORM    654-REWRITE-KD05      THRU     654-EXIT           
                END-IF                                                          
             ELSE                                                               
                   MOVE 'C'                   TO  WS-CDE-ERROR                  
             END-IF.                                                            
                                                                                
       656-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       657-CHK-SHG-RECOVERY.                                                    
      ******************************************************************        
                                                                                
             MOVE ZEROS                          TO  WS-AMT-TXN.                
             IF KD05-AMT-SHG-GRANT > 0 AND                                      
                F526-AMT-TXN       > 0                                          
                COMPUTE  WS-AMT-TXN = KD05-AMT-SHG-GRANT-RECOVER                
                                    + F526-AMT-TXN                              
                IF (KD05-AMT-SHG-GRANT-RECOVER  =  KD05-AMT-SHG-GRANT )         
                                               OR                               
                               (  WS-AMT-TXN   > KD05-AMT-SHG-GRANT )           
                   MOVE 'G'                    TO  WS-CDE-ERROR                 
                ELSE                                                            
                   COMPUTE  KD05-AMT-SHG-GRANT-RECOVER =                        
                            KD05-AMT-SHG-GRANT-RECOVER +                        
                            F526-AMT-TXN                                        
                   MOVE  F526-DTE-TXN     TO KD05-DTE-SHG-GRANT-RECOVER         
                   PERFORM    654-REWRITE-KD05      THRU     654-EXIT           
                END-IF                                                          
             ELSE                                                               
                   MOVE 'Z'               TO WS-CDE-ERROR                       
             END-IF.                                                            
                                                                                
                                                                                
                                                                                
       657-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       658-CHK-SUG-RECOVERY.                                                    
      ******************************************************************        
                                                                                
             MOVE ZEROS                          TO  WS-AMT-TXN.                
             IF KD05-AMT-SUG-GRANT > 0 AND                                      
                F526-AMT-TXN       > 0                                          
                COMPUTE  WS-AMT-TXN = KD05-AMT-SUG-GRANT-RECOVER                
                                    + F526-AMT-TXN                              
                IF (KD05-AMT-SUG-GRANT-RECOVER  =  KD05-AMT-SUG-GRANT )         
                                               OR                               
                               (  WS-AMT-TXN   > KD05-AMT-SUG-GRANT )           
                   MOVE 'G'                    TO  WS-CDE-ERROR                 
                ELSE                                                            
                   COMPUTE  KD05-AMT-SUG-GRANT-RECOVER =                        
                            KD05-AMT-SUG-GRANT-RECOVER +                        
                            F526-AMT-TXN                                        
                   MOVE  F526-DTE-TXN     TO KD05-DTE-SUG-GRANT-RECOVER         
                   PERFORM    654-REWRITE-KD05      THRU     654-EXIT           
                END-IF                                                          
             ELSE                                                               
                   MOVE 'U'               TO WS-CDE-ERROR                       
             END-IF.                                                            
                                                                                
       658-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       700-MOVE-VALUES-TO-K130.                                                 
      ******************************************************************        
                                                                                
           MOVE  SPACES                TO    BP13K130-CDHIST.                   
           INITIALIZE                        BP13K130-CDHIST.                   
           MOVE '11'                   TO    K130-TRANS-TYPE.                   
           MOVE F526-NUM-REF           TO    K130-NUM-ORIG-REGN.                
           IF WS-K800-REC-FND = 'Y'                                             
             IF F526-NUM-UIN  = SPACES OR LOW-VALUES                            
              MOVE K800-NUM-NRIC1         TO    K130-NUM-NRIC                   
             ELSE                                                               
                MOVE F526-NUM-UIN         TO   K130-NUM-NRIC                    
             END-IF                                                             
           ELSE                                                                 
              MOVE SPACES                 TO    K130-NUM-NRIC                   
           END-IF.                                                              
           MOVE F526-DTE-TXN           TO    K130-DTE-POST                      
                                             K130-DTE-TRANS.                    
           MOVE WS-COUNT-HISTORY       TO    K130-COUNT-HISTORY.                
           IF F526-AMT-TXN IS NOT NUMERIC                                       
              MOVE ZEROS               TO    F526-AMT-TXN                       
           END-IF.                                                              
           IF F526-NUM-RCPTCD = '6154A' OR '6088Z' OR '0520C' OR '1224I'        
                                                              OR '6254D'        
              MOVE F526-AMT-TXN        TO    K130-AMT-CASH                      
           ELSE                                                                 
              COMPUTE  K130-AMT-CASH =  F526-AMT-TXN * -1                       
           END-IF.                                                              
           MOVE F526-NUM-CRDR          TO    K130-AMT-TYP.                      
           MOVE F526-NUM-HDBREF        TO    K130-NUM-SCH-ACCT.                 
           MOVE F526-NUM-RCPT          TO    K130-NUM-RECPT-JRNO.               
           MOVE F526-NUM-RCPTCD        TO    K130-NUM-RECEIPT-CODE.             
                                                                                
           MOVE SPACES                 TO    K130-NME-NAME                      
                                             K130-CDE-ERROR                     
                                             K130-CDE-VALID                     
                                             K130-CDE-CANCEL                    
                                             K130-CDE-BO                        
                                             K130-NUM-FLAT-TYPE-SA              
                                             K130-NUM-FLAT-TYPE-RSL             
                                             K130-NUM-CPF-APPL.                 
           EVALUATE F526-NUM-RCPTCD                                             
              WHEN '6154A'                                                      
              WHEN '6088Z'                                                      
              WHEN '6095I'                                                      
                   MOVE 'ADV'           TO K130-PAYMENT-TYPE                    
              WHEN '1279J'                                                      
                   MOVE 'CHG'           TO K130-PAYMENT-TYPE                    
              WHEN '1277G'                                                      
              WHEN '6020H'                                                      
              WHEN '6014J'                                                      
                   MOVE 'AHG'           TO K130-PAYMENT-TYPE                    
              WHEN '0520C'                                                      
              WHEN '1224I'                                                      
              WHEN '6254D'                                                      
                   MOVE 'INT'           TO K130-PAYMENT-TYPE                    
              WHEN '6011E'                                                      
              WHEN '6021Z'                                                      
                   MOVE 'SHG'           TO K130-PAYMENT-TYPE                    
              WHEN '6015B'                                                      
                   MOVE 'SUG'           TO K130-PAYMENT-TYPE                    
                                                                                
           END-EVALUATE.                                                        
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       750-MOVE-VALUES-TO-K140.                                                 
      ******************************************************************        
                                                                                
           MOVE  SPACES                TO    BP13K140-KIVTRAN.                  
           ADD   1                     TO    WS-CNT-HIST.                       
           MOVE F526-NUM-REF           TO    K140-NUM-REGN.                     
           IF WS-K800-REC-FND = 'Y'                                             
                                                                                
              IF F526-NUM-UIN  = SPACES OR LOW-VALUES                           
                 MOVE K800-NUM-NRIC1         TO    K140-NUM-NRIC                
              ELSE                                                              
                 MOVE F526-NUM-UIN           TO    K140-NUM-NRIC                
              END-IF                                                            
           ELSE                                                                 
              MOVE SPACES                 TO    K140-NUM-NRIC                   
           END-IF.                                                              
           MOVE '11'                   TO    K140-CDE-TRANS-TYPE.               
           MOVE WS-DTE-CUR             TO    K140-DTE-POST.                     
           MOVE 'S'                    TO    K140-COUNT-HIST-CHAR.              
           MOVE WS-CNT-HIST            TO    K140-COUNT-HIST-NUM.               
           MOVE F526-NUM-RCPT          TO    K140-NUM-RECPT-JRNO.               
           MOVE F526-NUM-CRDR          TO    K140-CDE-CRDR.                     
           IF F526-AMT-TXN             IS    NOT NUMERIC                        
              MOVE  ZEROS              TO    F526-AMT-TXN                       
           END-IF.                                                              
           IF F526-NUM-RCPTCD = '6154A' OR '6088Z' OR '0520C' OR '1224I'        
                                                              OR '6254D'        
              MOVE F526-AMT-TXN        TO    K140-AMT-RECEIPT                   
           ELSE                                                                 
              COMPUTE K140-AMT-RECEIPT  = F526-AMT-TXN * -1                     
           END-IF.                                                              
           MOVE F526-DTE-TXN-DD        TO    WS-TRANS-DD.                       
           MOVE F526-DTE-TXN-MM        TO    WS-TRANS-MM.                       
           STRING F526-DTE-TXN-CC  F526-DTE-TXN-YY                              
           DELIMITED BY SIZE INTO      WS-TRANS-YYYY.                           
           MOVE WS-TRANS-DATE          TO    K140-DTE-TRANS.                    
           MOVE F526-NUM-HDBREF        TO    K140-NUM-SCH-ACCT.                 
           MOVE WS-CDE-ERROR           TO    K140-CDE-ERROR.                    
                                                                                
           EVALUATE F526-NUM-RCPTCD                                             
              WHEN '6154A'                                                      
              WHEN '6088Z'                                                      
                   MOVE 'ADV'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '1279J'                                                      
                   MOVE 'CHG'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '1277G'                                                      
              WHEN '6020H'                                                      
              WHEN '6014J'                                                      
                   MOVE 'AHG'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '0520C'                                                      
              WHEN '1224I'                                                      
              WHEN '6254D'                                                      
                   MOVE 'INT'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6011E'                                                      
              WHEN '6021Z'                                                      
                   MOVE 'SHG'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6182A'                                                      
                   MOVE 'BK '           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6038G'                                                      
                   MOVE 'SUS'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6183C'                                                      
                   MOVE 'SOC'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6163D'                                                      
                   MOVE 'SOL'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6046H'                                                      
                   MOVE 'RDE'           TO K140-CDE-PAYMENT-TYPE                
              WHEN '6015B'                                                      
                   MOVE 'SUG'           TO K140-CDE-PAYMENT-TYPE                
           END-EVALUATE.                                                        
                                                                                
       750-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       800-READ-BP13K130.                                                       
      ******************************************************************        
                                                                                
           MOVE F526-NUM-REF           TO    K130-NUM-ORIG-REGN.                
           MOVE F526-DTE-TXN           TO    K130-DTE-POST.                     
           ADD 1                       TO    WS-COUNT-HISTORY.                  
           MOVE WS-COUNT-HISTORY       TO    K130-COUNT-HISTORY.                
                                                                                
           READ BP13K130.                                                       
                                                                                
           IF WS-K130-STATUS = '00'                                             
              NEXT SENTENCE                                                     
           ELSE                                                                 
              IF  WS-K130-STATUS = '23'                                         
                  MOVE 'Y'  TO WS-K130-WRITTEN                                  
                  PERFORM 600-WRITE-BP13K130       THRU  600-EXIT.              
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-ERROR-LIST.                                                         
      *-------------------------------------------------------------            
                                                                                
           IF WS-LINE-CNT > 46                                                  
               MOVE 1 TO WS-LINE-CNT                                            
               PERFORM 1100-ERROR-HEADING THRU 1100-EXIT                        
           ELSE                                                                 
               ADD  1 TO WS-LINE-CNT.                                           
           IF F526-AMT-TXN       IS   NOT NUMERIC                               
              MOVE  ZEROS        TO   F526-AMT-TXN                              
           END-IF.                                                              
           ADD F526-AMT-TXN      TO   WS-AMT-KIV-TOTAL.                         
           ADD 1                 TO   CNT-KIV-CASES.                            
                                                                                
           EVALUATE WS-CDE-ERROR                                                
           WHEN 'A'                                                             
                 MOVE 'SCH-ACCT NO ERROR'       TO 13S1-REMARK                  
           WHEN 'R'                                                             
                 MOVE 'ORIGINAL REGN NUMBER ERROR' TO 13S1-REMARK               
           WHEN 'S'                                                             
                 MOVE 'NOT FD IN SOC-MASTER'    TO 13S1-REMARK                  
           WHEN 'G'                                                             
                 MOVE 'RECOVERY AMT >  GRANT'   TO 13S1-REMARK                  
           WHEN 'D'                                                             
                 MOVE 'REC NOTIN GRANT FILE'    TO 13S1-REMARK                  
           WHEN 'Z'                                                             
                 MOVE 'NO SHG GRANT'            TO 13S1-REMARK                  
           WHEN 'C'                                                             
                 MOVE 'NO CHG GRANT'            TO 13S1-REMARK                  
           WHEN 'H'                                                             
                 MOVE 'NO AHG GRANT'            TO 13S1-REMARK                  
           WHEN 'U'                                                             
                 MOVE 'NO SUG GRANT'            TO 13S1-REMARK                  
           END-EVALUATE.                                                        
           MOVE  CNT-KIV-CASES       TO 13S1-SNO.                               
           MOVE  F526-NUM-HDBREF     TO 13S1-NUM-SCHACCNT.                      
           MOVE  F526-NUM-REF        TO 13S1-ORIG-REG-NO.                       
           MOVE  'C'                 TO 13S1-CDE-HIST.                          
           MOVE  WS-CNT-HIST         TO 13S1-CNT-HIST.                          
           MOVE  F526-AMT-TXN        TO 13S1-AMT.                               
           EVALUATE F526-NUM-RCPTCD                                             
              WHEN '6154A'                                                      
              WHEN '6088Z'                                                      
                   MOVE 'ADV'           TO 13S1-PAYMENT-TYPE                    
              WHEN '1279J'                                                      
                   MOVE 'CHG'           TO 13S1-PAYMENT-TYPE                    
              WHEN '1277G'                                                      
              WHEN '6020H'                                                      
              WHEN '6014J'                                                      
                   MOVE 'AHG'           TO 13S1-PAYMENT-TYPE                    
              WHEN '0520C'                                                      
              WHEN '1224I'                                                      
              WHEN '6254D'                                                      
                   MOVE 'INT'           TO 13S1-PAYMENT-TYPE                    
              WHEN '6011E'                                                      
              WHEN '6021Z'                                                      
                   MOVE 'SHG'           TO 13S1-PAYMENT-TYPE                    
              WHEN '6015B'                                                      
                   MOVE 'SUG'           TO 13S1-PAYMENT-TYPE                    
              WHEN OTHER                                                        
                   MOVE 'OTH'           TO 13S1-PAYMENT-TYPE                    
           END-EVALUATE.                                                        
                                                                                
           STRING F526-DTE-TXN-CC  F526-DTE-TXN-YY                              
                  DELIMITED BY  SIZE INTO 13S1-POST-YYYY.                       
           MOVE F526-DTE-TXN-MM      TO 13S1-POST-MM.                           
           MOVE F526-DTE-TXN-DD      TO 13S1-POST-DD.                           
           MOVE F526-NUM-RCPT        TO 13S1-NUM-RECEIPT.                       
           WRITE PRINT-REC FROM L003-PR-DETAILS.                                
                                                                                
           MOVE SPACES               TO L003-PR-DETAILS.                        
           MOVE '/'                  TO 13S1-POST-FIL1                          
                                        13S1-POST-FIL2.                         
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1100-ERROR-HEADING.                                                      
      *-------------------------------------------------------------            
                                                                                
            ADD 1               TO WS-PAGE-CNT.                                 
            MOVE WS-PAGE-CNT    TO 13S1-PAGENO.                                 
            STRING WS-DD '/' WS-MM '/' WS-CC WS-YY                              
                   DELIMITED BY SIZE INTO 13S1-DATE.                            
            MOVE SPACES         TO PRINT-REC                                    
            WRITE PRINT-REC FROM L003-PR-HEAD-01 AFTER PAGE.                    
            WRITE PRINT-REC FROM L003-PR-HEAD-02 AFTER 2.                       
            WRITE PRINT-REC FROM L003-PR-HEAD-03 AFTER 2.                       
            INSPECT PRINT-REC REPLACING ALL SPACES BY LOW-VALUES.               
            INSPECT PRINT-REC REPLACING CHARACTERS BY '-'.                      
            INSPECT PRINT-REC REPLACING ALL LOW-VALUES BY SPACES.               
            WRITE PRINT-REC .                                                   
            MOVE SPACES TO PRINT-REC.                                           
            WRITE PRINT-REC AFTER 2.                                            
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************************************************************           
       900-CLOSE-FILES.                                                         
      ***************************************************************           
                                                                                
           DISPLAY '********* BP13C36A *********'.                              
           DISPLAY 'NO OF RECS PROCESSED (AC28F526) = ' WS-F526-READ.           
           DISPLAY 'NO OF RECS WRITTEN   (BP13K130) = ' WS-K130-WRITE.          
           DISPLAY 'NO OF RECS WRITTEN   (BP13K140) = ' WS-K140-WRITE.          
           DISPLAY 'NO OF RECS WRITTEN   (BP13K350) = ' WS-K350-WRITE.          
           DISPLAY 'NO OF RECS WRITTEN   (BP13K352) = ' WS-K352-WRITE.          
           DISPLAY 'NO OF RECS WRITTEN   (BP13F52A) = ' WS-F52A-WRITE.          
           DISPLAY 'NO OF RECS READ      (BM06K110) = ' WS-K110-READ.           
           DISPLAY 'NO OF RECS NOTFD     (BM06K110) = ' WS-K110-NOTFD.          
           DISPLAY 'NO OF RECS READ      (BP13K800) = ' WS-K800-READ.           
           DISPLAY 'NO OF RECS NOTFD     (BP13K800) = ' WS-K800-NOTFD.          
           DISPLAY 'NO OF RECS READ      (BP13KD05) = ' WS-KD05-READ.           
           DISPLAY 'NO OF RECS UPDATED   (BP13KD05) = ' WS-KD05-WRITE.          
                                                                                
           CLOSE AC28F526                                                       
                 BM06K110                                                       
                 BP13K800                                                       
                 BP13K130                                                       
                 BP13K140                                                       
                 BP13K350                                                       
                 BP13K352                                                       
                 BP13KD05                                                       
                 BP13F52A                                                       
                 BP13L36A.                                                      
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BM06K110. STATUS : ' WS-K110-STATUS        
              MOVE WS-K110-STATUS       TO   RETURN-CODE.                       
                                                                                
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13K800. STATUS : ' WS-K800-STATUS        
              MOVE WS-K800-STATUS       TO   RETURN-CODE.                       
                                                                                
           IF WS-K130-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13K130. STATUS : ' WS-K130-STATUS        
              MOVE WS-K130-STATUS       TO   RETURN-CODE.                       
                                                                                
           IF WS-K140-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13K140. STATUS : ' WS-K140-STATUS        
              MOVE WS-K140-STATUS       TO   RETURN-CODE.                       
                                                                                
           IF WS-K350-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13K350. STATUS : ' WS-K350-STATUS        
              MOVE WS-K350-STATUS       TO   RETURN-CODE.                       
                                                                                
           IF WS-K352-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13K352. STATUS : ' WS-K352-STATUS        
              MOVE WS-K352-STATUS       TO   RETURN-CODE.                       
                                                                                
           IF WS-KD05-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING ERROR BP13KD05. STATUS : ' WS-KD05-STATUS        
              MOVE WS-KD05-STATUS       TO   RETURN-CODE.                       
                                                                                
           STOP RUN.                                                            
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
