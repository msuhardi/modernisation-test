       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CC15.                                                 
       AUTHOR. BALA AMUTHAN.                                                    
       DATE-WRITTEN.  05/05/06.                                                 
                                                                                
      **********************************************************                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *                                                        *                
      *    SYSTEM ID : BP13                                    *                
      *                                                        *                
      *    OBJECTIVE  :                                        *                
      *        1.  THIS PROGRAMME WILL VALIDATE                *                
      *            NRIC-NO IN TRANSACTIONS FROM NCN            *                
      *            SYSTEM (CPF PAYMENT).                       *                
      *            IF THE RECORD DOES NOT MATCH, THE           *                
      *            OUTPUT RECORD WILL MOVE TO THE KIV          *                
      *            FILE (ERROR FILE).                          *                
      *                                                        *                
      *        2.  THE PREVIOUS PROGRAM ALREADY UPDATE THE     *                
      *            NCN FILE BY MATCHING THE CPF-NO IN BP13K820 *                
      *            TO GET THE NRIC.                            *                
      *                                                        *                
      *     INPUT FILES:                                       *                
      *           1. BP13F103 (WEEKLY CPF TRANSACTIONS)        *                
      *           2. BP13F800 (RFF)                            *                
      *           3. BP13KD00 (SUB-TRANSFER FILE)              *                
      *                                                        *                
      *     OUTPUT FILE:                                       *                
      *           1. BP13K140 (KIV FILE)                       *                
      *           2. BP13F125 (CPF TRANSACTIONS FILE)          *                
      *                                                        *                
      *     LISTINGS:                                          *                
      *           1. BP13LC15 (CONTROL LIST)                   *                
      *                                                        *                
      *  CHG-NO  BY   ON                                       *                
      * -----------------------------------------              *                
      * BP132857 BA2 050506 - SAME PGM AS BP13C101             *                
      * BP132857 LSB 081106 - OPTION FEE  OUTPUT AS OPT IN F125*                
      * BP132857 BA3 151106 - MOVE F103-KEY(3:11) TO F125      *                
      * BP132857 BA3 201106 - MOVE F103-PROC-DATE TO F125      *                
      * BP132838 BA3 080107 - GET PP-PAID FROM KD40-AMT-PP-CPF *                
      *                       OPT-RECEIVE FROM KD40-AMT-OPTION *                
      * BP133033 BA3 110407 - INCLUDE LUMP SUM (DBSS CAPITAL)  *                
      *                     - INCLUDE ADHOC    (DBSS ARREARS)  *                
      *              080507 - INCLUDE 'ARR-L'                  *                
      * BP133005 SSD 250507 - IF MATCH, TO READ BP13F800;      *                
      *                       REMOVE MOVING OF STATUS TO RC    *                
      * BP133052 BA3 130607 - REMOVE READING TO BP13F800 WHEN  *                
      *                       RECORD ARE MATCH TO CATER FOR    *                
      *                       MULTIPLE RECORDS IN BP13F800     *                
      * BP133115 BA3 161007 - ADD NUM-LOAN-SCH                 *                
      * BP133171 LSB 061107 - LUMPSUM PP                       *                
      * BP133091 RB12 161107  EXPAND KD00 LNGTH FR 1200 TO 1600*                
      * BP133450 JB8 091008   MOVE 'C' TO CR-DR                *                
      * BP133450 JB8 111108   TO GET THE RIGHT SCHDL           *                
      * BP133535 JB8 100209   TO READ KD03 IF KD00 NOT FND     *                
      * BP133545 JB8 270209   TO CATER FOR SOLICTOR-BILL IF    *                
      *                       DESC = 'DBSS STAMP'              *                
      * BP133752 JB8 090609   TO CATER FOR SUB-TRANSFER        *                
      * BP134245 JB8 160911   TO CATER FOR LOAN SCHEME         *                
      **********************************************************                
                                                                                
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F103 ASSIGN TO BP13F103.                                  
                                                                                
           SELECT BP13F800 ASSIGN TO BP13F800.                                  
                                                                                
           SELECT BP13K140 ASSIGN TO BP13K140                                   
                ACCESS MODE IS RANDOM                                           
                ORGANIZATION IS INDEXED                                         
                RECORD KEY IS K140-KEY-FLD                                      
                FILE STATUS IS K140-STATUS.                                     
                                                                                
           SELECT BP13KD00 ASSIGN TO BP13KD00                                   
                ACCESS MODE  IS RANDOM                                          
                ORGANIZATION IS INDEXED                                         
                RECORD KEY IS KD00-KEY-FLD                                      
                FILE STATUS IS KD00-STATUS.                                     
                                                                                
           SELECT BP13KD03 ASSIGN TO BP13KD03                                   
                ACCESS MODE  IS RANDOM                                          
                ORGANIZATION IS INDEXED                                         
                RECORD KEY IS KD03-KEY-FLD                                      
                FILE STATUS IS KD03-STATUS.                                     
                                                                                
           SELECT BP13KD40 ASSIGN TO BP13KD40                                   
                  ACCESS MODE IS DYNAMIC                                        
                  ORGANIZATION IS INDEXED                                       
                  RECORD KEY  IS KD40-KEY-FLD                                   
                  FILE STATUS IS KD40-STATUS.                                   
                                                                                
           SELECT BP13F125 ASSIGN TO BP13F125.                                  
                                                                                
           SELECT BP13LC15 ASSIGN TO BP13LC15.                                  
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F103                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 120 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F.                                                 
       COPY BP13F103.                                                           
                                                                                
       FD  BP13F800                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 2000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F.                                                 
       COPY BP13F800.                                                           
                                                                                
       FD  BP13F125                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       COPY BP13F125.                                                           
                                                                                
                                                                                
       FD  BP13K140                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13K140.                                                           
                                                                                
                                                                                
       FD  BP13KD00                                                             
           RECORD CONTAINS 1600 CHARACTERS.                                     
       COPY BP13KD00.                                                           
                                                                                
       FD  BP13KD03                                                             
           RECORD CONTAINS 1600 CHARACTERS.                                     
       COPY BP13KD03.                                                           
                                                                                
       FD  BP13KD40                                                             
           RECORD CONTAINS 1500 CHARACTERS.                                     
       COPY BP13KD40.                                                           
                                                                                
       FD  BP13LC15                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  PRINT-CONTROL-LIST             PIC X(132).                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  F800-STATUS                    PIC 99      VALUE ZEROES.             
       01  K140-STATUS                    PIC 99      VALUE ZEROES.             
       01  KD00-STATUS                    PIC 99      VALUE ZEROES.             
       01  KD03-STATUS                    PIC 99      VALUE ZEROES.             
       01  KD40-STATUS                    PIC 99      VALUE ZEROES.             
                                                                                
       01  WS-K140-STATUS.                                                      
           05  WS-K140-STATUS1            PIC 9.                                
           05  WS-K140-STATUS2            PIC 9.                                
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-F103-EOF-FLAG           PIC X       VALUE 'N'.                
           05  WS-F800-EOF-FLAG           PIC X       VALUE 'N'.                
           05  WS-KD40-EOF-FLAG           PIC X       VALUE 'N'.                
                                                                                
       01  WS-KD00-FND                    PIC X(1)    VALUE 'N'.                
       01  WS-KD03-FND                    PIC X(1)    VALUE 'N'.                
           88  KD03-FND                   VALUE 'Y'.                            
       01  WS-KD40-FND                    PIC X(1)    VALUE 'N'.                
       01  WS-CNT-BP13F103-READ           PIC 9(5)    VALUE ZEROES.             
       01  WS-CNT-BP13F800-READ           PIC 9(5)    VALUE ZEROES.             
       01  WS-CNT-K140-KIV                PIC 9(5)    VALUE ZEROES.             
       01  WS-CNT-F125-VALID              PIC 9(5)    VALUE ZEROES.             
       01  WS-CNT-KD00-READ               PIC 9(5)    VALUE ZEROES.             
       01  WS-CNT-KD40-READ               PIC 9(5)    VALUE ZEROES.             
       01  WS-K140-COUNT-HISTORY          PIC 9(2)    VALUE ZEROES.             
       01  WS-F125-COUNT-HISTORY          PIC 9(3)    VALUE ZEROES.             
       01  WS-CDE-APPLT                   PIC X       VALUE SPACES.             
       01  WS-NUM-NRIC                    PIC X(9)    VALUE SPACES.             
       01  WS-LINE-CNT                    PIC 9(5)    VALUE 00054.              
       01  WS-AMT-OPTION-RECV             PIC S9(06)V99 VALUE ZEROES.           
       01  WS-AMT-PP                      PIC S9(07)V99 VALUE ZEROES.           
       01  WS-PAGENO                      PIC 9(5)    VALUE ZEROES.             
       01  WS-SNO                         PIC 9(5)    VALUE ZEROES.             
       01  WS-AMT-TOT                     PIC 9(7)V99 VALUE ZEROES.             
                                                                                
       01  WS-CURRENT-DATE.                                                     
           05 WS-CCYY                     PIC 9999.                             
           05 WS-MM                       PIC 99.                               
           05 WS-DD                       PIC 99.                               
                                                                                
      ***************************************************************           
      *    HEADING AND CONTROL-LIST                                 *           
      ***************************************************************           
       01  WS-CONTROL-HEAD.                                                     
           05  FILLER                  PIC X(8)  VALUE 'BP13LC15'.              
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'HDBCAT3'.               
           05  FILLER                  PIC X(25) VALUE SPACES.                  
           05  FILLER                  PIC X(20) VALUE                          
                                       'S Y S T E M   O F   '.                  
           05  FILLER                  PIC X(19) VALUE                          
                                       'C O M M I T M E N T'.                   
           05  FILLER                  PIC X(15) VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'DATE :'.                
           05  CL-DATE-HD              PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'PAGE : '.               
           05  CL-PAGENO               PIC ZZZZ9 VALUE ZEROES.                  
           05  FILLER                  PIC X(1)  VALUE SPACES.                  
                                                                                
                                                                                
       01  WS-CONTROL-LIST-1.                                                   
           05  FILLER              PIC X(50)  VALUE SPACES.                     
           05  FILLER              PIC X(28)  VALUE                             
               'ERROR REPORT ON CPF PAYMENT'.                                   
           05  FILLER              PIC X(54)  VALUE SPACES.                     
                                                                                
       01  WS-CONTROL-LIST-2.                                                   
           05  FILLER              PIC X(10)  VALUE SPACES.                     
           05  FILLER              PIC X(04)  VALUE 'S/NO'.                     
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(06)  VALUE 'REG NO'.                   
           05  FILLER              PIC X(04)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE 'SCH-ACC'.                  
           05  FILLER              PIC X(05)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE 'PAYMENT'.                  
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(05)  VALUE 'JR-VR'.                    
           05  FILLER              PIC X(06)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE 'AMT-DEP'.                  
           05  FILLER              PIC X(03)  VALUE  SPACES.                    
           05  FILLER              PIC X(10)  VALUE  'AMT-INSTAL'.              
           05  FILLER              PIC X(03)  VALUE  SPACES.                    
           05  FILLER              PIC X(07)  VALUE  'REMARKS'.                 
           05  FILLER              PIC X(64)  VALUE  SPACES.                    
                                                                                
       01  WS-CONTROL-LIST-3.                                                   
           05  FILLER              PIC X(10)  VALUE SPACES.                     
           05  CL-SNO              PIC ZZZZ9  VALUE ZEROES.                     
           05  FILLER              PIC X(02)  VALUE SPACES.                     
           05  CL-RENO             PIC X(08)  VALUE SPACES.                     
           05  FILLER              PIC X(02)  VALUE SPACES.                     
           05  CL-SCH-ACC          PIC X(11)  VALUE SPACES.                     
           05  FILLER              PIC X(04)  VALUE SPACES.                     
           05  CL-PAY-TY           PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(04)  VALUE SPACES.                     
           05  CL-JR-VR            PIC X(09)  VALUE SPACES.                     
           05  FILLER              PIC X(02)  VALUE SPACES.                     
           05  CL-AMT-DEP          PIC ZZZZZ9.99    VALUE ZEROES.               
           05  FILLER              PIC X(02)  VALUE SPACES.                     
           05  CL-AMT-INSTAL       PIC ZZZZZ9.99    VALUE ZEROES.               
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  CL-REMARK           PIC X(50)  VALUE SPACES.                     
           05  FILLER              PIC X(23)  VALUE SPACES.                     
                                                                                
       01  WS-CONTROL-LIST-4.                                                   
           05  FILLER              PIC X(132) VALUE SPACES.                     
                                                                                
       01  WS-CONTROL-LIST-5.                                                   
      *    05  FILLER              PIC X(132) VALUE ALL '-'.                    
           05  FILLER              PIC X(10)  VALUE SPACES.                     
           05  FILLER              PIC X(04)  VALUE ALL '-'.                    
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(06)  VALUE ALL '-'.                    
           05  FILLER              PIC X(04)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE ALL '-'.                    
           05  FILLER              PIC X(05)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE ALL '-'.                    
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(05)  VALUE ALL '-'.                    
           05  FILLER              PIC X(06)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE ALL '-'.                    
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(10)  VALUE ALL '-'.                    
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  FILLER              PIC X(07)  VALUE ALL '-'.                    
           05  FILLER              PIC X(64)  VALUE SPACES.                     
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
                                                                                
      ******************************************************************        
      *        MAIN LINE PROCESS                                       *        
      ******************************************************************        
       MAIN-PROCESS.                                                            
           PERFORM 000-OPEN-FILE                THRU 000-EXIT.                  
           PERFORM 100-READ-F103                THRU 100-EXIT.                  
           PERFORM 200-READ-F800                THRU 200-EXIT.                  
           PERFORM 300-PROCESS-SEQUENTIAL-FILES THRU 300-EXIT                   
               UNTIL WS-F103-EOF-FLAG = 'Y'                                     
               AND   WS-F800-EOF-FLAG = 'Y'.                                    
           PERFORM 1000-CLOSE-ROUTINE           THRU 1000-EXIT.                 
                                                                                
      ***************************************************************           
      *    OPENING FILES SECTION                                    *           
      ***************************************************************           
                                                                                
       000-OPEN-FILE.                                                           
           OPEN INPUT  BP13F103                                                 
                       BP13F800                                                 
                       BP13KD00                                                 
                       BP13KD03                                                 
                       BP13KD40                                                 
                I-O    BP13K140                                                 
                OUTPUT BP13F125                                                 
                       BP13LC15.                                                
                                                                                
           IF K140-STATUS NOT = 0  AND                                          
              K140-STATUS NOT = 97                                              
              DISPLAY ' OPENING ERROR, BP13K140 STATUS ' K140-STATUS            
              MOVE K140-STATUS           TO RETURN-CODE                         
              PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT.                        
                                                                                
           IF KD00-STATUS NOT = 0  AND                                          
              KD00-STATUS NOT = 97                                              
              DISPLAY ' OPENING ERROR, BP13KD00 STATUS ' KD00-STATUS            
              MOVE KD00-STATUS           TO RETURN-CODE                         
              PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT.                        
                                                                                
           IF KD03-STATUS NOT = 0  AND                                          
              KD03-STATUS NOT = 97                                              
              DISPLAY ' OPENING ERROR, BP13KD03 STATUS ' KD03-STATUS            
              MOVE KD03-STATUS           TO RETURN-CODE                         
              PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT.                        
                                                                                
           IF KD40-STATUS NOT = 0  AND                                          
              KD40-STATUS NOT = 97                                              
              DISPLAY ' OPENING ERROR, BP13KD40 STATUS ' KD40-STATUS            
              MOVE KD40-STATUS           TO RETURN-CODE                         
              PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT.                        
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CURRENT-DATE.                  
           STRING WS-DD '/' WS-MM '/' WS-CCYY                                   
                  DELIMITED BY SIZE INTO CL-DATE-HD.                            
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ************************************************************              
      *    READ SEQUENTIAL FILE BP13F103                         *              
      ************************************************************              
                                                                                
       100-READ-F103.                                                           
                                                                                
           READ BP13F103                                                        
                AT END MOVE HIGH-VALUE  TO F103-KEY                             
                MOVE 'Y'        TO WS-F103-EOF-FLAG                             
                GO TO 100-EXIT.                                                 
           ADD  1                      TO WS-CNT-BP13F103-READ.                 
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
       200-READ-F800.                                                           
           READ BP13F800                                                        
                AT END MOVE HIGH-VALUE  TO F800-NUM-SCH-ACC                     
                MOVE 'Y'         TO WS-F800-EOF-FLAG                            
                GO TO 200-EXIT.                                                 
           ADD  1                       TO WS-CNT-BP13F800-READ.                
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
       300-PROCESS-SEQUENTIAL-FILES.                                            
                                                                                
           MOVE SPACES TO WS-CDE-APPLT  WS-NUM-NRIC CL-REMARK.                  
                                                                                
           IF F103-KEY(3:11) = F800-NUM-SCH-ACC                                 
               PERFORM 400-PROCESS-CPF  THRU 400-EXIT                           
               PERFORM 100-READ-F103    THRU 100-EXIT                           
           ELSE                                                                 
               IF F103-KEY(3:11) > F800-NUM-SCH-ACC                             
                  PERFORM 200-READ-F800 THRU 200-EXIT                           
               ELSE                                                             
                   MOVE SPACES                TO BP13K140-KIVTRAN               
                   INITIALIZE                    BP13K140-KIVTRAN               
                   MOVE 'A'                   TO K140-CDE-ERROR                 
                   MOVE 'SCH-ACC NUMBER NOT FOUND AT APPLICATION MASTER'        
                               TO CL-REMARK                                     
                   PERFORM 500-WRITE-KIV-REC  THRU 500-EXIT                     
                   PERFORM 100-READ-F103      THRU 100-EXIT                     
               END-IF                                                           
           END-IF.                                                              
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      * OUTPUT ERROR RECORD TO KIV FILE                                         
                                                                                
                                                                                
      ********************************************************                  
      * CHECK CPF-NO.  IF IT MATCHES CPF-NO1, MOVE '1' TO    *                  
      * CDE-APPLT-CPF, IT IT DOES NOT MATCH, PROCEED TO      *                  
      * NEXT PROCESSING.                                     *                  
      ********************************************************                  
                                                                                
       400-PROCESS-CPF.                                                         
                                                                                
           IF F103-AMT-REGN-DEP IS NOT NUMERIC                                  
              MOVE ZEROS TO F103-AMT-REGN-DEP                                   
           END-IF.                                                              
           MOVE 'N' TO WS-KD40-EOF-FLAG.                                        
           MOVE 'N' TO WS-KD40-FND.                                             
                                                                                
           IF F800-NUM-ALLO-CAT = 'DBS'                                         
              PERFORM 410-READ-KD00                THRU 410-EXIT                
              IF WS-KD00-FND = 'Y'                                              
                IF F103-DESC = 'DBSS LUMPSUM   ' OR                             
                               'DBSS STAMP     ' OR                             
                               'DBSS CONVY     '                                
                   PERFORM 420-START-KD40           THRU 420-EXIT               
                   IF WS-KD40-FND = 'Y'                                         
                      PERFORM 425-CHECK-OPTION-FEE THRU 425-EXIT                
                      PERFORM 430-OUTPUT-DBS-FILE  THRU 430-EXIT                
                   ELSE                                                         
                      MOVE SPACES TO BP13K140-KIVTRAN                           
                      INITIALIZE     BP13K140-KIVTRAN                           
                      MOVE 'NOT FOUND AT PP MASTER  ' TO CL-REMARK              
                      PERFORM 500-WRITE-KIV-REC    THRU 500-EXIT                
                   END-IF                                                       
                ELSE                                                            
                   PERFORM 430-OUTPUT-DBS-FILE     THRU 430-EXIT                
                END-IF                                                          
              ELSE                                                              
                MOVE SPACES TO BP13K140-KIVTRAN                                 
                INITIALIZE     BP13K140-KIVTRAN                                 
                MOVE 'AMOUNT OF REGN EQUAL ZEROES' TO CL-REMARK                 
                PERFORM 500-WRITE-KIV-REC          THRU 500-EXIT                
              END-IF                                                            
           ELSE                                                                 
              MOVE SPACES TO BP13K140-KIVTRAN                                   
              INITIALIZE     BP13K140-KIVTRAN                                   
              MOVE 'NOT A DBSS FLAT' TO CL-REMARK                               
              PERFORM 500-WRITE-KIV-REC            THRU 500-EXIT                
           END-IF.                                                              
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *****************************************************************         
      *    SEARCH F800-NUM-REGN  IN BP13KD00                          *         
      *****************************************************************         
                                                                                
       410-READ-KD00.                                                           
                                                                                
           MOVE   SPACES             TO     BP13KD00-REC.                       
           INITIALIZE                       BP13KD00-REC.                       
           MOVE  F800-NUM-REGN       TO     KD00-NUM-REGN.                      
           MOVE 'N'                  TO     WS-KD03-FND.                        
           READ BP13KD00.                                                       
           IF KD00-STATUS = 00 OR 02                                            
              MOVE 'Y'               TO     WS-KD00-FND                         
              ADD 1                  TO     WS-CNT-KD00-READ                    
           ELSE                                                                 
             IF KD00-STATUS = 23                                                
                PERFORM 411-READ-KD03      THRU 411-EXIT                        
                IF KD03-FND                                                     
                   MOVE BP13KD03-REC TO     BP13KD00-REC                        
                   MOVE 'Y'          TO     WS-KD00-FND                         
                   ADD 1             TO     WS-CNT-KD00-READ                    
                ELSE                                                            
                   MOVE 'N'          TO     WS-KD00-FND                         
                END-IF                                                          
             ELSE                                                               
                DISPLAY 'ERROR WITH READ OF BP13KD00. STATUS IS '               
                       KD00-STATUS                                              
                MOVE   KD00-STATUS   TO   RETURN-CODE                           
                PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT                       
             END-IF                                                             
           END-IF.                                                              
                                                                                
                                                                                
        410-EXIT.                                                               
            EXIT.                                                               
                                                                                
       411-READ-KD03.                                                           
                                                                                
           MOVE   SPACES             TO     BP13KD03-REC.                       
           INITIALIZE                       BP13KD03-REC.                       
           MOVE  F800-NUM-REGN       TO     KD03-NUM-REGN.                      
           READ BP13KD03.                                                       
           IF KD03-STATUS = 00 OR 02                                            
              MOVE 'Y'               TO     WS-KD03-FND                         
           ELSE                                                                 
             IF KD00-STATUS = 23                                                
                MOVE 'N'             TO     WS-KD03-FND                         
             ELSE                                                               
                DISPLAY 'ERROR WITH READ OF BP13KD03. STATUS IS '               
                       KD03-STATUS                                              
                MOVE   KD03-STATUS   TO   RETURN-CODE                           
                PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT                       
             END-IF                                                             
           END-IF.                                                              
                                                                                
                                                                                
        411-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       420-START-KD40.                                                          
                                                                                
           MOVE  SPACES              TO     KD40-KEY-FLD.                       
           MOVE  F800-NUM-REGN       TO     KD40-NUM-REGN.                      
           START BP13KD40 KEY >= KD40-KEY-FLD.                                  
                                                                                
           IF KD40-STATUS = 00 OR 02                                            
             PERFORM 423-READ-BP13KD40 THRU 423-EXIT                            
             PERFORM 424-PROCESS-BP13KD40 THRU 424-EXIT                         
                 UNTIL KD40-NUM-REGN NOT = F800-NUM-REGN                        
                 OR  WS-KD40-EOF-FLAG = 'Y'                                     
                 OR  WS-KD40-FND = 'Y'                                          
           ELSE                                                                 
             IF KD40-STATUS = 23                                                
                MOVE 'N' TO WS-KD40-FND                                         
             ELSE                                                               
                DISPLAY 'ERROR WITH START READ OF BP13KD40. STATUS IS '         
                       KD40-STATUS                                              
                MOVE KD40-STATUS   TO   RETURN-CODE                             
                PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT                       
             END-IF                                                             
           END-IF.                                                              
                                                                                
                                                                                
        420-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
        423-READ-BP13KD40.                                                      
                                                                                
              READ BP13KD40 NEXT AT END                                         
                    MOVE 'Y' TO WS-KD40-EOF-FLAG                                
                    GO TO 423-EXIT.                                             
                                                                                
              ADD 1    TO WS-CNT-KD40-READ.                                     
                                                                                
        423-EXIT.                                                               
            EXIT.                                                               
                                                                                
        424-PROCESS-BP13KD40.                                                   
                                                                                
           IF F103-DESC = 'DBSS LUMPSUM'                                        
              IF F103-NUM-CPF = KD40-NUM-CPF1                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-OPTION-CPF1 +                    
                                      KD40-AMT-PP-CPF1                          
              ELSE                                                              
                 IF F103-NUM-CPF = KD40-NUM-CPF2                                
                    COMPUTE WS-AMT-TOT = KD40-AMT-OPTION-CPF2 +                 
                                         KD40-AMT-PP-CPF2                       
                 ELSE                                                           
                    IF F103-NUM-CPF = KD40-NUM-CPF3                             
                       COMPUTE WS-AMT-TOT = KD40-AMT-OPTION-CPF3 +              
                                            KD40-AMT-PP-CPF3                    
                    ELSE                                                        
                       IF F103-NUM-CPF = KD40-NUM-CPF4                          
                          COMPUTE WS-AMT-TOT = KD40-AMT-OPTION-CPF4 +           
                                               KD40-AMT-PP-CPF4                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F103-DESC = 'DBSS STAMP'                                          
              IF F103-NUM-CPF = KD40-NUM-CPF1                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-MORT-STAMP-CPF1 +                
                                      KD40-AMT-CAVEAT-CPF1   +                  
                                      KD40-AMT-SNP-STAMP-CPF1 +                 
                                      KD40-AMT-LSE-ESCR-STAMP-CPF1 +            
                                      KD40-AMT-MORT-ESCR-STAMP-CPF1 +           
                                      KD40-AMT-SOLICITOR-BILL-CPF1 +            
                                      KD40-AMT-SURVEY-CPF1                      
                 IF KD40-NUM-PP-SCHDL = 'TR'                                    
                    COMPUTE WS-AMT-TOT = WS-AMT-TOT +                           
                                         KD40-AMT-TRF-WCAVEAT-CPF1 +            
                                         KD40-AMT-TRF-DOA-STAMP-CPF1            
                 END-IF                                                         
              ELSE                                                              
              IF F103-NUM-CPF = KD40-NUM-CPF2                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-MORT-STAMP-CPF2 +                
                                      KD40-AMT-CAVEAT-CPF2   +                  
                                      KD40-AMT-SNP-STAMP-CPF2 +                 
                                      KD40-AMT-LSE-ESCR-STAMP-CPF2 +            
                                      KD40-AMT-MORT-ESCR-STAMP-CPF2 +           
                                      KD40-AMT-SOLICITOR-BILL-CPF2 +            
                                      KD40-AMT-SURVEY-CPF2                      
                 IF KD40-NUM-PP-SCHDL = 'TR'                                    
                    COMPUTE WS-AMT-TOT = WS-AMT-TOT +                           
                                         KD40-AMT-TRF-WCAVEAT-CPF2 +            
                                         KD40-AMT-TRF-DOA-STAMP-CPF2            
                 END-IF                                                         
              ELSE                                                              
              IF F103-NUM-CPF = KD40-NUM-CPF3                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-MORT-STAMP-CPF3 +                
                                      KD40-AMT-CAVEAT-CPF3   +                  
                                      KD40-AMT-SNP-STAMP-CPF3 +                 
                                      KD40-AMT-LSE-ESCR-STAMP-CPF3 +            
                                      KD40-AMT-MORT-ESCR-STAMP-CPF3 +           
                                      KD40-AMT-SOLICITOR-BILL-CPF3 +            
                                      KD40-AMT-SURVEY-CPF3                      
                 IF KD40-NUM-PP-SCHDL = 'TR'                                    
                    COMPUTE WS-AMT-TOT = WS-AMT-TOT +                           
                                         KD40-AMT-TRF-WCAVEAT-CPF3 +            
                                         KD40-AMT-TRF-DOA-STAMP-CPF3            
                 END-IF                                                         
              ELSE                                                              
              IF F103-NUM-CPF = KD40-NUM-CPF4                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-MORT-STAMP-CPF4 +                
                                      KD40-AMT-CAVEAT-CPF4   +                  
                                      KD40-AMT-SNP-STAMP-CPF4 +                 
                                      KD40-AMT-LSE-ESCR-STAMP-CPF4 +            
                                      KD40-AMT-MORT-ESCR-STAMP-CPF4 +           
                                      KD40-AMT-SOLICITOR-BILL-CPF4 +            
                                      KD40-AMT-SURVEY-CPF4                      
                 IF KD40-NUM-PP-SCHDL = 'TR'                                    
                    COMPUTE WS-AMT-TOT = WS-AMT-TOT +                           
                                         KD40-AMT-TRF-WCAVEAT-CPF4 +            
                                         KD40-AMT-TRF-DOA-STAMP-CPF4            
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F103-DESC = 'DBSS CONVY'                                          
              IF F103-NUM-CPF = KD40-NUM-CPF1                                   
                 COMPUTE WS-AMT-TOT = KD40-AMT-CONVY-CPF1                       
                 IF KD40-NUM-PP-SCHDL = 'TR'                                    
                    COMPUTE WS-AMT-TOT = WS-AMT-TOT +                           
                                         KD40-AMT-TRF-CONVY-TROR-CPF1 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF1 +         
                                         KD40-AMT-TRF-CONVY-TDM-CPF1  +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF1           
                 END-IF                                                         
              ELSE                                                              
                 IF F103-NUM-CPF = KD40-NUM-CPF2                                
                    COMPUTE WS-AMT-TOT = KD40-AMT-CONVY-CPF2                    
                    IF KD40-NUM-PP-SCHDL = 'TR'                                 
                       COMPUTE WS-AMT-TOT = WS-AMT-TOT +                        
                                         KD40-AMT-TRF-CONVY-TROR-CPF2 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF2 +         
                                         KD40-AMT-TRF-CONVY-TDM-CPF2  +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF2           
                    END-IF                                                      
                 ELSE                                                           
                    IF F103-NUM-CPF = KD40-NUM-CPF3                             
                       COMPUTE WS-AMT-TOT = KD40-AMT-CONVY-CPF3                 
                       IF KD40-NUM-PP-SCHDL = 'TR'                              
                          COMPUTE WS-AMT-TOT = WS-AMT-TOT +                     
                                         KD40-AMT-TRF-CONVY-TROR-CPF3 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF3 +         
                                         KD40-AMT-TRF-CONVY-TDM-CPF3  +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF3           
                       END-IF                                                   
                    ELSE                                                        
                       IF F103-NUM-CPF = KD40-NUM-CPF4                          
                          COMPUTE WS-AMT-TOT = KD40-AMT-CONVY-CPF4              
                          IF KD40-NUM-PP-SCHDL = 'TR'                           
                             COMPUTE WS-AMT-TOT = WS-AMT-TOT +                  
                                         KD40-AMT-TRF-CONVY-TROR-CPF4 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF4 +         
                                         KD40-AMT-TRF-CONVY-TDM-CPF4  +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF4           
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD40-NUM-REGN = F800-NUM-REGN AND                                 
              F103-AMT-REGN-DEP = WS-AMT-TOT                                    
              MOVE 'Y'                   TO WS-KD40-FND                         
              GO TO 424-EXIT                                                    
           END-IF.                                                              
                                                                                
           PERFORM 423-READ-BP13KD40 THRU 423-EXIT.                             
                                                                                
      *                                                                         
        424-EXIT.                                                               
            EXIT.                                                               
      *                                                                         
      * CATER FOR LUMPSUM PP AND OPTION FEE REFUND                              
      *                                                                         
       425-CHECK-OPTION-FEE.                                                    
                                                                                
            MOVE ZEROS TO WS-AMT-OPTION-RECV.                                   
            MOVE ZEROS TO WS-AMT-PP.                                            
                                                                                
            IF F103-DESC = 'DBSS STAMP     ' OR                                 
                           'DBSS CONVY     '                                    
               GO TO 425-EXIT.                                                  
                                                                                
            IF KD40-AMT-OPTION-CPF1 NOT NUMERIC                                 
               MOVE ZEROS TO   KD40-AMT-OPTION-CPF1                             
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF2 NOT NUMERIC                                 
               MOVE ZEROS TO   KD40-AMT-OPTION-CPF2                             
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF3 NOT NUMERIC                                 
               MOVE ZEROS TO   KD40-AMT-OPTION-CPF3                             
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF4 NOT NUMERIC                                 
               MOVE ZEROS TO   KD40-AMT-OPTION-CPF4                             
            END-IF.                                                             
                                                                                
            IF KD40-AMT-PP-CPF1 NOT NUMERIC                                     
               MOVE ZEROS TO   KD40-AMT-PP-CPF1                                 
            END-IF.                                                             
                                                                                
            IF KD40-AMT-PP-CPF2 NOT NUMERIC                                     
               MOVE ZEROS TO   KD40-AMT-PP-CPF2                                 
            END-IF.                                                             
                                                                                
            IF KD40-AMT-PP-CPF3 NOT NUMERIC                                     
               MOVE ZEROS TO   KD40-AMT-PP-CPF3                                 
            END-IF.                                                             
                                                                                
            IF KD40-AMT-PP-CPF4 NOT NUMERIC                                     
               MOVE ZEROS TO   KD40-AMT-PP-CPF4                                 
            END-IF.                                                             
                                                                                
            MOVE    ZEROS TO WS-AMT-OPTION-RECV.                                
                                                                                
            IF F103-NUM-CPF =  KD40-NUM-CPF1                                    
               IF KD40-AMT-PP-CPF1 = ZEROS                                      
                 IF KD40-AMT-OPTION-CPF1 > ZEROS                                
                   COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF1            
                 ELSE                                                           
                     MOVE ZEROS TO WS-AMT-PP                                    
                 END-IF                                                         
               ELSE                                                             
                 IF KD40-AMT-OPTION-CPF1 > ZEROS                                
                    COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF1           
                    COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF1                        
                 ELSE                                                           
                   COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF1                         
                   MOVE ZEROS TO WS-AMT-OPTION-RECV                             
                 END-IF                                                         
                                                                                
            END-IF.                                                             
                                                                                
            IF F103-NUM-CPF =  KD40-NUM-CPF2                                    
               IF KD40-AMT-PP-CPF2 = ZEROS                                      
                 IF KD40-AMT-OPTION-CPF2 > ZEROS                                
                   COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF2            
                 ELSE                                                           
                   MOVE ZEROS TO WS-AMT-PP                                      
                 END-IF                                                         
               ELSE                                                             
                 IF KD40-AMT-OPTION-CPF2 > ZEROS                                
                    COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF2           
                    COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF2                        
                 ELSE                                                           
                   COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF2                         
                   MOVE ZEROS TO WS-AMT-OPTION-RECV                             
                 END-IF                                                         
            END-IF.                                                             
                                                                                
            IF F103-NUM-CPF =  KD40-NUM-CPF3                                    
               IF KD40-AMT-PP-CPF3 = ZEROS                                      
                 IF KD40-AMT-OPTION-CPF3 > ZEROS                                
                   COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF3            
                 ELSE                                                           
                   MOVE ZEROS TO WS-AMT-PP                                      
                 END-IF                                                         
               ELSE                                                             
                 IF KD40-AMT-OPTION-CPF3 > ZEROS                                
                    COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF3           
                    COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF3                        
                 ELSE                                                           
                   COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF3                         
                   MOVE ZEROS TO WS-AMT-OPTION-RECV                             
                 END-IF                                                         
            END-IF.                                                             
                                                                                
            IF F103-NUM-CPF =  KD40-NUM-CPF4                                    
               IF KD40-AMT-PP-CPF4 = ZEROS                                      
                 IF KD40-AMT-OPTION-CPF4 > ZEROS                                
                   COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF4            
                 ELSE                                                           
                   MOVE ZEROS TO WS-AMT-PP                                      
                 END-IF                                                         
               ELSE                                                             
                 IF KD40-AMT-OPTION-CPF4 > ZEROS                                
                    COMPUTE WS-AMT-OPTION-RECV = KD40-AMT-OPTION-CPF4           
                    COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF4                        
                 ELSE                                                           
                   COMPUTE WS-AMT-PP = KD40-AMT-PP-CPF4                         
                   MOVE ZEROS TO WS-AMT-OPTION-RECV                             
                 END-IF                                                         
            END-IF.                                                             
                                                                                
           IF WS-AMT-OPTION-RECV > ZEROS                                        
                                                                                
              MOVE SPACES                TO BP13F125-CASHTRAN                   
              INITIALIZE                    BP13F125-CASHTRAN                   
              PERFORM 435-MOVE-F125-DATA THRU 435-EXIT                          
              MOVE WS-AMT-OPTION-RECV TO F125-AMT-RECEIPT                       
              MOVE 'OPT'        TO F125-CDE-PAYMENT-TYPE                        
                                                                                
              WRITE BP13F125-CASHTRAN                                           
              ADD 1 TO WS-CNT-F125-VALID                                        
           END-IF.                                                              
                                                                                
       425-EXIT.                                                                
            EXIT.                                                               
                                                                                
       430-OUTPUT-DBS-FILE.                                                     
                                                                                
           MOVE SPACES                TO BP13F125-CASHTRAN.                     
           INITIALIZE                    BP13F125-CASHTRAN.                     
           PERFORM 435-MOVE-F125-DATA THRU 435-EXIT.                            
           IF F103-AMT-REGN-DEP > 0                                             
              IF F103-DESC = 'DBSS LUMPSUM   '                                  
                 IF WS-AMT-PP > ZEROS                                           
                     IF WS-AMT-OPTION-RECV = ZEROS                              
                       MOVE F103-AMT-REGN-DEP    TO F125-AMT-RECEIPT            
                     ELSE                                                       
                       MOVE WS-AMT-PP    TO F125-AMT-RECEIPT                    
                     END-IF                                                     
                     MOVE 'PP '        TO F125-CDE-PAYMENT-TYPE                 
                     IF KD03-FND                                                
                        MOVE 'Y'       TO F125-NUM-DBSS-TOP                     
                     END-IF                                                     
                 ELSE                                                           
                     GO TO 430-EXIT                                             
                 END-IF                                                         
              ELSE                                                              
              IF F103-DESC = 'DBSS STAMP     '                                  
                 MOVE 'DSP'             TO F125-CDE-PAYMENT-TYPE                
                 MOVE F103-AMT-REGN-DEP TO F125-AMT-RECEIPT                     
              ELSE                                                              
              IF F103-DESC = 'DBSS CONVY     '                                  
                 MOVE 'DCV'             TO F125-CDE-PAYMENT-TYPE                
                 MOVE F103-AMT-REGN-DEP TO F125-AMT-RECEIPT                     
              ELSE                                                              
              IF F103-DESC = 'DBSS CAPITAL   '                                  
                 MOVE 'LS '             TO F125-CDE-PAYMENT-TYPE                
                 MOVE F103-AMT-REGN-DEP TO F125-AMT-RECEIPT                     
              ELSE                                                              
              IF F103-DESC = 'DBSS ARREARS   '                                  
                 MOVE 'INS'             TO F125-CDE-PAYMENT-TYPE                
                 MOVE F103-AMT-REGN-DEP TO F125-AMT-RECEIPT                     
                 MOVE 'ARR-L'           TO F125-NUM-DOC                         
              END-IF                                                            
              END-IF                                                            
              END-IF                                                            
              END-IF                                                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F103-AMT-INSTAL IS NOT NUMERIC                                    
              MOVE 0 TO   F103-AMT-INSTAL.                                      
           IF F103-AMT-INSTAL     > 0 AND                                       
              F103-DESC = 'DBSS INSTALMENT'                                     
              MOVE F103-AMT-INSTAL TO F125-AMT-RECEIPT                          
              MOVE 'INS'           TO F125-CDE-PAYMENT-TYPE                     
           END-IF.                                                              
                                                                                
           MOVE KD00-CDE-LOAN-SCH TO F125-NUM-LOAN-SCH                          
                                                                                
           WRITE BP13F125-CASHTRAN.                                             
           ADD 1 TO WS-CNT-F125-VALID.                                          
                                                                                
       430-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       435-MOVE-F125-DATA.                                                      
                                                                                
           MOVE F800-NUM-REGN         TO F125-NUM-REGN.                         
           MOVE F103-PROC-DATE        TO F125-DTE-POST.                         
           MOVE ZEROS                 TO F125-COUNT-HISTORY.                    
           MOVE ZEROS                 TO F125-AMT-RECEIPT.                      
           MOVE F103-PROC-DATE        TO F125-DTE-TRANS.                        
           MOVE F103-KEY(3:11)        TO F125-NUM-SCH-ACCT.                     
           MOVE F103-JR-VR            TO F125-NUM-RECPT-JRNO.                   
           MOVE '12'                  TO F125-CDE-TRANS-TYPE.                   
           MOVE 'C'                   TO F125-CDE-CRDR.                         
                                                                                
           IF   F103-AMT-REGN-DEP IS NOT NUMERIC                                
                MOVE 0 TO   F103-AMT-REGN-DEP.                                  
           IF   F103-AMT-SUSP IS NOT NUMERIC                                    
                MOVE 0 TO   F103-AMT-SUSP.                                      
                                                                                
           IF  F103-NUM-NRIC NOT = SPACES                                       
               IF  F103-NUM-NRIC = F800-NUM-NRIC1                               
                   MOVE F800-NUM-NRIC1    TO   WS-NUM-NRIC                      
                   MOVE '1'               TO   WS-CDE-APPLT                     
               ELSE                                                             
               IF  F103-NUM-NRIC = F800-NUM-NRIC2                               
                   MOVE F800-NUM-NRIC2    TO   WS-NUM-NRIC                      
                   MOVE '2'               TO   WS-CDE-APPLT                     
               ELSE                                                             
               IF  F103-NUM-NRIC = F800-NUM-NRIC3                               
                   MOVE F800-NUM-NRIC3    TO   WS-NUM-NRIC                      
                   MOVE '3'               TO   WS-CDE-APPLT                     
               ELSE                                                             
               IF  F103-NUM-NRIC = F800-NUM-NRIC4                               
                   MOVE F800-NUM-NRIC4    TO   WS-NUM-NRIC                      
                   MOVE '4'               TO   WS-CDE-APPLT                     
               END-IF                                                           
           ELSE                                                                 
               MOVE SPACES            TO   WS-NUM-NRIC                          
                                           WS-CDE-APPLT                         
           END-IF.                                                              
                                                                                
           MOVE WS-NUM-NRIC           TO F125-NUM-NRIC.                         
           MOVE F103-NUM-CPF          TO F125-CDE-CPF-APPL.                     
           MOVE WS-CDE-APPLT          TO F125-CDE-APPLT-CPF.                    
           MOVE KD40-NUM-PP-SCHDL     TO F125-NUM-PP-SCHEDULE.                  
           MOVE KD40-DTE-PP-DUE       TO F125-DTE-PP-DUE.                       
                                                                                
       435-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       500-WRITE-KIV-REC.                                                       
                                                                                
           IF K140-CDE-ERROR NOT = 'A'                                          
              MOVE F800-NUM-REGN      TO K140-NUM-REGN                          
           END-IF.                                                              
           MOVE '12'                  TO K140-CDE-TRANS-TYPE.                   
           MOVE F103-PROC-DATE        TO K140-DTE-POST.                         
           ADD  1                     TO WS-K140-COUNT-HISTORY.                 
           MOVE 'N'                   TO K140-COUNT-HIST-CHAR.                  
           MOVE WS-K140-COUNT-HISTORY TO K140-COUNT-HIST-NUM.                   
           MOVE F103-PROC-DATE        TO K140-DTE-TRANS.                        
           MOVE F103-NUM-NRIC         TO K140-NUM-NRIC.                         
                                                                                
           IF F103-AMT-REGN-DEP IS NOT NUMERIC                                  
              MOVE 0 TO   F103-AMT-REGN-DEP.                                    
                                                                                
           IF F103-AMT-SUSP IS NOT NUMERIC                                      
              MOVE 0 TO   F103-AMT-SUSP.                                        
                                                                                
           IF F103-AMT-REGN-DEP > 0                                             
              MOVE F103-AMT-REGN-DEP TO K140-AMT-RECEIPT                        
              IF F103-DESC = 'DBSS LUMPSUM   '                                  
                 MOVE 'PP '           TO K140-CDE-PAYMENT-TYPE                  
              ELSE                                                              
              IF F103-DESC = 'DBSS STAMP     '                                  
                 MOVE 'DSP'           TO K140-CDE-PAYMENT-TYPE                  
              ELSE                                                              
              IF F103-DESC = 'DBSS CONVY     '                                  
                 MOVE 'DCV'           TO K140-CDE-PAYMENT-TYPE                  
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F103-AMT-INSTAL IS NOT NUMERIC                                    
              MOVE 0 TO   F103-AMT-INSTAL.                                      
                                                                                
           IF F103-AMT-INSTAL     > 0 AND                                       
              F103-DESC = 'DBSS INSTALMENT'                                     
              MOVE F103-AMT-INSTAL TO K140-AMT-RECEIPT                          
              MOVE 'INS'           TO K140-CDE-PAYMENT-TYPE                     
           END-IF.                                                              
                                                                                
           MOVE F103-JR-VR            TO K140-NUM-RECPT-JRNO.                   
           MOVE F103-KEY(3:11)        TO K140-NUM-SCH-ACCT.                     
           MOVE  'A' TO K140-CDE-ERROR.                                         
                                                                                
           WRITE BP13K140-KIVTRAN.                                              
                                                                                
           MOVE K140-STATUS TO  WS-K140-STATUS.                                 
                                                                                
           IF WS-K140-STATUS1 = 0                                               
              ADD 1 TO WS-CNT-K140-KIV                                          
           ELSE                                                                 
              IF K140-STATUS = 22                                               
                 DISPLAY ' ERROR WRITING DUP REC : ' K140-KEY-FLD               
              ELSE                                                              
                 DISPLAY ' OPENING ERROR, BP13K140 STATUS '                     
                         K140-STATUS                                            
                 MOVE K140-STATUS           TO   RETURN-CODE                    
                 PERFORM 1000-CLOSE-ROUTINE THRU 1000-EXIT                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 600-MOVE-VALUE-REPORT    THRU 600-EXIT.                      
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************************************************************         
      *    PRINT CONTROL-LIST                                         *         
      *****************************************************************         
                                                                                
       600-MOVE-VALUE-REPORT.                                                   
                                                                                
           IF WS-LINE-CNT > 53                                                  
              MOVE ZEROES              TO   WS-LINE-CNT                         
              PERFORM 610-PRINT-HEAD   THRU 610-EXIT                            
           END-IF.                                                              
                                                                                
           ADD +1                      TO   WS-SNO.                             
           MOVE  WS-SNO                TO   CL-SNO.                             
           MOVE  F800-NUM-REGN         TO   CL-RENO.                            
           MOVE  F103-KEY(3:11)        TO   CL-SCH-ACC.                         
           MOVE  K140-CDE-PAYMENT-TYPE TO   CL-PAY-TY.                          
           MOVE  F103-JR-VR            TO   CL-JR-VR.                           
           MOVE  F103-AMT-REGN-DEP     TO   CL-AMT-DEP.                         
           MOVE  F103-AMT-INSTAL       TO   CL-AMT-INSTAL.                      
                                                                                
           PERFORM 620-PRINT-REC       THRU 620-EXIT.                           
                                                                                
        600-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       610-PRINT-HEAD.                                                          
           ADD +1             TO WS-PAGENO.                                     
           MOVE WS-PAGENO     TO CL-PAGENO.                                     
           MOVE  SPACES       TO PRINT-CONTROL-LIST.                            
                                                                                
           WRITE PRINT-CONTROL-LIST AFTER PAGE.                                 
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-HEAD AFTER 3.               
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-LIST-1.                     
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-LIST-4.                     
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-LIST-2.                     
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-LIST-5.                     
           ADD +9             TO WS-LINE-CNT.                                   
                                                                                
       610-EXIT.                                                                
            EXIT.                                                               
                                                                                
                                                                                
       620-PRINT-REC.                                                           
           WRITE PRINT-CONTROL-LIST FROM WS-CONTROL-LIST-3.                     
           ADD +1  TO WS-LINE-CNT.                                              
                                                                                
       620-EXIT.                                                                
            EXIT.                                                               
                                                                                
                                                                                
       1000-CLOSE-ROUTINE.                                                      
                                                                                
           DISPLAY '******  BP13CC15 *************'.                            
           DISPLAY 'NO OF F103 READ      (F103) : '                             
                                             WS-CNT-BP13F103-READ.              
           DISPLAY 'NO OF RFF RECS READ  (F800) : '                             
                                             WS-CNT-BP13F800-READ.              
           DISPLAY 'NO OF KD00 REC READ  (KD00) : ' WS-CNT-KD00-READ.           
           DISPLAY 'NO OF KD40 REC READ  (KD40) : ' WS-CNT-KD40-READ.           
           DISPLAY 'NO OF F125 REC WRITE (F125) : ' WS-CNT-F125-VALID.          
           DISPLAY 'NO OF K140 REC WRITE (K140) : ' WS-CNT-K140-KIV.            
                                                                                
           CLOSE BP13F800                                                       
                 BP13F103                                                       
                 BP13F125                                                       
                 BP13K140                                                       
                 BP13KD00                                                       
                 BP13KD03                                                       
                 BP13LC15.                                                      
                                                                                
           IF K140-STATUS NOT = 0 AND K140-STATUS NOT = 97                      
               DISPLAY ' CLOSING ERROR, BP13K140 STATUS ' K140-STATUS.          
                                                                                
           IF KD00-STATUS NOT = 0 AND KD00-STATUS NOT = 97                      
               DISPLAY ' CLOSING ERROR, BP13KD00 STATUS ' KD00-STATUS.          
                                                                                
           IF KD03-STATUS NOT = 0 AND KD03-STATUS NOT = 97                      
               DISPLAY ' CLOSING ERROR, BP13KD03 STATUS ' KD03-STATUS.          
                                                                                
           IF KD40-STATUS NOT = 0 AND KD40-STATUS NOT = 97                      
               DISPLAY ' CLOSING ERROR, BP13KD40 STATUS ' KD40-STATUS.          
                                                                                
       1000-EXIT.                                                               
           STOP RUN.                                                            
