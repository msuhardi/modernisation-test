       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CB86.                                                 
       AUTHOR.        ZARITA SARMIENTO.                                         
       DATE-WRITTEN.  08/02/2010.                                               
      * ====================================================== *                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *    SYSTEM ID   : BP13                                  *                
      *    OBJECTIVE   : THIS PGM REPLICATES BP13F730          *                
      *                  ACCORDINGLY                           *                
      *                 MCPS FIRST TIMER    - OUTPUT 4 REC     *                
      *                 MCPS UPGRADER       - OUTPUT 2 REC     *                
      *                 NON-MCPS FIRST TIMER - OUTPUT 2 REC    *                
      *                 NON-MCPS UPGRADER    - OUTPUT 1 REC    *                
      *                                                        *                
      *                 FOR FIRST TIMER : ADD ON OUTPUT :      *                
      *                 4 UNSUCC ATTEMPT    - OUTPUT 1 REC     *                
      *                 5 UNSUCC ATTEMPT    - OUTPUT 2 REC     *                
      *                 AND ADD ON..                           *                
      *                                                        *                
      *    INPUT  FILE  : BP13F730  - CASES PER NRIC           *                
      *                   BP13K816                             *                
      *    OUTPUT FILE  : BP13F740  - F730 REPLICATED          *                
      *--------------------------------------------------------*                
      * CHG-NO   BY   DATE     DETAILS                         *                
      * BP133142 ED1 130707    NEW PROGRAM                     *                
      * ====================================================== *                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F740 ASSIGN TO BP13F740.                                  
           SELECT BP13F730 ASSIGN TO BP13F730.                                  
           SELECT BP13F500 ASSIGN TO BP13F500.                                  
           SELECT BP13LB86 ASSIGN TO BP13LB86.                                  
           SELECT P13LB86B ASSIGN TO P13LB86B.                                  
                                                                                
           SELECT BP13K816 ASSIGN TO BP13K816                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K816-KEY-FLD                               
                  FILE STATUS     IS WS-K816-STATUS.                            
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F740                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL RECORD IS STANDARD.                                           
       COPY BP13F740.                                                           
                                                                                
       FD   BP13F730                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL RECORD IS STANDARD.                                           
       COPY BP13F730.                                                           
                                                                                
       FD   BP13F500                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL RECORD IS STANDARD.                                           
       COPY BP13F500.                                                           
                                                                                
       FD   BP13K816                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K816.                                                           
                                                                                
       FD   BP13LB86                                                            
            RECORD CONTAINS   132 CHARACTERS                                    
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       01   LB86-PRTREC           PIC X(132).                                   
                                                                                
       FD   P13LB86B                                                            
            RECORD CONTAINS   100 CHARACTERS                                    
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
                                                                                
       01   LB86B-PRTREC.                                                       
           05  LB86B-REG-NO        PIC X(08).                                   
           05  LB86B-NRIC          PIC X(09).                                   
           05  LB86B-MCPS-TAG      PIC X(01).                                   
           05  LB86B-HH-TYPE       PIC X(01).                                   
           05  LB86B-ETHNIC        PIC X(01).                                   
           05  LB86B-UNS-CNT       PIC X(02).                                   
           05  LB86B-TOTAL         PIC X(02).                                   
           05  LB86B-MODE          PIC X(03).                                   
           05  LB86B-DTEBAL        PIC X(07).                                   
           05  LB86B-CDE-FT        PIC X(06).                                   
           05  LB86B-CDE-NT        PIC X(03).                                   
           05  FILLER              PIC X(56).                                   
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-F730-READ               PIC 9(5)  VALUE ZEROS.                 
           05 WS-F500-READ               PIC 9(5)  VALUE ZEROS.                 
           05 WS-F740-WRITE              PIC 9(5)  VALUE ZEROS.                 
           05 WS-LB86B-WRITE             PIC 9(5)  VALUE ZEROS.                 
           05 WS-SNO                     PIC 9(5)  VALUE 0.                     
           05 WS-PAGE                    PIC 9(4)  VALUE 0.                     
           05 WS-LINE-CTR                PIC 9(3)  VALUE 0.                     
           05 WS-COUNT                   PIC 99    VALUE 0.                     
           05 WS-CTR                     PIC 99    VALUE 0.                     
           05 WS-COUNT-P                 PIC 99    VALUE 0.                     
           05 WS-COUNT-SP                PIC 99    VALUE 0.                     
           05 WS-TOTAL                   PIC 99    VALUE 0.                     
           05 WS-GRAND-TOTAL             PIC 9(5)  VALUE 0.                     
                                                                                
       01  WS-NUM-PRIO                   PIC 99    VALUE 0.                     
       01  WS-NUM-UNSUC                  PIC 99    VALUE 0.                     
       01  WS-MCPS-TAG                   PIC X     VALUE SPACE.                 
       01  WS-MCPS-TAG-SP                PIC X     VALUE SPACE.                 
       01  WS-MAX-LINE                   PIC 9(2)  VALUE 58.                    
       01  WS-K816-STATUS                PIC 9(2)  VALUE 0.                     
       01  WS-CNT                        PIC 9(2)  VALUE 0.                     
       01  WS-MAX-UNSUCC                 PIC 9(2)  VALUE 0.                     
       01  WS-NRIC-UNSUC                 PIC X(9)  VALUE SPACES.                
       01  WS-MAX-CTR                    PIC 9(2)  VALUE 0.                     
       01  WS-EDITED-DATE                PIC X(10) VALUE SPACES.                
       01  WS-SYSTEM-DATE-TIME.                                                 
           05  WS-SYS-DATE               PIC X(08) VALUE SPACES.                
           05  WS-SYS-TIME               PIC X(08) VALUE SPACES.                
           05  FILLER                    PIC X(05) VALUE SPACES.                
                                                                                
       01  WS-PREV-KEY.                                                         
           05  WS-PREV-NT                PIC X(03) VALUE SPACES.                
           05  WS-PREV-FT                PIC X(01) VALUE SPACES.                
                                                                                
       01  WS-PREV-DATA.                                                        
           05  WS-PREV-MODE              PIC X(03) VALUE SPACES.                
           05  WS-PREV-DTEBAL            PIC X(06) VALUE SPACES.                
                                                                                
       01  WS-NEW-KEY.                                                          
           05  WS-NEW-NT                 PIC X(03) VALUE SPACES.                
           05  WS-NEW-FT                 PIC X(01) VALUE SPACES.                
                                                                                
       01  WS-EOF-F730                   PIC 9       VALUE ZERO.                
           88 EOF-F730                   VALUE 1.                               
                                                                                
       01  WS-EOF-F500                   PIC 9       VALUE ZERO.                
           88 EOF-F500                   VALUE 1.                               
                                                                                
       01  WS-BLANK-LINE  PIC X(132)             VALUE SPACES.                  
       01  WS-DASH-LINE   PIC X(132)             VALUE ALL '-'.                 
                                                                                
       01  LB86-PR-HEAD-01.                                                     
           05  FILLER             PIC X(08) VALUE 'BP13LB86'.                   
           05  FILLER             PIC X(05) VALUE SPACES.                       
           05  FILLER             PIC X(08) VALUE 'HDBCAT 3'.                   
           05  FILLER             PIC X(24) VALUE SPACES.                       
           05  FILLER             PIC X(39) VALUE                               
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER             PIC X(17) VALUE SPACES.                       
           05  FILLER             PIC X(06) VALUE 'DATE: '.                     
           05  LB86-DATE          PIC X(10).                                    
           05  FILLER             PIC X(03) VALUE SPACES.                       
           05  FILLER             PIC X(06) VALUE 'PAGE :'.                     
           05  LB86-PAGE          PIC ZZZ9.                                     
                                                                                
       01  LB86-PR-HEAD-02.                                                     
           05  FILLER             PIC X(45) VALUE SPACES.                       
           05  FILLER             PIC X(40) VALUE                               
               'REPORT DETAILS ON RANDOM NUMBER ISSUED'.                        
                                                                                
       01  LB86-PR-HEAD-3A.                                                     
           05  FILLER      PIC X(02) VALUE SPACES.                              
           05  FILLER      PIC X(17) VALUE 'MODE OF SALE   : '.                 
           05  LB86-MODE   PIC X(3).                                            
                                                                                
       01  LB86-PR-HEAD-3B.                                                     
           05  FILLER      PIC X(02) VALUE SPACES.                              
           05  FILLER      PIC X(17) VALUE 'BALLOT QUARTER : '.                 
           05  LB86-DTEBAL PIC X(7).                                            
                                                                                
       01  LB86-PR-HEAD-3C.                                                     
           05  FILLER      PIC X(02) VALUE SPACES.                              
           05  FILLER      PIC X(17) VALUE 'FLAT-TYPE      : '.                 
           05  LB86-CDE-FT PIC X(7).                                            
                                                                                
       01  LB86-PR-HEAD-3D.                                                     
           05  FILLER      PIC X(02) VALUE SPACES.                              
           05  FILLER      PIC X(17) VALUE 'NEW TOWN       : '.                 
           05  LB86-CDE-NT PIC X(30).                                           
                                                                                
       01  LB86-PR-HEAD-04.                                                     
           05  FILLER             PIC X(02) VALUE SPACES.                       
           05  FILLER             PIC X(51) VALUE                               
               'S/NO   REGN NO.   NRIC      MCPS  HOUSEHOLD  ETHNIC'.           
           05  FILLER             PIC X(40) VALUE                               
               '   TOTAL NO. OF '.                                              
                                                                                
       01  LB86-PR-HEAD-05.                                                     
           05  FILLER             PIC X(38) VALUE SPACES.                       
           05  FILLER             PIC X(50) VALUE                               
               'TYPE     GROUP    BALLOT CHANCES                 '.             
                                                                                
       01  LB86-PR-HEAD-06.                                                     
           05  FILLER             PIC X(02) VALUE SPACES.                       
           05  FILLER             PIC X(42) VALUE                               
               'TOTAL NUMBER OF RANDOM NUMBERS ASSIGNED : '.                    
           05  LB86-GRAND-TOTAL   PIC ZZZZ9.                                    
                                                                                
                                                                                
       01  LB86-PR-DETAILS.                                                     
           05  FILLER             PIC X(01) VALUE SPACES.                       
           05  LB86-SNO           PIC ZZZZ9 .                                   
           05  FILLER             PIC X(03) VALUE SPACES.                       
           05  LB86-REG-NO        PIC X(08).                                    
           05  FILLER             PIC X(02) VALUE SPACES.                       
           05  LB86-NRIC          PIC X(09).                                    
           05  FILLER             PIC X(03) VALUE SPACES.                       
           05  LB86-MCPS-TAG      PIC X(01).                                    
           05  FILLER             PIC X(07) VALUE SPACES.                       
           05  LB86-HH-TYPE       PIC X(01).                                    
           05  FILLER             PIC X(09) VALUE SPACES.                       
           05  LB86-ETHNIC        PIC X(01).                                    
           05  FILLER             PIC X(11) VALUE SPACES.                       
      *    05  LB86-UNS-CNT       PIC  Z9.                                      
      *    05  LB86-UNS-CNT-R REDEFINES LB86-UNS-CNT.                           
      *        10  LB86-UNS-CNT-X PIC XX.                                       
      *    05  FILLER             PIC X(15) VALUE SPACES.                       
           05  LB86-TOTAL         PIC  Z9.                                      
           05  LB86-TOTAL-R REDEFINES LB86-TOTAL.                               
               10  LB86-TOTAL-X   PIC XX.                                       
                                                                                
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
      ******************                                                        
       000-MAIN-ROUTINE.                                                        
      ******************                                                        
           PERFORM 100-INITIALIZATION THRU 100-EXIT.                            
           PERFORM 200-READ-F730      THRU 200-EXIT.                            
           PERFORM 250-READ-F500      THRU 250-EXIT.                            
           PERFORM 300-PROCESS-RTN    THRU 300-EXIT                             
             UNTIL EOF-F730 AND EOF-F500.                                       
           PERFORM 999-CLOSE-FILES    THRU 999-EXIT.                            
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ********************                                                      
       100-INITIALIZATION.                                                      
      ********************                                                      
           OPEN INPUT  BP13F730                                                 
                       BP13F500                                                 
                       BP13K816                                                 
                OUTPUT BP13F740                                                 
                       BP13LB86                                                 
                       P13LB86B.                                                
                                                                                
           IF WS-K816-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K816 FILE ERROR ' WS-K816-STATUS             
           END-IF.                                                              
                                                                                
           MOVE ZEROS                 TO WS-COUNTERS.                           
           MOVE FUNCTION CURRENT-DATE TO WS-SYSTEM-DATE-TIME.                   
                                                                                
           STRING WS-SYS-DATE(7:2) '/'                                          
                  WS-SYS-DATE(5:2) '/'                                          
                  WS-SYS-DATE(1:4)                                              
           DELIMITED BY SIZE INTO WS-EDITED-DATE.                               
                                                                                
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *****************                                                         
       200-READ-F730.                                                           
      *****************                                                         
           READ BP13F730 AT END                                                 
                MOVE 1               TO WS-EOF-F730                             
                GO TO 200-EXIT.                                                 
                                                                                
           MOVE  F730-CDE-NT1       TO WS-NEW-NT.                               
           MOVE  F730-CDE-FLAT-TYPE TO WS-NEW-FT.                               
                                                                                
           ADD  1                    TO WS-F730-READ.                           
                                                                                
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *****************                                                         
       250-READ-F500.                                                           
      *****************                                                         
           READ BP13F500 AT END                                                 
                MOVE 1               TO WS-EOF-F500                             
                GO TO 250-EXIT.                                                 
                                                                                
           ADD  1                    TO WS-F500-READ.                           
                                                                                
                                                                                
       250-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *****************                                                         
       300-PROCESS-RTN.                                                         
      *****************                                                         
           IF F730-NUM-JB-REGN = F500-NUM-REGN                                  
              MOVE  0      TO WS-COUNT                                          
              MOVE  0      TO WS-MAX-CTR                                        
      *       MOVE  0      TO WS-MAX-UNSUCC                                     
              MOVE  0      TO WS-TOTAL                                          
              MOVE  0      TO WS-NUM-PRIO                                       
              MOVE  0      TO WS-NUM-UNSUC                                      
              MOVE  SPACE  TO WS-MCPS-TAG                                       
              MOVE  SPACE  TO WS-MCPS-TAG-SP                                    
              MOVE  SPACES TO WS-NRIC-UNSUC                                     
                                                                                
              MOVE F730-CDE-NT1 TO K816-NUM-ZONE                                
              PERFORM 7200-READ-BP13K816 THRU 7200-EXIT                         
                                                                                
              IF WS-PREV-KEY = SPACES                                           
                 MOVE  F730-CDE-NT1       TO WS-PREV-NT                         
                 MOVE  F730-CDE-FLAT-TYPE TO WS-PREV-FT                         
              END-IF                                                            
                                                                                
              IF (F730-NUM-MCPS NOT = SPACE AND LOW-VALUE) AND                  
                 (F730-CDE-RESIDENT-HA1 NOT = 'H' AND                           
                  F730-CDE-RESIDENT-HA1 NOT = 'P' AND                           
                  F730-CDE-RESIDENT-HA1 NOT = 'M' )                             
                  MOVE 'Y' TO WS-MCPS-TAG                                       
                  PERFORM 400-PROCESS-MCPS    THRU 400-EXIT                     
              ELSE                                                              
                  MOVE 'N' TO WS-MCPS-TAG                                       
                  PERFORM 500-PROCESS-NONMCPS THRU 500-EXIT                     
              END-IF                                                            
                                                                                
      *       IF F730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                         
      *          IF F730-CDE-FLAT-TYPE NOT = '1A' AND '2A' AND 'SP'             
      *             PERFORM 7000-PROCESS-FT    THRU 7000-EXIT                   
      *          END-IF                                                         
      *       END-IF                                                            
                                                                                
                                                                                
              PERFORM 200-READ-F730   THRU 200-EXIT                             
              PERFORM 250-READ-F500   THRU 250-EXIT                             
                                                                                
              IF WS-PREV-KEY NOT = WS-NEW-KEY OR EOF-F730                       
                 PERFORM 320-PROCESS-DIFFREC  THRU 320-EXIT                     
              END-IF                                                            
                                                                                
           ELSE                                                                 
              IF F730-NUM-JB-REGN > F500-NUM-REGN                               
                 PERFORM 250-READ-F500 THRU 250-EXIT                            
              ELSE                                                              
                 PERFORM 200-READ-F730 THRU 200-EXIT                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ********************                                                      
       310-WRITE-BP13F740.                                                      
      ********************                                                      
           ADD  1               TO WS-NUM-PRIO.                                 
           MOVE BP13F730-REC    TO BP13F740-REC.                                
           MOVE WS-NUM-PRIO     TO F740-NUM-RANDOM-PRIORITY.                    
      *    MOVE WS-NUM-UNSUC    TO F740-NUM-WAIT-TIME.                          
                                                                                
           WRITE                   BP13F740-REC.                                
           ADD  1               TO WS-F740-WRITE.                               
                                                                                
                                                                                
       310-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ********************                                                      
       311-WRITE-BP13F740.                                                      
      ********************                                                      
           ADD  1               TO WS-NUM-PRIO.                                 
           MOVE BP13F500-REC    TO BP13F740-REC.                                
           MOVE WS-NUM-PRIO     TO F740-NUM-RANDOM-PRIORITY.                    
           MOVE WS-NUM-UNSUC    TO F740-NUM-WAIT-TIME.                          
                                                                                
           WRITE                   BP13F740-REC.                                
           ADD  1               TO WS-F740-WRITE.                               
                                                                                
                                                                                
       311-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      *********************                                                     
       320-PROCESS-DIFFREC.                                                     
      *********************                                                     
           MOVE  ZEROS               TO WS-SNO.                                 
           MOVE  F730-CDE-NT1        TO WS-PREV-NT.                             
           MOVE  F730-CDE-FLAT-TYPE  TO WS-PREV-FT.                             
                                                                                
           PERFORM 620-LOG-TOTAL   THRU 620-EXIT.                               
                                                                                
           MOVE  0                   TO WS-GRAND-TOTAL.                         
                                                                                
           IF NOT EOF-F730                                                      
              PERFORM 630-PRINT-CURR-HDR THRU 630-EXIT                          
           END-IF.                                                              
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************                                                        
       400-PROCESS-MCPS.                                                        
      ******************                                                        
                                                                                
           IF F730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                            
      *    FIRST TIMERS                                                         
      * -----------------                                                       
                  MOVE 4 TO WS-COUNT-P                                          
                                                                                
              ELSE                                                              
      *      UPGRADERS                                                          
      * -----------------                                                       
                  MOVE 2 TO WS-COUNT-P                                          
           END-IF.                                                              
                                                                                
           IF (F500-NUM-MCPS NOT = SPACE AND LOW-VALUE) AND                     
              (F500-CDE-RESIDENT-HA1 NOT = 'H' AND                              
               F500-CDE-RESIDENT-HA1 NOT = 'P' AND                              
               F500-CDE-RESIDENT-HA1 NOT = 'M' )                                
                                                                                
                MOVE 'Y' TO WS-MCPS-TAG-SP                                      
                                                                                
               IF F500-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                        
                MOVE 2 TO WS-COUNT-SP                                           
              ELSE                                                              
                MOVE 1 TO WS-COUNT-SP                                           
              END-IF                                                            
           ELSE                                                                 
              MOVE 'N' TO WS-MCPS-TAG-SP                                        
              MOVE 1 TO WS-COUNT-SP                                             
           END-IF.                                                              
                                                                                
           COMPUTE WS-COUNT = WS-COUNT-P * WS-COUNT-SP                          
           MOVE 0        TO WS-CTR                                              
                                                                                
           PERFORM 310-WRITE-BP13F740 THRU 310-EXIT                             
              VARYING WS-CTR   FROM 1 BY 1                                      
                 UNTIL WS-CTR  > WS-COUNT                                       
                                                                                
                                                                                
           PERFORM 600-LOG-REPORT  THRU 600-EXIT                                
                                                                                
           IF WS-TOTAL >= 4                                                     
              PERFORM 640-WRITE-P13LB86B THRU 640-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE ZEROES TO WS-NUM-PRIO                                           
           MOVE 0        TO WS-CTR                                              
                                                                                
           PERFORM 311-WRITE-BP13F740 THRU 311-EXIT                             
              VARYING WS-CTR   FROM 1 BY 1                                      
                 UNTIL WS-CTR  > WS-COUNT                                       
                                                                                
           PERFORM 601-LOG-REPORT  THRU 601-EXIT                                
                                                                                
           IF WS-TOTAL >= 4                                                     
              PERFORM 640-WRITE-P13LB86B THRU 640-EXIT                          
           END-IF.                                                              
                                                                                
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *********************                                                     
       500-PROCESS-NONMCPS.                                                     
      *********************                                                     
      * FIRST TIMERS                                                            
      * -----------------                                                       
           IF F730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                            
                  MOVE 2 TO WS-COUNT-P                                          
                                                                                
           ELSE                                                                 
      *      UPGRADERS                                                          
      * -----------------                                                       
      *           PERFORM 310-WRITE-BP13F740 THRU 310-EXIT                      
                  MOVE 1 TO WS-COUNT-P                                          
                                                                                
           END-IF.                                                              
                                                                                
           IF (F500-NUM-MCPS NOT = SPACE AND LOW-VALUE) AND                     
              (F500-CDE-RESIDENT-HA1 NOT = 'H' AND                              
               F500-CDE-RESIDENT-HA1 NOT = 'P' AND                              
               F500-CDE-RESIDENT-HA1 NOT = 'M' )                                
                MOVE 'Y' TO WS-MCPS-TAG-SP                                      
              IF F500-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                         
                MOVE 2 TO WS-COUNT-SP                                           
              ELSE                                                              
                MOVE 1 TO WS-COUNT-SP                                           
              END-IF                                                            
           ELSE                                                                 
              MOVE 1 TO WS-COUNT-SP                                             
              MOVE 'N' TO WS-MCPS-TAG-SP                                        
           END-IF.                                                              
                                                                                
           COMPUTE WS-COUNT = WS-COUNT-P * WS-COUNT-SP                          
           MOVE 0        TO WS-CTR                                              
                                                                                
           PERFORM 310-WRITE-BP13F740 THRU 310-EXIT                             
              VARYING WS-CTR   FROM 1 BY 1                                      
              UNTIL WS-CTR  > WS-COUNT.                                         
                                                                                
           PERFORM 600-LOG-REPORT  THRU 600-EXIT                                
                                                                                
           MOVE ZEROES TO WS-NUM-PRIO.                                          
           MOVE 0        TO WS-CTR.                                             
                                                                                
           PERFORM 311-WRITE-BP13F740 THRU 311-EXIT                             
              VARYING WS-CTR   FROM 1 BY 1                                      
              UNTIL WS-CTR  > WS-COUNT.                                         
                                                                                
           PERFORM 601-LOG-REPORT  THRU 601-EXIT                                
                                                                                
           IF WS-TOTAL >= 4                                                     
              PERFORM 640-WRITE-P13LB86B THRU 640-EXIT                          
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ****************                                                          
       600-LOG-REPORT.                                                          
      ****************                                                          
           MOVE SPACES  TO LB86-PR-DETAILS.                                     
           INITIALIZE      LB86-PR-DETAILS.                                     
                                                                                
           COMPUTE WS-TOTAL       = WS-COUNT       + WS-MAX-CTR.                
           COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL + WS-TOTAL.                  
                                                                                
           MOVE F730-NUM-REGN               TO LB86-REG-NO.                     
           MOVE F730-NUM-NRIC1              TO LB86-NRIC.                       
           MOVE F730-CDE-BALLOT-HOUSEHOLD   TO LB86-HH-TYPE.                    
           MOVE F730-CDE-CATEGORY           TO LB86-ETHNIC.                     
           MOVE WS-TOTAL                    TO LB86-TOTAL.                      
           MOVE WS-MCPS-TAG                 TO LB86-MCPS-TAG.                   
                                                                                
      *    IF F730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                            
      *        MOVE WS-MAX-UNSUCC TO LB86-UNS-CNT                               
      *    ELSE                                                                 
      *        MOVE SPACES        TO LB86-UNS-CNT-X                             
      *    END-IF.                                                              
                                                                                
           ADD   1                TO  WS-SNO.                                   
           MOVE  WS-SNO           TO  LB86-SNO.                                 
           MOVE  WS-EDITED-DATE   TO  LB86-DATE.                                
                                                                                
           IF WS-LINE-CTR > WS-MAX-LINE OR                                      
              WS-F730-READ = 1                                                  
              ADD          1   TO WS-PAGE                                       
              MOVE ZEROES      TO LB86-PAGE                                     
              MOVE WS-PAGE     TO LB86-PAGE                                     
              PERFORM 610-PRT-HEADING THRU 610-EXIT                             
           END-IF.                                                              
                                                                                
           STRING F730-CDE-FLAT-TYPE(1:1) DELIMITED BY ' '                      
                                        '-ROOM '                                
               DELIMITED BY SIZE INTO LB86-CDE-FT                               
           WRITE LB86-PRTREC FROM LB86-PR-DETAILS.                              
                                                                                
           ADD   1   TO   WS-LINE-CTR.                                          
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ****************                                                          
       601-LOG-REPORT.                                                          
      ****************                                                          
           MOVE SPACES  TO LB86-PR-DETAILS.                                     
           INITIALIZE      LB86-PR-DETAILS.                                     
                                                                                
           COMPUTE WS-TOTAL       = WS-COUNT       + WS-MAX-CTR.                
           COMPUTE WS-GRAND-TOTAL = WS-GRAND-TOTAL + WS-TOTAL.                  
                                                                                
           MOVE F500-NUM-REGN               TO LB86-REG-NO.                     
           MOVE F500-NUM-NRIC1              TO LB86-NRIC.                       
           MOVE F500-CDE-BALLOT-HOUSEHOLD   TO LB86-HH-TYPE.                    
           MOVE F500-CDE-CATEGORY           TO LB86-ETHNIC.                     
           MOVE WS-TOTAL                    TO LB86-TOTAL.                      
           MOVE WS-MCPS-TAG-SP              TO LB86-MCPS-TAG.                   
           MOVE '1-ROOM'                    TO LB86-CDE-FT.                     
                                                                                
      *    IF K730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T'                            
      *        MOVE WS-MAX-UNSUCC TO LB86-UNS-CNT                               
      *    ELSE                                                                 
      *        MOVE SPACES        TO LB86-UNS-CNT-X                             
      *    END-IF.                                                              
                                                                                
           ADD   1                TO  WS-SNO.                                   
           MOVE  WS-SNO           TO  LB86-SNO.                                 
           MOVE  WS-EDITED-DATE   TO  LB86-DATE.                                
                                                                                
      *    IF WS-LINE-CTR > WS-MAX-LINE OR                                      
      *       WS-F730-READ = 1                                                  
      *       ADD          1   TO WS-PAGE                                       
      *       MOVE ZEROES      TO LB86-PAGE                                     
      *       MOVE WS-PAGE     TO LB86-PAGE                                     
      *       PERFORM 610-PRT-HEADING THRU 610-EXIT                             
      *    END-IF.                                                              
                                                                                
           WRITE LB86-PRTREC FROM LB86-PR-DETAILS.                              
                                                                                
           ADD   1   TO   WS-LINE-CTR.                                          
                                                                                
       601-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************                                                         
       610-PRT-HEADING.                                                         
      *****************                                                         
      * POPULATE HEADER FIELDS                                                  
      *-------------------------------                                          
           MOVE F730-NUM-ALLO-CAT           TO LB86-MODE.                       
           IF F730-NUM-ALLO-CAT NOT  = 'BTO'                                    
               MOVE F730-CDE-NT1  TO LB86-CDE-NT                                
           ELSE                                                                 
               MOVE K816-NME-EST TO LB86-CDE-NT                                 
           END-IF.                                                              
                                                                                
           IF F730-DTE-BALLOT NOT = SPACES AND LOW-VALUES AND ZEROS             
               STRING F730-DTE-BALLOT(5:2) '/'                                  
                      F730-DTE-BALLOT(1:4)                                      
               DELIMITED BY SIZE INTO LB86-DTEBAL                               
           END-IF.                                                              
                                                                                
           IF F730-CDE-FLAT-TYPE NOT = SPACES AND LOW-VALUES AND ZEROS          
               STRING F730-CDE-FLAT-TYPE DELIMITED BY ' '                       
                                         '-ROOM '                               
               DELIMITED BY SIZE INTO LB86-CDE-FT                               
           END-IF.                                                              
                                                                                
      * PRINT REPORT                                                            
      *-------------------------------                                          
           WRITE LB86-PRTREC FROM WS-BLANK-LINE AFTER PAGE.                     
           WRITE LB86-PRTREC FROM WS-BLANK-LINE.                                
           WRITE LB86-PRTREC FROM WS-BLANK-LINE.                                
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-01.                              
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-02.                              
           WRITE LB86-PRTREC FROM WS-BLANK-LINE.                                
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-3A.                              
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-3B.                              
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-3C.                              
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-3D.                              
           WRITE LB86-PRTREC FROM WS-BLANK-LINE.                                
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-04.                              
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-05.                              
           WRITE LB86-PRTREC FROM WS-DASH-LINE.                                 
                                                                                
           INITIALIZE WS-LINE-CTR.                                              
           MOVE 14 TO WS-LINE-CTR.                                              
                                                                                
       610-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***************                                                           
       620-LOG-TOTAL.                                                           
      ***************                                                           
           MOVE WS-GRAND-TOTAL  TO LB86-GRAND-TOTAL.                            
           WRITE LB86-PRTREC FROM WS-BLANK-LINE.                                
           WRITE LB86-PRTREC FROM LB86-PR-HEAD-06.                              
           ADD 2 TO WS-LINE-CTR.                                                
                                                                                
       620-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ********************                                                      
       630-PRINT-CURR-HDR.                                                      
      ********************                                                      
           ADD          1      TO WS-PAGE.                                      
           MOVE ZEROES         TO LB86-PAGE.                                    
           MOVE WS-PAGE        TO LB86-PAGE.                                    
           MOVE F730-NUM-ALLO-CAT           TO LB86-MODE.                       
                                                                                
           IF F730-NUM-ALLO-CAT NOT  = 'BTO'                                    
               MOVE F730-CDE-NT1  TO LB86-CDE-NT                                
           ELSE                                                                 
               MOVE K816-NME-EST TO LB86-CDE-NT                                 
           END-IF.                                                              
                                                                                
           IF F730-DTE-BALLOT NOT = SPACES AND LOW-VALUES AND ZEROS             
               STRING F730-DTE-BALLOT(5:2) '/'                                  
                      F730-DTE-BALLOT(1:4)                                      
               DELIMITED BY SIZE INTO LB86-DTEBAL                               
           END-IF.                                                              
                                                                                
      *    IF F730-CDE-FLAT-TYPE NOT = SPACES AND LOW-VALUES AND ZEROS          
      *        STRING F730-CDE-FLAT-TYPE(1:1) DELIMITED BY ' '                  
      *                                  '-ROOM '                               
      *        DELIMITED BY SIZE INTO LB86-CDE-FT                               
      *    END-IF.                                                              
                                                                                
           PERFORM 610-PRT-HEADING  THRU 610-EXIT.                              
                                                                                
                                                                                
       630-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *********************                                                     
       640-WRITE-P13LB86B.                                                      
      *********************                                                     
           INITIALIZE     LB86B-PRTREC.                                         
           MOVE SPACES TO LB86B-PRTREC.                                         
           ADD 1               TO WS-LB86B-WRITE.                               
           MOVE LB86-REG-NO    TO LB86B-REG-NO.                                 
           MOVE LB86-NRIC      TO LB86B-NRIC.                                   
           MOVE LB86-MCPS-TAG  TO LB86B-MCPS-TAG.                               
           MOVE LB86-HH-TYPE   TO LB86B-HH-TYPE.                                
           MOVE LB86-ETHNIC    TO LB86B-ETHNIC.                                 
           IF LB86-TOTAL-X  NOT = SPACES AND LOW-VALUES AND ZEROS               
              MOVE LB86-TOTAL-X   TO LB86B-TOTAL                                
           END-IF.                                                              
      *    IF LB86-UNS-CNT-X NOT = SPACES AND LOW-VALUES AND ZEROS              
      *       MOVE LB86-UNS-CNT-X TO LB86B-UNS-CNT                              
      *    END-IF.                                                              
           MOVE LB86-MODE      TO LB86B-MODE.                                   
           MOVE LB86-DTEBAL    TO LB86B-DTEBAL.                                 
           MOVE LB86-CDE-FT    TO LB86B-CDE-FT.                                 
           MOVE F730-CDE-NT1   TO LB86B-CDE-NT.                                 
           WRITE LB86B-PRTREC.                                                  
                                                                                
       640-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *****************                                                         
       7000-PROCESS-FT.                                                         
      *****************                                                         
           IF WS-MAX-UNSUCC > 1                                                 
              COMPUTE WS-MAX-CTR = WS-MAX-UNSUCC - 1                            
                                                                                
              PERFORM VARYING WS-CNT FROM 1 BY 1                                
                        UNTIL WS-CNT > WS-MAX-CTR                               
                PERFORM 310-WRITE-BP13F740   THRU 310-EXIT                      
              END-PERFORM                                                       
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ********************                                                      
       7200-READ-BP13K816.                                                      
      ********************                                                      
           READ BP13K816.                                                       
                                                                                
           IF WS-K816-STATUS = 00 OR 23                                         
              CONTINUE                                                          
           ELSE                                                                 
              DISPLAY 'ERROR READING K816, STATUS ' WS-K816-STATUS              
                      ', KEY IS '  K816-KEY-FLD                                 
           END-IF.                                                              
                                                                                
       7200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ********************                                                      
       999-CLOSE-FILES.                                                         
      ********************                                                      
           CLOSE BP13F740                                                       
                 BP13F730                                                       
                 BP13K816                                                       
                 BP13LB86                                                       
                 P13LB86B.                                                      
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '* RUN DATE :  ' WS-EDITED-DATE.                             
           DISPLAY '*================ BP13CB86 ================*'.              
           DISPLAY '  NO. OF F730 RECORDS READ    = ' WS-F730-READ.             
           DISPLAY '  NO. OF F740 RECORDS WRITTEN = ' WS-F740-WRITE.            
           DISPLAY '*==========================================*'.              
                                                                                
           IF WS-K816-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13K816 FILE ERROR ' WS-K816-STATUS             
           END-IF.                                                              
                                                                                
                                                                                
           STOP RUN.                                                            
                                                                                
        999-EXIT.                                                               
            EXIT.                                                               
                                                                                
