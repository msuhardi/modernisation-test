       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C44D.                                         00020000
       AUTHOR.        ELGER DE GUZMAN                                   00030000
      *DATE-WRITTEN.  26/10/2013.                                       00040000
      * ===============================================================*00050000
      * SYSTEM NAME (SYSTEM ID)                                        *00060000
      * ===============================================================*00070000
      * OBJECTIVE   : CREATE MAIL FILE FOR LOAN TAG CHANGE             *00080000
      * BP134709  ESD1  261013  NEW PROGRAM                            *00090000
      * BP135537  RJB1  030315  CHANGE THE EMAIL RECIPIENT FROM        *00100000
      *                         NICKNAME INTO COMPLETE NAME            *00110000
      * BP136560  PCL4  161216  TO UPDATE EMAIL RECIPIENTS             *00120000
      * BP136851  KVL1  210817  REPLACED ALEX_C_LIM@HDB.GOV.SG WITH    *00130000
      *                         LAU_HONG_HUAT@HDB.GOV.SG               *00140000
      * BP137155  PCL4  080118  TO UPDATE EMAIL RECIPIENTS             *00150000
      * BP138757  KV8   150621  REPLACE HONG HUAT LAU with BERNICE     *00160000
      * BP139175  KAC1  290424  REPL Bernice_JH_GAN@hdb.gov.sg WITH    *00161003
      *                              Iris_LL_KOR@hdb.gov.sg            *00162003
      *================================================================*00170000
                                                                        00180000
      **********************                                            00190000
       ENVIRONMENT DIVISION.                                            00200000
      **********************                                            00210000
                                                                        00220000
       CONFIGURATION SECTION.                                           00230000
       SOURCE-COMPUTER. IBM-3090.                                       00240000
       OBJECT-COMPUTER. IBM-3090.                                       00250000
                                                                        00260000
       INPUT-OUTPUT SECTION.                                            00270000
       FILE-CONTROL.                                                    00280000
                                                                        00290000
           SELECT BP13K482  ASSIGN        TO BP13K482                   00300000
                            ACCESS MODE   IS RANDOM                     00310000
                            ORGANIZATION  IS INDEXED                    00320000
                            RECORD KEY    IS K482-KEY-FLD               00330000
                            FILE STATUS   IS K482-STATUS.               00340000
                                                                        00350000
           SELECT BP13F482  ASSIGN        TO BP13F482.                  00360000
                                                                        00370000
           SELECT MAILF482  ASSIGN        TO MAILF482.                  00380000
                                                                        00390000
      ****************                                                  00400000
       DATA DIVISION.                                                   00410000
      ****************                                                  00420000
                                                                        00430000
       FILE SECTION.                                                    00440000
      *-------------------------------------------------------------    00450000
       FD   BP13K482                                                    00460000
            RECORD CONTAINS 1000 CHARACTERS.                            00470000
       COPY BP13K482.                                                   00480000
                                                                        00490000
       FD  BP13F482                                                     00500000
           RECORDING MODE IS F                                          00510000
           RECORD CONTAINS 1000 CHARACTERS.                             00520000
       COPY BP13F482.                                                   00530000
                                                                        00540000
       FD  MAILF482                                                     00550000
           RECORDING MODE IS F                                          00560000
           RECORD CONTAINS 132 CHARACTERS.                              00570000
       01  MAILF482-REC      PIC X(132).                                00580000
                                                                        00590000
       WORKING-STORAGE SECTION.                                         00600000
      *-------------------------------------------------------------    00610000
                                                                        00620000
       01  WS-FILE-STATUS.                                              00630000
           05  K482-STATUS                      PIC 99    VALUE 00.     00640000
                                                                        00650000
       01  WS-SAVE-SCH                  PIC X(11)  VALUE SPACES.        00660000
       01  WS-SQL-CODE                  PIC 9(4)   VALUE ZEROS.         00670000
       01  WS-F482-EOF                  PIC X      VALUE 'N'.           00680000
       01  WS-DBSS-SW                   PIC X      VALUE 'N'.           00690000
       01  WS-F482RPT-COUNT             PIC 9(7)   VALUE ZERO.          00700000
       01  WS-UPDT-K482-CNT             PIC 9(7)   VALUE ZERO.          00710000
       01  WS-CTR                       PIC 9(2)   VALUE ZERO.          00720000
       01  WS-FIRST-REPORT              PIC X      VALUE 'Y'.           00730000
       01  WS-ADDRESS-FULL.                                             00740000
           05  WS-NUM-BLK-FLAT                  PIC X(05).              00750000
           05  WS-NME-STREET-FLAT               PIC X(32).              00760000
           05  WS-NUM-LEVEL-FLAT                PIC X(02).              00770000
           05  WS-NUM-MAIN-FLAT                 PIC X(04).              00780000
           05  WS-NUM-SUB-FLAT                  PIC X(03).              00790000
           05  WS-NUM-POSTAL-FLAT               PIC X(06).              00800000
                                                                        00810000
       01  WS-CUR-DATE.                                                 00820000
           05  WS-CUR-CCYY                  PIC 9(04).                  00830000
           05  WS-CUR-MM                    PIC 9(02).                  00840000
           05  WS-CUR-DD                    PIC 9(02).                  00850000
                                                                        00860000
       01  WS-REPORT-DTL.                                               00870000
           05  WS-CONSTANT-TXT.                                         00880000
               10 WS-TEXT-1.                                            00890000
                  15 FILLER                 PIC X(80)                   00900000
                  VALUE '1.   Please Withdraw caveat on the following fl00910000
      -           'at A :                        '.                     00920000
                                                                        00930000
               10 WS-TEXT-2.                                            00940000
                  15 FILLER                 PIC X(100)                  00950000
                  VALUE '2.   The buyers have opted for a bank loan or n00960000
      -           'o loan.                             '.               00970000
                                                                        00980000
               10 WS-TEXT-3.                                            00990000
                  15 FILLER                 PIC X(100)                  01000000
                  VALUE '3.   Please reply to us via the same email when01010000
      -           ' the caveat on flat A is withdrawn. '.               01020000
                                                                        01030000
               10 WS-TEXT-4.                                            01040000
                  15 FILLER                 PIC X(100)                  01050000
                  VALUE '4.   This is because applicant wish to take pos01060000
      -           'session of flat B urgently. Thank you.'.             01070000
                                                                        01080000
               10 WS-TEXT-5                 PIC X(8)                    01090000
                  VALUE '(signed)'.                                     01100000
                                                                        01110000
               10 WS-TEXT-6                 PIC X(4)                    01120000
                  VALUE 'BALA'.                                         01130000
                                                                        01140000
               10 WS-TEXT-7                 PIC X(80)                   01150000
                  VALUE 'SENIOR ADMINISTRATIVE EXECUTIVE'.              01160000
                                                                        01170000
               10 WS-TEXT-8                 PIC X(80)                   01180000
                  VALUE 'SALES OPERATIONS SECTION'.                     01190000
                                                                        01200000
               10 WS-TEXT-9                 PIC X(80)                   01210000
                  VALUE 'Cc   MA&B and COS - The DBSS 2nd con loan has c01220000
      -           'onverted to a bank or no loan.'.                     01230000
                                                                        01240000
           05  WS-HEADER1-RPT.                                          01250000
               10 FILLER                  PIC X(05) VALUE 'S/NO.'.      01260000
               10 FILLER                  PIC X(02) VALUE SPACES.       01270000
               10 FILLER                  PIC X(18)                     01280000
                                          VALUE 'SCHEME ACCOUNT NO.'.   01290000
               10 FILLER                  PIC X(02) VALUE SPACES.       01300000
               10 FILLER                  PIC X(07) VALUE 'ADDRESS'.    01310000
                                                                        01320000
           05  WS-HEADER2-RPT.                                          01330000
               10 FILLER                  PIC X(05) VALUE 'S/NO.'.      01340000
               10 FILLER                  PIC X(02) VALUE SPACES.       01350000
               10 FILLER                  PIC X(07) VALUE 'ADDRESS'.    01360000
               10 FILLER                  PIC X(65) VALUE SPACES.       01370000
               10 FILLER                  PIC X(21)                     01380000
                                       VALUE 'Title Search Result'.     01390000
               10 FILLER                  PIC X(03) VALUE SPACES.       01400000
               10 FILLER                  PIC X(24)                     01410000
                                       VALUE 'Reason if unsatisfactory'.01420000
           05  WS-DETAIL-RPT.                                           01430000
               10 WS-SNO-DTL                PIC Z99   VALUE ZERO.       01440000
               10 FILLER                    PIC X(4)  VALUE SPACES.     01450000
               10 WS-SCHEME-DTL             PIC X(11) VALUE SPACES.     01460000
               10 FILLER                    PIC X(9)  VALUE SPACES.     01470000
               10 WS-ADDR-DTL               PIC X(70) VALUE SPACES.     01480000
                                                                        01490000
           05  WS-DETAIL-RPT2.                                          01500000
               10 WS-SNO-DTL2               PIC Z99   VALUE ZERO.       01510000
               10 FILLER                    PIC X(2)  VALUE SPACES.     01520000
               10 WS-ADDR-DTL2              PIC X(67) VALUE SPACES.     01530000
               10 FILLER                    PIC X     VALUE SPACES.     01540000
               10 WS-STAT-DETAILS           PIC X(27) VALUE SPACES.     01550000
                                                                        01560000
           05  WS-DATE-RPT-DTL.                                         01570000
               10 FILLER                PIC X(6)  VALUE 'DATE: '.       01580000
               10 WS-DATE-RPT           PIC X(10) VALUE SPACES.         01590000
           05  WS-MAIL-RPT1             PIC X(12) VALUE 'HELO SGPHDB1'. 01600000
           05  WS-MAIL-RPT2             PIC X(27)                       01610000
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                        01620000
           05  WS-MAIL-RPT3             PIC X(60)                       01630000
               VALUE 'RCPT TO:<HENRY_EL_CHAN@HDB.GOV.SG>'.              01640000
           05  WS-MAIL-RPT4             PIC X(60)                       01650000
               VALUE 'RCPT TO:<ROLAND_KJ_KIU@HDB.GOV.SG>'.              01660000
           05  WS-MAIL-RPT4A            PIC X(60)                       01670000
               VALUE 'RCPT TO:<LAN_SECK_YONG@HDB.GOV.SG>'.              01680000
           05  WS-MAIL-RPT4B            PIC X(60)                       01690000
               VALUE 'RCPT TO:<EVELYN_KH_LEE@HDB.GOV.SG>'.              01700000
           05  WS-MAIL-RPT5             PIC X(60)                       01710000
               VALUE 'RCPT TO:<Iris_LL_KOR@hdb.gov.sg>'.                01720003
      *        VALUE 'RCPT TO:<Alex_C_LIM@HDB.GOV.SG>'.                 01730000
           05  WS-MAIL-RPT6             PIC X(60) VALUE                 01740000
               'RCPT TO:<BALASUBRAMANIAM_ARUNASALAM@HDB.GOV.SG>'.       01750000
           05  WS-MAIL-RPT7             PIC X(60) VALUE                 01760000
              'RCPT TO:<NOORJAHAN_SHAIK_MOHAMED_GULEMKADER@HDB.GOV.SG>'.01770000
           05  WS-MAIL-RPT7A            PIC X(60)                       01780000
               VALUE 'RCPT TO:<RAYMOND_HK_TANG@HDB.GOV.SG>'.            01790000
           05  WS-MAIL-RPT7B            PIC X(60)                       01800000
               VALUE 'RCPT TO:<JULIANAH_MOSTAJAP@HDB.GOV.SG>'.          01810000
           05  WS-MAIL-RPT7C            PIC X(60)                       01820000
               VALUE 'RCPT TO:<CHANDRA_LAGHA_ARUMUGAM@HDB.GOV.SG>'.     01830000
           05  WS-MAIL-RPT8             PIC X(60)                       01840000
               VALUE 'RCPT TO:<TAN_GEOK_MOOI@HDB.GOV.SG>'.              01850000
           05  WS-MAIL-RPT8A            PIC X(60)                       01860000
               VALUE 'RCPT TO:<PATRICIA_SS_CHIN@HDB.GOV.SG>'.           01870000
           05  WS-MAIL-RPT9             PIC X(4)                        01880000
               VALUE 'DATA'.                                            01890000
           05  WS-MAIL-RPT10            PIC X(29)                       01900000
               VALUE 'FROM:BALA - STAMPING TEAM    '.                   01910000
           05  WS-MAIL-RPT11            PIC X(60)                       01920000
               VALUE 'TO:<HENRY_EL_CHAN@HDB.GOV.SG>'.                   01930000
           05  WS-MAIL-RPT12            PIC X(60)                       01940000
               VALUE 'TO:<ROLAND_KJ_KIU@HDB.GOV.SG>'.                   01950000
           05  WS-MAIL-RPT12A           PIC X(60)                       01960000
               VALUE 'TO:<LAN_SECK_YONG@HDB.GOV.SG>'.                   01970000
           05  WS-MAIL-RPT12B           PIC X(60)                       01980000
               VALUE 'TO:<EVELYN_KH_LEE@HDB.GOV.SG>'.                   01990000
           05  WS-MAIL-RPT13            PIC X(60)                       02000000
               VALUE 'CC:<Iris_LL_KOR@hdb.gov.sg>'.                     02010003
      *        VALUE 'CC:<Alex_C_LIM@HDB.GOV.SG>'.                      02020000
           05  WS-MAIL-RPT14            PIC X(60) VALUE                 02030000
               'CC:<BALASUBRAMANIAM_ARUNASALAM@HDB.GOV.SG>'.            02040000
           05  WS-MAIL-RPT15            PIC X(60) VALUE                 02050000
               'CC:<NOORJAHAN_SHAIK_MOHAMED_GULEMKADER@HDB.GOV.SG>'.    02060000
           05  WS-MAIL-RPT15A           PIC X(60)                       02070000
               VALUE 'CC:<RAYMOND_HK_TANG@HDB.GOV.SG>'.                 02080000
           05  WS-MAIL-RPT15B           PIC X(60)                       02090000
               VALUE 'CC:<JULIANAH_MOSTAJAP@HDB.GOV.SG>'.               02100000
           05  WS-MAIL-RPT15C           PIC X(60)                       02110000
               VALUE 'CC:<CHANDRA_LAGHA_ARUMUGAM@HDB.GOV.SG>'.          02120000
           05  WS-MAIL-RPT16            PIC X(60)                       02130000
               VALUE 'CC:<TAN_GEOK_MOOI@HDB.GOV.SG>'.                   02140000
           05  WS-MAIL-RPT16A           PIC X(60)                       02150000
               VALUE 'CC:<PATRICIA_SS_CHIN@HDB.GOV.SG>'.                02160000
           05  WS-MAIL-RPT17            PIC X(34)                       02170000
               VALUE  'SUBJECT : PURCHASE OF FLAT AT BLK '.             02180000
           05  WS-MAIL-RPT18.                                           02190000
               10 WS-ADDR-RPT           PIC X(98).                      02200000
                                                                        02210000
      *----------------------------------------------------------------*02220000
      *    LINKAGE VARIABLES USED BY THE CALLED SUB-PROGRAM            *02230000
      *            (BP13C913)  TO RETRIEVE ADDRESS                     *02240000
      *----------------------------------------------------------------*02250000
       01  WS-LINK-REC.                                                 02260000
           05  WS-LINK-NUM-SCH-ACC.                                     02270000
               10  WS-LINK-NUM-SCH      PIC X(4).                       02280000
               10  WS-LINK-NUM-ACC      PIC X(5).                       02290000
                                                                        02300000
       COPY P13COMM8.                                                   02310000
                                                                        02320000
       PROCEDURE DIVISION.                                              02330000
      *=============================================================*   02340000
       MAIN.                                                            02350000
      *=============================================================*   02360000
                                                                        02370000
           PERFORM 1000-OPEN-ROUTINE    THRU 1000-EXIT.                 02380000
           PERFORM 2000-PROCESS-INDATA  THRU 2000-EXIT.                 02390000
           PERFORM 3000-GET-ALL-TRANS   THRU 3000-EXIT                  02400000
           UNTIL WS-F482-EOF = 'Y'.                                     02410000
           PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                 02420000
                                                                        02430000
      *=============================================================*   02440000
       1000-OPEN-ROUTINE.                                               02450000
      *=============================================================*   02460000
                                                                        02470000
           OPEN INPUT  BP13F482                                         02480000
                OUTPUT MAILF482                                         02490000
                I-O    BP13K482                                         02500000
                                                                        02510000
           INITIALIZE  BP13F482-REC                                     02520000
                       MAILF482-REC                                     02530000
                       BP13K482-REC.                                    02540000
                                                                        02550000
           IF K482-STATUS NOT = 00 AND 97                               02560000
              DISPLAY 'OPENING ERROR, K482-STATUS = ' K482-STATUS       02570000
              MOVE     K482-STATUS TO RETURN-CODE                       02580000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.               02590000
                                                                        02600000
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CUR-DATE.              02610000
                                                                        02620000
       1000-EXIT.                                                       02630000
           EXIT.                                                        02640000
                                                                        02650000
      *=============================================================*   02660000
       2000-PROCESS-INDATA.                                             02670000
      *=============================================================*   02680000
                                                                        02690000
            READ BP13F482                                               02700000
                 AT END MOVE 'Y'  TO WS-F482-EOF                        02710000
                        MOVE HIGH-VALUES TO F482-NUM-HDBREF-NEW         02720000
            END-READ.                                                   02730000
                                                                        02740000
       2000-EXIT.                                                       02750000
           EXIT.                                                        02760000
                                                                        02770000
      *=============================================================*   02780000
       3000-GET-ALL-TRANS.                                              02790000
      *=============================================================*   02800000
                                                                        02810000
            ADD   1   TO   WS-F482RPT-COUNT.                            02820000
            MOVE F482-NUM-HDBREF-NEW TO WS-SAVE-SCH.                    02830000
                                                                        02840000
            IF WS-F482RPT-COUNT > 1                                     02850000
               MOVE '.'     TO   MAILF482-REC                           02860000
               WRITE MAILF482-REC                                       02870000
            END-IF.                                                     02880000
                                                                        02890000
            MOVE 'N'  TO  WS-DBSS-SW                                    02900000
            PERFORM 4500-CREATE-REPORT   THRU  4500-EXIT.               02910000
                                                                        02920000
       3000-EXIT.                                                       02930000
           EXIT.                                                        02940000
                                                                        02950000
      *================================================================*02960000
       4000-PROCESS-REPORT.                                             02970000
      *================================================================*02980000
                                                                        02990000
           ADD   1   TO   WS-F482RPT-COUNT.                             03000000
                                                                        03010000
           IF WS-F482RPT-COUNT > 1                                      03020000
              MOVE '.'     TO   MAILF482-REC                            03030000
              WRITE MAILF482-REC                                        03040000
           END-IF.                                                      03050000
                                                                        03060000
           PERFORM 4500-CREATE-REPORT   THRU  4500-EXIT.                03070000
                                                                        03080000
       4000-EXIT.                                                       03090000
            EXIT.                                                       03100000
                                                                        03110000
      *================================================================*03120000
       4500-CREATE-REPORT.                                              03130000
      *================================================================*03140000
                                                                        03150000
            WRITE MAILF482-REC FROM WS-MAIL-RPT1                        03160000
            WRITE MAILF482-REC FROM WS-MAIL-RPT2                        03170000
            WRITE MAILF482-REC FROM WS-MAIL-RPT3                        03180000
            WRITE MAILF482-REC FROM WS-MAIL-RPT4                        03190000
            WRITE MAILF482-REC FROM WS-MAIL-RPT4A                       03200000
            WRITE MAILF482-REC FROM WS-MAIL-RPT4B                       03210000
      *     WRITE MAILF482-REC FROM WS-MAIL-RPT5                        03220000
            WRITE MAILF482-REC FROM WS-MAIL-RPT6                        03230000
            WRITE MAILF482-REC FROM WS-MAIL-RPT7                        03240000
            WRITE MAILF482-REC FROM WS-MAIL-RPT7A                       03250000
            WRITE MAILF482-REC FROM WS-MAIL-RPT7B                       03260000
            WRITE MAILF482-REC FROM WS-MAIL-RPT7C                       03270000
                                                                        03280000
            IF F482-NUM-REGN(1:1) = '5'                                 03290000
               WRITE MAILF482-REC FROM WS-MAIL-RPT8                     03300000
               WRITE MAILF482-REC FROM WS-MAIL-RPT8A                    03310000
            END-IF                                                      03320000
                                                                        03330000
            WRITE MAILF482-REC FROM WS-MAIL-RPT9                        03340000
            WRITE MAILF482-REC FROM WS-MAIL-RPT10                       03350000
            WRITE MAILF482-REC FROM WS-MAIL-RPT11                       03360000
            WRITE MAILF482-REC FROM WS-MAIL-RPT12                       03370000
            WRITE MAILF482-REC FROM WS-MAIL-RPT12A                      03380000
            WRITE MAILF482-REC FROM WS-MAIL-RPT12B                      03390000
      *     WRITE MAILF482-REC FROM WS-MAIL-RPT13                       03400000
            WRITE MAILF482-REC FROM WS-MAIL-RPT14                       03410000
            WRITE MAILF482-REC FROM WS-MAIL-RPT15                       03420000
            WRITE MAILF482-REC FROM WS-MAIL-RPT15A                      03430000
            WRITE MAILF482-REC FROM WS-MAIL-RPT15B                      03440000
            WRITE MAILF482-REC FROM WS-MAIL-RPT15C                      03450000
                                                                        03460000
            IF F482-NUM-REGN(1:1) = '5'                                 03470000
               MOVE 'Y'  TO  WS-DBSS-SW                                 03480000
               WRITE MAILF482-REC FROM WS-MAIL-RPT16                    03490000
               WRITE MAILF482-REC FROM WS-MAIL-RPT16A                   03500000
            END-IF                                                      03510000
                                                                        03520000
            MOVE SPACES            TO BP13COMM8-REC                     03530000
                                      WS-ADDRESS-FULL                   03540000
            INITIALIZE                BP13COMM8-REC                     03550000
            MOVE F482-NUM-HDBREF-NEW TO WS-LINK-REC                     03560000
            PERFORM 8000-CALL-BP13C913  THRU 8000-EXIT                  03570000
                                                                        03580000
            INSPECT WS-ADDRESS-FULL REPLACING LEADING SPACES BY ' '     03590000
            STRING WS-MAIL-RPT17                                        03600000
                   WS-NUM-BLK-FLAT ' #'                                 03610000
                   WS-NUM-LEVEL-FLAT '-'                                03620000
                   WS-NUM-MAIN-FLAT                                     03630000
                   WS-NUM-SUB-FLAT ' '                                  03640000
                   WS-NME-STREET-FLAT ' '                               03650000
                   'POSTAL: '                                           03660000
                   WS-NUM-POSTAL-FLAT ' ('                              03670000
                   F482-NUM-REGN   ') - FLAT B'                         03680000
                   DELIMITED BY '   '                                   03690000
            INTO   MAILF482-REC                                         03700000
            WRITE MAILF482-REC                                          03710000
            STRING WS-CUR-DD '/' WS-CUR-MM '/' WS-CUR-CCYY              03720000
                   DELIMITED BY SIZE INTO WS-DATE-RPT                   03730000
            WRITE MAILF482-REC FROM WS-DATE-RPT-DTL                     03740000
            MOVE SPACES TO  MAILF482-REC                                03750000
            WRITE   MAILF482-REC                                        03760000
            WRITE   MAILF482-REC   FROM  WS-TEXT-1                      03770000
            MOVE SPACES TO  MAILF482-REC                                03780000
            WRITE   MAILF482-REC                                        03790000
            WRITE   MAILF482-REC   FROM  WS-HEADER1-RPT                 03800000
                                                                        03810000
            PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 4         03820000
              MOVE WS-CTR     TO    WS-SNO-DTL                          03830000
              IF WS-SAVE-SCH NOT = F482-NUM-HDBREF-NEW                  03840000
                 MOVE SPACES TO WS-ADDR-DTL WS-SCHEME-DTL               03850000
              ELSE                                                      03860000
                 MOVE SPACES            TO BP13COMM8-REC                03870000
                                           WS-ADDRESS-FULL              03880000
                                           WS-ADDR-DTL                  03890000
                 INITIALIZE                BP13COMM8-REC                03900000
                 MOVE F482-NUM-HDBREF-DISPOSAL TO WS-LINK-REC           03910000
                                                  WS-SCHEME-DTL         03920000
                 PERFORM 8000-CALL-BP13C913  THRU 8000-EXIT             03930000
                                                                        03940000
                 INSPECT WS-ADDRESS-FULL REPLACING LEADING SPACES BY ' '03950000
                 STRING 'BLK '                                          03960000
                     WS-NUM-BLK-FLAT                ' '                 03970000
                     WS-NME-STREET-FLAT             ' #'                03980000
                     WS-NUM-LEVEL-FLAT              '-'                 03990000
                     WS-NUM-MAIN-FLAT                                   04000000
                     WS-NUM-SUB-FLAT                ' ('                04010000
                     WS-NUM-POSTAL-FLAT             ')'                 04020000
                     DELIMITED BY '   '                                 04030000
                 INTO WS-ADDR-DTL                                       04040000
                 PERFORM 5000-READ-BP13K482  THRU  5000-EXIT            04050000
                 PERFORM 2000-PROCESS-INDATA THRU 2000-EXIT             04060000
              END-IF                                                    04070000
                                                                        04080000
              WRITE  MAILF482-REC   FROM  WS-DETAIL-RPT                 04090000
                                                                        04100000
            END-PERFORM.                                                04110000
                                                                        04120000
            IF WS-SAVE-SCH = F482-NUM-HDBREF-NEW                        04130000
               PERFORM UNTIL WS-SAVE-SCH NOT = F482-NUM-HDBREF-NEW OR   04140000
                       WS-F482-EOF = 'Y'                                04150000
                   PERFORM 2000-PROCESS-INDATA THRU 2000-EXIT           04160000
                   MOVE F482-NUM-HDBREF-NEW TO WS-SAVE-SCH              04170000
               END-PERFORM                                              04180000
            END-IF.                                                     04190000
                                                                        04200000
            MOVE    SPACES         TO    MAILF482-REC                   04210000
            WRITE   MAILF482-REC                                        04220000
            WRITE   MAILF482-REC   FROM  WS-TEXT-2                      04230000
            MOVE    SPACES         TO    MAILF482-REC                   04240000
            WRITE   MAILF482-REC                                        04250000
            WRITE   MAILF482-REC   FROM  WS-TEXT-3                      04260000
            MOVE    SPACES         TO    MAILF482-REC                   04270000
            WRITE   MAILF482-REC                                        04280000
            WRITE   MAILF482-REC   FROM  WS-TEXT-4                      04290000
            MOVE    SPACES         TO    MAILF482-REC                   04300000
            WRITE   MAILF482-REC                                        04310000
            WRITE   MAILF482-REC   FROM  WS-TEXT-5                      04320000
            WRITE   MAILF482-REC   FROM  WS-TEXT-6                      04330000
            WRITE   MAILF482-REC   FROM  WS-TEXT-7                      04340000
            WRITE   MAILF482-REC   FROM  WS-TEXT-8                      04350000
            MOVE    SPACES         TO    MAILF482-REC                   04360000
            WRITE   MAILF482-REC                                        04370000
                                                                        04380000
            IF WS-DBSS-SW = 'Y'                                         04390000
               WRITE   MAILF482-REC   FROM  WS-TEXT-9                   04400000
            END-IF.                                                     04410000
                                                                        04420000
       4500-EXIT.                                                       04430000
            EXIT.                                                       04440000
                                                                        04450000
      ******************************************************************04460000
       5000-READ-BP13K482.                                              04470000
      ******************************************************************04480000
           MOVE SPACES TO BP13K482-REC.                                 04490000
           INITIALIZE  BP13K482-REC.                                    04500000
           MOVE F482-KEY-FLD TO K482-KEY-FLD                            04510000
                                                                        04520000
           READ BP13K482.                                               04530000
                                                                        04540000
           IF K482-STATUS = 00                                          04550000
              PERFORM 5100-UPDATE-BP13K482 THRU 5100-EXIT               04560000
           ELSE                                                         04570000
           IF K482-STATUS = 23                                          04580000
              DISPLAY 'RECORD NOT FOUND IN K482, STAT = ' K482-STATUS   04590000
              DISPLAY '           K482-KEY-FIELD      = ' F482-KEY-FLD  04600000
              MOVE  12            TO RETURN-CODE                        04610000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                04620000
           ELSE                                                         04630000
              DISPLAY 'ERROR READING BP13K482, STATUS = ' K482-STATUS   04640000
              DISPLAY '           K482-KEY-FIELD      = ' F482-KEY-FLD  04650000
              MOVE     K482-STATUS      TO     RETURN-CODE              04660000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.               04670000
                                                                        04680000
       5000-EXIT.                                                       04690000
            EXIT.                                                       04700000
                                                                        04710000
      ****************************************************************  04720000
       5100-UPDATE-BP13K482.                                            04730000
      *-------------------------------------------------------------    04740000
           MOVE   FUNCTION CURRENT-DATE(1:8)   TO   K482-DTE-UPDATE.    04750000
           MOVE   ' '  TO   K482-CDE-LOAN-TAG-CONVERSION                04760000
                            K482-CDE-LOAN-CNVERSN-EMAIL.                04770000
                                                                        04780000
           REWRITE BP13K482-REC.                                        04790000
                                                                        04800000
           IF K482-STATUS =  00                                         04810000
              ADD     1   TO WS-UPDT-K482-CNT                           04820000
           ELSE                                                         04830000
              DISPLAY 'ERROR UPDATING BP13K482, STAT = ' K482-STATUS    04840000
              DISPLAY '          K482-KEY-FIELD      = ' F482-KEY-FLD   04850000
              MOVE     K482-STATUS      TO     RETURN-CODE              04860000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                04870000
           END-IF.                                                      04880000
                                                                        04890000
       5100-EXIT.                                                       04900000
            EXIT.                                                       04910000
                                                                        04920000
      *------------------*                                              04930000
       8000-CALL-BP13C913.                                              04940000
      *------------------*                                              04950000
                                                                        04960000
           CALL 'BP13C913'  USING WS-LINK-REC,                          04970000
                                  BP13COMM8-REC.                        04980000
                                                                        04990000
                                                                        05000000
           IF COMM8-CDE-SYSERR = ZEROES                                 05010000
              MOVE COMM8-NUM-BLK          TO WS-NUM-BLK-FLAT            05020000
              MOVE COMM8-NME-STREET       TO WS-NME-STREET-FLAT         05030000
              MOVE COMM8-NUM-LEVEL        TO WS-NUM-LEVEL-FLAT          05040000
              MOVE COMM8-NUM-UNIT-MAIN    TO WS-NUM-MAIN-FLAT           05050000
              MOVE COMM8-NUM-UNIT-SUB     TO WS-NUM-SUB-FLAT            05060000
              MOVE COMM8-NUM-POSTAL-CODE  TO WS-NUM-POSTAL-FLAT         05070000
           ELSE                                                         05080000
             MOVE SPACES                 TO WS-NUM-BLK-FLAT             05090000
                                            WS-NME-STREET-FLAT          05100000
                                            WS-NUM-LEVEL-FLAT           05110000
                                            WS-NUM-MAIN-FLAT            05120000
                                            WS-NUM-SUB-FLAT             05130000
                                            WS-NUM-POSTAL-FLAT          05140000
             IF COMM8-CDE-SYSERR NOT = ZEROES                           05150000
                MOVE COMM8-CDE-SYSERR TO WS-SQL-CODE                    05160000
                IF COMM8-CDE-SYSERR = 100                               05170000
                 DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE   ' WS-SQL-CODE05180000
                ELSE                                                    05190000
                 DISPLAY 'ERROR READING PBF TABLE   ' WS-SQL-CODE.      05200000
                                                                        05210000
       8000-EXIT.                                                       05220000
            EXIT.                                                       05230000
                                                                        05240000
      *================================================================*05250000
       9000-CLOSE-ROUTINE.                                              05260000
      *================================================================*05270000
           DISPLAY 'TOTAL EMAIL CREATED: '                              05280000
                   WS-F482RPT-COUNT.                                    05290000
                                                                        05300000
           CLOSE BP13K482                                               05310000
                 BP13F482                                               05320000
                 MAILF482.                                              05330000
                                                                        05340000
           IF K482-STATUS NOT = 00 AND 97                               05350000
              DISPLAY 'ERROR CLOSING BP13K482, STATUS = ' K482-STATUS   05360000
              MOVE     K482-STATUS    TO    RETURN-CODE                 05370000
           END-IF.                                                      05380000
                                                                        05390000
           STOP RUN.                                                    05400000
                                                                        05410000
       9000-EXIT.                                                       05420000
           EXIT.                                                        05430000
