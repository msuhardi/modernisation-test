       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CC24.                                                 
       AUTHOR.        NINO ANGELO GARILLO.                                      
      *DATE-WRITTEN.  JUN2006.                                                  
      *****************************************************************         
      * SYSTEM OF COMMITMENT  (BP13)                                  *         
      *****************************************************************         
      * OBJECTIVES:  DELETE KD40 TO HISTORY FILE KD45                 *         
      *---------------------------------------------------------------*         
      * CHG REQ#  DATE        BY    DESCRIPTION                       *         
      * --------  ----------  ----  --------------------------------- *         
      * BP132706  06/26/2006  GAN1  NEW PROGRAM.                      *         
      * BP132888  08/16/2006  BA3   SUBTRACT PP LOAN FROM PP REQUIRED.*         
      *           03/01/2007  BA3   COMPUTE FOR LSE-ESCR-STAMP AND    *         
      *                             MORT-ESCR-STAMP WHEN PP SCHED IS  *         
      *                             NOT EQUAL TO '01'.                *         
      *                             REMOVED THE FF FIELDS:            *         
      *                                KD40-AMT-MORT-CONVY            *         
      *                                KD40-AMT-MORT-CONVY-CASH       *         
      *                                KD40-AMT-MORT-CONVY-CPF1       *         
      *                                KD40-AMT-MORT-CONVY-CPF2       *         
      *                                KD40-AMT-MORT-CONVY-CPF3       *         
      *                                KD40-AMT-MORT-CONVY-CPF4       *         
      *                                KD40-AMT-MORT-CONVY-GST.       *         
      *                             INCLUDED KD40-AMT-CONVY-GST.      *         
      *                             GENERATE REPORT FOR THE FF:       *         
      *                                PP01 > 05 DAYS OR              *         
      *                                PP OTHER THAN 01 > 02 DAYS     *         
      *           10/01/2007  BA3   PUT SPACE BETWEEN RECORDS WHEN    *         
      *                                PRINTED ON THE REPORT          *         
      *           11/01/2007  BA3   DELETED RECORD FROM BP13K600 WHEN *         
      *                                RECORD IS DBSS AND ACCEPTED    *         
      *                                DATE IS GREATER THAN 14 DAYS.  *         
      *                             OUTPUT RECORDS DELETED TO BP13F600*         
      *           25/01/2007  BA3   ADD FEES TOGETHER.                *         
      *                             COMMENT-OUT THE CONDITION:        *         
      *                             WS-DAYS-ACCEPTED > 14             *         
      * BP133051  17/05/2007  BA3   INCREMENT BYTE SIZE ON THE FF.    *         
      *                             VARS.: WS-DAYS-PP, WS-DAYS-PP01   *         
      * BP133250  10/03/2008  RB12  ADD SOLICITOR BILL FIELDS         *         
      * BP133387  28/07/2008  ED1   ADD SURVEY AMTS IN STAMP FEE      *         
      * BP133480  30/12/2008  JB8   REMOVE CHECK OF SCHED             *         
      * BP133907  21/07/2010  JB8   TO CATER FOR SUB-TRF              *         
      * BP136632  23/03/2017  KSJ3  TO EXPAND BP13K600 (1000 TO 1800) *         
      *****************************************************************         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.  IBM-3090.                                              
       OBJECT-COMPUTER.  IBM-3090.                                              
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT SY02F001  ASSIGN TO SY02F001.                                 
                                                                                
           SELECT BP13KD40  ASSIGN TO BP13KD40                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS SEQUENTIAL                                
                  RECORD KEY       IS KD40-KEY-FLD                              
                  FILE STATUS      IS WS-KD40-STATUS.                           
                                                                                
           SELECT BP13KD45  ASSIGN TO BP13KD45                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS DYNAMIC                                   
                  RECORD KEY       IS KD45-KEY-FLD                              
                  FILE STATUS      IS WS-KD45-STATUS.                           
                                                                                
           SELECT BP13K600 ASSIGN  TO BP13K600                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS DYNAMIC                                   
                  RECORD KEY       IS K600-KEY-FLD                              
      *           ALTERNATE KEY    IS K600-NUM-ALTX1                            
                  FILE STATUS      IS WS-K600-STATUS.                           
                                                                                
           SELECT BP13F600  ASSIGN TO BP13F600.                                 
           SELECT BP13LC24  ASSIGN TO BP13LC24.                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13KD40                                                            
            RECORD CONTAINS 1500 CHARACTERS.                                    
       COPY BP13KD40.                                                           
                                                                                
       FD   BP13KD45                                                            
            RECORD CONTAINS 1550 CHARACTERS.                                    
       COPY BP13KD45.                                                           
                                                                                
       FD   BP13K600                                                            
            RECORD CONTAINS 1800 CHARACTERS.                                    
       COPY BP13K600.                                                           
                                                                                
       FD  BP13F600                                                             
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 1800 CHARACTERS                                      
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD.                                          
       01  BP13F600-TRANS-REC    PIC X(1000).                                   
                                                                                
       FD  BP13LC24                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING MODE  IS  F                                                
           DATA RECORD     IS  PRINT-REC.                                       
       01  PRINT-REC                    PIC X(132).                             
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01 WS-READY-SW                      PIC X(01) VALUE 'N'.                 
       01 WS-END-OF-FILE                   PIC X(01) VALUE 'N'.                 
       01 WS-K600-EOF                      PIC X(01) VALUE 'N'.                 
       01 WS-KD40-STATUS                   PIC 9(02) VALUE ZEROES.              
       01 WS-KD45-STATUS                   PIC 9(02) VALUE ZEROES.              
       01 WS-K600-STATUS                   PIC 9(02) VALUE ZEROES.              
       01 WS-KD40-READ                     PIC 9(08) VALUE ZEROES.              
       01 WS-KD40-BYPASSED                 PIC 9(08) VALUE ZEROES.              
       01 WS-KD40-DELETED                  PIC 9(08) VALUE ZEROES.              
       01 WS-K600-DELETED                  PIC 9(08) VALUE ZEROES.              
       01 WS-KD45-WRITTEN                  PIC 9(08) VALUE ZEROES.              
       01 WS-F600-WRITTEN                  PIC 9(05) VALUE ZEROES.              
       01 WS-LC24-WRITTEN                  PIC 9(05) VALUE ZEROES.              
       01 WS-SN                            PIC 9(04) VALUE ZEROES.              
       01 WS-OTHER-VARIABLES.                                                   
          05 WS-CUR-TIME                   PIC X(09) VALUE SPACES.              
          05 WS-CUR-DATE.                                                       
             10 WS-CUR-CCYY                PIC X(04) VALUE SPACES.              
             10 WS-CUR-MM                  PIC X(02) VALUE SPACES.              
             10 WS-CUR-DD                  PIC X(02) VALUE SPACES.              
          05 REDEFINES WS-CUR-DATE.                                             
             10 WS-CURR-DATE               PIC 9(8).                            
          05 WS-EDT-DATE.                                                       
             10 WS-EDT-DD                  PIC X(02).                           
             10 FILLER                     PIC X(01) VALUE '/'.                 
             10 WS-EDT-MM                  PIC X(02).                           
             10 FILLER                     PIC X(01) VALUE '/'.                 
             10 WS-EDT-CCYY                PIC X(04).                           
       01 WS-PP-CASH-CPF-PD                PIC S9(7)V99 VALUE ZERO.             
       01 WS-STAMP-FEE-CASH                PIC S9(7)V99 VALUE ZERO.             
       01 WS-STAMP-FEE-CPF                 PIC S9(7)V99 VALUE ZERO.             
       01 WS-CONVY-FEE-CASH                PIC S9(7)V99 VALUE ZERO.             
       01 WS-CONVY-FEE-CPF                 PIC S9(7)V99 VALUE ZERO.             
       01 WS-FEE-REQ                       PIC S9(7)V99 VALUE ZERO.             
       01 WS-FEE-PD                        PIC S9(7)V99 VALUE ZERO.             
       01 WS-AMT-PP-REQ                    PIC S9(7)V99 VALUE ZERO.             
       01 WS-CURR-DTE-J                    PIC  9(8)    VALUE ZERO.             
       01 WS-PP-DTE-J                      PIC  9(8)    VALUE ZERO.             
       01 WS-DTE-ACCEPTED-J                PIC  9(8)    VALUE ZERO.             
       01 WS-PP-PYMT-DTE                   PIC  X(8)    VALUE SPACES.           
       01 REDEFINES WS-PP-PYMT-DTE.                                             
          05  WS-PP-PYMT-DATE              PIC  9(8).                           
       01 WS-DTE-ACCEPTED                  PIC  X(8)    VALUE SPACES.           
       01 REDEFINES WS-DTE-ACCEPTED.                                            
          05  WS-DATE-ACCEPTED             PIC  9(8).                           
       01 WS-DAYS-PP01                     PIC  9(5)    VALUE ZERO.             
       01 WS-DAYS-PP                       PIC  9(5)    VALUE ZERO.             
       01 WS-DAYS-ACCEPTED                 PIC  9(2)    VALUE ZERO.             
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-LINE-CNT             PIC 9(2)     VALUE 60.                   
           05  WS-PAGE-CNT             PIC 9(4)     VALUE ZEROES.               
                                                                                
       01  LC24-PR-HEAD-01.                                                     
           05  FILLER                  PIC X(8)  VALUE 'BP13LC24'.              
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(8)  VALUE 'HDBCAT 3'.              
           05  FILLER                  PIC X(24) VALUE SPACES.                  
           05  FILLER                  PIC X(20) VALUE                          
                                       'S Y S T E M   O F   '.                  
           05  FILLER                  PIC X(19) VALUE                          
                                       'C O M M I T M E N T'.                   
           05  FILLER                  PIC X(15) VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'DATE :'.                
           05  LC24-DATE               PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'PAGE : '.               
           05  LC24-PAGENO             PIC ZZZZ9 VALUE ZEROES.                  
                                                                                
       01  LC24-PR-HEAD-02.                                                     
           05  FILLER                  PIC X(41) VALUE SPACES.                  
           05  FILLER                  PIC X(46) VALUE                          
               'REPORT ON INSUFFICIENT/EXCEED CPF/CASH PAYMENT'.                
                                                                                
       01  LC24-PR-HEAD-03.                                                     
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  FILLER                  PIC X(3)  VALUE 'S/N'.                   
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(8)  VALUE ' REG-NO '.              
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  FILLER                  PIC X(3)  VALUE 'SCH'.                   
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(10) VALUE ' DUE-DATE '.            
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(09) VALUE ' PP-REQ '.              
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  FILLER                  PIC X(09) VALUE 'PP-LOAN'.               
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(6)  VALUE 'LS-REQ'.                
           05  FILLER                  PIC X(9)  VALUE SPACES.                  
           05  FILLER                  PIC X(05) VALUE 'LS-PD'.                 
           05  FILLER                  PIC X(7)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'FEE-REQ'.               
           05  FILLER                  PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(9)  VALUE 'FEE-PD'.                
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(10) VALUE 'REMARKS'.               
                                                                                
       01  LC24-PR-HEAD-04.                                                     
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  FILLER                  PIC X(3)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(8)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  FILLER                  PIC X(3)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(10) VALUE ALL '-'.                 
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(09) VALUE ALL '-'.                 
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  FILLER                  PIC X(07) VALUE ALL '-'.                 
           05  FILLER                  PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(6)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(9)  VALUE SPACES.                  
           05  FILLER                  PIC X(05) VALUE ALL '-'.                 
           05  FILLER                  PIC X(7)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(6)  VALUE ALL '-'.                 
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(07) VALUE ALL '-'.                 
                                                                                
       01  LC24-PR-DETAILS.                                                     
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-SN                 PIC ZZZ9  VALUE ZEROES.                  
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-REG-NO             PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-SCH                PIC X(3)  VALUE SPACES.                  
           05  FILLER                  PIC X(3)  VALUE SPACES.                  
           05  LC24-DUE-DATE           PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-PP-REQ             PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-PP-LOAN            PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-LS-REQ             PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-LS-PD              PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-FEE-REQ            PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-FEE-PD             PIC $,$$$,$$9.99 VALUE ZEROES.           
           05  FILLER                  PIC X(2)  VALUE SPACES.                  
           05  LC24-REMARKS            PIC X(10) VALUE SPACES.                  
                                                                                
       PROCEDURE DIVISION.                                                      
      *--------------------------------*                                        
       0000-MAIN-ROUTINE.                                                       
      *--------------------------------*                                        
           PERFORM 1000-INITIALIZATION    THRU 1000-EXIT.                       
           PERFORM 2000-READ-BP13KD40     THRU 2000-EXIT.                       
           PERFORM 3000-PROCESS-RECORDS   THRU 3000-EXIT                        
             UNTIL KD40-KEY-FLD = HIGH-VALUES.                                  
           PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       1000-INITIALIZATION.                                                     
      *--------------------------------*                                        
           OPEN INPUT  SY02F001                                                 
                OUTPUT BP13F600                                                 
                       BP13LC24                                                 
                I-O    BP13KD40                                                 
                       BP13KD45                                                 
                       BP13K600.                                                
                                                                                
           IF WS-KD40-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13KD40 ' WS-KD40-STATUS                
              MOVE WS-KD40-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-KD45-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13KD45 ' WS-KD45-STATUS                
              MOVE WS-KD45-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-K600-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K600 ' WS-K600-STATUS                
              MOVE WS-K600-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           PERFORM 1100-READ-SY02F001    THRU 1100-EXIT.                        
                                                                                
           MOVE WS-CUR-DD             TO WS-EDT-DD.                             
           MOVE WS-CUR-MM             TO WS-EDT-MM.                             
           MOVE WS-CUR-CCYY           TO WS-EDT-CCYY.                           
                                                                                
           STRING WS-CUR-DD '/'                                                 
                  WS-CUR-MM '/'                                                 
                  WS-CUR-CCYY                                                   
                  DELIMITED BY SIZE INTO LC24-DATE.                             
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       1100-READ-SY02F001.                                                      
      *----------------------------------------------------------------*        
                                                                                
           READ SY02F001.                                                       
           MOVE F001-DTE-CURRENT      TO WS-CUR-DATE.                           
                                                                                
           COMPUTE WS-CURR-DTE-J  =                                             
                   FUNCTION INTEGER-OF-DATE(WS-CURR-DATE).                      
                                                                                
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------*                                        
       2000-READ-BP13KD40.                                                      
      *--------------------------------*                                        
           READ BP13KD40  AT END                                                
                MOVE HIGH-VALUES TO KD40-KEY-FLD                                
                GO TO 2000-EXIT.                                                
                                                                                
           ADD 1 TO WS-KD40-READ.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       3000-PROCESS-RECORDS.                                                    
      *--------------------------------*                                        
                                                                                
           MOVE SPACES                     TO WS-K600-EOF.                      
                                                                                
           IF KD40-NUM-REGN = SPACES OR ZEROES OR LOW-VALUES                    
           OR KD40-NUM-PP-SCHDL = SPACES OR ZEROES OR LOW-VALUES                
              ADD 1                        TO WS-KD40-BYPASSED                  
              PERFORM 2000-READ-BP13KD40   THRU 2000-EXIT                       
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           MOVE 'Y'                        TO WS-READY-SW.                      
           PERFORM 4000-CHECK-TOTALS       THRU 4000-EXIT.                      
           IF WS-READY-SW = 'N'                                                 
              PERFORM 7000-COMPUTE-DAYS    THRU 7000-EXIT                       
              IF ((KD40-NUM-PP-SCHDL = '01' AND WS-DAYS-PP01 > 05) OR           
                  (KD40-NUM-PP-SCHDL NOT = '01' AND WS-DAYS-PP > 02))           
                 PERFORM 7100-WRITE-REPORT THRU 7100-EXIT                       
              END-IF                                                            
              ADD 1                        TO WS-KD40-BYPASSED                  
              PERFORM 2000-READ-BP13KD40   THRU 2000-EXIT                       
              GO TO 3000-EXIT                                                   
           END-IF.                                                              
                                                                                
           PERFORM 5000-WRITE-BP13KD45     THRU 5000-EXIT.                      
                                                                                
           PERFORM 8000-START-K600         THRU 8000-EXIT.                      
           PERFORM 8100-READ-NEXT-K600     THRU 8100-EXIT UNTIL                 
                                                WS-K600-EOF   = 'Y'.            
                                                                                
           PERFORM 3500-DELETE-BP13KD40    THRU 3500-EXIT.                      
                                                                                
           PERFORM 2000-READ-BP13KD40      THRU 2000-EXIT.                      
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       3500-DELETE-BP13KD40.                                                    
      *--------------------------------*                                        
           DELETE BP13KD40.                                                     
           IF WS-KD40-STATUS = 00 OR 02                                         
              CONTINUE                                                          
           ELSE                                                                 
              DISPLAY 'DELETE ERROR, KD40-STATUS = ' WS-KD40-STATUS             
                      ' KD40-KEY = ' KD40-KEY-FLD                               
              MOVE WS-KD40-STATUS TO RETURN-CODE                                
              GO TO 9000-CLOSE-ROUTINE.                                         
                                                                                
           ADD 1 TO WS-KD40-DELETED.                                            
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------*                                        
       4000-CHECK-TOTALS.                                                       
      *--------------------------------*                                        
                                                                                
           MOVE ZEROES           TO WS-FEE-REQ                                  
                                    WS-FEE-PD.                                  
                                                                                
           PERFORM 6000-INITIALIZE-NUMERICS THRU 6000-EXIT.                     
           COMPUTE WS-PP-CASH-CPF-PD =                                          
                   KD40-AMT-PP-CASH-PD +                                        
                   KD40-AMT-PP-CPF1-PD +                                        
                   KD40-AMT-PP-CPF2-PD +                                        
                   KD40-AMT-PP-CPF3-PD +                                        
                   KD40-AMT-PP-CPF4-PD.                                         
           COMPUTE WS-STAMP-FEE-CASH =                                          
                   KD40-AMT-MORT-STAMP-CASH +                                   
                   KD40-AMT-CAVEAT-CASH +                                       
                   KD40-AMT-SNP-STAMP-CASH +                                    
                   KD40-AMT-SOLICITOR-BILL-CASH +                               
                   KD40-AMT-LSE-ESCR-STAMP-CASH +                               
                   KD40-AMT-MORT-ESCR-STAMP-CASH +                              
                   KD40-AMT-SURVEY-CASH.                                        
           IF KD40-NUM-PP-SCHDL = 'TR'                                          
              COMPUTE WS-STAMP-FEE-CASH = WS-STAMP-FEE-CASH +                   
                                          KD40-AMT-TRF-WCAVEAT-CASH +           
                                          KD40-AMT-TRF-DOA-STAMP-CASH           
           END-IF.                                                              
           COMPUTE WS-STAMP-FEE-CPF =                                           
                   KD40-AMT-MORT-STAMP-CPF1 +                                   
                   KD40-AMT-MORT-STAMP-CPF2 +                                   
                   KD40-AMT-MORT-STAMP-CPF3 +                                   
                   KD40-AMT-MORT-STAMP-CPF4 +                                   
                   KD40-AMT-CAVEAT-CPF1 +                                       
                   KD40-AMT-CAVEAT-CPF2 +                                       
                   KD40-AMT-CAVEAT-CPF3 +                                       
                   KD40-AMT-CAVEAT-CPF4 +                                       
                   KD40-AMT-SNP-STAMP-CPF1 +                                    
                   KD40-AMT-SNP-STAMP-CPF2 +                                    
                   KD40-AMT-SNP-STAMP-CPF3 +                                    
                   KD40-AMT-SNP-STAMP-CPF4 +                                    
                   KD40-AMT-SOLICITOR-BILL-CPF1 +                               
                   KD40-AMT-SOLICITOR-BILL-CPF2 +                               
                   KD40-AMT-SOLICITOR-BILL-CPF3 +                               
                   KD40-AMT-SOLICITOR-BILL-CPF4.                                
           COMPUTE WS-STAMP-FEE-CPF =                                           
                   WS-STAMP-FEE-CPF +                                           
                   KD40-AMT-LSE-ESCR-STAMP-CPF1 +                               
                   KD40-AMT-LSE-ESCR-STAMP-CPF2 +                               
                   KD40-AMT-LSE-ESCR-STAMP-CPF3 +                               
                   KD40-AMT-LSE-ESCR-STAMP-CPF4 +                               
                   KD40-AMT-MORT-ESCR-STAMP-CPF1 +                              
                   KD40-AMT-MORT-ESCR-STAMP-CPF2 +                              
                   KD40-AMT-MORT-ESCR-STAMP-CPF3 +                              
                   KD40-AMT-MORT-ESCR-STAMP-CPF4 +                              
                   KD40-AMT-SURVEY-CPF1 +                                       
                   KD40-AMT-SURVEY-CPF2 +                                       
                   KD40-AMT-SURVEY-CPF3 +                                       
                   KD40-AMT-SURVEY-CPF4.                                        
           IF KD40-NUM-PP-SCHDL = 'TR'                                          
              COMPUTE WS-STAMP-FEE-CPF = WS-STAMP-FEE-CPF +                     
                                         KD40-AMT-TRF-WCAVEAT-CPF1 +            
                                         KD40-AMT-TRF-WCAVEAT-CPF2 +            
                                         KD40-AMT-TRF-WCAVEAT-CPF3 +            
                                         KD40-AMT-TRF-WCAVEAT-CPF4 +            
                                         KD40-AMT-TRF-DOA-STAMP-CPF1 +          
                                         KD40-AMT-TRF-DOA-STAMP-CPF2 +          
                                         KD40-AMT-TRF-DOA-STAMP-CPF3 +          
                                         KD40-AMT-TRF-DOA-STAMP-CPF4            
           END-IF.                                                              
           COMPUTE WS-CONVY-FEE-CASH =                                          
                   KD40-AMT-CONVY-CASH.                                         
           IF KD40-NUM-PP-SCHDL = 'TR'                                          
              COMPUTE WS-CONVY-FEE-CASH = WS-CONVY-FEE-CASH +                   
                                          KD40-AMT-TRF-CONVY-TROR-CASH +        
                                          KD40-AMT-TRF-CONVY-TREE-CASH +        
                                          KD40-AMT-TRF-CONVY-TDM-CASH +         
                                          KD40-AMT-TRF-CONVY-MORT-CASH          
           END-IF.                                                              
           COMPUTE WS-CONVY-FEE-CPF  =                                          
                   KD40-AMT-CONVY-CPF1 +                                        
                   KD40-AMT-CONVY-CPF2 +                                        
                   KD40-AMT-CONVY-CPF3 +                                        
                   KD40-AMT-CONVY-CPF4.                                         
           IF KD40-NUM-PP-SCHDL = 'TR'                                          
              COMPUTE WS-CONVY-FEE-CPF = WS-CONVY-FEE-CPF +                     
                                         KD40-AMT-TRF-CONVY-TROR-CPF1 +         
                                         KD40-AMT-TRF-CONVY-TROR-CPF2 +         
                                         KD40-AMT-TRF-CONVY-TROR-CPF3 +         
                                         KD40-AMT-TRF-CONVY-TROR-CPF4 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF1 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF2 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF3 +         
                                         KD40-AMT-TRF-CONVY-TREE-CPF4 +         
                                         KD40-AMT-TRF-CONVY-TDM-CPF1 +          
                                         KD40-AMT-TRF-CONVY-TDM-CPF2 +          
                                         KD40-AMT-TRF-CONVY-TDM-CPF3 +          
                                         KD40-AMT-TRF-CONVY-TDM-CPF4 +          
                                         KD40-AMT-TRF-CONVY-MORT-CPF1 +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF2 +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF3 +         
                                         KD40-AMT-TRF-CONVY-MORT-CPF4           
           END-IF.                                                              
                                                                                
           COMPUTE WS-AMT-PP-REQ =                                              
                   KD40-AMT-PP-REQ -                                            
                   KD40-AMT-PP-LOAN.                                            
                                                                                
           COMPUTE WS-FEE-REQ = WS-STAMP-FEE-CASH +                             
                                WS-STAMP-FEE-CPF +                              
                                WS-CONVY-FEE-CASH +                             
                                WS-CONVY-FEE-CPF.                               
                                                                                
           COMPUTE WS-FEE-PD = KD40-AMT-STAMP-CASH-PD +                         
                               KD40-AMT-STAMP-CPF-PD  +                         
                               KD40-AMT-CONVY-CASH-PD +                         
                               KD40-AMT-CONVY-CPF-PD.                           
                                                                                
           IF WS-PP-CASH-CPF-PD NOT = WS-AMT-PP-REQ                             
              MOVE 'N'                     TO WS-READY-SW                       
           END-IF.                                                              
           IF WS-FEE-PD NOT = WS-FEE-REQ                                        
              MOVE 'N'                     TO WS-READY-SW                       
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       5000-WRITE-BP13KD45.                                                     
      *--------------------------------*                                        
           MOVE SPACES                     TO BP13KD45-REC.                     
           INITIALIZE                         BP13KD45-REC.                     
                                                                                
           MOVE BP13KD40-REC               TO BP13KD45-REC(1:1500).             
           MOVE KD40-NUM-REGN              TO KD45-NUM-REGN-HIST.               
           MOVE WS-CUR-DATE                TO KD45-DTE-UPDATE-HIST.             
           ACCEPT WS-CUR-TIME              FROM TIME.                           
           MOVE WS-CUR-TIME                TO KD45-TME-UPDATE-HIST.             
           MOVE '1'                        TO KD45-NUM-HIST-REASON.             
                                                                                
           WRITE BP13KD45-REC.                                                  
           IF WS-KD45-STATUS = 00 OR 02                                         
              CONTINUE                                                          
           ELSE                                                                 
              DISPLAY 'WRITE ERROR, KD45-STATUS = ' WS-KD45-STATUS              
                      ' KD45-KEY = ' KD45-KEY-FLD                               
              MOVE WS-KD45-STATUS TO RETURN-CODE                                
              GO TO 9000-CLOSE-ROUTINE.                                         
                                                                                
           ADD 1 TO WS-KD45-WRITTEN.                                            
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       6000-INITIALIZE-NUMERICS.                                                
      *--------------------------------*                                        
           IF KD40-AMT-CURR-SELLPR          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CURR-SELLPR.                                
           IF KD40-AMT-LOAN-GRANTED         NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LOAN-GRANTED.                               
           IF KD40-AMT-PP-REQ               NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-REQ.                                     
           IF KD40-AMT-PP-CASH              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CASH.                                    
           IF KD40-AMT-PP-CPF1              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF1.                                    
           IF KD40-AMT-PP-CPF2              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF2.                                    
           IF KD40-AMT-PP-CPF3              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF3.                                    
           IF KD40-AMT-PP-CPF4              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF4.                                    
           IF KD40-AMT-PP-HSG1              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-HSG1.                                    
           IF KD40-AMT-PP-HSG2              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-HSG2.                                    
           IF KD40-AMT-PP-HSG3              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-HSG3.                                    
           IF KD40-AMT-PP-HSG4              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-HSG4.                                    
           IF KD40-AMT-PP-RETIRE1           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-RETIRE1.                                 
           IF KD40-AMT-PP-RETIRE2           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-RETIRE2.                                 
           IF KD40-AMT-PP-RETIRE3           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-RETIRE3.                                 
           IF KD40-AMT-PP-RETIRE4           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-RETIRE4.                                 
           IF KD40-AMT-PP-LOAN              NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-LOAN.                                    
           IF KD40-AMT-PP-INSTAL            NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-INSTAL.                                  
           IF KD40-AMT-CONVY                NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY.                                      
           IF KD40-AMT-CONVY-GST            NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-GST.                                  
           IF KD40-AMT-CONVY-CASH           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CASH.                                 
           IF KD40-AMT-CONVY-CPF1           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CPF1.                                 
           IF KD40-AMT-CONVY-CPF2           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CPF2.                                 
           IF KD40-AMT-CONVY-CPF3           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CPF3.                                 
           IF KD40-AMT-CONVY-CPF4           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CPF4.                                 
           IF KD40-AMT-MORT-STAMP           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP.                                 
           IF KD40-AMT-MORT-STAMP-CASH      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP-CASH.                            
           IF KD40-AMT-MORT-STAMP-CPF1      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP-CPF1.                            
           IF KD40-AMT-MORT-STAMP-CPF2      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP-CPF2.                            
           IF KD40-AMT-MORT-STAMP-CPF3      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP-CPF3.                            
           IF KD40-AMT-MORT-STAMP-CPF4      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-STAMP-CPF4.                            
           IF KD40-AMT-CAVEAT               NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT.                                     
           IF KD40-AMT-CAVEAT-CASH          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT-CASH.                                
           IF KD40-AMT-CAVEAT-CPF1          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT-CPF1.                                
           IF KD40-AMT-CAVEAT-CPF2          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT-CPF2.                                
           IF KD40-AMT-CAVEAT-CPF3          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT-CPF3.                                
           IF KD40-AMT-CAVEAT-CPF4          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CAVEAT-CPF4.                                
           IF KD40-AMT-SNP-STAMP            NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP.                                  
           IF KD40-AMT-SNP-STAMP-CASH       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP-CASH.                             
           IF KD40-AMT-SNP-STAMP-CPF1       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP-CPF1.                             
           IF KD40-AMT-SNP-STAMP-CPF2       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP-CPF2.                             
           IF KD40-AMT-SNP-STAMP-CPF3       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP-CPF3.                             
           IF KD40-AMT-SNP-STAMP-CPF4       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SNP-STAMP-CPF4.                             
           IF KD40-AMT-SOLICITOR-BILL       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL.                             
           IF KD40-AMT-SOLICITOR-BILL-CASH  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL-CASH.                        
           IF KD40-AMT-SOLICITOR-BILL-CPF1  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL-CPF1.                        
           IF KD40-AMT-SOLICITOR-BILL-CPF2  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL-CPF2.                        
           IF KD40-AMT-SOLICITOR-BILL-CPF3  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL-CPF3.                        
           IF KD40-AMT-SOLICITOR-BILL-CPF4  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SOLICITOR-BILL-CPF4.                        
           IF KD40-AMT-LSE-ESCR-STAMP       NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP.                             
           IF KD40-AMT-LSE-ESCR-STAMP-CASH  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP-CASH.                        
           IF KD40-AMT-LSE-ESCR-STAMP-CPF1  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP-CPF1.                        
           IF KD40-AMT-LSE-ESCR-STAMP-CPF2  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP-CPF2.                        
           IF KD40-AMT-LSE-ESCR-STAMP-CPF3  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP-CPF3.                        
           IF KD40-AMT-LSE-ESCR-STAMP-CPF4  NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-LSE-ESCR-STAMP-CPF4.                        
           IF KD40-AMT-MORT-ESCR-STAMP      NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP.                            
           IF KD40-AMT-MORT-ESCR-STAMP-CASH NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP-CASH.                       
           IF KD40-AMT-MORT-ESCR-STAMP-CPF1 NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP-CPF1.                       
           IF KD40-AMT-MORT-ESCR-STAMP-CPF2 NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP-CPF2.                       
           IF KD40-AMT-MORT-ESCR-STAMP-CPF3 NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP-CPF3.                       
           IF KD40-AMT-MORT-ESCR-STAMP-CPF4 NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-MORT-ESCR-STAMP-CPF4.                       
           IF KD40-NUM-SERIAL-CPF1          NOT NUMERIC                         
              MOVE ZERO TO KD40-NUM-SERIAL-CPF1.                                
           IF KD40-NUM-SERIAL-CPF2          NOT NUMERIC                         
              MOVE ZERO TO KD40-NUM-SERIAL-CPF2.                                
           IF KD40-NUM-SERIAL-CPF3          NOT NUMERIC                         
              MOVE ZERO TO KD40-NUM-SERIAL-CPF3.                                
           IF KD40-NUM-SERIAL-CPF4          NOT NUMERIC                         
              MOVE ZERO TO KD40-NUM-SERIAL-CPF4.                                
           IF KD40-AMT-PP-CASH-PD           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CASH-PD.                                 
           IF KD40-AMT-PP-CPF1-PD           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF1-PD.                                 
           IF KD40-AMT-PP-CPF2-PD           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF2-PD.                                 
           IF KD40-AMT-PP-CPF3-PD           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF3-PD.                                 
           IF KD40-AMT-PP-CPF4-PD           NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-PP-CPF4-PD.                                 
           IF KD40-AMT-STAMP-CASH-PD        NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-STAMP-CASH-PD.                              
           IF KD40-AMT-STAMP-CPF-PD         NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-STAMP-CPF-PD.                               
           IF KD40-AMT-CONVY-CASH-PD        NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CASH-PD.                              
           IF KD40-AMT-CONVY-CPF-PD         NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-CONVY-CPF-PD.                               
           IF KD40-AMT-SURVEY-CASH          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SURVEY-CASH.                                
           IF KD40-AMT-SURVEY-CPF1          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SURVEY-CPF1.                                
           IF KD40-AMT-SURVEY-CPF2          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SURVEY-CPF2.                                
           IF KD40-AMT-SURVEY-CPF3          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SURVEY-CPF3.                                
           IF KD40-AMT-SURVEY-CPF4          NOT NUMERIC                         
              MOVE ZERO TO KD40-AMT-SURVEY-CPF4.                                
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       7000-COMPUTE-DAYS.                                                       
      *--------------------------------*                                        
                                                                                
           MOVE ZEROES            TO WS-PP-DTE-J                                
                                     WS-DAYS-PP                                 
                                     WS-DAYS-PP01.                              
                                                                                
           MOVE KD40-DTE-PROGRESS-PYMT TO WS-PP-PYMT-DTE.                       
           COMPUTE WS-PP-DTE-J  =                                               
                   FUNCTION INTEGER-OF-DATE(WS-PP-PYMT-DATE).                   
                                                                                
           COMPUTE WS-DAYS-PP01 = WS-PP-DTE-J - WS-CURR-DTE-J.                  
           MOVE WS-DAYS-PP01      TO WS-DAYS-PP.                                
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       7100-WRITE-REPORT.                                                       
      *--------------------------------*                                        
                                                                                
           MOVE SPACES                    TO LC24-PR-DETAILS.                   
           INITIALIZE                        LC24-PR-DETAILS.                   
                                                                                
           IF WS-LINE-CNT > 50                                                  
              PERFORM 7200-WRITE-HEADING  THRU 7200-EXIT                        
           END-IF.                                                              
                                                                                
                                                                                
           MOVE KD40-NUM-REGN     TO LC24-REG-NO.                               
           MOVE KD40-NUM-PP-SCHDL TO LC24-SCH.                                  
           STRING KD40-DTE-PP-DUE(7:2) '/'                                      
                  KD40-DTE-PP-DUE(5:2) '/'                                      
                  KD40-DTE-PP-DUE(1:4)                                          
                  DELIMITED BY SIZE INTO LC24-DUE-DATE.                         
           MOVE KD40-AMT-PP-REQ   TO LC24-PP-REQ.                               
           MOVE KD40-AMT-PP-LOAN  TO LC24-PP-LOAN.                              
           MOVE WS-AMT-PP-REQ     TO LC24-LS-REQ.                               
           MOVE WS-PP-CASH-CPF-PD TO LC24-LS-PD.                                
           MOVE WS-FEE-REQ        TO LC24-FEE-REQ.                              
           MOVE WS-FEE-PD         TO LC24-FEE-PD.                               
                                                                                
           IF WS-PP-CASH-CPF-PD > WS-AMT-PP-REQ                                 
              MOVE 'EXCEED LS'    TO LC24-REMARKS                               
           ELSE                                                                 
           IF WS-PP-CASH-CPF-PD < WS-AMT-PP-REQ                                 
              MOVE 'INSUFF LS'    TO LC24-REMARKS                               
           ELSE                                                                 
           IF WS-FEE-PD > WS-FEE-REQ                                            
              MOVE 'EXCEED FEE'   TO LC24-REMARKS                               
           ELSE                                                                 
           IF WS-FEE-PD < WS-FEE-REQ                                            
              MOVE 'INSUFF FEE'   TO LC24-REMARKS                               
           END-IF.                                                              
                                                                                
           ADD 1                          TO WS-SN                              
                                             WS-LC24-WRITTEN.                   
                                                                                
           ADD 2                          TO WS-LINE-CNT.                       
                                                                                
           MOVE WS-SN                     TO LC24-SN.                           
                                                                                
           WRITE PRINT-REC                FROM LC24-PR-DETAILS AFTER 2.         
                                                                                
       7100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       7200-WRITE-HEADING.                                                      
      *----------------------------------------------------------------*        
                                                                                
           ADD 1                          TO WS-PAGE-CNT.                       
           MOVE WS-PAGE-CNT               TO LC24-PAGENO.                       
                                                                                
           MOVE  SPACES                   TO PRINT-REC.                         
           WRITE PRINT-REC                      AFTER PAGE.                     
           WRITE PRINT-REC FROM LC24-PR-HEAD-01 AFTER 3.                        
           WRITE PRINT-REC FROM LC24-PR-HEAD-02 AFTER 1.                        
           WRITE PRINT-REC FROM LC24-PR-HEAD-03 AFTER 2.                        
           WRITE PRINT-REC FROM LC24-PR-HEAD-04 AFTER 1.                        
           MOVE 8                         TO WS-LINE-CNT.                       
                                                                                
       7200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8000-START-K600.                                                         
      *----------------------------------------------------------------*        
                                                                                
           MOVE LOW-VALUES    TO K600-KEY-FLD.                                  
           MOVE KD40-NUM-REGN TO K600-NUM-ORIG-REGN.                            
                                                                                
           START BP13K600 KEY IS >= K600-KEY-FLD.                               
           IF WS-K600-STATUS = 00 OR 02                                         
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-K600-STATUS = 23                                            
                 MOVE 'Y'         TO WS-K600-EOF                                
              ELSE                                                              
                 DISPLAY 'START FAILURE IN BP13K600: ' WS-K600-STATUS           
                 MOVE WS-K600-STATUS TO RETURN-CODE                             
                 PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8100-READ-NEXT-K600.                                                     
      *----------------------------------------------------------------*        
                                                                                
           READ BP13K600 NEXT AT END MOVE 'Y' TO WS-K600-EOF                    
                                     GO TO 8100-EXIT.                           
                                                                                
           IF WS-K600-STATUS = 0                                                
              IF ((K600-NUM-SERIAL = KD40-NUM-SERIAL-CPF1 OR                    
                                     KD40-NUM-SERIAL-CPF2 OR                    
                                     KD40-NUM-SERIAL-CPF3 OR                    
                                     KD40-NUM-SERIAL-CPF4) AND                  
                  (KD40-NUM-REGN = K600-NUM-ORIG-REGN))                         
                 IF K600-NUM-DBSS = 'Y'                                         
      *             PERFORM 8200-COMPUTE-DAYS-ACCPT THRU 8200-EXIT              
      *             IF WS-DAYS-ACCEPTED > 14                                    
                       PERFORM 8300-CREATE-F600     THRU 8300-EXIT              
                       PERFORM 8400-DELETE-K600     THRU 8400-EXIT              
      *             END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              IF WS-K600-STATUS = 23                                            
                 MOVE 'Y'         TO WS-K600-EOF                                
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K600: ' WS-K600-STATUS              
                 MOVE WS-K600-STATUS TO RETURN-CODE                             
                 PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
       8100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
      *8200-COMPUTE-DAYS-ACCPT.                                                 
      *----------------------------------------------------------------*        
                                                                                
      *    MOVE ZEROES            TO WS-DAYS-ACCEPTED                           
      *                              WS-DTE-ACCEPTED-J.                         
                                                                                
      *    IF K600-DTE-ACCEPTED NOT = SPACES OR LOW-VALUES OR ALL ZEROS         
      *       MOVE K600-DTE-ACCEPTED TO WS-DTE-ACCEPTED                         
      *       COMPUTE WS-DTE-ACCEPTED-J =                                       
      *               FUNCTION INTEGER-OF-DATE(WS-DATE-ACCEPTED)                
      *                                                                         
      *       COMPUTE WS-DAYS-ACCEPTED = WS-DTE-ACCEPTED-J -                    
      *                                  WS-CURR-DTE-J                          
      *    END-IF.                                                              
      *                                                                         
      *8200-EXIT.                                                               
      *    EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8300-CREATE-F600.                                                        
      *----------------------------------------------------------------*        
                                                                                
           MOVE BP13K600-REC TO BP13F600-TRANS-REC.                             
           WRITE BP13F600-TRANS-REC.                                            
           ADD 1             TO WS-F600-WRITTEN.                                
                                                                                
       8300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8400-DELETE-K600.                                                        
      *----------------------------------------------------------------*        
                                                                                
           DELETE BP13K600.                                                     
           IF WS-K600-STATUS = 00 OR 02                                         
              CONTINUE                                                          
           ELSE                                                                 
              DISPLAY 'DELETE ERROR, K600-STATUS = ' WS-K600-STATUS             
                      ' K600-KEY = ' K600-KEY-FLD                               
              MOVE WS-K600-STATUS TO RETURN-CODE                                
              GO TO 9000-CLOSE-ROUTINE.                                         
                                                                                
           ADD 1 TO WS-K600-DELETED.                                            
                                                                                
       8400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------*                                        
       9000-CLOSE-ROUTINE.                                                      
      *--------------------------------*                                        
           DISPLAY 'PROGRAM ID   : BP13CC24'.                                   
           DISPLAY 'CURRENT DATE : ' WS-EDT-DATE.                               
           DISPLAY SPACES.                                                      
           DISPLAY '*=============== COUNTERS ===============*'.                
           DISPLAY 'BP13KD40 RECORDS READ     : ' WS-KD40-READ.                 
           DISPLAY 'BP13KD40 RECORDS BYPASSED : ' WS-KD40-BYPASSED.             
           DISPLAY 'BP13KD40 RECORDS DELETED  : ' WS-KD40-DELETED.              
           DISPLAY 'BP13KD45 RECORDS WRITTEN  : ' WS-KD45-WRITTEN.              
           DISPLAY 'BP13LC24 RECORDS WRITTEN  : ' WS-LC24-WRITTEN.              
           DISPLAY 'BP13K600 RECORDS DELETED  : ' WS-K600-DELETED.              
           DISPLAY 'BP13F600 RECORDS WRITTEN  : ' WS-F600-WRITTEN.              
                                                                                
           CLOSE SY02F001                                                       
                 BP13LC24                                                       
                 BP13F600                                                       
                 BP13KD40                                                       
                 BP13KD45                                                       
                 BP13K600.                                                      
                                                                                
           IF WS-KD40-STATUS NOT = 00                                           
              DISPLAY 'CLOSE ERROR FILE BP13KD40 ' WS-KD40-STATUS               
              MOVE WS-KD40-STATUS TO RETURN-CODE                                
           END-IF.                                                              
                                                                                
           IF WS-KD45-STATUS NOT = 00                                           
              DISPLAY 'CLOSE ERROR FILE BP13KD45 ' WS-KD45-STATUS               
              MOVE WS-KD45-STATUS TO RETURN-CODE                                
           END-IF.                                                              
                                                                                
           IF WS-K600-STATUS NOT = 00                                           
              DISPLAY 'CLOSE ERROR FILE BP13K600 ' WS-K600-STATUS               
              MOVE WS-K600-STATUS TO RETURN-CODE                                
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
