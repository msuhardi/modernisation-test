       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C970.                                         00020000
      *AUTHOR.        SATHAPPAN.                                        00030000
      *DATE-WRITTEN.  17/01/2002.                                       00040000
      *===============================================================* 00050000
      *               SYSTEM OF COMMITMENT (BP13) *                   * 00060000
      *===============================================================* 00070000
      *                                                               * 00080000
      * OBJECTIVE :  THIS PROGRAM IS USED TO DELETE THE OLD ROLE AND  * 00090000
      *              ADD THE NEW ROLE IN CDB,FOR ONLY REJECTED "CR"   * 00100000
      *              CASES FROM THE ONLINE PROGRAM BP13B561.          * 00110000
      *                                                               * 00120000
      *1. FILE DETAILS :                                              * 00130000
      *    INPUT   :  BE01KMSG  ( CDB ERROR FILE )                    * 00140000
      *    OUTPUT  :  P13F915A  ( CDB TRANSACTION FILE )              * 00150000
      *               P13F915B  ( CDB TRANSACTION FILE)               * 00160000
      *               BP13L970  ( PRINT CONTROL )                     * 00170000
      *               BP13F820  ( OCCUPIER FILE )                     * 00180000
      *                                                               * 00190000
      *2. WHEN RUNNING THIS PGOGRAM, YOU HAVE TO INCLUDE              * 00200000
      *   THE FOLLOWING FLAT FILES IN YOUR RUN JCL.                   * 00210000
      *---------------------------------------------------------------* 00220000
      *   CALL BE01C808 - UPDATING THE PERSON TABLE                   * 00230000
      *---------------------------------------------------------------* 00240000
      *     1. BE01F003 -  RECORD LENGTH - 570                        * 00250000
      *     2. BE01F903 -  RECORD LENGTH - 800                        * 00260000
      *     3. BE01F400 -  RECORD LENGTH - 160                        * 00270000
      *                                                               * 00280000
      *---------------------------------------------------------------* 00290000
      *   CALL BE01C809 - UPDATING THE MARRIAGE (MRG) TABLE           * 00300000
      *---------------------------------------------------------------* 00310000
      *     1. BE01F004 -  RECORD LENGTH - 440                        * 00320000
      *     2. BE01F904 -  RECORD LENGTH - 600                        * 00330000
      *     3. BE01F401 -  RECORD LENGTH - 160                        * 00340000
      *     4. BE01F620 -  RECORD LENGTH - 500                        * 00350000
      *                                                               * 00360000
      *     BE01F003   }-  LOG DOWN RECORDS UPDATED TO DATABASE       * 00370000
      *     BE01F004   }                                              * 00380000
      *                                                               * 00390000
      *     BE01F903   }-  LOG RECORDS WITH REJECTION (OR)            * 00400000
      *     BE01F904   }   WARNING STATUS.                            * 00410000
      *                                                               * 00420000
      *     BE01F400   }-  LOG NEW IDENTITY NO. OF SPOUSE ADDED TO    * 00430000
      *     BE01F401   }   OBTAIN:                                    * 00440000
      *                    A. PARTICULAR FROM MHA(FOR UNI/FIN)        * 00450000
      *                    B. MARRIAGE RECORDS FROM MCD               * 00460000
      *                    C. DIVORCE RECORDS FROM COURT              * 00470000
      *                                                               * 00480000
      *     BE01F620   }-   LOG FILE FOR INDIRECT UPDATES             * 00490000
      *                     CAUSED BY SOURCE SYSTEM.                  * 00500000
      *                                                               * 00510000
      *                     EXAMPLE :                                 * 00520000
      *                     DEL OF EXISTING RECORD WITH DEFAULT       * 00530000
      *                     MARRIAGE DATE IF SOURCE SYSTEM PASS       * 00540000
      *                     MARRIAGE RECORD WITH VALID DATE           * 00550000
      *                                                               * 00560000
      *---------------------------------------------------------------* 00570000
      *    TRANSACTION CODE TYPES.  ¦         DESCRIPTION.            * 00580000
      *---------------------------------------------------------------* 00590000
      * 1.      AR                  ¦ ADD CUSTOMER RECORD IN CDB      * 00600000
      * 2.      DE                  ¦ DELETE CUSTOMER RECORD IN CDB   * 00610000
      * 3.      CR                  ¦ CHANGE OF ROW OF EXISTING CSTMR * 00620000
      * 4.      AM                  ¦ ADD MARRIAGE RECORD IN CDB      * 00630000
      * --------------------------------------------------------------* 00640000
      *                                                               * 00650000
      * --------------------------------------------------------------* 00660000
      * CHG-NO    CHG-DATE     BY   DESCRIPTION                       * 00670000
      * ------    --------     --   -----------                       * 00680000
      * BP130850  17/01/2002   AS1  NEW PROGRAM                       * 00690000
      * BP137007  01/11/2017   SMR2 TAG NATIONALITY 'UN' WHEN BLANK   * 00700000
      * BP138971  15/12/2021   KR13 CATER FOR NEW FIN SERIES 'M'      * 00701002
      ***************************************************************** 00710000
      **********************                                            00720000
       ENVIRONMENT DIVISION.                                            00730000
      **********************                                            00740000
      *----------------------*                                          00750000
       CONFIGURATION SECTION.                                           00760000
      *----------------------*                                          00770000
       SOURCE-COMPUTER. IBM-3090.                                       00780000
       OBJECT-COMPUTER. IBM-3090.                                       00790000
                                                                        00800000
      *----------------------*                                          00810000
       INPUT-OUTPUT SECTION.                                            00820000
      *----------------------*                                          00830000
                                                                        00840000
       FILE-CONTROL.                                                    00850000
                                                                        00860000
           SELECT BP13F915 ASSIGN TO BP13F915.                          00870000
                                                                        00880000
           SELECT BP13K060 ASSIGN TO BP13K060                           00890000
                  ACCESS MODE     IS DYNAMIC                            00900000
                  ORGANIZATION    IS INDEXED                            00910000
                  RECORD KEY      IS K060-KEY-FLD                       00920000
                  FILE STATUS     IS WS-K060-STATUS.                    00930000
                                                                        00940000
           SELECT BE01KMSG ASSIGN TO BE01KMSG                           00950000
                  ACCESS MODE     IS DYNAMIC                            00960000
                  ORGANIZATION    IS INDEXED                            00970000
                  RECORD KEY      IS KMSG-KEY                           00980000
                  FILE STATUS     IS WS-KMSG-STATUS.                    00990000
                                                                        01000000
           SELECT BP13F820 ASSIGN TO BP13F820.                          01010000
                                                                        01020000
           SELECT P13F915A ASSIGN TO P13F915A.                          01030000
                                                                        01040000
           SELECT P13F915B ASSIGN TO P13F915B.                          01050000
                                                                        01060000
           SELECT BP13L970 ASSIGN TO BP13L970.                          01070000
                                                                        01080000
           SELECT P13L970A ASSIGN TO P13L970A.                          01090000
                                                                        01100000
      ***************                                                   01110000
       DATA DIVISION.                                                   01120000
      ***************                                                   01130000
      *-------------*                                                   01140000
       FILE SECTION.                                                    01150000
      *-------------*                                                   01160000
                                                                        01170000
       FD  BP13F915                                                     01180000
           RECORD    CONTAINS 800 CHARACTERS                            01190000
           BLOCK     CONTAINS   0 RECORDS                               01200000
           LABEL     RECORDS  ARE STANDARD                              01210000
           RECORDING MODE     IS  F.                                    01220000
       COPY BP13F915.                                                   01230000
                                                                        01240000
       FD  BP13K060                                                     01250000
           RECORD    CONTAINS 25  CHARACTERS.                           01260000
       COPY BP13K060.                                                   01270000
                                                                        01280000
       FD  BP13F820                                                     01290000
           RECORD    CONTAINS 400 CHARACTERS                            01300000
           BLOCK     CONTAINS   0 RECORDS                               01310000
           LABEL     RECORDS  ARE STANDARD                              01320000
           RECORDING MODE     IS  F.                                    01330000
       COPY BP13F820.                                                   01340000
                                                                        01350000
       FD  BE01KMSG                                                     01360000
           RECORD    CONTAINS  75 CHARACTERS.                           01370000
       COPY BE01KMSG.                                                   01380000
                                                                        01390000
       FD  P13F915A                                                     01400000
           RECORD    CONTAINS 800 CHARACTERS                            01410000
           BLOCK     CONTAINS   0 RECORDS                               01420000
           LABEL     RECORDS  ARE STANDARD                              01430000
           RECORDING MODE     IS  F.                                    01440000
       01  WS-P13F915A-REC             PIC X(800).                      01450000
                                                                        01460000
       FD  P13F915B                                                     01470000
           RECORD    CONTAINS 800 CHARACTERS                            01480000
           BLOCK     CONTAINS   0 RECORDS                               01490000
           LABEL     RECORDS  ARE STANDARD                              01500000
           RECORDING MODE     IS  F.                                    01510000
       01  WS-P13F915B-REC             PIC X(800).                      01520000
                                                                        01530000
       FD  BP13L970                                                     01540000
           RECORD    CONTAINS 85  CHARACTERS                            01550000
           BLOCK     CONTAINS   0 RECORDS                               01560000
           LABEL     RECORDS  ARE OMITTED                               01570000
           RECORDING MODE     IS  F.                                    01580000
       01  WS-BP13L970-REC             PIC X(85).                       01590000
                                                                        01600000
       FD  P13L970A                                                     01610000
           RECORD    CONTAINS 132 CHARACTERS                            01620000
           BLOCK     CONTAINS   0 RECORDS                               01630000
           LABEL     RECORDS  ARE OMITTED                               01640000
           RECORDING MODE     IS  F.                                    01650000
       01  WS-P13L970A-REC             PIC X(132).                      01660000
                                                                        01670000
      *-------------------------*                                       01680000
       WORKING-STORAGE SECTION.                                         01690000
      *------------------------*                                        01700000
                                                                        01710000
       01  FILE-STATUS.                                                 01720000
           03  WS-K060-STATUS          PIC 9(02)  VALUE 0.              01730000
           03  WS-KMSG-STATUS          PIC 9(02)  VALUE ZEROES.         01740000
                                                                        01750000
       01  WS-SWITCHES.                                                 01760000
           03  F915-EOF-IND            PIC X       VALUE SPACES.        01770000
               88 F915-EOF             VALUE 'Y'.                       01780000
                                                                        01790000
       01  WS-ACCUMULATORS.                                             01800000
           03  WS-NO-WRT-F820          PIC 9(6)    VALUE ZEROES.        01810000
           03  WS-NO-READ-F915         PIC 9(10)   VALUE ZEROES.        01820000
           03  WS-NO-SUCCESSFUL-CDB    PIC 9(10)   VALUE ZEROES.        01830000
           03  WS-NO-WRT-CDB-PERSON    PIC 9(10)   VALUE ZEROES.        01840000
           03  WS-NO-DEL-CDB-PERSON    PIC 9(10)   VALUE ZEROES.        01850000
           03  WS-NO-EXIST-CDB-PERSON  PIC 9(10)   VALUE ZEROES.        01860000
           03  WS-NO-WRT-CDB-MARRIAGE  PIC 9(10)   VALUE ZEROES.        01870000
           03  WS-NO-EXIST-CDB-MRG     PIC 9(10)   VALUE ZEROES.        01880000
           03  WS-NO-WRT-F915A-REC     PIC 9(10)   VALUE ZEROES.        01890000
           03  WS-NO-WRT-F915B-REC     PIC 9(10)   VALUE ZEROES.        01900000
           03  WS-NO-WRT-L970A-REC     PIC 9(10)   VALUE ZEROES.        01910000
           03  WS-NO-ROLE-NOTMATCH     PIC 9(10)   VALUE ZEROES.        01920000
           03  WS-NO-FAIL-REC          PIC 9(10)   VALUE ZEROES.        01930000
                                                                        01940000
       01  WS-TEMP.                                                     01950000
           05  WS-DTE                  PIC X(15) VALUE SPACES.          01960000
           05  WS-SYS-DATE             PIC 9(08) VALUE ZEROES.          01970000
           05  WS-ERROR-PGM            PIC X(30) VALUE SPACES.          01980000
           05  WS-MSG.                                                  01990000
               10 FILLER               PIC X(02) VALUE SPACES.          02000000
               10 WS-MSGNO             PIC X(04).                       02010000
               10 FILLER               PIC X(03) VALUE SPACES.          02020000
               10 WS-MSG-TEXT          PIC X(70).                       02030000
           05  WS-NUM-TRANS-CODE       PIC X(02) VALUE SPACES.          02040000
           05  WS-NUM-NRIC             PIC X(09) VALUE SPACES.          02050000
           05  WS-PREV-REGN            PIC X(08) VALUE SPACES.          02060000
           05  WS-NUM-IDNTY-NO-TYPE    PIC X(03) VALUE SPACES.          02070000
           05  WS-C993-OK              PIC X(01) VALUE 'Y'.             02080000
           05  WS-C808-OK              PIC X(01) VALUE 'Y'.             02090000
           05  WS-C809-OK              PIC X(01) VALUE 'Y'.             02100000
           05  WS-COMMIT-OK            PIC X(01) VALUE 'Y'.             02110000
           05  WS-AR-REGN-NO           PIC X(08) VALUE SPACES.          02120000
           05  WS-NUM-CSTMR            PIC X(09) VALUE SPACES.          02130000
           05  WS-NUM-ROLE             PIC X(03) VALUE SPACES.          02140000
                                                                        02150000
       01  WS-ERROR-REPORT.                                             02160000
           05 WS-LINE-CTR              PIC 9(6) VALUE 65.               02170000
           05 WS-PAGE-CTR              PIC 9(5) VALUE ZEROES.           02180000
           05 WS-SEQN-CTR              PIC 9(6) VALUE ZEROES.           02190000
                                                                        02200000
       01  WS-PRINT-HDG1.                                               02210000
           05 FILLER                   PIC X(8)  VALUE 'BP13L970'.      02220000
           05 FILLER                   PIC X(3)  VALUE SPACES.          02230000
           05 FILLER                   PIC X(51) VALUE                  02240000
              'CONTROL LIST FOR CDB PERSON & MARRIAGE TABLES  '.        02250000
           05 FILLER                   PIC X(7)  VALUE 'DATE : '.       02260000
           05 WS-PRINT-DATE            PIC X(10) VALUE SPACES.          02270000
                                                                        02280000
       01  WS-PRINT-REC.                                                02290000
           05 FILLER                   PIC X(10) VALUE SPACES.          02300000
           05 WS-PRINT-DESC            PIC X(53) VALUE SPACES.          02310000
           05 WS-PRINT-TOTAL           PIC Z,ZZZ,ZZZ,ZZ9.               02320000
                                                                        02330000
      *----------------------*                                          02340000
      *   ERROR REPORT LAYOUT                                           02350000
      *----------------------*                                          02360000
                                                                        02370000
       01  L970A-PR-HEAD-01.                                            02380000
           05  FILLER                  PIC X(8)  VALUE 'P13L970A'.      02390000
           05  FILLER                  PIC X(5)  VALUE SPACES .         02400000
           05  FILLER                  PIC X(8)  VALUE 'HDBCAT 3'.      02410000
           05  FILLER                  PIC X(24) VALUE SPACES.          02420000
           05  FILLER                  PIC X(20) VALUE                  02430000
                                       'S Y S T E M   O F   '.          02440000
           05  FILLER                  PIC X(19) VALUE                  02450000
                                       'C O M M I T M E N T'.           02460000
           05  FILLER                  PIC X(15) VALUE SPACES.          02470000
           05  FILLER                  PIC X(7)  VALUE 'DATE :'.        02480000
           05  L970A-DATE-RUN          PIC X(10).                       02490000
           05  FILLER                  PIC X(4)  VALUE SPACES.          02500000
           05  FILLER                  PIC X(7)  VALUE 'PAGE : '.       02510000
           05  L970A-PAGENO            PIC ZZZZ9 .                      02520000
                                                                        02530000
       01  L970A-PR-HEAD-02.                                            02540000
           05  FILLER                  PIC X(30)  VALUE SPACES .        02550000
           05  FILLER                  PIC X(100) VALUE                 02560000
               'PRINT ERROR REPORT OF   MARRIED PERSON WITH INCOMPLETE  02570000
      -        'SPOUSE INFORMATION '.                                   02580000
                                                                        02590000
       01  L970A-PR-HEAD-03.                                            02600000
           05  FILLER                  PIC X(06) VALUE 'S/NO'.          02610000
           05  FILLER                  PIC X(02) VALUE SPACES.          02620000
           05  FILLER                  PIC X(07) VALUE 'REGN NO'.       02630000
           05  FILLER                  PIC X(03) VALUE SPACES.          02640000
           05  FILLER                  PIC X(07) VALUE 'TRAN ID'.       02650000
           05  FILLER                  PIC X(02) VALUE SPACES.          02660000
           05  FILLER                  PIC X(04) VALUE 'NRIC'.          02670000
           05  FILLER                  PIC X(07) VALUE SPACES.          02680000
           05  FILLER                  PIC X(07) VALUE 'SP NRIC'.       02690000
           05  FILLER                  PIC X(04) VALUE SPACES.          02700000
           05  FILLER                  PIC X(50) VALUE 'SPNAME'.        02710000
           05  FILLER                  PIC X(02) VALUE SPACES.          02720000
           05  FILLER                  PIC X(06) VALUE 'REASON'.        02730000
           05  FILLER                  PIC X(31) VALUE SPACES.          02740000
                                                                        02750000
       01  L970A-PR-DTL-01.                                             02760000
           05  L970A-SNO               PIC Z(6)  VALUE ZEROES.          02770000
           05  FILLER                  PIC X(02) VALUE SPACES.          02780000
           05  L970A-REGN-NO           PIC X(08) VALUE SPACES.          02790000
           05  FILLER                  PIC X(02) VALUE SPACES.          02800000
           05  L966A-TRANS-ID          PIC X(02) VALUE SPACES.          02810000
           05  FILLER                  PIC X(07) VALUE SPACES.          02820000
           05  L970A-NRIC-NO           PIC X(09) VALUE SPACES.          02830000
           05  FILLER                  PIC X(02) VALUE SPACES.          02840000
           05  L970A-SP-NRIC-NO        PIC X(09) VALUE SPACES.          02850000
           05  FILLER                  PIC X(02) VALUE SPACES.          02860000
           05  L970A-SP-NAME           PIC X(50) VALUE SPACES.          02870000
           05  FILLER                  PIC X(02) VALUE SPACES.          02880000
           05  L970A-REASON            PIC X(31) VALUE SPACES.          02890000
           05  FILLER                  PIC X(05) VALUE SPACES.          02900000
                                                                        02910000
       01  L970A-PR-LINE               PIC X(132) VALUE ALL '-'.        02920000
                                                                        02930000
       01  L970A-PR-FOOTER.                                             02940000
           05  FILLER                  PIC X(32) VALUE SPACES .         02950000
           05  FILLER                  PIC X(45) VALUE                  02960000
               ' ********  NO RECORD FOUND  ********'.                  02970000
                                                                        02980000
       COPY BE01W808.                                                   02990000
       COPY BE01W809.                                                   03000000
       COPY BE01W993.                                                   03010000
       COPY TABCITZ.                                                    03020000
                                                                        03030000
            EXEC SQL INCLUDE SQLCA     END-EXEC.                        03040000
            EXEC SQL INCLUDE P13PERSN  END-EXEC.                        03050000
            EXEC SQL INCLUDE P13CSROL  END-EXEC.                        03060000
                                                                        03070000
      ********************                                              03080000
       PROCEDURE DIVISION.                                              03090000
      ********************                                              03100000
      *----------------*                                                03110000
       0000-MAIN-PROCESS.                                               03120000
      *----------------*                                                03130000
                                                                        03140000
             PERFORM 1000-OPEN-ROUTINE        THRU 1000-EXIT.           03150000
             PERFORM 2000-READ-BP13F915       THRU 2000-EXIT.           03160000
             PERFORM 3000-CALL-CDB-ROUTINE    THRU 3000-EXIT            03170000
               UNTIL F915-EOF.                                          03180000
             PERFORM 7000-CHECK-PRINT-REPORT  THRU 7000-EXIT.           03190000
             PERFORM 9020-PRINT-CONTROL       THRU 9020-EXIT.           03200000
             PERFORM 9999-CLOSE-ROUTINE       THRU 9999-EXIT.           03210000
                                                                        03220000
       0000-EXIT.                                                       03230000
           EXIT.                                                        03240000
                                                                        03250000
      *----------------*                                                03260000
       1000-OPEN-ROUTINE.                                               03270000
      *----------------*                                                03280000
                                                                        03290000
           OPEN       INPUT   BE01KMSG                                  03300000
                              BP13F915                                  03310000
                              BP13K060                                  03320000
                      OUTPUT  BP13F820                                  03330000
                              BP13L970                                  03340000
                              P13F915A                                  03350000
                              P13F915B                                  03360000
                              P13L970A.                                 03370000
                                                                        03380000
           IF WS-KMSG-STATUS NOT = ZEROS AND '97'                       03390000
              DISPLAY ' ERROR OPENING BE01KMSG  FILE, STATUS '          03400000
                                                  WS-KMSG-STATUS        03410000
              MOVE WS-KMSG-STATUS            TO   RETURN-CODE           03420000
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             03430000
           END-IF.                                                      03440000
                                                                        03450000
           IF WS-K060-STATUS NOT = ZEROS AND '97'                       03460000
              DISPLAY ' ERROR OPENING BP13K060  FILE, STATUS '          03470000
                                                  WS-K060-STATUS        03480000
              MOVE WS-K060-STATUS            TO   RETURN-CODE           03490000
              PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT             03500000
           END-IF.                                                      03510000
                                                                        03520000
           PERFORM 1100-OPEN-CDB-ROUTINE     THRU 1100-EXIT.            03530000
                                                                        03540000
           MOVE   FUNCTION CURRENT-DATE(1:8) TO   WS-SYS-DATE.          03550000
           STRING WS-SYS-DATE(7:2) '/'                                  03560000
                  WS-SYS-DATE(5:2) '/'                                  03570000
                  WS-SYS-DATE(1:4)                                      03580000
                  DELIMITED BY SIZE          INTO L970A-DATE-RUN.       03590000
                                                                        03600000
       1000-EXIT.                                                       03610000
           EXIT.                                                        03620000
                                                                        03630000
      *---------------------*                                           03640000
       1100-OPEN-CDB-ROUTINE.                                           03650000
      *---------------------*                                           03660000
                                                                        03670000
           MOVE 'OPENS'                      TO   BE01W808-IN-RTN-FXN.  03680000
           CALL 'BE01C808' USING BE01W808-COMMAREA.                     03690000
                                                                        03700000
           IF  BE01W808-OUT-RTN-ACTION = 'S'                            03710000
               MOVE    'BE01C808 - FILE OPEN ERROR'                     03720000
                                             TO   WS-ERROR-PGM          03730000
               PERFORM 9900-DISPLAY-CDB-ERROR THRU 9900-EXIT            03740000
               PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT            03750000
           END-IF.                                                      03760000
                                                                        03770000
                                                                        03780000
           MOVE 'OPENS'                      TO   BE01W809-IN-RTN-FXN.  03790000
           CALL 'BE01C809' USING BE01W809-COMMAREA.                     03800000
                                                                        03810000
           IF  BE01W809-OUT-RTN-ACTION = 'S'                            03820000
               MOVE    'BE01C809 - FILE OPEN ERROR'                     03830000
                                             TO   WS-ERROR-PGM          03840000
               PERFORM 9900-DISPLAY-CDB-ERROR THRU 9900-EXIT            03850000
               PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT            03860000
           END-IF.                                                      03870000
                                                                        03880000
       1100-EXIT.                                                       03890000
            EXIT.                                                       03900000
                                                                        03910000
      *-----------------*                                               03920000
       2000-READ-BP13F915.                                              03930000
      *-----------------*                                               03940000
                                                                        03950000
           READ BP13F915 AT END  MOVE 'Y' TO F915-EOF-IND               03960000
                         GO TO 2000-EXIT.                               03970000
                                                                        03980000
           ADD 1 TO WS-NO-READ-F915.                                    03990000
                                                                        04000000
       2000-EXIT.                                                       04010000
           EXIT.                                                        04020000
                                                                        04030000
      *---------------------*                                           04040000
       3000-CALL-CDB-ROUTINE.                                           04050000
      *---------------------*                                           04060000
                                                                        04070000
           PERFORM  3010-INITIALIZE-PARA    THRU 3010-EXIT              04080000
                                                                        04090000
           MOVE  F915-NUM-BSNS-REF          TO   WS-AR-REGN-NO.         04100000
                                                                        04110000
           PERFORM 4000-AR-PERSON-DETAIL  THRU  4000-EXIT               04120000
             UNTIL F915-NUM-BSNS-REF NOT = WS-AR-REGN-NO                04130000
                OR F915-EOF                                             04140000
                OR WS-COMMIT-OK = 'N'                                   04150000
                                                                        04160000
           IF  WS-COMMIT-OK = 'Y'                                       04170000
               PERFORM 9100-COMMIT-RECORDS THRU 9100-EXIT               04180000
           ELSE                                                         04190000
               PERFORM 8200-WRITE-P13F915A   THRU 8200-EXIT             04200000
               PERFORM 9200-ROLLBACK-RECORDS THRU 9200-EXIT             04210000
               PERFORM 2000-READ-BP13F915    THRU 2000-EXIT             04220000
                 UNTIL F915-NUM-BSNS-REF NOT = WS-AR-REGN-NO OR         04230000
                       F915-EOF                                         04240000
           END-IF.                                                      04250000
                                                                        04260000
       3000-EXIT.                                                       04270000
           EXIT.                                                        04280000
                                                                        04290000
      *--------------------*                                            04300000
       3010-INITIALIZE-PARA.                                            04310000
      *--------------------*                                            04320000
                                                                        04330000
           MOVE    'Y'         TO   WS-C993-OK.                         04340000
           MOVE    'Y'         TO   WS-C808-OK.                         04350000
           MOVE    'Y'         TO   WS-C809-OK.                         04360000
                                                                        04370000
           MOVE    'Y'         TO   WS-COMMIT-OK.                       04380000
                                                                        04390000
       3010-EXIT.                                                       04400000
            EXIT.                                                       04410000
                                                                        04420000
      *-----------------------*                                         04430000
       3020-INITZE-CDB-ROUTINE.                                         04440000
      *-----------------------*                                         04450000
                                                                        04460000
           MOVE    SPACES      TO   BE01W993-COMMAREA.                  04470000
           MOVE    SPACES      TO   BE01W808-COMMAREA.                  04480000
           MOVE    SPACES      TO   BE01W809-COMMAREA.                  04490000
                                                                        04500000
           INITIALIZE BE01W993-COMMAREA.                                04510000
           INITIALIZE BE01W808-COMMAREA.                                04520000
           INITIALIZE BE01W809-COMMAREA.                                04530000
                                                                        04540000
       3020-EXIT.                                                       04550000
            EXIT.                                                       04560000
                                                                        04570000
      *------------------*                                              04580000
       3030-GET-DATETIME.                                               04590000
      *------------------*                                              04600000
                                                                        04610000
           MOVE SPACES                   TO WS-MSGNO.                   04620000
           MOVE FUNCTION CURRENT-DATE    TO WS-DTE .                    04630000
                                                                        04640000
           IF BE01W808-IN-TXN-TYPE = 'AR' OR 'UA' OR 'DE' OR 'TE'       04650000
              STRING WS-DTE(1:4) '-' WS-DTE(5:2) '-'                    04660000
                     WS-DTE(7:2) DELIMITED BY SIZE                      04670000
                     INTO  BE01W808-IN-DTE-UPDATE-SOURCE                04680000
                                                                        04690000
              STRING WS-DTE(9:2) '.' WS-DTE(11:2) '.' WS-DTE(13:2)      04700000
                     DELIMITED BY SIZE INTO                             04710000
                     BE01W808-IN-TME-UPDATE-SOURCE                      04720000
           END-IF.                                                      04730000
                                                                        04740000
           IF BE01W809-IN-TXN-TYPE = 'AM'                               04750000
              STRING WS-DTE(1:4) '-' WS-DTE(5:2) '-'                    04760000
                     WS-DTE(7:2) DELIMITED BY SIZE                      04770000
                     INTO  BE01W809-IN-DTE-UPDATE-SOURCE                04780000
                                                                        04790000
              STRING WS-DTE(9:2) '.' WS-DTE(11:2) '.' WS-DTE(13:2)      04800000
                     DELIMITED BY SIZE INTO                             04810000
                     BE01W809-IN-TME-UPDATE-SOURCE                      04820000
           END-IF.                                                      04830000
                                                                        04840000
       3030-EXIT.                                                       04850000
           EXIT.                                                        04860000
                                                                        04870000
      *----------------------*                                          04880000
       3040-CONVERT-ID-TYPE.                                            04890000
      *----------------------*                                          04900000
                                                                        04910000
           MOVE F915-NUM-IDNTY-NO    TO  WS-NUM-NRIC                    04920000
                                                                        04930000
           IF WS-NUM-NRIC(1:1) = 'S' OR 'T'                             04940000
              MOVE 'UIN'             TO  WS-NUM-IDNTY-NO-TYPE           04950000
           ELSE                                                         04960000
              IF WS-NUM-NRIC(1:1) = 'G' OR 'F' OR 'M'                   04970001
                 MOVE 'FIN'          TO  WS-NUM-IDNTY-NO-TYPE           04980000
              ELSE                                                      04990000
                 MOVE 'XIN'          TO  WS-NUM-IDNTY-NO-TYPE           05000000
              END-IF                                                    05010000
           END-IF.                                                      05020000
                                                                        05030000
           MOVE WS-NUM-IDNTY-NO-TYPE TO  BE01W993-IN-NUM-IDNTY-NO-TYPE  05040000
                                         BE01W808-IN-NUM-IDNTY-NO-TYPE  05050000
                                         BE01W809-IN-CSTMR-IDNTY-TYPE   05060000
                                         F915-NUM-IDNTY-NO-TYPE         05070000
                                                                        05080000
           IF F915-NUM-IDNTY-NO (1:1) = 'S' OR 'T' OR 'F' OR 'G' OR 'M' 05090001
              MOVE F915-NUM-IDNTY-NO      TO BE01W993-IN-NUM-IDNTY-NO   05100000
                                             BE01W808-IN-NUM-IDNTY-NO   05110000
                                             BE01W809-IN-CSTMR-IDNTY-NO 05120000
           ELSE                                                         05130000
              MOVE F915-NUM-IDNTY-NO(2:8) TO BE01W993-IN-NUM-IDNTY-NO   05140000
                                             BE01W808-IN-NUM-IDNTY-NO   05150000
                                             BE01W809-IN-CSTMR-IDNTY-NO 05160000
                                                                        05170000
              MOVE F915-NME-PERSON      TO BE01W993-IN-NME-PERSON       05180000
                                           BE01W808-IN-NME-PERSON       05190000
                                           BE01W809-IN-CSTMR-NME-PERSON 05200000
           END-IF.                                                      05210000
                                                                        05220000
       3040-EXIT.                                                       05230000
            EXIT.                                                       05240000
                                                                        05250000
      *------------------*                                              05260000
       3050-READ-BE01KMSG.                                              05270000
      *------------------*                                              05280000
                                                                        05290000
            INITIALIZE KMSG-INFO.                                       05300000
            MOVE    WS-MSGNO             TO  KMSG-KEY.                  05310000
            READ BE01KMSG.                                              05320000
            EVALUATE  WS-KMSG-STATUS                                    05330000
                WHEN '00'                                               05340000
                     MOVE KMSG-KEY       TO  WS-MSGNO                   05350000
                     MOVE KMSG-TXT-MSG   TO  WS-MSG-TEXT                05360000
                WHEN '23'                                               05370000
                     MOVE 'MSG NO NOT FOUND - BE01KMSG'  TO KMSG-KEY    05380000
                WHEN  OTHER                                             05390000
                     MOVE 'READING ERROR IN BE01KMSG'    TO KMSG-KEY    05400000
            END-EVALUATE.                                               05410000
                                                                        05420000
       3050-EXIT.                                                       05430000
            EXIT.                                                       05440000
                                                                        05450000
      *---------------------*                                           05460000
       4000-AR-PERSON-DETAIL.                                           05470000
      *---------------------*                                           05480000
                                                                        05490000
           PERFORM  3020-INITZE-CDB-ROUTINE THRU 3020-EXIT.             05500000
           PERFORM  4100-CALL-BE01C993      THRU 4100-EXIT.             05510000
           PERFORM  4200-AR-F915-TO-CDB     THRU 4200-EXIT.             05520000
           PERFORM  4300-CALL-BE01C809      THRU 4300-EXIT.             05530000
                                                                        05540000
           IF WS-C993-OK = 'Y' AND WS-C808-OK = 'Y' AND WS-C809-OK = 'Y'05550000
              PERFORM 4500-WRITE-BP13F820 THRU 4500-EXIT                05560000
              PERFORM 2000-READ-BP13F915 THRU 2000-EXIT                 05570000
              ADD  1    TO    WS-NO-SUCCESSFUL-CDB                      05580000
           ELSE                                                         05590000
              MOVE 'N' TO WS-COMMIT-OK                                  05600000
           END-IF.                                                      05610000
                                                                        05620000
       4000-EXIT.                                                       05630000
            EXIT.                                                       05640000
                                                                        05650000
      *----------------------------------------------------------------*05660000
      * RTN-ACTION ¦   MSG NO. AND MSG TEXT                            *05670000
      *----------------------------------------------------------------*05680000
      *   'R'      ¦   0008 - INVALID OPTION                           *05690000
      *            ¦   0068 - INPUT REQUIRED IDENTITY NUMBER           *05700000
      *            ¦   0020 - INPUT REQUIRED IDENTITY TYPE             *05710000
      *            ¦   0021 - INPUT REQUIRED NAME                      *05720000
      *-----------------------------------------------------------------05730000
      *-----------------*                                               05740000
       4100-CALL-BE01C993.                                              05750000
      *-----------------*                                               05760000
                                                                        05770000
           PERFORM 3040-CONVERT-ID-TYPE    THRU 3040-EXIT.              05780000
                                                                        05790000
           MOVE    'OBTID'            TO  BE01W993-IN-RTN-FXN.          05800000
                                                                        05810000
           CALL 'BE01C993' USING  BE01W993-COMMAREA.                    05820000
                                                                        05830000
           IF BE01W993-OUT-RTN-ACTION = 'S'                             05840000
              PERFORM 9000-SQL-ERROR      THRU 9000-EXIT                05850000
           END-IF.                                                      05860000
                                                                        05870000
           IF BE01W993-OUT-RTN-ACTION = 'R'                             05880000
              MOVE BE01W993-OUT-RTN-MSGNO   TO   WS-MSGNO               05890000
              MOVE 'N'                      TO   WS-C993-OK             05900000
                                                                        05910000
              PERFORM 3050-READ-BE01KMSG    THRU 3050-EXIT              05920000
              DISPLAY 'CALLING BE01C993 - ERROR'                        05930000
              DISPLAY 'ERROR TYPE       : ' BE01W993-OUT-RTN-ACTION     05940000
              DISPLAY 'PROGRAM ID       : ' BE01W993-OUT-RTN-PGMID      05950000
              DISPLAY 'ERROR MESSAGE NO : ' WS-MSGNO   '-' WS-MSG-TEXT  05960000
              DISPLAY 'ERROR STATUS CODE: ' BE01W993-OUT-RTN-STATCDE    05970000
              DISPLAY 'HDBREF           : ' F915-NUM-REGN               05980000
              DISPLAY 'IDNTY NO         : ' F915-NUM-NRIC               05990000
                                                                        06000000
           ELSE                                                         06010000
      *                                                                 06020000
      *    CUSTOMER ALREADY EXIST                                       06030000
      *                                                                 06040000
              IF BE01W993-OUT-NUM-CSTMR-TAG = 'E'                       06050000
                 MOVE BE01W993-OUT-NUM-CSTMR TO WS-NUM-CSTMR            06060000
                 PERFORM 4110-RETRIEVE-PERSON-TBL THRU 4110-EXIT        06070000
                 PERFORM 5000-READ-CSTMR-ROLE     THRU 5000-EXIT        06080000
              ELSE                                                      06090000
                 PERFORM 4120-MOVE-PERSON-INFO THRU 4120-EXIT           06100000
              END-IF                                                    06110000
           END-IF.                                                      06120000
                                                                        06130000
       4100-EXIT.                                                       06140000
            EXIT.                                                       06150000
                                                                        06160000
      *------------------------*                                        06170000
       4110-RETRIEVE-PERSON-TBL.                                        06180000
      *------------------------*                                        06190000
                                                                        06200000
            EXEC SQL                                                    06210000
                 SELECT  NME_PERSON ,                                   06220000
                         NUM_NTNLTY ,                                   06230000
                         NUM_PR_STATUS ,                                06240000
                         NUM_SEX ,                                      06250000
                         NUM_ETHNIC_GROUP ,                             06260000
                         NUM_MRTL_STATUS ,                              06270000
                         DTE_BIRTH ,                                    06280000
                         NUM_CSTMR ,                                    06290000
                         NUM_PRTCLR_LOCK                                06300000
                   INTO  :DCLPERSONS.NME-PERSON ,                       06310000
                         :DCLPERSONS.NUM-NTNLTY ,                       06320000
                         :DCLPERSONS.NUM-PR-STATUS ,                    06330000
                         :DCLPERSONS.NUM-SEX ,                          06340000
                         :DCLPERSONS.NUM-ETHNIC-GROUP ,                 06350000
                         :DCLPERSONS.NUM-MRTL-STATUS ,                  06360000
                         :DCLPERSONS.DTE-BIRTH ,                        06370000
                         :DCLPERSONS.NUM-CSTMR  ,                       06380000
                         :DCLPERSONS.NUM-PRTCLR-LOCK                    06390000
                   FROM  PERSONS                                        06400000
                   WHERE NUM_CSTMR = :WS-NUM-CSTMR                      06410000
            END-EXEC.                                                   06420000
                                                                        06430000
            EVALUATE SQLCODE                                            06440000
             WHEN 000                                                   06450000
                  IF NUM-PRTCLR-LOCK OF DCLPERSONS = 'L'                06460000
                     IF F915-NUM-MRTL-STATUS > SPACES                   06470000
                        PERFORM 4410-CONVERT-MARITAL-CODE THRU 4410-EXIT06480000
                     END-IF                                             06490000
                  ELSE                                                  06500000
                     PERFORM 4120-MOVE-PERSON-INFO THRU 4120-EXIT       06510000
                  END-IF                                                06520000
             WHEN 100                                                   06530000
                  DISPLAY 'REC NOT IN PERSONS TABLE ' WS-NUM-CSTMR      06540000
                          ' ' F915-KEY-FLD                              06550000
             WHEN OTHER                                                 06560000
                  PERFORM  9000-SQL-ERROR  THRU  9000-EXIT              06570000
            END-EVALUATE.                                               06580000
                                                                        06590000
       4110-EXIT.                                                       06600000
            EXIT.                                                       06610000
                                                                        06620000
      *---------------------*                                           06630000
       4120-MOVE-PERSON-INFO.                                           06640000
      *---------------------*                                           06650000
                                                                        06660000
           MOVE    F915-NME-PERSON         TO   BE01W808-IN-NME-PERSON. 06670000
                                                                        06680000
           IF F915-NUM-NTNLTY = SPACES OR LOW-VALUES                    06690000
              MOVE 'UN'                    TO   BE01W808-IN-NUM-NTNLTY  06700000
           ELSE                                                         06710000
              MOVE F915-NUM-NTNLTY         TO   BE01W808-IN-NUM-NTNLTY  06720000
           END-IF.                                                      06730000
                                                                        06740000
           STRING  F915-DTE-BIRTH(1:4)  '-'                             06750000
                   F915-DTE-BIRTH(5:2)  '-'                             06760000
                   F915-DTE-BIRTH(7:2)                                  06770000
                   DELIMITED BY SIZE       INTO BE01W808-IN-DTE-BIRTH.  06780000
                                                                        06790000
           PERFORM 4400-CONVERT-DATA       THRU 4400-EXIT.              06800000
                                                                        06810000
       4120-EXIT.                                                       06820000
            EXIT.                                                       06830000
                                                                        06840000
      *---------------------*                                           06850000
       4200-AR-F915-TO-CDB.                                             06860000
      *---------------------*                                           06870000
                                                                        06880000
           IF WS-C993-OK = 'N'                                          06890000
              GO TO 4200-EXIT                                           06900000
           END-IF                                                       06910000
                                                                        06920000
           MOVE    'AR'               TO   BE01W808-IN-TXN-TYPE.        06930000
           PERFORM 4210-PASS-BE01W808 THRU 4210-EXIT.                   06940000
           PERFORM 4220-LINK-BE01C808 THRU 4220-EXIT.                   06950000
                                                                        06960000
       4200-EXIT.                                                       06970000
            EXIT.                                                       06980000
                                                                        06990000
      *---------------------*                                           07000000
       4210-PASS-BE01W808.                                              07010000
      *---------------------*                                           07020000
                                                                        07030000
           PERFORM  3030-GET-DATETIME  THRU 3030-EXIT.                  07040000
                                                                        07050000
           MOVE 'WRITE'                TO BE01W808-IN-RTN-FXN.          07060000
           MOVE 'P'                    TO BE01W808-IN-CSTMR-TYPE.       07070000
           MOVE F915-NUM-UPDATE-SOURCE TO BE01W808-IN-NUM-UPDATE-SOURCE.07080000
           MOVE SPACES                 TO BE01W808-IN-NUM-UPDATE-USERID.07090000
                                                                        07100000
           IF BE01W808-IN-TXN-TYPE = 'AR'                               07110000
              MOVE F915-NUM-NEW-ROLE   TO BE01W808-IN-NUM-ROLE          07120000
           ELSE                                                         07130000
             IF BE01W808-IN-TXN-TYPE = 'DE'                             07140000
                MOVE F915-NUM-ROLE     TO BE01W808-IN-NUM-ROLE          07150000
             END-IF                                                     07160000
           END-IF.                                                      07170000
                                                                        07180000
           MOVE F915-NUM-BSNS-REF      TO BE01W808-IN-NUM-BSNS-REF.     07190000
           MOVE '0001-01-01'           TO BE01W808-IN-DTE-ACPTNC.       07200000
                                                                        07210000
           IF F915-DTE-ROLE-START > SPACES                              07220000
              MOVE F915-DTE-ROLE-START TO BE01W808-IN-DTE-ROLE-START    07230000
           ELSE                                                         07240000
              MOVE SPACES              TO BE01W808-IN-DTE-ROLE-START    07250000
           END-IF.                                                      07260000
                                                                        07270000
       4210-EXIT.                                                       07280000
            EXIT.                                                       07290000
                                                                        07300000
      *---------------------*                                           07310000
       4220-LINK-BE01C808.                                              07320000
      *---------------------*                                           07330000
                                                                        07340000
           CALL 'BE01C808'  USING BE01W808-COMMAREA.                    07350000
                                                                        07360000
           IF  BE01W808-OUT-RTN-ACTION     = 'S'                        07370000
               PERFORM 9010-DISP-SEVEAR-ERR-C808   THRU 9010-EXIT       07380000
           ELSE                                                         07390000
             IF BE01W808-OUT-RTN-ACTION    = 'R'                        07400000
                PERFORM 4230-DISP-REJECT-ERR-C808  THRU 4230-EXIT       07410000
             ELSE                                                       07420000
               IF BE01W808-OUT-RTN-ACTION  = 'W' OR SPACES              07430000
                  PERFORM 4240-UPD-C808-BP13F915 THRU 4240-EXIT         07440000
                  PERFORM 4250-CAL-COUNTER       THRU 4250-EXIT         07450000
               END-IF                                                   07460000
             END-IF                                                     07470000
           END-IF.                                                      07480000
                                                                        07490000
       4220-EXIT.                                                       07500000
            EXIT.                                                       07510000
                                                                        07520000
      ******************************************************************07530000
      * THE MESSAGE NO.'0075' MEANS , RECORD IS ALREDAY EXISTED IN CDB *07540000
      * IF RECORD IS ALREADY EXISTED, JUSY WRITE  CSTMR-SOURCE IN F820 *07550000
      ******************************************************************07560000
      *-------------------------*                                       07570000
       4230-DISP-REJECT-ERR-C808.                                       07580000
      *-------------------------*                                       07590000
                                                                        07600000
            IF BE01W808-OUT-RTN-MSGNO  = '0075'                         07610000
               PERFORM 4240-UPD-C808-BP13F915  THRU 4240-EXIT           07620000
               ADD  1  TO WS-NO-EXIST-CDB-PERSON                        07630000
            ELSE                                                        07640000
               IF BE01W808-IN-TXN-TYPE = 'DE'                           07650000
                  IF BE01W808-OUT-RTN-MSGNO = '0091'                    07660000
                     CONTINUE                                           07670000
                  END-IF                                                07680000
               ELSE                                                     07690000
                  MOVE BE01W808-OUT-RTN-MSGNO      TO   WS-MSGNO        07700000
                  PERFORM  3050-READ-BE01KMSG      THRU 3050-EXIT       07710000
                  DISPLAY  SPACES                                       07720000
                  DISPLAY "F915-KEY-FLD            : " F915-KEY-FLD     07730000
                  DISPLAY "BE01W808-OUT-RTN-MSGNO  : " WS-MSGNO         07740000
                  DISPLAY "REASON FOR ERROR MSG    : " WS-MSG-TEXT      07750000
                                                                        07760000
                  ADD     1                        TO   WS-NO-FAIL-REC  07770000
                  MOVE   'N'                       TO   WS-C808-OK      07780000
              END-IF                                                    07790000
            END-IF.                                                     07800000
       4230-EXIT.                                                       07810000
            EXIT.                                                       07820000
                                                                        07830000
      *---------------------*                                           07840000
       4240-UPD-C808-BP13F915.                                          07850000
      *---------------------*                                           07860000
                                                                        07870000
           MOVE BE01W808-IN-TXN-TYPE          TO F915-TXN-TYPE.         07880000
                                                                        07890000
           MOVE BE01W808-OUT-NUM-CSTMR        TO F915-NUM-CSTMR-SOURCE. 07900000
           MOVE BE01W808-IN-DTE-UPDATE-SOURCE TO F915-DTE-UPDATE-SOURCE.07910000
           MOVE BE01W808-IN-TME-UPDATE-SOURCE TO F915-TME-UPDATE-SOURCE.07920000
                                                                        07930000
           PERFORM    8300-WRITE-P13F915B     THRU  8300-EXIT.          07940000
                                                                        07950000
       4240-EXIT.                                                       07960000
            EXIT.                                                       07970000
                                                                        07980000
      *----------------*                                                07990000
       4250-CAL-COUNTER.                                                08000000
      *----------------*                                                08010000
                                                                        08020000
           IF BE01W808-IN-TXN-TYPE = 'AR'                               08030000
              ADD    1        TO  WS-NO-WRT-CDB-PERSON                  08040000
           ELSE                                                         08050000
             IF BE01W808-IN-TXN-TYPE = 'DE'                             08060000
                ADD  1        TO  WS-NO-DEL-CDB-PERSON                  08070000
             END-IF                                                     08080000
           END-IF.                                                      08090000
                                                                        08100000
       4250-EXIT.                                                       08110000
            EXIT.                                                       08120000
                                                                        08130000
      *------------------*                                              08140000
       4300-CALL-BE01C809.                                              08150000
      *------------------*                                              08160000
                                                                        08170000
           IF WS-C808-OK = 'N'  OR WS-C993-OK = 'N'                     08180000
              GO TO 4300-EXIT                                           08190000
           END-IF                                                       08200000
                                                                        08210000
           IF BE01W808-IN-TXN-TYPE = 'AR'                               08220000
              IF (F915-NUM-MRTL-STATUS = 'M' OR '2')                    08230000
                 IF (WS-C993-OK = 'Y' )                        AND      08240000
                    (WS-C808-OK = 'Y' )                        AND      08250000
                    (F915-NME-SP  NOT = SPACES AND LOW-VALUES) AND      08260000
                    (F915-NUM-IDNTY-NO-SP NOT = SPACES)                 08270000
                      CONTINUE                                          08280000
                  ELSE                                                  08290000
                     PERFORM 8100-PRINT-ERROR-REPORT THRU 8100-EXIT     08300000
                     MOVE 'N' TO WS-C809-OK                             08310000
                     GO TO 4300-EXIT                                    08320000
                  END-IF                                                08330000
              ELSE                                                      08340000
                  GO TO 4300-EXIT                                       08350000
              END-IF                                                    08360000
           ELSE                                                         08370000
              GO TO 4300-EXIT                                           08380000
           END-IF.                                                      08390000
                                                                        08400000
           PERFORM 4310-PASS-BE01W809 THRU 4310-EXIT.                   08410000
                                                                        08420000
           CALL 'BE01C809'          USING BE01W809-COMMAREA.            08430000
                                                                        08440000
           IF  BE01W809-OUT-RTN-ACTION = 'S'                            08450000
               PERFORM 4320-DISP-SEVEAR-ERR-C809  THRU 4320-EXIT        08460000
           END-IF.                                                      08470000
                                                                        08480000
           IF  BE01W809-OUT-RTN-ACTION  NOT = SPACES                    08490000
               PERFORM 4350-DISP-NORMAL-ERR-C809  THRU 4350-EXIT        08500000
           ELSE                                                         08510000
               PERFORM 4360-UPD-C809-BP13F915     THRU 4360-EXIT        08520000
               ADD  1  TO WS-NO-WRT-CDB-MARRIAGE                        08530000
           END-IF.                                                      08540000
                                                                        08550000
       4300-EXIT.                                                       08560000
            EXIT.                                                       08570000
                                                                        08580000
      *------------------*                                              08590000
       4310-PASS-BE01W809.                                              08600000
      *------------------*                                              08610000
           MOVE 'WRITE'                TO BE01W809-IN-RTN-FXN.          08620000
           MOVE 'AM'                   TO BE01W809-IN-TXN-TYPE.         08630000
           MOVE F915-NUM-UPDATE-SOURCE TO BE01W809-IN-NUM-UPDATE-SOURCE.08640000
           MOVE SPACES                 TO BE01W809-IN-NUM-UPDATE-USERID.08650000
                                                                        08660000
           PERFORM  3030-GET-DATETIME  THRU 3030-EXIT.                  08670000
                                                                        08680000
           MOVE F915-NME-PSN           TO BE01W809-IN-CSTMR-NME-PERSON. 08690000
                                                                        08700000
      *******  TO GET THE IDENFICATION TYPE OF SPOUSE   ******          08710000
           MOVE F915-NUM-IDNTY-NO-SP     TO  WS-NUM-NRIC                08720000
                                                                        08730000
           IF WS-NUM-NRIC(1:1) = 'S' OR 'T'                             08740000
              MOVE 'UIN'            TO   WS-NUM-IDNTY-NO-TYPE           08750000
           ELSE                                                         08760000
              IF WS-NUM-NRIC(1:1) = 'G' OR 'F' OR 'M'                   08770001
                 MOVE 'FIN'         TO   WS-NUM-IDNTY-NO-TYPE           08780000
              ELSE                                                      08790000
                 MOVE 'XIN'         TO   WS-NUM-IDNTY-NO-TYPE           08800000
              END-IF                                                    08810000
           END-IF.                                                      08820000
                                                                        08830000
           MOVE WS-NUM-IDNTY-NO-TYPE TO  BE01W809-IN-SPOUSE-IDNTY-TYPE  08840000
                                         F915-NUM-IDNTY-NO-TYPE-SP.     08850000
                                                                        08860000
           IF WS-NUM-IDNTY-NO-TYPE = 'XIN'                              08870000
              MOVE F915-NUM-IDNTY-NO-SP(2:8) TO                         08880000
                                         BE01W809-IN-SPOUSE-IDNTY-NO    08890000
           ELSE                                                         08900000
              IF WS-NUM-IDNTY-NO-TYPE = 'UIN' OR 'FIN'                  08910000
                 MOVE F915-NUM-IDNTY-NO-SP TO                           08920000
                                         BE01W809-IN-SPOUSE-IDNTY-NO    08930000
              END-IF                                                    08940000
           END-IF.                                                      08950000
                                                                        08960000
           MOVE  F915-NME-SP        TO  BE01W809-IN-SPOUSE-NME-PERSON.  08970000
           MOVE  '0001-01-01'       TO  BE01W809-IN-DTE-MRG.            08980000
                                                                        08990000
       4310-EXIT.                                                       09000000
            EXIT.                                                       09010000
                                                                        09020000
      *-------------------------*                                       09030000
       4320-DISP-SEVEAR-ERR-C809.                                       09040000
      *-------------------------*                                       09050000
                                                                        09060000
            MOVE    BE01W809-OUT-RTN-MSGNO     TO   WS-MSGNO.           09070000
            PERFORM 3050-READ-BE01KMSG         THRU 3050-EXIT.          09080000
            DISPLAY 'CALLING BE01C809 - SEVEAR ERROR'.                  09090000
            DISPLAY 'ERROR TYPE        : ' BE01W809-OUT-RTN-ACTION.     09100000
            DISPLAY 'PROGRAM ID        : ' BE01W809-OUT-RTN-PGMID.      09110000
            DISPLAY 'ERROR MESSAGE NO  : ' WS-MSGNO.                    09120000
            DISPLAY 'ERROR MESSAGE NO  : ' WS-MSG-TEXT.                 09130000
            DISPLAY 'ERROR STATUS CODE : ' BE01W809-OUT-RTN-STATCDE.    09140000
                                                                        09150000
            DISPLAY 'TRANSACTION TYPE  : ' BE01W809-IN-TXN-TYPE.        09160000
            DISPLAY 'IDNTY NO OF CSTMR : ' F915-NUM-IDNTY-NO-PSN        09170000
            DISPLAY 'NAME OF CSTMR     : ' F915-NME-PSN.                09180000
                                                                        09190000
            DISPLAY 'IDNTY NO OF SPOUSE:'  F915-NUM-IDNTY-NO-SP.        09200000
            DISPLAY 'NAME OF SPOUSE    :'  F915-NME-SP.                 09210000
            PERFORM 9000-SQL-ERROR             THRU 9000-EXIT.          09220000
                                                                        09230000
       4320-EXIT.                                                       09240000
            EXIT.                                                       09250000
                                                                        09260000
      ******************************************************************09270000
      *  THE ERROR MESSAGE "0175" MEANS , MARRIAGE DATE IS ALREADY     *09280000
      *  EXISTED IN CDB MARRIAGE TABLE AND DEFAULT DATE IS NOT ALLOWED *09290000
      *  TO UPDATE TO CDB. SO, HERE WE ARE BYPASSING THE ERROR "0175". *09300000
      ******************************************************************09310000
      *-------------------------*                                       09320000
       4350-DISP-NORMAL-ERR-C809.                                       09330000
      *-------------------------*                                       09340000
                                                                        09350000
           IF BE01W809-OUT-RTN-MSGNO = '0175' OR '0171' OR '0176'       09360000
              PERFORM 4360-UPD-C809-BP13F915    THRU 4360-EXIT          09370000
              ADD  1  TO  WS-NO-EXIST-CDB-MRG                           09380000
           ELSE                                                         09390000
              MOVE BE01W809-OUT-RTN-MSGNO       TO   WS-MSGNO           09400000
              PERFORM 3050-READ-BE01KMSG        THRU 3050-EXIT          09410000
              DISPLAY SPACES                                            09420000
              DISPLAY "F915-TXN-TYPE            : " BE01W808-IN-TXN-TYPE09430000
              DISPLAY "F915-NUM-REGN            : " F915-NUM-BSNS-REF   09440000
              DISPLAY "F915-NUM-NRIC            : " F915-NUM-NRIC       09450000
              DISPLAY "BE01W809-OUT-RTN-MSGNO   : " WS-MSGNO            09460000
              DISPLAY "REASON FOR ERROR MSG     : " WS-MSG-TEXT         09470000
                                                                        09480000
              MOVE      'N'                      TO WS-C809-OK          09490000
           END-IF.                                                      09500000
                                                                        09510000
       4350-EXIT.                                                       09520000
            EXIT.                                                       09530000
                                                                        09540000
      *----------------------*                                          09550000
       4360-UPD-C809-BP13F915.                                          09560000
      *----------------------*                                          09570000
                                                                        09580000
           MOVE BE01W809-IN-TXN-TYPE     TO    F915-TXN-TYPE .          09590000
                                                                        09600000
           MOVE BE01W809-OUT-SPOUSE-NUM-CSTMR                           09610000
                                         TO    F915-NUM-CSTMR-SOURCE-SP.09620000
           MOVE BE01W809-IN-DTE-UPDATE-SOURCE                           09630000
                                         TO    F915-DTE-UPDATE-SOURCE.  09640000
           MOVE BE01W809-IN-TME-UPDATE-SOURCE                           09650000
                                         TO    F915-TME-UPDATE-SOURCE.  09660000
           PERFORM  8300-WRITE-P13F915B  THRU  8300-EXIT.               09670000
                                                                        09680000
       4360-EXIT.                                                       09690000
            EXIT.                                                       09700000
                                                                        09710000
      *-------------------*                                             09720000
       4400-CONVERT-DATA.                                               09730000
      *-------------------*                                             09740000
                                                                        09750000
           IF F915-NUM-MRTL-STATUS > SPACES                             09760000
              PERFORM 4410-CONVERT-MARITAL-CODE    THRU 4410-EXIT       09770000
           END-IF.                                                      09780000
                                                                        09790000
           IF F915-NUM-SEX > SPACES                                     09800000
              PERFORM 4420-CONVERT-SEX-CODE        THRU 4420-EXIT       09810000
           END-IF.                                                      09820000
                                                                        09830000
           IF F915-NUM-ETHNIC-GROUP > SPACES                            09840000
              PERFORM 4430-CONVERT-ETHNIC-CODE     THRU 4430-EXIT       09850000
           END-IF.                                                      09860000
                                                                        09870000
           IF F915-NUM-PR-STATUS > SPACES                               09880000
              PERFORM 4440-CONVERT-PRSTATUS-TO-CDB THRU 4440-EXIT       09890000
           END-IF.                                                      09900000
                                                                        09910000
       4400-EXIT.                                                       09920000
            EXIT.                                                       09930000
                                                                        09940000
      *-------------------------*                                       09950000
       4410-CONVERT-MARITAL-CODE.                                       09960000
      *-------------------------*                                       09970000
                                                                        09980000
            MOVE    SPACES               TO    K060-KEY-FLD.            09990000
            MOVE    44                   TO    K060-SERIAL-NO.          10000000
            MOVE    F915-NUM-MRTL-STATUS TO    K060-CODE.               10010000
            PERFORM 4450-CHECK-BP13K060  THRU  4450-EXIT.               10020000
                                                                        10030000
            IF WS-K060-STATUS = 00                                      10040000
               MOVE  K060-DESC1          TO BE01W808-IN-NUM-MRTL-STATUS 10050000
            END-IF.                                                     10060000
                                                                        10070000
       4410-EXIT.                                                       10080000
            EXIT.                                                       10090000
                                                                        10100000
      *---------------------*                                           10110000
       4420-CONVERT-SEX-CODE.                                           10120000
      *---------------------*                                           10130000
                                                                        10140000
            MOVE    SPACES               TO    K060-KEY-FLD.            10150000
            MOVE    43                   TO    K060-SERIAL-NO.          10160000
            MOVE    F915-NUM-SEX         TO    K060-CODE.               10170000
            PERFORM 4450-CHECK-BP13K060  THRU  4450-EXIT.               10180000
                                                                        10190000
            IF WS-K060-STATUS = 00                                      10200000
               MOVE    K060-DESC1        TO    BE01W808-IN-NUM-SEX      10210000
            END-IF.                                                     10220000
                                                                        10230000
       4420-EXIT.                                                       10240000
            EXIT.                                                       10250000
                                                                        10260000
      *------------------------*                                        10270000
       4430-CONVERT-ETHNIC-CODE.                                        10280000
      *------------------------*                                        10290000
                                                                        10300000
            MOVE    SPACES                TO    K060-KEY-FLD.           10310000
            MOVE    42                    TO    K060-SERIAL-NO.         10320000
            MOVE    F915-NUM-ETHNIC-GROUP TO    K060-CODE.              10330000
            PERFORM 4450-CHECK-BP13K060   THRU  4450-EXIT.              10340000
                                                                        10350000
            IF WS-K060-STATUS = 00                                      10360000
               MOVE  K060-DESC1         TO BE01W808-IN-NUM-ETHNIC-GROUP 10370000
            END-IF.                                                     10380000
                                                                        10390000
       4430-EXIT.                                                       10400000
            EXIT.                                                       10410000
                                                                        10420000
      *--------------------------*                                      10430000
       4440-CONVERT-PRSTATUS-TO-CDB.                                    10440000
      *--------------------------*                                      10450000
                                                                        10460000
           SET CITZ TO 1.                                               10470000
           SEARCH CITZ-TYPE-TABLE                                       10480000
              AT  END MOVE SPACES       TO  BE01W808-IN-NUM-PR-STATUS   10490000
              WHEN F915-NUM-PR-STATUS   = CITZ-CODE(CITZ)               10500000
                   MOVE CITZ-DESC(CITZ) TO  BE01W808-IN-NUM-PR-STATUS   10510000
           END-SEARCH.                                                  10520000
                                                                        10530000
       4440-EXIT.                                                       10540000
            EXIT.                                                       10550000
                                                                        10560000
      *--------------------*                                            10570000
       4450-CHECK-BP13K060.                                             10580000
      *--------------------*                                            10590000
                                                                        10600000
            READ BP13K060.                                              10610000
                                                                        10620000
            EVALUATE WS-K060-STATUS                                     10630000
                WHEN 00                                                 10640000
                     CONTINUE                                           10650000
                WHEN 23                                                 10660000
                     DISPLAY 'NOT FND IN BP13K060 : ' WS-K060-STATUS    10670000
                             '  K060-KEY-FLD  : ' K060-KEY-FLD          10680000
                             '  F915-KEY-FLD  : ' F915-KEY-FLD          10690000
                WHEN OTHER                                              10700000
                     DISPLAY 'ERROR IN BP13K060 : ' WS-K060-STATUS      10710000
                             '  K060-KEY-FLD  :  ' K060-KEY-FLD         10720000
                     DISPLAY 'F915-KEY-FLD    :  ' F915-KEY-FLD         10730000
                     PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT         10740000
            END-EVALUATE.                                               10750000
                                                                        10760000
       4450-EXIT.                                                       10770000
            EXIT.                                                       10780000
                                                                        10790000
      *-------------------*                                             10800000
       4500-WRITE-BP13F820.                                             10810000
      *-------------------*                                             10820000
                                                                        10830000
            MOVE SPACES TO BP13F820-REC.                                10840000
            INITIALIZE BP13F820-REC.                                    10850000
                                                                        10860000
            MOVE F915-NUM-BSNS-REF(1:8)  TO  F820-NUM-REGN.             10870000
            MOVE F915-NUM-IDNTY-NO       TO  F820-NUM-NRIC.             10880000
            MOVE BE01W808-OUT-NUM-CSTMR  TO  F820-NUM-CSTMR-SOURCE.     10890000
                                                                        10900000
            WRITE BP13F820-REC.                                         10910000
            ADD   1                      TO  WS-NO-WRT-F820.            10920000
                                                                        10930000
       4500-EXIT.                                                       10940000
            EXIT.                                                       10950000
                                                                        10960000
      *--------------------*                                            10970000
       5000-READ-CSTMR-ROLE.                                            10980000
      *--------------------*                                            10990000
                                                                        11000000
            EXEC SQL                                                    11010000
                 SELECT   NUM_CSTMR,                                    11020000
                          NUM_ROLE                                      11030000
                 INTO    :DCLCSTMR-ROLE.NUM-CSTMR,                      11040000
                         :DCLCSTMR-ROLE.NUM-ROLE                        11050000
                 FROM     CSTMR_ROLE                                    11060000
                 WHERE    NUM_CSTMR = :WS-NUM-CSTMR                     11070000
            END-EXEC.                                                   11080000
                                                                        11090000
            EVALUATE SQLCODE                                            11100000
                WHEN 000                                                11110000
                     MOVE NUM-ROLE OF DCLCSTMR-ROLE  TO  WS-NUM-ROLE    11120000
                     IF   F915-NUM-ROLE =  WS-NUM-ROLE                  11130000
                                                                        11140000
                          MOVE    'DE'          TO BE01W808-IN-TXN-TYPE 11150000
                          MOVE    WS-NUM-CSTMR  TO                      11160000
                                  BE01W808-IN-NUM-CSTMR-SOURCE          11170000
                                                                        11180000
                          PERFORM 4210-PASS-BE01W808 THRU 4210-EXIT     11190000
                          PERFORM 4220-LINK-BE01C808 THRU 4220-EXIT     11200000
                     ELSE                                               11210000
                          MOVE    'N'           TO WS-C993-OK           11220000
                          ADD      1            TO WS-NO-ROLE-NOTMATCH  11230000
                     END-IF                                             11240000
                WHEN 100                                                11250000
                     DISPLAY 'REC NOT IN CSTMR_ROLE TABLE' WS-NUM-CSTMR 11260000
                             ' ' F915-NUM-REGN ' ' F915-NUM-NRIC        11270000
                WHEN OTHER                                              11280000
                     PERFORM 9000-SQL-ERROR     THRU 9000-EXIT          11290000
            END-EVALUATE.                                               11300000
                                                                        11310000
       5000-EXIT.                                                       11320000
            EXIT.                                                       11330000
                                                                        11340000
      *-----------------------*                                         11350000
       7000-CHECK-PRINT-REPORT.                                         11360000
      *-----------------------*                                         11370000
                                                                        11380000
           IF WS-NO-WRT-L970A-REC = ZEROES                              11390000
             ADD  1              TO   WS-PAGE-CTR                       11400000
             MOVE WS-PAGE-CTR    TO   L970A-PAGENO                      11410000
             WRITE WS-P13L970A-REC FROM L970A-PR-HEAD-01 AFTER PAGE     11420000
             WRITE WS-P13L970A-REC FROM L970A-PR-HEAD-02                11430000
             WRITE WS-P13L970A-REC FROM L970A-PR-LINE   AFTER 2         11440000
             WRITE WS-P13L970A-REC FROM L970A-PR-HEAD-03                11450000
             WRITE WS-P13L970A-REC FROM L970A-PR-LINE                   11460000
             WRITE WS-P13L970A-REC FROM L970A-PR-FOOTER AFTER 2         11470000
             WRITE WS-P13L970A-REC FROM L970A-PR-LINE   AFTER 2         11480000
           END-IF.                                                      11490000
                                                                        11500000
       7000-EXIT.                                                       11510000
            EXIT.                                                       11520000
                                                                        11530000
      *-----------------------*                                         11540000
       8100-PRINT-ERROR-REPORT.                                         11550000
      *-----------------------*                                         11560000
                                                                        11570000
           IF WS-LINE-CTR > 55                                          11580000
              ADD       1             TO     WS-PAGE-CTR                11590000
              MOVE  WS-PAGE-CTR       TO     L970A-PAGENO               11600000
              MOVE      6             TO     WS-LINE-CTR                11610000
                                                                        11620000
              WRITE WS-P13L970A-REC   FROM   L970A-PR-HEAD-01 AFTER PAGE11630000
              WRITE WS-P13L970A-REC   FROM   L970A-PR-HEAD-02           11640000
              WRITE WS-P13L970A-REC   FROM   L970A-PR-LINE    AFTER 2   11650000
              WRITE WS-P13L970A-REC   FROM   L970A-PR-HEAD-03           11660000
              WRITE WS-P13L970A-REC   FROM   L970A-PR-LINE              11670000
           END-IF.                                                      11680000
                                                                        11690000
           IF F915-NUM-BSNS-REF   NOT =  WS-PREV-REGN                   11700000
              ADD      1              TO     WS-SEQN-CTR                11710000
              MOVE WS-SEQN-CTR        TO     L970A-SNO                  11720000
              MOVE F915-NUM-BSNS-REF  TO     L970A-REGN-NO              11730000
           ELSE                                                         11740000
              MOVE ZEROES             TO     L970A-SNO                  11750000
              MOVE SPACES             TO     L970A-REGN-NO              11760000
           END-IF.                                                      11770000
                                                                        11780000
           MOVE  BE01W808-IN-TXN-TYPE TO     L966A-TRANS-ID.            11790000
           MOVE  F915-NUM-IDNTY-NO    TO     L970A-NRIC-NO.             11800000
           MOVE  F915-NUM-IDNTY-NO-SP TO     L970A-SP-NRIC-NO.          11810000
           MOVE  F915-NME-SP          TO     L970A-SP-NAME.             11820000
                                                                        11830000
           WRITE WS-P13L970A-REC      FROM   L970A-PR-DTL-01.           11840000
           MOVE  SPACES               TO     L970A-PR-DTL-01.           11850000
           ADD          1             TO     WS-NO-WRT-L970A-REC.       11860000
           ADD          1             TO     WS-LINE-CTR.               11870000
                                                                        11880000
           MOVE F915-NUM-BSNS-REF     TO     WS-PREV-REGN.              11890000
                                                                        11900000
       8100-EXIT.                                                       11910000
            EXIT.                                                       11920000
                                                                        11930000
      *-------------------*                                             11940000
       8200-WRITE-P13F915A.                                             11950000
      *-------------------*                                             11960000
                                                                        11970000
            MOVE    'AR'           TO  F915-TXN-TYPE.                   11980000
                                                                        11990000
            WRITE WS-P13F915A-REC FROM BP13F915-REC.                    12000000
            ADD     1              TO  WS-NO-WRT-F915A-REC.             12010000
                                                                        12020000
       8200-EXIT.                                                       12030000
            EXIT.                                                       12040000
                                                                        12050000
      *-------------------*                                             12060000
       8300-WRITE-P13F915B.                                             12070000
      *-------------------*                                             12080000
                                                                        12090000
            WRITE WS-P13F915B-REC FROM BP13F915-REC.                    12100000
            ADD     1              TO  WS-NO-WRT-F915B-REC.             12110000
                                                                        12120000
       8300-EXIT.                                                       12130000
            EXIT.                                                       12140000
                                                                        12150000
      ***************************************************************** 12160000
      *   ABORT PROCESSING DUE TO SQL ERRORS                          * 12170000
      ***************************************************************** 12180000
      *--------------*                                                  12190000
       9000-SQL-ERROR.                                                  12200000
      *--------------*                                                  12210000
                                                                        12220000
           DISPLAY ' *****   BP13C970 ABEND   *****'.                   12230000
                                                                        12240000
           CALL 'DBATIAR'  USING SQLCA.                                 12250000
           EXEC SQL   ROLLBACK   END-EXEC.                              12260000
           EVALUATE SQLCODE                                             12270000
               WHEN 0                                                   12280000
                    CONTINUE                                            12290000
               WHEN OTHER                                               12300000
                    DISPLAY 'ROLLBACK FAILED, SQLCODE IS : ' SQLCODE    12310000
           END-EVALUATE.                                                12320000
                                                                        12330000
           MOVE 12                        TO   RETURN-CODE.             12340000
           PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT.               12350000
                                                                        12360000
       9000-EXIT.                                                       12370000
            EXIT.                                                       12380000
                                                                        12390000
      *-------------------------*                                       12400000
       9010-DISP-SEVEAR-ERR-C808.                                       12410000
      *-------------------------*                                       12420000
                                                                        12430000
           MOVE    BE01W808-OUT-RTN-MSGNO     TO    WS-MSGNO.           12440000
           PERFORM 3050-READ-BE01KMSG         THRU  3050-EXIT.          12450000
                                                                        12460000
           DISPLAY 'C808 SEVEAR ERROR  '.                               12470000
           DISPLAY 'ERROR TYPE       : ' BE01W808-OUT-RTN-ACTION.       12480000
           DISPLAY 'PROGRAM ID       : ' BE01W808-OUT-RTN-PGMID.        12490000
           DISPLAY 'ERROR MESSAGE NO : ' WS-MSGNO.                      12500000
           DISPLAY 'ERROR MESSAGE TXT: ' WS-MSG-TEXT.                   12510000
           DISPLAY 'ERROR STATUS CODE: ' BE01W808-OUT-RTN-STATCDE.      12520000
                                                                        12530000
           DISPLAY 'TRANSACTION TYPE : ' BE01W808-IN-TXN-TYPE.          12540000
           DISPLAY 'HDBREF           : ' F915-NUM-BSNS-REF.             12550000
           DISPLAY 'IDNTY NO         : ' F915-NUM-IDNTY-NO.             12560000
           DISPLAY 'IDNTY NO TYPE    : ' F915-NUM-IDNTY-NO-TYPE         12570000
           DISPLAY 'NAME             : ' F915-NME-PERSON.               12580000
                                                                        12590000
           PERFORM 9000-SQL-ERROR   THRU  9000-EXIT.                    12600000
                                                                        12610000
       9010-EXIT.                                                       12620000
            EXIT.                                                       12630000
                                                                        12640000
      *--------------------*                                            12650000
       9020-PRINT-CONTROL.                                              12660000
      *-------------------*                                             12670000
                                                                        12680000
           MOVE   FUNCTION CURRENT-DATE   TO   WS-DTE                   12690000
           STRING WS-DTE(7:2) '/' WS-DTE(5:2) '/' WS-DTE(1:4)           12700000
                  DELIMITED BY SIZE       INTO WS-PRINT-DATE.           12710000
                                                                        12720000
           WRITE  WS-BP13L970-REC FROM WS-PRINT-HDG1 AFTER PAGE.        12730000
                                                                        12740000
           MOVE   SPACES                  TO   WS-BP13L970-REC.         12750000
           WRITE  WS-BP13L970-REC AFTER 2.                              12760000
                                                                        12770000
           MOVE   ' 1) NO. OF REC READ    FROM F915                  =' 12780000
                                          TO WS-PRINT-DESC              12790000
           MOVE    WS-NO-READ-F915        TO WS-PRINT-TOTAL             12800000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   12810000
                                                                        12820000
           MOVE   ' 2) NO. OF REC WRITTEN INTO P13F915A              =' 12830000
                                          TO WS-PRINT-DESC              12840000
           MOVE    WS-NO-WRT-F915A-REC    TO WS-PRINT-TOTAL             12850000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   12860000
                                                                        12870000
           MOVE   ' 3) NO. OF REC WRITTEN INTO P13F915B              =' 12880000
                                          TO WS-PRINT-DESC              12890000
           MOVE    WS-NO-WRT-F915B-REC    TO WS-PRINT-TOTAL             12900000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   12910000
                                                                        12920000
           MOVE   ' 4) NO. OF REC WRITTEN INTO P13L970A              =' 12930000
                                          TO WS-PRINT-DESC              12940000
           MOVE    WS-NO-WRT-L970A-REC    TO WS-PRINT-TOTAL             12950000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   12960000
                                                                        12970000
           MOVE   ' 5) NO. OF REC WRITTEN INTO F820                  =' 12980000
                                          TO WS-PRINT-DESC              12990000
           MOVE    WS-NO-WRT-F820         TO  WS-PRINT-TOTAL            13000000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13010000
                                                                        13020000
           MOVE   ' 6) NO. OF REC CREATED THE ROLE (REGN.NO WISE)    =' 13030000
                                          TO WS-PRINT-DESC              13040000
           MOVE    WS-NO-SUCCESSFUL-CDB   TO  WS-PRINT-TOTAL            13050000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13060000
                                                                        13070000
           MOVE   ' 7) NO. OF REC WRITTEN INTO CDB PERSONS  TABLE(AR)=' 13080000
                                          TO WS-PRINT-DESC              13090000
           MOVE    WS-NO-WRT-CDB-PERSON   TO  WS-PRINT-TOTAL            13100000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13110000
                                                                        13120000
           MOVE   ' 8) NO. OF REC WRITTEN INTO CDB MARRIAGE TABLE(AM)=' 13130000
                                          TO WS-PRINT-DESC              13140000
           MOVE    WS-NO-WRT-CDB-MARRIAGE TO  WS-PRINT-TOTAL            13150000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13160000
                                                                        13170000
           MOVE   ' 9) NO. OF REC DELETED FROM CDB MARRIAGE TABLE(DE)=' 13180000
                                          TO WS-PRINT-DESC              13190000
           MOVE    WS-NO-DEL-CDB-PERSON   TO  WS-PRINT-TOTAL            13200000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13210000
                                                                        13220000
           MOVE   '10) NO. OF REC ALREADY EXISTED IN CDB    TABLE    =' 13230000
                                          TO WS-PRINT-DESC              13240000
           MOVE    WS-NO-EXIST-CDB-PERSON TO WS-PRINT-TOTAL             13250000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13260000
                                                                        13270000
           MOVE   '11) NO. OF REC EXISTED IN MARRIAGE TBL WITH DATE  =' 13280000
                                          TO WS-PRINT-DESC              13290000
           MOVE    WS-NO-EXIST-CDB-MRG    TO WS-PRINT-TOTAL             13300000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13310000
                                                                        13320000
           MOVE   '12) NO. OF REC ROLE DOES NOT MATCH WITH CDB       =' 13330000
                                          TO WS-PRINT-DESC              13340000
           MOVE    WS-NO-ROLE-NOTMATCH    TO WS-PRINT-TOTAL             13350000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13360000
                                                                        13370000
           MOVE   '13) NO. OF REC FAILURE RECORDS                    =' 13380000
                                          TO WS-PRINT-DESC              13390000
           MOVE    WS-NO-FAIL-REC         TO WS-PRINT-TOTAL             13400000
           WRITE   WS-BP13L970-REC        FROM WS-PRINT-REC  AFTER 2.   13410000
                                                                        13420000
       9020-EXIT.                                                       13430000
            EXIT.                                                       13440000
                                                                        13450000
      *----------------------*                                          13460000
       9100-COMMIT-RECORDS.                                             13470000
      *----------------------*                                          13480000
                                                                        13490000
           EXEC SQL   COMMIT     END-EXEC.                              13500000
           EVALUATE SQLCODE                                             13510000
               WHEN 0                                                   13520000
                    CONTINUE                                            13530000
               WHEN OTHER                                               13540000
                    DISPLAY 'COMMIT ERROR - BP13I005  IS : '            13550000
                    PERFORM 9000-SQL-ERROR  THRU  9000-EXIT             13560000
           END-EVALUATE.                                                13570000
                                                                        13580000
       9100-EXIT.                                                       13590000
            EXIT.                                                       13600000
                                                                        13610000
      *-------------------------*                                       13620000
       9200-ROLLBACK-RECORDS.                                           13630000
      *-------------------------*                                       13640000
                                                                        13650000
           EXEC SQL   ROLLBACK   END-EXEC.                              13660000
           EVALUATE SQLCODE                                             13670000
               WHEN 0                                                   13680000
                    CONTINUE                                            13690000
               WHEN OTHER                                               13700000
                    DISPLAY 'ROLLBACK FAILED, SQLCODE IS : ' SQLCODE    13710000
                    PERFORM 9000-SQL-ERROR  THRU  9000-EXIT             13720000
           END-EVALUATE.                                                13730000
                                                                        13740000
       9200-EXIT.                                                       13750000
            EXIT.                                                       13760000
                                                                        13770000
      *---------------------*                                           13780000
       9900-DISPLAY-CDB-ERROR.                                          13790000
      *---------------------*                                           13800000
                                                                        13810000
            IF BE01W808-OUT-RTN-ACTION = 'S'                            13820000
               DISPLAY WS-ERROR-PGM                                     13830000
               DISPLAY 'PROGRAM ID       : ' BE01W808-OUT-RTN-PGMID     13840000
               DISPLAY 'ERROR MESSAGE NO : ' BE01W808-OUT-RTN-MSGNO     13850000
               DISPLAY 'ERROR STATUS CODE: ' BE01W808-OUT-RTN-STATCDE   13860000
               MOVE  12                    TO   RETURN-CODE             13870000
            END-IF.                                                     13880000
                                                                        13890000
            IF BE01W809-OUT-RTN-ACTION = 'S'                            13900000
               DISPLAY WS-ERROR-PGM                                     13910000
               DISPLAY 'PROGRAM ID       : ' BE01W809-OUT-RTN-PGMID     13920000
               DISPLAY 'ERROR MESSAGE NO : ' BE01W809-OUT-RTN-MSGNO     13930000
               DISPLAY 'ERROR STATUS CODE: ' BE01W809-OUT-RTN-STATCDE   13940000
               MOVE  12                    TO   RETURN-CODE             13950000
            END-IF.                                                     13960000
                                                                        13970000
       9900-EXIT.                                                       13980000
            EXIT.                                                       13990000
                                                                        14000000
      *---------------------*                                           14010000
       9990-CLOSE-CDB-ROUTINE.                                          14020000
      *---------------------*                                           14030000
                                                                        14040000
           MOVE 'CLOSE'     TO   BE01W808-IN-RTN-FXN.                   14050000
           CALL 'BE01C808' USING BE01W808-COMMAREA.                     14060000
                                                                        14070000
           IF  BE01W808-OUT-RTN-ACTION = 'S'                            14080000
               MOVE 'BE01C808 - FILE CLOSE ERROR' TO WS-ERROR-PGM       14090000
               PERFORM 9900-DISPLAY-CDB-ERROR THRU 9900-EXIT            14100000
           END-IF.                                                      14110000
                                                                        14120000
           MOVE 'CLOSE'     TO   BE01W809-IN-RTN-FXN.                   14130000
           CALL 'BE01C809' USING BE01W809-COMMAREA.                     14140000
                                                                        14150000
           IF  BE01W809-OUT-RTN-ACTION = 'S'                            14160000
               MOVE 'BE01C809 - FILE CLOSE ERROR' TO WS-ERROR-PGM       14170000
               PERFORM 9900-DISPLAY-CDB-ERROR THRU 9900-EXIT            14180000
           END-IF.                                                      14190000
                                                                        14200000
       9990-EXIT.                                                       14210000
            EXIT.                                                       14220000
                                                                        14230000
      *------------------*                                              14240000
       9999-CLOSE-ROUTINE.                                              14250000
      *------------------*                                              14260000
                                                                        14270000
           CLOSE BP13F915                                               14280000
                 BP13K060                                               14290000
                 BP13F820                                               14300000
                 BE01KMSG                                               14310000
                 BP13L970                                               14320000
                 P13F915A                                               14330000
                 P13F915B                                               14340000
                 P13L970A.                                              14350000
                                                                        14360000
           IF WS-K060-STATUS NOT = 00 AND 97                            14370000
              DISPLAY ' ERROR CLOSING BP13K060  FILE, STATUS '          14380000
              WS-K060-STATUS.                                           14390000
                                                                        14400000
           IF WS-KMSG-STATUS NOT = 00 AND 97                            14410000
              DISPLAY ' ERROR CLOSING BE01KMSG  FILE, STATUS '          14420000
              WS-KMSG-STATUS.                                           14430000
                                                                        14440000
           PERFORM 9990-CLOSE-CDB-ROUTINE    THRU   9990-EXIT.          14450000
                                                                        14460000
           STOP RUN.                                                    14470000
                                                                        14480000
       9999-EXIT.                                                       14490000
           EXIT.                                                        14500000
