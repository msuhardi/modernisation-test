       IDENTIFICATION DIVISION.                                         00010002
       PROGRAM-ID.    BP13C0FK.                                         00020002
       AUTHOR.        JOHN.                                             00030002
       DATE-WRITTEN.  06 FEB 2013.                                      00040002
      ************************************************************      00050002
      *   SYSTEM NAME : SOC - GENERATE SOC EMAIL ALERT           *      00060002
      *                                                          *      00070002
      *   OBJECTIVE:                                             *      00080002
      *      GENERATE AN EMAIL ALERT FOR CSM TAGGED CASES        *      00090002
      *      FOR SYSTEM MONITORING.  READ B13F462 FILE AND       *      00100002
      *      GENERATE AN EMAIL ALERT FOR CASES WHICH COMPLETION  *      00110002
      *      DATE HAVE PASSED AND DOESN'T HAVE AN APPOINTMENT    *      00120002
      *      FIXED.  DO THE SAME THING FOR CASES WITH RESL       *      00130002
      *      ABORTIVE DATE.                                      *      00140002
      *                                                          *      00150002
      * CHG-NO  BY   ON       DESCRIPTION                        *      00160002
      *-------  ---  ------   ----------                         *      00170002
      *BP134763 JGO1 06/02/13 INITIAL CODING                     *      00180002
      *BP134974 RJE1 09/07/13 REMOVED LJL1 AND NST1              *      00190002
      *BP135537 RJB1 03/03/15 CHANGE THE EMAIL RECIPIENT FROM    *      00200002
      *                       NICKNAME INTO COMPLETE NAME        *      00210002
      *BP136026 KVL1 11/11/15 REPLACED KOK CHUN LIM(HDB) AND     *      00220002
      *                       YOKE PHENG(HDB) AS EMAIL RECIPIENTS*      00230002
      *                       AND CHANGED OIC EMAIL FR NICKNAME  *      00240002
      *                       TO COMPLETE NAME                   *      00250002
      *BP136082 PCL4 13/01/16 TO UPDATE EMAIL RECIPIENTS         *      00260002
      *BP136477 RJB1 18/10/16 TO REPLACE KIM HUAT TO YEE MIEN    *      00270002
      *BP136851 PCL4 20/06/17 TO UPDATE EMAIL RECIPIENTS         *      00280002
      *BP138757 KV8  21/06/15 TO REMOVE LEE & LAU ADDED BERNICE  *      00290002
      *BP139030 ZAR7 07/01/22  REPLACE CHUA YEE MIEN TO LIM KOK CHUN    00291002
      *BP139564 KAC1 03/06/23  REPLACE LIM KOK CHUN TO ZANY *           00292003
      *                       REPLACE BERNICE GAN   TO HEE_WAN_MENG     00293002
      *BP139175 KAC1 23/04/24 REPLACE ZANY TO SOFFIA_RAPHAY@HDB.GOV.SG  00294003
      ************************************************************      00300002
                                                                        00310002
       ENVIRONMENT DIVISION.                                            00320002
       CONFIGURATION SECTION.                                           00330002
                                                                        00340002
       SOURCE-COMPUTER. IBM-3090.                                       00350002
       OBJECT-COMPUTER. IBM-3090.                                       00360002
                                                                        00370002
       INPUT-OUTPUT SECTION.                                            00380002
       FILE-CONTROL.                                                    00390002
                                                                        00400002
           SELECT BP13F462  ASSIGN       TO BP13F462.                   00410002
                                                                        00420002
           SELECT BP13K462  ASSIGN       TO BP13K462                    00430002
                            ACCESS MODE  IS DYNAMIC                     00440002
                            ORGANIZATION IS INDEXED                     00450002
                            RECORD KEY   IS K462-KEY-FLD                00460002
                            FILE STATUS  IS BP13K462-STATUS.            00470002
                                                                        00480002
           SELECT BP13K450  ASSIGN       TO BP13K450                    00490002
                            ACCESS MODE  IS DYNAMIC                     00500002
                            ORGANIZATION IS INDEXED                     00510002
                            RECORD KEY   IS K454-KEY-FLD                00520002
                            ALTERNATE KEY IS K454-ALT1-KEY              00530002
                            FILE STATUS  IS BP13K454-STATUS.            00540002
                                                                        00550002
           SELECT BB24K130  ASSIGN       TO BB24K130                    00560002
                            ACCESS MODE  IS RANDOM                      00570002
                            ORGANIZATION IS INDEXED                     00580002
                            RECORD KEY   IS K130-KEY-FLD                00590002
                            FILE STATUS  IS BB24K130-STATUS.            00600002
                                                                        00610002
           SELECT BB24K010  ASSIGN       TO BB24K010                    00620002
                            ACCESS MODE  IS DYNAMIC                     00630002
                            ORGANIZATION IS INDEXED                     00640002
                            RECORD KEY   IS K010-KEY-FLD                00650002
                            ALTERNATE KEY IS K010-ALT-KEY1              00660002
                            FILE STATUS  IS BB24K010-STATUS.            00670002
                                                                        00680002
           SELECT BP13K022  ASSIGN       TO BP13K022                    00690002
                            ACCESS MODE  IS RANDOM                      00700002
                            ORGANIZATION IS INDEXED                     00710002
                            RECORD KEY   IS K022-KEY-FLD                00720002
                            ALTERNATE RECORD KEY IS K022-NUM-REGN       00730002
                            WITH DUPLICATES                             00740002
                            FILE STATUS  IS BP13K022-STATUS.            00750002
                                                                        00760002
           SELECT BP13F0FK  ASSIGN       TO BP13F0FK.                   00770002
                                                                        00780002
       DATA DIVISION.                                                   00790002
       FILE SECTION.                                                    00800002
      *-------------------------------------------------------------    00810002
       FD   BP13F0FK                                                    00820002
            RECORDING MODE  F                                           00830002
            RECORD CONTAINS 100 CHARACTERS.                             00840002
       01   MAIL-PRTREC              PIC X(100).                        00850002
                                                                        00860002
       FD   BP13F462                                                    00870002
                                      RECORD CONTAINS 1000 CHARACTERS   00880002
                                      LABEL RECORD IS STANDARD          00890002
                                      RECORDING MODE IS F.              00900002
       COPY BP13F462.                                                   00910002
                                                                        00920002
       FD   BP13K462                                                    00930002
            RECORD CONTAINS 1000 CHARACTERS.                            00940002
       COPY BP13K462.                                                   00950002
                                                                        00960002
       FD   BP13K450                                                    00970002
            RECORD CONTAINS 100 CHARACTERS.                             00980002
       COPY BP13K454.                                                   00990002
                                                                        01000002
       FD   BB24K130                                                    01010002
            RECORD CONTAINS 5000 CHARACTERS.                            01020002
       COPY BB24K130.                                                   01030002
                                                                        01040002
       FD   BB24K010                                                    01050002
            RECORD CONTAINS 5000 CHARACTERS.                            01060002
       COPY BB24K010.                                                   01070002
                                                                        01080002
       FD   BP13K022                                                    01090002
            RECORD CONTAINS 100 CHARACTERS.                             01100002
       COPY BP13K022.                                                   01110002
                                                                        01120002
      *-------------------------                                        01130002
       WORKING-STORAGE SECTION.                                         01140002
      *-------------------------                                        01150002
       01  BP13F462-STATUS              PIC 99     VALUE 00.            01160002
       01  BP13K462-STATUS              PIC 99     VALUE 00.            01170002
       01  BP13K454-STATUS              PIC 99     VALUE 00.            01180002
       01  BB24K010-STATUS              PIC 99     VALUE 00.            01190002
       01  BB24K130-STATUS              PIC 99     VALUE 00.            01200002
       01  BP13K022-STATUS              PIC 99     VALUE 00.            01210002
       01  WS-F462-EOF                  PIC X      VALUE 'N'.           01220002
       01  WS-K010-EOF                  PIC X      VALUE 'N'.           01230002
       01  WS-K454-EOF                  PIC X      VALUE 'N'.           01240002
       01  WS-K010-FOUND                PIC X      VALUE 'N'.           01250002
       01  WS-K454-FOUND                PIC X      VALUE 'N'.           01260002
       01  WS-K010-CASE                 PIC X(8)   VALUE SPACES.        01270002
       01  WS-CURRENT-DATE.                                             01280002
           05 WS-CURR-CCYY.                                             01290002
              10 WS-CURR-CC            PIC X(2).                        01300002
              10 WS-CURR-YY            PIC X(2).                        01310002
           05 WS-CURR-MM               PIC X(2).                        01320002
           05 WS-CURR-DD               PIC X(2).                        01330002
       01  WS-COUNTER.                                                  01340002
           05 WS-K0FK-WRITE             PIC 9(8)   VALUE ZEROES.        01350002
           05 WS-F462-READ              PIC 9(8)   VALUE ZEROES.        01360002
           05 WS-K462-UPDATE            PIC 9(8)   VALUE ZEROES.        01370002
           05 WS-TESTCOUNT              PIC 9(8)   VALUE ZEROES.        01380002
       01  WS-FLAGS.                                                    01390002
           05 WS-WRITE-OUT              PIC X.                          01400002
       01  WS-HDR-LINES.                                                01410002
           05 WS-SUBJ                   PIC X(9)                        01420002
              VALUE 'SUBJECT:'.                                         01430002
           05 WS-SUBJ2                  PIC X(18)                       01440002
              VALUE 'RESALE COMPLETED. '.                               01450002
           05 WS-SUBJ3                  PIC X(45)                       01460002
              VALUE 'PLEASE SCHEDULE TP APPT FOR YOUR CASES BELOW:'.    01470002
           05 WS-HDR2-1                 PIC X(12)                       01480002
              VALUE                  'REG NUMBER'.                      01490002
           05 WS-HDR2-2                 PIC X(13)                       01500002
              VALUE                  'NRIC'.                            01510002
           05 WS-HDR2-3                 PIC X(15)                       01520002
              VALUE                  'RESL COMP DATE'.                  01530002
           05 WS-HDR2-4                 PIC X(20)                       01540002
              VALUE                  'RESL ABORTIVE DATE'.              01550002
       01  MAIL-HDR1.                                                   01560002
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.         01570002
           05  FILLER          PIC X(88)  VALUE SPACES.                 01580002
                                                                        01590002
       01  MAIL-HDR2.                                                   01600002
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.          01610002
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                 01620002
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.            01630002
           05  FILLER          PIC X(76)  VALUE SPACES.                 01640002
       01  MAIL-DTL1A.                                                  01650002
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01660002
      *    05  RCPT-ID         PIC X(12)  VALUE 'LIM_KOK_CHUN'.         01670002
           05  RCPT-ID         PIC X(12)  VALUE 'HEE_WAN_MENG'.         01680002
      *    05  RCPT-ID         PIC X(11)  VALUE 'LEE_LI_PENG'.          01690002
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01700002
                                                                        01710002
       01  MAIL-DTL1B.                                                  01720002
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01730002
      *    05  RCPT-ID         PIC X(15)  VALUE 'KONG_YOKE_PHENG'.      01740002
           05  RCPT-ID         PIC X(13)  VALUE 'SOFFIA_RAPHAY'.        01750003
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01760002
                                                                        01770002
      *01  MAIL-DTL1B1.                                                 01780002
      *    05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01790002
      *    05  RCPT-ID   PIC X(13) VALUE 'LAU_HONG_HUAT'.               01800002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01810002
                                                                        01820002
       01  MAIL-DTL1B2.                                                 01830002
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01840002
           05  RCPT-ID         PIC X(14)  VALUE 'TENG_SIEW_HONG'.       01850002
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01860002
                                                                        01870002
      *01  MAIL-DTL1C.                                                  01880002
      *    05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01890002
      *    05  RCPT-ID         PIC X(04)  VALUE 'NST1'.                 01900002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01910002
                                                                        01920002
      *01  MAIL-DTL1D.                                                  01930002
      *    05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            01940002
      *    05  RCPT-ID         PIC X(04)  VALUE 'LJL1'.                 01950002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         01960002
                                                                        01970002
       01  MAIL-DTL1E.                                                  01980002
           05  FILLER          PIC X(60)  VALUE SPACES.                 01990002
                                                                        02000002
       01  MAIL-DTL2.                                                   02010002
           05  FILLER          PIC X(04)  VALUE 'DATA'.                 02020002
           05  FILLER          PIC X(96)  VALUE SPACES.                 02030002
                                                                        02040002
                                                                        02050002
       01  MAIL-DTL3.                                                   02060002
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                02070002
           05  MAIL-SENDMAILID PIC X(26)  VALUE                         02080002
               'SOC - EMAIL ALERT'.                                     02090002
           05  FILLER          PIC X(69)  VALUE SPACES.                 02100002
                                                                        02110002
       01  MAIL-DTL4A.                                                  02120002
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                 02130002
      *    05  RCPT-ID         PIC X(12)  VALUE 'LIM_KOK_CHUN'.         02140002
      *    05  RCPT-ID         PIC X(14)  VALUE 'BERNICE_JH_GAN'.       02150002
           05  RCPT-ID         PIC X(12)  VALUE 'HEE_WAN_MENG'.         02151002
      *    05  RCPT-ID         PIC X(11)  VALUE 'LEE_LI_PENG'.          02160002
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02170002
                                                                        02180002
       01  MAIL-DTL4B.                                                  02190002
           05  FILLER          PIC X(04)  VALUE 'CC:<'.                 02200002
      *    05  RCPT-ID         PIC X(15)  VALUE 'KONG_YOKE_PHENG'.      02210002
           05  RCPT-ID         PIC X(13)  VALUE 'SOFFIA_RAPHAY'.        02220003
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02230002
                                                                        02240002
      *01  MAIL-DTL4B1.                                                 02250002
      *    05  FILLER          PIC X(04)  VALUE 'CC:<'.                 02260002
      *    05  RCPT-ID   PIC X(13) VALUE 'LAU_HONG_HUAT'.               02270002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02280002
                                                                        02290002
       01  MAIL-DTL4B2.                                                 02300002
           05  FILLER          PIC X(04)  VALUE 'CC:<'.                 02310002
           05  RCPT-ID         PIC X(14)  VALUE 'TENG_SIEW_HONG'.       02320002
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02330002
                                                                        02340002
      *01  MAIL-DTL4C.                                                  02350002
      *    05  FILLER          PIC X(04)  VALUE 'TO:<'.                 02360002
      *    05  RCPT-ID         PIC X(04)  VALUE 'NST1'.                 02370002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02380002
                                                                        02390002
      *01  MAIL-DTL4D.                                                  02400002
      *    05  FILLER          PIC X(04)  VALUE 'TO:<'.                 02410002
      *    05  RCPT-ID         PIC X(04)  VALUE 'LJL1'.                 02420002
      *    05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.         02430002
                                                                        02440002
       01  MAIL-DTL4E.                                                  02450002
           05  FILLER          PIC X(60)  VALUE SPACES.                 02460002
                                                                        02470002
       01  MAIL-TRAILER.                                                02480002
           05  FILLER          PIC X(01)  VALUE '.'.                    02490002
                                                                        02500002
       01  WS-RECPT-STORAGE.                                            02510002
           05  WS-TOONLY       PIC X(04)  VALUE 'TO:<'.                 02520002
           05  WS-RCPTTO       PIC X(09)  VALUE 'RCPT TO:<'.            02530002
           05  WS-OIC-REC      PIC X(05).                               02540002
           05  WS-ATHDB        PIC X(12)  VALUE '@HDB.GOV.SG>'.         02550002
                                                                        02560002
       01 K0FK-HDR1.                                                    02570002
           05 K0FK-HDR1-SUB            PIC X(9).                        02580002
           05 K0FK-HDR1-SUB2           PIC X(91).                       02590002
       01 K0FK-HDR2.                                                    02600002
           05 K0FK-HDR2-REG            PIC X(12).                       02610002
           05 FILLER                   PIC X(05).                       02620002
           05 K0FK-HDR2-NRIC           PIC X(13).                       02630002
           05 FILLER                   PIC X(10).                       02640002
           05 K0FK-HDR2-COMP           PIC X(20).                       02650002
           05 FILLER                   PIC X(05).                       02660002
           05 K0FK-HDR2-ABORT          PIC X(20).                       02670002
           05 FILLER                   PIC X(15).                       02680002
       01 K0FK-DTL.                                                     02690002
           05 K0FK-DTL-REG             PIC X(08).                       02700002
           05 FILLER                   PIC X(09).                       02710002
           05 K0FK-DTL-NRIC            PIC X(09).                       02720002
           05 FILLER                   PIC X(14).                       02730002
           05 K0FK-DTL-DTE-COMP        PIC X(10).                       02740002
           05 FILLER                   PIC X(15).                       02750002
           05 K0FK-DTL-DTE-ABRT        PIC X(10).                       02760002
           05 FILLER                   PIC X(25).                       02770002
                                                                        02780002
      *-------------------------                                        02790002
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                         02800002
      *-------------------------                                        02810002
       01  WS-BP13CCNT-LINK.                                            02820002
           05  LINK-CNTCT-TYPE         PIC X(3).                        02830002
           05  LINK-STAFF-NICK         PIC X(6).                        02840002
           05  LINK-STAFF-NUM          PIC X(6).                        02850002
           05  LINK-STAFF-CNTCT        PIC X(50).                       02860002
           05  LINK-SYSERR             PIC X(4).                        02870002
                                                                        02880002
      *-------------------------                                        02890002
       PROCEDURE DIVISION.                                              02900002
      *-------------------------                                        02910002
       0000-MAIN.                                                       02920002
                                                                        02930002
            PERFORM A000-HOUSEKEEPING   THRU A000-EXIT.                 02940002
            PERFORM P100-PROCESS        THRU P100-EXIT                  02950002
                     UNTIL WS-F462-EOF = 'Y'.                           02960002
            PERFORM Z999-CLOSING        THRU Z999-EXIT.                 02970002
                                                                        02980002
       0000-EXIT.                                                       02990002
            EXIT.                                                       03000002
                                                                        03010002
       A000-HOUSEKEEPING.                                               03020002
                                                                        03030002
            OPEN I-O    BP13K462                                        03040002
                 INPUT  BB24K130                                        03050002
                        BP13F462                                        03060002
                        BP13K022                                        03070002
                 OUTPUT BP13F0FK.                                       03080002
                                                                        03090002
           IF BB24K130-STATUS NOT = 00 AND 97                           03100002
              DISPLAY 'OPENING ERROR, BB24K130-STATUS ' BB24K130-STATUS 03110002
              MOVE     BB24K130-STATUS TO RETURN-CODE                   03120002
              PERFORM  Z999-CLOSING THRU Z999-EXIT                      03130002
           END-IF.                                                      03140002
                                                                        03150002
           IF BP13K022-STATUS NOT = 00 AND 97                           03160002
              DISPLAY 'OPENING ERROR, BP13K022-STATUS ' BP13K022-STATUS 03170002
              MOVE     BP13K022-STATUS TO RETURN-CODE                   03180002
              PERFORM  Z999-CLOSING THRU Z999-EXIT                      03190002
           END-IF.                                                      03200002
                                                                        03210002
           IF BP13K462-STATUS NOT = 00 AND 97                           03220002
              DISPLAY 'OPENING ERROR, BP13K462-STATUS ' BP13K462-STATUS 03230002
              MOVE     BP13K462-STATUS TO RETURN-CODE                   03240002
              PERFORM  Z999-CLOSING THRU Z999-EXIT                      03250002
           END-IF.                                                      03260002
                                                                        03270002
           MOVE FUNCTION CURRENT-DATE(1:8)  TO WS-CURRENT-DATE.         03280002
           DISPLAY 'CURRENT-DATE : ' WS-CURRENT-DATE.                   03290002
                                                                        03300002
       A000-EXIT.                                                       03310002
            EXIT.                                                       03320002
                                                                        03330002
       P000-READ-F462.                                                  03340002
                                                                        03350002
           MOVE 'N' TO WS-WRITE-OUT.                                    03360002
           READ BP13F462 AT END                                         03370002
                MOVE 'Y'         TO WS-F462-EOF                         03380002
                GO TO P100-EXIT.                                        03390002
           ADD 1 TO WS-F462-READ.                                       03400002
                                                                        03410002
       P000-EXIT.                                                       03420002
            EXIT.                                                       03430002
                                                                        03440002
       P100-PROCESS.                                                    03450002
                                                                        03460002
            PERFORM P000-READ-F462      THRU P000-EXIT.                 03470002
            IF F462-EMAIL-FLAG = 'Y'                                    03480002
                 GO TO P100-EXIT                                        03490002
            ELSE                                                        03500002
                 CONTINUE                                               03510002
            END-IF.                                                     03520002
            MOVE SPACE TO MAIL-PRTREC.                                  03530002
            MOVE SPACES TO K130-DTE-ABORT.                              03540002
            MOVE 'N' TO WS-K010-EOF.                                    03550002
            MOVE 'N' TO WS-K454-EOF.                                    03560002
            MOVE 'N' TO WS-K010-FOUND.                                  03570002
            MOVE 'N' TO WS-K454-FOUND.                                  03580002
            PERFORM P200-START-K010 THRU P200-EXIT.                     03590002
            PERFORM P300-READ-K010  THRU P300-EXIT                      03600002
               UNTIL WS-K010-EOF = 'Y' OR                               03610002
                     WS-K010-FOUND = 'Y'.                               03620002
                                                                        03630002
            CLOSE BB24K010.                                             03640002
            IF BB24K010-STATUS  NOT = 00 AND 97                         03650002
               DISPLAY 'CLOSING ERROR BP24K010, STAT ' BB24K010-STATUS  03660002
               MOVE     BB24K010-STATUS TO RETURN-CODE                  03670002
               PERFORM  Z999-CLOSING THRU Z999-EXIT                     03680002
            END-IF.                                                     03690002
                                                                        03700002
            MOVE WS-K010-CASE    TO K130-NUM-CASE.                      03710002
            READ BB24K130.                                              03720002
            IF BB24K130-STATUS = '00'                                   03730002
               IF K130-DTE-ABORT NOT = SPACES OR LOW-VALUES             03740002
                  MOVE 'Y' TO WS-WRITE-OUT                              03750002
               ELSE                                                     03760002
                  MOVE SPACES TO K130-DTE-ABORT                         03770002
               END-IF                                                   03780002
            END-IF.                                                     03790002
                                                                        03800002
            IF WS-WRITE-OUT = 'Y'                                       03810002
               PERFORM W100-GEN-EMAIL THRU W100-EXIT                    03820002
               PERFORM W200-READ-K462 THRU W200-EXIT                    03830002
            END-IF.                                                     03840002
                                                                        03850002
       P100-EXIT.                                                       03860002
            EXIT.                                                       03870002
                                                                        03880002
                                                                        03890002
       P200-START-K010.                                                 03900002
                                                                        03910002
           OPEN INPUT   BB24K010.                                       03920002
                                                                        03930002
           IF BB24K010-STATUS NOT = 00 AND 97                           03940002
              DISPLAY 'OPENING ERROR, BB24K010-STATUS ' BB24K010-STATUS 03950002
              MOVE     BB24K010-STATUS TO RETURN-CODE                   03960002
              PERFORM  Z999-CLOSING THRU Z999-EXIT                      03970002
           END-IF.                                                      03980002
                                                                        03990002
           MOVE F462-NUM-HDBREF-DISPOSAL TO K010-ALT-KEY1.              04000002
           START BB24K010 KEY NOT LESS THAN K010-ALT-KEY1               04010002
           IF BB24K010-STATUS = ZEROES                                  04020002
              CONTINUE                                                  04030002
           ELSE                                                         04040002
            DISPLAY 'START READ ERROR BB24K010,STATUS' BB24K010-STATUS  04050002
              MOVE     BB24K010-STATUS TO RETURN-CODE                   04060002
              PERFORM Z999-CLOSING THRU Z999-EXIT                       04070002
           END-IF.                                                      04080002
                                                                        04090002
       P200-EXIT.                                                       04100002
           EXIT.                                                        04110002
                                                                        04120002
                                                                        04130002
       P300-READ-K010.                                                  04140002
                                                                        04150002
           READ BB24K010 NEXT RECORD AT END                             04160002
                MOVE 'Y'   TO  WS-K010-EOF                              04170002
                GO TO P300-EXIT.                                        04180002
                                                                        04190002
           ADD 1 TO WS-TESTCOUNT.                                       04200002
           IF BB24K010-STATUS = 00 OR 02                                04210002
              IF K010-ALT-KEY1 = F462-NUM-HDBREF-DISPOSAL               04220002
                 MOVE K010-NUM-CASE TO WS-K010-CASE                     04230002
                 MOVE 'Y'           TO WS-K010-FOUND                    04240002
                 IF K010-DTE-STATUS-UPDATE(17) <= WS-CURRENT-DATE       04250002
                    AND K010-DTE-STATUS-UPDATE(17) NOT = SPACES         04260002
                    AND K010-DTE-STATUS-UPDATE(17) NOT = LOW-VALUES     04270002
                     PERFORM P400-CHECK-K454 THRU P400-EXIT             04280002
                 END-IF                                                 04290002
              END-IF                                                    04300002
           ELSE                                                         04310002
              DISPLAY 'READ ERROR BB24K010,STATUS ' BB24K010-STATUS     04320002
              MOVE     BB24K010-STATUS TO RETURN-CODE                   04330002
              PERFORM Z999-CLOSING THRU Z999-EXIT                       04340002
           END-IF.                                                      04350002
                                                                        04360002
       P300-EXIT.                                                       04370002
           EXIT.                                                        04380002
                                                                        04390002
       P400-CHECK-K454.                                                 04400002
                                                                        04410002
           OPEN INPUT   BP13K450.                                       04420002
                                                                        04430002
           IF BP13K454-STATUS NOT = 00 AND 97                           04440002
              DISPLAY 'OPENING ERROR, BP13K454-STATUS ' BP13K454-STATUS 04450002
              MOVE     BP13K454-STATUS TO RETURN-CODE                   04460002
              PERFORM  Z999-CLOSING THRU Z999-EXIT                      04470002
           END-IF.                                                      04480002
                                                                        04490002
           MOVE LOW-VALUES      TO K454-CDE-APPT-TYPE.                  04500002
           MOVE F462-NUM-REGN   TO K454-NUM-REGN.                       04510002
           PERFORM P500-READ-K454  THRU P500-EXIT                       04520002
               UNTIL WS-K454-EOF = 'Y' OR                               04530002
                     WS-K454-FOUND = 'Y'.                               04540002
                                                                        04550002
           CLOSE BP13K450.                                              04560002
           IF BP13K454-STATUS  NOT = 00 AND 97                          04570002
               DISPLAY 'CLOSING ERROR BP13K454, STAT ' BP13K454-STATUS  04580002
               MOVE     BP13K454-STATUS TO RETURN-CODE                  04590002
               PERFORM  Z999-CLOSING THRU Z999-EXIT                     04600002
           END-IF.                                                      04610002
                                                                        04620002
                                                                        04630002
       P400-EXIT.                                                       04640002
            EXIT.                                                       04650002
                                                                        04660002
       P500-READ-K454.                                                  04670002
                                                                        04680002
           READ BP13K450 NEXT RECORD AT END                             04690002
                MOVE 'Y'   TO WS-WRITE-OUT                              04700002
                MOVE 'Y'   TO  WS-K454-EOF                              04710002
                GO TO P500-EXIT.                                        04720002
                                                                        04730002
           IF BP13K454-STATUS = 00 OR 02                                04740002
              IF F462-NUM-REGN = K454-NUM-REGN                          04750002
                 MOVE 'Y'  TO WS-K454-FOUND                             04760002
                 MOVE 'N' TO WS-WRITE-OUT                               04770002
              END-IF                                                    04780002
           ELSE                                                         04790002
              DISPLAY 'READ ERROR BP13K454,STATUS ' BP13K454-STATUS     04800002
              MOVE     BP13K454-STATUS TO RETURN-CODE                   04810002
              PERFORM Z999-CLOSING THRU Z999-EXIT                       04820002
           END-IF.                                                      04830002
                                                                        04840002
       P500-EXIT.                                                       04850002
           EXIT.                                                        04860002
                                                                        04870002
       W100-GEN-EMAIL.                                                  04880002
                                                                        04890002
            MOVE F462-NUM-REGN           TO K022-NUM-REGN.              04900002
            MOVE SPACES TO MAIL-DTL1E.                                  04910002
            MOVE SPACES TO MAIL-DTL4E.                                  04920002
            READ BP13K022 KEY IS K022-NUM-REGN.                         04930002
            IF BP13K022-STATUS = '00'                                   04940002
               PERFORM W350-CALL-BP13CCNT THRU W350-EXIT                04950002
            ELSE                                                        04960002
               MOVE SPACES TO MAIL-DTL1E                                04970002
                              MAIL-DTL4E                                04980002
                                                                        04990002
      *        IF K022-NUM-OIC(5:1) NOT = SPACES AND LOW-VALUES         05000002
      *            STRING WS-RCPTTO  K022-NUM-OIC  WS-ATHDB             05010002
      *               DELIMITED BY SIZE INTO   MAIL-DTL1E               05020002
      *            STRING WS-TOONLY K022-NUM-OIC WS-ATHDB               05030002
      *               DELIMITED BY SIZE INTO   MAIL-DTL4E               05040002
      *        ELSE                                                     05050002
      *          IF K022-NUM-OIC(4:1) NOT = SPACES AND LOW-VALUES       05060002
      *            STRING WS-RCPTTO K022-NUM-OIC(1:4) WS-ATHDB          05070002
      *               DELIMITED BY SIZE INTO   MAIL-DTL1E               05080002
      *            STRING WS-TOONLY K022-NUM-OIC(1:4) WS-ATHDB          05090002
      *               DELIMITED BY SIZE INTO   MAIL-DTL4E               05100002
      *          ELSE                                                   05110002
      *          IF K022-NUM-OIC(3:1) NOT = SPACES AND LOW-VALUES       05120002
      *            STRING WS-RCPTTO K022-NUM-OIC(1:3) WS-ATHDB          05130002
      *               DELIMITED BY SIZE INTO   MAIL-DTL1E               05140002
      *            STRING WS-TOONLY K022-NUM-OIC(1:3) WS-ATHDB          05150002
      *               DELIMITED BY SIZE INTO   MAIL-DTL4E               05160002
            END-IF.                                                     05170002
                                                                        05180002
            PERFORM W300-WRITE-HEADER THRU W300-EXIT                    05190002
            MOVE SPACES TO K0FK-DTL.                                    05200002
            ADD 1 TO WS-K0FK-WRITE                                      05210002
            MOVE F462-NUM-REGN           TO K0FK-DTL-REG.               05220002
            MOVE F462-NUM-NRIC1-NEW      TO K0FK-DTL-NRIC.              05230002
            IF K010-DTE-STATUS-UPDATE(17) = SPACES OR LOW-VALUES        05240002
              MOVE SPACES                     TO  K0FK-DTL-DTE-COMP     05250002
            ELSE                                                        05260002
              MOVE K010-DTE-STATUS-UPDATE(17) TO  K0FK-DTL-DTE-COMP     05270002
            END-IF.                                                     05280002
            MOVE K130-DTE-ABORT          TO K0FK-DTL-DTE-ABRT           05290002
            WRITE MAIL-PRTREC FROM K0FK-DTL.                            05300002
                                                                        05310002
            MOVE SPACES TO K0FK-DTL.                                    05320002
            IF F462-NUM-NRIC2-NEW        NOT = SPACES                   05330002
               MOVE F462-NUM-NRIC2-NEW      TO K0FK-DTL-NRIC            05340002
               WRITE MAIL-PRTREC FROM K0FK-DTL                          05350002
            END-IF.                                                     05360002
                                                                        05370002
            MOVE SPACES TO K0FK-DTL.                                    05380002
            IF F462-NUM-NRIC3-NEW NOT = SPACES                          05390002
               MOVE F462-NUM-NRIC3-NEW      TO K0FK-DTL-NRIC            05400002
               WRITE MAIL-PRTREC FROM K0FK-DTL                          05410002
            END-IF.                                                     05420002
                                                                        05430002
            MOVE SPACES TO K0FK-DTL.                                    05440002
            IF F462-NUM-NRIC4-NEW NOT = SPACES                          05450002
               MOVE F462-NUM-NRIC4-NEW      TO K0FK-DTL-NRIC            05460002
               WRITE MAIL-PRTREC FROM K0FK-DTL                          05470002
            END-IF.                                                     05480002
                                                                        05490002
            WRITE MAIL-PRTREC FROM MAIL-TRAILER.                        05500002
                                                                        05510002
       W100-EXIT.                                                       05520002
            EXIT.                                                       05530002
                                                                        05540002
       W200-READ-K462.                                                  05550002
                                                                        05560002
            MOVE F462-KEY-FLD TO K462-KEY-FLD.                          05570002
            READ BP13K462.                                              05580002
                                                                        05590002
            IF BP13K462-STATUS = 00 OR 02                               05600002
              PERFORM W250-UPDATE-K462 THRU W250-EXIT                   05610002
            ELSE                                                        05620002
              DISPLAY 'READ ERROR BP13K462,STATUS ' BP13K462-STATUS     05630002
              MOVE     BP13K462-STATUS TO RETURN-CODE                   05640002
              PERFORM Z999-CLOSING THRU Z999-EXIT                       05650002
            END-IF.                                                     05660002
                                                                        05670002
       W200-EXIT.                                                       05680002
            EXIT.                                                       05690002
                                                                        05700002
       W250-UPDATE-K462.                                                05710002
                                                                        05720002
            MOVE 'Y' TO K462-EMAIL-FLAG.                                05730002
            REWRITE BP13K462-REC.                                       05740002
            IF BP13K462-STATUS = 00 OR 02                               05750002
              ADD 1 TO WS-K462-UPDATE                                   05760002
            ELSE                                                        05770002
              DISPLAY 'READ ERROR BP13K462,STATUS ' BP13K462-STATUS     05780002
              MOVE     BP13K462-STATUS TO RETURN-CODE                   05790002
              PERFORM Z999-CLOSING THRU Z999-EXIT                       05800002
            END-IF.                                                     05810002
                                                                        05820002
       W250-EXIT.                                                       05830002
            EXIT.                                                       05840002
                                                                        05850002
       W300-WRITE-HEADER.                                               05860002
                                                                        05870002
            WRITE MAIL-PRTREC FROM MAIL-HDR1.                           05880002
            WRITE MAIL-PRTREC FROM MAIL-HDR2.                           05890002
            WRITE MAIL-PRTREC FROM MAIL-DTL1A.                          05900002
            WRITE MAIL-PRTREC FROM MAIL-DTL1B.                          05910002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL1B1.                         05920002
            WRITE MAIL-PRTREC FROM MAIL-DTL1B2.                         05930002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL1C.                          05940002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL1D.                          05950002
            IF BP13K022-STATUS = '00'                                   05960002
              WRITE MAIL-PRTREC FROM MAIL-DTL1E.                        05970002
            WRITE MAIL-PRTREC FROM MAIL-DTL2.                           05980002
            WRITE MAIL-PRTREC FROM MAIL-DTL3.                           05990002
            WRITE MAIL-PRTREC FROM MAIL-DTL4A.                          06000002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL4C.                          06010002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL4D.                          06020002
            IF BP13K022-STATUS = '00'                                   06030002
               WRITE MAIL-PRTREC FROM MAIL-DTL4E.                       06040002
            WRITE MAIL-PRTREC FROM MAIL-DTL4B.                          06050002
      *     WRITE MAIL-PRTREC FROM MAIL-DTL4B1.                         06060002
            WRITE MAIL-PRTREC FROM MAIL-DTL4B2.                         06070002
            MOVE SPACES TO K0FK-HDR1.                                   06080002
            MOVE   WS-SUBJ         TO K0FK-HDR1-SUB.                    06090002
            STRING WS-SUBJ2 WS-SUBJ3 DELIMITED BY SIZE                  06100002
                      INTO  K0FK-HDR1-SUB2.                             06110002
            WRITE MAIL-PRTREC FROM K0FK-HDR1.                           06120002
            MOVE SPACES TO K0FK-HDR1.                                   06130002
            WRITE MAIL-PRTREC FROM K0FK-HDR1.                           06140002
                                                                        06150002
            MOVE SPACES TO K0FK-HDR2.                                   06160002
            MOVE WS-HDR2-1         TO   K0FK-HDR2-REG.                  06170002
            MOVE WS-HDR2-2         TO   K0FK-HDR2-NRIC.                 06180002
            MOVE WS-HDR2-3         TO   K0FK-HDR2-COMP.                 06190002
            MOVE WS-HDR2-4         TO   K0FK-HDR2-ABORT.                06200002
            WRITE MAIL-PRTREC FROM K0FK-HDR2.                           06210002
            MOVE SPACES TO K0FK-HDR2.                                   06220002
            WRITE MAIL-PRTREC FROM K0FK-HDR2.                           06230002
                                                                        06240002
       W300-EXIT.                                                       06250002
            EXIT.                                                       06260002
                                                                        06270002
       W350-CALL-BP13CCNT.                                              06280002
                                                                        06290002
           MOVE SPACES                     TO WS-BP13CCNT-LINK.         06300002
           MOVE 'EML'                      TO LINK-CNTCT-TYPE.          06310002
           MOVE K022-NUM-OIC               TO LINK-STAFF-NICK.          06320002
           MOVE SPACES                     TO LINK-STAFF-NUM.           06330002
                                                                        06340002
           CALL 'BP13CCNT' USING WS-BP13CCNT-LINK.                      06350002
                                                                        06360002
           EVALUATE LINK-SYSERR                                         06370002
           WHEN ZEROS                                                   06380002
              STRING WS-RCPTTO DELIMITED BY SIZE                        06390002
                     LINK-STAFF-CNTCT '>'                               06400002
                 DELIMITED BY SPACE INTO  MAIL-DTL1E                    06410002
              STRING WS-TOONLY LINK-STAFF-CNTCT '>'                     06420002
                 DELIMITED BY SPACE INTO  MAIL-DTL4E                    06430002
           WHEN 100                                                     06440002
              DISPLAY 'OIC NOT FOUND IN OFFICE_CNTCT TABLE - '          06450002
                  K022-NUM-OIC  ', REGN : ' F462-NUM-REGN               06460002
              MOVE  SPACES                 TO MAIL-DTL1E                06470002
                                              MAIL-DTL4E                06480002
           WHEN OTHER                                                   06490002
              DISPLAY 'ERROR READING OFFICE_CNTCT TABLE = '             06500002
                       LINK-SYSERR                                      06510002
              MOVE  SPACES                 TO MAIL-DTL1E                06520002
                                              MAIL-DTL4E                06530002
           END-EVALUATE.                                                06540002
                                                                        06550002
       W350-EXIT.                                                       06560002
           EXIT.                                                        06570002
                                                                        06580002
       Z100-SUMMARY.                                                    06590002
                                                                        06600002
            DISPLAY '*********************'.                            06610002
            DISPLAY '*  BP13C0FK TOTALS  *'.                            06620002
            DISPLAY '*********************'.                            06630002
            DISPLAY 'ALERT WRITE: ' WS-K0FK-WRITE.                      06640002
            DISPLAY 'F462  READ:  ' WS-F462-READ.                       06650002
            DISPLAY 'K462  UPD :  ' WS-K462-UPDATE.                     06660002
                                                                        06670002
       Z100-EXIT.                                                       06680002
            EXIT.                                                       06690002
                                                                        06700002
       Z999-CLOSING.                                                    06710002
                                                                        06720002
            PERFORM Z100-SUMMARY THRU Z100-EXIT.                        06730002
            CLOSE BP13F462                                              06740002
                  BP13K462                                              06750002
                  BB24K130                                              06760002
                  BP13K022                                              06770002
                  BP13F0FK.                                             06780002
                                                                        06790002
            IF BB24K130-STATUS  NOT = 00 AND 97                         06800002
               DISPLAY 'CLOSING ERROR BB24K130, STAT ' BB24K130-STATUS. 06810002
                                                                        06820002
            IF BP13K462-STATUS  NOT = 00 AND 97                         06830002
               DISPLAY 'CLOSING ERROR BP13K462, STAT ' BP13K462-STATUS. 06840002
                                                                        06850002
            IF BP13K022-STATUS  NOT = 00 AND 97                         06860002
               DISPLAY 'CLOSING ERROR BP13K022, STAT ' BP13K022-STATUS. 06870002
                                                                        06880002
            STOP RUN.                                                   06890002
                                                                        06900002
       Z999-EXIT.                                                       06910002
            EXIT.                                                       06920002
