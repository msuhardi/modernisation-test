       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C49Q.                                         00020000
       AUTHOR.        KAVYA VAKA.                                       00030000
      *DATE-WRITTEN.  17/09/2020.                                       00040000
      *************************************************************     00050000
      *      SYSTEM OF COMMITMENT (BP13)                          *     00060000
      *===========================================================*     00070000
      *                                                           *     00080000
      *  OBJECTIVES: 1. TO SEND OUT EMAIL FOR NOTIFICATION (D4)   *     00090000
      *              2. PUT MQ MESSAGE INTO QUEUE WHICH CONTAINS  *     00100000
      *                 CUSTOMER'S DETAILS TO BE SENT BY JAVA     *     00110000
      *                 INTERFACE.                                *     00120000
      *                                                           *     00130000
      *     THIS PROGRAM WILL ALSO WRITE TO K491 FOR FORM-TAG = 1 *     00140000
      *                                                           *     00150000
      *  PROGRAM LOGIC:                                           *     00160000
      *          PROCESS INPUT FILES                              *     00170000
      *          MQCONNECT TO QUEUE MANAGER                       *     00180000
      *          MQOPEN QUEUE                                     *     00190000
      *          MQPUT                                            *     00200000
      *          MQCLOSE QUEUE                                    *     00210000
      *          MQDISCONNECT FROM QUEUE MANAGER                  *     00220000
      *                                                           *     00230000
      *                                                           *     00240000
      *                                                           *     00250000
      *===========================================================*     00260000
      * MODIFICATIONS :                                           *     00270000
      *                                                           *     00280000
      * CHG REQ#    DATE    AUTHOR REMARKS                        *     00290000
      * -------- ---------- ------ ------------------------------ *     00300000
      * BP138451 17/09/2020 KV5    NEW PROGRAM                    *     00310000
      * BP138634 22/02/2021 ZAR7   CATER FOR D5                   *     00320000
      * BP138714 03/05/2021 ZAR7   CATER FOR D7                   *     00330000
      * BP138761 04/06/2021 KV8    CATER FOR D6,D7,D8 & D9        *     00340000
      * BP138762 08/06/2021 KV8    CATER FOR E5,E6,E7 & E8        *     00350000
      * BP138763 10/06/2021 KV8    CATER FOR 1D,2D,3D,4D,5D,6D &7D*     00360000
      * BP138764 11/06/2021 KV8    CATER FOR 1E,2E,3E,4E,5E & 6E  *     00370000
      * BP138810 08/07/2021 KV8    CATER FOR D5                   *     00380000
      * BP138874 25/08/2021 KV8    CATER FOR 1E,2E,3E,4E,5E & 6E  *     00390000
      * BP138893 09/09/2021 KV8    CATER FOR 1E,2E,3E,4E,5E,6E,7E *     00400000
      *                            AND 8E                         *     00410000
      * BP138896 14/09/2021 KV8    CATER FOR 1E,2E,3E,4E,5E,6E&7E *     00420000
      * BP138909 27/09/2021 KV8    CATER FOR 1E,2E,3E,4E & 5E     *     00430000
      * BP138913 05/10/2021 KV8    CATER FOR 1E & 2E              *     00440000
      * BP138986 02/12/2021 KV8    CATER FOR 1F                   *     00450000
      * BP138998 09/12/2021 KV8    CATER FOR 1G,2G AND 3G         *     00460000
      * BP138998 13/12/2021 KV8    CATER FOR WOODLANDS N7 C27 USING 4G  00470000
      * BP139005 17/12/2021 KV8    CATER FOR 1G,2G AND 3G         *     00480000
      * BP139030 07/01/2022 ZAR7  REPLACE CHUA YEE MIEN TO LIM KOK CHUN 00490000
      * BP139047 24/01/2022 KV8    CATER FOR 1G                   *     00500000
      * BP139068 03/02/2022 KV8    CATER FOR 1G AND 2G            *     00510000
      * BP139107 23/03/2022 KV8    CATER FOR 1G, 2G, 3G & 4G      *     00520000
      * BP139119 28/03/2022 KV8    CATER FOR 1H, 2H, 3H, 4H, 5H,  *     00530000
      *                            6H, 7H, 8H & 9H                *     00540000
      * BP139147 16/04/2022 KV8    CATER FOR 1H, 2H, 3H, 4H, 1G,  *     00550000
      *                            2G,3G,4G, 5G,6G,7G,& 8G        *     00560000
      * BP139147 20/04/2022 KV8    COMMENTED NO DELAY BLOCKS      *     00570000
      * BP139233 23/06/2022 KV8    CATER FOR 1F                   *     00580000
      * BP139355 23/06/2022 KV8    FLAT ELIGIBLE FOR COTMA(1E)& FL*     00590000
      *                            AT NOT ELIGIBLE FOR COTMA(2E)  *     00600000
      * BP139395 27/10/2022 KV8    FLAT ELIGIBLE FOR COTMA(1E)& FL*     00610000
      *                            AT NOT ELIGIBLE FOR COTMA(2E)  *     00620000
      *                            FOR JAN 2023                   *     00630000
      * BP139395 02/11/2022 KV8    CHANGED NAME FROM 1E TO 1J & 2E*     00640000
      *                            TO 2J                          *     00650000
      * BP139422 16/11/2022 KV8    FLAT ELIGIBLE FOR COTMA(1E)    *     00660000
      *                            AND ALLOCAT NOT EQUAL NPL & FLAT     00670000
      *                            NOT ELIGIBLE FOR COTMA(2E)     *     00680000
      *                            OR ALLOCAT EQUAL NPL           *     00690000
      * BP139395 09/01/2023 KAC1   MATERIALS ON TERMINATION OF JSM*     00700000
      *                            FOR BTO PROJECT HARMONY VILLAGE*     00710000
      * BP139577 15/05/2023 KV8    FOR BLK 446A & 446B PUNGGOL    *     00720000
      *                            POINT COVE AND REPLACE         *     00730000
      *                            LIM KOK CHUN TO TAN PIAK HONG  *     00740000
      * BP139660 17/07/2023 KV8    FOR BLK 443A, 442A, 442B, 443B,*     00750000
      *                            445A & 445B                    *     00760000
      * BP139660 17/08/2023 KV8    FOR BLK 443A, 442A, 442B, 443B,*     00770000
      *                            445A & 445B                    *     00780000
      * BP139702 28/08/2023 KV8    FOR BLK 289A, 289B AND 289C    *     00790000
      * BP139760 16/10/2023 KV8    FOR BLK 289A, 289B AND 289C    *     00800000
      * BP139760 19/10/2023 KV8    FOR BLK 432A & 432B            *     00810000
      * BP139797 06/11/2023 KV8    FOR BLK 469A                   *     00820000
      * BP139844 26/12/2023 KV8    FOR BLK 448B                   *     00821000
      *************************************************************     00830000
                                                                        00840000
       ENVIRONMENT DIVISION.                                            00850000
                                                                        00860000
       CONFIGURATION SECTION.                                           00870000
       SOURCE-COMPUTER. IBM-3090.                                       00880000
       OBJECT-COMPUTER. IBM-3090.                                       00890000
                                                                        00900000
       SPECIAL-NAMES.                                                   00910000
           SYSIN IS PARM-INPUT.                                         00920000
                                                                        00930000
       INPUT-OUTPUT SECTION.                                            00940000
       FILE-CONTROL.                                                    00950000
                                                                        00960000
           SELECT BP13F491 ASSIGN       TO BP13F491.                    00970000
                                                                        00980000
           SELECT BP13K491 ASSIGN        TO BP13K491                    00990000
                           ACCESS MODE   IS RANDOM                      01000000
                           ORGANIZATION  IS INDEXED                     01010000
                           RECORD KEY    IS K491-NUM-REGN               01020000
                           FILE STATUS   IS WS-K491-STATUS.             01030000
                                                                        01040000
           SELECT BM06K110 ASSIGN        TO BM06K110                    01050000
                           ACCESS MODE   IS DYNAMIC                     01060000
                           ORGANIZATION  IS INDEXED                     01070000
                           RECORD KEY    IS K110-KEY-FLD                01080000
                           ALTERNATE KEY IS K110-REGN-NO                01090000
                           FILE STATUS   IS WS-K110-STATUS.             01100000
                                                                        01110000
           SELECT BP13K800 ASSIGN        TO BP13K800                    01120000
                           ACCESS MODE   IS RANDOM                      01130000
                           ORGANIZATION  IS INDEXED                     01140000
                           RECORD KEY    IS K800-NUM-REGN               01150000
                           FILE STATUS   IS WS-K800-STATUS.             01160000
                                                                        01170000
       DATA DIVISION.                                                   01180000
       FILE SECTION.                                                    01190000
                                                                        01200000
       FD   BP13K491                                                    01210000
            RECORD CONTAINS 200 CHARACTERS.                             01220000
       COPY BP13K491.                                                   01230000
                                                                        01240000
       FD  BP13F491                                                     01250000
           RECORDING MODE IS F                                          01260000
           RECORD CONTAINS 200 CHARACTERS.                              01270000
       COPY BP13F491.                                                   01280000
                                                                        01290000
       FD  BM06K110                                                     01300000
           RECORD CONTAINS 500 CHARACTERS.                              01310000
       COPY BM06K110.                                                   01320000
                                                                        01330000
       FD   BP13K800                                                    01340000
            RECORD CONTAINS 2000 CHARACTERS.                            01350000
       COPY BP13K800.                                                   01360000
                                                                        01370000
                                                                        01380000
       WORKING-STORAGE SECTION.                                         01390000
      *-------------------------------------------------------------    01400000
      *    QUEUE MANAGER                                                01410000
      *    FOR PRODUCTION, QUEUE MANAGER IS 'MQP1'                      01420000
      *    FOR TESTING,    QUEUE MANAGER IS 'MQT1'                      01430000
      *-------------------------------------------------------------    01440000
      *PROD QUEUE MANAGER                                               01450000
       01  WS-QM-NAME                    PIC X(48) VALUE 'MQP1'.        01460000
      *TEST QUEUE MANAGER                                               01470000
      *01  WS-QM-NAME                    PIC X(48) VALUE 'MQT1'.        01480000
                                                                        01490000
       01  WS-BP13Q-NAME                 PIC X(48) VALUE SPACES.        01500000
                                                                        01510000
      *-------------------------------------------------------------    01520000
      *    OUTPUT QUEUE NAME TO CRIMSONLOGIC                            01530000
      *    FOR PROD, QUEUE NAME IS BP13.WIS.MDB.REQUESTQ                01540000
      *    FOR TESTING, QUEUE NAME IS BP13S.WIS.MDB.REQUESTQ            01550000
      *-------------------------------------------------------------    01560000
      **PROD QUEUE                                                      01570000
       01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13.WIS.MDB.REQUESTQ'.     01580000
      **TEST QUEUE                                                      01590000
      *01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13S.WIS.MDB.REQUESTQ'.    01600000
                                                                        01610000
      *-------------------------------------------------------------    01620000
      *    MESSAGE LENGTH                                               01630000
      *-------------------------------------------------------------    01640000
      *01  WS-MESSAGE-LENGTH             PIC 9(06) VALUE  51612.        01650000
       01  WS-MESSAGE-LENGTH             PIC 9(06) VALUE  66011.        01660000
                                                                        01670000
      *-------------------------------------------------------------    01680000
      *    MESSAGE QUEUE                                                01690000
      *-------------------------------------------------------------    01700000
       01  WS-SEND-MESSAGE.                                             01710000
           05  WS-MSG-CDE                PIC X(03).                     01720000
           05  WS-FILLER-01              PIC X(01).                     01730000
           05  WS-MSG-APPT-TYP           PIC X(02).                     01740000
           05  WS-FILLER-02              PIC X(01).                     01750000
           05  WS-MSG-CTR                PIC 9(04).                     01760000
           05  WS-MSG OCCURS 400 TIMES.                                 01770000
               10  WS-FILLER-03          PIC X(01).                     01780000
               10  WS-MSG-NUM-REGN       PIC X(08).                     01790000
               10  WS-FILLER-04          PIC X(01).                     01800000
               10  WS-MSG-EMAIL-TYP      PIC X(02).                     01810000
               10  WS-FILLER-05          PIC X(01).                     01820000
               10  WS-MSG-NUM-EMAIL      PIC X(50).                     01830000
               10  WS-FILLER-06          PIC X(01).                     01840000
               10  WS-MSG-NUM-OIC        PIC X(30).                     01850000
               10  WS-FILLER-07          PIC X(01).                     01860000
               10  WS-MSG-DTE-PCD        PIC X(18).                     01870000
               10  WS-FILLER-08          PIC X(01).                     01880000
               10  WS-MSG-ADDR.                                         01890000
                   15 WS-MSG-BLK         PIC X(05).                     01900000
                   15 WS-FILLER-09       PIC X(01).                     01910000
                   15 WS-MSG-LEVEL       PIC X(02).                     01920000
                   15 WS-FILLER-10       PIC X(01).                     01930000
                   15 WS-MSG-MAIN-UNIT   PIC X(04).                     01940000
                   15 WS-FILLER-11       PIC X(01).                     01950000
                   15 WS-MSG-STREET      PIC X(30).                     01960000
                   15 WS-FILLER-12       PIC X(01).                     01970000
                   15 WS-MSG-POSTAL      PIC X(06).                     01980000
                                                                        01990000
      *-------------------------------------------------------------    02000000
      *    MQI - TEMPORARY VARIABLES FOR ERROR CODES                    02010000
      *-------------------------------------------------------------    02020000
       01  BP13C49Q-REC.                                                02030000
           05  C49Q-REASON               PIC 9(4).                      02040000
           05  C49Q-COMPLETION-CODE      PIC 9(4).                      02050000
           05  C49Q-ERR-MSG              PIC X(66).                     02060000
           05  FILLER                    PIC X(27).                     02070000
                                                                        02080000
      *-------------------------------------------------------------    02090000
      *    MQI STRUCTURE DECLARATION                                    02100000
      *-------------------------------------------------------------    02110000
       01  MY-MQ-CONSTANTS.                                             02120000
           COPY CMQV.                                                   02130000
                                                                        02140000
       01  OBJECT-DESCRIPTOR.                                           02150000
           COPY CMQODV.                                                 02160000
                                                                        02170000
       01  MESSAGE-DESCRIPTOR.                                          02180000
           COPY CMQMDV.                                                 02190000
                                                                        02200000
      *-------------------------------------------------------------    02210000
      *    PUT MESSAGE OPTIONS                                          02220000
      *-------------------------------------------------------------    02230000
       01  PMOPTIONS.                                                   02240000
           COPY CMQPMOV.                                                02250000
                                                                        02260000
      *-------------------------------------------------------------    02270000
      *    VARIABLE DESCRIPTION:                                        02280000
      *    (1) HCONN                                                    02290000
      *        - CONNECTION HANDLE - REPRESENTS THE CONNECTION TO       02300000
      *          THE QUEUE MANAGER. VALUE IS RETURNED BY MQCONN         02310000
      *          AND SUBSEQUENTLY REFERENCED IN MQOPEN, MQPUT,          02320000
      *          MQCLOSE AND MQDISC                                     02330000
      *                                                                 02340000
      *    (2) Q-HANDLE                                                 02350000
      *        - ACCESS THAT HAS BEEN ESTABLISHED  TO THE OBJECT        02360000
      *          CONNECTION HANDLE - VALUE IS RETURNED BY MQOPEN        02370000
      *          AND SUBSEQUENTLY REFERENCED IN MQPUT AND MQCLOSE       02380000
      *                                                                 02390000
      *    (3) OBJECT-DESCRIPTOR                                        02400000
      *        - THIS IDENTIFIES THE OBJECT TO BE OPENED                02410000
      *                                                                 02420000
      *    (4) OPTIONS                                                  02430000
      *        WHEN USED IN MQOPEN                                      02440000
      *        - OPTIONS THAT CONTROL THE ACTION OF MQOPEN              02450000
      *        - OPTIONS USED IN THIS PROGRAM:                          02460000
      *          (A) MQOO-OUTPUT - THE QUEUE IS OPENED FOR USE WITH     02470000
      *                            SUBSEQUENT MQPUT CALL                02480000
      *          (B) MQOO-FAIL-IF-QUIESCING - FORCES MQCALL TO FAIL     02490000
      *                            IF QUEUE MANAGER IS IN QUIESCING     02500000
      *                            STATE (I.E. PREPARING TO SHUTDOWN)   02510000
      *                                                                 02520000
      *        WHEN USED IN MQCLOSE                                     02530000
      *        - OPTIONS THAT CONTROL THE ACTION OF MQCLOSE             02540000
      *        - OPTIONS USED IN THIS PROGRAM:                          02550000
      *          (A) MQCO-NONE   - NO OPTIONAL CLOSE PROCESSING         02560000
      *                            REQUIRED                             02570000
      *                                                                 02580000
      *    (5) MESSAGE-DESCRIPTOR                                       02590000
      *        - THIS DESCRIBES THE ATTRIBUTES OF THE MESSAGE           02600000
      *          BEING SENT, AND RECEIVES INFO ABOUT THE MESSAGE        02610000
      *          AFTER THE PUT REQUEST IS COMPLETE                      02620000
      *                                                                 02630000
      *    (6) PMOPTIONS (PUT MESSAGE OPTIONS)                          02640000
      *        - OPTIONS THAT CONTROL THE ACTION OF MQPUT               02650000
      *        - OPTION USED IN THIS PROGRAM:                           02660000
      *          (A) MQMD-EXPIRY - MESSAGE LIFETIME. THE MESSAGE        02670000
      *                            BECOMES ELIGIBLE TO BE DISCARDED     02680000
      *                            IF IT HAS NOT BEEN REMOVED FROM      02690000
      *                            FROM THE QUEUE BEFORE THIS PERIOD    02700000
      *                            OF TIME ELAPSED                      02710000
      *                          - MUST BE SET TO MQEI_UNLIMITED        02720000
      *          (B) MQMD-PERSISTENCE = MQPER-PERSISTENT                02730000
      *                                                                 02740000
      *    (7) BUFFER-LENGTH                                            02750000
      *        - LENGTH OF THE MESSAGE IN BUFFER                        02760000
      *                                                                 02770000
      *    (8) BUFFER                                                   02780000
      *        - MESSAGE DATA                                           02790000
      *-------------------------------------------------------------    02800000
       01  HCONN                         PIC S9(9) BINARY.              02810000
       01  Q-HANDLE                      PIC S9(9) BINARY.              02820000
       01  OPTIONS                       PIC S9(9) BINARY.              02830000
       01  COMPLETION-CODE               PIC S9(9) BINARY.              02840000
       01  OPEN-CODE                     PIC S9(9) BINARY.              02850000
       01  CON-REASON                    PIC S9(9) BINARY.              02860000
       01  REASON                        PIC S9(9) BINARY.              02870000
       01  MQMSGD                        PIC S9(9) BINARY.              02880000
       01  BUFFER-LENGTH                 PIC S9(9) BINARY.              02890000
       01  BUFFER                        PIC X(368012).                 02900000
       01  QM-NAME                       PIC X(48) VALUE SPACES.        02910000
       01  TARGET-QUEUE                  PIC X(48) VALUE SPACES.        02920000
                                                                        02930000
      *-------------------------------------------------------------    02940000
      *  FLAGS / SWITCHES                                               02950000
      *-------------------------------------------------------------    02960000
       01  WS-OTHER-VARIABLES.                                          02970000
           05  WS-IDX                    PIC 9(03) VALUE ZEROES.        02980000
           05  WS-CURR-DATE              PIC X(08) VALUE SPACES.        02990000
           05  WS-CURR-TIME              PIC X(08) VALUE SPACES.        03000000
           05  WS-K491-STATUS            PIC 9(02) VALUE ZEROES.        03010000
           05  WS-K110-STATUS            PIC 9(02) VALUE ZEROES.        03020000
           05  WS-K800-STATUS            PIC 9(02) VALUE ZEROES.        03030000
           05  WS-F491-EOF               PIC X(01) VALUE SPACES.        03040000
           05  WS-REWRITE-CTR            PIC 9(06) VALUE ZEROES.        03050000
           05  WS-NOTFND-CTR             PIC 9(06) VALUE ZEROES.        03060000
           05  WS-F491-CTR               PIC 9(06) VALUE ZEROES.        03070000
           05  WS-CTR                    PIC 9(06) VALUE ZEROES.        03080000
                                                                        03090000
       PROCEDURE DIVISION.                                              03100000
      *=============================================================    03110000
       0000-MAIN-PROCESS.                                               03120000
      *=============================================================    03130000
                                                                        03140000
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.              03150000
           PERFORM 1100-INITIALIZATION     THRU 1100-EXIT.              03160000
           PERFORM 2000-BP13F491-READ      THRU 2000-EXIT.              03170000
                                                                        03180000
           IF WS-F491-EOF = 'Y'                                         03190000
              DISPLAY ' *** '                                           03200000
              DISPLAY ' *** NO RECORDS FOUND IN PRELIM FILE'            03210000
              DISPLAY ' *** '                                           03220000
                                                                        03230000
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT               03240000
           END-IF.                                                      03250000
                                                                        03260000
           PERFORM 2100-INIT-CONNECTION    THRU 2100-EXIT.              03270000
                                                                        03280000
           PERFORM 3000-MAIN-ROUTINE       THRU 3000-EXIT               03290000
                   UNTIL WS-F491-EOF = 'Y'                              03300000
                      OR WS-MSG-CTR = 400.                              03310000
                                                                        03320000
           DISPLAY 'WS-SEND-MESSAGE : ' WS-SEND-MESSAGE.                03330000
                                                                        03340000
                                                                        03350000
           PERFORM 4000-MQ-PUT-MESSAGE     THRU 4000-EXIT.              03360000
           DISPLAY ' *** APPOINTMENT NOTIFICATION SENT!'                03370000
           PERFORM 5000-MQ-CLOSE           THRU 5000-EXIT.              03380000
           PERFORM 5100-MQ-DISCONNECT      THRU 5100-EXIT.              03390000
           PERFORM 6000-UPDATE-BP13K491    THRU 6000-EXIT.              03400000
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.              03410000
                                                                        03420000
           STOP RUN.                                                    03430000
                                                                        03440000
       0000-EXIT.                                                       03450000
           EXIT.                                                        03460000
                                                                        03470000
      *=============================================================    03480000
       1000-OPEN-ROUTINE.                                               03490000
      *=============================================================    03500000
           DISPLAY ' ***** STARTING PROGRAM BP13C49Q *****'.            03510000
           DISPLAY ' '.                                                 03520000
                                                                        03530000
           OPEN INPUT BP13F491                                          03540000
                      BM06K110                                          03550000
                      BP13K800                                          03560000
                I-O   BP13K491.                                         03570000
                                                                        03580000
           IF WS-K491-STATUS NOT = 00 AND 97                            03590000
              DISPLAY 'BP13K491 - ERROR OPENING : ' WS-K491-STATUS      03600000
              MOVE WS-K491-STATUS                   TO RETURN-CODE      03610000
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03620000
           END-IF.                                                      03630000
           IF WS-K110-STATUS NOT = 00 AND 97                            03640000
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K110-STATUS      03650000
              MOVE WS-K110-STATUS                   TO RETURN-CODE      03660000
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03670000
           END-IF.                                                      03680000
           IF WS-K800-STATUS NOT = 00  AND  97                          03690000
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K800-STATUS      03700000
              MOVE WS-K800-STATUS                   TO RETURN-CODE      03710000
              PERFORM 9000-CLOSE-ROUTINE   THRU  9000-EXIT              03720000
           END-IF.                                                      03730000
                                                                        03740000
       1000-EXIT.                                                       03750000
           EXIT.                                                        03760000
                                                                        03770000
      *=============================================================    03780000
       1100-INITIALIZATION.                                             03790000
      *=============================================================    03800000
           MOVE SPACES                    TO WS-SEND-MESSAGE.           03810000
                                                                        03820000
           MOVE ';'                       TO WS-FILLER-01               03830000
                                             WS-FILLER-02.              03840000
                                                                        03850000
           PERFORM VARYING WS-MSG-CTR FROM 1 BY 1                       03860000
             UNTIL WS-MSG-CTR > 400                                     03870000
                   MOVE ';'               TO WS-FILLER-03(WS-MSG-CTR)   03880000
                                             WS-FILLER-04(WS-MSG-CTR)   03890000
                                             WS-FILLER-05(WS-MSG-CTR)   03900000
                                             WS-FILLER-06(WS-MSG-CTR)   03910000
                                             WS-FILLER-07(WS-MSG-CTR)   03920000
                                             WS-FILLER-08(WS-MSG-CTR)   03930000
                                             WS-FILLER-09(WS-MSG-CTR)   03940000
                                             WS-FILLER-10(WS-MSG-CTR)   03950000
                                             WS-FILLER-11(WS-MSG-CTR)   03960000
                                             WS-FILLER-12(WS-MSG-CTR)   03970000
           END-PERFORM.                                                 03980000
                                                                        03990000
           MOVE 'EML'                     TO WS-MSG-CDE.                04000000
           MOVE ZEROES                    TO WS-MSG-CTR.                04010000
                                                                        04020000
           ACCEPT WS-BP13Q-NAME         FROM PARM-INPUT.                04030000
                                                                        04040000
       1100-EXIT.                                                       04050000
           EXIT.                                                        04060000
                                                                        04070000
      *=============================================================    04080000
       2000-BP13F491-READ.                                              04090000
      *=============================================================    04100000
           READ BP13F491                                                04110000
              AT END MOVE 'Y'              TO   WS-F491-EOF             04120000
              GO TO 2000-EXIT.                                          04130000
                                                                        04140000
           ADD 1  TO WS-F491-CTR.                                       04150000
       2000-EXIT.                                                       04160000
           EXIT.                                                        04170000
                                                                        04180000
      *=============================================================    04190000
       2100-INIT-CONNECTION.                                            04200000
      *=============================================================    04210000
           PERFORM 2200-MQ-CONNECT         THRU 2200-EXIT               04220000
           PERFORM 2300-MQ-OPEN            THRU 2300-EXIT               04230000
                                                                        04240000
           MOVE SPACES                     TO   BUFFER.                 04250000
      *    MOVE 'K1'                       TO   WS-MSG-APPT-TYP.        04260000
                                                                        04270000
       2100-EXIT.                                                       04280000
           EXIT.                                                        04290000
                                                                        04300000
      *=============================================================    04310000
       2200-MQ-CONNECT.                                                 04320000
      *=============================================================    04330000
      *-------------------------------------------------------------    04340000
      *    SET THE QUEUE MANAGER NAME                                   04350000
      *-------------------------------------------------------------    04360000
           IF WS-BP13Q-NAME NOT = SPACES AND LOW-VALUES                 04370000
              MOVE WS-BP13Q-NAME           TO   QM-NAME                 04380000
           ELSE                                                         04390000
              MOVE WS-QM-NAME              TO   QM-NAME                 04400000
           END-IF.                                                      04410000
                                                                        04420000
      *-------------------------------------------------------------    04430000
      *    CALL MQCONN TO CONNECT TO QUEUE MANAGER                      04440000
      *-------------------------------------------------------------    04450000
           CALL 'MQCONN' USING QM-NAME, HCONN,                          04460000
                               COMPLETION-CODE, CON-REASON.             04470000
                                                                        04480000
           IF COMPLETION-CODE = MQCC-FAILED                             04490000
              MOVE CON-REASON              TO   C49Q-REASON             04500000
              MOVE COMPLETION-CODE         TO   C49Q-COMPLETION-CODE    04510000
              MOVE 'BP13CS49 MQCONN ERROR' TO   C49Q-ERR-MSG            04520000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               04530000
           END-IF.                                                      04540000
                                                                        04550000
       2200-EXIT.                                                       04560000
           EXIT.                                                        04570000
                                                                        04580000
      *=============================================================    04590000
       2300-MQ-OPEN.                                                    04600000
      *=============================================================    04610000
      *-------------------------------------------------------------    04620000
      *    USE DEFAULT WS-QUEUE-NAME                                    04630000
      *-------------------------------------------------------------    04640000
           MOVE WS-QUEUE-NAME              TO   MQOD-OBJECTNAME.        04650000
           ADD  MQOO-OUTPUT MQOO-FAIL-IF-QUIESCING GIVING OPTIONS.      04660000
                                                                        04670000
      *-------------------------------------------------------------    04680000
      *    CALL MQOPEN TO OPEN CONNECTION                               04690000
      *-------------------------------------------------------------    04700000
           CALL 'MQOPEN' USING HCONN, OBJECT-DESCRIPTOR,                04710000
                               OPTIONS, Q-HANDLE,                       04720000
                               OPEN-CODE, REASON.                       04730000
                                                                        04740000
           IF REASON NOT = MQRC-NONE                                    04750000
              MOVE REASON                  TO   C49Q-REASON             04760000
              MOVE OPEN-CODE               TO   C49Q-COMPLETION-CODE    04770000
              MOVE 'MQOPEN ENDED WITH REASON CODE'                      04780000
                                           TO   C49Q-ERR-MSG            04790000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               04800000
           END-IF.                                                      04810000
                                                                        04820000
       2300-EXIT.                                                       04830000
           EXIT.                                                        04840000
                                                                        04850000
      *=============================================================    04860000
       3000-MAIN-ROUTINE.                                               04870000
      *=============================================================    04880000
                                                                        04890000
           IF F491-NUM-REGN NOT = SPACES AND LOW-VALUES                 04900000
                                                                        04910000
              MOVE SPACES              TO K110-REC BP13K800-MASTER      04920000
              MOVE F491-NUM-REGN       TO K110-REGN-NO K800-NUM-REGN    04930000
              PERFORM 5900-READ-BP13K800  THRU 5900-EXIT                04940000
              PERFORM 6300-READ-BM06K110  THRU 6300-EXIT                04950000
                                                                        04960000
              ADD 1                    TO WS-MSG-CTR                    04970000
              MOVE F491-NUM-REGN       TO WS-MSG-NUM-REGN (WS-MSG-CTR)  04980000
      *       IF K110-AIX1 = '206N6  C12  640A'                         04990000
      *          MOVE '1E'               TO WS-MSG-APPT-TYP             05000000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05010000
      *       ELSE                                                      05020000
      *       IF K110-AIX1 = '206N6  C12  641A'                         05030000
      *          MOVE '2E'               TO WS-MSG-APPT-TYP             05040000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05050000
      *       ELSE                                                      05060000
      *        IF K110-AIX1 = '206N6  C15  638A'                        05070000
      *           MOVE '3E'              TO WS-MSG-APPT-TYP             05080000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05090000
      *        ELSE                                                     05100000
      *         IF K110-AIX1 = '108N8  C1   801A' OR                    05110000
      *                        '108N8  C1   801B' OR                    05120000
      *                        '108N8  C1   801C'                       05130000
      *            MOVE '4E'             TO WS-MSG-APPT-TYP             05140000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05150000
      *         ELSE                                                    05160000
      *          IF K110-AIX1 = '201N1  C15  114A' OR                   05170000
      *                         '201N1  C15  114B'                      05180000
      *             MOVE '5E'            TO WS-MSG-APPT-TYP             05190000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05200000
      *          ELSE                                                   05210000
      *           IF K110-AIX1 = '301N1  C25  187A' OR                  05220000
      *                          '301N1  C25  188A' OR                  05230000
      *                          '301N1  C25  188B' OR                  05240000
      *                          '301N1  C25  189A' OR                  05250000
      *                          '301N1  C25  189B'                     05260000
      *              MOVE '6E'           TO WS-MSG-APPT-TYP             05270000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05280000
      *        END-IF                                                   05290000
      *       END-IF                                                    05300000
      *      END-IF                                                     05310000
      *     END-IF                                                      05320000
      *    END-IF                                                       05330000
      *    END-IF                                                       05340000
      *    IF K110-AIX1 = '750S4  C13  431B' OR                         05350000
      *                   '750S4  C13  431C'                            05360000
      *       MOVE '1E'                  TO WS-MSG-APPT-TYP             05370000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05380000
      *    ELSE                                                         05390000
      *    IF K110-AIX1 = '750S4  C13  432A' OR                         05400000
      *                   '750S4  C13  432B' OR                         05410000
      *                   '750S4  C13  433A' OR                         05420000
      *                   '750S4  C13  433B'                            05430000
      *       MOVE '2E'                  TO WS-MSG-APPT-TYP             05440000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05450000
      *    ELSE                                                         05460000
      *    IF K110-AIX1 = '750S4  C14  446A' OR                         05470000
      *                   '750S4  C14  446B' OR                         05480000
      *                   '750S4  C14  448B'                            05490000
      *       MOVE '3E'                  TO WS-MSG-APPT-TYP             05500000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05510000
      *    ELSE                                                         05520000
      *    IF K110-AIX1 = '750S4  C14  447A' OR                         05530000
      *                   '750S4  C14  448A'                            05540000
      *       MOVE '4E'                  TO WS-MSG-APPT-TYP             05550000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05560000
      *    ELSE                                                         05570000
      *    IF K110-AIX1 = '618N6  C4   662A' OR                         05580000
      *                   '618N6  C4   662B' OR                         05590000
      *                   '618N6  C4   662C' OR                         05600000
      *                   '618N6  C4   663C'                            05610000
      *       MOVE '5E'                  TO WS-MSG-APPT-TYP             05620000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05630000
      *    ELSE                                                         05640000
      *    IF K110-AIX1 = '618N6  C4   663A' OR                         05650000
      *                   '618N6  C4   663B'                            05660000
      *       MOVE '6E'                  TO WS-MSG-APPT-TYP             05670000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05680000
      *                                                                 05690000
      *    ELSE                                                         05700000
      *    IF K110-AIX1 = '618N9  C18  951A' OR                         05710000
      *                   '618N9  C18  951B' OR                         05720000
      *                   '618N9  C18  951C' OR                         05730000
      *                   '618N9  C18  954A'                            05740000
      *       MOVE '7E'                  TO WS-MSG-APPT-TYP             05750000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05760000
      *    ELSE                                                         05770000
      *    IF K110-AIX1 = '618N9  C18  952A' OR                         05780000
      *                   '618N9  C18  952B' OR                         05790000
      *                   '618N9  C18  952C' OR                         05800000
      *                   '618N9  C18  953A' OR                         05810000
      *                   '618N9  C18  953B' OR                         05820000
      *                   '618N9  C18  953C' OR                         05830000
      *                   '618N9  C18  954B' OR                         05840000
      *                   '618N9  C18  954C' OR                         05850000
      *                   '618N9  C18  954D'                            05860000
      *       MOVE '8E'                  TO WS-MSG-APPT-TYP             05870000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)05880000
      *                                                                 05890000
      *    END-IF                                                       05900000
      *    END-IF                                                       05910000
      *    END-IF                                                       05920000
      *    END-IF                                                       05930000
      *    END-IF                                                       05940000
      *    END-IF                                                       05950000
      *    END-IF                                                       05960000
      *    END-IF                                                       05970000
      *    IF K110-AIX1 = '749N9  C8   206A' OR                         05980000
      *                   '749N9  C8   206B' OR                         05990000
      *                   '749N9  C8   206C' OR                         06000000
      *                   '749N9  C8   206D' OR                         06010000
      *                   '749N9  C8   207A' OR                         06020000
      *                   '749N9  C8   207B' OR                         06030000
      *                   '749N9  C8   207C' OR                         06040000
      *                   '749N9  C8   207D'                            06050000
      *       MOVE '1E'                  TO WS-MSG-APPT-TYP             06060000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06070000
      *    ELSE                                                         06080000
      *    IF K110-AIX1 = '750S4  C5   401A' OR                         06090000
      *                   '750S4  C5   402A' OR                         06100000
      *                   '750S4  C5   402B'                            06110000
      *       MOVE '2E'                  TO WS-MSG-APPT-TYP             06120000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06130000
      *    ELSE                                                         06140000
      *    IF K110-AIX1 = '744N4  C31  461A' OR                         06150000
      *                   '744N4  C31  461B' OR                         06160000
      *                   '744N4  C31  461C' OR                         06170000
      *                   '744N4  C31  462A'                            06180000
      *       MOVE '3E'                  TO WS-MSG-APPT-TYP             06190000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06200000
      *    ELSE                                                         06210000
      *    IF K110-AIX1 = '401N3  C25  383A' OR                         06220000
      *                   '401N3  C25  383B' OR                         06230000
      *                   '401N3  C25  383C' OR                         06240000
      *                   '401N3  C25  384A' OR                         06250000
      *                   '401N3  C25  384B'                            06260000
      *       MOVE '4E'                  TO WS-MSG-APPT-TYP             06270000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06280000
      *    ELSE                                                         06290000
      *    IF K110-AIX1 = '401N3  C25  381A' OR                         06300000
      *                   '401N3  C25  381B' OR                         06310000
      *                   '401N3  C25  381C' OR                         06320000
      *                   '401N3  C25  381D' OR                         06330000
      *                   '401N3  C25  382C' OR                         06340000
      *                   '401N3  C25  382B' OR                         06350000
      *                   '401N3  C25  382A'                            06360000
      *       MOVE '5E'                  TO WS-MSG-APPT-TYP             06370000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06380000
      *    ELSE                                                         06390000
      *    IF K110-AIX1 = '401N4  C20  470A' OR                         06400000
      *                   '401N4  C20  472B' OR                         06410000
      *                   '401N4  C20  471B' OR                         06420000
      *                   '401N4  C20  470B' OR                         06430000
      *                   '401N4  C20  471A' OR                         06440000
      *                   '401N4  C20  472A' OR                         06450000
      *                   '401N4  C20  473A' OR                         06460000
      *                   '401N4  C20  473B'                            06470000
      *       MOVE '6E'                  TO WS-MSG-APPT-TYP             06480000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06490000
      *                                                                 06500000
      *    ELSE                                                         06510000
      *    IF K110-AIX1 = '401N4  C21B 475A' OR                         06520000
      *                   '401N4  C21B 475B' OR                         06530000
      *                   '401N4  C21B 477B' OR                         06540000
      *                   '401N4  C21B 477C'                            06550000
      *       MOVE '7E'                  TO WS-MSG-APPT-TYP             06560000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06570000
      *    END-IF                                                       06580000
      *    END-IF                                                       06590000
      *    END-IF                                                       06600000
      *    END-IF                                                       06610000
      *    END-IF                                                       06620000
      *    END-IF                                                       06630000
      *    END-IF                                                       06640000
      *    IF K110-AIX1 = '206N6  C12  640A' OR                         06650000
      *                   '206N6  C12  641A'                            06660000
      *       MOVE '1E'                  TO WS-MSG-APPT-TYP             06670000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06680000
      *    ELSE                                                         06690000
      *    IF K110-AIX1 = '206N6  C15  638A'                            06700000
      *       MOVE '2E'                  TO WS-MSG-APPT-TYP             06710000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06720000
      *    ELSE                                                         06730000
      *    IF K110-AIX1 = '108N8  C1   801A' OR                         06740000
      *                   '108N8  C1   801B' OR                         06750000
      *                   '108N8  C1   801C'                            06760000
      *       MOVE '3E'                  TO WS-MSG-APPT-TYP             06770000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06780000
      *    ELSE                                                         06790000
      *    IF K110-AIX1 = '201N1  C15  114A' OR                         06800000
      *                   '201N1  C15  114B'                            06810000
      *       MOVE '4E'                  TO WS-MSG-APPT-TYP             06820000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06830000
      *    ELSE                                                         06840000
      *    IF K110-AIX1 = '301N1  C25  187A' OR                         06850000
      *                   '301N1  C25  188A' OR                         06860000
      *                   '301N1  C25  188B' OR                         06870000
      *                   '301N1  C25  189A' OR                         06880000
      *                   '301N1  C25  189B'                            06890000
      *       MOVE '5E'                  TO WS-MSG-APPT-TYP             06900000
      *                                     WS-MSG-EMAIL-TYP(WS-MSG-CTR)06910000
      *    END-IF                                                       06920000
      *    END-IF                                                       06930000
      *    END-IF                                                       06940000
      *    END-IF                                                       06950000
      *    END-IF                                                       06960000
                                                                        06970000
           IF WS-K800-STATUS = '00'                                     06980000
      *       IF K110-AIX1 = '201N4  C26  469A'                         06990000
      *       IF K110-AIX1 = '750S4  C14  446A' OR                      07000000
      *                      '750S4  C14  446B'                         07010000
              IF (K110-AIX1 = '129N2  C26  289A' OR                     07020000
                              '129N2  C26  289B' OR                     07030000
                              '129N2  C26  289C')                       07040000
      *          MOVE '3E'             TO WS-MSG-APPT-TYP               07050000
                 MOVE '1E'             TO WS-MSG-APPT-TYP               07060000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07070000
              ELSE                                                      07080000
              IF K110-AIX1 = '201N4  C26  469A'                         07090000
                 MOVE '1F'             TO WS-MSG-APPT-TYP               07100000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07110000
              ELSE                                                      07120000
              IF (K110-AIX1 = '750S4  C13  432A' OR                     07130000
                              '750S4  C13  432B')                       07140000
                 MOVE '1F'             TO WS-MSG-APPT-TYP               07150000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07160000
              ELSE                                                      07170000
              IF (K110-AIX1 = '750S4  C15  443A')                       07180000
                 MOVE '1E'             TO WS-MSG-APPT-TYP               07190000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07200000
              ELSE                                                      07210000
              IF (K110-AIX1 = '750S4  C15  442A' OR                     07220000
                              '750S4  C15  442B')                       07230000
                 MOVE '2E'             TO WS-MSG-APPT-TYP               07240000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07250000
              ELSE                                                      07260000
              IF (K110-AIX1 = '750S4  C15  443B' OR                     07270000
                              '750S4  C15  445A' OR                     07280000
                              '750S4  C15  445B')                       07290000
                 MOVE '3E'             TO WS-MSG-APPT-TYP               07300000
                                          WS-MSG-EMAIL-TYP(WS-MSG-CTR)  07310000
              ELSE                                                      07320000
              IF ((K800-DTE-REGN >= '20210501') OR                      07330000
                  (K800-NUM-ALLO-CAT = 'NPL'))                          07340000
                   MOVE '2E'             TO WS-MSG-APPT-TYP             07350000
                                            WS-MSG-EMAIL-TYP(WS-MSG-CTR)07360000
              ELSE                                                      07370000
              IF ((K800-DTE-REGN <= '20210430') AND                     07380000
                  (K800-NUM-ALLO-CAT NOT = 'NPL'))                      07390000
                   MOVE '1E'             TO WS-MSG-APPT-TYP             07400000
                                            WS-MSG-EMAIL-TYP(WS-MSG-CTR)07410000
              ELSE                                                      07420000
              IF (K110-AIX1 = '750S4  C14  448B')                       07430000
                   MOVE '1E'             TO WS-MSG-APPT-TYP             07440000
                                            WS-MSG-EMAIL-TYP(WS-MSG-CTR)07450000
              END-IF                                                    07460000
              END-IF                                                    07470000
              END-IF                                                    07480000
              END-IF                                                    07490000
              END-IF                                                    07500000
              END-IF                                                    07510000
              END-IF                                                    07520000
              END-IF                                                    07530000
              END-IF                                                    07540000
           END-IF                                                       07550000
                                                                        07560000
              MOVE F491-NUM-EMAIL      TO WS-MSG-NUM-EMAIL(WS-MSG-CTR)  07570000
      ***     MOVE F491-NME-OIC        TO WS-MSG-NUM-OIC  (WS-MSG-CTR)  07580000
      *       MOVE 'LIM KOK CHUN      '  TO WS-MSG-NUM-OIC(WS-MSG-CTR)  07590000
              MOVE 'TAN PIAK HONG     '  TO WS-MSG-NUM-OIC(WS-MSG-CTR)  07600000
              MOVE F491-DTE-PCD        TO WS-MSG-DTE-PCD  (WS-MSG-CTR)  07610000
              MOVE F491-NUM-BLK        TO WS-MSG-BLK      (WS-MSG-CTR)  07620000
              MOVE F491-NUM-LEVEL      TO WS-MSG-LEVEL    (WS-MSG-CTR)  07630000
              MOVE F491-NUM-MAIN-UNIT  TO WS-MSG-MAIN-UNIT(WS-MSG-CTR)  07640000
              MOVE F491-NUM-STREET     TO WS-MSG-STREET   (WS-MSG-CTR)  07650000
              MOVE F491-NUM-POSTAL     TO WS-MSG-POSTAL   (WS-MSG-CTR)  07660000
           END-IF.                                                      07670000
                                                                        07680000
           PERFORM 2000-BP13F491-READ THRU 2000-EXIT.                   07690000
                                                                        07700000
       3000-EXIT.                                                       07710000
           EXIT.                                                        07720000
                                                                        07730000
      *=============================================================    07740000
       4000-MQ-PUT-MESSAGE.                                             07750000
      *=============================================================    07760000
                                                                        07770000
           MOVE WS-SEND-MESSAGE            TO   BUFFER.                 07780000
                                                                        07790000
      *-------------------------------------------------------------    07800000
      *    SET UP MESSAGE DESCRIPTOR                                    07810000
      *-------------------------------------------------------------    07820000
           MOVE MQEI-UNLIMITED             TO   MQMD-EXPIRY.            07830000
           MOVE MQPER-PERSISTENT           TO   MQMD-PERSISTENCE.       07840000
           MOVE MQFMT-STRING               TO   MQMD-FORMAT.            07850000
           MOVE WS-MESSAGE-LENGTH          TO   BUFFER-LENGTH.          07860000
                                                                        07870000
      *-------------------------------------------------------------    07880000
      *    CALL MQPUT TO PUT MESSAGE TO QUEUE                           07890000
      *-------------------------------------------------------------    07900000
           CALL 'MQPUT' USING HCONN, Q-HANDLE,                          07910000
                              MESSAGE-DESCRIPTOR, PMOPTIONS,            07920000
                              BUFFER-LENGTH, BUFFER,                    07930000
                              COMPLETION-CODE, REASON.                  07940000
                                                                        07950000
           IF REASON NOT = MQRC-NONE                                    07960000
              MOVE REASON                  TO   C49Q-REASON             07970000
              MOVE COMPLETION-CODE         TO   C49Q-COMPLETION-CODE    07980000
              MOVE 'BP13CS49 MQPUT ERROR'  TO   C49Q-ERR-MSG            07990000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               08000000
           END-IF.                                                      08010000
                                                                        08020000
       4000-EXIT.                                                       08030000
           EXIT.                                                        08040000
                                                                        08050000
      *=============================================================    08060000
       5000-MQ-CLOSE.                                                   08070000
      *=============================================================    08080000
                                                                        08090000
           MOVE MQCO-NONE                  TO   OPTIONS.                08100000
                                                                        08110000
      *-------------------------------------------------------------    08120000
      *    CALL MQCLOSE TO CLOSE CONNECTION                             08130000
      *-------------------------------------------------------------    08140000
           CALL 'MQCLOSE' USING HCONN, Q-HANDLE, OPTIONS,               08150000
                                COMPLETION-CODE, REASON.                08160000
                                                                        08170000
           IF REASON NOT =  MQRC-NONE                                   08180000
              MOVE REASON                   TO   C49Q-REASON            08190000
              MOVE COMPLETION-CODE          TO   C49Q-COMPLETION-CODE   08200000
              MOVE 'BP13CS49 MQCLOSE ERROR' TO   C49Q-ERR-MSG           08210000
              PERFORM 9100-EXIT-MQCONN      THRU 9100-EXIT              08220000
           END-IF.                                                      08230000
                                                                        08240000
       5000-EXIT.                                                       08250000
           EXIT.                                                        08260000
                                                                        08270000
      *=============================================================    08280000
       5100-MQ-DISCONNECT.                                              08290000
      *=============================================================    08300000
                                                                        08310000
      *-------------------------------------------------------------    08320000
      *    CALL MQDISC TO DISCONNECT FROM QUEUE MANAGER                 08330000
      *-------------------------------------------------------------    08340000
           CALL 'MQDISC' USING HCONN, COMPLETION-CODE, REASON.          08350000
                                                                        08360000
           IF REASON NOT = MQRC-NONE                                    08370000
              MOVE REASON                  TO   C49Q-REASON             08380000
              MOVE COMPLETION-CODE         TO   C49Q-COMPLETION-CODE    08390000
              MOVE 'BP13CS49 MQDISC ERROR' TO   C49Q-ERR-MSG            08400000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               08410000
           END-IF.                                                      08420000
                                                                        08430000
       5100-EXIT.                                                       08440000
           EXIT.                                                        08450000
                                                                        08460000
      *=============================================================    08470000
       5900-READ-BP13K800.                                              08480000
      *=============================================================    08490000
           READ BP13K800  KEY IS K800-NUM-REGN.                         08500000
                                                                        08510000
           EVALUATE WS-K800-STATUS                                      08520000
               WHEN 00                                                  08530000
               WHEN 02                                                  08540000
                    CONTINUE                                            08550000
               WHEN 23                                                  08560000
                    DISPLAY 'K800 - REC NOTFND, KEY : ' K800-NUM-REGN   08570000
                    MOVE SPACES  TO BP13K800-MASTER                     08580000
               WHEN OTHER                                               08590000
                    DISPLAY 'ERROR READING OF BP13K800 : ' K800-NUM-REGN08600000
                            'STATUS(', WS-K800-STATUS ')'               08610000
                    MOVE WS-K800-STATUS             TO RETURN-CODE      08620000
                    PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT         08630000
           END-EVALUATE.                                                08640000
       5900-EXIT.                                                       08650000
           EXIT.                                                        08660000
                                                                        08670000
      *=============================================================    08680000
       6000-UPDATE-BP13K491.                                            08690000
      *=============================================================    08700000
           PERFORM VARYING WS-CTR FROM 1 BY 1                           08710000
              UNTIL WS-CTR > 400 OR WS-MSG-NUM-REGN(WS-CTR) = SPACES    08720000
              IF WS-MSG-NUM-REGN(WS-CTR) NOT = SPACES AND LOW-VALUES    08730000
                 MOVE WS-MSG-NUM-REGN(WS-CTR)      TO K491-NUM-REGN     08740000
                 PERFORM 6100-READUDT-BP13K491   THRU 6100-EXIT         08750000
              END-IF                                                    08760000
           END-PERFORM.                                                 08770000
       6000-EXIT.                                                       08780000
           EXIT.                                                        08790000
                                                                        08800000
      *=============================================================    08810000
       6100-READUDT-BP13K491.                                           08820000
      *=============================================================    08830000
           READ BP13K491.                                               08840000
                                                                        08850000
           EVALUATE WS-K491-STATUS                                      08860000
               WHEN 00                                                  08870000
                    MOVE '2'                        TO K491-TAG-FORM    08880000
      ***           MOVE WS-CURR-DATE               TO K491-DTE-UPDATE  08890000
                    PERFORM 6200-REWRITE-BP13K491 THRU 6200-EXIT        08900000
               WHEN 23                                                  08910000
                    DISPLAY 'K491 - REC NOTFND, KEY : ' K491-NUM-REGN   08920000
                    ADD 1                           TO WS-NOTFND-CTR    08930000
               WHEN OTHER                                               08940000
                    DISPLAY 'ERROR READING OF BP13K491 : ' K491-NUM-REGN08950000
                            'STATUS(', WS-K491-STATUS ')'               08960000
                    MOVE WS-K491-STATUS             TO RETURN-CODE      08970000
                    PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT         08980000
           END-EVALUATE.                                                08990000
       6100-EXIT.                                                       09000000
           EXIT.                                                        09010000
                                                                        09020000
      *=============================================================    09030000
       6200-REWRITE-BP13K491.                                           09040000
      *=============================================================    09050000
           REWRITE BP13K491-REC.                                        09060000
                                                                        09070000
           IF WS-K491-STATUS = 00 OR 02                                 09080000
              ADD 1 TO WS-REWRITE-CTR                                   09090000
           ELSE                                                         09100000
              DISPLAY 'BP13K491 - REWRITE ERROR, KEY : ' K491-NUM-REGN  09110000
                      ' , STATUS (' WS-K491-STATUS ')'                  09120000
              MOVE WS-K491-STATUS                  TO RETURN-CODE       09130000
              PERFORM 9000-CLOSE-ROUTINE         THRU 9000-EXIT         09140000
           END-IF.                                                      09150000
       6200-EXIT.                                                       09160000
           EXIT.                                                        09170000
                                                                        09180000
      *=============================================================    09190000
       6300-READ-BM06K110.                                              09200000
      *=============================================================    09210000
           READ BM06K110  KEY IS K110-REGN-NO.                          09220000
                                                                        09230000
           EVALUATE WS-K110-STATUS                                      09240000
               WHEN 00                                                  09250000
               WHEN 02                                                  09260000
                    CONTINUE                                            09270000
               WHEN 23                                                  09280000
                    DISPLAY 'K110 - REC NOTFND, KEY : ' K110-REGN-NO    09290000
                    MOVE SPACES  TO K110-REC                            09300000
               WHEN OTHER                                               09310000
                    DISPLAY 'ERROR READING OF BM06K110 : ' K110-REGN-NO 09320000
                            'STATUS(', WS-K110-STATUS ')'               09330000
                    MOVE WS-K110-STATUS             TO RETURN-CODE      09340000
                    PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT         09350000
           END-EVALUATE.                                                09360000
       6300-EXIT.                                                       09370000
           EXIT.                                                        09380000
                                                                        09390000
      *=============================================================    09400000
       9000-CLOSE-ROUTINE.                                              09410000
      *=============================================================    09420000
                                                                        09430000
           CLOSE BP13F491                                               09440000
                 BM06K110                                               09450000
                 BP13K800                                               09460000
                 BP13K491.                                              09470000
                                                                        09480000
           IF RETURN-CODE NOT = ZERO                                    09490000
              DISPLAY ' *** RETURN-CODE = ' RETURN-CODE ' ERROR'        09500000
           ELSE                                                         09510000
              DISPLAY ' '                                               09520000
              DISPLAY ' *** SUCCESSFUL EXECUTION OF BP13C49Q.'          09530000
              DISPLAY ' *** MESSAGE/S PUT INTO QUEUE SUCCESSFULLY!'     09540000
              DISPLAY ' *** Q MANAGER : ' QM-NAME                       09550000
              DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME                 09560000
              DISPLAY ' *** INPUT  (K491) : ' WS-F491-CTR               09570000
              DISPLAY ' *** REWRITE(K491) : ' WS-REWRITE-CTR            09580000
              DISPLAY ' *** NOTFND (K491) : ' WS-NOTFND-CTR             09590000
              DISPLAY ' '                                               09600000
           END-IF.                                                      09610000
                                                                        09620000
           STOP RUN.                                                    09630000
                                                                        09640000
       9000-EXIT.                                                       09650000
           EXIT.                                                        09660000
                                                                        09670000
                                                                        09680000
      *=============================================================    09690000
       9100-EXIT-MQCONN.                                                09700000
      *=============================================================    09710000
                                                                        09720000
           DISPLAY ' *** PROGRAM ID:  BP13C49Q '                        09730000
           DISPLAY ' *** Q MANAGER : ' QM-NAME                          09740000
           DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME                    09750000
           DISPLAY ' '                                                  09760000
                                                                        09770000
           IF C49Q-COMPLETION-CODE NOT = ZEROES AND LOW-VALUES          09780000
              DISPLAY ' *** MQ COMPLETION CODE: ' C49Q-COMPLETION-CODE  09790000
              DISPLAY ' *** MQ REASON         : ' C49Q-REASON           09800000
              DISPLAY ' *** MQ ERROR MSG      : ' C49Q-ERR-MSG          09810000
              MOVE 99                      TO  RETURN-CODE              09820000
           END-IF.                                                      09830000
                                                                        09840000
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.              09850000
                                                                        09860000
       9100-EXIT.                                                       09870000
           EXIT.                                                        09880000
                                                                        09890000
      **************************************************************    09900000
      **********           END OF BP13C49Q                **********    09910000
      **************************************************************    09920000
