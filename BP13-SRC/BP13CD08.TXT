       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CD08.                                                 
      *AUTHOR.        MSD1.                                                     
      *DATE-WRITTEN.  22/01/2008.                                               
      **********************************************************                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *    SYSTEM ID   : BP13                                  *                
      **********************************************************                
      *                                                        *                
      *    OBJECTIVES  :                                       *                
      *                                                        *                
      *    1.  TO GENERATE REPORT ON DBSS RESULT               *                
      *                                                        *                
      *    INPUT FILES : BP13F740 -                            *                
      *                  BP13KB20 -                            *                
      *                  BP13KB78 -                            *                
      *                  BP13K200 -                            *                
      *                  BP13K830 -                            *                
      *                                                        *                
      *    OUTPUT FILE : P13LD08A -                            *                
      *                  P13LD08B -                            *                
      *                  P13FD80B -                            *                
      *                                                        *                
      *--------------------------------------------------------*                
      * CHG-NO   BY    DATE   DETAILS                          *                
      * ======= ====  ======  ================================ *                
      * BP133244 MSD1 220108  NEW PROGRAM                      *                
      *          MSD1 060208  DROP APPT DATE/TIME, REFORMAT RPT*                
      * BP133544 ESA1 130509  UPDATE PHONE NUMBER IN REPORT    *                
      *                       REPLACE BP13K825 WITH BP13KB20   *                
      *                       COMMENT OUT P13LD08B FOR > 200%  *                
      * BP134674 SMR2 091012  EXPAND BP13FD08 TO ADD AGENT-CDE *                
      *                       AND CORRESPONDING ADDRESS        *                
      * BP135043 SMR2 020913  USE BP13KB78 INSTEAD OF BP13KB20 *                
      * BP135505 SMR2 201014  INCLUDE FT2T FIELD IN THE REPORT *                
      * ====================================================== *                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
             SELECT BP13F740  ASSIGN TO BP13F740.                               
                                                                                
             SELECT BP13KB78                                                    
                       ASSIGN        TO BP13KB78                                
                       ACCESS MODE   IS RANDOM                                  
                       ORGANIZATION  IS INDEXED                                 
                       RECORD KEY    IS KB78-KEY-FLD                            
                       FILE STATUS   IS WS-KB78-STATUS.                         
                                                                                
             SELECT BP13K200                                                    
                       ASSIGN        TO BP13K200                                
                       ACCESS MODE   IS RANDOM                                  
                       ORGANIZATION  IS INDEXED                                 
                       RECORD KEY    IS K200-KEY-FLD                            
                       ALTERNATE KEY IS K200-NUM-REGN                           
                       FILE STATUS   IS WS-K200-STATUS.                         
                                                                                
             SELECT BP13FD08  ASSIGN TO BP13FD08.                               
             SELECT P13LD08A  ASSIGN TO P13LD08A.                               
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD BP13F740             RECORD CONTAINS 500 CHARACTERS                   
                               RECORDING MODE IS  F .                           
       COPY BP13F740.                                                           
                                                                                
       FD   BP13KB78           RECORD CONTAINS 3300 CHARACTERS.                 
       COPY BP13KB78.                                                           
                                                                                
       FD   BP13K200           RECORD CONTAINS 300 CHARACTERS.                  
       COPY BP13K200.                                                           
                                                                                
       FD BP13FD08             RECORD CONTAINS 350 CHARACTERS                   
                               RECORDING MODE IS  F .                           
       01 BP13FD08-REC.                                                         
          05 FD08-SNO                  PIC X(04).                               
          05 FIL01                     PIC X(01).                               
          05 FD08-NUM-QUEUE            PIC X(05).                               
          05 FIL02                     PIC X(01).                               
          05 FD08-NUM-REGN             PIC X(08).                               
          05 FIL03                     PIC X(01).                               
          05 FD08-NME-OCCP             PIC X(66).                               
          05 FIL04                     PIC X(01).                               
          05 FD08-NUM-NRIC             PIC X(09).                               
          05 FIL05                     PIC X(01).                               
          05 FD08-DESC-ETHN            PIC X(07).                               
          05 FIL06                     PIC X(01).                               
          05 FD08-DESC-HH              PIC X(09).                               
          05 FIL07                     PIC X(01).                               
          05 FD08-NUM-ALLOC            PIC X(03).                               
          05 FIL08                     PIC X(01).                               
          05 FD08-NUM-PHONE1           PIC X(08).                               
          05 FIL09                     PIC X(01).                               
          05 FD08-NUM-PHONE2           PIC X(08).                               
          05 FIL10                     PIC X(01).                               
          05 FD08-TXT-EMAIL            PIC X(50).                               
          05 FIL11                     PIC X(01).                               
          05 FD08-DTE-APPT             PIC X(10).                               
          05 FIL12                     PIC X(01).                               
          05 FD08-TME-APPT             PIC X(05).                               
          05 FIL13                     PIC X(01).                               
          05 FD08-NUM-AGENT-CDE        PIC X(04).                               
          05 FIL14                     PIC X(01).                               
          05 FD08-NUM-CORR-ADDR.                                                
             10 FD08-NUM-BLK.                                                   
                15 FD08-NUM-BLK-HDR        PIC X(03).                           
                15 FILLER                  PIC X(01).                           
                15 FD08-NUM-MAIN-BLK       PIC X(04).                           
                15 FD08-NUM-BLK-DASH       PIC X(01).                           
                15 FD08-NUM-SUB-BLK        PIC X(01).                           
             10 FILLER                     PIC X(01).                           
             10 FD08-NME-STR-BLDG          PIC X(32).                           
             10 FILLER                     PIC X(01).                           
             10 FD08-NUM-FLAT.                                                  
                15 FD08-NUM-HSELVL.                                             
                   20 FD08-NUM-LVL-CHAR    PIC X(01).                           
                   20 FD08-NUM-LVL-NUM     PIC X(02).                           
                   20 FD08-NUM-LVL-DASH    PIC X(01).                           
                15 FD08-NUM-HSEMAIN        PIC X(04).                           
                15 FD08-NUM-HSESUB         PIC X(01).                           
             10 FILLER                     PIC X(01).                           
             10 FD08-NUM-POSTAL.                                                
                15 FD08-NUM-POSTAL-OPN     PIC X(02).                           
                15 FD08-NUM-POSTAL-NUM     PIC X(06).                           
                15 FD08-NUM-POSTAL-CLS     PIC X(01).                           
          05 FIL15                     PIC X(01).                               
          05 FD08-NUM-FT2T             PIC X(04).                               
          05 FIL16                     PIC X(01).                               
          05 FILLER                    PIC X(71).                               
                                                                                
       FD P13LD08A             LABEL RECORDS ARE OMITTED.                       
       01 P13LD08A-REC                 PIC X(132).                              
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
                                                                                
       01 WS-FILE-STATUS.                                                       
          05 WS-F740-EOF               PIC X(01)  VALUE 'N'.                    
          05 WS-KB78-STATUS            PIC 9(02)  VALUE ZERO.                   
          05 WS-K200-STATUS            PIC 9(02)  VALUE ZERO.                   
                                                                                
       01 WS-VBLES.                                                             
          05 WS-SNO                    PIC 9(04)  VALUE ZERO.                   
          05 WS-RETURN-CODE            PIC 9(03)  VALUE ZERO.                   
          05 WS-DATE                   PIC X(08)  VALUE SPACE.                  
                                                                                
       01 WS-COUNTERS.                                                          
          05 WS-CTR                    PIC 9(02)  VALUE ZERO.                   
          05 WS-PAGENO                 PIC 9(03)  VALUE ZERO.                   
          05 WS-LINE-CNT               PIC 9(02)  VALUE ZERO.                   
          05 WS-F740-READ              PIC 9(08)  VALUE ZERO.                   
          05 WS-LD08-WRITTEN           PIC 9(08)  VALUE ZERO.                   
          05 WS-KB78-FND               PIC 9(08)  VALUE ZERO.                   
          05 WS-KB78-NOT-FND           PIC 9(08)  VALUE ZERO.                   
          05 WS-K200-FND               PIC 9(08)  VALUE ZERO.                   
          05 WS-K200-NOT-FND           PIC 9(08)  VALUE ZERO.                   
                                                                                
       01 BP13FD08-HEADER.                                                      
          05 HD08-SNO                  PIC X(04) VALUE 'SNO '.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-QUEUE            PIC X(05) VALUE 'QUEUE'.                 
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-REGN             PIC X(08) VALUE 'REGN'.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NME-OCCP             PIC X(66) VALUE 'APPLICANT NAME'.        
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-NRIC             PIC X(09) VALUE 'NRIC'.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-DESC-ETHN            PIC X(07) VALUE 'CAT '.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-DESC-HH              PIC X(09) VALUE 'HH '.                   
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-ALLOC            PIC X(03) VALUE 'ALC'.                   
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-HP               PIC X(08) VALUE 'PHONE1'.                
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-PHONE            PIC X(08) VALUE 'PHONE2'.                
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-TXT-EMAIL            PIC X(50) VALUE 'EMAIL'.                 
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-DTE-APPT             PIC X(10) VALUE 'APPT DTE'.              
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-TME-APPT             PIC X(05) VALUE 'TIME'.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-AGENT-CDE        PIC X(04) VALUE 'AGNT'.                  
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-CORR-ADDR        PIC X(63) VALUE                          
             'CORRESPONDING ADDRESS'.                                           
          05 FILLER                    PIC X     VALUE ';'.                     
          05 HD08-NUM-FT2T             PIC X(04) VALUE 'FT2T'.                  
          05 FILLER                    PIC X     VALUE ';'.                     
                                                                                
      ***************************                                               
      * PRINT AREA                                                              
      ***************************                                               
       01 LD08-HEADER1.                                                         
          05 FILLER             PIC X(08) VALUE 'P13LD08A'.                     
          05 FILLER             PIC X(06) VALUE SPACES.                         
          05 FILLER             PIC X(04) VALUE 'HDB3'.                         
          05 FILLER             PIC X(38) VALUE SPACES.                         
          05 FILLER             PIC X(20) VALUE 'SYSTEM OF COMMITMENT'.         
          05 FILLER             PIC X(26) VALUE SPACES.                         
          05 FILLER             PIC X(07) VALUE 'DATE : '.                      
          05 LD08-DATE          PIC X(10).                                      
          05 FILLER             PIC X(02) VALUE SPACES.                         
          05 FILLER             PIC X(07) VALUE 'PAGE : '.                      
          05 LD08-PAGE          PIC Z(04).                                      
                                                                                
       01 LD08-HEADER2A.                                                        
          05 FILLER                    PIC X(46) VALUE SPACES.                  
          05 FILLER                    PIC X(40) VALUE                          
             "REPORT ON DBSS SHORTLISTING RESULT - GRO".                        
       01 LD08-HEADER2B.                                                        
          05 FILLER                    PIC X(39) VALUE SPACES.                  
          05 FILLER                    PIC X(54) VALUE                          
             "REPORT ON DBSS SHORTLISTING RESULT - SUCC WITHIN 100%".           
       01 LD08-HEADER2C.                                                        
          05 FILLER                    PIC X(38) VALUE SPACES.                  
          05 FILLER                    PIC X(56) VALUE                          
             "REPORT ON DBSS SHORTLISTING RESULT - SUCC > 100%".                
                                                                                
       01 LD08-HEADER3.                                                         
          05 FILLER                    PIC X(05) VALUE 'SNO '.                  
          05 FILLER                    PIC X(06) VALUE 'QUEUE'.                 
          05 FILLER                    PIC X(09) VALUE 'REGN'.                  
          05 FILLER                    PIC X(26) VALUE 'APPLICANT NAME'.        
          05 FILLER                    PIC X(08) VALUE 'NRIC'.                  
          05 FILLER                    PIC X(04) VALUE 'CAT '.                  
          05 FILLER                    PIC X(03) VALUE 'HH '.                   
          05 FILLER                    PIC X(03) VALUE 'ALC'.                   
          05 FILLER                    PIC X(04) VALUE SPACES.                  
          05 FILLER                    PIC X(07) VALUE 'PHONE1'.                
          05 FILLER                    PIC X(09) VALUE 'PHONE2'.                
          05 FILLER                    PIC X(35) VALUE 'EMAIL'.                 
          05 FILLER                    PIC X(13) VALUE 'APPT DTE/TIME'.         
                                                                                
       01 LD8A-HEADER3.                                                         
          05 FILLER                    PIC X(05) VALUE 'Q/NO '.                 
          05 FILLER                    PIC X(09) VALUE 'REGN-NO'.               
          05 FILLER                    PIC X(07) VALUE 'ALSCH'.                 
          05 FILLER                    PIC X(27) VALUE SPACES.                  
          05 FILLER                    PIC X(12) VALUE 'CAT '.                  
          05 FILLER                    PIC X(24) VALUE 'NAME'.                  
          05 FILLER                    PIC X(07) VALUE 'ADDRESS'.               
                                                                                
       01 LD08-DASH-LINE               PIC X(132) VALUE ALL '-'.                
                                                                                
       01 LD08-DETAILS.                                                         
          05 LD08-SNO                  PIC Z(04).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-QUEUE            PIC X(05).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-REGN             PIC X(08).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NME-OCCP             PIC X(25).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-NRIC             PIC X(09).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-DESC-ETHN            PIC X(01).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-DESC-HH              PIC X(02).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-ALLOC            PIC X(03).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-PHONE1           PIC X(08).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-NUM-PHONE2           PIC X(08).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-TXT-EMAIL            PIC X(35).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-DTE-APPT             PIC X(08).                               
          05 FILLER                    PIC X(01).                               
          05 LD08-TME-APPT             PIC X(04).                               
                                                                                
       01 LD8A-DETAILS.                                                         
          05 LD8A-NUM-QUEUE            PIC X(05).                               
          05 FILLER                    PIC X(01).                               
          05 LD8A-NUM-REGN             PIC X(08).                               
          05 FILLER                    PIC X(02).                               
          05 LD8A-NUM-ALLOC            PIC X(03).                               
          05 FILLER                    PIC X(27).                               
          05 LD8A-DESC-ETHN            PIC X(07).                               
          05 FILLER                    PIC X(07).                               
          05 LD8A-NME-OCCP             PIC X(22).                               
          05 FILLER                    PIC X(01).                               
          05 LD8A-ADDRESS              PIC X(45).                               
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-CONTROL.                                                            
      *-------------------------------------------------------------            
           PERFORM 1000-OPEN-FILES      THRU 1000-EXIT.                         
           PERFORM 1500-READ-F740       THRU 1500-EXIT.                         
           PERFORM 2000-PROCESS-RTN     THRU 2000-EXIT                          
                   UNTIL WS-F740-EOF = 'Y'.                                     
           PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT.                         
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1000-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
           OPEN INPUT  BP13F740                                                 
                       BP13K200                                                 
                       BP13KB78                                                 
                OUTPUT BP13FD08                                                 
                       P13LD08A.                                                
                                                                                
           IF WS-K200-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K200 : ' WS-K200-STATUS                
              MOVE     WS-K200-STATUS         TO WS-RETURN-CODE                 
              PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-KB78-STATUS NOT = 00 AND 97                            04810000
              DISPLAY 'ERROR OPENING BP13KB78 : ' WS-KB78-STATUS                
              MOVE     WS-KB78-STATUS          TO WS-RETURN-CODE                
              PERFORM  9000-CLOSE-FILES      THRU 9000-EXIT                     
           END-IF.                                                      04850000
                                                                        04850000
           MOVE FUNCTION CURRENT-DATE(1:8)     TO WS-DATE.                      
           STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)                
                           DELIMITED BY SIZE INTO LD08-DATE.                    
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       1500-READ-F740.                                                          
      *-------------------------------------------------------------            
           READ BP13F740 AT END                                                 
                MOVE 'Y' TO WS-F740-EOF                                         
                GO TO 1500-EXIT.                                                
                                                                                
            ADD 1 TO WS-F740-READ.                                              
                                                                                
       1500-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2000-PROCESS-RTN.                                                        
      *-------------------------------------------------------------            
           INITIALIZE                  BP13FD08-REC.                            
           MOVE SPACES                 TO LD08-DETAILS                          
                                          LD8A-DETAILS                          
                                          BP13FD08-REC.                         
                                                                                
           PERFORM 4000-READ-BP13KB78       THRU 4000-EXIT.                     
           PERFORM 5000-READ-BP13K200       THRU 5000-EXIT.                     
                                                                                
           PERFORM 6000-PRINT-DETAIL        THRU 6000-EXIT.                     
                                                                                
           PERFORM 1500-READ-F740      THRU 1500-EXIT.                          
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3000-MOVE-BP13KB78.                                                      
      *-----------------------------------------------------------------        
           MOVE KB78-NME-APPLT1             TO LD8A-NME-OCCP                    
                                               LD08-NME-OCCP                    
                                               FD08-NME-OCCP.                   
                                                                                
           IF KB78-NUM-APPLT1-HP-PAGER NOT = SPACES AND LOW-VALUES              
              MOVE KB78-NUM-APPLT1-HP-PAGER TO LD08-NUM-PHONE1                  
                                               FD08-NUM-PHONE1                  
           ELSE                                                                 
              MOVE KB78-NUM-APPLT1-PHONE    TO LD08-NUM-PHONE1                  
                                               FD08-NUM-PHONE1                  
           END-IF.                                                              
                                                                                
           IF KB78-NUM-APPLT2-HP-PAGER NOT = SPACES AND LOW-VALUES              
              MOVE KB78-NUM-APPLT2-HP-PAGER TO LD08-NUM-PHONE2                  
                                               FD08-NUM-PHONE2                  
           ELSE                                                                 
              PERFORM 3100-CHECK-PHONE3     THRU 3100-EXIT                      
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3100-CHECK-PHONE3.                                                       
      *-----------------------------------------------------------------        
           IF ((KB78-NUM-APPLT1-PHONE NOT = SPACES AND LOW-VALUES)              
              AND (KB78-NUM-APPLT1-PHONE NOT = LD08-NUM-PHONE1))                
              MOVE KB78-NUM-APPLT1-PHONE TO LD08-NUM-PHONE2                     
                                            FD08-NUM-PHONE2                     
           ELSE                                                                 
              IF KB78-NUM-APPLT2-PHONE NOT = SPACES AND LOW-VALUES              
                 MOVE KB78-NUM-APPLT2-PHONE TO LD08-NUM-PHONE2                  
                                               FD08-NUM-PHONE2                  
              ELSE                                                              
                 IF KB78-NUM-APPLT3-HP-PAGER NOT = SPACES AND LOW-VALUES        
                    MOVE KB78-NUM-APPLT3-HP-PAGER TO LD08-NUM-PHONE2            
                                                     FD08-NUM-PHONE2            
                 ELSE                                                           
                    IF KB78-NUM-APPLT4-HP-PAGER NOT = SPACES                    
                       AND LOW-VALUES                                           
                       MOVE KB78-NUM-APPLT4-HP-PAGER TO LD08-NUM-PHONE2         
                                                        FD08-NUM-PHONE2         
                    ELSE                                                        
                       IF KB78-NUM-APPLT3-PHONE NOT = SPACES                    
                          AND LOW-VALUES                                        
                          MOVE KB78-NUM-APPLT3-PHONE TO LD08-NUM-PHONE2         
                                                        FD08-NUM-PHONE2         
                       ELSE                                                     
                          IF KB78-NUM-APPLT4-PHONE NOT = SPACES                 
                             AND LOW-VALUES                                     
                             MOVE KB78-NUM-APPLT4-PHONE                         
                                                     TO LD08-NUM-PHONE2         
                                                        FD08-NUM-PHONE2         
                          ELSE                                                  
                             PERFORM 3200-CHECK-OCCUPIER-HP                     
                                     THRU 3200-EXIT                             
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
             END-IF                                                             
           END-IF.                                                              
                                                                                
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       3200-CHECK-OCCUPIER-HP.                                                  
      ******************************************************************        
           IF KB78-NUM-OCCUP1-HP-PAGER NOT = SPACES AND LOW-VALUES              
              MOVE KB78-NUM-OCCUP1-HP-PAGER TO LD08-NUM-PHONE2                  
                                               FD08-NUM-PHONE2                  
           ELSE                                                                 
              IF KB78-NUM-OCCUP2-HP-PAGER NOT = SPACES AND LOW-VALUES           
                 MOVE KB78-NUM-OCCUP2-HP-PAGER TO LD08-NUM-PHONE2               
                                                  FD08-NUM-PHONE2               
              ELSE                                                              
                IF KB78-NUM-OCCUP3-HP-PAGER NOT = SPACES AND LOW-VALUES         
                   MOVE KB78-NUM-OCCUP3-HP-PAGER TO LD08-NUM-PHONE2             
                                                    FD08-NUM-PHONE2             
                ELSE                                                            
                   IF KB78-NUM-OCCUP4-HP-PAGER NOT = SPACES                     
                      AND LOW-VALUES                                            
                      MOVE KB78-NUM-OCCUP4-HP-PAGER TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                   ELSE                                                         
                      IF KB78-NUM-OCCUP5-HP-PAGER NOT = SPACES                  
                         AND LOW-VALUES                                         
                         MOVE KB78-NUM-OCCUP5-HP-PAGER                          
                                                    TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                      ELSE                                                      
                         IF KB78-NUM-OCCUP6-HP-PAGER NOT = SPACES               
                           AND LOW-VALUES                                       
                           MOVE KB78-NUM-OCCUP6-HP-PAGER                        
                                                    TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                         ELSE                                                   
                           IF KB78-NUM-OCCUP7-HP-PAGER NOT = SPACES             
                              AND LOW-VALUES                                    
                              MOVE KB78-NUM-OCCUP7-HP-PAGER                     
                                                    TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                           ELSE                                                 
                              IF KB78-NUM-OCCUP8-HP-PAGER NOT = SPACES          
                                 AND LOW-VALUES                                 
                                 MOVE KB78-NUM-OCCUP8-HP-PAGER                  
                                                    TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                              ELSE                                              
                                 PERFORM 3300-CHECK-OCCUPIER-PHONE              
                                         THRU 3300-EXIT                         
                              END-IF                                            
                           END-IF                                               
                         END-IF                                                 
                      END-IF                                                    
                   END-IF                                                       
                END-IF                                                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3200-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3300-CHECK-OCCUPIER-PHONE.                                               
      ******************************************************************        
           IF KB78-NUM-OCCUP1-PHONE NOT = SPACES AND LOW-VALUES                 
              MOVE KB78-NUM-OCCUP1-PHONE    TO LD08-NUM-PHONE2                  
                                               FD08-NUM-PHONE2                  
           ELSE                                                                 
              IF KB78-NUM-OCCUP2-PHONE NOT = SPACES AND LOW-VALUES              
                 MOVE KB78-NUM-OCCUP2-PHONE    TO LD08-NUM-PHONE2               
                                                  FD08-NUM-PHONE2               
              ELSE                                                              
                IF KB78-NUM-OCCUP3-PHONE NOT = SPACES AND LOW-VALUES            
                   MOVE KB78-NUM-OCCUP3-PHONE    TO LD08-NUM-PHONE2             
                                                    FD08-NUM-PHONE2             
                ELSE                                                            
                   IF KB78-NUM-OCCUP4-PHONE NOT = SPACES                        
                      AND LOW-VALUES                                            
                      MOVE KB78-NUM-OCCUP4-PHONE    TO LD08-NUM-PHONE2          
                                                       FD08-NUM-PHONE2          
                   ELSE                                                         
                      IF KB78-NUM-OCCUP5-PHONE NOT = SPACES                     
                         AND LOW-VALUES                                         
                         MOVE KB78-NUM-OCCUP5-PHONE TO                          
                                                    LD08-NUM-PHONE2             
                                                    FD08-NUM-PHONE2             
                      ELSE                                                      
                         IF KB78-NUM-OCCUP6-PHONE NOT = SPACES                  
                           AND LOW-VALUES                                       
                           MOVE KB78-NUM-OCCUP6-PHONE TO                        
                                                    LD08-NUM-PHONE2             
                                                    FD08-NUM-PHONE2             
                         ELSE                                                   
                            IF KB78-NUM-OCCUP7-PHONE NOT = SPACES               
                               AND LOW-VALUES                                   
                               MOVE KB78-NUM-OCCUP7-PHONE TO                    
                                                      LD08-NUM-PHONE2           
                                                      FD08-NUM-PHONE2           
                            ELSE                                                
                              IF KB78-NUM-OCCUP8-PHONE NOT = SPACES             
                                 AND LOW-VALUES                                 
                                 MOVE KB78-NUM-OCCUP8-PHONE TO                  
                                                      LD08-NUM-PHONE2           
                                                      FD08-NUM-PHONE2           
                              ELSE                                              
                                 MOVE SPACES       TO LD08-NUM-PHONE2           
                                                      FD08-NUM-PHONE2           
                              END-IF                                            
                            END-IF                                              
                         END-IF                                                 
                      END-IF                                                    
                   END-IF                                                       
                END-IF                                                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3300-EXIT.                                                               
            EXIT.                                                               
                                                                                
       4000-READ-BP13KB78.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES            TO BP13KB78-REC.                              
           INITIALIZE                BP13KB78-REC.                              
           MOVE F740-NUM-REGN     TO KB78-NUM-REGN.                             
                                                                                
           READ BP13KB78.                                                       
           EVALUATE WS-KB78-STATUS                                              
           WHEN 00                                                              
                ADD   1           TO WS-KB78-FND                                
           WHEN 23                                                              
                ADD   1           TO WS-KB78-NOT-FND                            
                DISPLAY 'BP13KB78 NOT FOUND REGN: ' F740-NUM-REGN               
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13KB78 - ' WS-KB78-STATUS              
                MOVE WS-KB78-STATUS        TO  WS-RETURN-CODE                   
                PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       5000-READ-BP13K200.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES            TO BP13K200-REC.                              
           INITIALIZE                BP13K200-REC.                              
           MOVE F740-NUM-REGN     TO K200-NUM-REGN.                             
                                                                                
           READ BP13K200 KEY IS K200-NUM-REGN.                                  
           EVALUATE WS-K200-STATUS                                              
           WHEN 00                                                              
                ADD   1           TO WS-K200-FND                                
           WHEN 23                                                              
                ADD   1           TO WS-K200-NOT-FND                            
                DISPLAY 'BP13K200 NOT FOUND REGN: ' K200-NUM-REGN               
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K200 - ' WS-K200-STATUS              
                MOVE WS-K200-STATUS        TO  WS-RETURN-CODE                   
                PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6000-PRINT-DETAIL.                                                       
      *-------------------------------------------------------------            
           IF WS-PAGENO = ZERO                                                  
              PERFORM 8000-PRINT-HEADER THRU 8000-EXIT                          
              WRITE BP13FD08-REC  FROM BP13FD08-HEADER                          
           ELSE                                                                 
              IF WS-LINE-CNT > 55                                               
                 PERFORM 8000-PRINT-HEADER THRU 8000-EXIT                       
           END-IF.                                                              
                                                                                
           MOVE SPACES                TO BP13FD08-REC.                          
           ADD   1                    TO WS-SNO.                                
           MOVE WS-SNO                TO LD08-SNO                               
                                         FD08-SNO.                              
                                                                                
           MOVE F740-NUM-NT-FT-QUEUE  TO LD08-NUM-QUEUE                         
                                         LD8A-NUM-QUEUE                         
                                         FD08-NUM-QUEUE.                        
           MOVE F740-NUM-REGN         TO LD08-NUM-REGN                          
                                         LD8A-NUM-REGN                          
                                         FD08-NUM-REGN.                         
           MOVE F740-NUM-NRIC1        TO LD08-NUM-NRIC                          
                                         FD08-NUM-NRIC.                         
           MOVE F740-NUM-FT2T         TO FD08-NUM-FT2T.                         
                                                                                
           PERFORM 6100-DECODE-RTN  THRU 6100-EXIT.                             
                                                                                
           MOVE F740-CDE-ALLOC-SCH    TO LD08-NUM-ALLOC                         
                                         LD8A-NUM-ALLOC                         
                                         FD08-NUM-ALLOC.                        
           MOVE KB78-NUM-EMAIL        TO LD08-TXT-EMAIL                         
                                         FD08-TXT-EMAIL.                        
                                                                                
           MOVE K200-DTE-BKAPPMT-DATE TO LD08-DTE-APPT.                         
           IF K200-DTE-BKAPPMT-DATE NOT = SPACES AND LOW-VALUES                 
              STRING K200-DTE-BKAPPMT-DATE(7:2) '/'                             
                     K200-DTE-BKAPPMT-DATE(5:2) '/'                             
                     K200-DTE-BKAPPMT-DATE(1:4)                                 
                     DELIMITED BY SIZE INTO FD08-DTE-APPT                       
           END-IF.                                                              
                                                                                
           IF K200-TME-BKAPPMT NOT = SPACES AND LOW-VALUES                      
              MOVE K200-TME-BKAPPMT      TO LD08-TME-APPT                       
              STRING K200-TME-BKAPPMT(1:2) ':'                                  
                     K200-TME-BKAPPMT(3:2)                                      
                     DELIMITED BY SIZE INTO FD08-TME-APPT                       
           END-IF.                                                              
                                                                                
           PERFORM 6110-MOVE-CORRADDR THRU 6110-EXIT.                           
                                                                                
           PERFORM 3000-MOVE-BP13KB78 THRU 3000-EXIT.                           
                                                                                
           PERFORM 6200-WRITE-REC   THRU 6200-EXIT.                             
                                                                                
           MOVE ';' TO  FIL01 FIL02 FIL03 FIL04 FIL05 FIL06                     
                        FIL07 FIL08 FIL09 FIL10 FIL11 FIL12                     
                        FIL13 FIL14 FIL15 FIL16.                                
                                                                                
           WRITE BP13FD08-REC.                                                  
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6100-DECODE-RTN.                                                         
      *----------------------------------------------------------------*        
           EVALUATE F740-CDE-CATEGORY                                           
           WHEN '1'                                                             
                MOVE 'MALAY'        TO LD08-DESC-ETHN                           
                                       LD8A-DESC-ETHN                           
                                       FD08-DESC-ETHN                           
           WHEN '2'                                                             
                MOVE 'CHINESE'      TO LD08-DESC-ETHN                           
                                       LD8A-DESC-ETHN                           
                                       FD08-DESC-ETHN                           
           WHEN '3'                                                             
                MOVE 'INDIAN'       TO LD08-DESC-ETHN                           
                                       LD8A-DESC-ETHN                           
                                       FD08-DESC-ETHN                           
           WHEN OTHER                                                           
                MOVE 'OTHERS'       TO LD08-DESC-ETHN                           
                                       LD8A-DESC-ETHN                           
                                       FD08-DESC-ETHN                           
           END-EVALUATE.                                                        
                                                                                
           IF F740-CDE-HOUSEHOLD = 'T' OR 'H'                                   
              MOVE 'FT'              TO LD08-DESC-HH                            
              MOVE '1ST TIMER'       TO FD08-DESC-HH                            
           ELSE                                                                 
              MOVE '2T'              TO LD08-DESC-HH                            
              MOVE '2ND TIMER'       TO FD08-DESC-HH                            
           END-IF.                                                              
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6110-MOVE-CORRADDR.                                                      
      *----------------------------------------------------------------*        
           MOVE KB78-NUM-AGENT-CDE          TO FD08-NUM-AGENT-CDE.              
                                                                                
           MOVE KB78-NUM-MAIN-BLK           TO FD08-NUM-MAIN-BLK.               
           MOVE KB78-NUM-SUB-BLK            TO FD08-NUM-SUB-BLK.                
                                                                                
           IF KB78-NUM-SUB-BLK NOT = SPACES AND LOW-VALUES                      
              MOVE '-'                      TO FD08-NUM-BLK-DASH                
           ELSE                                                                 
              MOVE SPACES                   TO FD08-NUM-BLK-DASH                
           END-IF.                                                              
                                                                                
           MOVE '#'                         TO FD08-NUM-LVL-CHAR.               
                                                                                
           IF (KB78-NUM-LEVEL(1:1) = SPACES OR LOW-VALUES) AND                  
              (KB78-NUM-LEVEL(2:1) NOT = SPACES AND LOW-VALUES)                 
              STRING '0', KB78-NUM-LEVEL(2:1)                                   
                     DELIMITED BY SIZE                                          
                INTO FD08-NUM-LVL-NUM                                           
              END-STRING                                                        
           ELSE                                                                 
              IF (KB78-NUM-LEVEL(2:1) = SPACES OR LOW-VALUES) AND               
                 (KB78-NUM-LEVEL(1:1) NOT = SPACES AND LOW-VALUES)              
                 STRING '0', KB78-NUM-LEVEL(1:1)                                
                        DELIMITED BY SIZE                                       
                   INTO FD08-NUM-LVL-NUM                                        
                 END-STRING                                                     
              ELSE                                                              
                 MOVE KB78-NUM-LEVEL        TO FD08-NUM-LVL-NUM                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE '-'                         TO FD08-NUM-LVL-DASH.               
           MOVE KB78-NUM-MAIN-UNIT          TO FD08-NUM-HSEMAIN.                
           MOVE KB78-NUM-SUB-UNIT           TO FD08-NUM-HSESUB.                 
                                                                                
           MOVE KB78-NUM-CORRESP-STREET     TO FD08-NME-STR-BLDG.               
                                                                                
           IF (KB78-NUM-MAIN-BLK  NOT = SPACES AND LOW-VALUES) AND              
              (KB78-NUM-MAIN-UNIT NOT = SPACES AND LOW-VALUES) AND              
              (KB78-NUM-CORRESP-STREET NOT = SPACES AND LOW-VALUES)             
              MOVE 'BLK'                    TO FD08-NUM-BLK-HDR                 
           ELSE                                                                 
              MOVE SPACES                   TO FD08-NUM-LVL-CHAR                
                                               FD08-NUM-LVL-DASH                
           END-IF.                                                              
                                                                                
           IF KB78-CDE-CORRESP-POST = SPACES OR LOW-VALUES                      
              MOVE SPACES                   TO FD08-NUM-POSTAL                  
           ELSE                                                                 
              MOVE 'S('                     TO FD08-NUM-POSTAL-OPN              
              MOVE KB78-CDE-CORRESP-POST    TO FD08-NUM-POSTAL-NUM              
              MOVE ')'                      TO FD08-NUM-POSTAL-CLS              
           END-IF.                                                              
                                                                                
       6110-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6200-WRITE-REC.                                                          
      *----------------------------------------------------------------*        
           WRITE P13LD08A-REC         FROM LD08-DETAILS.                        
           ADD 1                      TO WS-LINE-CNT                            
                                         WS-LD08-WRITTEN.                       
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       8000-PRINT-HEADER.                                                       
      *-------------------------------------------------------------            
           ADD   1            TO WS-PAGENO.                                     
           MOVE WS-PAGENO     TO LD08-PAGE.                                     
                                                                                
           IF F740-CDE-ALLOC-SCH NOT = 'PA ' AND 'TCP'                          
              WRITE P13LD08A-REC  FROM LD08-HEADER1 AFTER PAGE                  
              WRITE P13LD08A-REC  FROM LD08-HEADER2A                            
              WRITE P13LD08A-REC  FROM LD08-HEADER3 AFTER 2                     
              WRITE P13LD08A-REC  FROM LD08-DASH-LINE AFTER 1                   
              MOVE   5              TO WS-LINE-CNT                              
           ELSE                                                                 
              EVALUATE F740-CDE-REQUEST-STATUS                                  
              WHEN 'S'                                                          
                 WRITE P13LD08A-REC  FROM LD08-HEADER1 AFTER PAGE               
                 WRITE P13LD08A-REC  FROM LD08-HEADER2B                         
                 WRITE P13LD08A-REC  FROM LD08-HEADER3 AFTER 2                  
                 WRITE P13LD08A-REC  FROM LD08-DASH-LINE AFTER 1                
                 MOVE   5              TO WS-LINE-CNT                           
              WHEN 'R'                                                          
              WHEN 'W'                                                          
                 WRITE P13LD08A-REC  FROM LD08-HEADER1 AFTER PAGE               
                 WRITE P13LD08A-REC  FROM LD08-HEADER2C                         
                 WRITE P13LD08A-REC  FROM LD08-HEADER3 AFTER 2                  
                 WRITE P13LD08A-REC  FROM LD08-DASH-LINE AFTER 1                
                 MOVE   5              TO WS-LINE-CNT                           
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       9000-CLOSE-FILES.                                                        
      *-------------------------------------------------------------            
                                                                                
           CLOSE      BP13F740                                                  
                      BP13K200                                                  
                      BP13KB78                                                  
                      BP13FD08                                                  
                      P13LD08A.                                                 
                                                                                
           IF WS-K200-STATUS NOT = ZEROES                                       
              DISPLAY 'ERROR CLOSING BP13K200 : ' WS-K200-STATUS                
              MOVE WS-K200-STATUS              TO WS-RETURN-CODE                
           END-IF.                                                              
                                                                                
           IF WS-KB78-STATUS NOT = ZEROES                                       
              DISPLAY 'ERROR CLOSING BP13KB78 : ' WS-KB78-STATUS                
              MOVE WS-KB78-STATUS              TO WS-RETURN-CODE                
           END-IF.                                                              
                                                                                
           DISPLAY ' NO. OF BP13F740 RECORDS READ ' WS-F740-READ.               
           DISPLAY ' NO. OF P13LD08A WRITTEN      ' WS-LD08-WRITTEN.            
           DISPLAY ' NO. OF BP13KB78 FOUND        ' WS-KB78-FND.                
           DISPLAY ' NO. OF BP13KB78 NOT FOUND    ' WS-KB78-NOT-FND.            
           DISPLAY ' NO. OF BP13K200 FOUND        ' WS-K200-FND.                
           DISPLAY ' NO. OF BP13K200 NOT FOUND    ' WS-K200-NOT-FND.            
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
