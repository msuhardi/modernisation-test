       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CE18.                                                 
      *AUTHOR.        KATHRINA VALENZUELA.                                      
      *DATE-WRITTEN.  03/07/2019.                                               
      * ========================================================== *            
      * OBJECTIVE    : TO FORMAT AND SEND EMAIL ALERT TO CRMS WHO  *            
      *                RESERVE FLATS                               *            
      * ========================================================== *            
      * INPUT  FILES :  BP13FE17                                   *            
      * OUTPUT FILES :  P13LE17A, P13LE17B, P13LE17C, P13LE17D     *            
      * ========================================================== *            
      * CHG-NO   BY   DATE       DESCRIPTION                       *            
      * -------- ---  ------     -----------                       *            
      * BP137719 KV6  03/07/2019 NEW PROGRAM                       *            
      * BP137719 KV6  18/07/2019 TO CHANGE EMAIL ADD               *            
      * BP138067 KV6  08/11/2019 TO CATER FOR EMAIL ALERT OF       *            
      *                          CONSOLIDATED REPORTS              *            
      * BP138529 KR13 16/12/2020 ADD NEW MAIL IDs FOR LE17D.       *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13FE17  ASSIGN        TO BP13FE17.                          
                                                                                
           SELECT P13LE17A  ASSIGN        TO P13LE17A.                          
                                                                                
           SELECT P13LE17B  ASSIGN        TO P13LE17B.                          
                                                                                
           SELECT P13LE17C  ASSIGN        TO P13LE17C.                          
                                                                                
           SELECT P13LE17D  ASSIGN        TO P13LE17D.                          
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13FE17           BLOCK CONTAINS 0 RECORDS                         
                               RECORD CONTAINS 150 CHARACTERS                   
                               LABEL RECORD IS STANDARD                         
                               RECORDING MODE  IS  F.                           
       COPY BP13FE17.                                                           
                                                                                
       FD  P13LE17A                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  P13LE17A-REC                PIC X(132).                              
                                                                                
       FD  P13LE17B                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  P13LE17B-REC                PIC X(132).                              
                                                                                
       FD  P13LE17C                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  P13LE17C-REC                PIC X(132).                              
                                                                                
       FD  P13LE17D                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  P13LE17D-REC                PIC X(132).                              
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
      *---------------------------------------------------------------*         
      *        LINKAGE FOR BP13CCNT                                   *         
      *---------------------------------------------------------------*         
       01  WS-LINK-REC-CCNT.                                                    
           05  WS-LINK-CNTCT-TYPE        PIC X(3).                              
           05  WS-LINK-STAFF-NICK        PIC X(6).                              
           05  WS-LINK-STAFF-NUM         PIC X(6).                              
           05  WS-LINK-STAFF-CNTCT       PIC X(50).                             
           05  WS-LINK-SYSERR            PIC 9(4).                              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-FE17-READ              PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-FIN-SKIP           PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-LE17A-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-LE17B-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-LE17C-WRITE        PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-LE17D-WRITE        PIC 9(6)   VALUE ZEROES.               
                                                                                
       01  WS-FLAGS.                                                            
           05  WS-FE17-EOF               PIC X(1)   VALUE 'N'.                  
                                                                                
       01  WS-DATE.                                                             
           05  WS-DTE-FMT8.                                                     
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-FMT10.                                                    
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-CURR-8             PIC 9(8)   VALUE ZEROES.               
           05  WS-DTE-CURR-10            PIC X(10)  VALUE ZEROES.               
                                                                                
       01  WS-OTHERS.                                                           
           05  WS-PREV-OIC-A             PIC X(5)   VALUE SPACES.               
           05  WS-PREV-OIC-B             PIC X(5)   VALUE SPACES.               
           05  WS-PREV-OIC-C             PIC X(5)   VALUE SPACES.               
           05  WS-PREV-ALERT-TYPE        PIC X(1)   VALUE SPACES.               
           05  WS-NUM-SNO-LE17A          PIC 9(4)   VALUE ZEROES.               
           05  WS-NUM-SNO-LE17B          PIC 9(4)   VALUE ZEROES.               
           05  WS-NUM-SNO-LE17C          PIC 9(4)   VALUE ZEROES.               
           05  WS-NUM-SNO-LE17D          PIC 9(4)   VALUE ZEROES.               
                                                                                
      *---------------------------------------------------------------*         
      *        MAIL HEADER                                            *         
      *---------------------------------------------------------------*         
       01  MAIL-HDR-HELO.                                                       
           05  FILLER PIC X(132) VALUE 'HELO SGPHDB1'.                          
                                                                                
       01  MAIL-HDR-MAIL-FROM.                                                  
           05  FILLER PIC X(132) VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.              
                                                                                
       01  MAIL-HDR-MAIL-RCPT-TO.                                               
           05  FILLER PIC X(132) VALUE SPACES.                                  
                                                                                
       01  MAIL-HDR-MAIL-RCPT2.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<CHIN_CHAINN_HUEY@HDB.GO        
      -      'V.SG>'.                                                           
                                                                                
       01  MAIL-HDR-MAIL-RCPT3.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<HDB-SOSRESVFLAT@HDB.GOV        
      -      '.SG>'.                                                            
                                                                                
       01  MAIL-HDR-MAIL-RCPT4.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<PATRICIA_YJ_TAY@HDB.GOV        
      -      '.SG>'.                                                            
                                                                                
       01  MAIL-HDR-MAIL-RCPT5.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<SERENE_YL_TAN@HDB.GOV.S        
      -      'G>'.                                                              
                                                                                
       01  MAIL-HDR-MAIL-RCPT6.                                                 
           05  FILLER PIC X(132) VALUE 'RCPT TO:<GERALDINE_WS_QUEK@HDB.G        
      -      'OV.SG>'.                                                          
                                                                                
       01  MAIL-HDR-DATA.                                                       
           05  FILLER PIC X(132) VALUE 'DATA'.                                  
                                                                                
       01  MAIL-HDR-FROM.                                                       
           05  FILLER PIC X(132) VALUE 'FROM:Soc System - Email Alert'.         
                                                                                
       01  MAIL-HDR-MAIL-TO.                                                    
           05  FILLER PIC X(132) VALUE SPACES.                                  
                                                                                
       01  MAIL-HDR-MAIL-TO-CC1.                                                
           05  FILLER PIC X(132)                                                
               VALUE 'CC:<chin_chainn_huey@hdb.gov.sg>'.                        
                                                                                
       01  MAIL-HDR-MAIL-TO-CC2.                                                
           05  FILLER PIC X(132)                                                
               VALUE 'TO:<HDB-SOSResvFlat@hdb.gov.sg>'.                         
                                                                                
       01  MAIL-HDR-MAIL-TO-CC3.                                                
           05  FILLER PIC X(132)                                                
               VALUE 'CC:<patricia_yj_tay@hdb.gov.sg>'.                         
                                                                                
       01  MAIL-HDR-MAIL-TO-CC4.                                                
           05  FILLER PIC X(132)                                                
               VALUE 'CC:<serene_yl_tan@hdb.gov.sg>'.                           
                                                                                
       01  MAIL-HDR-MAIL-TO-CC5.                                                
           05  FILLER PIC X(132)                                                
               VALUE 'CC:<geraldine_ws_quek@hdb.gov.sg>'.                       
                                                                                
       01  MAIL-SUBJECT-LCE17.                                                  
           05  FILLER PIC X(132) VALUE 'SUBJECT : Weekly Report for moni        
      -        'toring of reserved flats'.                                      
                                                                                
       01  MAIL-BODY-LCE17             PIC X(132) VALUE SPACES.                 
                                                                                
       01  MAIL-END-LCE17              PIC X(132) VALUE SPACES.                 
                                                                                
       01  MAIL-HDR-DATE.                                                       
           05  FILLER                  PIC X(6)   VALUE 'DATE: '.               
           05  MAIL-DATE               PIC X(10)  VALUE SPACES.                 
                                                                                
       01  MAIL-END.                                                            
           05 FILLER                   PIC X      VALUE '.'.                    
                                                                                
       01  MAIL-SPACES.                                                         
           05 FILLER                   PIC X(132) VALUE SPACES.                 
                                                                                
      *---------------------------------------------------------------*         
      *                      REPORT DETAILS                           *         
      *---------------------------------------------------------------*         
       01  LE17-PR-HEAD-01.                                                     
           05  LE17-REPORT-TYPE        PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(5)  VALUE SPACES .                 
           05  FILLER                  PIC X(8)  VALUE 'HDBCAT 3'.              
           05  FILLER                  PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(20) VALUE                          
              'SYSTEM OF COMMITMENT'.                                           
           05  FILLER                  PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'DATE :'.                
           05  LE17-DATE-RUN           PIC X(10).                               
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'PAGE : '.               
           05  LE17-PAGENO             PIC ZZZZ9.                               
                                                                                
       01  LE17-PR-HEAD-02.                                                     
           05  FILLER                  PIC X(26)  VALUE SPACES.                 
           05  FILLER                  PIC X(50)  VALUE                         
               'WEEKLY REPORT FOR MONITORING OF RESERVED FLATS'.                
                                                                                
       01  LE17-PR-HEAD-02A.                                                    
           05  FILLER                  PIC X(39)  VALUE                         
               'DATE RESERVE >= 1 MONTH BUT <= 2 MONTHS'.                       
           05  FILLER                  PIC X(82)  VALUE SPACES.                 
                                                                                
       01  LE17-PR-HEAD-02B.                                                    
           05  FILLER                  PIC X(26)  VALUE                         
               'DATE RESERVE >= 2.5 MONTHS'.                                    
           05  FILLER                  PIC X(106) VALUE SPACES.                 
                                                                                
       01  LE17-PR-HEAD-02C.                                                    
           05  FILLER                  PIC X(24)  VALUE                         
               'DATE RESERVE >= 3 MONTHS'.                                      
           05  FILLER                  PIC X(108) VALUE SPACES.                 
                                                                                
       01  LE17-PR-HEAD-03A.                                                    
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(02) VALUE 'SN'.                    
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(13) VALUE 'SCHEME ACC NO'.         
           05  FILLER                  PIC X(05) VALUE SPACES.                  
           05  FILLER                  PIC X(24) VALUE 'ADDRESS OF FLAT         
      -        'RESERVED'.                                                      
           05  FILLER                  PIC X(26) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'FLAT'.                  
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(10) VALUE 'ALLOCATION'.            
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'DATE'.                  
           05  FILLER                  PIC X(06) VALUE SPACES.                  
           05  FILLER                  PIC X(07) VALUE 'REPRICE'.               
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE 'HA1'.                   
           05  FILLER                  PIC X(09) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE 'OIC'.                   
           05  FILLER                  PIC X(04) VALUE SPACES.                  
                                                                                
       01  LE17-PR-HEAD-03B.                                                    
           05  FILLER                  PIC X(75) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'TYPE'.                  
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE 'TAG'.                   
           05  FILLER                  PIC X(09) VALUE SPACES.                  
           05  FILLER                  PIC X(08) VALUE 'RESERVED'.              
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'DATE'.                  
           05  FILLER                  PIC X(06) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'NRIC'.                  
           05  FILLER                  PIC X(15) VALUE SPACES.                  
                                                                                
       01  LE17-PR-DTL-01.                                                      
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  LE17-SNO                PIC Z(4)  VALUE ZEROES.                  
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  LE17-SCH-ACC-NO         PIC X(11) VALUE SPACES.                  
           05  FILLER                  PIC X(06) VALUE SPACES.                  
           05  LE17-ADDRESS            PIC X(50) VALUE SPACES.                  
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  LE17-FLAT-TYPE          PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  LE17-ALLO-TAG           PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(09) VALUE SPACES.                  
           05  LE17-DTE-RESERVED       PIC X(08) VALUE SPACES.                  
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  LE17-DTE-REPRICE        PIC X(08) VALUE SPACES.                  
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  LE17-HA1-NRIC           PIC X(09) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  LE17-OIC                PIC X(05) VALUE SPACES.                  
           05  FILLER                  PIC X(03) VALUE SPACES.                  
                                                                                
       01  LE17-PR-LINE                PIC X(132) VALUE ALL '-'.                
                                                                                
       PROCEDURE DIVISION.                                                      
      *=============================================================            
       0000-CONTROL.                                                            
      *=============================================================            
                                                                                
           PERFORM 1000-OPEN-ROUTINE        THRU 1000-EXIT.                     
           PERFORM 1100-GET-DATE            THRU 1100-EXIT.                     
           PERFORM 1150-P13LE17D-HEADER     THRU 1150-EXIT.                     
           PERFORM 2000-BP13FE17-READ       THRU 2000-EXIT.                     
           PERFORM 3000-MAIN-ROUTINE        THRU 3000-EXIT                      
                   UNTIL WS-FE17-EOF = 'Y'.                                     
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.                      
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1000-OPEN-ROUTINE.                                                       
      *=============================================================            
                                                                                
           OPEN INPUT  BP13FE17                                                 
                OUTPUT P13LE17A                                                 
                       P13LE17B                                                 
                       P13LE17C                                                 
                       P13LE17D.                                                
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1100-GET-DATE.                                                           
      *=============================================================            
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO  WS-DTE-CURR-8.                  
           MOVE WS-DTE-CURR-8               TO  WS-DTE-FMT8.                    
           MOVE CORR WS-DTE-FMT8            TO  WS-DTE-FMT10.                   
           MOVE WS-DTE-FMT10                TO  WS-DTE-CURR-10.                 
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1150-P13LE17D-HEADER.                                                    
      *=============================================================            
           MOVE WS-DTE-CURR-10              TO MAIL-DATE                        
                                               LE17-DATE-RUN.                   
           MOVE 1                           TO LE17-PAGENO.                     
                                                                                
           WRITE P13LE17D-REC               FROM MAIL-HDR-HELO.                 
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-FROM.            
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-RCPT3.           
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-RCPT4.           
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-RCPT5.           
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-RCPT6.           
           WRITE P13LE17D-REC               FROM MAIL-HDR-DATA.                 
           WRITE P13LE17D-REC               FROM MAIL-HDR-FROM.                 
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-TO-CC2.          
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-TO-CC3.          
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-TO-CC4.          
           WRITE P13LE17D-REC               FROM MAIL-HDR-MAIL-TO-CC5.          
           WRITE P13LE17D-REC               FROM MAIL-SUBJECT-LCE17.            
           WRITE P13LE17D-REC               FROM MAIL-HDR-DATE.                 
                                                                                
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE SPACES                      TO LE17-REPORT-TYPE                 
           MOVE 'P13LE17D'                  TO LE17-REPORT-TYPE                 
           WRITE P13LE17D-REC               FROM LE17-PR-HEAD-01.               
           WRITE P13LE17D-REC               FROM LE17-PR-HEAD-02.               
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE ZEROES                      TO WS-NUM-SNO-LE17D.                
                                                                                
       1150-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1200-CHECK-EMAIL.                                                        
      *=============================================================            
                                                                                
           MOVE SPACES                      TO WS-LINK-REC-CCNT.                
           MOVE FE17-OIC                    TO WS-LINK-STAFF-NICK.              
           MOVE 'EML'                       TO WS-LINK-CNTCT-TYPE.              
                                                                                
           PERFORM 8000-CALL-BP13CCNT       THRU 8000-EXIT.                     
                                                                                
           MOVE SPACES                      TO MAIL-HDR-MAIL-RCPT-TO            
                                               MAIL-HDR-MAIL-TO.                
                                                                                
           STRING 'RCPT TO:<'          DELIMITED BY SIZE                        
                   WS-LINK-STAFF-CNTCT DELIMITED BY SPACE                       
                  '>'                  DELIMITED BY SIZE                        
                   INTO MAIL-HDR-MAIL-RCPT-TO.                                  
                                                                                
           STRING 'TO:<'               DELIMITED BY SIZE                        
                   WS-LINK-STAFF-CNTCT DELIMITED BY SPACE                       
                  '>'                  DELIMITED BY SIZE                        
                   INTO MAIL-HDR-MAIL-TO.                                       
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1201-PRINT-LE17A-HEADER.                                                 
      *=============================================================            
           MOVE WS-DTE-CURR-10              TO MAIL-DATE                        
                                               LE17-DATE-RUN.                   
           MOVE 1                           TO LE17-PAGENO.                     
                                                                                
           WRITE P13LE17A-REC               FROM MAIL-HDR-HELO.                 
           WRITE P13LE17A-REC               FROM MAIL-HDR-MAIL-FROM.            
           WRITE P13LE17A-REC               FROM MAIL-HDR-MAIL-RCPT-TO.         
           WRITE P13LE17A-REC               FROM MAIL-HDR-MAIL-RCPT2.           
           WRITE P13LE17A-REC               FROM MAIL-HDR-DATA.                 
           WRITE P13LE17A-REC               FROM MAIL-HDR-FROM.                 
           WRITE P13LE17A-REC               FROM MAIL-HDR-MAIL-TO.              
           WRITE P13LE17A-REC               FROM MAIL-HDR-MAIL-TO-CC1.          
           WRITE P13LE17A-REC               FROM MAIL-SUBJECT-LCE17.            
           WRITE P13LE17A-REC               FROM MAIL-HDR-DATE.                 
                                                                                
           WRITE P13LE17A-REC               FROM MAIL-SPACES.                   
           WRITE P13LE17A-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE SPACES                      TO LE17-REPORT-TYPE                 
           MOVE 'P13LE17A'                  TO LE17-REPORT-TYPE                 
           WRITE P13LE17A-REC               FROM LE17-PR-HEAD-01.               
           WRITE P13LE17A-REC               FROM LE17-PR-HEAD-02.               
           WRITE P13LE17A-REC               FROM MAIL-SPACES.                   
                                                                                
           WRITE P13LE17A-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17A-REC               FROM LE17-PR-HEAD-03A.              
           WRITE P13LE17A-REC               FROM LE17-PR-HEAD-03B.              
           WRITE P13LE17A-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17A-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE ZEROES                      TO WS-NUM-SNO-LE17A.                
                                                                                
       1201-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1202-PRINT-LE17B-HEADER.                                                 
      *=============================================================            
           MOVE WS-DTE-CURR-10              TO MAIL-DATE                        
                                               LE17-DATE-RUN.                   
           MOVE 1                           TO LE17-PAGENO.                     
                                                                                
           WRITE P13LE17B-REC               FROM MAIL-HDR-HELO.                 
           WRITE P13LE17B-REC               FROM MAIL-HDR-MAIL-FROM.            
           WRITE P13LE17B-REC               FROM MAIL-HDR-MAIL-RCPT-TO.         
           WRITE P13LE17B-REC               FROM MAIL-HDR-MAIL-RCPT2.           
           WRITE P13LE17B-REC               FROM MAIL-HDR-DATA.                 
           WRITE P13LE17B-REC               FROM MAIL-HDR-FROM.                 
           WRITE P13LE17B-REC               FROM MAIL-HDR-MAIL-TO.              
           WRITE P13LE17B-REC               FROM MAIL-HDR-MAIL-TO-CC1.          
           WRITE P13LE17B-REC               FROM MAIL-SUBJECT-LCE17.            
           WRITE P13LE17B-REC               FROM MAIL-HDR-DATE.                 
                                                                                
           WRITE P13LE17B-REC               FROM MAIL-SPACES.                   
           WRITE P13LE17B-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE SPACES                      TO LE17-REPORT-TYPE                 
           MOVE 'P13LE17B'                  TO LE17-REPORT-TYPE                 
           WRITE P13LE17B-REC               FROM LE17-PR-HEAD-01.               
           WRITE P13LE17B-REC               FROM LE17-PR-HEAD-02.               
           WRITE P13LE17B-REC               FROM MAIL-SPACES.                   
                                                                                
           WRITE P13LE17B-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17B-REC               FROM LE17-PR-HEAD-03A.              
           WRITE P13LE17B-REC               FROM LE17-PR-HEAD-03B.              
           WRITE P13LE17B-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17B-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE ZEROES                      TO WS-NUM-SNO-LE17B.                
                                                                                
       1202-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1203-PRINT-LE17C-HEADER.                                                 
      *=============================================================            
           MOVE WS-DTE-CURR-10              TO MAIL-DATE                        
                                               LE17-DATE-RUN.                   
           MOVE 1                           TO LE17-PAGENO.                     
                                                                                
           WRITE P13LE17C-REC               FROM MAIL-HDR-HELO.                 
           WRITE P13LE17C-REC               FROM MAIL-HDR-MAIL-FROM.            
           WRITE P13LE17C-REC               FROM MAIL-HDR-MAIL-RCPT-TO.         
           WRITE P13LE17C-REC               FROM MAIL-HDR-MAIL-RCPT2.           
           WRITE P13LE17C-REC               FROM MAIL-HDR-DATA.                 
           WRITE P13LE17C-REC               FROM MAIL-HDR-FROM.                 
           WRITE P13LE17C-REC               FROM MAIL-HDR-MAIL-TO.              
           WRITE P13LE17C-REC               FROM MAIL-HDR-MAIL-TO-CC1.          
           WRITE P13LE17C-REC               FROM MAIL-SUBJECT-LCE17.            
           WRITE P13LE17C-REC               FROM MAIL-HDR-DATE.                 
                                                                                
           WRITE P13LE17C-REC               FROM MAIL-SPACES.                   
           WRITE P13LE17C-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE SPACES                      TO LE17-REPORT-TYPE                 
           MOVE 'P13LE17C'                  TO LE17-REPORT-TYPE                 
           WRITE P13LE17C-REC               FROM LE17-PR-HEAD-01.               
           WRITE P13LE17C-REC               FROM LE17-PR-HEAD-02.               
           WRITE P13LE17C-REC               FROM MAIL-SPACES.                   
                                                                                
           WRITE P13LE17C-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17C-REC               FROM LE17-PR-HEAD-03A.              
           WRITE P13LE17C-REC               FROM LE17-PR-HEAD-03B.              
           WRITE P13LE17C-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17C-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE ZEROES                      TO WS-NUM-SNO-LE17C.                
                                                                                
       1203-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       1204-PRINT-LE17D-HEADER.                                                 
      *=============================================================            
                                                                                
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
                                                                                
           IF FE17-ALERT-TYPE = 'A'                                             
              WRITE P13LE17D-REC            FROM LE17-PR-HEAD-02A               
           END-IF.                                                              
                                                                                
           IF FE17-ALERT-TYPE = 'B'                                             
              WRITE P13LE17D-REC            FROM LE17-PR-HEAD-02B               
           END-IF.                                                              
                                                                                
           IF FE17-ALERT-TYPE = 'C'                                             
              WRITE P13LE17D-REC            FROM LE17-PR-HEAD-02C               
           END-IF.                                                              
                                                                                
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
           WRITE P13LE17D-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17D-REC               FROM LE17-PR-HEAD-03A.              
           WRITE P13LE17D-REC               FROM LE17-PR-HEAD-03B.              
           WRITE P13LE17D-REC               FROM LE17-PR-LINE.                  
           WRITE P13LE17D-REC               FROM MAIL-SPACES.                   
           MOVE ZEROES                      TO WS-NUM-SNO-LE17D.                
                                                                                
       1204-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       2000-BP13FE17-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13FE17                                                        
              AT END MOVE 'Y'               TO WS-FE17-EOF.                     
                                                                                
           IF WS-FE17-EOF NOT = 'Y'                                             
              ADD 1                         TO WS-FE17-READ                     
           ELSE                                                                 
              WRITE P13LE17A-REC            FROM MAIL-SPACES                    
              WRITE P13LE17A-REC            FROM MAIL-SPACES                    
                                                                                
              PERFORM 2001-WRITE-MAIL-END-LCE17A THRU 2001-EXIT                 
                                                                                
              WRITE P13LE17B-REC            FROM MAIL-SPACES                    
              WRITE P13LE17B-REC            FROM MAIL-SPACES                    
                                                                                
              PERFORM 2002-WRITE-MAIL-END-LCE17B THRU 2002-EXIT                 
                                                                                
              WRITE P13LE17C-REC            FROM MAIL-SPACES                    
              WRITE P13LE17C-REC            FROM MAIL-SPACES                    
                                                                                
              PERFORM 2003-WRITE-MAIL-END-LCE17C THRU 2003-EXIT                 
                                                                                
              WRITE P13LE17D-REC            FROM MAIL-SPACES                    
              WRITE P13LE17D-REC            FROM MAIL-SPACES                    
                                                                                
              WRITE P13LE17D-REC            FROM MAIL-END                       
           END-IF.                                                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       2001-WRITE-MAIL-END-LCE17A.                                              
      *=============================================================            
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'The list of flats is currently reserved. '                   
                  'Please email chin_chainn_huey@hdb.gov.sg by '                
                  '<1 week from date of email '                                 
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17A-REC               FROM MAIL-END-LCE17.                
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'alert> to indicate whether you still want to'                
                  ' reserve the flat.'                                          
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17A-REC               FROM MAIL-END-LCE17.                
           WRITE P13LE17A-REC               FROM MAIL-END.                      
                                                                                
       2001-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       2002-WRITE-MAIL-END-LCE17B.                                              
      *=============================================================            
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'The list of flats is currently reserved. '                   
                  'For cases where Management''s approval has '                 
                  'been obtained,'                                              
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17B-REC               FROM MAIL-END-LCE17.                
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'please be reminded to arrange for flat '                     
                  'acceptance within the next 2 weeks if you '                  
                  'have not done so.'                                           
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17B-REC               FROM MAIL-END-LCE17.                
                                                                                
           WRITE P13LE17B-REC               FROM MAIL-SPACES.                   
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'For cases without Management''s approval, '                  
                  'please email chin_chainn_huey@hdb.gov.sg by '                
                  '<1 week from date of email> '                                
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17B-REC               FROM MAIL-END-LCE17.                
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'to indicate whether you will be seeking '                    
                  'GDEAP''s concurrence to extend flat reservation.'            
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17B-REC               FROM MAIL-END-LCE17.                
           WRITE P13LE17B-REC               FROM MAIL-END.                      
                                                                                
       2002-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       2003-WRITE-MAIL-END-LCE17C.                                              
      *=============================================================            
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'The list of flats has been either reserved '                 
                  'for more than 3 months without approved '                    
                  'submission or '                                              
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
                                                                                
           WRITE P13LE17C-REC               FROM MAIL-END-LCE17.                
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'where management''s approval for direct '                    
                  'allocation has been granted but overdue for '                
                  'flat acceptance.'                                            
                 DELIMITED BY SIZE INTO MAIL-END-LCE17                          
           WRITE P13LE17C-REC               FROM MAIL-END-LCE17.                
                                                                                
           WRITE P13LE17C-REC               FROM MAIL-SPACES.                   
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'We will proceed to release these flats by '                  
                  'today. Should you wish to reinstate the flat '               
                  'reservation,'                                                
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17C-REC               FROM MAIL-END-LCE17.                
                                                                                
           MOVE SPACES                      TO MAIL-END-LCE17.                  
           STRING 'you would need to seek GDEAP''s concurrence.'                
                 DELIMITED BY SIZE INTO MAIL-END-LCE17.                         
           WRITE P13LE17C-REC               FROM MAIL-END-LCE17.                
           WRITE P13LE17C-REC               FROM MAIL-END.                      
                                                                                
       2003-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3000-MAIN-ROUTINE.                                                       
      *=============================================================            
                                                                                
           IF FE17-ALERT-TYPE = 'A'                                             
              PERFORM 3100-WRITE-LE17A-REPORT    THRU 3100-EXIT                 
           END-IF                                                               
           IF FE17-ALERT-TYPE = 'B'                                             
              PERFORM 3200-WRITE-LE17B-REPORT    THRU 3200-EXIT                 
           END-IF                                                               
           IF FE17-ALERT-TYPE = 'C'                                             
              PERFORM 3300-WRITE-LE17C-REPORT    THRU 3300-EXIT                 
           END-IF                                                               
                                                                                
           PERFORM 3400-WRITE-LE17D-REPORT       THRU 3400-EXIT.                
           PERFORM 2000-BP13FE17-READ            THRU 2000-EXIT.                
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3100-WRITE-LE17A-REPORT.                                                 
      *=============================================================            
                                                                                
           IF FE17-OIC NOT = SPACES AND LOW-VALUES AND ZEROES                   
              IF FE17-OIC NOT = WS-PREV-OIC-A                                   
                 IF WS-PREV-OIC-A NOT = SPACES                                  
                    WRITE P13LE17A-REC           FROM MAIL-SPACES               
                    WRITE P13LE17A-REC           FROM MAIL-SPACES               
                                                                                
                    PERFORM 2001-WRITE-MAIL-END-LCE17A THRU 2001-EXIT           
                 END-IF                                                         
                 PERFORM 1200-CHECK-EMAIL        THRU 1200-EXIT                 
                 PERFORM 1201-PRINT-LE17A-HEADER THRU 1201-EXIT                 
                 MOVE FE17-OIC                   TO WS-PREV-OIC-A               
              END-IF                                                            
              PERFORM 3350-WRITE-LE17-REPORT     THRU 3350-EXIT                 
           END-IF.                                                              
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3200-WRITE-LE17B-REPORT.                                                 
      *=============================================================            
                                                                                
           IF FE17-OIC NOT = SPACES AND LOW-VALUES AND ZEROES                   
              IF FE17-OIC NOT = WS-PREV-OIC-B                                   
                 IF WS-PREV-OIC-B NOT = SPACES                                  
                    WRITE P13LE17B-REC           FROM MAIL-SPACES               
                    WRITE P13LE17B-REC           FROM MAIL-SPACES               
                                                                                
                    PERFORM 2002-WRITE-MAIL-END-LCE17B THRU 2002-EXIT           
                 END-IF                                                         
                 PERFORM 1200-CHECK-EMAIL        THRU 1200-EXIT                 
                 PERFORM 1202-PRINT-LE17B-HEADER THRU 1202-EXIT                 
                 MOVE FE17-OIC                   TO WS-PREV-OIC-B               
              END-IF                                                            
              PERFORM 3350-WRITE-LE17-REPORT     THRU 3350-EXIT                 
           END-IF.                                                              
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3300-WRITE-LE17C-REPORT.                                                 
      *=============================================================            
                                                                                
           IF FE17-OIC NOT = SPACES AND LOW-VALUES AND ZEROES                   
              IF FE17-OIC NOT = WS-PREV-OIC-C                                   
                 IF WS-PREV-OIC-C NOT = SPACES                                  
                    WRITE P13LE17C-REC           FROM MAIL-SPACES               
                    WRITE P13LE17C-REC           FROM MAIL-SPACES               
                                                                                
                    PERFORM 2003-WRITE-MAIL-END-LCE17C THRU 2003-EXIT           
                 END-IF                                                         
                 PERFORM 1200-CHECK-EMAIL        THRU 1200-EXIT                 
                 PERFORM 1203-PRINT-LE17C-HEADER THRU 1203-EXIT                 
                 MOVE FE17-OIC                   TO   WS-PREV-OIC-C             
              END-IF                                                            
              PERFORM 3350-WRITE-LE17-REPORT     THRU 3350-EXIT                 
           END-IF.                                                              
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3350-WRITE-LE17-REPORT.                                                  
      *=============================================================            
                                                                                
           IF FE17-ALERT-TYPE = 'A'                                             
              ADD 1                         TO WS-NUM-SNO-LE17A                 
                                               WS-CNT-LE17A-WRITE               
              MOVE WS-NUM-SNO-LE17A         TO LE17-SNO                         
           END-IF                                                               
           IF FE17-ALERT-TYPE = 'B'                                             
              ADD 1                         TO WS-NUM-SNO-LE17B                 
                                               WS-CNT-LE17B-WRITE               
              MOVE WS-NUM-SNO-LE17B         TO LE17-SNO                         
           END-IF                                                               
           IF FE17-ALERT-TYPE = 'C'                                             
              ADD 1                         TO WS-NUM-SNO-LE17C                 
                                               WS-CNT-LE17C-WRITE               
              MOVE WS-NUM-SNO-LE17C         TO LE17-SNO                         
           END-IF                                                               
                                                                                
           MOVE FE17-SCH-ACC                 TO LE17-SCH-ACC-NO                 
           MOVE FE17-FLAT-ADDRESS            TO LE17-ADDRESS                    
           MOVE FE17-FLAT-TYPE               TO LE17-FLAT-TYPE                  
           MOVE FE17-ALLOCATION-TAG          TO LE17-ALLO-TAG                   
           MOVE FE17-DTE-RESERVE             TO LE17-DTE-RESERVED               
           MOVE FE17-DTE-REPRICE             TO LE17-DTE-REPRICE                
           MOVE FE17-HA1-NRIC                TO LE17-HA1-NRIC                   
           MOVE FE17-OIC                     TO LE17-OIC                        
                                                                                
           IF FE17-ALERT-TYPE = 'A'                                             
              WRITE P13LE17A-REC            FROM LE17-PR-DTL-01                 
              WRITE P13LE17A-REC            FROM MAIL-SPACES                    
           END-IF.                                                              
           IF FE17-ALERT-TYPE = 'B'                                             
              WRITE P13LE17B-REC            FROM LE17-PR-DTL-01                 
              WRITE P13LE17B-REC            FROM MAIL-SPACES                    
           END-IF.                                                              
           IF FE17-ALERT-TYPE = 'C'                                             
              WRITE P13LE17C-REC            FROM LE17-PR-DTL-01                 
              WRITE P13LE17C-REC            FROM MAIL-SPACES                    
           END-IF.                                                              
                                                                                
       3350-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3400-WRITE-LE17D-REPORT.                                                 
      *=============================================================            
                                                                                
           IF FE17-ALERT-TYPE NOT = SPACES AND LOW-VALUES AND ZEROES            
              IF FE17-ALERT-TYPE NOT = WS-PREV-ALERT-TYPE                       
                 PERFORM 1204-PRINT-LE17D-HEADER THRU 1204-EXIT                 
                 MOVE FE17-ALERT-TYPE            TO WS-PREV-ALERT-TYPE          
              END-IF                                                            
              PERFORM 3450-WRITE-LE17D-REPORT    THRU 3450-EXIT                 
           END-IF.                                                              
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       3450-WRITE-LE17D-REPORT.                                                 
      *=============================================================            
                                                                                
           ADD 1                             TO WS-NUM-SNO-LE17D                
                                                WS-CNT-LE17D-WRITE              
           MOVE WS-NUM-SNO-LE17D             TO LE17-SNO                        
                                                                                
           MOVE FE17-SCH-ACC                 TO LE17-SCH-ACC-NO                 
           MOVE FE17-FLAT-ADDRESS            TO LE17-ADDRESS                    
           MOVE FE17-FLAT-TYPE               TO LE17-FLAT-TYPE                  
           MOVE FE17-ALLOCATION-TAG          TO LE17-ALLO-TAG                   
           MOVE FE17-DTE-RESERVE             TO LE17-DTE-RESERVED               
           MOVE FE17-DTE-REPRICE             TO LE17-DTE-REPRICE                
           MOVE FE17-HA1-NRIC                TO LE17-HA1-NRIC                   
           MOVE FE17-OIC                     TO LE17-OIC                        
                                                                                
           WRITE P13LE17D-REC                FROM LE17-PR-DTL-01.               
           WRITE P13LE17D-REC                FROM MAIL-SPACES.                  
                                                                                
       3450-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       8000-CALL-BP13CCNT.                                                      
      *=============================================================            
                                                                                
           CALL 'BP13CCNT' USING  WS-LINK-REC-CCNT.                             
                                                                                
           EVALUATE WS-LINK-SYSERR                                              
           WHEN 000                                                             
              CONTINUE                                                          
           WHEN 100                                                             
              DISPLAY 'EMAIL ADDRESS NOT FOUND FOR ' FE17-OIC                   
              STRING  FE17-OIC     DELIMITED BY SPACE                           
                     '@hdb.gov.sg' DELIMITED BY SIZE                            
                                           INTO WS-LINK-STAFF-CNTCT             
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'BP13CCNT ERROR STATUS : ' WS-LINK-SYSERR                 
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       9000-CLOSE-ROUTINE.                                                      
      *=============================================================            
                                                                                
           CLOSE BP13FE17                                                       
                 P13LE17A                                                       
                 P13LE17B                                                       
                 P13LE17C                                                       
                 P13LE17D.                                                      
                                                                                
           DISPLAY '   '.                                                       
           DISPLAY '*------- BP13CE18 CONTROL TOTAL -------*'.                  
           DISPLAY '   '.                                                       
           DISPLAY ' 1. NO OF BP13FIN READ       : ' WS-FE17-READ.              
           DISPLAY ' 2. NO OF P13LE17A WRITTEN   : ' WS-CNT-LE17A-WRITE.        
           DISPLAY ' 3. NO OF P13LE17B WRITTEN   : ' WS-CNT-LE17B-WRITE.        
           DISPLAY ' 4. NO OF P13LE17C WRITTEN   : ' WS-CNT-LE17C-WRITE.        
           DISPLAY ' 5. NO OF P13LE17D WRITTEN   : ' WS-CNT-LE17D-WRITE.        
           DISPLAY '  '.                                                        
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
