       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C219.                                                 
      *AUTHOR.        SIA.                                                      
      *DATE-WRITTEN.  15/05/98.                                                 
      * ======================================================== *              
      *    BP13  --  SYSTEM OF COMMITMENT                        *              
      * ======================================================== *              
      *    OBJECTIVE  :                                          *              
      *                                                          *              
      *            THIS IS THE PROGRAM TO PRINT                  *              
      *            OCS SUMMARY LISTING - APPENDIX E              *              
      *                                                          *              
      *    INPUT FILES : BP13F205, BP13F278                      *              
      *                  BP13K060                                *              
      *                                                          *              
      *    OUTPUT      : P13L219A                                *              
      *                  P13L219B                                *              
      *                                                          *              
      *  CHG-NO  BY   ON      DESCRIPTION                        *              
      *----------------------------------                        *              
      *BP130488 SIA  980515 - NEW PGM BASE FR BP13C230           *              
      *BP130418 SIA  980826 - CHGE BM06K210 TO BM06K100 (Y2K)    *              
      *BP130778 GBR  991213 - TO INCLUDE 3 ROOM FLAT UNDER FLAT  *              
      *                       TYPE 'SE'                          *              
      *BP131059 LMS  010824 - TO CATER FOR BTO.                  *              
      *BP133610 ESA1 090427 - TO REPLACE BP13K767 W/ BP13K816    *              
      *BP134681 ESA1 120919 - TO REPLACE BP13K816 W/ BP13K813    *              
      *BP135190 SMR2 131204 - EXPAND BP13K813 TO 1000            *              
      * ======================================================== *              
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F205 ASSIGN TO BP13F205.                                  
                                                                                
           SELECT BP13F278 ASSIGN TO BP13F278.                                  
                                                                                
           SELECT BP13K222 ASSIGN TO BP13K222                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS RANDOM                                        
                  RECORD KEY   IS K222-KEY-FLD                                  
                  FILE STATUS  IS WS-K222-STATUS.                               
                                                                                
           SELECT BP13K060 ASSIGN TO BP13K060                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS RANDOM                                        
                  RECORD KEY   IS K060-KEY-FLD                                  
                  FILE STATUS  IS WS-K060-STATUS.                               
                                                                                
           SELECT BM06K100 ASSIGN TO BM06K100                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS RANDOM                                        
                  RECORD KEY   IS K100-KEY-FLD                                  
                  FILE STATUS  IS WS-K100-STATUS.                               
                                                                                
                                                                                
           SELECT P13L219A ASSIGN TO P13L219A.                                  
           SELECT P13L219B ASSIGN TO P13L219B.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F205                                                             
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 80  CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F205.                                                           
                                                                                
       FD  BP13F278                                                             
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 100 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F278.                                                           
                                                                                
       FD  BP13K222                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K222.                                                           
                                                                                
       FD  BP13K060                                                             
           RECORD CONTAINS 25 CHARACTERS.                                       
       COPY BP13K060.                                                           
                                                                                
       FD  BM06K100                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
       COPY BM06K100.                                                           
                                                                                
       FD  P13L219A                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  P13L219A-REC                     PIC X(80).                          
                                                                                
       FD  P13L219B                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  P13L219B-REC                     PIC X(80).                          
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
       COPY AV02COMM.                                                           
       01  WS-K222-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-K060-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-K100-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-SNO-L219A                   PIC 9999  VALUE ZEROS.                
       01  WS-SNO-L219B                   PIC 9999  VALUE ZEROS.                
       01  WS-LINE-L219A                  PIC 99    VALUE ZEROS.                
       01  WS-LINE-L219B                  PIC 99    VALUE ZEROS.                
       01  WS-F205-READ-CNT               PIC 9(4)  VALUE ZEROS.                
       01  WS-F278-READ-CNT               PIC 9(4)  VALUE ZEROS.                
       01  WS-F278-PROC-CNT               PIC 9(4)  VALUE ZEROS.                
       01  WS-K100-READ                   PIC 9(4)  VALUE ZEROS.                
       01  EOF-F205                       PIC X     VALUE 'N'.                  
       01  EOF-F278                       PIC X     VALUE 'N'.                  
       01  FINISH-PROCESS                 PIC X     VALUE 'N'.                  
       01  WS-DESC                        PIC X(20) VALUE SPACES.               
                                                                                
       01  WS-DTE-ALLOC.                                                        
           05 WS-DTE-DD                   PIC 99.                               
           05 FILLER                      PIC X     VALUE '/'.                  
           05 WS-DTE-MM                   PIC 99.                               
           05 FILLER                      PIC X     VALUE '/'.                  
           05 WS-DTE-YY                   PIC 99.                               
                                                                                
       01  WS-DTE-APPT.                                                         
           05 WS-DTE-CC                   PIC 99.                               
           05 WS-DTE-YY                   PIC 99.                               
           05 WS-DTE-MM                   PIC 99.                               
           05 WS-DTE-DD                   PIC 99.                               
                                                                                
       01  WS-L219A-RM-TYP                PIC X(2).                             
       01  WS-L219A-NT-ZONE               PIC X(20).                            
       01  WS-L219A-APPT-DATE             PIC X(8).                             
                                                                                
       01  WS-L219B-RM-TYP                PIC X(2).                             
       01  WS-L219B-NT-ZONE               PIC X(20).                            
       01  WS-L219B-APPT-DATE             PIC X(8).                             
                                                                                
       01  WS-FROM-DATE                   PIC X(18).                            
       01  WS-TO-DATE                     PIC X(18).                            
                                                                                
       01  WS-E-DAY                       PIC Z9.                               
       01  WS-APPT-DTE                    PIC X(18).                            
                                                                                
       01  SPACE-2                        PIC XX    VALUE SPACES.               
                                                                                
       01  WS-ALLOC-NT-ZONE.                                                    
           05 WS-NT-ZONE                  PIC X(3).                             
           05 WS-FT                       PIC X(2).                             
           05 WS-ALLOC-DATE               PIC 9(8).                             
                                                                                
       01  WS-ESTATE-ZONE-TXT             PIC X(7).                             
       01  WS-QUEUE-NO-PIC9               PIC 9(5).                             
                                                                                
       01  WS-QTR-BALLOT                  PIC X(3).                             
       01  WS-DTE-BALLOT.                                                       
           05  WS-YY-BALLOT               PIC X(4).                             
           05  WS-MM-BALLOT               PIC 9(2).                             
                                                                                
      *-----------------------------------------------------------*             
      *       LINKAGE FOR SUB-PROGRAM BP13C910                    *             
      *-----------------------------------------------------------*             
       01  WS-LINK-REC-2.                                                       
           05  WS-LINK-ZONE           PIC X(03).                                
       01  WS-BP13K813-REC            PIC X(1000).                              
       01  WS-ZONE-FND-FLAG           PIC X(01).                                
       01  WS-RETURN-CODE             PIC 9(02).                                
                                                                                
       COPY BP13K813.                                                           
                                                                                
      *============================================================*            
      *            P R I N T    L A Y O U T                        *            
      *============================================================*            
                                                                                
       01  L219-HEADER-1.                                                       
           05  FILLER                     PIC X(70) VALUE SPACES.               
           05  FILLER                     PIC X(10) VALUE                       
               'APPENDIX E'.                                                    
                                                                                
       01  L219-HEADER-2.                                                       
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(48) VALUE                       
               'LIST OF BLOCKS UNDER OPTIONAL COMPONENT SCHEME ('.              
           05  FILLER                     PIC X(10) VALUE                       
               'OCS) FOR  '.                                                    
           05  FILLER                     PIC X(20) VALUE SPACES.               
                                                                                
                                                                                
       01  L219-HEADER-3.                                                       
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  L219-NT-ZONE-FT            PIC X(40).                            
           05  L219-BALLOT-QTR            PIC X(20).                            
                                                                                
       01  L219-HEADER-4.                                                       
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(27) VALUE                       
               'THE SELECTION EXERCISE FOR '.                                   
           05  L219-FLAT-TYPE-A           PIC X(44).                            
                                                                                
       01  L219-HEADER-5.                                                       
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  L219-NEWTOWN-ZONE-A        PIC X(71).                            
                                                                                
       01  L219-HEADER-6A.                                                      
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(75) VALUE                       
              'BLOCKS WITH OPTION AVAILABLE UNDER OCS. '.                       
                                                                                
       01  L219-HEADER-6B.                                                      
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(75) VALUE                       
              'BLOCKS WITHOUT OPTION AVAILABLE UNDER OCS. '.                    
                                                                                
       01  L219-HEADER-7A.                                                      
           05  FILLER                     PIC X(6)  VALUE SPACES.               
           05  FILLER                     PIC X(8)  VALUE '  S/N'.              
           05  FILLER                     PIC X(32) VALUE                       
                                         'BLOCK / STREET NAME'.                 
           05  FILLER                     PIC X(20) VALUE                       
                                         'OCS DUE DATE'.                        
       01  L219-HEADER-7B.                                                      
           05  FILLER                     PIC X(6)  VALUE SPACES.               
           05  FILLER                     PIC X(8)  VALUE '  S/N'.              
           05  FILLER                     PIC X(32) VALUE                       
                                         'BLOCK / STREET NAME'.                 
           05  FILLER                     PIC X(20) VALUE SPACES.               
                                                                                
       01  L219-DATA1.                                                          
           05  FILLER                     PIC X(6)  VALUE SPACES.               
           05  L219-SN                    PIC ZZZ9.                             
           05  FILLER                     PIC X(1)  VALUE ')'.                  
           05  FILLER                     PIC X(3)  VALUE SPACES.               
           05  L219-NUM-BLK               PIC X(10).                            
           05  FILLER                     PIC X(1)  VALUE SPACES.               
           05  L219-NME-STREET            PIC X(20).                            
           05  FILLER                     PIC X(2)  VALUE SPACES.               
           05  L219-OCS-DATE              PIC X(10).                            
           05  FILLER                     PIC X(40) VALUE SPACES.               
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
       000-MAIN-ROUTINE.                                                        
           PERFORM 100-INITIALIZATION THRU 100-EXIT.                            
           PERFORM 200-READ-F205      THRU 200-EXIT                             
             UNTIL EOF-F205 = 'Y'.                                              
           PERFORM 999-CLOSE-FILES.                                             
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
       100-INITIALIZATION.                                                      
           OPEN INPUT  BP13F205                                                 
                       BP13K222                                                 
                       BP13K060                                                 
                       BM06K100                                                 
                OUTPUT P13L219A                                                 
                       P13L219B.                                                
                                                                                
           IF WS-K222-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K222 ' WS-K222-STATUS                
              MOVE WS-K222-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           IF WS-K060-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K060 ' WS-K060-STATUS                
              MOVE WS-K060-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           IF WS-K100-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BM06K100 ' WS-K100-STATUS                
              MOVE WS-K100-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           CALL 'OP13K813'         USING WS-RETURN-CODE.                        
           IF WS-RETURN-CODE NOT = ZEROS AND 97                                 
              DISPLAY 'OPEN ERROR, BP13K813 STATUS ' WS-RETURN-CODE             
              MOVE WS-RETURN-CODE TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
       200-READ-F205.                                                           
           READ BP13F205 AT END MOVE 'Y' TO EOF-F205                            
                            GO  TO 200-EXIT.                                    
                                                                                
           MOVE 'N' TO FINISH-PROCESS.                                          
           ADD 1 TO WS-F205-READ-CNT.                                           
           PERFORM 300-PROCESS-F278 THRU 300-EXIT.                              
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
       210-READ-F278.                                                           
           READ BP13F278 AT END MOVE 'Y' TO EOF-F278                            
                             GO TO 210-EXIT.                                    
                                                                                
           ADD 1 TO WS-F278-READ-CNT.                                           
                                                                                
       210-EXIT.                                                                
           EXIT.                                                                
                                                                                
       300-PROCESS-F278.                                                        
           MOVE 'N' TO EOF-F278.                                                
           OPEN INPUT BP13F278.                                                 
           PERFORM 210-READ-F278 THRU 210-EXIT.                                 
                                                                                
           IF EOF-F278 = 'Y'                                                    
              GO TO 300-EXIT                                                    
           END-IF.                                                              
                                                                                
           PERFORM 400-CHECK-F278 THRU 400-EXIT                                 
             UNTIL (EOF-F278       = 'Y').                                      
                                                                                
           CLOSE BP13F278.                                                      
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
       400-CHECK-F278.                                                          
                                                                                
           IF (F205-NUM-NT-ZONE   = F278-NUM-NT-ZONE) AND                       
              (F205-DTE-ALLOCN    = F278-DTE-ALLOCN)                            
               IF F205-NUM-FLAT-TYPE = 'SE'                                     
                  IF (F278-NUM-FLAT-TYPE = '3 ' OR                              
                      F278-NUM-FLAT-TYPE = '4 ' OR                              
                      F278-NUM-FLAT-TYPE = '5 ')                                
                     PERFORM 500-PROCESS-DETAILS THRU 500-EXIT                  
                     ADD 1 TO WS-F278-PROC-CNT                                  
                  END-IF                                                        
               ELSE                                                             
                  IF F205-NUM-FLAT-TYPE = F278-NUM-FLAT-TYPE                    
                     PERFORM 500-PROCESS-DETAILS THRU 500-EXIT                  
                     ADD 1 TO WS-F278-PROC-CNT                                  
                  END-IF                                                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 210-READ-F278 THRU 210-EXIT.                                 
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
       500-PROCESS-DETAILS.                                                     
                                                                                
           IF F278-NUM-OCS = 'Y'                                                
              PERFORM 700-PROCESS-WITH-OCS  THRU 700-EXIT                       
           ELSE                                                                 
              PERFORM 800-PROCESS-WOUT-OCS  THRU 800-EXIT                       
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       700-PROCESS-WITH-OCS.                                                    
                                                                                
           IF F205-NUM-SELECTION = 'BTO'                                        
              PERFORM 860-CALL-BP13C910 THRU 860-EXIT                           
              MOVE K813-NME-SITE        TO   WS-DESC                            
           ELSE                                                                 
              PERFORM 900-READ-K060     THRU 900-EXIT                           
           END-IF.                                                              
                                                                                
           IF (WS-LINE-L219A = 0) OR                                            
              (F278-NUM-FLAT-TYPE   NOT = WS-L219A-RM-TYP) OR                   
              (F278-DTE-END-BKAPPMT NOT = WS-L219A-APPT-DATE) OR                
              (WS-DESC              NOT = WS-L219A-NT-ZONE)                     
              PERFORM 710-PRINT-HDR-L219A  THRU 710-EXIT                        
              MOVE F278-DTE-END-BKAPPMT    TO WS-L219A-APPT-DATE                
              MOVE F278-NUM-FLAT-TYPE      TO WS-L219A-RM-TYP                   
              MOVE WS-DESC                 TO WS-L219A-NT-ZONE                  
           END-IF.                                                              
                                                                                
           PERFORM 910-READ-BM06K100 THRU 910-EXIT.                             
           IF K100-DTE-OCS-DUE = SPACES OR LOW-VALUES OR ZEROES                 
              MOVE '00/00/0000' TO L219-OCS-DATE                                
           ELSE                                                                 
              STRING  K100-DTE-OCS-DUE(7:2) '/'                                 
                      K100-DTE-OCS-DUE(5:2) '/'                                 
                      K100-DTE-OCS-DUE(1:4)                                     
                      DELIMITED BY SIZE INTO L219-OCS-DATE                      
              END-STRING                                                        
           END-IF.                                                              
                                                                                
           STRING 'BLK ' F278-NUM-BLK                                           
                   DELIMITED BY SIZE INTO L219-NUM-BLK.                         
                                                                                
           MOVE  F278-NME-STREET           TO L219-NME-STREET.                  
                                                                                
           ADD   1                         TO WS-SNO-L219A                      
           MOVE  WS-SNO-L219A              TO L219-SN                           
           WRITE P13L219A-REC            FROM L219-DATA1 AFTER 1.               
                                                                                
           ADD 1                           TO WS-LINE-L219A.                    
           IF WS-LINE-L219A > 58                                                
              MOVE 0                       TO WS-LINE-L219A.                    
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       710-PRINT-HDR-L219A.                                                     
                                                                                
           MOVE  SPACES TO L219-HEADER-3.                                       
           MOVE  SPACES TO L219-HEADER-5.                                       
                                                                                
           IF F205-NUM-NT-ZONE-SW = 'T'                                         
              MOVE ' ESTATE'      TO WS-ESTATE-ZONE-TXT                         
           ELSE                                                                 
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              MOVE SPACES         TO WS-ESTATE-ZONE-TXT                         
           END-IF.                                                              
                                                                                
           IF F278-NUM-FLAT-TYPE NOT = WS-L219A-RM-TYP                          
           OR WS-DESC            NOT = WS-L219A-NT-ZONE                         
              MOVE 0  TO WS-SNO-L219A                                           
           END-IF.                                                              
                                                                                
           MOVE SPACES               TO L219-NT-ZONE-FT.                        
           IF F278-NUM-FLAT-TYPE = '00'                                         
              STRING K813-NUM-FLAT-TYPE (1:1) DELIMITED BY SPACE                
                     ' - ROOM FLATS IN '      DELIMITED BY SIZE                 
                      K813-NME-SITE           DELIMITED BY SPACE-2              
                      WS-ESTATE-ZONE-TXT      DELIMITED BY SIZE                 
                INTO  L219-NT-ZONE-FT                                           
              STRING K813-NUM-FLAT-TYPE (1:1)  DELIMITED BY SPACE               
                     ' - ROOM FLATS IN       ' DELIMITED BY SIZE                
                INTO L219-FLAT-TYPE-A                                           
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '3R'                                         
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS'       DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS'       DELIMITED BY SIZE                    
                INTO L219-FLAT-TYPE-A                                           
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '4D'                                         
              STRING 'TYPE A - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE A - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '5D'                                         
              STRING 'TYPE B - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE B - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = 'ED'                                         
              STRING 'TYPE C - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE C - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = 'E '                                         
              STRING 'EXECUTIVE FLATS IN ' DELIMITED BY SIZE                    
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'EXECUTIVE FLATS IN       ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS IN '   DELIMITED BY SIZE                    
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              STRING F278-NUM-FLAT-TYPE        DELIMITED BY SPACE               
                     ' - ROOM FLATS IN       ' DELIMITED BY SIZE                
                INTO L219-FLAT-TYPE-A.                                          
                                                                                
                                                                                
           MOVE F205-DTE-BALLOT TO WS-DTE-BALLOT.                               
           EVALUATE WS-MM-BALLOT                                                
           WHEN 1  THRU 3                                                       
              MOVE '1ST' TO WS-QTR-BALLOT                                       
           WHEN 4  THRU 6                                                       
              MOVE '2ND' TO WS-QTR-BALLOT                                       
           WHEN 7  THRU 9                                                       
              MOVE '3RD' TO WS-QTR-BALLOT                                       
           WHEN 10 THRU 12                                                      
              MOVE '4TH' TO WS-QTR-BALLOT                                       
           END-EVALUATE.                                                        
                                                                                
           STRING '(' WS-QTR-BALLOT ' QUARTER '                                 
                      WS-YY-BALLOT                                              
                  ')' DELIMITED BY SIZE INTO L219-BALLOT-QTR.                   
                                                                                
                                                                                
           PERFORM 950-READ-BP13K222 THRU 950-EXIT.                             
                                                                                
           MOVE SPACES                     TO L219-NEWTOWN-ZONE-A.              
                                                                                
           IF F278-NUM-FLAT-TYPE = '00'                                         
              STRING WS-DESC                  DELIMITED BY SPACE-2              
                     WS-ESTATE-ZONE-TXT       DELIMITED BY SIZE                 
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '3 '                                         
              STRING 'IS FROM '               DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
              STRING WS-L219A-NT-ZONE         DELIMITED BY SPACE-2              
                     WS-ESTATE-ZONE-TXT       DELIMITED BY SIZE                 
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A.                                       
                                                                                
           MOVE 13 TO WS-LINE-L219A.                                            
                                                                                
           WRITE P13L219A-REC FROM L219-HEADER-1 AFTER PAGE.                    
           WRITE P13L219A-REC FROM L219-HEADER-2 AFTER 2.                       
           WRITE P13L219A-REC FROM L219-HEADER-3 AFTER 1.                       
           WRITE P13L219A-REC FROM L219-HEADER-4 AFTER 2.                       
           WRITE P13L219A-REC FROM L219-HEADER-5 AFTER 1.                       
           WRITE P13L219A-REC FROM L219-HEADER-6A AFTER 2.                      
           WRITE P13L219A-REC FROM L219-HEADER-7A AFTER 2.                      
                                                                                
           MOVE SPACES       TO P13L219A-REC.                                   
           WRITE P13L219A-REC AFTER 1.                                          
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
       800-PROCESS-WOUT-OCS.                                                    
                                                                                
           IF F205-NUM-SELECTION = 'BTO'                                        
              PERFORM 860-CALL-BP13C910 THRU 860-EXIT                           
              MOVE K813-NME-SITE        TO   WS-DESC                            
           ELSE                                                                 
              PERFORM 900-READ-K060     THRU 900-EXIT                           
           END-IF.                                                              
                                                                                
           IF (WS-LINE-L219B = 0) OR                                            
              (F278-NUM-FLAT-TYPE   NOT = WS-L219B-RM-TYP) OR                   
              (F278-DTE-END-BKAPPMT NOT = WS-L219B-APPT-DATE) OR                
              (WS-DESC              NOT = WS-L219B-NT-ZONE)                     
              PERFORM 810-PRINT-HDR-L219B  THRU 810-EXIT                        
              MOVE F278-DTE-END-BKAPPMT    TO WS-L219B-APPT-DATE                
              MOVE F278-NUM-FLAT-TYPE      TO WS-L219B-RM-TYP                   
              MOVE WS-DESC                 TO WS-L219B-NT-ZONE                  
           END-IF.                                                              
                                                                                
           STRING 'BLK ' F278-NUM-BLK                                           
                   DELIMITED BY SIZE INTO L219-NUM-BLK.                         
                                                                                
           MOVE  F278-NME-STREET           TO L219-NME-STREET.                  
                                                                                
           PERFORM 910-READ-BM06K100 THRU 910-EXIT.                             
           IF K100-DTE-OCS-DUE = SPACES OR LOW-VALUES OR ZEROES                 
              MOVE '00/00/0000' TO L219-OCS-DATE                                
           ELSE                                                                 
              STRING  K100-DTE-OCS-DUE(7:2) '/'                                 
                      K100-DTE-OCS-DUE(5:2) '/'                                 
                      K100-DTE-OCS-DUE(1:4)                                     
                      DELIMITED BY SIZE INTO L219-OCS-DATE                      
              END-STRING                                                        
           END-IF.                                                              
                                                                                
           ADD   1                         TO WS-SNO-L219B                      
           MOVE  WS-SNO-L219B              TO L219-SN                           
           WRITE P13L219B-REC            FROM L219-DATA1 AFTER 1.               
                                                                                
           ADD 1                           TO WS-LINE-L219B.                    
           IF WS-LINE-L219B > 58                                                
              MOVE 0                       TO WS-LINE-L219B.                    
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       810-PRINT-HDR-L219B.                                                     
                                                                                
           MOVE  SPACES TO L219-HEADER-3.                                       
           MOVE  SPACES TO L219-HEADER-5.                                       
                                                                                
           IF F205-NUM-NT-ZONE-SW = 'T'                                         
              MOVE ' ESTATE'      TO WS-ESTATE-ZONE-TXT                         
           ELSE                                                                 
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              MOVE SPACES         TO WS-ESTATE-ZONE-TXT                         
           END-IF.                                                              
                                                                                
           IF F278-NUM-FLAT-TYPE NOT = WS-L219B-RM-TYP                          
           OR WS-DESC            NOT = WS-L219B-NT-ZONE                         
              MOVE 0  TO WS-SNO-L219B                                           
           END-IF.                                                              
                                                                                
           MOVE SPACES               TO L219-NT-ZONE-FT.                        
           IF F278-NUM-FLAT-TYPE = '00'                                         
              STRING K813-NUM-FLAT-TYPE (1:1) DELIMITED BY SPACE                
                     ' - ROOM FLATS IN '      DELIMITED BY SIZE                 
                      K813-NME-SITE           DELIMITED BY SPACE-2              
                      WS-ESTATE-ZONE-TXT      DELIMITED BY SIZE                 
                INTO  L219-NT-ZONE-FT                                           
              STRING K813-NUM-FLAT-TYPE (1:1)  DELIMITED BY SPACE               
                     ' - ROOM FLATS IN       ' DELIMITED BY SIZE                
                INTO L219-FLAT-TYPE-A                                           
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '3R'                                         
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS'       DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS'       DELIMITED BY SIZE                    
                INTO L219-FLAT-TYPE-A                                           
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '4D'                                         
              STRING 'TYPE A - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE A - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '5D'                                         
              STRING 'TYPE B - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE B - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = 'ED'                                         
              STRING 'TYPE C - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'TYPE C - ROOM FLATS IN   ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = 'E '                                         
              STRING 'EXECUTIVE FLATS IN ' DELIMITED BY SIZE                    
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              MOVE 'EXECUTIVE FLATS IN       ' TO L219-FLAT-TYPE-A              
           ELSE                                                                 
              STRING F278-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS IN '   DELIMITED BY SIZE                    
                      WS-DESC              DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L219-NT-ZONE-FT                                           
              STRING F278-NUM-FLAT-TYPE        DELIMITED BY SPACE               
                     ' - ROOM FLATS IN       ' DELIMITED BY SIZE                
                INTO L219-FLAT-TYPE-A.                                          
                                                                                
                                                                                
           MOVE F205-DTE-BALLOT TO WS-DTE-BALLOT.                               
           EVALUATE WS-MM-BALLOT                                                
           WHEN 1  THRU 3                                                       
              MOVE '1ST' TO WS-QTR-BALLOT                                       
           WHEN 4  THRU 6                                                       
              MOVE '2ND' TO WS-QTR-BALLOT                                       
           WHEN 7  THRU 9                                                       
              MOVE '3RD' TO WS-QTR-BALLOT                                       
           WHEN 10 THRU 12                                                      
              MOVE '4TH' TO WS-QTR-BALLOT                                       
           END-EVALUATE.                                                        
                                                                                
           STRING '(' WS-QTR-BALLOT ' QUARTER '                                 
                      WS-YY-BALLOT                                              
                  ')' DELIMITED BY SIZE INTO L219-BALLOT-QTR.                   
                                                                                
                                                                                
           PERFORM 950-READ-BP13K222 THRU 950-EXIT.                             
                                                                                
           MOVE SPACES                     TO L219-NEWTOWN-ZONE-A.              
                                                                                
           IF F278-NUM-FLAT-TYPE = '00'                                         
              STRING WS-DESC                  DELIMITED BY SPACE-2              
                     WS-ESTATE-ZONE-TXT       DELIMITED BY SIZE                 
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
           IF F278-NUM-FLAT-TYPE = '3 '                                         
              STRING 'IS FROM '               DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
              STRING WS-DESC                  DELIMITED BY SPACE-2              
                     WS-ESTATE-ZONE-TXT       DELIMITED BY SIZE                 
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L219-NEWTOWN-ZONE-A.                                       
                                                                                
           MOVE 13 TO WS-LINE-L219B.                                            
                                                                                
           WRITE P13L219B-REC FROM L219-HEADER-1 AFTER PAGE.                    
           WRITE P13L219B-REC FROM L219-HEADER-2 AFTER 2.                       
           WRITE P13L219B-REC FROM L219-HEADER-3 AFTER 1.                       
           WRITE P13L219B-REC FROM L219-HEADER-4 AFTER 2.                       
           WRITE P13L219B-REC FROM L219-HEADER-5 AFTER 1.                       
           WRITE P13L219B-REC FROM L219-HEADER-6B AFTER 2.                      
           WRITE P13L219B-REC FROM L219-HEADER-7B AFTER 2.                      
                                                                                
           MOVE SPACES       TO P13L219B-REC.                                   
           WRITE P13L219B-REC AFTER 1.                                          
                                                                                
       810-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       860-CALL-BP13C910.                                                       
                                                                                
           MOVE F278-NUM-NT-ZONE       TO WS-LINK-ZONE.                         
           CALL 'BP13C910' USING WS-LINK-REC-2,                                 
                                 WS-BP13K813-REC,                               
                                 WS-ZONE-FND-FLAG.                              
           IF WS-ZONE-FND-FLAG = 'Y'                                            
              MOVE WS-BP13K813-REC TO BP13K813-REC                              
           ELSE                                                                 
              MOVE SPACES          TO BP13K813-REC                              
           END-IF.                                                              
                                                                                
       860-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       900-READ-K060.                                                           
                                                                                
           IF F205-NUM-NT-ZONE-SW = 'T'                                         
              MOVE 02                TO K060-SERIAL-NO                          
           ELSE                                                                 
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              MOVE 45                TO K060-SERIAL-NO                          
           END-IF.                                                              
                                                                                
           MOVE F278-NUM-NT-ZONE  TO K060-CODE.                                 
           READ BP13K060.                                                       
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC      TO WS-DESC                                    
           ELSE                                                                 
           IF WS-K060-STATUS = 23                                               
              MOVE SPACES         TO WS-DESC                                    
              DISPLAY 'REC NOT FOUND IN BP13K060 ' WS-K060-STATUS               
              DISPLAY 'K060-KEY-FLD = ' K060-KEY-FLD                            
           ELSE                                                                 
              MOVE SPACES         TO WS-DESC                                    
              DISPLAY 'ERROR READING BP13K060 ' WS-K060-STATUS                  
              DISPLAY 'K060-KEY-FLD = ' K060-KEY-FLD                            
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       910-READ-BM06K100.                                                       
                                                                                
           INITIALIZE K100-REC.                                                 
           MOVE F278-NUM-ESTATE           TO K100-ESTATE.                       
           MOVE F278-NUM-NEIGHBOUR        TO K100-NEIGHBOURHOOD.                
           MOVE F278-NUM-CONTR            TO K100-CONTRACT-NO.                  
           MOVE F278-NUM-BLK              TO K100-BLK-NO.                       
                                                                                
           READ BM06K100.                                                       
           EVALUATE WS-K100-STATUS                                              
           WHEN 00                                                              
              ADD 1 TO WS-K100-READ                                             
           WHEN 23                                                              
              DISPLAY 'REC NOTFD IN BM06K100 = '                                
                       K100-KEY-FLD                                             
           WHEN OTHER                                                           
              DISPLAY 'ERROR READING BM06K100 ' WS-K100-STATUS                  
              DISPLAY 'K100-KEY-FLD = ' K100-KEY-FLD                            
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
                                                                                
       910-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       950-READ-BP13K222.                                                       
                                                                                
           MOVE F205-DTE-ALLOCN    TO K222-DTE-ALLOC.                           
           MOVE F205-NUM-NT-ZONE   TO K222-NUM-NT-ZONE.                         
           MOVE F205-NUM-FLAT-TYPE TO K222-NUM-FLAT-TYPE.                       
           READ BP13K222.                                                       
           IF WS-K222-STATUS NOT = 00                                           
              MOVE SPACES                 TO WS-FROM-DATE                       
              MOVE SPACES                 TO WS-TO-DATE                         
              DISPLAY 'ERROR READING BP13K222, STATUS= ' WS-K222-STATUS         
              DISPLAY 'K222-KEY-FLD = ' K222-KEY-FLD                            
           ELSE                                                                 
              MOVE K222-DTE-START-BKAPPMT TO WS-IN-DATE                         
              DISPLAY WS-IN-DATE                                                
              PERFORM 951-GET-DTE-DESC  THRU 951-EXIT                           
              MOVE WS-DD-WORD             TO WS-FROM-DATE                       
                                                                                
              MOVE K222-DTE-END-BKAPPMT   TO WS-IN-DATE                         
              PERFORM 951-GET-DTE-DESC  THRU 951-EXIT                           
              MOVE WS-DD-WORD             TO WS-TO-DATE.                        
                                                                                
       950-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       951-GET-DTE-DESC.                                                        
                                                                                
           MOVE 'DD'                   TO WS-IN-OPTION.                         
           MOVE '000'                  TO WS-RETURN.                            
                                                                                
           CALL 'AV02C001' USING LINK-REC.                                      
                                                                                
           IF WS-RETURN = 'EID'                                                 
              DISPLAY 'ERROR IN DATE ' WS-IN-DATE.                              
                                                                                
       951-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       999-CLOSE-FILES.                                                         
           CLOSE BP13F205                                                       
                 BP13K222                                                       
                 BP13K060                                                       
                 BM06K100                                                       
                 P13L219A                                                       
                 P13L219B.                                                      
                                                                                
           DISPLAY '+----- BP13C219 CTRL TOTAL -----------+'                    
           DISPLAY '      ' FUNCTION CURRENT-DATE                               
           DISPLAY '      '                                                     
           DISPLAY 'NO. OF BP13F205 RECORDS READ : ' WS-F205-READ-CNT           
           DISPLAY 'NO. OF BP13F278 PROCESSED    : ' WS-F278-PROC-CNT           
           DISPLAY 'NO. OF BM06K100 READ         : ' WS-K100-READ               
           DISPLAY '      '                                                     
           DISPLAY '+-------------------------------------+'                    
                                                                                
           CALL 'CP13K813'         USING WS-RETURN-CODE.                        
           IF WS-RETURN-CODE NOT = ZEROS AND 97                                 
              DISPLAY 'CLOSE ERROR, BP13K813 STATUS ' WS-RETURN-CODE            
              MOVE WS-RETURN-CODE TO RETURN-CODE                                
           END-IF.                                                              
                                                                                
           IF WS-K222-STATUS NOT = 00                                           
              DISPLAY 'FILE BP13K222  CLOSE ERROR ' WS-K222-STATUS.             
           IF WS-K060-STATUS NOT = 00                                           
              DISPLAY 'FILE BP13K060  CLOSE ERROR ' WS-K060-STATUS.             
           STOP RUN.                                                            
                                                                                
                                                                                
