      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID. BP13C656.                                                    
      *AUTHOR. RHB.                                                             
      *DATE-WRITTEN. 09/12/97.                                                  
                                                                                
      **************************************************************            
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                      *            
      *    SYSTEM ID   : BP13                                      *            
      *============================================================*            
      *    OBJECTIVE :                                             *            
      *                                                            *            
      *      1.  TO PRINT RECORDS FROM BP13F410 FOR SERS CASES.    *            
      *                                                            *            
      *============================================================*            
      * CHG-NO   BY   ON     DESCRIPTION                           *            
      * --------------------------------                           *            
      * BP130415 RHB 091297  NEW PGM                               *            
      * BP130418 RHB 090698  Y2K;FILE LENGTH                       *            
      * BP130895 JMS 150700  TO EXPAND SER-CONTRA                  *            
      *                      TO CATER FOR THE SER-CONTRA-1ST-INST  *            
      * BP130883 RAS 080800  TO CHANGE BP13C909 TO BP13C913        *            
      * BP132118 ANA 210302  PRINT SERS-CONTRA-MISC-FEE            *            
      * BP132604 YCH 111004  EXPAND BP17F000 FROM 80 TO 200        *            
      * BP135325 PCL4160614  TO CATER FOR SERS CREAM-OFF/CASH PROCEED           
      * BP135366 RJB 270215  TO CREATE AB03F123 SERS CASE          *            
      **************************************************************            
                                                                                
      *---------------------*                                                   
       ENVIRONMENT DIVISION.                                                    
      *---------------------*                                                   
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F410  ASSIGN       TO BP13F410.                           
           SELECT BP17F000  ASSIGN       TO BP17F000.                           
           SELECT BP13L656  ASSIGN       TO BP13L656.                           
           SELECT BP17K120  ASSIGN       TO BP17K120                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K120-KEY-FLD                        
                            FILE STATUS  IS WS-K120-STATUS.                     
           SELECT AB03F123  ASSIGN       TO AB03F123.                           
                                                                                
                                                                                
                                                                                
      *---------------------*                                                   
       DATA DIVISION.                                                           
      *---------------------*                                                   
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   BP17K120                                                            
            RECORD CONTAINS 1600 CHARACTERS.                                    
       COPY BP17K120.                                                           
                                                                                
       FD   BP13F410                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13F410.                                                           
                                                                                
       FD   BP17F000                                                            
            RECORD CONTAINS 200 CHARACTERS                                      
            BLOCK CONTAINS 0 RECORDS                                            
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP17F000.                                                           
                                                                                
       FD   BP13L656                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORDS ARE OMITTED.                                          
       01   PRINT-LINE      PIC X(132).                                         
                                                                                
       FD   AB03F123                                                            
            BLOCK  CONTAINS 0   RECORDS                                         
            RECORD CONTAINS 250 CHARACTERS                                      
            LABEL  RECORD   IS  OMITTED                                         
            RECORDING MODE IS F.                                                
       COPY AB03F123.                                                           
                                                                                
                                                                                
      *----------------------*                                                  
       WORKING-STORAGE SECTION.                                                 
      *----------------------*                                                  
                                                                                
       01  WS-F410-EOF             PIC X         VALUE SPACE.                   
       01  WS-F000-EOF             PIC X         VALUE SPACE.                   
       01  WS-F410-READ            PIC 9(08)     VALUE ZEROES.                  
       01  WS-F000-READ            PIC 9(08)     VALUE ZEROES.                  
       01  WS-K120-STATUS          PIC 9(02)     VALUE ZEROES.                  
       01  WS-F410-NOTMATCH        PIC 9(08)     VALUE ZEROES.                  
       01  WS-F000-NOTMATCH        PIC 9(08)     VALUE ZEROES.                  
       01  WS-F410-OUTPUT          PIC 9(08)     VALUE ZEROES.                  
       01  WS-SER-CONTRA-TOTAL     PIC 9(06)V99  VALUE ZEROES.                  
       01  WS-MATCH                PIC 9(08)     VALUE ZEROES.                  
       01  WS-CNT                  PIC 9(02)     VALUE 65.                      
       01  WS-PAGE                 PIC 9(05)     VALUE ZEROES.                  
       01  WS-F123-CNT-WRITE       PIC 9(8)      VALUE ZEROES.                  
                                                                                
       01  WS-SYS-DATE.                                                         
           05 WS-SYS-CC            PIC 9(02).                                   
           05 WS-SYS-YY            PIC 9(02).                                   
           05 WS-SYS-MM            PIC 9(02).                                   
           05 WS-SYS-DD            PIC 9(02).                                   
                                                                                
       01  WS-EDIT-DATE.                                                        
           05 WS-EDIT-DD           PIC 9(02).                                   
           05 FILLER               PIC X(01) VALUE '/'.                         
           05 WS-EDIT-MM           PIC 9(02).                                   
           05 FILLER               PIC X(01) VALUE '/'.                         
           05 WS-EDIT-CC           PIC 9(02).                                   
           05 WS-EDIT-YY           PIC 9(02).                                   
                                                                                
       01  L656-PR-HEAD-01.                                                     
           05  FILLER              PIC X(14)   VALUE 'BP13L656      '.          
           05  FILLER              PIC X(8)    VALUE 'HDB3    '.                
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'DATE: '.                  
           05  PRINT-DATE          PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(1)    VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'PAGE: '.                  
           05  PRINT-PAGE          PIC ZZZ9.                                    
                                                                                
       01  L656-PR-HEAD-02.                                                     
           05  FILLER              PIC X(58)   VALUE SPACES.                    
           05  FILLER              PIC X(17)   VALUE                            
                                  'SERS CONTRA CASES'.                          
                                                                                
       01  L656-PR-HEAD-03.                                                     
           05  FILLER              PIC X(53)   VALUE SPACES.                    
           05  FILLER              PIC X(27)   VALUE                            
                                  'SALES UNIT - AGREEMENT TEAM'.                
                                                                                
       01  L656-PR-HEAD-04.                                                     
           05  FILLER              PIC X(50)  VALUE                             
           '  S/N  SCHEME ACCT     ADDRESS                    '.                
           05  FILLER              PIC X(59)  VALUE                             
           '    TP          SERS            SERS                  '.            
           05  FILLER              PIC X(09)  VALUE                             
           '     SERS'.                                                         
                                                                                
       01  L656-PR-HEAD-05.                                                     
           05  FILLER              PIC X(50)  VALUE                             
           '       REGN NO  LT B/S                            '.                
           05  FILLER              PIC X(59)  VALUE                             
           '    DATE        CONTRA          FLAT ADDRESS             '.         
           05  FILLER              PIC X(16)  VALUE                             
           '     SCHEME ACCT'.                                                  
                                                                                
       01  L656-PR-DETAIL.                                                      
           05  L656-SN             PIC ZZZZ9.                                   
           05  FILLER              PIC X(2)  VALUE SPACES.                      
           05  L656-SCHEME         PIC X(4)   VALUE 'XXXX'.                     
           05  DD1                 PIC X      VALUE '-'.                        
           05  L656-ACC            PIC X(4)   VALUE 'XXXX'.                     
           05  DD2                 PIC X      VALUE '-'.                        
           05  L656-CDG            PIC X      VALUE 'X'.                        
           05  DD3                 PIC X      VALUE '-'.                        
           05  L656-ACC-TYPE       PIC X(2)   VALUE 'XX'.                       
           05  FILLER              PIC X(01).                                   
           05  L656-ADDRESS1.                                                   
               07  L656-BLKNO            PIC X(05)  VALUE SPACES.               
               07  FILLER                PIC X(1)   VALUE SPACES.               
               07  L656-NUM-FLAT.                                               
                   10  L656-CHAR         PIC X      VALUE SPACES.               
                   10  L656-LEVEL        PIC X(2)   VALUE SPACES.               
                   10  L656-DASH         PIC X      VALUE SPACES.               
                   10  L656-HSE-MAIN     PIC X(4)   VALUE SPACES.               
                   10  L656-HSE-SUB      PIC X(3)   VALUE SPACES.               
               07  FILLER                PIC X(13)  VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  L656-TP-DATE        PIC X(10) VALUE SPACES.                      
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  L656-LBL-ICP        PIC X(06)        VALUE 'ICP :'.              
           05  L656-AMT-ICP-CTR    PIC ZZZZZ9.99.                               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  L656-SER-ADDRESS1.                                               
               07  L656-SER-BLKNO        PIC X(05)  VALUE SPACES.               
               07  FILLER                PIC X(1)   VALUE SPACES.               
               07  L656-SER-NUM-FLAT.                                           
                   10  L656-SER-CHAR     PIC X      VALUE SPACES.               
                   10  L656-SER-LEVEL    PIC X(2)   VALUE SPACES.               
                   10  L656-SER-DASH     PIC X      VALUE SPACES.               
                   10  L656-SER-HSE-MAIN PIC X(4)   VALUE SPACES.               
                   10  L656-SER-HSE-SUB  PIC X(3)   VALUE SPACES.               
               07  FILLER                PIC X(13)  VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  L656-SER-SCHEME     PIC X(4)   VALUE 'XXXX'.                     
           05  D1                  PIC X      VALUE '-'.                        
           05  L656-SER-ACC        PIC X(4)   VALUE 'XXXX'.                     
           05  D2                  PIC X      VALUE '-'.                        
           05  L656-SER-CDG        PIC X      VALUE 'X'.                        
                                                                                
       01  L656-PR-DETAIL1.                                                     
           05  FILLER              PIC X(7)  VALUE SPACES.                      
           05  L656-REGN           PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(01).                                   
           05  L656-LT             PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(01).                                   
           05  L656-BS             PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(02).                                   
           05  L656-ADDRESS2.                                                   
               07  L656-STREET-NAME      PIC X(30)  VALUE SPACES.               
           05  FILLER              PIC X(13)        VALUE SPACES.               
           05  L656-LBL-SF         PIC X(06)        VALUE 'SF  :'.              
           05  L656-AMT-SF-CTR     PIC ZZZZZ9.99.                               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  L656-SER-ADDRESS2.                                               
               07  L656-SER-STREET-NAME  PIC X(30)  VALUE SPACES.               
                                                                                
       01  L656-PR-DETAIL2.                                                     
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-CF         PIC X(06)        VALUE 'CF   :'.             
           05  L656-AMT-CF-CTR     PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL2A.                                                    
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-1ST-INST   PIC X(06)        VALUE '1ST  :'.             
           05  L656-AMT-1ST-CTR    PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL2B.                                                    
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-MISC       PIC X(06)        VALUE 'MISC :'.             
           05  L656-AMT-MISC-CTR   PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL2C.                                                    
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-CREAM      PIC X(06)        VALUE 'CREAM:'.             
           05  L656-AMT-CREAM-CTR  PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL2D.                                                    
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-PROCD      PIC X(06)        VALUE 'PROCD:'.             
           05  L656-AMT-PROCD-CTR  PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL3.                                                     
           05  FILLER              PIC X(66)        VALUE SPACES.               
           05  L656-LBL-TOT        PIC X(06)        VALUE 'TOT :'.              
           05  L656-AMT-TOT-CTR    PIC ZZZZZ9.99.                               
                                                                                
       01  L656-PR-DETAIL4.                                                     
           05  FILLER              PIC X(40)        VALUE SPACES.               
           05  FILLER              PIC X(19)        VALUE                       
               'E M P T Y   F I L E'.                                           
                                                                                
       01  SQL-CODE                PIC 9(4).                                    
                                                                                
       01  WS-LINK-REC.                                                         
           05  WS-LINK-NUM-SCH-ACC.                                             
               10  WS-LINK-NUM-SCH     PIC X(4).                                
               10  WS-LINK-NUM-ACC     PIC X(5).                                
                                                                                
       COPY P13COMM8.                                                           
                                                                                
                                                                                
      *-------------------*                                                     
       PROCEDURE DIVISION.                                                      
      *-------------------*                                                     
                                                                                
      *-------------------*                                                     
       0000-MAIN-LOGIC.                                                         
      *-------------------*                                                     
           PERFORM 1000-INITIALIZATION.                                         
           PERFORM 2000-READ-F410 THRU 2000-EXIT.                               
           PERFORM 3000-READ-F000 THRU 3000-EXIT.                               
           PERFORM 4000-PROCESS   THRU 4000-EXIT                                
             UNTIL F410-NUM-REGN  = HIGH-VALUE                                  
               AND F000-NUM-REGNO = HIGH-VALUE.                                 
           PERFORM 8000-CHECK-NULL-FILE THRU 8000-EXIT.                         
           PERFORM 9000-FINALIZATION THRU 9000-FINALIZATION.                    
                                                                                
       0000-FINISH.                                                             
           STOP RUN.                                                            
                                                                                
                                                                                
      *-------------------*                                                     
       1000-INITIALIZATION.                                                     
      *-------------------*                                                     
            OPEN INPUT  BP13F410                                                
                        BP17F000                                                
                        BP17K120                                                
                 OUTPUT BP13L656                                                
                        AB03F123.                                               
                                                                                
            IF WS-K120-STATUS NOT = 00 AND 97                                   
               DISPLAY 'BP17K120 - ERROR OPENING : ' WS-K120-STATUS             
               PERFORM  9000-FINALIZATION   THRU 9000-EXIT                      
            END-IF.                                                             
                                                                                
                                                                                
            MOVE FUNCTION CURRENT-DATE TO WS-SYS-DATE.                          
            MOVE WS-SYS-CC             TO WS-EDIT-CC.                           
            MOVE WS-SYS-YY             TO WS-EDIT-YY.                           
            MOVE WS-SYS-MM             TO WS-EDIT-MM.                           
            MOVE WS-SYS-DD             TO WS-EDIT-DD.                           
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       2000-READ-F410.                                                          
      *---------------------------------------------------------------*         
            READ BP13F410 AT END MOVE HIGH-VALUE TO F410-NUM-REGN               
            GO TO 2000-EXIT.                                                    
            ADD 1 TO WS-F410-READ.                                              
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       3000-READ-F000.                                                          
      *---------------------------------------------------------------*         
            READ BP17F000 AT END MOVE HIGH-VALUE TO F000-NUM-REGNO              
               GO TO 3000-EXIT.                                                 
            ADD 1 TO WS-F000-READ.                                              
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       4000-PROCESS.                                                            
      *---------------------------------------------------------------*         
            IF  F410-NUM-REGN = F000-NUM-REGNO                                  
                ADD 1 TO WS-MATCH                                               
                PERFORM 7000-READ-K120 THRU 7000-EXIT                           
                PERFORM 5000-PRINT-REC THRU 5000-EXIT                           
                IF F410-AMT-LOAN > ZEROS                                        
                   PERFORM 7500-WRITE-SMS                                       
                      THRU 7500-EXIT                                            
                END-IF                                                          
                PERFORM 2000-READ-F410 THRU 2000-EXIT                           
                PERFORM 3000-READ-F000 THRU 3000-EXIT                           
            ELSE                                                                
            IF F410-NUM-REGN  < F000-NUM-REGNO                                  
               ADD 1 TO WS-F410-NOTMATCH                                        
               PERFORM 2000-READ-F410  THRU 2000-EXIT                           
            ELSE                                                                
               ADD 1 TO WS-F000-NOTMATCH                                        
               PERFORM 3000-READ-F000  THRU 3000-EXIT.                          
                                                                                
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       5000-PRINT-REC.                                                          
      *---------------------------------------------------------------*         
            ADD 1 TO WS-F410-OUTPUT.                                            
                                                                                
            IF WS-CNT > 50                                                      
               MOVE  0               TO WS-CNT                                  
               ADD   1               TO WS-PAGE                                 
               MOVE  WS-PAGE         TO PRINT-PAGE                              
               MOVE  WS-EDIT-DATE    TO PRINT-DATE                              
               WRITE PRINT-LINE FROM L656-PR-HEAD-01 AFTER PAGE                 
               WRITE PRINT-LINE FROM L656-PR-HEAD-02                            
               WRITE PRINT-LINE FROM L656-PR-HEAD-03                            
               WRITE PRINT-LINE FROM L656-PR-HEAD-04 AFTER 2                    
               WRITE PRINT-LINE FROM L656-PR-HEAD-05                            
               ADD   6 TO WS-CNT                                                
            END-IF.                                                             
                                                                                
            ADD  1 TO WS-CNT.                                                   
            IF F410-AMT-SER-CONTRA-ICP NOT NUMERIC                              
               MOVE ZEROES TO F410-AMT-SER-CONTRA-ICP.                          
                                                                                
            IF F410-AMT-SER-CONTRA-STAMP-FEES NOT NUMERIC                       
               MOVE ZEROES TO F410-AMT-SER-CONTRA-STAMP-FEES.                   
                                                                                
            IF F410-AMT-SER-CONTRA-CONVY-FEES NOT NUMERIC                       
               MOVE ZEROES TO F410-AMT-SER-CONTRA-CONVY-FEES.                   
                                                                                
            IF F410-AMT-SER-CONTRA-1STMTHINST NOT NUMERIC                       
               MOVE ZEROES TO F410-AMT-SER-CONTRA-1STMTHINST.                   
                                                                                
            IF F410-AMT-SER-CONTRA-MISC-FEE NOT NUMERIC                         
               MOVE ZEROES TO F410-AMT-SER-CONTRA-MISC-FEE.                     
                                                                                
            IF F410-AMT-CASH-PROCEED-USE    NOT NUMERIC                         
               MOVE ZEROES TO F410-AMT-CASH-PROCEED-USE.                        
                                                                                
            COMPUTE WS-SER-CONTRA-TOTAL            =                            
                    F410-AMT-SER-CONTRA-ICP        +                            
                    F410-AMT-SER-CONTRA-STAMP-FEES +                            
                    F410-AMT-SER-CONTRA-CONVY-FEES +                            
                    F410-AMT-SER-CONTRA-1STMTHINST +                            
                    F410-AMT-CASH-PROCEED-USE      +                            
                    K120-AMT-CREAM-OFF             +                            
                    F410-AMT-SER-CONTRA-MISC-FEE.                               
                                                                                
            MOVE WS-F410-OUTPUT                 TO L656-SN.                     
            MOVE F410-NUM-REGN                  TO L656-REGN.                   
            MOVE F410-NUM-LOAN-TAG              TO L656-LT.                     
            MOVE F410-NUM-BUY-SELL-TAG          TO L656-BS.                     
            MOVE 'ICP  :'                       TO L656-LBL-ICP.                
            MOVE 'SF   :'                       TO L656-LBL-SF .                
            MOVE 'CF   :'                       TO L656-LBL-CF .                
            MOVE 'MISC :'                       TO L656-LBL-MISC.               
            MOVE 'CREAM:'                       TO L656-LBL-CREAM.              
            MOVE 'PROCD:'                       TO L656-LBL-PROCD.              
            MOVE 'TOT  :'                       TO L656-LBL-TOT.                
            MOVE F410-AMT-SER-CONTRA-ICP        TO L656-AMT-ICP-CTR.            
            MOVE F410-AMT-SER-CONTRA-STAMP-FEES TO L656-AMT-SF-CTR.             
            MOVE F410-AMT-SER-CONTRA-CONVY-FEES TO L656-AMT-CF-CTR.             
            MOVE F410-AMT-SER-CONTRA-1STMTHINST TO L656-AMT-1ST-CTR.            
            MOVE F410-AMT-SER-CONTRA-MISC-FEE   TO L656-AMT-MISC-CTR.           
            MOVE K120-AMT-CREAM-OFF             TO L656-AMT-CREAM-CTR.          
            MOVE F410-AMT-CASH-PROCEED-USE      TO L656-AMT-PROCD-CTR.          
            MOVE WS-SER-CONTRA-TOTAL            TO L656-AMT-TOT-CTR.            
                                                                                
            STRING F410-DTE-SO-EXECUTION(7:2) '/'                               
                   F410-DTE-SO-EXECUTION(5:2) '/'                               
                   F410-DTE-SO-EXECUTION(1:4) DELIMITED BY SIZE                 
                   INTO L656-TP-DATE.                                           
                                                                                
            MOVE '-'                           TO DD1 DD2 DD3                   
                                                  D1 D2.                        
            MOVE F410-SCHEME                   TO L656-SCHEME.                  
            MOVE F410-ACC                      TO L656-ACC.                     
            MOVE F410-CHK                      TO L656-CDG.                     
            MOVE F410-LESSEE-CODE              TO L656-ACC-TYPE.                
            MOVE F000-NUM-SCH-ACC(1:4)         TO L656-SER-SCHEME.              
            MOVE F000-NUM-SCH-ACC(5:4)         TO L656-SER-ACC.                 
            MOVE F000-NUM-SCH-ACC(9:1)         TO L656-SER-CDG.                 
                                                                                
      *--> RETRIEVE ADDRESS USING F410-SCHEME-ACCT.                             
            MOVE    SPACES             TO   BP13COMM8-REC                       
                                            WS-LINK-REC.                        
            INITIALIZE                      BP13COMM8-REC.                      
            MOVE    F410-NUM-SCH-ACC   TO   WS-LINK-REC.                        
                                                                                
            PERFORM 6000-CALL-BP13C913  THRU 6000-EXIT.                         
            MOVE    '#'                 TO  L656-CHAR.                          
            MOVE    '-'                 TO  L656-DASH.                          
            MOVE    COMM8-NUM-UNIT-MAIN TO  L656-HSE-MAIN                       
            MOVE    COMM8-NUM-UNIT-SUB  TO  L656-HSE-SUB.                       
            MOVE    COMM8-NUM-BLK       TO  L656-BLKNO.                         
            MOVE    COMM8-NME-STREET    TO  L656-STREET-NAME.                   
            MOVE    COMM8-NUM-LEVEL     TO  L656-LEVEL.                         
                                                                                
      *--> RETRIEVE ADDRESS USING F000-SCHEME-ACCT.                             
            MOVE    SPACES             TO   BP13COMM8-REC                       
                                            WS-LINK-REC.                        
            INITIALIZE                      BP13COMM8-REC.                      
                                                                                
            MOVE    F000-NUM-SCH-ACC(1:9) TO   WS-LINK-REC.                     
                                                                                
            PERFORM 6000-CALL-BP13C913  THRU 6000-EXIT.                         
            MOVE    '#'                 TO  L656-SER-CHAR.                      
            MOVE    '-'                 TO  L656-SER-DASH.                      
            MOVE    COMM8-NUM-UNIT-MAIN TO  L656-SER-HSE-MAIN                   
            MOVE    COMM8-NUM-UNIT-SUB  TO  L656-SER-HSE-SUB.                   
            MOVE    COMM8-NUM-BLK       TO  L656-SER-BLKNO.                     
            MOVE    COMM8-NME-STREET    TO  L656-SER-STREET-NAME.               
            MOVE    COMM8-NUM-LEVEL     TO  L656-SER-LEVEL.                     
                                                                                
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL AFTER 2.                       
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL1.                              
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL2.                              
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL2A.                             
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL2B.                             
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL2C.                             
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL2D.                             
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE FROM L656-PR-DETAIL3.                              
            MOVE  SPACES                TO  PRINT-LINE.                         
            WRITE PRINT-LINE.                                                   
            ADD 8 TO WS-CNT.                                                    
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------*                                                     
       6000-CALL-BP13C913.                                                      
      *-------------------*                                                     
           CALL 'BP13C913'     USING  WS-LINK-REC,                              
                                      BP13COMM8-REC.                            
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0                                          
              MOVE COMM8-CDE-SYSERR TO SQL-CODE                                 
              DISPLAY 'SCHEME-ACCT-NO = ' WS-LINK-REC                           
              IF COMM8-CDE-SYSERR = 100                                         
                 DISPLAY 'SCH-ACC NOT FOUND INF PBF TABLE   ' SQL-CODE          
              ELSE                                                              
                 DISPLAY 'ERROR IN READING PBF TABLE   ' SQL-CODE.              
                                                                                
       6000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       7000-READ-K120.                                                          
      *---------------------------------------------------------------*         
                                                                                
           MOVE SPACES                            TO BP17K120-REC.              
           INITIALIZE                                BP17K120-REC.              
                                                                                
           MOVE F000-NUM-SCH-ACC                  TO K120-KEY-FLD.              
                                                                                
           READ BP17K120.                                                       
                                                                                
           EVALUATE WS-K120-STATUS                                              
               WHEN 00                                                          
                    IF K120-AMT-CREAM-OFF NOT NUMERIC                           
                       MOVE ZEROES            TO K120-AMT-CREAM-OFF             
                    END-IF                                                      
                                                                                
               WHEN 23                                                          
                    MOVE ZEROES               TO K120-AMT-CREAM-OFF             
                                                                                
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP17K120 : ' WS-K120-STATUS          
                            ' KEY = ' K120-KEY-FLD                              
                    PERFORM  9000-FINALIZATION       THRU 9000-EXIT             
           END-EVALUATE.                                                        
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       7500-WRITE-SMS.                                                          
      ******************************************************************        
           MOVE SPACES                        TO AB03F123-REC.                  
           INITIALIZE                            AB03F123-REC.                  
                                                                                
           MOVE F410-NUM-SCH-ACC              TO F123-NUM-HDB-REF.              
           MOVE F410-CDE-BO                   TO F123-CDE-BO.                   
           MOVE 'SE'                          TO F123-CDE-TRANS.                
           MOVE F410-DTE-KEY-ISSUE            TO F123-DTE-SALE-EFF.             
                                                                                
           MOVE F000-NUM-SCH-ACC              TO F123-NUM-HDBREF-RESALE.        
                                                                                
           MOVE WS-SER-CONTRA-TOTAL           TO F123-AMT-TOTL.                 
                                                                                
           MOVE F410-AMT-SER-CONTRA-ICP       TO F123-AMT-JV.                   
                                                                                
           MOVE WS-SYS-DATE                   TO F123-DTE-UPDATE.               
                                                                                
           MOVE SPACES                        TO F123-DTE-PROPOSD               
                                                 F123-CDE-ERROR.                
                                                                                
           INSPECT AB03F123-REC REPLACING ALL LOW-VALUES BY SPACES.             
                                                                                
           WRITE AB03F123-REC.                                                  
                                                                                
           ADD 1                              TO WS-F123-CNT-WRITE.             
                                                                                
       7500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------------------------------------------*         
       8000-CHECK-NULL-FILE.                                                    
      *---------------------------------------------------------------*         
           IF WS-F410-OUTPUT = 0                                                
               MOVE  0               TO WS-CNT                                  
               ADD   1               TO WS-PAGE                                 
               MOVE  WS-PAGE         TO PRINT-PAGE                              
               MOVE  WS-EDIT-DATE    TO PRINT-DATE                              
               WRITE PRINT-LINE FROM L656-PR-HEAD-01 AFTER PAGE                 
               WRITE PRINT-LINE FROM L656-PR-HEAD-02                            
               WRITE PRINT-LINE FROM L656-PR-HEAD-03                            
               WRITE PRINT-LINE FROM L656-PR-HEAD-04 AFTER 2                    
               WRITE PRINT-LINE FROM L656-PR-HEAD-05                            
               MOVE  SPACES                TO  PRINT-LINE                       
               WRITE PRINT-LINE                                                 
               WRITE PRINT-LINE FROM L656-PR-DETAIL4                            
           END-IF.                                                              
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       9000-FINALIZATION.                                                       
      *---------------------------------------------------------------*         
             DISPLAY '*-----------  BP13C656  ------------*'.                   
             DISPLAY ' F410-READ      ' WS-F410-READ.                           
             DISPLAY ' F000-READ      ' WS-F000-READ.                           
             DISPLAY ' MATCH          ' WS-MATCH.                               
             DISPLAY ' F410-NOT-MT    ' WS-F410-NOTMATCH.                       
             DISPLAY ' F000-NOT-MT    ' WS-F000-NOTMATCH.                       
             DISPLAY ' F410-OUTPUT    ' WS-F410-OUTPUT.                         
             DISPLAY ' NO. OF REC WRITTEN IN F123 = '                           
                                        WS-F123-CNT-WRITE.                      
                                                                                
             CLOSE     BP13F410                                                 
                       BP17F000                                                 
                       BP17K120                                                 
                       AB03F123                                                 
                       BP13L656.                                                
                                                                                
            IF WS-K120-STATUS NOT = 00 AND 97                                   
               DISPLAY 'BP17K120 - ERROR CLOSING : ' WS-K120-STATUS             
            END-IF.                                                             
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
