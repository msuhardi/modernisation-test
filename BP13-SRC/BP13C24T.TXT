      *--------------------------------------------------------------*          
       IDENTIFICATION DIVISION.                                                 
      *--------------------------------------------------------------*          
       PROGRAM-ID.    BP13C24T.                                                 
      *AUTHOR.        ELAINE S ARGA.                                            
      *DATE-WRITTEN.  04 JUNE 2014.                                             
      *--------------------------------------------------------------*          
      *                                                              *          
      *    SYSTEM NAME : SYSTEM OF COMMITMENT  (SOC)                 *          
      *                                                              *          
      *    SYSTEM ID   : BP13                                        *          
      *                                                              *          
      *    OBJECTIVES :  UPDATE K230-NUM-PARENT-FT                   *          
      *                                                              *          
      *    INPUT FILES  : BP13F230                                   *          
      *                   BM06K110                                   *          
      *                   BP13KQ50                                   *          
      *    I-O          : BP13K230                                   *          
      *--------------------------------------------------------------*          
      * CHG-NO  BY   DATE     DETAILS                                *          
      *-------- ---- -------- ---------------------------------------*          
      *BP135404 ESA1 31082010 NEW PGM                                *          
      *BP137581 ESA1 20122018 BYPASS SBF AND NUM-RP = 'Y' IN UPDATE  *          
      *BP138905 EL27 17012021 INCLUDE GRO WARDS IN THE MOVING        *          
      *-------- ---- -------- ---------------------------------------*          
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F230 ASSIGN TO BP13F230.                                  
                                                                                
           SELECT BP13K230 ASSIGN TO BP13K230                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K230-KEY-FLD                               
                  FILE STATUS     IS WS-K230-STATUS.                            
                                                                                
           SELECT BP13KQ50 ASSIGN TO BP13KQ50                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS KQ50-KEY-FLD                               
                  FILE STATUS     IS WS-KQ50-STATUS.                            
                                                                                
           SELECT BM06K110 ASSIGN TO BM06K110                                   
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K110-KEY-FLD                               
                  FILE STATUS     IS WS-K110-STATUS                             
                  ACCESS MODE     IS RANDOM.                                    
                                                                                
           SELECT BP13L24T ASSIGN TO BP13L24T.                                  
                                                                                
      *--------------------------------------------------------------*          
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *--------------------------------------------------------------*          
                                                                                
       FD   BP13F230                                                            
            RECORD CONTAINS 450 CHARACTERS                                      
            RECORDING MODE  IS F.                                               
       01  F230-DETAIL-REC.                                                     
           05  F230-CDE-INTV            PIC X(04).                              
           05  F230-CDE-DETAIL          PIC X(02).                              
           05  F230-DTE-ALLOC           PIC X(08).                              
           05  F230-ALT-KEY1.                                                   
               10  F230-DTE-ACCEPT      PIC X(08).                              
               10  F230-TME-ACCEPT      PIC X(07).                              
               10  F230-NUM-NEW-TOWN    PIC X(20).                              
               10  F230-NUM-FLAT-TYPE   PIC X(02).                              
               10  F230-NUM-BLK         PIC X(05).                              
               10  F230-NUM-LEVEL       PIC X(02).                              
               10  F230-NUM-UNIT        PIC X(05).                              
           05  F230-KEY-FLD.                                                    
               10  F230-NUM-SCH-ACC     PIC X(11).                              
           05  F230-NUM-ACCEPT          PIC X(01).                              
           05  F230-NUM-CAT             PIC X(01).                              
           05  FILLER                   PIC X(20).                              
           05  F230-NUM-ZONE            PIC X(10).                              
           05  F230-NUM-BALANCE         PIC X(01).                              
           05  F230-NUM-SELECTION       PIC X(3).                               
           05  FILLER                   PIC X(3).                               
           05  F230-NUM-PARENT-FT       PIC X(2).                               
           05  F230-NUM-RP              PIC X(1).                               
           05  F230-DTE-BALLOT          PIC X(6).                               
           05  F230-NUM-USERID          PIC X(08).                              
           05  F230-ALT-KEY2.                                                   
               10  F230-NUM-SELECTION2  PIC X(3).                               
               10  F230-NUM-ZONE2       PIC X(10).                              
               10  F230-NUM-NEW-TOWN2   PIC X(20).                              
               10  F230-NUM-FLAT-TYPE2  PIC X(09).                              
               10  F230-NUM-DESIGN2     PIC X(04).                              
               10  F230-NUM-BLK2        PIC X(05).                              
               10  F230-NUM-UNIT2       PIC X(05).                              
               10  F230-NUM-LEVEL2      PIC X(02).                              
           05  F230-HOLD-INFO.                                                  
               10  F230-NUM-HOLD            PIC X(01).                          
               10  F230-NUM-USERID-HOLD     PIC X(08).                          
               10  F230-DTE-HOLD            PIC X(08).                          
               10  F230-TME-HOLD            PIC X(08).                          
           05  F230-NUM-BONUS           PIC X(01).                              
           05  F230-NUM-SPRQUOTA-TAG    PIC X(01).                              
           05  F230-NUM-REGN-HOLD       PIC X(08).                              
           05  F230-NUM-QUEUE-HOLD      PIC X(05).                              
           05  FILLER                   PIC X(08).                              
           05  F230-CDE-MODL-DESG       PIC X(02).                              
           05  F230-NUM-DESIGN          PIC X(04).                              
           05  F230-ALT-KEY4.                                                   
               10  F230-NUM-SELECTION4  PIC X(3).                               
               10  F230-NUM-NEW-TOWN4   PIC X(20).                              
               10  F230-NUM-FLAT-TYPE4  PIC X(09).                              
               10  F230-NUM-NEIGH4      PIC X(04).                              
               10  F230-NUM-CNTRCT4     PIC X(04).                              
               10  F230-NUM-BLK4        PIC X(05).                              
               10  F230-NUM-UNIT4       PIC X(05).                              
               10  F230-NUM-LEVEL4      PIC X(02).                              
           05  F230-ALT-KEY3.                                                   
               10  F230-NUM-SELECTION3  PIC X(3).                               
               10  F230-NUM-ZONE3       PIC X(10).                              
               10  F230-NUM-NEW-TOWN3   PIC X(20).                              
               10  F230-NUM-FLAT-TYPE3  PIC X(09).                              
               10  F230-NUM-BLK3        PIC X(05).                              
               10  F230-NUM-UNIT3       PIC X(05).                              
               10  F230-NUM-LEVEL3      PIC X(02).                              
           05  F230-QTY-AREA-TOTAL      PIC S9(7)V9(2).                         
           05  F230-CURR-SELLING-PRICE  PIC 9(8).                               
           05  FILLER                   PIC X(85).                              
                                                                                
       FD   BP13KQ50                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13KQ50.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BP13K230                                                            
            RECORD CONTAINS 450 CHARACTERS.                                     
       COPY BP13K230.                                                           
                                                                                
       FD   BP13L24T                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 200 CHARACTERS                                      
            LABEL RECORDS ARE STANDARD.                                         
       01   L24T-PRTREC.                                                        
            05  L24T-SNO                PIC ZZZZ9.                              
            05  FIL01                   PIC X(01).                              
            05  L24T-SCH-ACC            PIC X(11).                              
            05  FIL02                   PIC X(01).                              
            05  L24T-NUM-ESTATE         PIC X(03).                              
            05  FIL03                   PIC X(01).                              
            05  L24T-NME-ESTATE         PIC X(20).                              
            05  FIL04                   PIC X(01).                              
            05  L24T-NUM-NGHBRD         PIC X(05).                              
            05  FIL05                   PIC X(01).                              
            05  L24T-NUM-CNTRCT         PIC X(06).                              
            05  FIL06                   PIC X(01).                              
            05  L24T-NUM-BLOCK          PIC X(05).                              
            05  FIL07                   PIC X(01).                              
            05  L24T-NUM-LEVEL          PIC X(05).                              
            05  FIL08                   PIC X(01).                              
            05  L24T-NUM-MAIN           PIC X(04).                              
            05  FIL09                   PIC X(01).                              
            05  L24T-DTE-BALLOT         PIC X(10).                              
            05  FIL10                   PIC X(01).                              
            05  L24T-SEL-TYPE           PIC X(08).                              
            05  FIL11                   PIC X(01).                              
            05  L24T-NUM-MGPS-B         PIC X(06).                              
            05  FIL12                   PIC X(01).                              
            05  L24T-NUM-MGPS-A         PIC X(06).                              
            05  FIL13                   PIC X(01).                              
            05  L24T-NUM-PARENT-FT-B    PIC X(11).                              
            05  FIL14                   PIC X(01).                              
            05  L24T-NUM-PARENT-FT-A    PIC X(11).                              
            05  FIL15                   PIC X(01).                              
            05  L24T-NUM-GRO-WARD-B     PIC X(06).                              
            05  FIL16                   PIC X(01).                              
            05  L24T-NUM-GRO-WARD-A     PIC X(06).                              
            05  FILLER                  PIC X(56).                              
                                                                                
      *--------------------------------------------------------------*          
       WORKING-STORAGE SECTION.                                                 
      *--------------------------------------------------------------*          
                                                                                
       01  WS-FILE-CONTROLS.                                                    
           05  WS-F230-EOF                PIC X(1)  VALUE 'N'.                  
           05  WS-K230-EOF                PIC X(1)  VALUE 'N'.                  
                                                                                
           05  WS-K230-STATUS             PIC 9(2)  VALUE 0.                    
           05  WS-KQ50-STATUS             PIC 9(2)  VALUE 0.                    
           05  WS-K110-STATUS             PIC 9(2)  VALUE 0.                    
           05  WS-CNT-F230-READ           PIC 9(8)  VALUE 0.                    
           05  WS-CNT-K230-UPD            PIC 9(8)  VALUE 0.                    
           05  WS-CNT-L24T-WRITE          PIC 9(8)  VALUE 0.                    
           05  WS-CNT-K230-NTFND          PIC 9(8)  VALUE 0.                    
           05  WS-CNT-KQ50-NTFND          PIC 9(8)  VALUE 0.                    
           05  WS-CNT-KQ50-FND            PIC 9(8)  VALUE 0.                    
           05  WS-CNT-K110-NTFND          PIC 9(8)  VALUE 0.                    
                                                                                
       01  WS-MISCELLANEOUS-VARS.                                               
           05 WS-EDITED-DATE              PIC X(10) VALUE SPACES.               
           05 WS-RIGHT-JUST-TXT           PIC X(04) VALUE SPACES.               
           05 WS-LEFT-JUST-TXT            PIC X(04) VALUE SPACES.               
           05 WS-CTR1                     PIC 9(02) VALUE ZEROES.               
           05 WS-CTR2                     PIC 9(02) VALUE ZEROES.               
           05 WS-ESTATE                   PIC X(03) VALUE SPACES.               
           05 WS-NEIGH                    PIC X(04) VALUE SPACES.               
           05 WS-CNTRCT                   PIC X(04) VALUE SPACES.               
           05 WS-NUM-RP                   PIC X(01) VALUE SPACES.               
           05 WS-PARENT-FT                PIC X(02) VALUE SPACES.               
           05 WS-GRO-WARD                 PIC X(03) VALUE SPACES.               
           05 WS-SNO                      PIC 9(05) VALUE ZEROES.               
                                                                                
       01  WS-SYSTEM-DATE.                                                      
           05  WS-SYS-CCYY                PIC 9(4).                             
           05  WS-SYS-MM                  PIC 9(2).                             
           05  WS-SYS-DD                  PIC 9(2).                             
                                                                                
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR CONTROL LISTING                         *            
      *------------------------------------------------------------*            
       01  L24T-HDG1.                                                           
           05  L24T-LISTING             PIC X(14) VALUE 'BP13L24T'.             
           05  FILLER                   PIC X(8)  VALUE 'HDB3'.                 
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(39) VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'DATE: '.               
           05  L24T-DATE                PIC X(10) VALUE SPACES.                 
                                                                                
       01  L24T-HDG2.                                                           
           05  FILLER                   PIC X(35) VALUE SPACES.                 
           05  FILLER                   PIC X(50) VALUE                         
               ' CONTROL LIST FOR UPDATE OF PARENT FLAT TYPE'.                  
                                                                                
       01  L24T-HDG3.                                                           
           05  FILLER              PIC X(05)  VALUE 'S/NO '.                    
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(11)  VALUE 'SCH-ACC '.                 
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(03)  VALUE 'EST'.                      
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(20)  VALUE 'EST NAME'.                 
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(05)  VALUE 'NEIGH'.                    
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(06)  VALUE 'CNTRCT'.                   
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(05)  VALUE 'BLOCK'.                    
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(05)  VALUE 'LEVEL'.                    
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(04)  VALUE 'UNIT'.                     
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(10)  VALUE 'DTE-BALLOT'.               
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(08)  VALUE 'SEL-TYPE'.                 
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(06)  VALUE 'MGPS-B'.                   
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(06)  VALUE 'MGPS-A'.                   
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(11)  VALUE 'PARENT-FT-B'.              
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(11)  VALUE 'PARENT-FT-A'.              
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(06)  VALUE 'WARD-B'.                   
           05  FILLER              PIC X(01)  VALUE ';'.                        
           05  FILLER              PIC X(06)  VALUE 'WARD-A'.                   
           05  FILLER              PIC X(56)  VALUE SPACES.                     
                                                                                
      *--------------------------------------------------------------*          
       PROCEDURE DIVISION.                                                      
      *--------------------------------------------------------------*          
                                                                                
      *--------------------------------------------------------------*          
       0000-MAIN-ROUTINE.                                                       
      *--------------------------------------------------------------*          
                                                                                
           PERFORM 1000-OPEN-ROUTINE      THRU 1000-EXIT.                       
                                                                                
           PERFORM 1200-READ-F230         THRU 1200-EXIT.                       
                                                                                
           PERFORM 2000-PROCESS           THRU 2000-EXIT                        
                UNTIL WS-F230-EOF = 'Y'.                                        
                                                                                
           PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------------*          
       1000-OPEN-ROUTINE.                                                       
      *--------------------------------------------------------------*          
                                                                                
           OPEN INPUT  BP13F230                                                 
                       BP13KQ50                                                 
                       BM06K110                                                 
                I-O    BP13K230                                                 
                OUTPUT BP13L24T.                                                
                                                                                
           IF WS-K230-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K230 ERROR ' WS-K230-STATUS                  
              MOVE     WS-K230-STATUS      TO RETURN-CODE                       
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KQ50-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KQ50 ERROR ' WS-KQ50-STATUS                  
              MOVE     WS-KQ50-STATUS      TO RETURN-CODE                       
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BM06K110 ERROR ' WS-K110-STATUS                  
              MOVE     WS-KQ50-STATUS      TO RETURN-CODE                       
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-SYSTEM-DATE.                   
                                                                                
           STRING WS-SYS-DD '/' WS-SYS-MM '/' WS-SYS-CCYY                       
                  DELIMITED BY SIZE                                             
                  INTO WS-EDITED-DATE                                           
           END-STRING.                                                          
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
       1200-READ-F230.                                                          
      *--------------------------------------------------------------*          
                                                                                
           READ BP13F230                                                        
                AT END  MOVE 'Y' TO WS-F230-EOF                                 
                GO TO 1200-EXIT                                                 
           END-READ.                                                            
                                                                                
           ADD 1 TO WS-CNT-F230-READ.                                           
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
       2000-PROCESS.                                                            
      *--------------------------------------------------------------*          
                                                                                
           MOVE SPACES             TO   WS-PARENT-FT                            
                                        WS-GRO-WARD                             
                                        WS-NUM-RP.                              
                                                                                
           PERFORM 3000-READ-K230  THRU 3000-EXIT.                              
                                                                                
           PERFORM 1200-READ-F230  THRU 1200-EXIT.                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------------*          
       3000-READ-K230.                                                          
      *--------------------------------------------------------------*          
                                                                                
           MOVE SPACES                TO K230-KEY-FLD.                          
           MOVE F230-KEY-FLD          TO K230-KEY-FLD.                          
                                                                                
           READ BP13K230.                                                       
           EVALUATE WS-K230-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                   IF K230-NUM-SELECTION = 'SBF' AND                            
                      K230-NUM-RP = 'Y'                                         
                      CONTINUE                                                  
                   ELSE                                                         
                      MOVE K230-NUM-PARENT-FT  TO WS-PARENT-FT                  
                      MOVE K230-NUM-GRO-WARD   TO WS-GRO-WARD                   
                      MOVE K230-NUM-RP         TO WS-NUM-RP                     
                      PERFORM 3150-READ-K110    THRU 3150-EXIT                  
                      PERFORM 3100-READ-KQ50    THRU 3100-EXIT                  
                      PERFORM 3200-REWRITE-K230 THRU 3200-EXIT                  
                   END-IF                                                       
              WHEN 23                                                           
                   ADD 1  TO WS-CNT-K230-NTFND                                  
                   CONTINUE                                                     
              WHEN OTHER                                                        
                   DISPLAY 'ERROR READING BP13K230. STATUS IS '                 
                           WS-K230-STATUS                                       
                   PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
       3100-READ-KQ50.                                                          
      *--------------------------------------------------------------*          
                                                                                
           PERFORM 3500-CHG-TXT-JUST  THRU 3500-EXIT.                           
           MOVE SPACES                TO KQ50-KEY-FLD.                          
           MOVE WS-ESTATE             TO KQ50-NUM-ESTATE.                       
           MOVE WS-NEIGH              TO KQ50-NUM-NGHBRD.                       
           MOVE WS-CNTRCT             TO KQ50-NUM-CNTRCT.                       
           MOVE F230-NUM-BLK4         TO KQ50-NUM-BLOCK.                        
           MOVE F230-NUM-LEVEL4       TO KQ50-NUM-LEVEL.                        
           MOVE F230-NUM-UNIT4        TO KQ50-NUM-MAIN.                         
                                                                                
           READ BP13KQ50.                                                       
           EVALUATE WS-KQ50-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                   ADD 1  TO WS-CNT-KQ50-FND                                    
                   IF K230-DTE-BALLOT = KQ50-DTE-BALLOT                         
                      IF KQ50-NUM-MGPS = ' '                                    
                         MOVE 'G'           TO K230-NUM-RP                      
                         MOVE KQ50-NUM-WARD TO K230-NUM-GRO-WARD                
                         MOVE SPACES        TO K230-NUM-PARENT-FT               
                      ELSE                                                      
                         MOVE KQ50-NUM-MGPS      TO K230-NUM-RP                 
                         MOVE SPACES             TO K230-NUM-GRO-WARD           
                         MOVE KQ50-NUM-PARENT-FT TO K230-NUM-PARENT-FT          
                      END-IF                                                    
                   ELSE                                                         
                      MOVE SPACES    TO  K230-NUM-GRO-WARD                      
                      MOVE SPACES    TO  K230-NUM-PARENT-FT                     
                      MOVE 'N'       TO  K230-NUM-RP                            
                   END-IF                                                       
              WHEN 23                                                           
                   MOVE SPACES       TO  BP13KQ50-REC                           
                   ADD 1  TO WS-CNT-KQ50-NTFND                                  
                   MOVE SPACES       TO  K230-NUM-GRO-WARD                      
                   MOVE SPACES       TO  K230-NUM-PARENT-FT                     
                   MOVE 'N'          TO  K230-NUM-RP                            
              WHEN OTHER                                                        
                   DISPLAY 'ERROR READING BP13KQ50. STATUS IS '                 
                           WS-KQ50-STATUS                                       
                   PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
       3150-READ-K110.                                                          
      *--------------------------------------------------------------*          
                                                                                
           MOVE SPACES                TO WS-ESTATE.                             
           MOVE SPACES                TO K110-KEY-FLD.                          
           MOVE F230-KEY-FLD          TO K110-KEY-FLD.                          
                                                                                
           READ BM06K110.                                                       
           EVALUATE WS-K110-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                   MOVE K110-ESTATE      TO  WS-ESTATE                          
              WHEN 23                                                           
                   ADD 1  TO WS-CNT-K110-NTFND                                  
                   CONTINUE                                                     
              WHEN OTHER                                                        
                   DISPLAY 'ERROR READING BM06K110. STATUS IS '                 
                           WS-K110-STATUS                                       
                   PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3150-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *--------------------------------------------------------------*          
       3200-REWRITE-K230.                                                       
      *--------------------------------------------------------------*          
                                                                                
           REWRITE K230-DETAIL-REC.                                             
                                                                                
           EVALUATE WS-K230-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                 ADD 1    TO WS-CNT-K230-UPD                                    
                 PERFORM 4000-WRITE-REPORT   THRU 4000-EXIT                     
               WHEN OTHER                                                       
                 DISPLAY 'ERROR UPDATING BP13K230. STATUS IS '                  
                          WS-K230-STATUS                                        
                 PERFORM 9999-CLOSE-ROUTINE  THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3500-CHG-TXT-JUST.                                                       
      *---------------------------------------------------------------*         
           MOVE SPACES             TO WS-RIGHT-JUST-TXT                         
                                      WS-LEFT-JUST-TXT                          
                                      WS-NEIGH.                                 
           MOVE F230-NUM-NEIGH4    TO WS-RIGHT-JUST-TXT.                        
           PERFORM 3600-RIGHT-JUSTIFY-TXT   THRU 3600-EXIT.                     
           MOVE WS-LEFT-JUST-TXT  TO WS-NEIGH.                                  
                                                                                
           MOVE SPACES             TO WS-RIGHT-JUST-TXT                         
                                      WS-LEFT-JUST-TXT                          
                                      WS-CNTRCT.                                
           MOVE F230-NUM-CNTRCT4   TO WS-RIGHT-JUST-TXT.                        
           PERFORM 3600-RIGHT-JUSTIFY-TXT   THRU 3600-EXIT.                     
           MOVE WS-LEFT-JUST-TXT  TO WS-CNTRCT.                                 
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3600-RIGHT-JUSTIFY-TXT.                                                  
      *---------------------------------------------------------------*         
           MOVE ZEROES    TO WS-CTR2.                                           
                                                                                
           PERFORM VARYING WS-CTR1 FROM 1 BY 1 UNTIL WS-CTR1 > 4                
              IF WS-RIGHT-JUST-TXT(WS-CTR1:1) NOT = SPACES                      
                 ADD 1  TO WS-CTR2                                              
                 MOVE WS-RIGHT-JUST-TXT(WS-CTR1:1) TO                           
                      WS-LEFT-JUST-TXT(WS-CTR2:1)                               
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------------*          
       4000-WRITE-REPORT.                                                       
      *--------------------------------------------------------------*          
           ADD  1               TO WS-SNO.                                      
                                                                                
           IF WS-SNO = 1                                                        
              MOVE WS-EDITED-DATE TO L24T-DATE                                  
              MOVE SPACES       TO L24T-PRTREC                                  
              WRITE L24T-PRTREC  FROM L24T-HDG1                                 
              MOVE SPACES       TO L24T-PRTREC                                  
              WRITE L24T-PRTREC  FROM L24T-HDG2                                 
              MOVE SPACES       TO L24T-PRTREC                                  
              WRITE L24T-PRTREC  FROM L24T-HDG3                                 
           END-IF.                                                              
                                                                                
           MOVE SPACES          TO L24T-PRTREC.                                 
           MOVE ';'             TO FIL01  FIL02  FIL03                          
                                   FIL04  FIL05  FIL06                          
                                   FIL07  FIL08  FIL09                          
                                   FIL10  FIL11  FIL12                          
                                   FIL13  FIL14  FIL15                          
                                   FIL16.                                       
           MOVE WS-SNO             TO  L24T-SNO.                                
           MOVE K230-NUM-SCH-ACC   TO  L24T-SCH-ACC.                            
           MOVE KQ50-NUM-ESTATE    TO  L24T-NUM-ESTATE.                         
           MOVE F230-NUM-NEW-TOWN  TO  L24T-NME-ESTATE.                         
           MOVE KQ50-NUM-NGHBRD    TO  L24T-NUM-NGHBRD.                         
           MOVE KQ50-NUM-CNTRCT    TO  L24T-NUM-CNTRCT.                         
           MOVE KQ50-NUM-BLOCK     TO  L24T-NUM-BLOCK.                          
           MOVE KQ50-NUM-LEVEL     TO  L24T-NUM-LEVEL.                          
           MOVE KQ50-NUM-MAIN      TO  L24T-NUM-MAIN.                           
           MOVE K230-DTE-BALLOT    TO  L24T-DTE-BALLOT.                         
           MOVE K230-NUM-SELECTION TO  L24T-SEL-TYPE.                           
           MOVE WS-NUM-RP          TO  L24T-NUM-MGPS-B.                         
           MOVE K230-NUM-RP        TO  L24T-NUM-MGPS-A.                         
           MOVE WS-PARENT-FT       TO  L24T-NUM-PARENT-FT-B.                    
           MOVE K230-NUM-PARENT-FT TO  L24T-NUM-PARENT-FT-A.                    
           MOVE WS-GRO-WARD        TO  L24T-NUM-GRO-WARD-B.                     
           MOVE K230-NUM-GRO-WARD  TO  L24T-NUM-GRO-WARD-A.                     
                                                                                
           ADD  1                TO WS-CNT-L24T-WRITE.                          
           WRITE L24T-PRTREC.                                                   
                                                                                
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *--------------------------------------------------------------*          
       9999-CLOSE-ROUTINE.                                                      
      *--------------------------------------------------------------*          
                                                                                
           CLOSE BP13F230                                                       
                 BP13KQ50                                                       
                 BM06K110                                                       
                 BP13K230                                                       
                 BP13L24T.                                                      
                                                                                
           EVALUATE WS-K230-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-K230-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BP13K230 FAIL. STATUS=' WS-K230-STATUS          
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-KQ50-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-KQ50-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BP13KQ50 FAIL. STATUS=' WS-KQ50-STATUS          
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K110-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-K110-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BM06K110 FAIL. STATUS=' WS-K110-STATUS          
           END-EVALUATE.                                                        
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '********* BP13C24T CONTROL ******************'.             
           DISPLAY 'DATE : ' WS-EDITED-DATE.                                    
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF READ (BP13F230) = ' WS-CNT-F230-READ.                
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECORDS NT FND  ='.                                  
           DISPLAY '    (BP13K230)         = ' WS-CNT-K230-NTFND.               
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECORDS NT FND  ='.                                  
           DISPLAY '    (BP13KQ50)         = ' WS-CNT-KQ50-NTFND.               
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECORDS FND     ='.                                  
           DISPLAY '    (BP13KQ50)         = ' WS-CNT-KQ50-FND.                 
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECORDS NT FND  ='.                                  
           DISPLAY '    (BM06K110)         = ' WS-CNT-K110-NTFND.               
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECS UPDATED    = '.                                 
           DISPLAY '    (BP13K230)         = ' WS-CNT-K230-UPD.                 
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF RECS WRITTEN    = '.                                 
           DISPLAY '    (BP13L24T)         = ' WS-CNT-L24T-WRITE.               
           DISPLAY 'PLS REFER TO BP13.L24T.PFT.RPT FOR DETAILS'.                
           DISPLAY '*********************************************'.             
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***************** E N D  O F  P R O G R A M *****************             
