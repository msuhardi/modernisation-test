       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C371.                                         00020000
      *AUTHOR.        KAVYA.                                            00030000
      *DATE-WRITTEN.  09 JUNE 2019.                                     00040000
      * ======================================================== *      00050000
      * SYSTEM OF COMMITMENT (BP13)                              *      00060000
      * ======================================================== *      00070000
      *    OBJECTIVE  :                                          *      00080000
      *      1.  CREATE F208 XML FILE                            *      00090000
      *                                                          *      00100000
      *     INPUT FILES:                                         *      00110000
      *           1. BP13F800                                    *      00120000
      *           2. BP13K022                                    *      00130000
      *           3. BP13K820                                    *      00140000
      *           4. SY02F001                                    *      00150000
      *                                                          *      00160000
      *     OUTPUT FILES:                                        *      00170000
      *           1. BP13F208                                    *      00180000
      * -------------------------------------------------------- *      00190000
      *  CHG NO     DATE     BY   DESCRIPTION                    *      00200000
      * -------- ----------  ---- ------------------------------ *      00210000
      * BP137632 09/07/2019  KV5  NEW PROGRAM                    *      00220000
      * BP137632 19/09/2019  KAC1 TO ADD SPECIAL APPOINTMENT TAG *      00230000
      * BP137632 30/09/2019  KAC1 ADD LOOP TO SHOW ALL APPL 1-4  *      00240000
      *                      KAC1 COMMENTED-OUT CALL TO BP13C913 *      00250000
      * BP138002 14/10/2019  KAC1 ADDED READING OF BP13K454 TO - *      00260000
      *                           DECODE APPT-TYPE, CONTRA-TYPE &*      00270000
      *                           CHECK FOR LOAN-TAG = 'B'       *      00280000
      * BP137874 24/10/2019  KAC1 ADDED CHECK FOR BP13K480       *      00290000
      * BP137632 11/11/2019  KTM3 ADDED CHECK FOR CL & CA        *      00300000
      * BP137632 12/06/2020  KTM3 ADDED CHECK FOR WT/WP(SELF BK) *      00310000
      * BP138701 24/06/2021  KV8  INCLUDED APPT TYPE 'PL' INSTEAD*      00311004
      *                           OF 'SP' & 'SL' AND CHANGED     *      00312005
      *                           CONTRA DU TO DT                *      00313005
      ************************************************************      00320000
                                                                        00330000
       ENVIRONMENT DIVISION.                                            00340000
       CONFIGURATION SECTION.                                           00350000
      *-------------------------------------------------------------    00360000
       SOURCE-COMPUTER. IBM-3090.                                       00370000
       OBJECT-COMPUTER. IBM-3090.                                       00380000
                                                                        00390000
       INPUT-OUTPUT SECTION.                                            00400000
       FILE-CONTROL.                                                    00410000
      *-------------------------------------------------------------    00420000
                                                                        00430000
           SELECT BP13F800  ASSIGN        TO  BP13F800.                 00440000
                                                                        00450000
           SELECT SY02F001  ASSIGN        TO  SY02F001.                 00460000
                                                                        00470000
           SELECT BP13F208  ASSIGN        TO  BP13F208                  00480000
                            FILE STATUS IS F208-STATUS.                 00490000
                                                                        00500000
           SELECT BP13F290  ASSIGN        TO  BP13F290                  00510000
                            FILE STATUS IS F290-STATUS.                 00520000
                                                                        00530000
           SELECT BP13K454  ASSIGN        TO  BP13K454                  00540000
                            ORGANIZATION  IS  INDEXED                   00550000
                            ACCESS MODE   IS  RANDOM                    00560000
                            RECORD KEY    IS  K454-KEY-FLD              00570000
                            ALTERNATE RECORD KEY IS K454-ALT1-KEY       00580000
                            FILE STATUS   IS  K454-STATUS.              00590000
                                                                        00600000
           SELECT BP13K820  ASSIGN        TO  BP13K820                  00610000
                            ORGANIZATION  IS  INDEXED                   00620000
                            ACCESS MODE   IS  RANDOM                    00630000
                            RECORD KEY    IS  K820-KEY-FLD              00640000
                            FILE STATUS   IS  K820-STATUS.              00650000
                                                                        00660000
           SELECT BP13K022  ASSIGN        TO  BP13K022                  00670000
                            ORGANIZATION  IS  INDEXED                   00680000
                            ACCESS MODE   IS  RANDOM                    00690000
                            RECORD KEY    IS  K022-KEY-FLD              00700000
                            ALTERNATE RECORD KEY IS  K022-NUM-REGN      00710000
                            FILE STATUS   IS  K022-STATUS.              00720000
                                                                        00730000
           SELECT BP13K480  ASSIGN       TO BP13K480                    00740000
                            ORGANIZATION IS INDEXED                     00750000
                            ACCESS MODE  IS RANDOM                      00760000
                            RECORD KEY   IS K480-KEY-FLD                00770000
                            FILE STATUS  IS K480-STATUS.                00780000
                                                                        00790000
       DATA DIVISION.                                                   00800000
       FILE SECTION.                                                    00810000
      *-------------------------------------------------------------    00820000
                                                                        00830000
       FD   BP13F800                                                    00840000
            BLOCK  CONTAINS 0   RECORDS                                 00850000
            LABEL  RECORDS  ARE STANDARD                                00860000
            RECORDING MODE  IS  F                                       00870000
            RECORD CONTAINS 2000  CHARACTERS.                           00880000
       COPY BP13F800.                                                   00890000
                                                                        00900000
       COPY SY02F001.                                                   00910000
                                                                        00920000
       FD   BP13F208                                                    00930000
            BLOCK CONTAINS 0 RECORDS                                    00940000
            RECORD CONTAINS 150 CHARACTERS                              00950000
            LABEL RECORDS ARE STANDARD                                  00960000
            RECORDING MODE IS F.                                        00970000
       01   BP13F208-REC                  PIC X(150).                   00980000
                                                                        00990000
       FD  BP13F290                                                     01000000
           BLOCK  CONTAINS 0 RECORDS                                    01010000
           RECORD CONTAINS 100 CHARACTERS                               01020000
           LABEL RECORD IS STANDARD                                     01030000
           RECORDING MODE IS F.                                         01040000
       COPY BP13F290.                                                   01050000
                                                                        01060000
       FD   BP13K454                                                    01070000
            RECORD CONTAINS 100 CHARACTERS.                             01080000
       COPY BP13K454.                                                   01090000
                                                                        01100000
       FD   BP13K820                                                    01110000
            RECORD CONTAINS 400 CHARACTERS.                             01120000
       COPY BP13K820.                                                   01130000
                                                                        01140000
       FD   BP13K022                                                    01150000
            RECORD CONTAINS 100 CHARACTERS.                             01160000
       COPY BP13K022.                                                   01170000
                                                                        01180000
       FD   BP13K480                                                    01190000
            RECORD CONTAINS 1000 CHARACTERS.                            01200000
       COPY BP13K480.                                                   01210000
                                                                        01220000
      *------------------------------------------------------------*    01230000
       WORKING-STORAGE SECTION.                                         01240000
      *-------------------------------------------------------------    01250000
       01  WS-INDICATORS.                                               01260000
           05  WS-EOF-F800                PIC X       VALUE 'N'.        01270000
           05  WS-EOF-F001                PIC X       VALUE 'N'.        01280000
           05  K454-STATUS                PIC 9(2)    VALUE  00.        01290000
           05  K820-STATUS                PIC 9(2)    VALUE  00.        01300000
           05  K022-STATUS                PIC 9(2)    VALUE  00.        01310000
           05  K480-STATUS                PIC 9(2)    VALUE  00.        01320000
           05  F208-STATUS                PIC 9(2)    VALUE  00.        01330000
           05  F290-STATUS                PIC 9(2)    VALUE  00.        01340000
                                                                        01350000
       01  WS-COUNTERS-POINTERS.                                        01360000
           05  WS-READ-CNT-F800           PIC 9(7)    VALUE ZEROS.      01370000
           05  WS-F208-BA-CNT             PIC 9(3)    VALUE ZEROS.      01380000
           05  WS-F208-LA-CNT             PIC 9(3)    VALUE ZEROS.      01390000
           05  WS-F208-SA-CNT             PIC 9(3)    VALUE ZEROS.      01400000
           05  WS-F208-SL-CNT             PIC 9(3)    VALUE ZEROS.      01410000
           05  WS-F208-SP-CNT             PIC 9(3)    VALUE ZEROS.      01420000
           05  WS-F208-SR-CNT             PIC 9(3)    VALUE ZEROS.      01430000
           05  WS-F208-TP-CNT             PIC 9(3)    VALUE ZEROS.      01440000
           05  WS-F208-TL-CNT             PIC 9(3)    VALUE ZEROS.      01450000
           05  WS-F208-TR-CNT             PIC 9(3)    VALUE ZEROS.      01460000
           05  WS-F208-WT-CNT             PIC 9(3)    VALUE ZEROS.      01470000
           05  WS-F208-WP-CNT             PIC 9(3)    VALUE ZEROS.      01480000
           05  WS-F208-PL-CNT             PIC 9(3)    VALUE ZEROS.      01490000
           05  WS-F208-PR-CNT             PIC 9(3)    VALUE ZEROS.      01500000
           05  WS-F208-BT-CNT             PIC 9(3)    VALUE ZEROS.      01510000
           05  WS-F208-BS-CNT             PIC 9(3)    VALUE ZEROS.      01520000
           05  WS-F208-BR-CNT             PIC 9(3)    VALUE ZEROS.      01530000
           05  WS-WRITE-F208              PIC 9(6)    VALUE ZEROS.      01540000
           05  WS-WRITE-F2081             PIC 9(3)    VALUE ZEROS.      01550000
           05  WS-WRITE-F290              PIC 9(6)    VALUE ZEROS.      01560000
           05  WS-MISSING-K022            PIC 9(7)    VALUE ZEROS.      01570000
           05  WS-MISSING-F820            PIC 9(7)    VALUE ZEROS.      01580000
           05  WS-MISSING-K454            PIC 9(7)    VALUE ZEROS.      01590000
           05  WS-MISSING-K480            PIC 9(7)    VALUE ZEROS.      01600000
           05  WS-MISSING-PIDB            PIC 9(7)    VALUE ZEROS.      01610000
           05  WS-INTEGER-DTE-SO-APPT     PIC S9(9)   VALUE ZEROS.      01620000
           05  WS-INTEGER-DTE-2ND-CONLOAN PIC S9(9)   VALUE ZEROS.      01630000
           05  WS-INTEGER-DTE-SUBTRANSFER PIC S9(9)   VALUE ZEROS.      01640000
           05  WS-INTEGER-DTE-AO-APPT     PIC S9(9)   VALUE ZEROS.      01650000
           05  WS-INTEGER-DTE-BK-APPT     PIC S9(9)   VALUE ZEROS.      01660000
           05  WS-INTEGER-DTE-SL-APPT     PIC S9(9)   VALUE ZEROS.      01670000
           05  WS-INTEGER-CUR-DATE1       PIC S9(9)   VALUE ZEROS.      01680000
           05  WS-INTEGER-CUR-DATE4       PIC S9(9)   VALUE ZEROS.      01690000
           05  WS-DATE-CHECK              PIC X(8)    VALUE SPACES.     01700000
           05  WS-INVALID                 PIC X       VALUE 'N'.        01710000
           05  WS-K480-FND                PIC X       VALUE 'N'.        01720000
           05  WS-F800-DTE-SO-APPT        PIC X(8).                     01730000
           05  WS-F800-DTE-SO-APPT-9 REDEFINES WS-F800-DTE-SO-APPT      01740000
                                          PIC 9(8).                     01750000
           05  WS-F800-DTE-2ND-CONLOAN    PIC X(8).                     01760000
           05  WS-F800-DTE-2ND-CONLOAN-9 REDEFINES                      01770000
               WS-F800-DTE-2ND-CONLOAN    PIC 9(8).                     01780000
           05  WS-F800-DTE-SUBTRANSFER    PIC X(8).                     01790000
           05  WS-F800-DTE-SUBTRANSFER-9 REDEFINES                      01800000
               WS-F800-DTE-SUBTRANSFER    PIC 9(8).                     01810000
           05  WS-F800-DTE-AO-APPT        PIC X(8).                     01820000
           05  WS-F800-DTE-AO-APPT-9 REDEFINES WS-F800-DTE-AO-APPT      01830000
                                          PIC 9(8).                     01840000
           05  WS-F800-DTE-BK-APPT        PIC X(8).                     01850000
           05  WS-F800-DTE-BK-APPT-9 REDEFINES WS-F800-DTE-BK-APPT      01860000
                                          PIC 9(8).                     01870000
           05  WS-F800-DTE-SL-APPT        PIC X(8).                     01880000
           05  WS-F800-DTE-SL-APPT-9 REDEFINES WS-F800-DTE-SL-APPT      01890000
                                          PIC 9(8).                     01900000
                                                                        01910000
       01  WS-TIME-APPT                   PIC X(4).                     01920000
       01  WS-DATE                        PIC X(8).                     01930000
       01  WS-DATE9 REDEFINES WS-DATE     PIC 9(8).                     01940000
       01  WS-NAME-OCC                    PIC X(66)   VALUE SPACES.     01950000
       01  WS-FILLER.                                                   01960000
           05  WS-NRIC OCCURS 4 TIMES.                                  01970000
               10 WS-NUM-NRIC             PIC X(9)    VALUE SPACES.     01980000
                                                                        01990000
       01  WS-COUTERS.                                                  02000000
           05 IDX1                        PIC 9(01)   VALUE ZERO.       02010000
                                                                        02020000
       01  LINK-VARIABLES.                                              02030000
           05 WS-LINK-REC.                                              02040000
              10 WS-IN-OPTION          PIC X(02).                       02050000
              10 WS-IN-GEN.                                             02060000
                 15 WS-IN-DATE         PIC X(08).                       02070000
              10 WS-RET-GEN.                                            02080000
                 15 WS-RETURN          PIC X(03).                       02090000
                                                                        02100000
       COPY F206XML.                                                    02110000
       COPY P13COMM8.                                                   02120000
                                                                        02130000
       01  LINK-REC.                                                    02140000
           05  LINK-NUM-SCH-ACC.                                        02150000
               10  LINK-NUM-SCH             PIC X(4).                   02160000
               10  LINK-NUM-ACC             PIC X(5).                   02170000
                                                                        02180000
       01  WS-VARS.                                                     02190000
           05  XML-DECLARATION         PIC X(38) VALUE                  02200000
               '<?xml version="1.0" encoding="UTF-8"?>'.                02210000
           05  XML-OPEN                PIC X(09) VALUE '<apntmts>'.     02220000
           05  XML-CLOSE               PIC X(10) VALUE '</apntmts>'.    02230000
           05  CSTMRS-OPEN             PIC X(10) VALUE '<cstmrs>'.      02240000
           05  CSTMRS-CLOSE            PIC X(11) VALUE '</cstmrs>'.     02250000
           05  CUSTOMER-OPEN           PIC X(10) VALUE '<cstmr>'.       02260000
           05  CUSTOMER-CLOSE          PIC X(11) VALUE '</cstmr>'.      02270000
           05  ADDRESS-OPEN            PIC X(06) VALUE '<adrs>'.        02280000
           05  ADDRESS-CLOSE           PIC X(07) VALUE '</adrs>'.       02290000
           05  RCRD-OPEN               PIC X(06) VALUE '<rcrd>'.        02300000
           05  RCRD-CLOSE              PIC X(07) VALUE '</rcrd>'.       02310000
           05  BLOCK-DETAILS.                                           02320000
               10 BLOCK-OPEN           PIC X(07) VALUE '<block>'.       02330000
               10 WS-BLOCK             PIC X(05) VALUE SPACES.          02340000
               10 BLOCK-CLOSE          PIC X(08) VALUE '</block>'.      02350000
           05  UNIT-DETAILS.                                            02360000
               10 UNIT-OPEN            PIC X(06) VALUE '<unit>'.        02370000
               10 WS-UNIT              PIC X(07) VALUE SPACES.          02380000
               10 UNIT-CLOSE           PIC X(07) VALUE '</unit>'.       02390000
                                                                        02400000
       01  WRITE-REC                   PIC X(80) VALUE SPACES.          02410000
      *------------------------------------------------------------*    02420000
       PROCEDURE DIVISION.                                              02430000
      *------------------------------------------------------------*    02440000
       000-MAIN.                                                        02450000
      *------------------------------------------------------------*    02460000
           INITIALIZE C221-TAGS                                         02470000
           PERFORM  100-OPEN-FILES        THRU   100-EXIT.              02480000
           PERFORM  150-READ-SY02F001     THRU   150-EXIT               02490000
           PERFORM  200-READ-BP13F800     THRU   200-EXIT.              02500000
           WRITE BP13F208-REC FROM XML-DECLARATION                      02510000
           MOVE SPACES              TO BP13F208-REC                     02520000
           WRITE BP13F208-REC FROM XML-OPEN                             02530000
                                                                        02540000
           MOVE SPACES              TO WRITE-REC                        02550000
           MOVE 'CREATE'            TO action                           02560000
           XML GENERATE WRITE-REC FROM action                           02570000
           WRITE BP13F208-REC FROM WRITE-REC                            02580000
                                                                        02590000
           PERFORM  300-PROCESS-F800      THRU   300-EXIT               02600000
                        UNTIL WS-EOF-F800 = 'Y'                         02610000
                                                                        02620000
           MOVE SPACES              TO WRITE-REC                        02630000
           MOVE WS-WRITE-F208       TO rcrds                            02640000
           XML GENERATE WRITE-REC FROM rcrds                            02650000
           WRITE BP13F208-REC FROM WRITE-REC                            02660000
                                                                        02670000
           WRITE BP13F208-REC FROM XML-CLOSE                            02680000
                                                                        02690000
           PERFORM  9999-CLOSE-ROUTINE    THRU   9999-EXIT.             02700000
                                                                        02710000
       000-EXIT.                                                        02720000
           EXIT.                                                        02730000
                                                                        02740000
      *-------------------------------------------------------------    02750000
       100-OPEN-FILES.                                                  02760000
      *-------------------------------------------------------------    02770000
           OPEN INPUT  BP13F800                                         02780000
                       SY02F001                                         02790000
                       BP13K454                                         02800000
                       BP13K820                                         02810000
                       BP13K022                                         02820000
                       BP13K480                                         02830000
                OUTPUT BP13F208                                         02840000
                       BP13F290.                                        02850000
                                                                        02860000
           IF K454-STATUS NOT = 00 AND 97                               02870000
              DISPLAY 'BP13K454 - OPEN ERROR, K454-STATUS ' K454-STATUS 02880000
              MOVE     K454-STATUS      TO       RETURN-CODE            02890000
              PERFORM  9999-CLOSE-ROUTINE.                              02900000
                                                                        02910000
           IF K820-STATUS NOT = 00 AND 97                               02920000
              DISPLAY 'BP13K820 - OPEN ERROR, K820-STATUS ' K820-STATUS 02930000
              MOVE     K820-STATUS      TO       RETURN-CODE            02940000
              PERFORM  9999-CLOSE-ROUTINE.                              02950000
                                                                        02960000
           IF K022-STATUS NOT = 00 AND 97                               02970000
              DISPLAY 'BP13K022 - OPEN ERROR, K022-STATUS ' K022-STATUS 02980000
              MOVE     K022-STATUS      TO       RETURN-CODE            02990000
              PERFORM  9999-CLOSE-ROUTINE.                              03000000
                                                                        03010000
           IF K480-STATUS NOT = 00 AND 97                               03020000
              DISPLAY 'BP13K480 - OPEN ERROR, K480-STATUS ' K480-STATUS 03030000
              MOVE     K480-STATUS      TO       RETURN-CODE            03040000
              PERFORM  9999-CLOSE-ROUTINE.                              03050000
                                                                        03060000
           MOVE ZEROS                       TO WS-COUNTERS-POINTERS.    03070000
                                                                        03080000
       100-EXIT.                                                        03090000
           EXIT.                                                        03100000
                                                                        03110000
      *-------------------------------------------------------------    03120000
       150-READ-SY02F001.                                               03130000
      *-------------------------------------------------------------    03140000
           READ SY02F001                                                03150000
                AT END MOVE 'Y'         TO     WS-EOF-F001              03160000
                       GO TO 150-EXIT.                                  03170000
                                                                        03180000
           MOVE F001-DTE-CURRENT TO WS-DATE.                            03190000
                                                                        03200000
           COMPUTE WS-INTEGER-CUR-DATE1 =                               03210000
              FUNCTION INTEGER-OF-DATE(WS-DATE9) + 1                    03220000
           COMPUTE WS-INTEGER-CUR-DATE4 =                               03230000
              FUNCTION INTEGER-OF-DATE(WS-DATE9) + 3.                   03240000
                                                                        03250000
       150-EXIT.                                                        03260000
           EXIT.                                                        03270000
                                                                        03280000
      *-------------------------------------------------------------    03290000
       200-READ-BP13F800.                                               03300000
      *-------------------------------------------------------------    03310000
           READ BP13F800                                                03320000
                AT END MOVE 'Y'         TO     WS-EOF-F800              03330000
                       GO TO 200-EXIT.                                  03340000
                                                                        03350000
           ADD     1                    TO     WS-READ-CNT-F800.        03360000
           INITIALIZE C221-TAGS WS-BLOCK WS-UNIT                        03370000
                                                                        03380000
           IF F800-DTE-SO-APPT NOT = SPACES AND LOW-VALUES AND          03390000
                                     ZEROES AND                         03400000
             (F800-DTE-SO-APPT >= F800-DTE-2ND-CONC-LOAN-APPT) AND      03410000
             (F800-DTE-SO-APPT >= F800-DTE-SUB-TRANSFER-APPT)  AND      03420000
             (F800-DTE-SO-APPT >= F800-DTE-SL-APPT)            AND      03430000
             (F800-DTE-SO-APPT >= F800-DTE-AO-APPT)                     03440000
              MOVE 'N'                  TO  WS-INVALID                  03450000
              MOVE F800-DTE-SO-APPT     TO  WS-DATE-CHECK               03460000
              PERFORM 500-VALIDATE-DATE     THRU  500-EXIT              03470000
              IF WS-INVALID = 'Y'                                       03480000
                 DISPLAY 'REGN: ' F800-NUM-REGN                         03490000
                         '  SO-APPT: ' F800-DTE-SO-APPT                 03500000
                 MOVE ZEROES  TO F800-DTE-SO-APPT                       03510000
              END-IF                                                    03520000
           ELSE                                                         03530000
              IF F800-DTE-2ND-CONC-LOAN-APPT NOT = SPACES AND LOW-VALUES03540000
                                                   AND ZEROES AND       03550000
                (F800-DTE-2ND-CONC-LOAN-APPT >=                         03560000
                                      F800-DTE-SUB-TRANSFER-APPT) AND   03570000
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-SL-APPT) AND   03580000
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-AO-APPT)       03590000
                 MOVE 'N'                  TO  WS-INVALID               03600000
                 MOVE F800-DTE-2ND-CONC-LOAN-APPT TO WS-DATE-CHECK      03610000
                 PERFORM 500-VALIDATE-DATE     THRU  500-EXIT           03620000
                 IF WS-INVALID = 'Y'                                    03630000
                    DISPLAY 'REGN: ' F800-NUM-REGN                      03640000
                            '  2ND-CONC-LOAN: '                         03650000
                            F800-DTE-2ND-CONC-LOAN-APPT                 03660000
                    MOVE ZEROES  TO F800-DTE-2ND-CONC-LOAN-APPT         03670000
                 END-IF                                                 03680000
              ELSE                                                      03690000
                 IF F800-DTE-SUB-TRANSFER-APPT NOT = SPACES AND         03700000
                                           LOW-VALUES AND ZEROES AND    03710000
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-SL-APPT) AND 03720000
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-AO-APPT)     03730000
                    MOVE 'N'                  TO  WS-INVALID            03740000
                    MOVE F800-DTE-SUB-TRANSFER-APPT  TO WS-DATE-CHECK   03750000
                    PERFORM 500-VALIDATE-DATE     THRU  500-EXIT        03760000
                    IF WS-INVALID = 'Y'                                 03770000
                       DISPLAY 'REGN: ' F800-NUM-REGN                   03780000
                               ' SUB-TRANSFER-APPT: '                   03790000
                               F800-DTE-SUB-TRANSFER-APPT               03800000
                       MOVE ZEROES  TO F800-DTE-SUB-TRANSFER-APPT       03810000
                    END-IF                                              03820000
                 ELSE                                                   03830000
                    IF F800-DTE-SL-APPT NOT = SPACES AND LOW-VALUES AND 03840000
                                              ZEROES AND                03850000
                      (F800-DTE-SL-APPT >= F800-DTE-AO-APPT)            03860000
                       MOVE 'N'                  TO  WS-INVALID         03870000
                       MOVE F800-DTE-SL-APPT     TO  WS-DATE-CHECK      03880000
                       PERFORM 500-VALIDATE-DATE     THRU  500-EXIT     03890000
                       IF WS-INVALID = 'Y'                              03900000
                          DISPLAY 'REGN: ' F800-NUM-REGN                03910000
                                  '  SL-APPT: ' F800-DTE-SL-APPT        03920000
                          MOVE ZEROES   TO F800-DTE-SL-APPT             03930000
                       END-IF                                           03940000
                    ELSE                                                03950000
                       IF F800-DTE-AO-APPT NOT = SPACES AND LOW-VALUES  03960000
                                                 AND ZEROES             03970000
                          MOVE 'N'                  TO  WS-INVALID      03980000
                          MOVE F800-DTE-AO-APPT     TO  WS-DATE-CHECK   03990000
                          PERFORM 500-VALIDATE-DATE     THRU  500-EXIT  04000000
                          IF WS-INVALID = 'Y'                           04010000
                             DISPLAY 'REGN: ' F800-NUM-REGN             04020000
                                     '  AO-APPT: ' F800-DTE-AO-APPT     04030000
                             MOVE ZEROES   TO F800-DTE-AO-APPT          04040000
                          END-IF                                        04050000
                       ELSE                                             04060000
                          IF F800-DTE-BK-APPT-MGPS NOT = SPACES AND     04070000
                                                LOW-VALUES AND ZEROES   04080000
                             MOVE 'N'                   TO  WS-INVALID  04090000
                             MOVE F800-DTE-BK-APPT-MGPS TO WS-DATE-CHECK04100000
                             PERFORM 500-VALIDATE-DATE   THRU  500-EXIT 04110000
                             IF WS-INVALID = 'Y'                        04120000
                                DISPLAY 'REGN: ' F800-NUM-REGN          04130000
                                        '  BK-APPT-MGPS: '              04140000
                                        F800-DTE-BK-APPT-MGPS           04150000
                                MOVE ZEROES   TO F800-DTE-BK-APPT-MGPS  04160000
                             END-IF                                     04170000
                          ELSE                                          04180000
                             IF F800-DTE-BK-APPT NOT = SPACES AND       04190000
                                             LOW-VALUES AND ZEROES      04200000
                                MOVE 'N'               TO WS-INVALID    04210000
                                MOVE F800-DTE-BK-APPT  TO WS-DATE-CHECK 04220000
                                PERFORM 500-VALIDATE-DATE  THRU 500-EXIT04230000
                                IF WS-INVALID = 'Y'                     04240000
                                   DISPLAY 'REGN: ' F800-NUM-REGN       04250000
                                           '  BK-APPT: '                04260000
                                           F800-DTE-BK-APPT             04270000
                                   MOVE ZEROES   TO F800-DTE-BK-APPT    04280000
                                END-IF                                  04290000
                             END-IF                                     04300000
                          END-IF                                        04310000
                       END-IF                                           04320000
                    END-IF                                              04330000
                 END-IF                                                 04340000
              END-IF                                                    04350000
           END-IF.                                                      04360000
                                                                        04370000
       200-EXIT.                                                        04380000
           EXIT.                                                        04390000
                                                                        04400000
      *-------------------------------------------------------------    04410000
       300-PROCESS-F800.                                                04420000
      *-------------------------------------------------------------    04430000
           MOVE SPACES TO BP13F208-REC.                                 04440000
           INITIALIZE BP13F208-REC.                                     04450000
           MOVE 'SALES'              TO  dptmnt.                        04460000
      *KAC1 MOVE F800-CDE-APPT-TYPE   TO  queuePFx.                     04470000
      *KAC1 MOVE F800-CDE-APPT-TYPE   TO  srvc.                         04480000
                                                                        04490000
           MOVE SPACES                 TO BP13K454-REC                  04500000
                                          queuePFx                      04510000
                                          srvc.                         04520000
           INITIALIZE                     BP13K454-REC.                 04530000
           MOVE F800-CDE-APPT-TYPE     TO K454-CDE-APPT-TYPE.           04540000
                                                                        04550000
     **FOR SELF BOOK***                                                 04560000
     **K454 KEEPS AS SP/TP FOR WP/WT CASES**                            04570000
           IF F800-CDE-APPT-TYPE = 'WP'                                 04580000
              MOVE 'SP'                TO K454-CDE-APPT-TYPE            04590000
           ELSE                                                         04600000
           IF F800-CDE-APPT-TYPE = 'WT'                                 04610000
              MOVE 'TP'                TO K454-CDE-APPT-TYPE            04620000
           END-IF.                                                      04630000
                                                                        04640000
           MOVE F800-NUM-REGN          TO K454-NUM-REGN.                04650000
           PERFORM 305-READ-BP13K454 THRU 305-EXIT.                     04660000
                                                                        04670000
           IF F800-NUM-LOAN-TAG = 'B'                                   04680000
                EVALUATE K454-CDE-APPT-TYPE                             04690000
                    WHEN 'SA'                                           04700000
                         EVALUATE K454-CDE-SUB-APPT-TYPE                04710000
                             WHEN 'A'                                   04720000
                                  MOVE 'BA'   TO queuePFx               04730000
                                                 srvc                   04740000
                             WHEN 'S'                                   04750000
                                  MOVE 'BS'   TO queuePFx               04760000
                                                 srvc                   04770000
                         END-EVALUATE                                   04780000
                    WHEN 'TP'                                           04790000
                         EVALUATE K454-CDE-SUB-APPT-TYPE                04800000
                             WHEN 'T'                                   04810000
                                  MOVE 'BT'   TO queuePFx               04820000
                                                 srvc                   04830000
                             WHEN 'R'                                   04840000
                                  MOVE 'BR'   TO queuePFx               04850000
                                                 srvc                   04860000
                         END-EVALUATE                                   04870000
                    WHEN OTHER                                          04880000
                         MOVE K454-CDE-APPT-TYPE  TO queuePFx           04890000
                                                     srvc               04900000
                END-EVALUATE                                            04910000
           ELSE                                                         04920000
               MOVE K454-CDE-APPT-TYPE        TO queuePFx               04930000
                                                 srvc                   04940000
           END-IF.                                                      04950000
                                                                        04960000
     **CHECK K480 START***                                              04970000
           MOVE 'N'                           TO WS-K480-FND.           04980000
           MOVE SPACES                        TO BP13K480-REC.          04990000
           INITIALIZE                            BP13K480-REC.          05000000
           MOVE F800-NUM-REGN                 TO K480-NUM-REGN.         05010000
           PERFORM 306-READ-BP13K480        THRU 306-EXIT.              05020000
                                                                        05030000
           IF WS-K480-FND = 'Y'                                         05040000
              EVALUATE K480-NUM-CONTRA-TYPE                             05050000
                  WHEN 'TM'                                             05060000
                       IF F800-CDE-APPT-TYPE = 'TP'                     05070000
                          MOVE 'TM'              TO srvc queuePFx       05080000
                       END-IF                                           05090000
                  WHEN 'PM'                                             05100000
                       IF F800-CDE-APPT-TYPE = 'SP'                     05110000
                          MOVE 'PM'              TO srvc queuePFx       05120000
                       END-IF                                           05130000
                  WHEN 'TU'                                             05140000
      *           WHEN 'DU'                                             05150000
                  WHEN 'DT'                                             05160000
                       IF F800-NUM-BUY-SELL-TAG = 'B'                   05170000
                          IF F800-CDE-APPT-TYPE = 'TP' OR 'TL'          05180000
                             MOVE 'CL'           TO srvc queuePFx       05190000
                          ELSE                                          05200000
      *                     IF F800-CDE-APPT-TYPE = 'SP' OR 'SL'        05210001
                            IF F800-CDE-APPT-TYPE = 'PL'                05211001
                               MOVE 'CA'         TO srvc queuePFx       05220000
                            END-IF                                      05230000
                          END-IF                                        05240000
                       ELSE                                             05250000
                         IF F800-CDE-APPT-TYPE = 'TP'                   05260000
                            MOVE 'CT'            TO srvc queuePFx       05270000
                         ELSE                                           05280000
                          IF F800-CDE-APPT-TYPE = 'SP'                  05290000
                             MOVE 'CP'              TO srvc queuePFx    05300000
                          END-IF                                        05310000
                         END-IF                                         05320000
                       END-IF                                           05330000
      *           WHEN 'CP'                                             05340000
      *                IF F800-CDE-APPT-TYPE = 'SP'                     05350000
      *                   MOVE 'CP'              TO srvc queuePFx       05360000
      *                END-IF                                           05370000
              END-EVALUATE                                              05380000
           END-IF.                                                      05390000
      **CHECK K480 END****                                              05400000
                                                                        05410000
     **CHECK SELF BOOK***                                               05420000
     **ONCE HQMS IS READY, NEED TO UPDATE SP TO WP**                    05430000
           IF K454-CDE-APPT = 'W'                                       05440000
              IF K454-CDE-APPT-TYPE = 'SP'                              05450000
                 MOVE 'SP'                      TO queuePFx             05460000
                                                   srvc                 05470000
              ELSE                                                      05480000
              IF K454-CDE-APPT-TYPE = 'TP'                              05490000
                 MOVE 'WT'                      TO queuePFx             05500000
                                                   srvc                 05510000
              END-IF                                                    05520000
           END-IF.                                                      05530000
                                                                        05540000
           MOVE F800-NUM-NEW-TOWN    TO  townCode.                      05550000
           MOVE F800-NUM-FLAT-TYPE   TO  flatType.                      05560000
           MOVE F800-DTE-BALLOT      TO  ballotDate.                    05570000
           MOVE F800-NUM-SPECIAL-APPT TO  SpclRqstTag.                  05580000
           MOVE F800-NUM-ALLO-CAT    TO  slctType.                      05590000
           MOVE F800-DTE-REGN        TO  rgstrtnDate                    05600000
           MOVE F800-NUM-REGN        TO  rfrnc.                         05610000
           MOVE 'APPLICANT'          TO  role.                          05620000
                                                                        05630000
           MOVE F800-NUM-NRIC1       TO WS-NUM-NRIC(1).                 05640000
           MOVE F800-NUM-NRIC2       TO WS-NUM-NRIC(2).                 05650000
           MOVE F800-NUM-NRIC3       TO WS-NUM-NRIC(3).                 05660000
           MOVE F800-NUM-NRIC4       TO WS-NUM-NRIC(4).                 05670000
                                                                        05680000
           IF F800-DTE-SO-APPT NOT = SPACES AND LOW-VALUES AND ZEROES   05690000
                                     AND                                05700000
             (F800-DTE-SO-APPT >= F800-DTE-2ND-CONC-LOAN-APPT)  AND     05710000
             (F800-DTE-SO-APPT >= F800-DTE-SUB-TRANSFER-APPT)   AND     05720000
             (F800-DTE-SO-APPT >= F800-DTE-SL-APPT)             AND     05730000
             (F800-DTE-SO-APPT >= F800-DTE-AO-APPT)                     05740000
              MOVE F800-DTE-SO-APPT  TO  WS-F800-DTE-SO-APPT            05750000
              COMPUTE WS-INTEGER-DTE-SO-APPT =                          05760000
                 FUNCTION INTEGER-OF-DATE(WS-F800-DTE-SO-APPT-9)        05770000
              IF WS-INTEGER-DTE-SO-APPT >= WS-INTEGER-CUR-DATE1 AND     05780000
                 WS-INTEGER-DTE-SO-APPT <= WS-INTEGER-CUR-DATE4         05790000
                 IF F800-DTE-AO-APPT = SPACES OR LOW-VALUES OR ZEROES   05800000
      *             MOVE 'SP'  TO  srvc                                 05810000
                    MOVE F800-DTE-SO-APPT TO apntmtDate                 05820000
                    MOVE F800-TME-SO-APPT TO WS-TIME-APPT               05830000
                    PERFORM 310-WRITE-F208 THRU 310-EXIT                05840000
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                05850000
                 ELSE                                                   05860000
      *             MOVE 'TP  '  TO  srvc                               05870000
                    MOVE F800-DTE-SO-APPT TO apntmtDate                 05880000
                    MOVE F800-TME-SO-APPT TO WS-TIME-APPT               05890000
                    PERFORM 310-WRITE-F208 THRU 310-EXIT                05900000
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                05910000
                 END-IF                                                 05920000
              END-IF                                                    05930000
           ELSE                                                         05940000
              IF F800-DTE-2ND-CONC-LOAN-APPT NOT = SPACES AND LOW-VALUES05950000
                                                   AND ZEROES AND       05960000
                (F800-DTE-2ND-CONC-LOAN-APPT >=                         05970000
                                  F800-DTE-SUB-TRANSFER-APPT)     AND   05980000
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-SL-APPT) AND   05990000
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-AO-APPT)       06000000
                 MOVE F800-DTE-2ND-CONC-LOAN-APPT                       06010000
                                       TO WS-F800-DTE-2ND-CONLOAN       06020000
                 COMPUTE WS-INTEGER-DTE-2ND-CONLOAN =                   06030000
                   FUNCTION INTEGER-OF-DATE(WS-F800-DTE-2ND-CONLOAN-9)  06040000
                 IF WS-INTEGER-DTE-2ND-CONLOAN >= WS-INTEGER-CUR-DATE1  06050000
                    AND                                                 06060000
                    WS-INTEGER-DTE-2ND-CONLOAN <= WS-INTEGER-CUR-DATE4  06070000
      *             MOVE 'LA  '           TO srvc                       06080000
                    MOVE F800-DTE-2ND-CONC-LOAN-APPT TO apntmtDate      06090000
                    MOVE F800-TME-2ND-CONC-LOAN-APPT TO WS-TIME-APPT    06100000
                    PERFORM 310-WRITE-F208 THRU 310-EXIT                06110000
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                06120000
                 END-IF                                                 06130000
              ELSE                                                      06140000
                 IF F800-DTE-SUB-TRANSFER-APPT  NOT = SPACES AND        06150000
                                                  LOW-VALUES AND ZEROES 06160000
                                                AND                     06170000
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-SL-APPT) AND 06180000
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-AO-APPT)     06190000
                    MOVE F800-DTE-SUB-TRANSFER-APPT                     06200000
                                             TO WS-F800-DTE-SUBTRANSFER 06210000
                    COMPUTE WS-INTEGER-DTE-SUBTRANSFER =                06220000
                    FUNCTION INTEGER-OF-DATE(WS-F800-DTE-SUBTRANSFER-9) 06230000
                    IF WS-INTEGER-DTE-SUBTRANSFER >=                    06240000
                       WS-INTEGER-CUR-DATE1 AND                         06250000
                       WS-INTEGER-DTE-SUBTRANSFER <=                    06260000
                       WS-INTEGER-CUR-DATE4                             06270000
      *                MOVE 'TR  '           TO srvc                    06280000
                       MOVE F800-DTE-SUB-TRANSFER-APPT TO               06290000
                                                      apntmtDate        06300000
                       MOVE F800-TME-SUB-TRANSFER-APPT TO               06310000
                                                      WS-TIME-APPT      06320000
                       PERFORM 310-WRITE-F208 THRU 310-EXIT             06330000
                       PERFORM 400-WRITE-F290 THRU 400-EXIT             06340000
                    END-IF                                              06350000
                 ELSE                                                   06360000
                    IF F800-DTE-SL-APPT NOT = SPACES AND LOW-VALUES     06370000
                                              AND ZEROES AND            06380000
                      (F800-DTE-SL-APPT >= F800-DTE-AO-APPT)            06390000
                       MOVE F800-DTE-SL-APPT TO WS-F800-DTE-SL-APPT     06400000
                       COMPUTE WS-INTEGER-DTE-SL-APPT =                 06410000
                       FUNCTION INTEGER-OF-DATE                         06420000
                                (WS-F800-DTE-SL-APPT-9)                 06430000
                       IF WS-INTEGER-DTE-SL-APPT >=                     06440000
                          WS-INTEGER-CUR-DATE1  AND                     06450000
                          WS-INTEGER-DTE-SL-APPT <=                     06460000
                          WS-INTEGER-CUR-DATE4                          06470000
      *                   MOVE 'SL  '  TO  srvc                         06480000
                          MOVE F800-DTE-SL-APPT TO apntmtDate           06490000
                          MOVE F800-TME-SL-APPT TO WS-TIME-APPT         06500000
                          PERFORM 310-WRITE-F208   THRU 310-EXIT        06510000
                          PERFORM 400-WRITE-F290   THRU 400-EXIT        06520000
                       END-IF                                           06530000
                    ELSE                                                06540000
                       IF F800-DTE-AO-APPT NOT = SPACES AND LOW-VALUES  06550000
                                                 AND ZEROES             06560000
                          MOVE F800-DTE-AO-APPT TO  WS-F800-DTE-AO-APPT 06570000
                          COMPUTE WS-INTEGER-DTE-AO-APPT = FUNCTION     06580000
                                 INTEGER-OF-DATE(WS-F800-DTE-AO-APPT-9) 06590000
                                                                        06600000
                          IF WS-INTEGER-DTE-AO-APPT >=                  06610000
                             WS-INTEGER-CUR-DATE1 AND                   06620000
                             WS-INTEGER-DTE-AO-APPT <=                  06630000
                             WS-INTEGER-CUR-DATE4                       06640000
      *                      IF F800-NUM-ALLO-CAT = 'DBS'               06650000
      *                         MOVE 'DSNP'  TO  srvc                   06660000
      *                      ELSE                                       06670000
      *                         IF ((F800-NUM-FLAT-TYPE NOT = '1A' OR   06680000
      *                             '2A') AND F800-NUM-LOAN-TAG = 'N')  06690000
      *                            MOVE 'SOCN'  TO  srvc                06700000
      *                            MOVE 'SA  '  TO  srvc                06710000
      *                         ELSE                                    06720000
      *                            MOVE 'SOCA'  TO  srvc                06730000
      *                            MOVE 'SA  '  TO  srvc                06740000
      *                         END-IF                                  06750000
      *                      END-IF                                     06760000
                             MOVE F800-DTE-AO-APPT TO apntmtDate        06770000
                             MOVE F800-TME-AO-APPT TO WS-TIME-APPT      06780000
                                                                        06790000
                             PERFORM 310-WRITE-F208 THRU 310-EXIT       06800000
                             PERFORM 400-WRITE-F290 THRU 400-EXIT       06810000
                          END-IF                                        06820000
                       ELSE                                             06830000
                          IF F800-DTE-BK-APPT-MGPS NOT = SPACES AND     06840000
                                              LOW-VALUES AND ZEROES     06850000
                             MOVE F800-DTE-BK-APPT-MGPS                 06860000
                                        TO WS-F800-DTE-BK-APPT          06870000
                             COMPUTE WS-INTEGER-DTE-BK-APPT =           06880000
                             FUNCTION INTEGER-OF-DATE                   06890000
                                     (WS-F800-DTE-BK-APPT-9)            06900000
                             IF WS-INTEGER-DTE-BK-APPT >=               06910000
                                WS-INTEGER-CUR-DATE1  AND               06920000
                                WS-INTEGER-DTE-BK-APPT <=               06930000
                                WS-INTEGER-CUR-DATE4                    06940000
      *                         MOVE 'BK  '  TO  srvc                   06950000
                                MOVE F800-DTE-BK-APPT-MGPS              06960000
                                             TO apntmtDate              06970000
                                MOVE F800-TME-BK-APPT-MGPS              06980000
                                             TO WS-TIME-APPT            06990000
                                PERFORM 310-WRITE-F208   THRU 310-EXIT  07000000
                                PERFORM 400-WRITE-F290   THRU 400-EXIT  07010000
                             END-IF                                     07020000
                          END-IF                                        07030000
                          IF F800-DTE-BK-APPT NOT = SPACES AND          07040000
                                                  LOW-VALUES AND ZEROES 07050000
                             MOVE F800-DTE-BK-APPT TO                   07060000
                                  WS-F800-DTE-BK-APPT                   07070000
                             COMPUTE WS-INTEGER-DTE-BK-APPT =           07080000
                             FUNCTION INTEGER-OF-DATE                   07090000
                                      (WS-F800-DTE-BK-APPT-9)           07100000
                             IF WS-INTEGER-DTE-BK-APPT >=               07110000
                                WS-INTEGER-CUR-DATE1  AND               07120000
                                WS-INTEGER-DTE-BK-APPT <=               07130000
                                WS-INTEGER-CUR-DATE4                    07140000
      *                         MOVE 'BK  '  TO  srvc                   07150000
                                MOVE F800-DTE-BK-APPT TO apntmtDate     07160000
                                MOVE F800-TME-BK-APPT TO WS-TIME-APPT   07170000
                                PERFORM 310-WRITE-F208   THRU 310-EXIT  07180000
                                PERFORM 400-WRITE-F290   THRU 400-EXIT  07190000
                             END-IF                                     07200000
                          END-IF                                        07210000
                      END-IF                                            07220000
                    END-IF                                              07230000
                 END-IF                                                 07240000
              END-IF                                                    07250000
           END-IF.                                                      07260000
                                                                        07270000
           PERFORM  200-READ-BP13F800     THRU   200-EXIT.              07280000
       300-EXIT.                                                        07290000
           EXIT.                                                        07300000
                                                                        07310000
      *---------------*                                                 07320000
       305-READ-BP13K454.                                               07330000
      *---------------*                                                 07340000
           READ BP13K454 KEY IS K454-ALT1-KEY.                          07350000
                                                                        07360000
           IF K454-STATUS = 00                                          07370000
              CONTINUE                                                  07380000
           ELSE                                                         07390000
             IF K454-STATUS = 23                                        07400000
                ADD 1   TO WS-MISSING-K454                              07410000
                MOVE SPACE                    TO K454-CDE-APPT-TYPE     07420000
                                                 K454-CDE-SUB-APPT-TYPE 07430000
                DISPLAY 'BP13K454 - REC KEY NOT FOUND : ' K454-ALT1-KEY 07440000
             ELSE                                                       07450000
              DISPLAY 'K454-STATUS' K454-STATUS                         07460000
                ADD 1   TO WS-MISSING-K454                              07470000
                MOVE SPACES                   TO K454-CDE-APPT-TYPE     07480000
                                                 K454-CDE-SUB-APPT-TYPE 07490000
                DISPLAY 'ERROR READING BP13K454, KEY : ' K454-ALT1-KEY  07500000
             END-IF                                                     07510000
           END-IF.                                                      07520000
       305-EXIT.                                                        07530000
           EXIT.                                                        07540000
                                                                        07550000
      *---------------*                                                 07560000
       306-READ-BP13K480.                                               07570000
      *---------------*                                                 07580000
           READ BP13K480                                                07590000
                                                                        07600000
           EVALUATE K480-STATUS                                         07610000
               WHEN 00                                                  07620000
                    MOVE 'Y'                            TO WS-K480-FND  07630000
               WHEN 23                                                  07640000
                    ADD 1   TO WS-MISSING-K480                          07650000
                    DISPLAY 'BP13K480 - RECORD NOTFND  : ' K480-NUM-REGN07660000
               WHEN OTHER                                               07670000
                    ADD 1   TO WS-MISSING-K480                          07680000
                    DISPLAY 'BP13K480 - READERROR STAT : ' K480-STATUS  07690000
           END-EVALUATE.                                                07700000
       306-EXIT.                                                        07710000
           EXIT.                                                        07720000
                                                                        07730000
      *---------------*                                                 07740000
       310-WRITE-F208.                                                  07750000
      *---------------*                                                 07760000
           IF WS-TIME-APPT NOT = SPACES                                 07770000
              MOVE WS-TIME-APPT(1:2) TO apntmtTime(1:2)                 07780000
              MOVE WS-TIME-APPT(3:2) TO apntmtTime(4:2)                 07790000
              MOVE ':'               TO apntmtTime(3:1)                 07800000
                                        apntmtTime(6:1)                 07810000
              MOVE '.'               TO apntmtTime(9:1)                 07820000
              MOVE ZEROES            TO apntmtTime(7:2)                 07830000
                                        apntmtTime(10:3)                07840000
           END-IF                                                       07850000
                                                                        07860000
           IF srvc = 'BK' AND  F800-NUM-COMBINED-APPT = 'Y'             07870000
              MOVE 'SSA'          TO srvc                               07880000
           END-IF                                                       07890000
                                                                        07900000
           IF srvc = 'BK' AND  F800-NUM-ALLO-SCHEME = 'FSH'             07910000
              MOVE 'FSH'          TO srvc                               07920000
           END-IF                                                       07930000
                                                                        07940000
           IF srvc = 'BK'                                               07950000
              MOVE 'SLN'          TO srvc                               07960000
           END-IF                                                       07970000
                                                                        07980000
           PERFORM 330-GET-OIC         THRU 330-EXIT.                   07990000
                                                                        08000000
      *    IF srvc NOT = 'BK' AND 'SLN' AND 'FSH' AND 'SSA'             08010000
      *       PERFORM 340-GET-ADDRESS  THRU 340-EXIT                    08020000
      *    END-IF                                                       08030000
                                                                        08040000
           MOVE SPACES              TO BP13F208-REC                     08050000
           WRITE BP13F208-REC FROM RCRD-OPEN                            08060000
                                                                        08070000
           MOVE SPACES              TO WRITE-REC                        08080000
           XML GENERATE WRITE-REC FROM dptmnt                           08090000
           WRITE BP13F208-REC FROM WRITE-REC                            08100000
                                                                        08110000
           MOVE SPACES              TO WRITE-REC                        08120000
           XML GENERATE WRITE-REC FROM srvc                             08130000
           WRITE BP13F208-REC FROM WRITE-REC                            08140000
                                                                        08150000
           MOVE SPACES              TO WRITE-REC                        08160000
           XML GENERATE WRITE-REC FROM apntmtDate                       08170000
           WRITE BP13F208-REC FROM WRITE-REC                            08180000
                                                                        08190000
           MOVE SPACES              TO WRITE-REC                        08200000
           XML GENERATE WRITE-REC FROM apntmtTime                       08210000
           WRITE BP13F208-REC FROM WRITE-REC                            08220000
                                                                        08230000
           MOVE SPACES              TO WRITE-REC                        08240000
           XML GENERATE WRITE-REC FROM rgstrtnDate                      08250000
           WRITE BP13F208-REC FROM WRITE-REC                            08260000
                                                                        08270000
           MOVE SPACES              TO WRITE-REC                        08280000
           XML GENERATE WRITE-REC FROM rfrnc                            08290000
           WRITE BP13F208-REC FROM WRITE-REC                            08300000
                                                                        08310000
           MOVE SPACES              TO BP13F208-REC                     08320000
           WRITE BP13F208-REC FROM CSTMRS-OPEN                          08330000
                                                                        08340000
      **===LOOP TO SHOW APPL 1-4=======**                               08350000
           MOVE ZEROES TO IDX1                                          08360000
           PERFORM VARYING IDX1 FROM 1 BY 1                             08370000
             UNTIL WS-NUM-NRIC(IDX1) = SPACES OR LOW-VALUES             08380000
                OR IDX1 >= 4                                            08390000
                                                                        08400000
                PERFORM 320-GET-OCCP-NAMES  THRU 320-EXIT               08410000
                                                                        08420000
                MOVE SPACES              TO BP13F208-REC                08430000
                WRITE BP13F208-REC FROM CUSTOMER-OPEN                   08440000
                                                                        08450000
                MOVE SPACES              TO WRITE-REC                   08460000
                XML GENERATE WRITE-REC FROM name                        08470000
                WRITE BP13F208-REC FROM WRITE-REC                       08480000
                                                                        08490000
                MOVE SPACES              TO WRITE-REC                   08500000
                XML GENERATE WRITE-REC FROM nric                        08510000
                WRITE BP13F208-REC FROM WRITE-REC                       08520000
                                                                        08530000
                MOVE SPACES              TO WRITE-REC                   08540000
                XML GENERATE WRITE-REC FROM role                        08550000
                WRITE BP13F208-REC FROM WRITE-REC                       08560000
                                                                        08570000
                MOVE SPACES              TO WRITE-REC                   08580000
                XML GENERATE WRITE-REC FROM cntct                       08590000
                WRITE BP13F208-REC FROM WRITE-REC                       08600000
                                                                        08610000
                MOVE SPACES              TO BP13F208-REC                08620000
                WRITE BP13F208-REC FROM CUSTOMER-CLOSE                  08630000
           END-PERFORM                                                  08640000
                                                                        08650000
                MOVE SPACES              TO BP13F208-REC                08660000
                WRITE BP13F208-REC FROM CSTMRS-CLOSE                    08670000
                                                                        08680000
           MOVE SPACES              TO WRITE-REC                        08690000
           XML GENERATE WRITE-REC FROM OIC                              08700000
           WRITE BP13F208-REC FROM WRITE-REC                            08710000
                                                                        08720000
           PERFORM 360-READ-APPT-TYPE THRU 360-EXIT                     08730000
                                                                        08740000
           MOVE SPACES              TO WRITE-REC                        08750000
           XML GENERATE WRITE-REC FROM queuePFx                         08760000
           WRITE BP13F208-REC FROM WRITE-REC                            08770000
                                                                        08780000
           MOVE WS-WRITE-F2081      to queuePstn                        08790000
           DISPLAY ' WS-WRITE-F2081' WS-WRITE-F2081                     08800000
                                                                        08810000
           MOVE SPACES              TO WRITE-REC                        08820000
           XML GENERATE WRITE-REC FROM queuePstn                        08830000
           WRITE BP13F208-REC FROM WRITE-REC                            08840000
                                                                        08850000
           MOVE SPACES              TO WRITE-REC                        08860000
           XML GENERATE WRITE-REC FROM townCode                         08870000
           WRITE BP13F208-REC FROM WRITE-REC                            08880000
                                                                        08890000
           MOVE SPACES              TO WRITE-REC                        08900000
           XML GENERATE WRITE-REC FROM flatType                         08910000
           WRITE BP13F208-REC FROM WRITE-REC                            08920000
                                                                        08930000
           MOVE SPACES              TO WRITE-REC                        08940000
           XML GENERATE WRITE-REC FROM slctType                         08950000
           WRITE BP13F208-REC FROM WRITE-REC                            08960000
                                                                        08970000
           MOVE SPACES              TO WRITE-REC                        08980000
           XML GENERATE WRITE-REC FROM ballotDate                       08990000
           WRITE BP13F208-REC FROM WRITE-REC                            09000000
                                                                        09010000
           MOVE SPACES              TO WRITE-REC                        09020000
           XML GENERATE WRITE-REC FROM SpclRqstTag                      09030000
           WRITE BP13F208-REC FROM WRITE-REC                            09040000
                                                                        09050000
           IF ((street NOT = SPACES) OR (WS-BLOCK NOT = SPACES) OR      09060000
              (level  NOT = SPACES) OR (WS-UNIT NOT = SPACES) OR        09070000
              (postalcode NOT = SPACES))                                09080000
              MOVE SPACES              TO BP13F208-REC                  09090000
              WRITE BP13F208-REC FROM ADDRESS-OPEN                      09100000
           END-IF                                                       09110000
                                                                        09120000
           IF street NOT = SPACES                                       09130000
              MOVE SPACES              TO WRITE-REC                     09140000
              XML GENERATE WRITE-REC FROM street                        09150000
              WRITE BP13F208-REC FROM WRITE-REC                         09160000
           END-IF                                                       09170000
                                                                        09180000
           MOVE SPACES              TO WRITE-REC                        09190000
           IF WS-BLOCK NOT = SPACES                                     09200000
              STRING BLOCK-OPEN, WS-BLOCK, BLOCK-CLOSE                  09210000
              DELIMITED BY SIZE                                         09220000
              INTO WRITE-REC                                            09230000
              WRITE BP13F208-REC FROM WRITE-REC                         09240000
           END-IF                                                       09250000
                                                                        09260000
           IF level NOT = SPACES                                        09270000
              MOVE SPACES              TO WRITE-REC                     09280000
              XML GENERATE WRITE-REC FROM level                         09290000
              WRITE BP13F208-REC FROM WRITE-REC                         09300000
           END-IF                                                       09310000
                                                                        09320000
           MOVE SPACES              TO WRITE-REC                        09330000
           IF WS-UNIT NOT = SPACES                                      09340000
              STRING UNIT-OPEN, WS-UNIT, UNIT-CLOSE                     09350000
              DELIMITED BY SIZE                                         09360000
              INTO WRITE-REC                                            09370000
              WRITE BP13F208-REC FROM WRITE-REC                         09380000
           END-IF                                                       09390000
                                                                        09400000
           IF postalcode NOT = SPACES                                   09410000
              MOVE SPACES              TO WRITE-REC                     09420000
              XML GENERATE WRITE-REC FROM postalcode                    09430000
              WRITE BP13F208-REC FROM WRITE-REC                         09440000
           END-IF                                                       09450000
                                                                        09460000
           IF ((street NOT = SPACES) OR (WS-BLOCK NOT = SPACES) OR      09470000
              (level  NOT = SPACES) OR (WS-UNIT  NOT = SPACES) OR       09480000
              (postalcode NOT = SPACES))                                09490000
              MOVE SPACES              TO BP13F208-REC                  09500000
              WRITE BP13F208-REC FROM ADDRESS-CLOSE                     09510000
           END-IF                                                       09520000
                                                                        09530000
           MOVE SPACES              TO BP13F208-REC                     09540000
           WRITE BP13F208-REC FROM RCRD-CLOSE                           09550000
                                                                        09560000
           ADD 1  TO WS-WRITE-F208.                                     09570000
                                                                        09580000
       310-EXIT.                                                        09590000
           EXIT.                                                        09600000
                                                                        09610000
      *-------------------*                                             09620000
       320-GET-OCCP-NAMES.                                              09630000
      *-------------------*                                             09640000
           IF WS-NUM-NRIC(IDX1) NOT = SPACES AND LOW-VALUES             09650000
              INITIALIZE BP13K820-REC                                   09660000
              MOVE F800-NUM-REGN  TO K820-NUM-REGN                      09670000
              MOVE WS-NUM-NRIC(IDX1) TO K820-NUM-NRIC                   09680000
              PERFORM 350-READ-K820  THRU 350-EXIT                      09690000
              MOVE WS-NAME-OCC          TO  name                        09700000
              MOVE WS-NUM-NRIC(IDX1)    TO  nric                        09710000
              MOVE K820-NUM-HP-PGR      TO  cntct                       09720000
           END-IF.                                                      09730000
                                                                        09740000
       320-EXIT.                                                        09750000
           EXIT.                                                        09760000
                                                                        09770000
      *--------------*                                                  09780000
       330-GET-OIC.                                                     09790000
      *--------------*                                                  09800000
           MOVE SPACES        TO K022-KEY-FLD                           09810000
           MOVE F800-NUM-REGN TO K022-NUM-REGN                          09820000
                                                                        09830000
           READ BP13K022 KEY IS K022-NUM-REGN                           09840000
                                                                        09850000
           EVALUATE K022-STATUS                                         09860000
           WHEN 00                                                      09870000
           WHEN 02                                                      09880000
                MOVE K022-NUM-OIC  TO OIC                               09890000
           WHEN 23                                                      09900000
                DISPLAY 'BP13K022 - RECORD NOT FOUND, KEY: '            09910000
                         F800-NUM-REGN                                  09920000
                MOVE SPACES        TO OIC                               09930000
                ADD 1 TO WS-MISSING-K022                                09940000
                                                                        09950000
           WHEN OTHER                                                   09960000
                DISPLAY 'BP13K022 - ERROR READING, KEY: '               09970000
                         F800-NUM-REGN                                  09980000
                MOVE SPACES        TO OIC                               09990000
                ADD 1 TO WS-MISSING-K022                                10000000
                                                                        10010000
           END-EVALUATE.                                                10020000
                                                                        10030000
       330-EXIT.                                                        10040000
           EXIT.                                                        10050000
                                                                        10060000
      *----------------*                                                10070000
      *340-GET-ADDRESS.                                                 10080000
      *----------------*                                                10090000
      *    MOVE F800-NUM-SCH-ACC          TO LINK-NUM-SCH-ACC           10100000
      *                                                                 10110000
      *    CALL 'BP13C913' USING LINK-REC, BP13COMM8-REC                10120000
      *                                                                 10130000
      *    IF COMM8-CDE-SYSERR = ZERO                                   10140000
      *       MOVE COMM8-NME-STREET       TO street                     10150000
      *       MOVE COMM8-NUM-BLK          TO WS-BLOCK                   10160000
      *       MOVE COMM8-NUM-LEVEL        TO level                      10170000
      *       MOVE COMM8-NUM-POSTAL-CODE  TO postalcode                 10180000
      *       STRING COMM8-NUM-UNIT-MAIN, COMM8-NUM-UNIT-SUB            10190000
      *              DELIMITED BY SIZE                                  10200000
      *              INTO WS-UNIT                                       10210000
      *    ELSE                                                         10220000
      *       IF COMM8-CDE-SYSERR = 100                                 10230000
      *          DISPLAY 'RECORD NOT FOUND IN PIDB: ' F800-NUM-SCH-ACC  10240000
      *          ADD 1 TO WS-MISSING-PIDB                               10250000
      *       ELSE                                                      10260000
      *          DISPLAY 'ERROR FETCHING FROM PIDB: ' F800-NUM-SCH-ACC  10270000
      *          ADD 1 TO WS-MISSING-PIDB                               10280000
      *       END-IF                                                    10290000
      *    END-IF.                                                      10300000
      *                                                                 10310000
      *340-EXIT.                                                        10320000
      *    EXIT.                                                        10330000
                                                                        10340000
      *--------------*                                                  10350000
       350-READ-K820.                                                   10360000
      *--------------*                                                  10370000
           READ BP13K820.                                               10380000
           EVALUATE K820-STATUS                                         10390000
           WHEN 00                                                      10400000
                MOVE K820-NME-OCCP TO WS-NAME-OCC                       10410000
           WHEN 23                                                      10420000
                DISPLAY 'BP13K820 - RECORD NOT FOUND, KEY: '            10430000
                         K820-NUM-REGN K820-NUM-NRIC                    10440000
                MOVE SPACES        TO WS-NAME-OCC                       10450000
                ADD 1 TO WS-MISSING-F820                                10460000
                                                                        10470000
           WHEN OTHER                                                   10480000
                DISPLAY 'BP13K820 - ERROR READING, KEY: '               10490000
                         K820-NUM-REGN K820-NUM-NRIC                    10500000
                MOVE SPACES        TO WS-NAME-OCC                       10510000
                ADD 1 TO WS-MISSING-F820                                10520000
                                                                        10530000
           END-EVALUATE.                                                10540000
                                                                        10550000
       350-EXIT.                                                        10560000
           EXIT.                                                        10570000
                                                                        10580000
      *--------------*                                                  10590000
       360-READ-APPT-TYPE.                                              10600000
      *--------------*                                                  10610000
           IF F800-CDE-APPT-TYPE = 'BA'                                 10620000
              ADD 1                          TO WS-F208-BA-CNT          10630000
              MOVE WS-F208-BA-CNT            TO WS-WRITE-F2081          10640000
           ELSE                                                         10650000
            IF F800-CDE-APPT-TYPE = 'LA'                                10660000
               ADD 1                         TO WS-F208-LA-CNT          10670000
               MOVE WS-F208-LA-CNT           TO WS-WRITE-F2081          10680000
            ELSE                                                        10690000
             IF F800-CDE-APPT-TYPE = 'SA'                               10700000
                ADD 1                        TO WS-F208-SA-CNT          10710000
                MOVE WS-F208-SA-CNT          TO WS-WRITE-F2081          10720000
             ELSE                                                       10730000
              IF F800-CDE-APPT-TYPE = 'SL'                              10740000
                 ADD 1                       TO WS-F208-SL-CNT          10750000
                 MOVE WS-F208-SL-CNT         TO WS-WRITE-F2081          10760000
              ELSE                                                      10770000
               IF F800-CDE-APPT-TYPE = 'SP'                             10780000
                  ADD 1                      TO WS-F208-SP-CNT          10790000
                  MOVE WS-F208-SP-CNT        TO WS-WRITE-F2081          10800000
               ELSE                                                     10810000
                IF F800-CDE-APPT-TYPE = 'SR'                            10820000
                   ADD 1                     TO WS-F208-SR-CNT          10830000
                   MOVE WS-F208-SR-CNT       TO WS-WRITE-F2081          10840000
                ELSE                                                    10850000
                 IF F800-CDE-APPT-TYPE = 'TP'                           10860000
                    ADD 1                    TO WS-F208-TP-CNT          10870000
                    MOVE WS-F208-TP-CNT      TO WS-WRITE-F2081          10880000
                 ELSE                                                   10890000
                  IF F800-CDE-APPT-TYPE = 'TL'                          10900000
                    ADD 1                    TO WS-F208-TL-CNT          10910000
                    MOVE WS-F208-TL-CNT      TO WS-WRITE-F2081          10920000
                  ELSE                                                  10930000
                   IF F800-CDE-APPT-TYPE = 'TR'                         10940000
                      ADD 1                  TO WS-F208-TR-CNT          10950000
                      MOVE WS-F208-TR-CNT    TO WS-WRITE-F2081          10960000
                   ELSE                                                 10970000
                    IF F800-CDE-APPT-TYPE = 'WT'                        10980000
                       ADD 1                 TO WS-F208-WT-CNT          10990000
                       MOVE WS-F208-WT-CNT   TO WS-WRITE-F2081          11000000
                    ELSE                                                11010000
                     IF F800-CDE-APPT-TYPE = 'WP'                       11020000
                        ADD 1                TO WS-F208-WP-CNT          11030000
                        MOVE WS-F208-WP-CNT  TO WS-WRITE-F2081          11040000
                     ELSE                                               11050000
                      IF F800-CDE-APPT-TYPE = 'PL'                      11060000
                         ADD 1               TO WS-F208-PL-CNT          11070000
                         MOVE WS-F208-PL-CNT TO WS-WRITE-F2081          11080000
                      ELSE                                              11090000
                       IF F800-CDE-APPT-TYPE = 'PR'                     11100000
                          ADD 1                  TO WS-F208-PR-CNT      11110000
                          MOVE WS-F208-PR-CNT    TO WS-WRITE-F2081      11120000
                       ELSE                                             11130000
                        IF F800-CDE-APPT-TYPE = 'BT'                    11140000
                           ADD 1                  TO WS-F208-BT-CNT     11150000
                           MOVE WS-F208-BT-CNT    TO WS-WRITE-F2081     11160000
                        ELSE                                            11170000
                         IF F800-CDE-APPT-TYPE = 'BS'                   11180000
                            ADD 1                  TO WS-F208-BS-CNT    11190000
                            MOVE WS-F208-BS-CNT    TO WS-WRITE-F2081    11200000
                         ELSE                                           11210000
                          IF F800-CDE-APPT-TYPE = 'BR'                  11220000
                             ADD 1                  TO WS-F208-BR-CNT   11230000
                             MOVE WS-F208-BR-CNT    TO WS-WRITE-F2081   11240000
                          END-IF                                        11250000
                         END-IF                                         11260000
                        END-IF                                          11270000
                       END-IF                                           11280000
                      END-IF                                            11290000
                     END-IF                                             11300000
                    END-IF                                              11310000
                   END-IF                                               11320000
                  END-IF                                                11330000
                 END-IF                                                 11340000
                END-IF                                                  11350000
               END-IF                                                   11360000
              END-IF                                                    11370000
             END-IF                                                     11380000
            END-IF                                                      11390000
           END-IF.                                                      11400000
                                                                        11410000
       360-EXIT.                                                        11420000
           EXIT.                                                        11430000
                                                                        11440000
      *---------------*                                                 11450000
       400-WRITE-F290.                                                  11460000
      *---------------*                                                 11470000
           MOVE F800-NUM-REGN    TO  F290-NUM-REGN.                     11480000
           IF F800-NUM-ALLO-CAT = 'BTO'                                 11490000
              MOVE F800-NUM-BTO-ZONE TO F290-NUM-ZONE                   11500000
           ELSE                                                         11510000
              MOVE SPACES            TO F290-NUM-ZONE                   11520000
           END-IF.                                                      11530000
           MOVE F800-NUM-NEW-TOWN    TO F290-NUM-NEW-TOWN.              11540000
           MOVE F800-NUM-FLAT-TYPE   TO F290-NUM-FLAT-TYPE.             11550000
           MOVE apntmtDate           TO F290-DTE-APPMT.                 11560000
           MOVE WS-TIME-APPT         TO F290-TME-APPMT.                 11570000
           MOVE srvc                 TO F290-NUM-APPMT-TYPE.            11580000
           MOVE F800-NUM-ALLO-CAT    TO F290-NUM-SELECT-TYPE.           11590000
           MOVE F800-DTE-BALLOT      TO F290-DTE-BALLOT.                11600000
           STRING '##' F800-NUM-REGN(3:6)                               11610000
                DELIMITED BY SIZE INTO F290-NUM-CSO                     11620000
           END-STRING.                                                  11630000
           MOVE SPACES               TO F290-NUM-STATUS                 11640000
                                        F290-NUM-USERID                 11650000
                                        F290-DTE-UPDATE                 11660000
                                        F290-TME-UPDATE                 11670000
                                        F290-HOLD-UNIT                  11680000
                                        F290-HOLD-BLOCK.                11690000
           MOVE F800-NUM-MGPS        TO F290-NUM-MGPS.                  11700000
                                                                        11710000
           WRITE BP13F290-REC.                                          11720000
           IF F290-STATUS NOT = ZEROES                                  11730000
              DISPLAY 'BP13F290 - WRITE ERROR, CHECK SPACE ALLOCATION: '11740000
                       F290-STATUS                                      11750000
              PERFORM  9999-CLOSE-ROUTINE                               11760000
           ELSE                                                         11770000
              ADD 1  TO WS-WRITE-F290.                                  11780000
                                                                        11790000
       400-EXIT.                                                        11800000
           EXIT.                                                        11810000
                                                                        11820000
      *------------------*                                              11830000
       500-VALIDATE-DATE.                                               11840000
      *------------------*                                              11850000
           MOVE 'CD'                     TO  WS-IN-OPTION.              11860000
           MOVE WS-DATE-CHECK            TO  WS-IN-DATE.                11870000
                                                                        11880000
           CALL 'AV02C001' USING WS-LINK-REC.                           11890000
                                                                        11900000
           IF WS-RETURN NOT = '000'                                     11910000
              MOVE 'Y'                   TO  WS-INVALID                 11920000
           END-IF.                                                      11930000
                                                                        11940000
       500-EXIT.                                                        11950000
           EXIT.                                                        11960000
                                                                        11970000
      *-------------------------------------------------------------    11980000
       9999-CLOSE-ROUTINE.                                              11990000
      *-------------------------------------------------------------    12000000
           DISPLAY '  '.                                                12010000
           DISPLAY '*----------- BP13C371 CONTROL LIST ----------*'.    12020000
           DISPLAY '  '.                                                12030000
           DISPLAY 'NO OF BP13F800 READ        = ' WS-READ-CNT-F800.    12040000
           DISPLAY 'NO OF F208 RECORDS WRITTEN = ' WS-WRITE-F208.       12050000
           DISPLAY 'NO OF F290 RECORDS WRITTEN = ' WS-WRITE-F290.       12060000
           DISPLAY 'NO OF PIDB MISSING RECORD  = ' WS-MISSING-PIDB.     12070000
           DISPLAY 'NO OF F820 MISSING RECORD  = ' WS-MISSING-F820.     12080000
           DISPLAY 'NO OF K022 MISSING RECORD  = ' WS-MISSING-K022.     12090000
           DISPLAY 'NO OF K454 MISSING RECORD  = ' WS-MISSING-K454.     12100000
           DISPLAY 'NO OF K480 MISSING RECORD  = ' WS-MISSING-K480.     12110000
                                                                        12120000
           CLOSE BP13F800                                               12130000
                 BP13K454                                               12140000
                 BP13K820                                               12150000
                 BP13K022                                               12160000
                 BP13K480                                               12170000
                 SY02F001                                               12180000
                 BP13F208                                               12190000
                 BP13F290.                                              12200000
                                                                        12210000
           IF K454-STATUS NOT = 00 AND 97                               12220000
              DISPLAY 'BP13K454 CLOSE ERROR, K454-STATUS ' K454-STATUS  12230000
              MOVE     K454-STATUS      TO       RETURN-CODE.           12240000
                                                                        12250000
           IF K820-STATUS NOT = 00 AND 97                               12260000
              DISPLAY 'BP13K820 CLOSE ERROR, K820-STATUS ' K820-STATUS  12270000
              MOVE     K820-STATUS      TO       RETURN-CODE.           12280000
                                                                        12290000
           IF K022-STATUS NOT = 00 AND 97                               12300000
              DISPLAY 'BP13K022 CLOSE ERROR, K022-STATUS ' K022-STATUS  12310000
              MOVE     K022-STATUS      TO       RETURN-CODE.           12320000
                                                                        12330000
           IF K480-STATUS NOT = 00 AND 97                               12340000
              DISPLAY 'BP13K480 CLOSE ERROR, K480-STATUS ' K480-STATUS  12350000
              MOVE     K480-STATUS      TO       RETURN-CODE.           12360000
                                                                        12370000
           STOP RUN.                                                    12380000
                                                                        12390000
       9999-EXIT.                                                       12400000
           EXIT.                                                        12410000
                                                                        12420000
