       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C494.                                                 
      *AUTHOR.        RJB1                                                      
      *DATE-WRITTEN.  JAN 17 2017.                                              
      * ============================================================            
      * SYSTEM OF COMMITMENT (SOC)                                              
      * ============================================================            
      * OBJECTIVE  - PRINT LETTERS ON NOTIFICATION OF                           
      *              REVISED COMPLETION DATE.                                   
      *              (MODELLED AFTER BP13C491 FOR ADHOC USE. MAINLY             
      *               FOR TESTING THE FORMS)                                    
      *                                                                         
      * FORM USED  - BP13XJ                                                     
      *                                                                         
      * INPUT FILES:  BM06F110                                                  
      *               BP13K022                                                  
      *               BP13K024                                                  
      *               BP13K800                                                  
      *               BP13K820                                                  
      *               BP13K830                                                  
      *               BM06K100                                                  
      *               BM06K510                                                  
      * REPORT:       BP13P491                                                  
      *               P13P491B                                                  
      *               BP13L491                                                  
      * ------------------------------------------------------------            
      * NOTE : TO RUN ACJOB                                                     
      *                     > NORMAL COMPILE IN TSO1                            
      *                     > JCL > BIND                                        
      *                           > RUN JOB                                     
      *                           > FREE PLAN                                   
      * ------------------------------------------------------------            
      * REF NO    DATE  BY  DESCRIPTIONS                                        
      * -------- ------ --- ------------                                        
      * BP136604 170117 RJB1 NEW PGM                                            
      * BP136611 240117 RJB1 REMOVE THE HARDCODED DATE                          
      * BP136704 140317 RJB1 COMMENTED OUT THE DATE AS IT IS CURRENTLY          
      *                      HARDCODED IN THE FORM.                             
      * BP138186 310120 KAC1 REPLACE P13XJ WITH P13XG                           
      * ============================================================            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K022  ASSIGN       TO BP13K022                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K022-KEY-FLD                        
                            ALTERNATE RECORD KEY IS K022-NUM-REGN               
                            WITH DUPLICATES                                     
                            FILE STATUS  IS K022-STATUS.                        
                                                                                
           SELECT BP13K024  ASSIGN       TO BP13K024                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K024-KEY-FLD                        
                            FILE STATUS  IS K024-STATUS.                        
                                                                                
           SELECT BP13K800 ASSIGN        TO BP13K800                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K800-NUM-REGN                       
                           FILE STATUS   IS K800-STATUS.                        
                                                                                
           SELECT BP13K820 ASSIGN        TO BP13K820                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K820-KEY-FLD                        
                           FILE STATUS   IS K820-STATUS.                        
                                                                                
           SELECT BP13K830 ASSIGN        TO BP13K830                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K830-KEY-FLD                        
                           ALTERNATE KEY IS K830-NUM-REGN                       
                           FILE STATUS   IS K830-STATUS.                        
                                                                                
           SELECT BM06K510 ASSIGN        TO BM06K510                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K510-ESTCDE                         
                           FILE STATUS   IS K510-STATUS.                        
                                                                                
           SELECT BM06K100 ASSIGN        TO BM06K100                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K100-KEY-FLD                        
                           FILE STATUS   IS K100-STATUS.                        
                                                                                
           SELECT BM06F110 ASSIGN       TO BM06F110.                            
           SELECT BP13P491 ASSIGN       TO BP13P491.                            
           SELECT P13P491B ASSIGN       TO P13P491B.                            
           SELECT BP13P492 ASSIGN       TO BP13P492.                            
           SELECT P13P492B ASSIGN       TO P13P492B.                            
           SELECT BP13L491 ASSIGN       TO BP13L491.                            
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K024                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K024.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   BM06K510                                                            
            RECORD CONTAINS 60 CHARACTERS.                                      
       COPY BM06K510.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K100.                                                           
                                                                                
       FD   BM06F110                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 500 CHARACTERS                                      
            BLOCK  CONTAINS 0   RECORDS.                                        
       COPY BM06F110.                                                           
                                                                                
       FD   BP13P491           RECORDING MODE IS F                              
                               RECORD CONTAINS 100 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   P491-PRTREC        PIC X(100).                                      
                                                                                
       FD   P13P491B           RECORDING MODE IS F                              
                               RECORD CONTAINS 100 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   P491B-PRTREC       PIC X(100).                                      
                                                                                
       FD   BP13P492           RECORDING MODE IS F                              
                               RECORD CONTAINS 100 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   P492-PRTREC        PIC X(100).                                      
                                                                                
       FD   P13P492B           RECORDING MODE IS F                              
                               RECORD CONTAINS 100 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   P492B-PRTREC       PIC X(100).                                      
                                                                                
       FD   BP13L491           RECORDING MODE IS F                              
                               RECORD CONTAINS 132 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   L491-PRTREC        PIC X(132).                                      
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  K022-STATUS                   PIC 99    VALUE 0.                     
       01  K024-STATUS                   PIC 99    VALUE 0.                     
       01  K800-STATUS                   PIC 99    VALUE 0.                     
       01  K820-STATUS                   PIC 99    VALUE 0.                     
       01  K830-STATUS                   PIC 99    VALUE 0.                     
       01  K510-STATUS                   PIC 99    VALUE 0.                     
       01  K100-STATUS                   PIC 99    VALUE 0.                     
       01  WS-F110-EOF                   PIC X     VALUE 'N'.                   
                                                                                
       01  WS-OCCUPANTS.                                                        
           05  WS-NAME      OCCURS 4 TIMES   PIC X(66).                         
                                                                                
       01  WS-DATE                       PIC X(8)  VALUE SPACES.                
       01  WS-MONTH                      PIC X(3)  VALUE SPACES.                
       01  WS-QUARTER                    PIC X(11) VALUE SPACES.                
       01  WS-YEAR                       PIC 9(4).                              
                                                                                
       01  WS-PREV-BLK-NO                PIC X(5).                              
       01  WS-OCCP-PTR                   PIC 9(2).                              
       01  WS-SQL-CODE                   PIC 9(4).                              
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-CNT-F110-READ           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-LETTER              PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K800-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K820-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K830-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K510-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K100-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-IDX                     PIC 9(2)  VALUE 0.                     
           05 WS-BLK-CNT                 PIC 9(7)  VALUE 0.                     
           05 WS-TOTAL-CNT               PIC 9(7)  VALUE 0.                     
           05 WS-LINE-CNT                PIC 9(7)  VALUE 0.                     
           05 WS-PAGE-CNT                PIC 9(7)  VALUE 0.                     
                                                                                
           05 WS-ERROR-FL                PIC X(1) VALUE 'N'.                    
              88 WS-NO-ERROR             VALUE 'N'.                             
              88 WS-ERROR                VALUE 'Y'.                             
                                                                                
       01  WS-MONTHS-IN-DIGITS-AND-WORDS.                                       
           05 FILLER                   PIC X(06) VALUE                          
             '01 JAN'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '02 FEB'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '03 MAR'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '04 APR'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '05 MAY'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '06 JUN'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '07 JUL'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '08 AUG'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '09 SEP'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '10 OCT'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '11 NOV'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '12 DEC'.                                                          
       01  FILLER  REDEFINES  WS-MONTHS-IN-DIGITS-AND-WORDS.                    
           05 WS-MONTH-TABLE               OCCURS 12                            
                                           INDEXED BY WS-MTH-IND.               
              10 WS-MONTH-IN-DIGITS    PIC X(02).                               
              10 FILLER                PIC X(01).                               
              10 WS-MONTH-IN-WORDS     PIC X(03).                               
                                                                                
      *=======================================================*                 
      *    LINKAGE VARIABLES                                  *                 
      *=======================================================*                 
       01   WS-LINK-REC.                                                        
            05 WS-LINK-NUM-SCH            PIC X(4).                             
            05 WS-LINK-NUM-ACC            PIC X(4).                             
            05 WS-LINK-NUM-CHK            PIC X(1).                             
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      *-------------------------------------------------------------            
      *    LETTER LAYOUT                                                        
      *-------------------------------------------------------------            
       01  P491-LINE01.                                                         
           05 FILLER                     PIC X(74) VALUE SPACES.                
           05 P491-REGN-NO               PIC X(8)  VALUE SPACES.                
                                                                                
       01  P491-LINE02.                                                         
           05 FILLER                     PIC X(74) VALUE SPACES.                
           05 P491-DATE                  PIC X(10) VALUE SPACES.                
                                                                                
       01  P491-LINE03.                                                         
           05 FILLER                     PIC X(74) VALUE SPACES.                
           05 P491-OIC-TEL             PIC X(13) VALUE '1800-866-3066'.         
                                                                                
       01  P491-LINE04.                                                         
           05 FILLER                     PIC X(11)  VALUE SPACES.               
           05 P491-NAME1                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04B.                                                        
           05 FILLER                     PIC X(11)  VALUE SPACES.               
           05 P491-NAME2                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04C.                                                        
           05 FILLER                     PIC X(11)  VALUE SPACES.               
           05 P491-NAME3                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04D.                                                        
           05 FILLER                     PIC X(11)  VALUE SPACES.               
           05 P491-NAME4                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE05.                                                         
           05 FILLER                     PIC X(11)  VALUE SPACES.               
           05 P491-BLK                   PIC X(10)  VALUE SPACES.               
           05 FILLER                     PIC X(2)   VALUE SPACES.               
           05 P491-FLAT-NO.                                                     
              15  P491-CHAR              PIC X      VALUE SPACE.                
              15  P491-LEVEL             PIC X(2)   VALUE SPACES.               
              15  P491-DASH              PIC X      VALUE SPACE.                
              15  P491-HSE-MAIN          PIC X(4)   VALUE SPACES.               
              15  P491-HSE-SUB           PIC X(3)   VALUE SPACES.               
                                                                                
       01  P491-LINE05B.                                                        
           05 FILLER                     PIC X(11) VALUE SPACES.                
           05 P491-STREET                PIC X(32) VALUE SPACES.                
                                                                                
       01  P491-LINE05C.                                                        
           05 FILLER                     PIC X(11) VALUE SPACES.                
           05 FILLER                     PIC X(10) VALUE 'SINGAPORE'.           
           05 P491-POSTAL                PIC X(6)  VALUE SPACES.                
                                                                                
       01  PECD-LINE06.                                                         
           05  FILLER                    PIC X(10) VALUE SPACES.                
           05  PECD-BAR-CODE             PIC X(09) VALUE SPACES.                
                                                                                
       01  PECD-LINE07.                                                         
           05 FILLER                     PIC X(11) VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'BLK'.                 
           05 P491-UNIT-BLK              PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 P491-UNIT-FLAT-NO.                                                
              10 FILLER                  PIC X     VALUE '#'.                   
              10 P491-UNIT-LVL-NO        PIC X(2)  VALUE SPACES.                
              10 FILLER                  PIC X     VALUE '-'.                   
              10 P491-UNIT-UNIT-NO       PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 P491-UNIT-STREET-POSTAL    PIC X(50) VALUE SPACES.                
                                                                                
       01  PECD-LINE08.                                                         
           05 FILLER                     PIC X(51) VALUE SPACES.                
           05 P491-NEWTOWN               PIC X(20)  VALUE SPACES.               
                                                                                
       01  PECD-LINE09.                                                         
           05 FILLER                     PIC X(56) VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'BLK'.                 
           05 P491-UNIT-BLK2             PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(1)  VALUE SPACES.                
           05 P491-NEWTOWN2              PIC X(20) VALUE SPACES.                
                                                                                
       01  PECD-LINE10.                                                         
           05 FILLER                     PIC X(26) VALUE SPACES.                
           05 P491-NEW-PCD               PIC X(25) VALUE SPACES.                
                                                                                
       01  PECD-LINE10Q.                                                        
           05 FILLER                     PIC X(48) VALUE SPACES.                
           05 P491-NEW-PCDQ              PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-FT-OIC.                                                         
           05 FILLER                     PIC X(10) VALUE SPACES.                
           05 P491-NME-OIC               PIC X(30) VALUE SPACES.                
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT                                                        
      *-------------------------------------------------------------            
       01  L491-HDR01.                                                          
           05 FILLER                     PIC X(14) VALUE 'BP13L491'.            
           05 FILLER                     PIC X(30) VALUE 'HDB3'.                
           05 FILLER                     PIC X(42) VALUE                        
             'S Y S T E M   O F   C O M M I T M E N T'.                         
           05 FILLER                     PIC X(13) VALUE SPACES.                
           05 FILLER                     PIC X(7)  VALUE 'DATE: '.              
           05 L491-DATE                  PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X(10) VALUE '   PAGE: '.           
           05 L491-PAGE                  PIC ZZZZ9.                             
                                                                                
       01  L491-HDR02.                                                          
           05 FILLER                     PIC X(40) VALUE SPACES.                
           05 FILLER                     PIC X(80) VALUE                        
             'LETTERS PRINTED FOR NOTIFICATION OF NEW PCD DATE'.                
                                                                                
       01  L491-HDR03.                                                          
           05 FILLER                     PIC X(10) VALUE '  BLOCK: '.           
           05 L491-BLOCK                 PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE SPACES.                
           05 L491-STREET-NAME           PIC X(32) VALUE SPACES.                
                                                                                
       01  L491-HDR04.                                                          
           05 FILLER                     PIC X(9)  VALUE '   NO.   '.           
           05 FILLER                     PIC X(14) VALUE 'SCH-ACC NO'.          
           05 FILLER                     PIC X(10) VALUE '  REGN NO.'.          
           05 FILLER                     PIC X(34)                              
                    VALUE '  NAME(TRUNCATED) '.                                 
           05 FILLER                     PIC X(10) VALUE '  NRIC NO.'.          
           05 FILLER                     PIC X(7)  VALUE '  BLK '.              
           05 FILLER                     PIC X(26)                              
                    VALUE '      MAIL STREET NAME'.                             
           05 FILLER                     PIC X(10) VALUE '  FLAT NO.'.          
           05 FILLER                     PIC X(8)  VALUE '  PC'.                
                                                                                
       01  L491-DETAIL.                                                         
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-NO                    PIC ZZZZ9.                             
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-SCH-ACC               PIC X(14) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-REGN-NO               PIC X(8)  VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-NAME                  PIC X(32) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-NRIC-NO               PIC X(9)  VALUE SPACES.                
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L491-BLK-NO                PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L491-STREET                PIC X(20) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-FLAT-NO.                                                     
              10 FILLER                  PIC X     VALUE '#'.                   
              10 L491-LVL-NO             PIC X(2)  VALUE SPACES.                
              10 FILLER                  PIC X     VALUE '-'.                   
              10 L491-UNIT-NO            PIC X(4)  VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L491-POSTAL-CODE           PIC X(6)  VALUE SPACES.                
                                                                                
       01  L491-PRT-TOTAL.                                                      
           05 FILLER                     PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X(30)                              
              VALUE 'TOTAL NUMBER OF LETTERS: '.                                
           05 L491-TOTAL                 PIC Z,ZZZ,ZZ9.                         
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR AV02C015                                                   
      *-------------------------------------------------------------            
        01  WS-LINK-AV02C015.                                                   
            05  AV02C015-IN-POSTCODE          PIC X(6).                         
            05  AV02C015-OUT-POSTCODE-CHKSUM  PIC X(9).                         
                                                                                
       COPY AV02COMM.                                                           
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-CONTROL.                                                            
      *-------------------------------------------------------------            
           PERFORM 1000-START-UP         THRU 1000-EXIT.                        
           PERFORM 2000-MAIN-ROUTINE     THRU 2000-EXIT                         
                   UNTIL WS-F110-EOF = 'Y'.                                     
           PERFORM 9999-WRAP-UP.                                                
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       1000-START-UP.                                                           
      *-------------------------------------------------------------            
            OPEN INPUT  BP13K022                                                
                        BP13K024                                                
                        BP13K800                                                
                        BP13K820                                                
                        BP13K830                                                
                        BM06K510                                                
                        BM06K100                                                
                        BM06F110                                                
                OUTPUT  BP13P491                                                
                        P13P491B                                                
                        BP13P492                                                
                        P13P492B                                                
                        BP13L491.                                               
                                                                                
            IF K022-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K022,STATUS ' K022-STATUS           
               MOVE K022-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K024-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K024,STATUS ' K024-STATUS           
               MOVE K024-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K800-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K800,STATUS ' K800-STATUS           
               MOVE K800-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K820-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K820,STATUS ' K820-STATUS           
               MOVE K820-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K830-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K830,STATUS ' K830-STATUS           
               MOVE K830-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K510-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BM06K510,STATUS ' K510-STATUS           
               MOVE K510-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K100-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BM06K100,STATUS ' K100-STATUS           
               MOVE K100-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            READ BM06F110                                                       
                 AT END  DISPLAY 'NO RECORDS FOUND!'                            
                         MOVE 'Y'          TO WS-F110-EOF                       
                         GO TO 1000-EXIT                                        
            END-READ.                                                           
                                                                                
            MOVE 60                  TO WS-LINE-CNT.                            
            ADD  1                   TO WS-CNT-F110-READ.                       
            MOVE F110-BLK-NO         TO WS-PREV-BLK-NO.                         
                                                                                
            MOVE FUNCTION CURRENT-DATE TO WS-DATE.                              
                                                                                
      *CR6704 THE DATE IS CURRENTLY HARDCODED INTO THE FORM                     
      *CR      - HARCODED FOR JANUARY 31,2020*                                  
            MOVE '31/01/2020'        TO P491-DATE.                              
                                                                                
      *     STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
      *            DELIMITED BY SIZE INTO P491-DATE.                            
                                                                                
            STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
                   DELIMITED BY SIZE INTO L491-DATE.                            
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       2000-MAIN-ROUTINE.                                                       
      *-------------------------------------------------------------            
           SET WS-NO-ERROR           TO TRUE.                                   
           INITIALIZE  WS-OCCUPANTS.                                            
                                                                                
      *-------------------------------------------------------------*           
      * READS BM06F110 AND PROCESS EACH RECORD UNTIL END OF FILE    *           
      *-------------------------------------------------------------*           
                                                                                
           PERFORM 2100-RETRIEVE-DATA   THRU 2100-EXIT.                         
           PERFORM 3000-FORMAT-LETTER   THRU 3000-EXIT.                         
           IF K100-NUM-PACD = 'M'                                               
              PERFORM 3100-PRINT-LETTER    THRU 3100-EXIT                       
           ELSE                                                                 
              PERFORM 3100-PRINT-LETTER    THRU 3100-EXIT                       
      *       PERFORM 3150-PRINT-LETTER    THRU 3150-EXIT                       
           EXIT.                                                                
           PERFORM 3200-PRINT-AUDIT     THRU 3200-EXIT.                         
                                                                                
           READ BM06F110 AT END                                                 
                MOVE 'Y' TO WS-F110-EOF                                         
                GO TO 2000-EXIT                                                 
                END-READ.                                                       
                                                                                
           ADD  1                          TO WS-CNT-F110-READ.                 
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       2100-RETRIEVE-DATA.                                                      
      *-------------------------------------------------------------            
           MOVE F110-REGN-NO               TO K800-NUM-REGN.                    
           PERFORM 8100-READ-K800          THRU 8100-EXIT.                      
           IF WS-NO-ERROR                                                       
              PERFORM 2200-GET-NRIC-NAMES  THRU 2200-EXIT                       
              PERFORM 2300-GET-NRIC-ADDR   THRU 2300-EXIT                       
              PERFORM 2400-GET-BLK-ADDRESS THRU 2400-EXIT                       
              PERFORM 2500-GET-NEWTOWN     THRU 2500-EXIT                       
      * DONT NEED THIS IN NEW FORM P13XG -CR#8186                               
      *       PERFORM 2600-GET-PCD         THRU 2600-EXIT                       
           END-IF.                                                              
                                                                                
       2100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       2200-GET-NRIC-NAMES.                                                     
      *-------------------------------------------------------------            
           MOVE  4                         TO   WS-OCCP-PTR.                    
           IF K800-NUM-NRIC4 NOT = SPACES                                       
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC4          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC3 NOT = SPACES AND WS-NO-ERROR                       
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC3          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC2 NOT = SPACES AND WS-NO-ERROR                       
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC2          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC1 NOT = SPACES AND WS-NO-ERROR                       
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC1          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
           END-IF.                                                              
                                                                                
       2200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       2300-GET-NRIC-ADDR.                                                      
      *------------------------------------------------------                   
                                                                                
           MOVE K800-NUM-REGN              TO  K830-NUM-REGN.                   
           PERFORM 8300-READ-K830          THRU 8300-EXIT.                      
                                                                                
       2300-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       2400-GET-BLK-ADDRESS.                                                    
      *------------------------------------------------------                   
           MOVE SPACES           TO BP13COMM8-REC.                              
           MOVE K800-NUM-SCH     TO WS-LINK-NUM-SCH.                            
           MOVE K800-NUM-ACC     TO WS-LINK-NUM-ACC.                            
           MOVE K800-NUM-ACC-CK  TO WS-LINK-NUM-CHK.                            
                                                                                
           CALL 'BP13C913' USING                                                
                 WS-LINK-REC, BP13COMM8-REC                                     
           END-CALL.                                                            
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0                                          
              MOVE COMM8-CDE-SYSERR  TO WS-SQL-CODE                             
              IF COMM8-CDE-SYSERR = 100                                         
                 DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE' WS-SQL-CODE           
              ELSE                                                              
                 DISPLAY 'ERROR READING PBF TABLE' WS-SQL-CODE                  
              END-IF                                                            
              MOVE SPACES        TO BP13COMM8-REC                               
              SET WS-ERROR       TO TRUE                                        
           END-IF.                                                              
                                                                                
       2400-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2500-GET-NEWTOWN.                                                        
      *------------------------------------------------------                   
                                                                                
            MOVE F110-ESTATE        TO   K510-ESTCDE.                           
            PERFORM 8400-READ-K510  THRU 8400-EXIT.                             
                                                                                
       2500-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2600-GET-PCD.                                                            
      *------------------------------------------------------                   
                                                                                
           MOVE F110-AIX1          TO   K100-KEY-FLD.                           
           PERFORM 8500-READ-K100  THRU 8500-EXIT.                              
                                                                                
           IF K100-NUM-PACD = 'M'                                               
              PERFORM 2700-MONTHLY-PACD   THRU 2700-EXIT                        
           ELSE                                                                 
             IF K100-NUM-PACD = 'Q'                                             
                PERFORM 2700-MONTHLY-PACD   THRU 2700-EXIT                      
      *NOT NEEDED ON NEW FORM P13XG CR#8186                                     
      *         PERFORM 2800-QUARTERLY-PACD   THRU 2800-EXIT                    
             END-IF                                                             
           END-IF.                                                              
                                                                                
                                                                                
       2600-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2700-MONTHLY-PACD.                                                       
      *------------------------------------------------------                   
           SET WS-MTH-IND TO 1.                                                 
                                                                                
           SEARCH WS-MONTH-TABLE                                                
               AT END                                                           
               MOVE '   ' TO WS-MONTH                                           
            WHEN WS-MONTH-IN-DIGITS(WS-MTH-IND) = K100-DTE-PACD-QTR(5:2)        
               MOVE WS-MONTH-IN-WORDS(WS-MTH-IND) TO WS-MONTH                   
           END-SEARCH.                                                          
                                                                                
           MOVE K100-DTE-PACD-QTR(1:4)       TO WS-YEAR.                        
                                                                                
      *    STRING WS-MONTH ' ' WS-YEAR '.'                                      
      *           DELIMITED BY SIZE                                             
      *           INTO P491-NEW-PCD                                             
      *    END-STRING.                                                          
                                                                                
      *    MOVE ' DEC 2013 / JAN 2014.'     TO P491-NEW-PCD.                    
                                                                                
       2700-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2800-QUARTERLY-PACD.                                                     
      *------------------------------------------------------                   
           IF K100-DTE-PACD-QTR(5:2) = '01' OR '02' OR '03'                     
              MOVE '1ST QUARTER' TO WS-QUARTER                                  
           ELSE                                                                 
              IF K100-DTE-PACD-QTR(5:2) = '04' OR '05' OR '06'                  
                 MOVE '2ND QUARTER' TO WS-QUARTER                               
              ELSE                                                              
                 IF K100-DTE-PACD-QTR(5:2) = '07' OR '08' OR '09'               
                    MOVE '3RD QUARTER' TO WS-QUARTER                            
                 ELSE                                                           
                    MOVE '4TH QUARTER' TO WS-QUARTER                            
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K100-DTE-PACD-QTR(1:4)       TO WS-YEAR.                        
                                                                                
           STRING WS-QUARTER ' ' WS-YEAR '.'                                    
                  DELIMITED BY SIZE                                             
                  INTO P491-NEW-PCDQ                                            
           END-STRING.                                                          
                                                                                
                                                                                
       2800-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3000-FORMAT-LETTER.                                                      
      *------------------------------------------------------                   
           MOVE SPACES                   TO  P491-REGN-NO                       
                                             P491-NAME1                         
                                             P491-NAME2                         
                                             P491-NAME3                         
                                             P491-NAME4                         
                                             P491-OIC-TEL                       
                                             P491-NME-OIC                       
                                             PECD-BAR-CODE.                     
                                                                                
           MOVE K800-NUM-REGN            TO  P491-REGN-NO.                      
           MOVE WS-NAME(1)               TO  P491-NAME1.                        
           MOVE WS-NAME(2)               TO  P491-NAME2.                        
           MOVE WS-NAME(3)               TO  P491-NAME3.                        
           MOVE WS-NAME(4)               TO  P491-NAME4.                        
           IF K830-NUM-MAIL-ADDR NOT = SPACES AND LOW-VALUES                    
              PERFORM 3050-FORMAT-MAIL-ADDR THRU 3050-EXIT                      
           ELSE                                                                 
              PERFORM 3055-FORMAT-HOME-ADDR THRU 3055-EXIT                      
           END-IF.                                                              
                                                                                
           MOVE COMM8-NUM-BLK            TO  P491-UNIT-BLK                      
                                             P491-UNIT-BLK2.                    
      *       MOVE COMM8-NME-STREET      TO  P491-UNIT-STREET-POSTAL.           
                                                                                
           IF P491-UNIT-BLK = ' 656A'                                           
              MOVE 'PUNGGOL EAST SINGAPORE 821656' TO                           
                     P491-UNIT-STREET-POSTAL                                    
                                                                                
      *       INSPECT P491-UNIT-STREET-POSTAL REPLACING ALL '*'                 
      *               BY SPACES                                                 
           ELSE                                                                 
             IF P491-UNIT-BLK = ' 656B'                                         
                MOVE 'PUNGGOL EAST SINGAPORE 822656' TO                         
                      P491-UNIT-STREET-POSTAL                                   
                                                                                
      *         STRING 'PUNGGOL EAST'  ' SINGAPORE 822656'                      
      *                DELIMITED BY SIZE INTO P491-UNIT-STREET-POSTAL           
      *         END-STRING                                                      
      *         INSPECT P491-UNIT-STREET-POSTAL REPLACING ALL '*'               
      *                 BY SPACES                                               
             END-IF                                                             
           END-IF.                                                              
                                                                                
                                                                                
           MOVE COMM8-NUM-LEVEL          TO  P491-UNIT-LVL-NO.                  
           MOVE COMM8-NUM-UNIT-MAIN      TO  P491-UNIT-UNIT-NO.                 
      ** NOT NEEDED ON NEW FORM BP13XG                                          
      **   PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3050-FORMAT-MAIL-ADDR.                                                   
      *------------------------------------------------------                   
           IF K830-NUM-MAIL-ADDR-TYPE  = 'H'                                    
              MOVE K830-NME-MAIL-STR-BLDG TO P491-STREET                        
              MOVE K830-NUM-MAIL-LVL-CHAR TO P491-CHAR                          
              MOVE K830-NUM-MAIL-LVL-NUM  TO P491-LEVEL                         
              MOVE K830-NUM-MAIL-LVL-DASH TO P491-DASH                          
              MOVE K830-NUM-MAIL-HSEMAIN  TO P491-HSE-MAIN                      
              MOVE K830-NUM-MAIL-HSESUB   TO P491-HSE-SUB                       
           ELSE                                                                 
              MOVE K830-NUM-MAIL-FLAT     TO P491-FLAT-NO                       
              MOVE K830-NME-MAIL-STR-BLDG TO P491-STREET                        
           END-IF.                                                              
                                                                                
           MOVE K830-NUM-MAIL-BLK         TO P491-BLK.                          
           MOVE K830-NUM-MAIL-POSTAL      TO P491-POSTAL.                       
                                                                                
           IF K830-NUM-MAIL-POSTAL = SPACES OR ZEROS                            
              DISPLAY '- MAIL POSTAL EMPTY ' K830-NUM-MAIL-POSTAL               
                      ', REGN IS ' K800-NUM-REGN.                               
                                                                                
           MOVE SPACES                    TO WS-LINK-AV02C015.                  
           MOVE K830-NUM-MAIL-POSTAL      TO AV02C015-IN-POSTCODE.              
           PERFORM 6500-CALL-AV02C015     THRU 6500-EXIT.                       
           MOVE AV02C015-OUT-POSTCODE-CHKSUM TO PECD-BAR-CODE.                  
                                                                                
       3050-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3055-FORMAT-HOME-ADDR.                                                   
      *------------------------------------------------------                   
           IF K830-NUM-ADDR-TYPE  = 'H'                                         
              MOVE K830-NME-STREET      TO P491-STREET                          
              MOVE K830-NUM-LVL-CHAR    TO P491-CHAR                            
              MOVE K830-NUM-LVL-NUM     TO P491-LEVEL                           
              MOVE K830-NUM-LVL-DASH    TO P491-DASH                            
              MOVE K830-NUM-HSEMAIN     TO P491-HSE-MAIN                        
              MOVE K830-NUM-HSESUB      TO P491-HSE-SUB                         
           ELSE                                                                 
              MOVE K830-NUM-FLAT        TO P491-FLAT-NO                         
              MOVE K830-NME-STREET-BLDG TO P491-STREET                          
           END-IF.                                                              
                                                                                
           MOVE K830-NUM-BLK            TO P491-BLK.                            
           MOVE K830-NUM-POSTAL         TO P491-POSTAL.                         
                                                                                
           IF K830-NUM-POSTAL = SPACES OR ZEROS                                 
              DISPLAY '- RES POSTAL EMPTY ' K830-NUM-MAIL-POSTAL                
                      ', REGN IS ' K800-NUM-REGN.                               
                                                                                
           MOVE SPACES                  TO WS-LINK-AV02C015.                    
           MOVE K830-NUM-POSTAL         TO AV02C015-IN-POSTCODE.                
           PERFORM 6500-CALL-AV02C015   THRU 6500-EXIT.                         
           MOVE AV02C015-OUT-POSTCODE-CHKSUM TO PECD-BAR-CODE.                  
                                                                                
                                                                                
       3055-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       3100-PRINT-LETTER.                                                       
      *-------------------------------------------------------------            
                                                                                
      * LETTER TO BE SENT OUT FOR MONTHLY                                       
      *-------------------------------------------------------------            
           MOVE  SPACES              TO P491-PRTREC.                            
                                                                                
           ADD   1                   TO WS-CNT-LETTER.                          
           WRITE P491-PRTREC FROM P491-LINE01 AFTER PAGE.                       
           WRITE P491-PRTREC FROM P491-LINE02.                                  
           WRITE P491-PRTREC FROM P491-LINE03.                                  
                                                                                
           WRITE P491-PRTREC FROM P491-LINE04 AFTER 4.                          
           WRITE P491-PRTREC FROM P491-LINE04B.                                 
           WRITE P491-PRTREC FROM P491-LINE04C.                                 
           WRITE P491-PRTREC FROM P491-LINE04D.                                 
                                                                                
           WRITE P491-PRTREC FROM P491-LINE05.                                  
           WRITE P491-PRTREC FROM P491-LINE05B.                                 
           WRITE P491-PRTREC FROM P491-LINE05C.                                 
           WRITE P491-PRTREC FROM PECD-LINE06 AFTER 2.                          
                                                                                
           WRITE P491-PRTREC FROM PECD-LINE07 AFTER 6.                          
                                                                                
      *    WRITE P491-PRTREC FROM PECD-LINE08 AFTER 2.                          
      *    WRITE P491-PRTREC FROM PECD-LINE09 AFTER 3.                          
           WRITE P491-PRTREC FROM PECD-LINE10 AFTER 4.                          
                                                                                
           WRITE P491-PRTREC FROM PECD-FT-OIC AFTER 29.                         
                                                                                
      * FILE COPY                                                               
      *-------------------------------------------------------------            
           MOVE  SPACES              TO P491B-PRTREC.                           
                                                                                
           WRITE P491B-PRTREC FROM P491-LINE01 AFTER PAGE.                      
           WRITE P491B-PRTREC FROM P491-LINE02.                                 
           WRITE P491B-PRTREC FROM P491-LINE03.                                 
                                                                                
           WRITE P491B-PRTREC FROM P491-LINE04 AFTER 4.                         
           WRITE P491B-PRTREC FROM P491-LINE04B.                                
           WRITE P491B-PRTREC FROM P491-LINE04C.                                
           WRITE P491B-PRTREC FROM P491-LINE04D.                                
                                                                                
           WRITE P491B-PRTREC FROM P491-LINE05.                                 
           WRITE P491B-PRTREC FROM P491-LINE05B.                                
           WRITE P491B-PRTREC FROM P491-LINE05C.                                
           WRITE P491B-PRTREC FROM PECD-LINE06 AFTER 2.                         
                                                                                
           WRITE P491B-PRTREC FROM PECD-LINE07 AFTER 6.                         
                                                                                
      *    WRITE P491B-PRTREC FROM PECD-LINE08 AFTER 2.                         
      *    WRITE P491B-PRTREC FROM PECD-LINE09 AFTER 3.                         
           WRITE P491B-PRTREC FROM PECD-LINE10 AFTER 4.                         
                                                                                
           WRITE P491B-PRTREC FROM PECD-FT-OIC AFTER 29.                        
                                                                                
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3150-PRINT-LETTER.                                                       
      *-------------------------------------------------------------            
                                                                                
      * LETTER TO BE SENT OUT FOR QUARTERLY                                     
      *-------------------------------------------------------------            
           MOVE  SPACES              TO P492-PRTREC.                            
                                                                                
           ADD   1                   TO WS-CNT-LETTER.                          
           WRITE P492-PRTREC FROM P491-LINE01 AFTER PAGE.                       
           WRITE P492-PRTREC FROM P491-LINE02.                                  
           WRITE P492-PRTREC FROM P491-LINE03.                                  
                                                                                
           WRITE P492-PRTREC FROM P491-LINE04 AFTER 4.                          
           WRITE P492-PRTREC FROM P491-LINE04B.                                 
           WRITE P492-PRTREC FROM P491-LINE04C.                                 
           WRITE P492-PRTREC FROM P491-LINE04D.                                 
                                                                                
           WRITE P492-PRTREC FROM P491-LINE05.                                  
           WRITE P492-PRTREC FROM P491-LINE05B.                                 
           WRITE P492-PRTREC FROM P491-LINE05C.                                 
           WRITE P492-PRTREC FROM PECD-LINE06 AFTER 2.                          
                                                                                
           WRITE P492-PRTREC FROM PECD-LINE07 AFTER 6.                          
                                                                                
      *    WRITE P492-PRTREC FROM PECD-LINE08 AFTER 2.                          
      *    WRITE P492-PRTREC FROM PECD-LINE09 AFTER 3.                          
           WRITE P492-PRTREC FROM PECD-LINE10Q AFTER 7.                         
                                                                                
           WRITE P492-PRTREC FROM PECD-FT-OIC AFTER 12.                         
                                                                                
      * FILE COPY                                                               
      *-------------------------------------------------------------            
           MOVE  SPACES              TO P491B-PRTREC.                           
                                                                                
           WRITE P492B-PRTREC FROM P491-LINE01 AFTER PAGE.                      
           WRITE P492B-PRTREC FROM P491-LINE02.                                 
           WRITE P492B-PRTREC FROM P491-LINE03.                                 
                                                                                
           WRITE P492B-PRTREC FROM P491-LINE04 AFTER 4.                         
           WRITE P492B-PRTREC FROM P491-LINE04B.                                
           WRITE P492B-PRTREC FROM P491-LINE04C.                                
           WRITE P492B-PRTREC FROM P491-LINE04D.                                
                                                                                
           WRITE P492B-PRTREC FROM P491-LINE05.                                 
           WRITE P492B-PRTREC FROM P491-LINE05B.                                
           WRITE P492B-PRTREC FROM P491-LINE05C.                                
           WRITE P492B-PRTREC FROM PECD-LINE06 AFTER 2.                         
                                                                                
           WRITE P492B-PRTREC FROM PECD-LINE07 AFTER 6.                         
                                                                                
      *    WRITE P492B-PRTREC FROM PECD-LINE08 AFTER 2.                         
      *    WRITE P492B-PRTREC FROM PECD-LINE09 AFTER 3.                         
           WRITE P492B-PRTREC FROM PECD-LINE10Q AFTER 7.                        
                                                                                
           WRITE P492B-PRTREC FROM PECD-FT-OIC AFTER 12.                        
                                                                                
       3150-EXIT.                                                               
            EXIT.                                                               
                                                                                
       3200-PRINT-AUDIT.                                                        
      *-------------------------------------------------------------            
           IF WS-LINE-CNT > 55                                                  
           OR WS-PREV-BLK-NO NOT = F110-BLK-NO                                  
              PERFORM 6000-PRINT-HEADING THRU 6000-EXIT                         
           END-IF.                                                              
                                                                                
           ADD 2                TO WS-LINE-CNT.                                 
           ADD 1                TO WS-BLK-CNT.                                  
                                                                                
           MOVE SPACES          TO L491-PRTREC.                                 
           MOVE WS-BLK-CNT      TO L491-NO.                                     
           STRING F110-SCHEME '-' F110-ACC '-' F110-CHK '-'                     
                  F110-ACC-TYPE                                                 
                  DELIMITED BY SIZE INTO L491-SCH-ACC.                          
                                                                                
           MOVE F110-REGN-NO    TO L491-REGN-NO.                                
                                                                                
           PERFORM VARYING WS-IDX FROM 1 BY 1                                   
             UNTIL WS-NAME(WS-IDX) NOT = SPACES                                 
                OR WS-IDX > 4                                                   
              CONTINUE                                                          
           END-PERFORM.                                                         
                                                                                
           IF WS-IDX > 4                                                        
              MOVE 1            TO WS-IDX                                       
           END-IF.                                                              
           MOVE WS-NAME(WS-IDX) TO L491-NAME.                                   
           MOVE K800-NUM-NRIC1  TO L491-NRIC-NO.                                
           MOVE P491-BLK        TO L491-BLK-NO.                                 
           MOVE P491-STREET     TO L491-STREET.                                 
           MOVE P491-FLAT-NO    TO L491-FLAT-NO.                                
           MOVE P491-POSTAL     TO L491-POSTAL-CODE.                            
                                                                                
           WRITE L491-PRTREC FROM L491-DETAIL AFTER 2.                          
                                                                                
       3200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5000-RETRIEVE-CSM.                                                       
      *-------------------------------------------------------------            
           MOVE K800-NUM-REGN TO K022-NUM-REGN.                                 
           READ BP13K022 KEY IS K022-NUM-REGN.                                  
                                                                                
           IF K022-STATUS = 00                                                  
              MOVE K022-NUM-OIC TO K024-NUM-OIC                                 
              PERFORM 5100-READ-BP13K024 THRU 5100-EXIT                         
           ELSE                                                                 
           IF K022-STATUS = 23                                                  
              DISPLAY '> CSM FOR ' K022-NUM-REGN ' NOT FOUND.'                  
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K022, STATUS ' K022-STATUS             
              MOVE K022-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5100-READ-BP13K024.                                                      
      *-------------------------------------------------------------            
           READ BP13K024 KEY IS K024-KEY-FLD.                                   
                                                                                
           IF K024-STATUS = 00                                                  
              MOVE K024-NME-OIC TO P491-NME-OIC                                 
      **KAC1 CHANGE TO HARDCODED                                                
      ***     MOVE K024-NUM-DID TO P491-OIC-TEL                                 
           ELSE                                                                 
           IF K024-STATUS = 23                                                  
              DISPLAY '> CSM DETAIL OF ' K024-NUM-OIC ' FOR '                   
                      K022-NUM-REGN ' NOT FOUND.'                               
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K024, STATUS ' K024-STATUS             
              MOVE K024-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       5100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       6000-PRINT-HEADING.                                                      
      *-------------------------------------------------------------            
           ADD  1                    TO WS-PAGE-CNT.                            
           MOVE WS-PAGE-CNT          TO L491-PAGE.                              
           MOVE F110-BLK-NO          TO L491-BLOCK.                             
           MOVE COMM8-NME-STREET     TO L491-STREET-NAME.                       
                                                                                
           MOVE  8                   TO WS-LINE-CNT.                            
                                                                                
           IF WS-PREV-BLK-NO  NOT = F110-BLK-NO                                 
              ADD WS-BLK-CNT         TO WS-TOTAL-CNT                            
              INITIALIZE                WS-BLK-CNT                              
           END-IF.                                                              
           MOVE F110-BLK-NO          TO WS-PREV-BLK-NO.                         
                                                                                
           MOVE SPACES               TO L491-PRTREC.                            
           WRITE L491-PRTREC         FROM L491-HDR01 AFTER PAGE.                
           WRITE L491-PRTREC         FROM L491-HDR02.                           
           WRITE L491-PRTREC         FROM L491-HDR03 AFTER 2.                   
           WRITE L491-PRTREC         FROM L491-HDR04 AFTER 2.                   
           MOVE ALL '='              TO L491-PRTREC.                            
           WRITE L491-PRTREC            AFTER 1.                                
                                                                                
       6000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       6500-CALL-AV02C015.                                                      
      *-------------------------------------------------------------            
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       8100-READ-K800.                                                          
      *-------------------------------------------------------------            
           READ BP13K800 KEY IS K800-NUM-REGN.                                  
                                                                                
           EVALUATE K800-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K800-MISS                 
                    DISPLAY 'K800 REC NOT FOUND : ' F110-REGN-NO                
                            ' ; ' F110-SCH-ACC-NO                               
                    SET WS-ERROR            TO TRUE                             
                    GO TO 8100-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K800-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K800, STATUS '                   
                             K800-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8200-READ-K820.                                                          
      *-------------------------------------------------------------            
           READ BP13K820 KEY IS K820-KEY-FLD.                                   
                                                                                
           EVALUATE K820-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    MOVE SPACES             TO K820-NME-OCCP                    
                    ADD  1                  TO WS-CNT-K820-MISS                 
                    DISPLAY 'K820 REC NOT FOUND : ' K800-NUM-REGN               
                    GO TO 8200-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K820-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K820, STATUS '                   
                             K820-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8300-READ-K830.                                                          
      *-------------------------------------------------------------            
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
                                                                                
           EVALUATE K830-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K830-MISS                 
                    DISPLAY 'REGN-NUM' K830-NUM-REGN                            
                    DISPLAY 'K830 REC NOT FOUND : ' K800-NUM-NRIC1              
                                                    K800-NUM-NRIC2              
                    SET WS-ERROR            TO TRUE                             
                    GO TO 8300-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K830-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K830, STATUS '                   
                             K830-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8300-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8400-READ-K510.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BM06K510 KEY IS K510-ESTCDE.                                    
                                                                                
           EVALUATE K510-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    MOVE K510-NT-NAME   TO  P491-NEWTOWN                        
                                            P491-NEWTOWN2                       
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K510-MISS                 
                    DISPLAY 'K510 REC NOT FOUND : ' K510-ESTCDE                 
                    GO TO 8400-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K510-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BM06K510, STATUS '                   
                             K510-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8400-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       8500-READ-K100.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BM06K100 KEY IS K100-KEY-FLD.                                   
                                                                                
           EVALUATE K820-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K100-MISS                 
                    DISPLAY 'K100 REC NOT FOUND : ' K100-KEY-FLD                
                    GO TO 8500-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K100-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BM06K100, STATUS '                   
                             K100-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       9900-HANDLE-ABEND.                                                       
      *-------------------------------------------------------------            
           DISPLAY ' '.                                                         
           DISPLAY '- BP13C494 CONTROL TOTAL -------------'.                    
           DISPLAY 'TOTAL BM06F110 RECS READ  = ' WS-CNT-F110-READ.             
           DISPLAY 'TOTAL LETTERS PRINTED     = ' WS-CNT-LETTER.                
           DISPLAY 'TOTAL MISSING K800 REC    = ' WS-CNT-K800-MISS.             
           DISPLAY 'TOTAL MISSING K820 REC    = ' WS-CNT-K820-MISS.             
           DISPLAY 'TOTAL MISSING K830 REC    = ' WS-CNT-K830-MISS.             
           DISPLAY 'TOTAL MISSING K510 REC    = ' WS-CNT-K510-MISS.             
           DISPLAY 'TOTAL MISSING K100 REC    = ' WS-CNT-K100-MISS.             
                                                                                
           CLOSE BP13K022                                                       
                 BP13K024                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 BM06F110                                                       
                 BP13P491                                                       
                 P13P491B                                                       
                 BP13L491.                                                      
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              MOVE K022-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K022 ' K022-STATUS                  
           END-IF.                                                              
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              MOVE K024-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K024-STATUS                  
           END-IF.                                                              
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              MOVE K800-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K800-STATUS                  
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              MOVE K820-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K820 ' K820-STATUS                  
           END-IF.                                                              
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              MOVE K830-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K830 ' K830-STATUS                  
           END-IF.                                                              
                                                                                
           IF K510-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K510 ' K510-STATUS                  
              MOVE K510-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K100-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K100 ' K100-STATUS                  
              MOVE K100-STATUS TO RETURN-CODE.                                  
                                                                                
           STOP RUN.                                                            
                                                                                
       9900-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       9999-WRAP-UP.                                                            
      *-------------------------------------------------------------            
           ADD WS-BLK-CNT                        TO WS-TOTAL-CNT.               
           MOVE WS-TOTAL-CNT                     TO L491-TOTAL.                 
           WRITE L491-PRTREC FROM L491-PRT-TOTAL AFTER 2.                       
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '- BP13C494 CONTROL TOTAL -------------'.                    
           DISPLAY ' TOTAL BM06F110 REC READ : ' WS-CNT-F110-READ.              
           DISPLAY ' TOTAL LETTERS PRINTED   : ' WS-CNT-LETTER.                 
           DISPLAY ' TOTAL MISSING K800 REC  : ' WS-CNT-K800-MISS.              
           DISPLAY ' TOTAL MISSING K820 REC  : ' WS-CNT-K820-MISS.              
           DISPLAY ' TOTAL MISSING K830 REC  : ' WS-CNT-K830-MISS.              
           DISPLAY ' TOTAL MISSING K510 REC  : ' WS-CNT-K510-MISS.              
           DISPLAY ' TOTAL MISSING K100 REC  : ' WS-CNT-K100-MISS.              
                                                                                
           CLOSE BP13K022                                                       
                 BP13K024                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 BM06K510                                                       
                 BM06K100                                                       
                 BM06F110                                                       
                 BP13P491                                                       
                 P13P491B                                                       
                 BP13P492                                                       
                 P13P492B                                                       
                 BP13L491.                                                      
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K022 ' K022-STATUS                  
              MOVE K022-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K024 ' K024-STATUS                  
              MOVE K024-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K800-STATUS                  
              MOVE K800-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K820 ' K820-STATUS                  
              MOVE K820-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K830 ' K830-STATUS                  
              MOVE K830-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K510-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K510 ' K510-STATUS                  
              MOVE K510-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K100-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K100 ' K100-STATUS                  
              MOVE K100-STATUS TO RETURN-CODE.                                  
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
            EXIT.                                                               
