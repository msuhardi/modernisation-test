      ***************************                                               
       IDENTIFICATION DIVISION.                                                 
      ***************************                                               
       PROGRAM-ID.    BP13C08B.                                                 
      *AUTHOR.        ELAINE S ARGA.                                            
      *DATE-WRITTEN.  23 OCTOBER 2014.                                          
      * ========================================================== *            
      * SYSTEM OF COMMITMENT  (BP13)                               *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE   : 1.  PRINT SUCC CONTROL LISTING FOR BE'02    *            
      *                                                            *            
      *  INPUT FILES : 1.  BP13F200  -  SOC REQ FILE               *            
      *                2.  BP13K825  -  OCCUPIER FILE              *            
      *                3.  BP13K830  -  ADDRESS FILE               *            
      *                4.  BP13K060  -  CODE TRANSCRIPTION         *            
      *                                                            *            
      *  LISTINGS    : 1.  BP13L082  - CONTROL LISTING FOR SUCC    *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * CHG REF  BY     DATE   DESCRIPTION                         *            
      * -------- ---  -------- ----------------------------------- *            
      * BP135517 ESA1 20141023 NEW PROGRAM MODELLED AFTER BP13C082 *            
      * ========================================================== *            
                                                                                
      ***********************                                                   
       ENVIRONMENT DIVISION.                                                    
      ***********************                                                   
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F200  ASSIGN       TO BP13F200.                           
                                                                                
           SELECT BP13K800  ASSIGN       TO BP13K800                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K800-NUM-REGN                       
                            FILE STATUS  IS WS-K800-STATUS.                     
                                                                                
           SELECT BP13K825  ASSIGN       TO BP13K825                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K825-KEY-FLD                        
                            FILE STATUS  IS WS-K825-STATUS.                     
                                                                                
           SELECT BP13K830  ASSIGN       TO BP13K830                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K830-KEY-FLD                        
                            FILE STATUS  IS WS-K830-STATUS.                     
                                                                                
           SELECT BP13K060  ASSIGN       TO BP13K060                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K060-KEY-FLD                        
                            FILE STATUS  IS WS-K060-STATUS.                     
                                                                                
           SELECT BP13L082  ASSIGN       TO BP13L082.                           
                                                                                
      *****************                                                         
       DATA DIVISION.                                                           
      *****************                                                         
       FILE SECTION.                                                            
                                                                                
       FD   BP13F200                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY BP13F200.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   BP13K060                                                            
            RECORD CONTAINS 25 CHARACTERS.                                      
       COPY BP13K060.                                                           
                                                                                
       FD  BP13L082                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  L082-PRT-REC                     PIC X(132).                         
                                                                                
      *------------------------*                                                
       WORKING-STORAGE SECTION.                                                 
      *------------------------*                                                
       COPY PRIOSCH.                                                            
                                                                                
       01  WS-STATUS.                                                           
           05  BP13F200-STATUS              PIC 99    VALUE ZEROS.              
           05  WS-K825-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K800-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K830-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K060-STATUS               PIC 99    VALUE ZEROS.              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F200-NOT-FND              PIC 9(06)  VALUE ZEROS.             
           05  WS-F200-READ-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-LETTERS-SUCC          PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-PAGE-L082             PIC 9(04)  VALUE ZEROS.             
           05  WS-CNT-LINE-L082             PIC 9(06)  VALUE 60.                
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-F200-EOF                  PIC X(01) VALUE 'N'.                
           05  WS-BALLOT-SW                 PIC X(02).                          
           05  WS-K825-NME-OCCP             PIC X(66) VALUE SPACES.             
           05  WS-ALLOCSCH-TYPE             PIC X(03) VALUE SPACES.             
           05  WS-PREV-L082-FLAT            PIC X(02) VALUE SPACES.             
           05  WS-PREV-L082-NT1             PIC X(03) VALUE SPACES.             
                                                                                
       01  WS-DATE-VARIABLES.                                                   
           05  WS-DATE.                                                         
               10  WS-CCYY                  PIC 9(4)  VALUE 0000.               
               10  WS-MM                    PIC 99    VALUE 00.                 
               10  WS-DD                    PIC 99    VALUE 00.                 
           05  WS-CURR-DATE                 PIC 9(08) VALUE ZEROES.             
                                                                                
       01  WS-DEFAULT.                                                          
           05  WS-MAX-LINES-L082            PIC 9(2)   VALUE 37.                
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR CONTROL LISTING                         *            
      *------------------------------------------------------------*            
                                                                                
       01  L082-HDG1.                                                           
           05  L082-LISTING             PIC X(14) VALUE 'BP13L082'.             
           05  FILLER                   PIC X(8)  VALUE 'HDB3'.                 
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(39) VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'DATE: '.               
           05  L082-DATE                PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE ' PAGE: '.              
           05  L082-PAGE                PIC ZZZZ9.                              
                                                                                
       01  L082-HDG2.                                                           
           05  FILLER                   PIC X(95) VALUE SPACES.                 
           05  FILLER                   PIC X(32) VALUE                         
               'SALES UNIT (APPLICATION TEAM)'.                                 
                                                                                
       01  L082-HDG3.                                                           
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  L082-LISTING-TYPE        PIC X(50) VALUE                         
              'CONTROL LIST FOR SUCCESSFUL LETTER '.                            
                                                                                
       01  L082-HDG4.                                                           
           05  FILLER                   PIC X(7)  VALUE ' S/N   '.              
           05  FILLER                   PIC X(9)  VALUE 'REF-NO   '.            
           05  FILLER                   PIC X(15) VALUE                         
               'APPLICANT NAMES'.                                               
           05  FILLER                   PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE '  UIN  '.              
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE 'CAT  '.                
           05  FILLER                   PIC X(5)  VALUE 'ALLOC'.                
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'FLAT'.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'HHTY   '.              
           05  FILLER                   PIC X(4)  VALUE 'MCPS'.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'RES-HA1'.              
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'SUCC'.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'NT1   '.               
           05  FILLER                   PIC X(6)  VALUE 'LOAN /'.               
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'BALLOT'.               
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(2)  VALUE 'ZE'.                   
                                                                                
       01  L082-HDG5.                                                           
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE 'REGN-NO'.              
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'SCH'.                  
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'TYPE'.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE '    '.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE '       '.              
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE '     '.                
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'ZONE   '.              
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE '   '.                  
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'ORIG'.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'POS'.                  
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'Q-POS'.                
                                                                                
       01  L082-HDG6.                                                           
           05  FILLER                   PIC X(7)  VALUE '       '.              
           05  FILLER                   PIC X(9)  VALUE 'LOAN-TAG '.            
           05  FILLER                   PIC X(15) VALUE                         
               'REQ-STATUS     '.                                               
                                                                                
       01  L082-HDG7.                                                           
           05  FILLER                   PIC X(132) VALUE ALL '='.               
                                                                                
       01  L082-DTL-1.                                                          
           05  L082-SERIAL-NO           PIC ZZZ9.                               
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-REF-NO              PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-NAME                PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-NRIC-1              PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-CAT                 PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-ALLOC               PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L082-FLAT                PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  L082-HHTY                PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L082-MCPS                PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(9)  VALUE SPACES.                 
           05  L082-RES-HA1             PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  L082-SUCC                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L082-NT1                 PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  L082-LOAN                PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE '/'.                    
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  L082-ORIG-LOAN           PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  L082-BALLOT-POS          PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-ZONE                PIC X(2)  VALUE SPACES.                 
                                                                                
       01  L082-DTL-2.                                                          
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  L082-REGN-NO             PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-NAME2               PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-NRIC-2              PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(79) VALUE SPACES.                 
           05  L082-QUEUE               PIC X(5)  VALUE SPACES.                 
                                                                                
       01  L082-DTL-3.                                                          
           05  FILLER                   PIC X(16) VALUE SPACES.                 
           05  L082-BLK                 PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-UNIT                PIC X(11) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L082-ADDR2               PIC X(65) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-ADDR3               PIC X(20) VALUE SPACES.                 
                                                                                
       01  L082-DTL-4.                                                          
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-LOAN-TAG            PIC X(6)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L082-REQ-STATUS          PIC X(22) VALUE SPACES.                 
                                                                                
      *===================*                                                     
       PROCEDURE DIVISION.                                                      
      *===================*                                                     
       0000-MAIN-ROUTINE.                                                       
      *===================*                                                     
                                                                                
           PERFORM 1000-OPEN-FILES             THRU 1000-EXIT.                  
           PERFORM 3000-PROCESS-RECORDS        THRU 3000-EXIT                   
                       UNTIL WS-F200-EOF = 'Y'.                                 
           PERFORM 9000-CLOSE-ROUTINE          THRU 9000-EXIT.                  
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *================*                                                        
       1000-OPEN-FILES.                                                         
      *================*                                                        
           OPEN INPUT BP13F200                                                  
                      BP13K800                                                  
                      BP13K825                                                  
                      BP13K830                                                  
                      BP13K060                                                  
               OUTPUT BP13L082.                                                 
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K825 STATUS IS ' WS-K825-STATUS            
              MOVE     WS-K825-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K800 STATUS IS ' WS-K800-STATUS            
              MOVE     WS-K800-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K830 STATUS IS ' WS-K830-STATUS            
              MOVE     WS-K830-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K060-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K060 STATUS IS ' WS-K060-STATUS            
              MOVE     WS-K060-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-DATE WS-CURR-DATE.             
           STRING WS-DD '/'                                                     
                  WS-MM '/'                                                     
                  WS-CCYY DELIMITED BY SIZE                                     
                  INTO L082-DATE.                                               
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=====================*                                                   
       3000-PROCESS-RECORDS.                                                    
      *=====================*                                                   
                                                                                
           PERFORM 4000-READ-BP13F200     THRU 4000-EXIT.                       
           PERFORM 4500-MOVE-DETAILS      THRU 4500-EXIT                        
                   UNTIL WS-F200-EOF = 'Y'.                                     
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===================*                                                     
       4000-READ-BP13F200.                                                      
      *===================*                                                     
            READ BP13F200                                                       
                 AT END MOVE 'Y'  TO  WS-F200-EOF                               
                        GO TO 4000-EXIT.                                        
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==================*                                                      
       4500-MOVE-DETAILS.                                                       
      *==================*                                                      
                                                                                
           MOVE SPACES                    TO K825-KEY-FLD.                      
                                                                                
           MOVE F200-NUM-REGN             TO K825-NUM-REGN                      
                                                                                
           MOVE F200-NUM-NRIC1            TO K825-NUM-NRIC.                     
                                                                                
           PERFORM  4600-READ-K825      THRU 4600-EXIT.                         
           MOVE     WS-K825-NME-OCCP      TO L082-NAME.                         
                                                                                
           IF F200-NUM-NRIC2 (2:1) = '#' OR SPACES OR LOW-VALUES                
              MOVE SPACES                    TO L082-NAME2                      
           ELSE                                                                 
              MOVE SPACES                    TO K825-KEY-FLD                    
              MOVE F200-NUM-REGN             TO K825-NUM-REGN                   
              MOVE F200-NUM-NRIC2            TO K825-NUM-NRIC                   
              PERFORM  4600-READ-K825        THRU 4600-EXIT                     
              MOVE     WS-K825-NME-OCCP      TO L082-NAME2                      
           END-IF.                                                              
                                                                                
           PERFORM  4700-GET-ADDR      THRU  4700-EXIT.                         
           PERFORM  6130-READ-K800     THRU  6130-EXIT.                         
           PERFORM  7000-CHECK-SCH     THRU  7000-EXIT.                         
                                                                                
           PERFORM 6000-PRINT-CONTROL-LIST  THRU 6000-EXIT.                     
                                                                                
           ADD 1 TO WS-F200-READ-CTR.                                           
           PERFORM 4000-READ-BP13F200    THRU 4000-EXIT.                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===============*                                                         
       4600-READ-K825.                                                          
      *===============*                                                         
           MOVE    SPACES                TO  WS-K825-NME-OCCP                   
           READ BP13K825.                                                       
                                                                                
           IF WS-K825-STATUS = 00 OR 02                                         
              MOVE    K825-NME-OCCP      TO  WS-K825-NME-OCCP                   
           ELSE                                                                 
           IF WS-K825-STATUS = 23                                               
              DISPLAY 'K825 REC NOT FOUND : '   K825-KEY-FLD                    
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K825 = '   WS-K825-STATUS              
                      ', K825-KEY-FLD = '   K825-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==============*                                                          
       4700-GET-ADDR.                                                           
      *==============*                                                          
           MOVE SPACES            TO    K830-KEY-FLD                            
                                        L082-DTL-3.                             
                                                                                
           MOVE F200-NUM-REGN     TO    K830-KEY-FLD(1:8).                      
           READ BP13K830.                                                       
                                                                                
           IF WS-K830-STATUS = 00                                               
              IF (K830-NUM-MAIL-ADDR =  SPACES OR LOW-VALUES) OR                
                 ((K830-NUM-MAIL-LVL-CHAR =  '#') AND                           
                 (K830-NUM-MAIL-LVL-NUM =  SPACES OR LOW-VALUES))               
                 MOVE K830-NUM-BLK         TO L082-BLK                          
                 IF K830-NUM-LVL-NUM = SPACES AND                               
                    K830-NUM-HSEMAIN = SPACES                                   
                    MOVE SPACES            TO L082-UNIT                         
                 ELSE                                                           
                    MOVE K830-NUM-FLAT     TO L082-UNIT                         
                 END-IF                                                         
                 MOVE K830-NME-STREET-BLDG(1:47) TO L082-ADDR2                  
                 IF K830-NUM-POSTAL  = SPACES OR LOW-VALUES OR ZEROES           
                    MOVE SPACES            TO L082-ADDR3                        
                    DISPLAY ' RES POSTAL CDE IS ' K830-NUM-POSTAL               
                            ' FOR REC KEY-FLD ' K830-KEY-FLD                    
                 ELSE                                                           
                    STRING 'SINGAPORE '  K830-NUM-POSTAL                        
                       DELIMITED BY SIZE INTO L082-ADDR3                        
                 END-IF                                                         
              ELSE                                                              
                 MOVE K830-NUM-MAIL-BLK        TO L082-BLK                      
                 IF K830-NUM-MAIL-LVL-NUM = SPACES AND                          
                    K830-NUM-MAIL-HSEMAIN = SPACES                              
                    MOVE SPACES                TO L082-UNIT                     
                 ELSE                                                           
                    MOVE K830-NUM-MAIL-FLAT    TO L082-UNIT                     
                 END-IF                                                         
                 MOVE K830-NME-MAIL-STR-BLDG(1:47) TO L082-ADDR2                
                 IF K830-NUM-MAIL-POSTAL = SPACES OR LOW-VALUES OR ZEROS        
                    MOVE SPACES                TO L082-ADDR3                    
                    DISPLAY ' MAIL POSTAL CDE IS ' K830-NUM-POSTAL              
                            ' FOR REC KEY-FLD ' K830-KEY-FLD                    
                 ELSE                                                           
                    STRING 'SINGAPORE '      K830-NUM-MAIL-POSTAL               
                           DELIMITED BY SIZE INTO L082-ADDR3                    
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
           IF WS-K830-STATUS = 23                                               
              DISPLAY 'BP13K830 RECORD NOT FOUND = ' WS-K830-STATUS             
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K830 = ' WS-K830-STATUS                
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT.                        
                                                                                
       4700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *========================*                                                
       6000-PRINT-CONTROL-LIST.                                                 
      *========================*                                                
      *-----------------------------------------------------------*             
      *    PRINT CONTROL LISTING FOR SUCCESSFUL APPLICANTS                      
      *-----------------------------------------------------------*             
                                                                                
           MOVE F200-NUM-REF              TO    L082-REF-NO.                    
           MOVE F200-NUM-REGN             TO    L082-REGN-NO.                   
           MOVE F200-NUM-NRIC1            TO    L082-NRIC-1.                    
           MOVE F200-NUM-NT-ZONE          TO    L082-NT1.                       
           MOVE K800-NUM-HOUSEHOLD        TO    L082-HHTY.                      
           MOVE K800-CDE-MCPS             TO    L082-MCPS.                      
           MOVE SPACES                    TO    L082-RES-HA1.                   
           MOVE K800-NUM-FLAT-TYPE        TO    L082-FLAT.                      
           MOVE K800-NUM-ALLO-SCHEME      TO    L082-ALLOC.                     
           MOVE K800-NUM-CAT              TO    L082-CAT.                       
           MOVE K800-NUM-BTO-ZONE         TO    L082-SUCC.                      
           MOVE K800-NUM-ZONE             TO    L082-ZONE.                      
           IF F200-NUM-NRIC2 (2:1) NOT = '#'                                    
              MOVE F200-NUM-NRIC2         TO    L082-NRIC-2                     
           ELSE                                                                 
              MOVE SPACES                 TO    L082-NRIC-2.                    
           MOVE K800-NUM-NT-FT-QUEUE      TO    L082-QUEUE.                     
           MOVE SPACES                    TO    L082-BALLOT-POS.                
           MOVE K800-NUM-LOAN-TAG         TO    L082-LOAN-TAG.                  
           MOVE K800-NUM-BALLOT-STATUS    TO    L082-REQ-STATUS.                
                                                                                
           IF WS-ALLOCSCH-TYPE = 'CCC'                                          
              CONTINUE                                                          
           ELSE                                                                 
              PERFORM 6100-PRINT-CONTROL-SUCC THRU  6100-EXIT                   
           END-IF.                                                              
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *========================*                                                
       6100-PRINT-CONTROL-SUCC.                                                 
      *========================*                                                
           MOVE 'BP13L082'             TO L082-LISTING.                         
           MOVE 'CONTROL LIST FOR SUCCESSFUL LETTER '                           
                                       TO L082-LISTING-TYPE.                    
           ADD    1                    TO WS-CNT-LETTERS-SUCC.                  
           MOVE   WS-CNT-LETTERS-SUCC  TO L082-SERIAL-NO.                       
                                                                                
           IF (WS-CNT-LINE-L082 > WS-MAX-LINES-L082) OR                         
              ((L082-FLAT NOT = WS-PREV-L082-FLAT)  AND                         
               (L082-FLAT NOT = '4P' AND '5P' AND 'SP')) OR                     
              (L082-NT1 NOT = WS-PREV-L082-NT1)                                 
                                                                                
              IF ((L082-FLAT NOT = WS-PREV-L082-FLAT) AND                       
                 (L082-FLAT NOT = '4P' AND '5P' AND 'SP')) OR                   
                 (L082-NT1 NOT = WS-PREV-L082-NT1)                              
                  MOVE 1                   TO WS-CNT-LETTERS-SUCC               
                  MOVE WS-CNT-LETTERS-SUCC TO L082-SERIAL-NO                    
              END-IF                                                            
                                                                                
              ADD  1                   TO WS-CNT-PAGE-L082                      
              MOVE 1                   TO WS-CNT-LINE-L082                      
              MOVE WS-CNT-PAGE-L082    TO L082-PAGE                             
              WRITE L082-PRT-REC       FROM L082-HDG1 AFTER PAGE                
                                                                                
              WRITE L082-PRT-REC       FROM L082-HDG2 AFTER 1                   
              WRITE L082-PRT-REC       FROM L082-HDG3 AFTER 2                   
              WRITE L082-PRT-REC       FROM L082-HDG4 AFTER 2                   
              WRITE L082-PRT-REC       FROM L082-HDG5 AFTER 1                   
              WRITE L082-PRT-REC       FROM L082-HDG6 AFTER 1                   
              WRITE L082-PRT-REC       FROM L082-HDG7 AFTER 1                   
                                                                                
              MOVE  SPACES             TO   L082-PRT-REC                        
              WRITE L082-PRT-REC                                                
           END-IF.                                                              
                                                                                
           PERFORM 6200-PRINT-DETAIL    THRU 6200-EXIT.                         
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *==================*                                                      
       6200-PRINT-DETAIL.                                                       
      *==================*                                                      
                                                                                
           WRITE   L082-PRT-REC         FROM  L082-DTL-1 AFTER 1.               
           WRITE   L082-PRT-REC         FROM  L082-DTL-2 AFTER 1.               
           WRITE   L082-PRT-REC         FROM  L082-DTL-3 AFTER 1.               
           WRITE   L082-PRT-REC         FROM  L082-DTL-4 AFTER 1.               
           MOVE    SPACES               TO    L082-PRT-REC.                     
           WRITE   L082-PRT-REC.                                                
           ADD     4                    TO    WS-CNT-LINE-L082.                 
                                                                                
           MOVE L082-FLAT               TO    WS-PREV-L082-FLAT.                
           MOVE L082-NT1                TO    WS-PREV-L082-NT1.                 
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===============*                                                         
       6130-READ-K800.                                                          
      *===============*                                                         
           MOVE F200-NUM-REGN          TO K800-NUM-REGN.                        
           READ BP13K800.                                                       
                                                                                
           IF WS-K800-STATUS = 00 OR 02                                         
              MOVE    K800-NUM-LOAN-TAG      TO  L082-LOAN                      
              MOVE    K800-NUM-ORIG-LOAN-TAG TO  L082-ORIG-LOAN                 
           ELSE                                                                 
           IF WS-K800-STATUS = 23                                               
              DISPLAY 'K800 REC NOT FOUND : '   K800-NUM-REGN                   
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K800 = '   WS-K800-STATUS              
                      ', K800-NUM-REGN = '   K800-NUM-REGN                      
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
                                                                                
       6130-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===============*                                                         
       7000-CHECK-SCH.                                                          
      *===============*                                                         
                                                                                
           SET WS-ALLOC-PTR TO 1.                                               
                                                                                
           SEARCH WS-ALLOC-SCH                                                  
               AT END MOVE 'XXX' TO WS-ALLOCSCH-TYPE                            
             WHEN K800-NUM-ALLO-SCHEME = WS-ALLOC-SCH-DESP(WS-ALLOC-PTR)        
             MOVE WS-MAIN-SCH-CD(WS-ALLOC-PTR) TO WS-ALLOCSCH-TYPE.             
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===================*                                                     
       9000-CLOSE-ROUTINE.                                                      
      *===================*                                                     
           DISPLAY ' '.                                                         
           DISPLAY ' ====  BP13C082 CONTROL TOTALS  ======'.                    
           DISPLAY ' '.                                                         
           DISPLAY ' F200 RECORDS READ          : ' WS-F200-READ-CTR.           
           DISPLAY ' '.                                                         
           DISPLAY ' ====================================='.                    
                                                                                
           CLOSE BP13F200                                                       
                 BP13K825                                                       
                 BP13K800                                                       
                 BP13K830                                                       
                 BP13K060                                                       
                 BP13L082.                                                      
                                                                                
           IF WS-K825-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K825-STAT ' WS-K825-STATUS.            
                                                                                
           IF WS-K800-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K800-STAT ' WS-K800-STATUS.            
                                                                                
           IF WS-K830-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K830-STAT ' WS-K830-STATUS.            
                                                                                
           IF WS-K060-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR BP13K060-STAT ' WS-K830-STATUS.            
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
