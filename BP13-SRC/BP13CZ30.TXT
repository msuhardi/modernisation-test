       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CZ30.                                                 
      *AUTHOR.        IRVIN CHING.                                              
      *DATE-WRITTEN.  15/10/2014.                                               
      *========================================================*                
      * SYSTEM OF COMMITMENT (BP13)                            *                
      *========================================================*                
      *    OBJECTIVE :                                         *                
      *      2. FOR VALID MCPS CASES, SYSTEM FUTHER CHECK      *                
      *         TAG NUM-MCPS=B IF PARENT BUY RIGHT SIZE FLAT   *                
      *         AND MOVE FROM MATURE ESTATE TO NON-MATURE EST. *                
      *         APPLICANTS OR SPOUSE MUST BE EXISTING LESSEE   *                
      *         BYPASS ELIG-SCH=FS                             *                
      *         AT TIME OF APPLICATION                         *                
      *         BP13F730 - FT=2,3 IN NON-MATURE ESTATE         *                
      *         AB03K030 - FOUND IN SMS LESSEE                 *                
      *                    BYPASS STUDIO APARTMENT FT=01,02    *                
      *                           DESIGN MODEL = 80,89         *                
      *                    BYPASS IF UNIT FOUND IN MATURE EST  *                
      *--------------------------------------------------------*                
      * CHG-NO    BY  DATE    DESCRIPTION                      *                
      * -------- ---  ------  -----------                      *                
      * BP135534 IMC1 210814  NEW PROGRAM                      *                
      * BP135534 IMC1 111014  ALLOW SA FLATS                   *                
      * BP135532 SMR2 181114  MCPS=B NOT APPLICABLE WHEN PARENT*                
      *                       APPLY SA                         *                
      * BP135838 ESA1 010715  TO CATER FOR MODL-DESIGN = '92'  *                
      *--------------------------------------------------------*                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13F730 ASSIGN          TO BP13F730.                         
                                                                                
           SELECT AB03K080 ASSIGN          TO AB03K080                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS DYNAMIC                           
                           RECORD KEY      IS K080-KEY                          
                           FILE STATUS     IS WS-AB03K080-STATUS.               
                                                                                
           SELECT AB03K030 ASSIGN          TO AB03K030                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS DYNAMIC                           
                           RECORD KEY      IS K030-NUM-HDB-REF                  
                           FILE STATUS     IS WS-AB03K030-STATUS.               
                                                                                
           SELECT BP13K825 ASSIGN          TO BP13K825                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS DYNAMIC                           
                           RECORD KEY      IS K825-KEY-FLD                      
                           FILE STATUS     IS WS-BP13K825-STATUS.               
                                                                                
           SELECT BP13K80A ASSIGN          TO BP13K80A                          
                           ACCESS MODE     IS DYNAMIC                           
                           ORGANIZATION    IS INDEXED                           
                           RECORD KEY      IS K80A-KEY-FLD                      
                           FILE STATUS     IS WS-BP13K80A-STATUS.               
                                                                                
           SELECT BP13K813 ASSIGN          TO BP13K813                          
                           ACCESS MODE     IS DYNAMIC                           
                           ORGANIZATION    IS INDEXED                           
                           RECORD KEY      IS K813-KEY-FLD                      
                           FILE STATUS     IS WS-BP13K813-STATUS.               
                                                                                
           SELECT AB03K700 ASSIGN          TO AB03K700                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS RANDOM                            
                           RECORD KEY      IS K700-NUM-HDB-REF                  
                           FILE STATUS     IS WS-AB03K700-STATUS.               
                                                                                
           SELECT BM06K510 ASSIGN          TO BM06K510                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS RANDOM                            
                           RECORD KEY      IS K510-ESTCDE                       
                           FILE STATUS     IS WS-BM06K510-STATUS.               
                                                                                
           SELECT BP13K730 ASSIGN          TO BP13K730                          
                           ACCESS MODE     IS DYNAMIC                           
                           ORGANIZATION    IS INDEXED                           
                           RECORD KEY      IS K730-KEY-NEW                      
                           FILE STATUS     IS WS-BP13K730-STATUS.               
                                                                                
           SELECT BP13LZ30 ASSIGN          TO BP13LZ30.                         
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F730.                                                           
       COPY BP13F730.                                                           
                                                                                
       FD   AB03K080.                                                           
       COPY AB03K080.                                                           
                                                                                
       FD   AB03K030.                                                           
       COPY AB03K030.                                                           
                                                                                
       FD   BP13K730                                                            
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BP13K730.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS  200 CHARACTERS.                                    
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K80A                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K80A.                                                           
                                                                                
       FD   BP13K813                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K813.                                                           
                                                                                
       FD   BM06K510                                                            
            RECORD CONTAINS 60  CHARACTERS.                                     
       COPY BM06K510.                                                           
                                                                                
       FD   AB03K700                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY AB03K700.                                                           
                                                                                
       FD   BP13LZ30                                                            
            RECORD CONTAINS 130 CHARACTERS                                      
            LABEL  RECORDS ARE  STANDARD                                        
            RECORDING MODE IS F.                                                
       01   BP13LZ30-REC      PIC X(130).                                       
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  WS-FILE-STATUS.                                                      
           05  WS-BM06K110-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-BP13K80A-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-BP13K825-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-BP13K813-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-BP13K730-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-BM06K510-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-AB03K030-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-AB03K080-STATUS   PIC 9(2)    VALUE ZEROES.                   
           05  WS-AB03K700-STATUS   PIC 9(2)    VALUE ZEROES.                   
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-F730-READ          PIC 9(8)    VALUE ZEROES.                   
           05 WS-CNT                PIC 9(8)    VALUE ZEROES.                   
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-SMS-FND           PIC X(1)     VALUE SPACES.                  
           05  WS-K730-FND          PIC X(1)     VALUE SPACES.                  
           05  WS-K825-FND          PIC X(1)     VALUE SPACES.                  
           05  WS-K825-EOF          PIC X(1)     VALUE SPACES.                  
                                                                                
       01  WS-WORKING-FIELDS.                                                   
           05  WS-NUM-REGN          PIC X(8)     VALUE SPACES.                  
           05  WS-NUM-NRIC          PIC X(9)     VALUE SPACES.                  
           05  WS-NUM-NRIC-FND      PIC X(9)     VALUE SPACES.                  
           05  WS-NUM-RELATIONSHIP  PIC X(2)     VALUE SPACES.                  
           05  WS-NUM-HDB-REF       PIC X(11)    VALUE SPACES.                  
           05  WS-CDE-SALES-TYP     PIC X(2)     VALUE SPACES.                  
           05  WS-K730-UPDATE       PIC X(1)     VALUE SPACES.                  
           05  WS-NUM-MCPS          PIC X(3)     VALUE SPACES.                  
           05  WS-REMARK            PIC X(8)     VALUE SPACES.                  
           05  WS-NUM-NRIC1-AGE     PIC X(3)     VALUE SPACES.                  
           05  WS-NUM-NRIC2-AGE     PIC X(3)     VALUE SPACES.                  
           05  WS-NUM-NRIC3-AGE     PIC X(3)     VALUE SPACES.                  
           05  WS-NUM-NRIC4-AGE     PIC X(3)     VALUE SPACES.                  
           05  WS-CNT-NOT-FND       PIC 9(5)     VALUE ZEROES.                  
           05  WS-CNT-SALES         PIC 9(5)     VALUE ZEROES.                  
           05  WS-CNT-NO-SCH        PIC 9(5)     VALUE ZEROES.                  
           05  WS-SNO               PIC 9(5)     VALUE ZEROES.                  
           05  WS-CNT-WRITE         PIC 9(5)     VALUE ZEROES.                  
           05  WS-SALE-EFF-MONTH    PIC 9(5)     VALUE ZEROES.                  
           05  WS-ACCEPT-MONTH      PIC 9(5)     VALUE ZEROES.                  
           05  WS-NUM-MONTH         PIC 9(5)     VALUE ZEROES.                  
           05  WS-SMS-FT            PIC 9(1)     VALUE ZEROES.                  
           05  WS-NUM-FT            PIC 9(1)     VALUE ZEROES.                  
           05  WS-AGE-APPL                 PIC 9(3)       VALUE ZEROES.         
           05  WS-AGE-SPOUSE               PIC 9(3)       VALUE ZEROES.         
           05  WS-AGE-FIANCEE              PIC 9(3)       VALUE ZEROES.         
           05  WS-F730-DTE-REQ.                                                 
               10  WS-F730-DTE-REQ-YR      PIC 9(4)       VALUE ZEROES.         
               10  WS-F730-DTE-REQ-MM      PIC 9(2)       VALUE ZEROES.         
               10  WS-F730-DTE-REQ-DD      PIC 9(2)       VALUE ZEROES.         
                                                                                
           05  WS-K825-DTE-BIRTH.                                               
               10  WS-K825-DTE-BIRTH-YR   PIC 9(4)        VALUE ZEROES.         
               10  WS-K825-DTE-BIRTH-MM   PIC 9(2)        VALUE ZEROES.         
               10  WS-K825-DTE-BIRTH-DD   PIC 9(2)        VALUE ZEROES.         
                                                                                
           05  WS-AGE                      PIC 9(03)      VALUE ZEROES.         
                                                                                
       01  WS-APPL-MARITAL-STATUS          PIC X  VALUE SPACES.                 
       01  WS-SPOUSE-MARITAL-STATUS        PIC X  VALUE SPACES.                 
                                                                                
       01  WS-SPOUSE-NUM-RELATIONSHIP      PIC X  VALUE SPACES.                 
           88 WS-SPOUSE-REL-TAG            VALUE  'Y'.                          
       01  WS-FIANCEE-NUM-RELATIONSHIP     PIC X  VALUE SPACES.                 
           88 WS-FIANCEE-REL-TAG           VALUE  'Y'.                          
                                                                                
       01  WS-DTE-CURRENT.                                                      
           05  WS-DTE-CURR-YYYY    PIC 9(4)      VALUE ZEROES.                  
           05  WS-DTE-CURR-MM      PIC 9(2)      VALUE ZEROES.                  
           05  WS-DTE-CURR-DD      PIC 9(2)      VALUE ZEROES.                  
                                                                                
       01  WS-DTE-ACCEPT.                                                       
           05  WS-DTE-ACCEPT-YYYY  PIC 9(4)      VALUE ZEROES.                  
           05  WS-DTE-ACCEPT-MM    PIC 9(2)      VALUE ZEROES.                  
                                                                                
       01  WS-EOF-SWITCHES.                                                     
           05  EOF-BP13F730         PIC X        VALUE 'N'.                     
           05  EOF-AB03K030         PIC X        VALUE 'N'.                     
           05  EOF-AB03K080         PIC X        VALUE 'N'.                     
                                                                                
       01  BP13LZ30-HEADER.                                                     
           05  FILLER               PIC X(20)    VALUE SPACES.                  
           05  FILLER               PIC X(51)    VALUE                          
               'DETERMINE MCPS=B PARENT MOVE OUT FROM MATURE ESTATE'.           
           05  FILLER               PIC X(5)     VALUE SPACES.                  
           05  LZ30-DTE-CURR-YYYY   PIC X(4)     VALUE SPACES.                  
           05  FILLER               PIC X(1)     VALUE '/'.                     
           05  LZ30-DTE-CURR-MM     PIC X(2)     VALUE SPACES.                  
           05  FILLER               PIC X(1)     VALUE '/'.                     
           05  LZ30-DTE-CURR-DD     PIC X(2)     VALUE SPACES.                  
                                                                                
       01  LZ30-FORMAT.                                                         
           05  LZ30-SNO             PIC X(5)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-REGN        PIC X(8)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NRIC1       PIC X(9)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NRIC2       PIC X(9)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NRIC3       PIC X(9)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NRIC4       PIC X(9)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NRIC-FND    PIC X(9)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-RELATIONSHIP PIC X(2)     VALUE SPACES.                 
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-FLAT-TYPE   PIC X(3)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-CDE-ELIG-SCH    PIC X(4)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-SMS-SCH-ACC     PIC X(11)    VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-SMS-FLAT-TYPE   PIC X(3)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-SMS-SALES-TYPE  PIC X(2)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-MCP         PIC X(3)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-NUM-NT          PIC X(3)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
           05  LZ30-HA-CHILD        PIC X(8)     VALUE SPACES.                  
           05  FILLER               PIC X        VALUE ';'.                     
                                                                                
       PROCEDURE DIVISION.                                                      
      *------------------------------------------------------------             
       0000-MAIN.                                                               
      *------------------------------------------------------------             
                                                                                
           OPEN INPUT  BP13F730                                                 
                       AB03K700                                                 
                       AB03K030                                                 
                       AB03K080                                                 
                       BM06K510                                                 
                       BP13K730                                                 
                       BP13K825                                                 
                       BP13K80A                                                 
                       BP13K813                                                 
                   I-O BP13K730                                                 
                OUTPUT BP13LZ30.                                                
                                                                                
           IF WS-AB03K030-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR AB03K030 ' WS-AB03K030-STATUS                 
              MOVE WS-AB03K030-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-AB03K080-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR AB03K080 ' WS-AB03K080-STATUS                 
              MOVE WS-AB03K080-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-AB03K700-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR AB03K700 ' WS-AB03K700-STATUS                 
              MOVE WS-AB03K700-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-BP13K80A-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR BP13K80A ' WS-BP13K80A-STATUS                 
              MOVE WS-BP13K80A-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-BP13K813-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR BP13K813 ' WS-BP13K813-STATUS                 
              MOVE WS-BP13K813-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-BP13K730-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR BP13K730 ' WS-BP13K730-STATUS                 
              MOVE WS-BP13K730-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-BM06K510-STATUS NOT = 0 AND 97                                 
              DISPLAY 'OPEN ERROR BM06K510 ' WS-BM06K510-STATUS                 
              MOVE WS-BM06K510-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-DTE-CURRENT                         
                                                                                
           MOVE WS-DTE-CURR-YYYY      TO LZ30-DTE-CURR-YYYY.                    
           MOVE WS-DTE-CURR-MM        TO LZ30-DTE-CURR-MM.                      
           MOVE WS-DTE-CURR-DD        TO LZ30-DTE-CURR-DD.                      
                                                                                
           WRITE BP13LZ30-REC  FROM BP13LZ30-HEADER.                            
                                                                                
           MOVE 'SNO'                    TO LZ30-SNO                            
           MOVE 'REGN'                   TO LZ30-NUM-REGN                       
           MOVE 'NRIC1'                  TO LZ30-NUM-NRIC1                      
           MOVE 'NRIC2'                  TO LZ30-NUM-NRIC2                      
           MOVE 'NRIC3'                  TO LZ30-NUM-NRIC3                      
           MOVE 'NRIC4'                  TO LZ30-NUM-NRIC4                      
           MOVE 'NRIC FND'               TO LZ30-NUM-NRIC-FND                   
           MOVE 'RL'                     TO LZ30-NUM-RELATIONSHIP               
           MOVE 'FT'                     TO LZ30-NUM-FLAT-TYPE                  
           MOVE 'ELIG'                   TO LZ30-CDE-ELIG-SCH                   
           MOVE 'SMS SCH ACC'            TO LZ30-SMS-SCH-ACC                    
           MOVE 'SFT'                    TO LZ30-SMS-FLAT-TYPE                  
           MOVE 'ST '                    TO LZ30-SMS-SALES-TYPE                 
           MOVE 'MCP'                    TO LZ30-NUM-MCP                        
           MOVE 'NT'                     TO LZ30-NUM-NT.                        
           MOVE 'REMARK'                 TO LZ30-HA-CHILD.                      
                                                                                
           WRITE BP13LZ30-REC  FROM LZ30-FORMAT                                 
                                                                                
           PERFORM 1000-READ-F730-REC THRU 1000-EXIT.                           
           PERFORM 2000-PROCESS-REC   THRU 2000-EXIT                            
             UNTIL EOF-BP13F730 = 'Y'.                                          
           PERFORM 9000-CLOSE-ROUTINE.                                          
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       1000-READ-F730-REC.                                                      
      *------------------------------------------------------------             
                                                                                
           READ BP13F730 AT END MOVE 'Y' TO EOF-BP13F730                        
                GO TO 1000-EXIT.                                                
                                                                                
           ADD 1 TO WS-F730-READ.                                               
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       2000-PROCESS-REC.                                                        
      *------------------------------------------------------------             
                                                                                
           MOVE  'N'           TO  WS-SMS-FND                                   
                                   WS-K730-UPDATE                               
           MOVE SPACES         TO  WS-SPOUSE-NUM-RELATIONSHIP                   
                                   WS-FIANCEE-NUM-RELATIONSHIP                  
                                   WS-APPL-MARITAL-STATUS                       
                                   WS-SPOUSE-MARITAL-STATUS                     
                                   WS-NUM-MCPS                                  
                                   WS-NUM-HDB-REF                               
                                   WS-NUM-RELATIONSHIP                          
                                   WS-NUM-NRIC                                  
                                   WS-NUM-NRIC-FND                              
                                   WS-REMARK                                    
                                   WS-CDE-SALES-TYP.                            
                                                                                
           PERFORM 3000-START-BP13K825 THRU 3000-EXIT                           
           IF WS-K825-FND = 'Y'                                                 
              PERFORM 3100-READNEXT-BP13K825 THRU 3100-EXIT                     
                UNTIL WS-K825-EOF = 'Y'                                         
           END-IF                                                               
                                                                                
           IF (WS-NUM-MCPS             = 'B') AND                               
              (F730-CDE-FLAT-TYPE  NOT = '1A' AND '2A')                         
              PERFORM 5100-READ-BP13K813  THRU 5100-EXIT                        
              IF K813-NUM-MATURE-EST-TAG = 'N'                                  
                 PERFORM 5000-READ-BP13K80A THRU 5000-EXIT                      
                                                                                
                 MOVE SPACES                 TO K510-REC                        
                 MOVE K80A-NUM-ESTATE        TO K510-ESTCDE                     
                 PERFORM 8030-READ-BM06K510  THRU 8030-EXIT                     
                                                                                
                 IF ((K80A-NUM-FLAT-TYPE   = '01' OR '02') AND                  
                    (K80A-CDE-MODL-DESG   = '80' OR '89' OR '92')) OR           
                     F730-NUM-MCPS    NOT = 'C'            OR                   
                     K510-NUM-MATURE-ESTATE = 'N'                               
                     CONTINUE                                                   
                 ELSE                                                           
                     PERFORM 4500-READ-BP13K730  THRU 4500-EXIT                 
                     PERFORM 8000-WRITE-BP13LZ30 THRU 8000-EXIT                 
                 END-IF                                                         
              END-IF                                                            
           END-IF                                                               
                                                                                
           PERFORM 1000-READ-F730-REC  THRU 1000-EXIT.                          
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===============================================================*         
       3000-START-BP13K825.                                                     
      *===============================================================*         
                                                                                
           MOVE SPACES                            TO BP13K825-REC               
           INITIALIZE                                BP13K825-REC.              
           MOVE 'N'                               TO WS-K825-EOF                
                                                     WS-K825-FND.               
                                                                                
           MOVE F730-NUM-REGN                     TO K825-NUM-REGN              
                                                                                
           START BP13K825 KEY >= K825-KEY-FLD.                                  
                                                                                
           IF WS-BP13K825-STATUS = 00 OR 02                                     
              MOVE 'Y'                            TO WS-K825-FND                
           ELSE                                                                 
              IF WS-BP13K825-STATUS = 23 OR 10                                  
                 MOVE 'N'                         TO WS-K825-FND                
              ELSE                                                              
                 DISPLAY 'BP13K825 - ERROR STARTING : '                 US      
                          WS-BP13K825-STATUS                                    
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *===============================================================*         
       3100-READNEXT-BP13K825.                                                  
      *===============================================================*         
                                                                                
           READ BP13K825 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'    TO WS-K825-EOF                                      
                GO          TO 3100-EXIT                                        
           END-READ.                                                            
                                                                                
           IF WS-BP13K825-STATUS = 00 OR 02                                     
              IF K825-NUM-REGN = F730-NUM-REGN                                  
                 IF K825-NUM-NRIC = F730-NUM-NRIC1 OR                           
                    K825-NUM-NRIC = F730-NUM-NRIC2 OR                           
                    K825-NUM-NRIC = F730-NUM-NRIC3 OR                           
                    K825-NUM-NRIC = F730-NUM-NRIC4                              
                    MOVE K825-NUM-NRIC         TO WS-NUM-NRIC                   
                    PERFORM 4000-CHECK-AB03K080 THRU 4000-EXIT                  
                    IF K825-NUM-RELATIONSHIP = 41                               
                       MOVE 'HA-CHILD'         TO WS-REMARK                     
                    END-IF                                                      
                 ELSE                                                           
                    IF (K825-NUM-RELATIONSHIP = 20) OR                          
                        K825-NUM-NRIC-SPOUSE = F730-NUM-NRIC1 OR                
                        K825-NUM-NRIC-SPOUSE = F730-NUM-NRIC2 OR                
                        K825-NUM-NRIC-SPOUSE = F730-NUM-NRIC3 OR                
                        K825-NUM-NRIC-SPOUSE = F730-NUM-NRIC4                   
                        MOVE K825-NUM-NRIC     TO WS-NUM-NRIC                   
                        PERFORM 4000-CHECK-AB03K080 THRU 4000-EXIT              
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 MOVE 'Y'                         TO WS-K825-EOF                
              END-IF                                                            
           ELSE                                                                 
              IF WS-BP13K825-STATUS = 23 OR 10                                  
                 MOVE 'Y'                         TO WS-K825-EOF                
              ELSE                                                              
                 DISPLAY 'BP13K825 - ERROR READING NEXT : '             STATUS  
                          WS-BP13K825-STATUS                                    
                 GO TO 9000-CLOSE-ROUTINE                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------------------------------------------             
       4000-CHECK-AB03K080.                                                     
      *------------------------------------------------------------             
           MOVE SPACES               TO K080-KEY.                               
           INITIALIZE                   AB03K080-REC.                           
           MOVE WS-NUM-NRIC          TO K080-NUM-UIN.                           
                                                                                
           START AB03K080 KEY >= K080-KEY.                                      
                                                                                
            EVALUATE WS-AB03K080-STATUS                                         
              WHEN 00                                                           
                   PERFORM 4100-READNEXT-AB03K080   THRU 4100-EXIT              
                     UNTIL K080-NUM-UIN OF AB03K080-REC NOT =                   
                                           WS-NUM-NRIC                          
                        OR WS-SMS-FND = 'Y'                                     
                        OR EOF-AB03K080 = 'Y'                                   
              WHEN 23                                                           
                   CONTINUE                                                     
              WHEN OTHER                                                        
                   DISPLAY 'START AB03K080 ERROR ' WS-AB03K080-STATUS           
                   MOVE WS-AB03K080-STATUS          TO RETURN-CODE              
                   PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                    
            END-EVALUATE.                                                       
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       4100-READNEXT-AB03K080.                                                  
      *------------------------------------------------------------             
            READ AB03K080 NEXT.                                                 
                                                                                
            EVALUATE WS-AB03K080-STATUS                                         
              WHEN 00                                                           
                   IF K080-NUM-UIN OF AB03K080 = WS-NUM-NRIC                    
                      PERFORM 4200-READ-AB03K030 THRU 4200-EXIT                 
                   END-IF                                                       
              WHEN 10                                                           
                   MOVE 'Y' TO EOF-AB03K080                                     
              WHEN 23                                                           
                   CONTINUE                                                     
              WHEN OTHER                                                        
                   DISPLAY 'START AB03K080 ERROR ' WS-AB03K080-STATUS           
                   MOVE WS-AB03K080-STATUS          TO RETURN-CODE              
                   PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                    
            END-EVALUATE.                                                       
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       4200-READ-AB03K030.                                                      
      *------------------------------------------------------------             
                                                                                
           INITIALIZE               AB03K030-REC.                               
           MOVE K080-NUM-HDB-REF TO K030-NUM-HDB-REF.                           
                                                                                
           READ AB03K030.                                                       
                                                                                
           EVALUATE WS-AB03K030-STATUS                                          
              WHEN 00                                                           
                   IF K030-CDE-ACCT-STAT = 'C'                                  
                      PERFORM 4300-READ-AB03K700 THRU 4300-EXIT                 
                      IF WS-SMS-FND = 'Y'                                       
      *                  DISPLAY F730-NUM-REGN ' ' K080-NUM-UIN ' '             
      *                          K030-NUM-HDB-REF                               
                         MOVE 'B'                TO WS-NUM-MCPS                 
                         MOVE K080-NUM-UIN       TO WS-NUM-NRIC-FND             
                         MOVE K825-NUM-RELATIONSHIP                             
                           TO WS-NUM-RELATIONSHIP                               
                         MOVE K030-NUM-HDB-REF   TO WS-NUM-HDB-REF              
                         MOVE K030-CDE-SALES-TYP TO WS-CDE-SALES-TYP            
                      END-IF                                                    
                   END-IF                                                       
              WHEN 10                                                           
              WHEN 23                                                           
                   CONTINUE                                                     
              WHEN OTHER                                                        
                   DISPLAY 'START AB03K030 ERROR ' WS-AB03K030-STATUS           
                   MOVE WS-AB03K030-STATUS          TO RETURN-CODE              
                   PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                    
            END-EVALUATE.                                                       
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4300-READ-AB03K700.                                                      
           MOVE K080-NUM-HDB-REF TO K700-NUM-HDB-REF.                           
                                                                                
           READ AB03K700.                                                       
                                                                                
           IF  WS-AB03K700-STATUS = ZEROES                                      
               NEXT SENTENCE                                                    
           ELSE                                                                 
               DISPLAY 'SCHACC NOT FOUND IN AB03K700 ' K080-NUM-HDB-REF         
               GO TO 4300-EXIT.                                                 
                                                                                
           IF K080-NUM-UIN = K700-NUM-UIN1                                      
              IF K700-CDE-OWNER-STATUS1 = 'E' OR 'A' OR 'P'                     
                 MOVE 'N' TO WS-SMS-FND                                         
              ELSE                                                              
                 MOVE 'Y' TO WS-SMS-FND                                         
           ELSE                                                                 
              IF K080-NUM-UIN = K700-NUM-UIN2                                   
                 IF K700-CDE-OWNER-STATUS2 = 'E' OR 'A' OR 'P'                  
                    MOVE 'N' TO WS-SMS-FND                                      
                 ELSE                                                           
                    MOVE 'Y' TO WS-SMS-FND                                      
              ELSE                                                              
                IF K080-NUM-UIN = K700-NUM-UIN3                                 
                   IF K700-CDE-OWNER-STATUS3 = 'E' OR 'A' OR 'P'                
                      MOVE 'N' TO WS-SMS-FND                                    
                   ELSE                                                         
                      MOVE 'Y' TO WS-SMS-FND                                    
                ELSE                                                            
                   IF K080-NUM-UIN = K700-NUM-UIN4                              
                      IF K700-CDE-OWNER-STATUS4 = 'E' OR 'A' OR 'P'             
                         MOVE 'N' TO WS-SMS-FND                                 
                      ELSE                                                      
                         MOVE 'Y' TO WS-SMS-FND.                                
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       4500-READ-BP13K730.                                                      
      *------------------------------------------------------------             
           INITIALIZE BP13K730-REC.                                             
                                                                                
           MOVE 'N'             TO WS-K730-FND                                  
                                                                                
           MOVE F730-NUM-REGN   TO K730-KEY-NEW                                 
                                                                                
           READ BP13K730.                                                       
                                                                                
           EVALUATE WS-BP13K730-STATUS                                          
              WHEN  00                                                          
                    MOVE 'Y'  TO WS-K730-FND                                    
                    MOVE WS-NUM-MCPS             TO K730-NUM-MCPS               
                    MOVE 'B'                     TO F730-NUM-MCPS               
                    PERFORM 4600-UPDATE-BP13K730 THRU 4600-EXIT                 
              WHEN  23                                                          
                    DISPLAY 'BP13K730 REC NOT FND: ' K730-KEY-NEW               
              WHEN  OTHER                                                       
                    DISPLAY 'READ BP13K730 ERROR ' WS-BP13K730-STATUS           
                    MOVE WS-BP13K730-STATUS TO RETURN-CODE                      
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------------------------------------------             
       4600-UPDATE-BP13K730.                                                    
      *------------------------------------------------------------             
                                                                                
           REWRITE BP13K730-REC.                                                
                                                                                
           EVALUATE WS-BP13K730-STATUS                                          
              WHEN  00                                                          
                    MOVE 'N'          TO WS-K730-UPDATE                         
              WHEN  23                                                          
                    DISPLAY 'BP13K730 REC NOT FND: ' K730-NUM-REGN              
              WHEN  OTHER                                                       
                    DISPLAY 'NEXT BP13K730 ERROR ' WS-BP13K730-STATUS           
                    MOVE WS-BP13K730-STATUS TO RETURN-CODE                      
                    PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5000-READ-BP13K80A.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                             TO  BP13K80A-REC.            
           INITIALIZE                                  BP13K80A-REC.            
                                                                                
           MOVE WS-NUM-HDB-REF                    TO  K80A-NUM-SCH-ACC.         
                                                                                
           READ BP13K80A.                                                       
                                                                                
           EVALUATE WS-BP13K80A-STATUS                                          
           WHEN 00                                                              
                CONTINUE                                                        
           WHEN 23                                                              
                DISPLAY 'NOT FOUND BP13K80A: ' K80A-KEY-FLD                     
           WHEN OTHER                                                           
                DISPLAY 'READ ERROR BP13K80A, STATUS  '                         
                        WS-BP13K80A-STATUS                                      
                        ',  SCHACC ' K80A-NUM-SCH-ACC                           
                MOVE WS-BP13K80A-STATUS         TO RETURN-CODE                  
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5100-READ-BP13K813.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                             TO  BP13K813-REC.            
           INITIALIZE                                  BP13K813-REC.            
                                                                                
           MOVE F730-CDE-NT1                      TO  K813-NUM-ZONE             
           MOVE F730-CDE-FLAT-TYPE                TO  K813-NUM-FLAT-TYPE        
           MOVE F730-DTE-BALLOT                   TO  K813-DTE-BALLOT           
                                                                                
           READ BP13K813.                                                       
                                                                                
           EVALUATE WS-BP13K813-STATUS                                          
           WHEN 00                                                              
                CONTINUE                                                        
           WHEN 23                                                              
                DISPLAY 'NOT FOUND BP13K813: ' K813-KEY-FLD                     
           WHEN OTHER                                                           
                DISPLAY 'READ ERROR BP13K813, STATUS  '                         
                        WS-BP13K80A-STATUS                                      
                        ',  SCHACC ' K813-KEY-FLD                               
                MOVE WS-BP13K813-STATUS         TO RETURN-CODE                  
                PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       8000-WRITE-BP13LZ30.                                                     
                                                                                
            ADD 1 TO WS-SNO                                                     
            INITIALIZE LZ30-FORMAT                                              
                                                                                
      * GET SMS FLAT TYPE                                                       
                                                                                
            MOVE WS-SNO                   TO LZ30-SNO                           
            MOVE F730-NUM-REGN            TO LZ30-NUM-REGN                      
            MOVE F730-NUM-NRIC1           TO LZ30-NUM-NRIC1                     
                                                                                
            IF F730-NUM-NRIC2(1:1) NOT = '#'                                    
               MOVE F730-NUM-NRIC2        TO LZ30-NUM-NRIC2                     
            END-IF                                                              
                                                                                
            IF F730-NUM-NRIC3(1:1) NOT = '#'                                    
               MOVE F730-NUM-NRIC3        TO LZ30-NUM-NRIC3                     
            END-IF                                                              
                                                                                
            IF F730-NUM-NRIC4(1:1) NOT = '#'                                    
               MOVE F730-NUM-NRIC4        TO LZ30-NUM-NRIC4                     
            END-IF                                                              
                                                                                
            MOVE WS-NUM-NRIC-FND          TO LZ30-NUM-NRIC-FND                  
            MOVE WS-NUM-RELATIONSHIP      TO LZ30-NUM-RELATIONSHIP              
            MOVE F730-CDE-FLAT-TYPE       TO LZ30-NUM-FLAT-TYPE                 
            MOVE F730-CDE-ELIG-SCH        TO LZ30-CDE-ELIG-SCH                  
                                                                                
            IF WS-SMS-FND = 'Y'                                                 
               MOVE K80A-NUM-FLAT-TYPE    TO LZ30-SMS-FLAT-TYPE                 
               MOVE WS-NUM-HDB-REF        TO LZ30-SMS-SCH-ACC                   
               MOVE WS-CDE-SALES-TYP      TO LZ30-SMS-SALES-TYPE                
            END-IF                                                              
                                                                                
            MOVE F730-NUM-MCPS            TO LZ30-NUM-MCP.                      
            MOVE K510-ALPHA-NTCDE         TO LZ30-NUM-NT.                       
            MOVE WS-REMARK                TO LZ30-HA-CHILD.                     
                                                                                
            WRITE BP13LZ30-REC  FROM LZ30-FORMAT                                
            ADD 1 TO WS-CNT-WRITE.                                              
                                                                                
            INITIALIZE AB03K080-REC                                             
                       AB03K030-REC.                                            
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       8030-READ-BM06K510.                                                      
      *-------------------------------------------------------------            
           READ BM06K510 KEY IS K510-ESTCDE.                                    
                                                                                
           EVALUATE WS-BM06K510-STATUS                                          
           WHEN 00                                                              
             CONTINUE                                                           
           WHEN 23                                                              
             DISPLAY 'ESTATE NOT FOUND IN BM06K510- ' K510-ESTCDE               
           WHEN OTHER                                                           
             DISPLAY 'ERROR READING BM06K510: ' WS-BM06K510-STATUS              
             MOVE WS-BM06K510-STATUS            TO RETURN-CODE                  
             PERFORM 9000-CLOSE-ROUTINE         THRU 9000-EXIT                  
           END-EVALUATE.                                                        
                                                                                
       8030-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------             
       9000-CLOSE-ROUTINE.                                                      
      *------------------------------------------------------------             
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY 'BP13CZ30          '                                         
           DISPLAY '*-----------------------------------------------*'.         
           DISPLAY 'DETERMINE MCPS=B                             '.             
           DISPLAY '*-----------------------------------------------*'.         
           DISPLAY 'NO OF RECORDS READ FROM F730   ' WS-F730-READ.              
           DISPLAY 'NO OF RECORDS WRITTEN          ' WS-CNT-WRITE.              
                                                                                
           CLOSE BP13F730                                                       
                 BP13K813                                                       
                 BP13K825                                                       
                 BP13K730                                                       
                 BP13K80A                                                       
                 BM06K510                                                       
                 AB03K080                                                       
                 AB03K030                                                       
                 AB03K700                                                       
                 BP13LZ30.                                                      
                                                                                
           IF  WS-AB03K080-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-AB03K080-STATUS ' WS-AB03K080-STATUS.                
                                                                                
           IF  WS-AB03K030-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-AB03K030-STATUS ' WS-AB03K030-STATUS.                
                                                                                
           IF  WS-AB03K700-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-AB03K700-STATUS ' WS-AB03K700-STATUS.                
                                                                                
           IF  WS-BP13K80A-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-BP13K80A-STATUS ' WS-BP13K80A-STATUS.                
                                                                                
           IF  WS-BP13K813-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-BP13K813-STATUS ' WS-BP13K813-STATUS.                
                                                                                
           IF  WS-BP13K730-STATUS NOT = ZEROS AND 97                            
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'WS-BP13K730-STATUS ' WS-BP13K730-STATUS.                
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
