       IDENTIFICATION DIVISION.                                         00010002
       PROGRAM-ID.  BP13C907.                                           00020002
       AUTHOR.      ANC1.                                               00021002
       DATE-WRITTEN 23/05/2002.                                         00022002
                                                                        00023002
      ****************************************************************  00023102
      *            SYSTEM OF COMMITMENT (BP13)                       *  00023202
      *--------------------------------------------------------------*  00023302
      * OBJECTIVES  THIS SUBROUTINE COMPUTES THE SHORTEST DISTANCE   *  00023402
      *             BETWEEN TWO POSTAL CODES AND BLK-NO.             *  00023502
      *             PROGRAM WILL RETURN THE DISTANCE TO BP13C014     *  00023602
      *             FOR GRANTING 'T' TO MARRIED CHILD PRIORITY SCHEME*  00023702
      *--------------------------------------------------------------*  00023802
      * MODIFICATIONS :                                              *  00023902
      *                                                              *  00024002
      * CHGE REQ DATE AUTHOR  REMARKS                                *  00024102
      * -------- ---- ------ --------------------------------------- *  00024202
      * BP132162 200702 ANC - NEW PGM                                *  00024302
      * BP132810 220206 CKK - CHECK DISTANCE UP TO 2 DECIMAL PLACES  *  00024402
      * BP134906 170513 SMR - CHANGE THE DISTANCE CALCULATION FROM 2 *  00024504
      *                       DECIMAL PLACES TO 1 DECIMAL PLACE      *  00024603
      ****************************************************************  00024703
       ENVIRONMENT DIVISION.                                            00024803
                                                                        00024903
       CONFIGURATION SECTION.                                           00025003
       SOURCE-COMPUTER. IBM-3090.                                       00025103
       OBJECT-COMPUTER. IBM-3090.                                       00025203
                                                                        00025303
       INPUT-OUTPUT SECTION.                                            00025403
       FILE-CONTROL.                                                    00025503
           SELECT BB29K800 ASSIGN  TO  BB29K800                         00026002
                     ORGANIZATION  IS  INDEXED                          00027002
                     ACCESS MODE   IS  RANDOM                           00028002
                     RECORD KEY    IS  K800-KEY-FLD                     00029002
                     FILE STATUS   IS  WS-K800-STATUS.                  00030002
                                                                        00040002
           SELECT BB29K805 ASSIGN  TO  BB29K805                         00050002
                     ORGANIZATION  IS  INDEXED                          00060002
                     ACCESS MODE   IS  DYNAMIC                          00070002
                     RECORD KEY    IS  K805-KEY-FLD                     00080002
                     FILE STATUS   IS  WS-K805-STATUS.                  00090002
                                                                        00100002
           SELECT BB29K820 ASSIGN  TO  BB29K820                         00101002
                     ORGANIZATION  IS  INDEXED                          00102002
                     ACCESS MODE   IS  RANDOM                           00103002
                     RECORD KEY    IS  K820-KEY-FLD                     00104002
                     FILE STATUS   IS  WS-K820-STATUS.                  00105002
                                                                        00105102
       DATA DIVISION.                                                   00105202
                                                                        00105302
       FILE SECTION.                                                    00105402
                                                                        00105502
       FD   BB29K800                                                    00105602
            RECORD CONTAINS  27 CHARACTERS.                             00105702
                                                                        00105802
       COPY BB29K800.                                                   00105902
                                                                        00106002
       FD   BB29K805                                                    00106102
            RECORD CONTAINS  27 CHARACTERS.                             00106202
                                                                        00106302
       COPY BB29K805.                                                   00106402
                                                                        00106502
       FD   BB29K820                                                    00106602
            RECORD CONTAINS  55 CHARACTERS.                             00106702
                                                                        00106802
       COPY BB29K820.                                                   00106902
                                                                        00107002
      *----------------------------*                                    00107102
       WORKING-STORAGE SECTION.                                         00107202
      *----------------------------*                                    00107302
       01 WS-MULTI-TBL-FLAG                    PIC  X(01).              00107402
          88 MORE-RECORDS                      VALUE 'N'.               00107502
          88 NO-MORE-RECORDS                   VALUE 'Y'.               00107602
                                                                        00107702
       01 WS-PC1-REC.                                                   00107802
          05 WS-PC1-CODE                       PIC  X(06).              00107902
          05 WS-PC1-BLK                        PIC  X(05).              00108002
          05 WS-PC1-ST                         PIC  X(06).              00109002
          05 WS-PC1-NT                         PIC  X(06).              00110002
                                                                        00120002
       01 WS-PC2-REC.                                                   00130002
          05 WS-PC2-CODE                       PIC  X(06).              00140002
          05 WS-PC2-BLK                        PIC  X(05).              00150002
          05 WS-PC2-ST                         PIC  X(06).              00160002
          05 WS-PC2-NT                         PIC  X(06).              00170002
                                                                        00180002
      *** POSTAL 1 ARRAY WITH X & Y COORDS (9(5)V99)  ********          00190002
                                                                        00200002
       01 WS-PC1-MULTI-TABLE.                                           00210002
          05 WS-PC1-MULTI-REC OCCURS 2000 TIMES                         00220002
               INDEXED  BY PC1-IND.                                     00230002
             10 WS-PC1-MULTI-BLK                  PIC  X(05).           00240002
             10 WS-PC1-MULTI-ST                   PIC  X(06).           00250002
             10 WS-CH-XCORD1                      PIC  X(08).           00260002
             10 WS-CH-YCORD1                      PIC  X(08).           00270002
                                                                        00280002
       01 WS-XCORD1.                                                    00290002
          05 WS-XCORD1-INT                  PIC X(05).                  00300002
          05 WS-XCORD1-DEC                  PIC X(02).                  00310002
       01 FILLER           REDEFINES    WS-XCORD1.                      00320002
          15 WS-NUM-XCORD1-DEC              PIC 9(05)V99.               00330002
       01 WS-YCORD1.                                                    00340002
          05 WS-YCORD1-INT                  PIC X(05).                  00350002
          05 WS-YCORD1-DEC                  PIC X(02).                  00360002
       01 FILLER           REDEFINES    WS-YCORD1.                      00370002
          15 WS-NUM-YCORD1-DEC              PIC 9(05)V99.               00380002
                                                                        00390002
      *** POSTAL 2 ARRAY WITH X & Y COORDS (9(5)V99)  ********          00400002
                                                                        00410002
       01 WS-PC2-MULTI-TABLE.                                           00420002
          05 WS-PC2-MULTI-REC OCCURS 2000 TIMES                         00430002
               INDEXED  BY PC2-IND.                                     00440002
             10 WS-PC2-MULTI-BLK                  PIC  X(05).           00441002
             10 WS-PC2-MULTI-ST                   PIC  X(06).           00442002
             10 WS-CH-XCORD2                      PIC  X(08).           00443002
             10 WS-CH-YCORD2                      PIC  X(08).           00444002
                                                                        00445002
       01 WS-XCORD2.                                                    00446002
          05 WS-XCORD2-INT                  PIC X(05).                  00447002
          05 WS-XCORD2-DEC                  PIC X(02).                  00448002
       01 FILLER           REDEFINES    WS-XCORD2.                      00449002
          15 WS-NUM-XCORD2-DEC              PIC 9(05)V99.               00450002
       01 WS-YCORD2.                                                    00451002
          05 WS-YCORD2-INT                  PIC X(05).                  00452002
          05 WS-YCORD2-DEC                  PIC X(02).                  00453002
       01 FILLER           REDEFINES    WS-YCORD2.                      00454002
          15 WS-NUM-YCORD2-DEC              PIC 9(05)V99.               00455002
                                                                        00456002
       01 WS-DIST                     PIC 9(03)V9 COMP-3 VALUE ZEROS.   00457002
       01 WS-TEMP-SDIST               PIC 9(03)V9 COMP-3 VALUE ZEROS.   00458002
       01 WS-I                        PIC  99 VALUE ZEROS.              00459002
       01 WS-J                        PIC  99 VALUE ZEROS.              00459102
       01 WS-NO-BLOCK.                                                  00459202
          05 WS-NUM-BLOCK-M    OCCURS 5 TIMES.                          00459302
             10 WS-NUM-BLOCK-MAIN     PIC X(1) VALUE SPACES.            00459402
       01 WS-NUM-BLK.                                                   00459502
          05 WS-NUM-BLK-M    OCCURS 4 TIMES.                            00459602
             10 WS-NUM-BLK-MAIN       PIC X(1) VALUE SPACES.            00459702
          05 WS-NUM-BLK-SUB           PIC X(1) VALUE SPACES.            00459802
                                                                        00459902
       01 WS-PC1-FLAG                         PIC X(1).                 00460002
          88 PC1-EOF                          VALUE 'Y'.                00461002
       01 WS-PC2-FLAG                         PIC X(1).                 00462002
          88 PC2-EOF                          VALUE 'Y'.                00463002
       01 WS-PC-FLAG                          PIC X(1).                 00464002
          88 PC1-CHK                          VALUE '1'.                00465002
          88 PC2-CHK                          VALUE '2'.                00466002
       01 WS-MULTI-CORD-FLAG                  PIC X(1).                 00467002
          88 MULTI-CORD-BLANK                 VALUE 'Y'.                00468002
                                                                        00469002
       01 WS-K820-STATUS              PIC 9(02)   VALUE ZEROS.          00469102
       01 WS-K800-STATUS              PIC 9(02)   VALUE ZEROS.          00469202
       01 WS-K805-STATUS              PIC 9(02)   VALUE ZEROS.          00469302
                                                                        00469402
       01 WS-COUNTERS.                                                  00469502
          05  WS-K800-NTFND           PIC 9(06)   VALUE ZEROS.          00469602
          05  WS-K805-NTFND           PIC 9(06)   VALUE ZEROS.          00469702
          05  WS-K820-NTFND           PIC 9(06)   VALUE ZEROS.          00469802
          05  WS-K800-READ            PIC 9(06)   VALUE ZEROS.          00469902
          05  WS-K805-READ            PIC 9(06)   VALUE ZEROS.          00470002
          05  WS-K820-READ            PIC 9(06)   VALUE ZEROS.          00470102
                                                                        00470202
      *----------------------------*                                    00470302
       LINKAGE SECTION.                                                 00470402
      *----------------------------*                                    00470502
       01  LINK-REC.                                                    00470602
           05  LINK-OPEN-CLOSE               PIC X.                     00470702
           05  LINK-NON-HDB                  PIC X.                     00470802
           05  LINK-RETURN-CODE              PIC 9(02).                 00470902
           05  LINK-POSTAL-CODE1             PIC X(06).                 00471002
           05  LINK-POSTAL-BLK1              PIC X(05).                 00472002
           05  LINK-POSTAL-CODE2             PIC X(06).                 00473002
           05  LINK-POSTAL-BLK2              PIC X(05).                 00474002
           05  LINK-DISTANCE                 PIC 9(03)V99.              00475002
                                                                        00476002
      *----------------------------*                                    00477002
       PROCEDURE DIVISION USING LINK-REC.                               00478002
      *----------------------------*                                    00479002
      ********************                                              00479102
       0000-MAIN-PROCESS.                                               00479202
      ********************                                              00479302
           MOVE LINK-POSTAL-CODE1    TO WS-PC1-CODE.                    00479402
           MOVE LINK-POSTAL-BLK1     TO WS-PC1-BLK.                     00479502
           MOVE LINK-POSTAL-CODE2    TO WS-PC2-CODE.                    00479602
           MOVE LINK-POSTAL-BLK2     TO WS-PC2-BLK.                     00479702
                                                                        00479802
           IF LINK-OPEN-CLOSE = 'O'                                     00479902
              PERFORM 0500-OPEN-FILES   THRU 0500-EXIT                  00480002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00481002
           END-IF.                                                      00482002
                                                                        00482102
           IF LINK-OPEN-CLOSE = SPACES OR LOW-VALUES                    00482202
              PERFORM 1000-PROCESS-REQUEST THRU 1000-EXIT               00482302
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00482402
           END-IF.                                                      00482502
                                                                        00482602
           IF LINK-OPEN-CLOSE = 'C'                                     00482702
              PERFORM 7500-CLOSE-FILES  THRU 7500-EXIT                  00482802
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00482902
           END-IF.                                                      00483002
                                                                        00484002
       0000-EXIT.                                                       00485002
           EXIT.                                                        00486002
                                                                        00487002
      ******************************************************            00488002
       0500-OPEN-FILES.                                                 00489002
      ******************************************************            00490002
                                                                        00500002
           OPEN INPUT BB29K800                                          00501002
                      BB29K805                                          00502002
                      BB29K820.                                         00503002
                                                                        00504002
           IF WS-K800-STATUS NOT = 00 AND 97                            00505002
              DISPLAY 'ERROR OPENING BB29K800: ' WS-K800-STATUS         00506002
              MOVE WS-K800-STATUS          TO LINK-RETURN-CODE          00507002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00508002
           END-IF.                                                      00509002
                                                                        00509102
           IF WS-K805-STATUS NOT = 00 AND 97                            00509202
              DISPLAY 'ERROR OPENING BB29K805: ' WS-K805-STATUS         00509302
              MOVE WS-K805-STATUS          TO LINK-RETURN-CODE          00509402
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00509502
           END-IF.                                                      00509602
                                                                        00509702
           IF WS-K820-STATUS NOT = 00 AND 97                            00509802
              DISPLAY 'ERROR OPENING BB29K820: ' WS-K820-STATUS         00509902
              MOVE WS-K820-STATUS          TO LINK-RETURN-CODE          00510002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               00511002
           END-IF.                                                      00511102
                                                                        00511202
       0500-EXIT.                                                       00511302
           EXIT.                                                        00511402
                                                                        00511502
      ******************************************************            00511602
       1000-PROCESS-REQUEST.                                            00511702
      ******************************************************            00511802
           IF (WS-PC1-CODE NOT = SPACES AND LOW-VALUES) AND             00511902
              (WS-PC1-BLK  NOT = SPACES AND LOW-VALUES)                 00512002
              MOVE SPACES                   TO K820-KEY-FLD             00512102
              MOVE WS-PC1-CODE              TO K820-NUM-POSTAL-CDE      00512202
              MOVE WS-PC1-BLK               TO WS-NO-BLOCK              00512302
              PERFORM 3500-REFORMAT-BLK     THRU 3500-EXIT              00512402
              MOVE WS-NUM-BLK               TO K820-NUM-BLK             00512502
                                               WS-PC1-BLK               00512602
              PERFORM 7000-READ-BB29K820    THRU 7000-EXIT              00512702
              MOVE BB29K820-REC(1:23)       TO WS-PC1-REC               00512802
           END-IF.                                                      00512902
                                                                        00513002
           IF (WS-PC2-CODE NOT = SPACES AND LOW-VALUES) AND             00513102
              (WS-PC2-BLK  NOT = SPACES AND LOW-VALUES)                 00513202
              MOVE SPACES                   TO K820-KEY-FLD             00513302
              MOVE WS-PC2-CODE              TO K820-NUM-POSTAL-CDE      00513402
              MOVE WS-PC2-BLK               TO WS-NO-BLOCK              00513502
              PERFORM 3500-REFORMAT-BLK     THRU 3500-EXIT              00513602
              MOVE WS-NUM-BLK               TO K820-NUM-BLK             00513702
                                               WS-PC2-BLK               00513802
              PERFORM 7000-READ-BB29K820    THRU 7000-EXIT              00513902
              MOVE BB29K820-REC(1:23)       TO WS-PC2-REC               00514002
           END-IF.                                                      00515002
                                                                        00516002
           PERFORM 3000-COMPUTE-DISTANCE    THRU 3000-EXIT.             00517002
                                                                        00518002
       1000-EXIT.                                                       00519002
           EXIT.                                                        00520002
                                                                        00521002
      ******************************************************            00522002
       3000-COMPUTE-DISTANCE.                                           00523002
      ******************************************************            00524002
           PERFORM 4000-SINGLE-POINT        THRU 4000-EXIT.             00525002
                                                                        00526002
           IF WS-DIST >= 2.1 AND WS-DIST <= 2.9                         00527002
              MOVE WS-DIST                     TO WS-TEMP-SDIST         00528002
              PERFORM 4100-LOAD-MULTIPLE-TABLE THRU 4100-EXIT           00529002
              IF NOT MULTI-CORD-BLANK                                   00530002
                 PERFORM 4400-MULTIPLE-POINT   THRU 4400-EXIT           00531002
              END-IF                                                    00532002
              MOVE WS-TEMP-SDIST               TO LINK-DISTANCE         00533002
           ELSE                                                         00534002
              MOVE WS-DIST                     TO LINK-DISTANCE         00535002
           END-IF.                                                      00536002
                                                                        00537002
       3000-EXIT.                                                       00538002
           EXIT.                                                        00539002
                                                                        00540002
      ******************************************************            00541002
       3500-REFORMAT-BLK.                                               00542002
      ******************************************************            00543002
           MOVE SPACES   TO WS-NUM-BLK.                                 00544002
           MOVE 5        TO WS-I.                                       00545002
           MOVE 4        TO WS-J.                                       00546002
                                                                        00547002
           PERFORM UNTIL WS-I < 1                                       00548002
             IF WS-NUM-BLOCK-MAIN(WS-I)        NOT = SPACES             00549002
                IF WS-NUM-BLOCK-MAIN(WS-I)  IS NOT NUMERIC              00549102
                   MOVE WS-NUM-BLOCK-MAIN(WS-I) TO WS-NUM-BLK-SUB       00549202
                ELSE                                                    00549302
                   MOVE WS-NUM-BLOCK-MAIN(WS-I) TO WS-NUM-BLK-MAIN(WS-J)00549402
                   SUBTRACT  1  FROM WS-J                               00549502
                END-IF                                                  00549602
             END-IF                                                     00549702
             SUBTRACT     1  FROM WS-I                                  00549802
           END-PERFORM.                                                 00549902
       3500-EXIT.                                                       00550002
           EXIT.                                                        00550102
                                                                        00550202
      ******************************************************            00550302
       4000-SINGLE-POINT.                                               00550402
      ******************************************************            00550502
           INITIALIZE WS-PC1-MULTI-TABLE  WS-PC2-MULTI-TABLE.           00550602
                                                                        00550702
           MOVE WS-PC1-BLK                  TO K800-NUM-BLK.            00550802
           MOVE WS-PC1-ST                   TO K800-CDE-ST.             00550902
           PERFORM 7100-READ-BB29K800       THRU 7100-EXIT.             00551002
           MOVE BB29K800-REC                TO WS-PC1-MULTI-REC(1).     00552002
                                                                        00553002
           MOVE WS-PC2-BLK                  TO K800-NUM-BLK.            00554002
           MOVE WS-PC2-ST                   TO K800-CDE-ST.             00555002
           PERFORM 7100-READ-BB29K800       THRU 7100-EXIT.             00556002
           MOVE BB29K800-REC                TO WS-PC2-MULTI-REC(1).     00556102
                                                                        00556202
           MOVE WS-CH-XCORD1(1) (1:5)       TO WS-XCORD1-INT.           00556302
           MOVE WS-CH-XCORD1(1) (7:2)       TO WS-XCORD1-DEC.           00556402
           MOVE WS-CH-YCORD1(1) (1:5)       TO WS-YCORD1-INT.           00556502
           MOVE WS-CH-YCORD1(1) (7:2)       TO WS-YCORD1-DEC.           00556602
                                                                        00556702
           MOVE WS-CH-XCORD2(1) (1:5)       TO WS-XCORD2-INT.           00556802
           MOVE WS-CH-XCORD2(1) (7:2)       TO WS-XCORD2-DEC.           00556902
           MOVE WS-CH-YCORD2(1) (1:5)       TO WS-YCORD2-INT.           00557002
           MOVE WS-CH-YCORD2(1) (7:2)       TO WS-YCORD2-DEC.           00558002
                                                                        00559002
           COMPUTE WS-DIST ROUNDED =                                    00560002
           (FUNCTION SQRT(                                              00570002
      -    ((WS-NUM-XCORD2-DEC - WS-NUM-XCORD1-DEC) ** 2) +             00570102
      -    ((WS-NUM-YCORD2-DEC - WS-NUM-YCORD1-DEC) ** 2)) / 1000).     00570202
                                                                        00570302
       4000-EXIT.                                                       00570502
           EXIT.                                                        00570602
                                                                        00570702
      ******************************************************            00570802
       4100-LOAD-MULTIPLE-TABLE.                                        00570902
      ******************************************************            00571002
           INITIALIZE       WS-PC1-MULTI-TABLE  WS-PC2-MULTI-TABLE.     00571102
           MOVE SPACE       TO WS-MULTI-CORD-FLAG.                      00572002
                                                                        00573002
           PERFORM 4200-LOAD-MULTIPLE-PC1  THRU 4200-EXIT.              00574002
           PERFORM 4300-LOAD-MULTIPLE-PC2  THRU 4300-EXIT.              00575002
                                                                        00576002
       4100-EXIT.                                                       00577002
           EXIT.                                                        00578002
                                                                        00579002
      ******************************************************            00580002
       4200-LOAD-MULTIPLE-PC1.                                          00581002
      ******************************************************            00582002
           INITIALIZE BB29K805-REC.                                     00583002
           MOVE SPACES                   TO K805-KEY-FLD.               00584002
           MOVE WS-PC1-BLK               TO K805-NUM-BLK(1:5).          00585002
           MOVE WS-PC1-ST                TO K805-CDE-ST.                00586002
           MOVE 'N'                      TO WS-MULTI-TBL-FLAG.          00587002
                                                                        00588002
           PERFORM 7200-START-BB29K805   THRU 7200-EXIT.                00589002
                                                                        00590002
           IF WS-K805-STATUS = 00                                       00600002
              PERFORM VARYING PC1-IND FROM 1 BY 1                       00610002
                      UNTIL NO-MORE-RECORDS                             00620002
                 PERFORM 7300-READNXT-BB29K805 THRU 7300-EXIT           00621002
                 IF WS-K805-STATUS = 00                                 00622002
                    IF K805-NUM-BLK = WS-PC1-BLK AND                    00622102
                       K805-CDE-ST  = WS-PC1-ST                         00622202
                       MOVE BB29K805-REC  TO WS-PC1-MULTI-REC(PC1-IND)  00622302
                    ELSE                                                00622402
                       MOVE  'Y'          TO WS-MULTI-TBL-FLAG          00622502
                    END-IF                                              00622602
                 END-IF                                                 00622702
              END-PERFORM                                               00622802
           END-IF.                                                      00622902
                                                                        00623002
       4200-EXIT.                                                       00623102
           EXIT.                                                        00623202
                                                                        00623302
      ******************************************************            00623402
       4300-LOAD-MULTIPLE-PC2.                                          00623502
      ******************************************************            00623602
           INITIALIZE BB29K805-REC.                                     00623702
           MOVE SPACES                   TO K805-KEY-FLD.               00623802
           MOVE WS-PC2-BLK               TO K805-NUM-BLK(1:5).          00623902
           MOVE WS-PC2-ST                TO K805-CDE-ST.                00624002
           MOVE 'N'                      TO WS-MULTI-TBL-FLAG.          00624102
                                                                        00624202
           PERFORM 7200-START-BB29K805   THRU 7200-EXIT.                00624302
                                                                        00624402
           IF WS-K805-STATUS = 00                                       00624502
              PERFORM VARYING PC2-IND FROM 1 BY 1                       00624602
                      UNTIL NO-MORE-RECORDS                             00624702
                 PERFORM 7300-READNXT-BB29K805 THRU 7300-EXIT           00624802
                 IF WS-K805-STATUS = 00                                 00624902
                    IF K805-NUM-BLK = WS-PC2-BLK AND                    00625002
                       K805-CDE-ST  = WS-PC2-ST                         00625102
                       MOVE BB29K805-REC   TO WS-PC2-MULTI-REC(PC2-IND) 00625202
                    ELSE                                                00625302
                       MOVE  'Y'           TO WS-MULTI-TBL-FLAG         00625402
                    END-IF                                              00625502
                 END-IF                                                 00625602
              END-PERFORM                                               00625702
           END-IF.                                                      00625802
                                                                        00625902
       4300-EXIT.                                                       00626002
           EXIT.                                                        00626102
                                                                        00626202
      ******************************************************            00626302
       4400-MULTIPLE-POINT.                                             00626402
      ******************************************************            00626502
           MOVE SPACE                         TO WS-PC1-FLAG.           00626602
                                                                        00626702
           PERFORM VARYING PC1-IND FROM 1 BY 1 UNTIL PC1-EOF            00626802
            IF WS-PC1-MULTI-BLK(PC1-IND) <= SPACES                      00626902
               MOVE 'Y'                  TO WS-PC1-FLAG                 00627002
            ELSE                                                        00627102
               MOVE SPACE                 TO WS-PC2-FLAG                00627202
               PERFORM VARYING PC2-IND FROM 1 BY 1 UNTIL PC2-EOF        00627302
                  IF WS-PC2-MULTI-BLK(PC2-IND) <= SPACES                00627402
                     MOVE 'Y'                  TO WS-PC2-FLAG           00627502
                  ELSE                                                  00627602
                     MOVE WS-CH-XCORD1(PC1-IND) (1:5) TO WS-XCORD1-INT  00627702
                     MOVE WS-CH-XCORD1(PC1-IND) (7:2) TO WS-XCORD1-DEC  00627802
                     MOVE WS-CH-YCORD1(PC1-IND) (1:5) TO WS-YCORD1-INT  00627902
                     MOVE WS-CH-YCORD1(PC1-IND) (7:2) TO WS-YCORD1-DEC  00628002
                                                                        00628102
                     MOVE WS-CH-XCORD2(PC2-IND) (1:5) TO WS-XCORD2-INT  00628202
                     MOVE WS-CH-XCORD2(PC2-IND) (7:2) TO WS-XCORD2-DEC  00628302
                     MOVE WS-CH-YCORD2(PC2-IND) (1:5) TO WS-YCORD2-INT  00628402
                     MOVE WS-CH-YCORD2(PC2-IND) (7:2) TO WS-YCORD2-DEC  00628502
                                                                        00628602
                     COMPUTE WS-DIST ROUNDED =                          00628802
                     (FUNCTION SQRT(                                    00628902
      -              ((WS-NUM-XCORD2-DEC - WS-NUM-XCORD1-DEC) ** 2) +   00629002
      -              ((WS-NUM-YCORD2-DEC - WS-NUM-YCORD1-DEC) ** 2))    00629102
      -              / 1000)                                            00629202
                                                                        00629302
                     IF WS-DIST < WS-TEMP-SDIST                         00629502
                        MOVE WS-DIST   TO WS-TEMP-SDIST                 00629602
                     END-IF                                             00629702
                  END-IF                                                00629802
               END-PERFORM                                              00629902
            END-IF                                                      00630002
           END-PERFORM.                                                 00630102
                                                                        00630202
       4400-EXIT.                                                       00630302
           EXIT.                                                        00630402
                                                                        00630502
      ********************************************                      00630602
       7000-READ-BB29K820.                                              00630702
      ********************************************                      00630802
           READ BB29K820.                                               00630902
                                                                        00631002
           IF WS-K820-STATUS = 00                                       00631102
              ADD  1      TO WS-K820-READ                               00631202
              MOVE 'N'    TO LINK-NON-HDB                               00632002
           ELSE                                                         00633002
              IF WS-K820-STATUS = 23                                    00634002
                 MOVE ZEROES                  TO LINK-DISTANCE          00635002
                 MOVE 'Y'                     TO LINK-NON-HDB           00636002
                 ADD  1                       TO WS-K820-NTFND          00637002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            00638002
              ELSE                                                      00639002
                 DISPLAY 'ERROR READING BB29K820: ' WS-K820-STATUS,     00640002
                         ' KEY IS: ' K820-KEY-FLD                       00650002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            00660002
              END-IF                                                    00670002
           END-IF.                                                      00680002
                                                                        00690002
       7000-EXIT.                                                       00700002
           EXIT.                                                        00710002
                                                                        00720002
      ********************************************                      00730002
       7100-READ-BB29K800.                                              00740002
      ********************************************                      00750002
           READ BB29K800.                                               00760002
                                                                        00770002
           IF WS-K800-STATUS = 00                                       00780002
              ADD  1      TO WS-K800-READ                               00790002
           ELSE                                                         00800002
              IF WS-K800-STATUS = 23                                    00810002
                 MOVE  ZEROES                 TO LINK-DISTANCE          00820002
                 ADD  1                       TO WS-K800-NTFND          00830002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            00840002
              ELSE                                                      00850002
                 DISPLAY 'ERROR READING BB29K800: ' WS-K800-STATUS,     00860002
                         ' KEY IS: ' K800-KEY-FLD                       00870002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            00880002
              END-IF                                                    00890002
           END-IF.                                                      00900002
                                                                        00910002
       7100-EXIT.                                                       00920002
           EXIT.                                                        00930002
                                                                        00940002
      ******************************************************            00950002
       7200-START-BB29K805.                                             00960002
      ******************************************************            00970002
           START BB29K805 KEY IS >= K805-KEY-FLD.                       00980002
                                                                        00990002
           IF WS-K805-STATUS = 00                                       01000002
              CONTINUE                                                  01010002
           ELSE                                                         01020002
              IF WS-K805-STATUS = 23                                    01030002
                 MOVE  ZEROES                 TO LINK-DISTANCE          01040002
                 ADD   1                      TO WS-K805-NTFND          01050002
                 MOVE 'Y'        TO WS-MULTI-CORD-FLAG                  01060002
              ELSE                                                      01070002
                 DISPLAY 'ERROR READ BB29K805,STATUS ' WS-K805-STATUS   01080002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            01090002
              END-IF                                                    01100002
           END-IF.                                                      01110002
                                                                        01120002
       7200-EXIT.                                                       01130002
           EXIT.                                                        01140002
                                                                        01150002
      ******************************************************            01160002
       7300-READNXT-BB29K805.                                           01170002
      ******************************************************            01180002
           READ BB29K805 NEXT                                           01190002
                AT END MOVE HIGH-VALUES TO K805-KEY-FLD                 01200002
                GO TO 7300-EXIT.                                        01210002
                                                                        01220002
           IF WS-K805-STATUS = 00                                       01230002
              ADD  1      TO WS-K805-READ                               01240002
           ELSE                                                         01250002
              IF WS-K805-STATUS = 23                                    01260002
                 MOVE  ZEROES                 TO LINK-DISTANCE          01270002
                 ADD   1                      TO WS-K805-NTFND          01280002
                 MOVE 'Y'        TO WS-MULTI-CORD-FLAG                  01290002
              ELSE                                                      01300002
                 DISPLAY 'ERROR READ BB29K805,STATUS ' WS-K805-STATUS   01310002
                 PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT            01320002
              END-IF                                                    01330002
           END-IF.                                                      01340002
                                                                        01350002
       7300-EXIT.                                                       01360002
           EXIT.                                                        01370002
                                                                        01380002
      ******************************************************            01390002
       7500-CLOSE-FILES.                                                01400002
      ******************************************************            01410002
           DISPLAY '* ------------ BP13C907 ------------- * '.          01420002
           DISPLAY 'NO OF REC READ    BB29K800 = ' WS-K800-READ.        01430002
           DISPLAY 'NO OF REC READ    BB29K805 = ' WS-K805-READ.        01440002
           DISPLAY 'NO OF REC READ    BB29K820 = ' WS-K820-READ.        01450002
           DISPLAY 'NO OF REC NOTFND  BB29K800 = ' WS-K800-NTFND.       01460002
           DISPLAY 'NO OF REC NOTFND  BB29K805 = ' WS-K805-NTFND.       01470002
           DISPLAY 'NO OF REC NOTFND  BB29K820 = ' WS-K820-NTFND.       01480002
                                                                        01490002
           CLOSE BB29K800                                               01500002
                 BB29K805                                               01510002
                 BB29K820.                                              01520002
                                                                        01530002
           IF WS-K800-STATUS NOT = 00 AND 97                            01540002
              DISPLAY 'ERROR CLOSING BB29K800: ' WS-K800-STATUS         01550002
              MOVE WS-K800-STATUS          TO LINK-RETURN-CODE          01560002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               01570002
           END-IF.                                                      01580002
                                                                        01590002
           IF WS-K805-STATUS NOT = 00 AND 97                            01600002
              DISPLAY 'ERROR CLOSING BB29K805: ' WS-K805-STATUS         01610002
              MOVE WS-K805-STATUS          TO LINK-RETURN-CODE          01620002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               01630002
           END-IF.                                                      01640002
                                                                        01650002
           IF WS-K820-STATUS NOT = 00 AND 97                            01660002
              DISPLAY 'ERROR CLOSING BB29K820: ' WS-K820-STATUS         01670002
              MOVE WS-K820-STATUS          TO LINK-RETURN-CODE          01680002
              PERFORM 8000-END-OF-SUBRTN   THRU 8000-EXIT               01690002
           END-IF.                                                      01700002
                                                                        01710002
       7500-EXIT.                                                       01720002
           EXIT.                                                        01730002
                                                                        01740002
      ********************************************                      01750002
       8000-END-OF-SUBRTN.                                              01760002
      ********************************************                      01770002
           GOBACK.                                                      01780002
                                                                        01790002
       8000-EXIT.                                                       01800002
           EXIT.                                                        01810002
      *=================== END OF PROGRAM ===========================*  01820002
