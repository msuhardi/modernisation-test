       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.   BP13C35I.                                                  
      *DATE-WRITTEN. 28 OCT 2015.                                               
      *AUTHOR.       KRISTINE LANTIN.                                           
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE: 1) to generate the exception report for the    *            
      *                payment of levy for different types of loan *            
      *                in email format                             *            
      * ---------------------------------------------------------- *            
      * CHG REF  DATE     BY    DESCRIPTION                        *            
      * -------- -------- ----- -----------                        *            
      * BP135823 20151028 KVL1  NEW PROGRAM                        *            
      * BP136477 20161018 RJB1  TO REPLACE KIM HUAT TO YEE MIEN    *            
      * BP138831 20210817 KV8   TO REPLACE LEE_LI_PENG TO          *            
      *                         BERNICE_JH_GAN                     *            
      * BP139030 20220107 ZAR7  REPLACE CHUA YEE MIEN TO LIM KOK CHUN           
      * BP139276 20240405 KAC1  REPLACE LIM KOK CHUN BY            *            
      *                                 KATHIJAH_BEE_ALI_MOHAMED   *            
      * BP139175 20240429 KAC1  REPL Bernice_JH_GAN@hdb.gov.sg WITH*            
      *                              Iris_LL_KOR@hdb.gov.sg        *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *-------------------------------------------------------------            
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13L35H ASSIGN TO BP13L35H.                                  
           SELECT MAILFILE ASSIGN TO MAILFILE.                                  
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD  BP13L35H                                                             
           RECORD CONTAINS 200   CHARACTERS                                     
           RECORDING MODE  IS  F.                                               
       01  BP13L35H-REC.                                                        
           05 L35H-NUM-REGN          PIC X(08).                                 
           05 L35H-NRIC              PIC X(09).                                 
           05 L35H-RESALE-STATUS     PIC X(02).                                 
           05 L35H-NUM-HDBREF        PIC X(11).                                 
           05 L35H-NUM-CSM           PIC X(38).                                 
           05 L35H-LOAN-TAG          PIC X(01).                                 
           05 L35H-OIC-EMAIL         PIC X(60).                                 
           05 L35H-HYBRID-TAG        PIC X(01).                                 
           05 L35H-K162-TAG          PIC X(01).                                 
                                                                                
       FD  MAILFILE                                                             
           RECORD CONTAINS 180   CHARACTERS                                     
           RECORDING MODE IS F.                                                 
       01  MAIL-PRTREC              PIC X(180).                                 
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-L35H-READ             PIC 9(6)   VALUE ZERO.                      
       01  WS-L35H-WRITE            PIC 9(6)   VALUE ZERO.                      
       01  WS-SNO                   PIC 9(6)   VALUE ZERO.                      
       01  WS-L35H-EOF              PIC X      VALUE 'N'.                       
       01  WS-SYSIN-PARAMETER       PIC X(1)   VALUE SPACE.                     
       01  WS-SAVE-OIC              PIC X(3)   VALUE SPACES.                    
       01  WS-SAVE-MAIL-REGN-NO     PIC X(08)  VALUE SPACES.                    
       01  WS-DUP                   PIC 9      VALUE ZERO.                      
       01  WS-CUR-DATE.                                                         
           05 WS-CCYY               PIC 9(04).                                  
           05 WS-MM                 PIC 9(02).                                  
           05 WS-DD                 PIC 9(02).                                  
                                                                                
       01  WS-EDT-DATE.                                                         
           05 WS-EDT-DD             PIC 9(02).                                  
           05 FILLER                PIC X(01) VALUE '/'.                        
           05 WS-EDT-MM             PIC 9(02).                                  
           05 FILLER                PIC X(01) VALUE '/'.                        
           05 WS-EDT-CCYY           PIC 9(04).                                  
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT MAILFILE  -  DATASET FOR EMAIL                                   
      *-------------------------------------------------------------            
       01  MAIL-HDR1.                                                           
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.                 
           05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
       01  MAIL-HDR2.                                                           
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                         
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.                    
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
      *  for testing purpose -------                                            
      *01  MAIL-HDR1.                                                           
      *    05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB3'.                 
      *    05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
      *01  MAIL-HDR2.                                                           
      *    05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
      *    05  MAIL-SENDID     PIC X(07)  VALUE 'CS93627'.                      
      *    05  FILLER          PIC X(09)  VALUE '@SGPHDB3>'.                    
      *    05  FILLER          PIC X(53)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL1.                                                           
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
      *    05  RCPT-ID         PIC X(11)  VALUE 'LEE_LI_PENG'.                  
           05  RCPT-ID         PIC X(14)  VALUE 'Iris_LL_KOR'.                  
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
                                                                                
       01  MAIL-DTL1-A.                                                         
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  RCPT-ID2        PIC X(24)  VALUE                                 
                                          'KATHIJAH_BEE_ALI_MOHAMED'.           
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
                                                                                
       01  MAIL-DTL1A.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  RCPT-ID         PIC X(14)  VALUE 'TENG_SIEW_HONG'.               
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
                                                                                
       01  MAIL-DTL1B.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  RCPT-ID-OIC     PIC X(50)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2.                                                           
           05  FILLER          PIC X(04)  VALUE 'DATA'.                         
           05  FILLER          PIC X(76)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL3.                                                           
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                        
           05  MAIL-SENDMAILID PIC X(24)  VALUE                                 
               'SOC SYSTEM - EMAIL ALERT'.                                      
           05  FILLER          PIC X(49)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4.                                                           
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
      *    05  TO-MAIL-ID      PIC X(11)  VALUE 'LEE_LI_PENG'.                  
           05  TO-MAIL-ID      PIC X(14)  VALUE 'Iris_LL_KOR'.                  
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
           05  FILLER          PIC X(57)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4-A.                                                         
           05  FILLER          PIC X(04)  VALUE 'CC:<'.                         
           05  CC-MAIL-ID      PIC X(24)  VALUE                                 
                                          'KATHIJAH_BEE_ALI_MOHAMED'.           
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
           05  FILLER          PIC X(46)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4A.                                                          
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  TO-MAIL-ID      PIC X(14)  VALUE 'TENG_SIEW_HONG'.               
           05  FILLER          PIC X(12)  VALUE '@HDB.GOV.SG>'.                 
           05  FILLER          PIC X(57)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4B.                                                          
           05  FILLER          PIC X(04)  VALUE 'TO:<'.                         
           05  TO-MAIL-ID-OIC  PIC X(60)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL5.                                                           
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  TITLE1          PIC X(10)  VALUE 'SUMMARY - '.                   
           05  MAIL-SUBJECT    PIC X(50)  VALUE                                 
               'Exception Report for the Payment of Sales Levy - '.             
           05  MAIL-DATE-DTL5  PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL5A.                                                          
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  TITLE2          PIC X(14)  VALUE 'QN/SD Cases - '.               
           05  MAIL-SUBJECT    PIC X(50)  VALUE                                 
               'Exception Report for the Payment of Sales Levy - '.             
           05  MAIL-DATE-DTL5A PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL5B.                                                          
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  TITLE3          PIC X(11)  VALUE 'LN Cases - '.                  
           05  MAIL-SUBJECT    PIC X(50)  VALUE                                 
               'Exception Report for the Payment of Sales Levy - '.             
           05  MAIL-DATE-DTL5B PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6.                                                           
           05  FILLER          PIC X(06)  VALUE 'DATE: '.                       
           05  MAIL-DATE-DTL6  PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL7.                                                           
           05  FILLER          PIC X(12)  VALUE 'BP13L35I    '.                 
           05  FILLER          PIC X(10)  VALUE 'HDBCAT 3  '.                   
           05  FILLER          PIC X(41)  VALUE                                 
               'S Y S T E M   O F   C O M M I T M E N T  '.                     
           05  FILLER          PIC X(06)  VALUE 'DATE: '.                       
           05  MAIL-DATE-DTL7  PIC X(10)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL8.                                                           
           05  FILLER          PIC X(10)  VALUE SPACES.                         
           05  FILLER          PIC X(47)  VALUE                                 
               'EXCEPTION REPORT FOR THE PAYMENT OF SALES LEVY'.                
                                                                                
       01  MAIL-BODY02.                                                         
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE 'S/N '.                         
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(08)  VALUE ' Regn No'.                     
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(09)  VALUE '   NRIC  '.                    
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(08)  VALUE 'Res Stat'.                     
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(13)  VALUE 'Resale HDBRef'.                
           05 FILLER           PIC X(10)  VALUE SPACES.                         
           05 FILLER           PIC X(20)  VALUE '     CSM (POSB)     '.         
           05 FILLER           PIC X(12)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE 'LOAN'.                         
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE 'In K162'.                      
                                                                                
       01  MAIL-BODY03.                                                         
           05 MAIL-SNO         PIC ZZZZZ9 VALUE ZEROS.                          
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 MAIL-HYBRID-TAG  PIC X(01)  VALUE SPACES.                         
           05 MAIL-REGN-NO     PIC X(08)  VALUE SPACES.                         
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 MAIL-NRIC1       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT    PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(06)  VALUE SPACES.                         
           05 MAIL-HDB-REF     PIC X(11)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-CSM         PIC X(38)  VALUE SPACES.                         
           05 FILLER           PIC X(02)  VALUE SPACES.                         
           05 MAIL-LOAN-TAG    PIC X(01)  VALUE SPACES.                         
           05 FILLER           PIC X(06)  VALUE SPACES.                         
           05 MAIL-K162-TAG    PIC X(01)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY04.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC2       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT2   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF2    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY05.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC3       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT3   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF3    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY06.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC4       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT4   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF4    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY07.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC5       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT5   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF5    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY08.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC6       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT6   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF6    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY09.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC7       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT7   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF7    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY10.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC8       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT8   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF8    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY11.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC9       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT9   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF9    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY12.                                                         
           05 FILLER           PIC X(19)  VALUE SPACES.                         
           05 MAIL-NRIC0       PIC X(09)  VALUE SPACES.                         
           05 FILLER           PIC X(04)  VALUE SPACES.                         
           05 MAIL-RES-STAT0   PIC X(02)  VALUE SPACES.                         
           05 FILLER           PIC X(07)  VALUE SPACES.                         
           05 MAIL-HDB-REF0    PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-TRL1.                                                           
           05 FILLER           PIC X(06)  VALUE 'Note: '.                       
           05 FILLER           PIC X(50)  VALUE                                 
              'Regn no. with an * refers to cases with more than '.             
                                                                                
       01  MAIL-TRL2.                                                           
           05 FILLER           PIC X(06)  VALUE SPACES.                         
           05 FILLER           PIC X(51)  VALUE                                 
              '1 type of  Resale Status code. Please double check.'.            
                                                                                
       01  MAIL-SPACES.                                                         
           05 FILLER           PIC X(80)  VALUE SPACES.                         
                                                                                
       01  MAIL-END.                                                            
           05 FILLER                   PIC X      VALUE '.'.                    
                                                                                
      *----------------------------------------------------------------*        
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                        *        
      *----------------------------------------------------------------*        
       01  WS-BP13CCNT-LINK.                                                    
           05  LINK-CNTCT-TYPE         PIC X(3).                                
           05  LINK-STAFF-NICK         PIC X(6).                                
           05  LINK-STAFF-NUM          PIC X(6).                                
           05  LINK-STAFF-CNTCT        PIC X(50).                               
           05  LINK-SYSERR             PIC X(4).                                
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN-LOGIC.                                                         
      *-------------------------------------------------------------            
                                                                                
           ACCEPT WS-SYSIN-PARAMETER FROM SYSIN.                                
           DISPLAY WS-SYSIN-PARAMETER                                           
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CUR-DATE.                      
                                                                                
           MOVE WS-CCYY TO WS-EDT-CCYY.                                         
           MOVE WS-MM   TO WS-EDT-MM.                                           
           MOVE WS-DD   TO WS-EDT-DD.                                           
                                                                                
           PERFORM 1000-OPEN-FILES     THRU 1000-EXIT.                          
           PERFORM 2000-READ-BP13L35H  THRU 2000-EXIT.                          
                                                                                
           IF WS-L35H-READ  =  0                                                
              IF WS-SYSIN-PARAMETER = 'L'                                       
                 DISPLAY 'FILE BP13L35H IS EMPTY, NO EMAIL TO CREATE'           
                 MOVE 04                   TO RETURN-CODE                       
              ELSE                                                              
                 PERFORM 4000-PRINT-MAIL-HDR  THRU 4000-EXIT                    
                 MOVE SPACES               TO MAIL-BODY03                       
                                              MAIL-BODY04                       
                                              MAIL-BODY05                       
                                              MAIL-BODY06                       
                                              MAIL-BODY07                       
                                              MAIL-BODY08                       
                                              MAIL-BODY09                       
                                              MAIL-BODY10                       
                                              MAIL-BODY11                       
                                              MAIL-BODY12                       
                 MOVE '                           <   EMPTY  REPORT   >'        
                                           TO MAIL-BODY03                       
                 PERFORM 4100-PRINT-MAIL-DTL  THRU 4100-EXIT                    
              END-IF                                                            
           ELSE                                                                 
              PERFORM 4000-PRINT-MAIL-HDR  THRU 4000-EXIT                       
              PERFORM 3000-WRITE-EMAIL     THRU 3000-EXIT                       
                UNTIL WS-L35H-EOF = 'Y'                                         
           END-IF                                                               
                                                                                
           IF WS-SYSIN-PARAMETER    NOT = 'S'                                   
              IF WS-SYSIN-PARAMETER = 'L' AND                                   
                 WS-L35H-READ       =  0                                        
                 NEXT SENTENCE                                                  
              ELSE                                                              
                 WRITE MAIL-PRTREC            FROM MAIL-SPACES                  
                 WRITE MAIL-PRTREC            FROM MAIL-TRL1                    
                 WRITE MAIL-PRTREC            FROM MAIL-TRL2                    
                 WRITE MAIL-PRTREC            FROM MAIL-END                     
              END-IF                                                            
           ELSE                                                                 
              WRITE MAIL-PRTREC            FROM MAIL-END                        
           END-IF.                                                              
                                                                                
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.                      
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
                                                                                
           OPEN INPUT  BP13L35H                                                 
                OUTPUT MAILFILE.                                                
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13L35H.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13L35H AT END                                                 
                MOVE 'Y' TO WS-L35H-EOF                                         
                GO TO 2000-EXIT.                                                
                                                                                
           ADD 1 TO WS-L35H-READ.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-WRITE-EMAIL.                                                        
      *-------------------------------------------------------------            
                                                                                
           PERFORM 3100-MOVE-L35H-DTL  THRU 3100-EXIT.                          
           PERFORM 4100-PRINT-MAIL-DTL THRU 4100-EXIT.                          
           PERFORM 2000-READ-BP13L35H  THRU 2000-EXIT.                          
           IF WS-SYSIN-PARAMETER = 'L'                                          
              IF L35H-NUM-CSM(2:3) NOT = WS-SAVE-OIC                            
                 WRITE MAIL-PRTREC           FROM MAIL-SPACES                   
                 WRITE MAIL-PRTREC           FROM MAIL-TRL1                     
                 WRITE MAIL-PRTREC           FROM MAIL-TRL2                     
                 WRITE MAIL-PRTREC           FROM MAIL-END                      
                 PERFORM 4000-PRINT-MAIL-HDR THRU 4000-EXIT                     
                 MOVE 0 TO WS-SNO                                               
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3100-MOVE-L35H-DTL.                                                      
      *-------------------------------------------------------------            
                                                                                
           INITIALIZE              MAIL-BODY03                                  
                                   MAIL-BODY04                                  
                                   MAIL-BODY05                                  
                                   MAIL-BODY06                                  
                                   MAIL-BODY07                                  
                                   MAIL-BODY08                                  
                                   MAIL-BODY09                                  
                                   MAIL-BODY10                                  
                                   MAIL-BODY11                                  
                                   MAIL-BODY12.                                 
           IF L35H-NUM-REGN = WS-SAVE-MAIL-REGN-NO                              
              ADD 1 TO WS-DUP                                                   
              EVALUATE WS-DUP                                                   
              WHEN 1                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC2                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT2                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF2                       
              WHEN 2                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC3                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT3                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF3                       
              WHEN 3                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC4                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT4                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF4                       
              WHEN 4                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC5                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT5                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF5                       
              WHEN 5                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC6                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT6                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF6                       
              WHEN 6                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC7                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT7                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF7                       
              WHEN 7                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC8                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT8                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF8                       
              WHEN 8                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC9                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT9                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF9                       
              WHEN 9                                                            
                 MOVE L35H-NRIC          TO MAIL-NRIC0                          
                 MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT0                      
                 MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF0                       
              END-EVALUATE                                                      
           ELSE                                                                 
              MOVE 0 TO WS-DUP                                                  
              COMPUTE WS-SNO = WS-SNO + 1                                       
              MOVE WS-SNO             TO MAIL-SNO                               
              MOVE L35H-NUM-REGN      TO MAIL-REGN-NO                           
              MOVE L35H-NUM-REGN      TO WS-SAVE-MAIL-REGN-NO                   
              MOVE L35H-NRIC          TO MAIL-NRIC1                             
              MOVE L35H-RESALE-STATUS TO MAIL-RES-STAT                          
              MOVE L35H-NUM-HDBREF    TO MAIL-HDB-REF                           
              MOVE L35H-NUM-CSM       TO MAIL-CSM                               
              MOVE L35H-LOAN-TAG      TO MAIL-LOAN-TAG                          
              MOVE L35H-K162-TAG      TO MAIL-K162-TAG                          
              IF WS-SYSIN-PARAMETER   NOT = 'S'                                 
                 IF L35H-HYBRID-TAG = '*'                                       
                    MOVE L35H-HYBRID-TAG TO MAIL-HYBRID-TAG                     
                 ELSE                                                           
                    MOVE SPACE           TO MAIL-HYBRID-TAG                     
                 END-IF                                                         
              ELSE                                                              
                 MOVE SPACE              TO MAIL-HYBRID-TAG                     
              END-IF                                                            
           END-IF.                                                              
           ADD 1 TO WS-L35H-WRITE.                                              
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4000-PRINT-MAIL-HDR.                                                     
      *-------------------------------------------------------------            
                                                                                
           INITIALIZE              MAIL-PRTREC.                                 
                                                                                
           WRITE MAIL-PRTREC       FROM MAIL-HDR1.                              
           WRITE MAIL-PRTREC       FROM MAIL-HDR2.                              
           IF WS-SYSIN-PARAMETER   = 'S'                                        
              WRITE MAIL-PRTREC    FROM MAIL-DTL1                               
              WRITE MAIL-PRTREC    FROM MAIL-DTL1A                              
           ELSE                                                                 
             IF WS-SYSIN-PARAMETER = 'Q'                                        
                WRITE MAIL-PRTREC  FROM MAIL-DTL1A                              
             ELSE                                                               
                IF L35H-OIC-EMAIL  = SPACES                                     
                   DISPLAY 'NO EMAIL RECIPIENT FOR REGN NUM '                   
                           L35H-NUM-REGN                                        
                   MOVE 23                     TO  RETURN-CODE                  
                   PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT                   
                ELSE                                                            
                   MOVE SPACES     TO   RCPT-ID-OIC                             
                   STRING L35H-OIC-EMAIL '>'                                    
                   DELIMITED BY SPACE INTO RCPT-ID-OIC                          
                   WRITE MAIL-PRTREC  FROM MAIL-DTL1B                           
                END-IF                                                          
             END-IF                                                             
           END-IF                                                               
                                                                                
           WRITE MAIL-PRTREC FROM MAIL-DTL2.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL3.                                    
           IF WS-SYSIN-PARAMETER = 'S'                                          
              WRITE MAIL-PRTREC         FROM MAIL-DTL4                          
              WRITE MAIL-PRTREC         FROM MAIL-DTL4A                         
              MOVE  WS-EDT-DATE         TO   MAIL-DATE-DTL5                     
              WRITE MAIL-PRTREC         FROM MAIL-DTL5                          
           ELSE                                                                 
             IF WS-SYSIN-PARAMETER = 'Q'                                        
                WRITE MAIL-PRTREC       FROM MAIL-DTL4A                         
                MOVE  WS-EDT-DATE       TO   MAIL-DATE-DTL5A                    
                WRITE MAIL-PRTREC       FROM MAIL-DTL5A                         
             ELSE                                                               
                MOVE L35H-NUM-CSM(2:3)  TO WS-SAVE-OIC                          
                MOVE SPACES             TO TO-MAIL-ID-OIC                       
                STRING L35H-OIC-EMAIL '>'                                       
                DELIMITED BY SPACE INTO TO-MAIL-ID-OIC                          
                WRITE MAIL-PRTREC       FROM MAIL-DTL4B                         
                MOVE  WS-EDT-DATE       TO   MAIL-DATE-DTL5B                    
                WRITE MAIL-PRTREC       FROM MAIL-DTL5B                         
             END-IF                                                             
           END-IF                                                               
           MOVE  WS-EDT-DATE TO   MAIL-DATE-DTL6                                
           WRITE MAIL-PRTREC FROM MAIL-DTL6                                     
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           MOVE  WS-EDT-DATE TO   MAIL-DATE-DTL7                                
           WRITE MAIL-PRTREC FROM MAIL-DTL7                                     
           WRITE MAIL-PRTREC FROM MAIL-DTL8                                     
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY02.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4100-PRINT-MAIL-DTL.                                                     
      *-------------------------------------------------------------            
                                                                                
           INITIALIZE                   MAIL-PRTREC.                            
                                                                                
           IF WS-DUP = 0                                                        
              WRITE MAIL-PRTREC    FROM MAIL-BODY03                             
           ELSE                                                                 
              IF MAIL-NRIC2 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY04                             
              END-IF                                                            
              IF MAIL-NRIC3 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY05                             
              END-IF                                                            
              IF MAIL-NRIC4 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY06                             
              END-IF                                                            
              IF MAIL-NRIC5 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY07                             
              END-IF                                                            
              IF MAIL-NRIC6 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY08                             
              END-IF                                                            
              IF MAIL-NRIC7 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY09                             
              END-IF                                                            
              IF MAIL-NRIC8 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY10                             
              END-IF                                                            
              IF MAIL-NRIC9 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY11                             
              END-IF                                                            
              IF MAIL-NRIC0 NOT = SPACES                                        
                 WRITE MAIL-PRTREC FROM MAIL-BODY12                             
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
                                                                                
                                                                                
           DISPLAY '---- BP13C35I CONTROL TOTAL -----'.                         
           DISPLAY ' NO OF REC READ FROM BP13L35H  = '                          
                     WS-L35H-READ.                                              
           DISPLAY ' NO OF REC WRITTEN TO MAILFILE = '                          
                     WS-L35H-WRITE.                                             
           DISPLAY SPACES.                                                      
                                                                                
           CLOSE       BP13L35H                                                 
                       MAILFILE.                                                
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
