      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    BP13C305.                                                 
      *AUTHOR.        TMK.                                                      
      *DATE-WRITTEN.  19/10/89.                                                 
                                                                                
      * ======================================================== *              
      * SYSTEM OF COMMITMENT (BP13)                              *              
      * ======================================================== *              
      *    OBJECTIVE :                                           *              
      *      LIST OF AMOUNT TO BE FORFEITED AND REFUNDED FOR     *              
      *      REJECTION OF FLAT AFTER SA.                         *              
      *                                                          *              
      *    LISTING :                                             *              
      *      1. P13L305A - LIST OF AMOUNT FORFEITED AND REFUNDED *              
      *                    FOR REJECTION OF FLAT AFTER SA.       *              
      *      2. P13L305B/C/D - FOR STUDIO APARTMENT.             *              
      * ======================================================== *              
      * CHG-NO   DATE   BY   DESCRIPTION                         *              
      * -------- ------ ---  -----------                         *              
      * C900919  900928 LKH  TO CHECK FOR IDP-SCH, IF THE CD-REG *              
      *                      IS 10% OF SELLING-PRICE THEN        *              
      *                      FORFEIT THE WHOLE AMT.              *              
      *                      TO TAG RESALE-CANCEL-REASON IN RFF  *              
      *                      AS '25'.                            *              
      *                      TO OUTPUT THE CPF REFUND TO         *              
      *                      EX-APPLT FILE.                      *              
      * C910737  910820 ACK  FORFEITURE IS BASE ON 3 TIMES OF    *              
      *                      BOOKING FEE INSTEAD OF 10% 0F CD    *              
      * C920167  920811 LJL  TO ERASE THE DELIVERY POSSN DATE    *              
      *                      FROM RFF MASTER.                    *              
      * C9210F3  921219 RAZ  OUTPUT RECORDS TO BP13F380          *              
      * I920718  930111 LJL  CHANGE TO COBOL II                  *              
      * SOCPH8   930916 BSL  CHANGE FROM P10K020 TO BP13K800     *              
      * BP130030 951010 SSS  CHG FORMAT OF REPORT-ID             *              
      * BP130418 980403 MPA  YEAR 2000 CHANGES                   *              
      * BP130418 980603 SGK  YEAR 2000 CHANGES                   *              
      * BP130530 981025 SRN  TO MOVE F310-NUM CANCEL-REASON TO   *              
      *                              K800-NUM CANCEL-REASON      *              
      * BP130666 990717 JMS  TO MOVE ZEROES IF K800-AMT-CD-CPF   *              
      *                      IS NOT NUMERIC.                     *              
      * BP130696 300799 CLT  TO REMOVE WRITING TO BP13KIV FILE   *              
      * BP130728 041099 JMS  TO CATER FOR STUDIO APARTMENT CASES *              
      * BP130790 160200 JMS  TO ADD IN-STREAM DOCUMENTATION      *              
      * BP130952 261200 ESC  TO CATER FOR 'RED' ALLOC SCHEME     *              
      * BP130998 170401 CLT  TO EXPAND BP13K350 TO LENGTH 600    *              
      * BP130962 010801 MALC TO DISPLAY ACTUAL REFUND/FORFEIT    *              
      *                      AMT WITH DECIMAL POINT              *              
      * BP132001 020801 MALC TO UPDATE CANCEL STAT & SOC MASTER  *              
      *                      IF OPT FOR RENTAL=Y & ALLOC-RENTAL=Y*              
      * BP131063 020801 CKK  TO CATER FOR BTO/COF BKING FEE OF   *              
      *                      $2000                               *              
      * BP132118 010302 CLT  CATER FOR SERS/RED STDAPT CASE      *              
      * BP132487 030304 MJ16 TO BLANK OFF DPD IF KEY AVAILABLE   *              
      * BP132525 060504 JF4  REMOVE $1 CPF IN CD CONTROL         *              
      * BP132577 190804 SK   INCLUDE BP13F915 (CDB FILE)         *              
      * BP132656 270105 JF4  REMOVE CHECK ON NUM-ALLO-SCHEME     *              
      *                      FOR NRT CASE                        *              
      * BP137200 080318 FNP1 CHANGE 'DE' TXN-TYPE TO 'TE' IN F915*              
      * BP137326 061218 FNP1 BLANK OFF OTHER DETAILS WHEN CREATING              
      *                      'TE' FOR F915                                      
      * ======================================================== *              
                                                                                
      *-----------------------*                                                 
       ENVIRONMENT DIVISION.                                                    
      *-----------------------*                                                 
       CONFIGURATION SECTION.                                                   
      *-----------------------*                                                 
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ACCESS MODE    IS RANDOM                                      
                  ORGANIZATION   IS INDEXED                                     
                  RECORD KEY     IS K800-NUM-REGN                               
                  FILE STATUS    IS BP13K800-STATUS.                            
                                                                                
           SELECT BP13K820 ASSIGN TO BP13K820                                   
                  ACCESS MODE    IS DYNAMIC                                     
                  ORGANIZATION   IS INDEXED                                     
                  RECORD KEY     IS K820-KEY-FLD                                
                  FILE STATUS    IS BP13K820-STATUS.                            
                                                                                
           SELECT BP13K840 ASSIGN TO BP13K840                                   
                  ACCESS MODE    IS RANDOM                                      
                  ORGANIZATION   IS INDEXED                                     
                  RECORD KEY     IS K840-KEY-FLD                                
                  FILE STATUS    IS BP13K840-STATUS.                            
                                                                                
           SELECT BP13K150 ASSIGN TO BP13K150                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K150-KEY-FLD                               
                  FILE STATUS     IS BP13K150-STATUS.                           
                                                                                
           SELECT BP13K350 ASSIGN TO BP13K350                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K350-KEY-FLD                               
                  FILE STATUS     IS BP13K350-STATUS.                           
                                                                                
           SELECT BM06K110 ASSIGN TO BM06K110                                   
                  ACCESS          IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K110-KEY-FLD                               
                  FILE STATUS     IS BM06K110-STATUS.                           
                                                                                
           SELECT BB14K580 ASSIGN TO BB14K580                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS RANDOM                                     
                  RECORD KEY      IS K580-KEY-FLD                               
                  FILE STATUS     IS BB14K580-STATUS.                           
                                                                                
           SELECT BP13OUT  ASSIGN TO BP13OUT.                                   
           SELECT BP13F380 ASSIGN TO BP13F380.                                  
           SELECT BP13F915 ASSIGN TO BP13F915.                                  
           SELECT BP13F310 ASSIGN TO BP13F310.                                  
           SELECT P13L305A ASSIGN TO P13L305A.                                  
           SELECT P13L305B ASSIGN TO P13L305B.                                  
           SELECT P13L305C ASSIGN TO P13L305C.                                  
           SELECT P13L305D ASSIGN TO P13L305D.                                  
                                                                                
                                                                                
      *-----------------------*                                                 
       DATA DIVISION.                                                           
      *-----------------------*                                                 
       FILE SECTION.                                                            
      *-----------------------*                                                 
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K840                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K840.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BB14K580                                                            
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY BB14K580.                                                           
                                                                                
       FD   BP13F310                                                            
            BLOCK  CONTAINS  0  RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
       COPY BP13F310.                                                           
                                                                                
       FD   BP13F915                                                            
            BLOCK  CONTAINS 0   RECORDS                                         
            RECORD CONTAINS 800 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
       COPY BP13F915.                                                           
                                                                                
       FD   BP13F380                                                            
            BLOCK  CONTAINS  0  RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
       COPY BP13F380.                                                           
                                                                                
       FD   BP13K150                                                            
            RECORD CONTAINS 150 CHARACTERS.                                     
       COPY BP13K150.                                                           
                                                                                
       FD   BP13K350                                                            
            RECORD CONTAINS 600 CHARACTERS.                                     
       COPY BP13K350.                                                           
                                                                                
       FD   BP13OUT                                                             
            BLOCK  CONTAINS  0  RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
       01   BP13OUT-REC                          PIC X(150).                    
                                                                                
       FD   P13L305A                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
       01   L305A-PRTREC                         PIC X(132).                    
                                                                                
       FD   P13L305B                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
       01   L305B-PRTREC                         PIC X(132).                    
                                                                                
       FD   P13L305C                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
       01   L305C-PRTREC                         PIC X(132).                    
                                                                                
       FD   P13L305D                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
       01   L305D-PRTREC                         PIC X(132).                    
                                                                                
                                                                                
      *-------------------------------------------------------------            
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-FILE-ACCESS-STATUS.                                               
           05  BP13K800-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BP13K820-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BP13K840-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BP13K150-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BP13K350-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BM06K110-STATUS         PIC 9(2)  VALUE ZEROS.                   
           05  BB14K580-STATUS         PIC 9(2)  VALUE ZEROS.                   
                                                                                
       01  WS-FORFEITURE-AMOUNTS.                                               
           05  WS-FFCASH               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FFCPF1               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FFCPF2               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FFCPF3               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FFCPF4               PIC S9(7)V99   VALUE ZEROES.             
                                                                                
           05  WS-RFCASH               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-RFCPF1               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-RFCPF2               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-RFCPF3               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-RFCPF4               PIC S9(7)V99   VALUE ZEROES.             
                                                                                
           05  WS-FF-AMT               PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FORFEIT              PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FF-VAR1              PIC S9(7)V99   VALUE ZEROES.             
           05  WS-FF-VAR2              PIC S9(7)V99999 VALUE ZEROES.            
           05  WS-BK                   PIC S9(4)V99    VALUE ZEROES.            
           05  WS-TOTAL                PIC S9(7)V99    VALUE ZEROES.            
                                                                                
       01  WS-TOTAL-FORFEITURE-AMOUNTS.                                         
           05  WS-TOT-FORFEIT              PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-REFUND               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCASH               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF1               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF2               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF3               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF4               PIC S9(8)V99   VALUE ZEROES.         
                                                                                
           05  WS-TOT-RFCASH               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF1               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF2               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF3               PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF4               PIC S9(8)V99   VALUE ZEROES.         
                                                                                
           05  WS-TOT-FFCASH-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF1-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF2-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF3-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-FFCPF4-SA            PIC S9(8)V99   VALUE ZEROES.         
                                                                                
           05  WS-TOT-RFCASH-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF1-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF2-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF3-SA            PIC S9(8)V99   VALUE ZEROES.         
           05  WS-TOT-RFCPF4-SA            PIC S9(8)V99   VALUE ZEROES.         
                                                                                
      **********************************************************                
      *    WORKING STORAGE FOR DPD                             *                
      **********************************************************                
       01 WS-K110-READ                     PIC  9(7)      VALUE 0.              
       01 WS-K580-READ                     PIC  9(7)      VALUE 0.              
       01 WS-K580-UPD                      PIC  9(7)      VALUE 0.              
       01 WS-K110-BYPASS                   PIC  9(7)      VALUE 0.              
       01 WS-K580-BYPASS                   PIC  9(7)      VALUE 0.              
       01 WS-BM06K110-FND                  PIC  X(1)      VALUE 'N'.            
       01 WS-BB14K580-FND                  PIC  X(1)      VALUE 'N'.            
       01 WS-K820-EOF                      PIC  X(1)      VALUE 'N'.            
                                                                                
      **********************************************************                
      *    WORKING STORAGE FOR MISMATCHED LIST                 *                
      **********************************************************                
       01  WS1-COUNTERS.                                                        
           05  WS1-CNT-SEQ-A           PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-SEQ-B           PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-SEQ-C           PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-SEQ-D           PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-READ-F310       PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-WRT-F380        PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-WRT-F915        PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-REWRITE-K800    PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-REWRITE-K840    PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-REWRITE-K150    PIC 9(7)    VALUE 0.                     
           05  WS1-CNT-LINE-L305A      PIC 9(4)    VALUE 66.                    
           05  WS1-CNT-LINE-L305B      PIC 9(4)    VALUE 66.                    
           05  WS1-CNT-LINE-L305C      PIC 9(4)    VALUE 66.                    
           05  WS1-CNT-LINE-L305D      PIC 9(4)    VALUE 66.                    
           05  WS1-CNT-PAGE-L305A      PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-PAGE-L305B      PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-PAGE-L305C      PIC 9(4)    VALUE 0.                     
           05  WS1-CNT-PAGE-L305D      PIC 9(4)    VALUE 0.                     
                                                                                
       01  WS2-DEFAULT-VALUES.                                                  
           05  WS2-MAX-LINES           PIC 9(2)   VALUE  48.                    
           05  WS2-RPT-A               PIC X(8)   VALUE  'P13L305A'.            
           05  WS2-RPT-B               PIC X(8)   VALUE  'P13L305B'.            
           05  WS2-RPT-C               PIC X(8)   VALUE  'P13L305C'.            
           05  WS2-RPT-D               PIC X(8)   VALUE  'P13L305D'.            
           05  WS3-PRT-DATE            PIC X(10).                               
                                                                                
       01  WS-EX-APPLT-DTLS.                                                    
           05  WS-NUM-CPF          PIC X(9).                                    
           05  WS-AMT-CPF-PAID     PIC S9(7)V99  VALUE ZEROS.                   
           05  WS-EDIT-CPF-PAID    PIC ZZZZZZ9.99- VALUE ZEROS.                 
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT COMMON TO L305A & L305B                                
      *-------------------------------------------------------------            
       01  L305-PRT-HEAD-1.                                                     
           05  L305-HD1-RPT-ID     PIC X(8)    VALUE SPACES.                    
           05  FILLER              PIC X(10)   VALUE '      HDB3'.              
           05  FILLER              PIC X(22)   VALUE SPACES.                    
           05  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'DATE: '.                  
           05  L305-HD1-DATE       PIC X(10)   VALUE SPACES.                    
           05  FILLER              PIC X(8)    VALUE ' PAGE: '.                 
           05  L305-HD1-PAGE-NO    PIC ZZZZ9.                                   
                                                                                
       01  L305-PRT-HEAD-2.                                                     
           05  FILLER              PIC X(57)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE                            
              'AGREEMENT TEAM'.                                                 
                                                                                
       01  L305-PRT-HEAD-3.                                                     
           05  FILLER              PIC X(44)   VALUE SPACES.                    
           05  FILLER              PIC X(45)   VALUE                            
              'LIST OF AMOUNT TO BE FORFEITED AND REFUNDED'.                    
                                                                                
       01  L305-PRT-HEAD-4.                                                     
           05  FILLER              PIC X(44)   VALUE SPACES.                    
           05  FILLER              PIC X(45)   VALUE                            
              '     FOR REJECTION OF FLAT AFTER SA'.                            
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT FOR L305 - LIST                                        
      *-------------------------------------------------------------            
       01  L305A-PRT-HEAD-5.                                                    
           05  FILLER              PIC X(41) VALUE SPACES.                      
           05  FILLER              PIC X(13) VALUE 'REFUND AMOUNT'.             
           05  FILLER              PIC X(40) VALUE SPACES.                      
           05  FILLER              PIC X(16) VALUE 'FORFEITED AMOUNT'.          
                                                                                
       01  L305A-PRT-HEAD-6.                                                    
           05  FILLER              PIC X(02) VALUE SPACE.                       
           05  FILLER              PIC X(02) VALUE 'NO'.                        
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'REGN-NO'.                   
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CASH'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF1'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF2'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF3'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF4'.                      
           05  FILLER              PIC X(09) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CASH'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF1'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF2'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF3'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF4'.                      
                                                                                
       01  L305D-PRT-HEAD-1.                                                    
           05  FILLER              PIC X(21) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(09) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TOT '.                      
                                                                                
       01  L305D-PRT-HEAD-2.                                                    
           05  FILLER              PIC X(21) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CASH'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF1'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF2'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF3'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF4'.                      
           05  FILLER              PIC X(09) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CASH'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF1'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF2'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF3'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'CPF4'.                      
                                                                                
       01  L305A-PRT-DETAIL.                                                    
           05  FILLER              PIC X(01) VALUE SPACE.                       
           05  L305A-SEQ-NO        PIC ZZZ9.                                    
           05  FILLER              PIC X(04) VALUE SPACES.                      
           05  L305A-CUR-REG       PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  L305A-AMOUNTS.                                                   
               10  L305A-RFCASH        PIC Z(4)9.99.                            
               10  L305A-RFCASH-X REDEFINES L305A-RFCASH PIC X(8).              
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-RFCPF1        PIC Z(4)9.99.                            
               10  L305A-RFCPF1-X REDEFINES L305A-RFCPF1 PIC X(8).              
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-RFCPF2        PIC Z(4)9.99.                            
               10  L305A-RFCPF2-X REDEFINES L305A-RFCPF2 PIC X(8).              
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-RFCPF3        PIC Z(4)9.99.                            
               10  L305A-RFCPF3-X REDEFINES L305A-RFCPF3 PIC X(8).              
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-RFCPF4        PIC Z(4)9.99.                            
               10  L305A-RFCPF4-X REDEFINES L305A-RFCPF4 PIC X(8).              
               10  FILLER              PIC X(04) VALUE SPACES.                  
               10  L305A-FFCASH        PIC Z(4)9.99.                            
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-FFCPF1        PIC Z(4)9.99.                            
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-FFCPF2        PIC Z(4)9.99.                            
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-FFCPF3        PIC Z(4)9.99.                            
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L305A-FFCPF4        PIC Z(4)9.99.                            
                                                                                
       01  L305A-PRT-TOTAL.                                                     
           05  FILLER              PIC X(19) VALUE SPACE.                       
           05  L305A-TOT-RFCASH    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-RFCPF1    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-RFCPF2    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-RFCPF3    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-RFCPF4    PIC Z(5)9.99.                                
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  L305A-TOT-FFCASH    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-FFCPF1    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-FFCPF2    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-FFCPF3    PIC Z(5)9.99.                                
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305A-TOT-FFCPF4    PIC Z(5)9.99.                                
                                                                                
       01  L305A-PRT-TOTAL-LINE.                                                
           05  FILLER              PIC X(019)  VALUE SPACE.                     
           05  FILLER              PIC X(101)  VALUE ALL '-'.                   
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT FOR L305 - MISMATCHED LIST                             
      *-------------------------------------------------------------            
       01  L305B-PRT-HEAD-5.                                                    
           05  FILLER              PIC X(49)   VALUE SPACES.                    
           05  FILLER              PIC X(90)   VALUE                            
                  'UNMATCHED LISTING'.                                          
                                                                                
       01  L305B-PRT-HEAD-6.                                                    
           05  FILLER              PIC X(01)   VALUE SPACES.                    
           05  FILLER              PIC X(02)   VALUE 'NO'.                      
           05  FILLER              PIC X(07)   VALUE SPACES.                    
           05  FILLER              PIC X(07)   VALUE 'REGN-NO'.                 
           05  FILLER              PIC X(06)   VALUE SPACES.                    
           05  FILLER              PIC X(07)   VALUE 'REMARKS'.                 
           05  FILLER              PIC X(90)   VALUE SPACES.                    
           05  FILLER              PIC X(11)   VALUE 'RETURN CODE'.             
                                                                                
       01  L305B-PR-ERROR.                                                      
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  L305B-SEQ-NO        PIC ZZZ9  VALUE ZEROES.                      
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  L305B-KEY           PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  L305B-ERRMSG        PIC X(95) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  L305B-RETURN-CODE   PIC X(02) VALUE SPACES.                      
                                                                                
       01  L305C-CC-DETL-1.                                                     
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  FILLER              PIC X(34) VALUE                              
           'CC  RHS - APPLICATION OF REGN NO. '.                                
           05  L305C-REGN-NO       PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(17) VALUE                              
           ' ALLOCATED RENTAL'.                                                 
           05  FILLER              PIC X(57) VALUE                              
           ' FLAT AT_________________________________________________'.         
                                                                                
       01  L305C-CC-DETL-2.                                                     
           05  FILLER              PIC X(15) VALUE SPACES.                      
           05  FILLER              PIC X(57) VALUE                              
           'HAS CANCELLED HIS/HER STUDIO APARTMENT FLAT. PLEASE SERVE'.         
           05  FILLER              PIC X(48) VALUE                              
           ' 3 MONTHS NOTICE FROM DATE OF CANCELLATION WITH '.                  
                                                                                
       01  L305C-CC-DETL-3.                                                     
           05  FILLER              PIC X(15) VALUE SPACES.                      
           05  FILLER              PIC X(12) VALUE                              
           'EFFECT FROM '.                                                      
           05  L305C-CAN-DTE       PIC X(10) VALUE SPACES.                      
           05  FILLER              PIC X(34) VALUE                              
           ' TO APPLICANTS TO VACATE THE FLAT.'.                                
                                                                                
       01  WS-CANCEL-DATE.                                                      
           05  WS-CANCEL-DD        PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(01) VALUE '/'.                         
           05  WS-CANCEL-MM        PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(01) VALUE '/'.                         
           05  WS-CANCEL-CC        PIC X(02) VALUE SPACES.                      
           05  WS-CANCEL-YY        PIC X(02) VALUE SPACES.                      
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       MAIN-ROUTINE.                                                            
      *-------------------------------------------------------------            
           PERFORM 000-OPEN-FILES    THRU 000-OPEN-EXIT.                        
           PERFORM 100-MAIN-PROCESS  THRU 100-EXIT                              
             UNTIL F310-REGN-NO = HIGH-VALUE.                                   
           PERFORM 600-PRINT-TOTAL   THRU 600-EXIT.                             
           PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                       
                                                                                
       MAIN-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       000-OPEN-FILES.                                                          
      *-------------------------------------------------------------            
           OPEN INPUT  BP13F310                                                 
                       BP13K820                                                 
                       BP13K350                                                 
                       BM06K110                                                 
                I-O    BP13K800                                                 
                       BB14K580                                                 
                       BP13K840                                                 
                       BP13K150                                                 
                OUTPUT BP13OUT                                                  
                       BP13F380                                                 
                       BP13F915                                                 
                       P13L305A                                                 
                       P13L305B                                                 
                       P13L305C                                                 
                       P13L305D.                                                
                                                                                
           IF BP13K800-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K800 FILE ' BP13K800-STATUS            
              MOVE BP13K800-STATUS TO  RETURN-CODE                              
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BP13K820-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K820 FILE ' BP13K820-STATUS            
              MOVE BP13K820-STATUS TO  RETURN-CODE                              
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BP13K840-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K840 FILE ' BP13K840-STATUS            
              MOVE BP13K840-STATUS TO  RETURN-CODE                              
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BP13K150-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K150 FILE ' BP13K150-STATUS            
              MOVE BP13K150-STATUS  TO  RETURN-CODE                             
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BP13K350-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K350 FILE ' BP13K350-STATUS            
              MOVE BP13K350-STATUS  TO  RETURN-CODE                             
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BM06K110-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BM06K110 FILE ' BM06K110-STATUS            
              MOVE BM06K110-STATUS  TO  RETURN-CODE                             
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           IF BB14K580-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BB14K580 FILE ' BB14K580-STATUS            
              MOVE BB14K580-STATUS  TO  RETURN-CODE                             
              PERFORM 000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT.                    
                                                                                
           STRING FUNCTION CURRENT-DATE(7:2) '/'                                
                  FUNCTION CURRENT-DATE(5:2)'/'                                 
                  FUNCTION CURRENT-DATE(1:4)                                    
           DELIMITED BY SIZE INTO WS3-PRT-DATE.                                 
                                                                                
       000-OPEN-EXIT.                                                           
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       000-CLOSE-ROUTINE.                                                       
      *-------------------------------------------------------------            
           CLOSE BP13F310                                                       
                 BP13K800                                                       
                 BP13OUT                                                        
                 BP13F380                                                       
                 BP13F915                                                       
                 BP13K820                                                       
                 BP13K840                                                       
                 BP13K150                                                       
                 BP13K350                                                       
                 BM06K110                                                       
                 BB14K580                                                       
                 P13L305A                                                       
                 P13L305B                                                       
                 P13L305C.                                                      
                                                                                
           IF BP13K800-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K800 FILE ' BP13K800-STATUS            
              MOVE BP13K800-STATUS TO RETURN-CODE.                              
                                                                                
           IF BP13K820-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K820 FILE ' BP13K820-STATUS            
              MOVE BP13K820-STATUS TO RETURN-CODE.                              
                                                                                
           IF BP13K840-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K840 FILE ' BP13K840-STATUS            
              MOVE BP13K840-STATUS TO RETURN-CODE.                              
                                                                                
           IF BP13K150-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K150 FILE ' BP13K150-STATUS            
              MOVE BP13K150-STATUS TO RETURN-CODE.                              
                                                                                
           IF BP13K350-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K350 FILE ' BP13K350-STATUS            
              MOVE BP13K350-STATUS TO RETURN-CODE.                              
                                                                                
           IF BM06K110-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BM06K110 FILE ' BM06K110-STATUS            
              MOVE BM06K110-STATUS TO RETURN-CODE.                              
                                                                                
           IF BB14K580-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BB14K580 FILE ' BB14K580-STATUS            
              MOVE BB14K580-STATUS TO RETURN-CODE.                              
                                                                                
           DISPLAY ' ** BP13C305 ** '.                                          
           DISPLAY 'NO OF RECORDS READ FROM TRANSACTION FILE(BP13F310)'         
                   ' = ' WS1-CNT-READ-F310.                                     
           DISPLAY 'NO OF RECORDS UPDATED TO RFF MASTER     (BP13K800)'         
                   ' = ' WS1-CNT-REWRITE-K800.                                  
           DISPLAY 'NO OF RECORDS WRITTEN TO                (BP13F380)'         
                   ' = ' WS1-CNT-WRT-F380.                                      
           DISPLAY 'NO OF RECORDS WRITTEN TO                (BP13F915)'         
                   ' = ' WS1-CNT-WRT-F915.                                      
           DISPLAY 'NO OF RECORDS WRITTEN TO HISTORY UPDATE (BP13K840)'         
                   ' = ' WS1-CNT-REWRITE-K840.                                  
           DISPLAY 'NO OF RECORDS WRITTEN TO EX-APPLT FILE  (BP13K150)'         
                   ' = ' WS1-CNT-REWRITE-K150.                                  
           DISPLAY 'NO OF RECORDS READ FROM FIS FILE        (BM06K110)'         
                   ' = ' WS-K110-READ.                                          
           DISPLAY 'NO OF RECORDS BYPASSED FROM FIS FILE    (BM06K110)'         
                   ' = ' WS-K110-BYPASS.                                        
           DISPLAY 'NO OF RECORDS READ FROM LEASE FILE      (BB14K580)'         
                   ' = ' WS-K580-READ.                                          
           DISPLAY 'NO OF RECORDS BYPASSED FROM LEASE FILE  (BB14K580)'         
                   ' = ' WS-K580-BYPASS.                                        
           DISPLAY 'NO OF RECORDS UPDATED TO LEASE FILE     (BB14K580)'         
                   ' = ' WS-K580-UPD.                                           
           DISPLAY 'NO OF MATCHED RECORDS PRINTED           (P13L305A)'         
                   ' = ' WS1-CNT-SEQ-A.                                         
           DISPLAY 'NO OF UNMATCHED RECORDS PRINTED         (P13L305B)'         
                   ' = ' WS1-CNT-SEQ-B.                                         
           DISPLAY 'NO OF MATCHED STUDIO RECORDS PRINTED    (P13L305C)'         
                   ' = ' WS1-CNT-SEQ-C.                                         
                                                                                
           STOP RUN.                                                            
                                                                                
       000-CLOSE-EXIT.                                                          
           EXIT.                                                                
                                                                                
                                                                                
      **************************************************************            
      *   1. READ FILE BP13F310 AT END EXIT.                       *            
      *   2. READ BP13K800 RFF MASTER FILE                         *            
      *         IF RECORD FOUND                                    *            
      *            CHECK SOC VERSUS REQ AMOUNTS                    *            
      *         ELSE                                               *            
      *            OUTPUT RETURN CODE TO P13L305B.                 *            
      **************************************************************            
      *-------------------------------------------------------------            
       100-MAIN-PROCESS.                                                        
      *-------------------------------------------------------------            
           READ BP13F310 AT END MOVE HIGH-VALUE TO F310-REGN-NO                 
                GO TO 100-EXIT.                                                 
                                                                                
           MOVE ZEROES       TO WS-FORFEITURE-AMOUNTS.                          
           ADD 1             TO WS1-CNT-READ-F310.                              
           MOVE F310-REGN-NO TO K800-NUM-REGN.                                  
                                                                                
           READ BP13K800.                                                       
           IF BP13K800-STATUS = 0                                               
              PERFORM 220-PROCESS-K800      THRU 220-EXIT                       
           ELSE                                                                 
              PERFORM 500-HANDLE-K800-ERROR THRU 500-EXIT.                      
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      **************************************************************            
      *     1.  CALCULATE FORFEITURE AND REFUND                    *            
      *     2.  UPDATE RFF FILE                                    *            
      *     3.  PRINT AMOUNT FORFEITED AND REFUNDED                *            
      **************************************************************            
      *-------------------------------------------------------------            
       220-PROCESS-K800.                                                        
      *-------------------------------------------------------------            
           MOVE ZEROES          TO  WS-BK.                                      
                                                                                
           IF K800-AMT-BK-REQ  NOT NUMERIC                                      
              MOVE ZEROES          TO  WS-BK                                    
           ELSE                                                                 
              MOVE K800-AMT-BK-REQ TO  WS-BK.                                   
                                                                                
           COMPUTE WS-FORFEIT = WS-BK * 3.                                      
                                                                                
      * CHG REQ BP131063                                                        
           IF K800-NUM-BTO = 'Y'                                                
              MOVE K800-AMT-BK-REQ TO WS-BK                                     
              COMPUTE WS-FORFEIT = WS-BK * 3                                    
           ELSE                                                                 
              IF K800-NUM-ROOM NOT = 'E' AND                                    
                 K800-AMT-REGN-DEPOSIT-REQ IS NUMERIC                           
                 IF K800-AMT-REGN-DEPOSIT-REQ NOT = ZERO                        
                    MOVE K800-AMT-REGN-DEPOSIT-REQ TO WS-FORFEIT.               
                                                                                
           IF K800-NUM-IDP-SCHEME  = 'NRT' AND                                  
              K800-AMT-CD          = (1.00 OR 0.00)                             
              MOVE ZEROES TO WS-FORFEIT                                         
           END-IF.                                                              
                                                                                
           COMPUTE WS-TOTAL = K800-AMT-CD-CASH + K800-AMT-CD-CPF1 +             
                              K800-AMT-CD-CPF2 + K800-AMT-CD-CPF3 +             
                              K800-AMT-CD-CPF4.                                 
                                                                                
           IF  WS-TOTAL < WS-FORFEIT                                            
               MOVE K800-AMT-CD-CASH TO WS-FFCASH                               
               MOVE K800-AMT-CD-CPF1 TO WS-FFCPF1                               
               MOVE K800-AMT-CD-CPF2 TO WS-FFCPF2                               
               MOVE K800-AMT-CD-CPF3 TO WS-FFCPF3                               
               MOVE K800-AMT-CD-CPF4 TO WS-FFCPF4                               
               MOVE ZEROES           TO WS-RFCASH                               
               MOVE ZEROES           TO WS-RFCPF1                               
               MOVE ZEROES           TO WS-RFCPF2                               
               MOVE ZEROES           TO WS-RFCPF3                               
               MOVE ZEROES           TO WS-RFCPF4                               
               MOVE WS-TOTAL         TO WS-TOT-FORFEIT                          
               MOVE ZEROES           TO WS-TOT-REFUND.                          
                                                                                
           IF WS-FORFEIT > K800-AMT-CD-CASH                                     
              MOVE        0         TO WS-RFCASH                                
              MOVE K800-AMT-CD-CASH TO WS-FFCASH                                
              COMPUTE WS-FF-AMT  = WS-FORFEIT - K800-AMT-CD-CASH                
              COMPUTE WS-FF-VAR1 = K800-AMT-CD-CPF1 + K800-AMT-CD-CPF2 +        
                                   K800-AMT-CD-CPF3 + K800-AMT-CD-CPF4          
                                                                                
              IF WS-FF-VAR1 = 0                                                 
                 MOVE 0 TO WS-FFCPF1 WS-FFCPF2 WS-FFCPF3 WS-FFCPF4              
                 MOVE 0 TO WS-RFCPF1 WS-RFCPF2 WS-RFCPF3 WS-RFCPF4              
              ELSE                                                              
                 COMPUTE WS-FF-VAR2  =  WS-FF-AMT / WS-FF-VAR1                  
                 PERFORM 230-COMPUTATION THRU 230-EXIT                          
                                                                                
           ELSE                                                                 
              MOVE WS-FORFEIT TO WS-FFCASH                                      
              MOVE WS-FORFEIT TO WS-TOT-FORFEIT                                 
              COMPUTE WS-TOT-REFUND = K800-AMT-CD - WS-FORFEIT                  
              COMPUTE WS-RFCASH = K800-AMT-CD-CASH - WS-FFCASH                  
              MOVE K800-AMT-CD-CPF1 TO WS-RFCPF1                                
              MOVE K800-AMT-CD-CPF2 TO WS-RFCPF2                                
              MOVE K800-AMT-CD-CPF3 TO WS-RFCPF3                                
              MOVE K800-AMT-CD-CPF4 TO WS-RFCPF4                                
              MOVE ZEROES           TO WS-FFCPF1                                
                                       WS-FFCPF2                                
                                       WS-FFCPF3                                
                                       WS-FFCPF4.                               
                                                                                
      * CHG REQ BP130728                                                        
           IF K800-NUM-IDP-SCHEME = 'SA ' OR                                    
             (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                               
              MOVE K800-NUM-REGN  TO  K350-NUM-REGN                             
              READ BP13K350                                                     
              IF BP13K350-STATUS = 0                                            
                 IF K350-CDE-OPT-RENTAL-FLAT   = 'N' AND                        
                    K350-CDE-ALLOC-RENTAL-FLAT = 'N'                            
                    IF F310-NUM-CANCEL-REASON = '05'                            
                       MOVE ZEROES   TO WS-FFCASH WS-RFCASH                     
                       MOVE ZEROES   TO WS-FFCPF1 WS-RFCPF1                     
                       MOVE ZEROES   TO WS-FFCPF2 WS-RFCPF2                     
                       MOVE ZEROES   TO WS-FFCPF3 WS-RFCPF3                     
                       MOVE ZEROES   TO WS-FFCPF4 WS-RFCPF4                     
                    END-IF                                                      
                 END-IF                                                         
                 IF K350-CDE-OPT-RENTAL-FLAT   = 'Y' AND                        
                    K350-CDE-ALLOC-RENTAL-FLAT = 'Y'                            
                    IF F310-NUM-CANCEL-REASON = '05'                            
                       MOVE ZEROES   TO WS-FFCASH WS-RFCASH                     
                       MOVE ZEROES   TO WS-FFCPF1 WS-RFCPF1                     
                       MOVE ZEROES   TO WS-FFCPF2 WS-RFCPF2                     
                       MOVE ZEROES   TO WS-FFCPF3 WS-RFCPF3                     
                       MOVE ZEROES   TO WS-FFCPF4 WS-RFCPF4                     
                    END-IF                                                      
                    MOVE ZEROES      TO WS-RFCASH                               
                    MOVE ZEROES      TO WS-RFCPF1                               
                    MOVE ZEROES      TO WS-RFCPF2                               
                    MOVE ZEROES      TO WS-RFCPF3                               
                    MOVE ZEROES      TO WS-RFCPF4                               
                END-IF                                                          
              ELSE                                                              
                 PERFORM 530-HANDLE-K350-ERROR THRU 530-EXIT                    
                 GO TO 220-EXIT                                                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * ACCUMULATE AND MOVE DETAILS TO FORFEITURE PRINT FIELDS *                
      * CHG REQ BP130728                                                        
           IF K800-NUM-IDP-SCHEME = 'SA ' OR                                    
             (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                               
              ADD  WS-FFCASH TO WS-TOT-FFCASH-SA                                
              ADD  WS-FFCPF1 TO WS-TOT-FFCPF1-SA                                
              ADD  WS-FFCPF2 TO WS-TOT-FFCPF2-SA                                
              ADD  WS-FFCPF3 TO WS-TOT-FFCPF3-SA                                
              ADD  WS-FFCPF4 TO WS-TOT-FFCPF4-SA                                
           ELSE                                                                 
              ADD  WS-FFCASH TO WS-TOT-FFCASH                                   
              ADD  WS-FFCPF1 TO WS-TOT-FFCPF1                                   
              ADD  WS-FFCPF2 TO WS-TOT-FFCPF2                                   
              ADD  WS-FFCPF3 TO WS-TOT-FFCPF3                                   
              ADD  WS-FFCPF4 TO WS-TOT-FFCPF4                                   
           END-IF.                                                              
                                                                                
           MOVE    WS-FFCASH TO L305A-FFCASH                                    
           MOVE    WS-FFCPF1 TO L305A-FFCPF1                                    
           MOVE    WS-FFCPF2 TO L305A-FFCPF2                                    
           MOVE    WS-FFCPF3 TO L305A-FFCPF3                                    
           MOVE    WS-FFCPF4 TO L305A-FFCPF4                                    
                                                                                
      * ACCUMULATE AND MOVE DETAILS TO REFUND PRINT FIELDS *                    
      * CHG REQ BP130728                                                        
           IF K800-NUM-IDP-SCHEME = 'SA ' OR                                    
             (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                               
              ADD  WS-RFCASH TO WS-TOT-RFCASH-SA                                
              ADD  WS-RFCPF1 TO WS-TOT-RFCPF1-SA                                
              ADD  WS-RFCPF2 TO WS-TOT-RFCPF2-SA                                
              ADD  WS-RFCPF3 TO WS-TOT-RFCPF3-SA                                
              ADD  WS-RFCPF4 TO WS-TOT-RFCPF4-SA                                
           ELSE                                                                 
              ADD  WS-RFCASH TO WS-TOT-RFCASH                                   
              ADD  WS-RFCPF1 TO WS-TOT-RFCPF1                                   
              ADD  WS-RFCPF2 TO WS-TOT-RFCPF2                                   
              ADD  WS-RFCPF3 TO WS-TOT-RFCPF3                                   
              ADD  WS-RFCPF4 TO WS-TOT-RFCPF4                                   
           END-IF.                                                              
                                                                                
           MOVE WS-RFCASH TO L305A-RFCASH.                                      
           MOVE WS-RFCPF1 TO L305A-RFCPF1.                                      
           MOVE WS-RFCPF2 TO L305A-RFCPF2.                                      
           MOVE WS-RFCPF3 TO L305A-RFCPF3.                                      
           MOVE WS-RFCPF4 TO L305A-RFCPF4.                                      
                                                                                
      * CHG REQ BP130728                                                        
           IF K800-NUM-IDP-SCHEME = 'SA ' OR                                    
             (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                               
              MOVE K800-NUM-REGN  TO  K350-NUM-REGN                             
              IF K350-CDE-OPT-RENTAL-FLAT   = 'Y' AND                           
                 K350-CDE-ALLOC-RENTAL-FLAT = 'N'                               
                 PERFORM 590-CHECK-LINECT THRU 590-EXIT                         
                 ADD 1              TO    WS1-CNT-LINE-L305B                    
                                          WS1-CNT-SEQ-B                         
                 MOVE WS1-CNT-SEQ-B TO    L305B-SEQ-NO                          
                 MOVE SPACES        TO    L305B-ERRMSG                          
                 MOVE F310-REGN-NO  TO    L305B-KEY                             
                 MOVE SPACES        TO    L305B-RETURN-CODE                     
                 STRING "OPT FOR RENTAL = 'Y' , ALLOC RENTAL = 'N'"             
                        ", PLEASE CHECK !"                                      
                 DELIMITED BY SIZE  INTO  L305B-ERRMSG                          
                 WRITE L305B-PRTREC FROM  L305B-PR-ERROR                        
                 MOVE SPACES        TO    L305B-PRTREC                          
              END-IF                                                            
              IF K350-CDE-OPT-RENTAL-FLAT   = 'N' AND                           
                 K350-CDE-ALLOC-RENTAL-FLAT = 'N'                               
                 IF F310-NUM-CANCEL-REASON = '05'                               
                    MOVE ZEROES    TO L305A-FFCASH WS-FFCASH WS-RFCASH          
                    MOVE ZEROES    TO L305A-FFCPF1 WS-FFCPF1 WS-RFCPF1          
                    MOVE ZEROES    TO L305A-FFCPF2 WS-FFCPF2 WS-RFCPF2          
                    MOVE ZEROES    TO L305A-FFCPF3 WS-FFCPF3 WS-RFCPF3          
                    MOVE ZEROES    TO L305A-FFCPF4 WS-FFCPF4 WS-RFCPF4          
                                                                                
                    MOVE '$______' TO L305A-RFCASH-X                            
                    MOVE '$______' TO L305A-RFCPF1-X                            
                    MOVE '$______' TO L305A-RFCPF2-X                            
                    MOVE '$______' TO L305A-RFCPF3-X                            
                    MOVE '$______' TO L305A-RFCPF4-X                            
                 END-IF                                                         
              END-IF                                                            
              IF K350-CDE-OPT-RENTAL-FLAT   = 'Y' AND                           
                 K350-CDE-ALLOC-RENTAL-FLAT = 'Y'                               
                 IF F310-NUM-CANCEL-REASON = '05'                               
                    MOVE ZEROES    TO L305A-FFCASH WS-FFCASH                    
                    MOVE ZEROES    TO L305A-FFCPF1 WS-FFCPF1                    
                    MOVE ZEROES    TO L305A-FFCPF2 WS-FFCPF2                    
                    MOVE ZEROES    TO L305A-FFCPF3 WS-FFCPF3                    
                    MOVE ZEROES    TO L305A-FFCPF4 WS-FFCPF4                    
                 END-IF                                                         
                 MOVE ZEROES       TO WS-RFCASH                                 
                 MOVE ZEROES       TO WS-RFCPF1                                 
                 MOVE ZEROES       TO WS-RFCPF2                                 
                 MOVE ZEROES       TO WS-RFCPF3                                 
                 MOVE ZEROES       TO WS-RFCPF4                                 
                 MOVE "$???"       TO L305A-RFCASH-X                            
                 MOVE "$???"       TO L305A-RFCPF1-X                            
                 MOVE "$???"       TO L305A-RFCPF2-X                            
                 MOVE "$???"       TO L305A-RFCPF3-X                            
                 MOVE "$???"       TO L305A-RFCPF4-X                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           DISPLAY '=============================================='.            
           DISPLAY 'CUR REG NO ' K800-NUM-REGN                                  
           DISPLAY 'FORFEIT ' WS-FORFEIT                                        
           DISPLAY 'VAR1    ' WS-FF-AMT WS-FF-VAR1 WS-FF-VAR2                   
           DISPLAY 'MAS ' K800-AMT-CD-CASH K800-AMT-CD-CPF1                     
                          K800-AMT-CD-CPF2 K800-AMT-CD-CPF3                     
                          K800-AMT-CD-CPF4.                                     
           DISPLAY 'REF ' WS-RFCASH WS-RFCPF1 WS-RFCPF2 WS-RFCPF3               
                          WS-RFCPF4                                             
           DISPLAY 'FOR ' WS-FFCASH WS-FFCPF1 WS-FFCPF2 WS-FFCPF3               
                          WS-FFCPF4.                                            
           DISPLAY '=============================================='.            
                                                                                
      *============================================================*            
      *       MOVE DETAILS TO UPDATE K800                          *            
      *============================================================*            
                                                                                
           MOVE      'C'                    TO  K800-NUM-STATUS.                
           MOVE      'RG'                   TO  K800-NUM-ALLOC-TAG.             
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO  K800-DTE-CANCEL                 
                                                K800-DTE-UPDATE.                
                                                                                
           MOVE   F310-NUM-CANCEL-REASON    TO  K800-NUM-CANCEL-REASON.         
           MOVE   SPACES                    TO  K800-DTE-SALE-AGMT              
                                                K800-DTE-RAISE-AO               
                                                K800-NUM-SCH-ACC                
                                                K800-DTE-BOND-EXP               
                                                K800-NUM-ASPF                   
                                                K800-DTE-DELIVERY-POSSN         
                                                K800-TME-AO-APPT                
                                                K800-DTE-AO-APPT.               
                                                                                
      **** REMOVE COMMENT AFTER TESTING                                         
           REWRITE BP13K800-MASTER.                                             
                                                                                
           IF BP13K800-STATUS = 0                                               
              ADD 1 TO WS1-CNT-REWRITE-K800                                     
              PERFORM 300-WRITE-BP13K840    THRU 300-EXIT                       
              PERFORM 320-WRITE-BP13F380    THRU 320-EXIT                       
              PERFORM 710-WRITE-CDB         THRU 710-EXIT                       
              PERFORM 350-WRITE-BP13OUT     THRU 350-EXIT                       
              PERFORM 360-PROCESS-BP13K150  THRU 360-EXIT                       
      **                                                                        
      * IF KEY AVAILABLE AND DPD FOUND CLEAR OFF DPD                            
      **                                                                        
              PERFORM 240-BLANK-DPD         THRU 240-EXIT                       
                                                                                
      *                                                                         
      * CALL ROUTINE TO PRINT DETAILS  *                                        
      *                                                                         
                                                                                
      * CHG REQ BP130728                                                        
              IF K800-NUM-IDP-SCHEME = 'SA ' OR                                 
                (K800-NUM-FLAT-TYPE  = '1A' OR '2A')                            
                 IF K350-CDE-OPT-RENTAL-FLAT   = 'Y' AND                        
                    K350-CDE-ALLOC-RENTAL-FLAT = 'Y'                            
                    ADD 1                   TO   WS1-CNT-SEQ-C                  
                    MOVE WS1-CNT-SEQ-C      TO   L305A-SEQ-NO                   
                    MOVE F310-REGN-NO       TO   L305A-CUR-REG                  
                    PERFORM 410-PRINT-L305C THRU 410-EXIT                       
                 END-IF                                                         
                 IF K350-CDE-OPT-RENTAL-FLAT   = 'N' AND                        
                    K350-CDE-ALLOC-RENTAL-FLAT = 'N'                            
                    ADD 1                   TO   WS1-CNT-SEQ-D                  
                    MOVE WS1-CNT-SEQ-D      TO   L305A-SEQ-NO                   
                    MOVE F310-REGN-NO       TO   L305A-CUR-REG                  
                    PERFORM 420-PRINT-L305D THRU 420-EXIT                       
                 END-IF                                                         
              ELSE                                                              
                 ADD 1              TO WS1-CNT-SEQ-A                            
                 MOVE WS1-CNT-SEQ-A TO L305A-SEQ-NO                             
                 MOVE F310-REGN-NO  TO L305A-CUR-REG                            
                 PERFORM 400-PRINT-L305A    THRU 400-EXIT                       
              END-IF                                                            
           ELSE                                                                 
              PERFORM 500-HANDLE-K800-ERROR THRU 500-EXIT.                      
                                                                                
       220-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       230-COMPUTATION.                                                         
      *-------------------------------------------------------------            
           COMPUTE WS-FFCPF1 ROUNDED = K800-AMT-CD-CPF1 * WS-FF-VAR2.           
           COMPUTE WS-FFCPF2 ROUNDED = K800-AMT-CD-CPF2 * WS-FF-VAR2.           
           COMPUTE WS-FFCPF3 ROUNDED = K800-AMT-CD-CPF3 * WS-FF-VAR2.           
           COMPUTE WS-FFCPF4 ROUNDED = K800-AMT-CD-CPF4 * WS-FF-VAR2.           
                                                                                
      * THE VARIABLE WS-FF-VAR2 WILL RANGE FROM 0 TO 1 AS WS-FF-VAR1            
      * WILL ALWAYS BE GREATER THAN WS-FF-AMT.                                  
      * IF K800-AMT-CD-CPF = WS-FFCPF, WS-RFCPF SHOULD BE ZEROS.                
                                                                                
           IF  K800-AMT-CD-CPF1 > WS-FFCPF1                                     
               COMPUTE WS-RFCPF1 = K800-AMT-CD-CPF1 - WS-FFCPF1                 
           ELSE                                                                 
               MOVE ZEROES TO WS-RFCPF1.                                        
                                                                                
           IF  K800-AMT-CD-CPF2 > WS-FFCPF2                                     
               COMPUTE WS-RFCPF2 = K800-AMT-CD-CPF2 - WS-FFCPF2                 
           ELSE                                                                 
               MOVE ZEROES TO WS-RFCPF2.                                        
                                                                                
           IF  K800-AMT-CD-CPF3 > WS-FFCPF3                                     
               COMPUTE WS-RFCPF3 = K800-AMT-CD-CPF3 - WS-FFCPF3                 
           ELSE                                                                 
               MOVE ZEROES TO WS-RFCPF3.                                        
                                                                                
           IF  K800-AMT-CD-CPF4 > WS-FFCPF4                                     
               COMPUTE WS-RFCPF4 = K800-AMT-CD-CPF4 - WS-FFCPF4                 
           ELSE                                                                 
               MOVE ZEROES TO WS-RFCPF4.                                        
                                                                                
           IF  WS-TOT-FORFEIT < WS-TOTAL                                        
               COMPUTE WS-FFCPF1 = WS-FORFEIT -                                 
                                   (WS-FFCASH +  WS-FFCPF2 +                    
                                    WS-FFCPF3 +  WS-FFCPF4)                     
               COMPUTE WS-RFCPF1 = K800-AMT-CD-CPF1 - WS-FFCPF1                 
               MOVE WS-FORFEIT TO WS-TOT-FORFEIT                                
               COMPUTE WS-TOT-REFUND = (K800-AMT-CD-CPF1 +                      
                                        K800-AMT-CD-CPF2 +                      
                                        K800-AMT-CD-CPF3 +                      
                                        K800-AMT-CD-CPF4 +                      
                                        K800-AMT-CD-CASH) - WS-FORFEIT          
            ELSE                                                                
               MOVE WS-TOTAL TO WS-TOT-FORFEIT                                  
               MOVE ZERO     TO WS-TOT-REFUND.                                  
                                                                                
       230-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       240-BLANK-DPD.                                                           
      *-------------------------------------------------------------            
           PERFORM 250-READ-BM06K110   THRU 250-EXIT.                           
                                                                                
           IF WS-BM06K110-FND = 'Y'                                             
              IF K110-DTE-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND             
                                          ZEROES                                
                PERFORM 260-READ-BB14K580      THRU 260-EXIT                    
                IF WS-BB14K580-FND = 'Y'                                        
                   PERFORM 270-UPDATE-BB14K580 THRU 270-EXIT                    
                END-IF                                                          
              ELSE                                                              
                ADD 1 TO WS-K110-BYPASS                                         
              END-IF                                                            
           ELSE                                                                 
              CONTINUE                                                          
           END-IF.                                                              
                                                                                
       240-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       250-READ-BM06K110.                                                       
      *-------------------------------------------------------------            
           MOVE SPACES        TO    K110-KEY-FLD.                               
           MOVE F310-SCH-ACC  TO    K110-KEY-FLD.                               
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE BM06K110-STATUS                                             
                                                                                
             WHEN 00                                                            
                ADD   1   TO WS-K110-READ                                       
                MOVE 'Y'  TO WS-BM06K110-FND                                    
             WHEN 23                                                            
                MOVE 'N'  TO WS-BM06K110-FND                                    
                                                                                
             WHEN OTHER                                                         
                DISPLAY 'ERROR IN READING BM06K110 :' BM06K110-STATUS           
                PERFORM 000-CLOSE-ROUTINE                                       
                                                                                
           END-EVALUATE.                                                        
                                                                                
       250-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       260-READ-BB14K580.                                                       
      *-------------------------------------------------------------            
           MOVE SPACES             TO   K580-KEY-FLD.                           
           MOVE F310-SCH-ACC(1:9)  TO   K580-NUM-SCH-ACCNT.                     
                                                                                
           READ BB14K580.                                                       
                                                                                
           EVALUATE BB14K580-STATUS                                             
                                                                                
             WHEN 00                                                            
                ADD   1  TO WS-K580-READ                                        
                MOVE 'Y' TO WS-BB14K580-FND                                     
                                                                                
             WHEN 23                                                            
                MOVE 'N' TO WS-BB14K580-FND                                     
                                                                                
             WHEN OTHER                                                         
                DISPLAY 'ERROR IN READING BB14K580 :' BB14K580-STATUS           
                PERFORM 000-CLOSE-ROUTINE                                       
                                                                                
           END-EVALUATE.                                                        
                                                                                
       260-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       270-UPDATE-BB14K580.                                                     
      *-------------------------------------------------------------            
           IF K580-DTE-UNIT-DELIVERY NOT = SPACES AND LOW-VALUES                
                                           AND ZEROES                           
              MOVE  SPACES  TO  K580-DTE-UNIT-DELIVERY                          
              REWRITE BB14K580-REC                                              
                                                                                
              IF BB14K580-STATUS = 00                                           
                 ADD 1 TO WS-K580-UPD                                           
              ELSE                                                              
                 DISPLAY 'ERROR IS UPDATING BB14K580 :' BB14K580-STATUS         
                 PERFORM 000-CLOSE-ROUTINE                                      
              END-IF                                                            
           ELSE                                                                 
              ADD 1  TO  WS-K580-BYPASS                                         
           END-IF.                                                              
                                                                                
       270-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       300-WRITE-BP13K840.                                                      
      *-------------------------------------------------------------            
           MOVE K800-NUM-REGN TO K840-NUM-REGN.                                 
                                                                                
           READ BP13K840.                                                       
           IF BP13K840-STATUS = 0                                               
              IF K840-DTE-REJECT1 = SPACES OR LOW-VALUES                        
                 MOVE F310-DTE-TRANS    TO K840-DTE-REJECT1                     
                 MOVE F310-SCH-ACC      TO K840-NUM-REJECT-FLAT1                
              ELSE                                                              
              IF K840-DTE-REJECT2  = SPACES OR  LOW-VALUES                      
                 MOVE F310-DTE-TRANS    TO K840-DTE-REJECT2                     
                 MOVE F310-SCH-ACC      TO K840-NUM-REJECT-FLAT2                
              ELSE                                                              
                 MOVE F310-DTE-TRANS    TO K840-DTE-REJECT3                     
                 MOVE F310-SCH-ACC      TO K840-NUM-REJECT-FLAT3                
              REWRITE BP13K840-REC                                              
              ADD 1 TO WS1-CNT-REWRITE-K840                                     
           ELSE                                                                 
           IF BP13K840-STATUS = 23                                              
              WRITE BP13K840-REC                                                
              ADD 1 TO WS1-CNT-REWRITE-K840                                     
           ELSE                                                                 
              PERFORM 520-HANDLE-K840-ERROR THRU 520-EXIT.                      
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       320-WRITE-BP13F380.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES                   TO BP13F380-REC.                       
           MOVE K800-NUM-REGN            TO F380-NUM-REGN.                      
           MOVE FUNCTION CURRENT-DATE(1:8)                                      
                                         TO F380-DTE-CANCELATION.               
                                                                                
           MOVE K800-NUM-NRIC1           TO F380-NUM-NRIC (1).                  
           MOVE K800-NUM-NRIC2           TO F380-NUM-NRIC (2).                  
           MOVE K800-NUM-NRIC3           TO F380-NUM-NRIC (3).                  
           MOVE K800-NUM-NRIC4           TO F380-NUM-NRIC (4).                  
                                                                                
           MOVE WS-FFCASH                TO F380-AMT-CASH-FORFEITED.            
           MOVE WS-FFCPF1                TO F380-AMT-CPF-FORFEITED (1).         
           MOVE WS-FFCPF2                TO F380-AMT-CPF-FORFEITED (2).         
           MOVE WS-FFCPF3                TO F380-AMT-CPF-FORFEITED (3).         
           MOVE WS-FFCPF4                TO F380-AMT-CPF-FORFEITED (4).         
                                                                                
           MOVE WS-RFCASH                TO F380-AMT-CASH-REFUNDED.             
           MOVE WS-RFCPF1                TO F380-AMT-CPF-REFUNDED (1).          
           MOVE WS-RFCPF2                TO F380-AMT-CPF-REFUNDED (2).          
           MOVE WS-RFCPF3                TO F380-AMT-CPF-REFUNDED (3).          
           MOVE WS-RFCPF4                TO F380-AMT-CPF-REFUNDED (4).          
                                                                                
           MOVE F310-SCH-ACC             TO F380-SCHEME-ACCT-NO.                
           WRITE BP13F380-REC.                                                  
           ADD 1                         TO WS1-CNT-WRT-F380.                   
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       350-WRITE-BP13OUT.                                                       
      *-------------------------------------------------------------            
           WRITE BP13OUT-REC FROM BP13F310-TRANS-REC.                           
                                                                                
       350-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      **************************************************************            
      *       UPDATE EX-APPLICANT FILE (BP13K150)                  *            
      **************************************************************            
      *-------------------------------------------------------------            
       360-PROCESS-BP13K150.                                                    
      *-------------------------------------------------------------            
           IF K800-AMT-CD-CPF1 IS NOT NUMERIC                                   
              MOVE ZEROES TO K800-AMT-CD-CPF1.                                  
                                                                                
           IF K800-AMT-CD-CPF2 IS NOT NUMERIC                                   
              MOVE ZEROES TO K800-AMT-CD-CPF2.                                  
                                                                                
           IF K800-AMT-CD-CPF3 IS NOT NUMERIC                                   
              MOVE ZEROES TO K800-AMT-CD-CPF3.                                  
                                                                                
           IF K800-AMT-CD-CPF4 IS NOT NUMERIC                                   
              MOVE ZEROES TO K800-AMT-CD-CPF4.                                  
                                                                                
           IF K800-AMT-CD-CPF1 = ZEROES                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              MOVE K800-NUM-REGN         TO K820-NUM-REGN                       
              MOVE K800-NUM-NRIC1        TO K820-NUM-NRIC                       
              PERFORM 365-READ-BP13K820  THRU 365-EXIT                          
              MOVE K820-NUM-CPF          TO WS-NUM-CPF                          
              MOVE K800-AMT-CD-CPF1      TO WS-AMT-CPF-PAID                     
              PERFORM 370-WRITE-BP13K150 THRU 370-EXIT.                         
                                                                                
           IF K800-AMT-CD-CPF2 = ZEROES                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              MOVE K800-NUM-REGN         TO K820-NUM-REGN                       
              MOVE K800-NUM-NRIC2        TO K820-NUM-NRIC                       
              PERFORM 365-READ-BP13K820  THRU 365-EXIT                          
              MOVE K820-NUM-CPF          TO WS-NUM-CPF                          
              MOVE K800-AMT-CD-CPF2      TO WS-AMT-CPF-PAID                     
              PERFORM 370-WRITE-BP13K150 THRU 370-EXIT.                         
                                                                                
           IF K800-AMT-CD-CPF3 = ZEROES                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              MOVE K800-NUM-REGN         TO K820-NUM-REGN                       
              MOVE K800-NUM-NRIC3        TO K820-NUM-NRIC                       
              PERFORM 365-READ-BP13K820  THRU 365-EXIT                          
              MOVE K820-NUM-CPF          TO WS-NUM-CPF                          
              MOVE K800-AMT-CD-CPF3 TO WS-AMT-CPF-PAID                          
              PERFORM 370-WRITE-BP13K150 THRU 370-EXIT.                         
                                                                                
           IF K800-AMT-CD-CPF4 = ZEROES                                         
              NEXT SENTENCE                                                     
           ELSE                                                                 
              MOVE K800-NUM-REGN         TO K820-NUM-REGN                       
              MOVE K800-NUM-NRIC4        TO K820-NUM-NRIC                       
              PERFORM 365-READ-BP13K820  THRU 365-EXIT                          
              MOVE K820-NUM-CPF          TO WS-NUM-CPF                          
              MOVE K800-AMT-CD-CPF4 TO WS-AMT-CPF-PAID                          
              PERFORM 370-WRITE-BP13K150 THRU 370-EXIT.                         
                                                                                
       360-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       365-READ-BP13K820.                                                       
      *-------------------------------------------------------------            
           READ BP13K820.                                                       
                                                                                
           IF BP13K820-STATUS = 00                                              
              NEXT SENTENCE                                                     
           ELSE                                                                 
           IF BP13K820-STATUS = 23                                              
              DISPLAY 'RECORD NOT FOUND IN BP13K820'                            
              DISPLAY 'NUM-REGN = ' K820-NUM-REGN                               
              DISPLAY 'NUM-NRIC = ' K820-NUM-NRIC                               
              MOVE SPACES TO K820-NUM-CPF                                       
           ELSE                                                                 
              PERFORM 520-HANDLE-K840-ERROR THRU 520-EXIT.                      
       365-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       370-WRITE-BP13K150.                                                      
      *-------------------------------------------------------------            
           MOVE K800-NUM-REGN   TO K150-NUM-REGN.                               
           MOVE WS-NUM-CPF      TO K150-NUM-CPF.                                
                                                                                
           READ BP13K150.                                                       
                                                                                
           IF BP13K150-STATUS NOT = ZEROS                                       
              ADD 1 TO WS1-CNT-REWRITE-K150                                     
              PERFORM 375-MOVE-FIELDS THRU 375-EXIT                             
              WRITE BP13K150-REC                                                
           ELSE                                                                 
              ADD 1 TO WS1-CNT-REWRITE-K150                                     
              PERFORM 375-MOVE-FIELDS THRU 375-EXIT                             
              REWRITE BP13K150-REC.                                             
                                                                                
       370-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       375-MOVE-FIELDS.                                                         
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE(1:8) TO K150-DTE-ADDED.                   
           MOVE WS-AMT-CPF-PAID            TO K150-AMT-REFUND.                  
           MOVE 'SOC'                      TO K150-CDE-PAYMENT-TYPE.            
           MOVE K800-NUM-SCH-ACC           TO K150-NUM-SCH-ACCT.                
                                                                                
       375-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      **************************************************************            
      *       OUTPUT BP13OUT TO PRINT BACKUP CARD                  *            
      **************************************************************            
      *-------------------------------------------------------------            
       400-PRINT-L305A.                                                         
      *-------------------------------------------------------------            
           IF (WS1-CNT-LINE-L305A > WS2-MAX-LINES)                              
              MOVE WS2-RPT-A          TO   L305-HD1-RPT-ID                      
              MOVE WS3-PRT-DATE       TO   L305-HD1-DATE                        
              ADD  1                  TO   WS1-CNT-PAGE-L305A                   
              MOVE WS1-CNT-PAGE-L305A TO   L305-HD1-PAGE-NO                     
              WRITE L305A-PRTREC      FROM L305-PRT-HEAD-1  AFTER PAGE          
              WRITE L305A-PRTREC      FROM L305-PRT-HEAD-2  AFTER 2             
              WRITE L305A-PRTREC      FROM L305-PRT-HEAD-3  AFTER 2             
              WRITE L305A-PRTREC      FROM L305-PRT-HEAD-4  AFTER 1             
              WRITE L305A-PRTREC      FROM L305A-PRT-HEAD-5 AFTER 2             
              WRITE L305A-PRTREC      FROM L305A-PRT-HEAD-6 AFTER 2             
              MOVE SPACES             TO   L305A-PRTREC                         
              WRITE L305A-PRTREC      AFTER 1                                   
              MOVE 1                  TO   WS1-CNT-LINE-L305A.                  
                                                                                
           ADD 1                  TO   WS1-CNT-LINE-L305A.                      
           WRITE L305A-PRTREC     FROM L305A-PRT-DETAIL.                        
           MOVE  SPACES           TO   L305A-PRTREC                             
                                       L305A-AMOUNTS.                           
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       410-PRINT-L305C.                                                         
      *-------------------------------------------------------------            
           MOVE WS2-RPT-C         TO   L305-HD1-RPT-ID.                         
           MOVE WS3-PRT-DATE      TO   L305-HD1-DATE.                           
           ADD     1              TO   WS1-CNT-PAGE-L305C.                      
           MOVE WS1-CNT-PAGE-L305C TO  L305-HD1-PAGE-NO.                        
           WRITE L305C-PRTREC     FROM L305-PRT-HEAD-1  AFTER PAGE.             
           WRITE L305C-PRTREC     FROM L305-PRT-HEAD-2  AFTER 2.                
           WRITE L305C-PRTREC     FROM L305-PRT-HEAD-3  AFTER 2.                
           WRITE L305C-PRTREC     FROM L305-PRT-HEAD-4  AFTER 1.                
           WRITE L305C-PRTREC     FROM L305A-PRT-HEAD-5 AFTER 2.                
           WRITE L305C-PRTREC     FROM L305A-PRT-HEAD-6 AFTER 2.                
           MOVE SPACES            TO   L305C-PRTREC.                            
           WRITE L305C-PRTREC     AFTER 1.                                      
                                                                                
           ADD 1                  TO   WS1-CNT-LINE-L305A.                      
           WRITE L305C-PRTREC     FROM L305A-PRT-DETAIL.                        
           MOVE  SPACES           TO   L305C-PRTREC                             
                                       L305A-AMOUNTS.                           
                                                                                
           MOVE F310-DTE-CC       TO   WS-CANCEL-CC.                            
           MOVE F310-DTE-YY       TO   WS-CANCEL-YY.                            
           MOVE F310-DTE-MM       TO   WS-CANCEL-MM.                            
           MOVE F310-DTE-DD       TO   WS-CANCEL-DD.                            
           MOVE WS-CANCEL-DATE    TO   L305C-CAN-DTE.                           
           MOVE F310-REGN-NO      TO   L305C-REGN-NO.                           
           WRITE L305C-PRTREC     FROM L305C-CC-DETL-1  AFTER 5.                
           WRITE L305C-PRTREC     FROM L305C-CC-DETL-2.                         
           WRITE L305C-PRTREC     FROM L305C-CC-DETL-3.                         
                                                                                
           MOVE  SPACES           TO   L305C-PRTREC.                            
                                                                                
       410-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       420-PRINT-L305D.                                                         
      *-------------------------------------------------------------            
           IF (WS1-CNT-LINE-L305D > WS2-MAX-LINES)                              
              MOVE WS2-RPT-D          TO   L305-HD1-RPT-ID                      
              MOVE WS3-PRT-DATE       TO   L305-HD1-DATE                        
              ADD  1                  TO   WS1-CNT-PAGE-L305A                   
              MOVE WS1-CNT-PAGE-L305D TO   L305-HD1-PAGE-NO                     
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-1  AFTER PAGE          
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-2  AFTER 2             
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-3  AFTER 2             
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-4  AFTER 1             
              WRITE L305D-PRTREC      FROM L305A-PRT-HEAD-5 AFTER 2             
              WRITE L305D-PRTREC      FROM L305A-PRT-HEAD-6 AFTER 2             
              MOVE SPACES             TO   L305D-PRTREC                         
              WRITE L305D-PRTREC      AFTER 1                                   
              MOVE 1                  TO   WS1-CNT-LINE-L305A.                  
                                                                                
           ADD 1                  TO   WS1-CNT-LINE-L305D.                      
           WRITE L305D-PRTREC     FROM L305A-PRT-DETAIL.                        
           MOVE  SPACES           TO   L305A-PRTREC                             
                                       L305A-AMOUNTS.                           
                                                                                
       420-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       500-HANDLE-K800-ERROR.                                                   
      *-------------------------------------------------------------            
           PERFORM 590-CHECK-LINECT THRU 590-EXIT.                              
                                                                                
           MOVE  F310-REGN-NO       TO  L305B-KEY.                              
           ADD   1                  TO  WS1-CNT-LINE-L305B                      
                                        WS1-CNT-SEQ-B.                          
           MOVE WS1-CNT-SEQ-B       TO  L305B-SEQ-NO.                           
           MOVE SPACES              TO  L305B-ERRMSG.                           
           MOVE BP13K800-STATUS     TO  L305B-RETURN-CODE.                      
                                                                                
           IF BP13K800-STATUS = 23                                              
              MOVE 'RECORD NOT FOUND IN BP13K800 FILE'                          
                                    TO   L305B-ERRMSG                           
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
           ELSE                                                                 
              MOVE 'ERROR READING/WRITING TO BP13K800 FILE'                     
                                    TO   L305B-ERRMSG                           
              MOVE  BP13K800-STATUS TO   RETURN-CODE                            
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
              PERFORM 000-CLOSE-ROUTINE  THRU 000-CLOSE-EXIT.                   
                                                                                
           MOVE SPACES TO L305B-PRTREC.                                         
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       520-HANDLE-K840-ERROR.                                                   
      *-------------------------------------------------------------            
           PERFORM 590-CHECK-LINECT THRU 590-EXIT.                              
           ADD   1                  TO   WS1-CNT-LINE-L305B                     
                                         WS1-CNT-SEQ-B.                         
           MOVE WS1-CNT-SEQ-B       TO   L305B-SEQ-NO.                          
           MOVE SPACES              TO   L305B-ERRMSG.                          
           MOVE  F310-REGN-NO       TO   L305B-KEY.                             
           MOVE  BP13K840-STATUS    TO   L305B-RETURN-CODE.                     
                                                                                
           IF BP13K840-STATUS = 22                                              
              MOVE  'RECORD NOT FOUND IN HISTORY BP13K840 FILE.'                
                                    TO   L305B-ERRMSG                           
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
           ELSE                                                                 
              MOVE 'ERROR WRITING BP13K840 FILE.' TO L305B-ERRMSG               
              MOVE  BP13K840-STATUS TO   RETURN-CODE                            
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
              PERFORM 000-CLOSE-ROUTINE.                                        
                                                                                
           MOVE SPACES              TO   L305B-PRTREC.                          
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       530-HANDLE-K350-ERROR.                                                   
      *-------------------------------------------------------------            
           PERFORM 590-CHECK-LINECT THRU 590-EXIT.                              
           ADD   1                  TO   WS1-CNT-LINE-L305B                     
                                         WS1-CNT-SEQ-B.                         
           MOVE WS1-CNT-SEQ-B       TO   L305B-SEQ-NO.                          
           MOVE SPACES              TO   L305B-ERRMSG.                          
           MOVE  F310-REGN-NO       TO   L305B-KEY.                             
           MOVE  BP13K350-STATUS    TO   L305B-RETURN-CODE.                     
                                                                                
           IF BP13K350-STATUS = 23                                              
              MOVE  'RECORD NOT FOUND IN STUDIO APARTMENT FILE.'                
                                    TO   L305B-ERRMSG                           
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
           ELSE                                                                 
              MOVE 'ERROR READING BP13K350 FILE.' TO L305B-ERRMSG               
              MOVE  BP13K350-STATUS TO   RETURN-CODE                            
              WRITE L305B-PRTREC FROM L305B-PR-ERROR                            
              PERFORM 000-CLOSE-ROUTINE.                                        
                                                                                
           MOVE SPACES              TO   L305B-PRTREC.                          
                                                                                
       530-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       590-CHECK-LINECT.                                                        
      *-------------------------------------------------------------            
           IF (WS1-CNT-LINE-L305B > WS2-MAX-LINES)                              
              MOVE WS2-RPT-B          TO   L305-HD1-RPT-ID                      
              MOVE WS3-PRT-DATE       TO   L305-HD1-DATE                        
              ADD  1                  TO   WS1-CNT-PAGE-L305B                   
              MOVE WS1-CNT-PAGE-L305B TO   L305-HD1-PAGE-NO                     
              WRITE L305B-PRTREC      FROM L305-PRT-HEAD-1  AFTER PAGE          
              WRITE L305B-PRTREC      FROM L305-PRT-HEAD-2  AFTER 2             
              WRITE L305B-PRTREC      FROM L305-PRT-HEAD-3  AFTER 2             
              WRITE L305B-PRTREC      FROM L305-PRT-HEAD-4  AFTER 1             
              WRITE L305B-PRTREC      FROM L305B-PRT-HEAD-5 AFTER 3             
              WRITE L305B-PRTREC      FROM L305B-PRT-HEAD-6 AFTER 2             
              MOVE SPACES             TO   L305B-PRTREC                         
              WRITE L305B-PRTREC      AFTER 1                                   
              MOVE  1                 TO   WS1-CNT-LINE-L305B.                  
                                                                                
       590-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       600-PRINT-TOTAL.                                                         
      *-------------------------------------------------------------            
           IF     WS1-CNT-READ-F310 = 0                                         
                  GO TO 600-EXIT.                                               
                                                                                
           IF WS1-CNT-SEQ-A > 0                                                 
              MOVE WS-TOT-FFCASH TO L305A-TOT-FFCASH                            
              MOVE WS-TOT-FFCPF1 TO L305A-TOT-FFCPF1                            
              MOVE WS-TOT-FFCPF2 TO L305A-TOT-FFCPF2                            
              MOVE WS-TOT-FFCPF3 TO L305A-TOT-FFCPF3                            
              MOVE WS-TOT-FFCPF4 TO L305A-TOT-FFCPF4                            
                                                                                
              MOVE WS-TOT-RFCASH TO L305A-TOT-RFCASH                            
              MOVE WS-TOT-RFCPF1 TO L305A-TOT-RFCPF1                            
              MOVE WS-TOT-RFCPF2 TO L305A-TOT-RFCPF2                            
              MOVE WS-TOT-RFCPF3 TO L305A-TOT-RFCPF3                            
              MOVE WS-TOT-RFCPF4 TO L305A-TOT-RFCPF4                            
                                                                                
              WRITE L305A-PRTREC FROM L305A-PRT-TOTAL-LINE AFTER 1              
              WRITE L305A-PRTREC FROM L305A-PRT-TOTAL         AFTER 1           
              WRITE L305A-PRTREC FROM L305A-PRT-TOTAL-LINE AFTER 1              
           END-IF.                                                              
                                                                                
           IF (WS1-CNT-SEQ-C + WS1-CNT-SEQ-D) > 0                               
              MOVE WS2-RPT-D          TO   L305-HD1-RPT-ID                      
              MOVE WS3-PRT-DATE       TO   L305-HD1-DATE                        
              ADD  1                  TO   WS1-CNT-PAGE-L305A                   
              MOVE WS1-CNT-PAGE-L305D TO   L305-HD1-PAGE-NO                     
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-1  AFTER PAGE          
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-2  AFTER 2             
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-3  AFTER 2             
              WRITE L305D-PRTREC      FROM L305-PRT-HEAD-4  AFTER 1             
              WRITE L305D-PRTREC      FROM L305A-PRT-HEAD-5 AFTER 2             
              WRITE L305D-PRTREC      FROM L305D-PRT-HEAD-1 AFTER 2             
              WRITE L305D-PRTREC      FROM L305D-PRT-HEAD-2 AFTER 1             
              MOVE SPACES             TO   L305D-PRTREC                         
              WRITE L305D-PRTREC      AFTER 1                                   
                                                                                
              MOVE WS-TOT-FFCASH-SA TO L305A-TOT-FFCASH                         
              MOVE WS-TOT-FFCPF1-SA TO L305A-TOT-FFCPF1                         
              MOVE WS-TOT-FFCPF2-SA TO L305A-TOT-FFCPF2                         
              MOVE WS-TOT-FFCPF3-SA TO L305A-TOT-FFCPF3                         
              MOVE WS-TOT-FFCPF4-SA TO L305A-TOT-FFCPF4                         
                                                                                
              MOVE WS-TOT-RFCASH-SA TO L305A-TOT-RFCASH                         
              MOVE WS-TOT-RFCPF1-SA TO L305A-TOT-RFCPF1                         
              MOVE WS-TOT-RFCPF2-SA TO L305A-TOT-RFCPF2                         
              MOVE WS-TOT-RFCPF3-SA TO L305A-TOT-RFCPF3                         
              MOVE WS-TOT-RFCPF4-SA TO L305A-TOT-RFCPF4                         
                                                                                
              WRITE L305D-PRTREC FROM L305A-PRT-TOTAL-LINE AFTER 1              
              WRITE L305D-PRTREC FROM L305A-PRT-TOTAL         AFTER 1           
              WRITE L305D-PRTREC FROM L305A-PRT-TOTAL-LINE AFTER 1              
           END-IF.                                                              
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       710-WRITE-CDB.                                                           
      *-------------------------------------------------------------            
           PERFORM 720-START-BP13K820    THRU 720-EXIT.                         
           PERFORM 730-READNEXT-BP13K820 THRU 730-EXIT                          
                 UNTIL WS-K820-EOF = 'Y'.                                       
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       720-START-BP13K820.                                                      
      *-------------------------------------------------------------            
           MOVE 'N'           TO  WS-K820-EOF.                                  
           MOVE K800-NUM-REGN TO  K820-NUM-REGN.                                
           MOVE SPACES        TO  K820-NUM-NRIC.                                
                                                                                
           START BP13K820 KEY >= K820-KEY-FLD                                   
           IF BP13K820-STATUS = ZEROS OR 02                                     
              CONTINUE                                                          
           ELSE                                                                 
              DISPLAY 'START BROWSE ERROR, BP13K820 STATUS IS '                 
                      BP13K820-STATUS                                           
              MOVE BP13K820-STATUS          TO RETURN-CODE                      
              PERFORM  000-CLOSE-ROUTINE THRU 000-CLOSE-EXIT                    
           END-IF.                                                              
                                                                                
       720-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       730-READNEXT-BP13K820.                                                   
      *-------------------------------------------------------------            
           READ BP13K820 NEXT                                                   
                AT END                                                          
                   MOVE 'Y'      TO WS-K820-EOF                                 
           END-READ.                                                            
                                                                                
           IF K820-NUM-REGN  = K800-NUM-REGN                                    
              PERFORM 740-WRITE-F915   THRU 740-EXIT                            
           ELSE                                                                 
              MOVE 'Y'      TO WS-K820-EOF                                      
           END-IF.                                                              
                                                                                
       730-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       740-WRITE-F915.                                                          
      *-------------------------------------------------------------            
           IF K820-NUM-CSTMR-SOURCE = SPACES OR LOW-VALUES                      
              GO TO 740-EXIT                                                    
           END-IF.                                                              
                                                                                
           MOVE SPACES                   TO   BP13F915-REC.                     
           INITIALIZE                         BP13F915-REC.                     
                                                                                
           MOVE  'TE'                    TO   F915-TXN-TYPE.                    
           MOVE  'BP13'                  TO   F915-NUM-UPDATE-SOURCE.           
           MOVE  'BP13C305'              TO   F915-NUM-UPDATE-USERID.           
                                                                                
           MOVE  K820-NUM-CSTMR-SOURCE   TO   F915-NUM-CSTMR-SOURCE.            
                                                                                
           PERFORM 750-CONVERT-CUSTOMER-ROLE  THRU 750-EXIT.                    
           MOVE  K820-NUM-REGN           TO   F915-NUM-BSNS-REF.                
           STRING K800-DTE-CANCEL(1:4) '-'                                      
                  K800-DTE-CANCEL(5:2) '-'                                      
                  K800-DTE-CANCEL(7:2)                                          
                  DELIMITED BY SIZE INTO                                        
                  F915-DTE-ROLE-END                                             
           END-STRING.                                                          
                                                                                
           STRING K800-DTE-CANCEL(1:4) '-'                                      
                  K800-DTE-CANCEL(5:2) '-'                                      
                  K800-DTE-CANCEL(7:2)                                          
                  DELIMITED BY SIZE INTO                                        
                  F915-DTE-UPDATE-SOURCE                                        
           END-STRING.                                                          
                                                                                
           WRITE BP13F915-REC.                                                  
           ADD 1 TO WS1-CNT-WRT-F915.                                           
                                                                                
       740-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       750-CONVERT-CUSTOMER-ROLE.                                               
      *-------------------------------------------------------------            
           IF K820-NUM-NRIC = K800-NUM-NRIC1                                    
               MOVE '011'                 TO F915-NUM-ROLE                      
           ELSE                                                                 
           IF (K820-NUM-NRIC = K800-NUM-NRIC2) OR                               
              (K820-NUM-NRIC = K800-NUM-NRIC3) OR                               
              (K820-NUM-NRIC = K800-NUM-NRIC4)                                  
               MOVE '012'                 TO F915-NUM-ROLE                      
           ELSE                                                                 
               MOVE '013'                 TO F915-NUM-ROLE                      
           END-IF.                                                              
                                                                                
       750-EXIT.                                                                
           EXIT.                                                                
