      *************************                                                 
       IDENTIFICATION DIVISION.                                                 
      *************************                                                 
       PROGRAM-ID.    BP13C771.                                                 
      *AUTHOR.        TON.                                                      
      *DATE-WRITTEN.  29/12/92.                                                 
                                                                                
      * ========================================================= *             
      *              SYSTEM OF COMMITMENT  (BP13)                 *             
      * ========================================================= *             
      *   OBJECTIVE   :  THIS IS A PROGRAM TO PRINT REPORT TO     *             
      *                  SHOW THE DETAIL REPORT OF RELOCATION     *             
      *                  CASES ACCEPTED FLAT ( SORTED BY BO )     *             
      *                                                           *             
      *   INPUT FILES :  1.  P10F020                              *             
      *                  2.  BM06K110                             *             
      *                  3.  BB14K500                             *             
      *                  4.  BP13K830                             *             
      *                                                           *             
      *   SUB-PROGRAM :  1.  BP13C904                             *             
      *                                                           *             
      *   LISTING     :  1.  BP13L771                             *             
      *                                                           *             
      * = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *             
      * CHG-NO   BY    DATE   DESCRIPTION                         *             
      * -------  ---  ------  -----------                         *             
      * N930012  TON  XX0793  SOC PH8 - COBOL II                  *             
      * SOC-PH8  JEP  231093  TO CHECK FOREIGN ADDRESS            *             
      * SOC-PH8  TON  091293  TO CHANGE P10F020 FILE TO BP13F800  *             
      * SOC 8G   SSS  241095  GET PROPERTY DATA FROM PIDB         *             
      * BP130078 ATH  160196  REGISTRATION DATE SHOULD BE WITHIN  *             
      *                          2 MONTHS FROM CURRENT DATE       *             
      * BP130418 SIA  200398  CHGE BM06K211 TO BM06K110           *             
      * BP130657 LSB  140499  CHG DTE-REGN WITH SYSTEM-DATE 2 MTH *             
      * BP130671 LSB  250699  H/HOLD TYPE/10 YEAR CHECK FOR RELO- *             
      *                       CATION APPLICATIONS                 *             
      * BP130790 SCK  020200  TO ADD IN IN-SOURCE DOCUMENTATION   *             
      * BP130883 RAS  080800  TO CHANGE BP13C904 TO BP13C913      *             
      * BP130970 MBS  210501  TO ADD 'RED' IN THE COND..          *             
      *                       IF F800-NUM-ALLO-SCH.               *             
      * ========================================================= *             
                                                                                
      **********************                                                    
       ENVIRONMENT DIVISION.                                                    
      **********************                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F800  ASSIGN        TO BP13F800.                          
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            FILE STATUS   IS WS-BM06K110.                       
                                                                                
           SELECT BB14K500  ASSIGN        TO BB14K500                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K500-KEY-FLD                       
                            ALTERNATE KEY IS K500-ALTX-KEY                      
                            FILE STATUS   IS WS-BB14K500.                       
                                                                                
           SELECT BP13K830  ASSIGN        TO BP13K830                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K830-KEY-FLD                       
                            ALTERNATE KEY IS K830-NUM-REGN                      
                            FILE STATUS   IS WS-BP13K830.                       
                                                                                
           SELECT BP13L771  ASSIGN        TO BP13L771.                          
                                                                                
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F800                                                            
            BLOCK  CONTAINS 0   RECORDS                                         
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL  RECORD   IS  STANDARD                                        
            RECORDING MODE  IS  F.                                              
       COPY BP13F800.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BB14K500                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BB14K500.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD  BP13L771                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS   ARE OMITTED                                          
           RECORDING MODE  IS  F.                                               
       01  BP13L771-REC                PIC X(132).                              
                                                                                
                                                                                
      *************************                                                 
       WORKING-STORAGE SECTION.                                                 
      *************************                                                 
       01  WS-VARIABLES.                                                        
           05  WS-BM06K110               PIC 9(2)  VALUE ZEROS.                 
           05  WS-BB14K500               PIC 9(2)  VALUE ZEROS.                 
           05  WS-BP13K830               PIC 9(2)  VALUE ZEROS.                 
                                                                                
           05  WS-CNT-PROCESS            PIC 9(8)  VALUE ZEROS.                 
           05  WS-CNT-F800-READ          PIC 9(8)  VALUE ZEROS.                 
           05  WS-CNT-K830-READ          PIC 9(8)  VALUE ZEROS.                 
           05  WS-CNT-K110-READ          PIC 9(8)  VALUE ZEROS.                 
           05  WS-CNT-K500-READ          PIC 9(8)  VALUE ZEROS.                 
           05  WS-CNT-PIDB-FD            PIC 9(8)  VALUE ZEROS.                 
           05  WS-BRANCH-OFFICE          PIC X(2)  VALUE SPACES.                
           05  WS-SERIAL-NO              PIC 9(4)  VALUE ZEROS.                 
           05  WS-CNT-PRINTED            PIC 9(8)  VALUE ZEROS.                 
           05  WS-LINE                   PIC 9(2)  VALUE 70.                    
           05  WS-PAGE                   PIC 9(4)  VALUE ZEROS.                 
           05  SQL-CODE                  PIC 9(4).                              
           05  WS-REM                    PIC 9(3)  VALUE ZEROES.                
           05  WS-YEAR                   PIC 9(4)  VALUE ZEROES.                
                                                                                
           05 WS-F800-EOF                PIC X     VALUE 'N'.                   
              88 F800-EOF                          VALUE 'Y'.                   
                                                                                
       01  DATE-REC.                                                            
           05  CAL-DATE.                                                        
               10  CAL-YEAR              PIC 9(4).                              
                   88  VALID-YEAR               VALUE 1900 THRU 2100.           
               10  CAL-MONTH             PIC 9(2).                              
                   88  31-DAY-MONTH             VALUE 01, 03, 05, 07,           
                                                      08, 10, 12.               
                   88  30-DAY-MONTH             VALUE 04, 06, 09, 11.           
                   88  28-29-DAY-MONTH          VALUE 02.                       
                   88  VALID-MONTH              VALUE 01 THRU 12.               
               10  CAL-DAY               PIC 9(2).                              
                   88  VALID-DAY                VALUE 01 THRU 31.               
                                                                                
       01  WS-PRINT-DATE.                                                       
           05 WS-PRINT-DD                PIC XX    VALUE SPACES.                
           05 FILLER                     PIC X     VALUE '/'.                   
           05 WS-PRINT-MM                PIC XX    VALUE SPACES.                
           05 FILLER                     PIC X     VALUE '/'.                   
           05 WS-PRINT-YY                PIC XXXX  VALUE SPACES.                
                                                                                
       01  WS-ECD-DATE.                                                         
           05 WS-ECD-CC                  PIC XX    VALUE SPACES.                
           05 WS-ECD-YY                  PIC XX    VALUE SPACES.                
           05 WS-ECD-MM                  PIC XX    VALUE SPACES.                
           05 WS-ECD-DD                  PIC XX    VALUE SPACES.                
                                                                                
       01  WS-PRINT-ECD-DATE.                                                   
           05 WS-PRINT-ECD-DD            PIC XX    VALUE SPACES.                
           05 WS-PRINT-SLASH1            PIC X     VALUE SPACES.                
           05 WS-PRINT-ECD-MM            PIC XX    VALUE SPACES.                
           05 WS-PRINT-SLASH2            PIC X     VALUE SPACES.                
           05 WS-PRINT-ECD-CC            PIC XX    VALUE SPACES.                
           05 WS-PRINT-ECD-YY            PIC XX    VALUE SPACES.                
                                                                                
       01  WS-CURR-DATE.                                                        
           05 WS-CUR-YY                  PIC XXXX.                              
           05 WS-CUR-MM                  PIC XX.                                
           05 WS-CUR-DD                  PIC XX.                                
                                                                                
       01  WS-EDIT-DATE.                                                        
           05 WS-CUR-DD                  PIC XX.                                
           05 FILLER                     PIC X  VALUE '/'.                      
           05 WS-CUR-MM                  PIC XX.                                
           05 FILLER                     PIC X  VALUE '/'.                      
           05 WS-CUR-YY                  PIC XXXX.                              
                                                                                
       01  WS-REQ-DATE.                                                         
           05 WS-REQ-DATE-YY             PIC XXXX.                              
           05 WS-REQ-DATE-MM             PIC XX.                                
           05 WS-REQ-DATE-DD             PIC XX.                                
                                                                                
       01  WS-SYS-DATE.                                                 01360000
           05 WS-DATE.                                                          
              10 WS-YY                   PIC X(04).                     01370000
              10 WS-YY-R REDEFINES WS-YY PIC 9(04).                             
              10 WS-MM                   PIC X(02).                     01380000
                 88 WS-JANUARY                       VALUE '01'.                
              10 WS-MM-R REDEFINES WS-MM PIC 9(02).                             
              10 WS-DD                   PIC X(02).                     01390000
                                                                        01420000
       01  WS-PREVIOUS-DATE              PIC X(08).                     01360000
       01  WS-CURRENT-DATE               PIC X(08).                     01360000
                                                                        01420000
      *-----------------------------------------------------------*             
      *       LINKAGE FOR SUB-PROGRAM BP13C913                    *             
      *-----------------------------------------------------------*             
       01  WS-LINK-REC.                                                         
           05  WS-LINK-NUM-SCH-ACC.                                             
               10  WS-LINK-NUM-SCH     PIC X(4).                                
               10  WS-LINK-NUM-ACC     PIC X(5).                                
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      **********************************************************                
      *              REPORT FORMAT                             *                
      **********************************************************                
       01  L771-HEAD1.                                                          
           05 FILLER                     PIC X(8)  VALUE 'BP13L771'.            
           05 FILLER                     PIC X(33) VALUE SPACES.                
           05 FILLER                     PIC X(41) VALUE                        
              'S Y S T E M   O F   C O M M I T E M E N T'.                      
           05 FILLER                     PIC X(14) VALUE SPACES.                
           05 FILLER                     PIC X(7)  VALUE 'DATE : '.             
           05 L771-DATE                  PIC X(10).                             
           05 FILLER                     PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(7)  VALUE 'PAGE : '.             
           05 L771-PAGE                  PIC ZZZ9.                              
                                                                                
       01  L771-HEAD2.                                                          
           05 FILLER                     PIC X(38) VALUE SPACES.                
           05 FILLER                     PIC X(47) VALUE                        
              'DETAIL REPORT OF RELOCATION CASES ACCEPTED FLAT'.                
                                                                                
       01  L771-HEAD3.                                                          
           05 FILLER                     PIC X(60) VALUE SPACES.                
           05 FILLER                     PIC X(14) VALUE                        
              '(SORTED BY BO)'.                                                 
                                                                                
       01  L771-HEAD4.                                                          
           05 FILLER                     PIC X(16) VALUE                        
              'BRANCH OFFICE : '.                                               
           05 L771-BRANCH-OFFICE         PIC X(2).                              
                                                                                
       01  L771-HEAD5.                                                          
           05 FILLER                     PIC X(72) VALUE SPACES.                
           05 FILLER                     PIC X(8)  VALUE                        
              'ACCEPTED'.                                                       
           05 FILLER                     PIC X(15) VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'FLAT'.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'FLAT'.                
                                                                                
                                                                                
       01  L771-HEAD6.                                                          
           05 FILLER                     PIC X(4)  VALUE 'S/NO'.                
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 FILLER                     PIC X(18) VALUE                        
              'RELOCATION ADDRESS'.                                             
           05 FILLER                     PIC X(37) VALUE SPACES.                
           05 FILLER                     PIC X(7)  VALUE 'REGN NO'.             
           05 FILLER                     PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'DATE'.                
           05 FILLER                     PIC X(6)  VALUE SPACES.                
           05 FILLER                     PIC X(8)  VALUE 'T/P DATE'.            
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'TYPE'.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 FILLER                     PIC X(6)  VALUE 'STATUS'.              
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 FILLER                     PIC X(5)  VALUE 'ECD /'.               
                                                                                
       01  L771-HEAD7.                                                          
           05 FILLER                     PIC X(7)  VALUE SPACES.                
           05 FILLER                     PIC X(25) VALUE                        
              'ADDRESS OF FLAT ALLOCATED'.                                      
           05 FILLER                     PIC X(78) VALUE SPACES.                
           05 FILLER                     PIC X(19) VALUE                        
              'KEYS AVAILABLE DATE'.                                            
                                                                                
       01  L771-DETAIL1.                                                        
           05 L771-SERIAL-NO             PIC ZZZ9.                              
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 L771-BLK-HDER              PIC X(4).                              
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L771-BLK-NUM               PIC X(4).                              
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L771-STREET-NAME           PIC X(20).                             
           05 FILLER                     PIC X(2)  VALUE ' #'.                  
           05 L771-HSE-LVL               PIC X(2).                              
           05 FILLER                     PIC X     VALUE '-'.                   
           05 L771-HSE-NO.                                                      
              10 L771-HSE-MAIN           PIC X(4).                              
              10 L771-DASH               PIC X.                                 
              10 L771-HSE-SUB            PIC X(3).                              
           05 FILLER                     PIC X(3)  VALUE ' S('.                 
           05 L771-POST-CODE             PIC X(6).                              
           05 FILLER                     PIC X(2)  VALUE ') '.                  
           05 FILLER                     PIC X(1)  VALUE SPACES.                
           05 L771-REGN                  PIC X(8).                              
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L771-ACCEPTED-DATE.                                               
              10 L771-ACCEPT-DD          PIC XX.                                
              10 FILLER                  PIC X     VALUE '/'.                   
              10 L771-ACCEPT-MM          PIC XX.                                
              10 FILLER                  PIC X     VALUE '/'.                   
              10 L771-ACCEPT-YY          PIC X(4).                              
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L771-TP-DATE               PIC X(10).                             
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L771-FLAT-TYPE             PIC X(2).                              
           05 FILLER                     PIC X(5)  VALUE SPACES.                
           05 L771-FLAT-STATUS           PIC X(2).                              
           05 FILLER                     PIC X(5)  VALUE SPACES.                
           05 L771-ECD-DATE              PIC X(10) VALUE SPACES.                
                                                                                
       01  L771-DETAIL2.                                                        
           05 FILLER                     PIC X(7)  VALUE SPACES.                
           05 L771-ALLOC-BLK-HDER        PIC X(4)  VALUE SPACES.                
           05 L771-ALLOC-BLK-NO          PIC X(5).                              
           05 FILLER                     PIC X(1)  VALUE SPACES.                
           05 L771-ALLOC-STREET-NAME     PIC X(20).                             
           05 L771-ALLOC-HASH            PIC X(2)  VALUE SPACES.                
           05 L771-ALLOC-LEVEL-NO        PIC X(2).                              
           05 L771-ALLOC-DASH            PIC X     VALUE SPACES.                
           05 L771-ALLOC-MAIN-UNIT       PIC X(4).                              
           05 FILLER                     PIC X.                                 
           05 L771-ALLOC-SUB-UNIT        PIC X(3).                              
           05 L771-ALLOC-BRACKET1        PIC X(3)  VALUE SPACES.                
           05 L771-ALLOC-POSTAL-CODE     PIC X(6).                              
           05 L771-ALLOC-BRACKET2        PIC X     VALUE SPACES.                
           05 FILLER                     PIC X(50) VALUE SPACES.                
           05 L771-ALLOC-KEY-AVAIL-DATE  PIC X(10).                             
                                                                                
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      *----------------*                                                        
       000-MAIN-ROUTINE.                                                        
      *----------------*                                                        
           PERFORM 100-OPEN-FILES      THRU 100-EXIT.                           
           PERFORM 800-DETERMINE-DATE  THRU 800-EXIT.                           
                                                                                
           PERFORM 200-READ-BP13F800   THRU 200-EXIT.                           
           PERFORM 300-PROCESS-F800    THRU 300-EXIT                            
                   UNTIL F800-EOF.                                              
           PERFORM 900-CLOSE-ROUTINE   THRU 900-EXIT.                           
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *--------------*                                                          
       100-OPEN-FILES.                                                          
      *--------------*                                                          
           OPEN INPUT  BP13F800                                                 
                       BM06K110                                                 
                       BB14K500                                                 
                       BP13K830                                                 
                OUTPUT BP13L771.                                                
                                                                                
           IF WS-BM06K110 NOT = 00 AND 97                                       
              DISPLAY 'OPENING ERROR, WS-BM06K110 '  WS-BM06K110                
              MOVE     WS-BM06K110       TO   RETURN-CODE                       
              PERFORM  900-CLOSE-ROUTINE THRU 900-EXIT.                         
                                                                                
           IF WS-BB14K500 NOT = 00 AND 97                                       
              DISPLAY 'OPENING ERROR, WS-BB14K500 '  WS-BB14K500                
              MOVE     WS-BB14K500       TO   RETURN-CODE                       
              PERFORM  900-CLOSE-ROUTINE THRU 900-EXIT.                         
                                                                                
           IF WS-BP13K830 NOT = 0 AND 97                                        
              DISPLAY 'OPENING ERROR, WS-BP13K830 '  WS-BP13K830                
              MOVE     WS-BP13K830       TO   RETURN-CODE                       
              PERFORM  900-CLOSE-ROUTINE THRU 900-EXIT.                         
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------*                                                        
       200-READ-BP13F800.                                                       
      *----------------*                                                        
           READ BP13F800                 AT END                                 
           MOVE 'Y'                      TO WS-F800-EOF                         
           GO TO 200-EXIT.                                                      
                                                                                
           ADD 1                         TO WS-CNT-F800-READ.                   
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------*                                                        
       300-PROCESS-F800.                                                        
      *----------------*                                                        
           IF F800-NUM-ALLO-SCHEME = 'REA' OR 'REE' OR 'REW' OR                 
                                     'RES' OR 'REN' OR 'RED'                    
                                                                                
              IF F800-NUM-SCH-ACC NOT = SPACES                                  
                 ADD 1 TO WS-CNT-PROCESS                                        
                 PERFORM 400-READ-BP13K830  THRU 400-EXIT.                      
                                                                                
              PERFORM 200-READ-BP13F800     THRU 200-EXIT.                      
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------*                                                        
       400-READ-BP13K830.                                                       
      *----------------*                                                        
           MOVE SPACES                   TO BP13K830-REC.                       
           INITIALIZE                       BP13K830-REC.                       
           MOVE F800-NUM-REGN            TO K830-NUM-REGN.                      
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
                                                                                
           IF WS-BP13K830 = 00 OR 02                                            
              ADD 1                      TO WS-CNT-K830-READ                    
              IF K830-NUM-MAIL-ADDR = SPACES OR LOW-VALUES                      
                 IF K830-NUM-ADDR-TYPE = 'H'                                    
                    MOVE K830-NUM-BLK-HDR  TO L771-BLK-HDER                     
                    MOVE K830-NUM-MAIN-BLK TO L771-BLK-NUM                      
                    MOVE K830-NME-STREET   TO L771-STREET-NAME                  
                    MOVE K830-NUM-LVL-NUM  TO L771-HSE-LVL                      
                    MOVE K830-NUM-HSEMAIN  TO L771-HSE-MAIN                     
                    IF K830-NUM-HSESUB NOT = SPACES                             
                       MOVE '-'               TO L771-DASH                      
                       MOVE K830-NUM-HSESUB   TO L771-HSE-SUB                   
                    ELSE                                                        
                       MOVE SPACES            TO L771-DASH                      
                       MOVE SPACES            TO L771-HSE-SUB                   
                    END-IF                                                      
                    MOVE K830-NUM-POSTAL   TO L771-POST-CODE                    
                 ELSE                                                           
                    MOVE K830-NUM-BLK-HDR  TO L771-BLK-HDER                     
                    MOVE K830-NUM-MAIN-BLK TO L771-BLK-NUM                      
                    MOVE K830-NME-STREET   TO L771-STREET-NAME                  
                    IF K830-NUM-FLAT = SPACES                                   
                       MOVE SPACES            TO L771-HSE-LVL                   
                                                 L771-HSE-MAIN                  
                                                 L771-DASH                      
                                                 L771-HSE-SUB                   
                    ELSE                                                        
                       MOVE K830-NUM-LVL-NUM  TO L771-HSE-LVL                   
                       MOVE K830-NUM-HSEMAIN  TO L771-HSE-MAIN                  
                       IF K830-NUM-HSESUB NOT = SPACES                          
                          MOVE '-'               TO L771-DASH                   
                          MOVE K830-NUM-HSESUB   TO L771-HSE-SUB                
                       ELSE                                                     
                          MOVE SPACES            TO L771-DASH                   
                          MOVE SPACES            TO L771-HSE-SUB                
                       END-IF                                                   
                    END-IF                                                      
                    MOVE K830-NUM-POSTAL   TO L771-POST-CODE                    
                 END-IF                                                         
              ELSE                                                              
                 IF K830-NUM-MAIL-ADDR-TYPE = 'H'                               
                    MOVE K830-NUM-MAIL-BLK-HDR  TO L771-BLK-HDER                
                    MOVE K830-NUM-MAIL-MAIN-BLK TO L771-BLK-NUM                 
                    MOVE K830-NME-MAIL-STREET   TO L771-STREET-NAME             
                    MOVE K830-NUM-MAIL-LVL-NUM  TO L771-HSE-LVL                 
                    MOVE K830-NUM-MAIL-LVL-DASH TO L771-DASH                    
                    MOVE K830-NUM-MAIL-HSEMAIN  TO L771-HSE-MAIN                
                    MOVE K830-NUM-MAIL-HSESUB   TO L771-HSE-SUB                 
                    MOVE K830-NUM-MAIL-POSTAL   TO L771-POST-CODE               
                 ELSE                                                           
                    MOVE K830-NUM-MAIL-BLK-HDR  TO L771-BLK-HDER                
                    MOVE K830-NUM-MAIL-MAIN-BLK TO L771-BLK-NUM                 
                    MOVE K830-NME-MAIL-STREET   TO L771-STREET-NAME             
                    IF K830-NUM-MAIL-FLAT  = SPACES                             
                       MOVE SPACES                 TO L771-HSE-LVL              
                                                      L771-DASH                 
                                                      L771-HSE-MAIN             
                                                      L771-HSE-SUB              
                    ELSE                                                        
                       MOVE K830-NUM-MAIL-LVL-NUM  TO L771-HSE-LVL              
                       MOVE K830-NUM-MAIL-LVL-DASH TO L771-DASH                 
                       MOVE K830-NUM-MAIL-HSEMAIN  TO L771-HSE-MAIN             
                       MOVE K830-NUM-MAIL-HSESUB   TO L771-HSE-SUB              
                    END-IF                                                      
                    MOVE K830-NUM-MAIL-POSTAL  TO L771-POST-CODE                
                 END-IF                                                         
              END-IF                                                            
              MOVE K830-NUM-REGN           TO L771-REGN                         
              PERFORM 500-READ-BM06K110    THRU 500-EXIT                        
              PERFORM 700-PRINT-REPORT     THRU 700-EXIT                        
           ELSE                                                                 
              IF WS-BP13K830 = 23                                               
                 DISPLAY 'RECORD NOT FOUND IN BP13K830, STATUS '                
                 WS-BP13K830 ' KEY IS REGN NO ' F800-NUM-REGN                   
              ELSE                                                              
                 DISPLAY ' ERROR READING BP13K830, STATUS '                     
                 WS-BP13K830 ' KEY IS REGN NO ' F800-NUM-REGN                   
                 PERFORM 900-CLOSE-ROUTINE.                                     
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       500-READ-BM06K110.                                                       
      *-----------------*                                                       
           MOVE F800-NUM-SCH-ACC TO K110-SCH-ACC-NO.                            
           READ BM06K110.                                                       
                                                                                
           IF WS-BM06K110 = 00                                                  
              ADD 1                      TO WS-CNT-K110-READ                    
              PERFORM 550-CALL-BP13C913  THRU 550-EXIT                          
                                                                                
              MOVE K110-DTE-ACCEPTANCE(1:4)  TO L771-ACCEPT-YY                  
              MOVE K110-DTE-ACCEPTANCE(5:2)  TO L771-ACCEPT-MM                  
              MOVE K110-DTE-ACCEPTANCE(7:2)  TO L771-ACCEPT-DD                  
              MOVE K110-DTE-KEY-ISSUED   TO WS-REQ-DATE                         
              MOVE WS-REQ-DATE-DD        TO WS-PRINT-DD                         
              MOVE WS-REQ-DATE-MM        TO WS-PRINT-MM                         
              MOVE WS-REQ-DATE-YY        TO WS-PRINT-YY                         
              MOVE WS-PRINT-DATE         TO L771-TP-DATE                        
              MOVE COMM8-CDE-TYP-ACTLUSE TO L771-FLAT-TYPE                      
              MOVE K110-FLAT-STATUS      TO L771-FLAT-STATUS                    
              MOVE K110-DTE-KEY-AVAIL    TO WS-REQ-DATE                         
              MOVE WS-REQ-DATE-DD        TO WS-PRINT-DD                         
              MOVE WS-REQ-DATE-MM        TO WS-PRINT-MM                         
              MOVE WS-REQ-DATE-YY        TO WS-PRINT-YY                         
              MOVE WS-PRINT-DATE         TO L771-ALLOC-KEY-AVAIL-DATE           
              PERFORM 650-READ-BB14K500  THRU 650-EXIT                          
           ELSE                                                                 
              IF WS-BM06K110 = 23                                               
                 DISPLAY 'RECORD NOT FOUND IN BM06K110, '                       
                 WS-BM06K110 ' KEY IS SCHEME A/C' F800-NUM-SCH-ACC              
              ELSE                                                              
                 DISPLAY ' ERROR READING BM06K110, '                            
                 WS-BM06K110 ' KEY IS SCHEME A/C' F800-NUM-SCH-ACC              
                 PERFORM 900-CLOSE-ROUTINE.                                     
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       550-CALL-BP13C913.                                                       
      *-----------------*                                                       
           IF K110-SCH-ACC-NO NOT = SPACES AND ZEROES AND LOW-VALUES            
              MOVE SPACES               TO BP13COMM8-REC                        
              INITIALIZE                   BP13COMM8-REC.                       
                                                                                
              MOVE K110-SCH-ACC-NO      TO WS-LINK-REC.                         
              CALL 'BP13C913' USING WS-LINK-REC, BP13COMM8-REC.                 
                                                                                
              IF COMM8-CDE-SYSERR NOT = 0                                       
                 MOVE COMM8-CDE-SYSERR TO SQL-CODE                              
                 DISPLAY 'K110-SCH-ACC-NO = ' K110-SCH-ACC-NO                   
                 IF COMM8-CDE-SYSERR = 100                                      
                    DISPLAY 'SCH-ACC NOT FOUND IN PIDB TABLE ' SQL-CODE         
                 ELSE                                                           
                    DISPLAY 'ERROR IN READING PIDB TABLE ' SQL-CODE.            
                                                                                
           IF COMM8-CDE-SYSERR = 0                                              
              ADD 1 TO WS-CNT-PIDB-FD                                           
              PERFORM 600-ALLOC-ADDRESS.                                        
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       600-ALLOC-ADDRESS.                                                       
      *-----------------*                                                       
           IF COMM8-NUM-BLK       = SPACES AND                                  
              COMM8-NME-STREET    = SPACES AND                                  
              COMM8-NUM-LEVEL     = SPACES AND                                  
              COMM8-NUM-UNIT-MAIN = SPACES AND                                  
              COMM8-NUM-UNIT-SUB  = SPACES AND                                  
              COMM8-NUM-POSTAL-CODE = SPACES                                    
              MOVE SPACES                TO L771-ALLOC-BLK-NO                   
                                            L771-ALLOC-STREET-NAME              
                                            L771-ALLOC-LEVEL-NO                 
                                            L771-ALLOC-MAIN-UNIT                
                                            L771-ALLOC-SUB-UNIT                 
                                            L771-ALLOC-POSTAL-CODE              
                                            L771-ALLOC-BLK-HDER                 
                                            L771-ALLOC-HASH                     
                                            L771-ALLOC-DASH                     
                                            L771-ALLOC-BRACKET1                 
                                            L771-ALLOC-BRACKET2                 
           ELSE                                                                 
              MOVE 'BLK '                TO L771-ALLOC-BLK-HDER                 
              MOVE ' #'                  TO L771-ALLOC-HASH                     
              MOVE '-'                   TO L771-ALLOC-DASH                     
              MOVE ' S('                 TO L771-ALLOC-BRACKET1                 
              MOVE ')'                   TO L771-ALLOC-BRACKET2                 
              MOVE COMM8-NUM-BLK         TO L771-ALLOC-BLK-NO                   
              MOVE COMM8-NME-STREET      TO L771-ALLOC-STREET-NAME              
              MOVE COMM8-NUM-LEVEL       TO L771-ALLOC-LEVEL-NO                 
              MOVE COMM8-NUM-UNIT-MAIN   TO L771-ALLOC-MAIN-UNIT                
              MOVE COMM8-NUM-UNIT-SUB    TO L771-ALLOC-SUB-UNIT                 
              MOVE COMM8-NUM-POSTAL-CODE TO L771-ALLOC-POSTAL-CODE.             
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       650-READ-BB14K500.                                                       
      *-----------------*                                                       
           MOVE K110-SCHEME               TO K500-NUM-SCH.                      
           MOVE COMM8-NUM-BLK             TO K500-NUM-BLK.                      
           START BB14K500 KEY = K500-ALTX-KEY.                                  
           IF WS-BB14K500 = 00                                                  
              READ BB14K500 NEXT RECORD                                         
              ADD 1               TO WS-CNT-K500-READ                           
              MOVE K500-DTE-BLDG-COMPLETE TO WS-ECD-DATE                        
              MOVE WS-ECD-CC              TO WS-PRINT-ECD-CC                    
              MOVE WS-ECD-YY              TO WS-PRINT-ECD-YY                    
              MOVE WS-ECD-MM              TO WS-PRINT-ECD-MM                    
              MOVE WS-ECD-DD              TO WS-PRINT-ECD-DD                    
              MOVE '/'                    TO WS-PRINT-SLASH1                    
                                             WS-PRINT-SLASH2                    
              MOVE WS-PRINT-ECD-DATE      TO L771-ECD-DATE                      
           ELSE                                                                 
              IF WS-BB14K500 = 23                                               
                 MOVE SPACES              TO L771-ECD-DATE                      
                 DISPLAY 'RECORD NOT FOUND IN BB14K500, '                       
                 WS-BB14K500 ' KEY IS SCHEME A/C' K500-NUM-SCH                  
                               K500-NUM-BLK                                     
              ELSE                                                              
                 DISPLAY ' ERROR READING BB14K500, '                            
                 WS-BB14K500 ' KEY IS SCHEME A/C' K110-SCH-ACC-NO               
                 PERFORM 900-CLOSE-ROUTINE.                                     
                                                                                
       650-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------*                                                        
       700-PRINT-REPORT.                                                        
      *----------------*                                                        
           IF WS-LINE > 54 AND WS-BRANCH-OFFICE = SPACES                        
              MOVE ZEROES                TO WS-SERIAL-NO                        
              MOVE F800-NUM-BO           TO WS-BRANCH-OFFICE                    
                                            L771-BRANCH-OFFICE                  
              PERFORM 850-PRINT-HEAD     THRU 850-EXIT                          
              MOVE ZEROS TO WS-LINE                                             
           ELSE                                                                 
              IF F800-NUM-BO NOT = WS-BRANCH-OFFICE                             
                 MOVE F800-NUM-BO           TO WS-BRANCH-OFFICE                 
                                               L771-BRANCH-OFFICE               
                 PERFORM 850-PRINT-HEAD     THRU 850-EXIT                       
                 MOVE ZEROES                TO WS-SERIAL-NO                     
              ELSE                                                              
                 IF WS-LINE > 54                                                
                    PERFORM 850-PRINT-HEAD     THRU 850-EXIT.                   
                                                                                
           ADD 1                      TO WS-SERIAL-NO.                          
           MOVE WS-SERIAL-NO          TO L771-SERIAL-NO.                        
           WRITE BP13L771-REC FROM L771-DETAIL1 AFTER 2.                        
           WRITE BP13L771-REC FROM L771-DETAIL2 AFTER 1.                        
                                                                                
           ADD 3                         TO WS-LINE.                            
           ADD 1                         TO WS-CNT-PRINTED.                     
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------*                                                   
       800-DETERMINE-DATE.                                                      
      *---------------------*                                                   
      *----------------------------------------------------------*              
      *  REGISTRATION IS VALID IS MADE WITHIN 2 MONTHS OF CURDTE *              
      *    -  TO DETERMINE THE 2 MONTHS VALIDITY PERIOD          *              
      *----------------------------------------------------------*              
           MOVE FUNCTION CURRENT-DATE TO  WS-SYS-DATE.                          
                                                                                
           DISPLAY 'TODAY IS           ==> ' WS-SYS-DATE.                       
                                                                                
      *---- CURRENT-DATE                                                        
           MOVE  WS-SYS-DATE        TO  WS-CURRENT-DATE.                        
                                                                                
      *---- PREVIOUS-DATE                                                       
           IF WS-JANUARY                                                        
              SUBTRACT  1           FROM WS-YY-R                                
              MOVE '12'             TO  WS-MM                                   
           ELSE                                                                 
              SUBTRACT  1           FROM WS-MM-R                                
           END-IF.                                                              
                                                                                
           MOVE    WS-SYS-DATE      TO    DATE-REC.                             
           PERFORM 810-PROCESS-DATE THRU  810-EXIT.                             
           MOVE    DATE-REC         TO    WS-PREVIOUS-DATE.                     
                                                                                
           DISPLAY 'CURRENT MONTH IS   ==> ' WS-CURRENT-DATE.                   
           DISPLAY 'PREVIOUS MONTH IS  ==> ' WS-PREVIOUS-DATE.                  
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       810-PROCESS-DATE.                                                        
      ******************************************************************        
            IF 31-DAY-MONTH                                                     
               IF CAL-DAY IS NOT LESS THAN 32                                   
                  MOVE 31 TO CAL-DAY.                                           
                                                                                
            IF 30-DAY-MONTH                                                     
               IF CAL-DAY IS NOT LESS THAN 31                                   
                  MOVE 30 TO CAL-DAY.                                           
                                                                                
            IF 28-29-DAY-MONTH                                                  
               IF CAL-DAY IS LESS THAN 29                                       
                  GO TO 810-EXIT                                                
               ELSE                                                             
                  PERFORM 820-FEBRUARY                                          
            ELSE                                                                
               NEXT SENTENCE.                                                   
                                                                                
       810-EXIT.                                                                
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       820-FEBRUARY.                                                            
      ******************************************************************        
            DIVIDE 4 INTO CAL-YEAR   GIVING WS-YEAR REMAINDER WS-REM.           
                                                                                
            IF WS-REM IS EQUAL TO ZERO AND CAL-DAY IS GREATER THAN 29           
               MOVE 29 TO CAL-DAY.                                              
                                                                                
            IF WS-REM IS NOT EQUAL TO ZERO                                      
                                   AND CAL-DAY IS GREATER THAN 28               
               MOVE 28 TO CAL-DAY.                                              
                                                                                
       820-EXIT.                                                                
            EXIT.                                                               
                                                                                
                                                                                
      *--------------*                                                          
       850-PRINT-HEAD.                                                          
      *--------------*                                                          
           MOVE WS-BRANCH-OFFICE         TO L771-BRANCH-OFFICE.                 
           ADD 1                         TO WS-PAGE.                            
           MOVE WS-PAGE                  TO L771-PAGE.                          
           MOVE FUNCTION CURRENT-DATE TO WS-CURR-DATE.                          
           MOVE CORR WS-CURR-DATE        TO WS-EDIT-DATE.                       
                                                                                
           MOVE WS-EDIT-DATE             TO L771-DATE.                          
                                                                                
           WRITE BP13L771-REC FROM L771-HEAD1 AFTER PAGE.                       
           WRITE BP13L771-REC FROM L771-HEAD2 AFTER 2.                          
           WRITE BP13L771-REC FROM L771-HEAD3 AFTER 1.                          
           WRITE BP13L771-REC FROM L771-HEAD4 AFTER 2.                          
           WRITE BP13L771-REC FROM L771-HEAD5 AFTER 2.                          
           WRITE BP13L771-REC FROM L771-HEAD6 AFTER 1.                          
           WRITE BP13L771-REC FROM L771-HEAD7 AFTER 1.                          
                                                                                
           MOVE 10                       TO WS-LINE.                            
                                                                                
       850-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       900-CLOSE-ROUTINE.                                                       
      *-----------------*                                                       
           CLOSE BP13F800                                                       
                 BM06K110                                                       
                 BB14K500                                                       
                 BP13K830                                                       
                 BP13L771.                                                      
                                                                                
           IF WS-BM06K110 NOT = 00                                              
              DISPLAY ' CLOSING ERROR, WS-BM06K110 = '  WS-BM06K110.            
                                                                                
           IF WS-BB14K500 NOT = 00                                              
              DISPLAY ' CLOSING ERROR, WS-BB14K500 = '  WS-BB14K500.            
                                                                                
           IF WS-BP13K830 NOT = 00                                              
              DISPLAY ' CLOSING ERROR, WS-BP13K830 = '  WS-BP13K830.            
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '******************** BP13C771 *******************'.         
           DISPLAY ' '.                                                         
           DISPLAY 'NO OF PROCESS REC FROM FILE (BP13F800) : '                  
                    WS-CNT-PROCESS.                                             
           DISPLAY 'NO OF REC READ FROM FILE    (BP13F800) : '                  
                    WS-CNT-F800-READ.                                           
           DISPLAY 'NO OF REC READ FROM FILE    (BP13K830) : '                  
                    WS-CNT-K830-READ.                                           
           DISPLAY 'NO OF REC READ FROM FILE    (BM06K110) : '                  
                    WS-CNT-K110-READ.                                           
           DISPLAY 'NO OF SCH ACC FOUND IN PIDB  (BP13C913) : '                 
                    WS-CNT-PIDB-FD.                                             
           DISPLAY 'NO OF REC READ FROM FILE    (BB14K500) : '                  
                    WS-CNT-K500-READ.                                           
           DISPLAY 'NO OF REC PRINTED           (BP13L771) : '                  
                    WS-CNT-PRINTED.                                             
                                                                                
           STOP RUN.                                                            
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
