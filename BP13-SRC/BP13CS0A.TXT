       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13CS0A.                                         00020000
       AUTHOR.        ELAINE S ARGA.                                    00030000
      *DATE-WRITTEN.  13 JAN 2018.                                      00040000
                                                                        00050000
      *************************************************************     00060000
      *      SYSTEM OF COMMITMENT (BP13)                          *     00070000
      *===========================================================*     00080000
      *                                                           *     00090000
      *  OBJECTIVES: 1. TO NOTIFY APPLICANTS THRU EMAIL OF THE    *     00100000
      *                 RESULTS OF THE BALLOT AND THEIR SCHEDULED *     00110000
      *                 APPOINTMENT TO BOOK FLAT.                 *     00120000
      *              2. PROGRAM TO PUT MQ MESSAGE INTO QUEUE      *     00130000
      *                 WHICH CONTAINS CUSTOMER'S EMAIL ADDRESS,  *     00140000
      *                 QUEUE NO., APPT DATE/TIME TO BE SENT BY   *     00150000
      *                 THE JAVA INTERFACE.                       *     00160000
      *                                                           *     00170000
      *   PROGRAM LOGIC:                                          *     00180000
      *         PROCESS INPUT FILES                               *     00190000
      *         MQCONNECT TO QUEUE MANAGER                        *     00200000
      *         MQOPEN QUEUE                                      *     00210000
      *         MQPUT                                             *     00220000
      *         MQCLOSE QUEUE                                     *     00230000
      *         MQDISCONNECT FROM QUEUE MANAGER                   *     00240000
      *                                                           *     00250000
      *===========================================================*     00260000
      * MODIFICATIONS :                                           *     00270000
      *                                                           *     00280000
      * CHG REQ#    DATE    AUTHOR REMARKS                        *     00290000
      * -------- ---------- ------ ------------------------------ *     00300000
      * BP137145 13/01/2018  ESA1  NEW PROGRAM                    *     00310000
      * BP137208 14/03/2018  FNP1  ADD 'A3' TYPE-APPMT FOR SERS   *     00320000
      * BP138330 01/06/2020  PP11  ADD A4 & A5 TYPE-APPMT FOR SERS*     00321001
      *************************************************************     00330000
                                                                        00340000
       ENVIRONMENT DIVISION.                                            00350000
       CONFIGURATION SECTION.                                           00360000
       SOURCE-COMPUTER. IBM-3090.                                       00370000
       OBJECT-COMPUTER. IBM-3090.                                       00380000
       SPECIAL-NAMES.                                                   00390000
           SYSIN IS PARM-INPUT.                                         00400000
                                                                        00410000
       INPUT-OUTPUT SECTION.                                            00420000
       FILE-CONTROL.                                                    00430000
      *                                                                 00440000
           SELECT BP13F23C ASSIGN TO BP13F23C                           00450000
                  ORGANIZATION    IS SEQUENTIAL                         00460000
                  FILE STATUS     IS BP13F23C-STAT.                     00470000
                                                                        00480000
                                                                        00490000
       DATA DIVISION.                                                   00500000
       FILE SECTION.                                                    00510000
                                                                        00520000
       FD  BP13F23C                                                     00530000
           RECORD CONTAINS 250 CHARACTERS                               00540000
           RECORDING MODE IS F.                                         00550000
       COPY BP13F23C.                                                   00560000
                                                                        00570000
                                                                        00580000
       WORKING-STORAGE SECTION.                                         00590000
                                                                        00600000
      *----------------------------------------------------------*      00610000
      *  IMPORTANT!                                              *      00620000
      *  FOR PRODUCTION, QUEUE MANAGER IS 'MQP1'                 *      00630000
      *  FOR TESTING,    QUEUE MANAGER IS 'MQT1'                 *      00640000
      *----------------------------------------------------------*      00650000
       01  WS-QM-NAME               PIC X(48) VALUE 'MQP1'.             00660001
      *01  WS-QM-NAME               PIC X(48) VALUE 'MQT1'.             00670001
       01  WS-BP13Q-NAME            PIC X(48) VALUE SPACES.             00680000
                                                                        00690000
      *----------------------------------------------------------*      00700000
      *  OUTPUT QUEUE NAME TO CRIMSONLOGIC                       *      00710000
      *  THE QUEUE NAME IS THE SAME FOR PRODUCTION AND TESTING   *      00720000
      *----------------------------------------------------------*      00730000
       01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13.WIS.MDB.REQUESTQ'.     00740001
      *01  WS-QUEUE-NAME   PIC X(48) VALUE 'BP13S.WIS.MDB.REQUESTQ'.    00750001
                                                                        00760000
      *----------------------------------------------------------*      00770000
      *  MESSAGE LENGTH                                          *      00780000
      *----------------------------------------------------------*      00790000
       01  WS-MESSAGE-LENGTH        PIC 9(06) VALUE 226012.             00800000
                                                                        00810000
      *----------------------------------------------------------*      00820000
      *  MESSAGE                                                 *      00830000
      *----------------------------------------------------------*      00840000
       01  WS-SEND-MESSAGE.                                             00850000
           05  WS-MSG-CDE                   PIC X(03).                  00860000
           05  WS-FILLER-01                 PIC X(01).                  00870000
           05  WS-MSG-APPT-TYP              PIC X(02).                  00880000
           05  WS-FILLER-02                 PIC X(01).                  00890000
           05  WS-MSG-CTR                   PIC 9(04).                  00900000
           05  WS-FILLER-03                 PIC X(01).                  00910000
           05  WS-MSG OCCURS 2000 TIMES.                                00920000
               10  WS-MSG-EMAIL             PIC X(50).                  00930000
               10  WS-FILLER-04             PIC X(01).                  00940000
               10  WS-MSG-DTE-BALLOT        PIC X(14).                  00950000
               10  WS-FILLER-05             PIC X(01).                  00960000
               10  WS-MSG-ALLO-MODE         PIC X(03).                  00970000
               10  WS-FILLER-06             PIC X(01).                  00980000
               10  WS-MSG-FLAT-TYPE         PIC X(02).                  00990000
               10  WS-FILLER-07             PIC X(01).                  01000000
               10  WS-MSG-QUEUE-NO          PIC X(05).                  01010000
               10  WS-FILLER-08             PIC X(01).                  01020000
               10  WS-MSG-DTE-APPMT         PIC X(11).                  01030000
               10  WS-FILLER-09             PIC X(01).                  01040000
               10  WS-MSG-TME-APPMT         PIC X(07).                  01050000
               10  WS-FILLER-10             PIC X(01).                  01060000
               10  WS-MSG-REGN              PIC X(08).                  01070000
               10  WS-FILLER-11             PIC X(01).                  01080000
               10  WS-NUM-UNIT-OFFER        PIC X(04).                  01090000
               10  WS-FILLER-12             PIC X(01).                  01100000
                                                                        01110000
      *----------------------------------------------------------*      01120000
      *  OTHER VARIABLES                                         *      01130000
      *----------------------------------------------------------*      01140000
       01  WS-VARIABLES.                                                01150000
           05  WS-CTR               PIC 9(04).                          01160000
           05  WS-START             PIC 9(03).                          01170000
           05  WS-MTH-BALLOT        PIC X(10).                          01180000
           05  WS-MTH-APPT          PIC X(04).                          01190000
           05  WS-DTE-BALLOT        PIC X(14).                          01200000
           05  WS-FLAT-TYPE         PIC X(20).                          01210000
           05  WS-DTE-APPMT         PIC X(11).                          01220000
           05  WS-TME-APPMT         PIC X(07).                          01230000
           05  WS-MSG-DETAIL        PIC X(320).                         01240000
           05  WS-TME.                                                  01250000
               10  WS-TME-HH        PIC 9(02).                          01260000
               10  WS-TME-MM        PIC 9(02).                          01270000
           05  WS-APPT-HH           PIC 9(02).                          01280000
                                                                        01290000
       01  WS-MTH-CONV.                                                 01300000
           05  FILLER               PIC X(05)    VALUE 'Jan01'.         01310000
           05  FILLER               PIC X(05)    VALUE 'Feb02'.         01320000
           05  FILLER               PIC X(05)    VALUE 'Mar03'.         01330000
           05  FILLER               PIC X(05)    VALUE 'Apr04'.         01340000
           05  FILLER               PIC X(05)    VALUE 'May05'.         01350000
           05  FILLER               PIC X(05)    VALUE 'Jun06'.         01360000
           05  FILLER               PIC X(05)    VALUE 'Jul07'.         01370000
           05  FILLER               PIC X(05)    VALUE 'Aug08'.         01380000
           05  FILLER               PIC X(05)    VALUE 'Sep09'.         01390000
           05  FILLER               PIC X(05)    VALUE 'Oct10'.         01400000
           05  FILLER               PIC X(05)    VALUE 'Nov11'.         01410000
           05  FILLER               PIC X(05)    VALUE 'Dec12'.         01420000
       01  WS-MTH-CONV-TABLE REDEFINES WS-MTH-CONV.                     01430000
           05  WS-TF-MTH    OCCURS 12 TIMES INDEXED BY WS-IDX.          01440000
               10  WS-TRAN-MM      PIC X(3).                            01450000
               10  WS-NUM-MM       PIC X(2).                            01460000
                                                                        01470000
       01  WS-TABLE.                                                    01480000
           05  FILLER              PIC X(11) VALUE '01January  '.       01490000
           05  FILLER              PIC X(11) VALUE '02February '.       01500000
           05  FILLER              PIC X(11) VALUE '03March    '.       01510000
           05  FILLER              PIC X(11) VALUE '04April    '.       01520000
           05  FILLER              PIC X(11) VALUE '05May      '.       01530000
           05  FILLER              PIC X(11) VALUE '06June     '.       01540000
           05  FILLER              PIC X(11) VALUE '07July     '.       01550000
           05  FILLER              PIC X(11) VALUE '08August   '.       01560000
           05  FILLER              PIC X(11) VALUE '09September'.       01570000
           05  FILLER              PIC X(11) VALUE '10October  '.       01580000
           05  FILLER              PIC X(11) VALUE '11November '.       01590000
           05  FILLER              PIC X(11) VALUE '12December '.       01600000
       01  WS-MTH-TABLE REDEFINES WS-TABLE.                             01610000
           05  MONTH-TABLE OCCURS 12 TIMES INDEXED BY WS-IND.           01620000
               10  WS-MTH-CODE     PIC XX.                              01630000
               10  WS-MTH-DESC     PIC X(9).                            01640000
                                                                        01650000
      *-------------------------------------------------------------    01660000
      *  MQI - TEMPORARY VARIABLES FOR ERROR CODES                      01670000
      *-------------------------------------------------------------    01680000
       01  BP13CS0A-REC.                                                01690000
           05 CS0A-REASON          PIC 9(4).                            01700000
           05 CS0A-COMPLETION-CODE PIC 9(4).                            01710000
           05 CS0A-ERR-MSG         PIC X(66).                           01720000
           05 FILLER               PIC X(27).                           01730000
                                                                        01740000
                                                                        01750000
      *----------------------------------------------------------*      01760000
      *              MQI STRUCTURE DECLARATION                   *      01770000
      *----------------------------------------------------------*      01780000
       01 MY-MQ-CONSTANTS.                                              01790000
          COPY CMQV.                                                    01800000
                                                                        01810000
       01 OBJECT-DESCRIPTOR.                                            01820000
          COPY CMQODV.                                                  01830000
                                                                        01840000
       01 MESSAGE-DESCRIPTOR.                                           01850000
          COPY CMQMDV.                                                  01860000
                                                                        01870000
      * PUT MESSAGE OPTIONS                                             01880000
       01 PMOPTIONS.                                                    01890000
          COPY CMQPMOV.                                                 01900000
                                                                        01910000
      *----------------------------------------------------------*      01920000
      * VARIABLE DESCRIPTION:                                    *      01930000
      * (1) HCONN                                                *      01940000
      *       - CONNECTION HANDLE - REPRESENTS THE CONNECTION TO *      01950000
      *         THE QUEUE MANAGER. VALUE IS RETURNED BY MQCONN   *      01960000
      *         AND SUBSEQUENTLY REFERENCED IN MQOPEN, MQPUT,    *      01970000
      *         MQCLOSE AND MQDISC                               *      01980000
      *                                                          *      01990000
      * (2) Q-HANDLE                                             *      02000000
      *       - ACCESS THAT HAS BEEN ESTABLISHED  TO THE OBJECT  *      02010000
      *         CONNECTION HANDLE - VALUE IS RETURNED BY MQOPEN  *      02020000
      *         AND SUBSEQUENTLY REFERENCED IN MQPUT AND MQCLOSE *      02030000
      *                                                          *      02040000
      * (3) OBJECT-DESCRIPTOR                                    *      02050000
      *       - THIS IDENTIFIES THE OBJECT TO BE OPENED          *      02060000
      *                                                          *      02070000
      * (4) OPTIONS                                              *      02080000
      *       WHEN USED IN MQOPEN                                *      02090000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQOPEN        *      02100000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      02110000
      *         MQOO-OUTPUT - THE QUEUE IS OPENED FOR USE WITH   *      02120000
      *                       SUBSEQUENT MQPUT CALL              *      02130000
      *         MQOO-FAIL-IF-QUIESCING - FORCES MQCALL TO FAIL   *      02140000
      *                       IF QUEUE MANAGER IS IN QUIESCING   *      02150000
      *                       STATE (I.E. PREPARING TO SHUTDOWN) *      02160000
      *                                                          *      02170000
      *       WHEN USED IN MQCLOSE                               *      02180000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQCLOSE       *      02190000
      *       - OPTIONS USED IN THIS PROGRAM:                    *      02200000
      *         MQCO-NONE   - NO OPTIONAL CLOSE PROCESSING       *      02210000
      *                       REQUIRED                           *      02220000
      *                                                          *      02230000
      * (5) MESSAGE-DESCRIPTOR                                   *      02240000
      *       - THIS DESCRIBES THE ATTRIBUTES OF THE MESSAGE     *      02250000
      *         BEING SENT, AND RECEIVES INFO ABOUT THE MESSAGE  *      02260000
      *         AFTER THE PUT REQUEST IS COMPLETE                *      02270000
      *                                                          *      02280000
      * (6) PMOPTIONS (PUT MESSAGE OPTIONS)                      *      02290000
      *       - OPTIONS THAT CONTROL THE ACTION OF MQPUT         *      02300000
      *       - OPTION USED IN THIS PROGRAM:                     *      02310000
      *         MQMD-EXPIRY - MESSAGE LIFETIME. THE MESSAGE      *      02320000
      *                       BECOMES ELIGIBLE TO BE DISCARDED   *      02330000
      *                       IF IT HAS NOT BEEN REMOVED FROM    *      02340000
      *                       FROM THE QUEUE BEFORE THIS PERIOD  *      02350000
      *                       OF TIME ELAPSED                    *      02360000
      *                     - MUST BE SET TO MQEI_UNLIMITED      *      02370000
      *         MQMD-PERSISTENCE = MQPER-PERSISTENT              *      02380000
      *                                                          *      02390000
      * (7) BUFFER-LENGTH                                        *      02400000
      *       - LENGTH OF THE MESSAGE IN BUFFER                  *      02410000
      *                                                          *      02420000
      * (7) BUFFER                                               *      02430000
      *       - MESSAGE DATA                                     *      02440000
      *----------------------------------------------------------*      02450000
       01 HCONN                    PIC S9(9) BINARY.                    02460000
       01 Q-HANDLE                 PIC S9(9) BINARY.                    02470000
       01 OPTIONS                  PIC S9(9) BINARY.                    02480000
       01 COMPLETION-CODE          PIC S9(9) BINARY.                    02490000
       01 OPEN-CODE                PIC S9(9) BINARY.                    02500000
       01 CON-REASON               PIC S9(9) BINARY.                    02510000
       01 REASON                   PIC S9(9) BINARY.                    02520000
       01 MQMSGD                   PIC S9(9) BINARY.                    02530000
       01 BUFFER-LENGTH            PIC S9(9) BINARY.                    02540000
       01 BUFFER                   PIC X(226012).                       02550000
       01 QM-NAME                  PIC X(48) VALUE SPACES.              02560000
       01 TARGET-QUEUE             PIC X(48) VALUE SPACES.              02570000
                                                                        02580000
      *-------------------------------------------------------------    02590000
      *  FILE STATUS                                                    02600000
      *-------------------------------------------------------------    02610000
       01  WS-FILE-STAT.                                                02620000
           05 BP13F23C-STAT        PIC X(02)  VALUE SPACES.             02630000
                                                                        02640000
      *-------------------------------------------------------------    02650000
      *  FLAGS / SWITCHES                                               02660000
      *-------------------------------------------------------------    02670000
       01  WS-FLAGS.                                                    02680000
           05 F23C-EOF             PIC X(01) VALUE 'N'.                 02690000
           05 F23C-EMPTY           PIC X(01) VALUE 'N'.                 02700000
                                                                        02710000
      ****************************************************************  02720000
       PROCEDURE DIVISION.                                              02730000
      ****************************************************************  02740000
                                                                        02750000
      ********************                                              02760000
       0000-MAIN-PROCESS.                                               02770000
      ********************                                              02780000
           PERFORM 0100-OPEN-FILES         THRU 0100-EXIT.              02790000
           PERFORM 0200-INITIALIZATION     THRU 0200-EXIT.              02800000
                                                                        02810000
           ACCEPT WS-BP13Q-NAME            FROM PARM-INPUT.             02820000
                                                                        02830000
           PERFORM 1000-CHECK-MESSAGE      THRU 1000-EXIT.              02840000
           PERFORM 3000-PROCESS-BP13F23C   THRU 3000-EXIT               02850000
                   UNTIL F23C-EOF = 'Y'.                                02860000
           DISPLAY 'WS-SEND-MESSAGE : ' WS-SEND-MESSAGE.                02870000
           PERFORM 5300-MQ-PUT-MESSAGE     THRU 5300-EXIT.              02880000
           DISPLAY ' *** APPOINTMENT NOTIFICATION SENT!'                02890000
           PERFORM 5400-MQ-CLOSE           THRU 5400-EXIT.              02900000
           PERFORM 5500-MQ-DISCONNECT      THRU 5500-EXIT.              02910000
           PERFORM 9000-CLOSE-FILES        THRU 9000-EXIT.              02920000
                                                                        02930000
           STOP RUN.                                                    02940000
                                                                        02950000
       0000-EXIT.                                                       02960000
           EXIT.                                                        02970000
                                                                        02980000
      ********************                                              02990000
       0100-OPEN-FILES.                                                 03000000
      ********************                                              03010000
           DISPLAY ' ***** STARTING PROGRAM BP13CS0A . . . '.           03020000
           DISPLAY ' '.                                                 03030000
           OPEN    INPUT   BP13F23C.                                    03040000
                                                                        03050000
           IF  BP13F23C-STAT     NOT  =  00                             03060000
               DISPLAY ' OPEN ERROR BP13F23C'                           03070000
               DISPLAY 'BP13F23C-STAT = ' BP13F23C-STAT                 03080000
               MOVE     12                   TO RETURN-CODE             03090000
               PERFORM  9000-CLOSE-FILES     THRU 9000-EXIT             03100000
           END-IF.                                                      03110000
                                                                        03120000
       0100-EXIT.                                                       03130000
           EXIT.                                                        03140000
                                                                        03150000
      **********************                                            03160000
       0200-INITIALIZATION.                                             03170000
      **********************                                            03180000
                                                                        03190000
           MOVE SPACES     TO WS-SEND-MESSAGE.                          03200000
           INITIALIZE         WS-SEND-MESSAGE.                          03210000
           MOVE ';'        TO WS-FILLER-01                              03220000
                              WS-FILLER-02                              03230000
                              WS-FILLER-03.                             03240000
           PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL WS-CTR > 2000       03250000
              MOVE ';'     TO WS-FILLER-04(WS-CTR)                      03260000
                              WS-FILLER-05(WS-CTR)                      03270000
                              WS-FILLER-06(WS-CTR)                      03280000
                              WS-FILLER-07(WS-CTR)                      03290000
                              WS-FILLER-08(WS-CTR)                      03300000
                              WS-FILLER-09(WS-CTR)                      03310000
                              WS-FILLER-10(WS-CTR)                      03320000
                              WS-FILLER-11(WS-CTR)                      03330000
                              WS-FILLER-12(WS-CTR)                      03340000
           END-PERFORM.                                                 03350000
                                                                        03360000
           MOVE 'EML'      TO WS-MSG-CDE.                               03370000
                                                                        03380000
      *-----------------------------                                    03390000
      *  INITIAL READ OF INPUT FILES                                    03400000
      *-----------------------------                                    03410000
           READ BP13F23C                                                03420000
               AT END                                                   03430000
                   MOVE 'Y' TO F23C-EOF                                 03440000
                   MOVE 'Y' TO F23C-EMPTY                               03450000
                   DISPLAY ' *** '                                      03460000
                   DISPLAY ' *** NO RECORDS FOUND IN SMS FILE'          03470000
                   DISPLAY ' *** '                                      03480000
           END-READ.                                                    03490000
                                                                        03500000
           MOVE F23C-TYPE-APPMT            TO WS-MSG-APPT-TYP.          03510000
                                                                        03520000
       0200-EXIT.                                                       03530000
           EXIT.                                                        03540000
                                                                        03550000
      ************************                                          03560000
       1000-CHECK-MESSAGE.                                              03570000
      ************************                                          03580000
           IF F23C-EMPTY = 'Y'                                          03590000
               PERFORM 9000-CLOSE-FILES  THRU  9000-EXIT                03600000
           ELSE                                                         03610000
               PERFORM 5100-MQ-CONNECT   THRU  5100-EXIT                03620000
               PERFORM 5200-MQ-OPEN      THRU  5200-EXIT                03630000
           END-IF.                                                      03640000
                                                                        03650000
           MOVE SPACES                     TO BUFFER.                   03660000
                                                                        03670000
       1000-EXIT.                                                       03680000
           EXIT.                                                        03690000
                                                                        03700000
      ************************                                          03710000
       3000-PROCESS-BP13F23C.                                           03720000
      ************************                                          03730000
                                                                        03740000
           IF F23C-TYPE-APPMT = 'A1' OR 'A2' OR 'A3' OR 'A4' OR 'A5'    03750000
              PERFORM 3200-PASS-MSG  THRU 3200-EXIT                     03760000
           END-IF.                                                      03770000
                                                                        03780000
           READ BP13F23C                                                03790000
               AT END                                                   03800000
                   MOVE 'Y' TO F23C-EOF                                 03810000
           END-READ.                                                    03820000
                                                                        03830000
       3000-EXIT.                                                       03840000
           EXIT.                                                        03850000
                                                                        03860000
                                                                        03870000
      ****************************************************************  03880000
       3200-PASS-MSG.                                                   03890000
      ****************************************************************  03900000
                                                                        03910000
           MOVE SPACES     TO WS-DTE-BALLOT                             03920000
                              WS-FLAT-TYPE                              03930000
                              WS-DTE-APPMT                              03940000
                              WS-TME-APPMT.                             03950000
                                                                        03960000
           ADD 1  TO WS-MSG-CTR.                                        03970000
                                                                        03980000
           MOVE F23C-NUM-EMAIL   TO WS-MSG-EMAIL(WS-MSG-CTR).           03990000
                                                                        04000000
           IF F23C-DTE-BALLOT NOT = SPACES AND LOW-VALUES AND ZEROES    04010000
              PERFORM 3300-FORMAT-BALLOT-DTE  THRU 3300-EXIT            04020000
              MOVE WS-DTE-BALLOT    TO WS-MSG-DTE-BALLOT (WS-MSG-CTR)   04030000
           END-IF.                                                      04040000
                                                                        04050000
           MOVE F23C-NUM-ALLO-MODE   TO WS-MSG-ALLO-MODE (WS-MSG-CTR).  04060000
           MOVE F23C-NUM-FLAT-TYPE   TO WS-MSG-FLAT-TYPE (WS-MSG-CTR).  04070000
           MOVE F23C-NUM-QUEUE       TO WS-MSG-QUEUE-NO (WS-MSG-CTR).   04080000
                                                                        04090000
           IF F23C-DTE-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES     04100000
              PERFORM 3400-FORMAT-APPT-DTE  THRU 3400-EXIT              04110000
              MOVE WS-DTE-APPMT      TO WS-MSG-DTE-APPMT (WS-MSG-CTR)   04120000
           END-IF.                                                      04130000
           IF F23C-TME-APPMT NOT = SPACES AND LOW-VALUES AND ZEROES     04140000
              MOVE F23C-TME-APPMT    TO WS-TME                          04150000
              IF WS-TME-HH > 12                                         04160000
                 COMPUTE WS-APPT-HH = WS-TME-HH - 12                    04170000
                 STRING WS-APPT-HH ':'                                  04180000
                        WS-TME-MM  'pm'                                 04190000
                        DELIMITED BY SIZE                               04200000
                 INTO WS-TME-APPMT                                      04210000
              ELSE                                                      04220000
                 IF WS-TME-HH = 12                                      04230000
                    STRING WS-TME-HH  ':'                               04240000
                           WS-TME-MM  'pm'                              04250000
                           DELIMITED BY SIZE                            04260000
                    INTO WS-TME-APPMT                                   04270000
                 ELSE                                                   04280000
                    STRING WS-TME-HH  ':'                               04290000
                           WS-TME-MM  'am'                              04300000
                           DELIMITED BY SIZE                            04310000
                    INTO WS-TME-APPMT                                   04320000
                 END-IF                                                 04330000
              END-IF                                                    04340000
              MOVE WS-TME-APPMT      TO WS-MSG-TME-APPMT (WS-MSG-CTR)   04350000
           END-IF.                                                      04360000
                                                                        04370000
           MOVE F23C-NUM-REGN        TO WS-MSG-REGN (WS-MSG-CTR).       04380000
           MOVE F23C-NUM-UNIT-OFFER  TO WS-NUM-UNIT-OFFER(WS-MSG-CTR).  04390000
                                                                        04400000
       3200-EXIT.                                                       04410000
           EXIT.                                                        04420000
                                                                        04430000
      ****************************************************************  04440000
       3300-FORMAT-BALLOT-DTE.                                          04450000
      ****************************************************************  04460000
                                                                        04470000
           SET WS-IND TO 1.                                             04480000
                                                                        04490000
           SEARCH MONTH-TABLE                                           04500000
               AT END                                                   04510000
                  MOVE SPACES              TO WS-MTH-BALLOT             04520000
               WHEN WS-MTH-CODE (WS-IND) = F23C-DTE-BALLOT(5:2)         04530000
                  MOVE WS-MTH-DESC (WS-IND) TO WS-MTH-BALLOT            04540000
           END-SEARCH.                                                  04550000
                                                                        04560000
           STRING WS-MTH-BALLOT                                         04570000
                  F23C-DTE-BALLOT(1:4)                                  04580000
                  DELIMITED BY SIZE                                     04590000
             INTO WS-DTE-BALLOT.                                        04600000
                                                                        04610000
       3300-EXIT.                                                       04620000
           EXIT.                                                        04630000
                                                                        04640000
      ****************************************************************  04650000
       3400-FORMAT-APPT-DTE.                                            04660000
      ****************************************************************  04670000
                                                                        04680000
           SET WS-IDX TO 1.                                             04690000
                                                                        04700000
           SEARCH WS-TF-MTH                                             04710000
               AT END                                                   04720000
                  MOVE SPACES              TO WS-MTH-APPT               04730000
               WHEN WS-NUM-MM (WS-IDX) = F23C-DTE-APPMT(5:2)            04740000
                  MOVE WS-TRAN-MM (WS-IDX) TO WS-MTH-APPT               04750000
           END-SEARCH.                                                  04760000
                                                                        04770000
           STRING F23C-DTE-APPMT(7:2) ' '                               04780000
                  WS-MTH-APPT                                           04790000
                  F23C-DTE-APPMT(1:4)                                   04800000
                  DELIMITED BY SIZE                                     04810000
             INTO WS-DTE-APPMT.                                         04820000
                                                                        04830000
       3400-EXIT.                                                       04840000
           EXIT.                                                        04850000
                                                                        04860000
      ****************************************************************  04870000
       5100-MQ-CONNECT.                                                 04880000
      ****************************************************************  04890000
      *---------------------------------------------------------------  04900000
      *  SET THE QUEUE MANAGER NAME                                     04910000
      *---------------------------------------------------------------  04920000
           IF WS-BP13Q-NAME NOT = SPACES AND LOW-VALUES                 04930000
              MOVE WS-BP13Q-NAME           TO   QM-NAME                 04940000
           ELSE                                                         04950000
              MOVE WS-QM-NAME              TO   QM-NAME                 04960000
           END-IF.                                                      04970000
                                                                        04980000
      *---------------------------------------------------------------  04990000
      *   MQCONN                                                        05000000
      *---------------------------------------------------------------  05010000
           CALL 'MQCONN'                                                05020000
                USING QM-NAME, HCONN,                                   05030000
                COMPLETION-CODE, CON-REASON.                            05040000
                                                                        05050000
           IF COMPLETION-CODE  = MQCC-FAILED                            05060000
              MOVE CON-REASON              TO   CS0A-REASON             05070000
              MOVE COMPLETION-CODE         TO   CS0A-COMPLETION-CODE    05080000
              MOVE 'BP13CS0A MQCONN ERROR' TO   CS0A-ERR-MSG            05090000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               05100000
           END-IF.                                                      05110000
                                                                        05120000
       5100-EXIT.                                                       05130000
           EXIT.                                                        05140000
                                                                        05150000
                                                                        05160000
      ****************************************************************  05170000
       5200-MQ-OPEN.                                                    05180000
      ****************************************************************  05190000
      *---------------------------------------------------------------  05200000
      *  USE DEFAULT WS-QUEUE-NAME                                      05210000
      *---------------------------------------------------------------  05220000
           MOVE  WS-QUEUE-NAME         TO MQOD-OBJECTNAME.              05230000
           ADD   MQOO-OUTPUT MQOO-FAIL-IF-QUIESCING                     05240000
                               GIVING OPTIONS.                          05250000
                                                                        05260000
      *---------------------------------------------------------------  05270000
      *   MQOPEN                                                        05280000
      *---------------------------------------------------------------  05290000
           CALL 'MQOPEN'                                                05300000
                USING HCONN, OBJECT-DESCRIPTOR,                         05310000
                OPTIONS, Q-HANDLE,                                      05320000
                OPEN-CODE, REASON.                                      05330000
                                                                        05340000
           IF REASON NOT =  MQRC-NONE                                   05350000
              MOVE REASON                     TO   CS0A-REASON          05360000
              MOVE OPEN-CODE                  TO   CS0A-COMPLETION-CODE 05370000
              MOVE 'MQOPEN ENDED WITH REASON CODE'                      05380000
                                              TO   CS0A-ERR-MSG         05390000
              PERFORM 9100-EXIT-MQCONN        THRU 9100-EXIT            05400000
           END-IF.                                                      05410000
                                                                        05420000
       5200-EXIT.                                                       05430000
           EXIT.                                                        05440000
                                                                        05450000
      ***********************                                           05460000
       5300-MQ-PUT-MESSAGE.                                             05470000
      ***********************                                           05480000
           MOVE WS-SEND-MESSAGE     TO BUFFER.                          05490000
                                                                        05500000
      *---------------------------------------------------------------  05510000
      *  SET UP MESSAGE DESCRIPTOR                                      05520000
      *---------------------------------------------------------------  05530000
           MOVE MQEI-UNLIMITED      TO MQMD-EXPIRY.                     05540000
           MOVE MQPER-PERSISTENT    TO MQMD-PERSISTENCE.                05550000
           MOVE MQFMT-STRING        TO MQMD-FORMAT.                     05560000
           MOVE WS-MESSAGE-LENGTH   TO BUFFER-LENGTH.                   05570000
      *---------------------------------------------------------------  05580000
      *   MQPUT                                                         05590000
      *---------------------------------------------------------------  05600000
           CALL 'MQPUT'                                                 05610000
                USING HCONN, Q-HANDLE,                                  05620000
                      MESSAGE-DESCRIPTOR, PMOPTIONS,                    05630000
                      BUFFER-LENGTH, BUFFER,                            05640000
                      COMPLETION-CODE, REASON.                          05650000
                                                                        05660000
           IF REASON NOT =  MQRC-NONE                                   05670000
              MOVE REASON                  TO   CS0A-REASON             05680000
              MOVE COMPLETION-CODE         TO   CS0A-COMPLETION-CODE    05690000
              MOVE 'BP13CS0A MQPUT ERROR'  TO   CS0A-ERR-MSG            05700000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               05710000
           END-IF.                                                      05720000
                                                                        05730000
       5300-EXIT.                                                       05740000
           EXIT.                                                        05750000
                                                                        05760000
      ****************************************************************  05770000
       5400-MQ-CLOSE.                                                   05780000
      ****************************************************************  05790000
           MOVE MQCO-NONE TO OPTIONS.                                   05800000
                                                                        05810000
      *---------------------------------------------------------------  05820000
      *   MQCLOSE                                                       05830000
      *---------------------------------------------------------------  05840000
           CALL 'MQCLOSE'                                               05850000
                USING HCONN, Q-HANDLE, OPTIONS,                         05860000
                COMPLETION-CODE, REASON.                                05870000
                                                                        05880000
           IF REASON NOT =  MQRC-NONE                                   05890000
              MOVE REASON                   TO   CS0A-REASON            05900000
              MOVE COMPLETION-CODE          TO   CS0A-COMPLETION-CODE   05910000
              MOVE 'BP13CS0A MQCLOSE ERROR' TO   CS0A-ERR-MSG           05920000
              PERFORM 9100-EXIT-MQCONN      THRU 9100-EXIT              05930000
           END-IF.                                                      05940000
                                                                        05950000
       5400-EXIT.                                                       05960000
           EXIT.                                                        05970000
                                                                        05980000
      ****************************************************************  05990000
       5500-MQ-DISCONNECT.                                              06000000
      ****************************************************************  06010000
      *---------------------------------------------------------------  06020000
      *  DISCONNECT FROM QUEUE MANAGER                                  06030000
      *---------------------------------------------------------------  06040000
           CALL 'MQDISC'                                                06050000
           USING HCONN, COMPLETION-CODE, REASON                         06060000
                                                                        06070000
           IF REASON NOT =  MQRC-NONE                                   06080000
              MOVE REASON                  TO   CS0A-REASON             06090000
              MOVE COMPLETION-CODE         TO   CS0A-COMPLETION-CODE    06100000
              MOVE 'BP13CS0A MQDISC ERROR' TO   CS0A-ERR-MSG            06110000
              PERFORM 9100-EXIT-MQCONN     THRU 9100-EXIT               06120000
           END-IF.                                                      06130000
                                                                        06140000
       5500-EXIT.                                                       06150000
           EXIT.                                                        06160000
                                                                        06170000
                                                                        06180000
      ****************************************************************  06190000
       9000-CLOSE-FILES.                                                06200000
      ****************************************************************  06210000
                                                                        06220000
           CLOSE BP13F23C.                                              06230000
                                                                        06240000
           IF    RETURN-CODE NOT = ZERO                                 06250000
                 DISPLAY ' *** RETURN-CODE = ' RETURN-CODE ' ERROR'     06260000
           ELSE                                                         06270000
                 DISPLAY ' '                                            06280000
                 DISPLAY ' *** SUCCESSFUL EXECUTION OF BP13CS0A.'       06290000
                 DISPLAY ' *** MESSAGE/S PUT INTO QUEUE SUCCESSFULLY!'  06300000
                 DISPLAY ' *** Q MANAGER : ' QM-NAME                    06310000
                 DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME              06320000
                 DISPLAY ' '                                            06330000
           END-IF.                                                      06340000
                                                                        06350000
           STOP RUN.                                                    06360000
                                                                        06370000
       9000-EXIT.                                                       06380000
           EXIT.                                                        06390000
                                                                        06400000
      ****************************************************************  06410000
       9100-EXIT-MQCONN.                                                06420000
      ****************************************************************  06430000
           DISPLAY ' *** PROGRAM ID:  BP13CS0A '                        06440000
           DISPLAY ' *** Q MANAGER : ' QM-NAME                          06450000
           DISPLAY ' *** TARGET Q  : ' WS-QUEUE-NAME                    06460000
           DISPLAY ' '                                                  06470000
           IF CS0A-COMPLETION-CODE NOT = ZEROES AND LOW-VALUES          06480000
              DISPLAY ' *** MQ COMPLETION CODE: ' CS0A-COMPLETION-CODE  06490000
              DISPLAY ' *** MQ REASON         : ' CS0A-REASON           06500000
              DISPLAY ' *** MQ ERROR MSG      : ' CS0A-ERR-MSG          06510000
              MOVE 99                    TO  RETURN-CODE                06520000
           END-IF.                                                      06530000
                                                                        06540000
           PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT.                06550000
                                                                        06560000
       9100-EXIT.                                                       06570000
           EXIT.                                                        06580000
                                                                        06590000
      ****************************************************************  06600000
      **********            END OF BP13CS0A                 **********  06610000
      ****************************************************************  06620000
