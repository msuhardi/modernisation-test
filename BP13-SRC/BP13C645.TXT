      ***************************                                               
       IDENTIFICATION DIVISION.                                                 
      ***************************                                               
                                                                                
       PROGRAM-ID.    BP13C645.                                                 
      *AUTHOR.        RAYATHATHA ASHOK.                                         
      *DATE-WRITTEN.  27/03/92.                                                 
      *DATE-COMPILED.                                                           
      *REMARKS.                                                                 
      ******************************************************************        
      *                                                                *        
      *   SYSTEM NAME  :    SYSTEM OF COMMITMENT   (SOC)               *        
      *                                                                *        
      *   SYSTEM ID    :    BP13                                       *        
      *                                                                *        
      *   OBJECTIVE    :    TO PRINT PAYMENT VOUCHER                   *        
      *                                                                *        
      *   INPUT FILES  :    1. BP13T.F650.PREPVRCH  (BP13F650)         *        
      *                     2. BP13T.K330.ACCUMAO   (BP13K330)         *        
      *                     3. BP13T.K800.APPLN     (BP13K800)         *        
      *                                                                *        
      *   I-O FILE     :    1. BP13T.K650.PREPVRCH  (BP13K650)         *        
      *                                                                *        
      *   OUTPUT FILES :    1. BP13T.F651.PREPVRCH  (BP13F651)         *        
      *                     2. BP13.F235.EGPVR.SOC  (AG07F235)         *        
      *                                                                *        
      *   REPORT       :    1. BP13L645                                *        
      *                                                                *        
      *                                                                *        
      *   CHGE-NO  BY    DATE   DESCRIPTION                            *        
      *   -------  ---  ------  -------------------------------------  *        
      *   SOC-PH8  LJL  050892  A) TO REMOVE THE WORD CHECKED BY RE-   *        
      *                            COMMENDED BY AND RETAIN CERTIFIED   *        
      *                            BY.                                 *        
      *                         B) TO CREATE A TEMPORARY FILE FOR RE-  *        
      *                            FUND CASES ASSIGNED WITH BATCH NO   *        
      *                            FOR PRINTING OF REFUND LETTERS.     *        
      *   C9210B9  LJL  241092  A) TO CHECK WITH ACCUMAO FILE TO EN-   *        
      *                            SURE THAT THE CASE IS A VALID SA    *        
      *                            CASE.                               *        
      *   SOC-PH8  RML  030893  REFER TO BP13K800                      *        
      *   C931147  JEP  190194  TO CATER FOR PAYMENT SYSTEM.           *        
      *   C940876  LJL  170894  TO INCLUDE 'REFUND OF BOOKING FEE' TO  *        
      *                         THE NARRATION FIELD.                   *        
      *   C950330  LJL  240395  TO CATER FOR REFUND OF BK FEE FOR AA.  *        
      *  BP130037  LJL  181095  TO CATER FOR THE AMALGATION OF SALES   *        
      *                         TYPE 1,2,2B,3,3A AND 10.               *        
      *  BP130418  SIA  090498  CATER FOR Y2000                        *        
      *  BP130594  RAS  241198  TO SEPARATE REFUND METHOD OF CHEQUE &  *        
      *                         IBG.                                   *        
      *  BP130594  LSB  090199  ELECTRONIC REFUND OF BOOKING FEE BY IBG*        
      *  BP130594  LSB  230199  ELECTRONIC REFUND OF BOOKING FEE BY IBG*        
      *  BP130790  SCK  020200  TO ADD IN IN-SOURCE DOCUMENTATION      *        
      *  BP132103  CLT  180201  AG07 8 DIGIT EXPANSION                 *        
      *  BP132185  MALC 190802  TO CHANGE PHONE NO TO 64903783         *        
      *  BP133172  JB8  200508  CHANGE BP13F680 TO AG07F235            *        
      *            JB8  120609  CHANGE PRPR ID & START ID TO SHARON    *        
      *            JB8  290609  TO BY PASS CASES WITH VR NO            *        
      *  BP132185  MALC 190802  TO CHANGE PHONE NO TO 64903782         *        
      *  BP134092  ESA1 080311  TO CATER FOR NEW ERP GL ACCOUNT        *        
      *  BP135096  JGO1 161013  UPDATE VOUCHER FROM 'SU' TO 'SS'       *        
      *  BP135616  JGO1 090315  CHANGE LENGTH OF F650/K650 TO 500      *        
      *  BP135832  JGO1 200515  USE NEW BANK AND IBG ACCT FIELDS       *        
      *  BP135832  RJB1 140715  CATERED FOR 20 BYTES FOR BANK AND IBG  *        
      *                         ON THE REPORT                          *        
      *  BP138339  KR13 050820  UPDATE REPORT ID.                      *        
      ******************************************************************        
                                                                                
                                                                                
      ***************************                                               
       ENVIRONMENT    DIVISION.                                                 
      ***************************                                               
                                                                                
       CONFIGURATION  SECTION.                                                  
       SOURCE-COMPUTER.   IBM-3090.                                             
       OBJECT-COMPUTER.   IBM-3090.                                             
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F650  ASSIGN       TO BP13F650.                           
           SELECT BP13F651  ASSIGN       TO BP13F651.                           
           SELECT AG07F235  ASSIGN       TO AG07F235.                           
           SELECT BP13K330  ASSIGN       TO BP13K330                            
                            ORGANIZATION IS INDEXED                             
                            ACCESS MODE  IS DYNAMIC                             
                            RECORD KEY   IS K330-KEY-FLD                        
                            FILE STATUS  IS WS-K330-STATUS.                     
           SELECT BP13K650  ASSIGN       TO BP13K650                            
                            ORGANIZATION IS INDEXED                             
                            ACCESS MODE  IS DYNAMIC                             
                            RECORD KEY   IS K650-KEY-FLD                        
                            FILE STATUS  IS WS-K650-STATUS.                     
           SELECT BP13K800  ASSIGN       TO BP13K800                            
                            ORGANIZATION IS INDEXED                             
                            ACCESS MODE  IS DYNAMIC                             
                            RECORD KEY   IS K800-NUM-REGN                       
                            FILE STATUS  IS WS-K800-STATUS.                     
           SELECT SY08K010  ASSIGN       TO SY08K010                            
                            ORGANIZATION IS INDEXED                             
                            ACCESS MODE  IS RANDOM                              
                            RECORD KEY   IS K010-NUM-USERID                     
                            FILE STATUS  IS WS-K010-STATUS.                     
           SELECT BP13L645  ASSIGN       TO BP13L645.                           
                                                                                
                                                                                
      *******************                                                       
       DATA DIVISION.                                                           
      *******************                                                       
                                                                                
      *============*                                                            
       FILE SECTION.                                                            
      *============*                                                            
                                                                                
       FD   BP13F650                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13F650.                                                           
                                                                                
       FD   BP13F651                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13F651.                                                           
                                                                                
       FD   AG07F235                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 700 CHARACTERS.                                     
       COPY AG07F235.                                                           
                                                                                
       FD   BP13K330                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K330.                                                           
                                                                                
       FD   BP13K650                                                            
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BP13K650.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   SY08K010                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY SY08K010.                                                           
                                                                                
       FD   BP13L645                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 132 CHARACTERS.                                     
       01   BP13L645-REC        PIC X(132).                                     
                                                                                
                                                                                
      *=======================*                                                 
       WORKING-STORAGE SECTION.                                                 
      *=======================*                                                 
                                                                                
       01  WS-INDICATORS.                                                       
           05  WS-EOF-F650                PIC X(3)   VALUE 'NO '.               
               88  END-OF-F650                       VALUE 'YES'.               
           05  WS-K330-STATUS             PIC 9(2)   VALUE  00.                 
           05  WS-K650-STATUS             PIC 9(2)   VALUE  00.                 
           05  WS-K800-STATUS             PIC 9(2)   VALUE  00.                 
           05  WS-K010-STATUS             PIC 9(2)   VALUE  00.                 
           05  WS-NEW-VOUCHER             PIC X(1)   VALUE 'Y'.                 
           05  WS-BY-IBG                  PIC X(1)   VALUE 'N'.                 
           05  WS-STAFF-START             PIC X(9)   VALUE '08849H   '.         
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F650-READ               PIC 9(8)   VALUE ZEROES.              
           05  WS-K330-READ               PIC 9(8)   VALUE ZEROES.              
           05  WS-K800-READ               PIC 9(8)   VALUE ZEROES.              
           05  WS-F670-READ               PIC 9(8)   VALUE ZEROES.              
           05  WS-F650-PROCESS            PIC 9(8)   VALUE ZEROES.              
           05  WS-F651-WRITE              PIC 9(8)   VALUE ZEROES.              
           05  WS-F235-WRITE              PIC 9(8)   VALUE ZEROES.              
           05  WS-K800-ZERO-DEBTOR        PIC 9(8)   VALUE ZEROES.              
           05  WS-SEQ-NO                  PIC 9(2)   VALUE ZEROES.              
           05  WS-PAGE                    PIC 9(3)   VALUE 0.                   
           05  WS-CNT1                    PIC 9(8)   VALUE ZEROES.              
           05  WS-CNT2                    PIC 9(8)   VALUE ZEROES.              
           05  WS-CNT3                    PIC 9(8)   VALUE ZEROES.              
           05  WS-CNT4                    PIC 9(8)   VALUE ZEROES.              
                                                                                
                                                                                
       01  WS-ADDRESS-VARIABLES.                                                
           05  WS-ADDR1.                                                        
               10  WS-BLKHDR              PIC X(4)   VALUE 'BLK '.              
               10  WS-BLKNO               PIC X(5)   VALUE SPACES.              
               10  FILLER                 PIC X      VALUE SPACE.               
               10  WS-STREET              PIC X(29)  VALUE SPACES.              
           05  WS-ADDR2.                                                        
               10  WS-HEX                 PIC X      VALUE '#'.                 
               10  WS-LEVELNO             PIC X(2)   VALUE SPACES.              
               10  WS-DASH1               PIC X      VALUE '-'.                 
               10  WS-MAIN-LVL            PIC X(4)   VALUE SPACES.              
               10  WS-DASH2               PIC X      VALUE '-'.                 
               10  WS-SUB-LVL             PIC X(3)   VALUE SPACES.              
               10  FILLER                 PIC X(3)   VALUE ' S('.               
               10  WS-POSTAL              PIC X(6)   VALUE SPACES.              
               10  FILLER                 PIC X      VALUE ')'.                 
           05  WS-NUM-UNIT.                                                     
               10  WS-HSE-MAIN            PIC X(4)   VALUE SPACES.              
               10  WS-HSE-SUB             PIC X(3)   VALUE SPACES.              
           05  WS-NUM-BLK-HSE.                                                  
               10  WS-BLK-HSE-DESC        PIC X(4)   VALUE 'BLK '.              
               10  WS-BLK-HSE-NO          PIC X(6)   VALUE SPACES.              
                                                                                
                                                                                
       01  WS-STORE-FIELDS.                                                     
                                                                                
           05  WS-NET-AMT                 PIC 9(7)V99  VALUE ZEROS.             
                                                                                
           05  WS-CDE-SALES-PROCESS       PIC X(2)   VALUE SPACES.              
                                                                                
           05  WS-NUM-VOUCHER             PIC X(11)  VALUE SPACES.              
           05  WS-VOUCHER-NO.                                                   
               10  WS-VOUCHER-DDD         PIC X(3)   VALUE SPACES.              
               10  FILLER                 PIC X(1)   VALUE '-'.                 
               10  WS-VOUCHER-FIN-YEAR    PIC X(2)   VALUE SPACES.              
               10  FILLER                 PIC X(1)   VALUE '-'.                 
               10  WS-VOUCHER-VR-SERIAL   PIC X(6)   VALUE SPACES.              
                                                                                
                                                                                
      *----------------------------------------------------------*              
      *    WS DATE VARIABLES                                     *              
      *----------------------------------------------------------*              
       01  WS-CURRENT-DATE.                                                     
           05  WS-CURRENT-CC              PIC 9(2)   VALUE 00.                  
           05  WS-CURRENT-YYMMDD.                                               
               10  WS-CURRENT-YY          PIC 9(2)   VALUE 00.                  
               10  WS-CURRENT-MM          PIC 9(2)   VALUE 00.                  
               10  WS-CURRENT-DD          PIC 9(2)   VALUE 00.                  
                                                                                
       01  WS-EDITED-DATE.                                                      
           05  WS-EDITED-DD               PIC X(2)   VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '/'.                 
           05  WS-EDITED-MM               PIC X(2)   VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '/'.                 
           05  WS-EDITED-CC               PIC X(2)   VALUE SPACES.              
           05  WS-EDITED-YY               PIC X(2)   VALUE SPACES.              
                                                                                
                                                                                
                                                                                
      *----------------------------------------------------------*              
      *    WS LINKAGE VARIABLES PASSED TO "AG07C908"             *              
      *----------------------------------------------------------*              
                                                                                
       01  AG07C908-AREA.                                                       
           05  C908-NUM-DDD               PIC X(3).                             
           05  C908-NUM-FIN-YEAR          PIC 9(2).                             
           05  C908-NUM-VR-SERIAL         PIC 9(6).                             
           05  C908-NUM-ERRMSG            PIC X(4).                             
           05  C908-NUM-FILENAME          PIC X(8).                             
           05  C908-NUM-FILE-STATUS       PIC X(2).                             
                                                                                
                                                                                
                                                                                
      *----------------------------------------------------------*              
      *    FORMAT OF THE VOUCHER LISTING                         *              
      *----------------------------------------------------------*              
                                                                                
       01  PRT-L645-HDG1.                                                       
           05  FILLER                     PIC X      VALUE SPACE.               
           05  FILLER                     PIC X(8)   VALUE 'BP13L645'.          
           05  FILLER                     PIC X(5)   VALUE SPACES.              
           05  FILLER                     PIC X(4)   VALUE 'HDB3'.              
           05  FILLER                     PIC X(68)  VALUE SPACES.              
           05  FILLER                     PIC X(7)   VALUE 'DATE : '.           
           05  L645-DATE                  PIC X(10)  VALUE SPACES.              
           05  FILLER                     PIC X(10)  VALUE SPACES.              
           05  FILLER                     PIC X(7)   VALUE 'PAGE : '.           
           05  L645-PAGE                  PIC ZZ9.                              
                                                                                
       01  PRT-L645-HDG2.                                                       
           05  FILLER                     PIC X(46)  VALUE SPACES.              
           05  FILLER                     PIC X(81)  VALUE ALL '-'.             
                                                                                
       01  PRT-L645-HDG3.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(16)  VALUE                      
               'SALES         : '.                                              
           05  L645-CDE-SA-TP             PIC X(11)  VALUE SPACES.              
           05  FILLER                     PIC X(17)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
                                                                                
       01  PRT-L645-HDG4.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(31)  VALUE                      
               'PAYABLE TO    : AS LISTED BELOW'.                               
           05  FILLER                     PIC X(13)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE                      
               ' FOR FINANCE DEPARTMENT USE             '.                      
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE                      
               ' SCHEDULE NO :                          '.                      
           05  FILLER                     PIC X      VALUE '|'.                 
                                                                                
       01  PRT-L645-HDG5.                                                       
           05  FILLER                     PIC X(45)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
                                                                                
       01  PRT-L645-HDG6.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(31)  VALUE                      
               'SYSTEM CODE   : 18             '.                               
           05  FILLER                     PIC X(13)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE                      
               ' CHECKED  BY :                          '.                      
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(16)  VALUE                      
               ' VOUCHER  NO :  '.                                              
           05  L645-VOUCHER-NO            PIC X(24)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
                                                                                
       01  PRT-L645-HDG7.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(31)  VALUE                      
               'GL CODE       : 0000000104516  '.                               
           05  FILLER                     PIC X(13)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X      VALUE '|'.                 
                                                                                
       01  PRT-L645-HDG8.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(38)  VALUE                      
               'DESCRIPTION   : REFUND OF BOOKING FEES'.                        
           05  FILLER                     PIC X(7)   VALUE SPACES.              
           05  FILLER                     PIC X(81)  VALUE ALL '-'.             
                                                                                
       01  PRT-L645-HDG9-A.                                                     
           05  FILLER                     PIC X(86)  VALUE SPACES.              
           05  FILLER                     PIC X(10)  VALUE                      
               'BANK      '.                                                    
           05  FILLER                     PIC X(25)  VALUE SPACES.              
           05  FILLER                     PIC X(6)   VALUE 'REG NO'.            
                                                                                
       01  PRT-L645-HDG9.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(4)   VALUE 'S/NO'.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  FILLER                     PIC X(4)   VALUE 'NAME'.              
           05  FILLER                     PIC X(64)  VALUE SPACES.              
           05  FILLER                     PIC X(4)   VALUE 'NRIC'.              
           05  FILLER                     PIC X(7)   VALUE SPACES.              
           05  FILLER                     PIC X(11)  VALUE                      
                                                          'IBG BNK A/C'.        
           05  FILLER                     PIC X(1)   VALUE SPACES.              
           05  FILLER                     PIC X(6)   VALUE SPACES.              
           05  FILLER                     PIC X(5)   VALUE SPACES.              
           05  FILLER                     PIC X(6)   VALUE 'AMOUNT'.            
           05  FILLER                     PIC X(6)   VALUE SPACES.              
           05  FILLER                     PIC X(9)   VALUE 'SOCA-DATE'.         
                                                                                
       01  PRT-L645-DTL1.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  L645-VOUCHER               PIC 9(4)   VALUE ZEROES.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  L645-NAME1                 PIC X(66)  VALUE SPACES.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  L645-NRIC1                 PIC X(9)   VALUE SPACES.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  L645-BNK-CODE              PIC X(20)  VALUE SPACES.              
           05  FILLER                     PIC X(4)   VALUE '   $'.              
           05  L645-AMOUNT                PIC ZZZZ9.99.                         
           05  FILLER                     PIC X(3)   VALUE SPACES.              
           05  L645-REGNO                 PIC X(8)   VALUE SPACES.              
                                                                                
       01  PRT-L645-DTL2.                                                       
           05  FILLER                     PIC X(7)   VALUE SPACE.               
           05  L645-NAME2                 PIC X(66)  VALUE SPACES.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  L645-NRIC2                 PIC X(9)   VALUE SPACES.              
           05  FILLER                     PIC X(2)   VALUE SPACES.              
           05  L645-BNK-ACCT              PIC X(20)  VALUE SPACES.              
           05  FILLER                     PIC X(15)  VALUE SPACES.              
           05  L645-SOCA-DATE             PIC X(8)   VALUE SPACES.              
                                                                                
       01  PRT-L645-DTL3.                                                       
           05  FILLER                     PIC X(7)   VALUE SPACE.               
           05  L645-ADDR1                 PIC X(59)  VALUE SPACES.              
                                                                                
       01  PRT-L645-DTL4.                                                       
           05  FILLER                     PIC X(7)   VALUE SPACE.               
           05  L645-ADDR2                 PIC X(54)  VALUE SPACES.              
                                                                                
       01  PRT-L645-FTG1.                                                       
           05  FILLER                     PIC X(109) VALUE SPACES.              
           05  FILLER                     PIC X(9)   VALUE ALL '='.             
                                                                                
       01  PRT-L645-FTG2.                                                       
           05  FILLER                     PIC X(50)  VALUE SPACES.              
           05  FILLER                     PIC X(17)  VALUE                      
               '( VOUCHER NO :   '.                                             
           05  PRT-L645-FIRST             PIC 9(4)   VALUE ZEROES.              
           05  FILLER                     PIC X(4)   VALUE ' TO '.              
           05  PRT-L645-LAST              PIC 9(4)   VALUE ZEROES.              
           05  FILLER                     PIC X(2)   VALUE ' )'.                
           05  FILLER                     PIC X(6)   VALUE SPACES.              
           05  FILLER                     PIC X(22)  VALUE                      
               'TOTAL                $'.                                        
           05  PRT-L645-TOTAL             PIC ZZZZZ9.99.                        
                                                                                
       01  PRT-L645-FTG3.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(15)  VALUE                      
               'NET PAYABLE  : '.                                               
           05  PRT-L645-DESC1              PIC X(60)  VALUE SPACES.             
           05  PRT-L645-DESC2              PIC X(60)  VALUE SPACES.             
                                                                                
       01  PRT-L645-FTG4.                                                       
           05  FILLER                     PIC X      VALUE SPACES.              
           05  FILLER                     PIC X(20)  VALUE                      
               'CHECKED BY / DATE : '.                                          
           05  FILLER                     PIC X(20)  VALUE ALL '_'.             
           05  FILLER                     PIC X(40)  VALUE SPACES.              
           05  FILLER                     PIC X(21)  VALUE                      
               'CERTIFIED BY/ DATE : '.                                         
           05  FILLER                     PIC X(20)  VALUE ALL '_'.             
                                                                                
                                                                                
      *----------------------------------------------------------*              
      *    WS VARIABLES FOR CONVERTING AMOUNT TO WORDS           *              
      *----------------------------------------------------------*              
       01  WS-SUBSCRIPTS.                                                       
           05  WA-SUB                     PIC 999    VALUE 0.                   
           05  WF-SUB                     PIC 999    VALUE 0.                   
           05  WL-SUB                     PIC 999    VALUE 0.                   
           05  WS-SUB                     PIC 999    VALUE 0.                   
           05  WS-FIRST-SUB               PIC 999    VALUE 0.                   
                                                                                
       01  WA-NAMES.                                                            
           05  FILLER                     PIC X(10)  VALUE '3ONE      '.        
           05  FILLER                     PIC X(10)  VALUE '3TWO      '.        
           05  FILLER                     PIC X(10)  VALUE '5THREE    '.        
           05  FILLER                     PIC X(10)  VALUE '4FOUR     '.        
           05  FILLER                     PIC X(10)  VALUE '4FIVE     '.        
           05  FILLER                     PIC X(10)  VALUE '3SIX      '.        
           05  FILLER                     PIC X(10)  VALUE '5SEVEN    '.        
           05  FILLER                     PIC X(10)  VALUE '5EIGHT    '.        
           05  FILLER                     PIC X(10)  VALUE '4NINE     '.        
           05  FILLER                     PIC X(10)  VALUE '3TEN      '.        
           05  FILLER                     PIC X(10)  VALUE '6ELEVEN   '.        
           05  FILLER                     PIC X(10)  VALUE '6TWELVE   '.        
           05  FILLER                     PIC X(10)  VALUE '8THIRTEEN '.        
           05  FILLER                     PIC X(10)  VALUE '8FOURTEEN '.        
           05  FILLER                     PIC X(10)  VALUE '7FIFTEEN  '.        
           05  FILLER                     PIC X(10)  VALUE '7SIXTEEN  '.        
           05  FILLER                     PIC X(10)  VALUE '9SEVENTEEN'.        
           05  FILLER                     PIC X(10)  VALUE '8EIGHTEEN '.        
           05  FILLER                     PIC X(10)  VALUE '8NINETEEN '.        
           05  FILLER                     PIC X(10)  VALUE '6TWENTY   '.        
           05  FILLER                     PIC X(10)  VALUE '6THIRTY   '.        
           05  FILLER                     PIC X(10)  VALUE '5FORTY    '.        
           05  FILLER                     PIC X(10)  VALUE '5FIFTY    '.        
           05  FILLER                     PIC X(10)  VALUE '5SIXTY    '.        
           05  FILLER                     PIC X(10)  VALUE '7SEVENTY  '.        
           05  FILLER                     PIC X(10)  VALUE '6EIGHTY   '.        
           05  FILLER                     PIC X(10)  VALUE '6NINETY   '.        
       01  WA-NAMER REDEFINES WA-NAMES.                                         
           05  WA-NAME                    PIC X(10)  OCCURS 27 TIMES.           
                                                                                
       01  WS-LITERALS.                                                         
           05  L-CENT                     PIC X(5)   VALUE '4CENT'.             
           05  L-AND                      PIC X(4)   VALUE '3AND'.              
           05  L-X                        PIC X      VALUE '%'.                 
           05  L-MILLION                  PIC X(8)   VALUE '7MILLION'.          
           05  L-THOUSAND                 PIC X(9)   VALUE '8THOUSAND'.         
           05  L-DOLLARS                  PIC X(8)   VALUE '7DOLLARS'.          
           05  L-CENTS                    PIC X(6)   VALUE '6CENTS'.            
           05  L-ONLY                     PIC X(6)   VALUE '5ONLY '.            
           05  L-HUNDRED                  PIC X(8)   VALUE '7HUNDRED'.          
           05  L-DOLLAR                   PIC X(7)   VALUE '6DOLLAR'.           
                                                                                
       01  SWITCHES.                                                            
           05  WS-SWITCH                  PIC 9      VALUE 0.                   
           05  WS-THO-SW                  PIC 9      VALUE 0.                   
           05  WS-CNT-SW                  PIC 9      VALUE 0.                   
           05  WS-LIT-SW                  PIC 9      VALUE 0.                   
           05  WS-TEN-SW                  PIC 9      VALUE 0.                   
           05  WS-AND-SW                  PIC 9      VALUE 0.                   
                                                                                
       01  WS-PLACE-COUNTER               PIC 999    VALUE 0.                   
       01  WL-AREA-SAVE                   PIC X(12)  VALUE SPACES.              
       01  WS-RESULT                      PIC 999    VALUE 0.                   
       01  WL-AREA.                                                             
           05  WL-ITEM1                   PIC 9      VALUE 0.                   
           05  FILLER                     PIC X(11)  VALUE SPACES.              
       01  WL-ITM REDEFINES WL-AREA.                                            
           05  WL-ITEM                    PIC X      OCCURS 12 TIMES.           
                                                                                
       01  WS-CHEQUE-DETAILS.                                                   
           05  WS-AMT                     PIC 9(7)V99 VALUE 0.                  
           05  WS-DIGIT REDEFINES WS-AMT  PIC 9      OCCURS 9 TIMES.            
           05  WF-DETAILS.                                                      
               10  WF-LINE-1              PIC X(60).                            
               10  WF-LINE-2              PIC X(60).                            
           05  WF-ITEM REDEFINES WF-DETAILS   PIC X  OCCURS  120 TIMES.         
           05  WP-ITEM REDEFINES WF-DETAILS   PIC X(60) OCCURS 2 TIMES.         
                                                                                
                                                                                
      **********************                                                    
       PROCEDURE DIVISION.                                                      
      **********************                                                    
                                                                                
                                                                                
                                                                                
      ******************************************************************        
       000-MAIN-ROUTINE.                                                        
      ******************************************************************        
                                                                                
           PERFORM  100-OPEN-ROUTINE         THRU   100-EXIT.                   
           PERFORM  200-READ-BP13F650        THRU   200-EXIT.                   
           PERFORM  300-MAIN-ROUTINE         THRU   300-EXIT                    
                        UNTIL END-OF-F650.                                      
           PERFORM  700-WRITE-TRAILER        THRU   700-EXIT.                   
           PERFORM  800-DISPLAY-TOTALS       THRU   800-EXIT.                   
           PERFORM  900-CLOSE-ROUTINE        THRU   900-EXIT.                   
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       100-OPEN-ROUTINE.                                                        
      ******************************************************************        
           OPEN INPUT  BP13F650                                                 
                       BP13K330                                                 
                       SY08K010                                                 
                       BP13K800                                                 
                I-O    BP13K650                                                 
                OUTPUT BP13F651                                                 
                       AG07F235                                                 
                       BP13L645.                                                
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR OPENING SY08K010, STATUS = ' WS-K010-STATUS        
              MOVE     WS-K010-STATUS    TO    RETURN-CODE                      
              PERFORM  900-CLOSE-ROUTINE THRU  900-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-K330-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K330, STATUS = ' WS-K330-STATUS        
              MOVE     WS-K330-STATUS    TO    RETURN-CODE                      
              PERFORM  900-CLOSE-ROUTINE THRU  900-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K800, STATUS = ' WS-K800-STATUS        
              MOVE     WS-K800-STATUS    TO    RETURN-CODE                      
              PERFORM  900-CLOSE-ROUTINE THRU  900-EXIT                         
           END-IF.                                                              
                                                                                
           IF WS-K650-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K650, STATUS = ' WS-K650-STATUS        
              MOVE     WS-K650-STATUS    TO    RETURN-CODE                      
              PERFORM  900-CLOSE-ROUTINE THRU  900-EXIT                         
           END-IF.                                                              
                                                                                
                                                                                
           MOVE 'AG07K962' TO C908-NUM-FILENAME.                                
                                                                                
           CALL 'K962OPEN' USING AG07C908-AREA.                                 
                                                                                
           IF C908-NUM-FILE-STATUS NOT = ('00' AND '97')                        
              DISPLAY 'ERROR OPENING AG07K962, STATUS = '                       
                       C908-NUM-FILE-STATUS                                     
              MOVE     C908-NUM-FILE-STATUS   TO    RETURN-CODE                 
              PERFORM  900-CLOSE-ROUTINE      THRU  900-EXIT                    
           END-IF.                                                              
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       200-READ-BP13F650.                                                       
      ******************************************************************        
                                                                                
           READ BP13F650                                                        
                AT END MOVE   'YES'  TO WS-EOF-F650                             
                       GO TO   200-EXIT.                                        
                                                                                
           ADD  1  TO  WS-F650-READ.                                            
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      ******************************************************************        
       300-MAIN-ROUTINE.                                                        
      ******************************************************************        
                                                                                
           IF F650-NUM-GRP-VR NOT = SPACES AND LOW-VALUES                       
              PERFORM 200-READ-BP13F650  THRU  200-EXIT                         
              GO TO 300-EXIT                                                    
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------*              
      *    CHECK THAT THE RECORD IS A VALID  "SA"  CASE          *              
      *----------------------------------------------------------*              
                                                                                
           IF F650-CDE-SALES-PROCESS = 'SA'                                     
              MOVE     F650-NUM-REGN    TO   K330-CURR-REG                      
              MOVE    '1'               TO   K330-SEQ-NO                        
                                                                                
              READ BP13K330                                                     
                                                                                
              IF WS-K330-STATUS = 00                                            
                 ADD   1 TO  WS-K330-READ                                       
              ELSE                                                              
                 PERFORM 200-READ-BP13F650  THRU  200-EXIT                      
                 GO TO   300-EXIT                                               
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------*              
      *    CHECK THAT THE RECORD HAS PAID SOC-DEBTOR             *              
      *----------------------------------------------------------*              
           MOVE F650-NUM-REGN    TO  K800-NUM-REGN.                             
                                                                                
           READ BP13K800.                                                       
                                                                                
           IF WS-K800-STATUS = 00                                               
              NEXT SENTENCE                                                     
           ELSE                                                                 
              PERFORM  200-READ-BP13F650  THRU  200-EXIT                        
              GO TO    300-EXIT.                                                
                                                                                
           IF K800-AMT-SOC-DEBTOR NOT NUMERIC                                   
              MOVE     ZEROES              TO    K800-AMT-SOC-DEBTOR            
              PERFORM  200-READ-BP13F650   THRU  200-EXIT                       
              GO TO    300-EXIT                                                 
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS = 00                                               
              ADD 1    TO      WS-K800-READ                                     
              IF K800-AMT-BK-PAID <  F650-AMT-REFUND                            
                 DISPLAY 'ERROR : AMT REFUND > BK PAID ' F650-KEY-FLD           
              ELSE                                                              
                 IF K800-AMT-SOC-DEBTOR = ZEROS                                 
                    ADD 1 TO WS-CNT1                                            
                    IF NOT (WS-BY-IBG = 'Y')                                    
                       ADD 1 TO WS-CNT2                                         
                       PERFORM 400-PROCESS-BP13K650-CHEQUE THRU 400-EXIT        
                    ELSE                                                        
                       ADD 1 TO WS-CNT3                                         
                       PERFORM 410-PROCESS-BP13K650-IBG THRU 410-EXIT           
                    END-IF                                                      
                 ELSE                                                           
                    DISPLAY '_BP13K800 KEY : ' K800-NUM-REGN                    
                           ' K800-AMT-SOC-DEBTOR : ' K800-AMT-SOC-DEBTOR        
                    ADD 1 TO WS-K800-ZERO-DEBTOR                                
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NOT END-OF-F650                                                   
              PERFORM    200-READ-BP13F650  THRU  200-EXIT                      
           END-IF.                                                              
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       400-PROCESS-BP13K650-CHEQUE.                                             
      ******************************************************************        
                                                                                
           IF (WS-NEW-VOUCHER = 'Y')                                            
      *       MOVE  'SU '       TO    C908-NUM-DDD                              
              MOVE  'SS '       TO    C908-NUM-DDD                              
              MOVE  'AG07K962'  TO    C908-NUM-FILENAME                         
                                                                                
              CALL  'AG07C908'  USING AG07C908-AREA                             
                                                                                
              IF C908-NUM-FILE-STATUS = '00'                                    
                 PERFORM  500-WRITE-HEADER-REC  THRU   500-EXIT                 
                 MOVE    'N'                    TO     WS-NEW-VOUCHER           
              ELSE                                                              
                 DISPLAY 'ERROR CALLING AG07C908, STATUS '                      
                          C908-NUM-FILE-STATUS                                  
                 PERFORM  900-CLOSE-ROUTINE  THRU 900-EXIT                      
           END-IF.                                                              
                                                                                
           IF  NOT (F650-NEW-NUM-BANK = SPACES OR LOW-VALUES) AND               
               NOT (F650-NEW-NUM-IBG-ACCT  = SPACES OR LOW-VALUES)              
               MOVE 'Y'                           TO WS-BY-IBG                  
               PERFORM 700-WRITE-TRAILER        THRU 700-EXIT                   
               PERFORM 410-PROCESS-BP13K650-IBG THRU 410-EXIT                   
               GO TO 400-EXIT                                                   
           END-IF.                                                              
                                                                                
           PERFORM 600-WRITE-OUTPUT-FILES THRU 600-EXIT.                        
                                                                                
                                                                                
           IF WS-SEQ-NO  = 10 OR END-OF-F650                                    
              PERFORM 700-WRITE-TRAILER   THRU  700-EXIT                        
              MOVE   'Y'                  TO    WS-NEW-VOUCHER                  
              MOVE    ZEROES              TO    WS-SEQ-NO                       
              MOVE    ZEROES              TO    WS-NET-AMT                      
           END-IF.                                                              
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       410-PROCESS-BP13K650-IBG.                                                
      ******************************************************************        
                                                                                
           MOVE 'Y'             TO    WS-BY-IBG.                                
                                                                                
           IF (WS-NEW-VOUCHER = 'Y')                                            
      *       MOVE  'SU '       TO    C908-NUM-DDD                              
              MOVE  'SS '       TO    C908-NUM-DDD                              
              MOVE  'AG07K962'  TO    C908-NUM-FILENAME                         
                                                                                
              CALL  'AG07C908'  USING AG07C908-AREA                             
                                                                                
              IF C908-NUM-FILE-STATUS = '00'                                    
                 PERFORM  500-WRITE-HEADER-REC  THRU   500-EXIT                 
                 MOVE    'N'                    TO     WS-NEW-VOUCHER           
              ELSE                                                              
                 DISPLAY 'ERROR CALLING AG07C908, STATUS '                      
                          C908-NUM-FILE-STATUS                                  
                 PERFORM  900-CLOSE-ROUTINE  THRU 900-EXIT                      
           END-IF.                                                              
                                                                                
           PERFORM 600-WRITE-OUTPUT-FILES THRU 600-EXIT.                        
                                                                                
                                                                                
           IF WS-SEQ-NO  = 10 OR END-OF-F650                                    
              PERFORM 700-WRITE-TRAILER   THRU  700-EXIT                        
              MOVE   'Y'                  TO    WS-NEW-VOUCHER                  
              MOVE    ZEROES              TO    WS-SEQ-NO                       
              MOVE    ZEROES              TO    WS-NET-AMT                      
           END-IF.                                                              
                                                                                
       410-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       500-WRITE-HEADER-REC.                                                    
      ******************************************************************        
           INITIALIZE    AG07F235-HEADER.                                       
           MOVE SPACES                    TO AG07F235-HEADER.                   
           MOVE C908-NUM-DDD              TO F235-NUM-DDD                       
           MOVE C908-NUM-FIN-YEAR         TO F235-NUM-FIN-YEAR                  
           MOVE C908-NUM-VR-SERIAL        TO F235-NUM-VR-SERIAL                 
           MOVE F235-NUM-GRP-VR           TO WS-NUM-VOUCHER                     
           MOVE 00                        TO F235-NUM-REC-TYP.                  
           MOVE 'PV'                      TO F235-NUM-VR-TYP.                   
           MOVE 'TL'                      TO F235-NUM-VR-SUB-TYP.               
           MOVE 'SOC     '                TO F235-NUM-TRANS-TYP.                
           MOVE 'SOC     '                TO F235-NUM-INTRFC-FR.                
           MOVE 1                         TO F235-QTY-VR-PRT-FINAL.             
           MOVE 'CV'                      TO F235-NUM-ACTION-TYP.               
           MOVE '18'                      TO F235-NUM-SYS.                      
           MOVE '0000000104516'           TO F235-NUM-GL-ACCT.                  
           MOVE 'REFUND OF BOOKING FEES'  TO F235-TXT-VR-INFO.                  
           MOVE FUNCTION CURRENT-DATE     TO WS-CURRENT-DATE.                   
           MOVE WS-CURRENT-DATE           TO F235-DTE-VR-CREATE                 
                                             F235-DTE-VR-PRT-FINAL              
           MOVE 'BP13C645'                TO F235-NUM-VR-CREATE-USERID          
                                          F235-NUM-VR-PRT-FINAL-USERID          
           MOVE 'SALES AGREEMENT TEAM'    TO F235-NME-CONTACT-OFFCR.            
           MOVE '64903782'                TO F235-NUM-CONTACT-PHONE.            
      *    MOVE 'E'                       TO F235-NUM-TAX-CDE.                  
      *    AS INFORMED BY CYS ON 28/2/94  TAX-CDE IS BLANK.                     
           MOVE SPACES                    TO F235-NUM-TAX-CDE                   
                                             F235-TXT-REJECT-HDR.               
           MOVE WS-STAFF-START            TO F235-NUM-STAFF-ID-PREP             
                                             F235-NUM-USERID-START.             
           MOVE 'CHKO'                    TO F235-NUM-VCHR-STATE-START.         
                                                                                
           WRITE AG07F235-HEADER.                                               
                                                                                
           ADD      1                     TO WS-F235-WRITE.                     
           PERFORM  520-PRINT-HEADING   THRU 520-EXIT.                          
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       520-PRINT-HEADING.                                                       
      ******************************************************************        
           ADD    1                     TO WS-PAGE.                             
           MOVE   WS-PAGE               TO L645-PAGE.                           
           MOVE   FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.                     
           MOVE   WS-CURRENT-CC         TO WS-EDITED-CC.                        
           MOVE   WS-CURRENT-YY         TO WS-EDITED-YY.                        
           MOVE   WS-CURRENT-MM         TO WS-EDITED-MM.                        
           MOVE   WS-CURRENT-DD         TO WS-EDITED-DD.                        
           MOVE   WS-EDITED-DATE        TO L645-DATE.                           
           MOVE   C908-NUM-DDD          TO WS-VOUCHER-DDD.                      
           MOVE   C908-NUM-FIN-YEAR     TO WS-VOUCHER-FIN-YEAR.                 
           MOVE   C908-NUM-VR-SERIAL    TO WS-VOUCHER-VR-SERIAL.                
           MOVE   WS-VOUCHER-NO         TO L645-VOUCHER-NO.                     
           MOVE   WS-CDE-SALES-PROCESS  TO L645-CDE-SA-TP.                      
                                                                                
           IF     F650-CDE-SALES-PROCESS = 'SA'                                 
                  MOVE 'SA CASES'       TO L645-CDE-SA-TP                       
           ELSE                                                                 
           IF     F650-CDE-SALES-PROCESS = 'AA'                                 
                  MOVE 'AA CASES'       TO L645-CDE-SA-TP                       
           ELSE                                                                 
           IF     F650-CDE-SALES-PROCESS = 'RP'                                 
                  MOVE 'RP CASES'       TO L645-CDE-SA-TP                       
           ELSE                                                                 
           IF     F650-CDE-SALES-PROCESS = 'BB'                                 
                  MOVE 'BB CASES'       TO L645-CDE-SA-TP                       
           ELSE                                                                 
                  MOVE 'SA-TP CASES'    TO L645-CDE-SA-TP.                      
                                                                                
           EVALUATE F650-CDE-SALES-PROCESS                                      
               WHEN 'TP'                                                        
                    MOVE '-A'    TO PRT-L645-HDG1(10:2)                         
               WHEN 'AA'                                                        
                    MOVE '-B'    TO PRT-L645-HDG1(10:2)                         
               WHEN 'BP'                                                        
                    MOVE '-C'    TO PRT-L645-HDG1(10:2)                         
               WHEN 'RP'                                                        
                    MOVE '-D'    TO PRT-L645-HDG1(10:2)                         
               WHEN '  '                                                        
                    MOVE '-E'    TO PRT-L645-HDG1(10:2)                         
           END-EVALUATE                                                         
           WRITE  BP13L645-REC FROM PRT-L645-HDG1 AFTER PAGE.                   
           WRITE  BP13L645-REC FROM PRT-L645-HDG2 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG3 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG4 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG5 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG6 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG7 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG8 AFTER 1.                      
           WRITE  BP13L645-REC FROM PRT-L645-HDG9-A AFTER 1.                    
           WRITE  BP13L645-REC FROM PRT-L645-HDG9 AFTER 1.                      
           MOVE   SPACES       TO   BP13L645-REC.                               
           WRITE  BP13L645-REC.                                                 
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       600-WRITE-OUTPUT-FILES.                                                  
      ******************************************************************        
                                                                                
           PERFORM  620-READ-BP13K650  THRU  620-EXIT.                          
                                                                                
           IF F650-CDE-SALES-PROCESS = 'SA'                                     
              MOVE    'SA'        TO    WS-CDE-SALES-PROCESS                    
           ELSE                                                                 
           IF F650-CDE-SALES-PROCESS = 'TP'                                     
              MOVE    'TP'        TO    WS-CDE-SALES-PROCESS.                   
                                                                                
                                                                                
           PERFORM  640-WRITE-TRANS-DETAIL    THRU  640-EXIT.                   
           PERFORM  660-PRINT-VOUCHER-DETL    THRU  660-EXIT.                   
                                                                                
                                                                                
           MOVE WS-NUM-VOUCHER   TO K650-NUM-GRP-VR.                            
           MOVE WS-SEQ-NO        TO K650-NUM-VOUCHER.                           
           MOVE 'V'              TO K650-CDE-PRINT.                             
           MOVE WS-CURRENT-DATE  TO K650-DTE-UPDATE.                            
                                                                                
           REWRITE BP13K650-REC.                                                
                                                                                
           IF WS-K650-STATUS NOT = 00 AND 02                                    
              DISPLAY 'ERROR UPDATE BP13K650, STATUS = ' WS-K650-STATUS         
              MOVE     WS-K650-STATUS   TO    RETURN-CODE                       
           ELSE                                                                 
              INITIALIZE  BP13F651-REC                                          
              MOVE        SPACES        TO    BP13F651-REC                      
              MOVE        BP13K650-REC  TO    BP13F651-REC                      
                                                                                
              WRITE       BP13F651-REC                                          
                                                                                
              ADD         1             TO    WS-F651-WRITE.                    
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       620-READ-BP13K650.                                                       
      ******************************************************************        
           MOVE SPACES       TO K650-KEY-FLD.                                   
           MOVE F650-KEY-FLD TO K650-KEY-FLD.                                   
                                                                                
           READ BP13K650 KEY IS K650-KEY-FLD.                                   
                                                                                
           IF WS-K650-STATUS NOT = 00 AND 02                                    
              DISPLAY 'ERROR READING BP13K650, STATUS = ' WS-K650-STATUS        
              DISPLAY '                  K650-KEY-FLD = ' K650-KEY-FLD          
              MOVE     WS-K650-STATUS    TO    RETURN-CODE                      
              PERFORM  900-CLOSE-ROUTINE THRU  900-EXIT                         
           END-IF.                                                              
                                                                                
       620-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       640-WRITE-TRANS-DETAIL.                                                  
      ******************************************************************        
           INITIALIZE  AG07F235-TRANS.                                          
           MOVE        SPACES               TO   AG07F235-TRANS.                
           ADD         1                    TO   WS-SEQ-NO.                     
           MOVE        WS-NUM-VOUCHER       TO   F235-NUM-GRP-VR-T.             
           MOVE        WS-SEQ-NO            TO   F235-NUM-TRANS-SERIAL.         
           MOVE        K650-NUM-REGN        TO   F235-NUM-REGN.                 
           MOVE        K650-AMT-REFUND      TO   F235-AMT-TRANS.                
           MOVE       'D'                   TO   F235-AMT-TRANS-CR-DR.          
           MOVE        ZEROS                TO   F235-AMT-TRANS-GST.            
           MOVE        F650-PAYABLE-NAME1   TO   F235-NME-PAYEE1.               
           MOVE        F650-PAYABLE-NRIC1   TO   F235-NUM-PAYEE-UIN1.           
           MOVE        F650-PAYABLE-NAME2   TO   F235-NME-PAYEE2.               
           MOVE        F650-PAYABLE-NRIC2   TO   F235-NUM-PAYEE-UIN2.           
           MOVE        SPACES               TO   F235-NUM-PAYEE-BANK.           
           MOVE        F650-NEW-NUM-BANK    TO   F235-NUM-PAYEE-BANK.           
           MOVE        SPACES               TO   F235-NUM-PAYEE-BANK-BR.        
           MOVE        SPACES                TO F235-NUM-PAYEE-IBG-ACCT.        
           MOVE        F650-NEW-NUM-IBG-ACCT TO F235-NUM-PAYEE-IBG-ACCT.        
           IF F650-HSE-LVL  = SPACES OR LOW-VALUES                              
                  MOVE SPACES               TO   WS-BLK-HSE-DESC                
           ELSE                                                                 
                  MOVE 'BLK'                TO   WS-BLK-HSE-DESC                
           END-IF.                                                              
           MOVE        F650-BLK             TO   WS-BLK-HSE-NO.                 
           MOVE        WS-NUM-BLK-HSE       TO   F235-NUM-BLK-HSE.              
           MOVE        F650-STREET-NAME     TO   F235-NME-STREET.               
           MOVE        F650-HSE-LVL         TO   F235-NUM-LVL.                  
           MOVE        F650-HSE-MAIN        TO   WS-HSE-MAIN.                   
           MOVE        F650-HSE-SUB         TO   WS-HSE-SUB.                    
           MOVE        WS-NUM-UNIT          TO   F235-NUM-UNIT.                 
           MOVE        F650-POSTAL-CDE      TO   F235-NUM-POSTAL.               
           MOVE        SPACES               TO  F235-TXT-REJECT-DTL             
                                                F235-TXT-VR-TRANS-NRNT1         
                                                F235-TXT-VR-TRANS-NRNT2         
                                                F235-TXT-VR-TRANS-NRNT3.        
           WRITE       AG07F235-TRANS.                                          
                                                                                
           ADD         1                   TO WS-F235-WRITE.                    
                                                                                
       640-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       660-PRINT-VOUCHER-DETL.                                                  
      ******************************************************************        
           ADD  1                        TO WS-F650-PROCESS.                    
           MOVE F650-PAYABLE-NAME1       TO L645-NAME1.                         
           MOVE F650-PAYABLE-NAME2       TO L645-NAME2.                         
           MOVE F650-PAYABLE-NRIC1       TO L645-NRIC1.                         
           MOVE F650-PAYABLE-NRIC2       TO L645-NRIC2.                         
                                                                                
           MOVE WS-SEQ-NO                TO L645-VOUCHER.                       
           MOVE K650-NUM-REGN            TO L645-REGNO.                         
           MOVE K650-AMT-REFUND          TO L645-AMOUNT.                        
           MOVE K650-DTE-SALES-AGREEMENT TO L645-SOCA-DATE.                     
                                                                                
           IF K650-NEW-NUM-IBG-ACCT NOT = SPACES                                
              MOVE K650-NEW-NUM-BANK        TO L645-BNK-CODE                    
              MOVE K650-NEW-NUM-IBG-ACCT    TO L645-BNK-ACCT                    
           ELSE                                                                 
              MOVE SPACES                   TO L645-BNK-CODE                    
                                               L645-BNK-ACCT                    
           END-IF.                                                              
                                                                                
           IF F650-CDE-ADDR-TYPE = 'H'                                          
              MOVE    'BLK '             TO WS-BLKHDR                           
           ELSE                                                                 
              MOVE     SPACES            TO WS-BLKHDR.                          
                                                                                
           MOVE F650-BLK                 TO WS-BLKNO.                           
           MOVE F650-STREET-NAME         TO WS-STREET.                          
                                                                                
           IF  F650-HSE-LVL  = SPACES OR LOW-VALUES OR ZEROS                    
               MOVE     SPACES           TO WS-BLKHDR                           
               MOVE     SPACES           TO  WS-HEX                             
                                             WS-DASH1                           
           ELSE                                                                 
               MOVE     '-'              TO  WS-DASH1                           
               MOVE     '#'              TO  WS-HEX.                            
                                                                                
           MOVE F650-HSE-LVL         TO WS-LEVELNO.                             
           MOVE F650-HSE-MAIN        TO WS-MAIN-LVL.                            
           MOVE F650-HSE-SUB         TO WS-SUB-LVL.                             
           IF  WS-SUB-LVL  = SPACES OR LOW-VALUES                               
               MOVE SPACES           TO WS-DASH2                                
           ELSE                                                                 
               MOVE '-'              TO WS-DASH2.                               
           MOVE F650-POSTAL-CDE      TO WS-POSTAL.                              
                                                                                
           MOVE WS-ADDR1             TO L645-ADDR1.                             
           MOVE WS-ADDR2             TO L645-ADDR2.                             
                                                                                
           COMPUTE WS-NET-AMT = WS-NET-AMT + K650-AMT-REFUND.                   
                                                                                
           WRITE BP13L645-REC FROM PRT-L645-DTL1 AFTER 1.                       
           WRITE BP13L645-REC FROM PRT-L645-DTL2 AFTER 1.                       
           WRITE BP13L645-REC FROM PRT-L645-DTL3 AFTER 1.                       
           WRITE BP13L645-REC FROM PRT-L645-DTL4 AFTER 1.                       
                                                                                
       660-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       700-WRITE-TRAILER.                                                       
      ******************************************************************        
           IF WS-SEQ-NO  = ZEROES                                               
              GO TO 700-EXIT                                                    
           END-IF.                                                              
                                                                                
           INITIALIZE AG07F235-TRAILER.                                         
           MOVE       SPACES              TO  AG07F235-TRAILER.                 
                                                                                
           MOVE       WS-NUM-VOUCHER      TO  F235-NUM-GRP-VR-R.                
           MOVE       99                  TO  F235-NUM-TRAILER-SERIAL.          
           MOVE  'REFUND OF BOOKING FEE'  TO  F235-TXT-VR-TRAILER-NRNT1.        
           MOVE  SPACES                   TO  F235-TXT-VR-TRAILER-NRNT2         
                                              F235-TXT-VR-TRAILER-NRNT3.        
           MOVE       WS-SEQ-NO           TO  F235-QTY-VR-TRANS.                
           MOVE       WS-NET-AMT          TO  F235-AMT-VR-DR-TOTAL.             
           MOVE       ZEROES              TO  F235-AMT-VR-CR-TOTAL.             
           MOVE       SPACES              TO  F235-TXT-REJECT-TRL.              
           MOVE       ZEROES              TO  F235-AMT-VR-DR-GST-TOTAL          
                                              F235-AMT-VR-CR-GST-TOTAL.         
                                                                                
           WRITE      AG07F235-TRAILER.                                         
                                                                                
           ADD        1                   TO       WS-F235-WRITE.               
           MOVE      'Y'                  TO       WS-NEW-VOUCHER.              
           PERFORM    720-PRINT-FOOTING   THRU     720-EXIT.                    
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       720-PRINT-FOOTING.                                                       
      ******************************************************************        
           MOVE    '0001'                 TO    PRT-L645-FIRST.                 
           MOVE     WS-SEQ-NO             TO    PRT-L645-LAST.                  
           MOVE     WS-NET-AMT            TO    PRT-L645-TOTAL.                 
           MOVE     WS-NET-AMT            TO    WS-AMT.                         
           PERFORM  9000-CONVT-AMT-WORD   THRU  9000-EXIT.                      
           MOVE     WP-ITEM(1)            TO    PRT-L645-DESC1.                 
           MOVE     WP-ITEM(2)            TO    PRT-L645-DESC2.                 
                                                                                
           WRITE    BP13L645-REC FROM PRT-L645-FTG1 AFTER 1.                    
           WRITE    BP13L645-REC FROM PRT-L645-FTG2 AFTER 1.                    
           WRITE    BP13L645-REC FROM PRT-L645-FTG1 AFTER 1.                    
           WRITE    BP13L645-REC FROM PRT-L645-FTG3 AFTER 1.                    
           WRITE    BP13L645-REC FROM PRT-L645-FTG4 AFTER 4.                    
                                                                                
           MOVE     ZEROES         TO WS-NET-AMT WS-SEQ-NO.                     
                                                                                
       720-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       800-DISPLAY-TOTALS.                                                      
      ******************************************************************        
           DISPLAY  '                                           '.              
           DISPLAY  '*****     BP13C645 CONTROL LISTING    *****'.              
           DISPLAY  '                                           '.              
           DISPLAY  'NO OF RECORDS READ  FROM BP13F650 = ' WS-F650-READ         
           DISPLAY  'NO OF RECORDS READ  FROM BP13K330 = ' WS-K330-READ         
           DISPLAY  'NO OF RECORDS READ  FROM BP13K800 = ' WS-K800-READ         
           DISPLAY  '                                           '.              
           DISPLAY  'NO OF RECORDS WRITTEN TO AG07F235 = ' WS-F235-WRITE        
           DISPLAY  '                                           '.              
           DISPLAY  'CNT 1 = ' WS-CNT1                                          
           DISPLAY  'CNT 2 = ' WS-CNT2                                          
           DISPLAY  'CNT 3 = ' WS-CNT3                                          
           DISPLAY  '                                           '.              
           DISPLAY  'NO OF RECORDS IN K800 WITH ZERO SOC-DEBTOR '               
                    WS-K800-ZERO-DEBTOR.                                        
           DISPLAY  '                                           '.              
           DISPLAY  'NO OF RECORDS PROCESSED & PRINTED = '                      
                     WS-F650-PROCESS.                                           
           DISPLAY  'NO OF RECORDS PASSED FOR PRINTING OF '                     
                    'REFUND LETTERS = '                   WS-F651-WRITE.        
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       900-CLOSE-ROUTINE.                                                       
      ******************************************************************        
           CLOSE BP13F650                                                       
                 BP13F651                                                       
                 AG07F235                                                       
                 BP13K330                                                       
                 BP13K650                                                       
                 BP13K800                                                       
                 SY08K010                                                       
                 BP13L645.                                                      
                                                                                
           IF WS-K330-STATUS NOT = 00                                           
              DISPLAY 'ERROR CLOSING BP13K330, STATUS = ' WS-K330-STATUS        
              MOVE     WS-K330-STATUS    TO    RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K010-STATUS NOT = 00                                           
              DISPLAY 'ERROR CLOSING BP13K010, STATUS = ' WS-K010-STATUS        
              MOVE     WS-K010-STATUS    TO    RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K650-STATUS NOT = 00                                           
              DISPLAY 'ERROR CLOSING BP13K650, STATUS = ' WS-K650-STATUS        
              MOVE     WS-K650-STATUS    TO    RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00                                           
              DISPLAY 'ERROR CLOSING BP13K800, STATUS = ' WS-K800-STATUS        
              MOVE     WS-K800-STATUS    TO    RETURN-CODE                      
           END-IF.                                                              
                                                                                
           MOVE 'AG07K962'  TO     C908-NUM-FILENAME.                           
           CALL 'K962CLSE'  USING  AG07C908-AREA.                               
                                                                                
           IF C908-NUM-FILE-STATUS NOT = ('00' AND '97')                        
              DISPLAY 'ERROR CLOSING AG07K962, STATUS = '                       
                       C908-NUM-FILE-STATUS                                     
              MOVE     C908-NUM-FILE-STATUS TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           STOP  RUN.                                                           
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
                                                                                
      ******************************************************************        
       9000-CONVT-AMT-WORD.                                                     
      ******************************************************************        
      *----------------------------------------------------------*              
      *     OBJECTIVE  :  CONVERSION FROM AMOUNT IN DIGITS       *              
      *                              INTO AMOUNT IN WORDS        *              
      *----------------------------------------------------------*              
            MOVE SPACES TO WF-DETAILS.                                          
            MOVE ZEROES TO WS-SWITCH                                            
                           WS-THO-SW                                            
                           WS-CNT-SW                                            
                           WS-LIT-SW                                            
                           WS-TEN-SW                                            
                           WS-AND-SW.                                           
            MOVE 60     TO WS-PLACE-COUNTER.                                    
            MOVE 1      TO WF-SUB.                                              
                                                                                
            PERFORM B000-ROUTINE THRU B990-EXIT                                 
                    VARYING WS-SUB FROM 1 BY 1 UNTIL WS-SUB = 10.               
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       B000-ROUTINE SECTION.                                                    
      ******************************************************************        
                                                                                
       B000-GO.                                                                 
            IF WS-DIGIT (WS-SUB) = ZERO                                         
               IF WS-TEN-SW = ZERO                                              
                  GO TO B800-MOVE-TYPE                                          
               ELSE                                                             
                  GO TO B010-PROCESS.                                           
                                                                                
            IF WS-FIRST-SUB = ZERO                                              
               MOVE WS-SUB TO WS-FIRST-SUB.                                     
                                                                                
            IF WS-SWITCH =  ZERO                                                
               MOVE 1 TO WS-SWITCH.                                             
                                                                                
       B010-PROCESS.                                                            
            IF WS-SUB = 8                                                       
               MOVE 9 TO WS-CNT-SW.                                             
                                                                                
            IF WS-SUB = 9                                                       
               IF WS-CNT-SW = ZERO                                              
                  MOVE WS-DIGIT (WS-SUB) TO WS-CNT-SW.                          
                                                                                
            IF WS-SUB = 2 OR 3 OR 4                                             
               MOVE 1 TO WS-THO-SW.                                             
                                                                                
            MOVE WS-DIGIT (WS-SUB) TO WA-SUB.                                   
            IF WS-SUB = 3 OR 6 OR 8                                             
               IF WS-DIGIT (WS-SUB) = 1                                         
                  MOVE 1 TO WS-TEN-SW                                           
                  GO TO B990-EXIT                                               
               ELSE                                                             
                  ADD 18 TO WA-SUB                                              
            ELSE                                                                
            IF WS-SUB = 1 OR 4 OR 7 OR 9                                        
               IF WS-TEN-SW = 1                                                 
                  MOVE 0 TO WS-TEN-SW                                           
                  ADD 10 TO WA-SUB.                                             
                                                                                
            MOVE    WA-NAME (WA-SUB) TO WL-AREA.                                
            PERFORM R000-LOAD-IN.                                               
                                                                                
       B300-TENS.                                                               
            IF WS-SUB = 3 OR 6 OR 8                                             
               GO TO B990-EXIT.                                                 
                                                                                
       B400-MOVE-HUNDRED.                                                       
            IF WS-SUB = 2 OR 5                                                  
               MOVE     L-HUNDRED TO WL-AREA                                    
               MOVE     1         TO WS-LIT-SW                                  
               PERFORM  R000-LOAD-IN                                            
               MOVE     1         TO WS-AND-SW                                  
               GO TO    B990-EXIT.                                              
                                                                                
       B800-MOVE-TYPE.                                                          
           IF WS-SWITCH = ZERO                                                  
              GO TO B990-EXIT.                                                  
                                                                                
           IF WS-SUB = 1                                                        
              MOVE L-MILLION  TO WL-AREA                                        
              MOVE 1          TO WS-LIT-SW                                      
              MOVE 1          TO WS-AND-SW                                      
              GO TO B880-LOAD-IN.                                               
                                                                                
           IF WS-SUB =  7                                                       
              MOVE 1 TO WS-LIT-SW WS-AND-SW                                     
              IF WS-FIRST-SUB = 7 AND                                           
                 WS-DIGIT (WS-SUB) = 1                                          
                 MOVE L-DOLLAR TO WL-AREA                                       
                 GO TO B880-LOAD-IN                                             
              ELSE                                                              
                 MOVE L-DOLLARS TO WL-AREA                                      
                 GO TO B880-LOAD-IN.                                            
                                                                                
           IF WS-SUB = 4 AND WS-THO-SW = 1                                      
              MOVE 1 TO WS-AND-SW WS-LIT-SW                                     
              MOVE L-THOUSAND TO WL-AREA                                        
              GO TO B880-LOAD-IN.                                               
                                                                                
           IF WS-SUB = 9                                                        
              MOVE 1 TO WS-LIT-SW                                               
              IF WS-CNT-SW = ZERO                                               
                 MOVE L-ONLY TO WL-AREA                                         
                 GO TO B880-LOAD-IN                                             
              ELSE                                                              
              IF WS-CNT-SW = 1                                                  
                 MOVE L-CENT  TO WL-AREA                                        
                 PERFORM R000-LOAD-IN                                           
                 MOVE L-ONLY  TO WL-AREA                                        
                 GO TO B880-LOAD-IN                                             
              ELSE                                                              
                 MOVE L-CENTS TO WL-AREA                                        
                 PERFORM R000-LOAD-IN                                           
                 MOVE L-ONLY  TO WL-AREA                                        
                 GO TO B880-LOAD-IN.                                            
                                                                                
            GO TO B990-EXIT.                                                    
                                                                                
       B880-LOAD-IN.                                                            
            PERFORM R000-LOAD-IN.                                               
                                                                                
       B990-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       R000-LOAD-IN SECTION.                                                    
      ******************************************************************        
      *----------------------------------------------------------*              
      *     THIS SECTION LOADS THE WORDS INTO THE THREE LINES    *              
      *     AND JUST KEEPS INCREMENTING A SUBSCRIPT.             *              
      *----------------------------------------------------------*              
                                                                                
       R001-GO.                                                                 
            IF WS-LIT-SW =  1                                                   
               MOVE ZERO TO WS-LIT-SW                                           
               GO TO R050-CONT.                                                 
                                                                                
            IF WS-SUB = 2 OR 5                                                  
               GO TO R050-CONT.                                                 
                                                                                
       R025-ADD-TEST.                                                           
            IF WS-AND-SW NOT = 1                                                
               GO TO R050-CONT.                                                 
                                                                                
            MOVE    ZERO          TO  WS-AND-SW.                                
            MOVE    WL-AREA       TO  WL-AREA-SAVE.                             
            MOVE    L-AND         TO  WL-AREA.                                  
            PERFORM R200-LOADUP.                                                
            MOVE    WL-AREA-SAVE  TO  WL-AREA.                                  
                                                                                
       R050-CONT.                                                               
            PERFORM R200-LOADUP.                                                
                                                                                
       R099-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       R200-LOADUP SECTION.                                                     
      ******************************************************************        
                                                                                
       R201-GO.                                                                 
            ADD WL-ITEM1 WF-SUB GIVING WS-RESULT.                               
                                                                                
            IF WS-RESULT > WS-PLACE-COUNTER                                     
               ADD 1  WS-PLACE-COUNTER GIVING WF-SUB                            
               ADD 60 TO WS-PLACE-COUNTER.                                      
                                                                                
            PERFORM R500-LOAD VARYING WL-SUB FROM 2 BY 1                        
                    UNTIL WL-ITEM (WL-SUB) = L-X.                               
                                                                                
       R490-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       R500-LOAD SECTION.                                                       
      ******************************************************************        
                                                                                
       R501-GO.                                                                 
            MOVE WL-ITEM (WL-SUB)  TO    WF-ITEM (WF-SUB).                      
            ADD  1                 TO    WF-SUB.                                
            IF WL-ITEM (WL-SUB)    =     SPACE                                  
               ADD      1          TO    WL-SUB                                 
               MOVE     L-X        TO    WL-ITEM (WL-SUB)                       
               SUBTRACT 1          FROM  WL-SUB.                                
                                                                                
       R990-EXIT.                                                               
            EXIT.                                                               
                                                                                
