      *===============================================================*         
       IDENTIFICATION DIVISION.                                                 
      *===============================================================*         
       PROGRAM-ID.    BP13CE15.                                                 
       AUTHOR.        MRN1.                                                     
       DATE-WRITTEN.  29052015.                                                 
      *===============================================================*         
      *   OBJECTIVE:  UPDATE/CREATE BP13KD09 GRANT FIELDS             *         
      *               BASED ON GRANT_ASMNT SRG/REG/AHG/SHG/SUG        *         
      *===============================================================*         
      *                                                               *         
      *     INPUT:                                                    *         
      *                  1. GRANT_ASMNT                               *         
      *                  2. BP13K800                                  *         
      *                  3. BP13K893                                  *         
      *                  4. BM06K110                                  *         
      *                  5. BP13FD09                                  *         
      *                                                               *         
      *     OUTPUT:                                                   *         
      *                  1. BP13KD09                                  *         
      *                                                               *         
      *===============================================================*         
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              *         
      * -------- ---------- ---- -----------------------              *         
      * BP135620 29/25/2015 MRN1 NEW PROGRAM.                         *         
      * BP136028 26/11/2015 MRN1 CATER FOR REG                        *         
      * BP136417 09/09/2016 MRN1 CATER FOR AHG, SHG, SUG, HGT         *         
      * BP136468 18/10/2016 MRN1 ADD OUTPUT TO FD09 FOR THOSE UPDATED *         
      *                          UPDATE DTE PAYMENT FOR AHG AND SHG   *         
      * BP136884 19/02/2018 MRN1 CATER FOR FSG                        *         
      *===============================================================*         
                                                                                
                                                                                
      **********************                                                    
       ENVIRONMENT DIVISION.                                                    
      **********************                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13KD09   ASSIGN        TO BP13KD09                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS KD09-KEY-FLD                      
                             FILE STATUS   IS WS-KD09-STATUS.                   
                                                                                
           SELECT BP13K800   ASSIGN        TO BP13K800                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K800-NUM-REGN                     
                             FILE STATUS   IS WS-K800-STATUS.                   
                                                                                
           SELECT BP13K893   ASSIGN        TO BP13K893                          
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K893-KEY-FLD                      
                             FILE STATUS   IS WS-K893-STATUS.                   
                                                                                
           SELECT BM06K110   ASSIGN        TO BM06K110                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K110-KEY-FLD                      
                             FILE STATUS   IS WS-K110-STATUS.                   
                                                                                
           SELECT BP13FD09   ASSIGN        TO BP13FD09.                         
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   BP13KD09                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13KD09.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K893                                                            
            RECORD CONTAINS 2050 CHARACTERS.                                    
       COPY BP13K893.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BP13FD09                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13FD09.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
      *****************************************************************         
      *                   WORKING-STORAGE AREA                                  
      *****************************************************************         
                                                                                
       01  WS-SQLCODE                       PIC S9(4) COMP.                     
                                                                                
       01  FILE-VARIABLES.                                                      
           05  WS-KD09-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K800-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K893-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K110-STATUS          PIC 9(02) VALUE ZEROES.                  
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-K800-FND             PIC 9(7)  VALUE ZEROES.                  
           05  WS-K800-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K893-FND             PIC 9(7)  VALUE ZEROES.                  
           05  WS-K893-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K893-SCHACCT-BLANK   PIC 9(7)  VALUE ZEROES.                  
           05  WS-K893-EOF             PIC X(1)  VALUE 'N'.                     
           05  WS-KD09-FND             PIC 9(7)  VALUE ZEROES.                  
           05  WS-KD09-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-KD09-UPD             PIC 9(7)  VALUE ZEROES.                  
           05  WS-KD09-WRITE           PIC 9(7)  VALUE ZEROES.                  
           05  WS-KD09-DUP             PIC 9(7)  VALUE ZEROES.                  
           05  WS-K110-FND             PIC 9(7)  VALUE ZEROES.                  
           05  WS-K110-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K110-SOLD            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K110-ZERO-KI         PIC 9(7)  VALUE ZEROES.                  
           05  WS-FETCH                PIC 9(7)  VALUE ZEROES.                  
           05  WS-FD09-WRITE           PIC 9(7)  VALUE ZEROES.                  
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-SYSTEM-DATE-TIME.                                              
              10 WS-SYSTEM-DATE        PIC X(08) VALUE ZEROES.                  
              10 WS-SYSTEM-TIME        PIC X(08) VALUE ZEROES.                  
           05 WS-KD09-FOUND-TAG         PIC X(1) VALUE SPACES.                  
           05 WS-K800-FOUND-TAG         PIC X(1) VALUE SPACES.                  
           05 WS-K893-FOUND-TAG         PIC X(1) VALUE SPACES.                  
           05 WS-DATE                   PIC X(08) VALUE SPACES.                 
           05 WS-DTE-KEY-ISSUED         PIC X(08) VALUE SPACES.                 
           05 WS-CURSOR-EOF             PIC X VALUE 'N'.                        
           05 WS-SQL-CODE               PIC 9(4).                               
           05 WS-SQL-CODE-X REDEFINES WS-SQL-CODE PIC X(4).                     
           05 WS-SRG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-SRG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-REG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-REG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-AHG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-AHG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-SHG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-SHG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-SUG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-SUG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-FSG-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-FSG-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-HGT-AMT-GRANT-TOTAL    PIC 9(06)V99.                           
           05 WS-HGT-AMT-RCVRY-TOTAL    PIC 9(06)V99.                           
           05 WS-PREV-REGN              PIC X(8) VALUE SPACES.                  
                                                                                
           EXEC SQL INCLUDE P13VGASM END-EXEC.                                  
           EXEC SQL INCLUDE SQLCA    END-EXEC.                                  
                                                                                
       01  WS-SQL-FOUND                     PIC S9(4) COMP VALUE +000.          
       01  WS-SQL-NOT-FOUND                 PIC S9(4) COMP VALUE +100.          
                                                                                
       COPY P13COM4A.                                                           
                                                                                
      *****************************************************************         
      *                   P R O G R A M     B O D Y                             
      *****************************************************************         
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
           EXEC SQL WHENEVER NOT FOUND                                          
                             CONTINUE END-EXEC.                                 
           EXEC SQL WHENEVER SQLERROR                                           
                             GO TO 9000-ABORT-PROCESS END-EXEC.                 
           EXEC SQL WHENEVER SQLWARNING                                         
                             GO TO 9000-ABORT-PROCESS END-EXEC.                 
                                                                                
      ******************************************************************        
       0000-MAIN.                                                               
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-ROUTINE    THRU 1000-EXIT.                         
           PERFORM 1100-OPEN-CURSOR     THRU 1100-EXIT.                         
           PERFORM 1200-FETCH-CURSOR    THRU 1200-EXIT                          
                   UNTIL (SQLCODE = WS-SQL-NOT-FOUND)                           
                      OR (WS-CURSOR-EOF) = 'Y'.                                 
           PERFORM 1300-CLOSE-CURSOR    THRU 1300-EXIT.                         
           PERFORM 9999-CLOSE-ROUTINE   THRU 9999-EXIT.                         
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           OPEN INPUT  BP13K800                                                 
                       BP13K893                                                 
                       BM06K110                                                 
                 I-O   BP13KD09                                                 
                OUTPUT BP13FD09.                                                
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR OPENING : ' WS-K800-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K893-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K893 - ERROR OPENING : ' WS-K893-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KD09-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD09 - ERROR OPENING : ' WS-KD09-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K110-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                               
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       1100-OPEN-CURSOR.                                                        
      *================================================================*        
           MOVE 'N' TO WS-CURSOR-EOF.                                           
           INITIALIZE SQLCODE.                                                  
                                                                                
      *-------------------------------------*                                   
      *  DECLARE CURSOR - GRANT ASSESSMENT  *                                   
      *-------------------------------------*                                   
           EXEC SQL                                                             
             DECLARE CURSOR1 CURSOR FOR                                         
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      NUM_ELGBL_GRANT,                                          
                      NUM_GRANT_AMOUNT_ELGBL,                                   
                      NUM_GRANT_STATUS,                                         
                      DTE_APRV,                                                 
                      DTE_CANCEL,                                               
                      DTE_REJECT,                                               
                      DTE_SUBMIT,                                               
                      DTE_WTHDRW,                                               
                      NUM_RJCTN_REASON,                                         
                      NUM_WTDRWL_REASON,                                        
                      TXT_CNCLTN_REASON,                                        
                      DTE_GRANT_RQST,                                           
                      NUM_GRANT_DOC_RCV,                                        
                      DTE_ACK,                                                  
                      DTE_GRANT_FORM_ISSUE,                                     
                      DTE_GRANT_OPT_OUT_FORM_ISSUE,                             
                      NUM_GRANT_OPT_OUT_REASON,                                 
                      DTE_GRANT_OPT_OUT_REASON,                                 
                      NUM_ALCTN_SCHEME,                                         
                      NUM_HSHLD_CTZNSP,                                         
                      NUM_WRKNG_CHILD_ASMNT,                                    
                      QTY_MONTH_WORK,                                           
                      NUM_APPEAL_ATCHMT,                                        
                      NUM_PARENT_ADRS_BLDNG,                                    
                      NUM_PARENT_ADRS_LEVEL,                                    
                      NUM_PARENT_ADRS_UNIT,                                     
                      TXT_PARENT_ADRS1,                                         
                      TXT_PARENT_ADRS2,                                         
                      NUM_PARENT_ADRS_POSTAL,                                   
                      DTE_PYMNT,                                                
                      DTE_CPF_ACK_GRANT_RCV,                                    
                      NUM_GRANT_CREDIT,                                         
                      TME_APNTMT,                                               
                      DTE_APNTMT,                                               
                      TME_CREATE_ASMNT,                                         
                      NUM_UPDATE_USERID,                                        
                      TME_UPDATE,                                               
                      DTE_UPDATE,                                               
                      NUM_SOURCE_SYSTEM,                                        
                      NUM_ACNT,                                                 
                      NUM_SCHEME,                                               
                      NUM_TNCY,                                                 
                      NUM_HALF_GRANT                                            
               FROM                                                             
                 GRANT_ASMNT                                                    
               WHERE                                                            
                 (NUM_GRANT_TYPE = 'SRG   '  OR                                 
                  NUM_GRANT_TYPE = 'REG   '  OR                                 
                  NUM_GRANT_TYPE = 'AHG   '  OR                                 
                  NUM_GRANT_TYPE = 'SHG   '  OR                                 
                  NUM_GRANT_TYPE = 'SUG   '  OR                                 
                  NUM_GRANT_TYPE = 'FSG   '  OR                                 
                  NUM_GRANT_TYPE = 'HGT   ') AND                                
                  DTE_PYMNT NOT IN ('0001-01-01')                               
               ORDER BY                                                         
                 NUM_RGSTRN,                                                    
                 NUM_GRANT_TYPE                                                 
           END-EXEC.                                                            
                                                                                
      *----------------------------------*                                      
      *  OPEN CURSOR - GRANT ASSESSMENT  *                                      
      *----------------------------------*                                      
           EXEC SQL                                                             
             OPEN CURSOR1                                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 0                                                               
             CONTINUE                                                           
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQL-CODE                             
             DISPLAY 'OPEN CURSOR ERROR - ' WS-SQL-CODE                         
             GO TO 9000-ABORT-PROCESS                                           
           END-EVALUATE.                                                        
                                                                                
       1100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *================================================================*        
       1200-FETCH-CURSOR.                                                       
      *================================================================*        
                                                                                
           EXEC SQL                                                             
             FETCH CURSOR1                                                      
               INTO                                                             
                 :NUM-RGSTRN,                                                   
                 :NUM-GRANT-TYPE,                                               
                 :NUM-ELGBL-GRANT,                                              
                 :NUM-GRANT-AMOUNT-ELGBL,                                       
                 :NUM-GRANT-STATUS,                                             
                 :DTE-APRV,                                                     
                 :DTE-CANCEL,                                                   
                 :DTE-REJECT,                                                   
                 :DTE-SUBMIT,                                                   
                 :DTE-WTHDRW,                                                   
                 :NUM-RJCTN-REASON,                                             
                 :NUM-WTDRWL-REASON,                                            
                 :TXT-CNCLTN-REASON,                                            
                 :DTE-GRANT-RQST,                                               
                 :NUM-GRANT-DOC-RCV,                                            
                 :DTE-ACK,                                                      
                 :DTE-GRANT-FORM-ISSUE,                                         
                 :DTE-GRANT-OPT-OUT-FORM-ISSUE,                                 
                 :NUM-GRANT-OPT-OUT-REASON,                                     
                 :DTE-GRANT-OPT-OUT-REASON,                                     
                 :NUM-ALCTN-SCHEME,                                             
                 :NUM-HSHLD-CTZNSP,                                             
                 :NUM-WRKNG-CHILD-ASMNT,                                        
                 :QTY-MONTH-WORK,                                               
                 :NUM-APPEAL-ATCHMT,                                            
                 :NUM-PARENT-ADRS-BLDNG,                                        
                 :NUM-PARENT-ADRS-LEVEL,                                        
                 :NUM-PARENT-ADRS-UNIT,                                         
                 :TXT-PARENT-ADRS1,                                             
                 :TXT-PARENT-ADRS2,                                             
                 :NUM-PARENT-ADRS-POSTAL,                                       
                 :DTE-PYMNT,                                                    
                 :DTE-CPF-ACK-GRANT-RCV,                                        
                 :NUM-GRANT-CREDIT,                                             
                 :TME-APNTMT,                                                   
                 :DTE-APNTMT,                                                   
                 :TME-CREATE-ASMNT,                                             
                 :NUM-UPDATE-USERID,                                            
                 :TME-UPDATE,                                                   
                 :DTE-UPDATE,                                                   
                 :NUM-SOURCE-SYSTEM,                                            
                 :NUM-ACNT,                                                     
                 :NUM-SCHEME,                                                   
                 :NUM-TNCY,                                                     
                 :NUM-HALF-GRANT                                                
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-FOUND                                                    
             ADD 1 TO WS-FETCH                                                  
             PERFORM 3000-PROCESS-RECORDS THRU 3000-EXIT                        
           WHEN WS-SQL-NOT-FOUND                                                
             MOVE 'Y'                  TO WS-CURSOR-EOF                         
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQL-CODE                             
             DISPLAY 'FETCH CURSOR ERROR - ' WS-SQL-CODE                        
             GO TO 9000-ABORT-PROCESS                                           
           END-EVALUATE.                                                        
                                                                                
       1200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       1300-CLOSE-CURSOR.                                                       
      *---------------------------------------------------------------*         
           INITIALIZE SQLCODE.                                                  
                                                                                
      *-----------------------------------*                                     
      * CLOSE CURSOR - GRANT ASSESSMENT   *                                     
      *-----------------------------------*                                     
           EXEC SQL CLOSE CURSOR1                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN 0                                                            
                   CONTINUE                                                     
              WHEN OTHER                                                        
                MOVE SQLCODE TO WS-SQL-CODE                                     
                DISPLAY 'CLOSE CURSOR ERROR - ' WS-SQL-CODE                     
                GO TO 9000-ABORT-PROCESS                                        
           END-EVALUATE.                                                        
                                                                                
       1300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           MOVE SPACES                    TO BP13KD09-REC                       
                                             BP13K800-MASTER                    
                                             BP13K893-MASTER.                   
           INITIALIZE                        BP13KD09-REC                       
                                             BP13K800-MASTER                    
                                             BP13K893-MASTER.                   
           MOVE SPACES                    TO WS-DTE-KEY-ISSUED.                 
           MOVE ZEROES                    TO WS-SRG-AMT-GRANT-TOTAL             
                                             WS-SRG-AMT-RCVRY-TOTAL             
                                             WS-REG-AMT-GRANT-TOTAL             
                                             WS-REG-AMT-RCVRY-TOTAL             
                                             WS-FSG-AMT-GRANT-TOTAL             
                                             WS-FSG-AMT-RCVRY-TOTAL             
                                             WS-AHG-AMT-GRANT-TOTAL             
                                             WS-AHG-AMT-RCVRY-TOTAL             
                                             WS-SHG-AMT-GRANT-TOTAL             
                                             WS-SHG-AMT-RCVRY-TOTAL             
                                             WS-SUG-AMT-GRANT-TOTAL             
                                             WS-SUG-AMT-RCVRY-TOTAL             
                                             WS-HGT-AMT-GRANT-TOTAL             
                                             WS-HGT-AMT-RCVRY-TOTAL.            
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:16)  TO WS-SYSTEM-DATE-TIME.            
           MOVE SPACES  TO WS-KD09-FOUND-TAG.                                   
           MOVE SPACES  TO WS-K800-FOUND-TAG.                                   
                                                                                
           IF NUM-GRANT-TYPE = 'SRG   '                                         
              PERFORM 3600-GET-SRG-GRANT-SUM THRU 3600-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'REG   '                                         
              PERFORM 3700-GET-REG-GRANT-SUM THRU 3700-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'AHG   '                                         
              PERFORM 3800-GET-AHG-GRANT-SUM THRU 3800-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SHG   '                                         
              PERFORM 3900-GET-SHG-GRANT-SUM THRU 3900-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SUG   '                                         
              PERFORM 4000-GET-SUG-GRANT-SUM THRU 4000-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'HGT   '                                         
              PERFORM 4100-GET-HGT-GRANT-SUM THRU 4100-EXIT                     
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'FSG   '                                         
              PERFORM 4200-GET-FSG-GRANT-SUM THRU 4200-EXIT                     
           END-IF.                                                              
                                                                                
           MOVE NUM-RGSTRN TO KD09-KEY-FLD.                                     
           PERFORM 4300-READ-BP13KD09  THRU 4300-EXIT.                          
                                                                                
           MOVE NUM-RGSTRN TO K800-NUM-REGN.                                    
           PERFORM 4500-READ-BP13K800  THRU 4500-EXIT.                          
                                                                                
           IF WS-KD09-FOUND-TAG = 'N'                                           
               IF WS-K800-FOUND-TAG = 'Y'                                       
                  MOVE SPACES                    TO BP13KD09-REC                
                  INITIALIZE                        BP13KD09-REC                
                  MOVE NUM-RGSTRN                TO KD09-KEY-FLD                
                  PERFORM 4550-MOVE-K800-TO-KD09 THRU 4550-EXIT                 
                  PERFORM 4800-WRITE-BP13KD09    THRU 4800-EXIT                 
               ELSE                                                             
                  PERFORM 5000-STARTBR-K893        THRU 5000-EXIT               
               END-IF                                                           
           ELSE                                                                 
               IF WS-K800-FOUND-TAG = 'Y'                                       
                  PERFORM 4550-MOVE-K800-TO-KD09 THRU 4550-EXIT                 
                  PERFORM 4700-REWRITE-BP13KD09  THRU 4700-EXIT                 
               ELSE                                                             
                  PERFORM 5000-STARTBR-K893        THRU 5000-EXIT               
               END-IF                                                           
           END-IF.                                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3600-GET-SRG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'SRG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SRG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-SRG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SRG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-SRG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-SRG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-SRG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3700-GET-REG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'REG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-REG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-REG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-REG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-REG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-REG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-REG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
       3700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3800-GET-AHG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'AHG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-AHG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-AHG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-AHG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-AHG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-AHG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-AHG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3900-GET-SHG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'SHG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SHG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-SHG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SHG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-SHG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-SHG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-SHG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4000-GET-SUG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'SUG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SUG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-SUG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-SUG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-SUG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-SUG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-SUG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4100-GET-HGT-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'HGT   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-HGT-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-HGT-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-HGT-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-HGT-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-HGT-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-HGT-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4200-GET-FSG-GRANT-SUM.                                                  
      ******************************************************************        
           INITIALIZE BP13COM4A-REC.                                            
                                                                                
           MOVE 'R'                  TO  COM4A-NUM-CALL-ACTION.                 
           MOVE NUM-RGSTRN           TO  COM4A-NUM-RGSTRN-INPUT.                
           MOVE 'FSG   '             TO  COM4A-NUM-GRANT-TYPE-INPUT.            
                                                                                
           CALL 'BP13CR4A' USING BP13COM4A-REC.                                 
                                                                                
           IF COM4A-CDE-SYSERR = WS-SQL-FOUND                                   
              IF COM4A-AMT-GRANT-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-FSG-AMT-GRANT-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-GRANT-TOTAL TO WS-FSG-AMT-GRANT-TOTAL           
              END-IF                                                            
              IF COM4A-AMT-RCVRY-TOTAL IS NOT NUMERIC                           
                 MOVE ZEROES                TO WS-FSG-AMT-RCVRY-TOTAL           
              ELSE                                                              
                 MOVE COM4A-AMT-RCVRY-TOTAL TO WS-FSG-AMT-RCVRY-TOTAL           
              END-IF                                                            
           ELSE                                                                 
              IF COM4A-CDE-SYSERR = WS-SQL-NOT-FOUND                            
                 MOVE ZEROES             TO WS-FSG-AMT-GRANT-TOTAL              
                 MOVE ZEROES             TO WS-FSG-AMT-RCVRY-TOTAL              
              ELSE                                                              
                 DISPLAY 'ERROR IN BP13CR4A'                                    
                 DISPLAY 'SQLCODE :- ' COM4A-CDE-SYSERR                         
                 MOVE 99 TO RETURN-CODE                                         
                 PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                    
              END-IF                                                            
           END-IF.                                                              
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4300-READ-BP13KD09.                                                      
      ******************************************************************        
                                                                                
           READ BP13KD09.                                                       
                                                                                
           EVALUATE WS-KD09-STATUS                                              
               WHEN 00                                                          
                    MOVE 'Y' TO WS-KD09-FOUND-TAG                               
                    ADD 1                             TO WS-KD09-FND            
               WHEN 23                                                          
                    MOVE 'N' TO WS-KD09-FOUND-TAG                               
                    ADD 1                             TO WS-KD09-NFND           
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13KD09 : ' WS-KD09-STATUS          
                            ' REGN = ' KD09-KEY-FLD                             
                    PERFORM  9999-CLOSE-ROUTINE     THRU 9999-EXIT              
           END-EVALUATE.                                                        
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4500-READ-BP13K800.                                                      
      ******************************************************************        
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-K800-STATUS                                              
               WHEN 00                                                          
                    MOVE 'Y' TO WS-K800-FOUND-TAG                               
                    ADD 1                TO WS-K800-FND                         
               WHEN 23                                                          
                    MOVE 'N' TO WS-K800-FOUND-TAG                               
                    ADD 1                TO WS-K800-NFND                        
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K800 : ' WS-K800-STATUS          
                            ' REGN = ' K800-NUM-REGN                            
                    PERFORM  9999-CLOSE-ROUTINE     THRU 9999-EXIT              
           END-EVALUATE.                                                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4550-MOVE-K800-TO-KD09.                                                  
      ******************************************************************        
                                                                                
           IF NUM-GRANT-TYPE = 'AHG'                                            
              STRING DTE-PYMNT(1:4)                                             
                     DTE-PYMNT(6:2)                                             
                     DTE-PYMNT(9:2)                                             
                     DELIMITED BY SIZE INTO KD09-DTE-AHG-PAYMENT                
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SHG'                                            
              STRING DTE-PYMNT(1:4)                                             
                     DTE-PYMNT(6:2)                                             
                     DTE-PYMNT(9:2)                                             
                     DELIMITED BY SIZE INTO KD09-DTE-SHG-PAYMENT                
           END-IF.                                                              
                                                                                
           IF K800-NUM-SCH-ACC = SPACES OR LOW-VALUES                           
              STRING '#' NUM-RGSTRN                                             
                        DELIMITED BY SIZE INTO KD09-NUM-SCH-ACCNT               
           ELSE                                                                 
              MOVE K800-NUM-SCH-ACC          TO KD09-NUM-SCH-ACCNT              
           END-IF.                                                              
                                                                                
           MOVE 'BP13CE15'                TO KD09-NUM-USERID.                   
           MOVE WS-SYSTEM-DATE            TO KD09-DTE-BKIMAGE.                  
           MOVE WS-SYSTEM-TIME            TO KD09-TME-BKIMAGE.                  
                                                                                
           IF NUM-GRANT-TYPE = 'SRG   '                                         
              MOVE WS-SRG-AMT-GRANT-TOTAL TO KD09-AMT-SRG-GRANT                 
              MOVE WS-SRG-AMT-RCVRY-TOTAL TO KD09-AMT-SRG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'REG   '                                         
              MOVE WS-REG-AMT-GRANT-TOTAL TO KD09-AMT-REG-GRANT                 
              MOVE WS-REG-AMT-RCVRY-TOTAL TO KD09-AMT-REG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'FSG   '                                         
              MOVE WS-FSG-AMT-GRANT-TOTAL TO KD09-AMT-FSG-GRANT                 
              MOVE WS-FSG-AMT-RCVRY-TOTAL TO KD09-AMT-FSG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'AHG   '                                         
              IF KD09-AMT-AHG-GRANT < WS-AHG-AMT-GRANT-TOTAL                    
                 MOVE WS-AHG-AMT-GRANT-TOTAL TO KD09-AMT-AHG-GRANT              
              END-IF                                                            
              IF KD09-AMT-AHG-RECOVER < WS-AHG-AMT-RCVRY-TOTAL                  
                 MOVE WS-AHG-AMT-RCVRY-TOTAL TO KD09-AMT-AHG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SHG   '                                         
              IF KD09-AMT-SHG-GRANT < WS-SHG-AMT-GRANT-TOTAL                    
                 MOVE WS-SHG-AMT-GRANT-TOTAL TO KD09-AMT-SHG-GRANT              
              END-IF                                                            
              IF KD09-AMT-SHG-RECOVER < WS-SHG-AMT-RCVRY-TOTAL                  
                 MOVE WS-SHG-AMT-RCVRY-TOTAL TO KD09-AMT-SHG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SUG   '                                         
              IF KD09-AMT-SUG-GRANT < WS-SUG-AMT-GRANT-TOTAL                    
                 MOVE WS-SUG-AMT-GRANT-TOTAL TO KD09-AMT-SUG-GRANT              
              END-IF                                                            
              IF KD09-AMT-SUG-RECOVER < WS-SUG-AMT-RCVRY-TOTAL                  
                 MOVE WS-SUG-AMT-RCVRY-TOTAL TO KD09-AMT-SUG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'HGT   '                                         
              IF KD09-AMT-HSGNT-GRANT < WS-HGT-AMT-GRANT-TOTAL                  
                 MOVE WS-HGT-AMT-GRANT-TOTAL TO KD09-AMT-HSGNT-GRANT            
              END-IF                                                            
              IF KD09-AMT-HSGNT-RECOVER < WS-HGT-AMT-RCVRY-TOTAL                
                 MOVE WS-HGT-AMT-RCVRY-TOTAL TO KD09-AMT-HSGNT-RECOVER          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4550-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4700-REWRITE-BP13KD09.                                                   
      ******************************************************************        
                                                                                
           REWRITE BP13KD09-REC.                                                
                                                                                
           EVALUATE WS-KD09-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
              ADD 1                         TO WS-KD09-UPD                      
              MOVE BP13KD09-REC TO BP13FD09-REC                                 
              MOVE WS-AHG-AMT-GRANT-TOTAL TO FD09-AMT-AHG-GRANT                 
              MOVE WS-AHG-AMT-RCVRY-TOTAL TO FD09-AMT-AHG-RECOVER               
              MOVE WS-SHG-AMT-GRANT-TOTAL TO FD09-AMT-SHG-GRANT                 
              MOVE WS-SHG-AMT-RCVRY-TOTAL TO FD09-AMT-SHG-RECOVER               
              MOVE WS-SUG-AMT-GRANT-TOTAL TO FD09-AMT-SUG-GRANT                 
              MOVE WS-SUG-AMT-RCVRY-TOTAL TO FD09-AMT-SUG-RECOVER               
              MOVE WS-HGT-AMT-GRANT-TOTAL TO FD09-AMT-HSGNT-GRANT               
              MOVE WS-HGT-AMT-RCVRY-TOTAL TO FD09-AMT-HSGNT-RECOVER             
              WRITE BP13FD09-REC                                                
              ADD 1              TO WS-FD09-WRITE                               
           WHEN 22                                                              
              ADD 1                         TO WS-KD09-DUP                      
              DISPLAY 'BP13KD09 DUPLICATE ERROR : ' WS-KD09-STATUS              
              DISPLAY 'BP13KD09 REGNO           : ' KD09-KEY-FLD                
           WHEN OTHER                                                           
              DISPLAY 'BP13KD09 REWRITE ERROR : ' WS-KD09-STATUS                
              DISPLAY 'BP13KD09 REGNO         : ' KD09-KEY-FLD                  
              MOVE WS-KD09-STATUS           TO RETURN-CODE                      
              PERFORM 9999-CLOSE-ROUTINE    THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       4800-WRITE-BP13KD09.                                                     
      ******************************************************************        
                                                                                
      *    DISPLAY 'CREATED REGN IN KD09: ' KD09-NUM-REGN                       
      *    DISPLAY 'SRG-GRANT '    KD09-AMT-SRG-GRANT                           
      *    DISPLAY 'SRG-RECVR '    KD09-AMT-SRG-RECOVER                         
      *    DISPLAY 'REG-GRANT '    KD09-AMT-REG-GRANT                           
      *    DISPLAY 'REG-RECVR '    KD09-AMT-REG-RECOVER                         
      *    DISPLAY 'FSG-GRANT '    KD09-AMT-FSG-GRANT                           
      *    DISPLAY 'FSG-RECVR '    KD09-AMT-FSG-RECOVER                         
      *    DISPLAY 'AHG-GRANT '    KD09-AMT-AHG-GRANT                           
      *    DISPLAY 'AHG-RECVR '    KD09-AMT-AHG-RECOVER                         
      *    DISPLAY 'SHG-GRANT '    KD09-AMT-SHG-GRANT                           
      *    DISPLAY 'SHG-RECVR '    KD09-AMT-SHG-RECOVER                         
      *    DISPLAY 'SUG-GRANT '    KD09-AMT-SUG-GRANT                           
      *    DISPLAY 'SUG-RECVR '    KD09-AMT-SUG-RECOVER                         
      *    DISPLAY 'HGT-GRANT '    KD09-AMT-HSGNT-GRANT                         
      *    DISPLAY 'HGT-RECVR '    KD09-AMT-HSGNT-RECOVER                       
                                                                                
           WRITE BP13KD09-REC.                                                  
                                                                                
           EVALUATE WS-KD09-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
              ADD 1                         TO WS-KD09-WRITE                    
              WRITE BP13FD09-REC FROM BP13KD09-REC                              
              ADD 1              TO WS-FD09-WRITE                               
           WHEN 22                                                              
              ADD 1                         TO WS-KD09-DUP                      
              DISPLAY 'BP13KD09 DUPLICATE ERROR : ' WS-KD09-STATUS              
              DISPLAY 'BP13KD09 REGNO           : ' KD09-KEY-FLD                
           WHEN OTHER                                                           
              DISPLAY 'BP13KD09 WRITE ERROR : ' WS-KD09-STATUS                  
                                                                                
              DISPLAY 'BP13KD09 REGNO       : ' KD09-KEY-FLD                    
              MOVE WS-KD09-STATUS           TO RETURN-CODE                      
              PERFORM 9999-CLOSE-ROUTINE    THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4800-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5000-STARTBR-K893.                                                       
      ******************************************************************        
                                                                                
           MOVE 'N'             TO  WS-K893-EOF.                                
           MOVE NUM-RGSTRN      TO  K893-NUM-REGN-HIST.                         
                                                                                
           START BP13K893 KEY >= K893-NUM-REGN-HIST.                            
           EVALUATE WS-K893-STATUS                                              
           WHEN 00                                                              
                MOVE 'N' TO WS-K893-FOUND-TAG                                   
                PERFORM 5100-READNEXT-BP13K893 THRU 5100-EXIT                   
                   UNTIL K893-NUM-REGN-HIST NOT = NUM-RGSTRN                    
                      OR WS-K893-EOF = 'Y'                                      
                IF WS-K893-FOUND-TAG = 'N'                                      
                   ADD 1 TO WS-K893-NFND                                        
                END-IF                                                          
           WHEN 23                                                              
                CONTINUE                                                        
           WHEN OTHER                                                           
                DISPLAY 'ERROR START BP13K893, STATUS  '                        
                        WS-K893-STATUS                                          
                        ',  REGN ' K893-NUM-REGN-HIST                           
                PERFORM 9999-CLOSE-ROUTINE    THRU 9999-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5100-READNEXT-BP13K893.                                                  
                                                                                
      *-------------------------------------------------------------            
                                                                                
           READ BP13K893 NEXT RECORD                                            
                AT END MOVE 'Y' TO WS-K893-EOF.                                 
                                                                                
           EVALUATE WS-K893-STATUS                                              
           WHEN 00                                                              
           WHEN 02                                                              
                IF K893-NUM-REGN-HIST = NUM-RGSTRN                              
                   MOVE 'Y' TO WS-K893-FOUND-TAG                                
                   ADD 1    TO WS-K893-FND                                      
                   IF K893-NUM-SCH-ACC = SPACES OR LOW-VALUES                   
                      ADD 1 TO WS-K893-SCHACCT-BLANK                            
                   ELSE                                                         
                      MOVE K893-NUM-SCH-ACC TO K110-KEY-FLD                     
                      PERFORM 5105-READ-BM06K110  THRU 5105-EXIT                
                   END-IF                                                       
                   IF WS-KD09-FOUND-TAG = 'N'                                   
                      MOVE SPACES                TO BP13KD09-REC                
                      INITIALIZE                    BP13KD09-REC                
                      MOVE NUM-RGSTRN            TO KD09-KEY-FLD                
                      PERFORM 5150-MOVE-K893-TO-KD09 THRU 5150-EXIT             
                      PERFORM 4800-WRITE-BP13KD09    THRU 4800-EXIT             
                   ELSE                                                         
                      PERFORM 5150-MOVE-K893-TO-KD09 THRU 5150-EXIT             
                      PERFORM 4700-REWRITE-BP13KD09  THRU 4700-EXIT             
                   END-IF                                                       
                ELSE                                                            
                   MOVE 'Y' TO WS-K893-EOF                                      
                END-IF                                                          
           WHEN 10                                                              
           WHEN 23                                                              
                MOVE 'Y' TO WS-K893-EOF                                         
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K893, STATUS  '                      
                        WS-K893-STATUS                                          
                        ',  REGN ' K893-NUM-REGN-HIST                           
                PERFORM 9999-CLOSE-ROUTINE    THRU 9999-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5105-READ-BM06K110.                                                      
      ******************************************************************        
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE WS-K110-STATUS                                              
               WHEN 00                                                          
                    ADD 1                TO WS-K110-FND                         
                    MOVE K110-DTE-KEY-ISSUED TO WS-DTE-KEY-ISSUED               
                    IF  K110-DTE-KEY-ISSUED > ZEROS                             
                        ADD 1 TO WS-K110-SOLD                                   
                    ELSE                                                        
                        ADD 1 TO WS-K110-ZERO-KI                                
                    END-IF                                                      
               WHEN 23                                                          
                    ADD 1                TO WS-K110-NFND                        
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BM06K110 : ' WS-K110-STATUS          
                            ' REGN = ' K110-KEY-FLD                             
                    PERFORM  9999-CLOSE-ROUTINE     THRU 9999-EXIT              
           END-EVALUATE.                                                        
                                                                                
       5105-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5150-MOVE-K893-TO-KD09.                                                  
      ******************************************************************        
                                                                                
           IF NUM-GRANT-TYPE = 'AHG'                                            
              STRING DTE-PYMNT(1:4)                                             
                     DTE-PYMNT(6:2)                                             
                     DTE-PYMNT(9:2)                                             
                     DELIMITED BY SIZE INTO KD09-DTE-AHG-PAYMENT                
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SHG'                                            
              STRING DTE-PYMNT(1:4)                                             
                     DTE-PYMNT(6:2)                                             
                     DTE-PYMNT(9:2)                                             
                     DELIMITED BY SIZE INTO KD09-DTE-SHG-PAYMENT                
           END-IF.                                                              
                                                                                
           IF K893-NUM-SCH-ACC = SPACES OR LOW-VALUES                           
              STRING '#' NUM-RGSTRN                                             
                        DELIMITED BY SIZE INTO KD09-NUM-SCH-ACCNT               
           ELSE                                                                 
              MOVE K893-NUM-SCH-ACC          TO KD09-NUM-SCH-ACCNT              
           END-IF.                                                              
           MOVE 'BP13CE15'           TO KD09-NUM-USERID.                        
           MOVE WS-SYSTEM-DATE            TO KD09-DTE-BKIMAGE.                  
           MOVE WS-SYSTEM-TIME            TO KD09-TME-BKIMAGE.                  
           MOVE WS-DTE-KEY-ISSUED         TO KD09-DTE-KEY-ISSUED.               
           IF NUM-GRANT-TYPE = 'SRG   '                                         
              MOVE WS-SRG-AMT-GRANT-TOTAL TO KD09-AMT-SRG-GRANT                 
              MOVE WS-SRG-AMT-RCVRY-TOTAL TO KD09-AMT-SRG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'REG   '                                         
              MOVE WS-REG-AMT-GRANT-TOTAL TO KD09-AMT-REG-GRANT                 
              MOVE WS-REG-AMT-RCVRY-TOTAL TO KD09-AMT-REG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'FSG   '                                         
              MOVE WS-FSG-AMT-GRANT-TOTAL TO KD09-AMT-FSG-GRANT                 
              MOVE WS-FSG-AMT-RCVRY-TOTAL TO KD09-AMT-FSG-RECOVER               
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'AHG   '                                         
              IF KD09-AMT-AHG-GRANT < WS-AHG-AMT-GRANT-TOTAL                    
                 MOVE WS-AHG-AMT-GRANT-TOTAL TO KD09-AMT-AHG-GRANT              
              END-IF                                                            
              IF KD09-AMT-AHG-RECOVER < WS-AHG-AMT-RCVRY-TOTAL                  
                 MOVE WS-AHG-AMT-RCVRY-TOTAL TO KD09-AMT-AHG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SHG   '                                         
              IF KD09-AMT-SHG-GRANT < WS-SHG-AMT-GRANT-TOTAL                    
                 MOVE WS-SHG-AMT-GRANT-TOTAL TO KD09-AMT-SHG-GRANT              
              END-IF                                                            
              IF KD09-AMT-SHG-RECOVER < WS-SHG-AMT-RCVRY-TOTAL                  
                 MOVE WS-SHG-AMT-RCVRY-TOTAL TO KD09-AMT-SHG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'SUG   '                                         
              IF KD09-AMT-SUG-GRANT < WS-SUG-AMT-GRANT-TOTAL                    
                 MOVE WS-SUG-AMT-GRANT-TOTAL TO KD09-AMT-SUG-GRANT              
              END-IF                                                            
              IF KD09-AMT-SUG-RECOVER < WS-SUG-AMT-RCVRY-TOTAL                  
                 MOVE WS-SUG-AMT-RCVRY-TOTAL TO KD09-AMT-SUG-RECOVER            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF NUM-GRANT-TYPE = 'HGT   '                                         
              IF KD09-AMT-HSGNT-GRANT < WS-HGT-AMT-GRANT-TOTAL                  
                 MOVE WS-HGT-AMT-GRANT-TOTAL TO KD09-AMT-HSGNT-GRANT            
              END-IF                                                            
              IF KD09-AMT-HSGNT-RECOVER < WS-HGT-AMT-RCVRY-TOTAL                
                 MOVE WS-HGT-AMT-RCVRY-TOTAL TO KD09-AMT-HSGNT-RECOVER          
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       5150-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-----------------------*                                                 
       9000-ABORT-PROCESS.                                                      
      *-----------------------*                                                 
           CALL 'DBATIAR' USING SQLCA.                                          
           MOVE SQLCODE       TO WS-SQL-CODE.                                   
           DISPLAY 'CE15 - SYSERR = ' WS-SQL-CODE.                              
           GOBACK.                                                              
                                                                                
      ******************************************************************        
       9999-CLOSE-ROUTINE.                                                      
      ******************************************************************        
                                                                                
           DISPLAY '*************** CONTROL    TOTALS ***************'.         
           DISPLAY 'PROGRAM-ID : BP13CE15'.                                     
           DISPLAY '-------------------------------------------------'.         
           DISPLAY '(01) NO OF GRANT RECORDS READ ............... : '           
                    WS-FETCH.                                                   
           DISPLAY '(02) NO OF BP13K800 RECORDS FOUND  .......... : '           
                    WS-K800-FND.                                                
           DISPLAY '(03) NO OF BP13K800 RECORDS NOT FOUND ....... : '           
                    WS-K800-NFND.                                               
           DISPLAY '(05) NO OF BP13K893 RECORDS FOUND  .......... : '           
                    WS-K893-FND.                                                
           DISPLAY '(06) NO OF BP13K893 RECORDS NOT FOUND ....... : '           
                    WS-K893-NFND.                                               
           DISPLAY '(08) NO OF BP13KD09 RECORDS FOUND  .......... : '           
                    WS-KD09-FND.                                                
           DISPLAY '(09) NO OF BP13KD09 RECORDS NOT FOUND ....... : '           
                    WS-KD09-NFND.                                               
           DISPLAY '(10) NO OF BP13KD09 RECORDS CREATED   ....... : '           
                    WS-KD09-WRITE.                                              
           DISPLAY '(11) NO OF BP13KD09 RECORDS UPDATED   ....... : '           
                    WS-KD09-UPD.                                                
           DISPLAY '(12) NO OF BP13KD09 DUPLICATES .............. : '           
                    WS-KD09-DUP.                                                
           DISPLAY '(13) NO OF FD09 RECS WRITTEN  ............... : '           
                    WS-FD09-WRITE.                                              
           DISPLAY '(14) NO OF BM06K110 RECORDS FOUND  .......... : '           
                    WS-K110-FND.                                                
           DISPLAY '(15) NO OF BP13K110 RECORDS NOT FOUND ....... : '           
                    WS-K110-NFND.                                               
           DISPLAY '(16) NO OF BM06K110 RECORDS KEY-ISSUED ...... : '           
                    WS-K110-SOLD.                                               
           DISPLAY '(17) NO OF BM06K110 NO KEY-ISSUED ........... : '           
                    WS-K110-ZERO-KI.                                            
           DISPLAY '(18) NO OF BLANK SCHACCT IN K893 ............ : '           
                    WS-K893-SCHACCT-BLANK.                                      
                                                                                
           CLOSE    BP13KD09                                                    
                    BP13K800                                                    
                    BP13K893                                                    
                    BM06K110                                                    
                    BP13FD09.                                                   
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR CLOSING : ' WS-K800-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-KD09-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD09 - ERROR CLOSING : ' WS-KD09-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K893-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K893 - ERROR CLOSING : ' WS-K893-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 - ERROR CLOSING : ' WS-K110-STATUS              
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
                                                                                
