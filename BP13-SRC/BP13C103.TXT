       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C103.                                                 
      *AUTHOR.        SOH E G.                                                  
      *DATE-WRITTEN.  05/05/89.                                                 
      * ============================================================ *          
      * SYSTEM OF COMMITMENT (BP13)                                  *          
      * ============================================================ *          
      *  OBJECTIVE        : THIS PROGRAM IS TO READ BP13.K140.KIVTRAN*          
      *                     SEQUENTIALLY, OUTPUT VALID CASES TO      *          
      *                     BP13F124 (VALIDKIV) & DELETE VALID CASES *          
      *                     FROM BP13K140-KIVTRAN.                   *          
      *                                                              *          
      *  INPUT FILES      : 1. BP13K800 (APPLICATION MASTER)         *          
      *                     2. BP13.K140.KIVTRAN                     *          
      *                     3. BP13K880 (SUB-TRANSFER FILE)          *          
      *                                                              *          
      *  OUTPUT FILES     : 1. BP13F124 (VALIDKIV)                   *          
      *                     2. BP13F140 (FOR UPDATING BALANCE FILE)  *          
      *                                                              *          
      * REF      DATE      BY    DESCRIPTIONS                        *          
      * -------  --------  ----  ------------                        *          
      * SOC-PH8B 09/07/93  KPS   UPD BP13K800 INSTEAD OF RFF AND     *          
      *                          EXPAND REGN AND NRIC NO             *          
      * SOC-PH8F 23/11/95  EG1   TO INCLUDE OPTION FOR CHECKING FOR  *          
      * BP130103 26/03/96  EG1   EX-APPLT FILE.                      *          
      * BP130289 24/04/97  SGK   SEARCH REGN NO IN BP13K880          *          
      * BP130338 02/06/97  SGK   CHECK K140-AMT-RECEIPT + K800-AMT-  *          
      *                          REGN-PAID >=0. IF NOT MOVE 'L' TO   *          
      *                          K140-CDE-ERR. REWRITE K140-CDE-ERR. *          
      * BP130418 14/07/98  SSS   YEAR 2000 CHANGES                   *          
      * BP130531 07/08/98  SSS   REPOSITION CONTROL TOTAL            *          
      * BP130418 20/08/98  NOR   YEAR 2000 CHANGES                   *          
      * BP133480 03/02/09  NOR   BYPASS DBSS RECORD                  *          
      * BP133545 26/02/09  JB8   BYPASS DBSS RECORD                  *          
      * BP133701 19/10/09  LSB   ALLOW BK UNDER TRANS-TY=16          *          
      * BP134302 25/08/11  AB9   TO BYPASS FOR AMR AND ADV PAYMENT TY*          
      * BP134408 09/10/12  AB9   TO BYPASS FOR AHG/CHG/SHG/INT       *          
      * BP137941 10/09/19  KV6   TO ALLOW CD UNDER TRANS-TY=14       *          
      * BP138754 03/06/21  ZDD   TO ALLOW CD UNDER TRANS-TY=15 OR 16 *          
      * ============================================================ *          
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                 ACCESS MODE IS RANDOM                                          
                 ORGANIZATION IS INDEXED                                        
                 RECORD KEY IS K800-NUM-REGN                                    
                 FILE STATUS IS BP13K800-STATUS.                                
                                                                                
           SELECT BP13K885 ASSIGN TO BP13K885                                   
                 ACCESS MODE IS RANDOM                                          
                 ORGANIZATION IS INDEXED                                        
                 RECORD KEY IS K885-KEY-FLD                                     
                 FILE STATUS IS BP13K885-STATUS.                                
                                                                                
           SELECT BP13K880 ASSIGN TO BP13K880                                   
                 ACCESS MODE IS RANDOM                                          
                 ORGANIZATION IS INDEXED                                        
                 RECORD KEY IS K880-KEY-FLD                                     
                 FILE STATUS IS K880-STATUS.                                    
                                                                                
           SELECT BP13K140 ASSIGN TO BP13K140                                   
                 ACCESS MODE IS SEQUENTIAL                                      
                 ORGANIZATION IS INDEXED                                        
                 RECORD KEY IS K140-KEY-FLD                                     
                 FILE STATUS IS BP13K140-STATUS.                                
                                                                                
           SELECT BP13F140 ASSIGN TO BP13F140.                                  
                                                                                
           SELECT BP13F124 ASSIGN TO BP13F124.                                  
                                                                                
           SELECT BP13L103 ASSIGN TO BP13L103.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD  BP13K800                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 2000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K885                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 400 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K885.                                                           
                                                                                
       FD  BP13K880                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 2000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K880.                                                           
                                                                                
       FD  BP13K140                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13K140.                                                           
                                                                                
       FD  BP13F140                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F.                                                 
       COPY BP13F140.                                                           
                                                                                
       FD  BP13F124                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F.                                                 
       COPY BP13F124.                                                           
                                                                                
       FD  BP13L103                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  L103-PRTREC                PIC X(132).                               
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  BP13K140-STATUS                  PIC 9(2).                           
       01  WS-K140-STATUS.                                                      
           05 WS-K140-STATUS1               PIC 9.                              
           05 WS-K140-STATUS2               PIC 9.                              
       01  BP13K800-STATUS                  PIC 9(2)    VALUE ZEROS.            
       01  K880-STATUS                      PIC 9(2)    VALUE ZEROS.            
       01  BP13K885-STATUS                  PIC 9(2)    VALUE ZEROS.            
       01  CNT-BP13K140-READ                PIC 9(5)    VALUE ZEROS.            
       01  CNT-BP13F140-WRITE               PIC 9(5)    VALUE ZEROS.            
       01  CNT-BP13K800-READ                PIC 9(5)    VALUE ZEROS.            
       01  CNT-BP13K885-READ                PIC 9(5)    VALUE ZEROS.            
       01  CNT-REGN-NO-ERR                  PIC 9(5)    VALUE ZEROS.            
       01  WS-K140-EOF                      PIC X       VALUE 'N'.              
       01  WS-PAGE-NO                       PIC 9(5)    VALUE 0.                
       01  WS-LINE-COUNT                    PIC 9(2)    VALUE 99.               
       01  WS-CASE-NO                       PIC 9(4)    VALUE 1.                
       01  WS-AMT-TOTAL-DELETE              PIC 9(6)V99 VALUE ZEROES.           
       01  WS-DIFF                          PIC S9(9)V99 VALUE ZERO.            
       01  WS-K885-FND-FL                   PIC X       VALUE 'N'.              
       01  WS-DATE                          PIC X(8)    VALUE SPACES.           
                                                                                
       01  HL-HEADER1.                                                          
           05  FILLER                  PIC X(8) VALUE 'BP13L103'.               
           05  FILLER                  PIC X(6).                                
           05  FILLER                  PIC X(8) VALUE 'HDBCAT 3'.               
           05  FILLER                  PIC X(20).                               
           05  FILLER                  PIC X(40) VALUE                          
               'S Y S T E M    O F   C O M M I T M E N T'.                      
           05  FILLER                  PIC X(13).                               
           05  FILLER                  PIC X(7) VALUE 'DATE : '.                
           05  HL-DATE                 PIC X(10).                               
           05  FILLER                  PIC X(4).                                
           05  FILLER                  PIC X(7) VALUE 'PAGE : '.                
           05  HL-PAGE                 PIC ZZZZ9.                               
           05  FILLER                  PIC X(4).                                
                                                                                
       01  HL-HEADER2.                                                          
           05  FILLER                  PIC X(35).                               
           05  FILLER                  PIC X(54) VALUE                          
               'RECORDS VALIDATED FROM KIV(UNPOSTED TRANSACTIONS) FOR '.        
           05  HL-MTH-MM               PIC XX.                                  
           05  FILLER                  PIC X(3)  VALUE ' / '.                   
           05  HL-MTH-CCYY             PIC X(4).                                
           05  FILLER                  PIC X(36).                               
                                                                                
       01  HL-HEADER3.                                                          
           05  FILLER                  PIC X(45).                               
           05  FILLER                  PIC X(11)    VALUE 'RECEIPT NO/'.        
           05  FILLER                  PIC X(12).                               
           05  FILLER                  PIC X(7)     VALUE 'DATE OF'.            
           05  FILLER                  PIC X(7).                                
           05  FILLER                  PIC X(7)     VALUE 'PAYMENT'.            
           05  FILLER                  PIC X(26).                               
           05  FILLER                  PIC X(4)     VALUE 'USER'.               
           05  FILLER                  PIC X(13)    VALUE SPACES.               
                                                                                
       01  HL-HEADER4.                                                          
           05  FILLER                  PIC X(4).                                
           05  FILLER                  PIC X(4)     VALUE 'S/NO'.               
           05  FILLER                  PIC X(7).                                
           05  FILLER                  PIC X(6)     VALUE 'REG-NO'.             
           05  FILLER                  PIC X(8).                                
           05  FILLER                  PIC X(11)    VALUE 'SCH-ACCT-NO'.        
           05  FILLER                  PIC X(7).                                
           05  FILLER                  PIC X(11)    VALUE 'DOC REF    '.        
           05  FILLER                  PIC X(8).                                
           05  FILLER                  PIC X(11)    VALUE 'TRANSACTION'.        
           05  FILLER                  PIC X(5).                                
           05  FILLER                  PIC X(7)     VALUE ' TYPE  '.            
           05  FILLER                  PIC X(8).                                
           05  FILLER                  PIC X(6)     VALUE 'AMOUNT'.             
           05  FILLER                  PIC X(12).                               
           05  FILLER                  PIC X(4)     VALUE 'ID  '.               
           05  FILLER                  PIC X(5).                                
           05  FILLER                  PIC X(3).                                
           05  FILLER                  PIC X(5)     VALUE SPACES.               
                                                                                
       01  HL-HEADER5.                                                          
           05  FILLER                  PIC X(87)    VALUE SPACES.               
           05  FILLER                  PIC X(8)     VALUE 'TOTAL : '.           
           05  WS-TOTAL-DEL            PIC $$$$,$$9.99DB.                       
                                                                                
      *---------------------------------------*                                 
      *  WORKING STORAGE FOR PRINTING DETAIL  *                                 
      *---------------------------------------*                                 
       01  WS-PRINT-DETAIL.                                                     
           05  FILLER                  PIC X(4).                                
           05  WS-SERIAL-NUM           PIC ZZZ9.                                
           05  FILLER                  PIC X(7).                                
           05  WS-ORIG-REG-NO          PIC X(8).                                
           05  FILLER                  PIC X(6).                                
           05  WS-SCH-ACCT-NO          PIC X(11).                               
           05  FILLER                  PIC X(5).                                
           05  WS-RECPT-JRNO           PIC X(14).                               
           05  FILLER                  PIC X(7).                                
           05  WS-DTE-TRANS            PIC X(10).                               
           05  FILLER                  PIC X(5).                                
           05  WS-PAYMENT-TYPE         PIC X(7).                                
           05  FILLER                  PIC X(8).                                
           05  WS-AMT-CASH             PIC $$$,$$9.99DB.                        
           05  FILLER                  PIC X(27).                               
                                                                                
           EJECT                                                                
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       000-MAIN-PROCESS.                                                        
      *-------------------------------------------------------------            
           PERFORM 100-OPEN-FILES                THRU 100-EXIT.                 
           PERFORM 200-READ-K140                 THRU 200-EXIT.                 
           PERFORM 300-PROCESS-K140-CODE-VALID   THRU 300-EXIT                  
                   UNTIL WS-K140-EOF = 'Y'.                                     
           PERFORM 900-CLOSE-ROUTINE             THRU 900-EXIT.                 
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       100-OPEN-FILES.                                                          
      *-------------------------------------------------------------            
           OPEN INPUT  BP13K800                                                 
                       BP13K885                                                 
                       BP13K880                                                 
                I-O    BP13K140                                                 
                OUTPUT BP13F124                                                 
                       BP13F140                                                 
                       BP13L103.                                                
                                                                                
           IF BP13K140-STATUS = 00  OR  97                                      
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY 'OPENING ERROR, BP13K140-STATUS' BP13K140-STATUS          
              MOVE BP13K140-STATUS      TO RETURN-CODE                          
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
           IF BP13K800-STATUS = 00  OR  97                                      
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY 'OPENING ERROR, BP13K800-STATUS' BP13K800-STATUS          
              MOVE BP13K800-STATUS      TO RETURN-CODE                          
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
           IF BP13K885-STATUS = 00  OR  97                                      
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY 'OPENING ERROR, BP13K885-STATUS' BP13K885-STATUS          
              MOVE BP13K885-STATUS      TO RETURN-CODE                          
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
           IF     K880-STATUS = 00  OR  97                                      
              NEXT SENTENCE                                                     
           ELSE                                                                 
              DISPLAY 'OPENING ERROR, BP13K880-STATUS'     K880-STATUS          
              MOVE     K880-STATUS      TO RETURN-CODE                          
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                               
           STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)                
                  DELIMITED BY SIZE INTO HL-DATE.                               
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       200-READ-K140.                                                           
      *-------------------------------------------------------------            
           READ BP13K140 AT END                                                 
                MOVE 'Y' TO WS-K140-EOF                                         
                GO TO 200-EXIT.                                                 
                                                                                
           ADD 1 TO CNT-BP13K140-READ.                                          
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *       PROCESS K140-CODE-VALID                           *               
      *       IF CDE-VALID = 'V', REC BEEN VALIDATED THRU ONLINE*               
      *       PANEL, IF CDE-VALID = 'D', KIV REC BEEN TAGGED AS *               
      *       DELETED. THE PROGRAM   HERE CHECK AGAIN IN CASE   *               
      *       DUE TO TIMING PROBLEM, THE REC SUPPOSE TO BE A    *               
      *       VALID CASE.                                       *               
      ***********************************************************               
       300-PROCESS-K140-CODE-VALID.                                             
      *-------------------------------------------------------------            
           IF K140-KEY-FLD       = SPACES OR                                    
              K140-NUM-REGN(1:1) = '5'                                          
              PERFORM 200-READ-K140       THRU 200-EXIT                         
              GO TO 300-EXIT.                                                   
                                                                                
           IF K140-CDE-PAYMENT-TYPE = 'ADV' OR 'AMR' OR 'ADP' OR 'AHG'          
                                            OR 'CHG' OR 'SHG' OR 'INT'          
              PERFORM 200-READ-K140       THRU 200-EXIT                         
              GO TO 300-EXIT.                                                   
                                                                                
           IF K140-CDE-VALID NOT = 'V'                                          
              PERFORM 550-WRITE-F140      THRU 550-EXIT                         
              PERFORM 200-READ-K140       THRU 200-EXIT                         
              GO TO 300-EXIT.                                                   
                                                                                
           MOVE K140-NUM-REGN TO K800-NUM-REGN.                                 
           READ BP13K800.                                                       
           IF BP13K800-STATUS = 00                                              
              ADD 1    TO CNT-BP13K800-READ                                     
              IF K140-NUM-NRIC NOT = SPACES AND LOW-VALUES                      
                 PERFORM 400-COMPARE-NUM-CPF THRU 400-EXIT                      
              ELSE                                                              
                 IF K140-CDE-TRANS-TYPE  = '14'                                 
                         AND K140-CDE-PAYMENT-TYPE = 'CD '                      
                    MOVE SPACES               TO K140-CDE-ERROR                 
                    PERFORM  500-WRITE-F124    THRU  500-EXIT                   
                 ELSE                                                           
                 IF (K140-CDE-TRANS-TYPE  = '16' OR '15')                       
                    AND (K140-CDE-PAYMENT-TYPE = 'BK ' OR 'CD ')                
                    MOVE SPACES               TO K140-CDE-ERROR                 
                    PERFORM  500-WRITE-F124    THRU  500-EXIT                   
                 ELSE                                                           
                    MOVE 'G'                  TO K140-CDE-ERROR                 
                    PERFORM 350-REWRITE-K140  THRU  350-EXIT                    
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              IF BP13K800-STATUS = 23                                           
                 MOVE 'R'                  TO K140-CDE-ERROR                    
                 PERFORM 350-REWRITE-K140  THRU  350-EXIT                       
              ELSE                                                              
                 DISPLAY 'READING ERROR, BP13K800-STATUS'                       
                          BP13K800-STATUS                                       
                 MOVE BP13K800-STATUS TO RETURN-CODE                            
                 PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                       
                                                                                
           PERFORM 200-READ-K140      THRU 200-EXIT.                            
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
       310-CHECK-K885.                                                          
      *-------------------------------------------------------------            
           MOVE K140-NUM-REGN        TO K885-NUM-REGN.                          
           MOVE K140-NUM-NRIC        TO K885-NUM-NRIC.                          
           PERFORM 1000-READ-K885    THRU 1000-EXIT.                            
           IF WS-K885-FND-FL = 'Y'                                              
              MOVE 'E'            TO K140-CDE-APPLT-CPF                         
              MOVE SPACES         TO K140-CDE-ERROR                             
              PERFORM  500-WRITE-F124    THRU  500-EXIT                         
           ELSE                                                                 
              MOVE 'S'            TO K140-CDE-ERROR                             
              PERFORM 350-REWRITE-K140  THRU  350-EXIT                          
           END-IF.                                                              
                                                                                
       310-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       350-REWRITE-K140.                                                        
      *-------------------------------------------------------------            
           IF K140-CDE-VALID = 'D'                                              
              NEXT SENTENCE                                                     
           ELSE                                                                 
              MOVE SPACES      TO K140-CDE-VALID.                               
                                                                                
           REWRITE BP13K140-KIVTRAN.                                            
                                                                                
           MOVE BP13K140-STATUS TO WS-K140-STATUS.                              
                                                                                
           IF WS-K140-STATUS1 = ZEROES                                          
              ADD 1 TO CNT-REGN-NO-ERR                                          
           ELSE                                                                 
              DISPLAY 'REWRITING ERROR, BP13K140-STATUS'                        
                       BP13K140-STATUS                                          
              MOVE BP13K140-STATUS TO RETURN-CODE                               
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
       350-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
      *  IF CASH TYPE UPDATE, ELSE COMPARE CPF NO.                              
      ******************************************************************        
       400-COMPARE-NUM-CPF.                                                     
      *-------------------------------------------------------------            
      *******************************************************                   
      *    TO CHECK K140-AMT-RECEIPT SHOULD NOT BE MORE THAN                    
      *    K800-AMT-REGN-PAID FOR PAYMENT-TYPE = 'REG'                          
                                                                                
           IF K140-CDE-PAYMENT-TYPE = 'REG'                                     
                                                                                
               COMPUTE WS-DIFF = K800-AMT-REGN-PAID +                           
                                 K140-AMT-RECEIPT                               
               DISPLAY 'WS-DIFF : '  WS-DIFF                                    
                                                                                
               IF WS-DIFF <  0                                                  
                  MOVE 'L' TO   K140-CDE-ERROR                                  
                  PERFORM 350-REWRITE-K140   THRU  350-EXIT                     
               END-IF                                                           
                                                                                
            END-IF.                                                             
      *SGK***************************************************                   
                                                                                
           IF K140-CDE-TRANS-TYPE = '11' OR '15' OR '16'                        
              PERFORM 500-WRITE-F124  THRU 500-EXIT                             
              GO TO 400-EXIT.                                                   
                                                                                
           MOVE 'G'            TO K140-CDE-ERROR.                               
           IF K140-NUM-NRIC = K800-NUM-NRIC1                                    
              MOVE '1'       TO  K140-CDE-APPLT-CPF                             
              MOVE SPACES    TO  K140-CDE-ERROR.                                
                                                                                
           IF K140-NUM-NRIC = K800-NUM-NRIC2                                    
              MOVE '2'       TO  K140-CDE-APPLT-CPF                             
              MOVE SPACES    TO  K140-CDE-ERROR.                                
                                                                                
           IF K140-NUM-NRIC = K800-NUM-NRIC3                                    
              MOVE '3'       TO  K140-CDE-APPLT-CPF                             
              MOVE SPACES    TO  K140-CDE-ERROR.                                
                                                                                
           IF K140-NUM-NRIC = K800-NUM-NRIC4                                    
              MOVE '4'       TO  K140-CDE-APPLT-CPF                             
              MOVE SPACES    TO  K140-CDE-ERROR.                                
                                                                                
           IF K140-CDE-ERROR = 'G'                                              
              IF K140-CDE-PAYMENT-TYPE = 'SUS'                                  
                 MOVE K140-NUM-REGN  TO  K880-NUM-REGN                          
                 READ BP13K880                                                  
                 IF K880-STATUS = 0                                             
                   PERFORM  310-CHECK-K885    THRU  310-EXIT                    
                   CONTINUE                                                     
                 ELSE                                                           
                    MOVE 'S'                    TO   K140-CDE-ERROR             
                    PERFORM 350-REWRITE-K140   THRU  350-EXIT                   
                 END-IF                                                         
           ELSE                                                                 
               CONTINUE                                                         
           ELSE                                                                 
              PERFORM  500-WRITE-F124    THRU  500-EXIT.                        
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
      *  WRITE AFTER FINAL VALIDATION PERFORMED                        *        
      ******************************************************************        
       500-WRITE-F124.                                                          
      *-------------------------------------------------------------            
           MOVE BP13K140-KIVTRAN TO BP13F124-VALIDKIV.                          
           MOVE WS-DATE          TO K140-DTE-POST.                              
           MOVE ZEROES           TO F124-COUNT-HISTORY.                         
           IF K800-NUM-STATUS = 'C'                                             
              MOVE 'C'           TO F124-CDE-CANCEL.                            
                                                                                
           WRITE BP13F124-VALIDKIV.                                             
           ADD K140-AMT-RECEIPT  TO WS-AMT-TOTAL-DELETE.                        
           PERFORM 600-CONTROL-LISTING THRU 600-EXIT.                           
                                                                                
           PERFORM 550-WRITE-F140      THRU 550-EXIT.                           
                                                                                
           DELETE BP13K140.                                                     
                                                                                
           IF BP13K140-STATUS NOT = 00                                          
              DISPLAY 'DELETING ERROR, BP13K140-STATUS'                         
                       BP13K140-STATUS                                          
              MOVE BP13K140-STATUS TO RETURN-CODE                               
              PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT.                          
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       550-WRITE-F140.                                                          
      *-------------------------------------------------------------            
           IF K140-CDE-VALID = 'V'                                              
              NEXT SENTENCE                                                     
           ELSE                                                                 
              IF K140-CDE-BALANCE-UPDATE = SPACES OR LOW-VALUES                 
                 MOVE 'U'        TO  K140-CDE-BALANCE-UPDATE                    
                 PERFORM 350-REWRITE-K140    THRU  350-EXIT                     
              ELSE                                                              
                 GO TO 550-EXIT.                                                
                                                                                
           IF K140-CDE-VALID = 'V' OR 'D'                                       
           COMPUTE K140-AMT-RECEIPT = 0 - K140-AMT-RECEIPT.                     
                                                                                
           MOVE   BP13K140-KIVTRAN   TO  BP13F140-KIVTRAN.                      
           WRITE  BP13F140-KIVTRAN.                                             
           ADD    1                  TO  CNT-BP13F140-WRITE.                    
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       600-CONTROL-LISTING.                                                     
      *-------------------------------------------------------------            
           IF WS-LINE-COUNT > 52                                                
              MOVE 1 TO WS-LINE-COUNT                                           
              PERFORM 800-PRINT-HEADER THRU 800-EXIT                            
           ELSE                                                                 
               ADD 1 TO WS-LINE-COUNT.                                          
                                                                                
           MOVE K140-AMT-RECEIPT      TO WS-AMT-CASH.                           
                                                                                
           STRING K140-DTE-TRANS(7:2) '/'                                       
                  K140-DTE-TRANS(5:2) '/'                                       
                  K140-DTE-TRANS(1:4)                                           
                  DELIMITED BY SIZE INTO WS-DTE-TRANS.                          
                                                                                
           MOVE WS-CASE-NO            TO WS-SERIAL-NUM.                         
           MOVE K140-NUM-REGN         TO WS-ORIG-REG-NO.                        
           MOVE K140-NUM-SCH-ACCT     TO WS-SCH-ACCT-NO.                        
           MOVE K140-CDE-PAYMENT-TYPE TO WS-PAYMENT-TYPE.                       
           MOVE K140-NUM-RECPT-JRNO   TO WS-RECPT-JRNO.                         
                                                                                
           WRITE L103-PRTREC FROM WS-PRINT-DETAIL AFTER 1.                      
                                                                                
           ADD 1 TO WS-CASE-NO.                                                 
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       800-PRINT-HEADER.                                                        
      *-------------------------------------------------------------            
           ADD 1 TO WS-PAGE-NO.                                                 
           MOVE WS-PAGE-NO                 TO HL-PAGE.                          
           MOVE WS-DATE(5:2)               TO HL-MTH-MM.                        
           MOVE WS-DATE(1:4)               TO HL-MTH-CCYY.                      
           WRITE L103-PRTREC FROM HL-HEADER1     AFTER PAGE.                    
           WRITE L103-PRTREC FROM HL-HEADER2     AFTER 1.                       
           WRITE L103-PRTREC FROM HL-HEADER3     AFTER 3.                       
           WRITE L103-PRTREC FROM HL-HEADER4     AFTER 1.                       
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       900-CLOSE-ROUTINE.                                                       
      *-------------------------------------------------------------            
           IF WS-CASE-NO > 1                                                    
              MOVE  WS-AMT-TOTAL-DELETE TO WS-TOTAL-DEL                         
              WRITE L103-PRTREC FROM HL-HEADER5 AFTER 2.                        
                                                                                
           DISPLAY 'TOTAL'          WS-AMT-TOTAL-DELETE                         
           DISPLAY 'TOTAL DEL'      WS-TOTAL-DEL                                
                                                                                
           DISPLAY '******  BP13C103 *************'.                            
           DISPLAY 'NO OF KIV RECS READ  (K140) : ' CNT-BP13K140-READ.          
           DISPLAY 'NO OF RFF RECS READ  (K800) : ' CNT-BP13K800-READ.          
           DISPLAY 'NO OF EXAPP RECS READ(K885) : ' CNT-BP13K885-READ.          
           DISPLAY 'NO OF KIV RECS WRITE (F140) : ' CNT-BP13F140-WRITE.         
           DISPLAY 'NO OF REGN NO ERROR         : ' CNT-REGN-NO-ERR.            
                                                                                
           CLOSE BP13K800                                                       
                 BP13K885                                                       
                 BP13K880                                                       
                 BP13K140                                                       
                 BP13F140                                                       
                 BP13F124                                                       
                 BP13L103.                                                      
                                                                                
           IF BP13K800-STATUS NOT = 00 AND 97                                   
              MOVE BP13K800-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSING ERROR, BP13K800-STATUS' BP13K800-STATUS.         
                                                                                
           IF BP13K885-STATUS NOT = 00 AND 97                                   
              MOVE BP13K885-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSING ERROR, BP13K885-STATUS' BP13K885-STATUS.         
                                                                                
                                                                                
           IF     K880-STATUS NOT = 00 AND 97                                   
              MOVE     K880-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSING ERROR, BP13K880-STATUS'     K880-STATUS.         
                                                                                
           IF BP13K140-STATUS NOT = 00 AND 97                                   
              MOVE BP13K140-STATUS TO RETURN-CODE                               
              DISPLAY 'CLOSING ERROR, BP13K140-STATUS' BP13K140-STATUS.         
                                                                                
           STOP RUN.                                                            
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
       1000-READ-K885.                                                          
      *-------------------------------------------------------------            
           READ  BP13K885.                                                      
           IF BP13K885-STATUS = 00                                              
              ADD 1               TO CNT-BP13K885-READ                          
              MOVE 'Y'            TO WS-K885-FND-FL                             
           ELSE                                                                 
              IF BP13K885-STATUS = 23                                           
                 MOVE 'N'            TO WS-K885-FND-FL                          
              ELSE                                                              
                 MOVE BP13K885-STATUS TO RETURN-CODE                            
                 DISPLAY 'READ  ERROR, BP13K885-STATUS' BP13K885-STATUS         
                 PERFORM 900-CLOSE-ROUTINE THRU 900-EXIT                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
