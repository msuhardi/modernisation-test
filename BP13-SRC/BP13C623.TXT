      *------------------------*                                                
       IDENTIFICATION DIVISION.                                         00010002
      *------------------------*                                                
       PROGRAM-ID.    BP13C623.                                         00020001
       AUTHOR.        LMS.                                              00030001
       DATE-WRITTEN.  27/07/96.                                         00040001
                                                                                
      * ====================================================== *        00050002
      *             SYSTEM OF COMMITMENT (BP13)                *        00060002
      * ====================================================== *        00070002
      *    OBJECTIVE   : TO UPDATE ACCEPTANCE OF SST CASES.    *        00080002
      *--------------------------------------------------------*        00090002
      * CHG-NO  BY    DATE    DETAILS                          *        00100002
      * ------  --- --------  -------                          *        00110002
      *BP130102 LMS 27/07/96  TO READ BB22F090 FOR SST CASES   *        00111001
      *                       FORWARDED FROM STFS.             *        00112001
      *BP130405 LMS 10/11/97 -TO UPDATE CAP, CA-TAG, SPR-TAG,  *        00113003
      *                       SUBSIDIZED-LOAN TO SOC.          *        00114003
      *                      -TO OUTPUT FILE BP13K640.         *        00114003
      *BP130461 LMS 11/06/98 -TO ADD HA-OPT TO BP13K640.       *                
      *BP130418 SIA 11/03/98  CHGE BM06 FILES: K210 TO K100,   *        00114003
      *                       K211 TO K110, K900 TO K190.      *        00114003
      *BP130652 LSB 17/09/99  CHANGE F740 RECL FROM 300 TO 500 *                
      *BP130807 GBR 16/02/00  TO ALLOW MODL-DESG CODES '70,71, *                
      *                       72,73,81,82' FOR ROOM TYP '04,05'*                
      *                       AND '70,72,73,81,82' FOR '06'.   *                
      *BP130799 JMS 15/03/00  REMOVE K640-CDE-LOAN-OPTION-APPL *                
      *BP130858 LMS 25/05/00  TO REMOVE MOVING OF K800-NUM-    *                
      *                       ALLO-SCHEME.                     *                
      *BP130883 RAS 08/08/00  TO CHANGE BP13C904 TO BP13C913   *                
      *BP130925 ANC 06/04/01  REMOVE K800-NUM-PRESENT-FLAT-TYPE*                
      *                       & K800-NUM-PRESENT-NT.           *                
      *BP132289 LMS 24/02/03  MOVE F740-CDE-IDP-SCH TO         *                
      *                       K800-NUM-IDP-SCH                 *                
      *BP132532 LMS 15/05/04  MOVE PROPOSED-DATE-OF-SALE TO    *                
      *                       BP13K800.                        *                
      *BP133047 LMS 17/04/07  MOVE DTE-APPLICATION TO DTE-REGN *                
      *BP133091 LMS 08/01/08  TO INITIALISE K640 NUMERIC FIELDS*                
      * ====================================================== *        00118002
                                                                                
      *------------------------*                                                
       ENVIRONMENT DIVISION.                                            00119002
      *------------------------*                                                
       CONFIGURATION SECTION.                                           00120002
       SOURCE-COMPUTER. IBM-4341.                                       00130002
       OBJECT-COMPUTER. IBM-4341.                                       00140002
                                                                                
      *------------------------*                                                
       INPUT-OUTPUT SECTION.                                            00150002
      *------------------------*                                                
       FILE-CONTROL.                                                    00160002
                                                                        00170002
           SELECT BB22F090 ASSIGN       TO BB22F090.                    00180001
                                                                        00190002
           SELECT BP13F740 ASSIGN       TO BP13F740.                    00200002
                                                                        00210002
           SELECT BB14K500 ASSIGN       TO BB14K500                     00220002
                           ORGANIZATION IS INDEXED                      00230002
                           ACCESS MODE  IS DYNAMIC                      00240002
                           RECORD KEY   IS K500-KEY-FLD                 00250002
                           FILE STATUS  IS K500-STATUS.                 00270002
                                                                        00280002
           SELECT BP13K800 ASSIGN       TO BP13K800                     00290002
                           ORGANIZATION IS INDEXED                      00300002
                           ACCESS MODE  IS DYNAMIC                      00310002
                           RECORD KEY   IS K800-NUM-REGN                00320002
                           FILE STATUS  IS K800-STATUS.                 00330002
                                                                        00340002
           SELECT BP13K840 ASSIGN       TO BP13K840                     00350002
                           ORGANIZATION IS INDEXED                      00360002
                           ACCESS MODE  IS DYNAMIC                      00370002
                           RECORD KEY   IS K840-KEY-FLD                 00380002
                           FILE STATUS  IS K840-STATUS.                 00390002
                                                                        00400002
           SELECT BM06K100 ASSIGN       TO BM06K100                     00470002
                           ORGANIZATION IS INDEXED                      00480002
                           ACCESS MODE  IS DYNAMIC                      00490002
                           RECORD KEY   IS K100-KEY-FLD                 00500002
                           FILE STATUS  IS K100-STATUS.                 00510002
                                                                        00520002
           SELECT BM06K110 ASSIGN       TO BM06K110                     00530002
                           ORGANIZATION IS INDEXED                      00540002
                           ACCESS MODE  IS DYNAMIC                      00550002
                           RECORD KEY   IS K110-KEY-FLD                 00560002
                           FILE STATUS  IS K110-STATUS.                 00570002
                                                                        00580002
           SELECT BP13K640  ASSIGN TO BP13K640                                  
                  ACCESS MODE      IS RANDOM                                    
                  ORGANIZATION     IS INDEXED                                   
                  RECORD KEY       IS K640-KEY-FLD                              
                  FILE STATUS      IS K640-STATUS.                              
                                                                                
           SELECT BM06K190 ASSIGN       TO BM06K190                     00590002
                           ORGANIZATION IS INDEXED                      00600002
                           ACCESS MODE  IS DYNAMIC                      00610002
                           RECORD KEY   IS K190-2-KEY                   00620002
                           FILE STATUS  IS K190-STATUS.                 00630002
                                                                        00640002
           SELECT BP13L623 ASSIGN       TO BP13L623.                    00650001
                                                                        00660002
                                                                        00670002
      *------------------------*                                                
       DATA DIVISION.                                                   00680002
      *------------------------*                                                
       FILE SECTION.                                                    00690002
                                                                        00700002
       FD  BB22F090                                                     00710001
           BLOCK CONTAINS 0 RECORDS                                     00720002
           RECORD CONTAINS 100 CHARACTERS                               00730002
           LABEL RECORDS ARE STANDARD.                                  00740002
       COPY BB22F090.                                                   00750001
                                                                        00800002
       FD  BP13F740                                                     00810002
           BLOCK CONTAINS 0 RECORDS                                     00820002
           RECORD CONTAINS 500 CHARACTERS                               00830002
           LABEL RECORDS ARE STANDARD.                                  00840002
       COPY BP13F740.                                                   00850002
                                                                        00860002
       FD  BB14K500                                                     00870002
           RECORD CONTAINS 400 CHARACTERS.                              00880002
       COPY BB14K500.                                                   00890002
                                                                        00900002
       FD  BP13K640                                                     00870002
           RECORD CONTAINS 500 CHARACTERS.                              00880002
       COPY BP13K640.                                                   00890002
                                                                        00900002
       FD  BP13K800                                                     00910002
           RECORD CONTAINS 2000 CHARACTERS.                             00920002
       COPY BP13K800.                                                   00930002
                                                                        00940002
       FD  BP13K840                                                     00950002
           RECORD CONTAINS 500 CHARACTERS.                              00960002
       COPY BP13K840.                                                   00970002
                                                                        00980002
       FD  BM06K100                                                     00950002
           RECORD CONTAINS 500 CHARACTERS.                              00960002
       COPY BM06K100.                                                   01030002
                                                                        01040002
       FD  BM06K110                                                     00950002
           RECORD CONTAINS 500 CHARACTERS.                              00960002
       COPY BM06K110.                                                   01050002
                                                                        01060002
       FD  BM06K190                                                     01070002
           RECORD CONTAINS 650 CHARACTERS.                              01080002
       COPY BM06K190.                                                   01090002
                                                                        01100002
       FD  BP13L623                                                     01110001
           RECORD CONTAINS 132 CHARACTERS                               01120002
           LABEL RECORDS ARE OMITTED.                                   01130002
       01  BP13L623-REC                   PIC X(132).                   01140001
                                                                        01150002
                                                                        01150002
      *------------------------*                                                
       WORKING-STORAGE SECTION.                                         01160002
      *------------------------*                                                
                                                                        01170002
       COPY P13COMM8.                                                   01180002
                                                                        01190002
       01  WS-EXP-MM-31D                  PIC 9(2).                     01200002
           88   WS-31-DAY-MONTH              VALUE 01, 03, 05, 07, 08,  01210002
                                                   10, 12.              01220002
           88   WS-30-DAY-MONTH              VALUE 04, 06, 09, 11.      01230002
           88   WS-28-29-DAY-MONTH           VALUE 02.                  01240002
                                                                        01250002
       01  WS-YEAR                        PIC 9(4)   VALUE 0.           01260002
       01  WS-REM                         PIC 9(3)   VALUE 0.           01270002
                                                                        01340002
       01  WS-CURR-TIME.                                                01290002
           05  WS-HH                      PIC X(2)   VALUE SPACES.      01300002
           05  WS-MM                      PIC X(2)   VALUE SPACES.      01310002
           05  WS-SS                      PIC X(2)   VALUE SPACES.      01320002
           05  WS-MS                      PIC X(2)   VALUE SPACES.      01330002
                                                                        01340002
       01  WS-TIME.                                                     01350002
           05  WS-HH                      PIC X(2)   VALUE SPACES.      01360002
           05  WS-MM                      PIC X(2)   VALUE SPACES.      01370002
           05  WS-SS                      PIC X(2)   VALUE SPACES.      01380002
                                                                        01390002
       01  WS-EDITED-TIME.                                              01400002
           05  WS-SYS-TIME                PIC X(6)   VALUE SPACES.      01410002
           05  WS-MICRO-SEC               PIC 9      VALUE 0.           01420002
                                                                        01430002
       01  WS-ADJUST-TIME.                                              01440002
           05  WS-ADJ-TIME                PIC X(4)   VALUE SPACES.      01450002
           05  WS-ADJ-MICRO-SEC           PIC 999    VALUE 0.           01460002
                                                                        01470002
       01  WS-SEC-COUNT                   PIC 9      VALUE 0.           01480002
                                                                        01490002
       01  WS-FILE-STATUS.                                              01500002
           05 K500-STATUS                 PIC 99     VALUE ZEROS.       01510002
           05 K640-STATUS                 PIC 99     VALUE ZEROS.       01510002
           05 K800-STATUS                 PIC 99     VALUE ZEROS.       01520002
           05 K840-STATUS                 PIC 99     VALUE ZEROS.       01530002
           05 K100-STATUS                 PIC 99     VALUE ZEROS.       01550002
           05 K110-STATUS                 PIC 99     VALUE ZEROS.       01560002
           05 K190-STATUS                 PIC 99     VALUE ZEROS.       01570002
                                                                        01580002
       01  WS-COUNTERS.                                                 01590002
           05 WS-F090-READ                PIC 9(5)   VALUE ZEROS.       01600002
           05 WS-F740-READ                PIC 9(5)   VALUE ZEROS.       01610002
           05 WS-K640-UPDTE               PIC 9(5)   VALUE ZEROS.       01620002
           05 WS-K640-WRITE               PIC 9(5)   VALUE ZEROS.       01640002
           05 WS-K800-UPDTE               PIC 9(5)   VALUE ZEROS.       01620002
           05 WS-K110-UPDTE               PIC 9(5)   VALUE ZEROS.       01630002
           05 WS-K840-WRITE               PIC 9(5)   VALUE ZEROS.       01640002
           05 WS-K840-UPDTE               PIC 9(5)   VALUE ZEROS.       01650002
           05 WS-K190-WRITE               PIC 9(5)   VALUE ZEROS.       01660002
           05 WS-K100-UPDTE               PIC 9(5)   VALUE ZEROS.       01670002
           05 WS-LINE-CTR                 PIC 99     VALUE ZEROS.       01700002
           05 WS-PAGE-CTR                 PIC 9(5)   VALUE ZEROS.       01710002
           05 WS-SERIAL                   PIC 9(5)   VALUE ZEROS.       01720002
           05 RM-PTR                      PIC 9      VALUE ZEROS.       01730002
                                                                        01740002
       01  WS-SYS-DATE.                                                 01750002
           05 WS-SYS-CC                   PIC 99.                       01760002
           05 WS-SYS-YYMMDD.                                            01770002
              10 WS-SYS-YY                PIC 99.                       01780002
              10 WS-SYS-MM                PIC 99.                       01790002
              10 WS-SYS-DD                PIC 99.                       01800002
                                                                        01810002
       01  WS-EXP-DATE.                                                 01820002
           05 WS-EXP-CCYY                 PIC 9999.                     01830002
           05 WS-EXP-MM                   PIC 99.                       01850002
           05 WS-EXP-DD                   PIC 99.                       01860002
                                                                        01870002
       01  WS-EOF-INPUT                   PIC 9.                        01880002
           88 EOF-INPUT                   VALUE 1.                      01890002
       01  WS-EOF-F740                    PIC 9.                        01900002
           88 EOF-F740                    VALUE 1.                      01910002
                                                                        01920002
       01  WS-LINK-REC.                                                 01930002
           05 WS-LINK-SCH-ACC             PIC X(9).                     01940002
                                                                        01950002
       01  PRINT-VARIABLES.                                             01960002
           05 L623-HDG1.                                                01970001
              10 FILLER                   PIC X(14)  VALUE 'BP13L623'.  01980001
              10 FILLER                   PIC X(8)   VALUE 'HDB3'.      01990002
              10 FILLER                   PIC X(24)  VALUE SPACES.      02000002
              10 FILLER                   PIC X(40)  VALUE              02010002
                'S Y S T E M   O F   C O M M I T M E N T'.              02020002
              10 FILLER                   PIC X(14)  VALUE SPACES.      02030002
              10 FILLER                   PIC X(7)   VALUE 'DATE: '.    02040002
              10 L623-DATE.                                             02050001
                 15 L623-DD               PIC 99.                       02060001
                 15 FILLER                PIC X      VALUE '/'.         02070002
                 15 L623-MM               PIC 99.                       02080001
                 15 FILLER                PIC X      VALUE '/'.         02090002
                 15 L623-CC               PIC 99.                       02100001
                 15 L623-YY               PIC 99.                       02100001
              10 FILLER                   PIC X(3)   VALUE SPACES.      02110002
              10 FILLER                   PIC X(7)   VALUE 'PAGE: '.    02120002
              10 L623-PAGE                PIC ZZZZ9.                    02130001
                                                                        02140002
           05 L623-HDG2.                                                02150001
              10 FILLER                   PIC X(100) VALUE SPACES.      02160002
              10 FILLER                   PIC X(32)  VALUE              02170002
                'RENTAL HOUSING  (OPERATION UNIT)'.                     02180002
                                                                        02190002
           05 L623-HDG3.                                                02200001
              10 FILLER                   PIC X(46) VALUE SPACES.       02210002
              10 FILLER                   PIC X(40) VALUE               02220002
                'ACCEPTANCE LIST OF SITTING TENANTS CASE'.              02230002
                                                                        02240002
           05 L623-HDG4.                                                02250001
              10 FILLER                   PIC X(11) VALUE ' S/N '.      02260002
              10 FILLER                   PIC X(15) VALUE 'NRIC'.       02270002
              10 FILLER                   PIC X(14) VALUE 'REGN NO.'.   02280002
              10 FILLER                   PIC X(17) VALUE 'SCH-ACC-NO'. 02290002
              10 FILLER                   PIC X(56) VALUE 'ADDRESS'.    02300002
              10 FILLER                   PIC X(19) VALUE 'REMARKS'.    02310002
                                                                        02320002
           05 L623-DTL.                                                 02330001
              10 L623-SERIAL              PIC ZZZZ9.                    02340001
              10 FILLER                   PIC X(06) VALUE SPACES.       02350002
              10 L623-NRIC                PIC X(09).                    02360001
              10 FILLER                   PIC X(06) VALUE SPACES.       02370002
              10 L623-REGN                PIC X(08).                    02380001
              10 FILLER                   PIC X(06) VALUE SPACES.       02390002
              10 L623-SCH-ACC             PIC X(11).                    02400001
              10 FILLER                   PIC X(06) VALUE SPACES.       02410002
              10 L623-ADDR                PIC X(53).                    02420001
              10 FILLER                   PIC X(03) VALUE SPACES.       02430002
              10 L623-REMARKS             PIC X(19) VALUE SPACES.       02440001
                                                                        02450002
           05 L623-DASH                   PIC X(132) VALUE ALL '-'.     02460001
                                                                        02470002
                                                                        02480002
      ******************************************************************02490002
       PROCEDURE DIVISION.                                              02500002
      ******************************************************************02510002
      *------------------------*                                                
       000-MAIN-ROUTINE.                                                02520002
      *------------------------*                                                
           PERFORM 100-INITIALIZATION THRU 100-EXIT.                    02530002
           PERFORM 200-READ-F740      THRU 200-EXIT.                    02540002
           PERFORM 210-READ-INPUT     THRU 210-EXIT.                    02550002
           PERFORM 300-PROCESS-RTN    THRU 300-EXIT                     02560002
             UNTIL EOF-INPUT OR EOF-F740.                               02570002
           PERFORM 999-CLOSE-FILES    THRU 999-EXIT.                    02580002
                                                                        02590002
       000-EXIT.                                                        02600002
           EXIT.                                                        02610002
                                                                        02620002
                                                                        02620002
      *------------------------*                                                
       100-INITIALIZATION.                                              02630002
      *------------------------*                                                
           OPEN INPUT  BB22F090                                         02650002
                       BP13F740                                         02660002
                       BB14K500                                         02670002
                I-O    BP13K800                                         02680002
                       BP13K840                                         02690002
                       BM06K100                                         02710002
                       BM06K110                                         02720002
                       BM06K190                                         02730002
                       BP13K640                                         02730002
                OUTPUT BP13L623.                                        02740001
                                                                        02750002
           IF K500-STATUS NOT = 00 AND 97                               02760002
              MOVE K500-STATUS          TO RETURN-CODE                  02770002
              DISPLAY 'ERROR OPENING BP13K500 FILE ' K500-STATUS        02780002
              GO TO 999-CLOSE-FILES.                                    02790002
                                                                        02800002
           IF K640-STATUS NOT = 00 AND 97                               02760002
              MOVE K640-STATUS          TO RETURN-CODE                  02770002
              DISPLAY 'ERROR OPENING BP13K640 FILE ' K640-STATUS        02780002
              GO TO 999-CLOSE-FILES.                                    02790002
                                                                        02800002
           IF K800-STATUS NOT = 00 AND 97                               02810002
              MOVE K800-STATUS          TO RETURN-CODE                  02820002
              DISPLAY 'ERROR OPENING BP13K800 FILE ' K800-STATUS        02830002
              GO TO 999-CLOSE-FILES.                                    02840002
                                                                        02850002
           IF K840-STATUS NOT = 00 AND 97                               02860002
              MOVE K840-STATUS          TO RETURN-CODE                  02870002
              DISPLAY 'ERROR OPENING BP13K840 FILE ' K840-STATUS        02880002
              GO TO 999-CLOSE-FILES.                                    02890002
                                                                        02900002
           IF K100-STATUS NOT = 00 AND 97                               02960002
              MOVE K100-STATUS          TO RETURN-CODE                  02970002
              DISPLAY 'ERROR OPENING BM06K100 FILE ' K100-STATUS        02980002
              GO TO 999-CLOSE-FILES.                                    02990002
                                                                        03000002
           IF K110-STATUS NOT = 00 AND 97                               03010002
              MOVE K110-STATUS          TO RETURN-CODE                  03020002
              DISPLAY 'ERROR OPENING BM06K110 FILE ' K110-STATUS        03030002
              GO TO 999-CLOSE-FILES.                                    03040002
                                                                        03050002
           IF K190-STATUS NOT = 00 AND 97                               03060002
              MOVE K190-STATUS          TO RETURN-CODE                  03070002
              DISPLAY 'ERROR OPENING BM06K190 FILE ' K190-STATUS        03080002
              GO TO 999-CLOSE-FILES.                                    03090002
                                                                        03100002
           MOVE FUNCTION CURRENT-DATE TO WS-SYS-DATE.                           
           MOVE ZEROS                   TO WS-COUNTERS                  03120002
                                           WS-EOF-INPUT                 03130002
                                           WS-EOF-F740.                 03140002
                                                                        03150002
       100-EXIT.                                                        03160002
           EXIT.                                                        03170002
                                                                        03180002
                                                                        02620002
      *------------------------*                                                
       200-READ-F740.                                                   03190002
      *------------------------*                                                
           READ BP13F740 NEXT                                           03200002
             AT END                                                     03210002
                MOVE 1                  TO WS-EOF-F740                  03220002
                GO TO 200-EXIT.                                         03230002
                                                                        03240002
           ADD  1                       TO WS-F740-READ.                03250002
                                                                        03260002
       200-EXIT.                                                        03270002
           EXIT.                                                        03280002
                                                                        03290002
                                                                        02620002
      *------------------------*                                                
       210-READ-INPUT.                                                  03300002
      *------------------------*                                                
           READ BB22F090 NEXT                                           03310002
             AT END                                                     03320002
                MOVE 1                  TO WS-EOF-INPUT                 03330002
                GO TO 210-EXIT.                                         03340002
                                                                        03350002
           ADD  1                       TO WS-F090-READ.                03360002
                                                                        03370002
       210-EXIT.                                                        03380002
           EXIT.                                                        03390002
                                                                        03400002
                                                                        02620002
      *------------------------*                                                
       300-PROCESS-RTN.                                                 03410002
      *------------------------*                                                
           IF (F740-NUM-NRIC1    = F090-NUM-CSTMR-ID    ) AND           03420002
              (F740-NUM-REGN NOT = SPACES AND LOW-VALUES)               03430002
              PERFORM 400-UPDATE-FILES  THRU 400-EXIT                   03440002
              PERFORM 200-READ-F740     THRU 200-EXIT                   03450002
              PERFORM 210-READ-INPUT    THRU 210-EXIT                   03460002
           ELSE                                                         03470002
           IF F740-NUM-NRIC1 < F090-NUM-CSTMR-ID                        03480002
              PERFORM 200-READ-F740     THRU 200-EXIT                   03490002
           ELSE                                                         03500002
              PERFORM 210-READ-INPUT    THRU 210-EXIT.                  03510002
                                                                        03520002
       300-EXIT.                                                        03530002
           EXIT.                                                        03540002
                                                                        03550002
                                                                        02620002
      *------------------------*                                                
       400-UPDATE-FILES.                                                03560002
      *------------------------*                                                
           PERFORM 410-UPDATE-K800      THRU 410-EXIT.                  03570002
           PERFORM 420-UPDATE-K110      THRU 420-EXIT.                  03580002
           PERFORM 430-UPDATE-K840      THRU 430-EXIT.                  03590002
           PERFORM 440-WRITE-K190       THRU 440-EXIT.                  03600002
           PERFORM 450-UPDATE-K100      THRU 450-EXIT.                  03610002
           PERFORM 460-UPDATE-K640      THRU 460-EXIT.                  03610002
           PERFORM 500-PRINT-SUMMARY    THRU 500-EXIT.                  03630002
                                                                        03640002
       400-EXIT.                                                        03650002
           EXIT.                                                        03660002
                                                                        03670002
                                                                        02620002
      *------------------------*                                                
       410-UPDATE-K800.                                                 03680002
      *------------------------*                                                
           MOVE F740-NUM-REGN           TO K800-NUM-REGN.               03690002
                                                                        03700002
           READ BP13K800.                                               03710002
                                                                        03720002
           IF K800-STATUS = 00                                          03730002
              NEXT SENTENCE                                             03740002
           ELSE                                                         03750002
           IF K800-STATUS = 23                                          03760002
              MOVE K800-STATUS          TO RETURN-CODE                  03770002
              DISPLAY 'REC NOT FOUND IN BP13K800, ' K800-NUM-REGN       03780002
              GO TO 999-CLOSE-FILES                                     03790002
           ELSE                                                         03800002
              MOVE K800-STATUS          TO RETURN-CODE                  03810002
              DISPLAY 'ERROR READING BP13K800, ' K800-NUM-REGN          03820002
              GO TO 999-CLOSE-FILES.                                    03830002
                                                                        03840002
           MOVE ZEROS                   TO K800-AMT-BK-REQ.             03850002
                                                                        03860002
           MOVE WS-SYS-DATE             TO WS-EXP-DATE.                 03870002
           ADD  3                       TO WS-EXP-MM.                   03880002
           MOVE WS-EXP-MM               TO WS-EXP-MM-31D.               03890002
           PERFORM 800-CHECK-MONTH    THRU 800-EXIT.                    03900002
           MOVE WS-EXP-DATE             TO K800-DTE-OPTION-EXP.         03910002
                                                                        03920002
           MOVE WS-SYS-DATE              TO WS-EXP-DATE.                03930002
           ADD  4                        TO WS-EXP-MM.                  03940002
           PERFORM 800-CHECK-MONTH     THRU 800-EXIT.                   03950002
           MOVE WS-EXP-DATE              TO K800-DTE-EXPIRED-TP.        03960002
                                                                        03970002
           MOVE F090-NUM-SALE-HDB-REF    TO K800-NUM-SCH-ACC.           03980002
           MOVE F090-PCT-PREM            TO K800-NUM-PREMIUM-RATE.      03980002
           MOVE F090-AMT-PREM            TO K800-AMT-PREMIUM.           03980002
           MOVE WS-SYS-DATE              TO K800-NUM-ALLOC-DATE         03990002
                                            K800-DTE-UPDATE.            04000002
           MOVE 'AS'                     TO K800-NUM-ALLOC-TAG.         04010002
           MOVE F740-CDE-IDP-SCH         TO K800-NUM-IDP-SCHEME.        04020002
           MOVE 'PA'                     TO K800-NUM-ELIG-SCHEME.       04040002
           MOVE F740-NUM-CA-TAG          TO K800-NUM-CA-TAG.            04040002
           MOVE F740-NUM-SPR-TAG         TO K800-NUM-SPR-TAG.           04040002
           MOVE F740-NUM-SUBSIDISED-LOAN TO K800-NUM-SUBSIDISED-LOAN.   04040002
           MOVE F740-NUM-LOAN-TAG        TO K800-NUM-LOAN-TAG.          04040002
           MOVE F740-NUM-CAP             TO K800-NUM-CAP.               04040002
           MOVE F740-DTE-PRPSD-SALE      TO K800-DTE-PRPSD-SALE.        04040002
           MOVE SPACES                   TO K800-NUM-NT-WITH-LAND.      04050002
           MOVE F090-DTE-APLCTN          TO K800-DTE-REGN.                      
                                                                        04060002
           PERFORM 412-READ-K110      THRU 412-EXIT.                    04070002
           PERFORM 413-READ-K100      THRU 413-EXIT.                    04080002
                                                                        04090002
           MOVE K100-NT-CODE            TO K800-NUM-NEW-TOWN.           04110002
                                                                        04130002
           REWRITE BP13K800-MASTER.                                     04140002
                                                                        04150002
           IF K800-STATUS = 00                                          04160002
              ADD 1                     TO WS-K800-UPDTE                04170002
           ELSE                                                         04180002
              MOVE K800-STATUS          TO RETURN-CODE                  04190002
              DISPLAY 'ERROR UPDATING BP13K800, ' K800-NUM-REGN         04200002
              GO TO 999-CLOSE-FILES.                                    04210002
                                                                        04220002
       410-EXIT.                                                        04230002
           EXIT.                                                        04240002
                                                                        04250002
                                                                        02620002
      *------------------------*                                                
       412-READ-K110.                                                   04260002
      *------------------------*                                                
           MOVE F090-NUM-SALE-HDB-REF   TO K110-SCH-ACC-NO.             04270002
                                                                        04280002
           READ BM06K110.                                               04290002
                                                                        04300002
           IF K110-STATUS = 00                                          04310002
              NEXT SENTENCE                                             04311002
           ELSE                                                         04312002
           IF K110-STATUS = 23                                          04313002
              MOVE K110-STATUS          TO RETURN-CODE                  04314002
              DISPLAY 'REC NOT FOUND IN BM06K110, ' K110-SCH-ACC-NO     04315002
              GO TO 999-CLOSE-FILES                                     04316002
           ELSE                                                         04317002
              MOVE K110-STATUS          TO RETURN-CODE                  04318002
              DISPLAY 'ERROR READING BM06K110, ' K110-SCH-ACC-NO        04319002
              GO TO 999-CLOSE-FILES.                                    04320002
                                                                        04330002
           MOVE  SPACES                 TO BP13COMM8-REC.               04330002
           INITIALIZE                      BP13COMM8-REC.               04330002
                                                                        04370002
           MOVE F090-NUM-SALE-HDB-REF   TO WS-LINK-SCH-ACC.             04380002
           CALL 'BP13C913' USING WS-LINK-REC,                           04390002
                                 BP13COMM8-REC.                         04400002
                                                                        04401002
           IF COMM8-CDE-SYSERR NOT = 0                                  04402002
              MOVE COMM8-CDE-SYSERR     TO RETURN-CODE                  04403002
              DISPLAY 'ERROR READING PBF TABLE ' COMM8-CDE-SYSERR       04404002
              GO TO 999-CLOSE-FILES.                                    04404102
                                                                        04404202
           IF (COMM8-CDE-TYP-ACTLUSE = '01')                            04404302
               MOVE '1' TO K800-NUM-ROOM                                04404402
               MOVE ' ' TO K800-NUM-ROOM-TYPE                           04404502
           ELSE                                                         04404602
           IF (COMM8-CDE-TYP-ACTLUSE = '02')                            04404702
               MOVE '2' TO K800-NUM-ROOM                                04404802
               MOVE ' ' TO K800-NUM-ROOM-TYPE                           04404902
           ELSE                                                         04405002
           IF (COMM8-CDE-TYP-ACTLUSE = '03')                            04406002
               MOVE '3' TO K800-NUM-ROOM                                04407002
               MOVE ' ' TO K800-NUM-ROOM-TYPE                           04408002
           ELSE                                                         04409002
           IF (COMM8-CDE-TYP-ACTLUSE = '04') AND                        04410002
              (COMM8-CDE-MODL-DESG = '06')                              04420002
               MOVE '4' TO K800-NUM-ROOM                                04430002
               MOVE 'S' TO K800-NUM-ROOM-TYPE                           04440002
           ELSE                                                         04450002
           IF (COMM8-CDE-TYP-ACTLUSE = '04') AND                        04460002
              (COMM8-CDE-MODL-DESG = '34' OR '70' OR '71' OR            04470002
                                     '72' OR '73' OR '81' OR '82')              
               MOVE '4' TO K800-NUM-ROOM                                04480002
               MOVE 'D' TO K800-NUM-ROOM-TYPE                           04490002
           ELSE                                                         04500002
           IF (COMM8-CDE-TYP-ACTLUSE = '04')                            04510002
               MOVE '4' TO K800-NUM-ROOM                                04520002
               MOVE ' ' TO K800-NUM-ROOM-TYPE                           04530002
           ELSE                                                         04540002
           IF (COMM8-CDE-TYP-ACTLUSE = '05') AND                        04550002
              (COMM8-CDE-MODL-DESG = '34' OR '70' OR '71' OR            04560002
                                     '72' OR '73' OR '81' OR '82')              
               MOVE '5' TO K800-NUM-ROOM                                04570002
               MOVE 'D' TO K800-NUM-ROOM-TYPE                           04580002
           ELSE                                                         04590002
           IF (COMM8-CDE-TYP-ACTLUSE = '05' )                           04600002
               MOVE '5' TO K800-NUM-ROOM                                04610002
               MOVE ' ' TO K800-NUM-ROOM-TYPE                           04620002
           ELSE                                                         04630002
           IF (COMM8-CDE-TYP-ACTLUSE = '06'      ) AND                  04640002
              (COMM8-CDE-MODL-DESG = '34' OR '70' OR '71' OR            04650002
                                     '72' OR '73' OR '81' OR '82')              
               MOVE 'E' TO K800-NUM-ROOM                                04660002
               MOVE 'D' TO K800-NUM-ROOM-TYPE                           04670002
           ELSE                                                         04680002
           IF (COMM8-CDE-TYP-ACTLUSE = '06' )                           04690002
               MOVE 'E' TO K800-NUM-ROOM                                04700002
               MOVE ' ' TO K800-NUM-ROOM-TYPE.                          04710002
                                                                        04720002
       412-EXIT.                                                        04730002
           EXIT.                                                        04740002
                                                                        04750002
                                                                        02620002
      *------------------------*                                                
       413-READ-K100.                                                   04760002
      *------------------------*                                                
           MOVE K110-ESTATE             TO K100-ESTATE.                 04770002
           MOVE K110-NEIGHBOURHOOD      TO K100-NEIGHBOURHOOD.          04780002
           MOVE K110-CONTRACT-NO        TO K100-CONTRACT-NO.            04790002
           MOVE K110-BLK-NO             TO K100-BLK-NO.                 04800002
                                                                        04810002
           READ BM06K100.                                               04820002
                                                                        04830002
           IF K100-STATUS = 00                                          04840002
              NEXT SENTENCE                                             04850002
           ELSE                                                         04860002
           IF K100-STATUS = 23                                          04870002
              MOVE K100-STATUS          TO RETURN-CODE                  04880002
              DISPLAY 'REC NOT FOUND IN BM06K100, ' K100-KEY-FLD        04890002
              GO TO 999-CLOSE-FILES                                     04900002
           ELSE                                                         04910002
              MOVE K100-STATUS          TO RETURN-CODE                  04920002
              DISPLAY 'ERROR READING BM06K100, ' K100-KEY-FLD           04930002
              GO TO 999-CLOSE-FILES.                                    04940002
                                                                        04950002
       413-EXIT.                                                        04960002
           EXIT.                                                        04970002
                                                                        04980002
                                                                        02620002
      *------------------------*                                                
       420-UPDATE-K110.                                                 04990002
      *------------------------*                                                
           MOVE F740-NUM-REGN           TO K110-REGN-NO.                05000002
           MOVE K800-NUM-ALLO-SCHEME    TO K110-ALLOC-SCH.              05010002
           MOVE K800-NUM-CAT            TO K110-CATEGORY.               05020002
           MOVE 'A'                     TO K110-ALLOCN-STATUS.          05030002
           MOVE 'S'                     TO K110-ALLOCN-TYPE.            05040002
           IF K110-DTE-1ST-SALE = ZEROS OR SPACES OR LOW-VALUES         05050002
              MOVE K100-DTE-1ST-SALE    TO K110-DTE-1ST-SALE.           05060002
                                                                        05070002
           MOVE WS-SYS-DATE             TO K110-DTE-KEY-AVAIL           05080002
                                           K110-DTE-ALLOCN              05090002
                                           K110-DTE-ACCEPTANCE          05100002
                                           K110-DTE-LAST-UPD.           05110002
           REWRITE K110-REC.                                            05130002
                                                                        05140002
           IF K110-STATUS = 00                                          05150002
              ADD 1                     TO WS-K110-UPDTE                05160002
           ELSE                                                         05170002
              MOVE K110-STATUS          TO RETURN-CODE                  05180002
              DISPLAY 'ERROR UPDATING BM06K110, ' K110-KEY-FLD          05190002
              GO TO 999-CLOSE-FILES.                                    05200002
                                                                        05210002
       420-EXIT.                                                        05220002
           EXIT.                                                        05230002
                                                                        05240002
                                                                        02620002
      *------------------------*                                                
       430-UPDATE-K840.                                                 05250002
      *------------------------*                                                
           MOVE K800-NUM-REGN           TO K840-NUM-REGN.               05260002
                                                                        05270002
           READ BP13K840.                                               05280002
                                                                        05290002
           IF K840-STATUS = 00                                          05300002
              NEXT SENTENCE                                             05310002
           ELSE                                                         05320002
           IF K840-STATUS = 23                                          05330002
              MOVE SPACES               TO BP13K840-REC                 05340002
              MOVE K800-NUM-REGN        TO K840-NUM-REGN                05350002
              MOVE K800-NUM-NEW-TOWN    TO K840-NUM-NEW-TOWN            05360002
              MOVE K800-NUM-FLAT-TYPE   TO K840-NUM-FLAT-TYPE           05370002
              MOVE K800-NUM-IDP-SCHEME  TO K840-NUM-IDP-SCH             05380002
              MOVE K800-NUM-ALLO-SCHEME TO K840-NUM-ALLOC-SCH           05390002
              MOVE K800-NUM-SCH-ACC     TO K840-NUM-SCH-ACC             05400002
              MOVE 'P13C623'            TO K840-NUM-USERID              05410001
              MOVE K800-NUM-NRIC1       TO K840-NUM-NRIC1               05420002
              MOVE K800-NUM-NRIC2       TO K840-NUM-NRIC2               05430002
              MOVE K800-NUM-NRIC3       TO K840-NUM-NRIC3               05440002
              MOVE K800-NUM-NRIC4       TO K840-NUM-NRIC4               05450002
              MOVE WS-SYS-DATE          TO K840-DTE-ACCEPT1             05460002
              MOVE K800-NUM-SCH-ACC     TO K840-NUM-ACCEPT-FLAT1        05470002
                                                                                
              WRITE BP13K840-REC                                        05480002
              IF K840-STATUS = 00 OR 02                                 05490002
                 ADD 1                  TO WS-K840-WRITE                05500002
                 GO TO 430-EXIT                                         05510002
              ELSE                                                      05520002
                 MOVE K840-STATUS       TO RETURN-CODE                  05530002
                 DISPLAY 'ERROR WRITING IN BP13K840, ' K840-KEY-FLD     05540002
                 GO TO 999-CLOSE-FILES                                  05550002
              END-IF                                                    05560002
           ELSE                                                         05570002
              MOVE K840-STATUS          TO RETURN-CODE                  05580002
              DISPLAY 'ERROR READING BP13K840, ' K840-KEY-FLD           05590002
              GO TO 999-CLOSE-FILES.                                    05600002
                                                                        05610002
           MOVE K800-NUM-REGN           TO K840-NUM-REGN.               05620002
           MOVE K800-NUM-NEW-TOWN       TO K840-NUM-NEW-TOWN.           05630002
           MOVE K800-NUM-FLAT-TYPE      TO K840-NUM-FLAT-TYPE.          05640002
           MOVE K800-NUM-IDP-SCHEME     TO K840-NUM-IDP-SCH.            05650002
           MOVE K800-NUM-ALLO-SCHEME    TO K840-NUM-ALLOC-SCH.          05660002
           MOVE K800-NUM-SCH-ACC        TO K840-NUM-SCH-ACC.            05670002
           MOVE 'P13C623'               TO K840-NUM-USERID.             05680001
                                                                        05690002
           IF K840-DTE-ACCEPT1 = SPACES OR LOW-VALUES                   05700002
              MOVE WS-SYS-DATE          TO K840-DTE-ACCEPT1             05710002
              MOVE K800-NUM-SCH-ACC     TO K840-NUM-ACCEPT-FLAT1        05720002
           ELSE                                                         05730002
           IF K840-DTE-ACCEPT2 = SPACES OR LOW-VALUES                   05740002
              MOVE WS-SYS-DATE          TO K840-DTE-ACCEPT2             05750002
              MOVE K800-NUM-SCH-ACC     TO K840-NUM-ACCEPT-FLAT2        05760002
           ELSE                                                         05770002
           IF K840-DTE-ACCEPT3 = SPACES OR LOW-VALUES                   05780002
              MOVE WS-SYS-DATE          TO K840-DTE-ACCEPT3             05790002
              MOVE K800-NUM-SCH-ACC     TO K840-NUM-ACCEPT-FLAT3.       05800002
                                                                        05810002
           REWRITE BP13K840-REC.                                        05820002
                                                                        05830002
           IF K840-STATUS = 00                                          05840002
              ADD 1                     TO WS-K840-UPDTE                05850002
              GO TO 430-EXIT                                            05860002
           ELSE                                                         05870002
              MOVE K840-STATUS          TO RETURN-CODE                  05880002
              DISPLAY 'ERROR UPDATING BP13K840, ' K840-KEY-FLD          05890002
              GO TO 999-CLOSE-FILES.                                    05900002
                                                                        05910002
       430-EXIT.                                                        05920002
           EXIT.                                                        05930002
                                                                        05940002
                                                                        02620002
      *------------------------*                                                
       440-WRITE-K190.                                                  05950002
      *------------------------*                                                
           MOVE SPACES                  TO K190-REC2.                   05960002
           MOVE K100-REC                TO K190-REC2.                   05970002
           MOVE WS-SYS-DATE             TO K190-2-SYS-DATE.             05980002
           ADD 1                        TO WS-SEC-COUNT.                05990002
           ACCEPT WS-CURR-TIME        FROM TIME.                        06000002
           MOVE CORR WS-CURR-TIME       TO WS-TIME.                     06010002
           MOVE WS-TIME                 TO WS-SYS-TIME.                 06020002
           MOVE WS-SEC-COUNT            TO WS-MICRO-SEC.                06030002
           MOVE WS-EDITED-TIME          TO K190-2-SYS-TIME.             06040002
      *                                                                 06050002
      * TO ADJUST SYS-TIME SO AS TO PREVENT DUPLICATE KEYS              06060002
      *                                                                 06070002
           MOVE WS-EDITED-TIME(1:4)     TO WS-ADJ-TIME.                 06080002
           ADD  1                       TO WS-ADJ-MICRO-SEC.            06090002
           MOVE WS-ADJUST-TIME          TO K190-2-SYS-TIME.             06100002
                                                                        06110002
           MOVE '050000'                TO K190-2-TRANS-TYPE.           06120002
           MOVE 'P13C623'               TO K190-2-USER-ID.              06130001
                                                                        06140002
           WRITE K190-REC2.                                             06150002
                                                                        06160002
           IF K190-STATUS = 00                                          06170002
              ADD 1                     TO WS-K190-WRITE                06180002
           ELSE                                                         06190002
              MOVE K190-STATUS          TO RETURN-CODE                  06200002
              DISPLAY 'ERROR WRITING IN BM06K190, ' K190-KEY            06210002
                      ' COND' K190-STATUS                               06220002
              GO TO 999-CLOSE-FILES.                                    06230002
                                                                        06240002
       440-EXIT.                                                        06250002
           EXIT.                                                        06260002
                                                                        06270002
                                                                        02620002
      *------------------------*                                                
       450-UPDATE-K100.                                                 06280002
      *------------------------*                                                
           IF (COMM8-CDE-TYP-ACTLUSE = '01')                            06320002
               MOVE  1  TO RM-PTR                                       06330002
           ELSE                                                         06340002
           IF (COMM8-CDE-TYP-ACTLUSE = '02')                            06350002
               MOVE  2  TO RM-PTR                                       06360002
           ELSE                                                         06370002
           IF (COMM8-CDE-TYP-ACTLUSE = '03')                            06380002
               MOVE  3  TO RM-PTR                                       06390002
           ELSE                                                         06400002
           IF (COMM8-CDE-TYP-ACTLUSE = '04') AND                        06410002
              (COMM8-CDE-MODL-DESG = '06')                              06420002
               MOVE  5  TO RM-PTR                                       06430002
           ELSE                                                         06440002
           IF (COMM8-CDE-TYP-ACTLUSE = '04')                            06450002
               MOVE  4  TO RM-PTR                                       06460002
           ELSE                                                         06461002
           IF (COMM8-CDE-TYP-ACTLUSE = '05')                            06462002
               MOVE  6  TO RM-PTR                                       06463002
           ELSE                                                         06464002
           IF (COMM8-CDE-TYP-ACTLUSE = '06')                            06465002
               MOVE  7  TO RM-PTR                                       06466002
           ELSE                                                         06467002
           IF (COMM8-CDE-TYP-ACTLUSE = '07')                            06468002
               MOVE  8  TO RM-PTR                                       06469002
           ELSE                                                         06470002
           IF (COMM8-CDE-TYP-ACTLUSE = '08')                            06480002
               MOVE  9  TO RM-PTR.                                      06490002
                                                                        06500002
           SUBTRACT 1                   FROM K100-BAL-ALLOCN(RM-PTR).   06510002
           IF K800-NUM-CAT = '1'                                        06520002
              ADD 1                     TO K100-CAT1-ACCEPT(RM-PTR).    06530002
           IF K800-NUM-CAT = '2'                                        06540002
              ADD 1                     TO K100-CAT2-ACCEPT(RM-PTR).    06550002
           IF K800-NUM-CAT = '3'                                        06560002
              ADD 1                     TO K100-CAT3-ACCEPT(RM-PTR).    06570002
                                                                        06580002
           MOVE K100-CDE-BLK            TO K500-KEY-FLD.                06600002
                                                                        06610002
           READ BB14K500.                                               06620002
                                                                        06630002
           IF   K500-STATUS = ZEROS                                     06640002
                MOVE K500-DTE-LEASE-COMM-FLAT                           06650002
                  TO K100-DTE-1ST-KEY-ISSUE                             06660002
           ELSE                                                         06670002
           IF   K500-STATUS = 23                                        06680002
                DISPLAY 'REC NOT FOUND IN BB14K500 ' K500-KEY-FLD       06690002
                MOVE SPACES TO K100-DTE-1ST-KEY-ISSUE                   06700002
           ELSE                                                         06710002
                DISPLAY 'READ ERROR, BB14K500-STATUS ' K500-STATUS      06720002
                DISPLAY 'K500-KEY-FLD ' K500-KEY-FLD                    06730002
                PERFORM 999-CLOSE-FILES  THRU 999-EXIT.                 06740002
                                                                        06750002
      *--------------------------------------------------------*        06760002
      * C9412XX                                                *        06770002
      * TO UPDATE ALLOC-DTE AND KEY-AVAIL-DTE FOR NEW BLOCK    *        06780002
      * IN BLOCK SUMMARY                                       *        06790002
      *--------------------------------------------------------*        06800002
           IF K100-DTE-1ST-SALE = ZEROS OR SPACES OR LOW-VALUES         06810002
              MOVE K110-DTE-ALLOCN      TO K100-DTE-1ST-SALE.           06820002
                                                                        06830002
           IF K100-DTE-KEY-AVAIL = ZEROS OR SPACES OR LOW-VALUES        06840002
              MOVE K110-DTE-KEY-AVAIL   TO K100-DTE-KEY-AVAIL.          06850002
                                                                        06860002
           REWRITE K100-REC.                                            06870002
                                                                        06880002
           IF K100-STATUS = 00                                          06890002
              ADD 1                     TO WS-K100-UPDTE                06900002
           ELSE                                                         06910002
              MOVE K100-STATUS          TO RETURN-CODE                  06920002
              DISPLAY 'ERROR UPDATING BM06K100, ' K100-KEY-FLD          06930002
              GO TO 999-CLOSE-FILES.                                    06940002
                                                                        06950002
       450-EXIT.                                                        06960002
           EXIT.                                                        06970002
                                                                        06980002
                                                                        02620002
      *------------------------*                                                
       460-UPDATE-K640.                                                         
      *------------------------*                                                
           MOVE K800-NUM-REGN        TO    K640-REGN-NO.                        
                                                                                
           READ BP13K640.                                                       
                                                                                
           EVALUATE K640-STATUS                                                 
             WHEN '23'                                                          
                    PERFORM 470-WRITE-K640 THRU 470-EXIT                        
             WHEN '00'                                                          
                    PERFORM 480-REWRITE-K640 THRU 480-EXIT                      
             WHEN OTHER                                                         
                    DISPLAY 'BP13K640 - FILE   READ ERROR'                      
                    DISPLAY 'STATUS : '  K640-STATUS                            
                    DISPLAY 'KEY : ' K800-NUM-REGN                              
                    PERFORM 999-CLOSE-FILES  THRU 999-EXIT              06740002
           END-EVALUATE.                                                        
                                                                                
       460-EXIT.                                                        06960002
           EXIT.                                                        06970002
                                                                        06980002
                                                                        06980002
      *------------------------*                                                
       470-WRITE-K640.                                                          
      *------------------------*                                                
           MOVE SPACES                   TO BP13K640-TRANS-REC.                 
           INITIALIZE                       BP13K640-TRANS-REC.                 
           MOVE K800-NUM-REGN            TO K640-REGN-NO.                       
           MOVE ZEROES                   TO K640-AMT-ICP-CASH.                  
           MOVE K800-NUM-SCH-ACC         TO K640-SCH-ACC.                       
           MOVE SPACES                   TO K640-DTE-TRANS.                     
           MOVE ZEROES                   TO K640-NUM-PREMIUM-RATE.              
           MOVE K800-NUM-SUBSIDISED-LOAN TO K640-NUM-SUBSIDISED-LOAN.           
           MOVE SPACES                   TO K640-DTE-LOAN-APPROVAL.             
           MOVE ZEROES                   TO K640-AMT-MAX-LOAN                   
                                            K640-AMT-INTEREST-RATE              
                                            K640-AMT-ELIG-INSTAL                
                                            K640-AMT-REPAY-PERIOD.              
           MOVE SPACES                   TO K640-NUM-HPS-CASH1                  
                                            K640-NUM-HPS-CASH2                  
                                            K640-NUM-HPS-CASH3                  
                                            K640-NUM-HPS-CASH4                  
                                            K640-CDE-SA-TP-TAG.                 
           MOVE K800-NUM-ZONE             TO K640-NUM-ZONE.                     
           MOVE F090-DTE-OFFER            TO K640-DTE-LETTER-PRINTED.           
           MOVE F090-DTE-HNDVR            TO K640-DTE-LOAN-APPLN-RETURN.        
                                                                                
           MOVE FUNCTION CURRENT-DATE TO K640-DTE-UPDATE.                       
                                                                                
           MOVE 'BP13C623'                TO K640-USERID.                       
                                                                                
           WRITE    BP13K640-TRANS-REC.                                         
                                                                                
           EVALUATE K640-STATUS                                                 
             WHEN '00'                                                          
                   ADD   1      TO    WS-K640-WRITE                             
             WHEN OTHER                                                         
                    DISPLAY 'BP13K640 - FILE  WRITE ERROR'                      
                    DISPLAY 'STATUS : '  K640-STATUS                            
                    DISPLAY 'KEY : ' K800-NUM-REGN                              
                    PERFORM 999-CLOSE-FILES  THRU 999-EXIT              06740002
           END-EVALUATE.                                                        
                                                                                
       470-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       480-REWRITE-K640.                                                        
      *------------------------*                                                
           MOVE K800-NUM-SUBSIDISED-LOAN TO K640-NUM-SUBSIDISED-LOAN.           
           MOVE F740-NUM-HA-OPT          TO K640-CDE-LOAN-OPTION.               
           MOVE F090-DTE-OFFER           TO K640-DTE-LETTER-PRINTED.            
           MOVE F090-DTE-HNDVR           TO K640-DTE-LOAN-APPLN-RETURN.         
                                                                                
           MOVE FUNCTION CURRENT-DATE    TO K640-DTE-UPDATE.                    
                                                                                
           MOVE 'BP13C623'               TO K640-USERID.                        
                                                                                
           REWRITE    BP13K640-TRANS-REC.                                       
                                                                                
           EVALUATE K640-STATUS                                                 
             WHEN '00'                                                          
                   ADD   1      TO    WS-K640-UPDTE                             
             WHEN OTHER                                                         
                    DISPLAY 'BP13K640 - FILE  WRITE ERROR'                      
                    DISPLAY 'STATUS : '  K640-STATUS                            
                    DISPLAY 'KEY : ' K800-NUM-REGN                              
                    PERFORM 999-CLOSE-FILES  THRU 999-EXIT              06740002
           END-EVALUATE.                                                        
                                                                                
       480-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *------------------------*                                                
       500-PRINT-SUMMARY.                                               07360002
      *------------------------*                                                
           MOVE SPACES                  TO L623-DTL.                    07370001
           ADD  1                       TO WS-SERIAL.                   07380002
           MOVE WS-SERIAL               TO L623-SERIAL.                 07390001
           MOVE F740-NUM-NRIC1          TO L623-NRIC.                   07400001
           MOVE F740-NUM-REGN           TO L623-REGN.                   07410001
           MOVE F090-NUM-SALE-HDB-REF   TO L623-SCH-ACC.                07420001
                                                                        07430002
           STRING 'BLK ' COMM8-NUM-BLK     DELIMITED BY SIZE            07440002
                  ' #'   COMM8-NUM-LEVEL   DELIMITED BY SIZE            07450002
                  '-'    COMM8-NUM-UNIT-MAIN DELIMITED BY SIZE          07460002
                  '-'    COMM8-NUM-UNIT-SUB DELIMITED BY SIZE           07470002
                  ' '    COMM8-NME-STREET  DELIMITED BY '  '            07480002
                  ' S('  COMM8-NUM-POSTAL-CODE DELIMITED BY SIZE        07490002
                  ')'                      DELIMITED BY SIZE            07500002
                  INTO   L623-ADDR.                                     07510001
                                                                        07520002
           IF WS-LINE-CTR > 55 OR WS-SERIAL = 1                         07530002
              PERFORM 510-PRINT-HDG   THRU 510-EXIT.                    07540002
                                                                        07550002
           WRITE BP13L623-REC FROM L623-DTL AFTER 1.                    07560001
           ADD   1                      TO WS-LINE-CTR.                 07570002
                                                                        07580002
       500-EXIT.                                                        07590002
           EXIT.                                                        07600002
                                                                        07610002
                                                                        07610002
      *------------------------*                                                
       510-PRINT-HDG.                                                   07620002
      *------------------------*                                                
           ADD  1                       TO WS-PAGE-CTR.                 07630002
           MOVE WS-PAGE-CTR             TO L623-PAGE.                   07640001
           MOVE WS-SYS-DD               TO L623-DD.                     07650001
           MOVE WS-SYS-MM               TO L623-MM.                     07660001
           MOVE WS-SYS-CC               TO L623-CC.                     07670001
           MOVE WS-SYS-YY               TO L623-YY.                     07670001
                                                                        07680002
           WRITE BP13L623-REC FROM L623-HDG1 AFTER PAGE.                07690001
           WRITE BP13L623-REC FROM L623-HDG2 AFTER 1.                   07700001
           WRITE BP13L623-REC FROM L623-HDG3 AFTER 1.                   07710001
           WRITE BP13L623-REC FROM L623-HDG4 AFTER 2.                   07720001
           WRITE BP13L623-REC FROM L623-DASH AFTER 1.                   07730001
           MOVE  6                      TO WS-LINE-CTR.                 07740002
                                                                        07750002
       510-EXIT.                                                        07760002
           EXIT.                                                        07770002
                                                                        07780002
                                                                        07780002
      *------------------------*                                                
       800-CHECK-MONTH.                                                 07790002
      *------------------------*                                                
                                                                        07800002
           IF WS-EXP-MM > 12                                            07810002
              ADD      1            TO WS-EXP-CCYY                      07820002
              SUBTRACT 12           FROM WS-EXP-MM                      07830002
              PERFORM 805-CHECK-DAY THRU 805-EXIT                       07840002
           ELSE                                                         07850002
              PERFORM 805-CHECK-DAY THRU 805-EXIT.                      07860002
                                                                        07920002
       800-EXIT.                                                        07930002
           EXIT.                                                        07940002
                                                                        07950002
                                                                        07780002
      *------------------------*                                                
       805-CHECK-DAY.                                                   07960002
      *------------------------*                                                
           IF WS-31-DAY-MONTH                                           07980002
              IF (WS-EXP-DD >= 32)                                      07990002
                 MOVE 31 TO WS-EXP-DD                                   08000002
              END-IF                                                    08010002
           ELSE                                                         08020002
           IF WS-30-DAY-MONTH                                           08030002
              IF (WS-EXP-DD >= 31)                                      08040002
                 MOVE 30 TO WS-EXP-DD                                   08050002
              END-IF                                                    08060002
           ELSE                                                         08070002
           IF WS-28-29-DAY-MONTH                                        08080002
              IF (WS-EXP-DD >= 29)                                      08090002
                  PERFORM 810-CHECK-FEB                                 08100002
                     THRU 810-EXIT                                      08110002
              END-IF                                                    08120002
           END-IF.                                                      08130002
                                                                        08140002
       805-EXIT.                                                        08150002
           EXIT.                                                        08160002
                                                                        08170002
                                                                        07780002
      *------------------------*                                                
       810-CHECK-FEB.                                                   08180002
      *------------------------*                                                
           DIVIDE WS-EXP-CCYY BY 4 GIVING WS-YEAR REMAINDER WS-REM.     08200002
                                                                        08210002
           IF (WS-REM = 0) AND (WS-EXP-DD > 29)                         08220002
               MOVE 29 TO WS-EXP-DD                                     08230002
           ELSE                                                         08240002
           IF (WS-REM IS NOT = 0) AND (WS-EXP-DD > 28)                  08250002
               MOVE 28 TO WS-EXP-DD.                                    08260002
                                                                        08270002
       810-EXIT.                                                        08280002
           EXIT.                                                        08290002
                                                                        08300002
                                                                        07780002
      *------------------------*                                                
       999-CLOSE-FILES.                                                 08310002
      *------------------------*                                                
           CLOSE BB22F090                                               08320002
                 BP13F740                                               08330002
                 BB14K500                                               08340002
                 BP13K800                                               08350002
                 BP13K840                                               08360002
                 BM06K100                                               08380002
                 BM06K110                                               08390002
                 BM06K190                                               08400002
                 BP13L623.                                              08410001
                                                                        08420002
           DISPLAY SPACES.                                              08430002
           DISPLAY '*================ BP13C623 ================*'.      08440001
           DISPLAY '    NO. OF F090  READ           = ' WS-F090-READ.   08450002
           DISPLAY '    NO. OF F740  READ           = ' WS-F740-READ.   08460002
           DISPLAY '    NO. OF K800  UPDATE         = ' WS-K800-UPDTE.  08470002
           DISPLAY '    NO. OF K110  UPDATE         = ' WS-K110-UPDTE.  08480002
           DISPLAY '    NO. OF K840  WRITE          = ' WS-K840-WRITE.  08490002
           DISPLAY '    NO. OF K840  UPDATE         = ' WS-K840-UPDTE.  08500002
           DISPLAY '    NO. OF K190  WRITE          = ' WS-K190-WRITE.  08510002
           DISPLAY '    NO. OF K100  UPDATE         = ' WS-K100-UPDTE.  08520002
           DISPLAY '    NO. OF K640  WRITE          = ' WS-K640-WRITE.  08490002
           DISPLAY '    NO. OF K640  UPDATE         = ' WS-K640-UPDTE.  08490002
           DISPLAY '*==========================================*'.      08550002
                                                                        08560002
           STOP RUN.                                                    08570002
                                                                        08580002
        999-EXIT.                                                       08590002
            EXIT.                                                       08600002
