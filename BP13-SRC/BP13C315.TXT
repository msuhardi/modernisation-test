      *-------------------------*                                               
       IDENTIFICATION DIVISION.                                                 
      *-------------------------*                                               
       PROGRAM-ID.    BP13C315.                                                 
      *AUTHOR.        SHARON DUMDUM.                                            
      *DATE-WRITTEN.  21/07/2004.                                               
                                                                                
      * ========================================================= *             
      *                SYSTEM OF COMMITMENT  (BP13)               *             
      * ========================================================= *             
      *    OBJECTIVE :                                            *             
      *      1. TO PRINT THE OUTSTANDING CASES FOR STAMPING       *             
      *         > 1 MTHS (FOR CONCESSIONARY AND BANK LOAN         *             
      *         SUB-TRANSFER CASES)                               *             
      *                                                           *             
      *    I/O FILES :                                            *             
      *       INPUT  :  BP13F800 -                                *             
      *                 BP13K022 - OIC    FILE                    *             
      *      OUTPUT  :  BP13L315 - PRINT  FILE                    *             
      *                                                           *             
      *    FUNCTION :                                             *             
      *      1. BATCH PROGRAMMING IN COBOL                        *             
      *      2. PRINT LISTINGS OF OUTSTANDING CASES FOR STAMPING  *             
      *                                                           *             
      * ========================================================= *             
      * CHGE-NO  DATE     BY   DESCRIPTIONS                       *             
      * -------- -------- ---  ------------                       *             
      * BP132561 21/07/04 SSD  NEW PROGRAM                        *             
      * BP132734 05/10/05 JF4  MONITOR 30 DAYS                    *             
      * BP134779 13/06/13 PCL4 TO CONVERT THE REPORT TO SENDMAIL  *             
      * BP135537 14/10/15 RJB1 CHANGE THE EMAIL RECIPIENT FROM    *             
      *                        NICKNAME INTO COMPLETE NAME        *             
      * BP136477 18/10/16 RJB1 TO REPLACE KIM HUAT TO YEE MIEN    *             
      * BP136625 01/02/17 RJB1 REMOVE NORMALA BUANG, INCLUDE CHANDRA            
      *                        ARUMUGAM AND MEENACHI              *             
      * BP137087 17/11/17 PCL4 TO UPDATE EMAIL RECIPIENTS         *             
      * BP137150 04/01/18 PCL4 TO UPDATE EMAIL RECIPIENTS         *             
      * BP137155 08/01/18 PCL4 TO UPDATE EMAIL RECIPIENTS         *             
      * BP138757 23/07/21 KV8  REPLACEING KATHIJAH TO SUZANNE     *             
      * BP139030 07/01/22 ZAR7 REPLACE CHUA YEE MIEN TO LIM KOK CHUN            
      * BP139159 13/06/22 KAC1 ADDED oh_meng_huat@hdb.gov.sg      *             
      *                              zoe_sm_aw@hdb.gov.sg         *             
      *                              ngai_chyau_jiann@hdb.gov.sg  *             
      *                              jocelyn_wt_seah@hdb.gov.sg   *             
      * BP139195 27/06/22 RJB1 REMOVE AFIQAH INCLUDE KATHIJAH                   
      * BP139177 16/08/22 KAR1 TO BYPASS CF-TYPE = 'NA'                         
      * BP139276 05/04/24 KAC1 REPLACE LIM KOK CHUN BY            *             
      *                                KATHIJAH_BEE_ALI_MOHAMED   *             
      * ========================================================= *             
                                                                                
      *----------------------*                                                  
       ENVIRONMENT DIVISION.                                                    
      *----------------------*                                                  
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.   IBM-3090.                                             
       OBJECT-COMPUTER.   IBM-3090.                                             
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K022  ASSIGN        TO BP13K022                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K022-KEY-FLD                       
                            ALTERNATE KEY IS K022-NUM-REGN                      
                            FILE STATUS   IS WS-K022-STATUS.                    
                                                                                
           SELECT BP13F800  ASSIGN        TO BP13F800.                          
                                                                                
           SELECT BP13L315  ASSIGN        TO BP13L315.                          
                                                                                
                                                                                
      *---------------*                                                         
       DATA DIVISION.                                                           
      *---------------*                                                         
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   BP13K022.                                                           
       COPY BP13K022.                                                           
                                                                                
       FD   BP13F800                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            RECORDING MODE IS F.                                                
       COPY BP13F800.                                                           
                                                                                
       FD   BP13L315                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 132 CHARACTERS.                                     
       01   BP13L315-REC         PIC X(132).                                    
                                                                                
                                                                                
      *-----------------------*                                                 
       WORKING-STORAGE SECTION.                                                 
      *-----------------------*                                                 
                                                                                
       01  WS-EMAIL-RPT-VARIABLES.                                              
           05  WS-DATE-RPT-DTL.                                                 
               10 FILLER                PIC X(6)  VALUE 'DATE: '.               
               10 WS-DATE-RPT           PIC X(10) VALUE SPACES.                 
           05  WS-MAIL-RPT1             PIC X(12) VALUE 'HELO SGPHDB1'.         
           05  WS-MAIL-RPT2             PIC X(27)                               
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                                
           05  WS-MAIL-RPT3             PIC X(60) VALUE                         
               'RCPT TO:<BALASUBRAMANIAM_ARUNASALAM@HDB.GOV.SG>'.               
           05  WS-MAIL-RPT4             PIC X(60) VALUE                         
               'RCPT TO:<NOORJAHAN_SHAIK_MOHAMED_GULEMKADER@HDB.GOV.SG>'        
               .                                                                
           05  WS-MAIL-RPT5             PIC X(60)                               
               VALUE 'RCPT TO:<MUHAMMED_SHARIFF_SAHROM@HDB.GOV.SG>'.            
           05  WS-MAIL-RPT6             PIC X(60)                               
               VALUE 'RCPT TO:<CHANDRA_LAGHA_ARUMUGAM@HDB.GOV.SG>'.             
           05  WS-MAIL-RPT7             PIC X(60)                               
               VALUE 'RCPT TO:<SUZANNE_SC_HENG@HDB.GOV.SG>'.                    
           05  WS-MAIL-RPT7A            PIC X(60)                               
               VALUE 'RCPT TO:<KATHIJAH_BEE_ALI_MOHAMED@HDB.GOV.SG>'.           
      *        VALUE 'RCPT TO:<NUR_AFIQAH_SASMAN@HDB.GOV.SG>'.                  
           05  WS-MAIL-RPT7B            PIC X(60)                               
               VALUE 'RCPT TO:<PHNG_BEE_LUAN@HDB.GOV.SG>'.                      
           05  WS-MAIL-RPT7C            PIC X(60)                               
               VALUE 'RCPT TO:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.           
           05  WS-MAIL-RPT7D            PIC X(60)                               
               VALUE 'RCPT TO:<oh_meng_huat@hdb.gov.sg>'.                       
           05  WS-MAIL-RPT7E            PIC X(60)                               
               VALUE 'RCPT TO:<zoe_sm_aw@hdb.gov.sg>'.                          
           05  WS-MAIL-RPT7F            PIC X(60)                               
               VALUE 'RCPT TO:<ngai_chyau_jiann@hdb.gov.sg>'.                   
           05  WS-MAIL-RPT7G            PIC X(60)                               
               VALUE 'RCPT TO:<jocelyn_wt_seah@hdb.gov.sg>'.                    
           05  WS-MAIL-RPT8             PIC X(4)                                
               VALUE 'DATA'.                                                    
           05  WS-MAIL-RPT9             PIC X(40)                               
               VALUE 'FROM:Soc System - Email Alert'.                           
           05  WS-MAIL-RPT10            PIC X(60) VALUE                         
               'TO:<BALASUBRAMANIAM_ARUNASALAM@HDB.GOV.SG>'.                    
           05  WS-MAIL-RPT11            PIC X(60) VALUE                         
               'TO:<NOORJAHAN_SHAIK_MOHAMED_GULEMKADER@HDB.GOV.SG>'.            
           05  WS-MAIL-RPT12            PIC X(60)                               
               VALUE 'TO:<MUHAMMED_SHARIFF_SAHROM@HDB.GOV.SG>'.                 
           05  WS-MAIL-RPT13A           PIC X(60)                               
               VALUE 'TO:<CHANDRA_LAGHA_ARUMUGAM@HDB.GOV.SG>'.                  
           05  WS-MAIL-RPT13B           PIC X(60)                               
               VALUE 'TO:<SUZANNE_SC_HENG@HDB.GOV.SG>'.                         
           05  WS-MAIL-RPT13C           PIC X(60)                               
               VALUE 'TO:<KATHIJAH_BEE_ALI_MOHAMED@HDB.GOV.SG>'.                
      *        VALUE 'TO:<NUR_AFIQAH_SASMAN@HDB.GOV.SG>'.                       
           05  WS-MAIL-RPT13D           PIC X(60)                               
               VALUE 'TO:<PHNG_BEE_LUAN@HDB.GOV.SG>'.                           
           05  WS-MAIL-RPT13E           PIC X(60)                               
               VALUE 'TO:<oh_meng_huat@hdb.gov.sg>'.                            
           05  WS-MAIL-RPT13F           PIC X(60)                               
               VALUE 'TO:<zoe_sm_aw@hdb.gov.sg>'.                               
           05  WS-MAIL-RPT13G           PIC X(60)                               
               VALUE 'TO:<ngai_chyau_jiann@hdb.gov.sg>'.                        
           05  WS-MAIL-RPT13H           PIC X(60)                               
               VALUE 'TO:<jocelyn_wt_seah@hdb.gov.sg>'.                         
           05  WS-MAIL-RPT13I           PIC X(60)                               
               VALUE 'CC:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.                
           05  WS-MAIL-RPT15            PIC X(100) VALUE                        
               'SUBJECT : LIST OF OUTSTANDING CASES (SA)/TP/SUBT'.              
                                                                                
      *-----------------------------------------------------------*             
      *    DEFINE BP13L315               HEADING LINES            *             
      *-----------------------------------------------------------*             
       01  PRT-L315-HDG-1.                                                      
           05  L315-REPORT-ID       PIC X(8)  VALUE 'BP13L315'.                 
           05  FILLER               PIC X(10) VALUE '      HDB3'.               
           05  FILLER               PIC X(27) VALUE SPACES.                     
           05  FILLER               PIC X(39) VALUE                             
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER               PIC X(14) VALUE SPACES.                     
           05  FILLER               PIC X(7)  VALUE 'DATE : '.                  
           05  L315-CURRENT-DATE    PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(4)  VALUE SPACES.                     
           05  FILLER               PIC X(7)  VALUE 'PAGE : '.                  
           05  L315-PAGE            PIC ZZZZ9.                                  
                                                                                
       01  PRT-L315-HDG-2.                                                      
           05  FILLER               PIC X(11) VALUE SPACES.                     
           05  FILLER               PIC X(51) VALUE                             
               'SUMMARY LIST OF OUTSTANDING CASES FOR STAMPING > 1 '.           
           05  FILLER               PIC X(39) VALUE                             
               'MONTH (FOR CONCESSIONARY AND BANK LOAN '.                       
           05  FILLER               PIC X(19) VALUE                             
               'SUB-TRANSFER CASES)'.                                           
                                                                                
       01  PRT-L315-HDG-4.                                                      
           05  FILLER               PIC X(04) VALUE 'S/NO'.                     
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  FILLER               PIC X(08) VALUE 'REGN  NO'.                 
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  FILLER               PIC X(11) VALUE 'SCH ACCT NO'.              
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  FILLER               PIC X(35) VALUE 'FLAT ADDRESS'.             
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  FILLER               PIC X(15) VALUE 'PRINC SA DATE  '.          
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  FILLER               PIC X(07) VALUE 'CF TYPE'.                  
           05  FILLER               PIC X(03) VALUE SPACES.                     
           05  FILLER               PIC X(03) VALUE 'OIC'.                      
                                                                                
       01  L315-BLANK-LINE          PIC X(132) VALUE SPACES.                    
                                                                                
       01  L315-UNDER-LINE          PIC X(132) VALUE ALL '-'.                   
                                                                                
       01  PRT-L315-NO-CASE.                                                    
           05  FILLER               PIC X(50)  VALUE SPACES.                    
           05  FILLER               PIC X(31)  VALUE                            
               '*******  N O   C A S E  *******'.                               
                                                                                
       01  PRT-L315-DTL-1.                                                      
           05  L315-SEQ-NO          PIC ZZZ9  VALUE ZEROES.                     
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  L315-REGN-NO         PIC X(08) VALUE SPACES.                     
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  L315-SCH-ACC         PIC X(11) VALUE SPACES.                     
           05  FILLER               PIC X(04) VALUE SPACES.                     
           05  L315-FLAT-ADD1       PIC X(35) VALUE SPACES.                     
           05  FILLER               PIC X(05) VALUE SPACES.                     
           05  L315-ST-DTE          PIC X(10) VALUE SPACES.                     
           05  FILLER               PIC X(11) VALUE SPACES.                     
           05  L315-CF-TYPE         PIC X(02) VALUE SPACES.                     
           05  FILLER               PIC X(05) VALUE SPACES.                     
           05  L315-NUM-OIC         PIC X(05) VALUE SPACES.                     
                                                                                
       01  PRT-L315-DTL-2.                                                      
           05  FILLER               PIC X(36) VALUE SPACES.                     
           05  L315-FLAT-ADD2       PIC X(35) VALUE SPACES.                     
                                                                                
      *-----------------------------------------------------------*             
      *    OTHER VARIABLES                                        *             
      *-----------------------------------------------------------*             
       01  WS-COUNTERS.                                                         
           05  WS-BP13F800-READ-CNT         PIC 9(6)       VALUE ZEROS.         
           05  WS-BP13F800-PROC-CNT         PIC 9(6)       VALUE ZEROS.         
           05  WS-BP13K022-READ-CNT         PIC 9(6)       VALUE ZEROS.         
           05  WS-F800-READ-CNT             PIC Z,ZZ,ZZ9   VALUE ZEROS.         
           05  WS-K022-READ-CNT             PIC Z,ZZ,ZZ9   VALUE ZEROS.         
           05  WS-PRINT-CNT                 PIC Z,ZZ,ZZ9   VALUE ZEROS.         
           05  WS-SKIP-CNT                  PIC 9(5)       VALUE ZEROS.         
           05  WS-LINE-CNT                  PIC 9(2)       VALUE 99.            
           05  WS-PAGE-CNT                  PIC 9(5)       VALUE ZEROS.         
           05  WS-SEQ-NO                    PIC 9(5)       VALUE ZEROS.         
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  WS-K022-STATUS               PIC 9(2)   VALUE ZEROES.            
           05  EOF-F800                     PIC X      VALUE 'N'.               
                                                                                
       01  WS-FUNC-CUR-DTE                  PIC 9(9).                           
       01  WS-FUNC-TRF-DTE                  PIC 9(9).                           
       01  WS-DATE-DIFF                     PIC 9(9).                           
                                                                                
       01  WS-EDIT-DTE.                                                         
           05  WS-EDIT-DD                   PIC X(2).                           
           05  FILLER                       PIC X(1) VALUE '/'.                 
           05  WS-EDIT-MM                   PIC X(2).                           
           05  FILLER                       PIC X(1) VALUE '/'.                 
           05  WS-EDIT-CCYY                 PIC X(4).                           
                                                                                
       01  WS-CUR-DATE.                                                         
           05  WS-CUR-CY                    PIC 9(4).                           
           05  WS-CUR-MM                    PIC 9(2).                           
           05  WS-CUR-DD                    PIC 9(2).                           
       01  WS-CUR-DATE-9 REDEFINES                                              
               WS-CUR-DATE                  PIC 9(8).                           
                                                                                
       01  WS-SUBTRF-DATE.                                                      
           05  WS-SUBTRF-CY                 PIC 9(4).                           
           05  WS-SUBTRF-MM                 PIC 9(2).                           
           05  WS-SUBTRF-DD                 PIC 9(2).                           
       01  WS-SUBTRF-DATE-9 REDEFINES                                           
               WS-SUBTRF-DATE               PIC 9(8).                           
                                                                                
       01  WS-ADDRESS1.                                                         
           05  FILLER                       PIC X(05) VALUE 'BLOCK'.            
           05  WS-BLK-NO                    PIC X(05) VALUE SPACES.             
           05  FILLER                       PIC X(02) VALUE ' ,'.               
           05  WS-ST-NAME                   PIC X(20) VALUE SPACES.             
                                                                                
       01  WS-ADDRESS2.                                                         
           05  FILLER                       PIC X(02) VALUE '# '.               
           05  WS-LEVEL-NO                  PIC X(02) VALUE SPACES.             
           05  FILLER                       PIC X(03) VALUE ' - '.              
           05  WS-MAIN-UNIT                 PIC X(04) VALUE SPACES.             
           05  FILLER                       PIC X(03) VALUE ' , '.              
           05  FILLER                       PIC X(09) VALUE 'SINGAPORE'.        
           05  FILLER                       PIC X(02) VALUE ' ('.               
           05  WS-COUNTRY-POSTCDE           PIC X(06) VALUE SPACES.             
           05  FILLER                       PIC X(01) VALUE ')'.                
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      ***LINKAGE FOR BP13C913*                                                  
       01  WS-LINK-REC.                                                         
           05 WS-LINK-NUM-SCH-ACC.                                              
              10 WS-LINK-NUM-SCH        PIC X(4).                               
              10 WS-LINK-NUM-ACC        PIC X(5).                               
                                                                                
                                                                                
      *------------------*                                                      
       PROCEDURE DIVISION.                                                      
      *------------------*                                                      
      ******************************************************************        
       0000-CONTROL.                                                            
      ******************************************************************        
            PERFORM  0100-SET-DATE               THRU  0100-EXIT.               
            PERFORM  0200-OPEN-FILES             THRU  0200-EXIT.               
            PERFORM  0300-READ-BP13F800          THRU  0300-EXIT                
                          UNTIL EOF-F800 = 'Y'.                                 
            PERFORM  0890-CHK-REPORT-STATUS      THRU  0890-EXIT.               
            PERFORM  0900-DISPLAY-STATISTICS     THRU  0900-EXIT.               
            PERFORM  9999-CLOSE-FILES            THRU  9999-EXIT.               
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0100-SET-DATE.                                                           
      ******************************************************************        
            STRING  FUNCTION CURRENT-DATE(7:2) '/'                              
                    FUNCTION CURRENT-DATE(5:2) '/'                              
                    FUNCTION CURRENT-DATE(1:4)                                  
            DELIMITED BY SIZE INTO L315-CURRENT-DATE.                           
                                                                                
       0100-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0200-OPEN-FILES.                                                         
      ******************************************************************        
            OPEN INPUT  BP13F800                                                
                        BP13K022                                                
                 OUTPUT BP13L315.                                               
                                                                                
            IF WS-K022-STATUS NOT = 00 AND 97                                   
               DISPLAY 'OPENING ERROR BP13K022 ' WS-K022-STATUS                 
               PERFORM 0900-DISPLAY-STATISTICS   THRU  0900-EXIT                
               PERFORM 9999-CLOSE-FILES          THRU  9999-EXIT                
            END-IF.                                                             
                                                                                
            PERFORM 5000-HEADER-EMAIL            THRU 5000-EXIT.                
                                                                                
       0200-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0300-READ-BP13F800.                                                      
      ******************************************************************        
            READ BP13F800                                                       
              AT END                                                            
                 MOVE    'Y'  TO EOF-F800                                       
                 GO TO   0300-EXIT.                                             
                                                                                
            ADD 1 TO WS-BP13F800-READ-CNT.                                      
                                                                                
            PERFORM  0500-CHECK-DATE         THRU  0500-EXIT.                   
                                                                                
            ADD 1 TO WS-BP13F800-PROC-CNT.                                      
                                                                                
       0300-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0500-CHECK-DATE.                                                         
      ******************************************************************        
            MOVE   FUNCTION CURRENT-DATE   TO   WS-CUR-DATE.                    
                                                                                
      *     DISPLAY '****************************************'.                 
      *     DISPLAY 'NUM-REGN      = ' F800-NUM-REGN.                           
      *     DISPLAY 'DTE-SUBTR-EFF = ' F800-DTE-SUBTR-EFF.                      
      *     DISPLAY 'DTE-PRIN-SA   = ' F800-DTE-PRINCIPAL-SALES-AGMT.           
      *     DISPLAY 'DTE-SUB-TRF   = ' F800-DTE-SUB-TRANSFER.                   
      *     DISPLAY 'NUM-SUB-TRF   = ' F800-NUM-SUB-TRANSFER.                   
                                                                                
      *----------------------------------------------------------*              
      *     TO USE F800-DTE-PRINCIPAL-SALES-AGMT FOR COMPUTATION                
      *     AS IT IS THE DAY WHERE THE DOC IS RAISED.                           
      *----------------------------------------------------------*              
            IF F800-DTE-PRINCIPAL-SALES-AGMT = SPACES  OR '00000000' OR         
                                               LOW-VALUES                       
               MOVE '19960101'                    TO WS-SUBTRF-DATE             
            ELSE                                                                
               MOVE F800-DTE-PRINCIPAL-SALES-AGMT TO WS-SUBTRF-DATE             
            END-IF.                                                             
                                                                                
            COMPUTE  WS-FUNC-CUR-DTE =                                          
                     FUNCTION INTEGER-OF-DATE(WS-CUR-DATE-9).                   
            COMPUTE  WS-FUNC-TRF-DTE =                                          
                     FUNCTION INTEGER-OF-DATE(WS-SUBTRF-DATE-9).                
                                                                                
            COMPUTE WS-DATE-DIFF = WS-FUNC-CUR-DTE - WS-FUNC-TRF-DTE.           
                                                                                
      ******  THE DIFFERENCE OF 30 DAYS IS TAKEN TO SORT CASES WHOSE            
      *****   KEY ISSUE DATE IS 1 MTH PRIOR TO CURRENT DATE.                    
                                                                                
      *------------------------------------------------------------*            
      * USE 60 DAYS TO DENOTE > 1 MTH.                                          
      *------------------------------------------------------------*            
                                                                                
            IF F800-NUM-CF-TYPE = 'NA'                                          
               ADD 1 TO WS-SKIP-CNT                                             
               CONTINUE                                                         
            ELSE                                                                
            IF WS-DATE-DIFF >= 30                                               
               PERFORM 0600-PRINT-LISTING  THRU   0600-EXIT                     
            ELSE                                                                
               ADD 1 TO WS-SKIP-CNT                                             
               CONTINUE                                                         
            END-IF.                                                             
                                                                                
       0500-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0600-PRINT-LISTING.                                                      
      ******************************************************************        
            IF WS-LINE-CNT > 50                                                 
               PERFORM  0650-PRINT-HEADING     THRU   0650-EXIT                 
            END-IF.                                                             
                                                                                
            ADD         1                      TO     WS-SEQ-NO.                
            ADD         2                      TO     WS-LINE-CNT.              
            MOVE        WS-SEQ-NO              TO     L315-SEQ-NO.              
            PERFORM     0700-MOVE-DATA         THRU   0700-EXIT.                
            WRITE       BP13L315-REC           FROM   L315-BLANK-LINE.          
            WRITE       BP13L315-REC           FROM   PRT-L315-DTL-1.           
            WRITE       BP13L315-REC           FROM   PRT-L315-DTL-2.           
                                                                                
       0600-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0650-PRINT-HEADING.                                                      
      ******************************************************************        
            ADD    1             TO    WS-PAGE-CNT.                             
            MOVE   WS-PAGE-CNT   TO    L315-PAGE.                               
            MOVE   7             TO    WS-LINE-CNT.                             
            WRITE  BP13L315-REC  FROM  PRT-L315-HDG-1 AFTER PAGE.               
            WRITE  BP13L315-REC  FROM  PRT-L315-HDG-2.                          
            WRITE  BP13L315-REC  FROM  L315-BLANK-LINE.                         
            WRITE  BP13L315-REC  FROM  PRT-L315-HDG-4.                          
            WRITE  BP13L315-REC  FROM  L315-UNDER-LINE.                         
                                                                                
       0650-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0700-MOVE-DATA.                                                          
      ******************************************************************        
            PERFORM  0800-GET-ADDRESS        THRU  0800-EXIT.                   
            PERFORM  0850-READ-BP13K022      THRU  0850-EXIT.                   
                                                                                
            MOVE   F800-NUM-REGN           TO    L315-REGN-NO.                  
            MOVE   F800-NUM-SCH-ACC        TO    L315-SCH-ACC.                  
            MOVE   F800-DTE-PRINCIPAL-SALES-AGMT(1:4) TO WS-EDIT-CCYY.          
            MOVE   F800-DTE-PRINCIPAL-SALES-AGMT(5:2) TO WS-EDIT-MM.            
            MOVE   F800-DTE-PRINCIPAL-SALES-AGMT(7:2) TO WS-EDIT-DD.            
            MOVE   WS-EDIT-DTE             TO    L315-ST-DTE.                   
            MOVE   F800-NUM-CF-TYPE        TO    L315-CF-TYPE.                  
            MOVE   K022-NUM-OIC            TO    L315-NUM-OIC.                  
                                                                                
       0700-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0800-GET-ADDRESS.                                                        
      ******************************************************************        
           MOVE SPACES                 TO BP13COMM8-REC.                        
           INITIALIZE                     BP13COMM8-REC.                        
                                                                                
           MOVE F800-NUM-SCH-ACC       TO WS-LINK-REC.                          
                                                                                
           CALL 'BP13C913' USING WS-LINK-REC,                                   
                                BP13COMM8-REC.                                  
                                                                                
           IF (COMM8-CDE-SYSERR = 0) AND                                        
              (COMM8-NUM-MGMT   NOT = SPACES)                                   
              MOVE COMM8-NUM-BLK         TO WS-BLK-NO                           
              MOVE COMM8-NME-STREET      TO WS-ST-NAME                          
              MOVE COMM8-NUM-UNIT-MAIN   TO WS-MAIN-UNIT                        
              MOVE COMM8-NUM-LEVEL       TO WS-LEVEL-NO                         
              MOVE COMM8-NUM-POSTAL-CODE TO WS-COUNTRY-POSTCDE                  
              MOVE WS-ADDRESS1           TO L315-FLAT-ADD1                      
              MOVE WS-ADDRESS2           TO L315-FLAT-ADD2                      
           ELSE                                                                 
              DISPLAY 'ERROR CALLING BP13C913 '                                 
              DISPLAY 'SQL CODE = ' COMM8-CDE-SYSERR                            
              MOVE SPACES                TO L315-FLAT-ADD1                      
              MOVE SPACES                TO L315-FLAT-ADD2                      
           END-IF.                                                              
                                                                                
       0800-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0850-READ-BP13K022.                                                      
      ******************************************************************        
            MOVE   SPACES          TO   K022-KEY-FLD.                           
            MOVE   F800-NUM-REGN   TO   K022-NUM-REGN.                          
                                                                                
            READ BP13K022 KEY IS K022-NUM-REGN.                                 
                                                                                
            EVALUATE WS-K022-STATUS                                             
               WHEN 00                                                          
               WHEN 02                                                          
                  ADD    1         TO   WS-BP13K022-READ-CNT                    
               WHEN 23                                                          
                  DISPLAY 'BP13K022 REC NOT FOUND : ' K022-NUM-REGN             
               WHEN OTHER                                                       
                  DISPLAY 'BP13K022 - READ ERROR, STATUS '                      
                                                     WS-K022-STATUS             
                  MOVE     WS-K022-STATUS      TO   RETURN-CODE                 
                  PERFORM 9999-CLOSE-FILES     THRU 9999-EXIT                   
            END-EVALUATE.                                                       
                                                                                
       0850-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0890-CHK-REPORT-STATUS.                                                  
      ******************************************************************        
           IF WS-SEQ-NO = ZERO                                                  
              PERFORM 0650-PRINT-HEADING THRU 0650-EXIT                         
              WRITE   BP13L315-REC       FROM PRT-L315-NO-CASE AFTER 25         
           END-IF.                                                              
                                                                                
       0890-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       5000-HEADER-EMAIL.                                                       
      *================================================================*        
                                                                                
            WRITE BP13L315-REC FROM WS-MAIL-RPT1.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT2.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT3.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT4.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT5.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT6.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT7.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT7A.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7B.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7C.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7D.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7E.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7F.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT7G.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT8.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT9.                               
            WRITE BP13L315-REC FROM WS-MAIL-RPT10.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT11.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT12.                              
            WRITE BP13L315-REC FROM WS-MAIL-RPT13A.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13B.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13C.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13D.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13E.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13F.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13G.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13H.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT13I.                             
            WRITE BP13L315-REC FROM WS-MAIL-RPT15.                              
            MOVE L315-CURRENT-DATE TO WS-DATE-RPT.                              
            WRITE BP13L315-REC FROM WS-DATE-RPT-DTL.                            
                                                                                
            MOVE SPACES TO  BP13L315-REC.                                       
            WRITE   BP13L315-REC.                                               
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       0900-DISPLAY-STATISTICS.                                                 
      ******************************************************************        
            MOVE    WS-BP13F800-READ-CNT  TO  WS-F800-READ-CNT.                 
            MOVE    WS-BP13K022-READ-CNT  TO  WS-K022-READ-CNT.                 
            MOVE    WS-SEQ-NO             TO  WS-PRINT-CNT.                     
                                                                                
            DISPLAY '************* BP13C315 ******************'.                
            DISPLAY ' RECORDS READ FROM BP13F800  : ' WS-F800-READ-CNT.         
            MOVE    WS-BP13F800-PROC-CNT  TO  WS-F800-READ-CNT.                 
            DISPLAY ' RECORDS PROCESSED FROM F800 : ' WS-F800-READ-CNT.         
            DISPLAY ' RECORDS READ FROM BP13K022  : ' WS-K022-READ-CNT.         
            DISPLAY ' NO OF RECORDS >= 30 DAYS    : ' WS-PRINT-CNT.             
            DISPLAY ' NO OF RECORDS <  30 DAYS    : ' WS-SKIP-CNT.              
                                                                                
       0900-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      ******************************************************************        
       9999-CLOSE-FILES.                                                        
      ******************************************************************        
            CLOSE  BP13F800                                                     
                   BP13K022                                                     
                   BP13L315.                                                    
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'ERROR CLOSING BP13K022, STAT = ' WS-K022-STATUS          
              MOVE     WS-K022-STATUS      TO  RETURN-CODE                      
           END-IF.                                                              
                                                                                
            STOP RUN.                                                           
                                                                                
       9999-EXIT.                                                               
            EXIT.                                                               
