      *--------------------------------------------------------*                
       IDENTIFICATION DIVISION.                                                 
      *--------------------------------------------------------*                
       PROGRAM-ID.   BP13C149.                                                  
      *AUTHOR.       SK.                                                        
      *DATE-WRITTEN. 23/09/2003.                                                
      *--------------------------------------------------------*                
      *                                                        *                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT  (SOC)           *                
      *                                                        *                
      *    SYSTEM ID   : BP13                                  *                
      *                                                        *                
      *    OBJECTIVES  : MATCHING & UPDATING BP13K740          *                
      *                                                        *                
      *    INPUT FILES  : BP13F740                             *                
      *                   BP13K740                             *                
      *                                                        *                
      *    OUPUT FILES  : BP13L149                             *                
      *--------------------------------------------------------*                
      * CHG-NO  BY   DATE      DETAILS                         *                
      *-------- ---- --------  --------------------------------*                
      *BP132412 SK   20030923  NEW PGM                         *                
      *BP132412 SK   20031017  ADD BP13K595                    *                
      *BP132463 CKK  20031227  TO CHECK FOR BE PRIORITY CASE   *                
      *BP132596 CKK  20041004  TO UPDATE ELIG-SCH TO PA        *                
      *BP132653 CKK  20050215  TO UPDATE ELIG-SCH FOR TCP ONLY *                
      *BP132756 CKK  20051015  TO CHECK FOR ALLOCATION SCH     *                
      *--------------------------------------------------------*                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F740   ASSIGN TO BP13F740.                                
                                                                                
           SELECT BP13K740   ASSIGN TO BP13K740                                 
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K740-KEY-FLD                      
                             FILE STATUS   IS WS-K740-STATUS.                   
                                                                                
           SELECT BP13K520   ASSIGN TO BP13K520                                 
                             ORGANIZATION  IS INDEXED                           
                             ACCESS MODE   IS DYNAMIC                           
                             RECORD KEY    IS K520-KEY-NEW                      
                             FILE STATUS   IS WS-K520-STATUS.                   
                                                                                
           SELECT BP13K595   ASSIGN TO BP13K595                                 
                             ORGANIZATION  IS INDEXED                           
                             ACCESS MODE   IS DYNAMIC                           
                             RECORD KEY    IS K595-KEY-FLD                      
                             FILE STATUS   IS WS-K595-STATUS.                   
                                                                                
           SELECT BP13L149  ASSIGN  TO BP13L149.                                
                                                                                
      *--------------------------------------------------------*                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *--------------------------------------------------------*                
                                                                                
       FD   BP13F740                                                            
            RECORD CONTAINS 500 CHARACTERS                                      
            BLOCK CONTAINS 0 RECORDS                                            
            RECORDING MODE IS F                                                 
            LABEL RECORDS ARE STANDARD.                                         
                                                                                
       COPY BP13F740.                                                           
                                                                                
       FD   BP13K740                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
                                                                                
       COPY BP13K740.                                                           
                                                                                
       FD   BP13K520                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
                                                                                
       COPY BP13K520.                                                           
                                                                                
       FD   BP13K595                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
                                                                                
       COPY BP13K595.                                                           
                                                                                
       FD  BP13L149                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS  132 CHARACTERS.                                     
                                                                                
       01  BP13L149-REC         PIC X(132).                                     
                                                                                
      *--------------------------------------------------------*                
       WORKING-STORAGE SECTION.                                                 
      *--------------------------------------------------------*                
       01  WS-FILE-VARIABLES.                                                   
           05 WS-F740-EOF               PIC X(1)    VALUE 'N'.                  
           05 WS-K740-FOUND             PIC X(1)    VALUE 'N'.                  
           05 WS-K520-FOUND             PIC X(1)    VALUE 'N'.                  
           05 WS-FLAG                   PIC X(1)    VALUE 'N'.                  
                                                                                
           05 WS-READ-F740              PIC 9(8)    VALUE 0.                    
           05 WS-K740-UPD               PIC 9(8)    VALUE 0.                    
           05 WS-K520-UPD               PIC 9(8)    VALUE 0.                    
           05 WS-K595-WRITE             PIC 9(8)    VALUE 0.                    
           05 WS-K740-STATUS            PIC 9(2)    VALUE 00.                   
           05 WS-K520-STATUS            PIC 9(2)    VALUE 00.                   
           05 WS-K595-STATUS            PIC 9(2)    VALUE 00.                   
                                                                                
       01  WS-PRINT-VARIABLES.                                                  
           05 WS-CNT-LINE-ON-PAGE       PIC 9(8)    VALUE 66.                   
           05 WS-CNT-PRINT-L149         PIC 9(8)    VALUE 1.                    
           05 WS-CNT-WRITE-L149         PIC 9(8)    VALUE 0.                    
           05 WS-NO-OF-PAGE             PIC 9(8)    VALUE 0.                    
                                                                                
       01  WS-SYSTEM-DATE.                                                      
           05  WS-SYS-CCYY              PIC 9(4).                               
           05  WS-SYS-MM                PIC 9(2).                               
           05  WS-SYS-DD                PIC 9(2).                               
                                                                                
       01  WS-EDITED-DATE               PIC X(10).                              
       01  WS-SYSTEM-TIME               PIC 9(8).                               
                                                                                
      *--------------------------------------------------------*                
      *         BP13L149  -  R E P O R T    L A Y O U T        *                
      *--------------------------------------------------------*                
                                                                                
       01  L149-PR-HEAD-01.                                                     
           05  FILLER                   PIC X(14) VALUE 'BP13L149'.             
           05  FILLER                   PIC X(8)  VALUE 'HDBCAT 3'.             
           05  FILLER                   PIC X(25) VALUE SPACES.                 
           05  FILLER                   PIC X(39) VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                   PIC X(13) VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'DATE: '.               
           05  L149-RUN-DATE            PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'PAGE: '.               
           05  L149-PAGE-NO             PIC ZZZ9.                               
                                                                                
       01  L149-PR-HEAD-02.                                                     
           05  FILLER                   PIC X(47) VALUE SPACES.                 
           05  FILLER                   PIC X(73) VALUE                         
                'REPORT ON PRIORITY CASES TAKING PA QUOTA'.                     
                                                                                
       01  L149-PR-HEAD-03.                                                     
           05  FILLER          PIC X(05)  VALUE ' S-NO'.                        
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(09)  VALUE 'REGN NO'.                      
           05  FILLER          PIC X(02)  VALUE SPACES.                         
           05  FILLER          PIC X(03)  VALUE 'CDE'.                          
           05  FILLER          PIC X(02)  VALUE SPACES.                         
           05  FILLER          PIC X(03)  VALUE 'JB'.                           
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(06)  VALUE 'JB'.                           
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(07)  VALUE 'JB PRNT'.                      
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(06)  VALUE ' JB '.                         
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(08)  VALUE 'JB REGN'.                      
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE ' ALO'.                         
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE ' IDP'.                         
           05  FILLER          PIC X(02)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE 'MCPS'.                         
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE ' REQ'.                         
           05  FILLER          PIC X(05)  VALUE SPACES.                         
           05  FILLER          PIC X(09)  VALUE 'NUM SEQ'.                      
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(28)  VALUE 'RANDOM'.                       
                                                                                
       01  L149-PR-HEAD-04.                                                     
           05  FILLER          PIC X(17)  VALUE SPACES.                         
           05  FILLER          PIC X(03)  VALUE 'JB'.                           
           05  FILLER          PIC X(02)  VALUE SPACES.                         
           05  FILLER          PIC X(03)  VALUE 'CNT'.                          
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(06)  VALUE 'REF NO'.                       
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(07)  VALUE ' REGN  '.                      
           05  FILLER          PIC X(03)  VALUE SPACES.                         
           05  FILLER          PIC X(06)  VALUE ' PRNT '.                       
           05  FILLER          PIC X(12)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE ' SCH'.                         
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE ' SCH'.                         
           05  FILLER          PIC X(02)  VALUE SPACES.                         
           05  FILLER          PIC X(04)  VALUE 'ELIG'.                         
           05  FILLER          PIC X(01)  VALUE SPACES.                         
           05  FILLER          PIC X(07)  VALUE 'ALO SCH'.                      
                                                                                
       01  L149-PR-HEAD-05.                                                     
           05  FILLER                PIC X(132) VALUE ALL '-'.                  
                                                                                
       01  L149-PR-HEAD-06.                                                     
           05  FILLER                PIC X(132) VALUE SPACES.                   
                                                                                
       01  L149-PR-DETAILS-1.                                                   
           05  L149-NUMBER           PIC ZZZZ9  BLANK WHEN ZERO.                
           05  FILLER                PIC X(01)  VALUE SPACES.                   
           05  L149-REGN-NO          PIC X(09)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-CDE-JB           PIC X(03)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-NUM-JB-CNT       PIC X(03)  VALUE SPACES.                   
           05  FILLER                PIC X(03)  VALUE SPACES.                   
           05  L149-NUM-JB-REF       PIC X(06)  VALUE SPACES.                   
           05  FILLER                PIC X(03)  VALUE SPACES.                   
           05  L149-JB-PARENT-REGN   PIC X(08)  VALUE SPACES.                   
           05  FILLER                PIC X(03)  VALUE SPACES.                   
           05  L149-CDE-JB-PARENT    PIC X(06)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-NUM-JB-REGN      PIC X(08)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-CDE-ALLO-SCH     PIC X(03)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-CDE-IDP-SCH      PIC X(03)  VALUE SPACES.                   
           05  FILLER                PIC X(02)  VALUE SPACES.                   
           05  L149-NUM-MCPS         PIC X(01)  VALUE SPACES.                   
           05  L149-SLASH            PIC X(01)  VALUE '/'.                      
           05  L149-NUM-MCPS-HA1     PIC X(01)  VALUE SPACES.                   
           05  FILLER                PIC X(04)  VALUE SPACES.                   
           05  L149-CDE-REQ-ALO-SCH  PIC X(03)  VALUE SPACES.                   
           05  FILLER                PIC X(04)  VALUE SPACES.                   
           05  L149-NUM-SEQ          PIC X(09)  VALUE SPACES.                   
           05  FILLER                PIC X(01)  VALUE SPACES.                   
           05  L149-RANDOM           PIC X(28)  VALUE SPACES.                   
                                                                                
      *--------------------------------------------------------*                
       PROCEDURE DIVISION.                                                      
      *--------------------------------------------------------*                
                                                                                
      *--------------------------------------------------------*                
       0000-MAIN.                                                               
      *--------------------------------------------------------*                
                                                                                
           PERFORM 1000-OPEN-FILES    THRU 1000-EXIT.                           
           PERFORM 2000-READ-F740     THRU 2000-EXIT.                           
                                                                                
           PERFORM 3000-PROCESS       THRU 3000-EXIT                            
                   UNTIL WS-F740-EOF = 'Y'.                                     
                                                                                
           PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       1000-OPEN-FILES.                                                         
      *--------------------------------------------------------*                
                                                                                
           OPEN INPUT  BP13F740                                                 
                I-O    BP13K740                                                 
                       BP13K520                                                 
                       BP13K595                                                 
                OUTPUT BP13L149.                                                
                                                                                
           EVALUATE WS-K740-STATUS                                              
               WHEN 00                                                          
               WHEN 97                                                          
                  CONTINUE                                                      
               WHEN OTHER                                                       
                  MOVE WS-K740-STATUS        TO RETURN-CODE                     
                  DISPLAY 'OPEN BP13K740 FAIL. STATUS=' WS-K740-STATUS          
                  PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K520-STATUS                                              
               WHEN 00                                                          
               WHEN 97                                                          
                  CONTINUE                                                      
               WHEN OTHER                                                       
                  MOVE WS-K520-STATUS        TO RETURN-CODE                     
                  DISPLAY 'OPEN BP13K520 FAIL. STATUS=' WS-K520-STATUS          
                  PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K595-STATUS                                              
               WHEN 00                                                          
               WHEN 97                                                          
                  CONTINUE                                                      
               WHEN OTHER                                                       
                  MOVE WS-K595-STATUS        TO RETURN-CODE                     
                  DISPLAY 'OPEN BP13K595 FAIL. STATUS=' WS-K595-STATUS          
                  PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
           MOVE FUNCTION CURRENT-DATE   TO WS-SYSTEM-DATE.                      
                                                                                
           STRING WS-SYS-DD '/' WS-SYS-MM '/' WS-SYS-CCYY                       
                  DELIMITED BY SIZE                                             
                  INTO WS-EDITED-DATE                                           
           END-STRING.                                                          
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       2000-READ-F740.                                                          
      *--------------------------------------------------------*                
                                                                                
           READ BP13F740                                                        
                AT END MOVE 'Y' TO WS-F740-EOF                                  
                GO TO 2000-EXIT                                                 
           END-READ.                                                            
                                                                                
           ADD 1 TO WS-READ-F740.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       3000-PROCESS.                                                            
      *--------------------------------------------------------*                
                                                                                
           PERFORM 4500-READ-K740 THRU 4500-EXIT.                               
                                                                                
           IF WS-K740-FOUND = 'Y'                                               
              MOVE  'Y'  TO WS-FLAG                                             
              PERFORM 5700-WRITE-K595       THRU 5700-EXIT                      
              PERFORM 5000-MOVE-PARA-1      THRU 5000-EXIT                      
              PERFORM 6000-WRITE-BP13L149   THRU 6000-EXIT                      
                                                                                
              PERFORM 5200-REWRITE-BP13K740 THRU 5200-EXIT                      
                                                                                
              MOVE  'N'  TO WS-FLAG                                             
              PERFORM 5100-MOVE-PARA-2      THRU 5100-EXIT                      
              PERFORM 6000-WRITE-BP13L149   THRU 6000-EXIT                      
              PERFORM 6200-WRITE-BLANK      THRU 6200-EXIT                      
           ELSE                                                                 
              PERFORM 5300-READ-K520 THRU 5300-EXIT                             
              IF WS-K520-FOUND = 'Y'                                            
                 MOVE 'Y' TO WS-FLAG                                            
                 PERFORM 5700-WRITE-K595       THRU 5700-EXIT                   
                 PERFORM 5400-MOVE-PARA-3      THRU 5400-EXIT                   
                 PERFORM 6000-WRITE-BP13L149   THRU 6000-EXIT                   
                                                                                
                 PERFORM 5600-REWRITE-BP13K520 THRU 5600-EXIT                   
                                                                                
                 MOVE 'N' TO WS-FLAG                                            
                 PERFORM 5500-MOVE-PARA-4      THRU 5500-EXIT                   
                 PERFORM 6000-WRITE-BP13L149   THRU 6000-EXIT                   
                 PERFORM 6200-WRITE-BLANK      THRU 6200-EXIT                   
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-F740      THRU 2000-EXIT.                          
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       4500-READ-K740.                                                          
      *--------------------------------------------------------*                
                                                                                
           MOVE LOW-VALUES     TO K740-KEY-FLD.                                 
           MOVE F740-KEY-FLD   TO K740-KEY-FLD.                                 
           MOVE 'Y'            TO WS-K740-FOUND.                                
                                                                                
           READ BP13K740.                                                       
                                                                                
           EVALUATE WS-K740-STATUS                                              
              WHEN 00                                                           
                 IF (K740-CDE-REQ-ALLOC-SCH                                     
                                NOT = SPACES AND LOW-VALUES)                    
                    MOVE 'Y' TO WS-K740-FOUND                                   
                 ELSE                                                           
                    MOVE 'N' TO WS-K740-FOUND                                   
                 END-IF                                                         
              WHEN 23                                                           
                 MOVE 'N' TO WS-K740-FOUND                                      
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READ OF BP13K740. STATUS IS '                
                          WS-K740-STATUS                                        
                 PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5000-MOVE-PARA-1.                                                        
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                   TO  L149-PR-DETAILS-1.                 
           INITIALIZE                        L149-PR-DETAILS-1.                 
                                                                                
           MOVE K740-NUM-REGN            TO  L149-REGN-NO.                      
           MOVE K740-CDE-JB              TO  L149-CDE-JB.                       
           MOVE K740-NUM-JB-CNT          TO  L149-NUM-JB-CNT.                   
           MOVE K740-NUM-JB-REF          TO  L149-NUM-JB-REF.                   
           MOVE K740-NUM-JB-PARENT-REGN  TO  L149-JB-PARENT-REGN.               
           MOVE K740-NUM-JB-REGN         TO  L149-NUM-JB-REGN.                  
           MOVE K740-CDE-JB-PARENT       TO  L149-CDE-JB-PARENT.                
           MOVE K740-CDE-ALLOC-SCH       TO  L149-CDE-ALLO-SCH.                 
           MOVE K740-NUM-MCPS            TO  L149-NUM-MCPS.                     
           MOVE '/'                      TO  L149-SLASH.                        
           MOVE K740-CDE-RESIDENT-HA1    TO  L149-NUM-MCPS-HA1.                 
           MOVE K740-CDE-IDP-SCH         TO  L149-CDE-IDP-SCH.                  
           MOVE K740-CDE-REQ-ALLOC-SCH   TO  L149-CDE-REQ-ALO-SCH.              
           MOVE K740-NUM-SEQUENCE        TO  L149-NUM-SEQ.                      
           MOVE K740-NUM-RANDOM          TO  L149-RANDOM.                       
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5100-MOVE-PARA-2.                                                        
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                   TO  L149-PR-DETAILS-1.                 
           INITIALIZE                        L149-PR-DETAILS-1.                 
                                                                                
           MOVE SPACES                   TO  L149-REGN-NO.                      
                                                                                
           MOVE K740-NUM-REGN            TO  L149-REGN-NO.                      
           MOVE K740-CDE-JB              TO  L149-CDE-JB.                       
           MOVE K740-NUM-JB-CNT          TO  L149-NUM-JB-CNT.                   
           MOVE K740-NUM-JB-REF          TO  L149-NUM-JB-REF.                   
           MOVE K740-NUM-JB-PARENT-REGN  TO  L149-JB-PARENT-REGN.               
           MOVE K740-NUM-JB-REGN         TO  L149-NUM-JB-REGN.                  
           MOVE K740-CDE-JB-PARENT       TO  L149-CDE-JB-PARENT.                
           MOVE K740-CDE-ALLOC-SCH       TO  L149-CDE-ALLO-SCH.                 
           MOVE K740-NUM-MCPS            TO  L149-NUM-MCPS.                     
           MOVE '/'                      TO  L149-SLASH.                        
           MOVE K740-CDE-RESIDENT-HA1    TO  L149-NUM-MCPS-HA1.                 
           MOVE K740-CDE-IDP-SCH         TO  L149-CDE-IDP-SCH.                  
           MOVE K740-CDE-REQ-ALLOC-SCH   TO  L149-CDE-REQ-ALO-SCH.              
           MOVE K740-NUM-SEQUENCE        TO  L149-NUM-SEQ.                      
           MOVE K740-NUM-RANDOM          TO  L149-RANDOM.                       
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5200-REWRITE-BP13K740.                                                   
      *----------------------------------------------------------------*        
                                                                                
      *    MOVE SPACES         TO K740-NUM-RES-NRIC1                            
      *                           K740-NUM-RES-NRIC2                            
      *                           K740-NUM-MCPS                                 
      *                           K740-CDE-RESIDENT-HA1.                        
                                                                                
           MOVE 0              TO K740-CDE-JB                                   
                                  K740-NUM-JB-CNT.                              
                                                                                
           MOVE SPACES         TO K740-NUM-JB-REGN                              
                                  K740-CDE-JB-PARENT                            
                                  K740-NUM-JB-PARENT-REGN                       
                                  K740-NUM-JB-REF.                              
                                                                                
           IF K740-CDE-REQ-ALLOC-SCH = 'TCP'                                    
              MOVE 'PA'        TO K740-CDE-ELIG-SCH                             
           END-IF.                                                              
                                                                                
           MOVE 'PA'           TO K740-CDE-ALLOC-SCH                            
                                  K740-CDE-IDP-SCH.                             
                                                                                
                                                                                
           MOVE SPACES         TO K740-NUM-SEQUENCE.                            
                                                                                
           REWRITE BP13K740-REC.                                                
                                                                                
           EVALUATE WS-K740-STATUS                                              
              WHEN 00                                                           
                 ADD 1 TO WS-K740-UPD                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN REWRITE OF BP13K740. STATUS IS '             
                          WS-K740-STATUS                                        
                 PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       5300-READ-K520.                                                          
      *--------------------------------------------------------*                
                                                                                
           MOVE LOW-VALUES      TO K520-NUM-REGN.                               
           MOVE F740-NUM-REGN   TO K520-NUM-REGN.                               
           MOVE 'Y'             TO WS-K520-FOUND.                               
                                                                                
           READ BP13K520.                                                       
                                                                                
           EVALUATE WS-K520-STATUS                                              
              WHEN 00                                                           
                 IF (K520-CDE-REQ-ALLOC-SCH                                     
                                NOT = SPACES AND LOW-VALUES)                    
                    MOVE 'Y' TO WS-K520-FOUND                                   
                 ELSE                                                           
                    MOVE 'N' TO WS-K520-FOUND                                   
                 END-IF                                                         
              WHEN 23                                                           
                 MOVE 'N' TO WS-K520-FOUND                                      
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READ OF BP13K520. STATUS IS '                
                          WS-K520-STATUS                                        
                 PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                      
            END-EVALUATE.                                                       
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5400-MOVE-PARA-3.                                                        
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                   TO  L149-PR-DETAILS-1.                 
           INITIALIZE                        L149-PR-DETAILS-1.                 
                                                                                
           MOVE K520-NUM-REGN            TO  L149-REGN-NO.                      
           MOVE K520-CDE-JB              TO  L149-CDE-JB.                       
           MOVE K520-NUM-JB-CNT          TO  L149-NUM-JB-CNT.                   
           MOVE K520-NUM-JB-REF          TO  L149-NUM-JB-REF.                   
           MOVE K520-NUM-JB-PARENT-REGN  TO  L149-JB-PARENT-REGN.               
           MOVE K520-NUM-JB-REGN         TO  L149-NUM-JB-REGN.                  
           MOVE K520-CDE-JB-PARENT       TO  L149-CDE-JB-PARENT.                
           MOVE K520-CDE-ALLOC-SCH       TO  L149-CDE-ALLO-SCH.                 
           MOVE K520-NUM-MCPS            TO  L149-NUM-MCPS.                     
           MOVE '/'                      TO  L149-SLASH.                        
           MOVE K520-CDE-RESIDENT-HA1    TO  L149-NUM-MCPS-HA1.                 
           MOVE K520-CDE-IDP-SCH         TO  L149-CDE-IDP-SCH.                  
           MOVE K520-CDE-REQ-ALLOC-SCH   TO  L149-CDE-REQ-ALO-SCH.              
           MOVE K520-NUM-SEQUENCE        TO  L149-NUM-SEQ.                      
           MOVE K520-NUM-RANDOM          TO  L149-RANDOM.                       
                                                                                
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5500-MOVE-PARA-4.                                                        
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                   TO  L149-PR-DETAILS-1.                 
           INITIALIZE                        L149-PR-DETAILS-1.                 
                                                                                
           MOVE SPACES                   TO  L149-REGN-NO.                      
                                                                                
           MOVE K520-NUM-REGN            TO  L149-REGN-NO.                      
           MOVE K520-CDE-JB              TO  L149-CDE-JB.                       
           MOVE K520-NUM-JB-CNT          TO  L149-NUM-JB-CNT.                   
           MOVE K520-NUM-JB-REF          TO  L149-NUM-JB-REF.                   
           MOVE K520-NUM-JB-PARENT-REGN  TO  L149-JB-PARENT-REGN.               
           MOVE K520-NUM-JB-REGN         TO  L149-NUM-JB-REGN.                  
           MOVE K520-CDE-JB-PARENT       TO  L149-CDE-JB-PARENT.                
           MOVE K520-CDE-ALLOC-SCH       TO  L149-CDE-ALLO-SCH.                 
           MOVE K520-NUM-MCPS            TO  L149-NUM-MCPS.                     
           MOVE '/'                      TO  L149-SLASH.                        
           MOVE K520-CDE-RESIDENT-HA1    TO  L149-NUM-MCPS-HA1.                 
           MOVE K520-CDE-IDP-SCH         TO  L149-CDE-IDP-SCH.                  
           MOVE K520-CDE-REQ-ALLOC-SCH   TO  L149-CDE-REQ-ALO-SCH.              
           MOVE K520-NUM-SEQUENCE        TO  L149-NUM-SEQ.                      
           MOVE K520-NUM-RANDOM          TO  L149-RANDOM.                       
                                                                                
       5500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5600-REWRITE-BP13K520.                                                   
      *----------------------------------------------------------------*        
                                                                                
           MOVE 0              TO K520-CDE-JB                                   
                                  K520-NUM-JB-CNT.                              
                                                                                
           MOVE SPACES         TO K520-NUM-JB-REGN                              
                                  K520-CDE-JB-PARENT                            
                                  K520-NUM-JB-PARENT-REGN                       
                                  K520-NUM-JB-REF.                              
                                                                                
           MOVE 'PA'           TO K520-CDE-ALLOC-SCH                            
                                  K520-CDE-IDP-SCH.                             
                                                                                
           MOVE SPACES         TO K520-NUM-SEQUENCE.                            
                                                                                
           REWRITE BP13K520-REC.                                                
                                                                                
           EVALUATE WS-K520-STATUS                                              
              WHEN 00                                                           
                 ADD 1 TO WS-K520-UPD                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN REWRITE OF BP13K520. STATUS IS '             
                          WS-K520-STATUS                                        
                 PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       5600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       5700-WRITE-K595.                                                         
      *--------------------------------------------------------*                
                                                                                
           MOVE SPACES TO BP13K595-REC.                                         
           INITIALIZE     BP13K595-REC.                                         
                                                                                
           IF WS-K520-FOUND = 'Y'                                               
              MOVE BP13K520-REC   TO BP13K595-REC                               
              MOVE K520-NUM-REF   TO K595-NUM-REGN-REF                          
           ELSE                                                                 
           IF WS-K740-FOUND = 'Y'                                               
              MOVE BP13K740-REC   TO BP13K595-REC                               
              MOVE K740-NUM-REF   TO K595-NUM-REGN-REF                          
           END-IF.                                                              
                                                                                
           MOVE WS-SYSTEM-DATE TO K595-DTE-UPDATE.                              
           MOVE FUNCTION CURRENT-DATE(9:8) TO WS-SYSTEM-TIME.                   
           MOVE WS-SYSTEM-TIME TO K595-TME-SYSTEM.                              
                                                                                
           WRITE BP13K595-REC.                                                  
                                                                                
           EVALUATE WS-K595-STATUS                                              
              WHEN 00                                                           
              WHEN 02                                                           
                 ADD 1 TO WS-K595-WRITE                                         
                 CONTINUE                                                       
              WHEN 22                                                           
                 DISPLAY 'DUPLICATE KEY IN BP13K595, REF  = '                   
                         K595-NUM-REGN-REF                                      
              WHEN OTHER                                                        
                 DISPLAY 'ERRROR UPDATING BP13K595, STATUS = '                  
                         WS-K595-STATUS                                         
                 PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT                      
                                                                                
           END-EVALUATE.                                                        
                                                                                
       5700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       6000-WRITE-BP13L149.                                                     
      *----------------------------------------------------------------*        
                                                                                
           IF WS-CNT-LINE-ON-PAGE > 55                                          
              PERFORM 6100-PRINT-HEADING THRU 6100-EXIT                         
              MOVE 5 TO WS-CNT-LINE-ON-PAGE                                     
           END-IF.                                                              
                                                                                
           IF WS-FLAG = 'Y'                                                     
              MOVE WS-CNT-PRINT-L149  TO  L149-NUMBER                           
           ELSE                                                                 
              MOVE 0                  TO  L149-NUMBER                           
           END-IF.                                                              
                                                                                
           WRITE BP13L149-REC  FROM  L149-PR-DETAILS-1 AFTER 1.                 
           ADD   1             TO    WS-CNT-LINE-ON-PAGE.                       
                                                                                
           IF WS-FLAG = 'Y'                                                     
              ADD   1          TO    WS-CNT-PRINT-L149                          
           END-IF.                                                              
                                                                                
           ADD   1             TO    WS-CNT-WRITE-L149.                         
           MOVE  SPACES        TO    L149-PR-DETAILS-1.                         
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       6100-PRINT-HEADING.                                                      
      *----------------------------------------------------------------*        
                                                                                
           ADD  1                TO     WS-NO-OF-PAGE.                          
           MOVE WS-NO-OF-PAGE    TO     L149-PAGE-NO.                           
           MOVE WS-EDITED-DATE   TO     L149-RUN-DATE.                          
                                                                                
           MOVE SPACES           TO     BP13L149-REC.                           
                                                                                
           WRITE BP13L149-REC    AFTER  PAGE.                                   
           WRITE BP13L149-REC    FROM   L149-PR-HEAD-01 AFTER 1.                
           WRITE BP13L149-REC    FROM   L149-PR-HEAD-02 AFTER 1.                
           WRITE BP13L149-REC    FROM   L149-PR-HEAD-03 AFTER 2.                
           WRITE BP13L149-REC    FROM   L149-PR-HEAD-04 AFTER 1.                
           WRITE BP13L149-REC    FROM   L149-PR-HEAD-05 AFTER 1.                
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       6200-WRITE-BLANK.                                                        
      *----------------------------------------------------------------*        
                                                                                
           IF WS-CNT-LINE-ON-PAGE > 55                                          
              PERFORM 6100-PRINT-HEADING   THRU 6100-EXIT                       
              MOVE 1 TO WS-CNT-LINE-ON-PAGE                                     
           END-IF.                                                              
                                                                                
           MOVE SPACES           TO     BP13L149-REC.                           
           INITIALIZE                   BP13L149-REC.                           
                                                                                
           WRITE BP13L149-REC   FROM L149-PR-HEAD-06 AFTER 1.                   
           ADD   1              TO WS-CNT-LINE-ON-PAGE.                         
           MOVE  SPACES         TO L149-PR-DETAILS-1.                           
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------------------------------------*                
       9999-CLOSE-ROUTINE.                                                      
      *--------------------------------------------------------*                
                                                                                
           DISPLAY '**********  BP13C149  *************'.                       
           DISPLAY SPACES.                                                      
           DISPLAY 'DATE   : ' WS-EDITED-DATE.                                  
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECORDS READ    :'                                    
           DISPLAY '   BP13F740           : '  WS-READ-F740.                    
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECORDS UPDATE  :'                                    
           DISPLAY '   BP13K740           : '  WS-K740-UPD.                     
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECORDS UPDATE  :'                                    
           DISPLAY '   BP13K520           : '  WS-K520-UPD.                     
           DISPLAY SPACES.                                                      
           DISPLAY 'NO OF RECORDS WRITE   :'                                    
           DISPLAY '   BP13K595           : '  WS-K595-WRITE.                   
           DISPLAY SPACES.                                                      
           DISPLAY '***********************************'.                       
                                                                                
           CLOSE BP13F740                                                       
                 BP13K740                                                       
                 BP13K520                                                       
                 BP13K595                                                       
                 BP13L149.                                                      
                                                                                
           EVALUATE WS-K740-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-K740-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BP13K740 FAIL. STATUS=' WS-K740-STATUS          
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K520-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-K520-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BP13K520 FAIL. STATUS=' WS-K520-STATUS          
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K595-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 MOVE WS-K595-STATUS        TO RETURN-CODE                      
                 DISPLAY 'CLOSE BP13K595 FAIL. STATUS=' WS-K595-STATUS          
           END-EVALUATE.                                                        
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
