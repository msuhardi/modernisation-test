       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C45M.                                                 
      *AUTHOR.        RJB1.                                                     
      *DATE-WRITTEN.  20/09/2017.                                               
      * ========================================================== *            
      * OBJECTIVE    : DAILY PROGRAM TO POPULATE BP13KC70          *            
      *                (POTENTIAL REGNS FOR SELF BOOKING) USING    *            
      *                SATP CASES.                                 *            
      * ========================================================== *            
      * INPUT  FILES :  1.) BP13F800                               *            
      *                 2.) BM06K110                               *            
      *                 3.) BP13K820                               *            
      *                 4.) BP13KC20                               *            
      *                 5.) BP13KC25                               *            
      * I-O    FILES :  1.) BP13KC70                               *            
      * ========================================================== *            
      * CHG-NO   BY   DATE       DESCRIPTION                       *            
      * -------- ---  ------     -----------                       *            
      * BP136980 RJB1 20/09/2017 NEW PROGRAM                       *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F800  ASSIGN        TO BP13F800.                          
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            FILE STATUS   IS WS-K110-STATUS.                    
                                                                                
           SELECT BP13K820  ASSIGN        TO BP13K820                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K820-KEY-FLD                       
                            FILE STATUS   IS WS-K820-STATUS.                    
                                                                                
           SELECT BP13KC20  ASSIGN        TO BP13KC20                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KC20-KEY-FLD                       
                            ALTERNATE KEY IS KC20-ALT-KEY                       
                            FILE STATUS   IS WS-KC20-STATUS.                    
                                                                                
           SELECT BP13KC25  ASSIGN        TO BP13KC25                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KC25-KEY-FLD                       
                            ALTERNATE KEY IS KC25-ALT-KEY1                      
                            FILE STATUS   IS WS-KC25-STATUS.                    
                                                                                
           SELECT BP13KC70  ASSIGN        TO BP13KC70                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS KC70-KEY-FLD                       
                            FILE STATUS   IS WS-KC70-STATUS.                    
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F800                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 2000 CHARACTERS.                                     
           COPY BP13F800.                                                       
                                                                                
       FD  BM06K110                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
           COPY BM06K110.                                                       
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
           COPY BP13K820.                                                       
                                                                                
       FD  BP13KC20                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
           COPY BP13KC20.                                                       
                                                                                
       FD  BP13KC25                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
           COPY BP13KC25.                                                       
                                                                                
       FD  BP13KC70                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
           COPY BP13KC70.                                                       
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-FILE-STATUS.                                                      
           05  WS-K110-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-K820-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-KC20-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-KC25-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-KC60-STATUS            PIC 9(2)   VALUE ZEROES.               
           05  WS-KC70-STATUS            PIC 9(2)   VALUE ZEROES.               
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-IDX                    PIC 9(2)   VALUE ZEROES.               
           05  WS-CNT-F800-READ          PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-F800-SKIP          PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-KC60-UPD           PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-KC70-WRITE         PIC 9(6)   VALUE ZEROES.               
           05  WS-CNT-KC70-UPDATE        PIC 9(6)   VALUE ZEROES.               
                                                                                
       01  WS-FLAGS.                                                            
           05  WS-F800-EOF               PIC X(1)   VALUE 'N'.                  
           05  WS-K110-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-K820-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-KC20-FND               PIC X(1)   VALUE 'N'.                  
           05  WS-KC25-FND               PIC X(1)   VALUE 'N'.                  
                                                                                
       01  WS-DATE.                                                             
           05  WS-DTE-FMT8.                                                     
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-FMT10.                                                    
               10  WS-DTE-DD             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-MM             PIC 9(2)   VALUE ZEROES.               
               10  FILLER                PIC X      VALUE '/'.                  
               10  WS-DTE-CCYY.                                                 
                   15  WS-DTE-CC         PIC 9(2)   VALUE ZEROES.               
                   15  WS-DTE-YY         PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-CURR-8.                                                   
               10  WS-DTE-CURR8-CCYY     PIC 9(4)   VALUE ZEROES.               
               10  WS-DTE-CURR8-MM       PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-CURR8-DD       PIC 9(2)   VALUE ZEROES.               
           05  WS-DTE-CURR-10            PIC X(10)  VALUE SPACES.               
           05  WS-DTE-BIRTH.                                                    
               10  WS-DTE-BIRTH-CCYY     PIC 9(4)   VALUE ZEROES.               
               10  WS-DTE-BIRTH-MM       PIC 9(2)   VALUE ZEROES.               
               10  WS-DTE-BIRTH-DD       PIC 9(2)   VALUE ZEROES.               
           05  WS-TIME-RUN               PIC X(8)   VALUE ZEROES.               
                                                                                
       01  WS-OTHERS.                                                           
           05  WS-NUM-AVG-AGE            PIC 9(2)   VALUE ZEROES.               
           05  WS-NUM-REM                PIC 9(2)   VALUE ZEROES.               
           05  WS-TMP-DIV                PIC 9(1)   VALUE ZEROES.               
           05  WS-TMP-AGE-TOT            PIC 9(3)   VALUE ZEROES.               
           05  FILLER OCCURS 4 TIMES.                                           
               10  WS-NUM-O-UIN       PIC X(9)    VALUE SPACES.                 
               10  WS-NUM-O-AGE       PIC 9(2)    VALUE ZEROES.                 
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *=============================================================            
       0000-CONTROL.                                                            
      *=============================================================            
                                                                                
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                      
           PERFORM 1100-GET-DATE           THRU 1100-EXIT.                      
           PERFORM 2000-BP13F800-READ      THRU 2000-EXIT.                      
           PERFORM 3000-MAIN-ROUTINE       THRU 3000-EXIT                       
                   UNTIL WS-F800-EOF = 'Y'                                      
           PERFORM 9000-CLOSE-ROUTINE      THRU 9000-EXIT.                      
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       1000-OPEN-ROUTINE.                                                       
      *=============================================================            
                                                                                
           OPEN INPUT  BP13F800                                                 
                       BM06K110                                                 
                       BP13K820                                                 
                       BP13KC20                                                 
                       BP13KC25                                                 
                I-O    BP13KC70.                                                
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BM06K110 ERROR ' WS-K110-STATUS                  
              MOVE     WS-K110-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13K820 ERROR ' WS-K820-STATUS                  
              MOVE     WS-K820-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KC20-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KC20 ERROR ' WS-KC20-STATUS                  
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KC25-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KC25 ERROR ' WS-KC25-STATUS                  
              MOVE     WS-KC25-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KC70-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING BP13KC70 ERROR ' WS-KC70-STATUS                  
              MOVE     WS-KC70-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       1100-GET-DATE.                                                           
      *=============================================================            
                                                                                
      *-------------------------------------------------------------            
      *    GET CURRENT DATE                                                     
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE(1:8) TO   WS-DTE-CURR-8.                  
           MOVE WS-DTE-CURR-8              TO   WS-DTE-FMT8.                    
           MOVE CORR WS-DTE-FMT8           TO   WS-DTE-FMT10.                   
           MOVE WS-DTE-FMT10               TO   WS-DTE-CURR-10.                 
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       2000-BP13F800-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13F800                                                        
              AT END MOVE 'Y'              TO   WS-F800-EOF.                    
                                                                                
           IF WS-F800-EOF NOT = 'Y'                                             
              ADD 1                        TO   WS-CNT-F800-READ                
           END-IF.                                                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3000-MAIN-ROUTINE.                                                       
      *=============================================================            
                                                                                
      *-------------------------------------------------------------            
      *    GET ESTATE, NEIGHBOURHOOD, CONTRACT-NO, BLK-NO                       
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   K110-KEY-FLD.                   
           MOVE F800-NUM-SCH-ACC           TO   K110-KEY-FLD.                   
           PERFORM 3010-READ-BM06K110      THRU 3010-EXIT.                      
                                                                                
           PERFORM 3100-PROCESS-REGNS      THRU 3100-EXIT.                      
                                                                                
           PERFORM 2000-BP13F800-READ      THRU 2000-EXIT.                      
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3010-READ-BM06K110.                                                      
      *=============================================================            
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE WS-K110-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-K110-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-K110-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BM06K110 ERROR '    WS-K110-STATUS                  
              MOVE    WS-K110-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3010-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3100-PROCESS-REGNS.                                                      
      *=============================================================            
                                                                                
      *-------------------------------------------------------------            
      *    SKIP RECORDS WITH KEY NOT YET AVAILABLE                              
      *-------------------------------------------------------------            
           IF K110-DTE-KEY-AVAIL = SPACES OR LOW-VALUES OR ZEROES               
              GO TO 3100-EXIT.                                                  
                                                                                
      *-------------------------------------------------------------            
      *    SKIP RECORDS WITH KEY ALREADY ISSUED                                 
      *-------------------------------------------------------------            
           IF K110-DTE-KEY-ISSUED NOT = SPACES AND LOW-VALUES AND ZEROES        
              GO TO 3100-EXIT.                                                  
                                                                                
      *-------------------------------------------------------------            
      *    GET SOC DETAILS                                                      
      *-------------------------------------------------------------            
      *-------------------------------------------------------------            
      *    SKIP RECORDS WITH EXISTING APPOINTMENT DATES                         
      *-------------------------------------------------------------            
           IF F800-DTE-SO-APPT NOT = SPACES AND LOW-VALUES AND ZEROES           
              GO TO 3100-EXIT.                                                  
                                                                                
      *-------------------------------------------------------------            
      *    GET OCCUP DETAILS AND COMPUTE AVG AGE                                
      *-------------------------------------------------------------            
           PERFORM 3200-GET-OCCUP          THRU 3200-EXIT.                      
           PERFORM 3300-COMP-AVG-AGE       THRU 3300-EXIT.                      
                                                                                
      *-------------------------------------------------------------            
      *    CHECK RECORD IN SELF BOOKING LIST                                    
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   BP13KC20-REC.                   
           MOVE F800-NUM-REGN              TO   KC20-NUM-REGN.                  
                                                                                
           PERFORM 3120-BP13KC20-READ      THRU 3120-EXIT.                      
                                                                                
           IF WS-KC20-FND = 'Y'                                                 
              GO TO 3100-EXIT.                                                  
                                                                                
      *-------------------------------------------------------------            
      *    CHECK RECORD IN SELF BOOKING QUEUE                                   
      *-------------------------------------------------------------            
           MOVE SPACES                     TO   BP13KC25-REC.                   
           MOVE F800-NUM-REGN              TO   KC25-NUM-REGN.                  
                                                                                
           PERFORM 3130-BP13KC25-READ      THRU 3130-EXIT.                      
                                                                                
           IF WS-KC25-FND = 'Y'                                                 
              GO TO 3100-EXIT.                                                  
                                                                                
           PERFORM 4000-CREATE-SELFREGN    THRU 4000-EXIT.                      
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3120-BP13KC20-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13KC20 KEY IS KC20-ALT-KEY.                                   
                                                                                
           EVALUATE WS-KC20-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-KC20-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-KC20-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13KC20 ERROR '    WS-KC20-STATUS                  
              MOVE    WS-KC20-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3120-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3130-BP13KC25-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13KC25 KEY IS KC25-ALT-KEY1.                                  
                                                                                
           EVALUATE WS-KC25-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-KC25-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-KC25-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13KC25 ERROR '    WS-KC25-STATUS                  
              MOVE    WS-KC25-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3130-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3200-GET-OCCUP.                                                          
      *=============================================================            
                                                                                
           PERFORM VARYING WS-IDX FROM 1 BY 1 UNTIL WS-IDX > 4                  
              MOVE SPACES                  TO   WS-NUM-O-UIN(WS-IDX)            
              MOVE ZEROES                  TO   WS-NUM-O-AGE(WS-IDX)            
           END-PERFORM.                                                         
                                                                                
           MOVE ZEROES                     TO   WS-IDX.                         
                                                                                
           IF F800-NUM-NRIC1 NOT = SPACES AND LOW-VALUES AND ZEROES             
              ADD 1                        TO   WS-IDX                          
              MOVE F800-NUM-NRIC1          TO   WS-NUM-O-UIN(WS-IDX)            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES AND LOW-VALUES AND ZEROES             
              ADD 1                        TO   WS-IDX                          
              MOVE F800-NUM-NRIC2          TO   WS-NUM-O-UIN(WS-IDX)            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES AND LOW-VALUES AND ZEROES             
              ADD 1                        TO   WS-IDX                          
              MOVE F800-NUM-NRIC3          TO   WS-NUM-O-UIN(WS-IDX)            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES AND LOW-VALUES AND ZEROES             
              ADD 1                        TO   WS-IDX                          
              MOVE F800-NUM-NRIC4          TO   WS-NUM-O-UIN(WS-IDX)            
           END-IF.                                                              
                                                                                
           PERFORM VARYING WS-IDX FROM 1 BY 1                                   
                     UNTIL WS-IDX > 4                                           
                        OR WS-NUM-O-UIN(WS-IDX) = SPACES                        
              MOVE SPACES                  TO   BP13K820-REC                    
              MOVE F800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE WS-NUM-O-UIN(WS-IDX)    TO   K820-NUM-NRIC                   
                                                                                
              PERFORM 3210-BP13K820-READ   THRU 3210-EXIT                       
                                                                                
              IF WS-K820-FND = 'Y'                                              
                 IF K820-DTE-BIRTH NOT NUMERIC                                  
                    MOVE ZEROES            TO   WS-NUM-O-AGE(WS-IDX)            
                 ELSE                                                           
                    MOVE K820-DTE-BIRTH    TO   WS-DTE-BIRTH                    
                    COMPUTE WS-NUM-O-AGE(WS-IDX) =                              
                            WS-DTE-CURR8-CCYY - WS-DTE-BIRTH-CCYY               
                                                                                
                    IF WS-DTE-CURR8-MM = WS-DTE-BIRTH-MM                        
                       IF WS-DTE-CURR8-DD > WS-DTE-BIRTH-DD                     
                          SUBTRACT 1       FROM WS-NUM-O-AGE(WS-IDX)            
                       END-IF                                                   
                    ELSE                                                        
                       IF WS-DTE-CURR8-MM > WS-DTE-BIRTH-MM                     
                          SUBTRACT 1       FROM WS-NUM-O-AGE(WS-IDX)            
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3210-BP13K820-READ.                                                      
      *=============================================================            
                                                                                
           READ BP13K820.                                                       
                                                                                
           EVALUATE WS-K820-STATUS                                              
           WHEN 00                                                              
              MOVE 'Y'                     TO   WS-K820-FND                     
                                                                                
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'N'                     TO   WS-K820-FND                     
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'READ BP13K820 ERROR '    WS-K820-STATUS                  
              MOVE    WS-K820-STATUS       TO   RETURN-CODE                     
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3210-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       3300-COMP-AVG-AGE.                                                       
      *=============================================================            
                                                                                
           MOVE ZEROES                     TO   WS-TMP-DIV                      
                                                WS-TMP-AGE-TOT.                 
                                                                                
           PERFORM VARYING WS-IDX FROM 1 BY 1 UNTIL WS-IDX > 4                  
              IF (WS-NUM-O-AGE(WS-IDX) IS NUMERIC)  AND                         
                 (WS-NUM-O-AGE(WS-IDX) NOT = SPACES AND LOW-VALUES AND          
                                              ZEROES)                           
                 ADD 1                     TO   WS-TMP-DIV                      
                 ADD WS-NUM-O-AGE(WS-IDX)  TO   WS-TMP-AGE-TOT                  
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
           IF WS-TMP-AGE-TOT = 0 OR WS-TMP-DIV = 0                              
              MOVE 0                       TO   WS-NUM-AVG-AGE                  
           ELSE                                                                 
              DIVIDE WS-TMP-AGE-TOT BY WS-TMP-DIV GIVING WS-NUM-AVG-AGE         
           END-IF.                                                              
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4000-CREATE-SELFREGN.                                                    
      *=============================================================            
                                                                                
           MOVE SPACES                     TO   BP13KC70-REC.                   
           MOVE K110-ESTATE                TO   KC70-ESTATE.                    
           MOVE K110-NEIGHBOURHOOD         TO   KC70-NEIGHBOURHOOD.             
           MOVE K110-CONTRACT-NO           TO   KC70-CONTRACT-NO.               
           MOVE K110-BLK-NO                TO   KC70-BLK-NO.                    
           MOVE F800-NUM-REGN              TO   KC70-NUM-REGN.                  
           MOVE 'SP'                       TO   KC70-NUM-APPT-TYPE.             
           MOVE 'W'                        TO   KC70-CDE-APPT.                  
           MOVE 'A'                        TO   KC70-NUM-STATUS.                
           MOVE 'BP13C45M'                 TO   KC70-NUM-USERID.                
           MOVE WS-DTE-CURR-8              TO   KC70-DTE-UPDATE.                
           MOVE FUNCTION CURRENT-DATE(9:9) TO   KC70-TME-UPDATE.                
           MOVE '3'                        TO   KC70-NUM-CATEGORY.              
                                                                                
           PERFORM 4010-BP13KC70-WRITE     THRU 4010-EXIT.                      
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=============================================================            
       4010-BP13KC70-WRITE.                                                     
      *=============================================================            
                                                                                
           WRITE BP13KC70-REC.                                                  
                                                                                
           EVALUATE WS-KC70-STATUS                                              
           WHEN 00                                                              
              ADD 1                        TO   WS-CNT-KC70-WRITE               
                                                                                
           WHEN 02                                                              
           WHEN 22                                                              
              PERFORM 4020-REWRITE-KC70    THRU 4020-EXIT                       
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'WRITE BP13KC70 ERROR '   WS-KC70-STATUS                  
              MOVE     WS-KC70-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4010-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       4020-REWRITE-KC70.                                                       
      *=============================================================            
                                                                                
           REWRITE BP13KC70-REC.                                                
                                                                                
           EVALUATE WS-KC70-STATUS                                              
           WHEN 00                                                              
              ADD 1                        TO   WS-CNT-KC70-UPDATE              
                                                                                
           WHEN OTHER                                                           
              DISPLAY 'REWRITE BP13KC70 ERROR ' WS-KC70-STATUS                  
              MOVE     WS-KC70-STATUS      TO   RETURN-CODE                     
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4020-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *=============================================================            
       9000-CLOSE-ROUTINE.                                                      
      *=============================================================            
                                                                                
           CLOSE BP13F800                                                       
                 BM06K110                                                       
                 BP13K820                                                       
                 BP13KC20                                                       
                 BP13KC25                                                       
                 BP13KC70.                                                      
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BM06K110 ERROR ' WS-K110-STATUS                  
              MOVE     WS-K110-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13K820 ERROR ' WS-K820-STATUS                  
              MOVE     WS-K820-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-KC20-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13KC20 ERROR ' WS-KC20-STATUS                  
              MOVE     WS-KC20-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-KC25-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13KC25 ERROR ' WS-KC25-STATUS                  
              MOVE     WS-KC25-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           IF WS-KC70-STATUS NOT = 00 AND 97                                    
              DISPLAY 'CLOSING BP13KC70 ERROR ' WS-KC70-STATUS                  
              MOVE     WS-KC70-STATUS      TO   RETURN-CODE                     
           END-IF.                                                              
                                                                                
           DISPLAY '   '.                                                       
           DISPLAY '*------- BP13C45M CONTROL TOTAL -------*'.                  
           DISPLAY '   '.                                                       
           DISPLAY ' 1. NO OF BP13F800 READ      : ' WS-CNT-F800-READ.          
           DISPLAY ' 2. NO OF BP13KC70 WRITTEN   : ' WS-CNT-KC70-WRITE.         
           DISPLAY ' 3. NO OF BP13KC70 UPDATED   : ' WS-CNT-KC70-UPDATE.        
           DISPLAY '  '.                                                        
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
