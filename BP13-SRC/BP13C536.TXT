       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C536.                                                 
      *AUTHOR.        TRM1.                                                     
      *DATE-WRITTEN.  07/07/2011.                                               
      **********************************************************                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *    SYSTEM ID : BP13                                    *                
      *                                                        *                
      *    OBJECTIVE  :                                        *                
      *        1.  TO DUPLICATE RECORDS FOR DBSS GRO           *                
      *            CASES IN BP13K740                           *                
      *        2.  TO PRINT CONTROL LIST OF THE ASSIGNMENTS.   *                
      *                                                        *                
      *     INPUT FILES :                                      *                
      *       1. BP13F740  :  BALLOT FILE                      *                
      *                                                        *                
      *     I-O FILES.                                         *                
      *       1. BP13K740  :  BALLOT FILE FOR MATURE NT        *                
      *       2. BP13K825  :  OCCUPIER FILE                    *                
      *       3. BP13K830  :  ADDRESS FILE                     *                
      *       4. BP13KB78  :  DBS REQUEST FILE                 *                
      *       4. BP13KB95  :  DATE/REGN FILE                   *                
      *                                                        *                
      *     OUTPUT FILES :                                     *                
      *       1. BP13L536  : CONTROL LIST                      *                
      *                                                        *                
      *  CHG NO   BY   ON        DESCRIPTION                   *                
      *  ------   --   --        -----------                   *                
      * BP134270 TRM1 07072011  -NEW PROGRAM COPIED FROM       *                
      *                          BP13C511                      *                
      *                         -USED KB95 INSTEAD OF KB85     *                
      **********************************************************                
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3900.                                               
       OBJECT-COMPUTER. IBM-3900.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F740  ASSIGN  TO  BP13F740.                               
           SELECT BP13K740  ASSIGN  TO  BP13K740                                
                ACCESS       IS RANDOM                                          
                ORGANIZATION IS INDEXED                                         
                RECORD KEY   IS K740-KEY-FLD                                    
                FILE STATUS  IS BP13K740-STATUS.                                
                                                                                
           SELECT BP13KB78  ASSIGN  TO  BP13KB78                                
                ACCESS       IS RANDOM                                          
                ORGANIZATION IS INDEXED                                         
                RECORD KEY   IS KB78-KEY-FLD                                    
                FILE STATUS  IS BP13KB78-STATUS.                                
                                                                                
           SELECT BP13KB95  ASSIGN  TO  BP13KB95                                
                ACCESS       IS RANDOM                                          
                ORGANIZATION IS INDEXED                                         
                RECORD KEY   IS KB95-KEY-FLD                                    
                FILE STATUS  IS BP13KB95-STATUS.                                
                                                                                
           SELECT BP13K825  ASSIGN  TO  BP13K825                                
                ACCESS       IS DYNAMIC                                         
                ORGANIZATION IS INDEXED                                         
                RECORD KEY   IS K825-KEY-FLD                                    
                FILE STATUS  IS BP13K825-STATUS.                                
                                                                                
           SELECT BP13K830  ASSIGN  TO  BP13K830                                
                ACCESS       IS DYNAMIC                                         
                ORGANIZATION IS INDEXED                                         
                RECORD KEY   IS K830-KEY-FLD                                    
                FILE STATUS  IS BP13K830-STATUS.                                
                                                                                
           SELECT BP13L536  ASSIGN  TO  BP13L536.                               
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F740                                                             
           BLOCK     CONTAINS 0   RECORDS                                       
           RECORD    CONTAINS 500 CHARACTERS                                    
           LABEL     RECORDS  ARE STANDARD                                      
           RECORDING MODE IS F.                                                 
       COPY BP13F740.                                                           
                                                                                
       FD  BP13K740                                                             
           RECORD    CONTAINS 500 CHARACTERS.                                   
       COPY BP13K740.                                                           
                                                                                
       FD  BP13KB78                                                             
           RECORD    CONTAINS 3300 CHARACTERS.                                  
       COPY BP13KB78.                                                           
                                                                                
       FD  BP13K825                                                             
           RECORD    CONTAINS 200 CHARACTERS.                                   
       COPY BP13K825.                                                           
                                                                                
       FD  BP13KB95                                                             
           RECORD    CONTAINS 50 CHARACTERS.                                    
       COPY BP13KB95.                                                           
                                                                                
       FD  BP13K830                                                             
           RECORD    CONTAINS 250 CHARACTERS.                                   
       COPY BP13K830.                                                           
                                                                                
       FD  BP13L536                                                             
           BLOCK     CONTAINS   0 RECORDS                                       
           RECORD    CONTAINS 132 CHARACTERS                                    
           LABEL     RECORDS  ARE OMITTED                                       
           RECORDING MODE IS F.                                                 
       01  BP13L536-PRT-REC    PIC X(132).                                      
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILE-STATUS.                                                         
           05 BP13K740-STATUS           PIC 99 VALUE 0.                         
              88 BP13K740-WRITE-OK          VALUE 0.                            
           05 BP13KB78-STATUS           PIC 99 VALUE 0.                         
              88 BP13KB78-WRITE-OK          VALUE 0.                            
           05 BP13KB95-STATUS           PIC 99 VALUE 0.                         
              88 BP13KB95-REC-FOUND         VALUE 0.                            
              88 BP13KB95-REC-NOTFND        VALUE 23.                           
           05 BP13K825-STATUS           PIC 99 VALUE 0.                         
              88 BP13K825-REC-FOUND         VALUE 0.                            
              88 BP13K825-REC-NOTFND        VALUE 23.                           
           05 BP13K830-STATUS           PIC 99 VALUE 0.                         
              88 BP13K830-REC-FOUND         VALUE 0.                            
              88 BP13K830-REC-NOTFND        VALUE 23.                           
              88 BP13K830-WRITE-OK          VALUE 0.                            
                                                                                
       01  WS-ACCUMULATORS.                                                     
           05 WS-NUM-READ-BP13F740      PIC 9(06) VALUE ZERO.                   
           05 WS-NUM-WRITE-BP13K740     PIC 9(06) VALUE ZERO.                   
           05 WS-NUM-WRITE-BP13K830     PIC 9(06) VALUE ZERO.                   
           05 WS-NUM-WRITE-BP13KB78     PIC 9(06) VALUE ZERO.                   
           05 WS-NUM-WRITE-BP13K825     PIC 9(06) VALUE ZERO.                   
           05 WS-NUM-REWRITE-BP13KB95   PIC 9(06) VALUE ZERO.                   
           05 WS-LINECT                 PIC 9(02) VALUE 60.                     
           05 WS-PAGECT                 PIC 9(04) VALUE ZERO.                   
           05 WS-SEQCT                  PIC 9(04) VALUE ZERO.                   
                                                                                
       01  WS-SWITCHES.                                                         
           05 EOF-BP13F740-IND          PIC X(01) VALUE SPACE.                  
              88 EOF-BP13F740               VALUE 'Y'.                          
           05 WS-DATE-FOUND-IND         PIC X(01) VALUE SPACE.                  
              88 WS-DATE-FOUND              VALUE 'Y'.                          
                                                                                
       01  WS-KB95-CURDTE-NOTFND        PIC X(01) VALUE SPACE.                  
       01  WS-K825-UPDATED              PIC X(01) VALUE SPACE.                  
                                                                                
       01  WS-CURR-DATE.                                                        
           05 WS-CURR-MM                PIC 9(02).                              
           05 FILLER                    PIC X(01).                              
           05 WS-CURR-DD                PIC 9(02).                              
           05 FILLER                    PIC X(01).                              
           05 WS-CURR-CCYY              PIC 9(04).                              
                                                                                
       01  WS-CURR-CCYYMMDD.                                                    
           05 WS-CCYY                   PIC 9(04).                              
           05 WS-MM                     PIC 9(02).                              
           05 WS-DD                     PIC 9(02).                              
                                                                                
       01  FILLER  REDEFINES  WS-CURR-CCYYMMDD.                                 
           05 WS-CURR-YEAR.                                                     
              10 WS-YEAR-YR             PIC 9(04).                              
           05 WS-YEAR REDEFINES WS-CURR-YEAR  PIC 9(04).                        
           05 FILLER                    PIC 9(04).                              
                                                                                
       01  WS-SYS-TIME                 PIC 9(07).                               
                                                                                
       01  WS-SYS-DATE.                                                         
           05 WS-SYS-CCYY              PIC 9(04).                               
           05 WS-SYS-MM                PIC 9(02).                               
           05 WS-SYS-DD                PIC 9(02).                               
                                                                                
       01  WS-RESULT1                  PIC 9(4)  VALUE 0.                       
       01  WS-RESULT2                  PIC 9(4)  VALUE 0.                       
       01  WS-RESULT3                  PIC 9(4)  VALUE 0.                       
       01  WS-REM1                     PIC 9(03) VALUE 0.                       
       01  WS-REM2                     PIC 9(03) VALUE 0.                       
       01  WS-REM3                     PIC 9(03) VALUE 0.                       
                                                                                
      ************************************************************              
      *    TABLE CONTAINING THE THE LAST DAY OF THE MONTH        *              
      ************************************************************              
                                                                                
       01  WS-MTHLDAY-TABLE.                                                    
           05 FILLER                   PIC X(04) VALUE '0131'.                  
           05 FILLER                   PIC X(04) VALUE '0228'.                  
           05 FILLER                   PIC X(04) VALUE '0331'.                  
           05 FILLER                   PIC X(04) VALUE '0430'.                  
           05 FILLER                   PIC X(04) VALUE '0531'.                  
           05 FILLER                   PIC X(04) VALUE '0630'.                  
           05 FILLER                   PIC X(04) VALUE '0731'.                  
           05 FILLER                   PIC X(04) VALUE '0831'.                  
           05 FILLER                   PIC X(04) VALUE '0930'.                  
           05 FILLER                   PIC X(04) VALUE '1031'.                  
           05 FILLER                   PIC X(04) VALUE '1130'.                  
           05 FILLER                   PIC X(04) VALUE '1231'.                  
                                                                                
       01  WS-MTHLDAY-TBL   REDEFINES  WS-MTHLDAY-TABLE.                        
           05 WS-MTHLDAY-REC               OCCURS 12 TIMES                      
              INDEXED BY WS-MLDAY-IDX.                                          
              10 WS-MTH                PIC X(02).                               
              10 WS-LDAY               PIC X(02).                               
                                                                                
      ************************************************************              
      *    VARIABLES FOR CREATION OF REGN NO. CHECK DIGIT        *              
      ************************************************************              
                                                                                
       01  WS-REGN-TAB.                                                         
           05 FILLER                   PIC X(33) VALUE                          
             '01A02B03C04D05E06F07G08H09I10Z11J'.                               
                                                                                
       01  WS-REGNO-TAB REDEFINES WS-REGN-TAB.                                  
           05 REGN-TAB                     OCCURS 11 TIMES                      
              INDEXED BY WS-CDG.                                                
              10 REGN-REMAINDER        PIC 9(02).                               
              10 REGN-CDG              PIC X(01).                               
                                                                                
       01  WS-REG                      PIC X(08) VALUE SPACES.                  
                                                                                
       01  WS-REGN-NUMERIC.                                                     
           05 REGN-NUM OCCURS 7 TIMES  PIC 9(01).                               
           05 REGN-FLD                 PIC X(01).                               
                                                                                
       01  WS-FLD.                                                              
           05 WS-FLD1                  PIC 9(04) VALUE 0.                       
           05 WS-FLD2                  PIC 9(04) VALUE 0.                       
           05 WS-FLD3                  PIC 9(02) VALUE 0.                       
                                                                                
       01  WS-CHK-DGT                  PIC X(01) VALUE SPACE.                   
                                                                                
       01  WS-TEMP-REG-NO.                                                      
           05 WS-TEMP-REG-NUM          PIC 9(07).                               
           05 WS-TEMP-CHK-DGT          PIC X(01).                               
                                                                                
      **************************************************************            
      *           LAY-OUT FOR CONTROL LISTING                      *            
      **************************************************************            
                                                                                
       01  L536-HDG1.                                                           
           05 FILLER                   PIC X(14) VALUE 'BP13L536'.              
           05 FILLER                   PIC X(08) VALUE 'HDB3'.                  
           05 FILLER                   PIC X(18) VALUE SPACES.                  
           05 FILLER                   PIC X(39) VALUE                          
              'S Y S T E M   O F   C O M M I T M E N T'.                        
           05 FILLER                   PIC X(18) VALUE SPACES.                  
           05 FILLER                   PIC X(07) VALUE 'DATE: '.                
           05 HDG1-DATE                PIC X(10) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE SPACES.                  
           05 FILLER                   PIC X(07) VALUE 'PAGE: '.                
           05 HDG1-PAGECT              PIC ZZZZ9.                               
                                                                                
       01  L536-HDG2.                                                           
           05 FILLER                   PIC X(97) VALUE SPACES.                  
           05 FILLER                   PIC X(32) VALUE                          
              'SALES UNIT (APPLICATION TEAM)'.                                  
                                                                                
       01  L536-HDG3.                                                           
           05 FILLER                   PIC X(33) VALUE SPACES.                  
           05 FILLER                   PIC X(60) VALUE                          
              'LIST OF SUCCESSFUL REQUEST ASSIGNED REGISTRATION NO'.            
                                                                                
       01  L536-HDG4.                                                           
           05 FILLER                   PIC X(05) VALUE ' S/N'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(29) VALUE                          
             '       RANDOM NO'.                                                
           05 FILLER                   PIC X(08) VALUE 'PREV-REF'.              
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(08) VALUE 'CURR-REF'.              
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(07) VALUE 'REGN NO'.               
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE 'CAT'.                   
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(11) VALUE 'NRIC1/NRIC2'.           
           05 FILLER                   PIC X(09) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE ' JB'.                   
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(05) VALUE 'RANK'.                  
           05 FILLER                   PIC X(03) VALUE 'ALC'.                   
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE 'ELIG'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE ' NT '.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE ' FT '.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE ' JB '.                  
           05 FILLER                   PIC X(03) VALUE SPACES.                  
           05 FILLER                   PIC X(06) VALUE 'OPTION'.                
                                                                                
       01  L536-HDG5.                                                           
           05 FILLER                   PIC X(67) VALUE SPACES.                  
           05 FILLER                   PIC X(14) VALUE                          
             'APPLICANT NAME'.                                                  
           05 FILLER                   PIC X(06) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE 'CODE'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(06) VALUE '   SCH'.                
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE ' SCH'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE 'CODE'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE 'TYPE'.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(06) VALUE 'REF-NO'.                
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(04) VALUE 'CASE'.                  
                                                                                
       01  L536-DTL1.                                                           
           05 SERIAL-NO                PIC Z(4)9.                               
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 RANDOM-NO                PIC X(28) VALUE SPACES.                  
           05 FILLER                   PIC X(01) VALUE SPACE.                   
           05 PREV-RN                  PIC X(06) VALUE SPACES.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 CUR-RN                   PIC X(08) VALUE SPACES.                  
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 REGN-NO                  PIC X(08) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE SPACES.                  
           05 CAT                      PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 NRIC-1                   PIC X(09) VALUE SPACES.                  
           05 FILLER                   PIC X(01) VALUE '/'.                     
           05 NRIC-2                   PIC X(09) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE SPACES.                  
           05 JB-CODE                  PIC X(01) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE SPACES.                  
           05 GRO-RANK                 PIC X(02) VALUE SPACES.                  
           05 FILLER                   PIC X(03) VALUE SPACES.                  
           05 ALLOC-SCH                PIC X(03) VALUE SPACES.                  
           05 FILLER                   PIC X(01) VALUE SPACES.                  
           05 L-CDE-ELIG               PIC X(03) VALUE SPACES.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 NT-CODE                  PIC X(04) VALUE SPACES.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 FT-TYPE                  PIC X(04) VALUE SPACES.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 JB-REF                   PIC X(06) VALUE SPACES.                  
           05 FILLER                   PIC X(02) VALUE SPACES.                  
           05 OPTION-CASE              PIC X(01) VALUE SPACES.                  
                                                                                
       01  L536-DTL2.                                                           
           05 FILLER                   PIC X(67) VALUE SPACES.                  
           05 NAME                     PIC X(66) VALUE SPACES.                  
                                                                                
       01  WS-BLANK-LINE  PIC X(132)             VALUE SPACES.                  
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      *----------------*                                                        
       010-OPEN-ROUTINE.                                                        
      *----------------*                                                        
      *    READY TRACE.                                                         
                                                                                
           OPEN INPUT  BP13F740                                                 
                I-O    BP13KB95                                                 
                       BP13K740                                                 
                       BP13KB78                                                 
                       BP13K825                                                 
                       BP13K830                                                 
                OUTPUT BP13L536.                                                
                                                                                
           IF BP13K740-STATUS NOT = 0 AND 97                                    
              DISPLAY ' ERROR OPENING BP13K740 FILE, STATUS '                   
                      BP13K740-STATUS                                           
              MOVE BP13K740-STATUS TO RETURN-CODE                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13KB78-STATUS NOT = 0 AND 97                                    
              DISPLAY ' ERROR OPENING BP13KB78 FILE, STATUS '                   
                      BP13KB78-STATUS                                           
              MOVE BP13KB78-STATUS TO RETURN-CODE                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K825-STATUS NOT = 0 AND 97                                    
              DISPLAY ' ERROR OPENING BP13K825 FILE, STATUS '                   
                      BP13K825-STATUS                                           
              MOVE BP13K825-STATUS TO RETURN-CODE                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13KB95-STATUS NOT = 0 AND 97                                    
              DISPLAY ' ERROR OPENING BP13KB95 FILE, STATUS '                   
                      BP13KB95-STATUS                                           
              MOVE BP13KB95-STATUS TO RETURN-CODE                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
           IF BP13K830-STATUS NOT = 0 AND 97                                    
              DISPLAY ' ERROR OPENING BP13K830 FILE, STATUS '                   
                      BP13K830-STATUS                                           
              MOVE BP13K830-STATUS TO RETURN-CODE                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
      *-------------------*                                                     
       020-PROCESS-ROUTINE.                                                     
      *-------------------*                                                     
                                                                                
      ** SET CURRENT DATE FORMAT FOR REGN AND CONTROL LISTING **                
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CURR-CCYYMMDD.                 
           MOVE FUNCTION CURRENT-DATE(9:7) TO WS-SYS-TIME.                      
           MOVE WS-DD             TO WS-CURR-DD  WS-SYS-DD.                     
           MOVE WS-MM             TO WS-CURR-MM  WS-SYS-MM.                     
           MOVE WS-CCYY           TO WS-CURR-CCYY  WS-SYS-CCYY.                 
                                                                                
           STRING WS-CURR-DD '/' WS-CURR-MM '/' WS-CURR-CCYY                    
                  DELIMITED BY SIZE INTO HDG1-DATE                              
           END-STRING.                                                          
      *                                                                         
           PERFORM 100-PROCESS-BP13KB95 THRU 100-EXIT                           
              UNTIL WS-DATE-FOUND.                                              
      *                                                                         
           PERFORM 200-PROCESS-BP13F740 THRU 200-EXIT                           
              UNTIL EOF-BP13F740.                                               
      *                                                                         
           PERFORM 800-UPDATE-BP13KB95  THRU 800-EXIT.                          
      *                                                                         
           PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT.                             
      *                                                                         
       020-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       030-CLOSE-ROUTINE.                                                       
      *-----------------*                                                       
                                                                                
           CLOSE BP13F740                                                       
                 BP13KB95                                                       
                 BP13K740                                                       
                 BP13KB78                                                       
                 BP13K825                                                       
                 BP13K830                                                       
                 BP13L536.                                                      
                                                                                
           IF BP13K740-STATUS NOT = 0                                           
              DISPLAY ' ERROR CLOSING BP13K740 FILE, STATUS '                   
                      BP13K740-STATUS                                           
           END-IF.                                                              
                                                                                
           IF BP13KB78-STATUS NOT = 0                                           
              DISPLAY ' ERROR CLOSING BP13KB78 FILE, STATUS '                   
                      BP13KB78-STATUS                                           
           END-IF.                                                              
                                                                                
           IF BP13KB95-STATUS NOT = 0                                           
              MOVE BP13KB95-STATUS TO RETURN-CODE                               
              DISPLAY ' ERROR CLOSING BP13KB95 FILE, STATUS '                   
                      BP13KB95-STATUS                                           
           END-IF.                                                              
                                                                                
           IF BP13K825-STATUS NOT = 0                                           
              MOVE BP13K825-STATUS TO RETURN-CODE                               
              DISPLAY ' ERROR CLOSING K825 FILE, STATUS '                       
                     BP13K825-STATUS                                            
           END-IF.                                                              
                                                                                
           IF BP13K830-STATUS NOT = 0                                           
              MOVE BP13K830-STATUS TO RETURN-CODE                               
              DISPLAY ' ERROR CLOSING K830 FILE, STATUS '                       
                     BP13K830-STATUS                                            
           END-IF.                                                              
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY 'BP13C536 CONTROL TOTAL         ' HDG1-DATE.                 
           DISPLAY '*******************************************'.               
           DISPLAY ' RECORDS READ FROM    BP13F740  = '                         
                     WS-NUM-READ-BP13F740.                                      
           DISPLAY ' RECORDS WRITTEN   TO BP13K740  = '                         
                     WS-NUM-WRITE-BP13K740.                                     
           DISPLAY ' RECORDS WRITTEN   TO BP13KB78  = '                         
                     WS-NUM-WRITE-BP13KB78.                                     
           DISPLAY ' RECORDS WRITTEN   TO BP13K830  = '                         
                     WS-NUM-WRITE-BP13K830.                                     
           DISPLAY ' RECORDS WRITTEN   TO BP13K825  = '                         
                     WS-NUM-WRITE-BP13K825.                                     
           DISPLAY ' RECORDS REWRITTEN TO BP13KB95  = '                         
                     WS-NUM-REWRITE-BP13KB95.                                   
           DISPLAY '*******************************************'.               
                                                                                
           STOP RUN.                                                            
                                                                                
       030-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *  1.  READ BP13KB95 FILE USING CURRENT DATE              *               
      *        OR CURRENT DATE - 1                              *               
      *  2.  IF NOT FOUND                                       *               
      *         SUBTRACT 1 FROM DATE AND REPEAT ROUTINE         *               
      *         UNTIL DATE FOUND                                *               
      ***********************************************************               
                                                                                
      *--------------------*                                                    
       100-PROCESS-BP13KB95.                                                    
      *--------------------*                                                    
                                                                                
           MOVE 'BP13'      TO KB95-KEY-FLD.                                    
                                                                                
           READ BP13KB95.                                                       
                                                                                
           IF BP13KB95-REC-FOUND                                                
              MOVE 'Y'                TO WS-DATE-FOUND-IND                      
              MOVE KB95-NUM-LAST-REGN TO WS-TEMP-REG-NO                         
              MOVE WS-SYS-TIME        TO KB95-TME-UPDATE                        
              MOVE WS-SYS-DATE        TO KB95-DTE-UPDATE                        
              MOVE 'BP13C536'         TO KB95-NUM-USERID                        
           ELSE                                                                 
             IF BP13KB95-REC-NOTFND                                             
                MOVE 'Y' TO WS-KB95-CURDTE-NOTFND                               
             ELSE                                                               
                DISPLAY ' ERROR READING BP13KB95, STATUS '                      
                          BP13KB95-STATUS                                       
                MOVE BP13KB95-STATUS  TO RETURN-CODE                            
                PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                         
             END-IF                                                             
           END-IF.                                                              
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *  1.  READ BP13F740 FILE AT END EXIT                     *               
      *  2.  IF (F740-CDE-UNSUCC NOT = SPACES AND LOW-VALUES)   *               
      *       AND FLAT-TYPE NOT = 3 OR 4S                       *               
      *         ASSIGN REGISTRATION NUMBER                      *               
      ***********************************************************               
                                                                                
      *--------------------*                                                    
       200-PROCESS-BP13F740.                                                    
      *--------------------*                                                    
                                                                                
           READ BP13F740  AT END                                                
                MOVE 'Y' TO EOF-BP13F740-IND                                    
                GO TO 200-EXIT                                                  
           END-READ.                                                            
                                                                                
           ADD   1          TO WS-NUM-READ-BP13F740.                            
           MOVE 'N'         TO WS-K825-UPDATED.                                 
                                                                                
           PERFORM  300-UPDATE-BP13K740    THRU  300-EXIT.                      
           PERFORM  400-UPDATE-BP13K830    THRU  400-EXIT.                      
           PERFORM  500-UPDATE-BP13K825    THRU  500-EXIT                       
                            UNTIL WS-K825-UPDATED = 'Y'.                        
           PERFORM  600-UPDATE-BP13KB78    THRU  600-EXIT.                      
                                                                                
           PERFORM  700-PRINT-CONTROL-LIST THRU  700-EXIT.                      
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *  1.  INCREMENT LAST REG NO.                             *               
      *  2.  ASSIGN REGISTRATION NUMBER AND UPDATE              *               
      *      BP13K740 WITH  REG. NO.                            *               
      ***********************************************************               
                                                                                
      *-------------------*                                                     
       300-UPDATE-BP13K740.                                                     
      *-------------------*                                                     
                                                                                
           MOVE SPACES         TO  BP13K740-REC.                                
           MOVE F740-KEY-FLD   TO  K740-KEY-FLD.                                
                                                                                
           READ BP13K740.                                                       
                                                                                
           IF BP13K740-STATUS = 23                                              
               DISPLAY 'BP13K740 RECORD NOT FOUND ' F740-KEY-FLD                
               GO TO 300-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF BP13K740-STATUS NOT = 00 AND 23                                   
               MOVE BP13K740-STATUS TO RETURN-CODE                              
               DISPLAY 'ERROR READING BP13K740'    BP13K740-STATUS              
               PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                          
           END-IF.                                                              
                                                                                
           ADD 1 TO WS-TEMP-REG-NUM.                                            
           PERFORM 320-FIND-CHK-DGT THRU 320-EXIT.                              
                                                                                
           MOVE WS-TEMP-REG-NO   TO K740-NUM-REGN  F740-NUM-REGN                
                                    K740-NUM-REF.                               
           MOVE 'P'              TO K740-NUM-RANDOM(28:1).                      
           MOVE SPACES           TO K740-NUM-GRO-RANK.                          
           MOVE SPACES           TO K740-NUM-WARD.                              
           MOVE SPACES           TO K740-CDE-SERVE.                             
                                                                                
           IF F740-CDE-REQ-ALLOC-SCH = SPACES                                   
               MOVE 'PA'   TO K740-CDE-ALLOC-SCH                                
           ELSE                                                                 
               MOVE F740-CDE-REQ-ALLOC-SCH TO K740-CDE-ALLOC-SCH                
               MOVE SPACES           TO K740-CDE-REQ-ALLOC-SCH                  
           END-IF.                                                              
                                                                                
           WRITE BP13K740-REC.                                                  
                                                                                
           IF BP13K740-WRITE-OK                                                 
              ADD 1 TO WS-NUM-WRITE-BP13K740                                    
              DISPLAY  'REG-NO '    K740-NUM-REGN                               
           ELSE                                                                 
              DISPLAY ' ERROR WRITING BP13K740, STATUS '                        
                        BP13K740-STATUS                                         
              MOVE BP13K740-STATUS TO RETURN-CODE                               
              DISPLAY  ' REGN NO ' WS-TEMP-REG-NO                               
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
           IF WS-KB95-CURDTE-NOTFND = 'Y'                                       
              MOVE SPACES TO BP13KB95-REC                                       
              MOVE 'BP13'           TO KB95-KEY-FLD                             
              MOVE WS-TEMP-REG-NO TO KB95-NUM-LAST-REGN                         
              MOVE WS-SYS-TIME        TO KB95-TME-UPDATE                        
              MOVE WS-SYS-DATE        TO KB95-DTE-UPDATE                        
              MOVE 'BP13C536'         TO KB95-NUM-USERID                        
              WRITE BP13KB95-REC                                                
              MOVE SPACE TO WS-KB95-CURDTE-NOTFND                               
           END-IF.                                                              
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ************************************************************              
      *     CREATE REGISTRATION NUMBER CHECK DIGIT               *              
      ************************************************************              
                                                                                
      *----------------*                                                        
       320-FIND-CHK-DGT.                                                        
      *----------------*                                                        
                                                                                
            MOVE WS-TEMP-REG-NO  TO WS-REG.                                     
            MOVE WS-REG          TO WS-REGN-NUMERIC.                            
            COMPUTE WS-FLD1 = REGN-NUM (1) * 2 + REGN-NUM (2) * 7 +             
                              REGN-NUM (3) * 6 + REGN-NUM (4) * 5 +             
                              REGN-NUM (5) * 4 + REGN-NUM (6) * 3 +             
                              REGN-NUM (7) * 2.                                 
            DIVIDE WS-FLD1 BY 11 GIVING WS-FLD2 REMAINDER WS-FLD3               
                COMPUTE WS-FLD3 = 11 - WS-FLD3.                                 
            SET WS-CDG TO 1.                                                    
                                                                                
            SEARCH REGN-TAB                                                     
                   AT END GO TO 320-EXIT                                        
                   WHEN REGN-REMAINDER (WS-CDG) = WS-FLD3                       
                        MOVE REGN-CDG (WS-CDG) TO WS-CHK-DGT                    
            END-SEARCH.                                                         
                                                                                
            MOVE WS-CHK-DGT TO WS-TEMP-CHK-DGT.                                 
                                                                                
       320-EXIT.                                                                
            EXIT.                                                               
                                                                                
      ***********************************************************               
      *      UPDATE BP13K830 FILE                               *               
      ***********************************************************               
                                                                                
      *-------------------*                                                     
       400-UPDATE-BP13K830.                                                     
      *-------------------*                                                     
                                                                                
           MOVE SPACES         TO  BP13K830-REC.                                
           MOVE F740-NUM-REF   TO  K830-NUM-REF.                                
                                                                                
           READ BP13K830.                                                       
                                                                                
           IF BP13K830-STATUS = 23                                              
               DISPLAY 'BP13K830 RECORD NOT FOUND ' F740-NUM-REF                
               GO TO   400-EXIT                                                 
           END-IF.                                                              
                                                                                
           IF BP13K830-STATUS NOT = 00 AND 02 AND 23                            
               MOVE BP13K830-STATUS TO RETURN-CODE                              
               DISPLAY 'ERROR READING BP13K830 '    BP13K830-STATUS             
                      ' KEY IS ' F740-NUM-REF                                   
               PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                          
           END-IF.                                                              
                                                                                
           IF BP13K830-STATUS = 00 OR 02                                        
              MOVE WS-TEMP-REG-NO TO K830-NUM-REGN                              
                                     K830-KEY-FLD                               
              PERFORM 410-WRITE-BP13K830 THRU 410-EXIT                          
           END-IF.                                                              
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *      WRITE  BP13K830 FILE                               *               
      ***********************************************************               
                                                                                
      *------------------*                                                      
       410-WRITE-BP13K830.                                                      
      *------------------*                                                      
                                                                                
           WRITE BP13K830-REC.                                                  
                                                                                
           IF BP13K830-STATUS = 00                                              
             ADD      1          TO WS-NUM-WRITE-BP13K830                       
           ELSE                                                                 
             DISPLAY 'ERROR WRITING BP13K830 ' BP13K830-STATUS                  
                    ' KEY IS ' K830-KEY-FLD                                     
             MOVE BP13K830-STATUS      TO   RETURN-CODE                         
             PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                            
           END-IF.                                                              
                                                                                
       410-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *      UPDATE BP13K825 FILE                               *               
      ***********************************************************               
                                                                                
      *-------------------*                                                     
       500-UPDATE-BP13K825.                                                     
      *-------------------*                                                     
                                                                                
           MOVE SPACES         TO  BP13K825-REC.                                
           MOVE F740-NUM-REF   TO  K825-NUM-REF.                                
                                                                                
           START BP13K825 KEY > K825-KEY-FLD.                                   
                                                                                
           IF BP13K825-STATUS NOT = 00 AND 02                                   
              MOVE 'Y'                    TO WS-K825-UPDATED                    
              DISPLAY 'BP13K825 RECORD NOT FOUND ' F740-NUM-REF                 
              GO                          TO 500-EXIT.                          
                                                                                
           PERFORM 500-READNEXT-BP13K825                                        
                          UNTIL WS-K825-UPDATED = 'Y'.                          
                                                                                
       500-READNEXT-BP13K825.                                                   
                                                                                
           READ BP13K825 NEXT AT END                                            
                MOVE 'Y'                  TO WS-K825-UPDATED                    
                GO TO 500-EXIT.                                                 
                                                                                
           IF K825-NUM-REF NOT = F740-NUM-REF                                   
               MOVE 'Y'                   TO WS-K825-UPDATED                    
               GO TO 500-EXIT                                                   
                                                                                
           ELSE                                                                 
                                                                                
              MOVE WS-TEMP-REG-NO         TO K825-NUM-REGN                      
              WRITE BP13K825-REC                                                
                                                                                
              IF BP13K825-STATUS = 00 OR 02 OR 22                               
                 ADD 1 TO WS-NUM-WRITE-BP13K825                                 
                                                                                
              ELSE                                                              
                 DISPLAY 'ERROR WRITING BP13K825 '  BP13K825-STATUS             
                        ' KEY IS ' K825-KEY-FLD                                 
                 MOVE BP13K825-STATUS  TO RETURN-CODE                           
                 PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                        
              END-IF                                                            
                                                                                
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *  1.  ASSIGN REGISTRATION NUMBER AND UPDATE              *               
      *      BP13KB78 WITH  REG. NO.                            *               
      ***********************************************************               
                                                                                
      *-------------------*                                                     
       600-UPDATE-BP13KB78.                                                     
      *-------------------*                                                     
                                                                                
           MOVE SPACES         TO  BP13KB78-REC.                                
           MOVE F740-NUM-REF   TO  KB78-KEY-FLD.                                
                                                                                
           READ BP13KB78.                                                       
                                                                                
           IF BP13KB78-STATUS = 23                                              
               DISPLAY 'BP13KB78 RECORD NOT FOUND ' F740-NUM-REF                
               GO TO   600-EXIT                                                 
           END-IF.                                                              
                                                                                
           IF BP13KB78-STATUS NOT = 00 AND 23                                   
               MOVE BP13KB78-STATUS TO RETURN-CODE                              
               DISPLAY 'ERROR READING BP13KB78'    BP13KB78-STATUS              
               PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE WS-TEMP-REG-NO   TO KB78-NUM-REGN.                              
                                                                                
           WRITE BP13KB78-REC.                                                  
                                                                                
           IF BP13KB78-STATUS = 00 OR 02                                        
              ADD 1 TO WS-NUM-WRITE-BP13KB78                                    
           ELSE                                                                 
              MOVE BP13KB78-STATUS  TO RETURN-CODE                              
              DISPLAY 'ERROR WRITING BP13KB78 '  BP13KB78-STATUS                
                      ' KEY IS ' KB78-NUM-REGN                                  
              PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                           
           END-IF.                                                              
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *      PRINT CONTROL LIST                                 *               
      ***********************************************************               
                                                                                
      *----------------------*                                                  
       700-PRINT-CONTROL-LIST.                                                  
      *----------------------*                                                  
                                                                                
           IF WS-LINECT > 50                                                    
              PERFORM 750-PRINT-HEADING THRU 750-EXIT                           
           END-IF.                                                              
                                                                                
           ADD  1 TO WS-SEQCT.                                                  
                                                                                
           MOVE SPACES           TO BP13K825-REC.                               
           MOVE F740-NUM-REF     TO K825-NUM-REGN.                              
           MOVE F740-NUM-NRIC1   TO K825-NUM-NRIC.                              
                                                                                
           READ BP13K825.                                                       
                                                                                
           IF BP13K825-STATUS = 00                                              
             MOVE K825-NME-OCCP     TO NAME                                     
           ELSE                                                                 
              IF BP13K825-STATUS = 23                                           
                 DISPLAY 'BP13K825 RECORD NOT FOUND '                           
                         F740-NUM-REGN ' ' F740-NUM-NRIC1                       
                MOVE SPACES  TO NAME                                            
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K825 ' BP13K825-STATUS              
                 DISPLAY 'IN RETRIEVING NAME,'                                  
                        ' KEY IS ' K825-KEY-FLD                                 
                 PERFORM 030-CLOSE-ROUTINE THRU 030-EXIT                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F740-NUM-NRIC2 (2:1) NOT = '#'                                    
              MOVE F740-NUM-NRIC2  TO NRIC-2                                    
           ELSE                                                                 
              MOVE SPACES          TO NRIC-2                                    
           END-IF.                                                              
                                                                                
           MOVE WS-SEQCT            TO SERIAL-NO.                               
           MOVE K740-NUM-REGN       TO REGN-NO.                                 
           MOVE F740-NUM-REF        TO CUR-RN.                                  
           MOVE F740-NUM-PREV-REF   TO PREV-RN.                                 
           MOVE F740-NUM-NRIC1      TO NRIC-1.                                  
           MOVE F740-CDE-CATEGORY   TO CAT.                                     
           MOVE F740-CDE-JB         TO JB-CODE.                                 
           MOVE F740-CDE-ALLOC-SCH  TO ALLOC-SCH.                               
           MOVE F740-NUM-GRO-RANK   TO GRO-RANK.                                
           MOVE F740-CDE-ELIG-SCH   TO L-CDE-ELIG.                              
           MOVE F740-CDE-SUCC-NT-ZONE    TO NT-CODE.                            
           MOVE F740-CDE-FLAT-TYPE  TO FT-TYPE.                                 
           MOVE F740-NUM-JB-REF     TO JB-REF.                                  
                                                                                
           IF F740-NUM-PREV-REF = SPACES OR LOW-VALUES                          
               MOVE SPACES              TO OPTION-CASE                          
                                           PREV-RN                              
           ELSE                                                                 
               MOVE 'X'                 TO OPTION-CASE                          
               MOVE F740-NUM-PREV-REF   TO PREV-RN                              
           END-IF.                                                              
                                                                                
           MOVE F740-NUM-RANDOM     TO RANDOM-NO.                               
                                                                                
           ADD  2                   TO WS-LINECT.                               
           WRITE BP13L536-PRT-REC   FROM L536-DTL1  AFTER 2.                    
           MOVE SPACES              TO BP13L536-PRT-REC.                        
                                                                                
           ADD  1                   TO WS-LINECT.                               
           WRITE BP13L536-PRT-REC   FROM L536-DTL2  AFTER 1.                    
           MOVE SPACES              TO BP13L536-PRT-REC.                        
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       750-PRINT-HEADING.                                                       
      *-----------------*                                                       
                                                                                
           ADD   1 TO WS-PAGECT.                                                
           MOVE  1 TO WS-LINECT.                                                
           MOVE  WS-PAGECT TO HDG1-PAGECT.                                      
           WRITE BP13L536-PRT-REC FROM L536-HDG1 AFTER PAGE.                    
           WRITE BP13L536-PRT-REC FROM L536-HDG2.                               
           WRITE BP13L536-PRT-REC FROM L536-HDG3.                               
           WRITE BP13L536-PRT-REC FROM WS-BLANK-LINE.                           
           WRITE BP13L536-PRT-REC FROM L536-HDG4.                               
           WRITE BP13L536-PRT-REC FROM L536-HDG5.                               
           MOVE  SPACES       TO BP13L536-PRT-REC.                              
           WRITE BP13L536-PRT-REC.                                              
                                                                                
       750-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ***********************************************************               
      *      UPDATE BP13KB95 FILE                               *               
      ***********************************************************               
                                                                                
      *-------------------*                                                     
       800-UPDATE-BP13KB95.                                                     
      *-------------------*                                                     
                                                                                
           MOVE SPACES         TO  BP13KB95-REC.                                
           MOVE 'BP13'         TO  KB95-KEY-FLD.                                
                                                                                
           READ BP13KB95.                                                       
                                                                                
           IF BP13KB95-STATUS NOT = 0                                           
               MOVE BP13KB95-STATUS TO RETURN-CODE                              
               DISPLAY 'READ ERROR - BP13KB95 ' BP13KB95-STATUS                 
               PERFORM  030-CLOSE-ROUTINE THRU 030-EXIT                         
           END-IF.                                                              
                                                                                
           MOVE WS-TEMP-REG-NO TO KB95-NUM-LAST-REGN.                           
           MOVE WS-SYS-TIME    TO KB95-TME-UPDATE.                              
           MOVE WS-SYS-DATE    TO KB95-DTE-UPDATE.                              
           MOVE 'BP13C536'     TO KB95-NUM-USERID.                              
                                                                                
           REWRITE BP13KB95-REC.                                                
                                                                                
           IF BP13KB95-STATUS NOT = 0                                           
               MOVE BP13KB95-STATUS TO RETURN-CODE                              
               DISPLAY 'REWRITE ERROR - BP13KB95 ' BP13KB95-STATUS              
               PERFORM  030-CLOSE-ROUTINE THRU 030-EXIT                         
           ELSE                                                                 
               ADD 1 TO  WS-NUM-REWRITE-BP13KB95                                
           END-IF.                                                              
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
