      *===============================================================* 00010001
       IDENTIFICATION DIVISION.                                         00020001
      *===============================================================* 00030001
       PROGRAM-ID.    BP13C38L.                                         00040001
       AUTHOR.        PAULO CAMIA LEGASPI.                              00050001
       DATE-WRITTEN.  MAY 07, 2015.                                     00060001
      *===============================================================* 00070001
      * OBJECTIVE  :  PRINT BUY FIRST CASES WITH NO LA APPOINTMENT    * 00080001
      *===============================================================* 00090001
      *                                                               * 00100001
      * INPUT FILE :                                                  * 00110001
      *               1. BP13F800                                     * 00120001
      *                                                                 00130001
      * OUTPUT FILE:  1. BP13L38L                                     * 00140001
      *                                                               * 00150001
      *===============================================================* 00160001
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              * 00170001
      *---------------------------------------------------------------* 00180001
      * BP135711 07/05/2015 PCL4 NEW PROGRAM.                         * 00190001
      * BP135711 30/05/2015 PCL4 TO UPDATE EMAIL RECIPIENTS           * 00200001
      * BP136082 13/01/2016 PCL4 TO UPDATE EMAIL RECIPIENTS           * 00210001
      * BP136477 18/10/2016 RJB1 TO REMOVE LIM KIM HUAT               * 00220001
      * BP136539 23/11/2016 PCL4 TO REMOVE SENDING OF EMAIL TO        * 00230001
      *                          INDIVIDUAL OIC (BP13L38L)            * 00240001
      * BP136851 20/06/2017 PCL4 TO UPDATE EMAIL RECIPIENTS           * 00250001
      * BP138047 25/11/2019 KAC1 RECOMPILE FOR BP27 COPYBOOK UPDATE   * 00260001
      * BP138757 14/06/2021 KV8  TO REplace LAU HONG HUAT with BERNICE* 00270001
      * BP139030 07/01/2022 ZAR7 REPLACE CHUA YEE MIEN TO LIM KOK CHUN  00271001
      * BP139451 25/02/2023 ZAR7 REPLACE CHUA YEE MIEN TO LIM KOK CHUN  00271101
      *                          INDIVIDUAL OIC (BP13L38L)            * 00271201
      * BP139276 05/04/2024 KAC1 REPLACE LIM KOK CHUN BY              * 00271303
      *                                  KATHIJAH_BEE_ALI_MOHAMED     * 00271403
      * BP139175 29/04/2024 KAC1 REPL Bernice_JH_GAN@hdb.gov.sg WITH  * 00271503
      *                               Iris_LL_KOR@hdb.gov.sg          * 00271603
      *===============================================================* 00272001
                                                                        00273001
                                                                        00274001
      **********************                                            00275001
       ENVIRONMENT DIVISION.                                            00276001
      **********************                                            00277001
                                                                        00278001
       CONFIGURATION SECTION.                                           00279001
       SOURCE-COMPUTER. IBM-3090.                                       00280001
       OBJECT-COMPUTER. IBM-3090.                                       00290001
       INPUT-OUTPUT SECTION.                                            00300001
       FILE-CONTROL.                                                    00310001
                                                                        00320001
           SELECT  BP13F800  ASSIGN        TO BP13F800.                 00330001
                                                                        00340001
           SELECT  BP13K022  ASSIGN        TO BP13K022                  00350001
                             ACCESS MODE   IS DYNAMIC                   00360001
                             ORGANIZATION  IS INDEXED                   00370001
                             RECORD KEY    IS K022-KEY-FLD              00380001
                             ALTERNATE RECORD KEY IS K022-NUM-REGN      00390001
                             FILE STATUS   IS WS-K022-STATUS.           00400001
                                                                        00410001
           SELECT  BM06K110  ASSIGN       TO BM06K110                   00420001
                             ACCESS MODE  IS RANDOM                     00430001
                             ORGANIZATION IS INDEXED                    00440001
                             RECORD KEY   IS K110-KEY-FLD OF K110-REC   00450001
                             FILE STATUS  IS WS-K110-STATUS.            00460001
                                                                        00470001
           SELECT  BP27K800  ASSIGN       TO BP27K800                   00480001
                             ACCESS MODE  IS RANDOM                     00490001
                             ORGANIZATION IS INDEXED                    00500001
                       RECORD KEY IS K800-NUM-HLA OF BP27K800-MASTER    00510001
                       FILE STATUS IS WS-K800-STATUS.                   00520001
                                                                        00530001
           SELECT  BP13K800  ASSIGN       TO BP13K800                   00540001
                             ACCESS MODE  IS RANDOM                     00550001
                             ORGANIZATION IS INDEXED                    00560001
                       RECORD KEY IS K800-NUM-REGN                      00570001
                       FILE STATUS IS WS-K800-STATUS1.                  00580001
                                                                        00590001
                                                                        00600001
           SELECT  MAILC38L  ASSIGN        TO MAILC38L.                 00610001
                                                                        00620001
      ***************                                                   00630001
       DATA DIVISION.                                                   00640001
      ***************                                                   00650001
                                                                        00660001
       FILE SECTION.                                                    00670001
                                                                        00680001
       FD   BP13F800                                                    00690001
            BLOCK CONTAINS 0 RECORDS                                    00700001
            RECORD CONTAINS 2000 CHARACTERS                             00710001
            LABEL RECORDS ARE STANDARD                                  00720001
            RECORDING MODE IS F.                                        00730001
       COPY BP13F800.                                                   00740001
                                                                        00750001
       FD   BP27K800                                                    00760001
            RECORD CONTAINS 1200 CHARACTERS.                            00770001
       COPY BP27K800.                                                   00780001
                                                                        00790001
       FD   BP13K800                                                    00800001
            RECORD CONTAINS 2000 CHARACTERS.                            00810001
       COPY BP13K800.                                                   00820001
                                                                        00830001
       FD   BP13K022                                                    00840001
            RECORD CONTAINS 100 CHARACTERS.                             00850001
       COPY BP13K022.                                                   00860001
                                                                        00870001
       FD   BM06K110                                                    00880001
            RECORD CONTAINS 500 CHARACTERS.                             00890001
       COPY BM06K110.                                                   00900001
                                                                        00910001
       FD   MAILC38L                                                    00920001
            RECORDING MODE IS F                                         00930001
            RECORD CONTAINS  100 CHARACTERS.                            00940001
       01   MAILC38L-REC               PIC X(100).                      00950001
                                                                        00960001
       WORKING-STORAGE SECTION.                                         00970001
      ******************************************************************00980001
      *                   WORKING-STORAGE AREA                         *00990001
      ******************************************************************01000001
       01  FILE-VARIABLES.                                              01010001
           05  WS-EOF-F800             PIC X(1)  VALUE 'N'.             01020001
           05  WS-K800-STATUS          PIC 9(02) VALUE ZEROES.          01030001
           05  WS-K800-STATUS1         PIC 9(02) VALUE ZEROES.          01040001
           05  WS-K110-STATUS          PIC 9(02) VALUE ZEROES.          01050001
           05  WS-K022-STATUS          PIC 9(02) VALUE ZEROES.          01060001
                                                                        01070001
       01  WS-ADDRESS.                                                  01080001
           05 WS-BLK-NO                PIC X(05) VALUE SPACES.          01090001
           05 FILLER                   PIC X     VALUE SPACES.          01100001
           05 WS-FLAT-NO.                                               01110001
              10 FILLER                PIC X     VALUE '#'.             01120001
              10 WS-LVL-NO             PIC X(2)  VALUE SPACES.          01130001
              10 FILLER                PIC X     VALUE '-'.             01140001
              10 WS-UNIT-NO            PIC X(4)  VALUE SPACES.          01150001
           05 FILLER                   PIC X(1)  VALUE SPACES.          01160001
           05 WS-STREET                PIC X(25) VALUE SPACES.          01170001
           05 WS-SINGAPORE             PIC X(01) VALUE 'S'.             01180001
           05 FILLER                   PIC X(1)  VALUE SPACES.          01190001
           05 WS-OPEN                  PIC X(01) VALUE '('.             01200001
           05 WS-POSTAL-CODE           PIC X(6)  VALUE SPACES.          01210001
           05 WS-CLOSE                 PIC X(01) VALUE ')'.             01220001
                                                                        01230001
       01  WS-COUNTERS.                                                 01240001
           05  WS-I                    PIC 9(1)  VALUE ZEROES.          01250001
           05  WS-F800-READ            PIC 9(7)  VALUE ZEROES.          01260001
           05  WS-K800-FNDD            PIC 9(7)  VALUE ZEROES.          01270001
           05  WS-SNO                  PIC 9(7)  VALUE ZEROES.          01280001
           05  WS-LINE-CTR             PIC 9(2)  VALUE ZEROES.          01290001
           05  WS-PAGE-CTR             PIC 9(4)  VALUE ZEROES.          01300001
           05  WS-CNT-L38L-WRITE       PIC 9(7)  VALUE ZEROES.          01310001
           05  WS-CNT-WRITE            PIC 9(5)  VALUE 2.               01320001
           05  WS-CNT-BYPASS           PIC 9(7)  VALUE ZEROES.          01330001
           05  WS-MAX-LINE             PIC 9(2)  VALUE 55.              01340001
                                                                        01350001
       01  WS-VARIABLES.                                                01360001
           05 WS-PRIOR-DTE             PIC 9(08) VALUE ZEROES.          01370001
           05 WS-2NDCA-DTE             PIC 9(08) VALUE ZEROES.          01380001
           05 WS-NUM-DTE-APPT          PIC 9(07) VALUE ZEROES.          01390001
           05 WS-NUM-DTE-CA            PIC 9(07) VALUE ZEROES.          01400001
           05 WS-SYSTEM-DATE           PIC 9(8)  VALUE ZEROES.          01410001
           05 WS-NUM-OIC               PIC X(5)  VALUE ZEROES.          01420001
           05 WS-HLE-EXPIRY            PIC X(8)  VALUE SPACES.          01430001
           05 WS-NUM-NRIC              PIC X(9)  VALUE SPACES.          01440001
           05 WS-NUM-FTS               PIC X(2)  VALUE SPACES.          01450001
           05 WS-NUM-RELN              PIC X(20) VALUE SPACES.          01460001
           05 WS-SNO-ZZZZ9             PIC ZZZZ9 VALUE ZEROES.          01470001
           05 WS-FIRST-WRITE           PIC X(1)  VALUE 'Y'.             01480001
                                                                        01490001
       01 WS-PRIO-DTE.                                                  01500001
          05  WS-PRIO-CCYY                 PIC 9(04).                   01510001
          05  WS-PRIO-MM                   PIC 9(02).                   01520001
          05  WS-PRIO-DD                   PIC 9(02).                   01530001
                                                                        01540001
       01 WS-CA-DTE.                                                    01550001
          05  WS-CA-CCYY                   PIC 9(04).                   01560001
          05  WS-CA-MM                     PIC 9(02).                   01570001
          05  WS-CA-DD                     PIC 9(02).                   01580001
                                                                        01590001
       01 WS-CURR-DATE.                                                 01600001
          05  WS-CURR-CCYY                 PIC 9(04).                   01610001
          05  WS-CURR-MM                   PIC 9(02).                   01620001
          05  WS-CURR-DD                   PIC 9(02).                   01630001
                                                                        01640001
       01  WS-DEBAR-CODE               PIC X(02).                       01650001
           88 VALID-YR-CODE          VALUE 'YR'.                        01660001
           88 VALID-YS-CODE          VALUE 'YS'.                        01670001
                                                                        01680001
       01  L38L-HEADER01.                                               01690001
           05  FILLER              PIC X(8)      VALUE 'BP13L38L'.      01700001
           05  FILLER              PIC X(4)      VALUE SPACES.          01710001
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.      01720001
           05  FILLER              PIC X(02)     VALUE SPACES.          01730001
           05  FILLER              PIC X(20)     VALUE                  01740001
                                  'S Y S T E M   O F   '.               01750001
           05  FILLER              PIC X(19) VALUE                      01760001
                                  'C O M M I T M E N T'.                01770001
           05  FILLER              PIC X(02)     VALUE SPACES.          01780001
           05  FILLER              PIC X(07)     VALUE 'DATE : '.       01790001
           05  L38L-DATE-HDR       PIC X(10)     VALUE SPACES.          01800001
           05  FILLER              PIC X(04)     VALUE SPACES.          01810001
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.       01820001
           05  L38L-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.          01830001
                                                                        01840001
       01  L38L-HEADER02.                                               01850001
           05  FILLER              PIC X(22)    VALUE SPACES.           01860001
           05  FILLER              PIC X(31)     VALUE                  01870001
                   'REPORT ON BUY FIRST CASES WITH '.                   01880001
           05  FILLER              PIC X(22) VALUE                      01890001
                   'NO LA APPOINTMENT DATE'.                            01900001
                                                                        01910001
       01  L38L-HEADER03.                                               01920001
           05  FILLER              PIC X(01)    VALUE SPACES.           01930001
           05  FILLER              PIC X(05)    VALUE '  S/N'.          01940001
           05  FILLER              PIC X(01)    VALUE SPACES.           01950001
           05  FILLER              PIC X(08)    VALUE 'REGN NO '.       01960001
           05  FILLER              PIC X(01)    VALUE SPACES.           01970001
           05  FILLER              PIC X(11)    VALUE 'HLE EXPIRY '.    01980001
           05  FILLER              PIC X(01)    VALUE SPACES.           01990001
           05  FILLER              PIC X(05)    VALUE 'OIC '.           02000001
           05  FILLER              PIC X(01)    VALUE SPACES.           02010001
           05  FILLER              PIC X(50)    VALUE 'FLAT ADDRESS'.   02020001
                                                                        02030001
       01  L38L-HEADER04.                                               02040001
           05  FILLER              PIC X(07)    VALUE SPACES.           02050001
           05  FILLER              PIC X(40)     VALUE                  02060001
                   'HLE HAS BEEN APPROVED, APPOINTMENT TEAM '.          02070001
           05  FILLER              PIC X(40)     VALUE                  02080001
                   'WILL SCHEDULE LA APPOINTMENT.'.                     02090001
                                                                        02100001
       01  L38L-DETAIL01.                                               02110001
           05  FILLER              PIC X(01)        VALUE SPACES.       02120001
           05  L38L-SN             PIC X(05)        VALUE SPACES.       02130001
           05  FILLER              PIC X(01)        VALUE SPACES.       02140001
           05  L38L-REGN           PIC X(08)        VALUE SPACES.       02150001
           05  FILLER              PIC X(01)        VALUE SPACES.       02160001
           05  L38L-HLE-EXPIRY     PIC X(10)        VALUE SPACES.       02170001
           05  FILLER              PIC X(02)        VALUE SPACES.       02180001
           05  L38L-OIC            PIC X(05)        VALUE SPACES.       02190001
           05  FILLER              PIC X(01)        VALUE SPACES.       02200001
           05  L38L-FLAT-ADDRESS   PIC X(50)        VALUE SPACES.       02210001
                                                                        02220001
       01  WS-REPORT-DTL.                                               02230001
           05  WS-EMPTY-RPT.                                            02240001
               10 FILLER                  PIC X(30) VALUE SPACES.       02250001
               10 FILLER                  PIC X(21)                     02260001
                                          VALUE '<   EMPTY  REPORT   >'.02270001
           05  WS-DATE-RPT-DTL.                                         02280001
               10 FILLER                PIC X(6)  VALUE 'DATE: '.       02290001
               10 WS-DATE-RPT           PIC X(10) VALUE SPACES.         02300001
           05  WS-MAIL-RPT1             PIC X(12) VALUE 'HELO SGPHDB1'. 02310001
           05  WS-MAIL-RPT2             PIC X(27)                       02320001
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                        02330001
      *    05  WS-MAIL-RPT3A            PIC X(55)                       02340001
      *        VALUE 'RCPT TO:<LAU_HONG_HUAT@hdb.gov.sg>'.              02350001
           05  WS-MAIL-RPT3A            PIC X(55)                       02360001
               VALUE 'RCPT TO:<Iris_LL_KOR@hdb.gov.sg>'.                02370003
           05  WS-MAIL-RPT3B            PIC X(37)                       02380001
               VALUE 'RCPT TO:<TENG_SIEW_HONG@hdb.gov.sg>'.             02390001
           05  WS-MAIL-RPT4             PIC X(45)                       02400003
               VALUE 'RCPT TO:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.   02410003
           05  WS-MAIL-RPT5             PIC X(4)                        02420001
               VALUE 'DATA'.                                            02430001
           05  WS-MAIL-RPT6             PIC X(29)                       02440001
               VALUE 'FROM:Soc System - Email Alert'.                   02450001
           05  WS-MAIL-RPT8             PIC X(40)                       02460003
               VALUE 'TO:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.        02470003
      *    05  WS-MAIL-RPT8A            PIC X(50)                       02480001
      *        VALUE 'TO:<LAU_HONG_HUAT@hdb.gov.sg>'.                   02490001
           05  WS-MAIL-RPT8A            PIC X(50)                       02500001
               VALUE 'TO:<Iris_LL_KOR@hdb.gov.sg>'.                     02510003
           05  WS-MAIL-RPT8B            PIC X(37)                       02520001
               VALUE 'TO:<TENG_SIEW_HONG@hdb.gov.sg>'.                  02530001
           05  WS-MAIL-RPT9             PIC X(80) VALUE                 02540001
                   'SUBJECT: REPORT ON BUY FIRST CASES W/ NO LA DATE'.  02550001
           05  FILLER              PIC X(01)        VALUE SPACES.       02560001
                                                                        02570001
           05  WS-DATE-RPT-OIC.                                         02580001
               10 FILLER                PIC X(6)  VALUE 'DATE: '.       02590001
               10 WS-DATE-OIC           PIC X(10) VALUE SPACES.         02600001
           05  WS-MAIL-OIC1             PIC X(12) VALUE 'HELO SGPHDB1'. 02610001
           05  WS-MAIL-OIC2             PIC X(27)                       02620001
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                        02630001
           05  WS-MAIL-OIC3             PIC X(45)                       02640003
               VALUE 'RCPT TO:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.   02650003
           05  WS-MAIL-OIC4             PIC X(4)                        02660001
               VALUE 'DATA'.                                            02670001
           05  WS-MAIL-OIC5             PIC X(29)                       02680001
               VALUE 'FROM:Soc System - Email Alert'.                   02690001
           05  WS-MAIL-OIC6             PIC X(40)                       02700003
               VALUE 'TO:<KATHIJAH_BEE_ALI_MOHAMED@hdb.gov.sg>'.        02710003
           05  WS-MAIL-OIC7             PIC X(80) VALUE                 02720001
                   'SUBJECT: REPORT ON BUY FIRST CASES W/ NO LA DATE'.  02730001
           05  FILLER              PIC X(01)        VALUE SPACES.       02740001
                                                                        02750001
       COPY P13COMM8.                                                   02760001
                                                                        02770001
      *-------------------------------------------------------*         02780001
      *    LINKAGE VARIABLES                                  *         02790001
      *-------------------------------------------------------*         02800001
       01  WS-LINK-BP13C913.                                            02810001
           05  LINK-NUM-SCH-ACC.                                        02820001
               10  LINK-NUM-SCH        PIC X(4).                        02830001
               10  LINK-NUM-ACC        PIC X(5).                        02840001
                                                                        02850001
      ******************************************************************02860001
      *                   P R O G R A M     B O D Y                    *02870001
      ******************************************************************02880001
                                                                        02890001
      ********************                                              02900001
       PROCEDURE DIVISION.                                              02910001
      ********************                                              02920001
                                                                        02930001
      ******************************************************************02940001
       0000-MAIN.                                                       02950001
      ******************************************************************02960001
                                                                        02970001
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.              02980001
                                                                        02990001
           PERFORM 2000-READ-BP13F800      THRU 2000-EXIT.              03000001
                                                                        03010001
           PERFORM 3000-PROCESS-RECORDS    THRU 3000-EXIT               03020001
             UNTIL WS-EOF-F800 = 'Y'.                                   03030001
                                                                        03040001
           PERFORM 9999-CLOSE-ROUTINE      THRU 9999-EXIT.              03050001
                                                                        03060001
       0000-EXIT.                                                       03070001
           EXIT.                                                        03080001
                                                                        03090001
      ******************************************************************03100001
       1000-OPEN-ROUTINE.                                               03110001
      ******************************************************************03120001
                                                                        03130001
           OPEN INPUT  BP13F800                                         03140001
                       BP27K800                                         03150001
                       BP13K022                                         03160001
                       BM06K110                                         03170001
                I-O    BP13K800                                         03180001
              OUTPUT   MAILC38L.                                        03190001
                                                                        03200001
                                                                        03210001
           IF WS-K800-STATUS NOT = 00 AND 97                            03220001
              DISPLAY 'BP27K800 - ERROR OPENING : ' WS-K800-STATUS      03230001
              MOVE WS-K800-STATUS                   TO RETURN-CODE      03240001
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03250001
           END-IF.                                                      03260001
                                                                        03270001
           IF WS-K800-STATUS1 NOT = 00 AND 97                           03280001
              DISPLAY 'BP13K800 - ERROR OPENING : ' WS-K800-STATUS1     03290001
              MOVE WS-K800-STATUS1                  TO RETURN-CODE      03300001
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03310001
           END-IF.                                                      03320001
                                                                        03330001
           IF WS-K022-STATUS NOT = 00 AND 97                            03340001
              DISPLAY 'BP13K022 - ERROR OPENING : ' WS-K022-STATUS      03350001
              MOVE WS-K022-STATUS                   TO RETURN-CODE      03360001
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03370001
           END-IF.                                                      03380001
                                                                        03390001
           IF WS-K110-STATUS NOT = 00 AND 97                            03400001
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K110-STATUS      03410001
              MOVE WS-K110-STATUS                   TO RETURN-CODE      03420001
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT               03430001
           END-IF.                                                      03440001
                                                                        03450001
           PERFORM 6000-PRINT-HEADER       THRU 6000-EXIT.              03460001
           PERFORM 7000-HEADER-EMAIL       THRU 7000-EXIT.              03470001
                                                                        03480001
       1000-EXIT.                                                       03490001
           EXIT.                                                        03500001
                                                                        03510001
      ******************************************************************03520001
       2000-READ-BP13F800.                                              03530001
      ******************************************************************03540001
                                                                        03550001
           READ BP13F800           AT   END                             03560001
                MOVE 'Y'           TO   WS-EOF-F800                     03570001
                GO                 TO   2000-EXIT.                      03580001
                                                                        03590001
           ADD  1                  TO WS-F800-READ.                     03600001
                                                                        03610001
       2000-EXIT.                                                       03620001
           EXIT.                                                        03630001
                                                                        03640001
                                                                        03650001
      ******************************************************************03660001
       3000-PROCESS-RECORDS.                                            03670001
      ******************************************************************03680001
                                                                        03690001
           MOVE ZEROES                         TO WS-CA-DTE.            03700001
                                                                        03710001
           IF F800-DTE-2ND-CA-SENT NOT = SPACES AND LOW-VALUES          03720001
                                                AND ZEROES              03730001
              PERFORM 6100-GET-DATE            THRU 6100-EXIT           03740001
           END-IF.                                                      03750001
                                                                        03760001
           IF (F800-DTE-2ND-CA-SENT NOT = SPACES AND LOW-VALUES         03770001
                                    AND ZEROES)  AND                    03780001
              (F800-DTE-2ND-CONC-LOAN-SIGNED = SPACES OR LOW-VALUES     03790001
                                    OR  ZEROES)  AND                    03800001
              (F800-NUM-LOAN-TAG OF BP13F800-MASTER = 'H') AND          03810001
              (F800-NUM-BUY-SELL-RPT-SENT NOT = 'Y')       AND          03820001
              (F800-NUM-BUY-SELL-TAG = 'B')                AND          03830001
              (WS-CA-DTE >= WS-PRIO-DTE)                                03840001
                                                                        03850001
              PERFORM 3100-READ-BM06K110           THRU 3100-EXIT       03860001
                                                                        03870001
              IF K110-DTE-KEY-AVAIL = SPACES OR LOW-VALUES OR ZEROES    03880001
                 PERFORM 3200-READ-BP27K800        THRU 3200-EXIT       03890001
                 PERFORM 3300-READ-BP13K022        THRU 3300-EXIT       03900001
                 PERFORM 5000-PRINT-REPORT         THRU 5000-EXIT       03910001
                 PERFORM 5100-UPDATE-BP13K800      THRU 5100-EXIT       03920001
              ELSE                                                      03930001
                 ADD 1                             TO WS-CNT-BYPASS     03940001
              END-IF                                                    03950001
           ELSE                                                         03960001
              ADD 1                                TO WS-CNT-BYPASS     03970001
           END-IF.                                                      03980001
                                                                        03990001
           PERFORM 2000-READ-BP13F800              THRU 2000-EXIT.      04000001
                                                                        04010001
       3000-EXIT.                                                       04020001
           EXIT.                                                        04030001
                                                                        04040001
      ******************************************************************04050001
       3100-READ-BM06K110.                                              04060001
      ******************************************************************04070001
                                                                        04080001
           MOVE SPACES                   TO K110-REC.                   04090001
           INITIALIZE                       K110-REC.                   04100001
                                                                        04110001
           MOVE F800-NUM-SCH-ACC         TO K110-KEY-FLD OF K110-REC.   04120001
                                                                        04130001
           READ BM06K110.                                               04140001
                                                                        04150001
           EVALUATE WS-K110-STATUS                                      04160001
               WHEN 00                                                  04170001
                    CONTINUE                                            04180001
                                                                        04190001
               WHEN 23                                                  04200001
                    MOVE SPACES                           TO K110-REC   04210001
                    INITIALIZE                               K110-REC   04220001
                                                                        04230001
               WHEN OTHER                                               04240001
                    DISPLAY 'ERROR READING BM06K110 : ' WS-K110-STATUS  04250001
                            ' KEY  = ' K110-KEY-FLD OF K110-REC         04260001
                    PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT     04270001
           END-EVALUATE.                                                04280001
                                                                        04290001
       3100-EXIT.                                                       04300001
           EXIT.                                                        04310001
                                                                        04320001
      ******************************************************************04330001
       3200-READ-BP27K800.                                              04340001
      ******************************************************************04350001
                                                                        04360001
           MOVE SPACES                   TO BP27K800-MASTER.            04370001
           INITIALIZE                       BP27K800-MASTER.            04380001
                                                                        04390001
           MOVE SPACES                   TO WS-HLE-EXPIRY.              04400001
                                                                        04410001
           MOVE F800-NUM-HLA OF BP13F800-MASTER                         04420001
             TO K800-NUM-HLA OF BP27K800-MASTER.                        04430001
                                                                        04440001
           READ BP27K800.                                               04450001
                                                                        04460001
           EVALUATE WS-K800-STATUS                                      04470001
               WHEN 00                                                  04480001
                    MOVE K800-DTE-HLA-EXPIRY   TO WS-HLE-EXPIRY         04490001
                                                                        04500001
               WHEN 23                                                  04510001
                    MOVE SPACES                TO WS-HLE-EXPIRY         04520001
                                                                        04530001
               WHEN OTHER                                               04540001
                    DISPLAY 'ERROR READING BP27K800 : ' WS-K800-STATUS  04550001
                            ' KEY  = ' K800-NUM-HLA OF BP27K800-MASTER  04560001
                    PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT     04570001
           END-EVALUATE.                                                04580001
                                                                        04590001
       3200-EXIT.                                                       04600001
           EXIT.                                                        04610001
                                                                        04620001
      ******************************************************************04630001
       3300-READ-BP13K022.                                              04640001
      ******************************************************************04650001
                                                                        04660001
           MOVE SPACES                            TO BP13K022-REC.      04670001
           INITIALIZE                                BP13K022-REC.      04680001
                                                                        04690001
           MOVE SPACES                            TO WS-NUM-OIC.        04700001
                                                                        04710001
           MOVE F800-NUM-REGN                     TO K022-NUM-REGN.     04720001
                                                                        04730001
           READ BP13K022 KEY IS K022-NUM-REGN                           04740001
                                                                        04750001
           EVALUATE WS-K022-STATUS                                      04760001
               WHEN 00                                                  04770001
               WHEN 02                                                  04780001
                    MOVE K022-NUM-OIC             TO WS-NUM-OIC         04790001
                                                                        04800001
               WHEN 23                                                  04810001
                    MOVE SPACES                   TO WS-NUM-OIC         04820001
                                                                        04830001
               WHEN OTHER                                               04840001
                    DISPLAY 'ERROR READING BP13K022 : ' WS-K022-STATUS  04850001
                            ' REGN = ' F800-NUM-REGN                    04860001
                    PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT     04870001
           END-EVALUATE.                                                04880001
                                                                        04890001
       3300-EXIT.                                                       04900001
           EXIT.                                                        04910001
                                                                        04920001
                                                                        04930001
      ******************************************************************04940001
       5000-PRINT-REPORT.                                               04950001
      ******************************************************************04960001
                                                                        04970001
           MOVE SPACES                       TO L38L-DETAIL01.          04980001
           INITIALIZE                           L38L-DETAIL01.          04990001
                                                                        05000001
           ADD 1                          TO WS-SNO                     05010001
           MOVE WS-SNO                    TO WS-SNO-ZZZZ9               05020001
           MOVE WS-SNO-ZZZZ9              TO L38L-SN                    05030001
           MOVE F800-NUM-REGN             TO L38L-REGN                  05040001
                                                                        05050001
           IF WS-HLE-EXPIRY NOT = SPACES AND LOW-VALUES AND ZEROES      05060001
              STRING WS-HLE-EXPIRY(7:2) '/'                             05070001
                     WS-HLE-EXPIRY(5:2) '/'                             05080001
                     WS-HLE-EXPIRY(1:4)                                 05090001
                   DELIMITED BY SIZE INTO L38L-HLE-EXPIRY               05100001
           END-IF.                                                      05110001
                                                                        05120001
           MOVE WS-NUM-OIC                TO L38L-OIC.                  05130001
                                                                        05140001
           IF F800-NUM-SCH-ACC NOT = SPACES AND LOW-VALUES              05150001
              MOVE SPACES                       TO BP13COMM8-REC        05160001
              INITIALIZE                           BP13COMM8-REC        05170001
                                                                        05180001
              MOVE SPACES                       TO WS-BLK-NO            05190001
                                                   WS-LVL-NO            05200001
                                                   WS-UNIT-NO           05210001
                                                   WS-STREET            05220001
                                                   WS-POSTAL-CODE       05230001
                                                                        05240001
              MOVE F800-NUM-SCH-ACC             TO LINK-NUM-SCH-ACC     05250001
              PERFORM 6200-CALL-BP13C913      THRU 6200-EXIT            05260001
                                                                        05270001
              MOVE COMM8-NUM-BLK                TO WS-BLK-NO            05280001
              MOVE COMM8-NUM-LEVEL              TO WS-LVL-NO            05290001
              MOVE COMM8-NUM-UNIT-MAIN          TO WS-UNIT-NO           05300001
              MOVE COMM8-NME-STREET             TO WS-STREET            05310001
              MOVE COMM8-NUM-POSTAL-CODE        TO WS-POSTAL-CODE       05320001
                                                                        05330001
              MOVE WS-ADDRESS                   TO L38L-FLAT-ADDRESS    05340001
           END-IF.                                                      05350001
                                                                        05360001
                                                                        05370001
           WRITE MAILC38L-REC                 FROM L38L-DETAIL01.       05380001
           ADD 1                                TO WS-CNT-L38L-WRITE.   05390001
                                                                        05400001
       5000-EXIT.                                                       05410001
           EXIT.                                                        05420001
                                                                        05430001
      ******************************************************************05440001
       5100-UPDATE-BP13K800.                                            05450001
      ******************************************************************05460001
                                                                        05470001
           MOVE SPACES                   TO BP13K800-MASTER.            05480001
           INITIALIZE                       BP13K800-MASTER.            05490001
                                                                        05500001
           MOVE F800-NUM-REGN            TO K800-NUM-REGN.              05510001
                                                                        05520001
           READ BP13K800.                                               05530001
                                                                        05540001
           EVALUATE WS-K800-STATUS1                                     05550001
               WHEN 00                                                  05560001
                    PERFORM 5200-REWRITE-BP13K800    THRU 5200-EXIT     05570001
                                                                        05580001
               WHEN 23                                                  05590001
                    CONTINUE                                            05600001
                                                                        05610001
               WHEN OTHER                                               05620001
                    DISPLAY 'ERROR READING BP13K800 : ' WS-K800-STATUS1 05630001
                            ' KEY  = ' K800-NUM-REGN OF BP13K800-MASTER 05640001
                    PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT     05650001
           END-EVALUATE.                                                05660001
                                                                        05670001
       5100-EXIT.                                                       05680001
           EXIT.                                                        05690001
                                                                        05700001
      ******************************************************************05710001
       5200-REWRITE-BP13K800.                                           05720001
      ******************************************************************05730001
                                                                        05740001
           MOVE 'Y'                       TO K800-NUM-BUY-SELL-RPT-SENT 05750001
                                                                        05760001
           REWRITE BP13K800-MASTER.                                     05770001
                                                                        05780001
           EVALUATE WS-K800-STATUS1                                     05790001
               WHEN 00                                                  05800001
                    CONTINUE                                            05810001
                                                                        05820001
               WHEN OTHER                                               05830001
                  DISPLAY 'REWRITE ERROR BP13K800 : '  WS-K800-STATUS1  05840001
                          ' KEY : ' K800-NUM-REGN                       05850001
                  PERFORM  9999-CLOSE-ROUTINE     THRU 9999-EXIT        05860001
           END-EVALUATE.                                                05870001
                                                                        05880001
       5200-EXIT.                                                       05890001
           EXIT.                                                        05900001
                                                                        05910001
      ******************************************************************05920001
       6000-PRINT-HEADER.                                               05930001
      ******************************************************************05940001
                                                                        05950001
           MOVE FUNCTION CURRENT-DATE(1:8)      TO WS-SYSTEM-DATE       05960001
                                                   WS-CURR-DATE         05970001
                                                   WS-PRIO-DTE.         05980001
                                                                        05990001
           STRING WS-CURR-DD '/' WS-CURR-MM '/' WS-CURR-CCYY            06000001
                    DELIMITED BY SIZE INTO WS-DATE-RPT.                 06010001
                                                                        06020001
           STRING WS-SYSTEM-DATE(7:2) '/'                               06030001
                  WS-SYSTEM-DATE(5:2) '/'                               06040001
                  WS-SYSTEM-DATE(1:4)                                   06050001
              DELIMITED BY SIZE INTO L38L-DATE-HDR.                     06060001
                                                                        06070001
           ADD 1                               TO WS-PAGE-CTR.          06080001
           MOVE ZEROES                         TO L38L-PAGE-HDR.        06090001
           MOVE WS-PAGE-CTR                    TO L38L-PAGE-HDR.        06100001
                                                                        06110001
       6000-EXIT.                                                       06120001
           EXIT.                                                        06130001
                                                                        06140001
      ******************************************************************06150001
       6100-GET-DATE.                                                   06160001
      ******************************************************************06170001
                                                                        06180001
           MOVE F800-DTE-2ND-CA-SENT           TO  WS-2NDCA-DTE.        06190001
                                                                        06200001
           COMPUTE WS-NUM-DTE-CA =                                      06210001
                   FUNCTION INTEGER-OF-DATE(WS-2NDCA-DTE).              06220001
                                                                        06230001
           ADD 14 TO WS-NUM-DTE-CA.                                     06240001
                                                                        06250001
           COMPUTE  WS-2NDCA-DTE =                                      06260001
                    FUNCTION DATE-OF-INTEGER(WS-NUM-DTE-CA).            06270001
                                                                        06280001
           MOVE WS-2NDCA-DTE        TO WS-CA-DTE.                       06290001
                                                                        06300001
                                                                        06310001
       6100-EXIT.                                                       06320001
           EXIT.                                                        06330001
                                                                        06340001
      ******************************************************************06350001
       6200-CALL-BP13C913.                                              06360001
      ******************************************************************06370001
                                                                        06380001
           CALL 'BP13C913' USING WS-LINK-BP13C913,                      06390001
                                 BP13COMM8-REC.                         06400001
                                                                        06410001
           IF COMM8-CDE-SYSERR NOT = 0                                  06420001
              IF COMM8-CDE-SYSERR = 100                                 06430001
                 DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE'               06440001
                         COMM8-CDE-SYSERR                               06450001
              ELSE                                                      06460001
                 DISPLAY 'ERROR READING PBF TABLE' COMM8-CDE-SYSERR     06470001
              END-IF                                                    06480001
              MOVE SPACES        TO BP13COMM8-REC                       06490001
           END-IF.                                                      06500001
                                                                        06510001
       6200-EXIT.                                                       06520001
            EXIT.                                                       06530001
                                                                        06540001
      ******************************************************************06550001
       7000-HEADER-EMAIL.                                               06560001
      ******************************************************************06570001
                                                                        06580001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT1.                       06590001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT2.                       06600001
      *     WRITE MAILC38L-REC FROM WS-MAIL-RPT3A.                      06610001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT3B.                      06620001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT4.                       06630001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT5.                       06640001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT6.                       06650001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT8.                       06660001
      *     WRITE MAILC38L-REC FROM WS-MAIL-RPT8A.                      06670001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT8B.                      06680001
            WRITE MAILC38L-REC FROM WS-MAIL-RPT9.                       06690001
                                                                        06700001
            MOVE SPACES TO MAILC38L-REC.                                06710001
            WRITE MAILC38L-REC.                                         06720001
                                                                        06730001
            WRITE MAILC38L-REC FROM L38L-HEADER01.                      06740001
            WRITE MAILC38L-REC FROM L38L-HEADER02.                      06750001
                                                                        06760001
            MOVE SPACES TO MAILC38L-REC.                                06770001
            WRITE MAILC38L-REC.                                         06780001
                                                                        06790001
            WRITE MAILC38L-REC FROM L38L-HEADER03.                      06800001
                                                                        06810001
       7000-EXIT.                                                       06820001
            EXIT.                                                       06830001
                                                                        06840001
      ******************************************************************06850001
       9999-CLOSE-ROUTINE.                                              06860001
      ******************************************************************06870001
                                                                        06880001
           MOVE  SPACES                         TO   MAILC38L-REC.      06890001
           WRITE MAILC38L-REC.                                          06900001
           WRITE MAILC38L-REC                 FROM L38L-HEADER04.       06910001
                                                                        06920001
           DISPLAY '*************** CONTROL    TOTALS ***************'. 06930001
           DISPLAY 'PROGRAM-ID : BP13C38L'.                             06940001
           DISPLAY '-------------------------------------------------'. 06950001
           DISPLAY '(1) NO OF BP13F800 RECORDS READ............. : '    06960001
                    WS-F800-READ.                                       06970001
           DISPLAY '(2) NO OF BP13L38L RECORDS WRITTEN.......... : '    06980001
                    WS-CNT-L38L-WRITE.                                  06990001
           DISPLAY '(3) NO OF BP13F800 RECORDS BYPASS .......... : '    07000001
                    WS-CNT-BYPASS.                                      07010001
                                                                        07020001
           CLOSE    BP13F800                                            07030001
                    BP13K800                                            07040001
                    BP27K800                                            07050001
                    BP13K022                                            07060001
                    BM06K110                                            07070001
                    MAILC38L.                                           07080001
                                                                        07090001
           IF WS-K800-STATUS NOT = 00 AND 97                            07100001
              DISPLAY 'BP27K800 - ERROR CLOSING : ' WS-K800-STATUS      07110001
           END-IF.                                                      07120001
                                                                        07130001
           IF WS-K800-STATUS1 NOT = 00 AND 97                           07140001
              DISPLAY 'BP13K800 - ERROR CLOSING : ' WS-K800-STATUS1     07150001
           END-IF.                                                      07160001
                                                                        07170001
           IF WS-K022-STATUS NOT = 00 AND 97                            07180001
              DISPLAY 'BP13K022 - ERROR CLOSING : ' WS-K022-STATUS      07190001
           END-IF.                                                      07200001
                                                                        07210001
           IF WS-K110-STATUS NOT = 00 AND 97                            07220001
              DISPLAY 'BM06K110 - ERROR CLOSING : ' WS-K110-STATUS      07230001
           END-IF.                                                      07240001
                                                                        07250001
                                                                        07260001
           STOP RUN.                                                    07270001
                                                                        07280001
       9999-EXIT.                                                       07290001
           EXIT.                                                        07300001
