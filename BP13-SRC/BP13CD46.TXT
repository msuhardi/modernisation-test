      *************************                                                 
       IDENTIFICATION DIVISION.                                                 
      *************************                                                 
       PROGRAM-ID.    BP13CD46.                                                 
      *AUTHOR.        JIANG BO.                                                 
      *DATE-WRITTEN.  09/07/08.                                                 
      *****************************************************************         
      *OBJECTIVE - PRINT DBSS LETTER FOR MA&B TO INFORM APPLICANT ON  *         
      *            TOP AND LOAN INFOR WILL BE MANAGED BY BO.          *         
      *                                                               *         
      *     INPUT FILE :                                              *         
      *                  1. BP13F400                                  *         
      *                  2. BP13KA10                                  *         
      *                  3. BP13KD03                                  *         
      *                                                               *         
      *     OUTPUT FILE: 1. BP13LD46                                  *         
      *                  2. BP13PC46                                  *         
      *                                                               *         
      *---------------------------------------------------------------*         
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              *         
      * -------- ---------- ---- -----------------------              *         
      * BP133298 09/07/2008 JB8  NEW PROGRAM.                         *         
      * BP133480 20/01/2009 PCL3 ADDED SUB TOTAL FOR LOAN TRANSFERRED *         
      * BP133545 24/02/2009 PCL3 REMOVE PRINTING OF LETTER WHEN       *         
      *                          LOAN-TAG NOT = H AND AMT-LOAN <= 0.  *         
      * BP133572 28/05/2009 JB8  GET LOAN-COMM DATE FROM BP13KD03     *         
      * BP133662 14/08/2009 JB8  NOT PRINT HEADER IS NO RECORD PRINTED*         
      * BP133662 24/03/2011 JB8  TO CATER FOR BO EMAIL                *         
      * BP134360 13/10/2011 JB8  TO SORT BY BO & BALLOT(PRJCT)        *         
      * BP134423 01/03/2012 FGP1 TO PRINT SUB-HEADER FOR BO CODE                
      *                          FOR EOS REPORT PRINTING                        
      * BP135161 29/01/2014 PCL4 TO INCREASE THE LENGTH OF BO EMAIL ADD         
      *****************************************************************         
                                                                                
                                                                                
      **********************                                                    
       ENVIRONMENT DIVISION.                                                    
      **********************                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT  SY02F001  ASSIGN        TO SY02F001.                         
           SELECT  BP13F400  ASSIGN        TO BP13F400.                         
           SELECT  BP13KA10  ASSIGN        TO BP13KA10                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS KA10-KEY-FLD                      
                             FILE STATUS   IS WS-KA10-STATUS.                   
           SELECT  BP13KD03  ASSIGN        TO BP13KD03                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS KD03-KEY-FLD                      
                             FILE STATUS   IS WS-KD03-STATUS.                   
           SELECT  BP13LD46  ASSIGN        TO BP13LD46.                         
           SELECT  BP13PD46  ASSIGN        TO BP13PD46.                         
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13F400                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13F400.                                                           
                                                                                
       FD   BP13KA10                                                            
            RECORD CONTAINS 800 CHARACTERS.                                     
       COPY BP13KA10.                                                           
                                                                                
       FD   BP13KD03                                                            
            RECORD CONTAINS 1600 CHARACTERS.                                    
       COPY BP13KD03.                                                           
                                                                                
       FD   BP13LD46                                                            
            BLOCK  CONTAINS 0 RECORDS                                           
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORD IS OMITTED                                             
            RECORDING MODE IS F.                                                
       01   BP13LD46-REC               PIC X(132).                              
                                                                                
       FD   BP13PD46                                                            
            RECORD CONTAINS 90 CHARACTERS                                       
            RECORDING MODE IS F.                                                
       01   BP13PD46-REC               PIC X(90).                               
                                                                                
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                   WORKING-STORAGE AREA                         *        
      ******************************************************************        
       01  FILE-VARIABLES.                                                      
           05  WS-F001-EOF             PIC X(1)  VALUE 'N'.                     
               88 EOF-F001                       VALUE 'Y'.                     
           05  WS-EOF-F400             PIC X(1)  VALUE 'N'.                     
           05  WS-KA10-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-KD03-STATUS          PIC 9(02) VALUE ZEROES.                  
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F400-READ            PIC 9(7)  VALUE ZEROES.                  
           05  WS-KA10-NOTFND          PIC 9(07) VALUE ZEROES.                  
           05  WS-KD03-NOTFND          PIC 9(07) VALUE ZEROES.                  
           05  WS-PD46-WRITE           PIC 9(7)  VALUE ZEROES.                  
           05  WS-LD46-WRITE           PIC 9(7)  VALUE ZEROES.                  
           05  WS-SNO                  PIC 9(5)  VALUE ZEROES.                  
           05  WS-LINE-CTR             PIC 9(2)  VALUE ZEROES.                  
           05  WS-PAGE-CTR             PIC 9(2)  VALUE ZEROES.                  
           05  WS-CNT-LD46-WRITE       PIC 9(5)  VALUE ZEROES.                  
           05  WS-CNT-PD46-WRITE       PIC 9(5)  VALUE ZEROES.                  
           05  WS-MAX-LINE             PIC 9(2)  VALUE 53.                      
           05  WS-CNT-WRITE            PIC 9(2)  VALUE ZEROES.                  
           05  WS-CNT-LOAN-GRNT-Y      PIC 9(9)  VALUE ZEROES.                  
           05  WS-CNT-LOAN-GRNT-N      PIC 9(9)  VALUE ZEROES.                  
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-SYSTEM-DATE           PIC 9(8)  VALUE ZEROES.                  
           05 WS-DTE-ISSUE             PIC 9(8)  VALUE ZEROES.                  
           05 WS-DTE-ISSUE-N REDEFINES WS-DTE-ISSUE.                            
              10 WS-DTE-YR             PIC 9(4).                                
              10 WS-DTE-MTH            PIC 9(2).                                
              10 WS-DTE-DAY            PIC 9(2).                                
                                                                                
       01   WS-SUB-TOTAL                  PIC S9(9)V99  VALUE ZEROES.           
       01   WS-PREV-BO                    PIC X(02)     VALUE SPACES.           
       01   WS-PREV-BALLOT                PIC X(06)     VALUE SPACES.           
       01   WS-NUM-TEL-BO                 PIC X(12)     VALUE SPACES.           
       01   WS-FIRST-WRITE                PIC X(1)      VALUE 'Y'.              
                                                                                
       01   WS-LINK-REC1.                                                       
            05 WS-LINK-NUM-OFFICE         PIC X(8).                             
            05 WS-LINK-NUM-TYPE-OFFICE    PIC X(15).                            
            05 WS-LINK-NUM-SQNC           PIC X(2).                             
       01   WS-SQL-CODE                   PIC 9(4).                             
                                                                                
       01  LD46-HEADER01.                                                       
           05  FILLER              PIC X(8)      VALUE 'BP13LD46'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                  'S Y S T E M   O F   '.                       
           05  FILLER              PIC X(19) VALUE                              
                                  'C O M M I T M E N T'.                        
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE : '.               
           05  LD46-DATE-HDR       PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.               
           05  LD46-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.                  
                                                                                
       01  LD46-HEADER02.                                                       
           05  FILLER              PIC X(46)     VALUE SPACES.                  
           05  FILLER              PIC X(34)     VALUE                          
               'REPORT ON DBSS CASES PASSED TO SMS'.                            
                                                                                
       01  LD46-HEADER03A.                                                      
           05  FILLER              PIC X(10)     VALUE 'BRANCH  : '.            
           05  LD46-BO-HDR         PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(68)     VALUE SPACES.                  
                                                                                
       01  LD46-HEADER03.                                                       
           05  LD46-NME-PRJCT      PIC X(42)     VALUE SPACES.                  
           05  FILLER              PIC X(29)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'LOAN'.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(56)     VALUE 'NAME'.                  
                                                                                
       01  LD46-HEADER04.                                                       
           05  FILLER              PIC X(05)     VALUE '  S/N'.                 
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'BO'.                    
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE 'TC'.                    
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'REGN NO '.              
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(14)     VALUE 'HDB REF       '.        
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(12)     VALUE ' LOAN-TRANSF'.          
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'TP-DATE'.               
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(10)     VALUE 'COMM-DATE '.            
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'GRNT'.                  
           05  FILLER              PIC X(01)     VALUE SPACES.                  
           05  FILLER              PIC X(56)     VALUE 'ADDRESS'.               
                                                                                
       01  LD46-SUBTOTAL-REC.                                                   
           05  FILLER           PIC X(21)          VALUE SPACES.                
           05  FILLER           PIC X(13)          VALUE 'SUB-TOTAL :'.         
           05  LD46-SUB-TOTAL   PIC ZZZ,ZZZ,ZZ9.99 VALUE ZEROES.                
                                                                                
       01  LD46-TOTAL-LOAN-GRNT-REC-Y.                                          
           05  FILLER         PIC X(38)          VALUE SPACES.                  
           05  FILLER         PIC X(21) VALUE 'TOTAL LOAN GRANT (Y):'.          
           05  LD46-LOAN-GRNT-Y PIC ZZZ,ZZZ,ZZ9  VALUE ZEROES.                  
                                                                                
       01  LD46-TOTAL-LOAN-GRNT-REC-N.                                          
           05  FILLER         PIC X(38)          VALUE SPACES.                  
           05  FILLER         PIC X(21) VALUE 'TOTAL LOAN GRANT (N):'.          
           05  LD46-LOAN-GRNT-N PIC ZZZ,ZZZ,ZZ9  VALUE ZEROES.                  
                                                                                
       01  LD46-DETAIL01.                                                       
           05  LD46-SN             PIC ZZZZ9        VALUE ZEROES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-BO             PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-TC             PIC X(02)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-REGN           PIC X(08)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-HDBREF         PIC X(14)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-LOAN-TRANSFER  PIC Z,ZZZ,ZZ9.99 VALUE ZEROES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-TP-DATE        PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD46-DTE-LOAN-COMM  PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD46-HDB-LOAN       PIC X(01)        VALUE SPACE.                
           05  FILLER              PIC X(03)        VALUE SPACES.               
           05  LD46-NAME           PIC X(56)        VALUE SPACES.               
                                                                                
       01  LD46-DETAIL02.                                                       
           05  FILLER              PIC X(76)     VALUE SPACES.                  
           05  LD46-FLAT-ADDR      PIC X(56)     VALUE SPACES.                  
                                                                                
      *--> DETAIL LINES FOR LETTER                                              
                                                                                
       01  PD46-PR-LINE-1.                                                      
           05  FILLER                   PIC X(72)  VALUE SPACES.                
           05  PD46-HDBREF              PIC X(14)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-2.                                                      
           05  FILLER                   PIC X(72)  VALUE SPACES.                
           05  PD46-NUM-REGN            PIC X(14)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-3.                                                      
           05  FILLER                   PIC X(72)  VALUE SPACES.                
           05  PD46-DATE-HDR            PIC X(10)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-4.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-NAME1               PIC X(66)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-5.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-NAME2               PIC X(66)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-6.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-NAME3               PIC X(66)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-7.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-NAME4               PIC X(66)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-8.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-BLK                 PIC X(09)  VALUE SPACES.                
           05  FILLER                   PIC X      VALUE SPACE.                 
           05  PD46-UNIT                PIC X(11)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-9.                                                      
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-ADDR1               PIC X(65)  VALUE SPACES.                
           05  FILLER                   PIC X      VALUE SPACE.                 
                                                                                
       01  PD46-PR-LINE-10.                                                     
           05  FILLER                   PIC X(12)  VALUE SPACES.                
           05  PD46-ADDR2               PIC X(65)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-11.                                                     
           05  FILLER                   PIC X(10)  VALUE SPACES.                
           05  PD46-BAR-CODE            PIC X(09)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-12.                                                     
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  PD46-FLAT-ADDR           PIC X(70)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-13.                                                     
           05  FILLER                   PIC X(73)  VALUE SPACES.                
           05  PD46-TP-DATE             PIC X(10)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-14.                                                     
           05  FILLER                   PIC X(52)  VALUE SPACES.                
           05  PD46-EFF-DATE            PIC X(10)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-15.                                                     
           05  FILLER                   PIC X(28)  VALUE SPACES.                
           05  PD46-BO-1                PIC X(41)  VALUE SPACES.                
                                                                                
       01  PD46-PR-LINE-18.                                                     
           05  FILLER                   PIC X(11)  VALUE SPACES.                
           05  PD46-EMAIL               PIC X(28)  VALUE SPACES.                
                                                                                
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR AV02C015                                                   
      *-------------------------------------------------------------            
        01  WS-LINK-AV02C015.                                                   
            05  AV02C015-IN-POSTCODE          PIC X(6).                         
            05  AV02C015-OUT-POSTCODE-CHKSUM  PIC X(9).                         
                                                                                
       COPY AV02COMM.                                                           
       COPY P13COMM4.                                                           
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR BP13C913                                                   
      *-------------------------------------------------------------            
       01  WS-LINK-REC.                                                         
           05 WS-LINK-NUM-SCH            PIC X(04).                             
           05 WS-LINK-NUM-ACC            PIC X(04).                             
           05 WS-LINK-NUM-CHK            PIC X(01).                             
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      ******************************************************************        
      *                   P R O G R A M     B O D Y                    *        
      ******************************************************************        
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      ******************************************************************        
       0000-MAIN.                                                               
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                      
                                                                                
           PERFORM 2000-READ-BP13F400      THRU 2000-EXIT.                      
                                                                                
           PERFORM 3000-PROCESS-RECORDS    THRU 3000-EXIT                       
             UNTIL WS-EOF-F400 = 'Y'.                                           
                                                                                
      ************                                                              
      * BP133480 *                                                              
      ************                                                              
           IF WS-PAGE-CTR NOT = 0                                               
              MOVE  SPACES                      TO   F400-CDE-BO                
              PERFORM 7000-PRINT-HEADER         THRU 7000-EXIT                  
                                                                                
              MOVE WS-CNT-LOAN-GRNT-Y            TO LD46-LOAN-GRNT-Y            
              MOVE WS-CNT-LOAN-GRNT-N            TO LD46-LOAN-GRNT-N            
              WRITE BP13LD46-REC FROM LD46-TOTAL-LOAN-GRNT-REC-Y AFTER 2        
              WRITE BP13LD46-REC FROM LD46-TOTAL-LOAN-GRNT-REC-N                
           END-IF.                                                              
                                                                                
           PERFORM 9999-CLOSE-ROUTINE      THRU  9999-EXIT.                     
                                                                                
       0000-EXIT.  EXIT.                                                        
                                                                                
      ******************************************************************        
       1000-OPEN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           OPEN INPUT  BP13F400                                                 
                       SY02F001                                                 
                       BP13KA10                                                 
                       BP13KD03                                                 
              OUTPUT   BP13LD46                                                 
                       BP13PD46.                                                
                                                                                
           IF WS-KA10-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KA10 - ERROR OPENING : ' WS-KA10-STATUS              
              GO TO 9999-CLOSE-ROUTINE                                          
           END-IF.                                                              
                                                                                
           IF WS-KD03-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD03 - ERROR OPENING : ' WS-KD03-STATUS              
              GO TO 9999-CLOSE-ROUTINE                                          
           END-IF.                                                              
                                                                                
           READ SY02F001 AT END MOVE 'Y'  TO WS-F001-EOF.                       
           IF EOF-F001                                                          
              DISPLAY 'RECORD NOT FOUND IN SY01F001 '                           
              DISPLAY 'PROCESSING TERMINATED '                                  
              GO TO 9999-CLOSE-ROUTINE                                          
           ELSE                                                                 
              MOVE F001-DTE-CURRENT      TO   WS-SYSTEM-DATE                    
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       2000-READ-BP13F400.                                                      
      ******************************************************************        
                                                                                
           READ BP13F400           AT   END                                     
                MOVE 'Y'           TO   WS-EOF-F400                             
                GO                 TO   2000-EXIT.                              
                                                                                
           ADD  1                  TO   WS-F400-READ.                           
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           IF F400-NUM-REGN > SPACES                                            
              PERFORM 4000-GET-FIELDS        THRU 4000-EXIT                     
              PERFORM 5000-GET-AREA-DESCR    THRU 5000-EXIT                     
              PERFORM 5200-GET-PIDB-ADDRESS  THRU 5200-EXIT                     
              PERFORM 5300-GET-DTE-LOAN-COMM THRU 5300-EXIT                     
              PERFORM 6100-PRINT-LETTER      THRU 6100-EXIT                     
              PERFORM 6200-PRINT-REPORT      THRU 6200-EXIT                     
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP13F400        THRU 2000-EXIT.                    
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4000-GET-FIELDS.                                                         
      ******************************************************************        
                                                                                
           MOVE SPACES          TO LD46-DETAIL01   LD46-DETAIL02                
                                   PD46-PR-LINE-1  PD46-PR-LINE-2               
                                   PD46-PR-LINE-3  PD46-PR-LINE-4               
                                   PD46-PR-LINE-5  PD46-PR-LINE-6               
                                   PD46-PR-LINE-7  PD46-PR-LINE-8               
                                   PD46-PR-LINE-9  PD46-PR-LINE-10              
                                   PD46-PR-LINE-11 PD46-PR-LINE-12              
                                   PD46-PR-LINE-13 PD46-PR-LINE-14              
                                   PD46-PR-LINE-15 PD46-PR-LINE-18.             
           INITIALIZE              LD46-DETAIL01   LD46-DETAIL02                
                                   PD46-PR-LINE-1  PD46-PR-LINE-2               
                                   PD46-PR-LINE-3  PD46-PR-LINE-4               
                                   PD46-PR-LINE-5  PD46-PR-LINE-6               
                                   PD46-PR-LINE-7  PD46-PR-LINE-8               
                                   PD46-PR-LINE-9  PD46-PR-LINE-10              
                                   PD46-PR-LINE-11 PD46-PR-LINE-12              
                                   PD46-PR-LINE-13 PD46-PR-LINE-14              
                                   PD46-PR-LINE-15 PD46-PR-LINE-18.             
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO PD46-DATE-HDR                              
                                                                                
           STRING F400-SCHEME '-'  F400-ACC    '-'                              
                  F400-CHK    '-'  F400-LESSEE-CODE                             
              DELIMITED BY SIZE INTO LD46-HDBREF.                               
           MOVE LD46-HDBREF                    TO PD46-HDBREF.                  
                                                                                
           MOVE F400-NUM-REGN                  TO PD46-NUM-REGN.                
                                                                                
           MOVE F400-NAME1                     TO PD46-NAME1.                   
           MOVE F400-NAME2                     TO PD46-NAME2.                   
                                                                                
           MOVE F400-CDE-BO                    TO LD46-BO.                      
           MOVE F400-CDE-TC                    TO LD46-TC.                      
           MOVE F400-NUM-REGN                  TO LD46-REGN.                    
           MOVE F400-AMT-OUTS-LOAN-BAL         TO LD46-LOAN-TRANSFER.           
                                                                                
           STRING F400-DTE-KEY-ISSUE(7:2) '/'                                   
                  F400-DTE-KEY-ISSUE(5:2) '/'                                   
                  F400-DTE-KEY-ISSUE(1:4)                                       
              DELIMITED BY SIZE INTO LD46-TP-DATE.                              
           MOVE LD46-TP-DATE                   TO PD46-TP-DATE.                 
                                                                                
           IF F400-AMT-LOAN > 0                                                 
              MOVE 'Y'                         TO LD46-HDB-LOAN                 
              ADD  1                           TO WS-CNT-LOAN-GRNT-Y            
           ELSE                                                                 
              MOVE 'N'                         TO LD46-HDB-LOAN                 
              ADD  1                           TO WS-CNT-LOAN-GRNT-N            
           END-IF.                                                              
           MOVE F400-NAME1                     TO LD46-NAME.                    
                                                                                
           MOVE F400-DTE-KEY-ISSUE             TO WS-DTE-ISSUE.                 
                                                                                
           IF WS-DTE-MTH = 12                                                   
              ADD 1                            TO WS-DTE-YR                     
              MOVE 1                           TO WS-DTE-MTH                    
           ELSE                                                                 
              ADD 1                            TO WS-DTE-MTH                    
           END-IF.                                                              
                                                                                
           STRING '01/' WS-DTE-MTH '/' WS-DTE-YR                                
              DELIMITED BY SIZE INTO PD46-EFF-DATE.                             
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **************************                                                
       5000-GET-AREA-DESCR.                                                     
      **************************                                                
                                                                                
           MOVE SPACES       TO BP13COMM4-REC.                                  
           INITIALIZE           BP13COMM4-REC.                                  
                                                                                
           MOVE F400-CDE-BO  TO WS-LINK-NUM-OFFICE.                             
           MOVE 'BO'         TO WS-LINK-NUM-TYPE-OFFICE.                        
           MOVE '00'         TO WS-LINK-NUM-SQNC.                               
           STRING 'B' F400-CDE-BO 'ADMIN@MAILBOX.HDB.GOV.SG'                    
                  DELIMITED BY SIZE INTO PD46-EMAIL                             
                                                                                
           CALL 'BP13C902' USING                                                
                 WS-LINK-REC1, BP13COMM4-REC                                    
           END-CALL.                                                            
                                                                                
           IF COMM4-CDE-SYSERR NOT = 0                                          
              MOVE COMM4-CDE-SYSERR TO WS-SQL-CODE                              
              IF COMM4-CDE-SYSERR = 100                                         
                 DISPLAY 'OFFICE NOT FND = ' WS-LINK-REC1                       
                 DISPLAY 'SQL ERROR CODE = ' WS-SQL-CODE                        
                 MOVE SPACES                    TO PD46-BO-1                    
                                                   PD46-EMAIL                   
              ELSE                                                              
                 DISPLAY 'ERROR IN READING OFFICE TABLE' WS-SQL-CODE            
              END-IF                                                            
           ELSE                                                                 
              MOVE COMM4-NME-OFFICE-BO(1)       TO PD46-BO-1                    
           END-IF.                                                              
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       5100-GET-NME-PRJCT.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                         TO BP13KA10-REC.                 
           INITIALIZE                             BP13KA10-REC.                 
                                                                                
           MOVE KD03-NUM-PROJECT               TO KA10-NUM-PRJCT.               
                                                                                
           READ BP13KA10.                                                       
                                                                                
           IF WS-KA10-STATUS = 00                                               
              MOVE KA10-NME-PRJCT              TO LD46-NME-PRJCT                
           ELSE                                                                 
              MOVE SPACES                      TO LD46-NME-PRJCT                
              ADD 1 TO WS-KA10-NOTFND                                           
              DISPLAY 'BP13KA10 - ERROR READING : ' WS-KA10-STATUS              
                      ' KEY : ' KA10-NUM-PRJCT                                  
           END-IF.                                                              
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5200-GET-PIDB-ADDRESS.                                                   
      ******************************************************************        
                                                                                
           MOVE SPACES                         TO BP13COMM8-REC.                
           INITIALIZE                             BP13COMM8-REC.                
           MOVE F400-NUM-SCH-ACC(1:9)          TO WS-LINK-REC.                  
                                                                                
           CALL 'BP13C913' USING WS-LINK-REC, BP13COMM8-REC.                    
                                                                                
           EVALUATE COMM8-CDE-SYSERR                                            
             WHEN 000                                                           
                STRING 'BLK '  COMM8-NUM-BLK  ' '                               
                       '#'  COMM8-NUM-LEVEL   '-'                               
                       COMM8-NUM-UNIT-MAIN    ' ' DELIMITED BY SIZE             
                       COMM8-NME-STREET       DELIMITED BY '   '                
                       INTO PD46-FLAT-ADDR                                      
                MOVE PD46-FLAT-ADDR            TO LD46-FLAT-ADDR                
                STRING 'BLK ' COMM8-NUM-BLK                                     
                       DELIMITED BY SIZE INTO PD46-BLK                          
                STRING '#' COMM8-NUM-LEVEL                                      
                       '-' COMM8-NUM-UNIT-MAIN COMM8-NUM-UNIT-SUB               
                       DELIMITED BY SIZE INTO PD46-UNIT                         
                MOVE   COMM8-NME-STFULL        TO PD46-ADDR1                    
                STRING 'SINGAPORE ' COMM8-NUM-POSTAL-CODE                       
                       DELIMITED BY SIZE INTO PD46-ADDR2                        
                MOVE SPACES                   TO WS-LINK-AV02C015               
                MOVE COMM8-NUM-POSTAL-CODE    TO AV02C015-IN-POSTCODE           
                PERFORM 5400-CALL-AV02C015        THRU 5400-EXIT                
                MOVE AV02C015-OUT-POSTCODE-CHKSUM TO PD46-BAR-CODE              
             WHEN 100                                                           
                DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE - '                     
                         F400-NUM-SCH-ACC ', REGN : ' F400-NUM-REGN             
             WHEN OTHER                                                         
                DISPLAY 'ERROR READING PBF TABLE' COMM8-CDE-SYSERR              
                        ', AT KEY ' F400-NUM-SCH-ACC                            
                        ', REGN : ' F400-NUM-REGN                               
           END-EVALUATE.                                                        
                                                                                
       5200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5300-GET-DTE-LOAN-COMM.                                                  
      ******************************************************************        
                                                                                
           MOVE SPACES                        TO BP13KD03-REC.                  
           INITIALIZE                            BP13KD03-REC.                  
                                                                                
           MOVE F400-NUM-REGN                 TO KD03-KEY-FLD.                  
                                                                                
           READ BP13KD03.                                                       
                                                                                
           IF WS-KD03-STATUS = 00 OR 02                                         
              STRING KD03-DTE-LOAN-COMM(7:2) '/'                                
                     KD03-DTE-LOAN-COMM(5:2) '/'                                
                     KD03-DTE-LOAN-COMM(1:4)                                    
                     DELIMITED BY SIZE INTO LD46-DTE-LOAN-COMM                  
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                     TO LD46-DTE-LOAN-COMM             
              ADD 1                           TO WS-KD03-NOTFND                 
              DISPLAY 'BP13KD03 - ERROR READING : ' WS-KD03-STATUS              
                      ' , KEY IS : ' KD03-KEY-FLD                               
           END-IF.                                                              
                                                                                
       5300-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5400-CALL-AV02C015.                                                      
      ******************************************************************        
                                                                                
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
                                                                                
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6100-PRINT-LETTER.                                                       
      ******************************************************************        
                                                                                
      * PRINT LETTER                                                            
                                                                                
           IF F400-NUM-LOAN-TAG = 'H' AND F400-AMT-LOAN > 0                     
              CONTINUE                                                          
           ELSE                                                                 
              GO TO 6100-EXIT                                                   
           END-IF.                                                              
                                                                                
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-1 AFTER PAGE           
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-2                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-3                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-4 AFTER 4              
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-5                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-6                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-7                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-8                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-9                      
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-10                     
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-11 AFTER 2             
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-12 AFTER 6             
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-13 AFTER 2             
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-14 AFTER 3             
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-15                     
           WRITE BP13PD46-REC          FROM PD46-PR-LINE-18 AFTER 2             
                                                                                
           ADD 1                               TO WS-CNT-PD46-WRITE.            
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6200-PRINT-REPORT.                                                       
      ******************************************************************        
                                                                                
           IF F400-CDE-BO NOT = WS-PREV-BO                                      
              PERFORM 7000-PRINT-HEADER         THRU 7000-EXIT                  
              MOVE F400-CDE-BO                    TO WS-PREV-BO                 
              MOVE F400-DTE-BALLOT                TO WS-PREV-BALLOT             
              MOVE ZEROES                         TO WS-SNO                     
           ELSE                                                                 
              IF F400-DTE-BALLOT NOT = WS-PREV-BALLOT                           
                 PERFORM 7000-PRINT-HEADER      THRU 7000-EXIT                  
                 MOVE F400-DTE-BALLOT             TO WS-PREV-BALLOT             
                 MOVE ZEROES                      TO WS-SNO                     
              END-IF                                                            
           END-IF.                                                              
                                                                                
      **  CHECK MAX RECORDS PER PAGE                                            
           ADD 2                                  TO WS-LINE-CTR                
           IF WS-LINE-CTR > WS-MAX-LINE                                         
              PERFORM 7000-PRINT-HEADER         THRU 7000-EXIT                  
              ADD 2                               TO WS-LINE-CTR                
           END-IF.                                                              
                                                                                
           ADD  F400-AMT-OUTS-LOAN-BAL            TO WS-SUB-TOTAL               
                                                                                
           ADD  1                                 TO WS-SNO                     
           MOVE WS-SNO                            TO LD46-SN.                   
                                                                                
           WRITE BP13LD46-REC                   FROM LD46-DETAIL01.             
           WRITE BP13LD46-REC                   FROM LD46-DETAIL02.             
                                                                                
           ADD 1                                  TO WS-CNT-LD46-WRITE.         
                                                                                
       6200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       7000-PRINT-HEADER.                                                       
      ******************************************************************        
                                                                                
           IF WS-PAGE-CTR NOT = 0                                               
              MOVE WS-SUB-TOTAL                   TO LD46-SUB-TOTAL             
              WRITE BP13LD46-REC FROM LD46-SUBTOTAL-REC AFTER 2                 
              COMPUTE WS-SUB-TOTAL = 0                                          
           END-IF.                                                              
                                                                                
           ADD 1                               TO WS-PAGE-CTR.                  
           MOVE WS-PAGE-CTR                    TO LD46-PAGE-HDR.                
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO LD46-DATE-HDR.                             
                                                                                
           MOVE F400-CDE-BO                  TO LD46-BO-HDR.                    
                                                                                
           PERFORM 5100-GET-NME-PRJCT        THRU 5100-EXIT                     
                                                                                
           WRITE BP13LD46-REC    FROM LD46-HEADER01 AFTER PAGE.                 
           WRITE BP13LD46-REC    FROM LD46-HEADER02.                            
           WRITE BP13LD46-REC    FROM LD46-HEADER03A AFTER 2.                   
           WRITE BP13LD46-REC    FROM LD46-HEADER03 AFTER 2.                    
           WRITE BP13LD46-REC    FROM LD46-HEADER04.                            
                                                                                
           INITIALIZE WS-LINE-CTR.                                              
           MOVE 7  TO WS-LINE-CTR.                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       9999-CLOSE-ROUTINE.                                                      
      ******************************************************************        
                                                                                
                                                                                
           DISPLAY '*************** CONTROL    TOTALS ***************'.         
           DISPLAY 'PROGRAM-ID : BP13CD46'.                                     
           DISPLAY '-------------------------------------------------'.         
           DISPLAY '(1) NO OF BP13F400 RECORDS READ............. : '            
                    WS-F400-READ.                                               
           DISPLAY '(2) NO OF BP13LD46 RECORDS WRITTEN.......... : '            
                    WS-F400-READ.                                               
           DISPLAY '(3) NO OF BP13PD46 RECORDS WRITTEN.......... : '            
                    WS-F400-READ.                                               
           DISPLAY '(4) NO OF BP13KA10 RECORDS NOT FOUND ....... : '            
                    WS-KA10-NOTFND.                                             
           DISPLAY '(5) NO OF BP13KD03 RECORDS NOT FOUND ....... : '            
                    WS-KD03-NOTFND.                                             
                                                                                
           CLOSE SY02F001                                                       
                 BP13F400                                                       
                 BP13KA10                                                       
                 BP13KD03                                                       
                 BP13PD46                                                       
                 BP13LD46.                                                      
                                                                                
           IF WS-KA10-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KA10 - ERROR CLOSING : ' WS-KA10-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-KD03-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD03 - ERROR CLOSING : ' WS-KD03-STATUS              
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.  EXIT.                                                        
