      *------------------------------------------------------------*            
       IDENTIFICATION DIVISION.                                                 
      *------------------------------------------------------------*            
       PROGRAM-ID.   BP13C447.                                                  
      *AUTHOR.       SK.                                                        
      *DATE-WRITTEN. 28/06/2004.                                                
      *------------------------------------------------------------*            
      *                SYSTEM OF COMMITMENT  (BP13)                *            
      *------------------------------------------------------------*            
      *                                                            *            
      *  OBJECTIVE                                                 *            
      *               : TO CREARTE BP13F300                        *            
      *                 FOR THE SUB-TRANSFER CASE (BANK LOAN)      *            
      *                 IF ALL THE PAID AND REQUIRED FIELDS ARE    *            
      *                 EQUAL & DTE-TRANSFER ALSO EQUAL, THEN      *            
      *                 OUTPUT BP13F300                            *            
      *                                                            *            
      *               : TO CREATE CPF TRANSACTION ON SOC CPF       *            
      *                 FOR THE SUB-TRANSFER CASES                 *            
      *                 ONLY SHORT-FALL-COLLECTED = "Y"            *            
      *                                   (FROM PANEL M640)        *            
      *                                                            *            
      *               : WRITE F121 - ONLY THE NEW STAMP/LEGAL FEES *            
      *                 (FRESH CV + SUBTR-SF + SUBTR-CF +          *            
      *                  BUYER-WCV + BANK-WCV)                     *            
      *                                                            *            
      *               : UPDATE BP13K330 - ALL THE PAID AMOUNT OF   *            
      *                                   SHORT FALLEN CASES WILL  *            
      *                                   BE UPDATED               *            
      *                                                            *            
      *                                                            *            
      *  I-O FILES:    1. BP13K330 (AGREEMENT ORDER FILE)          *            
      *                2. BP13K671 (BANK ORIGINATION FILE)         *            
      *                                                            *            
      *  INPUT FILES : 1.  BP13F671  - (BANK ORIGINATION FILE)     *            
      *  OUTPUT FILE   1.  BP13F300  - (AGREEMENT ORDER FILE)      *            
      *                2.  BP13F121  - (CPF TRANSACTION FILE)      *            
      *------------------------------------------------------------*            
      * CHG REQ# BY   DATE      DESCRIPTION                        *            
      * -------- ---- --------  -----------------------------------*            
      * BP132526 SK   28/06/04  NEW PROGRAM.                       *            
      *------------------------------------------------------------*            
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
      *------------------------------------------------------------*            
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
      *------------------------------------------------------------*            
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *------------------------------------------------------------*            
                                                                                
           SELECT BP13F671 ASSIGN TO BP13F671.                                  
                                                                                
           SELECT BP13K330 ASSIGN TO BP13K330                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K330-KEY-FLD                               
                  FILE STATUS     IS WS-K330-STATUS.                            
                                                                                
           SELECT BP13K671 ASSIGN TO BP13K671                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K671-KEY-FLD                               
                  FILE STATUS     IS WS-K671-STATUS.                            
                                                                                
           SELECT BP13F121 ASSIGN TO BP13F121.                                  
           SELECT BP13F300 ASSIGN TO BP13F300.                                  
                                                                                
      *------------------------------------------------------------*            
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *------------------------------------------------------------*            
                                                                                
       FD   BP13F671                                                            
            RECORD CONTAINS 3000 CHARACTERS                                     
            BLOCK CONTAINS     0 RECORDS                                        
            RECORDING MODE    IS F                                              
            LABEL RECORDS    ARE STANDARD.                                      
                                                                                
       COPY BP13F671.                                                           
                                                                                
       FD   BP13K330                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
                                                                                
       COPY BP13K330.                                                           
                                                                                
       FD   BP13K671                                                            
            RECORD CONTAINS 3000 CHARACTERS.                                    
                                                                                
       COPY BP13K671.                                                           
                                                                                
       FD   BP13F121                                                            
            RECORD CONTAINS  150 CHARACTERS                                     
            BLOCK CONTAINS     0 RECORDS                                        
            RECORDING MODE    IS F                                              
            LABEL RECORDS    ARE STANDARD.                                      
                                                                                
       COPY BP13F121.                                                           
                                                                                
       FD   BP13F300                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            BLOCK CONTAINS     0 RECORDS                                        
            RECORDING MODE    IS F                                              
            LABEL RECORDS    ARE STANDARD.                                      
                                                                                
       COPY BP13F300.                                                           
                                                                                
      *------------------------------------------------------------*            
       WORKING-STORAGE SECTION.                                                 
      *------------------------------------------------------------*            
                                                                                
       01  WORK-FILE-VARS.                                                      
           05  WS-F671-EOF                PIC X(01)   VALUE 'N'.                
           05  WS-K330-EOF                PIC X(01)   VALUE 'N'.                
           05  WS-K330-FOUND              PIC X(01)   VALUE 'N'.                
                                                                                
           05  WS-F671-READ               PIC 9(08)   VALUE 0.                  
           05  WS-K671-UPDATE             PIC 9(08)   VALUE 0.                  
           05  WS-F300-WRITE              PIC 9(08)   VALUE 0.                  
           05  WS-F121-WRITE              PIC 9(08)   VALUE 0.                  
           05  WS-K330-UPDATE             PIC 9(08)   VALUE 0.                  
                                                                                
           05  WS-K330-STATUS             PIC 9(02)   VALUE 0.                  
           05  WS-K671-STATUS             PIC 9(02)   VALUE 0.                  
                                                                                
       01  WS-DATE-VARS.                                                        
           05  WS-SYSTEM-DATE.                                                  
               10  WS-SYS-CCYY            PIC 9(04).                            
               10  WS-SYS-MM              PIC 9(02).                            
               10  WS-SYS-DD              PIC 9(02).                            
                                                                                
           05 WS-EDITED-DATE              PIC X(10)   VALUE SPACES.             
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-NRIC                     PIC X(9)    VALUE SPACES.             
           05 WS-LSE-CPF                  PIC 9(7)V99 VALUE ZEROES.             
           05 WS-DTE-CPF-POST             PIC X(8)    VALUE SPACES.             
           05 WS-DTE-CPF1                 PIC X(8)    VALUE SPACES.             
           05 WS-DTE-CPF2                 PIC X(8)    VALUE SPACES.             
           05 WS-DTE-CPF3                 PIC X(8)    VALUE SPACES.             
           05 WS-DTE-CPF4                 PIC X(8)    VALUE SPACES.             
           05 WS-CDE-APPLT-CPF            PIC X(1)    VALUE SPACES.             
           05 WS-K330-REC                 PIC X(2000) VALUE SPACES.             
           05 WS-REQ-EQ-PAID              PIC X(1)    VALUE 'N'.                
                                                                                
      *------------------------------------------------------------*            
       PROCEDURE DIVISION.                                                      
      *------------------------------------------------------------*            
                                                                                
      *------------------------------------------------------------*            
       0000-MAIN.                                                               
      *------------------------------------------------------------*            
                                                                                
           PERFORM 1000-OPEN-FILES    THRU 1000-EXIT.                           
           PERFORM 1200-READ-F671     THRU 1200-EXIT.                           
           PERFORM 2000-PROCESS       THRU 2000-EXIT                            
                   UNTIL WS-F671-EOF = 'Y'.                                     
                                                                                
           PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       1000-OPEN-FILES.                                                         
      *------------------------------------------------------------*            
                                                                                
           OPEN INPUT  BP13F671                                                 
                I-O    BP13K330                                                 
                       BP13K671                                                 
                OUTPUT BP13F121                                                 
                       BP13F300.                                                
                                                                                
           EVALUATE WS-K330-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'OPEN BP13K330 FAIL. STATUS - '                        
                                            WS-K330-STATUS                      
                 MOVE  WS-K330-STATUS       TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
              WHEN 97                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'OPEN BP13K671 FAIL. STATUS - '                        
                                            WS-K671-STATUS                      
                 MOVE  WS-K671-STATUS       TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
           MOVE FUNCTION CURRENT-DATE       TO WS-SYSTEM-DATE.                  
                                                                                
           STRING  WS-SYSTEM-DATE(7:2) '/'                                      
                   WS-SYSTEM-DATE(5:2) '/'                                      
                   WS-SYSTEM-DATE(1:4)                                          
                   DELIMITED BY SIZE                                            
                   INTO WS-EDITED-DATE                                          
           END-STRING.                                                          
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       1200-READ-F671.                                                          
      *------------------------------------------------------------*            
                                                                                
           READ BP13F671                                                        
                AT END                                                          
                   MOVE 'Y' TO WS-F671-EOF                                      
                NOT AT END                                                      
                   ADD 1    TO WS-F671-READ                                     
           END-READ.                                                            
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       2000-PROCESS.                                                            
      *------------------------------------------------------------*            
                                                                                
           PERFORM 3000-READ-K330      THRU 3000-EXIT.                          
                                                                                
           IF WS-K330-FOUND = 'Y'                                               
              IF F671-NUM-SHORTFALL-COLLECTED = 'Y'                             
                 PERFORM 8000-INIT-FIELDS       THRU 8000-EXIT                  
                 PERFORM 2100-GET-CPF-POST-DATE THRU 2100-EXIT                  
                 PERFORM 2200-CREATE-F121       THRU 2200-EXIT                  
                 PERFORM 3600-REWRITE-K330      THRU 3600-EXIT                  
              ELSE                                                              
                 PERFORM 3200-CHECK-FIELD    THRU 3200-EXIT                     
                 IF WS-REQ-EQ-PAID = 'Y'                                        
                    PERFORM 3500-WRITE-F300  THRU 3500-EXIT                     
                    PERFORM 4000-READ-K671   THRU 4000-EXIT                     
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 1200-READ-F671      THRU 1200-EXIT.                          
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       2100-GET-CPF-POST-DATE.                                                  
      *------------------------------------------------------------*            
                                                                                
            MOVE WS-SYSTEM-DATE      TO WS-DTE-CPF1                             
                                        WS-DTE-CPF2                             
                                        WS-DTE-CPF3                             
                                        WS-DTE-CPF4.                            
                                                                                
            IF (F671-DTE-VALUE-CPF1 NOT = SPACES AND LOW-VALUES                 
                                                 AND ALL '0')                   
                MOVE F671-DTE-VALUE-CPF1 TO WS-DTE-CPF1                         
            END-IF.                                                             
                                                                                
            IF (F671-DTE-VALUE-CPF2 NOT = SPACES AND LOW-VALUES                 
                                                 AND ALL '0')                   
                MOVE F671-DTE-VALUE-CPF2 TO WS-DTE-CPF2                         
            END-IF.                                                             
                                                                                
            IF (F671-DTE-VALUE-CPF3 NOT = SPACES AND LOW-VALUES                 
                                                 AND ALL '0')                   
                MOVE F671-DTE-VALUE-CPF3 TO WS-DTE-CPF3                         
            END-IF.                                                             
                                                                                
            IF (F671-DTE-VALUE-CPF4 NOT = SPACES AND LOW-VALUES                 
                                                 AND ALL '0')                   
                MOVE F671-DTE-VALUE-CPF4 TO WS-DTE-CPF4                         
            END-IF.                                                             
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       2200-CREATE-F121.                                                        
      *------------------------------------------------------------*            
                                                                                
           MOVE SPACES TO WS-NRIC.                                              
           MOVE 0      TO WS-LSE-CPF.                                           
                                                                                
           COMPUTE WS-LSE-CPF = F671-AMT-FRESH-CAV-CPF1-PAID +                  
                                F671-AMT-SBTR-SF-CPF1-PAID   +                  
                                F671-AMT-SBTR-CF-CPF1-PAID   +                  
                                F671-AMT-BUYER-WCV-CPF1-PAID +                  
                                F671-AMT-BANK-WCV-CPF1-PAID.                    
                                                                                
           IF WS-LSE-CPF > 0                                                    
              MOVE WS-DTE-CPF1          TO WS-DTE-CPF-POST                      
              MOVE F671-NUM-CPF1-NO     TO WS-NRIC                              
              MOVE '1'                  TO WS-CDE-APPLT-CPF                     
              PERFORM 2500-WRITE-F121   THRU 2500-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE 0 TO WS-LSE-CPF.                                                
                                                                                
           COMPUTE WS-LSE-CPF = F671-AMT-FRESH-CAV-CPF2-PAID +                  
                                F671-AMT-SBTR-SF-CPF2-PAID   +                  
                                F671-AMT-SBTR-CF-CPF2-PAID   +                  
                                F671-AMT-BUYER-WCV-CPF2-PAID +                  
                                F671-AMT-BANK-WCV-CPF2-PAID.                    
                                                                                
           IF WS-LSE-CPF > 0                                                    
              MOVE WS-DTE-CPF2          TO WS-DTE-CPF-POST                      
              MOVE F671-NUM-CPF2-NO     TO WS-NRIC                              
              MOVE '2'                  TO WS-CDE-APPLT-CPF                     
              PERFORM 2500-WRITE-F121   THRU 2500-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE 0 TO WS-LSE-CPF.                                                
                                                                                
           COMPUTE WS-LSE-CPF = F671-AMT-FRESH-CAV-CPF3-PAID +                  
                                F671-AMT-SBTR-SF-CPF3-PAID   +                  
                                F671-AMT-SBTR-CF-CPF3-PAID   +                  
                                F671-AMT-BUYER-WCV-CPF3-PAID +                  
                                F671-AMT-BANK-WCV-CPF3-PAID.                    
                                                                                
           IF WS-LSE-CPF > 0                                                    
              MOVE WS-DTE-CPF3          TO WS-DTE-CPF-POST                      
              MOVE F671-NUM-CPF2-NO     TO WS-NRIC                              
              MOVE '3'                  TO WS-CDE-APPLT-CPF                     
              PERFORM 2500-WRITE-F121   THRU 2500-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE 0 TO WS-LSE-CPF.                                                
                                                                                
           COMPUTE WS-LSE-CPF = F671-AMT-FRESH-CAV-CPF4-PAID +                  
                                F671-AMT-SBTR-SF-CPF4-PAID   +                  
                                F671-AMT-SBTR-CF-CPF4-PAID   +                  
                                F671-AMT-BUYER-WCV-CPF4-PAID +                  
                                F671-AMT-BANK-WCV-CPF4-PAID.                    
                                                                                
           IF WS-LSE-CPF > 0                                                    
              MOVE WS-DTE-CPF4          TO WS-DTE-CPF-POST                      
              MOVE F671-NUM-CPF4-NO     TO WS-NRIC                              
              MOVE '4'                  TO WS-CDE-APPLT-CPF                     
              PERFORM 2500-WRITE-F121   THRU 2500-EXIT                          
           END-IF.                                                              
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       2500-WRITE-F121.                                                         
      *------------------------------------------------------------*            
                                                                                
           MOVE SPACES                TO BP13F121-CPFTRAN.                      
           INITIALIZE                    BP13F121-CPFTRAN.                      
                                                                                
           MOVE F671-NUM-REGN         TO F121-NUM-REGN.                         
           MOVE WS-SYSTEM-DATE        TO F121-DTE-POST.                         
           MOVE WS-DTE-CPF-POST       TO F121-DTE-TRANS.                        
           MOVE ZEROS                 TO F121-COUNT-HISTORY.                    
           MOVE WS-LSE-CPF            TO F121-AMT-RECIEPT.                      
           MOVE F671-NUM-SCH-ACC      TO F121-NUM-SCH-ACCT.                     
           MOVE '23'                  TO F121-CDE-TRANS-TYPE.                   
           MOVE 'LSE'                 TO F121-CDE-PAYMENT-TYPE.                 
           MOVE WS-NRIC               TO F121-NUM-NRIC.                         
           MOVE WS-CDE-APPLT-CPF      TO F121-CDE-APPLT-CPF.                    
                                                                                
           IF F671-NUM-HBL-TYP = '2'                                            
              MOVE 'BANK LOAN CPF2'   TO F121-NUM-RECPT-JRNO                    
           ELSE                                                                 
              MOVE 'BANK LOAN CPF1'   TO F121-NUM-RECPT-JRNO                    
           END-IF.                                                              
                                                                                
           WRITE BP13F121-CPFTRAN.                                              
                                                                                
           ADD 1 TO WS-F121-WRITE.                                              
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3000-READ-K330.                                                          
      *------------------------------------------------------------*            
                                                                                
           MOVE 'N'               TO WS-K330-FOUND                              
                                     WS-K330-EOF.                               
           MOVE SPACES            TO WS-K330-REC.                               
           MOVE LOW-VALUES        TO K330-KEY-FLD.                              
           MOVE F671-NUM-REGN     TO K330-CURR-REG.                             
                                                                                
           START BP13K330 KEY >= K330-KEY-FLD.                                  
                                                                                
           EVALUATE WS-K330-STATUS                                              
              WHEN 00                                                           
                 PERFORM 3100-READNEXT-K330 THRU 3100-EXIT                      
                   UNTIL K330-CURR-REG NOT = F671-NUM-REGN                      
                      OR WS-K330-EOF = 'Y'                                      
              WHEN 10                                                           
              WHEN 23                                                           
                 DISPLAY 'REGN NOT FOUND IN K330 - ' F671-NUM-REGN              
              WHEN OTHER                                                        
                 DISPLAY 'ERRROR READING BP13K330. STATUS - '                   
                                            WS-K330-STATUS                      
                 MOVE WS-K330-STATUS        TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3100-READNEXT-K330.                                                      
      *------------------------------------------------------------*            
                                                                                
           READ BP13K330 NEXT RECORD                                            
               AT END                                                           
                  MOVE 'Y' TO WS-K330-EOF                                       
               NOT AT END                                                       
                  PERFORM 3150-CHECK-DTE-SUBTRF   THRU 3150-EXIT                
           END-READ.                                                            
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3150-CHECK-DTE-SUBTRF.                                                   
      *------------------------------------------------------------*            
                                                                                
           IF F671-DTE-SUBTRF = K330-DTE-SUB-TRANSFER                           
              MOVE BP13K330-REC   TO WS-K330-REC                                
              MOVE 'Y'            TO WS-K330-FOUND                              
           END-IF.                                                              
                                                                                
       3150-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3200-CHECK-FIELD.                                                        
      *------------------------------------------------------------*            
                                                                                
           MOVE 'N'  TO WS-REQ-EQ-PAID.                                         
                                                                                
           IF (F671-AMT-SOC-CPF1                                                
                          = F671-AMT-SOC-CPF1-PAID)         AND                 
              (F671-AMT-SOC-CPF2                                                
                          = F671-AMT-SOC-CPF2-PAID)         AND                 
              (F671-AMT-SOC-CPF3                                                
                          = F671-AMT-SOC-CPF3-PAID)         AND                 
              (F671-AMT-SOC-CPF4                                                
                          = F671-AMT-SOC-CPF4-PAID)         AND                 
              (F671-AMT-LUMPSUM-CPF1                                            
                          = F671-AMT-LUMPSUM-CPF1-PAID)     AND                 
              (F671-AMT-LUMPSUM-CPF2                                            
                          = F671-AMT-LUMPSUM-CPF2-PAID)     AND                 
              (F671-AMT-LUMPSUM-CPF3                                            
                          = F671-AMT-LUMPSUM-CPF3-PAID)     AND                 
              (F671-AMT-LUMPSUM-CPF4                                            
                          = F671-AMT-LUMPSUM-CPF4-PAID)     AND                 
              (F671-AMT-LSE-STMP-CPF1                                           
                          = F671-AMT-LSE-STMP-CPF1-PAID)    AND                 
              (F671-AMT-LSE-STMP-CPF2                                           
                          = F671-AMT-LSE-STMP-CPF2-PAID)    AND                 
              (F671-AMT-LSE-STMP-CPF3                                           
                          = F671-AMT-LSE-STMP-CPF3-PAID)    AND                 
              (F671-AMT-LSE-STMP-CPF4                                           
                          = F671-AMT-LSE-STMP-CPF4-PAID)    AND                 
              (F671-AMT-SALE-CONVY-CPF1                                         
                          = F671-AMT-SALE-CONVY-CPF1-PAID)  AND                 
              (F671-AMT-SALE-CONVY-CPF2                                         
                          = F671-AMT-SALE-CONVY-CPF2-PAID)  AND                 
              (F671-AMT-SALE-CONVY-CPF3                                         
                          = F671-AMT-SALE-CONVY-CPF3-PAID)  AND                 
              (F671-AMT-SALE-CONVY-CPF4                                         
                          = F671-AMT-SALE-CONVY-CPF4-PAID)  AND                 
              (F671-AMT-MORT-CONVY-CPF1                                         
                          = F671-AMT-MORT-CONVY-CPF1-PAID)  AND                 
              (F671-AMT-MORT-CONVY-CPF2                                         
                          = F671-AMT-MORT-CONVY-CPF2-PAID)  AND                 
              (F671-AMT-MORT-CONVY-CPF3                                         
                          = F671-AMT-MORT-CONVY-CPF3-PAID)  AND                 
              (F671-AMT-MORT-CONVY-CPF4                                         
                          = F671-AMT-MORT-CONVY-CPF4-PAID)  AND                 
              (F671-AMT-SRVY-FEE-CPF1                                           
                          = F671-AMT-SRVY-FEE-CPF1-PAID)    AND                 
              (F671-AMT-SRVY-FEE-CPF2                                           
                          = F671-AMT-SRVY-FEE-CPF2-PAID)    AND                 
              (F671-AMT-SRVY-FEE-CPF3                                           
                          = F671-AMT-SRVY-FEE-CPF3-PAID)    AND                 
              (F671-AMT-SRVY-FEE-CPF4                                           
                          = F671-AMT-SRVY-FEE-CPF4-PAID)    AND                 
              (F671-AMT-LSE-ESCR-CPF1                                           
                          = F671-AMT-LSE-ESCR-CPF1-PAID)    AND                 
              (F671-AMT-LSE-ESCR-CPF2                                           
                          = F671-AMT-LSE-ESCR-CPF2-PAID)    AND                 
              (F671-AMT-LSE-ESCR-CPF3                                           
                          = F671-AMT-LSE-ESCR-CPF3-PAID)    AND                 
              (F671-AMT-LSE-ESCR-CPF4                                           
                          = F671-AMT-LSE-ESCR-CPF4-PAID)    AND                 
              (F671-AMT-LSE-REGN-CPF1                                           
                          = F671-AMT-LSE-REGN-CPF1-PAID)    AND                 
              (F671-AMT-LSE-REGN-CPF2                                           
                          = F671-AMT-LSE-REGN-CPF2-PAID)    AND                 
              (F671-AMT-LSE-REGN-CPF3                                           
                          = F671-AMT-LSE-REGN-CPF3-PAID)    AND                 
              (F671-AMT-LSE-REGN-CPF4                                           
                          = F671-AMT-LSE-REGN-CPF4-PAID)    AND                 
              (F671-AMT-CAVEAT-REGN-CPF1                                        
                          = F671-AMT-CAVEAT-REGN-CPF1-PAID) AND                 
              (F671-AMT-CAVEAT-REGN-CPF2                                        
                          = F671-AMT-CAVEAT-REGN-CPF2-PAID) AND                 
              (F671-AMT-CAVEAT-REGN-CPF3                                        
                          = F671-AMT-CAVEAT-REGN-CPF3-PAID) AND                 
              (F671-AMT-CAVEAT-REGN-CPF4                                        
                          = F671-AMT-CAVEAT-REGN-CPF4-PAID) AND                 
              (F671-AMT-SOLICIT-CPF1                                            
                          = F671-AMT-SOLICIT-CPF1-PAID)     AND                 
              (F671-AMT-SOLICIT-CPF2                                            
                          = F671-AMT-SOLICIT-CPF2-PAID)     AND                 
              (F671-AMT-SOLICIT-CPF3                                            
                          = F671-AMT-SOLICIT-CPF3-PAID)     AND                 
              (F671-AMT-SOLICIT-CPF4                                            
                          = F671-AMT-SOLICIT-CPF4-PAID)     AND                 
              (F671-AMT-FRESH-CAVEAT-CPF1                                       
                          = F671-AMT-FRESH-CAV-CPF1-PAID)   AND                 
              (F671-AMT-FRESH-CAVEAT-CPF2                                       
                          = F671-AMT-FRESH-CAV-CPF2-PAID)   AND                 
              (F671-AMT-FRESH-CAVEAT-CPF3                                       
                          = F671-AMT-FRESH-CAV-CPF3-PAID)   AND                 
              (F671-AMT-FRESH-CAVEAT-CPF4                                       
                          = F671-AMT-FRESH-CAV-CPF4-PAID)   AND                 
              (F671-AMT-BUYER-WCV-CPF1                                          
                          = F671-AMT-BUYER-WCV-CPF1-PAID)   AND                 
              (F671-AMT-BUYER-WCV-CPF2                                          
                          = F671-AMT-BUYER-WCV-CPF2-PAID)   AND                 
              (F671-AMT-BUYER-WCV-CPF3                                          
                          = F671-AMT-BUYER-WCV-CPF3-PAID)   AND                 
              (F671-AMT-BUYER-WCV-CPF4                                          
                          = F671-AMT-BUYER-WCV-CPF4-PAID)   AND                 
              (F671-AMT-BANK-WCV-CPF1                                           
                          = F671-AMT-BANK-WCV-CPF1-PAID)    AND                 
              (F671-AMT-BANK-WCV-CPF2                                           
                          = F671-AMT-BANK-WCV-CPF2-PAID)    AND                 
              (F671-AMT-BANK-WCV-CPF3                                           
                          = F671-AMT-BANK-WCV-CPF3-PAID)    AND                 
              (F671-AMT-BANK-WCV-CPF4                                           
                          = F671-AMT-BANK-WCV-CPF4-PAID)    AND                 
              (F671-AMT-SBTR-SF-CPF1                                            
                          = F671-AMT-SBTR-SF-CPF1-PAID)     AND                 
              (F671-AMT-SBTR-SF-CPF2                                            
                          = F671-AMT-SBTR-SF-CPF2-PAID)     AND                 
              (F671-AMT-SBTR-SF-CPF3                                            
                          = F671-AMT-SBTR-SF-CPF3-PAID)     AND                 
              (F671-AMT-SBTR-SF-CPF4                                            
                          = F671-AMT-SBTR-SF-CPF4-PAID)     AND                 
              (F671-AMT-SBTR-CF-CPF1                                            
                          = F671-AMT-SBTR-CF-CPF1-PAID)     AND                 
              (F671-AMT-SBTR-CF-CPF2                                            
                          = F671-AMT-SBTR-CF-CPF2-PAID)     AND                 
              (F671-AMT-SBTR-CF-CPF3                                            
                          = F671-AMT-SBTR-CF-CPF3-PAID)     AND                 
              (F671-AMT-SBTR-CF-CPF4                                            
                          = F671-AMT-SBTR-CF-CPF4-PAID)                         
              MOVE 'Y' TO WS-REQ-EQ-PAID                                        
           END-IF.                                                              
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3500-WRITE-F300.                                                         
      *------------------------------------------------------------*            
                                                                                
           WRITE BP13F300-REC  FROM WS-K330-REC.                                
           ADD 1 TO WS-F300-WRITE.                                              
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3600-REWRITE-K330.                                                       
      *------------------------------------------------------------*            
                                                                                
           MOVE WS-K330-REC  TO BP13K330-REC.                                   
                                                                                
           PERFORM 3700-MOVE-VALUES    THRU 3700-EXIT.                          
                                                                                
           REWRITE BP13K330-REC.                                                
                                                                                
           EVALUATE WS-K330-STATUS                                              
              WHEN 00                                                           
                 ADD 1  TO WS-K330-UPDATE                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERRROR UPDATING BP13K330. STATUS - '                  
                                            WS-K330-STATUS                      
                 MOVE WS-K330-STATUS        TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       3700-MOVE-VALUES.                                                        
      *------------------------------------------------------------*            
                                                                                
      *CPF1                                                                     
                                                                                
           MOVE F671-AMT-SOC-CPF1-PAID                                          
                                   TO K330-AMT-SOC-CPF1.                        
           MOVE F671-AMT-LSE-STMP-CPF1-PAID                                     
                                   TO K330-AMT-LEASE-STAMP-CPF1.                
           MOVE F671-AMT-SALE-CONVY-CPF1-PAID                                   
                                   TO K330-AMT-CONV-CPF1.                       
           MOVE F671-AMT-MORT-CONVY-CPF1-PAID                                   
                                   TO K330-AMT-MORT-CONVY-CPF1.                 
           MOVE F671-AMT-CAVEAT-REGN-CPF1-PAID                                  
                                   TO K330-AMT-CAVEAT-REGN-CPF1.                
      *CPF2                                                                     
           MOVE F671-AMT-SOC-CPF2-PAID                                          
                                   TO K330-AMT-SOC-CPF2.                        
           MOVE F671-AMT-LSE-STMP-CPF2-PAID                                     
                                   TO K330-AMT-LEASE-STAMP-CPF2.                
           MOVE F671-AMT-SALE-CONVY-CPF2-PAID                                   
                                   TO K330-AMT-CONV-CPF2.                       
           MOVE F671-AMT-MORT-CONVY-CPF2-PAID                                   
                                   TO K330-AMT-MORT-CONVY-CPF2.                 
           MOVE F671-AMT-CAVEAT-REGN-CPF2-PAID                                  
                                   TO K330-AMT-CAVEAT-REGN-CPF2.                
      *CPF3                                                                     
           MOVE F671-AMT-SOC-CPF3-PAID                                          
                                   TO K330-AMT-SOC-CPF3.                        
           MOVE F671-AMT-LSE-STMP-CPF3-PAID                                     
                                   TO K330-AMT-LEASE-STAMP-CPF3.                
           MOVE F671-AMT-SALE-CONVY-CPF3-PAID                                   
                                   TO K330-AMT-CONV-CPF3.                       
           MOVE F671-AMT-MORT-CONVY-CPF3-PAID                                   
                                   TO K330-AMT-MORT-CONVY-CPF3.                 
           MOVE F671-AMT-CAVEAT-REGN-CPF3-PAID                                  
                                   TO K330-AMT-CAVEAT-REGN-CPF3.                
      *CPF4                                                                     
           MOVE F671-AMT-SOC-CPF4-PAID                                          
                                   TO K330-AMT-SOC-CPF4.                        
           MOVE F671-AMT-LSE-STMP-CPF4-PAID                                     
                                   TO K330-AMT-LEASE-STAMP-CPF4.                
           MOVE F671-AMT-SALE-CONVY-CPF4-PAID                                   
                                   TO K330-AMT-CONV-CPF4.                       
           MOVE F671-AMT-MORT-CONVY-CPF4-PAID                                   
                                   TO K330-AMT-MORT-CONVY-CPF4.                 
           MOVE F671-AMT-CAVEAT-REGN-CPF4-PAID                                  
                                   TO K330-AMT-CAVEAT-REGN-CPF4.                
                                                                                
       3700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       4000-READ-K671.                                                          
      *------------------------------------------------------------*            
                                                                                
           MOVE LOW-VALUES     TO K671-NUM-REGN.                                
           MOVE F671-NUM-REGN  TO K671-NUM-REGN.                                
                                                                                
           READ BP13K671.                                                       
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
                 PERFORM 4100-REWRITE-K671  THRU 4100-EXIT                      
              WHEN 23                                                           
                 DISPLAY ' NOT FOUND IN BP13K671 - ' F671-NUM-REGN              
              WHEN OTHER                                                        
                 DISPLAY 'ERRROR READING BP13K671. STATUS - '                   
                                            WS-K671-STATUS                      
                 MOVE WS-K671-STATUS        TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       4100-REWRITE-K671.                                                       
      *------------------------------------------------------------*            
                                                                                
           MOVE 'Y'         TO K671-NUM-SUBTR-PROCESSED.                        
           REWRITE BP13K671-REC.                                                
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
                 ADD 1  TO WS-K671-UPDATE                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERRROR UPDATING BP13K671. STATUS - '                  
                                            WS-K671-STATUS                      
                 MOVE WS-K671-STATUS        TO RETURN-CODE                      
                 PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       8000-INIT-FIELDS.                                                        
      *------------------------------------------------------------*            
                                                                                
      *FRESH CAVEAT FEE                                                         
           IF F671-AMT-FRESH-CAV-CPF1-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-FRESH-CAV-CPF1-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-FRESH-CAV-CPF2-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-FRESH-CAV-CPF2-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-FRESH-CAV-CPF3-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-FRESH-CAV-CPF3-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-FRESH-CAV-CPF4-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-FRESH-CAV-CPF4-PAID                    
           END-IF.                                                              
                                                                                
      *SUB-TRAN STAMP FEE                                                       
           IF F671-AMT-SBTR-SF-CPF1-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-SF-CPF1-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-SF-CPF2-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-SF-CPF2-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-SF-CPF3-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-SF-CPF3-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-SF-CPF4-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-SF-CPF4-PAID                      
           END-IF.                                                              
                                                                                
      *SUB-TRAN CONVEY FEE                                                      
           IF F671-AMT-SBTR-CF-CPF1-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-CF-CPF1-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-CF-CPF2-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-CF-CPF2-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-CF-CPF3-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-CF-CPF3-PAID                      
           END-IF.                                                              
                                                                                
           IF F671-AMT-SBTR-CF-CPF4-PAID NOT NUMERIC                            
              MOVE ZEROS     TO F671-AMT-SBTR-CF-CPF4-PAID                      
           END-IF.                                                              
                                                                                
      *BUYERS WCV                                                               
           IF F671-AMT-BUYER-WCV-CPF1-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-BUYER-WCV-CPF1-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-BUYER-WCV-CPF2-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-BUYER-WCV-CPF2-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-BUYER-WCV-CPF3-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-BUYER-WCV-CPF3-PAID                    
           END-IF.                                                              
                                                                                
           IF F671-AMT-BUYER-WCV-CPF4-PAID NOT NUMERIC                          
              MOVE ZEROS     TO F671-AMT-BUYER-WCV-CPF4-PAID                    
           END-IF.                                                              
                                                                                
      *BANKS WCV                                                                
           IF F671-AMT-BANK-WCV-CPF1-PAID NOT NUMERIC                           
              MOVE ZEROS     TO F671-AMT-BANK-WCV-CPF1-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-BANK-WCV-CPF2-PAID NOT NUMERIC                           
              MOVE ZEROS     TO F671-AMT-BANK-WCV-CPF2-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-BANK-WCV-CPF3-PAID NOT NUMERIC                           
              MOVE ZEROS     TO F671-AMT-BANK-WCV-CPF3-PAID                     
           END-IF.                                                              
                                                                                
           IF F671-AMT-BANK-WCV-CPF4-PAID NOT NUMERIC                           
              MOVE ZEROS     TO F671-AMT-BANK-WCV-CPF4-PAID                     
           END-IF.                                                              
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
       9000-CLOSE-ROUTINE.                                                      
      *------------------------------------------------------------*            
                                                                                
           CLOSE BP13F671                                                       
                 BP13K671                                                       
                 BP13K330                                                       
                 BP13F121                                                       
                 BP13F300.                                                      
                                                                                
           EVALUATE WS-K671-STATUS                                              
              WHEN 00                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'CLOSE BP13K671 FAIL. STATUS-'                         
                                         WS-K671-STATUS                         
                 MOVE WS-K671-STATUS  TO RETURN-CODE                            
           END-EVALUATE.                                                        
                                                                                
           EVALUATE WS-K330-STATUS                                              
              WHEN 00                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'CLOSE BP13K330 FAIL. STATUS-'                         
                                         WS-K330-STATUS                         
                 MOVE WS-K330-STATUS  TO RETURN-CODE                            
           END-EVALUATE.                                                        
                                                                                
           DISPLAY '*----------- BP13C447 -------------*'.                      
           DISPLAY 'DATE : ' WS-EDITED-DATE.                                    
           DISPLAY SPACES.                                                      
           DISPLAY ' 1. BP13F671 READ      : '  WS-F671-READ.                   
           DISPLAY ' 2. BP13K671 UPDATE    : '  WS-K671-UPDATE.                 
           DISPLAY ' 3. BP13K330 UPDATE    : '  WS-K330-UPDATE.                 
           DISPLAY SPACES.                                                      
           DISPLAY ' 4. BP13F121 WRITE     : '  WS-F121-WRITE.                  
           DISPLAY ' 5. BP13F300 WRITE     : '  WS-F300-WRITE.                  
           DISPLAY SPACES.                                                      
           DISPLAY '*----------------------------------*'.                      
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------------------------------------------*            
      *                      END OF PROGRAM                        *            
      *------------------------------------------------------------*            
