       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C24K.                                                 
       AUTHOR.        ELAINE S ARGA.                                            
      *DATE-WRITTEN.  27 MAY 2012.                                              
      * ======================================================== *              
      * SYSTEM OF COMMITMENT (BP13)                              *              
      * ======================================================== *              
      *    OBJECTIVE  :                                          *              
      *                                                          *              
      *            THIS IS THE PROGRAM TO PRINT FINALISED        *              
      *            NAME LIST BASED ON DATE OF ALLOCATION AND     *              
      *            NEW TOWN - APPENDIX C(MGPS)                   *              
      *                                                          *              
      *    INPUT FILES : BM06CTL                                 *              
      *                  BM06K010                                *              
      *                  BP13K060                                *              
      *                  BP13K246                                *              
      *    OUTPUT      : BP13L24K                                *              
      *                  P13L24KA                                *              
      *                                                          *              
      *  CHG-NO   BY   DATE     DESCRIPTION                      *              
      *  -------- ---- -------  -----------                      *              
      *  BP134587 ESA1 20120507 NEW PROGRAM                      *              
      *  BP134681 ESA1 20120919 REPLACE BP13K816 WITH BP13K813   *              
      *  BP135190 SMR2 20131204 EXPAND BP13K813 TO 1000          *              
      *  BP135561 ESA1 20150128 TO INCLUDE DJDE IN THE PROGRAM   *              
      *  BP135591 ESA1 20150218 TO REMOVE VALIDATION OF NT-ZONE  *              
      *  BP136066 ESA1 20160121 TO CATER FOR 2-ROOM FLEXI PRINTING              
      *  BP136122 ESA1 20160408 CATER FOR '2F' IN READING BP13K246              
      *  BP137208 FNP1 20180314 CATER FOR '2F' IN SERS           *              
      * ======================================================== *              
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F205 ASSIGN TO BP13F205.                                  
                                                                                
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS DYNAMIC                                       
                  RECORD KEY   IS K800-NUM-REGN                                 
                  FILE STATUS  IS WS-K800-STATUS.                               
                                                                                
           SELECT BP13F200 ASSIGN TO BP13F200.                                  
                                                                                
           SELECT BP13K222 ASSIGN TO BP13K222                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS RANDOM                                        
                  RECORD KEY   IS K222-KEY-FLD                                  
                  FILE STATUS  IS WS-K222-STATUS.                               
                                                                                
           SELECT BP13K060 ASSIGN TO BP13K060                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS DYNAMIC                                       
                  RECORD KEY   IS K060-KEY-FLD                                  
                  FILE STATUS  IS WS-K060-STATUS.                               
                                                                                
           SELECT BP13K246 ASSIGN TO BP13K246                                   
                  ORGANIZATION IS INDEXED                                       
                  ACCESS MODE  IS DYNAMIC                                       
                  RECORD KEY   IS K246-KEY-FLD                                  
                  FILE STATUS  IS WS-K246-STATUS.                               
                                                                                
           SELECT BP13L24K ASSIGN TO BP13L24K.                                  
           SELECT P13L24KA ASSIGN TO P13L24KA.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD  BP13F205                                                             
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 80  CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F205.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13K800.                                                           
                                                                                
       FD  BP13F200                                                             
           RECORDING MODE F                                                     
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 300 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F200.                                                           
                                                                                
       FD  BP13K222                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K222.                                                           
                                                                                
       FD  BP13K060                                                             
           RECORD CONTAINS 25 CHARACTERS.                                       
       COPY BP13K060.                                                           
                                                                                
       FD  BP13K246                                                             
           RECORD CONTAINS 80 CHARACTERS.                                       
       COPY BP13K246.                                                           
                                                                                
       FD  BP13L24K                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  PRINT-REC                        PIC X(80).                          
                                                                                
       FD  P13L24KA                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  PRINT-REC-A                      PIC X(80).                          
                                                                                
       COPY AV02COMM.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-K222-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-K060-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-K800-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-K246-STATUS                 PIC 99    VALUE ZEROS.                
       01  WS-NUMBER                      PIC 9999  VALUE ZEROS.                
       01  WS-PAGE-NUMBER                 PIC ZZZ9.                             
       01  WS-DAY                         PIC 99    VALUE ZEROS.                
       01  WS-SRNO                        PIC 9(5)  VALUE ZEROS.                
       01  WS-LINE-CNT                    PIC 99    VALUE ZEROS.                
       01  WS-F205-READ-CNT               PIC 9(4)  VALUE ZEROS.                
       01  WS-F200-READ-CNT               PIC 9(4)  VALUE ZEROS.                
       01  EOF-F205                       PIC X     VALUE 'N'.                  
       01  EOF-F200                       PIC X     VALUE 'N'.                  
       01  FINISH-PROCESS                 PIC X     VALUE 'N'.                  
       01  WS-F205-SW-FLAG                PIC X     VALUE 'N'.                  
       01  WS-SNO-CTR                     PIC 9(04) VALUE ZEROES.               
       01  WS-SNO-CTR1                    PIC 9(04) VALUE ZEROES.               
                                                                                
       01  WS-DTE-ALLOC.                                                        
           05 WS-DTE-DD                   PIC 99.                               
           05 FILLER                      PIC X     VALUE '/'.                  
           05 WS-DTE-MM                   PIC 99.                               
           05 FILLER                      PIC X     VALUE '/'.                  
           05 WS-DTE-YY                   PIC 99.                               
                                                                                
       01  WS-DTE-APPT.                                                         
           05 WS-DTE-CC                   PIC 99.                               
           05 WS-DTE-YY                   PIC 99.                               
           05 WS-DTE-MM                   PIC 99.                               
           05 WS-DTE-DD                   PIC 99.                               
                                                                                
       01  WS-PARSING.                                                          
           05 WS-STRING-TO-PARSE            PIC X(70).                          
           05 WS-PARSED-STRING              PIC X(70).                          
           05 WS-STRING-LENGTH              PIC 9(03).                          
           05 WS-CUR-POS-SP                 PIC 9(03).                          
           05 WS-CUR-POS-PS                 PIC 9(03).                          
           05 WS-SPACE-FLAG                 PIC X    VALUE 'N'.                 
           05 WS-INSERT-SPACE-FLAG          PIC X    VALUE 'N'.                 
       01  WS-PREV-NT-ZONE                PIC X(25).                            
                                                                                
       01  WS-FROM-DATE                   PIC X(18).                            
       01  WS-TO-DATE                     PIC X(18).                            
                                                                                
       01  WS-E-DAY                       PIC Z9.                               
       01  WS-DAY-DESC                    PIC XX.                               
       01  WS-APPT-DTE                    PIC X(18).                            
                                                                                
       01  SPACE-2                        PIC XX    VALUE SPACES.               
                                                                                
       01  WS-PREV-APPT-DATE              PIC X(8).                             
                                                                                
       01  WS-ALLOC-NT-ZONE.                                                    
      **   05 WS-ALLOC-DATE               PIC 9(8).                             
           05 WS-ALLOC-DATE               PIC X(8).                             
           05 WS-NT-ZONE                  PIC X(3).                             
           05 WS-FT                       PIC X(2).                             
                                                                                
       01  WS-ESTATE-ZONE-TXT             PIC X(7).                             
       01  WS-QUEUE-NO-PIC9               PIC X(5).                             
       01  WS-NUM-ALLO-SCHEME             PIC X(03) VALUE SPACES.               
       01  SW-SERS-ALLO-SCHEME            PIC X(01) VALUE SPACES.               
           88  C-SERS-ALLO-SCHEME         VALUE 'Y'.                            
                                                                                
      *-----------------------------------------------------------*             
      *       DJDE FOR FORMS PRINTING                             *             
      *-----------------------------------------------------------*             
       01  DJDE-LINE1                      PIC X(80) VALUE                      
           '$DJDE$ JDE=13C230,JDL=BP13,NUMBER=(0000,63,80),END;'.               
                                                                                
      *-----------------------------------------------------------*             
      *       LINKAGE FOR SUB-PROGRAM BP13C910                    *             
      *-----------------------------------------------------------*             
       01  WS-LINK-REC-2.                                                       
           05  WS-LINK-ZONE           PIC X(03).                                
       01  WS-BP13K813-REC            PIC X(1000).                              
       01  WS-ZONE-FND-FLAG           PIC X(01).                                
       01  WS-RETURN-CODE             PIC 9(02).                                
                                                                                
       COPY BP13K813.                                                           
       COPY SERSCH.                                                             
                                                                                
      *============================================================*            
      *            P R I N T    L A Y O U T                        *            
      *============================================================*            
       01  L24KA-HEADER-1.                                                      
           05  FILLER                     PIC X(64) VALUE SPACES.               
           05  FILLER                     PIC X(16) VALUE                       
               'APPENDIX C(MGPS)'.                                              
                                                                                
       01  L24KA-HEADER-2.                                                      
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(48) VALUE                       
               'LIST OF INVITED APPLICANTS'' QUEUE POSITIONS FOR '.             
           05  FILLER                     PIC X(10) VALUE                       
               'SELECTION '.                                                    
           05  FILLER                     PIC X(20) VALUE SPACES.               
                                                                                
       01  L24KA-HEADER-2A.                                                     
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(48) VALUE                       
               'LIST OF INVITED APPLICANTS'' FOR SELECTION'.                    
           05  FILLER                     PIC X(20) VALUE SPACES.               
                                                                                
       01  L24KA-HEADER-3.                                                      
           05  FILLER                     PIC X(10) VALUE SPACES.               
           05  FILLER                     PIC X(03) VALUE 'OF '.                
           05  L24K-NT-ZONE-FT            PIC X(67).                            
                                                                                
       01  L24KA-HEADER-4.                                                      
           05  FILLER                     PIC X(10) VALUE SPACES.               
           05  L24K-DAY-A                 PIC X(70) VALUE SPACES.               
                                                                                
       01  L24KA-HEADER-5.                                                      
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(34) VALUE                       
               'NOTE : THE SELECTION EXERCISE FOR '.                            
           05  L24K-FLAT-TYPE-A           PIC X(44).                            
                                                                                
       01  L24KA-HEADER-5A.                                                     
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  FILLER                     PIC X(33) VALUE                       
               'NOTE : THE SELECTION EXERCISE IN '.                             
           05  L24K-FLAT-TYPE-00          PIC X(45) VALUE SPACES.               
                                                                                
       01  L24KA-HEADER-6.                                                      
           05  FILLER                     PIC X(09) VALUE SPACES.               
           05  L24K-NEWTOWN-ZONE-A        PIC X(71).                            
                                                                                
       01  L24KA-HEADER-8-SERS.                                                 
           05  FILLER                     PIC X(09) VALUE SPACES.               
           05  FILLER                     PIC X(54) VALUE                       
               'REGISTRATION NUMBER DETERMINED BY A COMPUTER BALLOT.'.          
           05  FILLER                     PIC X(17) VALUE SPACES.               
                                                                                
       01  L24KA-HEADER-9-SERS.                                                 
           05  FILLER                     PIC X(06) VALUE SPACES.               
           05  FILLER                     PIC X(54) VALUE                       
               'S/NO   REGISTRATION NO.   QUEUE NO.'.                           
                                                                                
       01  L24KA-HEADER-9A-SERS.                                                
           05  FILLER                     PIC X(06) VALUE SPACES.               
           05  FILLER                     PIC X(54) VALUE                       
               'S/NO   REGISTRATION NO.       QUEUE NO.'.                       
                                                                                
       01  L24KA-DATA1.                                                         
           05  FILLER                     PIC X(6)  VALUE SPACES.               
           05  L24K-SN                    PIC ZZZ9.                             
           05  FILLER                     PIC X(3)  VALUE ' ) '.                
           05  L24K-REGN-NO               PIC X(8).                             
           05  FILLER                     PIC X(1)  VALUE SPACES.               
           05  L24K-FT                    PIC X(6).                             
           05  FILLER                     PIC X(04) VALUE SPACES.               
           05  L24K-NUM-QUEUE             PIC X(05).                            
           05  FILLER                     PIC X(42) VALUE SPACES.               
                                                                                
       01  L24KA-DATA2.                                                         
           05  FILLER                     PIC X(6)  VALUE SPACES.               
           05  L23A-SN                    PIC ZZZ9.                             
           05  FILLER                     PIC X(3)  VALUE ' ) '.                
           05  L23A-REGN-NO               PIC X(8).                             
           05  FILLER                     PIC X(1)  VALUE SPACES.               
           05  L23A-FT                    PIC X(6).                             
           05  FILLER                     PIC X(2)  VALUE ' ('.                 
           05  L23A-ALLOC-SCH             PIC X(3).                             
           05  FILLER                     PIC X(1)  VALUE ')'.                  
           05  FILLER                     PIC X(02) VALUE SPACES.               
           05  L23A-NUM-QUEUE             PIC X(05).                            
           05  FILLER                     PIC X(36) VALUE SPACES.               
                                                                                
       01  L24KA-TLR-1.                                                         
           05  FILLER                     PIC X(65) VALUE SPACES.               
           05  FILLER                     PIC X(15) VALUE '*PTO*'.              
                                                                                
      *---------------->  FOR 'ZONE' FLATS                                      
       01  L24KB-HDR-1.                                                         
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE                       
               'S/NO.'.                                                         
           05  FILLER                    PIC X(04)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE                       
               'QUEUE NO.'.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(16)  VALUE                       
               'REGISTRATION NO.'.                                              
                                                                                
       01  L24KB-HDR-1A.                                                        
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE                       
               'S/NO.'.                                                         
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE                       
               'HOUSEHOLD TYPE/REGISTRATION NO.'.                               
                                                                                
       01  L24KB-HDR-1-UNDERLINE.                                               
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(07)  VALUE ALL '-'.              
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE ALL '-'.              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(16)  VALUE ALL '-'.              
                                                                                
       01  L24KB-HDR-1A-UNDERLINE.                                              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE ALL '-'.              
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE ALL '-'.              
                                                                                
       01  L24KB-HDR-2.                                                         
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE                       
               'QUEUE NO.'.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE                       
               'HH TYPE/REG NO./JB REG NO./ALLOC-SCH'.                          
                                                                                
       01  L24KB-HDR-2-UNDERLINE.                                               
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(07)  VALUE ALL '-'.              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE ALL '-'.              
                                                                                
       01  L24KB-HDR-2A.                                                        
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE                       
               'S/NO.'.                                                         
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE                       
               'HH TYPE/REG NO./JB REG NO./ALLOC-SCH'.                          
                                                                                
       01  L24KB-HDR-2A-UNDERLINE.                                              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(07)  VALUE ALL '-'.              
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  FILLER                    PIC X(44)  VALUE ALL '-'.              
                                                                                
       01  L24KB-DATA1.                                                         
           05  FILLER                    PIC X(07)  VALUE SPACES.               
           05  L24KA-SN                  PIC ZZZ9.                              
           05  FILLER                    PIC X(3)  VALUE ')  '.                 
           05  L24KB-QUEUE-NO            PIC X(05)  VALUE ZEROS.                
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  L24KB-HT-SEQ-REGN.                                               
               10  L24KB-SEQ-NO          PIC X(07)  VALUE SPACES.               
               10  FILLER                PIC X(01)  VALUE '/'.                  
               10  L24KB-REGN-NO         PIC X(08)  VALUE SPACES.               
                                                                                
       01  L24KB-DATA2.                                                         
           05  FILLER                    PIC X(07)  VALUE SPACES.               
           05  L24KB-SN                  PIC ZZZ9.                              
           05  FILLER                    PIC X(3)  VALUE ')  '.                 
           05  L24B-QUEUE-NO             PIC X(05)  VALUE ZEROS.                
           05  FILLER                    PIC X(09)  VALUE SPACES.               
           05  L24B-HT-SEQ-REGN.                                                
               10  L24B-SEQ-NO           PIC X(07)  VALUE SPACES.               
               10  FILLER                PIC X(01)  VALUE '/'.                  
               10  L24B-REGN-NO          PIC X(08)  VALUE SPACES.               
               10  FILLER                PIC X(02)  VALUE ' ('.                 
               10  L24B-ALLOC-SCH        PIC X(03)  VALUE SPACES.               
               10  FILLER                PIC X(01)  VALUE ')'.                  
                                                                                
      *---------------->  FOR 3-RM REN                                          
       01  L24KB-HDR-1-REN.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE                       
               'QUEUE NO.'.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(17)  VALUE                       
               'SELECTION REF NO.'.                                             
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(19)  VALUE                       
               'REGISTRATION NUMBER'.                                           
                                                                                
       01  L24KB-HDR-1-UNDERLINE-REN.                                           
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE ALL '-'.              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(17)  VALUE ALL '-'.              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(19)  VALUE ALL '-'.              
                                                                                
       01  L24KB-HDR-2-REN.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE                       
               'QUEUE NO.'.                                                     
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(38)  VALUE                       
               'REGISTRATION NUMBER/ALLOCATION SCHEME'.                         
                                                                                
       01  L24KB-HDR-2-UNDERLINE-REN.                                           
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(09)  VALUE ALL '-'.              
           05  FILLER                    PIC X(05)  VALUE SPACES.               
           05  FILLER                    PIC X(38)  VALUE ALL '-'.              
                                                                                
       01  L24KB-DATA1-REN.                                                     
           05  FILLER                    PIC X(07)  VALUE SPACES.               
           05  L24KB-QUEUE-NO-REN        PIC X(05)  VALUE ZEROS.                
           05  FILLER                    PIC X(10)  VALUE SPACES.               
           05  L24KB-SEL-REF-NO-REN      PIC X(07)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE SPACES.               
           05  L24KB-REGN-NO-REN         PIC X(08)  VALUE SPACES.               
                                                                                
       01  L24KB-DATA2-REN.                                                     
           05  FILLER                    PIC X(07)  VALUE SPACES.               
           05  L24B-QUEUE-NO-REN         PIC X(05)  VALUE ZEROS.                
           05  FILLER                    PIC X(10)  VALUE SPACES.               
           05  L24B-SEL-REF-NO-REN       PIC X(07)  VALUE SPACES.               
           05  FILLER                    PIC X(10)  VALUE SPACES.               
           05  L24B-REGN-NO-REN          PIC X(08)  VALUE SPACES.               
           05  FILLER                    PIC X(01)  VALUE '('.                  
           05  L24B-ALLOC-SCH-REN        PIC X(03)  VALUE SPACES.               
           05  FILLER                    PIC X(01)  VALUE ')'.                  
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       000-MAIN-ROUTINE.                                                        
      *-------------------------------------------------------------            
           PERFORM 100-INITIALIZATION THRU 100-EXIT.                            
           PERFORM 200-READ-F205      THRU 200-EXIT                             
             UNTIL EOF-F205 = 'Y'.                                              
           PERFORM 999-CLOSE-FILES.                                             
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
       100-INITIALIZATION.                                                      
      *-------------------------------------------------------------            
           OPEN INPUT  BP13F205                                                 
                       BP13K222                                                 
                       BP13K800                                                 
                       BP13K060                                                 
                       BP13K246                                                 
                OUTPUT BP13L24K                                                 
                       P13L24KA.                                                
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K800 ' WS-K800-STATUS                
              MOVE WS-K800-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           IF WS-K222-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K222 ' WS-K222-STATUS                
              MOVE WS-K222-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           IF WS-K060-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K060 ' WS-K060-STATUS                
              MOVE WS-K060-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           IF WS-K246-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN ERROR FILE BP13K246 ' WS-K246-STATUS                
              MOVE WS-K246-STATUS TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
           CALL 'OP13K813'         USING WS-RETURN-CODE.                        
           IF WS-RETURN-CODE NOT = ZEROS AND 97                                 
              DISPLAY 'OPEN ERROR, BP13K813 STATUS ' WS-RETURN-CODE             
              MOVE WS-RETURN-CODE TO RETURN-CODE                                
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
       200-READ-F205.                                                           
      *-------------------------------------------------------------            
           READ BP13F205 AT END MOVE 'Y' TO EOF-F205                            
                            GO  TO 200-EXIT.                                    
                                                                                
           MOVE 'N' TO FINISH-PROCESS.                                          
           MOVE 0   TO WS-SNO-CTR                                               
                       WS-SNO-CTR1.                                             
           ADD 1 TO WS-F205-READ-CNT.                                           
           MOVE 'Y' TO WS-F205-SW-FLAG.                                         
           MOVE F205-NUM-NT-ZONE    TO WS-NT-ZONE.                              
           MOVE F205-DTE-ALLOCN     TO WS-ALLOC-DATE.                           
           MOVE F205-NUM-FLAT-TYPE  TO WS-FT.                                   
           IF F205-NUM-GRO = 'P'                                                
              PERFORM 300-PROCESS-F200 THRU 300-EXIT                            
           END-IF.                                                              
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
       210-READ-F200.                                                           
      *-------------------------------------------------------------            
           READ BP13F200 AT END MOVE 'Y' TO EOF-F200                            
                             GO TO 210-EXIT.                                    
                                                                                
           ADD 1 TO WS-F200-READ-CNT.                                           
                                                                                
       210-EXIT.                                                                
           EXIT.                                                                
                                                                                
       300-PROCESS-F200.                                                        
      *-------------------------------------------------------------            
           MOVE 'N' TO EOF-F200.                                                
           OPEN INPUT BP13F200.                                                 
           PERFORM 210-READ-F200 THRU 210-EXIT.                                 
                                                                                
           IF EOF-F200 = 'Y'                                                    
              GO TO 300-EXIT                                                    
           END-IF.                                                              
                                                                                
           PERFORM 400-CHECK-F200 THRU 400-EXIT                                 
             UNTIL (EOF-F200       = 'Y').                                      
                                                                                
           CLOSE BP13F200.                                                      
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
       400-CHECK-F200.                                                          
      *-------------------------------------------------------------            
                                                                                
           PERFORM 600-READ-K060 THRU 600-EXIT.                                 
           PERFORM 700-READ-K800 THRU 700-EXIT.                                 
           PERFORM 800-PROCESS-DETAILS THRU 800-EXIT.                           
                                                                                
           PERFORM 210-READ-F200 THRU 210-EXIT.                                 
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
       600-READ-K060.                                                           
      *-------------------------------------------------------------            
                                                                                
           IF (F200-NUM-NT-ZONE(1:2) = 'RE' OR 'ZN' OR 'ME') OR                 
              (F200-NUM-SELTYPE = 'BTO')                                        
               EVALUATE F200-NUM-NT-ZONE(1:2)                                   
                 WHEN 'RE'                                                      
                    MOVE '3-ROOM REN'         TO WS-PREV-NT-ZONE                
                                                 K060-DESC                      
                 WHEN 'ZN'                                                      
                    MOVE 'NON-MATURE ESTATES' TO WS-PREV-NT-ZONE                
                                                 K060-DESC                      
                 WHEN 'ME'                                                      
                    MOVE 'MATURE ESTATES'     TO WS-PREV-NT-ZONE                
                                                 K060-DESC                      
                 WHEN OTHER                                                     
                    MOVE F200-NUM-NT-ZONE      TO WS-PREV-NT-ZONE               
                                                  K060-DESC                     
               END-EVALUATE                                                     
           ELSE                                                                 
              PERFORM 650-CHECK-DESC THRU 650-EXIT                              
           END-IF.                                                              
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       650-CHECK-DESC.                                                          
      *-------------------------------------------------------------            
           IF F205-NUM-NT-ZONE-SW = 'T'                                         
              MOVE 02                TO K060-SERIAL-NO                          
           ELSE                                                                 
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              MOVE 45                TO K060-SERIAL-NO                          
           END-IF.                                                              
                                                                                
           MOVE F200-NUM-NT-ZONE  TO K060-CODE.                                 
           READ BP13K060.                                                       
           IF WS-K060-STATUS = 00                                               
              MOVE K060-DESC      TO WS-PREV-NT-ZONE                            
           ELSE                                                                 
              IF WS-K060-STATUS = 23                                            
                 MOVE SPACES         TO WS-PREV-NT-ZONE                         
                                        K060-DESC                               
                 DISPLAY 'REC NOT FOUND IN BP13K060 ' WS-K060-STATUS            
                 DISPLAY 'K060-KEY-FLD = ' K060-KEY-FLD                         
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K060 ' WS-K060-STATUS               
                 DISPLAY 'K060-KEY-FLD = ' K060-KEY-FLD                         
                 PERFORM 999-CLOSE-FILES.                                       
                                                                                
       650-EXIT.                                                                
           EXIT.                                                                
                                                                                
       700-READ-K800.                                                           
      *-------------------------------------------------------------            
           MOVE F200-NUM-REGN     TO K800-NUM-REGN.                             
           READ BP13K800.                                                       
           IF WS-K800-STATUS = 00                                               
              PERFORM 750-MOVE-K800-DATA THRU 750-EXIT                          
           ELSE                                                                 
           IF WS-K800-STATUS = 23                                               
              MOVE SPACES         TO L23A-ALLOC-SCH                             
                                     L24B-ALLOC-SCH                             
                                     L24B-ALLOC-SCH-REN                         
              DISPLAY 'REC NOT FOUND IN BP13K800 ' WS-K800-STATUS               
              DISPLAY 'K800-KEY-FLD = ' K800-NUM-REGN                           
              GO TO 700-EXIT                                                    
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K800 ' WS-K800-STATUS                  
              DISPLAY 'K800-KEY-FLD = ' K800-NUM-REGN                           
              PERFORM 999-CLOSE-FILES.                                          
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
       750-MOVE-K800-DATA.                                                      
      *-------------------------------------------------------------            
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              IF (K800-NUM-ALLO-SCHEME   = 'JB ') OR                            
                 (K800-NUM-JT-BALLOT-MTF = 1 OR 2 OR 3 OR 5)                    
                  MOVE F200-NUM-JB-PARENT-REGN TO L24B-REGN-NO                  
              ELSE                                                              
                 MOVE SPACES                  TO L24B-REGN-NO.                  
                                                                                
           IF K800-NUM-MGPS = 'P' OR 'C'                                        
              MOVE 'MGP'                TO L23A-ALLOC-SCH                       
                                           L24B-ALLOC-SCH                       
                                           L24B-ALLOC-SCH-REN                   
           ELSE                                                                 
              MOVE K800-NUM-ALLO-SCHEME TO L23A-ALLOC-SCH                       
                                           L24B-ALLOC-SCH                       
                                           L24B-ALLOC-SCH-REN                   
           END-IF.                                                              
                                                                                
       750-EXIT.                                                                
           EXIT.                                                                
                                                                                
       800-PROCESS-DETAILS.                                                     
      *-------------------------------------------------------------            
           MOVE K800-NUM-ALLO-SCHEME       TO WS-NUM-ALLO-SCHEME.               
           PERFORM 888-CHK-SERS-ALSCH    THRU 888-EXIT.                         
                                                                                
           IF (WS-LINE-CNT = 0) OR                                              
              (F200-DTE-BKAPPMT-DATE-MGPS NOT = WS-PREV-APPT-DATE) OR           
              (WS-F205-SW-FLAG = 'Y')                                           
              ADD   1               TO    WS-NUMBER                             
              MOVE WS-NUMBER        TO    WS-PAGE-NUMBER                        
              MOVE WS-PAGE-NUMBER   TO    DJDE-LINE1(36:4)                      
              WRITE PRINT-REC      FROM DJDE-LINE1 AFTER PAGE                   
              WRITE PRINT-REC-A    FROM DJDE-LINE1 AFTER PAGE                   
              PERFORM 850-PRINT-HEADING  THRU 850-EXIT                          
              MOVE 13                      TO WS-LINE-CNT                       
              MOVE F200-DTE-BKAPPMT-DATE-MGPS TO WS-PREV-APPT-DATE              
              MOVE K060-DESC               TO WS-PREV-NT-ZONE                   
              MOVE 'N'                     TO WS-F205-SW-FLAG                   
           END-IF.                                                              
                                                                                
           PERFORM 900-PRINT-DETAIL      THRU 900-EXIT.                         
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
       850-PRINT-HEADING.                                                       
      *-------------------------------------------------------------            
           MOVE  SPACES TO L24KA-HEADER-4.                                      
           MOVE  SPACES TO L24KA-HEADER-6.                                      
                                                                                
           IF F205-NUM-NT-ZONE-SW = 'T'                                         
              MOVE ' ESTATE'      TO WS-ESTATE-ZONE-TXT                         
           ELSE                                                                 
           IF F205-NUM-NT-ZONE-SW = 'Z'                                         
              MOVE SPACES         TO WS-ESTATE-ZONE-TXT                         
           END-IF.                                                              
                                                                                
           WRITE PRINT-REC      FROM L24KA-TLR-1 AFTER 2                        
           WRITE PRINT-REC-A    FROM L24KA-TLR-1 AFTER 2.                       
                                                                                
           ADD  1    TO WS-DAY.                                                 
           MOVE  WS-DAY TO WS-E-DAY.                                            
           IF (WS-DAY(1:1) NOT = '1') AND                                       
              (WS-DAY(2:1) = '1')                                               
              MOVE 'ST' TO WS-DAY-DESC                                          
           ELSE                                                                 
           IF (WS-DAY(1:1) NOT = '1') AND                                       
              (WS-DAY(2:1) = '2')                                               
              MOVE 'ND' TO WS-DAY-DESC                                          
           ELSE                                                                 
           IF (WS-DAY(1:1) NOT = '1') AND                                       
              (WS-DAY(2:1) = '3')                                               
              MOVE 'RD' TO WS-DAY-DESC                                          
           ELSE                                                                 
              MOVE 'TH' TO WS-DAY-DESC.                                         
                                                                                
           MOVE SPACES                TO L24K-DAY-A.                            
           MOVE F200-DTE-BKAPPMT-DATE-MGPS TO WS-IN-DATE.                       
           PERFORM 951-GET-DTE-DESC  THRU 951-EXIT.                             
           MOVE WS-DD-WORD           TO WS-APPT-DTE.                            
                                                                                
           IF (F200-NUM-FLAT-TYPE   = 'E')           AND                        
              (F200-NUM-NT-ZONE NOT = 'ME' AND 'ZN') AND                        
              (F200-DTE-BALLOT     >= '199810')                                 
              MOVE WS-APPT-DTE             TO L24K-DAY-A                        
           ELSE                                                                 
           STRING '( '  DELIMITED BY SIZE                                       
                  WS-APPT-DTE              DELIMITED BY SPACE-2                 
                  ' )'                     DELIMITED BY SIZE                    
             INTO L24K-DAY-A.                                                   
                                                                                
           MOVE SPACES               TO L24K-NT-ZONE-FT.                        
                                                                                
           EVALUATE F200-NUM-FLAT-TYPE                                          
                                                                                
            WHEN '00'                                                           
              IF F200-NUM-SELTYPE = 'BTO'                                       
                 PERFORM 860-CALL-BP13C910 THRU 860-EXIT                        
                 IF K813-NUM-FLAT-TYPE = '1A'                                   
                    STRING 'STUDIO APARTMENT IN ' DELIMITED BY SIZE             
                           K813-NME-SITE         DELIMITED BY SPACE-2           
                           INTO  L24K-NT-ZONE-FT                                
                                                                                
                    STRING 'STUDIO APARTMENT IN '                               
                      DELIMITED BY SIZE                                         
                    INTO  L24K-FLAT-TYPE-A                                      
                 ELSE                                                           
                    IF K813-NUM-FLAT-TYPE = '4P' OR '5P'                        
                       STRING K813-NUM-FLAT-TYPE(1:1) DELIMITED BY SPACE        
                              ' - ROOM FLAT (PAIRED UNITS) IN '                 
                                                   DELIMITED BY SIZE            
                              K813-NME-SITE        DELIMITED BY SPACE-2         
                       INTO  L24K-NT-ZONE-FT                                    
                       STRING K813-NUM-FLAT-TYPE(1:1) DELIMITED BY SPACE        
                           ' - ROOM FLAT (PAIRED UNITS) IN'                     
                                                   DELIMITED BY SIZE            
                       INTO L24K-FLAT-TYPE-A                                    
                    ELSE                                                        
                       IF K813-NUM-FLAT-TYPE = '2F'                             
                          STRING '2 - ROOM FLEXI FLATS IN '                     
                                 DELIMITED BY SIZE                              
                                 K813-NME-SITE     DELIMITED BY SPACE-2         
                                 INTO  L24K-NT-ZONE-FT                          
                          STRING '2 - ROOM FLEXI FLATS IN '                     
                                 DELIMITED BY SIZE                              
                                 INTO L24K-FLAT-TYPE-A                          
                       ELSE                                                     
                          STRING K813-NUM-FLAT-TYPE(1:1)                        
                                 DELIMITED BY SPACE                             
                                 ' - ROOM FLATS IN '  DELIMITED BY SIZE         
                                 K813-NME-SITE     DELIMITED BY SPACE-2         
                                 INTO  L24K-NT-ZONE-FT                          
                          STRING K813-NUM-FLAT-TYPE(1:1)                        
                                 DELIMITED BY SPACE                             
                                 ' - ROOM FLATS IN       '                      
                                 DELIMITED BY SIZE                              
                                 INTO L24K-FLAT-TYPE-A                          
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 STRING                                                         
                    WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                   
                    WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                      
                   INTO L24K-FLAT-TYPE-00                                       
              END-IF                                                            
                                                                                
            WHEN '1A'                                                           
              STRING 'STUDIO APARTMENT IN ' DELIMITED BY SIZE                   
                      WS-PREV-NT-ZONE       DELIMITED BY SPACE-2                
                      WS-ESTATE-ZONE-TXT    DELIMITED BY SIZE                   
                INTO  L24K-NT-ZONE-FT                                           
                                                                                
              STRING 'STUDIO APARTMENT IN '                                     
                      DELIMITED BY SIZE                                         
                INTO  L24K-FLAT-TYPE-A                                          
                                                                                
            WHEN '2A'                                                           
              STRING 'STUDIO APARTMENT'                                         
                      DELIMITED BY SIZE                                         
                INTO  L24K-NT-ZONE-FT                                           
              STRING 'STUDIO APARTMENT IN '                                     
                      DELIMITED BY SIZE                                         
                INTO  L24K-FLAT-TYPE-A                                          
                                                                                
            WHEN '2 '                                                           
              STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                   
                     ' - ROOM FLATS IN '   DELIMITED BY SIZE                    
                      WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L24K-NT-ZONE-FT                                           
              STRING F200-NUM-FLAT-TYPE        DELIMITED BY SPACE               
                     ' - ROOM FLATS IN       ' DELIMITED BY SIZE                
                INTO L24K-FLAT-TYPE-A                                           
                                                                                
            WHEN '3 '                                                           
              IF F200-NUM-NT-ZONE = '3R' OR 'RE'                                
                 STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                
                        ' - ROOM FLATS'       DELIMITED BY SIZE                 
                   INTO  L24K-NT-ZONE-FT                                        
                 STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                
                        ' - ROOM FLATS'       DELIMITED BY SIZE                 
                   INTO L24K-FLAT-TYPE-A                                        
              ELSE                                                              
                 STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                
                        ' - ROOM FLATS IN '   DELIMITED BY SIZE                 
                         WS-PREV-NT-ZONE      DELIMITED BY SPACE-2              
                         WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                 
                   INTO  L24K-NT-ZONE-FT                                        
                 STRING F200-NUM-FLAT-TYPE        DELIMITED BY SPACE            
                        ' - ROOM FLATS IN       ' DELIMITED BY SIZE             
                   INTO L24K-FLAT-TYPE-A                                        
              END-IF                                                            
                                                                                
            WHEN 'SE'                                                           
              STRING 'SA, 3, 4 & 5 - ROOM FLATS IN ' DELIMITED BY SIZE          
                      WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L24K-NT-ZONE-FT                                           
              MOVE 'SA, 3, 4 & 5 - ROOM FLATS IN   ' TO L24K-FLAT-TYPE-A        
                                                                                
            WHEN '4D'                                                           
              STRING 'TYPE A - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L24K-NT-ZONE-FT                                           
              MOVE 'TYPE A - ROOM FLATS IN   ' TO L24K-FLAT-TYPE-A              
                                                                                
            WHEN '5D'                                                           
              STRING 'TYPE B - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L24K-NT-ZONE-FT                                           
              MOVE 'TYPE B - ROOM FLATS IN   ' TO L24K-FLAT-TYPE-A              
                                                                                
            WHEN 'ED'                                                           
              STRING 'TYPE C - ROOM FLATS IN ' DELIMITED BY SIZE                
                      WS-PREV-NT-ZONE      DELIMITED BY SPACE-2                 
                      WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                    
                INTO  L24K-NT-ZONE-FT                                           
              MOVE 'TYPE C - ROOM FLATS IN   ' TO L24K-FLAT-TYPE-A              
                                                                                
            WHEN 'E '                                                           
              EVALUATE F200-NUM-NT-ZONE                                         
                                                                                
                WHEN 'ME'                                                       
                 MOVE 'EXECUTIVE FLATS IN MATURE ESTATES '                      
                   TO  L24K-NT-ZONE-FT                                          
                 MOVE 'EXECUTIVE FLATS IN MATURE ESTATES '                      
                   TO  L24K-FLAT-TYPE-A                                         
                                                                                
                WHEN 'ZN'                                                       
                 MOVE 'EXECUTIVE FLATS IN NON-MATURE ESTATES '                  
                   TO  L24K-NT-ZONE-FT                                          
                 MOVE 'EXECUTIVE FLATS IN NON-MATURE ESTATES '                  
                   TO  L24K-FLAT-TYPE-A                                         
                                                                                
                WHEN OTHER                                                      
                 STRING 'EXECUTIVE FLATS IN ' DELIMITED BY SIZE                 
                         WS-PREV-NT-ZONE      DELIMITED BY SPACE-2              
                         WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE                 
                   INTO  L24K-NT-ZONE-FT                                        
                 MOVE 'EXECUTIVE FLATS IN       ' TO L24K-FLAT-TYPE-A           
                                                                                
              END-EVALUATE                                                      
                                                                                
            WHEN '4 '                                                           
               IF F200-NUM-NT-ZONE = 'CT'                                       
                  STRING '4-ROOM/S1 APARTMENTS IN'                              
                     DELIMITED BY SIZE                                          
                     INTO L24K-FLAT-TYPE-A                                      
                  STRING '4-ROOM/S1 APARTMENTS IN CENTRAL'                      
                     DELIMITED BY SIZE                                          
                     INTO L24K-NT-ZONE-FT                                       
               ELSE                                                             
                    STRING F200-NUM-FLAT-TYPE  DELIMITED BY SPACE               
                       ' - ROOM FLATS IN '     DELIMITED BY SIZE                
                        WS-PREV-NT-ZONE        DELIMITED BY SPACE-2             
                        WS-ESTATE-ZONE-TXT     DELIMITED BY SIZE                
                    INTO  L24K-NT-ZONE-FT                                       
                    STRING F200-NUM-FLAT-TYPE  DELIMITED BY SPACE               
                       ' - ROOM FLATS IN       ' DELIMITED BY SIZE              
                       INTO L24K-FLAT-TYPE-A                                    
               END-IF                                                           
            WHEN '5 '                                                           
              EVALUATE F200-NUM-NT-ZONE                                         
                                                                                
                WHEN 'ME'                                                       
                 STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                
                        ' - ROOM FLATS IN MATURE ESTATES '                      
                        DELIMITED BY SIZE                                       
                   INTO L24K-NT-ZONE-FT                                         
                 STRING F200-NUM-FLAT-TYPE        DELIMITED BY SPACE            
                        ' - ROOM FLATS IN MATURE ESTATES '                      
                        DELIMITED BY SIZE                                       
                   INTO L24K-FLAT-TYPE-A                                        
                                                                                
                WHEN 'ZN'                                                       
                 STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE                
                        ' - ROOM FLATS IN NON-MATURE ESTATES '                  
                        DELIMITED BY SIZE                                       
                   INTO L24K-NT-ZONE-FT                                         
                 STRING F200-NUM-FLAT-TYPE        DELIMITED BY SPACE            
                        ' - ROOM FLATS IN NON-MATURE ESTATES '                  
                        DELIMITED BY SIZE                                       
                   INTO L24K-FLAT-TYPE-A                                        
                                                                                
                WHEN 'CT'                                                       
                  STRING '5-ROOM/S2 APARTMENTS IN CENTRAL'                      
                     DELIMITED BY SIZE                                          
                     INTO L24K-NT-ZONE-FT                                       
                  STRING '5-ROOM/S2 APARTMENTS IN'                              
                      DELIMITED BY SIZE                                         
                      INTO L24K-FLAT-TYPE-A                                     
                                                                                
                WHEN OTHER                                                      
                   STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE              
                          ' - ROOM FLATS IN '   DELIMITED BY SIZE               
                           WS-PREV-NT-ZONE      DELIMITED BY SPACE-2            
                           WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE               
                     INTO  L24K-NT-ZONE-FT                                      
                   STRING F200-NUM-FLAT-TYPE     DELIMITED BY SPACE             
                        ' - ROOM FLATS IN       ' DELIMITED BY SIZE             
                     INTO L24K-FLAT-TYPE-A                                      
              END-EVALUATE                                                      
           END-EVALUATE.                                                        
                                                                                
           IF F200-NUM-SELTYPE = 'SBF'                                          
              MOVE F200-DTE-BALLOT        TO K246-DTE-BALLOT                    
              MOVE WS-PREV-NT-ZONE        TO K246-NUM-NEW-TOWN                  
              EVALUATE F200-NUM-FLAT-TYPE                                       
               WHEN '1A'                                                        
               WHEN '2A'                                                        
                 MOVE 'SA    '               TO K246-NUM-FLAT-TYPE              
               WHEN '2 '                                                        
               WHEN '2F'                                                        
                 MOVE '2-ROOM'               TO K246-NUM-FLAT-TYPE              
               WHEN '3 '                                                        
                 MOVE '3-ROOM'               TO K246-NUM-FLAT-TYPE              
               WHEN '4 '                                                        
                 MOVE '4-ROOM'               TO K246-NUM-FLAT-TYPE              
               WHEN '5 '                                                        
                 MOVE '5-ROOM'               TO K246-NUM-FLAT-TYPE              
              END-EVALUATE                                                      
              PERFORM 870-READ-K246       THRU 870-EXIT                         
           END-IF.                                                              
                                                                                
           PERFORM 950-READ-BP13K222 THRU 950-EXIT.                             
                                                                                
           MOVE SPACES                     TO L24K-NEWTOWN-ZONE-A.              
                                                                                
           IF F200-NUM-NT-ZONE = '3R' OR 'RE' OR 'ZN' OR 'ME'                   
              STRING 'IS FROM '               DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L24K-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
           IF F200-NUM-NT-ZONE = 'CT'                                           
              STRING 'CENTRAL'                DELIMITED BY SPACE-2              
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L24K-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
           IF F200-NUM-SELTYPE = 'BTO'                                          
              STRING K813-NME-SITE            DELIMITED BY SPACE-2              
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L24K-NEWTOWN-ZONE-A                                        
           ELSE                                                                 
              STRING WS-PREV-NT-ZONE          DELIMITED BY SPACE-2              
                     WS-ESTATE-ZONE-TXT       DELIMITED BY SIZE                 
                     ' IS FROM '              DELIMITED BY SIZE                 
                     WS-FROM-DATE             DELIMITED BY SPACE-2              
                     ' TO '                   DELIMITED BY SIZE                 
                     WS-TO-DATE               DELIMITED BY SPACE-2              
                     '.'                      DELIMITED BY SIZE                 
                INTO L24K-NEWTOWN-ZONE-A                                        
           END-IF                                                               
           END-IF.                                                              
                                                                                
                                                                                
      * APPLICANT'S COPY (BP13L24K)                                             
           WRITE PRINT-REC FROM L24KA-HEADER-1.                                 
                                                                                
           IF F205-NUM-NT-ZONE NOT = 'RE' AND 'ZN' AND 'ME'                     
              IF F200-NUM-FLAT-TYPE = 'E' AND                                   
                            F200-DTE-BALLOT >= '199810'                         
                 WRITE PRINT-REC FROM L24KA-HEADER-2A AFTER 2                   
              ELSE                                                              
                 WRITE PRINT-REC FROM L24KA-HEADER-2  AFTER 2                   
              END-IF                                                            
           ELSE                                                                 
              WRITE PRINT-REC FROM L24KA-HEADER-2  AFTER 2                      
           END-IF.                                                              
                                                                                
           WRITE PRINT-REC FROM L24KA-HEADER-3 AFTER 1.                         
           WRITE PRINT-REC FROM L24KA-HEADER-4 AFTER 1.                         
           WRITE PRINT-REC FROM L24KA-HEADER-5 AFTER 2.                         
           WRITE PRINT-REC FROM L24KA-HEADER-6 AFTER 1.                         
                                                                                
           IF (F205-NUM-NT-ZONE-SW = 'Z'                   AND                  
               F205-NUM-NT-ZONE    = 'RE' OR 'ME' OR 'ZN') OR                   
              (F205-NUM-NT-ZONE-SW = 'T'                   AND                  
               F205-NUM-FLAT-TYPE = '1A' OR '2A')                               
               IF C-SERS-ALLO-SCHEME                                            
      *           WRITE PRINT-REC FROM L24KA-HEADER-7 AFTER 2                   
                  WRITE PRINT-REC FROM L24KA-HEADER-8-SERS AFTER 1              
                  WRITE PRINT-REC FROM L24KA-HEADER-9-SERS AFTER 2              
               ELSE                                                             
                  WRITE PRINT-REC FROM L24KB-HDR-1-REN           AFTER 2        
                  WRITE PRINT-REC FROM L24KB-HDR-1-UNDERLINE-REN AFTER 1        
               END-IF                                                           
           ELSE                                                                 
              IF F205-NUM-NT-ZONE-SW = 'T'                                      
      *          WRITE PRINT-REC FROM L24KA-HEADER-7 AFTER 2                    
                 IF C-SERS-ALLO-SCHEME                                          
                    WRITE PRINT-REC FROM L24KA-HEADER-8-SERS AFTER 1            
                    WRITE PRINT-REC FROM L24KA-HEADER-9-SERS AFTER 2            
                 ELSE                                                           
      *             WRITE PRINT-REC FROM L24KA-HEADER-8 AFTER 1                 
                    WRITE PRINT-REC FROM L24KA-HEADER-9-SERS AFTER 2            
                 END-IF                                                         
              ELSE                                                              
                 IF F205-NUM-NT-ZONE-SW = 'Z'                                   
                    IF F200-NUM-FLAT-TYPE = 'E' AND                             
                       F200-DTE-BALLOT >= '199810'                              
                       WRITE PRINT-REC FROM L24KB-HDR-1A                        
                             AFTER 2                                            
                       WRITE PRINT-REC FROM L24KB-HDR-1A-UNDERLINE              
                             AFTER 1                                            
                    ELSE                                                        
                       IF C-SERS-ALLO-SCHEME                                    
      *                   WRITE PRINT-REC FROM L24KA-HEADER-7 AFTER 2           
                          WRITE PRINT-REC FROM L24KA-HEADER-8-SERS              
                                                              AFTER 1           
                          WRITE PRINT-REC FROM L24KA-HEADER-9-SERS              
                                                              AFTER 2           
                       ELSE                                                     
                          WRITE PRINT-REC FROM L24KB-HDR-1                      
                                AFTER 2                                         
                          WRITE PRINT-REC FROM L24KB-HDR-1-UNDERLINE            
                                AFTER 1                                         
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      * ALLOCATION'S COPY (P13L24KA)                                            
           WRITE PRINT-REC-A FROM L24KA-HEADER-1.                               
                                                                                
           IF F205-NUM-NT-ZONE NOT = 'RE' AND 'ZN' AND 'ME'                     
              IF F200-NUM-FLAT-TYPE = 'E' AND                                   
                            F200-DTE-BALLOT >= '199810'                         
                 WRITE PRINT-REC-A FROM L24KA-HEADER-2A AFTER 2                 
              ELSE                                                              
                 WRITE PRINT-REC-A FROM L24KA-HEADER-2 AFTER 2                  
              END-IF                                                            
           ELSE                                                                 
              WRITE PRINT-REC-A FROM L24KA-HEADER-2 AFTER 2                     
           END-IF.                                                              
                                                                                
           WRITE PRINT-REC-A FROM L24KA-HEADER-3 AFTER 1.                       
           WRITE PRINT-REC-A FROM L24KA-HEADER-4 AFTER 1.                       
           WRITE PRINT-REC-A FROM L24KA-HEADER-5 AFTER 2.                       
           WRITE PRINT-REC-A FROM L24KA-HEADER-6 AFTER 1.                       
                                                                                
           IF (F205-NUM-NT-ZONE-SW = 'Z'          AND                           
               F205-NUM-NT-ZONE    = 'RE' OR 'ME' OR 'ZN') OR                   
              (F205-NUM-NT-ZONE-SW = 'T'          AND                           
               F205-NUM-FLAT-TYPE = '1A' OR '2A')                               
               IF C-SERS-ALLO-SCHEME                                            
      *           WRITE PRINT-REC-A FROM L24KA-HEADER-7 AFTER 2                 
                  WRITE PRINT-REC-A FROM L24KA-HEADER-8-SERS AFTER 1            
                  WRITE PRINT-REC-A FROM L24KA-HEADER-9A-SERS AFTER 2           
               ELSE                                                             
                  WRITE PRINT-REC-A FROM L24KB-HDR-1-REN     AFTER 2            
                  WRITE PRINT-REC-A FROM L24KB-HDR-1-UNDERLINE-REN              
                                                             AFTER 1            
               END-IF                                                           
           ELSE                                                                 
              IF F205-NUM-NT-ZONE-SW = 'T'                                      
      *          WRITE PRINT-REC-A FROM L24KA-HEADER-7 AFTER 2                  
                 IF C-SERS-ALLO-SCHEME                                          
                    WRITE PRINT-REC-A FROM L24KA-HEADER-8-SERS AFTER 1          
                    WRITE PRINT-REC-A FROM L24KA-HEADER-9A-SERS AFTER 2         
                 ELSE                                                           
      *             WRITE PRINT-REC-A FROM L24KA-HEADER-8 AFTER 1               
                    WRITE PRINT-REC-A FROM L24KA-HEADER-9A-SERS AFTER 2         
                 END-IF                                                         
              ELSE                                                              
                 IF F205-NUM-NT-ZONE-SW = 'Z'                                   
                    IF F200-NUM-FLAT-TYPE = 'E' AND                             
                       F200-DTE-BALLOT >= '199810'                              
                       WRITE PRINT-REC-A FROM L24KB-HDR-1A                      
                             AFTER 2                                            
                       WRITE PRINT-REC-A FROM L24KB-HDR-1A-UNDERLINE            
                             AFTER 1                                            
                    ELSE                                                        
                       IF C-SERS-ALLO-SCHEME                                    
      *                   WRITE PRINT-REC-A FROM L24KA-HEADER-7 AFTER 2         
                          WRITE PRINT-REC-A FROM L24KA-HEADER-8-SERS            
                                                              AFTER 1           
                          WRITE PRINT-REC-A FROM L24KA-HEADER-9A-SERS           
                                                              AFTER 2           
                       ELSE                                                     
                          WRITE PRINT-REC-A FROM L24KB-HDR-1                    
                                AFTER 2                                         
                          WRITE PRINT-REC-A FROM L24KB-HDR-1-UNDERLINE          
                                AFTER 1                                         
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       850-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       860-CALL-BP13C910.                                                       
      *----------------------------------------------------------------*        
           MOVE WS-PREV-NT-ZONE      TO WS-LINK-ZONE.                           
           CALL 'BP13C910' USING WS-LINK-REC-2,                                 
                                 WS-BP13K813-REC,                               
                                 WS-ZONE-FND-FLAG.                              
           IF WS-ZONE-FND-FLAG = 'Y'                                            
              MOVE WS-BP13K813-REC TO BP13K813-REC                              
           ELSE                                                                 
              MOVE SPACES          TO BP13K813-REC                              
           END-IF.                                                              
                                                                                
       860-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       870-READ-K246.                                                           
      *-------------------------------------------------------------            
                                                                                
           READ BP13K246.                                                       
                                                                                
           IF WS-K246-STATUS = 00                                               
              IF K246-COMBINED-NT NOT = SPACES AND LOW-VALUES                   
                 MOVE SPACES       TO WS-STRING-TO-PARSE                        
                 IF K246-NUM-NT-TAG = 'Y'                                       
                    STRING K246-NUM-NEW-TOWN '/ '                               
                           K246-COMBINED-NT                                     
                           DELIMITED BY SIZE INTO WS-STRING-TO-PARSE            
                    END-STRING                                                  
                    MOVE LENGTH OF WS-STRING-TO-PARSE                           
                                      TO WS-STRING-LENGTH                       
                    MOVE 'Y'          TO WS-INSERT-SPACE-FLAG                   
                    PERFORM 960-PARSE-STRING    THRU 960-EXIT                   
                    MOVE WS-PARSED-STRING   TO  WS-PREV-NT-ZONE                 
                                                K060-DESC                       
                 ELSE                                                           
                    MOVE SPACES       TO WS-STRING-TO-PARSE                     
                    STRING K246-COMBINED-NT '/ '                                
                           K246-NUM-NEW-TOWN                                    
                           DELIMITED BY SIZE INTO WS-STRING-TO-PARSE            
                    END-STRING                                                  
                    MOVE LENGTH OF WS-STRING-TO-PARSE                           
                                      TO WS-STRING-LENGTH                       
                    MOVE 'Y'          TO WS-INSERT-SPACE-FLAG                   
                    PERFORM 960-PARSE-STRING    THRU 960-EXIT                   
                    MOVE WS-PARSED-STRING   TO  WS-PREV-NT-ZONE                 
                                                K060-DESC                       
                 END-IF                                                         
              END-IF                                                            
              IF K246-COMBINED-FT NOT = SPACES AND LOW-VALUES                   
                 IF K246-NUM-FT-TAG = 'N'                                       
                    STRING K246-COMBINED-FT(1:1) '/'                            
                           K246-NUM-FLAT-TYPE(1:1) ' - ROOM FLAT IN '           
                           DELIMITED BY SIZE                                    
                           WS-PREV-NT-ZONE      DELIMITED BY SPACE-2            
                           WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE               
                           INTO  L24K-NT-ZONE-FT                                
                    STRING K246-COMBINED-FT(1:1) '/'                            
                           K246-NUM-FLAT-TYPE(1:1) ' - ROOM FLAT IN '           
                           DELIMITED BY SIZE INTO L24K-FLAT-TYPE-A              
                 ELSE                                                           
                    MOVE SPACES       TO WS-STRING-TO-PARSE                     
                    STRING K246-NUM-FLAT-TYPE '/'                               
                           K246-COMBINED-FT(1:4) ' FLAT IN '                    
                           DELIMITED BY SIZE                                    
                           WS-PREV-NT-ZONE      DELIMITED BY SPACE-2            
                           WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE               
                           INTO WS-STRING-TO-PARSE                              
                    MOVE LENGTH OF WS-STRING-TO-PARSE                           
                                      TO WS-STRING-LENGTH                       
                    MOVE 'Y'          TO WS-INSERT-SPACE-FLAG                   
                    PERFORM 960-PARSE-STRING    THRU 960-EXIT                   
                    MOVE WS-PARSED-STRING   TO  L24K-NT-ZONE-FT                 
                    MOVE SPACES       TO WS-STRING-TO-PARSE                     
                    STRING K246-NUM-FLAT-TYPE '/'                               
                           K246-COMBINED-FT(1:4) ' ROOM FLAT IN '               
                           DELIMITED BY SIZE INTO WS-STRING-TO-PARSE            
                    MOVE LENGTH OF WS-STRING-TO-PARSE                           
                                      TO WS-STRING-LENGTH                       
                    MOVE 'Y'          TO WS-INSERT-SPACE-FLAG                   
                    PERFORM 960-PARSE-STRING    THRU 960-EXIT                   
                    MOVE WS-PARSED-STRING   TO  L24K-FLAT-TYPE-A                
                 END-IF                                                         
              ELSE                                                              
                 IF K246-COMBINED-NT NOT = SPACES AND LOW-VALUES                
                    IF F200-NUM-FLAT-TYPE = '1A' OR '2A'                        
                       STRING 'STUDIO APARTMENT IN ' DELIMITED BY SIZE          
                         WS-PREV-NT-ZONE       DELIMITED BY SPACE-2             
                         WS-ESTATE-ZONE-TXT    DELIMITED BY SIZE                
                         INTO  L24K-NT-ZONE-FT                                  
                                                                                
                       STRING 'STUDIO APARTMENT IN '                            
                         DELIMITED BY SIZE                                      
                         INTO  L24K-FLAT-TYPE-A                                 
                    ELSE                                                        
                       STRING F200-NUM-FLAT-TYPE    DELIMITED BY SPACE          
                          ' - ROOM FLATS IN '   DELIMITED BY SIZE               
                           WS-PREV-NT-ZONE      DELIMITED BY SPACE-2            
                           WS-ESTATE-ZONE-TXT   DELIMITED BY SIZE               
                        INTO  L24K-NT-ZONE-FT                                   
                       STRING F200-NUM-FLAT-TYPE     DELIMITED BY SPACE         
                        ' - ROOM FLATS IN       ' DELIMITED BY SIZE             
                       INTO L24K-FLAT-TYPE-A                                    
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              IF WS-K246-STATUS = 23                                            
                 DISPLAY 'REC NOT FOUND IN BP13K246 ' K246-KEY-FLD              
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K246 ' WS-K246-STATUS               
                 DISPLAY 'K246-KEY-FLD = ' K246-KEY-FLD                         
                 PERFORM 999-CLOSE-FILES                                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       870-EXIT.                                                                
           EXIT.                                                                
                                                                                
       888-CHK-SERS-ALSCH.                                                      
      *-------------------------------------------------------------            
      *----------------------------------------------------------------         
      * SEARCH SERS TABLE TO CHECK ALLOC SCHEME                                 
      *----------------------------------------------------------------         
           SET WS-SERS-PTR TO 1.                                                
           SEARCH WS-SERS-SCH                                                   
              AT END                                                            
                 MOVE 'N'      TO SW-SERS-ALLO-SCHEME                           
              WHEN WS-SERS-SCHEME (WS-SERS-PTR) = WS-NUM-ALLO-SCHEME            
                 MOVE 'Y'      TO SW-SERS-ALLO-SCHEME                           
           END-SEARCH.                                                          
                                                                                
       888-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       900-PRINT-DETAIL.                                                        
      *-------------------------------------------------------------            
           IF ((F205-NUM-NT-ZONE-SW = 'Z')         AND                          
               (F205-NUM-NT-ZONE    = 'RE' OR 'ME' OR 'ZN') AND                 
               (NOT C-SERS-ALLO-SCHEME)) OR                                     
              ((F205-NUM-NT-ZONE-SW = 'T')         AND                          
               (F205-NUM-FLAT-TYPE = '1A' OR '2A') AND                          
               (NOT C-SERS-ALLO-SCHEME))                                        
               PERFORM 901-PRINT-REN-SA THRU 901-EXIT                           
           ELSE                                                                 
              IF F205-NUM-NT-ZONE-SW = 'T'                                      
                 PERFORM 902-PRINT-NT THRU 902-EXIT                             
           ELSE                                                                 
              IF F205-NUM-NT-ZONE-SW = 'Z'                                      
                 IF C-SERS-ALLO-SCHEME                                          
                    PERFORM 902-PRINT-NT         THRU 902-EXIT                  
                 ELSE                                                           
                    PERFORM 904-PRINT-ZN         THRU 904-EXIT                  
                 END-IF                                                         
              END-IF                                                            
              END-IF                                                            
           END-IF.                                                              
                                                                                
           ADD 1                           TO WS-LINE-CNT.                      
                                                                                
           IF WS-LINE-CNT > 58                                                  
              MOVE 0                       TO WS-LINE-CNT                       
           END-IF.                                                              
                                                                                
       900-EXIT.                                                                
            EXIT.                                                               
                                                                                
       901-PRINT-REN-SA.                                                        
      *-------------------------------------------------------------            
              MOVE F200-NUM-MGPS-QUEUE-SERIAL TO WS-QUEUE-NO-PIC9.              
              MOVE WS-QUEUE-NO-PIC9           TO L24KB-QUEUE-NO-REN             
                                                 L24B-QUEUE-NO-REN.             
                                                                                
              IF F200-NUM-JB-QUEUE-SEQUENCE NOT = SPACES                        
              MOVE F200-NUM-JB-QUEUE-SEQUENCE TO L24KB-SEL-REF-NO-REN           
                                                 L24B-SEL-REF-NO-REN            
              ELSE                                                              
              MOVE F200-NUM-SEQUENCE TO L24KB-SEL-REF-NO-REN                    
                                        L24B-SEL-REF-NO-REN                     
              END-IF.                                                           
                                                                                
              MOVE F200-NUM-REGN              TO L24KB-REGN-NO-REN              
                                                 L24B-REGN-NO-REN.              
              WRITE PRINT-REC    FROM L24KB-DATA1-REN AFTER 1.                  
              WRITE PRINT-REC-A  FROM L24KB-DATA2-REN AFTER 1.                  
                                                                                
       901-EXIT.                                                                
            EXIT.                                                               
                                                                                
       902-PRINT-NT.                                                            
      *-------------------------------------------------------------            
              ADD 1    TO WS-SNO-CTR.                                           
              MOVE F200-NUM-MGPS-QUEUE-SERIAL TO WS-QUEUE-NO-PIC9.              
              MOVE WS-QUEUE-NO-PIC9           TO L24K-NUM-QUEUE                 
                                                 L23A-NUM-QUEUE.                
              MOVE WS-SNO-CTR                 TO L24K-SN                        
                                                 L23A-SN.                       
              MOVE F200-NUM-REGN              TO L24K-REGN-NO                   
                                                 L23A-REGN-NO.                  
              IF C-SERS-ALLO-SCHEME                                             
                 EVALUATE F200-NUM-ACTUAL-FT                                    
                   WHEN '2 '                                                    
                   WHEN '2F'                                                    
                     MOVE '(2-RM)' TO L24K-FT                                   
                                      L23A-FT                                   
                   WHEN '3 '                                                    
                     MOVE '(3-RM)' TO L24K-FT                                   
                                      L23A-FT                                   
                   WHEN '4 '                                                    
                     MOVE '(4-RM)' TO L24K-FT                                   
                                      L23A-FT                                   
                   WHEN '5 '                                                    
                     MOVE '(5-RM)' TO L24K-FT                                   
                                      L23A-FT                                   
                   WHEN '2A'                                                    
                     MOVE '(2A  )' TO L24K-FT                                   
                                      L23A-FT                                   
                 END-EVALUATE                                                   
              ELSE                                                              
                 MOVE SPACES   TO L24K-FT                                       
                                  L23A-FT                                       
              END-IF.                                                           
                                                                                
              WRITE PRINT-REC    FROM L24KA-DATA1 AFTER 1.                      
              WRITE PRINT-REC-A  FROM L24KA-DATA2 AFTER 1.                      
                                                                                
       902-EXIT.                                                                
            EXIT.                                                               
                                                                                
       904-PRINT-ZN.                                                            
      *-------------------------------------------------------------            
           ADD 1    TO WS-SNO-CTR1.                                             
           MOVE WS-SNO-CTR1                TO L24KA-SN                          
                                              L24KB-SN.                         
           IF F200-NUM-FLAT-TYPE = 'E' AND                                      
              F200-DTE-BALLOT >= '199810'                                       
              ADD 1 TO WS-SRNO                                                  
              MOVE WS-SRNO                    TO L24KB-QUEUE-NO                 
                                                 L24B-QUEUE-NO                  
           ELSE                                                                 
              MOVE F200-NUM-MGPS-QUEUE-SERIAL TO WS-QUEUE-NO-PIC9               
              MOVE WS-QUEUE-NO-PIC9           TO L24KB-QUEUE-NO                 
                                                 L24B-QUEUE-NO                  
           END-IF.                                                              
                                                                                
           MOVE F200-NUM-SEQUENCE TO L24KB-SEQ-NO                               
                                     L24B-SEQ-NO.                               
                                                                                
           MOVE F200-NUM-REGN              TO L24KB-REGN-NO                     
                                              L24B-REGN-NO.                     
           WRITE PRINT-REC               FROM L24KB-DATA1 AFTER 1.              
           WRITE PRINT-REC-A             FROM L24KB-DATA2 AFTER 1.              
                                                                                
       904-EXIT.                                                                
           EXIT.                                                                
                                                                                
       950-READ-BP13K222.                                                       
      *-------------------------------------------------------------            
           MOVE F200-DTE-ALLOC     TO K222-DTE-ALLOC.                           
           MOVE F200-NUM-NT-ZONE   TO K222-NUM-NT-ZONE.                         
           MOVE F200-NUM-FLAT-TYPE TO K222-NUM-FLAT-TYPE.                       
           READ BP13K222.                                                       
           IF WS-K222-STATUS NOT = 00                                           
              MOVE SPACES                 TO WS-FROM-DATE                       
              MOVE SPACES                 TO WS-TO-DATE                         
              DISPLAY 'ERROR READING BP13K222, STATUS= ' WS-K222-STATUS         
              DISPLAY 'K222-KEY-FLD = ' K222-KEY-FLD                            
           ELSE                                                                 
              MOVE K222-DTE-START-BKAPPMT TO WS-IN-DATE                         
              PERFORM 951-GET-DTE-DESC  THRU 951-EXIT                           
              MOVE WS-DD-WORD             TO WS-FROM-DATE                       
                                                                                
              MOVE K222-DTE-END-BKAPPMT   TO WS-IN-DATE                         
              PERFORM 951-GET-DTE-DESC  THRU 951-EXIT                           
              MOVE WS-DD-WORD             TO WS-TO-DATE.                        
                                                                                
       950-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
       951-GET-DTE-DESC.                                                        
      *-------------------------------------------------------------            
           MOVE 'DD'                   TO WS-IN-OPTION.                         
           MOVE '000'                  TO WS-RETURN.                            
                                                                                
           CALL 'AV02C001' USING LINK-REC.                                      
                                                                                
           IF WS-RETURN = 'EID'                                                 
              DISPLAY 'ERROR IN DATE ' WS-IN-DATE.                              
                                                                                
       951-EXIT.                                                                
           EXIT.                                                                
                                                                                
       960-PARSE-STRING.                                                        
      *--------------------------------------------------------------           
           MOVE SPACES                    TO   WS-PARSED-STRING.                
           MOVE 1                         TO   WS-CUR-POS-PS.                   
           ADD  1                         TO   WS-STRING-LENGTH.                
           PERFORM 965-GET-CHAR           THRU 965-EXIT                         
              VARYING WS-CUR-POS-SP FROM 1 BY 1                                 
              UNTIL WS-CUR-POS-SP = WS-STRING-LENGTH.                           
                                                                                
                                                                                
       960-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *---------------------------------------------------------------          
       965-GET-CHAR.                                                            
      *---------------------------------------------------------------          
           IF WS-STRING-TO-PARSE(WS-CUR-POS-SP:1) NOT = SPACES                  
              IF WS-SPACE-FLAG = 'Y' AND                                        
                 WS-INSERT-SPACE-FLAG = 'Y' AND                                 
                 WS-PARSED-STRING NOT = SPACES                                  
                 MOVE ' ' TO WS-PARSED-STRING(WS-CUR-POS-PS:1)                  
                 ADD 1           TO  WS-CUR-POS-PS                              
              END-IF                                                            
              MOVE WS-STRING-TO-PARSE(WS-CUR-POS-SP:1)                          
                              TO  WS-PARSED-STRING(WS-CUR-POS-PS:1)             
              ADD 1           TO  WS-CUR-POS-PS                                 
              MOVE    'N'      TO WS-SPACE-FLAG                                 
           ELSE                                                                 
              MOVE 'Y'     TO WS-SPACE-FLAG                                     
           END-IF.                                                              
                                                                                
       965-EXIT.                                                                
           EXIT.                                                                
                                                                                
       999-CLOSE-FILES.                                                         
      *-------------------------------------------------------------            
           CLOSE BP13F205                                                       
                 BP13K222                                                       
                 BP13K060                                                       
                 BP13K800                                                       
                 BP13K246                                                       
                 BP13L24K                                                       
                 P13L24KA.                                                      
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'FILE BP13K800  CLOSE ERROR ' WS-K800-STATUS.             
           IF WS-K222-STATUS NOT = 00 AND 97                                    
              DISPLAY 'FILE BP13K222  CLOSE ERROR ' WS-K222-STATUS.             
           IF WS-K060-STATUS NOT = 00 AND 97                                    
              DISPLAY 'FILE BP13K060  CLOSE ERROR ' WS-K060-STATUS.             
           IF WS-K246-STATUS NOT = 00 AND 97                                    
              DISPLAY 'FILE BP13K246  CLOSE ERROR ' WS-K246-STATUS.             
                                                                                
           CALL 'CP13K813'         USING WS-RETURN-CODE.                        
           IF WS-RETURN-CODE NOT = ZEROS AND 97                                 
              DISPLAY 'ERROR CLOSING BP13K813 - ' WS-RETURN-CODE                
              MOVE WS-RETURN-CODE TO RETURN-CODE                                
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
