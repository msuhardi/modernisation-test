      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID.    BP13C36D.                                                 
      *AUTHOR.        ALWYN BENNY.                                              
      *DATE-WRITTEN.  05/07/2011.                                               
                                                                                
      * =========================================================== *           
      * SYSTEM OF COMMITMENT (BP13)                                 *           
      * =========================================================== *           
      *   OBJECTIVE   : THIS PROGRAM VALIDATE TRANSACTIONS PASSSED  *           
      *                 FROM PAYMENT SYSTEM TO PROCESS AMR CASE     *           
      *                                                             *           
      *   INPUT FILES :                                             *           
      *   3.  AG07F225 -- VOUCHER TRANSACTION FILE                  *           
      *                                                             *           
      *   OUTPUT FILES:                                             *           
      *   1.  BP13K350                                                          
      *   2.  BP13K352                                                          
      *   3.  BP13L36D -- CONTROL LISTING                           *           
      *                                                             *           
      * REF      DATE      BY   DESCRIPTIONS                        *           
      * -------  --------  ---- ------------                        *           
      * BP134276 04/07/11  AB9  NEW PROGRAM.                        *           
      * BP134302 25/08/11  AB9  INCLUDE 'T' FOR CDE-PRINT.          *           
      * BP134355 09/03/11  AB9  REMOVE WRITING TO KIV FILE.         *           
      * BP134873 04/07/13  ESD1 ADD CHECKING OF NUMERIC VALUES      *           
      * =========================================================== *           
                                                                                
      *------------------------*                                                
       ENVIRONMENT DIVISION.                                                    
      *------------------------*                                                
       CONFIGURATION SECTION.                                                   
      *------------------------*                                                
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
      *------------------------*                                                
       INPUT-OUTPUT SECTION.                                                    
      *------------------------*                                                
       FILE-CONTROL.                                                            
      *------------------------*                                                
                                                                                
                                                                                
           SELECT BP13K350 ASSIGN         TO BP13K350                           
                           ACCESS MODE       IS RANDOM                          
                           ORGANIZATION      IS INDEXED                         
                           RECORD KEY        IS K350-KEY-FLD                    
                           FILE STATUS       IS BP13K350-STATUS.                
                                                                                
           SELECT BP13K352 ASSIGN         TO BP13K352                           
                           ACCESS MODE       IS RANDOM                          
                           ORGANIZATION      IS INDEXED                         
                           RECORD KEY        IS K352-KEY-FLD                    
                           FILE STATUS       IS BP13K352-STATUS.                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS BP13K800-STATUS.                   
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-KEY-FLD                       
                            FILE STATUS   IS BM06K110-STATUS.                   
                                                                                
           SELECT AG07F225 ASSIGN TO AG07F225.                                  
                                                                                
           SELECT BP13F365 ASSIGN TO BP13F365.                                  
           SELECT BP13L36D ASSIGN TO BP13L36D.                                  
                                                                                
                                                                                
      *------------------------*                                                
       DATA DIVISION.                                                           
      *------------------------*                                                
       FILE SECTION.                                                            
      *------------------------*                                                
                                                                                
                                                                                
       FD   AG07F225                                                    00150000
            BLOCK CONTAINS   0  RECORDS                                         
            RECORD CONTAINS 600  CHARACTERS                                     
            LABEL RECORD IS STANDARD                                            
            RECORDING MODE IS F.                                                
       COPY AG07F225.                                                   00150000
                                                                                
       FD  BP13K350                                                             
           RECORD CONTAINS 600 CHARACTERS.                                      
       COPY BP13K350.                                                           
                                                                                
       FD  BP13K352                                                             
           RECORD CONTAINS 600 CHARACTERS.                                      
       COPY BP13K352.                                                           
                                                                                
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD BP13F365                                                              
            RECORD CONTAINS  160  CHARACTERS                                    
            LABEL RECORD IS STANDARD                                            
            RECORDING MODE IS F.                                                
       COPY BP13F365.                                                   00150000
                                                                                
       FD  BP13L36D                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F.                                                 
       01  PRINT-REC                 PIC X(132).                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-VARIABLES.                                                        
           05  WS-COUNT-HISTORY           PIC 9(3)       VALUE ZEROS.           
           05  WS-CDE-ERROR               PIC X          VALUE SPACES.          
                                                                                
       01  WS-LINE-CNT                    PIC 99         VALUE 66.              
       01  WS-PAGE-CNT                    PIC 9(5)       VALUE ZERO.            
       01  CNT-KIV-CASES                  PIC 9(4)       VALUE ZERO.            
       01  WS-AMT-KIV-TOTAL               PIC 9(6)V99    VALUE ZEROES.          
       01  WS-DTE-CUR.                                                          
           05  WS-CC                      PIC 99.                               
           05  WS-YY                      PIC 99.                               
           05  WS-MM                      PIC 99.                               
           05  WS-DD                      PIC 99.                               
                                                                                
       01  WS-TRANS-DATE.                                                       
           05  WS-TRANS-YYYY              PIC 9(4).                             
           05  WS-TRANS-MM                PIC 9(2).                             
           05  WS-TRANS-DD                PIC 9(2).                             
                                                                                
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  BP13K350-STATUS            PIC 9(2)       VALUE ZEROES.          
           05  BP13K352-STATUS            PIC 9(2)       VALUE ZEROES.          
           05  BP13K800-STATUS            PIC 9(2)       VALUE ZEROES.          
           05  BM06K110-STATUS            PIC 9(2)       VALUE ZEROES.          
           05  BP13K140-STATUS            PIC 9(2)       VALUE ZEROES.          
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-K350-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K352-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-F365-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K140-WRITE              PIC 9(5)       VALUE ZEROES.          
           05  WS-K350-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K352-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K800-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K110-READ               PIC 9(5)       VALUE ZEROES.          
           05  WS-K800-NOTFD              PIC 9(5)       VALUE ZEROES.          
           05  WS-K110-NOTFD              PIC 9(5)       VALUE ZEROES.          
           05  WS-CNT-F225-READ           PIC 9(5)       VALUE ZEROES.          
           05  WS-CNT-HIST                PIC 9(2)       VALUE ZEROES.          
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-F225-EOF                PIC X          VALUE 'N'.             
           05  WS-K350-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K352-WRITTEN            PIC X          VALUE SPACE.           
           05  WS-K800-REC-FND            PIC X          VALUE SPACES.          
           05  WS-K110-REC-FND            PIC X          VALUE SPACES.          
           05  WS-K350-FOUND              PIC X          VALUE 'N'.             
           05  WS-K352-FOUND              PIC X          VALUE 'N'.             
           05  WS-K140-TAG                PIC X          VALUE 'N'.             
                                                                                
       01  WS-SCH-TAG                     PIC X          VALUE 'N'.             
       01  WS-TOTAL-AMT            PIC S9(7)V99 VALUE +0.                       
       01  WS-DIFF                 PIC S9(7)V9(2)  VALUE +0.                    
                                                                                
       01  WS-SCHEDULE-NO.                                                      
           05  WS-SCHEDULE-NUM     PIC X(8).                                    
           05  WS-DOC-NO           PIC X(6).                                    
                                                                                
       01  L36D-PR-HEAD-01.                                                     
           05  FILLER              PIC X(8)      VALUE 'BP13L36D'.              
           05  FILLER              PIC X(7)      VALUE SPACES .                 
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(26)     VALUE SPACES.                  
           05  FILLER              PIC X(39)     VALUE                          
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(6)      VALUE 'DATE: '.                
           05  13S1-DATE           PIC X(10).                                   
           05  FILLER              PIC X(1)      VALUE SPACES.                  
           05  FILLER              PIC X(6)      VALUE 'PAGE :'.                
           05  13S1-PAGE           PIC ZZ9 .                                    
           05  FILLER              PIC X(5)      VALUE SPACES.                  
                                                                                
       01  L36D-PR-HEAD-02.                                                     
           05  FILLER              PIC X(40)     VALUE SPACES .                 
           05  FILLER              PIC X(40)     VALUE                          
               '  ERROR LIST OF TRANSACTIONS PASSED FROM'.                      
           05  FILLER              PIC X(13)     VALUE                          
                                                 ' VOUCHER FILE'.               
           05  FILLER              PIC X(40)     VALUE SPACES.                  
                                                                                
       01  L36D-PR-HEAD-03.                                                     
           05  FILLER              PIC X(27)                                    
                  VALUE ' S/NO REGN NO   SCH ACC    '.                          
           05  FILLER              PIC X(34)                                    
                  VALUE ' AMOUNT    FLAT TYPE    RECEIPT NO'.                   
           05  FILLER              PIC X(28)                                    
                  VALUE '    TRANS DATE  SALES MODE'.                           
           05  FILLER              PIC X(21)                                    
                  VALUE ' PAY-TYPE  REMARK'.                                    
           05  FILLER              PIC X(22)     VALUE SPACES.                  
                                                                                
       01  L36D-PR-DETAILS.                                                     
           05  FILLER              PIC X(01)     VALUE SPACES .                 
           05  13S1-SNO            PIC ZZZZ9.                                   
           05  FILLER              PIC X(01)     VALUE SPACES .                 
           05  13S1-REG-NO         PIC X(08).                                   
           05  FILLER              PIC X(01)     VALUE SPACES .                 
           05  13S1-SCH-ACC        PIC X(11)     VALUE SPACES.                  
           05  FILLER              PIC X(01)     VALUE SPACES .                 
           05  13S1-AMT            PIC $$$$$$$9.99DB.                           
           05  FILLER              PIC X(01)     VALUE SPACES .                 
           05  13S1-FLAT-TYP       PIC X(02).                                   
           05  FILLER              PIC X(02)     VALUE SPACES .                 
           05  13S1-DRCR           PIC X(01).                                   
           05  FILLER              PIC X(04)     VALUE SPACES .                 
           05  13S1-NUM-RECEIPT    PIC X(14) .                                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  13S1-DTE-TRANS      PIC X(08) .                                  
           05  FILLER              PIC X(05)     VALUE SPACES .                 
           05  13S1-SALES-MODE     PIC X(03).                                   
           05  FILLER              PIC X(07)     VALUE SPACES .                 
           05  13S1-PAY-TYPE       PIC X(03).                                   
           05  FILLER              PIC X(04)     VALUE SPACES .                 
           05  13S1-REMARK         PIC X(37).                                   
                                                                                
       01  L36D-CONTROL-LINE.                                                   
           05  FILLER              PIC X(20)     VALUE  SPACES.                 
           05  CNTL-ITEM           PIC X(30)     VALUE  SPACES.                 
           05  CNTL-CNT            PIC ZZZZ9 .                                  
           05  FILLER              PIC X(58)     VALUE  SPACES.                 
                                                                                
                                                                                
      *-------------------------------------------------------------            
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
                                                                                
      *-------------------------------------------------------------            
       000-MAIN-ROUTINE.                                                        
      *-------------------------------------------------------------            
           PERFORM 100-OPEN-FILES       THRU 100-EXIT.                          
           PERFORM 200-READ-AG07F225    THRU 200-EXIT.                          
           PERFORM 300-VALIDATE-VOUCHER THRU 300-EXIT                           
                   UNTIL WS-F225-EOF = 'Y'.                                     
           PERFORM 999-CLOSE-FILES      THRU 999-EXIT.                          
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       100-OPEN-FILES.                                                          
      *-------------------------------------------------------------            
           OPEN   INPUT  AG07F225                                               
                         BP13K800                                               
                         BM06K110                                               
                  I-O    BP13K350                                               
                         BP13K352                                               
                  OUTPUT BP13F365                                               
                         BP13L36D.                                              
                                                                                
           IF BP13K350-STATUS NOT = 0   AND  97                                 
               DISPLAY 'ERROR OPENING - BP13K350 : ' BP13K350-STATUS            
               MOVE BP13K350-STATUS TO RETURN-CODE                              
               PERFORM 999-CLOSE-FILES THRU 999-EXIT.                           
                                                                                
           IF BP13K352-STATUS NOT = 0   AND  97                                 
               DISPLAY 'ERROR OPENING - BP13K352 : ' BP13K352-STATUS            
               MOVE BP13K352-STATUS TO RETURN-CODE                              
               PERFORM 999-CLOSE-FILES THRU 999-EXIT.                           
                                                                                
           IF BP13K800-STATUS NOT = ZEROS   AND  97                             
               DISPLAY 'ERROR OPENING - BP13K800 : ' BP13K800-STATUS            
               MOVE BP13K800-STATUS TO RETURN-CODE                              
               PERFORM 999-CLOSE-FILES THRU 999-EXIT.                           
                                                                                
           IF BM06K110-STATUS NOT = ZEROS   AND  97                             
               DISPLAY 'ERROR OPENING - BM06K110 : ' BM06K110-STATUS            
               MOVE BM06K110-STATUS TO RETURN-CODE                              
               PERFORM 999-CLOSE-FILES THRU 999-EXIT.                           
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-DTE-CUR.                            
           STRING WS-DTE-CUR(7:2) '/' WS-DTE-CUR(5:2) '/'               )       
                  WS-DTE-CUR(1:4)                                               
           DELIMITED BY SIZE INTO 13S1-DATE.                                    
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       200-READ-AG07F225.                                                       
      *-------------------------------------------------------------            
           READ AG07F225                                                        
                AT END                                                          
                MOVE HIGH-VALUES TO  AG07F225-HEADER                            
                MOVE 'Y' TO  WS-F225-EOF                                        
                GO TO 200-EXIT.                                                 
           ADD 1 TO WS-CNT-F225-READ.                                           
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      **********************************************************                
      *              VALIDATE TRANSACTION  CASES               *                
      *                                                        *                
      * IF FOUND, WRITE VOUCHER TARNS ELSE WRITE KIV FILE      *                
      **********************************************************                
      *-------------------------------------------------------------            
       300-VALIDATE-VOUCHER.                                                    
      *-------------------------------------------------------------            
           MOVE 'N'   TO WS-K350-FOUND WS-K352-FOUND.                           
                                                                                
           MOVE ZEROS TO WS-DIFF  WS-TOTAL-AMT.                                 
           PERFORM 310-READ-K350          THRU 310-EXIT.                        
           IF (WS-K350-FOUND = 'Y') OR                                          
              (WS-K352-FOUND = 'Y')                                             
              PERFORM 320-UPDATE-K350-K352     THRU    320-EXIT                 
           END-IF.                                                              
           IF (WS-K350-FOUND = 'N') AND (WS-K352-FOUND = 'N')                   
              MOVE 'R'              TO WS-CDE-ERROR                             
           END-IF.                                                              
           IF ((WS-K350-FOUND = 'N') AND (WS-K352-FOUND = 'N')) OR              
              (WS-K140-TAG   = 'Y')                                             
              PERFORM 800-ERROR-LIST           THRU    800-EXIT                 
           END-IF.                                                              
           PERFORM  200-READ-AG07F225          THRU    200-EXIT.                
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       310-READ-K350.                                                           
      *-------------------------------------------------------------            
                                                                                
                MOVE F225-NUM-DDD-FILE-REF(1:8)   TO K350-NUM-REGN              
                                      K800-NUM-REGN                             
                READ BP13K350                                                   
                EVALUATE BP13K350-STATUS                                        
                WHEN '00'                                                       
                     PERFORM 311-CHECK350-NUMERIC  THRU 311-EXIT                
                     MOVE 'Y'         TO WS-K350-FOUND                          
                     ADD 1 TO WS-K350-READ                                      
                     MOVE SPACES                 TO  K110-REC                   
                     MOVE K350-NUM-SCH-ACC       TO K110-KEY-FLD                
                     PERFORM 380-READ-K110       THRU   380-EXIT                
                     PERFORM 375-READ-K800       THRU   375-EXIT                
                WHEN '23'                                                       
                      MOVE 'N'         TO WS-K350-FOUND                         
                      PERFORM 315-READ-K352       THRU     315-EXIT             
                WHEN OTHER                                                      
                      DISPLAY 'ERROR READING - BP13K350 : '             S       
                                                   BP13K350-STATUS              
                      MOVE  BP13K350-STATUS TO RETURN-CODE                      
                      PERFORM 999-CLOSE-FILES THRU 999-EXIT                     
                END-EVALUATE.                                                   
                                                                                
       310-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       311-CHECK350-NUMERIC.                                                    
      *-------------------------------------------------------------            
             IF K350-AMT-ADV-COLLECTION NOT NUMERIC                             
                MOVE ZEROES TO K350-AMT-ADV-COLLECTION                          
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP NOT NUMERIC                             
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP                          
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP-HA2 NOT NUMERIC                         
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP-HA2                      
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP-HA3 NOT NUMERIC                         
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP-HA3                      
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP-HA4 NOT NUMERIC                         
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP-HA4                      
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP-FU1 NOT NUMERIC                         
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP-FU1                      
             END-IF.                                                            
                                                                                
             IF K350-AMT-MEDISAVE-TOPUP-FU2 NOT NUMERIC                         
                MOVE ZEROES TO K350-AMT-MEDISAVE-TOPUP-FU2                      
             END-IF.                                                            
                                                                                
             IF K350-AMT-ADV-COLLECTION-TOPUP NOT NUMERIC                       
                MOVE ZEROES TO K350-AMT-ADV-COLLECTION-TOPUP                    
             END-IF.                                                            
                                                                                
             IF K350-AMT-RLEVY-HA1 NOT NUMERIC                                  
                MOVE ZEROES TO K350-AMT-RLEVY-HA1                               
             END-IF.                                                            
                                                                                
             IF K350-AMT-CONTRA-HA1 NOT NUMERIC                                 
                MOVE ZEROES TO K350-AMT-CONTRA-HA1                              
             END-IF.                                                            
                                                                                
             IF K350-AMT-RLEVY-HA2 NOT NUMERIC                                  
                MOVE ZEROES TO K350-AMT-RLEVY-HA2                               
             END-IF.                                                            
                                                                                
             IF K350-AMT-CONTRA-HA2 NOT NUMERIC                                 
                MOVE ZEROES TO K350-AMT-CONTRA-HA2                              
             END-IF.                                                            
                                                                                
             IF K350-AMT-BAL-SELL-PRICE NOT NUMERIC                             
                MOVE ZEROES TO K350-AMT-BAL-SELL-PRICE                          
             END-IF.                                                            
                                                                                
             IF K350-AMT-CD-PAID NOT NUMERIC                                    
                MOVE ZEROES TO K350-AMT-CD-PAID                                 
             END-IF.                                                            
                                                                                
             IF K350-AMT-REFUND-CD NOT NUMERIC                                  
                MOVE ZEROES TO K350-AMT-REFUND-CD                               
             END-IF.                                                            
                                                                                
             IF K350-AMT-REFUND-BK NOT NUMERIC                                  
                MOVE ZEROES TO K350-AMT-REFUND-BK                               
             END-IF.                                                            
                                                                                
             IF K350-AMT-REFUND-ADV-COL NOT NUMERIC                             
                MOVE ZEROES TO K350-AMT-REFUND-ADV-COL                          
             END-IF.                                                            
                                                                                
             IF K350-AMT-ADV-COLLECTION-USED NOT NUMERIC                        
                MOVE ZEROES TO K350-AMT-ADV-COLLECTION-USED                     
             END-IF.                                                            
                                                                                
       311-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       315-READ-K352.                                                           
      *-------------------------------------------------------------            
                MOVE F225-NUM-DDD-FILE-REF(1:8)   TO K352-NUM-REGN              
                                                     K800-NUM-REGN              
                READ BP13K352.                                                  
                EVALUATE BP13K352-STATUS                                        
                WHEN '00'                                                       
                     PERFORM 316-CHECK352-NUMERIC THRU 316-EXIT                 
                     MOVE 'Y'         TO WS-K352-FOUND                          
                     ADD 1 TO WS-K352-READ                                      
                     MOVE SPACES                 TO  K110-REC                   
                     MOVE K352-NUM-SCH-ACC       TO K110-KEY-FLD                
                     PERFORM 380-READ-K110       THRU   380-EXIT                
                     PERFORM 375-READ-K800       THRU   375-EXIT                
                WHEN '23'                                                       
                       MOVE 'N'         TO WS-K352-FOUND                        
                WHEN OTHER                                                      
                      DISPLAY 'ERROR READING - BP13K352 : '             S       
                                                   BP13K352-STATUS              
                      MOVE  BP13K352-STATUS TO RETURN-CODE                      
                      PERFORM 999-CLOSE-FILES THRU 999-EXIT                     
                END-EVALUATE.                                                   
                                                                                
                                                                                
       315-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       316-CHECK352-NUMERIC.                                                    
      *-------------------------------------------------------------            
             IF K352-AMT-ADV-COLLECTION NOT NUMERIC                             
                MOVE ZEROES TO K352-AMT-ADV-COLLECTION                          
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP NOT NUMERIC                             
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP                          
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP-HA2 NOT NUMERIC                         
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP-HA2                      
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP-HA3 NOT NUMERIC                         
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP-HA3                      
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP-HA4 NOT NUMERIC                         
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP-HA4                      
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP-FU1 NOT NUMERIC                         
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP-FU1                      
             END-IF.                                                            
                                                                                
             IF K352-AMT-MEDISAVE-TOPUP-FU2 NOT NUMERIC                         
                MOVE ZEROES TO K352-AMT-MEDISAVE-TOPUP-FU2                      
             END-IF.                                                            
                                                                                
             IF K352-AMT-ADV-COLLECTION-TOPUP NOT NUMERIC                       
                MOVE ZEROES TO K352-AMT-ADV-COLLECTION-TOPUP                    
             END-IF.                                                            
                                                                                
             IF K352-AMT-RLEVY-HA1 NOT NUMERIC                                  
                MOVE ZEROES TO K352-AMT-RLEVY-HA1                               
             END-IF.                                                            
                                                                                
             IF K352-AMT-CONTRA-HA1 NOT NUMERIC                                 
                MOVE ZEROES TO K352-AMT-CONTRA-HA1                              
             END-IF.                                                            
                                                                                
             IF K352-AMT-RLEVY-HA2 NOT NUMERIC                                  
                MOVE ZEROES TO K352-AMT-RLEVY-HA2                               
             END-IF.                                                            
                                                                                
             IF K352-AMT-CONTRA-HA2 NOT NUMERIC                                 
                MOVE ZEROES TO K352-AMT-CONTRA-HA2                              
             END-IF.                                                            
                                                                                
             IF K352-AMT-BAL-SELL-PRICE NOT NUMERIC                             
                MOVE ZEROES TO K352-AMT-BAL-SELL-PRICE                          
             END-IF.                                                            
                                                                                
             IF K352-AMT-CD-PAID NOT NUMERIC                                    
                MOVE ZEROES TO K352-AMT-CD-PAID                                 
             END-IF.                                                            
                                                                                
             IF K352-AMT-REFUND-CD NOT NUMERIC                                  
                MOVE ZEROES TO K352-AMT-REFUND-CD                               
             END-IF.                                                            
                                                                                
             IF K352-AMT-REFUND-BK NOT NUMERIC                                  
                MOVE ZEROES TO K352-AMT-REFUND-BK                               
             END-IF.                                                            
                                                                                
             IF K352-AMT-REFUND-ADV-COL NOT NUMERIC                             
                MOVE ZEROES TO K352-AMT-REFUND-ADV-COL                          
             END-IF.                                                            
                                                                                
             IF K352-AMT-ADV-COLLECTION-USED NOT NUMERIC                        
                MOVE ZEROES TO K352-AMT-ADV-COLLECTION-USED                     
             END-IF.                                                            
                                                                                
       316-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       320-UPDATE-K350-K352.                                                    
      *-------------------------------------------------------------            
                                                                                
              IF (F225-NUM-TRANS-TYP = 'AMR' OR 'ADP') AND                      
                 (F225-NUM-VR-TYP = 'PV' OR 'JV')                               
                 IF WS-K350-FOUND = 'Y'                                         
                    PERFORM 330-UPDATE-K350       THRU    330-EXIT              
                 ELSE                                                           
                    IF WS-K352-FOUND = 'Y'                                      
                      PERFORM 335-UPDATE-K352       THRU    335-EXIT            
                    END-IF                                                      
                 END-IF                                                         
             ELSE                                                               
                MOVE 'Y'                            TO   WS-K140-TAG            
             END-IF.                                                            
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       330-UPDATE-K350.                                                         
      *-------------------------------------------------------------            
                 IF K350-CDE-PRINT = 'J' OR 'V' OR 'T'                          
                    PERFORM 340-MOVE-VALUE-K350  THRU  340-EXIT                 
                    PERFORM 500-WRITE-BP13F365   THRU  500-EXIT                 
                 ELSE                                                           
                    MOVE 'Y'                     TO    WS-K140-TAG              
                 END-IF.                                                        
                                                                                
       330-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       335-UPDATE-K352.                                                         
      *-------------------------------------------------------------            
                                                                                
                 IF K352-CDE-PRINT = 'J' OR 'V' OR 'T'                          
                    PERFORM 345-MOVE-VALUE-K352  THRU  345-EXIT                 
                    PERFORM 500-WRITE-BP13F365   THRU  500-EXIT                 
                 ELSE                                                           
                    MOVE 'Y'                     TO    WS-K140-TAG              
                 END-IF.                                                        
       335-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       340-MOVE-VALUE-K350.                                                     
      *-------------------------------------------------------------            
                                                                                
               MOVE 'D'                 TO  K350-CDE-PRINT.                     
               MOVE WS-DTE-CUR          TO  K350-DTE-UPDATE.                    
               MOVE 'BP13C36D'          TO  K350-NUM-USERID.                    
               REWRITE BP13K350-REC                                             
               IF BP13K350-STATUS = '00'                                        
                  ADD        1     TO    WS-K350-WRITE                          
               END-IF.                                                          
                                                                                
       340-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       345-MOVE-VALUE-K352.                                                     
      *-------------------------------------------------------------            
                                                                                
               MOVE 'D'                 TO  K352-CDE-PRINT.                     
               MOVE WS-DTE-CUR          TO  K352-DTE-UPDATE.                    
               MOVE 'BP13C36D'          TO  K352-NUM-USERID.                    
               REWRITE BP13K352-REC                                             
               IF BP13K352-STATUS = '00'                                        
                  ADD        1     TO    WS-K352-WRITE                          
               END-IF.                                                          
                                                                                
       345-EXIT.                                                                
           EXIT.                                                                
      ******************************************************************        
       375-READ-K800.                                                           
      ******************************************************************        
                                                                                
              READ BP13K800                                                     
              EVALUATE BP13K800-STATUS                                          
              WHEN '00'                                                         
                    MOVE 'Y'      TO    WS-K800-REC-FND                         
                    ADD  1        TO    WS-K800-READ                            
              WHEN  '23'                                                        
                     MOVE 'N'     TO     WS-K800-REC-FND                        
                     ADD 1        TO     WS-K800-NOTFD                          
                     DISPLAY 'BP13K800-RECORD NOT FOUND  '                      
                                     K800-NUM-REGN                              
                                                                                
              WHEN  OTHER                                                       
                     MOVE 'N'     TO     WS-K800-REC-FND                        
                     MOVE  BP13K800-STATUS TO RETURN-CODE                       
                     PERFORM 999-CLOSE-FILES THRU 999-EXIT                      
              END-EVALUATE.                                                     
                                                                                
                                                                                
       375-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       380-READ-K110.                                                           
      ******************************************************************        
                                                                                
              READ BM06K110                                                     
              EVALUATE BM06K110-STATUS                                          
              WHEN '00'                                                         
                    MOVE 'Y'      TO    WS-K110-REC-FND                         
                    ADD  1        TO    WS-K110-READ                            
              WHEN  '23'                                                        
                     MOVE 'N'     TO     WS-K110-REC-FND                        
                     ADD 1        TO     WS-K110-NOTFD                          
                     DISPLAY 'BM06K110-RECORD NOT FOUND  '                      
                                     K110-REGN-NO                               
                                                                                
              WHEN  OTHER                                                       
                     MOVE 'N'     TO     WS-K110-REC-FND                        
                     MOVE  BM06K110-STATUS TO RETURN-CODE                       
                     PERFORM 999-CLOSE-FILES THRU 999-EXIT                      
              END-EVALUATE.                                                     
                                                                                
                                                                                
       380-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       500-WRITE-BP13F365.                                                      
      ******************************************************************        
                                                                                
           PERFORM 510-MOVE-VALUES-TO-F365 THRU 510-EXIT.                       
           WRITE BP13F365-REC.                                                  
           ADD 1 TO WS-F365-WRITE.                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       510-MOVE-VALUES-TO-F365.                                                 
      ******************************************************************        
                                                                                
           MOVE  SPACES                TO    BP13F365-REC.                      
           INITIALIZE                        BP13F365-REC.                      
           MOVE F225-DTE-VR-CREATE     TO    F365-DTE-TRANS.                    
      *    MOVE F630-NUM-TRANS-DR-CR   TO    F365-NUM-TRANS-DR-CR.              
           MOVE F225-NUM-VR            TO    F365-NUM-RECPT-JRNO.               
           MOVE 'D'                    TO    F365-NUM-TAX-CDE.                  
           MOVE F225-NUM-VR-TYP        TO    F365-NUM-VR-TYP.                   
           IF F225-NUM-VR-TYP = 'PV'                                            
              MOVE 'D'                 TO    F365-NUM-TRANS-DR-CR               
           END-IF.                                                              
                                                                                
           MOVE F225-NUM-DDD-FILE-REF(1:8)   TO F365-NUM-REG                    
           IF WS-K352-FOUND = 'Y'                                               
             MOVE K352-AMT-ADV-COLLECTION TO   F365-AMT-ADV-COLLECTION          
             MOVE K352-AMT-ADV-COLLECTION-USED TO                               
                        F365-AMT-ADV-COLLECTION-USED                            
             MOVE K352-AMT-REFUND-ADV-COL TO   F365-AMT-REFUND-ADV-COL          
             MOVE K352-NUM-SCH-ACC        TO   F365-NUM-HDB-REF                 
           ELSE                                                                 
           IF WS-K350-FOUND = 'Y'                                               
             MOVE K350-AMT-ADV-COLLECTION TO   F365-AMT-ADV-COLLECTION          
             MOVE K350-AMT-ADV-COLLECTION-USED TO                               
                        F365-AMT-ADV-COLLECTION-USED                            
             MOVE K350-AMT-REFUND-ADV-COL TO   F365-AMT-REFUND-ADV-COL          
             MOVE K350-NUM-SCH-ACC          TO    F365-NUM-HDB-REF              
           END-IF.                                                              
           MOVE K800-NUM-FLAT-TYPE      TO   F365-NUM-FLAT-TYPE.                
           MOVE K800-NUM-ALLO-CAT       TO   F365-NUM-SALE-MODE.                
           MOVE K110-DTE-KEY-AVAIL      TO   F365-DTE-KEY-AVAIL.                
                                                                                
       510-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       800-ERROR-LIST.                                                          
      *-------------------------------------------------------------            
           IF WS-LINE-CNT > 46                                                  
               MOVE 1 TO WS-LINE-CNT                                            
               PERFORM 900-ERROR-HEADING THRU 900-EXIT                          
           ELSE                                                                 
               ADD 1 TO WS-LINE-CNT.                                            
                                                                                
           ADD 1 TO CNT-KIV-CASES.                                              
                                                                                
           MOVE  SPACES   TO  13S1-REMARK.                                      
           IF WS-CDE-ERROR = 'R'                                                
               MOVE 'ORIG REGN NO ERROR' TO 13S1-REMARK                         
           ELSE                                                                 
           IF WS-CDE-ERROR = 'A'                                                
               MOVE 'SCHEME ACCOUNT NUMBER ERROR' TO 13S1-REMARK                
           ELSE                                                                 
               MOVE 'VOUCHER TYPE NOT JV OR PV  ' TO 13S1-REMARK.               
           MOVE  F225-NUM-DDD-FILE-REF(1:8) TO 13S1-REG-NO.                     
           MOVE  CNT-KIV-CASES         TO 13S1-SNO.                             
           MOVE  K800-NUM-ALLO-CAT     TO 13S1-SALES-MODE.                      
           MOVE  K800-NUM-FLAT-TYPE    TO 13S1-FLAT-TYP.                        
           MOVE  F225-NUM-VR           TO 13S1-NUM-RECEIPT.                     
           MOVE  F225-DTE-VR-CREATE    TO 13S1-DTE-TRANS.                       
           IF F225-NUM-TRANS-TYP = 'AMR'                                        
              MOVE 'AMR'               TO 13S1-PAY-TYPE                         
           ELSE                                                                 
             IF F225-NUM-TRANS-TYP = 'ADP'                                      
                MOVE 'ADP'               TO 13S1-PAY-TYPE                       
             ELSE                                                               
                MOVE SPACES              TO 13S1-PAY-TYPE                       
             END-IF                                                             
           END-IF.                                                              
           IF WS-K352-FOUND = 'Y'                                               
              MOVE  K352-NUM-SCH-ACC   TO 13S1-SCH-ACC                          
           ELSE                                                                 
           IF WS-K350-FOUND = 'Y'                                               
              MOVE  K350-NUM-SCH-ACC   TO 13S1-SCH-ACC                          
           END-IF.                                                              
      *    MOVE  F365-NUM-TRANS-DR-CR  TO 13S1-DRCR.                            
           WRITE PRINT-REC FROM L36D-PR-DETAILS.                                
                                                                                
       800-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       900-ERROR-HEADING.                                                       
      *-------------------------------------------------------------            
            ADD 1         TO WS-PAGE-CNT .                                      
            MOVE WS-PAGE-CNT TO 13S1-PAGE.                                      
            MOVE SPACES   TO PRINT-REC                                          
            WRITE PRINT-REC AFTER PAGE.                                         
            WRITE PRINT-REC FROM L36D-PR-HEAD-01 AFTER 2.                       
            WRITE PRINT-REC FROM L36D-PR-HEAD-02 AFTER 3.                       
            WRITE PRINT-REC FROM L36D-PR-HEAD-03 AFTER 3.                       
            MOVE ALL '-'  TO PRINT-REC.                                         
            WRITE PRINT-REC .                                                   
            MOVE SPACES   TO PRINT-REC.                                         
            WRITE PRINT-REC AFTER 1.                                            
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       999-CLOSE-FILES.                                                         
      *-------------------------------------------------------------            
           DISPLAY '******  BP13C36D *************'.                            
           DISPLAY 'NO OF F225 READ      (F225) : ' WS-CNT-F225-READ.           
           DISPLAY 'NO OF K350 READ      (K350) : ' WS-K350-READ.               
           DISPLAY 'NO OF K352 READ      (K352) : ' WS-K352-READ.               
           DISPLAY 'NO OF K800 READ      (K800) : ' WS-K800-READ.               
           DISPLAY 'NO OF K350 WRITE     (K350) : ' WS-K350-WRITE.              
           DISPLAY 'NO OF K352 WRITE     (K352) : ' WS-K352-WRITE.              
           DISPLAY 'NO OF F365 WRITE     (F365) : ' WS-F365-WRITE.              
                                                                                
           CLOSE BP13K350                                                       
                 BP13K352                                                       
                 AG07F225                                                       
                 BP13K800                                                       
                 BM06K110                                                       
                 BP13F365                                                       
                 BP13L36D.                                                      
                                                                                
           IF BP13K350-STATUS NOT = 0 AND 97                                    
            DISPLAY ' CLOSING ERROR, BP13K350-STATUS ' BP13K350-STATUS          
            MOVE BP13K350-STATUS TO RETURN-CODE.                                
                                                                                
           IF BP13K352-STATUS NOT = 0 AND 97                                    
            DISPLAY ' CLOSING ERROR, BP13K352-STATUS ' BP13K352-STATUS          
            MOVE BP13K352-STATUS TO RETURN-CODE.                                
                                                                                
           IF BP13K800-STATUS NOT = 0 AND 97                                    
            DISPLAY ' CLOSING ERROR, BP13K800-STATUS ' BP13K800-STATUS          
            MOVE BP13K800-STATUS TO RETURN-CODE.                                
                                                                                
           IF BM06K110-STATUS NOT = 0 AND 97                                    
            DISPLAY ' CLOSING ERROR, BM06K110-STATUS ' BM06K110-STATUS          
            MOVE BM06K110-STATUS TO RETURN-CODE.                                
                                                                                
           STOP RUN.                                                            
                                                                                
       999-EXIT.                                                                
            EXIT.                                                               
