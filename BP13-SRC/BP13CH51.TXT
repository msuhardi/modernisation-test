       IDENTIFICATION DIVISION.                                         00010003
       PROGRAM-ID.    BP13CH51.                                         00020003
       AUTHOR.        RJB1.                                             00030003
      *DATE-WRITTEN.  12/05/2015.                                       00040003
      * ===============================================================*00050003
      * BP13 SYSTEM OF COMMITMENT                                      *00060003
      * ===============================================================*00070003
      *                                                                *00080003
      * CONDITIONS:                                                    *00090003
      *             - THOSE WHO BOOKED STUDIO APT (SA) I.E DESIGN TYPE *00100003
      *               = 89 OR 80 AND (K800-NUM-IDP-SCHEME = 'SA ' AND  *00110003
      *               K800-NUM-FLAT-TYPE = '1A'  OR '2A')              *00120003
      *             - NRICS OF APPLICANTS/OCCUPIERS FOUND IN PPOS (BR10)00130003
      *               TAKE NRIC OF HAS AND OCCUPIERS TO READ IN BR10K01000140003
      *               FOR K010-CDE-PPTY-TYPE = R. FOUND, FLAG OUT.     *00150003
      *                                                                *00160003
      *   INPUT FILES :  1. BM06F100                                   *00170003
      *                  2. BM06K110                                   *00180003
      *                  3. BP13K800                                   *00190003
      *                  4. BP13K820                                   *00200003
      *                  5. BP13K022                                   *00210003
      *                  6. BP13K024                                   *00220003
      *                  7. BR10K010                                   *00230003
      *                                                                *00240003
      *   OUTPUT      :  1. BP13LH51                                   *00250003
      *                  2. P13LH51A                                   *00260003
      *                                                                *00270003
      *   CHGE-NO   BY     DATE    DESCRIPTION                         *00280003
      *   -------   ---   ------   ------------------------------------*00290003
      *   BP135711  RJB1  12/05/15 NEW PROGRAM                         *00300003
      *   BP135711  RJB1  04/06/15 TO CALL BP13CCNT TO GET EMAIL ADDR  *00310003
      *   BP135711  RJB1  11/08/15 TO CATER FOR NO RECORDS             *00320003
      *   BP136082  PCL4  13/01/16 TO UPDATE EMAIL RECIPIENTS          *00330003
      *   BP136477  RJB1  18/10/16 TO REPLACE KIM HUAT TO YEE MIEN     *00340003
      *   BP136851  PCL4  20/06/17 TO UPDATE EMAIL RECIPIENTS          *00350003
      *   BP138757  KV8   16/06/21 REMOVED LAU ADDED GAN               *00351003
      *   BP139030  ZAR7  07/01/22 REPLACE CHUA YEE MIEN TO LIM KOK CHUN00352003
      *   BP139608  KAR1  25/11/23 REPLACE lim kok chun TO zany liaw    00353003
      *                            REPLACE bernice with janice          00354003
      *   BP139276  KAC1  05/04/24 REPLACE LIM KOK CHUN BY          *   00355004
      *                                    KATHIJAH_BEE_ALI_MOHAMED *   00356004
      *   BP139175  KAC1  25/04/24 REPLACE kATHIJAH_BEE_ALI_MOHAMED by *00357004
      *                            Soffia RAPHAY (HDB)                 *00358004
      *================================================================*00360003
                                                                        00370003
      **********************                                            00380003
       ENVIRONMENT DIVISION.                                            00390003
      **********************                                            00400003
                                                                        00410003
       CONFIGURATION SECTION.                                           00420003
       SOURCE-COMPUTER. IBM-3090.                                       00430003
       OBJECT-COMPUTER. IBM-3090.                                       00440003
                                                                        00450003
       INPUT-OUTPUT SECTION.                                            00460003
       FILE-CONTROL.                                                    00470003
                                                                        00480003
           SELECT BP13K800  ASSIGN        TO BP13K800                   00490003
                            ACCESS MODE      IS RANDOM                  00500003
                            ORGANIZATION     IS INDEXED                 00510003
                            RECORD KEY       IS K800-NUM-REGN           00520003
                            FILE STATUS      IS WS-K800-STATUS.         00530003
                                                                        00540003
           SELECT BP13K820  ASSIGN        TO BP13K820                   00550003
                            ACCESS MODE      IS DYNAMIC                 00560003
                            ORGANIZATION     IS INDEXED                 00570003
                            RECORD KEY       IS K820-KEY-FLD            00580003
                            FILE STATUS      IS WS-K820-STATUS.         00590003
                                                                        00600003
           SELECT BP13K022  ASSIGN        TO BP13K022                   00610003
                            ACCESS MODE      IS DYNAMIC                 00620003
                            ORGANIZATION     IS INDEXED                 00630003
                            RECORD KEY       IS K022-KEY-FLD            00640003
                            ALTERNATE KEY    IS K022-NUM-REGN           00650003
                            FILE STATUS      IS WS-K022-STATUS.         00660003
                                                                        00670003
           SELECT BP13K024  ASSIGN        TO BP13K024                   00680003
                            ACCESS MODE      IS DYNAMIC                 00690003
                            ORGANIZATION     IS INDEXED                 00700003
                            RECORD KEY       IS K024-KEY-FLD            00710003
                            FILE STATUS      IS WS-K024-STATUS.         00720003
                                                                        00730003
           SELECT BM06K110  ASSIGN        TO BM06K110                   00740003
                            ACCESS MODE      IS DYNAMIC                 00750003
                            ORGANIZATION     IS INDEXED                 00760003
                            RECORD KEY       IS K110-KEY-FLD            00770003
                            ALTERNATE KEY    IS K110-AIX1               00780003
                                             WITH DUPLICATES            00790003
                            FILE STATUS      IS WS-K110-STATUS.         00800003
                                                                        00810003
           SELECT BR10K010  ASSIGN        TO BR10K010                   00820003
                            ACCESS MODE      IS DYNAMIC                 00830003
                            ORGANIZATION     IS INDEXED                 00840003
                            RECORD KEY       IS K010-KEY-FLD            00850003
                            FILE STATUS      IS WS-K010-STATUS.         00860003
                                                                        00870003
           SELECT BM06F100  ASSIGN        TO BM06F100.                  00880003
           SELECT BP13LH51  ASSIGN        TO BP13LH51.                  00890003
           SELECT P13LH51A  ASSIGN        TO P13LH51A.                  00900003
                                                                        00910003
      ****************                                                  00920003
       DATA DIVISION.                                                   00930003
      ****************                                                  00940003
                                                                        00950003
       FILE SECTION.                                                    00960003
      *-------------------------------------------------------------    00970003
       FD  BP13LH51                                                     00980003
           RECORDING MODE IS F                                          00990003
           RECORD CONTAINS 132 CHARACTERS.                              01000003
       01  BP13LH51-REC        PIC X(132).                              01010003
                                                                        01020003
       FD  P13LH51A                                                     01030003
           RECORDING MODE IS F                                          01040003
           RECORD CONTAINS 132 CHARACTERS.                              01050003
       01  P13LH51A-REC        PIC X(132).                              01060003
                                                                        01070003
       FD  BP13K800                                                     01080003
           RECORD CONTAINS 2000 CHARACTERS.                             01090003
       COPY BP13K800.                                                   01100003
                                                                        01110003
       FD  BP13K820                                                     01120003
           RECORD CONTAINS 400 CHARACTERS.                              01130003
       COPY BP13K820.                                                   01140003
                                                                        01150003
       FD  BM06K110                                                     01160003
           RECORD CONTAINS 500 CHARACTERS.                              01170003
       COPY BM06K110.                                                   01180003
                                                                        01190003
       FD  BM06F100                                                     01200003
           RECORDING MODE IS F                                          01210003
           RECORD CONTAINS 500 CHARACTERS.                              01220003
       COPY BM06F100.                                                   01230003
                                                                        01240003
       FD  BP13K022                                                     01250003
           RECORD CONTAINS 100 CHARACTERS.                              01260003
       COPY BP13K022.                                                   01270003
                                                                        01280003
       FD  BP13K024                                                     01290003
           RECORD CONTAINS 100 CHARACTERS.                              01300003
       COPY BP13K024.                                                   01310003
                                                                        01320003
       FD  BR10K010                                                     01330003
           RECORD CONTAINS 300 CHARACTERS.                              01340003
       COPY BR10K010.                                                   01350003
                                                                        01360003
       WORKING-STORAGE SECTION.                                         01370003
      *-------------------------------------------------------------    01380003
                                                                        01390003
       01  WS-CUR-DATE.                                                 01400003
           05  WS-CUR-CCYY             PIC 9(04).                       01410003
           05  WS-CUR-MM               PIC 9(02).                       01420003
           05  WS-CUR-DD               PIC 9(02).                       01430003
                                                                        01440003
       01  WS-REPORT-DATE.                                              01450003
           05  WS-REP-CCYY             PIC X(04).                       01460003
           05  WS-REP-MM               PIC X(02).                       01470003
                                                                        01480003
       01  WS-COUNT.                                                    01490003
           05  WS-F100-INPUT           PIC 9(08) VALUE 0.               01500003
           05  WS-LH51-OUT             PIC 9(08) VALUE 0.               01510003
           05  WS-LH51A-OUT            PIC 9(08) VALUE 0.               01520003
           05  WS-F100-OUT             PIC 9(08) VALUE 0.               01530003
           05  WS-WRITTEN              PIC 9(08) VALUE 0.               01540003
                                                                        01550003
       01  WS-TIME                     PIC 9(08) VALUE 0.               01560003
       01  WS-F100-EOF                 PIC X(01) VALUE SPACES.          01570003
       01  WS-K110-EOF                 PIC X(01) VALUE SPACES.          01580003
       01  WS-K010-EOF                 PIC X(01) VALUE SPACES.          01590003
       01  WS-K820-EOF                 PIC X(01) VALUE SPACES.          01600003
       01  WS-FOUND-K010               PIC X(01) VALUE 'N'.             01610003
       01  WS-FOUND-K800               PIC X(01) VALUE 'N'.             01620003
       01  WS-FOUND-K110               PIC X(01) VALUE 'N'.             01630003
       01  WS-FOUND-K022               PIC X(01) VALUE 'N'.             01640003
       01  WS-PRINTED                  PIC X(01) VALUE 'N'.             01650003
       01  WS-NIL-SW                   PIC X(01) VALUE SPACE.           01660003
       01  WS-BLANK-LINE               PIC X(132) VALUE SPACES.         01670003
       01  WS-FILE-STATUS.                                              01680003
           05 WS-K800-STATUS           PIC 99    VALUE ZEROS.           01690003
           05 WS-K820-STATUS           PIC 99    VALUE ZEROS.           01700003
           05 WS-K022-STATUS           PIC 99    VALUE ZEROS.           01710003
           05 WS-K024-STATUS           PIC 99    VALUE ZEROS.           01720003
           05 WS-K110-STATUS           PIC 99    VALUE ZEROS.           01730003
           05 WS-K010-STATUS           PIC 99    VALUE ZEROS.           01740003
                                                                        01750003
       01  WS-VARIABLES.                                                01760003
           05 WS-OIC                   PIC X(5)  VALUE SPACES.          01770003
           05 WS-OIC-NME               PIC X(30) VALUE SPACES.          01780003
           05 WS-EMAIL                 PIC X(50) VALUE SPACES.          01790003
           05 WS-SAVE-KEY              PIC X(16) VALUE SPACES.          01800003
           05  WS-DTE-SYS-VALID.                                        01810003
              10 WS-YY-SYS-VALID       PIC 9(4)  VALUE ZEROES.          01820003
              10 WS-MM-SYS-VALID       PIC 9(2)  VALUE ZEROES.          01830003
              10 WS-DD-SYS-VALID       PIC 9(2)  VALUE ZEROES.          01840003
           05 WS-DESIGN-TYPE           PIC X(02).                       01850003
              88 STUDIO-APT                      VALUE '80', '89'.      01860003
           05 WS-IDP-SCHEME            PIC X(03).                       01870003
              88 VALID-IDP                       VALUE 'SA '.           01880003
           05 WS-FLAT-TYPE             PIC X(02).                       01890003
              88 VALID-FT                        VALUE '1A', '2A'.      01900003
                                                                        01910003
                                                                        01920003
      *-------------------------------------------------------------    01930003
      * LAYOUT BP13MAIL  -  DATASET FOR EMAIL                           01940003
      *-------------------------------------------------------------    01950003
       01  MAIL-HDR1.                                                   01960003
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.         01970003
           05  FILLER          PIC X(68)  VALUE SPACES.                 01980003
                                                                        01990003
       01  MAIL-HDR2.                                                   02000003
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.          02010003
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                 02020003
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.            02030003
           05  FILLER          PIC X(56)  VALUE SPACES.                 02040003
                                                                        02050003
       01  MAIL-DTL1A.                                                  02060003
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            02070003
           05  FILLER          PIC X(60)  VALUE                         02080003
      *        'LAU_HONG_HUAT@HDB.GOV.SG>'.                             02090003
      *        'BERNICE_JH_GAN@HDB.GOV.SG>'.                            02100003
      *        'Janice_ML_OH@hdb.gov.sg>'.                              02101005
               'Iris_LL_KOR@hdb.gov.sg>'.                               02102005
                                                                        02110003
       01  MAIL-DTL1B.                                                  02120003
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.            02130003
           05  FILLER          PIC X(60)  VALUE                         02140003
      *        'LIM_Kok_Chun@hdb.gov.sg>'.                              02150003
               'Soffia_RAPHAY@hdb.gov.sg>'.                             02151005
                                                                        02160003
       01  MAIL-DTL3.                                                   02170003
           05  FILLER          PIC X(04)  VALUE 'DATA'.                 02180003
           05  FILLER          PIC X(76)  VALUE SPACES.                 02190003
                                                                        02200003
       01  MAIL-DTL4.                                                   02210003
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                02220003
           05  MAIL-SENDMAILID PIC X(26)  VALUE                         02230003
               'SOC System - Email Alert'.                              02240003
           05  FILLER          PIC X(49)  VALUE SPACES.                 02250003
                                                                        02260003
       01  MAIL-DTL5A.                                                  02270003
           05  FILLER          PIC X(4)   VALUE 'TO:<'.                 02280003
           05  FILLER          PIC X(60)  VALUE                         02290003
      *        'LAU_HONG_HUAT@HDB.GOV.SG>'.                             02300003
      *        'BERNICE_JH_GAN@HDB.GOV.SG>'.                            02310003
      *        'Janice_ML_OH@hdb.gov.sg>'.                              02311005
               'Iris_LL_KOR@hdb.gov.sg>'.                               02312005
                                                                        02320003
       01  MAIL-DTL5B.                                                  02330003
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                 02340003
           05  FILLER          PIC X(60)  VALUE                         02350003
      *        'LIM_Kok_Chun@hdb.gov.sg>'.                              02360003
               'Soffia_RAPHAY@hdb.gov.sg>'.                             02361005
                                                                        02370003
       01  MAIL-DTL7.                                                   02380003
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.           02390003
           05  FILLER          PIC X(14)  VALUE 'Submission of '.       02400003
           05  FILLER          PIC X(21)  VALUE 'PPO Disposal/Transfer'.02410003
           05  FILLER          PIC X(21)  VALUE ' Documents for Studio'.02420003
           05  FILLER          PIC X(21)  VALUE ' Apt Cases (PCD updat'.02430003
           05  FILLER          PIC X(12)  VALUE 'ed to month)'.         02440003
                                                                        02450003
       01  MAIL-DTL8.                                                   02460003
           05 FILLER                   PIC X(6)   VALUE 'DATE: '.       02470003
           05 MAIL-DATE                PIC X(10)  VALUE SPACES.         02480003
                                                                        02490003
       01  MAIL-FOOTER.                                                 02500003
           05 FILLER                   PIC X(40)  VALUE                 02510003
              'Please remind applicants to submit trans'.               02520003
           05 FILLER                   PIC X(40)  VALUE                 02530003
              'fer documents before keys collection.   '.               02540003
                                                                        02550003
       01  MAIL-END.                                                    02560003
           05 FILLER                   PIC X      VALUE '.'.            02570003
                                                                        02580003
       01  MAIL-SPACES.                                                 02590003
           05 FILLER                   PIC X(80)  VALUE SPACES.         02600003
                                                                        02610003
       01  WS-PRINT-VARIABLES.                                          02620003
           05 LH51-HDG1.                                                02630003
              10 FILLER                   PIC X(45)   VALUE SPACES.     02640003
              10 FILLER                   PIC X(22)   VALUE             02650003
                'SYSTEM  OF  COMMITMENT'.                               02660003
              10 FILLER                   PIC X(55)   VALUE SPACES.     02670003
                                                                        02680003
           05 LH51-HDG2.                                                02690003
              10 FILLER                   PIC X(26)   VALUE 'BP13LH51'. 02700003
              10 FILLER                   PIC X(49)   VALUE             02710003
                'SUBMISSION OF PPO DISPOSAL/TRANSFER DOCUMENTS FOR'.    02720003
              10 FILLER                   PIC X(17)   VALUE             02730003
                ' STUDIO APT CASES'.                                    02740003
              10 FILLER                   PIC X(11)   VALUE SPACES.     02750003
              10 FILLER                   PIC X(07)   VALUE 'DATE : '.  02760003
              10 LH51-SYS-DATE            PIC X(10).                    02770003
                                                                        02780003
           05 LH51-HDG2A.                                               02790003
              10 FILLER                   PIC X(40)   VALUE SPACES.     02800003
              10 FILLER                   PIC X(22)   VALUE             02810003
                '(PCD UPDATED TO MONTH)'.                               02820003
                                                                        02830003
           05 LH51-HDG3.                                                02840003
              10 FILLER                   PIC X(06)   VALUE             02850003
                'S/NO. '.                                               02860003
              10 FILLER                   PIC X(05)   VALUE SPACES.     02870003
              10 FILLER                   PIC X(20)   VALUE             02880003
                'REGISTRATION NO.'.                                     02890003
              10 FILLER                   PIC X(05)   VALUE SPACES.     02900003
              10 FILLER                   PIC X(40)   VALUE             02910003
                 'PPO ADDRESS'.                                         02920003
              10 FILLER                   PIC X(05)   VALUE SPACES.     02930003
              10 FILLER                   PIC X(14)   VALUE 'OIC'.      02940003
                                                                        02950003
           05 LH51-HDG4.                                                02960003
              10 FILLER                   PIC X(06)   VALUE             02970003
                '======'.                                               02980003
              10 FILLER                   PIC X(05)   VALUE SPACES.     02990003
              10 FILLER                   PIC X(20)   VALUE             03000003
                '===================='.                                 03010003
              10 FILLER                   PIC X(05)   VALUE SPACES.     03020003
              10 FILLER                   PIC X(40)   VALUE             03030003
                '========================================'.             03040003
              10 FILLER                   PIC X(05)   VALUE SPACES.     03050003
              10 FILLER                   PIC X(40)   VALUE             03060003
                '========================================'.             03070003
                                                                        03080003
           05 LH51-DTL1.                                                03090003
              10 LH51-SNO                 PIC ZZZZZ9  VALUE ZEROES.     03100003
              10 FILLER                   PIC X(05)   VALUE SPACES.     03110003
              10 LH51-REGN                PIC X(08)   VALUE SPACES.     03120003
              10 FILLER                   PIC X(12)   VALUE SPACES.     03130003
              10 FILLER                   PIC X(05)   VALUE SPACES.     03140003
              10 LH51-ADDR                PIC X(40)   VALUE SPACES.     03150003
              10 FILLER                   PIC X(05)   VALUE SPACES.     03160003
              10 LH51-OIC                 PIC X(40)   VALUE SPACES.     03170003
                                                                        03180003
       01  LH51-NIL.                                                    03190003
           05  FILLER                     PIC X(11)   VALUE             03200003
                                          'NO RECORDS.'.                03210003
      *----------------------------------------------------------------*03220003
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                        *03230003
      *----------------------------------------------------------------*03240003
       01  WS-BP13CCNT-LINK.                                            03250003
           05  LINK-CNTCT-TYPE         PIC X(3).                        03260003
           05  LINK-STAFF-NICK         PIC X(6).                        03270003
           05  LINK-STAFF-NUM          PIC X(6).                        03280003
           05  LINK-STAFF-CNTCT        PIC X(50).                       03290003
           05  LINK-SYSERR             PIC X(4).                        03300003
                                                                        03310003
      *----------------------------------------------------------------*03320003
      *        LINKAGE FOR SUB-PROGRAM BP13C913                        *03330003
      *----------------------------------------------------------------*03340003
       01  WS-LINK-REC.                                                 03350003
           05  WS-LINK-NUM-SCH-ACC.                                     03360003
               10  WS-LINK-NUM-SCH     PIC X(4).                        03370003
               10  WS-LINK-NUM-ACC     PIC X(5).                        03380003
                                                                        03390003
       COPY P13COMM8.                                                   03400003
                                                                        03410003
                                                                        03420003
       PROCEDURE DIVISION.                                              03430003
      *=============================================================*   03440003
       MAIN.                                                            03450003
      *=============================================================*   03460003
                                                                        03470003
           PERFORM 1000-OPEN-ROUTINE    THRU 1000-EXIT.                 03480003
           PERFORM 2000-READ-INPUT      THRU 2000-EXIT.                 03490003
           PERFORM 3000-PROCESS-DATA    THRU 3000-EXIT                  03500003
           UNTIL WS-F100-EOF = 'Y'.                                     03510003
           PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                 03520003
                                                                        03530003
      *=============================================================*   03540003
       1000-OPEN-ROUTINE.                                               03550003
      *=============================================================*   03560003
                                                                        03570003
           OPEN INPUT  BM06F100                                         03580003
                       BM06K110                                         03590003
                       BP13K800                                         03600003
                       BP13K820                                         03610003
                       BP13K022                                         03620003
                       BP13K024                                         03630003
                       BR10K010                                         03640003
                OUTPUT BP13LH51                                         03650003
                       P13LH51A.                                        03660003
                                                                        03670003
           IF WS-K010-STATUS NOT = 00 AND 97                            03680003
              DISPLAY 'OPENING BR10K010 ERROR ' WS-K010-STATUS          03690003
              MOVE     WS-K010-STATUS      TO RETURN-CODE               03700003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03710003
           END-IF.                                                      03720003
                                                                        03730003
           IF WS-K110-STATUS NOT = 00 AND 97                            03740003
              DISPLAY 'OPENING BM06K110 ERROR ' WS-K110-STATUS          03750003
              MOVE     WS-K110-STATUS      TO RETURN-CODE               03760003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03770003
           END-IF.                                                      03780003
                                                                        03790003
           IF WS-K820-STATUS NOT = 00 AND 97                            03800003
              DISPLAY 'OPENING BP13K820 ERROR ' WS-K820-STATUS          03810003
              MOVE     WS-K820-STATUS      TO RETURN-CODE               03820003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03830003
           END-IF.                                                      03840003
                                                                        03850003
           IF WS-K800-STATUS NOT = 00 AND 97                            03860003
              DISPLAY 'OPENING BP13K800 ERROR ' WS-K800-STATUS          03870003
              MOVE     WS-K800-STATUS      TO RETURN-CODE               03880003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03890003
           END-IF.                                                      03900003
                                                                        03910003
           IF WS-K022-STATUS NOT = 00 AND 97                            03920003
              DISPLAY 'OPENING BP13K022 ERROR ' WS-K022-STATUS          03930003
              MOVE     WS-K022-STATUS      TO RETURN-CODE               03940003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               03950003
           END-IF.                                                      03960003
                                                                        03970003
           IF WS-K024-STATUS NOT = 00 AND 97                            03980003
              DISPLAY 'OPENING BP13K024 ERROR ' WS-K024-STATUS          03990003
              MOVE     WS-K024-STATUS      TO RETURN-CODE               04000003
              PERFORM  9000-CLOSE-ROUTINE  THRU 9000-EXIT               04010003
           END-IF.                                                      04020003
                                                                        04030003
           INITIALIZE  WS-COUNT.                                        04040003
                                                                        04050003
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CUR-DATE.              04060003
           MOVE FUNCTION CURRENT-DATE(9:8) TO WS-TIME.                  04070003
                                                                        04080003
           MOVE WS-CUR-DATE(1:6)           TO WS-REPORT-DATE.           04090003
                                                                        04100003
       1000-EXIT.                                                       04110003
           EXIT.                                                        04120003
                                                                        04130003
      *=============================================================*   04140003
       2000-READ-INPUT.                                                 04150003
      *=============================================================*   04160003
                                                                        04170003
            READ BM06F100                                               04180003
                 AT END MOVE 'Y'  TO WS-F100-EOF                        04190003
            END-READ.                                                   04200003
                                                                        04210003
            IF WS-F100-EOF NOT = 'Y'                                    04220003
               ADD 1 TO WS-F100-INPUT                                   04230003
            END-IF.                                                     04240003
                                                                        04250003
       2000-EXIT.                                                       04260003
           EXIT.                                                        04270003
                                                                        04280003
      *=============================================================*   04290003
       3000-PROCESS-DATA.                                               04300003
      *=============================================================*   04310003
                                                                        04320003
           MOVE SPACES                     TO BP13K800-MASTER.          04330003
           INITIALIZE WS-FOUND-K800 WS-FOUND-K022 WS-PRINTED.           04340003
                                                                        04350003
           PERFORM 3200-READ-BM06K110                                   04360003
              THRU 3200-EXIT                                            04370003
                                                                        04380003
           IF WS-PRINTED NOT = 'Y'                                      04390003
              ADD 1 TO WS-F100-OUT                                      04400003
              DISPLAY 'NOT PRINTED = ' F100-KEY-FLD '/'                 04410003
                 K110-SCH-ACC-NO '/' K110-REGN-NO '/' K820-NUM-NRIC     04420003
           ELSE                                                         04430003
              MOVE 'N' TO WS-PRINTED                                    04440003
           END-IF.                                                      04450003
                                                                        04460003
           PERFORM 2000-READ-INPUT                                      04470003
              THRU 2000-EXIT.                                           04480003
                                                                        04490003
       3000-EXIT.                                                       04500003
           EXIT.                                                        04510003
                                                                        04520003
      *================================================================*04530003
       3200-READ-BM06K110.                                              04540003
      *================================================================*04550003
                                                                        04560003
           MOVE SPACES                TO K110-REC.                      04570003
           INITIALIZE                    K110-REC.                      04580003
           MOVE 'N'                   TO WS-K110-EOF.                   04590003
                                                                        04600003
           MOVE F100-KEY-FLD          TO K110-AIX1.                     04610003
                                                                        04620003
           START BM06K110 KEY >= K110-AIX1.                             04630003
                                                                        04640003
           EVALUATE WS-K110-STATUS                                      04650003
              WHEN 00                                                   04660003
                 PERFORM 3210-READNEXT-BM06K110                         04670003
                    THRU 3210-EXIT                                      04680003
                   UNTIL WS-K110-EOF = 'Y'                              04690003
              WHEN 10                                                   04700003
              WHEN 23                                                   04710003
              WHEN 46                                                   04720003
                 MOVE 'Y' TO WS-K110-EOF                                04730003
                 DISPLAY 'BM06K110 REC NOT FND : ' WS-K110-STATUS       04740003
                         ' F100-KEY-FLD = ' F100-KEY-FLD                04750003
              WHEN OTHER                                                04760003
                 DISPLAY 'ERROR STARTBROWSE BM06K110. STATUS IS '       04770003
                            WS-K110-STATUS                              04780003
                 MOVE WS-K110-STATUS TO RETURN-CODE                     04790003
                 PERFORM 9000-CLOSE-ROUTINE                             04800003
                    THRU 9000-EXIT                                      04810003
           END-EVALUATE.                                                04820003
                                                                        04830003
       3200-EXIT.                                                       04840003
           EXIT.                                                        04850003
                                                                        04860003
      *================================================================*04870003
       3210-READNEXT-BM06K110.                                          04880003
      *================================================================*04890003
           READ BM06K110 NEXT RECORD.                                   04900003
                                                                        04910003
           EVALUATE WS-K110-STATUS                                      04920003
              WHEN 00                                                   04930003
              WHEN 02                                                   04940003
                 IF K110-AIX1 = F100-KEY-FLD                            04950003
                    IF K110-REGN-NO NOT = SPACES AND LOW-VALUES AND     04960003
                       K110-REGN-NO(1:2) NOT = '##'                     04970003
                       MOVE SPACES         TO BP13K800-MASTER           04980003
                       MOVE K110-REGN-NO   TO K800-NUM-REGN             04990003
                       PERFORM 3500-READ-BP13K800                       05000003
                          THRU 3500-EXIT                                05010003
                    ELSE                                                05020003
                       DISPLAY 'INVALID K110-REGN-NO = ' K110-REGN-NO   05030003
                    END-IF                                              05040003
                 ELSE                                                   05050003
                    DISPLAY 'K110-AIX1 = ' K110-AIX1                    05060003
                    DISPLAY 'F100-KEY-FLD = ' F100-KEY-FLD              05070003
                    MOVE 'Y'               TO WS-K110-EOF               05080003
                 END-IF                                                 05090003
              WHEN 10                                                   05100003
              WHEN 23                                                   05110003
              WHEN 46                                                   05120003
                 MOVE 'Y'                  TO   WS-K110-EOF             05130003
              WHEN OTHER                                                05140003
                 DISPLAY 'ERROR READ NEXT BM06K110. STATUS IS '         05150003
                            WS-K110-STATUS                              05160003
                 MOVE WS-K110-STATUS TO RETURN-CODE                     05170003
                 PERFORM 9000-CLOSE-ROUTINE                             05180003
                    THRU 9000-EXIT                                      05190003
           END-EVALUATE.                                                05200003
                                                                        05210003
       3210-EXIT.                                                       05220003
           EXIT.                                                        05230003
                                                                        05240003
      *================================================================*05250003
       3500-READ-BP13K800.                                              05260003
      *================================================================*05270003
                                                                        05280003
           READ BP13K800.                                               05290003
                                                                        05300003
           EVALUATE WS-K800-STATUS                                      05310003
              WHEN 00                                                   05320003
                MOVE 'Y'                   TO WS-FOUND-K800             05330003
                MOVE K800-NUM-IDP-SCHEME   TO WS-IDP-SCHEME             05340003
                MOVE K800-NUM-FLAT-TYPE    TO WS-FLAT-TYPE              05350003
              WHEN 23                                                   05360003
                MOVE 'N'                   TO WS-FOUND-K800             05370003
                DISPLAY 'BP13K800 REC NOT FND : ' WS-K800-STATUS        05380003
                        ' K800-NUM-REGN = ' K800-NUM-REGN               05390003
              WHEN OTHER                                                05400003
                MOVE  WS-K800-STATUS TO RETURN-CODE                     05410003
                DISPLAY 'ERROR READING BP13K800 FILE : ' WS-K800-STATUS 05420003
                DISPLAY 'K800-NUM-REGN = ' K800-NUM-REGN                05430003
                PERFORM 9000-CLOSE-ROUTINE                              05440003
                   THRU 9000-EXIT                                       05450003
           END-EVALUATE.                                                05460003
                                                                        05470003
           IF WS-FOUND-K800 = 'Y'                                       05480003
              PERFORM 4700-CALL-BP13C913                                05490003
                 THRU 4700-EXIT                                         05500003
              IF STUDIO-APT AND VALID-IDP AND VALID-FT                  05510003
                 DISPLAY 'DESG/IDP/FT = ' WS-DESIGN-TYPE '/ '           05520003
                         WS-IDP-SCHEME '/ ' WS-FLAT-TYPE                05530003
                         ' REGNO = ' K800-NUM-REGN                      05540003
                 PERFORM 3520-START-BP13K820                            05550003
                    THRU 3520-EXIT                                      05560003
              ELSE                                                      05570003
                 DISPLAY 'DESG/IDP/FT = ' WS-DESIGN-TYPE '/ '           05580003
                         WS-IDP-SCHEME '/ ' WS-FLAT-TYPE                05590003
                         ' REGNO = ' K800-NUM-REGN                      05600003
              END-IF                                                    05610003
           END-IF.                                                      05620003
                                                                        05630003
       3500-EXIT.                                                       05640003
            EXIT.                                                       05650003
                                                                        05660003
      *================================================================*05670003
       3510-PROCEED.                                                    05680003
      *================================================================*05690003
                                                                        05700003
           IF WS-FOUND-K010 = 'Y'                                       05710003
              IF K010-CDE-PPTY-TYPE(1:1) = 'R'                          05720003
                 PERFORM 4000-CREATE-REPORT                             05730003
                    THRU 4000-EXIT                                      05740003
                 IF WS-OIC NOT = SPACES AND LOW-VALUES                  05750003
                    PERFORM 6000-CALL-BP13CCNT                          05760003
                       THRU 6000-EXIT                                   05770003
                    IF WS-EMAIL NOT = SPACES AND LOW-VALUES             05780003
                       PERFORM 4100-CREATE-REPORT2                      05790003
                          THRU 4100-EXIT                                05800003
                    END-IF                                              05810003
                 END-IF                                                 05820003
              ELSE                                                      05830003
                 ADD 1 TO WS-F100-OUT                                   05840003
                 DISPLAY 'BR10 PPTY-TYPE = ' K010-CDE-PPTY-TYPE(1:1)    05850003
                         ' -NRIC IS ' K010-NUM-UIN                      05860003
              END-IF                                                    05870003
           ELSE                                                         05880003
              ADD 1 TO WS-F100-OUT                                      05890003
           END-IF.                                                      05900003
                                                                        05910003
       3510-EXIT.                                                       05920003
            EXIT.                                                       05930003
                                                                        05940003
      *================================================================*05950003
       3520-START-BP13K820.                                             05960003
      *================================================================*05970003
           MOVE SPACES                     TO K820-KEY-FLD.             05980003
           MOVE K800-NUM-REGN              TO K820-NUM-REGN.            05990003
           MOVE 'N'                        TO WS-K820-EOF.              06000003
                                                                        06010003
           START BP13K820 KEY >= K820-KEY-FLD.                          06020003
                                                                        06030003
           EVALUATE WS-K820-STATUS                                      06040003
              WHEN 00                                                   06050003
              WHEN 02                                                   06060003
                PERFORM 3525-READNEXT-BP13K820                          06070003
                   THRU 3525-EXIT                                       06080003
                  UNTIL WS-K820-EOF = 'Y'                               06090003
              WHEN 10                                                   06100003
              WHEN 23                                                   06110003
                MOVE 'Y'                   TO WS-K820-EOF               06120003
                DISPLAY 'BP13K820 REC NOT FND : ' WS-K820-STATUS        06130003
                        ' K820-NUM-REGN = ' K820-NUM-REGN               06140003
              WHEN OTHER                                                06150003
                MOVE  WS-K820-STATUS TO RETURN-CODE                     06160003
                DISPLAY 'ERROR READING BP13K820 FILE : ' WS-K820-STATUS 06170003
                DISPLAY 'K820-NUM-REGN = ' K820-NUM-REGN                06180003
                PERFORM 9000-CLOSE-ROUTINE                              06190003
                   THRU 9000-EXIT                                       06200003
           END-EVALUATE.                                                06210003
                                                                        06220003
       3520-EXIT.                                                       06230003
           EXIT.                                                        06240003
                                                                        06250003
      *================================================================*06260003
       3525-READNEXT-BP13K820.                                          06270003
      *================================================================*06280003
                                                                        06290003
           READ BP13K820 NEXT RECORD.                                   06300003
                                                                        06310003
           EVALUATE WS-K820-STATUS                                      06320003
              WHEN 00                                                   06330003
              WHEN 02                                                   06340003
                 IF K820-NUM-REGN = K800-NUM-REGN                       06350003
                    PERFORM 3600-STARTBR-K010                           06370003
                       THRU 3600-EXIT                                   06380003
                 ELSE                                                   06390003
                    MOVE 'Y'               TO WS-K820-EOF               06400003
                 END-IF                                                 06410003
              WHEN 10                                                   06420003
              WHEN 23                                                   06430003
              WHEN 46                                                   06440003
                 MOVE 'Y'                  TO WS-K820-EOF               06450003
              WHEN OTHER                                                06460003
                 DISPLAY 'ERROR READ NEXT BP13K820. STATUS IS '         06470003
                            WS-K820-STATUS                              06480003
                 MOVE WS-K820-STATUS TO RETURN-CODE                     06490003
                 PERFORM 9000-CLOSE-ROUTINE                             06500003
                    THRU 9000-EXIT                                      06510003
           END-EVALUATE.                                                06520003
                                                                        06530003
       3525-EXIT.                                                       06540003
           EXIT.                                                        06550003
                                                                        06560003
      *================================================================*06570003
       3600-STARTBR-K010.                                               06580003
      *================================================================*06590003
                                                                        06600003
           MOVE SPACES           TO K010-KEY-FLD.                       06610003
           MOVE 'N'              TO WS-K010-EOF                         06620003
                                    WS-FOUND-K010.                      06630003
                                                                        06640003
           MOVE K820-NUM-NRIC    TO K010-NUM-UIN.                       06650003
           START BR10K010 KEY >= K010-NUM-UIN.                          06660003
                                                                        06670003
           EVALUATE WS-K010-STATUS                                      06680003
              WHEN 00                                                   06690003
              WHEN 02                                                   06700003
                 PERFORM 3610-READNXT-K010                              06710003
                    THRU 3610-EXIT                                      06720003
                   UNTIL WS-K010-EOF = 'Y'                              06730003
              WHEN 10                                                   06740003
              WHEN 23                                                   06750003
                 MOVE 'Y'        TO WS-K010-EOF                         06760003
                 DISPLAY 'BR10K010 REC NOT FND : ' WS-K010-STATUS       06770003
                         ' K010-NUM-UIN = ' K010-NUM-UIN                06780003
                         ' REGNO = ' K820-NUM-REGN                      06790003
              WHEN OTHER                                                06800003
                 DISPLAY 'ERRROR READING BR10K010 STATUS - '            06810003
                                            WS-K010-STATUS              06820003
                 MOVE WS-K010-STATUS       TO RETURN-CODE               06830003
                 PERFORM 9000-CLOSE-ROUTINE                             06840003
                    THRU 9000-EXIT                                      06850003
           END-EVALUATE.                                                06860003
                                                                        06870003
       3600-EXIT.                                                       06880003
           EXIT.                                                        06890003
                                                                        06900003
      *================================================================*06910003
       3610-READNXT-K010.                                               06920003
      *================================================================*06930003
                                                                        06940003
           READ BR10K010 NEXT RECORD.                                   06950003
                                                                        06960003
           EVALUATE WS-K010-STATUS                                      06970003
              WHEN 00                                                   06980003
              WHEN 02                                                   06990003
                 IF K010-NUM-UIN = K820-NUM-NRIC                        07000003
                    MOVE 'Y'  TO WS-K010-EOF WS-FOUND-K010 WS-K820-EOF  07010003
                    PERFORM 3510-PROCEED                                07020003
                       THRU 3510-EXIT                                   07030003
                 ELSE                                                   07040003
                    MOVE 'Y'               TO WS-K010-EOF               07050003
                 END-IF                                                 07060003
              WHEN 10                                                   07070003
              WHEN 23                                                   07080003
              WHEN 46                                                   07090003
                 MOVE 'Y'                  TO WS-K010-EOF               07100003
                 DISPLAY 'NOT FOUND IN BR10K010 = ' K010-NUM-UIN        07110003
              WHEN OTHER                                                07120003
                 DISPLAY 'ERROR READ NEXT BR10K010. STATUS IS '         07130003
                            WS-K010-STATUS                              07140003
                 MOVE WS-K010-STATUS TO RETURN-CODE                     07150003
                 PERFORM 9000-CLOSE-ROUTINE                             07160003
                    THRU 9000-EXIT                                      07170003
           END-EVALUATE.                                                07180003
                                                                        07190003
       3610-EXIT.                                                       07200003
           EXIT.                                                        07210003
                                                                        07220003
      *================================================================*07230003
       4000-CREATE-REPORT.                                              07240003
      *================================================================*07250003
                                                                        07260003
           ADD  1                   TO WS-LH51-OUT.                     07270003
                                                                        07280003
           IF WS-LH51-OUT = 1                                           07290003
              STRING WS-CUR-DATE(7:2) '/'                               07300003
                     WS-CUR-DATE(5:2) '/'                               07310003
                     WS-CUR-DATE(1:4)                                   07320003
                     DELIMITED BY SIZE                                  07330003
                     INTO LH51-SYS-DATE                                 07340003
              END-STRING                                                07350003
              MOVE LH51-SYS-DATE TO MAIL-DATE                           07360003
              WRITE BP13LH51-REC FROM MAIL-HDR1                         07370003
              WRITE BP13LH51-REC FROM MAIL-HDR2                         07380003
              WRITE BP13LH51-REC FROM MAIL-DTL1A                        07390003
              WRITE BP13LH51-REC FROM MAIL-DTL1B                        07400003
              WRITE BP13LH51-REC FROM MAIL-DTL3                         07410003
              WRITE BP13LH51-REC FROM MAIL-DTL4                         07420003
              WRITE BP13LH51-REC FROM MAIL-DTL5A                        07430003
              WRITE BP13LH51-REC FROM MAIL-DTL5B                        07440003
              WRITE BP13LH51-REC FROM MAIL-DTL7                         07450003
              WRITE BP13LH51-REC FROM MAIL-DTL8                         07460003
              WRITE BP13LH51-REC FROM MAIL-SPACES                       07470003
              WRITE BP13LH51-REC FROM LH51-HDG1                         07480003
              WRITE BP13LH51-REC FROM LH51-HDG2                         07490003
              WRITE BP13LH51-REC FROM LH51-HDG2A                        07500003
              MOVE SPACES TO BP13LH51-REC                               07510003
              WRITE BP13LH51-REC                                        07520003
              WRITE BP13LH51-REC FROM LH51-HDG3                         07530003
              WRITE BP13LH51-REC FROM LH51-HDG4                         07540003
              MOVE SPACES TO BP13LH51-REC                               07550003
              WRITE BP13LH51-REC                                        07560003
           END-IF.                                                      07570003
                                                                        07580003
           MOVE WS-LH51-OUT               TO LH51-SNO.                  07590003
           MOVE K800-NUM-REGN             TO LH51-REGN.                 07600003
           IF K010-ALTX-KEY NOT = SPACES AND LOW-VALUES                 07610003
              STRING K010-NUM-BLK-HSE ' '                               07620003
                     K010-NME-STREET  ' #'                              07630003
                     K010-NUM-LVL     '-'                               07640003
                     K010-NUM-UNIT ' S'                                 07650003
                     K010-CDE-POSTAL                                    07660003
                 DELIMITED BY '  '                                      07670003
                 INTO LH51-ADDR                                         07680003
              END-STRING                                                07690003
           ELSE                                                         07700003
              MOVE SPACES                 TO LH51-ADDR                  07710003
           END-IF.                                                      07720003
                                                                        07730003
           PERFORM 4500-GET-OIC                                         07740003
              THRU 4500-EXIT.                                           07750003
           IF WS-OIC NOT = SPACES AND LOW-VALUES                        07760003
              STRING '(' WS-OIC ')' ' ' WS-OIC-NME                      07770003
                 DELIMITED BY SIZE       INTO LH51-OIC                  07780003
              END-STRING                                                07790003
           ELSE                                                         07800003
              MOVE SPACES                  TO LH51-OIC                  07810003
           END-IF.                                                      07820003
           WRITE BP13LH51-REC            FROM LH51-DTL1.                07830003
           IF F100-KEY-FLD = WS-SAVE-KEY                                07840003
              ADD 1                        TO WS-F100-INPUT             07850003
           END-IF                                                       07860003
           ADD 1                           TO WS-WRITTEN.               07870003
           MOVE F100-KEY-FLD               TO WS-SAVE-KEY.              07880003
           MOVE 'Y'                        TO WS-PRINTED.               07890003
           MOVE 'N'                        TO WS-NIL-SW.                07900003
                                                                        07910003
       4000-EXIT.                                                       07920003
            EXIT.                                                       07930003
                                                                        07940003
      *================================================================*07950003
       4100-CREATE-REPORT2.                                             07960003
      *================================================================*07970003
                                                                        07980003
           MOVE 1                   TO WS-LH51A-OUT.                    07990003
                                                                        08000003
           STRING WS-CUR-DATE(7:2) '/'                                  08010003
                  WS-CUR-DATE(5:2) '/'                                  08020003
                  WS-CUR-DATE(1:4)                                      08030003
                  DELIMITED BY SIZE                                     08040003
                  INTO LH51-SYS-DATE                                    08050003
           END-STRING                                                   08060003
           MOVE LH51-SYS-DATE TO MAIL-DATE                              08070003
           WRITE P13LH51A-REC FROM MAIL-HDR1                            08080003
           WRITE P13LH51A-REC FROM MAIL-HDR2                            08090003
                                                                        08100003
           MOVE SPACES  TO P13LH51A-REC                                 08110003
           STRING 'RCPT TO:<' DELIMITED BY SIZE                         08120003
                  WS-EMAIL '>'                                          08130003
                  DELIMITED BY SPACES INTO P13LH51A-REC                 08140003
           WRITE P13LH51A-REC                                           08150003
                                                                        08160003
           WRITE P13LH51A-REC FROM MAIL-DTL3                            08170003
           WRITE P13LH51A-REC FROM MAIL-DTL4                            08180003
                                                                        08190003
           MOVE SPACES  TO P13LH51A-REC                                 08200003
           STRING 'TO:<' DELIMITED BY SIZE                              08210003
                  WS-EMAIL '>'                                          08220003
                  DELIMITED BY SPACES                                   08230003
                  INTO P13LH51A-REC                                     08240003
           WRITE P13LH51A-REC                                           08250003
                                                                        08260003
           WRITE P13LH51A-REC FROM MAIL-DTL7                            08270003
           WRITE P13LH51A-REC FROM MAIL-DTL8                            08280003
           WRITE P13LH51A-REC FROM MAIL-SPACES                          08290003
           WRITE P13LH51A-REC FROM LH51-HDG1                            08300003
           WRITE P13LH51A-REC FROM LH51-HDG2                            08310003
           WRITE P13LH51A-REC FROM LH51-HDG2A                           08320003
           MOVE SPACES TO P13LH51A-REC                                  08330003
           WRITE P13LH51A-REC                                           08340003
           WRITE P13LH51A-REC FROM LH51-HDG3                            08350003
           WRITE P13LH51A-REC FROM LH51-HDG4                            08360003
           MOVE SPACES TO P13LH51A-REC                                  08370003
           WRITE P13LH51A-REC                                           08380003
                                                                        08390003
           MOVE WS-LH51A-OUT              TO LH51-SNO.                  08400003
           MOVE K800-NUM-REGN             TO LH51-REGN.                 08410003
           IF K010-ALTX-KEY NOT = SPACES AND LOW-VALUES                 08420003
              STRING K010-NUM-BLK-HSE ' '                               08430003
                     K010-NME-STREET  ' #'                              08440003
                     K010-NUM-LVL     '-'                               08450003
                     K010-NUM-UNIT ' S '                                08460003
                     K010-CDE-POSTAL                                    08470003
                 DELIMITED BY '  '                                      08480003
                 INTO LH51-ADDR                                         08490003
              END-STRING                                                08500003
           ELSE                                                         08510003
              MOVE SPACES                 TO LH51-ADDR                  08520003
           END-IF.                                                      08530003
                                                                        08540003
           STRING '(' WS-OIC ')' ' ' WS-OIC-NME                         08550003
              DELIMITED BY SIZE       INTO LH51-OIC                     08560003
           END-STRING                                                   08570003
           WRITE P13LH51A-REC           FROM LH51-DTL1.                 08580003
                                                                        08590003
           MOVE  SPACES                   TO P13LH51A-REC.              08600003
           WRITE P13LH51A-REC.                                          08610003
           WRITE P13LH51A-REC FROM MAIL-FOOTER.                         08620003
           WRITE P13LH51A-REC FROM MAIL-END.                            08630003
                                                                        08640003
       4100-EXIT.                                                       08650003
            EXIT.                                                       08660003
                                                                        08670003
      *================================================================*08680003
       4500-GET-OIC.                                                    08690003
      *================================================================*08700003
           MOVE SPACES                     TO K022-KEY-FLD.             08710003
           MOVE K800-NUM-REGN              TO K022-NUM-REGN.            08720003
                                                                        08730003
           READ BP13K022 KEY IS K022-NUM-REGN.                          08740003
                                                                        08750003
           EVALUATE WS-K022-STATUS                                      08760003
              WHEN ZEROS                                                08770003
                 MOVE 'Y'                     TO WS-FOUND-K022          08780003
                 MOVE K022-NUM-OIC            TO WS-OIC                 08790003
                 PERFORM 4600-GET-OIC-NAME                              08800003
                    THRU 4600-EXIT                                      08810003
              WHEN 23                                                   08820003
                 MOVE SPACES                  TO WS-OIC                 08830003
              WHEN OTHER                                                08840003
                MOVE  WS-K022-STATUS TO RETURN-CODE                     08850003
                DISPLAY 'ERROR READING BP13K022 FILE : ' WS-K022-STATUS 08860003
                DISPLAY 'K022-NUM-REGN = ' K022-NUM-REGN                08870003
                PERFORM 9000-CLOSE-ROUTINE                              08880003
                   THRU 9000-EXIT                                       08890003
           END-EVALUATE.                                                08900003
                                                                        08910003
       4500-EXIT.                                                       08920003
            EXIT.                                                       08930003
                                                                        08940003
      *================================================================*08950003
       4600-GET-OIC-NAME.                                               08960003
      *================================================================*08970003
           MOVE SPACES        TO K024-KEY-FLD.                          08980003
           MOVE K022-NUM-OIC  TO K024-NUM-OIC.                          08990003
                                                                        09000003
           READ BP13K024                                                09010003
                                                                        09020003
           EVALUATE WS-K024-STATUS                                      09030003
              WHEN ZEROS                                                09040003
                 MOVE K024-NME-OIC            TO WS-OIC-NME             09050003
              WHEN 23                                                   09060003
                 MOVE SPACES                  TO WS-OIC-NME             09070003
              WHEN OTHER                                                09080003
                MOVE  WS-K024-STATUS TO RETURN-CODE                     09090003
                DISPLAY 'ERROR READING BP13K024 FILE : ' WS-K024-STATUS 09100003
                DISPLAY 'K024-NUM-OIC = ' K024-NUM-OIC                  09110003
                PERFORM 9000-CLOSE-ROUTINE                              09120003
                   THRU 9000-EXIT                                       09130003
           END-EVALUATE.                                                09140003
                                                                        09150003
       4600-EXIT.                                                       09160003
            EXIT.                                                       09170003
                                                                        09180003
      *================================================================*09190003
       4700-CALL-BP13C913.                                              09200003
      *================================================================*09210003
           MOVE K110-SCH-ACC-NO            TO WS-LINK-REC.              09220003
                                                                        09230003
           CALL 'BP13C913' USING WS-LINK-REC, BP13COMM8-REC.            09240003
                                                                        09250003
           EVALUATE COMM8-CDE-SYSERR                                    09260003
           WHEN 000                                                     09270003
              MOVE COMM8-CDE-MODL-DESG     TO WS-DESIGN-TYPE            09280003
           WHEN 100                                                     09290003
              DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE - '               09300003
                         K110-SCH-ACC-NO ', REGN : ' K110-REGN-NO       09310003
              MOVE  SPACES                 TO WS-DESIGN-TYPE            09320003
           WHEN OTHER                                                   09330003
              DISPLAY 'ERROR READING PBF TABLE' COMM8-CDE-SYSERR        09340003
              MOVE  SPACES                 TO WS-DESIGN-TYPE            09350003
           END-EVALUATE.                                                09360003
                                                                        09370003
                                                                        09380003
       4700-EXIT.                                                       09390003
           EXIT.                                                        09400003
                                                                        09410003
      *================================================================*09420003
       5000-EMAIL-FOOTER.                                               09430003
      *================================================================*09440003
                                                                        09450003
           MOVE  SPACES         TO BP13LH51-REC.                        09460003
           WRITE BP13LH51-REC.                                          09470003
           WRITE BP13LH51-REC FROM MAIL-FOOTER.                         09480003
           WRITE BP13LH51-REC FROM MAIL-END.                            09490003
                                                                        09500003
       5000-EXIT.                                                       09510003
            EXIT.                                                       09520003
                                                                        09530003
      *================================================================*09540003
       6000-CALL-BP13CCNT.                                              09550003
      *================================================================*09560003
           MOVE 'EML'                      TO LINK-CNTCT-TYPE.          09570003
           MOVE WS-OIC                     TO LINK-STAFF-NICK.          09580003
           MOVE SPACES                     TO LINK-STAFF-NUM.           09590003
                                                                        09600003
           CALL 'BP13CCNT' USING WS-BP13CCNT-LINK.                      09610003
                                                                        09620003
           EVALUATE LINK-SYSERR                                         09630003
           WHEN ZEROS                                                   09640003
              MOVE LINK-STAFF-CNTCT        TO WS-EMAIL                  09650003
           WHEN 100                                                     09660003
              DISPLAY 'OIC NOT FOUND IN OFFICE_CNTCT TABLE - '          09670003
                         WS-OIC  ', REGN : ' K110-REGN-NO               09680003
              MOVE  SPACES                 TO WS-EMAIL                  09690003
           WHEN OTHER                                                   09700003
              DISPLAY 'ERROR READING OFFICE_CNTCT TABLE = '             09710003
                       LINK-SYSERR                                      09720003
              MOVE  SPACES                 TO WS-EMAIL                  09730003
           END-EVALUATE.                                                09740003
                                                                        09750003
       6000-EXIT.                                                       09760003
           EXIT.                                                        09770003
                                                                        09780003
      *================================================================*09790003
       7000-WRITE-NIL.                                                  09800003
      *================================================================*09810003
           STRING WS-CUR-DATE(7:2) '/'                                  09820003
                  WS-CUR-DATE(5:2) '/'                                  09830003
                  WS-CUR-DATE(1:4)                                      09840003
                  DELIMITED BY SIZE                                     09850003
                  INTO LH51-SYS-DATE                                    09860003
           END-STRING.                                                  09870003
           MOVE LH51-SYS-DATE TO MAIL-DATE                              09880003
           WRITE BP13LH51-REC FROM MAIL-HDR1                            09890003
           WRITE BP13LH51-REC FROM MAIL-HDR2                            09900003
           WRITE BP13LH51-REC FROM MAIL-DTL1A                           09910003
           WRITE BP13LH51-REC FROM MAIL-DTL1B                           09920003
           WRITE BP13LH51-REC FROM MAIL-DTL3                            09930003
           WRITE BP13LH51-REC FROM MAIL-DTL4                            09940003
           WRITE BP13LH51-REC FROM MAIL-DTL5A                           09950003
           WRITE BP13LH51-REC FROM MAIL-DTL5B                           09960003
           WRITE BP13LH51-REC FROM MAIL-DTL7                            09970003
           WRITE BP13LH51-REC FROM MAIL-DTL8                            09980003
           WRITE BP13LH51-REC FROM MAIL-SPACES                          09990003
           WRITE BP13LH51-REC FROM LH51-HDG1                            10000003
           WRITE BP13LH51-REC FROM LH51-HDG2                            10010003
           WRITE BP13LH51-REC FROM LH51-HDG2A                           10020003
           MOVE SPACES TO BP13LH51-REC.                                 10030003
           WRITE BP13LH51-REC FROM WS-BLANK-LINE.                       10040003
           MOVE SPACES TO BP13LH51-REC.                                 10050003
           WRITE BP13LH51-REC FROM WS-BLANK-LINE.                       10060003
           WRITE BP13LH51-REC FROM LH51-NIL.                            10070003
                                                                        10080003
       7000-EXIT.                                                       10090003
            EXIT.                                                       10100003
                                                                        10110003
      *================================================================*10120003
       9000-CLOSE-ROUTINE.                                              10130003
      *================================================================*10140003
           IF WS-NIL-SW NOT = 'N'                                       10150003
              PERFORM 7000-WRITE-NIL                                    10160003
                 THRU 7000-EXIT                                         10170003
           ELSE                                                         10180003
              PERFORM 5000-EMAIL-FOOTER                                 10190003
                 THRU 5000-EXIT                                         10200003
           END-IF.                                                      10210003
                                                                        10220003
           DISPLAY 'PROGRAM: BP13CH51'.                                 10230003
           DISPLAY 'TOTAL INPUT RECORDS        : ' WS-F100-INPUT.       10240003
           DISPLAY 'TOTAL RECORD WRITTEN       : ' WS-WRITTEN.          10250003
           DISPLAY 'TOTAL RECORD NOT WRITTEN   : ' WS-F100-OUT.         10260003
           DISPLAY '        '                                           10270003
                                                                        10280003
           CLOSE BM06F100                                               10290003
                 BM06K110                                               10300003
                 BP13K800                                               10310003
                 BP13K820                                               10320003
                 BP13K022                                               10330003
                 BP13K024                                               10340003
                 BR10K010                                               10350003
                 BP13LH51                                               10360003
                 P13LH51A.                                              10370003
                                                                        10380003
           IF WS-K820-STATUS NOT = 00 AND 97                            10390003
              DISPLAY 'CLOSING BP13K820 ERROR ' WS-K820-STATUS          10400003
              MOVE     WS-K820-STATUS      TO RETURN-CODE               10410003
           END-IF.                                                      10420003
                                                                        10430003
           IF WS-K010-STATUS NOT = 00 AND 97                            10440003
              DISPLAY 'CLOSING BR10K010 ERROR ' WS-K010-STATUS          10450003
              MOVE     WS-K010-STATUS      TO RETURN-CODE               10460003
           END-IF.                                                      10470003
                                                                        10480003
           IF WS-K110-STATUS NOT = 00 AND 97                            10490003
              DISPLAY 'CLOSING BM06K110 ERROR ' WS-K110-STATUS          10500003
              MOVE     WS-K110-STATUS      TO RETURN-CODE               10510003
           END-IF.                                                      10520003
                                                                        10530003
           IF WS-K800-STATUS NOT = 00 AND 97                            10540003
              DISPLAY 'CLOSING BP13K800 ERROR ' WS-K800-STATUS          10550003
              MOVE     WS-K800-STATUS      TO RETURN-CODE               10560003
           END-IF.                                                      10570003
                                                                        10580003
           IF WS-K022-STATUS NOT = 00 AND 97                            10590003
              DISPLAY 'CLOSING BP13K022 ERROR ' WS-K022-STATUS          10600003
              MOVE     WS-K022-STATUS      TO RETURN-CODE               10610003
           END-IF.                                                      10620003
                                                                        10630003
           IF WS-K024-STATUS NOT = 00 AND 97                            10640003
              DISPLAY 'CLOSING BP13K024 ERROR ' WS-K024-STATUS          10650003
              MOVE     WS-K024-STATUS      TO RETURN-CODE               10660003
           END-IF.                                                      10670003
                                                                        10680003
           STOP RUN.                                                    10690003
                                                                        10700003
       9000-EXIT.                                                       10710003
           EXIT.                                                        10720003
