      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID.    BP13C428.                                                 
      *AUTHOR.        TMK.                                                      
      *DATE-WRITTEN.  11/11/89.                                                 
                                                                                
      **********************************************************                
      *    SYSTEM NAME : SYSTEM OF COMMENCEMENT                *                
      *    SYSTEM ID : BP13                                    *                
      **********************************************************                
      *                                                        *                
      *    OBJECTIVE  :                                        *                
      *        1.  TO PRINT THE SUMMARY LIST OF CD             *                
      *            TRANSFERRED TO MORTGAGE LOAN                *                
      *        2.  TO PRINT DETAIL LIST OF TRANSACTION FOR     *                
      *            EACH APPLICATION.                           *                
      *                                                        *                
      *     INPUT FILES :                                      *                
      *       1. BP13F450  :  MTL PRINTING FILE                *                
      *       2. BP13K130  :  SOC TRANS HISTORY FILE           *                
      *       3. BP13K060  :  CODETABE  TABLE                  *                
      *                                                        *                
      *     LISTING:                                           *                
      *       1. LIST OF DETAIL TRANSACTIONS  - BP13P428       *                
      *       2. SUMMARY LIST                 - BP13L428       *                
      *                                                        *                
      * CHG-NO   BY   ON    -  DESCRIPTION                     *                
      * ------   --   --    --------------                     *                
      * BP130418 MPA 980611 - Y2000 CHANGES                    *                
      * BP130522 SIA 980709 - CATER FOR EXPANSION OF CPF NO    *                
      * BP130418 SIA 981012 - CATER FOR EXPANSION OF CPF NO    *                
      * BP130883 CLT 031100 - REMOVE READING OF BC14K060       *                
      **********************************************************                
                                                                                
      *------------------------*                                                
       ENVIRONMENT DIVISION.                                                    
      *------------------------*                                                
       CONFIGURATION SECTION.                                                   
      *------------------------*                                                
                                                                                
       SOURCE-COMPUTER. IBM-3900.                                               
       OBJECT-COMPUTER. IBM-3900.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13F450 ASSIGN TO BP13F450.                                  
           SELECT BP13K130 ASSIGN TO BP13K130                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K130-KEY-FLD                               
                  FILE STATUS     IS BP13K130-STATUS.                           
           SELECT BP13K060 ASSIGN TO BP13K060                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K060-KEY-FLD                               
                  FILE STATUS     IS BP13K060-STATUS.                           
           SELECT BP13P428  ASSIGN TO BP13P428.                                 
           SELECT BP13L428  ASSIGN TO BP13L428.                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F450                                                             
           BLOCK  CONTAINS   0 RECORDS                                          
           RECORD CONTAINS 200 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F450.                                                           
                                                                                
       FD  BP13K130                                                             
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13K130.                                                           
                                                                                
       FD  BP13K060                                                             
           RECORD CONTAINS  25 CHARACTERS.                                      
       COPY BP13K060.                                                           
                                                                                
       FD  BP13P428                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P428-PRT-REC                PIC X(132).                              
                                                                                
       FD  BP13L428                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  L428-PRT-REC                PIC X(132).                              
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  WS-FILE-STATUS.                                                      
           03  BP13K130-STATUS         PIC 99      VALUE ZEROS.                 
               88  BP13K130-REC-FOUND              VALUE ZEROS.                 
               88  BP13K130-REC-NOTFND             VALUE 23.                    
           03  BP13K060-STATUS         PIC 99      VALUE ZEROS.                 
               88  BP13K060-REC-FOUND              VALUE ZEROS.                 
               88  BP13K060-REC-NOTFND             VALUE 23.                    
                                                                                
       01  WS-ACCUMULATORS.                                                     
           03  WS-NUM-READ             PIC 9(5)    VALUE ZERO.                  
           03  WS-NUM-ACC              PIC 9(5)    VALUE ZERO.                  
           03  WS-NUM-LINE-P428        PIC 9(2)    VALUE 60.                    
           03  WS-NUM-PAGE-P428        PIC 9(5)    VALUE ZERO.                  
           03  WS-NUM-LINE-L428        PIC 9(2)    VALUE 60.                    
           03  WS-NUM-PAGE-L428        PIC 9(5)    VALUE ZERO.                  
                                                                                
       01  WS-SWITCHES.                                                         
           03  EOF-F450-IND            PIC X       VALUE SPACES.                
               88 EOF-F450             VALUE 'Y'.                               
                                                                                
      *------------------------------------------------*                        
      *  TRANS TYPE AND DESCRIPTION TABLE              *                        
      *------------------------------------------------*                        
       01  WS-TRANS-TYPE-TABLE.                                                 
           05  FILLER          PIC X(27) VALUE                                  
              '11SOC- CASH RECEIPT        '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '12SOC- CPF RECEIPT         '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '13SOC- CPF REFUND          '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '14SOC- CPF ADJUSTMENT      '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '15SOC- CASH REFUND         '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '16SOC- CASH ADJUSTMENT     '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '17SOC- CD TRANSFER TO MTL  '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '18SOC- TRANSFER TO CL ACCNT'.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '19SOC- TRANSFER TO CD      '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '20SOC- CLEAR CD AT TP      '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '21SOC- RAISE CD AT SA      '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '22SOC- DEBIT SOC FROM GL   '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '23SOC- CR FOR LSE/CVNY FEES'.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '24SOC- CLEAR SOC POSTED AMT'.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '25                         '.                                    
       01  WS-TRANS-TYPE    REDEFINES WS-TRANS-TYPE-TABLE.                      
           05  WS-TRANS        OCCURS 15 TIMES INDEXED BY TRN-IDX.              
               10  WS-TRN-CDE      PIC X(2).                                    
               10  WS-TRN-DESC     PIC X(25).                                   
                                                                                
      *------------------------------------------------*                        
      *  TRANS TYPE AND DESCRIPTION TABLE              *                        
      *------------------------------------------------*                        
       01  WS-IDP-TYPE-TABLE.                                                   
           05  FILLER          PIC X(27) VALUE                                  
              '01IDP- CASH RECEIPT        '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '02IDP- CPF RECEIPT         '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '03IDP- CPF REFUND          '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '04IDP- VOUCHER ADJUSTMENT  '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '07IDP- TRANSFER IDP TO MTL '.                                    
           05  FILLER          PIC X(27) VALUE                                  
              '08IDP- CLEARING ACCOUNT    '.                                    
       01  WS-IDP-TYPE    REDEFINES WS-IDP-TYPE-TABLE.                          
           05  WS-IDP          OCCURS 6 TIMES INDEXED BY TRN-IDX1.              
               10  WS-TRN-CDE-IDP  PIC X(2).                                    
               10  WS-TRN-DESC-IDP PIC X(25).                                   
                                                                                
       01  WS-CURR-CCYYMMDD.                                                    
           03  WS-CURR-CC              PIC 99.                                  
           03  WS-CURR-YY              PIC 99.                                  
           03  WS-CURR-MM              PIC 99.                                  
           03  WS-CURR-DD              PIC 99.                                  
                                                                                
       01  WS-EDITED-DATE.                                                      
           03  WS-EDIT-DD              PIC 99.                                  
           03  FILLER                  PIC X      VALUE '/'.                    
           03  WS-EDIT-MM              PIC 99.                                  
           03  FILLER                  PIC X      VALUE '/'.                    
           03  WS-EDIT-CC              PIC 99.                                  
           03  WS-EDIT-YY              PIC 99.                                  
                                                                                
       01  WS-CUR-DATE.                                                         
           03  WS-CUR-MM               PIC 99.                                  
           03  FILLER                  PIC X.                                   
           03  WS-CUR-DD               PIC 99.                                  
           03  FILLER                  PIC X.                                   
           03  WS-CUR-CC               PIC 99.                                  
           03  WS-CUR-YY               PIC 99.                                  
                                                                                
       01  WS1-DATE.                                                            
           03  WS1-CCYY                PIC X(4).                                
           03  WS1-MM                  PIC X(02).                               
           03  WS1-DD                  PIC X(02).                               
                                                                                
       01  WS1-EDITED-DATE.                                                     
           03  WS1-EDIT-DD             PIC X(02).                               
           03  FILLER                  PIC X      VALUE '/'.                    
           03  WS1-EDIT-MM             PIC X(02).                               
           03  FILLER                  PIC X      VALUE '/'.                    
           03  WS1-EDIT-CCYY           PIC X(04).                               
                                                                                
       01  WS2-PREVIOUS-REC-FIELDS.                                             
           03  WS2-PREV-NT             PIC X(03)  VALUE SPACES.                 
                                                                                
       01  WS2-PREV-BO                 PIC X(2)   VALUE LOW-VALUES.             
       01  WS2-PREV-JR                 PIC X(9)   VALUE LOW-VALUES.             
                                                                                
       01  WS3-DEFAULT.                                                         
           03  WS3-MAX-LINES-P428      PIC 9(02)   VALUE 50.                    
           03  WS3-MAX-B4-DTL-6        PIC 9(02)   VALUE 42.                    
           03  WS3-MAX-LINES-L428      PIC 9(02)   VALUE 50.                    
           03  WS3-DASH-LINE           PIC X(132)  VALUE ALL '-'.               
                                                                                
       01  WS4-AMOUNTS.                                                         
           03  WS4-SUBTOT-MORT-LOAN    PIC S9(8)V99 VALUE +0.                   
           03  WS4-TOTAL-MORT-LOAN     PIC S9(8)V99 VALUE +0.                   
           03  WS4-TOTAL-CASE-AMT      PIC S9(8)V99 VALUE +0.                   
           03  WS4-NUM-ACC             PIC 9(5) VALUE ZEROS.                    
                                                                                
       01  WS-TOT-IDP-AMT              PIC S9(8)V99 VALUE +0.                   
                                                                                
       01  WS5-PRTED-SUMRY-IND         PIC X(01)    VALUE SPACE.                
           88  WS5-PRTED-SUMMARY       VALUE 'Y'.                               
                                                                                
                                                                                
      **************************************************************            
      *                                                            *            
      *    COMMON LAY-OUT FOR BOTH DETAIL AND SUMMARY LIST         *            
      *                                                            *            
      **************************************************************            
       01  COMM-HDG-1.                                                          
           03  COMM-HD1-RPT-ID     PIC X(14)   VALUE SPACES.                    
           03  FILLER              PIC X(8)    VALUE 'HDB3'.                    
           03  FILLER              PIC X(18)   VALUE SPACES.                    
           03  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           03  FILLER              PIC X(18)   VALUE SPACES.                    
           03  FILLER              PIC X(7)    VALUE 'DATE: '.                  
           03  COMM-HD1-DATE       PIC X(10)    VALUE SPACES.                   
           03  FILLER              PIC X(1)    VALUE SPACES.                    
           03  FILLER              PIC X(7)    VALUE 'PAGE: '.                  
           03  COMM-HD1-PAGE-NO    PIC ZZZZ9.                                   
                                                                                
      **************************************************************            
      *                                                            *            
      *           LAY-OUT FOR DETAIL LISTING                       *            
      *                                                            *            
      **************************************************************            
       01  P428-HDG-1.                                                          
           03  FILLER              PIC X(34) VALUE SPACES.                      
           03  FILLER              PIC X(60) VALUE                              
           'DETAIL TRANSACTION LIST FOR TRANSFER TO MORTGAGE LOAN'.             
                                                                                
       01  P428-HDG-2.                                                          
           03  FILLER              PIC X(50) VALUE SPACES.                      
           03  FILLER              PIC X(16) VALUE                              
              'FOR WEEK ENDING '.                                               
           03  P428-HD2-DATE       PIC X(10) VALUE SPACES.                      
                                                                                
       01  P428-DTL-1.                                                          
           03  FILLER              PIC X(16) VALUE                              
              'BRANCH OFFICE : '.                                               
           03  P428-BO-NAME        PIC X(20) VALUE SPACES.                      
           03  FILLER              PIC X(32) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE 'NAME'.                      
           03  FILLER              PIC X(21) VALUE SPACES.                      
           03  FILLER              PIC X(06) VALUE 'CPF NO'.                    
                                                                                
       01  P428-DTL-2.                                                          
           03  FILLER              PIC X(16) VALUE                              
              'SCH-ACCNT-NO  : '.                                               
           03  P428-SCH-ACC        PIC X(14) VALUE SPACES.                      
           03  FILLER              PIC X(11) VALUE SPACES.                      
           03  FILLER              PIC X(16) VALUE 'APPLICANT # 1 : '.          
           03  P428-NAME1          PIC X(32) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  P428-CPF1           PIC X(09) VALUE SPACES.                      
                                                                                
       01  P428-DTL-3.                                                          
           03  FILLER              PIC X(16) VALUE                              
              'SALES REF NO  : '.                                               
           03  P428-SALES-REF      PIC X(13) VALUE SPACES.                      
           03  FILLER              PIC X(12) VALUE SPACES.                      
           03  FILLER              PIC X(16) VALUE 'APPLICANT # 2 : '.          
           03  P428-NAME2          PIC X(32) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  P428-CPF2           PIC X(09) VALUE SPACES.                      
                                                                                
       01  P428-DTL-4.                                                          
           03  FILLER              PIC X(16) VALUE                              
              'REGN NO       : '.                                               
           03  P428-REGN           PIC X(08) VALUE SPACES.                      
           03  FILLER              PIC X(17) VALUE SPACES.                      
           03  FILLER              PIC X(16) VALUE 'APPLICANT # 3 : '.          
           03  P428-NAME3          PIC X(32) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  P428-CPF3           PIC X(09) VALUE SPACES.                      
                                                                                
       01  P428-DTL-5.                                                          
           03  FILLER              PIC X(16) VALUE                              
              'DATE OF SO    : '.                                               
           03  P428-SO-DATE        PIC X(10) VALUE SPACES.                      
           03  FILLER              PIC X(15) VALUE SPACES.                      
           03  FILLER              PIC X(16) VALUE 'APPLICANT # 4 : '.          
           03  P428-NAME4          PIC X(32) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  P428-CPF4           PIC X(09) VALUE SPACES.                      
                                                                                
       01  P428-HDG-3.                                                          
           03  FILLER              PIC X(23) VALUE                              
              'HISTORICAL TRANSACTIONS'.                                        
                                                                                
       01  P428-HDG-4.                                                          
           03  FILLER              PIC X(25) VALUE 'DESCRIPTION '.              
           03  FILLER              PIC X(03) VALUE SPACES.                      
           03  FILLER              PIC X(08) VALUE ' CPF NO '.                  
           03  FILLER              PIC X(03) VALUE SPACES.                      
           03  FILLER              PIC X(09) VALUE 'JV/SCH NO'.                 
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  FILLER              PIC X(06) VALUE 'DOC NO'.                    
           03  FILLER              PIC X(03) VALUE SPACES.                      
           03  FILLER              PIC X(10) VALUE 'POST  DATE'.                
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  FILLER              PIC X(18) VALUE                              
               'TRANSACTION AMOUNT'.                                            
                                                                                
       01  P428-DTL-6.                                                          
           03  P428-DESC           PIC X(25) VALUE SPACES.                      
           03  FILLER              PIC X(03) VALUE SPACES.                      
           03  P428-CPF            PIC X(09) VALUE SPACES.                      
           03  FILLER              PIC X(02) VALUE SPACES.                      
           03  P428-JR-NO          PIC X(09) VALUE SPACES.                      
           03  FILLER              PIC X(04) VALUE SPACES.                      
           03  P428-DOC-NO         PIC X(06) VALUE SPACES.                      
           03  FILLER              PIC X(03) VALUE SPACES.                      
           03  P428-DTE-POST       PIC X(10) VALUE SPACES.                      
           03  FILLER              PIC X(06) VALUE SPACES.                      
           03  P428-TRAN-AMT       PIC ZZZ,ZZZ,ZZ9.99.                          
           03  P428-DRCR           PIC X(02) VALUE SPACE.                       
                                                                                
       01  P428-CASE-TOTAL-LINE.                                                
           03  FILLER                  PIC X(77) VALUE SPACES.                  
           03  P428-CASE-AMT           PIC ZZZ,ZZZ,ZZ9.99.                      
           03  P428-CASE-DRCR          PIC X(02) VALUE SPACE.                   
                                                                                
      **************************************************************            
      *                                                            *            
      *           LAY-OUT FOR SUMMARY LISTING                      *            
      *                                                            *            
      **************************************************************            
       01  L428-HDG-1.                                                          
           03  FILLER              PIC X(38) VALUE SPACES.                      
           03  FILLER              PIC X(60) VALUE                              
               'SUMMARY LIST OF TRANSFER OF COMMITMENT DEPOSIT'.                
                                                                                
       01  L428-HDG-2.                                                          
           03  FILLER              PIC X(34) VALUE SPACES.                      
           03  FILLER              PIC X(45) VALUE                              
              'TRANSFERRED TO MORTGAGE LOAN FOR WEEK ENDING '.                  
           03  L428-HD2-DATE       PIC X(10).                                   
                                                                                
       01  L428-HDG-3.                                                          
           03  FILLER              PIC X(09) VALUE SPACES.                      
           03  FILLER              PIC X(30) VALUE                              
              'CREDIT     00 00  00 00 00 810'.                                 
           03  FILLER              PIC X(30) VALUE                              
              '  -  MORTGAGE LOAN ACCOUNT'.                                     
                                                                                
       01  L428-HDG-4.                                                          
           03  FILLER              PIC X(09) VALUE SPACES.                      
           03  FILLER              PIC X(20) VALUE 'BRANCH OFFICE'.             
           03  FILLER              PIC X(07) VALUE SPACES.                      
           03  FILLER              PIC X(14) VALUE 'JR VR NO'.                  
           03  FILLER              PIC X(05) VALUE SPACES.                      
           03  FILLER              PIC X(09) VALUE 'NO OF A/C'.                 
           03  FILLER              PIC X(10) VALUE SPACES.                      
           03  FILLER              PIC X(18) VALUE '      AMOUNT'.              
                                                                                
       01  L428-DTL-1.                                                          
           03  FILLER              PIC X(09)  VALUE SPACES.                     
           03  L428-NT-DESC        PIC X(20)  VALUE SPACES.                     
           03  FILLER              PIC X(07)  VALUE SPACES.                     
           03  L428-JR-NO          PIC X(14)  VALUE SPACES.                     
           03  FILLER              PIC X(06)  VALUE SPACES.                     
           03  L428-NUM-ACC        PIC ZZ,ZZ9.                                  
           03  FILLER              PIC X(10)  VALUE SPACES.                     
           03  L428-DOLLAR-SIGN    PIC X(01)  VALUE SPACES.                     
           03  L428-AMOUNT         PIC Z,ZZZ,ZZZ,ZZ9.99.                        
                                                                                
       01  L428-TOTAL-LINE.                                                     
           03  FILLER              PIC X(56)  VALUE SPACES.                     
           03  L428-TOTAL-ACC      PIC ZZ,ZZ9.                                  
           03  FILLER              PIC X(10)  VALUE SPACES.                     
           03  L428-TOTAL-DOLLAR   PIC X(01)  VALUE SPACES.                     
           03  L428-TOTAL-AMOUNT   PIC Z,ZZZ,ZZZ,ZZ9.99.                        
                                                                                
      *=======================================================*                 
      *    LINKAGE VARIABLES                                  *                 
      *=======================================================*                 
       01  WS-LINK-REC.                                                         
           05 WS-LINK-NUM-OFFICE         PIC X(8).                              
           05 WS-LINK-NUM-TYPE-OFFICE    PIC X(15).                             
           05 WS-LINK-NUM-SQNC           PIC X(2).                              
                                                                                
       01  WS-SQL-CODE                   PIC 9(4).                              
                                                                                
       COPY P13COMM4.                                                           
                                                                                
                                                                                
      **************************************************************            
       PROCEDURE DIVISION.                                                      
      **************************************************************            
                                                                                
      *-------------------*                                                     
       000-MAIN-ROUTINE.                                                        
      *-------------------*                                                     
           PERFORM 050-OPEN-FILES     THRU 050-EXIT.                            
                                                                                
           PERFORM 100-PROCESS-INDATA THRU 100-EXIT                             
                   UNTIL EOF-F450.                                              
                                                                                
           IF NOT WS5-PRTED-SUMMARY                                             
              PERFORM 500-PRINT-SUMMARY THRU 500-EXIT.                          
                                                                                
           PERFORM 600-PRINT-TOTAL THRU 600-EXIT.                               
           PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                             
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *----------------*                                                        
       050-OPEN-FILES.                                                          
      *----------------*                                                        
           OPEN INPUT BP13F450                                                  
                      BP13K130                                                  
                      BP13K060                                                  
               OUTPUT BP13L428                                                  
                      BP13P428.                                                 
                                                                                
           IF BP13K130-STATUS NOT = 0 AND 97                                    
              DISPLAY ' OPENING ERROR, BP13K130-STATUS '                        
                        BP13K130-STATUS                                         
              MOVE BP13K130-STATUS TO RETURN-CODE                               
              PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                          
                                                                                
           IF BP13K060-STATUS NOT = 0 AND 97                                    
              DISPLAY ' OPENING ERROR, BP13K060-STATUS '                        
                       BP13K060-STATUS                                          
              MOVE BP13K060-STATUS TO RETURN-CODE                               
              PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                          
                                                                                
       050-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ***********************************************************               
      *  1.  READ F450 FILE AT END EXIT                         *               
      *  2.  READ F450 FILE USING REGN                          *               
      *  3.  IF RECORD FOUND                                    *               
      *         PRINT OUT K410 DETAILS BEFORE UPDATE            *               
      *         OVERWRITE K410 WITH DETAILS FROM F450           *               
      *      ELSE                                               *               
      *      IF RECORD NOT FOUND                                *               
      *         WRITE TO K410 WITH DETAILS FROM F450            *               
      *      ELSE                                               *               
      *         ERROR                                           *               
      ***********************************************************               
      *-------------------*                                                     
       100-PROCESS-INDATA.                                                      
      *-------------------*                                                     
           READ BP13F450 AT END                                                 
                MOVE 'Y' TO EOF-F450-IND                                        
                GO TO 100-EXIT.                                                 
                                                                                
           ADD 1             TO WS-NUM-READ.                                    
           ADD F450-AMT-LOAN TO WS4-TOTAL-MORT-LOAN.                            
           ADD 1             TO WS4-NUM-ACC.                                    
                                                                                
           IF WS-NUM-READ = 1                                                   
              MOVE F450-CDE-BO    TO WS2-PREV-BO                                
              MOVE F450-CDE-JR-VR TO WS2-PREV-JR.                               
                                                                                
      *-----------------------------------------------*                         
      * IF CHANGE IN NEW TOWN CODE - PRINT SUMMARY    *                         
      *                              UPDATE PREV NT   *                         
      * IF NO CHANGE IN NEW TOWN CODE - ACCUMULATE    *                         
      *-----------------------------------------------*                         
           IF (WS2-PREV-BO NOT = F450-CDE-BO) OR                                
              (WS2-PREV-JR NOT = F450-CDE-JR-VR)                                
              PERFORM 500-PRINT-SUMMARY THRU 500-EXIT.                          
                                                                                
           ADD 1             TO WS-NUM-ACC.                                     
           ADD F450-AMT-LOAN TO WS4-SUBTOT-MORT-LOAN.                           
                                                                                
      *------------------------------------------------------------*            
      * FOR EACH RECORD READ (EACH CASE READ)                      *            
      *   - PRINT HEADING                                          *            
      *   - PRINT DETAIL LINE 1 TO 5                               *            
      *   - READ K130 AND PRINT DETAIL 6 UNTIL CHANGE IN  REGN     *            
      *------------------------------------------------------------*            
           PERFORM 200-PRINT-DETAIL-HEADING THRU 200-EXIT.                      
                                                                                
           PERFORM 220-PRINT-DETAIL-1-5     THRU 220-EXIT.                      
                                                                                
           PERFORM 240-READ-K130            THRU 240-EXIT.                      
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ****************************************************************          
      *            PRINT HEADING FOR DETAIL LIST                     *          
      ****************************************************************          
      *-------------------------*                                               
       200-PRINT-DETAIL-HEADING.                                                
      *-------------------------*                                               
           MOVE 1                          TO WS-NUM-LINE-P428.                 
           MOVE SPACES                     TO P428-PRT-REC.                     
           ADD 1                           TO WS-NUM-PAGE-P428.                 
           MOVE WS-NUM-PAGE-P428           TO COMM-HD1-PAGE-NO.                 
           MOVE 'BP13P428'                 TO COMM-HD1-RPT-ID.                  
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-CURR-CCYYMMDD.                 
           MOVE WS-CURR-CC                 TO WS-CUR-CC  WS-EDIT-CC.            
           MOVE WS-CURR-YY                 TO WS-CUR-YY  WS-EDIT-YY.            
           MOVE WS-CURR-MM                 TO WS-CUR-MM  WS-EDIT-MM.            
           MOVE WS-CURR-DD                 TO WS-CUR-DD  WS-EDIT-DD.            
           MOVE WS-EDITED-DATE             TO COMM-HD1-DATE                     
                                              P428-HD2-DATE.                    
                                                                                
           WRITE P428-PRT-REC AFTER   PAGE.                                     
           WRITE P428-PRT-REC FROM    COMM-HDG-1 AFTER 2.                       
           WRITE P428-PRT-REC FROM    P428-HDG-1 AFTER 2.                       
           WRITE P428-PRT-REC FROM    P428-HDG-2 AFTER 1.                       
           MOVE  SPACES               TO P428-PRT-REC.                          
           WRITE P428-PRT-REC AFTER 1.                                          
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------*                                               
       220-PRINT-DETAIL-1-5.                                                    
      *-------------------------*                                               
           MOVE SPACE  TO  WS5-PRTED-SUMRY-IND.                                 
                                                                                
      **** PRINT DETAIL 1 ****                                                  
           MOVE F450-CDE-BO TO P428-BO-NAME.                                    
                                                                                
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-1 AFTER 1.                          
           MOVE  SPACES    TO P428-PRT-REC.                                     
                                                                                
      **** PRINT DETAIL 2 ****                                                  
           STRING F450-SCHEME '-' F450-ACCOUNT '-' F450-CHK                     
                  F450-LESSEE-CD DELIMITED BY SIZE INTO                         
                  P428-SCH-ACC.                                                 
           MOVE F450-NAME1 TO P428-NAME1.                                       
           MOVE F450-CPF1  TO P428-CPF1.                                        
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-2 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
      **** PRINT DETAIL 3 ****                                                  
           STRING F450-CDE-NT ' / ' F450-NUM-REGN                               
              DELIMITED BY SIZE INTO  P428-SALES-REF.                           
           MOVE F450-NAME2 TO P428-NAME2.                                       
           MOVE F450-CPF2  TO P428-CPF2.                                        
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-3 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
      **** PRINT DETAIL 4 ****                                                  
           MOVE F450-NUM-REGN      TO P428-REGN.                                
           MOVE F450-NAME3         TO P428-NAME3.                               
           MOVE F450-CPF3          TO P428-CPF3.                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-4 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
      **** PRINT DETAIL 5 ****                                                  
           STRING F450-SO-EFF-DD '/' F450-SO-EFF-MM '/' F450-SO-EFF-YY          
              DELIMITED BY SIZE INTO P428-SO-DATE.                              
           MOVE F450-NAME4         TO P428-NAME4.                               
           MOVE F450-CPF4          TO P428-CPF4.                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-5 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
      **** PRINT HEADING 4 & HEADING 5 ****                                     
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-HDG-3 AFTER 2.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-HDG-4 AFTER 2.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
           WRITE P428-PRT-REC.                                                  
                                                                                
       220-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *  READ K130 STARTING FROM F450  REGN                            *        
      *     IF RECORD FOUND - PRINT DETAIL 6 UNTIL CHANGE IN REGN      *        
      *     WHEN CHANGE IN ORIG REG - PRINT TOTAL                      *        
      ******************************************************************        
      *-------------------------*                                               
       240-READ-K130.                                                           
      *-------------------------*                                               
           MOVE F450-NUM-REGN      TO K130-NUM-ORIG-REGN.                       
           START BP13K130 KEY = K130-NUM-ORIG-REGN.                             
                                                                                
           IF BP13K130-REC-FOUND                                                
                                                                                
              PERFORM 260-PRINT-DETAIL-6 THRU 260-EXIT                          
                 UNTIL K130-NUM-ORIG-REGN > F450-NUM-REGN                       
                                                                                
              PERFORM 400-PRINT-EACH-CASE-TOTAL THRU 400-EXIT                   
                                                                                
           ELSE                                                                 
           IF BP13K130-REC-NOTFND                                               
              MOVE SPACES TO P428-DTL-6                                         
              DISPLAY ' RECORD NOT FOUND IN BP13K130, KEY '                     
                        F450-NUM-REGN                                           
           ELSE                                                                 
              DISPLAY ' ERROR READING BP13K130, STATUS ' BP13K130-STATUS        
              MOVE BP13K130-STATUS TO RETURN-CODE                               
              PERFORM 999-CLOSE-ROUTINE THRU 999-EXIT.                          
       240-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *             PRINT 6TH TYPE OF DETAIL LINE                      *        
      ******************************************************************        
      *-------------------------*                                               
       260-PRINT-DETAIL-6.                                                      
      *-------------------------*                                               
           READ BP13K130 NEXT AT END                                            
                MOVE HIGH-VALUES TO K130-KEY-FLD                                
                GO TO 260-EXIT.                                                 
                                                                                
           IF K130-NUM-ORIG-REGN > F450-NUM-REGN                                
              GO TO 260-EXIT.                                                   
                                                                                
           SET TRN-IDX TO 1.                                                    
           SEARCH WS-TRANS                                                      
               AT END MOVE SPACES TO P428-DESC                                  
             WHEN WS-TRN-CDE(TRN-IDX) = K130-TRANS-TYPE                         
                MOVE WS-TRN-DESC(TRN-IDX) TO P428-DESC.                         
                                                                                
           MOVE K130-NUM-CPF-APPL  TO P428-CPF.                                 
           MOVE K130-NUM-JRNO      TO P428-JR-NO.                               
           MOVE K130-NUM-DOC       TO P428-DOC-NO.                              
           MOVE K130-DTE-POST      TO WS1-DATE.                                 
           MOVE WS1-DD             TO WS1-EDIT-DD.                              
           MOVE WS1-MM             TO WS1-EDIT-MM.                              
           MOVE WS1-CCYY           TO WS1-EDIT-CCYY.                            
           MOVE WS1-EDITED-DATE    TO P428-DTE-POST.                            
                                                                                
           IF K130-AMT-CASH NOT NUMERIC                                         
              MOVE ZEROS        TO K130-AMT-CASH.                               
                                                                                
           MOVE K130-AMT-CASH   TO P428-TRAN-AMT.                               
                                                                                
      *----------------------------------------------------*                    
      * FOR TRANSACTION TYPE 19 AND 21                     *                    
      *   - REVERSE THE SIGN FOR THE AMOUNT                *                    
      * FOR ALL TRANSACTIONS - ADD ACCORDINGLY             *                    
      *----------------------------------------------------*                    
           IF K130-TRANS-TYPE = '19' OR '21'                                    
              COMPUTE K130-AMT-CASH = K130-AMT-CASH * -1.                       
                                                                                
           ADD  K130-AMT-CASH   TO WS4-TOTAL-CASE-AMT.                          
                                                                                
           IF K130-AMT-CASH < 0                                                 
              MOVE 'DR' TO P428-DRCR                                            
           ELSE                                                                 
           IF K130-AMT-CASH > 0                                                 
              MOVE 'CR' TO P428-DRCR                                            
           ELSE                                                                 
              MOVE '  ' TO P428-DRCR.                                           
                                                                                
           IF (WS-NUM-LINE-P428 > WS3-MAX-LINES-P428)                           
              PERFORM 200-PRINT-DETAIL-HEADING THRU 200-EXIT                    
              PERFORM 300-PRINT-DETAIL-1-5     THRU 300-EXIT.                   
                                                                                
           WRITE P428-PRT-REC FROM P428-DTL-6 AFTER 1.                          
           MOVE  SPACES TO P428-PRT-REC.                                        
           ADD   1      TO WS-NUM-LINE-P428.                                    
                                                                                
       260-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *           REPEAT THE SUB HEADINGS WHEN CHANGE IN PAGE          *        
      ******************************************************************        
      *-------------------------*                                               
       300-PRINT-DETAIL-1-5.                                                    
      *-------------------------*                                               
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-1 AFTER 1.                          
           MOVE  SPACES    TO P428-PRT-REC.                                     
                                                                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-2 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-3 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-4 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
           ADD 1           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-DTL-5 AFTER 1.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-HDG-3 AFTER 2.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
                                                                                
           ADD 2           TO WS-NUM-LINE-P428.                                 
           WRITE P428-PRT-REC FROM P428-HDG-4 AFTER 2.                          
           MOVE SPACES     TO P428-PRT-REC.                                     
           WRITE P428-PRT-REC.                                                  
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *           PRINT DETAIL TOTAL FOR EACH CASE                     *        
      ******************************************************************        
      *-------------------------*                                               
       400-PRINT-EACH-CASE-TOTAL.                                               
      *-------------------------*                                               
           WRITE P428-PRT-REC  FROM  WS3-DASH-LINE AFTER 2.                     
           MOVE  SPACES              TO P428-PRT-REC.                           
           MOVE  WS4-TOTAL-CASE-AMT  TO P428-CASE-AMT.                          
                                                                                
           IF    WS4-TOTAL-CASE-AMT  > 0                                        
                 MOVE 'CR'  TO P428-CASE-DRCR                                   
           ELSE                                                                 
           IF    WS4-TOTAL-CASE-AMT  < 0                                        
                 MOVE 'DR'  TO P428-CASE-DRCR                                   
           ELSE                                                                 
                 MOVE '  '  TO P428-CASE-DRCR.                                  
                                                                                
           WRITE P428-PRT-REC  FROM  P428-CASE-TOTAL-LINE AFTER 1.              
           WRITE P428-PRT-REC  FROM  WS3-DASH-LINE AFTER 1.                     
           MOVE  SPACES              TO P428-PRT-REC.                           
           WRITE P428-PRT-REC.                                                  
           ADD   3                   TO WS-NUM-LINE-P428.                       
           MOVE ZEROES               TO WS4-TOTAL-CASE-AMT.                     
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *             PRINT  SUMMARY  (L428)                             *        
      ******************************************************************        
      *-------------------------*                                               
       500-PRINT-SUMMARY.                                                       
      *-------------------------*                                               
           MOVE 'Y'         TO WS5-PRTED-SUMRY-IND.                             
                                                                                
           MOVE SPACES       TO BP13COMM4-REC.                                  
           INITIALIZE           BP13COMM4-REC.                                  
                                                                                
           MOVE WS2-PREV-BO  TO WS-LINK-NUM-OFFICE.                             
           MOVE 'BO'         TO WS-LINK-NUM-TYPE-OFFICE.                        
           MOVE '00'         TO WS-LINK-NUM-SQNC.                               
                                                                                
           CALL 'BP13C902' USING                                                
                 WS-LINK-REC, BP13COMM4-REC                                     
           END-CALL.                                                            
                                                                                
           IF COMM4-CDE-SYSERR NOT = 0                                          
              MOVE COMM4-CDE-SYSERR TO WS-SQL-CODE                              
              MOVE SPACES           TO L428-NT-DESC                             
              IF COMM4-CDE-SYSERR = 100                                         
                 DISPLAY 'OFFICE NOT FND = ' WS-LINK-REC                        
                 DISPLAY 'SQL ERROR CODE = ' WS-SQL-CODE                        
              ELSE                                                              
                 DISPLAY 'ERROR IN READING OFFICE TABLE' WS-SQL-CODE            
              END-IF                                                            
           ELSE                                                                 
              MOVE COMM4-NME-OFFICE-BO(1) TO L428-NT-DESC                       
           END-IF.                                                              
                                                                                
           IF WS-NUM-LINE-L428 > WS3-MAX-LINES-L428                             
              PERFORM 550-PRINT-SUMMARY-HEADING THRU 550-EXIT                   
              MOVE 1  TO WS-NUM-LINE-L428.                                      
                                                                                
           MOVE WS2-PREV-JR          TO L428-JR-NO.                             
           MOVE WS-NUM-ACC           TO L428-NUM-ACC.                           
           MOVE WS4-SUBTOT-MORT-LOAN TO L428-AMOUNT.                            
           MOVE '$'                  TO L428-DOLLAR-SIGN.                       
           MOVE ZEROES               TO WS4-SUBTOT-MORT-LOAN                    
                                        WS-NUM-ACC.                             
           ADD  1                    TO WS-NUM-LINE-L428.                       
           MOVE F450-CDE-BO          TO WS2-PREV-BO.                            
           MOVE F450-CDE-JR-VR       TO WS2-PREV-JR.                            
                                                                                
           WRITE L428-PRT-REC FROM L428-DTL-1 AFTER 1.                          
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *           PRINT HEADING FOR SUMMARY LIST                       *        
      ******************************************************************        
      *-------------------------*                                               
       550-PRINT-SUMMARY-HEADING.                                               
      *-------------------------*                                               
           MOVE SPACES                      TO L428-PRT-REC.                    
           ADD 1                            TO WS-NUM-PAGE-L428.                
           MOVE WS-NUM-PAGE-L428            TO COMM-HD1-PAGE-NO.                
           MOVE 'BP13L428'                  TO COMM-HD1-RPT-ID.                 
           MOVE FUNCTION CURRENT-DATE(1:8)  TO WS-CURR-CCYYMMDD.                
           MOVE WS-CURR-CC                  TO WS-CUR-CC  WS-EDIT-CC.           
           MOVE WS-CURR-YY                  TO WS-CUR-YY  WS-EDIT-YY.           
           MOVE WS-CURR-MM                  TO WS-CUR-MM  WS-EDIT-MM.           
           MOVE WS-CURR-DD                  TO WS-CUR-DD  WS-EDIT-DD.           
           MOVE WS-EDITED-DATE              TO COMM-HD1-DATE                    
                                               L428-HD2-DATE.                   
                                                                                
           WRITE L428-PRT-REC AFTER   PAGE.                                     
           WRITE L428-PRT-REC FROM    COMM-HDG-1 AFTER 2.                       
           WRITE L428-PRT-REC FROM    L428-HDG-1 AFTER 2.                       
           WRITE L428-PRT-REC FROM    L428-HDG-2 AFTER 1.                       
           WRITE L428-PRT-REC FROM    L428-HDG-3 AFTER 2.                       
           WRITE L428-PRT-REC FROM    L428-HDG-4 AFTER 2.                       
           MOVE  SPACES               TO L428-PRT-REC.                          
           WRITE L428-PRT-REC AFTER 1.                                          
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
      *           PRINT TOTAL FOR   SUMMARY LIST                       *        
      ******************************************************************        
      *-------------------------*                                               
       600-PRINT-TOTAL.                                                         
      *-------------------------*                                               
           WRITE L428-PRT-REC FROM WS3-DASH-LINE AFTER 2.                       
           MOVE  SPACES              TO L428-PRT-REC.                           
           MOVE  WS4-NUM-ACC         TO L428-TOTAL-ACC.                         
           MOVE  '$'                 TO L428-TOTAL-DOLLAR.                      
           MOVE  WS4-TOTAL-MORT-LOAN TO L428-TOTAL-AMOUNT.                      
                                                                                
           WRITE L428-PRT-REC FROM L428-TOTAL-LINE AFTER 1.                     
           WRITE L428-PRT-REC FROM WS3-DASH-LINE AFTER 1.                       
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-----------------*                                                       
       999-CLOSE-ROUTINE.                                                       
      *-----------------*                                                       
           CLOSE BP13F450                                                       
                 BP13K130                                                       
                 BP13K060                                                       
                 BP13L428                                                       
                 BP13P428.                                                      
                                                                                
           DISPLAY ' ** BP13C428 ** '.                                          
           DISPLAY ' NO. OF RECORDS READ FROM F450  = '                         
                     WS-NUM-READ.                                               
                                                                                
           IF BP13K130-STATUS NOT = 0 AND 97                                    
              DISPLAY ' CLOSING ERROR, BP13K130-STATUS '                        
                        BP13K130-STATUS.                                        
                                                                                
           IF BP13K060-STATUS NOT = 0 AND 97                                    
              DISPLAY ' CLOSING ERROR, BP13K060-STATUS '                        
                       BP13K060-STATUS.                                         
                                                                                
           STOP RUN.                                                            
                                                                                
       999-EXIT.                                                                
           EXIT.                                                                
