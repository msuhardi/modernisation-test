      **************************                                                
       IDENTIFICATION DIVISION.                                                 
      **************************                                                
       PROGRAM-ID.    BP13CB0I.                                                 
      *AUTHOR.        MARGE LAM KO.                                             
      *DATE-WRITTEN.  24 APR 2017.                                              
                                                                                
      * =========================================================== *           
      * SYSTEM OF COMMITMENT (BP13)                                 *           
      * =========================================================== *           
      *   OBJECTIVE   : THIS PROGRAM USES RECORDS FROM              *           
      *                 BP13KD07, BP13K800, BP13KD00 TO             *           
      *                 CHECK GRANT_ASMNT DATE APPROVAL SO THAT IT  *           
      *                 CAN BE DROPPED FROM THE LIVE TABLE TO THE EX*           
      *                 OR DELETED FROM EX TABLE                    *           
      *                                                             *           
      *   IF FILE PROCESS DATE > DB2 APPROVAL/REJECTION/WITHDRAWAL  *           
      *      - DROP CASES TO EX TABLES                              *           
      *      - OUTPUT TO FILE FOR CREATION                          *           
      *   IF FILE PROCESS DATE = DB2 APPROVAL/REJECTION/WITHDRAWAL  *           
      *      - JUST DELETE FROM THE LIVE TABLE                      *           
      *      - OUTPUT TO FILE FOR CREATION                          *           
      *   IF FILE PROCESS DATE > DB2 APPROVAL/REJECTION/WITHDRAWAL (EX)         
      *      - OUTPUT TO FILE FOR CREATION                          *           
      *   IF FILE PROCESS DATE = DB2 APPROVAL/REJECTION/WITHDRAWAL (EX)         
      *      - JUST DELETE FROM THE EX TABLE                        *           
      *      - OUTPUT TO FILE FOR CREATION                          *           
      *                                                             *           
      *   INPUT FILES :                                             *           
      *   1.  BP13FD07 - PREJULY CASES                              *           
      *   2.  PREJF800 - PREJULY IN K800 BUT NOT IN KD07            *           
      *   3.  BP13F800 - DBSS CASES IN K800                         *           
      *   4.  BP13FD00 - DBSS CASES IN FD00                         *           
      *                                                             *           
      *   OUTPUT FILE                                               *           
      *   1.  P13FD07A - FD07 FILE FOR CREATION USING BP13CB0J      *           
      *   2.  P13F800B - PREJULY IN K800 BUT NOT IN KD07            *           
      *   3.  P13F800A - DBSS FILE FOR CREATION USING BP13CB0K      *           
      *   4.  BP13FD00 - DBSS FILE FOR CREATION USING BP13CB0L      *           
      *                                                             *           
      *   TABLES:                                                   *           
      *   1.  GRANT_ASMNT                                           *           
      *   2.  GRANT_ASMNT_PERSON                                    *           
      *   3.  GRANT_RCVRY                                           *           
      *   4.  EX_GRANT_ASMNT                                        *           
      *   5.  EX_GRANT_ASMNT_PERSON                                 *           
      *   6.  GRANT_UPDATE_LOG                                      *           
      *                                                             *           
      * CHQ REQ     DATE     BY  DESCRIPTIONS                       *           
      * -------- ---------- ---- ---------------------------------- *           
      * BP13     24/04/2017 MRN1 NEW PROGRAM                        *           
      * =========================================================== *           
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13FD07 ASSIGN TO BP13FD07.                                  
                                                                                
           SELECT BP13F800 ASSIGN TO BP13F800.                                  
                                                                                
           SELECT PREJF800 ASSIGN TO PREJF800.                                  
                                                                                
           SELECT BP13KD05 ASSIGN       TO BP13KD05                             
                           ACCESS MODE  IS DYNAMIC                              
                           ORGANIZATION IS INDEXED                              
                           RECORD KEY   IS KD05-KEY-FLD                         
                           FILE STATUS  IS KD05-STATUS.                         
                                                                                
           SELECT BP13FD00 ASSIGN TO BP13FD00.                                  
                                                                                
           SELECT P13FD07A ASSIGN TO P13FD07A.                                  
                                                                                
           SELECT P13F800A ASSIGN TO P13F800A.                                  
                                                                                
           SELECT P13F800B ASSIGN TO P13F800B.                                  
                                                                                
           SELECT P13FD00A ASSIGN TO P13FD00A.                                  
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD   BP13FD07                                                            
            RECORD CONTAINS 700 CHARACTERS                                      
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       COPY BP13KD07.                                                           
                                                                                
       FD  BP13KD05                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
       COPY BP13KD05.                                                           
                                                                                
       FD   BP13F800                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13K800.                                                           
                                                                                
       FD   PREJF800                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       01 PREJF800-MASTER.                                                      
           05 FILLER                         PIC X(3).                          
           05 PREJ-NUM-REGN                  PIC X(8).                          
           05 FILLER                         PIC X(1228).                       
           05 PREJ-DTE-AHG-PROCESS           PIC X(8).                          
           05 PREJ-NUM-AHG-STATUS            PIC X(1).                          
           05 FILLER                         PIC X(278).                        
           05 PREJ-DTE-SHG-PROCESS           PIC X(8).                          
           05 PREJ-NUM-SHG-STATUS            PIC X(1).                          
           05 FILLER                         PIC X(465).                        
                                                                                
       FD   BP13FD00                                                            
            RECORD CONTAINS 1600 CHARACTERS                                     
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       COPY BP13KD00.                                                           
                                                                                
       FD   P13FD07A                                                            
            RECORD CONTAINS 700 CHARACTERS                                      
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       COPY BP13FD07.                                                           
                                                                                
       FD   P13F800A                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       COPY BP13F800.                                                           
                                                                                
       FD   P13F800B                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       01   P13F800B-REC          PIC X(2000).                                  
                                                                                
       FD   P13FD00A                                                            
            RECORD CONTAINS 1600 CHARACTERS                                     
            LABEL RECORDS ARE OMITTED                                           
            RECORDING MODE IS F.                                                
       COPY BP13FD00.                                                           
                                                                                
       COPY AV02COMM.                                                           
                                                                                
      *************************                                                 
       WORKING-STORAGE SECTION.                                                 
      *************************                                                 
                                                                                
       01  KD05-STATUS              PIC 9(2)  VALUE ZEROS.                      
       01  CNT-FD07-READ            PIC 9(06) VALUE ZEROES.                     
       01  CNT-F800-READ            PIC 9(06) VALUE ZEROES.                     
       01  CNT-PREJ-F800-READ       PIC 9(06) VALUE ZEROES.                     
       01  CNT-FD00-READ            PIC 9(06) VALUE ZEROES.                     
       01  WS-KD05-EOF              PIC X     VALUE 'N'.                        
       01  WS-EOF-FD00              PIC X     VALUE 'N'.                        
       01  WS-CURSOR1-EOF           PIC X     VALUE 'N'.                        
       01  WS-CURSOR2-EOF           PIC X     VALUE 'N'.                        
       01  WS-CURSOR3-EOF           PIC X     VALUE 'N'.                        
       01  WS-WRITTEN               PIC X     VALUE 'N'.                        
       01  WS-DELETE-ONLY           PIC X     VALUE 'N'.                        
       01  WS-GRNT-UPD-LOG          PIC 9(06) VALUE ZEROES.                     
       01  WS-CREATE-FD07           PIC 9(06) VALUE ZEROES.                     
       01  WS-CREATE-PREJ           PIC 9(06) VALUE ZEROES.                     
       01  WS-CREATE-F800           PIC 9(06) VALUE ZEROES.                     
       01  WS-CREATE-FD00           PIC 9(06) VALUE ZEROES.                     
       01  WS-EX-GRANT-INS          PIC 9(06) VALUE ZEROES.                     
       01  WS-EX-PRSN-INS           PIC 9(06) VALUE ZEROES.                     
       01  WS-RCVRY-INS             PIC 9(06) VALUE ZEROES.                     
       01  WS-EX-GRANT-DELETE       PIC 9(06) VALUE ZEROES.                     
       01  WS-EX-PERSON-DELETE      PIC 9(06) VALUE ZEROES.                     
       01  WS-GRANT-RCVRY-DELETE    PIC 9(06) VALUE ZEROES.                     
       01  WS-TIME-CREATE           PIC X(26) VALUE SPACES.                     
       01  WS-GRANT-DELETE          PIC 9(06) VALUE ZEROES.                     
       01  WS-PERSON-DELETE         PIC 9(06) VALUE ZEROES.                     
       01  WS-EOF-FD07              PIC X     VALUE SPACE.                      
       01  WS-EOF-F800              PIC X     VALUE SPACE.                      
       01  WS-EOF-PREJ-F800         PIC X     VALUE SPACE.                      
       01  WS-GRANT-ASMNT-FND       PIC X     VALUE SPACE.                      
       01  WS-EX-GRANT-ASMNT-FND    PIC X     VALUE SPACE.                      
       01  WS-KD05-AMT-AHG          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-KD05-AMT-SHG          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-KD05-AMT-SUG          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-KD05-AMT-HGT          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-KD05-AMT-TUG          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-KD05-AMT-PHG          PIC S9(7)V99 VALUE ZEROES.                  
       01  WS-GRANT-AMT-SUM         PIC S9(7)V99 USAGE COMP-3.                  
       01  WS-GRANT-AMT-SUM-INDNULL PIC S9(4) COMP.                             
       01  WS-DATE                  PIC X(08) VALUE SPACES.                     
       01  WS-FORMAT-DATE           PIC X(08) VALUE SPACES.                     
       01  WS-DTE-APRV              PIC X(08) VALUE SPACES.                     
       01  WS-DTE-RJCT              PIC X(08) VALUE SPACES.                     
       01  WS-DTE-WDWL              PIC X(08) VALUE SPACES.                     
       01  WS-DTE-PROCESS           PIC X(08) VALUE SPACES.                     
       01  WS-KD07-DTE-PROCESS-HGT  PIC X(08) VALUE SPACES.                     
       01  WS-KD07-DTE-PROCESS-TUG  PIC X(08) VALUE SPACES.                     
       01  WS-KD00-DTE-PROCESS-HGT  PIC X(08) VALUE SPACES.                     
       01  WS-KD00-DTE-PROCESS-TUG  PIC X(08) VALUE SPACES.                     
       01  WS-KD00-DTE-PROCESS-PHG  PIC X(08) VALUE SPACES.                     
       01  WS-TABLE-DATE            PIC X(10) VALUE SPACES.                     
       01  WS-TIMESTAMP             PIC X(26) VALUE SPACES.                     
       01  WS-GRANT-TYPE            PIC X(3)  VALUE SPACES.                     
       01  WS-NUM-REGN              PIC X(8)  VALUE SPACES.                     
       01  WS-SQLCODE               PIC ---9.                                   
       01  WS-DTE-CCYYMMDD.                                                     
           05 WS-DTE-CCYY           PIC X(04) VALUE SPACES.                     
           05 WS-DTE-MM             PIC X(02) VALUE SPACES.                     
           05 WS-DTE-DD             PIC X(02) VALUE SPACES.                     
       01  WS-TIME-HHMMSS.                                                      
           05 WS-TIME-HH            PIC X(02) VALUE SPACES.                     
           05 WS-TIME-MM            PIC X(02) VALUE SPACES.                     
           05 WS-TIME-SS            PIC X(02) VALUE SPACES.                     
           05 WS-TIME-MS            PIC X(02) VALUE SPACES.                     
                                                                                
       01  WS-LOG-VARIABLE.                                                     
           05  WS-BEFORE-IMAGE      PIC X(600).                                 
           05  WS-AFTER-IMAGE       PIC X(600).                                 
           05  WS-SOURCE            PIC X(30).                                  
           05  WS-RGSTRN            PIC X(8).                                   
           05  WS-ACTION            PIC X(1).                                   
           05  WS-GRNT-TYPE         PIC X(6).                                   
           05  WS-TIMESTAMP-LOG     PIC X(26) VALUE SPACES.                     
                                                                                
       01  WS-SQL-STATUS.                                                       
           05 WS-SQL-OK             PIC S9(03) VALUE +000.                      
           05 WS-SQL-NFND           PIC S9(03) VALUE +100.                      
           05 WS-SQL-DUPREC         PIC S9(03) VALUE -803.                      
           05 WS-SQL-MORE-ROWS      PIC S9(03) VALUE -811.                      
                                                                                
      *--------------------------------------------------------------*          
      *                          SQLCA                               *          
      *--------------------------------------------------------------*          
           EXEC SQL INCLUDE SQLCA          END-EXEC.                            
           EXEC SQL INCLUDE P13VGASM       END-EXEC.                            
           EXEC SQL INCLUDE P13VGAPN       END-EXEC.                            
           EXEC SQL INCLUDE P13VGRCV       END-EXEC.                            
           EXEC SQL INCLUDE P13VGXAP       END-EXEC.                            
           EXEC SQL INCLUDE P13VGXAS       END-EXEC.                            
           EXEC SQL INCLUDE P13VGUPD       END-EXEC.                            
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      *----------*                                                              
       0000-MAIN.                                                               
      *----------*                                                              
                                                                                
           PERFORM 0500-OPEN-FILES    THRU 0500-EXIT.                           
           PERFORM 1200-READ-BP13FD07 THRU 1200-EXIT.                           
           PERFORM 1500-PROCESS-REC   THRU 1500-EXIT                            
                   UNTIL WS-EOF-FD07 = 'Y'.                                     
           PERFORM 4000-READ-BP13FD00 THRU 4000-EXIT                            
                   UNTIL WS-EOF-FD00 = 'Y'.                                     
           PERFORM 4100-READ-BP13F800 THRU 4100-EXIT                            
                   UNTIL WS-EOF-F800 = 'Y'.                                     
           PERFORM 4200-READ-PREJF800 THRU 4200-EXIT                            
                   UNTIL WS-EOF-PREJ-F800 = 'Y'.                                
           PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------*                                                        
       0500-OPEN-FILES.                                                         
      *----------------*                                                        
                                                                                
           OPEN INPUT  BP13FD07                                                 
                       BP13F800                                                 
                       PREJF800                                                 
                       BP13KD05                                                 
                       BP13FD00                                                 
                OUTPUT P13FD07A                                                 
                       P13F800B                                                 
                       P13F800A                                                 
                       P13FD00A.                                                
                                                                                
           IF KD05-STATUS NOT = 0 AND 97                                        
              DISPLAY 'BP13KD05 OPEN ERROR, STATUS: '                           
                      KD05-STATUS                                               
              PERFORM 9000-CLOSE-FILES       THRU 9000-EXIT                     
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                               
                                                                                
           ACCEPT WS-DTE-CCYYMMDD   FROM   DATE YYYYMMDD.                       
           ACCEPT WS-TIME-HHMMSS    FROM   TIME.                                
                                                                                
           PERFORM 1100-SET-DB2-TIMESTAMP THRU 1100-EXIT.                       
                                                                                
       0500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       1100-SET-DB2-TIMESTAMP.                                                  
      *----------------------------------------------------------------*        
            EXEC SQL                                                            
                 SET :WS-TIMESTAMP = CURRENT TIMESTAMP                          
            END-EXEC.                                                           
            IF SQLCODE NOT = 000                                                
               MOVE SQLCODE          TO WS-SQLCODE                              
               DISPLAY 'SQL ERROR SET DB2 TIMESTAMP'                            
               DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                         
               PERFORM 9999-SQL-ERROR THRU 9999-EXIT                            
            END-IF.                                                             
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       1200-READ-BP13FD07.                                                      
      *-------------------*                                                     
                                                                                
           READ BP13FD07 AT END                                                 
                MOVE HIGH-VALUES TO KD07-KEY-FLD                                
                MOVE 'Y' TO WS-EOF-FD07                                         
                GO TO 1200-EXIT.                                                
                                                                                
           PERFORM 1250-CHECK-NUMERIC-FD07 THRU 1250-EXIT.                      
           PERFORM 1260-CHECK-FD07-DATES   THRU 1260-EXIT.                      
                                                                                
           ADD 1 TO CNT-FD07-READ.                                              
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-----------------------*                                                 
       1250-CHECK-NUMERIC-FD07.                                                 
      *-----------------------*                                                 
           IF KD07-AMT-SHG-GRANT IS NOT NUMERIC                                 
              MOVE ZEROES TO KD07-AMT-SHG-GRANT                                 
           END-IF.                                                              
           IF KD07-AMT-SHG-RECOVER IS NOT NUMERIC                               
              MOVE ZEROES TO KD07-AMT-SHG-RECOVER                               
           END-IF.                                                              
           IF KD07-AMT-AHG-GRANT IS NOT NUMERIC                                 
              MOVE ZEROES TO KD07-AMT-AHG-GRANT                                 
           END-IF.                                                              
           IF KD07-AMT-AHG-RECOVER IS NOT NUMERIC                               
              MOVE ZEROES TO KD07-AMT-AHG-RECOVER                               
           END-IF.                                                              
           IF KD07-AMT-SUG-GRANT IS NOT NUMERIC                                 
              MOVE ZEROES TO KD07-AMT-SUG-GRANT                                 
           END-IF.                                                              
           IF KD07-AMT-SUG-RECOVER IS NOT NUMERIC                               
              MOVE ZEROES TO KD07-AMT-SUG-RECOVER                               
           END-IF.                                                              
                                                                                
       1250-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       1260-CHECK-FD07-DATES.                                                   
      *-------------------*                                                     
           MOVE KD07-DTE-HSGNT-APPROVE TO WS-IN-DATE.                           
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-HSGNT-APPROVE                         
           END-IF.                                                              
                                                                                
           STRING KD07-DTE-HSGNT-REJECT(5:4)                                    
                  KD07-DTE-HSGNT-REJECT(3:2)                                    
                  KD07-DTE-HSGNT-REJECT(1:2)                                    
                DELIMITED BY SIZE                                               
                INTO WS-FORMAT-DATE.                                            
                                                                                
           MOVE WS-FORMAT-DATE TO WS-IN-DATE                                    
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN = '000'                                                 
              MOVE WS-FORMAT-DATE TO KD07-DTE-HSGNT-REJECT                      
           ELSE                                                                 
              MOVE '00010101' TO KD07-DTE-HSGNT-REJECT                          
           END-IF.                                                              
                                                                                
           MOVE KD07-DTE-HSGNT-APPROVE-TOPUP TO WS-IN-DATE                      
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-HSGNT-APPROVE-TOPUP                   
           END-IF.                                                              
                                                                                
           MOVE KD07-DTE-HSGNT-REJECT-TOPUP TO WS-IN-DATE                       
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-HSGNT-REJECT-TOPUP                    
           END-IF.                                                              
                                                                                
                                                                                
           MOVE KD07-DTE-AHG-PROCESS TO WS-IN-DATE                              
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-AHG-PROCESS                           
           END-IF.                                                              
                                                                                
           MOVE KD07-DTE-SHG-PROCESS TO WS-IN-DATE                              
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-SHG-PROCESS                           
           END-IF.                                                              
                                                                                
           MOVE KD07-DTE-SUG-PROCESS TO WS-IN-DATE                              
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD07-DTE-SUG-PROCESS                           
           END-IF.                                                              
                                                                                
       1260-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       1500-PROCESS-REC.                                                        
      *-----------------*                                                       
           MOVE 'N' TO WS-WRITTEN.                                              
           MOVE KD07-NUM-REGN TO WS-NUM-REGN.                                   
                                                                                
           PERFORM 1700-GET-KD05-SUM THRU 1700-EXIT.                            
                                                                                
           IF KD07-NUM-AHG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'AHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD07-NUM-AHG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-AHG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-AHG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-DTE-AHG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD07-DTE-AHG-PROCESS = WS-DTE-PROCESS                    
                       IF KD07-NUM-AHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD07-REC FROM BP13KD07-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD07                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD07-NUM-AHG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-AHG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-AHG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-DTE-AHG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD07-REC FROM BP13KD07-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD07                               
                       END-IF                                                   
                    ELSE                                                        
                       IF KD07-DTE-AHG-PROCESS = WS-DTE-PROCESS                 
                          IF KD07-NUM-AHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD07-REC FROM BP13KD07-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD07                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD07-NUM-SHG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'SHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD07-NUM-SHG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-SHG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-SHG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-DTE-SHG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD07-DTE-SHG-PROCESS = WS-DTE-PROCESS                    
                       IF KD07-NUM-SHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD07-REC FROM BP13KD07-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD07                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD07-NUM-SHG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-SHG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-SHG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-DTE-SHG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD07-REC FROM BP13KD07-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD07                               
                       END-IF                                                   
                    ELSE                                                        
                       IF KD07-DTE-SHG-PROCESS = WS-DTE-PROCESS                 
                          IF KD07-NUM-SHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD07-REC FROM BP13KD07-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD07                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD07-NUM-SUG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'SUG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD07-NUM-SUG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-SUG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-NUM-SUG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF KD07-DTE-SUG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD07-DTE-SUG-PROCESS = WS-DTE-PROCESS                    
                       IF KD07-NUM-SUG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-SUG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD07-REC FROM BP13KD07-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD07                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD07-NUM-SUG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-SUG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-NUM-SUG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF KD07-DTE-SUG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD07-REC FROM BP13KD07-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD07                               
                       END-IF                                                   
                    ELSE                                                        
                       IF KD07-DTE-SUG-PROCESS = WS-DTE-PROCESS                 
                          IF KD07-NUM-SUG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-SUG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD07-REC FROM BP13KD07-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD07                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD07-NUM-HSGNT-STATUS = 'A' OR 'R' OR 'W'                         
              MOVE 'HGT' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD07-NUM-HSGNT-STATUS = 'A'                                 
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                    MOVE KD07-DTE-HSGNT-APPROVE                                 
                                             TO WS-KD07-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF KD07-NUM-HSGNT-STATUS = 'R'                                 
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                    MOVE KD07-DTE-HSGNT-REJECT                                  
                                             TO WS-KD07-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF KD07-NUM-HSGNT-STATUS = 'W'                                 
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                    MOVE KD07-DTE-HSGNT-REJECT                                  
                                             TO WS-KD07-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF WS-KD07-DTE-PROCESS-HGT > WS-DTE-PROCESS                    
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD07-DTE-HSGNT-APPROVE = WS-DTE-PROCESS                  
                       IF KD07-NUM-HSGNT-STATUS =                               
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-HGT NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD07-REC FROM BP13KD07-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD07                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD07-NUM-HSGNT-STATUS = 'A'                              
                      MOVE WS-DTE-APRV TO WS-DTE-PROCESS                        
                      MOVE KD07-DTE-HSGNT-APPROVE                               
                                            TO WS-KD07-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF KD07-NUM-HSGNT-STATUS = 'R'                              
                      MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                        
                      MOVE KD07-DTE-HSGNT-REJECT                                
                                            TO WS-KD07-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF KD07-NUM-HSGNT-STATUS = 'W'                              
                      MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                        
                      MOVE KD07-DTE-HSGNT-REJECT                                
                                            TO WS-KD07-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF WS-KD07-DTE-PROCESS-HGT > WS-DTE-PROCESS                 
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD07-REC FROM BP13KD07-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD07                               
                       END-IF                                                   
                    ELSE                                                        
                       IF WS-KD07-DTE-PROCESS-HGT = WS-DTE-PROCESS              
                          IF KD07-NUM-HSGNT-STATUS =                            
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-HGT NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD07-REC FROM BP13KD07-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD07                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD07-NUM-HSGNT-STATUS-TOPUP = 'A' OR 'R'                          
              MOVE 'TUG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD07-NUM-HSGNT-STATUS-TOPUP = 'A'                           
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                    MOVE KD07-DTE-HSGNT-APPROVE-TOPUP                           
                                             TO WS-KD07-DTE-PROCESS-TUG         
                 END-IF                                                         
                 IF KD07-NUM-HSGNT-STATUS-TOPUP = 'R'                           
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                    MOVE KD07-DTE-HSGNT-REJECT-TOPUP                            
                                             TO WS-KD07-DTE-PROCESS-TUG         
                 END-IF                                                         
                 IF WS-KD07-DTE-PROCESS-TUG > WS-DTE-PROCESS                    
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-KD07-DTE-PROCESS-TUG = WS-DTE-PROCESS                 
                       IF KD07-NUM-HSGNT-STATUS-TOPUP =                         
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-TUG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD07-REC FROM BP13KD07-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD07                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD07-NUM-HSGNT-STATUS-TOPUP = 'A'                        
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                       MOVE KD07-DTE-HSGNT-APPROVE-TOPUP                        
                                            TO WS-KD07-DTE-PROCESS-TUG          
                    END-IF                                                      
                    IF KD07-NUM-HSGNT-STATUS-TOPUP = 'R'                        
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                       MOVE KD07-DTE-HSGNT-REJECT-TOPUP                         
                                            TO WS-KD07-DTE-PROCESS-TUG          
                    END-IF                                                      
                    IF WS-KD07-DTE-PROCESS-TUG > WS-DTE-PROCESS                 
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD07-REC FROM BP13KD07-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD07                               
                       END-IF                                                   
                    ELSE                                                        
                       IF WS-KD07-DTE-PROCESS-TUG = WS-DTE-PROCESS              
                          IF KD07-NUM-HSGNT-STATUS-TOPUP =                      
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-TUG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD07-REC FROM BP13KD07-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD07                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD07-REC FROM BP13KD07-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD07                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD07-REC FROM BP13KD07-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD07                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 1200-READ-BP13FD07 THRU 1200-EXIT.                           
                                                                                
       1500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       1700-GET-KD05-SUM.                                                       
      *-------------------------------------------------------------            
           MOVE SPACES                       TO BP13KD05-REC.                   
           INITIALIZE                           BP13KD05-REC.                   
           MOVE ZEROES                       TO WS-KD05-AMT-AHG                 
                                                WS-KD05-AMT-SHG                 
                                                WS-KD05-AMT-SUG                 
                                                WS-KD05-AMT-HGT                 
                                                WS-KD05-AMT-TUG.                
                                                                                
           MOVE WS-NUM-REGN                  TO KD05-NUM-REGN.                  
           MOVE 'N'                          TO WS-KD05-EOF.                    
           START BP13KD05 KEY = KD05-NUM-REGN.                                  
                                                                                
           EVALUATE KD05-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                 PERFORM 1750-READNEXT-BP13KD05 THRU 1750-EXIT                  
                 PERFORM 1800-PROCESS-BP13KD05  THRU 1800-EXIT                  
                    UNTIL WS-KD05-EOF = 'Y'                                     
               WHEN 23                                                          
                 DISPLAY 'REGNO NOT FOUND IN BP13KD05 : ' KD05-NUM-REGN         
               WHEN OTHER                                                       
                 DISPLAY 'ERROR STARTING- BP13KD05 : ' KD05-STATUS              
                 MOVE KD05-STATUS         TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       1700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1750-READNEXT-BP13KD05.                                                  
      ******************************************************************        
                                                                                
           READ BP13KD05 NEXT RECORD                                            
                         AT END MOVE 'Y' TO WS-KD05-EOF.                        
                                                                                
       1750-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       1800-PROCESS-BP13KD05.                                                   
      *---------------------*                                                   
                                                                                
           IF WS-NUM-REGN = KD05-NUM-REGN                                       
              IF KD05-AMT-AHG-GRANT IS NOT NUMERIC                              
                 MOVE ZEROES TO KD05-AMT-AHG-GRANT                              
              END-IF                                                            
              IF KD05-AMT-SHG-GRANT IS NOT NUMERIC                              
                 MOVE ZEROES TO KD05-AMT-SHG-GRANT                              
              END-IF                                                            
              IF KD05-AMT-SUG-GRANT IS NOT NUMERIC                              
                 MOVE ZEROES TO KD05-AMT-SUG-GRANT                              
              END-IF                                                            
              IF KD05-AMT-HSGNT IS NOT NUMERIC                                  
                 MOVE ZEROES TO KD05-AMT-HSGNT                                  
              END-IF                                                            
              IF KD05-AMT-HSGNT-TOPUP IS NOT NUMERIC                            
                 MOVE ZEROES TO KD05-AMT-HSGNT-TOPUP                            
              END-IF                                                            
                                                                                
              COMPUTE WS-KD05-AMT-AHG =                                         
                      WS-KD05-AMT-AHG + KD05-AMT-AHG-GRANT                      
                                                                                
              COMPUTE WS-KD05-AMT-SHG =                                         
                      WS-KD05-AMT-SHG + KD05-AMT-SHG-GRANT                      
                                                                                
              COMPUTE WS-KD05-AMT-SUG =                                         
                      WS-KD05-AMT-SUG + KD05-AMT-SUG-GRANT                      
                                                                                
              COMPUTE WS-KD05-AMT-HGT =                                         
                      WS-KD05-AMT-HGT + KD05-AMT-HSGNT                          
                                                                                
              COMPUTE WS-KD05-AMT-TUG =                                         
                      WS-KD05-AMT-TUG + KD05-AMT-HSGNT-TOPUP                    
                                                                                
              PERFORM 1750-READNEXT-BP13KD05        THRU 1750-EXIT              
           ELSE                                                                 
             MOVE 'Y' TO WS-KD05-EOF                                            
           END-IF.                                                              
                                                                                
       1800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       1900-GET-DB2-AMT-SUM.                                                    
      *---------------------------------------------------------------*         
                                                                                
            EXEC SQL                                                            
                 SELECT SUM(AMT_GRANT)                                          
                  INTO :WS-GRANT-AMT-SUM:WS-GRANT-AMT-SUM-INDNULL               
                  FROM  GRANT_ASMNT_PERSON                                      
                  WHERE NUM_RGSTRN = :WS-NUM-REGN AND                           
                    NUM_GRANT_TYPE = :WS-GRANT-TYPE                             
            END-EXEC.                                                           
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
             CONTINUE                                                           
           WHEN WS-SQL-NFND                                                     
             MOVE ZEROES             TO WS-GRANT-AMT-SUM                        
           WHEN OTHER                                                           
             DISPLAY 'READ GRANT_ASMNT_PERSON ERROR' SQLCODE                    
             GO TO 1900-EXIT                                                    
           END-EVALUATE.                                                        
                                                                                
       1900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       1950-GET-DB2-AMT-SUM-EX.                                                 
      *---------------------------------------------------------------*         
                                                                                
            EXEC SQL                                                            
                 SELECT SUM(AMT_GRANT)                                          
                  INTO :WS-GRANT-AMT-SUM:WS-GRANT-AMT-SUM-INDNULL               
                  FROM  EX_GRANT_ASMNT_PERSON                                   
                  WHERE NUM_RGSTRN = :WS-NUM-REGN AND                           
                    NUM_GRANT_TYPE = :WS-GRANT-TYPE AND                         
                    TME_CREATE IN (SELECT MAX(TME_CREATE)                       
                                   FROM EX_GRANT_ASMNT_PERSON                   
                                   WHERE NUM_RGSTRN = :WS-NUM-REGN              
                                    AND NUM_GRANT_TYPE = :WS-GRANT-TYPE)        
            END-EXEC.                                                           
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
             CONTINUE                                                           
           WHEN WS-SQL-NFND                                                     
             MOVE ZEROES             TO WS-GRANT-AMT-SUM                        
           WHEN OTHER                                                           
             DISPLAY 'READ GRANT_ASMNT_PERSON ERROR' SQLCODE                    
             GO TO 1900-EXIT                                                    
           END-EVALUATE.                                                        
                                                                                
       1950-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       2000-READ-GRANT-ASMNT.                                                   
      *--------------------*                                                    
           MOVE WS-NUM-REGN      TO NUM-RGSTRN OF DCLGRANT-ASMNT.               
           MOVE WS-GRANT-TYPE    TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT.           
                                                                                
           MOVE 'N'              TO WS-GRANT-ASMNT-FND.                         
                                                                                
           EXEC SQL                                                             
              SELECT NUM_RGSTRN,                                                
                     NUM_GRANT_TYPE,                                            
                     NUM_ELGBL_GRANT,                                           
                     NUM_GRANT_AMOUNT_ELGBL,                                    
                     NUM_GRANT_STATUS,                                          
                     DTE_APRV,                                                  
                     DTE_CANCEL,                                                
                     DTE_REJECT,                                                
                     DTE_SUBMIT,                                                
                     DTE_WTHDRW,                                                
                     NUM_RJCTN_REASON,                                          
                     NUM_WTDRWL_REASON,                                         
                     TXT_CNCLTN_REASON,                                         
                     DTE_GRANT_RQST,                                            
                     NUM_GRANT_DOC_RCV,                                         
                     DTE_ACK,                                                   
                     DTE_GRANT_FORM_ISSUE,                                      
                     DTE_GRANT_OPT_OUT_FORM_ISSUE,                              
                     NUM_GRANT_OPT_OUT_REASON,                                  
                     DTE_GRANT_OPT_OUT_REASON,                                  
                     NUM_ALCTN_SCHEME,                                          
                     NUM_HSHLD_CTZNSP,                                          
                     NUM_WRKNG_CHILD_ASMNT,                                     
                     QTY_MONTH_WORK,                                            
                     NUM_APPEAL_ATCHMT,                                         
                     NUM_PARENT_ADRS_BLDNG,                                     
                     NUM_PARENT_ADRS_LEVEL,                                     
                     NUM_PARENT_ADRS_UNIT,                                      
                     TXT_PARENT_ADRS1,                                          
                     TXT_PARENT_ADRS2,                                          
                     NUM_PARENT_ADRS_POSTAL,                                    
                     DTE_PYMNT,                                                 
                     DTE_CPF_ACK_GRANT_RCV,                                     
                     NUM_GRANT_CREDIT,                                          
                     TME_APNTMT,                                                
                     DTE_APNTMT,                                                
                     TME_CREATE_ASMNT,                                          
                     NUM_UPDATE_USERID,                                         
                     TME_UPDATE,                                                
                     DTE_UPDATE,                                                
                     NUM_SOURCE_SYSTEM,                                         
                     NUM_ACNT,                                                  
                     NUM_SCHEME,                                                
                     NUM_TNCY,                                                  
                     NUM_HALF_GRANT                                             
              INTO  :DCLGRANT-ASMNT.NUM-RGSTRN,                                 
                    :DCLGRANT-ASMNT.NUM-GRANT-TYPE,                             
                    :DCLGRANT-ASMNT.NUM-ELGBL-GRANT,                            
                    :DCLGRANT-ASMNT.NUM-GRANT-AMOUNT-ELGBL,                     
                    :DCLGRANT-ASMNT.NUM-GRANT-STATUS,                           
                    :DCLGRANT-ASMNT.DTE-APRV,                                   
                    :DCLGRANT-ASMNT.DTE-CANCEL,                                 
                    :DCLGRANT-ASMNT.DTE-REJECT,                                 
                    :DCLGRANT-ASMNT.DTE-SUBMIT,                                 
                    :DCLGRANT-ASMNT.DTE-WTHDRW,                                 
                    :DCLGRANT-ASMNT.NUM-RJCTN-REASON,                           
                    :DCLGRANT-ASMNT.NUM-WTDRWL-REASON,                          
                    :DCLGRANT-ASMNT.TXT-CNCLTN-REASON,                          
                    :DCLGRANT-ASMNT.DTE-GRANT-RQST,                             
                    :DCLGRANT-ASMNT.NUM-GRANT-DOC-RCV,                          
                    :DCLGRANT-ASMNT.DTE-ACK,                                    
                    :DCLGRANT-ASMNT.DTE-GRANT-FORM-ISSUE,                       
                    :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-FORM-ISSUE,               
                    :DCLGRANT-ASMNT.NUM-GRANT-OPT-OUT-REASON,                   
                    :DCLGRANT-ASMNT.DTE-GRANT-OPT-OUT-REASON,                   
                    :DCLGRANT-ASMNT.NUM-ALCTN-SCHEME,                           
                    :DCLGRANT-ASMNT.NUM-HSHLD-CTZNSP,                           
                    :DCLGRANT-ASMNT.NUM-WRKNG-CHILD-ASMNT,                      
                    :DCLGRANT-ASMNT.QTY-MONTH-WORK,                             
                    :DCLGRANT-ASMNT.NUM-APPEAL-ATCHMT,                          
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-BLDNG,                      
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-LEVEL,                      
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-UNIT,                       
                    :DCLGRANT-ASMNT.TXT-PARENT-ADRS1,                           
                    :DCLGRANT-ASMNT.TXT-PARENT-ADRS2,                           
                    :DCLGRANT-ASMNT.NUM-PARENT-ADRS-POSTAL,                     
                    :DCLGRANT-ASMNT.DTE-PYMNT,                                  
                    :DCLGRANT-ASMNT.DTE-CPF-ACK-GRANT-RCV,                      
                    :DCLGRANT-ASMNT.NUM-GRANT-CREDIT,                           
                    :DCLGRANT-ASMNT.TME-APNTMT,                                 
                    :DCLGRANT-ASMNT.DTE-APNTMT,                                 
                    :DCLGRANT-ASMNT.TME-CREATE-ASMNT,                           
                    :DCLGRANT-ASMNT.NUM-UPDATE-USERID,                          
                    :DCLGRANT-ASMNT.TME-UPDATE,                                 
                    :DCLGRANT-ASMNT.DTE-UPDATE,                                 
                    :DCLGRANT-ASMNT.NUM-SOURCE-SYSTEM,                          
                    :DCLGRANT-ASMNT.NUM-ACNT,                                   
                    :DCLGRANT-ASMNT.NUM-SCHEME,                                 
                    :DCLGRANT-ASMNT.NUM-TNCY,                                   
                    :DCLGRANT-ASMNT.NUM-HALF-GRANT                              
              FROM                                                              
                GRANT_ASMNT                                                     
              WHERE NUM_RGSTRN       = :DCLGRANT-ASMNT.NUM-RGSTRN               
               AND  NUM_GRANT_TYPE   = :DCLGRANT-ASMNT.NUM-GRANT-TYPE           
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
                MOVE 'Y' TO WS-GRANT-ASMNT-FND                                  
                MOVE DTE-APRV OF DCLGRANT-ASMNT TO WS-TABLE-DATE                
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-APRV(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-APRV(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-APRV(7:2)                     
                                                                                
                MOVE DTE-REJECT OF DCLGRANT-ASMNT TO WS-TABLE-DATE              
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-RJCT(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-RJCT(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-RJCT(7:2)                     
                                                                                
                MOVE DTE-WTHDRW OF DCLGRANT-ASMNT TO WS-TABLE-DATE              
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-WDWL(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-WDWL(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-WDWL(7:2)                     
                                                                                
           WHEN WS-SQL-NFND                                                     
                MOVE 'N' TO WS-GRANT-ASMNT-FND                                  
                                                                                
           WHEN OTHER                                                           
                MOVE SQLCODE   TO WS-SQLCODE                                    
                DISPLAY 'ERROR READING GRANT_ASMNT'                             
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                              
                DISPLAY SPACES                                                  
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------*                                                        
       2100-DROP-TO-EX.                                                         
      *----------------*                                                        
           MOVE 'N' TO WS-DELETE-ONLY.                                          
                                                                                
           PERFORM 2110-INSERT-TO-EX-GRANT THRU 2110-EXIT.                      
           PERFORM 2120-DELETE-GRANT-ASMNT THRU 2120-EXIT.                      
           PERFORM 2130-PROCESS-PERSON     THRU 2130-EXIT.                      
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------*                                                  
       2110-INSERT-TO-EX-GRANT.                                                 
      *----------------------*                                                  
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT                                    
                    TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT.                         
           MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT                                
                    TO NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT.                     
           MOVE NUM-ELGBL-GRANT OF DCLGRANT-ASMNT                               
                    TO NUM-ELGBL-GRANT OF DCLEX-GRANT-ASMNT.                    
           MOVE NUM-GRANT-AMOUNT-ELGBL OF DCLGRANT-ASMNT                        
                    TO NUM-GRANT-AMOUNT-ELGBL OF DCLEX-GRANT-ASMNT.             
           MOVE NUM-GRANT-STATUS OF DCLGRANT-ASMNT                              
                    TO NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT.                   
           MOVE DTE-APRV OF DCLGRANT-ASMNT                                      
                    TO DTE-APRV OF DCLEX-GRANT-ASMNT.                           
           MOVE DTE-CANCEL OF DCLGRANT-ASMNT                                    
                    TO DTE-CANCEL OF DCLEX-GRANT-ASMNT.                         
           MOVE DTE-REJECT OF DCLGRANT-ASMNT                                    
                    TO DTE-REJECT OF DCLEX-GRANT-ASMNT.                         
           MOVE DTE-SUBMIT OF DCLGRANT-ASMNT                                    
                    TO DTE-SUBMIT OF DCLEX-GRANT-ASMNT.                         
           MOVE DTE-WTHDRW OF DCLGRANT-ASMNT                                    
                    TO DTE-WTHDRW OF DCLEX-GRANT-ASMNT.                         
           MOVE NUM-RJCTN-REASON OF DCLGRANT-ASMNT                              
                    TO NUM-RJCTN-REASON OF DCLEX-GRANT-ASMNT.                   
           MOVE NUM-WTDRWL-REASON OF DCLGRANT-ASMNT                             
                    TO NUM-WTDRWL-REASON OF DCLEX-GRANT-ASMNT.                  
           MOVE TXT-CNCLTN-REASON OF DCLGRANT-ASMNT                             
                    TO TXT-CNCLTN-REASON OF DCLEX-GRANT-ASMNT.                  
           MOVE DTE-GRANT-RQST OF DCLGRANT-ASMNT                                
                    TO DTE-GRANT-RQST OF DCLEX-GRANT-ASMNT.                     
           MOVE NUM-GRANT-DOC-RCV OF DCLGRANT-ASMNT                             
                    TO NUM-GRANT-DOC-RCV OF DCLEX-GRANT-ASMNT.                  
           MOVE DTE-ACK OF DCLGRANT-ASMNT                                       
                    TO DTE-ACK OF DCLEX-GRANT-ASMNT.                            
           MOVE DTE-GRANT-FORM-ISSUE OF DCLGRANT-ASMNT                          
                    TO DTE-GRANT-FORM-ISSUE OF DCLEX-GRANT-ASMNT.               
           MOVE DTE-GRANT-OPT-OUT-FORM-ISSUE OF DCLGRANT-ASMNT                  
                 TO DTE-GRANT-OPT-OUT-FORM-ISSUE OF DCLEX-GRANT-ASMNT.          
           MOVE NUM-GRANT-OPT-OUT-REASON OF DCLGRANT-ASMNT                      
                 TO NUM-GRANT-OPT-OUT-REASON OF DCLEX-GRANT-ASMNT.              
           MOVE DTE-GRANT-OPT-OUT-REASON OF DCLGRANT-ASMNT                      
                 TO DTE-GRANT-OPT-OUT-REASON OF DCLEX-GRANT-ASMNT.              
           MOVE NUM-ALCTN-SCHEME OF DCLGRANT-ASMNT                              
                 TO NUM-ALCTN-SCHEME OF DCLEX-GRANT-ASMNT.                      
           MOVE NUM-HSHLD-CTZNSP OF DCLGRANT-ASMNT                              
                 TO NUM-HSHLD-CTZNSP OF DCLEX-GRANT-ASMNT.                      
           MOVE NUM-WRKNG-CHILD-ASMNT OF DCLGRANT-ASMNT                         
                 TO NUM-WRKNG-CHILD-ASMNT OF DCLEX-GRANT-ASMNT.                 
           MOVE QTY-MONTH-WORK OF DCLGRANT-ASMNT                                
                 TO QTY-MONTH-WORK OF DCLEX-GRANT-ASMNT.                        
           MOVE NUM-APPEAL-ATCHMT OF DCLGRANT-ASMNT                             
                 TO NUM-APPEAL-ATCHMT OF DCLEX-GRANT-ASMNT.                     
           MOVE NUM-PARENT-ADRS-BLDNG OF DCLGRANT-ASMNT                         
                 TO NUM-PARENT-ADRS-BLDNG OF DCLEX-GRANT-ASMNT.                 
           MOVE NUM-PARENT-ADRS-LEVEL OF DCLGRANT-ASMNT                         
                 TO NUM-PARENT-ADRS-LEVEL OF DCLEX-GRANT-ASMNT.                 
           MOVE NUM-PARENT-ADRS-UNIT OF DCLGRANT-ASMNT                          
                 TO NUM-PARENT-ADRS-UNIT OF DCLEX-GRANT-ASMNT.                  
           MOVE TXT-PARENT-ADRS1 OF DCLGRANT-ASMNT                              
                 TO TXT-PARENT-ADRS1 OF DCLEX-GRANT-ASMNT.                      
           MOVE TXT-PARENT-ADRS2 OF DCLGRANT-ASMNT                              
                 TO TXT-PARENT-ADRS2 OF DCLEX-GRANT-ASMNT.                      
           MOVE NUM-PARENT-ADRS-POSTAL OF DCLGRANT-ASMNT                        
                 TO NUM-PARENT-ADRS-POSTAL OF DCLEX-GRANT-ASMNT.                
           MOVE DTE-PYMNT OF DCLGRANT-ASMNT                                     
                 TO DTE-PYMNT OF DCLEX-GRANT-ASMNT.                             
           MOVE DTE-CPF-ACK-GRANT-RCV OF DCLGRANT-ASMNT                         
                 TO DTE-CPF-ACK-GRANT-RCV OF DCLEX-GRANT-ASMNT.                 
           MOVE NUM-GRANT-CREDIT OF DCLGRANT-ASMNT                              
                 TO NUM-GRANT-CREDIT OF DCLEX-GRANT-ASMNT.                      
           MOVE TME-APNTMT OF DCLGRANT-ASMNT                                    
                 TO TME-APNTMT OF DCLEX-GRANT-ASMNT.                            
           MOVE DTE-APNTMT OF DCLGRANT-ASMNT                                    
                 TO DTE-APNTMT OF DCLEX-GRANT-ASMNT.                            
           MOVE TME-CREATE-ASMNT OF DCLGRANT-ASMNT                              
                 TO TME-CREATE-ASMNT OF DCLEX-GRANT-ASMNT.                      
           MOVE NUM-SOURCE-SYSTEM OF DCLGRANT-ASMNT                             
                 TO NUM-SOURCE-SYSTEM OF DCLEX-GRANT-ASMNT.                     
           MOVE NUM-ACNT OF DCLGRANT-ASMNT                                      
                 TO NUM-ACNT OF DCLEX-GRANT-ASMNT.                              
           MOVE NUM-SCHEME OF DCLGRANT-ASMNT                                    
                 TO NUM-SCHEME OF DCLEX-GRANT-ASMNT.                            
           MOVE NUM-TNCY OF DCLGRANT-ASMNT                                      
                 TO NUM-TNCY OF DCLEX-GRANT-ASMNT.                              
           MOVE NUM-HALF-GRANT OF DCLGRANT-ASMNT                                
                 TO NUM-HALF-GRANT OF DCLEX-GRANT-ASMNT.                        
                                                                                
           MOVE 'BP13CB0I ' TO NUM-UPDATE-USERID OF DCLEX-GRANT-ASMNT.          
                                                                                
           STRING WS-DTE-CCYYMMDD(1:4) '-'                                      
                  WS-DTE-CCYYMMDD(5:2) '-'                                      
                  WS-DTE-CCYYMMDD(7:2)                                          
                 DELIMITED BY SIZE INTO DTE-UPDATE OF DCLEX-GRANT-ASMNT.        
                                                                                
           STRING WS-TIME-HHMMSS(1:2) '.'                                       
                  WS-TIME-HHMMSS(3:2) '.'                                       
                  WS-TIME-HHMMSS(5:2)                                           
                 DELIMITED BY SIZE INTO TME-UPDATE OF DCLEX-GRANT-ASMNT.        
                                                                                
            MOVE WS-TIMESTAMP TO TME-CREATE OF DCLEX-GRANT-ASMNT.               
                                                                                
            EXEC SQL                                                            
                 INSERT INTO EX_GRANT_ASMNT                                     
                        ( NUM_RGSTRN,                                           
                          NUM_GRANT_TYPE,                                       
                          TME_CREATE,                                           
                          NUM_ELGBL_GRANT,                                      
                          NUM_GRANT_AMOUNT_ELGBL,                               
                          NUM_GRANT_STATUS,                                     
                          DTE_APRV,                                             
                          DTE_CANCEL,                                           
                          DTE_REJECT,                                           
                          DTE_SUBMIT,                                           
                          DTE_WTHDRW,                                           
                          NUM_RJCTN_REASON,                                     
                          NUM_WTDRWL_REASON,                                    
                          TXT_CNCLTN_REASON,                                    
                          DTE_GRANT_RQST,                                       
                          NUM_GRANT_DOC_RCV,                                    
                          DTE_ACK,                                              
                          DTE_GRANT_FORM_ISSUE,                                 
                          DTE_GRANT_OPT_OUT_FORM_ISSUE,                         
                          NUM_GRANT_OPT_OUT_REASON,                             
                          DTE_GRANT_OPT_OUT_REASON,                             
                          NUM_ALCTN_SCHEME,                                     
                          NUM_HSHLD_CTZNSP,                                     
                          NUM_WRKNG_CHILD_ASMNT,                                
                          QTY_MONTH_WORK,                                       
                          NUM_APPEAL_ATCHMT,                                    
                          NUM_PARENT_ADRS_BLDNG,                                
                          NUM_PARENT_ADRS_LEVEL,                                
                          NUM_PARENT_ADRS_UNIT,                                 
                          TXT_PARENT_ADRS1,                                     
                          TXT_PARENT_ADRS2,                                     
                          NUM_PARENT_ADRS_POSTAL,                               
                          DTE_PYMNT,                                            
                          DTE_CPF_ACK_GRANT_RCV,                                
                          NUM_GRANT_CREDIT,                                     
                          TME_APNTMT,                                           
                          DTE_APNTMT,                                           
                          TME_CREATE_ASMNT,                                     
                          NUM_UPDATE_USERID,                                    
                          TME_UPDATE,                                           
                          DTE_UPDATE )                                          
                 VALUES ( :DCLEX-GRANT-ASMNT.NUM-RGSTRN,                        
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-TYPE,                    
                          :DCLEX-GRANT-ASMNT.TME-CREATE,                        
                          :DCLEX-GRANT-ASMNT.NUM-ELGBL-GRANT,                   
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-AMOUNT-ELGBL,            
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-STATUS,                  
                          :DCLEX-GRANT-ASMNT.DTE-APRV,                          
                          :DCLEX-GRANT-ASMNT.DTE-CANCEL,                        
                          :DCLEX-GRANT-ASMNT.DTE-REJECT,                        
                          :DCLEX-GRANT-ASMNT.DTE-SUBMIT,                        
                          :DCLEX-GRANT-ASMNT.DTE-WTHDRW,                        
                          :DCLEX-GRANT-ASMNT.NUM-RJCTN-REASON,                  
                          :DCLEX-GRANT-ASMNT.NUM-WTDRWL-REASON,                 
                          :DCLEX-GRANT-ASMNT.TXT-CNCLTN-REASON,                 
                          :DCLEX-GRANT-ASMNT.DTE-GRANT-RQST,                    
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-DOC-RCV,                 
                          :DCLEX-GRANT-ASMNT.DTE-ACK,                           
                          :DCLEX-GRANT-ASMNT.DTE-GRANT-FORM-ISSUE,              
                        :DCLEX-GRANT-ASMNT.DTE-GRANT-OPT-OUT-FORM-ISSUE,        
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-OPT-OUT-REASON,          
                          :DCLEX-GRANT-ASMNT.DTE-GRANT-OPT-OUT-REASON,          
                          :DCLEX-GRANT-ASMNT.NUM-ALCTN-SCHEME,                  
                          :DCLEX-GRANT-ASMNT.NUM-HSHLD-CTZNSP,                  
                          :DCLEX-GRANT-ASMNT.NUM-WRKNG-CHILD-ASMNT,             
                          :DCLEX-GRANT-ASMNT.QTY-MONTH-WORK,                    
                          :DCLEX-GRANT-ASMNT.NUM-APPEAL-ATCHMT,                 
                          :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-BLDNG,             
                          :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-LEVEL,             
                          :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-UNIT,              
                          :DCLEX-GRANT-ASMNT.TXT-PARENT-ADRS1,                  
                          :DCLEX-GRANT-ASMNT.TXT-PARENT-ADRS2,                  
                          :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-POSTAL,            
                          :DCLEX-GRANT-ASMNT.DTE-PYMNT,                         
                          :DCLEX-GRANT-ASMNT.DTE-CPF-ACK-GRANT-RCV,             
                          :DCLEX-GRANT-ASMNT.NUM-GRANT-CREDIT,                  
                          :DCLEX-GRANT-ASMNT.TME-APNTMT,                        
                          :DCLEX-GRANT-ASMNT.DTE-APNTMT,                        
                          :DCLEX-GRANT-ASMNT.TME-CREATE-ASMNT,                  
                          :DCLEX-GRANT-ASMNT.NUM-UPDATE-USERID,                 
                          :DCLEX-GRANT-ASMNT.TME-UPDATE,                        
                          :DCLEX-GRANT-ASMNT.DTE-UPDATE )                       
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-EX-GRANT-INS                    
                    MOVE 'EX_GRANT_ASMNT'  TO WS-SOURCE                         
                    MOVE 'C'            TO WS-ACTION                            
                    MOVE NUM-RGSTRN OF DCLEX-GRANT-ASMNT TO WS-RGSTRN           
                    MOVE NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT                    
                                                  TO WS-GRNT-TYPE               
                    MOVE SPACES            TO WS-BEFORE-IMAGE                   
                    MOVE DCLEX-GRANT-ASMNT TO WS-AFTER-IMAGE                    
                    PERFORM 8000-INSERT-TO-LOG     THRU 8000-EXIT               
                                                                                
               WHEN -803                                                        
                    DISPLAY 'RECORD ALREADY EXIST IN EX_GRANT_ASMNT'            
                    DISPLAY NUM-RGSTRN OF DCLEX-GRANT-ASMNT ' '                 
                            NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT                 
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (INSERT) IN EX_GRANT_ASMNT'              
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
                    PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       2110-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------*                                                  
       2120-DELETE-GRANT-ASMNT.                                                 
      *----------------------*                                                  
            MOVE DCLGRANT-ASMNT                   TO WS-BEFORE-IMAGE.           
            MOVE NUM-RGSTRN OF DCLGRANT-ASMNT     TO WS-RGSTRN.                 
            MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT TO WS-GRNT-TYPE.              
                                                                                
            EXEC SQL                                                            
                 DELETE FROM GRANT_ASMNT                                        
                 WHERE NUM_RGSTRN      = :DCLGRANT-ASMNT.NUM-RGSTRN             
                 AND   NUM_GRANT_TYPE  = :DCLGRANT-ASMNT.NUM-GRANT-TYPE         
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-GRANT-DELETE                    
                    MOVE 'GRANT_ASMNT'  TO WS-SOURCE                            
                    MOVE 'D'            TO WS-ACTION                            
                    MOVE SPACES         TO WS-AFTER-IMAGE                       
                    PERFORM 8000-INSERT-TO-LOG     THRU 8000-EXIT               
                                                                                
               WHEN 100                                                         
                    DISPLAY 'RECORD NOT EXIST IN GRANT_ASMNT'                   
                    DISPLAY NUM-RGSTRN OF DCLGRANT-ASMNT ' '                    
                            NUM-GRANT-TYPE OF DCLGRANT-ASMNT                    
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (DELETE) IN GRANT_ASMNT TABLE '          
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
            END-EVALUATE.                                                       
                                                                                
       2120-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2130-PROCESS-PERSON.                                                     
      *================================================================*        
           PERFORM 2140-OPEN-CURSOR1    THRU 2140-EXIT.                         
           PERFORM 2150-FETCH-CURSOR1   THRU 2150-EXIT                          
                   UNTIL WS-CURSOR1-EOF = 'Y'.                                  
           PERFORM 2170-CLOSE-CURSOR1   THRU 2170-EXIT.                         
                                                                                
       2130-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2140-OPEN-CURSOR1.                                                       
      *================================================================*        
           INITIALIZE SQLCODE.                                                  
           MOVE 'N'                   TO WS-CURSOR1-EOF.                        
                                                                                
           MOVE WS-NUM-REGN  TO NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON.            
           MOVE WS-GRANT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON        
                                                                                
      *------------------------------------------*                              
      *  DECLARE CURSOR1 - GRANT ASSESSMENT PERSON                              
      *------------------------------------------*                              
           EXEC SQL                                                             
             DECLARE CURSOR1 CURSOR FOR                                         
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      NUM_IDNTY_NO,                                             
                      NUM_IDNTY_NO_TYPE,                                        
                      NUM_CSTMR_SOURCE,                                         
                      NUM_CPF_ACNT,                                             
                      AMT_GRANT,                                                
                      AMT_GRANT_USE,                                            
                      NUM_ROLE_TAG,                                             
                      NUM_RLTNSP,                                               
                      NME_PERSON,                                               
                      NUM_GENDER,                                               
                      NUM_CTZNSP,                                               
                      NUM_MRTL_STATUS,                                          
                      AMT_INCOME,                                               
                      NUM_1YR_CNTNS_EMPLY,                                      
                      NUM_DEBAR,                                                
                      NUM_DEBAR_REASON,                                         
                      NUM_RCVRY,                                                
                      NUM_UPDATE_USERID,                                        
                      DTE_UPDATE,                                               
                      TME_UPDATE,                                               
                      AMT_GRANT_THRSHD,                                         
                      AMT_GRANT_EXCESS                                          
               FROM                                                             
                 GRANT_ASMNT_PERSON                                             
               WHERE                                                            
                 NUM_RGSTRN = :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN AND             
                 NUM_GRANT_TYPE = :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE         
               ORDER BY NUM_IDNTY_NO                                            
           END-EXEC.                                                            
                                                                                
      *----------------------------------------*                                
      *  OPEN CURSOR1 - GRANT ASSESSMENT PERSON *                               
      *----------------------------------------*                                
           EXEC SQL                                                             
             OPEN CURSOR1                                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 0                                                               
             CONTINUE                                                           
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'OPEN CURSOR1 ERROR'                                       
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
       2140-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *================================================================*        
       2150-FETCH-CURSOR1.                                                      
      *================================================================*        
                                                                                
           EXEC SQL                                                             
             FETCH CURSOR1                                                      
               INTO                                                             
                 :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN,                             
                 :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE,                         
                 :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO,                           
                 :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO-TYPE,                      
                 :DCLGRANT-ASMNT-PERSON.NUM-CSTMR-SOURCE,                       
                 :DCLGRANT-ASMNT-PERSON.NUM-CPF-ACNT,                           
                 :DCLGRANT-ASMNT-PERSON.AMT-GRANT,                              
                 :DCLGRANT-ASMNT-PERSON.AMT-GRANT-USE,                          
                 :DCLGRANT-ASMNT-PERSON.NUM-ROLE-TAG,                           
                 :DCLGRANT-ASMNT-PERSON.NUM-RLTNSP,                             
                 :DCLGRANT-ASMNT-PERSON.NME-PERSON,                             
                 :DCLGRANT-ASMNT-PERSON.NUM-GENDER,                             
                 :DCLGRANT-ASMNT-PERSON.NUM-CTZNSP,                             
                 :DCLGRANT-ASMNT-PERSON.NUM-MRTL-STATUS,                        
                 :DCLGRANT-ASMNT-PERSON.AMT-INCOME,                             
                 :DCLGRANT-ASMNT-PERSON.NUM-1YR-CNTNS-EMPLY,                    
                 :DCLGRANT-ASMNT-PERSON.NUM-DEBAR,                              
                 :DCLGRANT-ASMNT-PERSON.NUM-DEBAR-REASON,                       
                 :DCLGRANT-ASMNT-PERSON.NUM-RCVRY,                              
                 :DCLGRANT-ASMNT-PERSON.NUM-UPDATE-USERID,                      
                 :DCLGRANT-ASMNT-PERSON.DTE-UPDATE,                             
                 :DCLGRANT-ASMNT-PERSON.TME-UPDATE,                             
                 :DCLGRANT-ASMNT-PERSON.AMT-GRANT-THRSHD,                       
                 :DCLGRANT-ASMNT-PERSON.AMT-GRANT-EXCESS                        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
             IF WS-DELETE-ONLY = 'Y'                                            
                PERFORM 2320-DELETE-GRANT-PERSON THRU 2320-EXIT                 
             ELSE                                                               
                PERFORM 2300-INSERT-TO-EX-PERSON THRU 2300-EXIT                 
                PERFORM 2310-INSERT-TO-RECOVERY  THRU 2310-EXIT                 
                PERFORM 2320-DELETE-GRANT-PERSON THRU 2320-EXIT                 
             END-IF                                                             
           WHEN WS-SQL-NFND                                                     
             MOVE 'Y'                  TO WS-CURSOR1-EOF                        
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'FETCH CURSOR1 ERROR'                                      
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
       2150-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       2170-CLOSE-CURSOR1.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE SQLCODE.                                                  
                                                                                
      *-----------------------------------*                                     
      * CLOSE CURSOR1 - GRANT ASSESSMENT PERSON                                 
      *-----------------------------------*                                     
           EXEC SQL CLOSE CURSOR1                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN 0                                                            
                   CONTINUE                                                     
              WHEN OTHER                                                        
                MOVE SQLCODE TO WS-SQLCODE                                      
                DISPLAY 'CLOSE CURSOR1 ERROR'                                   
                GO TO 9999-SQL-ERROR                                            
           END-EVALUATE.                                                        
                                                                                
       2170-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       2200-DELETE-FROM-LIVE.                                                   
      *---------------------*                                                   
           MOVE 'Y' TO WS-DELETE-ONLY.                                          
           MOVE WS-NUM-REGN TO NUM-RGSTRN OF DCLGRANT-ASMNT.                    
           MOVE WS-GRANT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT.              
           PERFORM 2120-DELETE-GRANT-ASMNT  THRU 2120-EXIT.                     
                                                                                
           MOVE WS-NUM-REGN TO NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON.             
           MOVE WS-GRANT-TYPE                                                   
                           TO NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON.          
           PERFORM 2130-PROCESS-PERSON THRU 2130-EXIT.                          
           MOVE 'N' TO WS-DELETE-ONLY.                                          
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------*                                                
       2300-INSERT-TO-EX-PERSON.                                                
      *------------------------*                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON                             
                TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON                         
                TO NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON.                  
           MOVE NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON                           
                TO NUM-IDNTY-NO OF DCLEX-GRANT-ASMNT-PERSON.                    
           MOVE NUM-IDNTY-NO-TYPE OF DCLGRANT-ASMNT-PERSON                      
                TO NUM-IDNTY-NO-TYPE OF DCLEX-GRANT-ASMNT-PERSON.               
           MOVE NUM-CSTMR-SOURCE OF DCLGRANT-ASMNT-PERSON                       
                TO NUM-CSTMR-SOURCE OF DCLEX-GRANT-ASMNT-PERSON.                
           MOVE NUM-CPF-ACNT OF DCLGRANT-ASMNT-PERSON                           
                TO NUM-CPF-ACNT OF DCLEX-GRANT-ASMNT-PERSON.                    
           MOVE AMT-GRANT OF DCLGRANT-ASMNT-PERSON                              
                TO AMT-GRANT OF DCLEX-GRANT-ASMNT-PERSON.                       
           MOVE AMT-GRANT-USE OF DCLGRANT-ASMNT-PERSON                          
                TO AMT-GRANT-USE OF DCLEX-GRANT-ASMNT-PERSON.                   
           MOVE NUM-ROLE-TAG OF DCLGRANT-ASMNT-PERSON                           
                TO NUM-ROLE-TAG OF DCLEX-GRANT-ASMNT-PERSON.                    
           MOVE NUM-RLTNSP OF DCLGRANT-ASMNT-PERSON                             
                TO NUM-RLTNSP OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NME-PERSON OF DCLGRANT-ASMNT-PERSON                             
                TO NME-PERSON OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NUM-GENDER OF DCLGRANT-ASMNT-PERSON                             
                TO NUM-GENDER OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NUM-CTZNSP OF DCLGRANT-ASMNT-PERSON                             
                TO NUM-CTZNSP OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NUM-MRTL-STATUS OF DCLGRANT-ASMNT-PERSON                        
                TO NUM-MRTL-STATUS OF DCLEX-GRANT-ASMNT-PERSON.                 
           MOVE AMT-INCOME OF DCLGRANT-ASMNT-PERSON                             
                TO AMT-INCOME OF DCLEX-GRANT-ASMNT-PERSON.                      
           MOVE NUM-1YR-CNTNS-EMPLY OF DCLGRANT-ASMNT-PERSON                    
                TO NUM-1YR-CNTNS-EMPLY OF DCLEX-GRANT-ASMNT-PERSON.             
           MOVE NUM-DEBAR OF DCLGRANT-ASMNT-PERSON                              
                TO NUM-DEBAR OF DCLEX-GRANT-ASMNT-PERSON.                       
           MOVE NUM-DEBAR-REASON OF DCLGRANT-ASMNT-PERSON                       
                TO NUM-DEBAR-REASON OF DCLEX-GRANT-ASMNT-PERSON.                
           MOVE NUM-RCVRY OF DCLGRANT-ASMNT-PERSON                              
                TO NUM-RCVRY OF DCLEX-GRANT-ASMNT-PERSON.                       
           MOVE AMT-GRANT-THRSHD OF DCLGRANT-ASMNT-PERSON                       
                TO AMT-GRANT-THRSHD OF DCLEX-GRANT-ASMNT-PERSON.                
           MOVE AMT-GRANT-EXCESS OF DCLGRANT-ASMNT-PERSON                       
                TO AMT-GRANT-EXCESS OF DCLEX-GRANT-ASMNT-PERSON.                
                                                                                
           MOVE 'BP13CB0I '                                                     
                   TO NUM-UPDATE-USERID OF DCLEX-GRANT-ASMNT-PERSON.            
                                                                                
           STRING WS-DTE-CCYYMMDD(1:4) '-'                                      
                  WS-DTE-CCYYMMDD(5:2) '-'                                      
                  WS-DTE-CCYYMMDD(7:2)                                          
                  DELIMITED BY SIZE                                             
                  INTO DTE-UPDATE OF DCLEX-GRANT-ASMNT-PERSON.                  
                                                                                
           STRING WS-TIME-HHMMSS(1:2) '.'                                       
                  WS-TIME-HHMMSS(3:2) '.'                                       
                  WS-TIME-HHMMSS(5:2)                                           
                  DELIMITED BY SIZE                                             
                  INTO TME-UPDATE OF DCLEX-GRANT-ASMNT-PERSON.                  
                                                                                
            MOVE WS-TIMESTAMP TO TME-CREATE OF DCLEX-GRANT-ASMNT-PERSON.        
                                                                                
            EXEC SQL                                                            
                 INSERT INTO EX_GRANT_ASMNT_PERSON                              
                        ( NUM_RGSTRN,                                           
                          NUM_GRANT_TYPE,                                       
                          TME_CREATE,                                           
                          NUM_IDNTY_NO,                                         
                          NUM_IDNTY_NO_TYPE,                                    
                          NUM_CSTMR_SOURCE,                                     
                          NUM_CPF_ACNT,                                         
                          AMT_GRANT,                                            
                          AMT_GRANT_USE,                                        
                          NUM_ROLE_TAG,                                         
                          NUM_RLTNSP,                                           
                          NME_PERSON,                                           
                          NUM_GENDER,                                           
                          NUM_CTZNSP,                                           
                          NUM_MRTL_STATUS,                                      
                          AMT_INCOME,                                           
                          NUM_1YR_CNTNS_EMPLY,                                  
                          NUM_DEBAR,                                            
                          NUM_DEBAR_REASON,                                     
                          NUM_RCVRY,                                            
                          NUM_UPDATE_USERID,                                    
                          DTE_UPDATE,                                           
                          TME_UPDATE,                                           
                          AMT_GRANT_THRSHD,                                     
                          AMT_GRANT_EXCESS )                                    
                 VALUES ( :DCLEX-GRANT-ASMNT-PERSON.NUM-RGSTRN,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-GRANT-TYPE,             
                          :DCLEX-GRANT-ASMNT-PERSON.TME-CREATE,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-IDNTY-NO,               
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-IDNTY-NO-TYPE,          
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-CSTMR-SOURCE,           
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-CPF-ACNT,               
                          :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT,                  
                          :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-USE,              
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-ROLE-TAG,               
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-RLTNSP,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NME-PERSON,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-GENDER,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-CTZNSP,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-MRTL-STATUS,            
                          :DCLEX-GRANT-ASMNT-PERSON.AMT-INCOME,                 
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-1YR-CNTNS-EMPLY,        
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-DEBAR,                  
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-DEBAR-REASON,           
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-RCVRY,                  
                          :DCLEX-GRANT-ASMNT-PERSON.NUM-UPDATE-USERID,          
                          :DCLEX-GRANT-ASMNT-PERSON.DTE-UPDATE,                 
                          :DCLEX-GRANT-ASMNT-PERSON.TME-UPDATE,                 
                          :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-THRSHD,           
                          :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-EXCESS )          
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-EX-PRSN-INS                     
                    MOVE 'EX_GRANT_ASMNT_PERSON'  TO WS-SOURCE                  
                    MOVE 'C'            TO WS-ACTION                            
                    MOVE NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON                 
                                                  TO WS-RGSTRN                  
                    MOVE NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON             
                                                  TO WS-GRNT-TYPE               
                    MOVE SPACES                   TO WS-BEFORE-IMAGE            
                    MOVE DCLEX-GRANT-ASMNT-PERSON TO WS-AFTER-IMAGE             
                    PERFORM 8000-INSERT-TO-LOG     THRU 8000-EXIT               
                                                                                
               WHEN -803                                                        
                    DISPLAY 'RECORD EXIST IN EX_GRANT_ASMNT_PERSON'             
                    DISPLAY NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON ' '          
                         NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON ' '         
                         NUM-IDNTY-NO OF DCLEX-GRANT-ASMNT-PERSON               
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERR (INSERT) IN EX_GRANT_ASMNT_PERSON'         
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
                    PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       2300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------*                                                
       2310-INSERT-TO-RECOVERY.                                                 
      *------------------------*                                                
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON                             
                             TO NUM-RGSTRN OF DCLGRANT-RCVRY.                   
           MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON                         
                             TO NUM-GRANT-TYPE OF DCLGRANT-RCVRY.               
           MOVE NUM-IDNTY-NO OF DCLGRANT-ASMNT-PERSON                           
                             TO NUM-IDNTY-NO OF DCLGRANT-RCVRY.                 
           MOVE NUM-IDNTY-NO-TYPE OF DCLGRANT-ASMNT-PERSON                      
                             TO NUM-IDNTY-NO-TYPE OF DCLGRANT-RCVRY.            
                                                                                
           MOVE ZEROES TO AMT-GRANT-RCVR OF DCLGRANT-RCVRY                      
                          AMT-GRANT-RCVR-INTRST OF DCLGRANT-RCVRY.              
                                                                                
           MOVE '0001-01-01' TO DTE-RCV-RCVR-GRANT OF DCLGRANT-RCVRY.           
                                                                                
           MOVE WS-TIMESTAMP TO TME-CREATE OF DCLGRANT-RCVRY                    
                                WS-TIME-CREATE.                                 
                                                                                
           MOVE 'BP13CB0I '                                                     
                   TO NUM-UPDATE-USERID OF DCLGRANT-RCVRY.                      
                                                                                
           STRING WS-DTE-CCYYMMDD(1:4) '-'                                      
                  WS-DTE-CCYYMMDD(5:2) '-'                                      
                  WS-DTE-CCYYMMDD(7:2)                                          
                  DELIMITED BY SIZE                                             
                  INTO DTE-UPDATE OF DCLGRANT-RCVRY.                            
                                                                                
           STRING WS-TIME-HHMMSS(1:2) '.'                                       
                  WS-TIME-HHMMSS(3:2) '.'                                       
                  WS-TIME-HHMMSS(5:2)                                           
                  DELIMITED BY SIZE                                             
                  INTO TME-UPDATE OF DCLGRANT-RCVRY.                            
                                                                                
            MOVE ZEROES TO AMT-GRANT-RCVR-INTRST OF DCLGRANT-RCVRY.             
            MOVE '0001-01-01' TO DTE-TRNSFR OF DCLGRANT-RCVRY                   
                              DTE-RQST-RCVR OF DCLGRANT-RCVRY                   
                              DTE-ACK-GRANT-RCVRY-CPF OF DCLGRANT-RCVRY         
                              DTE-GRANT-ABORT OF DCLGRANT-RCVRY                 
                              DTE-GRANT-RPDT OF DCLGRANT-RCVRY                  
                              DTE-CPF-GRANT-RQST OF DCLGRANT-RCVRY              
                              DTE-CPF-GRANT-RCV OF DCLGRANT-RCVRY               
                              DTE-UNUSED-GRANT-RQST OF DCLGRANT-RCVRY           
                              DTE-UNUSED-GRANT-RCV OF DCLGRANT-RCVRY            
                              DTE-USED-GRANT-RQST OF DCLGRANT-RCVRY             
                              DTE-USED-GRANT-RCV OF DCLGRANT-RCVRY.             
                                                                                
            MOVE SPACES    TO NUM-TRNSFR OF DCLGRANT-RCVRY                      
                              NUM-ACNT OF DCLGRANT-RCVRY                        
                              NUM-SCHEME OF DCLGRANT-RCVRY                      
                              NUM-TNCY OF DCLGRANT-RCVRY.                       
                                                                                
            EXEC SQL                                                            
                 INSERT INTO GRANT_RCVRY                                        
                        ( NUM_RGSTRN,                                           
                          NUM_GRANT_TYPE,                                       
                          TME_CREATE,                                           
                          NUM_IDNTY_NO,                                         
                          NUM_IDNTY_NO_TYPE,                                    
                          AMT_GRANT_RCVR,                                       
                          AMT_GRANT_RCVR_INTRST,                                
                          DTE_RQST_RCVR,                                        
                          DTE_RCV_RCVR_GRANT,                                   
                          DTE_ACK_GRANT_RCVRY_CPF,                              
                          DTE_GRANT_ABORT,                                      
                          DTE_GRANT_RPDT,                                       
                          NUM_TRNSFR,                                           
                          DTE_TRNSFR,                                           
                          NUM_ACNT,                                             
                          NUM_SCHEME,                                           
                          NUM_TNCY,                                             
                          DTE_CPF_GRANT_RQST,                                   
                          DTE_CPF_GRANT_RCV,                                    
                          DTE_UNUSED_GRANT_RQST,                                
                          DTE_UNUSED_GRANT_RCV,                                 
                          DTE_USED_GRANT_RQST,                                  
                          DTE_USED_GRANT_RCV,                                   
                          NUM_UPDATE_USERID,                                    
                          DTE_UPDATE,                                           
                          TME_UPDATE )                                          
                 VALUES ( :DCLGRANT-RCVRY.NUM-RGSTRN,                           
                          :DCLGRANT-RCVRY.NUM-GRANT-TYPE,                       
                          :DCLGRANT-RCVRY.TME-CREATE,                           
                          :DCLGRANT-RCVRY.NUM-IDNTY-NO,                         
                          :DCLGRANT-RCVRY.NUM-IDNTY-NO-TYPE,                    
                          :DCLGRANT-RCVRY.AMT-GRANT-RCVR,                       
                          :DCLGRANT-RCVRY.AMT-GRANT-RCVR-INTRST,                
                          :DCLGRANT-RCVRY.DTE-RQST-RCVR,                        
                          :DCLGRANT-RCVRY.DTE-RCV-RCVR-GRANT,                   
                          :DCLGRANT-RCVRY.DTE-ACK-GRANT-RCVRY-CPF,              
                          :DCLGRANT-RCVRY.DTE-GRANT-ABORT,                      
                          :DCLGRANT-RCVRY.DTE-GRANT-RPDT,                       
                          :DCLGRANT-RCVRY.NUM-TRNSFR,                           
                          :DCLGRANT-RCVRY.DTE-TRNSFR,                           
                          :DCLGRANT-RCVRY.NUM-ACNT,                             
                          :DCLGRANT-RCVRY.NUM-SCHEME,                           
                          :DCLGRANT-RCVRY.NUM-TNCY,                             
                          :DCLGRANT-RCVRY.DTE-CPF-GRANT-RQST,                   
                          :DCLGRANT-RCVRY.DTE-CPF-GRANT-RCV,                    
                          :DCLGRANT-RCVRY.DTE-UNUSED-GRANT-RQST,                
                          :DCLGRANT-RCVRY.DTE-UNUSED-GRANT-RCV,                 
                          :DCLGRANT-RCVRY.DTE-USED-GRANT-RQST,                  
                          :DCLGRANT-RCVRY.DTE-USED-GRANT-RCV,                   
                          :DCLGRANT-RCVRY.NUM-UPDATE-USERID,                    
                          :DCLGRANT-RCVRY.DTE-UPDATE,                           
                          :DCLGRANT-RCVRY.TME-UPDATE )                          
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-RCVRY-INS                       
                    MOVE 'GRANT_RCVRY'  TO WS-SOURCE                            
                    MOVE 'C'            TO WS-ACTION                            
                    MOVE NUM-RGSTRN OF DCLGRANT-RCVRY TO WS-RGSTRN              
                    MOVE NUM-GRANT-TYPE OF DCLGRANT-RCVRY                       
                                                  TO WS-GRNT-TYPE               
                    MOVE SPACES         TO WS-BEFORE-IMAGE                      
                    MOVE DCLGRANT-RCVRY TO WS-AFTER-IMAGE                       
                    PERFORM 8000-INSERT-TO-LOG     THRU 8000-EXIT               
                                                                                
               WHEN -803                                                        
                    DISPLAY 'RECORD EXIST IN GRANT_RCVRY'                       
                    DISPLAY NUM-RGSTRN OF DCLGRANT-RCVRY ' '                    
                            NUM-GRANT-TYPE OF DCLGRANT-RCVRY ' '                
                            NUM-IDNTY-NO OF DCLGRANT-RCVRY                      
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERR (INSERT) IN GRANT_RCVRY'                   
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
                    PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       2310-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------*                                                
       2320-DELETE-GRANT-PERSON.                                                
      *------------------------*                                                
           MOVE DCLGRANT-ASMNT-PERSON               TO WS-BEFORE-IMAGE.         
           MOVE NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON     TO WS-RGSTRN.           
           MOVE NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON TO WS-GRNT-TYPE         
                                                                                
            EXEC SQL                                                            
              DELETE FROM GRANT_ASMNT_PERSON                                    
              WHERE NUM_RGSTRN   = :DCLGRANT-ASMNT-PERSON.NUM-RGSTRN            
              AND NUM_GRANT_TYPE = :DCLGRANT-ASMNT-PERSON.NUM-GRANT-TYPE        
              AND NUM_IDNTY_NO   = :DCLGRANT-ASMNT-PERSON.NUM-IDNTY-NO          
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-PERSON-DELETE                   
                    MOVE 'GRANT_ASMNT_PERSON'  TO WS-SOURCE                     
                    MOVE 'D'                   TO WS-ACTION                     
                    MOVE SPACES                TO WS-AFTER-IMAGE                
                    PERFORM 8000-INSERT-TO-LOG THRU 8000-EXIT                   
                                                                                
               WHEN 100                                                         
                    DISPLAY 'RECORD NOT EXIST IN GRANT_ASMNT_PERSON'            
                    DISPLAY NUM-RGSTRN OF DCLGRANT-ASMNT-PERSON ' '             
                            NUM-GRANT-TYPE OF DCLGRANT-ASMNT-PERSON             
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (DELETE) IN GRANT_ASMNT_PERSON'          
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
            END-EVALUATE.                                                       
                                                                                
       2320-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       2400-DELETE-FROM-EX.                                                     
      *-------------------*                                                     
           MOVE WS-NUM-REGN   TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT.               
           MOVE WS-GRANT-TYPE TO NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT.           
           PERFORM 2410-DELETE-EX-GRANT-ASMNT  THRU 2410-EXIT.                  
                                                                                
           MOVE WS-NUM-REGN TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON.          
           MOVE WS-GRANT-TYPE                                                   
                        TO NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON.          
           PERFORM 2420-DELETE-EX-GRANT-PERSON THRU 2420-EXIT.                  
                                                                                
           MOVE WS-NUM-REGN TO NUM-RGSTRN OF DCLGRANT-RCVRY.                    
           MOVE WS-GRANT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-RCVRY.              
           PERFORM 2500-DELETE-GRANT-RCVRY     THRU 2500-EXIT.                  
                                                                                
       2400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------------*                                              
       2410-DELETE-EX-GRANT-ASMNT.                                              
      *--------------------------*                                              
            MOVE DCLEX-GRANT-ASMNT                   TO WS-BEFORE-IMAGE.        
            MOVE NUM-RGSTRN OF DCLEX-GRANT-ASMNT     TO WS-RGSTRN.              
            MOVE NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT TO WS-GRNT-TYPE.           
                                                                                
            EXEC SQL                                                            
                 DELETE FROM EX_GRANT_ASMNT                                     
                 WHERE NUM_RGSTRN   = :DCLEX-GRANT-ASMNT.NUM-RGSTRN             
                 AND NUM_GRANT_TYPE = :DCLEX-GRANT-ASMNT.NUM-GRANT-TYPE         
                 AND TME_CREATE     = :DCLEX-GRANT-ASMNT.TME-CREATE             
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                  TO WS-EX-GRANT-DELETE                
                    MOVE 'EX_GRANT_ASMNT'  TO WS-SOURCE                         
                    MOVE 'D'            TO WS-ACTION                            
                    MOVE SPACES         TO WS-AFTER-IMAGE                       
                    PERFORM 8000-INSERT-TO-LOG     THRU 8000-EXIT               
                                                                                
               WHEN 100                                                         
                    DISPLAY 'RECORD NOT EXIST IN EX_GRANT_ASMNT'                
                    DISPLAY NUM-RGSTRN OF DCLEX-GRANT-ASMNT ' '                 
                            NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT                 
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (DELETE) IN EX_GRANT_ASMNT'              
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
            END-EVALUATE.                                                       
                                                                                
       2410-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2420-DELETE-EX-GRANT-PERSON.                                             
      *================================================================*        
           PERFORM 2430-OPEN-CURSOR2    THRU 2430-EXIT.                         
           PERFORM 2440-FETCH-CURSOR2   THRU 2440-EXIT                          
                   UNTIL WS-CURSOR2-EOF = 'Y'.                                  
           PERFORM 2470-CLOSE-CURSOR2   THRU 2470-EXIT.                         
                                                                                
       2420-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2430-OPEN-CURSOR2.                                                       
      *================================================================*        
           INITIALIZE SQLCODE.                                                  
           MOVE 'N'                   TO WS-CURSOR2-EOF.                        
                                                                                
           MOVE WS-NUM-REGN  TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON.         
           MOVE WS-GRANT-TYPE TO                                                
                             NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON.        
           MOVE WS-TIME-CREATE TO                                               
                             TME-CREATE OF DCLEX-GRANT-ASMNT-PERSON.            
                                                                                
      *------------------------------------------*                              
      *  DECLARE CURSOR2 - EX GRANT ASSESSMENT PERSON                           
      *------------------------------------------*                              
           EXEC SQL                                                             
             DECLARE CURSOR2 CURSOR FOR                                         
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      TME_CREATE,                                               
                      NUM_IDNTY_NO,                                             
                      NUM_IDNTY_NO_TYPE,                                        
                      NUM_CSTMR_SOURCE,                                         
                      NUM_CPF_ACNT,                                             
                      AMT_GRANT,                                                
                      AMT_GRANT_USE,                                            
                      NUM_ROLE_TAG,                                             
                      NUM_RLTNSP,                                               
                      NME_PERSON,                                               
                      NUM_GENDER,                                               
                      NUM_CTZNSP,                                               
                      NUM_MRTL_STATUS,                                          
                      AMT_INCOME,                                               
                      NUM_1YR_CNTNS_EMPLY,                                      
                      NUM_DEBAR,                                                
                      NUM_DEBAR_REASON,                                         
                      NUM_RCVRY,                                                
                      NUM_UPDATE_USERID,                                        
                      DTE_UPDATE,                                               
                      TME_UPDATE,                                               
                      AMT_GRANT_THRSHD,                                         
                      AMT_GRANT_EXCESS                                          
               FROM                                                             
                 EX_GRANT_ASMNT_PERSON                                          
               WHERE                                                            
                 NUM_RGSTRN = :DCLEX-GRANT-ASMNT-PERSON.NUM-RGSTRN              
             AND NUM_GRANT_TYPE =                                               
                              :DCLEX-GRANT-ASMNT-PERSON.NUM-GRANT-TYPE          
             AND TME_CREATE = :DCLEX-GRANT-ASMNT-PERSON.TME-CREATE              
               ORDER BY NUM_IDNTY_NO                                            
           END-EXEC.                                                            
                                                                                
      *--------------------------------------------*                            
      *  OPEN CURSOR2 - EX GRANT ASSESSMENT PERSON *                            
      *--------------------------------------------*                            
           EXEC SQL                                                             
             OPEN CURSOR2                                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 0                                                               
             CONTINUE                                                           
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'OPEN CURSOR2 ERROR'                                       
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
       2430-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *================================================================*        
       2440-FETCH-CURSOR2.                                                      
      *================================================================*        
                                                                                
           EXEC SQL                                                             
             FETCH CURSOR2                                                      
               INTO                                                             
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-RGSTRN,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-GRANT-TYPE,                      
                 :DCLEX-GRANT-ASMNT-PERSON.TME-CREATE,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-IDNTY-NO,                        
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-IDNTY-NO-TYPE,                   
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-CSTMR-SOURCE,                    
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-CPF-ACNT,                        
                 :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT,                           
                 :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-USE,                       
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-ROLE-TAG,                        
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-RLTNSP,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NME-PERSON,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-GENDER,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-CTZNSP,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-MRTL-STATUS,                     
                 :DCLEX-GRANT-ASMNT-PERSON.AMT-INCOME,                          
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-1YR-CNTNS-EMPLY,                 
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-DEBAR,                           
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-DEBAR-REASON,                    
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-RCVRY,                           
                 :DCLEX-GRANT-ASMNT-PERSON.NUM-UPDATE-USERID,                   
                 :DCLEX-GRANT-ASMNT-PERSON.DTE-UPDATE,                          
                 :DCLEX-GRANT-ASMNT-PERSON.TME-UPDATE,                          
                 :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-THRSHD,                    
                 :DCLEX-GRANT-ASMNT-PERSON.AMT-GRANT-EXCESS                     
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
             PERFORM 2480-DEL-EX-GRANT-PERSON THRU 2480-EXIT                    
           WHEN WS-SQL-NFND                                                     
             MOVE 'Y'                  TO WS-CURSOR2-EOF                        
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'FETCH CURSOR2 ERROR'                                      
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
       2440-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       2470-CLOSE-CURSOR2.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE SQLCODE.                                                  
                                                                                
      *-------------------------------------------*                             
      * CLOSE CURSOR2 - EX GRANT ASSESSMENT PERSON                              
      *-------------------------------------------*                             
           EXEC SQL CLOSE CURSOR2                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN 0                                                            
                   CONTINUE                                                     
              WHEN OTHER                                                        
                MOVE SQLCODE TO WS-SQLCODE                                      
                DISPLAY 'CLOSE CURSOR2 ERROR'                                   
                GO TO 9999-SQL-ERROR                                            
           END-EVALUATE.                                                        
                                                                                
       2470-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------------*                                                
       2480-DEL-EX-GRANT-PERSON.                                                
      *------------------------*                                                
           MOVE DCLEX-GRANT-ASMNT-PERSON            TO WS-BEFORE-IMAGE.         
           MOVE NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON  TO WS-RGSTRN.           
           MOVE NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON              PE      
                                                        TO WS-GRNT-TYPE         
            EXEC SQL                                                            
              DELETE FROM EX_GRANT_ASMNT_PERSON                                 
              WHERE NUM_RGSTRN = :DCLEX-GRANT-ASMNT-PERSON.NUM-RGSTRN           
              AND NUM_GRANT_TYPE =                                              
                                :DCLEX-GRANT-ASMNT-PERSON.NUM-GRANT-TYPE        
              AND NUM_IDNTY_NO = :DCLEX-GRANT-ASMNT-PERSON.NUM-IDNTY-NO         
              AND TME_CREATE = :DCLEX-GRANT-ASMNT-PERSON.TME-CREATE             
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-EX-PERSON-DELETE                
                    MOVE 'EX_GRANT_ASMNT_PERSON'  TO WS-SOURCE                  
                    MOVE 'D'                      TO WS-ACTION                  
                    MOVE SPACES                   TO WS-AFTER-IMAGE             
                    PERFORM 8000-INSERT-TO-LOG THRU 8000-EXIT                   
                                                                                
               WHEN 100                                                         
                    DISPLAY 'RECORD NOT EXIST IN EX_GRANT_ASMNT_PERSON'         
                    DISPLAY NUM-RGSTRN OF DCLEX-GRANT-ASMNT-PERSON ' '          
                            NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT-PERSON          
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (DEL) IN EX_GRANT_ASMNT_PERSON'          
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
            END-EVALUATE.                                                       
                                                                                
       2480-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2500-DELETE-GRANT-RCVRY.                                                 
      *================================================================*        
           PERFORM 2510-OPEN-CURSOR3    THRU 2510-EXIT.                         
           PERFORM 2520-FETCH-CURSOR3   THRU 2520-EXIT                          
                   UNTIL WS-CURSOR3-EOF = 'Y'.                                  
           PERFORM 2600-CLOSE-CURSOR3   THRU 2600-EXIT.                         
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *================================================================*        
       2510-OPEN-CURSOR3.                                                       
      *================================================================*        
           INITIALIZE SQLCODE.                                                  
           MOVE 'N'                   TO WS-CURSOR3-EOF.                        
                                                                                
           MOVE WS-NUM-REGN  TO NUM-RGSTRN OF DCLGRANT-RCVRY.                   
           MOVE WS-GRANT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-RCVRY.              
           MOVE WS-TIME-CREATE TO TME-CREATE OF DCLGRANT-RCVRY.                 
                                                                                
      *------------------------------------------*                              
      *  DECLARE CURSOR3 - GRANT RCVRY                                          
      *------------------------------------------*                              
           EXEC SQL                                                             
             DECLARE CURSOR3 CURSOR FOR                                         
               SELECT NUM_RGSTRN,                                               
                      NUM_GRANT_TYPE,                                           
                      TME_CREATE,                                               
                      NUM_IDNTY_NO,                                             
                      NUM_IDNTY_NO_TYPE,                                        
                      AMT_GRANT_RCVR,                                           
                      AMT_GRANT_RCVR_INTRST,                                    
                      DTE_RQST_RCVR,                                            
                      DTE_RCV_RCVR_GRANT,                                       
                      DTE_ACK_GRANT_RCVRY_CPF,                                  
                      DTE_GRANT_ABORT,                                          
                      DTE_GRANT_RPDT,                                           
                      NUM_TRNSFR,                                               
                      DTE_TRNSFR,                                               
                      NUM_ACNT,                                                 
                      NUM_SCHEME,                                               
                      NUM_TNCY,                                                 
                      DTE_CPF_GRANT_RQST,                                       
                      DTE_CPF_GRANT_RCV,                                        
                      DTE_UNUSED_GRANT_RQST,                                    
                      DTE_UNUSED_GRANT_RCV,                                     
                      DTE_USED_GRANT_RQST,                                      
                      DTE_USED_GRANT_RCV,                                       
                      NUM_UPDATE_USERID,                                        
                      DTE_UPDATE,                                               
                      TME_UPDATE                                                
               FROM                                                             
                 GRANT_RCVRY                                                    
               WHERE                                                            
                 NUM_RGSTRN       = :DCLGRANT-RCVRY.NUM-RGSTRN AND              
                 NUM_GRANT_TYPE   = :DCLGRANT-RCVRY.NUM-GRANT-TYPE AND          
                 TME_CREATE       = :DCLGRANT-RCVRY.TME-CREATE                  
           END-EXEC.                                                            
                                                                                
      *----------------------------------------*                                
      *  OPEN CURSOR3 - GRANT RCVRY            *                                
      *----------------------------------------*                                
           EXEC SQL                                                             
             OPEN CURSOR3                                                       
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 0                                                               
             CONTINUE                                                           
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'OPEN CURSOR3 ERROR'                                       
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
                                                                                
       2510-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *================================================================*        
       2520-FETCH-CURSOR3.                                                      
      *================================================================*        
                                                                                
           EXEC SQL                                                             
             FETCH CURSOR3                                                      
               INTO                                                             
                 :DCLGRANT-RCVRY.NUM-RGSTRN,                                    
                 :DCLGRANT-RCVRY.NUM-GRANT-TYPE,                                
                 :DCLGRANT-RCVRY.TME-CREATE,                                    
                 :DCLGRANT-RCVRY.NUM-IDNTY-NO,                                  
                 :DCLGRANT-RCVRY.NUM-IDNTY-NO-TYPE,                             
                 :DCLGRANT-RCVRY.AMT-GRANT-RCVR,                                
                 :DCLGRANT-RCVRY.AMT-GRANT-RCVR-INTRST,                         
                 :DCLGRANT-RCVRY.DTE-RQST-RCVR,                                 
                 :DCLGRANT-RCVRY.DTE-RCV-RCVR-GRANT,                            
                 :DCLGRANT-RCVRY.DTE-ACK-GRANT-RCVRY-CPF,                       
                 :DCLGRANT-RCVRY.DTE-GRANT-ABORT,                               
                 :DCLGRANT-RCVRY.DTE-GRANT-RPDT,                                
                 :DCLGRANT-RCVRY.NUM-TRNSFR,                                    
                 :DCLGRANT-RCVRY.DTE-TRNSFR,                                    
                 :DCLGRANT-RCVRY.NUM-ACNT,                                      
                 :DCLGRANT-RCVRY.NUM-SCHEME,                                    
                 :DCLGRANT-RCVRY.NUM-TNCY,                                      
                 :DCLGRANT-RCVRY.DTE-CPF-GRANT-RQST,                            
                 :DCLGRANT-RCVRY.DTE-CPF-GRANT-RCV,                             
                 :DCLGRANT-RCVRY.DTE-UNUSED-GRANT-RQST,                         
                 :DCLGRANT-RCVRY.DTE-UNUSED-GRANT-RCV,                          
                 :DCLGRANT-RCVRY.DTE-USED-GRANT-RQST,                           
                 :DCLGRANT-RCVRY.DTE-USED-GRANT-RCV,                            
                 :DCLGRANT-RCVRY.NUM-UPDATE-USERID,                             
                 :DCLGRANT-RCVRY.DTE-UPDATE,                                    
                 :DCLGRANT-RCVRY.TME-UPDATE                                     
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
             PERFORM 2610-DEL-GRANT-RCVRY     THRU 2610-EXIT                    
           WHEN WS-SQL-NFND                                                     
             MOVE 'Y'                  TO WS-CURSOR3-EOF                        
           WHEN OTHER                                                           
             MOVE SQLCODE            TO WS-SQLCODE                              
             DISPLAY 'FETCH CURSOR3 ERROR'                                      
             GO TO 9999-SQL-ERROR                                               
           END-EVALUATE.                                                        
                                                                                
       2520-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       2600-CLOSE-CURSOR3.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE SQLCODE.                                                  
                                                                                
      *----------------------------*                                            
      * CLOSE CURSOR3 - GRANT RCVRY                                             
      *----------------------------*                                            
           EXEC SQL CLOSE CURSOR3                                               
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
              WHEN 0                                                            
                   CONTINUE                                                     
              WHEN OTHER                                                        
                MOVE SQLCODE TO WS-SQLCODE                                      
                DISPLAY 'CLOSE CURSOR3 ERROR'                                   
                GO TO 9999-SQL-ERROR                                            
           END-EVALUATE.                                                        
                                                                                
       2600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       2610-DEL-GRANT-RCVRY.                                                    
      *--------------------*                                                    
           MOVE DCLGRANT-RCVRY                   TO WS-BEFORE-IMAGE.            
           MOVE NUM-RGSTRN OF DCLGRANT-RCVRY     TO WS-RGSTRN.                  
           MOVE NUM-GRANT-TYPE OF DCLGRANT-RCVRY TO WS-GRNT-TYPE.       PE      
                                                                                
            EXEC SQL                                                            
              DELETE FROM GRANT_RCVRY                                           
              WHERE NUM_RGSTRN = :DCLGRANT-RCVRY.NUM-RGSTRN                     
              AND NUM_GRANT_TYPE = :DCLGRANT-RCVRY.NUM-GRANT-TYPE               
              AND NUM_IDNTY_NO = :DCLGRANT-RCVRY.NUM-IDNTY-NO                   
              AND TME_CREATE = :DCLGRANT-RCVRY.TME-CREATE                       
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-GRANT-RCVRY-DELETE              
                    MOVE 'GRANT_RCVRY'            TO WS-SOURCE                  
                    MOVE 'D'                      TO WS-ACTION                  
                    MOVE SPACES                   TO WS-AFTER-IMAGE             
                    PERFORM 8000-INSERT-TO-LOG THRU 8000-EXIT                   
                                                                                
               WHEN 100                                                         
                    DISPLAY 'RECORD NOT EXIST IN GRANT_RCVRY'                   
                    DISPLAY NUM-RGSTRN OF DCLGRANT-RCVRY ' '                    
                            NUM-GRANT-TYPE OF DCLGRANT-RCVRY                    
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (DEL) IN GRANT_RCVRY'                    
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
            END-EVALUATE.                                                       
                                                                                
       2610-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------*                                               
       3000-READ-EX-GRANT-ASMNT.                                                
      *-------------------------*                                               
           MOVE WS-NUM-REGN      TO NUM-RGSTRN OF DCLEX-GRANT-ASMNT.            
           MOVE WS-GRANT-TYPE    TO NUM-GRANT-TYPE OF DCLEX-GRANT-ASMNT.        
                                                                                
           MOVE 'N'              TO WS-EX-GRANT-ASMNT-FND.                      
                                                                                
           EXEC SQL                                                             
              SELECT NUM_RGSTRN,                                                
                     NUM_GRANT_TYPE,                                            
                     TME_CREATE,                                                
                     NUM_ELGBL_GRANT,                                           
                     NUM_GRANT_AMOUNT_ELGBL,                                    
                     NUM_GRANT_STATUS,                                          
                     DTE_APRV,                                                  
                     DTE_CANCEL,                                                
                     DTE_REJECT,                                                
                     DTE_SUBMIT,                                                
                     DTE_WTHDRW,                                                
                     NUM_RJCTN_REASON,                                          
                     NUM_WTDRWL_REASON,                                         
                     TXT_CNCLTN_REASON,                                         
                     DTE_GRANT_RQST,                                            
                     NUM_GRANT_DOC_RCV,                                         
                     DTE_ACK,                                                   
                     DTE_GRANT_FORM_ISSUE,                                      
                     DTE_GRANT_OPT_OUT_FORM_ISSUE,                              
                     NUM_GRANT_OPT_OUT_REASON,                                  
                     DTE_GRANT_OPT_OUT_REASON,                                  
                     NUM_ALCTN_SCHEME,                                          
                     NUM_HSHLD_CTZNSP,                                          
                     NUM_WRKNG_CHILD_ASMNT,                                     
                     QTY_MONTH_WORK,                                            
                     NUM_APPEAL_ATCHMT,                                         
                     NUM_PARENT_ADRS_BLDNG,                                     
                     NUM_PARENT_ADRS_LEVEL,                                     
                     NUM_PARENT_ADRS_UNIT,                                      
                     TXT_PARENT_ADRS1,                                          
                     TXT_PARENT_ADRS2,                                          
                     NUM_PARENT_ADRS_POSTAL,                                    
                     DTE_PYMNT,                                                 
                     DTE_CPF_ACK_GRANT_RCV,                                     
                     NUM_GRANT_CREDIT,                                          
                     TME_APNTMT,                                                
                     DTE_APNTMT,                                                
                     TME_CREATE_ASMNT,                                          
                     NUM_UPDATE_USERID,                                         
                     TME_UPDATE,                                                
                     DTE_UPDATE,                                                
                     NUM_SOURCE_SYSTEM,                                         
                     NUM_ACNT,                                                  
                     NUM_SCHEME,                                                
                     NUM_TNCY,                                                  
                     NUM_HALF_GRANT                                             
              INTO  :DCLEX-GRANT-ASMNT.NUM-RGSTRN,                              
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-TYPE,                          
                    :DCLEX-GRANT-ASMNT.TME-CREATE,                              
                    :DCLEX-GRANT-ASMNT.NUM-ELGBL-GRANT,                         
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-AMOUNT-ELGBL,                  
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-STATUS,                        
                    :DCLEX-GRANT-ASMNT.DTE-APRV,                                
                    :DCLEX-GRANT-ASMNT.DTE-CANCEL,                              
                    :DCLEX-GRANT-ASMNT.DTE-REJECT,                              
                    :DCLEX-GRANT-ASMNT.DTE-SUBMIT,                              
                    :DCLEX-GRANT-ASMNT.DTE-WTHDRW,                              
                    :DCLEX-GRANT-ASMNT.NUM-RJCTN-REASON,                        
                    :DCLEX-GRANT-ASMNT.NUM-WTDRWL-REASON,                       
                    :DCLEX-GRANT-ASMNT.TXT-CNCLTN-REASON,                       
                    :DCLEX-GRANT-ASMNT.DTE-GRANT-RQST,                          
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-DOC-RCV,                       
                    :DCLEX-GRANT-ASMNT.DTE-ACK,                                 
                    :DCLEX-GRANT-ASMNT.DTE-GRANT-FORM-ISSUE,                    
                    :DCLEX-GRANT-ASMNT.DTE-GRANT-OPT-OUT-FORM-ISSUE,            
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-OPT-OUT-REASON,                
                    :DCLEX-GRANT-ASMNT.DTE-GRANT-OPT-OUT-REASON,                
                    :DCLEX-GRANT-ASMNT.NUM-ALCTN-SCHEME,                        
                    :DCLEX-GRANT-ASMNT.NUM-HSHLD-CTZNSP,                        
                    :DCLEX-GRANT-ASMNT.NUM-WRKNG-CHILD-ASMNT,                   
                    :DCLEX-GRANT-ASMNT.QTY-MONTH-WORK,                          
                    :DCLEX-GRANT-ASMNT.NUM-APPEAL-ATCHMT,                       
                    :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-BLDNG,                   
                    :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-LEVEL,                   
                    :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-UNIT,                    
                    :DCLEX-GRANT-ASMNT.TXT-PARENT-ADRS1,                        
                    :DCLEX-GRANT-ASMNT.TXT-PARENT-ADRS2,                        
                    :DCLEX-GRANT-ASMNT.NUM-PARENT-ADRS-POSTAL,                  
                    :DCLEX-GRANT-ASMNT.DTE-PYMNT,                               
                    :DCLEX-GRANT-ASMNT.DTE-CPF-ACK-GRANT-RCV,                   
                    :DCLEX-GRANT-ASMNT.NUM-GRANT-CREDIT,                        
                    :DCLEX-GRANT-ASMNT.TME-APNTMT,                              
                    :DCLEX-GRANT-ASMNT.DTE-APNTMT,                              
                    :DCLEX-GRANT-ASMNT.TME-CREATE-ASMNT,                        
                    :DCLEX-GRANT-ASMNT.NUM-UPDATE-USERID,                       
                    :DCLEX-GRANT-ASMNT.TME-UPDATE,                              
                    :DCLEX-GRANT-ASMNT.DTE-UPDATE,                              
                    :DCLEX-GRANT-ASMNT.NUM-SOURCE-SYSTEM,                       
                    :DCLEX-GRANT-ASMNT.NUM-ACNT,                                
                    :DCLEX-GRANT-ASMNT.NUM-SCHEME,                              
                    :DCLEX-GRANT-ASMNT.NUM-TNCY,                                
                    :DCLEX-GRANT-ASMNT.NUM-HALF-GRANT                           
              FROM                                                              
                EX_GRANT_ASMNT                                                  
              WHERE NUM_RGSTRN       = :DCLEX-GRANT-ASMNT.NUM-RGSTRN            
               AND  NUM_GRANT_TYPE   = :DCLEX-GRANT-ASMNT.NUM-GRANT-TYPE        
               AND  TME_CREATE IN (SELECT MAX(TME_CREATE)                       
                                   FROM EX_GRANT_ASMNT                          
                                   WHERE NUM_RGSTRN =                           
                                      :DCLEX-GRANT-ASMNT.NUM-RGSTRN             
                                    AND NUM_GRANT_TYPE =                        
                                      :DCLEX-GRANT-ASMNT.NUM-GRANT-TYPE)        
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN WS-SQL-OK                                                       
           WHEN WS-SQL-DUPREC                                                   
           WHEN WS-SQL-MORE-ROWS                                                
                MOVE 'Y' TO WS-EX-GRANT-ASMNT-FND                               
                MOVE DTE-APRV OF DCLEX-GRANT-ASMNT TO WS-TABLE-DATE             
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-APRV(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-APRV(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-APRV(7:2)                     
                                                                                
                MOVE DTE-REJECT OF DCLEX-GRANT-ASMNT TO WS-TABLE-DATE           
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-RJCT(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-RJCT(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-RJCT(7:2)                     
                                                                                
                MOVE DTE-WTHDRW OF DCLEX-GRANT-ASMNT TO WS-TABLE-DATE           
                MOVE WS-TABLE-DATE(1:4) TO WS-DTE-WDWL(1:4)                     
                MOVE WS-TABLE-DATE(6:2) TO WS-DTE-WDWL(5:2)                     
                MOVE WS-TABLE-DATE(9:2) TO WS-DTE-WDWL(7:2)                     
                                                                                
                MOVE TME-CREATE OF DCLEX-GRANT-ASMNT TO WS-TIME-CREATE          
                                                                                
           WHEN WS-SQL-NFND                                                     
                MOVE 'N' TO WS-EX-GRANT-ASMNT-FND                               
                                                                                
           WHEN OTHER                                                           
                MOVE SQLCODE   TO WS-SQLCODE                                    
                DISPLAY 'ERROR READING EX_GRANT_ASMNT'                          
                DISPLAY 'SQLCODE IS : ' WS-SQLCODE                              
                DISPLAY SPACES                                                  
                PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4000-READ-BP13FD00.                                                      
      ******************************************************************        
                                                                                
           READ BP13FD00 AT END                                                 
                MOVE HIGH-VALUES TO BP13KD00-REC                                
                MOVE 'Y' TO WS-EOF-FD00                                         
                GO TO 4000-EXIT.                                                
                                                                                
           IF KD00-NUM-REGN(1:1) NOT = '5'                                      
                GO TO 4000-EXIT.                                                
                                                                                
           ADD 1 TO CNT-FD00-READ.                                              
                                                                                
           PERFORM 4010-CHECK-KD00-DATES THRU 4010-EXIT.                        
                                                                                
           MOVE KD00-NUM-REGN TO WS-NUM-REGN.                                   
           PERFORM 1700-GET-KD05-SUM THRU 1700-EXIT.                            
                                                                                
           MOVE 'N' TO WS-WRITTEN.                                              
                                                                                
           IF KD00-NUM-HSGNT-STATUS = 'A' OR 'R' OR 'W'                         
              MOVE 'HGT' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD00-NUM-HSGNT-STATUS = 'A'                                 
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                    MOVE KD00-DTE-HSGNT-APPROVE                                 
                                             TO WS-KD00-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF KD00-NUM-HSGNT-STATUS = 'R'                                 
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                    MOVE KD00-DTE-HSGNT-REJECT                                  
                                             TO WS-KD00-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF KD00-NUM-HSGNT-STATUS = 'W'                                 
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                    MOVE KD00-DTE-HSGNT-REJECT                                  
                                             TO WS-KD00-DTE-PROCESS-HGT         
                 END-IF                                                         
                 IF WS-KD00-DTE-PROCESS-HGT > WS-DTE-PROCESS                    
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD00-DTE-HSGNT-APPROVE = WS-DTE-PROCESS                  
                       IF KD00-NUM-HSGNT-STATUS =                               
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-HGT NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD00-REC FROM BP13KD00-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD00                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD00-NUM-HSGNT-STATUS = 'A'                              
                      MOVE WS-DTE-APRV TO WS-DTE-PROCESS                        
                      MOVE KD00-DTE-HSGNT-APPROVE                               
                                            TO WS-KD00-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF KD00-NUM-HSGNT-STATUS = 'R'                              
                      MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                        
                      MOVE KD00-DTE-HSGNT-REJECT                                
                                            TO WS-KD00-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF KD00-NUM-HSGNT-STATUS = 'W'                              
                      MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                        
                      MOVE KD00-DTE-HSGNT-REJECT                                
                                            TO WS-KD00-DTE-PROCESS-HGT          
                    END-IF                                                      
                    IF WS-KD00-DTE-PROCESS-HGT > WS-DTE-PROCESS                 
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD00-REC FROM BP13KD00-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD00                               
                       END-IF                                                   
                    ELSE                                                        
                       IF WS-KD00-DTE-PROCESS-HGT = WS-DTE-PROCESS              
                          IF KD00-NUM-HSGNT-STATUS =                            
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-HGT NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD00-REC FROM BP13KD00-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD00                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD00-NUM-HSGNT-STATUS-TOPUP = 'A' OR 'R'                          
              MOVE 'TUG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD00-NUM-HSGNT-STATUS-TOPUP = 'A'                           
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                    MOVE KD00-DTE-HSGNT-APPROVE-TOPUP                           
                                             TO WS-KD00-DTE-PROCESS-TUG         
                 END-IF                                                         
                 IF KD00-NUM-HSGNT-STATUS-TOPUP = 'R'                           
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                    MOVE KD00-DTE-HSGNT-REJECT-TOPUP                            
                                             TO WS-KD00-DTE-PROCESS-TUG         
                 END-IF                                                         
                 IF WS-KD00-DTE-PROCESS-TUG > WS-DTE-PROCESS                    
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-KD00-DTE-PROCESS-TUG = WS-DTE-PROCESS                 
                       IF KD00-NUM-HSGNT-STATUS-TOPUP =                         
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-TUG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD00-REC FROM BP13KD00-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD00                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD00-NUM-HSGNT-STATUS-TOPUP = 'A'                        
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                       MOVE KD00-DTE-HSGNT-APPROVE-TOPUP                        
                                            TO WS-KD00-DTE-PROCESS-TUG          
                    END-IF                                                      
                    IF KD00-NUM-HSGNT-STATUS-TOPUP = 'R'                        
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                       MOVE KD00-DTE-HSGNT-REJECT-TOPUP                         
                                            TO WS-KD00-DTE-PROCESS-TUG          
                    END-IF                                                      
                    IF WS-KD00-DTE-PROCESS-TUG > WS-DTE-PROCESS                 
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD00-REC FROM BP13KD00-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD00                               
                       END-IF                                                   
                    ELSE                                                        
                       IF WS-KD00-DTE-PROCESS-TUG = WS-DTE-PROCESS              
                          IF KD00-NUM-HSGNT-STATUS-TOPUP =                      
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-TUG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD00-REC FROM BP13KD00-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD00                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF KD00-NUM-PHG-STATUS = 'A'                                         
              MOVE 'PHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF KD00-DTE-PHG-APPROVE > WS-DTE-APRV                          
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF KD00-DTE-PHG-APPROVE = WS-DTE-APRV                       
                       IF KD00-NUM-PHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13FD00-REC FROM BP13KD00-REC                
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-FD00                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF KD00-DTE-PHG-APPROVE > WS-DTE-APRV                       
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13FD00-REC FROM BP13KD00-REC                  
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-FD00                               
                       END-IF                                                   
                    ELSE                                                        
                       IF KD00-DTE-PHG-APPROVE = WS-DTE-APRV                    
                          IF KD00-NUM-PHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13FD00-REC FROM BP13KD00-REC           
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-FD00                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                               WRITE BP13FD00-REC FROM BP13KD00-REC             
                               MOVE 'Y' TO WS-WRITTEN                           
                               ADD 1 TO WS-CREATE-FD00                          
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13FD00-REC FROM BP13KD00-REC                     
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-FD00                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4010-CHECK-KD00-DATES.                                                   
      ******************************************************************        
                                                                                
           MOVE KD00-DTE-HSGNT-APPROVE TO WS-IN-DATE.                           
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-HSGNT-APPROVE                         
           END-IF.                                                              
                                                                                
           MOVE KD00-DTE-HSGNT-REJECT TO WS-IN-DATE.                            
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-HSGNT-REJECT                          
           END-IF.                                                              
                                                                                
           MOVE KD00-DTE-HSGNT-APPROVE-TOPUP TO WS-IN-DATE.                     
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-HSGNT-APPROVE-TOPUP                   
           END-IF.                                                              
                                                                                
           MOVE KD00-DTE-HSGNT-REJECT-TOPUP TO WS-IN-DATE.                      
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-HSGNT-REJECT-TOPUP                    
           END-IF.                                                              
                                                                                
           MOVE KD00-DTE-PHG-APPROVE TO WS-IN-DATE.                             
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-PHG-APPROVE                           
           END-IF.                                                              
                                                                                
           MOVE KD00-DTE-HSGNT-REJECT TO WS-IN-DATE.                            
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO KD00-DTE-HSGNT-REJECT                          
           END-IF.                                                              
                                                                                
       4010-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       4100-READ-BP13F800.                                                      
      *-------------------*                                                     
                                                                                
           READ BP13F800 AT END                                                 
                MOVE HIGH-VALUES TO BP13K800-MASTER                             
                MOVE 'Y' TO WS-EOF-F800                                         
                GO TO 4100-EXIT.                                                
                                                                                
           MOVE K800-DTE-AHG-PROCESS TO WS-IN-DATE.                             
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO K800-DTE-AHG-PROCESS                           
           END-IF.                                                              
                                                                                
           ADD 1 TO CNT-F800-READ.                                              
                                                                                
           MOVE 'N' TO WS-WRITTEN.                                              
           MOVE K800-NUM-REGN TO WS-NUM-REGN.                                   
                                                                                
           PERFORM 1700-GET-KD05-SUM THRU 1700-EXIT.                            
                                                                                
           IF K800-NUM-AHG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'AHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF K800-NUM-AHG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF K800-NUM-AHG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF K800-NUM-AHG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF K800-DTE-AHG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13F800-MASTER FROM BP13K800-MASTER               
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-F800                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF K800-DTE-AHG-PROCESS = WS-DTE-PROCESS                    
                       IF K800-NUM-AHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                              WRITE BP13F800-MASTER FROM BP13K800-MASTER        
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-F800                           
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE BP13F800-MASTER FROM BP13K800-MASTER          
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-F800                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF K800-NUM-AHG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF K800-NUM-AHG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF K800-NUM-AHG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF K800-DTE-AHG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE BP13F800-MASTER FROM BP13K800-MASTER            
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-F800                               
                       END-IF                                                   
                    ELSE                                                        
                       IF K800-DTE-AHG-PROCESS = WS-DTE-PROCESS                 
                          IF K800-NUM-AHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE BP13F800-MASTER                          
                                                   FROM BP13K800-MASTER         
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-F800                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                              WRITE BP13F800-MASTER FROM BP13K800-MASTER        
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-F800                           
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE BP13F800-MASTER FROM BP13K800-MASTER               
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-F800                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       4200-READ-PREJF800.                                                      
      *-------------------*                                                     
                                                                                
           READ PREJF800 AT END                                                 
                MOVE HIGH-VALUES TO PREJF800-MASTER                             
                MOVE 'Y' TO WS-EOF-PREJ-F800                                    
                GO TO 4200-EXIT.                                                
                                                                                
           MOVE PREJ-DTE-AHG-PROCESS TO WS-IN-DATE.                             
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO PREJ-DTE-AHG-PROCESS                           
           END-IF.                                                              
                                                                                
           MOVE PREJ-DTE-SHG-PROCESS TO WS-IN-DATE.                             
           MOVE 'CD' TO WS-IN-OPTION.                                           
           CALL 'AV02C001' USING LINK-REC                                       
           IF WS-RETURN NOT = '000'                                             
              MOVE '00010101' TO PREJ-DTE-SHG-PROCESS                           
           END-IF.                                                              
                                                                                
           ADD 1 TO CNT-PREJ-F800-READ.                                         
                                                                                
           MOVE 'N' TO WS-WRITTEN.                                              
           MOVE PREJ-NUM-REGN TO WS-NUM-REGN.                                   
                                                                                
           PERFORM 1700-GET-KD05-SUM THRU 1700-EXIT.                            
                                                                                
           IF PREJ-NUM-AHG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'AHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF PREJ-NUM-AHG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-NUM-AHG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-NUM-AHG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-DTE-AHG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE P13F800B-REC FROM PREJF800-MASTER                  
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-PREJ                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF PREJ-DTE-AHG-PROCESS = WS-DTE-PROCESS                    
                       IF PREJ-NUM-AHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                              WRITE P13F800B-REC FROM PREJF800-MASTER           
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-PREJ                           
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE P13F800B-REC FROM PREJF800-MASTER             
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-PREJ                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF PREJ-NUM-AHG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-NUM-AHG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-NUM-AHG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-DTE-AHG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE P13F800B-REC FROM PREJF800-MASTER               
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-PREJ                               
                       END-IF                                                   
                    ELSE                                                        
                       IF PREJ-DTE-AHG-PROCESS = WS-DTE-PROCESS                 
                          IF PREJ-NUM-AHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-AHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE P13F800B-REC FROM PREJF800-MASTER        
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-PREJ                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                              WRITE P13F800B-REC FROM PREJF800-MASTER           
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-PREJ                           
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE P13F800B-REC FROM PREJF800-MASTER                  
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-PREJ                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF PREJ-NUM-SHG-STATUS = 'A' OR 'R' OR 'W'                           
              MOVE 'SHG' TO WS-GRANT-TYPE                                       
              PERFORM 2000-READ-GRANT-ASMNT THRU 2000-EXIT                      
              IF WS-GRANT-ASMNT-FND = 'Y'                                       
                 IF PREJ-NUM-SHG-STATUS = 'A'                                   
                    MOVE WS-DTE-APRV TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-NUM-SHG-STATUS = 'R'                                   
                    MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-NUM-SHG-STATUS = 'W'                                   
                    MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                          
                 END-IF                                                         
                 IF PREJ-DTE-SHG-PROCESS > WS-DTE-PROCESS                       
                    PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                      
                    IF WS-WRITTEN = 'N'                                         
                       WRITE P13F800B-REC FROM PREJF800-MASTER                  
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-PREJ                                  
                    END-IF                                                      
                 ELSE                                                           
                    IF PREJ-DTE-SHG-PROCESS = WS-DTE-PROCESS                    
                       IF PREJ-NUM-SHG-STATUS =                                 
                                  NUM-GRANT-STATUS OF DCLGRANT-ASMNT            
                         PERFORM 1900-GET-DB2-AMT-SUM THRU 1900-EXIT            
                         IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM              
                            PERFORM 2200-DELETE-FROM-LIVE THRU 2200-EXIT        
                            IF WS-WRITTEN = 'N'                                 
                              WRITE P13F800B-REC FROM PREJF800-MASTER           
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-PREJ                           
                            END-IF                                              
                         END-IF                                                 
                       ELSE                                                     
                         PERFORM 2100-DROP-TO-EX THRU 2100-EXIT                 
                         IF WS-WRITTEN = 'N'                                    
                            WRITE P13F800B-REC FROM PREJF800-MASTER             
                            MOVE 'Y' TO WS-WRITTEN                              
                            ADD 1 TO WS-CREATE-PREJ                             
                         END-IF                                                 
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              ELSE                                                              
                 PERFORM 3000-READ-EX-GRANT-ASMNT THRU 3000-EXIT                
                 IF WS-EX-GRANT-ASMNT-FND = 'Y'                                 
                    IF PREJ-NUM-SHG-STATUS = 'A'                                
                       MOVE WS-DTE-APRV TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-NUM-SHG-STATUS = 'R'                                
                       MOVE WS-DTE-RJCT TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-NUM-SHG-STATUS = 'W'                                
                       MOVE WS-DTE-WDWL TO WS-DTE-PROCESS                       
                    END-IF                                                      
                    IF PREJ-DTE-SHG-PROCESS > WS-DTE-PROCESS                    
                       IF WS-WRITTEN = 'N'                                      
                          WRITE P13F800B-REC FROM PREJF800-MASTER               
                          MOVE 'Y' TO WS-WRITTEN                                
                          ADD 1 TO WS-CREATE-PREJ                               
                       END-IF                                                   
                    ELSE                                                        
                       IF PREJ-DTE-SHG-PROCESS = WS-DTE-PROCESS                 
                          IF PREJ-NUM-SHG-STATUS =                              
                                  NUM-GRANT-STATUS OF DCLEX-GRANT-ASMNT         
                            PERFORM 1950-GET-DB2-AMT-SUM-EX                     
                                                         THRU 1950-EXIT         
                            IF WS-KD05-AMT-SHG NOT = WS-GRANT-AMT-SUM           
                              PERFORM 2400-DELETE-FROM-EX THRU 2400-EXIT        
                              IF WS-WRITTEN = 'N'                               
                                 WRITE P13F800B-REC FROM PREJF800-MASTER        
                                 MOVE 'Y' TO WS-WRITTEN                         
                                 ADD 1 TO WS-CREATE-PREJ                        
                              END-IF                                            
                            END-IF                                              
                          ELSE                                                  
                            IF WS-WRITTEN = 'N'                                 
                              WRITE P13F800B-REC FROM PREJF800-MASTER           
                              MOVE 'Y' TO WS-WRITTEN                            
                              ADD 1 TO WS-CREATE-PREJ                           
                            END-IF                                              
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 ELSE                                                           
                    IF WS-WRITTEN = 'N'                                         
                       WRITE P13F800B-REC FROM PREJF800-MASTER                  
                       MOVE 'Y' TO WS-WRITTEN                                   
                       ADD 1 TO WS-CREATE-PREJ                                  
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------------*                                                    
       8000-INSERT-TO-LOG.                                                      
      *--------------------*                                                    
            EXEC SQL                                                            
                 SET :WS-TIMESTAMP-LOG = CURRENT TIMESTAMP                      
            END-EXEC.                                                           
            IF SQLCODE NOT = 000                                                
               MOVE SQLCODE          TO WS-SQLCODE                              
               DISPLAY 'SQL ERROR SET DB2 TIMESTAMP'                            
               DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                         
               PERFORM 9999-SQL-ERROR THRU 9999-EXIT                            
            END-IF.                                                             
                                                                                
           MOVE WS-TIMESTAMP-LOG TO TME-UPDATE OF DCLGRANT-UPDATE-LOG.          
           MOVE 'BP13CB0I'  TO NUM-UPDATE-USERID OF DCLGRANT-UPDATE-LOG.        
           MOVE WS-SOURCE   TO NUM-SOURCE-RECORD OF DCLGRANT-UPDATE-LOG.        
           MOVE WS-ACTION     TO NUM-ACTION OF DCLGRANT-UPDATE-LOG.             
           MOVE WS-RGSTRN     TO NUM-RGSTRN OF DCLGRANT-UPDATE-LOG.             
           MOVE WS-GRNT-TYPE TO NUM-GRANT-TYPE OF DCLGRANT-UPDATE-LOG.          
           MOVE WS-BEFORE-IMAGE TO TXT-BEFORE-IMAGE-TEXT                        
                                              OF DCLGRANT-UPDATE-LOG.           
           MOVE LENGTH OF WS-BEFORE-IMAGE TO TXT-BEFORE-IMAGE-LEN               
                                              OF DCLGRANT-UPDATE-LOG.           
           MOVE WS-AFTER-IMAGE TO TXT-AFTER-IMAGE-TEXT                          
                                              OF DCLGRANT-UPDATE-LOG.           
           MOVE LENGTH OF WS-AFTER-IMAGE TO TXT-AFTER-IMAGE-LEN                 
                                              OF DCLGRANT-UPDATE-LOG.           
            EXEC SQL                                                            
                 INSERT INTO GRANT_UPDATE_LOG                                   
                        ( TME_UPDATE,                                           
                          NUM_UPDATE_USERID,                                    
                          NUM_SOURCE_RECORD,                                    
                          NUM_ACTION,                                           
                          NUM_RGSTRN,                                           
                          NUM_GRANT_TYPE,                                       
                          TXT_BEFORE_IMAGE,                                     
                          TXT_AFTER_IMAGE )                                     
                 VALUES ( :DCLGRANT-UPDATE-LOG.TME-UPDATE,                      
                          :DCLGRANT-UPDATE-LOG.NUM-UPDATE-USERID,               
                          :DCLGRANT-UPDATE-LOG.NUM-SOURCE-RECORD,               
                          :DCLGRANT-UPDATE-LOG.NUM-ACTION,                      
                          :DCLGRANT-UPDATE-LOG.NUM-RGSTRN,                      
                          :DCLGRANT-UPDATE-LOG.NUM-GRANT-TYPE,                  
                          :DCLGRANT-UPDATE-LOG.TXT-BEFORE-IMAGE,                
                          :DCLGRANT-UPDATE-LOG.TXT-AFTER-IMAGE )                
            END-EXEC.                                                           
                                                                                
            EVALUATE SQLCODE                                                    
               WHEN 000                                                         
                    ADD 1                 TO WS-GRNT-UPD-LOG                    
                                                                                
               WHEN -803                                                        
                    CONTINUE                                                    
                                                                                
               WHEN OTHER                                                       
                    MOVE SQLCODE          TO WS-SQLCODE                         
                    DISPLAY 'SQL ERROR (INSERT) IN GRANT_UPDATE_LOG'            
                    DISPLAY 'SQL ERROR CODE  : '  WS-SQLCODE                    
                    PERFORM 9999-SQL-ERROR      THRU 9999-EXIT                  
            END-EVALUATE.                                                       
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-----------------*                                                       
       9000-CLOSE-FILES.                                                        
      *-----------------*                                                       
                                                                                
           DISPLAY '******  BP13CB0I *************'.                            
           DISPLAY 'RECS READ FROM  BP13FD07     : ' CNT-FD07-READ.             
           DISPLAY 'RECS READ FROM  PREJF800     : ' CNT-PREJ-F800-READ.        
           DISPLAY 'RECS READ FROM  BP13FD00     : ' CNT-FD00-READ.             
           DISPLAY 'RECS DROPPED FROM LIVE TO EX : ' WS-EX-GRANT-INS.           
           DISPLAY 'RECS DELETED FROM LIVE TABLE : ' WS-GRANT-DELETE.           
           DISPLAY 'RECS DELETED FROM EX TABLE   : ' WS-EX-GRANT-DELETE.        
           DISPLAY 'RECS WRITTEN TO UPDATE LOG   : ' WS-GRNT-UPD-LOG.           
           DISPLAY 'REGNO TO BE CREATED FOR PREJULY : ' WS-CREATE-FD07.         
           DISPLAY 'REGNO TO BE CREATED FOR PREJK800: ' WS-CREATE-PREJ.         
           DISPLAY 'REGNO TO BE CREATED FOR DBSS    : ' WS-CREATE-FD00.         
           DISPLAY 'REGNO TO BE CREATED FOR DBSS AHG: ' WS-CREATE-F800.         
                                                                                
           CLOSE BP13FD07                                                       
                 BP13F800                                                       
                 PREJF800                                                       
                 BP13KD05                                                       
                 BP13FD00                                                       
                 P13FD07A                                                       
                 P13F800B                                                       
                 P13F800A                                                       
                 P13FD00A.                                                      
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *****************************************************************         
       9100-COMMIT.                                                             
      *****************************************************************         
           EXEC SQL                                                             
                COMMIT                                                          
           END-EXEC                                                             
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN 000                                                             
                CONTINUE                                                        
           WHEN OTHER                                                           
                PERFORM 9999-SQL-ERROR    THRU 9999-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       9100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------         
       9999-SQL-ERROR.                                                          
      *----------------------------------------------------------------         
           CALL 'DBATIAR'  USING SQLCA.                                         
           EXEC SQL ROLLBACK               END-EXEC.                            
           MOVE 99                         TO    RETURN-CODE.                   
           PERFORM 9000-CLOSE-FILES        THRU  9000-EXIT.                     
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
