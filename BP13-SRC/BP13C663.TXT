       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C663.                                                 
      *AUTHOR.        SGK.                                                      
      *DATE-WRITTEN.  13/11/97.                                                 
      * =========================================================== *           
      * SYSTEM OF COMMITMENT (SOC)                                  *           
      * =========================================================== *           
      *                                                             *           
      *  OBJECTIVE  :  CREATE 1-MONTH APPOINTMENT TIME-TABLE        *           
      *                                                             *           
      *  I/O FILE                                                   *           
      *  --------                                                   *           
      *         I   :  CP27.K090.HOLIDAY                            *           
      *             :  BP13.K388.TIMESLOT                           *           
      *         O   :  BP13.F382.WORKPLAN                           *           
      *                                                             *           
      * ----------------------------------------------------------- *           
      * CHG REF  DATE   BY   DESCRIPTION                            *           
      * -------- ------ ---  -----------                            *           
      * BP130408 131197 SGK  NEW PGM.                               *           
      * BP130418 250398 SIA  YEAR 2000 CHANGES                      *           
      *                      CHG AV02C010 TO AV02C001               *           
      * BP132055 090302 JAM1 CHANGE HOLIDAY REFERENCE FILE FROM     *           
      *                      CP16K090 TO CP27K090.                  *           
      * =========================================================== *           
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.   IBM-3090.                                             
       OBJECT-COMPUTER.   IBM-3090.                                             
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT CP27K090                                                      
              ASSIGN       TO CP27K090                                          
              ACCESS MODE  IS RANDOM                                            
              ORGANIZATION IS INDEXED                                           
              RECORD KEY   IS K090-KEY                                          
              FILE STATUS  IS K090-STATUS.                                      
                                                                                
           SELECT BP13K388                                                      
              ASSIGN       TO BP13K388                                          
              ACCESS MODE  IS DYNAMIC                                           
              ORGANIZATION IS INDEXED                                           
              RECORD KEY   IS K388-KEY-FLD                                      
              FILE STATUS  IS K388-STATUS.                                      
                                                                                
           SELECT BP13K382 ASSIGN TO BP13K382.                                  
                                                                                
           SELECT BP13F382 ASSIGN TO BP13F382.                                  
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD  CP27K090                                                             
           RECORD CONTAINS 50 CHARACTERS.                                       
       COPY CP27K090.                                                           
                                                                                
       FD  BP13K388                                                             
           RECORD CONTAINS 350 CHARACTERS.                                      
       COPY BP13K388.                                                           
                                                                                
       FD  BP13F382                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 450 CHARACTERS                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD.                                          
       COPY BP13F382.                                                           
                                                                                
       FD  BP13K382                                                             
           RECORD CONTAINS 450 CHARACTERS.                                      
       COPY BP13K382.                                                           
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  K388-STATUS                    PIC XX    VALUE ZEROS.                
       01  K388-EOF                       PIC X     VALUE SPACES.               
       01  WS-EOF-F382                    PIC XXX   VALUE SPACES.               
           88  END-OF-F382                VALUE 'YES'.                          
       01  WS-F382-READ                   PIC 999   VALUE ZEROS.                
                                                                                
       01  K090-STATUS                    PIC XX    VALUE ZEROS.                
           88  K090-FOUND                 VALUE ZEROS.                          
           88  K090-NOTFND                VALUE '23'.                           
                                                                                
       01  WS-CUR-DATE.                                                         
           05  WS-CUR-DTE-CC               PIC 99.                              
           05  WS-CUR-DTE-YY               PIC 99.                              
           05  WS-CUR-DTE-MM               PIC 99.                              
           05  WS-CUR-DTE-DD               PIC 99.                              
                                                                                
       01  WS-DTE-DISPLAY                 PIC X(10) VALUE SPACES.               
                                                                                
      *---------------------------------------------------------*               
      *    DEFINE APPOINTMENT TABEL FROM BP13K388               *               
      *---------------------------------------------------------*               
       01  MN-APPOINT-TABLE-WKDAY.                                              
           05  MN-APPOINT OCCURS 50 TIMES.                                      
               10  MN-TME-SLOT.                                                 
                   15  MN-TME-HH          PIC 9(2).                             
                   15  MN-TME-MM          PIC 9(2).                             
               10  MN-NUM-MAX-CASE        PIC 9(2).                             
                                                                                
       01  TU-APPOINT-TABLE-WKDAY.                                              
           05  TU-APPOINT OCCURS 50 TIMES.                                      
               10  TU-TME-SLOT.                                                 
                   15  TU-TME-HH          PIC 9(2).                             
                   15  TU-TME-MM          PIC 9(2).                             
               10  TU-NUM-MAX-CASE        PIC 9(2).                             
                                                                                
       01  WE-APPOINT-TABLE-WKDAY.                                              
           05  WE-APPOINT OCCURS 50 TIMES.                                      
               10  WE-TME-SLOT.                                                 
                   15  TU-TME-HH          PIC 9(2).                             
                   15  TU-TME-MM          PIC 9(2).                             
               10  WE-NUM-MAX-CASE        PIC 9(2).                             
                                                                                
       01  TH-APPOINT-TABLE-WKDAY.                                              
           05  TH-APPOINT OCCURS 50 TIMES.                                      
               10  TH-TME-SLOT.                                                 
                   15  TH-TME-HH          PIC 9(2).                             
                   15  TH-TME-MM          PIC 9(2).                             
               10  TH-NUM-MAX-CASE        PIC 9(2).                             
                                                                                
       01  FR-APPOINT-TABLE-FRDAY.                                              
           05  FR-APPOINT OCCURS 50 TIMES.                                      
               10  FR-TME-SLOT.                                                 
                   15  FR-TME-HH          PIC 9(2).                             
                   15  FR-TME-MM          PIC 9(2).                             
               10  FR-NUM-MAX-CASE        PIC 9(2).                             
                                                                                
       01  SAT-APPOINT-TABLE-SATDAY.                                            
           05  SAT-APPOINT OCCURS 50 TIMES.                                     
               10  SAT-TME-SLOT.                                                
                   15  SAT-TME-HH         PIC 9(2).                             
                   15  SAT-TME-MM         PIC 9(2).                             
               10  SAT-NUM-MAX-CASE       PIC 9(2).                             
                                                                                
       01  SUN-APPOINT-TABLE-SUNDAY.                                            
           05  SUN-APPOINT OCCURS 50 TIMES.                                     
               10  SUN-TME-SLOT.                                                
                   15  SUN-TME-HH          PIC 9(2).                            
                   15  SUN-TME-MM          PIC 9(2).                            
               10  SUN-NUM-MAX-CASE        PIC 9(2).                            
                                                                                
       01  WS-DATE.                                                             
           05  WS-YEAR-CNT.                                                     
               07  WS-CENT                PIC 9(2).                             
               07  WS-YY                  PIC 9(2).                             
           05  WS-YEAR-R REDEFINES WS-YEAR-CNT PIC 9(4).                        
           05  WS-MONTH-CNT               PIC 9(2).                             
               88  31DAY-MTH              VALUE 1, 3, 5, 7, 8, 10, 12.          
               88  30DAY-MTH              VALUE 4, 6, 9, 11.                    
               88  FEB-MTH                VALUE 2.                              
           05  WS-DAY-CNT                 PIC 9(2).                             
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-CNT                     PIC 9(2) VALUE ZEROS.                 
           05  WS-HOLIDAY-CNT             PIC 9(3) VALUE ZEROS.                 
           05  WS-K090-READ               PIC 9(5) VALUE ZEROS.                 
           05  WS-K388-READ               PIC 9(5) VALUE ZEROS.                 
           05  WS-F382-WRITE              PIC 9(5) VALUE ZEROS.                 
           05  WS-F382-START-DATE.                                              
               10  WS-F382-START-YYMM     PIC X(6) VALUE SPACES.                
               10  WS-F382-START-DD       PIC 9(2) VALUE ZEROS.                 
           05  WS-F382-END-DATE.                                                
               10  WS-F382-END-YYMM       PIC X(6) VALUE SPACES.                
               10  WS-F382-END-DD         PIC 9(2) VALUE ZEROS.                 
           05  LEAP-YEAR                  PIC 9(2) VALUE ZEROS.                 
           05  LEAP-YY-RR                 PIC 9(1) VALUE ZEROS.                 
           05  INVALID-CNT                PIC 9(1) VALUE ZERO.                  
                                                                                
       01  LINK-REC.                                                            
           03  WS-IN-OPTION               PIC X(2).                             
           03  LINK-DATE.                                                       
               05  LINK-CC                PIC 99   VALUE ZEROS.                 
               05  LINK-YY                PIC 99   VALUE ZEROS.                 
               05  LINK-MM                PIC 99   VALUE ZEROS.                 
               05  LINK-DD                PIC 99   VALUE ZEROS.                 
           03  LINK-DAY-WEEK1             PIC X(3) VALUE SPACES.                
                                                                                
       01  LINK-DAY-WEEK                  PIC 9    VALUE ZERO.                  
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN-LOGIC.                                                         
      *-------------------------------------------------------------            
           PERFORM  0100-INITIALIZATION         THRU 0100-EXIT.                 
           PERFORM  0150-OPEN-FILES             THRU 0150-EXIT.                 
           PERFORM  0180-READ-F382  THRU 0180-EXIT UNTIL END-OF-F382.           
           PERFORM  0200-SET-TIMESLOT           THRU 0200-EXIT.                 
           PERFORM  1000-MAIN-PROCESS           THRU 1000-EXIT.                 
           PERFORM  7000-DISPLAY-TOTAL          THRU 7000-EXIT.                 
           PERFORM  9000-CLOSE-FILES            THRU 9000-EXIT.                 
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ** SET UP THE CALENDER 3 MONTHS AHEAD FROM SYSTEM                         
                                                                                
       0100-INITIALIZATION.                                                     
      *-------------------------------------------------------------            
           MOVE FUNCTION CURRENT-DATE TO WS-CUR-DATE.                           
           STRING WS-CUR-DTE-DD '/'  WS-CUR-DTE-MM '/'                          
                  WS-CUR-DTE-CC WS-CUR-DTE-YY                                   
                  DELIMITED BY SIZE INTO WS-DTE-DISPLAY.                        
                                                                                
       0100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       0150-OPEN-FILES.                                                         
      *-------------------------------------------------------------            
           OPEN INPUT  CP27K090                                                 
                       BP13K388                                                 
                       BP13K382                                                 
                OUTPUT BP13F382.                                                
                                                                                
           IF K388-STATUS NOT = ZEROS AND '97'                                  
              DISPLAY 'ERROR IN OPEN BP13K388 : ' K388-STATUS                   
              MOVE K388-STATUS TO RETURN-CODE                                   
              PERFORM  9000-CLOSE-FILES THRU  9000-EXIT.                        
                                                                                
           IF K090-STATUS NOT = ZEROS AND '97'                                  
              DISPLAY 'ERROR IN OPEN CP27K090 : ' K090-STATUS                   
              MOVE K090-STATUS TO RETURN-CODE                                   
              PERFORM  9000-CLOSE-FILES THRU  9000-EXIT.                        
                                                                                
       0150-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ** SYSTEM TO GET THE LAST DAY FROM WORKPLAN.                              
                                                                                
       0180-READ-F382.                                                          
      *-------------------------------------------------------------            
           READ BP13K382 AT END                                                 
           PERFORM 0190-EOF-F382 THRU 0190-EXIT                                 
           GO TO 0180-EXIT.                                                     
                                                                                
           ADD 1 TO WS-F382-READ.                                               
                                                                                
       0180-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       0190-EOF-F382.                                                           
      *-------------------------------------------------------------            
           MOVE 'YES' TO WS-EOF-F382.                                           
           IF   K382-DTE-APPT  IS NOT NUMERIC                                   
                MOVE  WS-CUR-DATE  TO      K382-DTE-APPT                        
           END-IF.                                                              
                                                                                
           MOVE K382-DTE-APPT  TO WS-CUR-DATE.                                  
           MOVE WS-CUR-DTE-CC  TO WS-CENT.                                      
           MOVE WS-CUR-DTE-YY  TO WS-YY.                                        
           COMPUTE WS-MONTH-CNT = WS-CUR-DTE-MM + 1.                            
           IF WS-MONTH-CNT > 12                                                 
              COMPUTE WS-MONTH-CNT = WS-MONTH-CNT - 12                          
              COMPUTE WS-YEAR-R   = WS-YEAR-R + 1.                              
                                                                                
       0190-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       0200-SET-TIMESLOT.                                                       
      *-------------------------------------------------------------            
           MOVE SPACES TO K388-CDE-APPT-TYPE.                                   
           MOVE SPACES TO K388-CDE-DAY-OF-WEEK.                                 
           START BP13K388 KEY NOT LESS THAN K388-KEY-FLD                        
           IF K388-STATUS = ZEROS                                               
              PERFORM 0230-READ-TIMESLOT-FILE THRU 0230-EXIT                    
              PERFORM 0220-PROCESS-TIMESLOT-TABLE THRU 0220-EXIT                
                              UNTIL K388-EOF = 'Y'                              
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K388 ' K388-STATUS                     
              MOVE K388-STATUS TO RETURN-CODE                                   
              PERFORM  9000-CLOSE-FILES THRU  9000-EXIT.                        
                                                                                
       0200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       0220-PROCESS-TIMESLOT-TABLE.                                             
      *-------------------------------------------------------------            
           PERFORM 0250-SETUP-APPTABLE THRU 0250-EXIT                           
                  VARYING WS-CNT FROM 1 BY 1 UNTIL WS-CNT > 50.                 
           PERFORM 0230-READ-TIMESLOT-FILE THRU 0230-EXIT.                      
                                                                                
       0220-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ** READ BP13K388 TO GET THE TIMESLOT FOR THE DAY, THE MAX STAFFS          
      ** FOR FRIDAY AND SUNDAY IS DIFFIRENT FROM WEEKDAY                        
                                                                                
       0230-READ-TIMESLOT-FILE.                                                 
      *-------------------------------------------------------------            
           READ BP13K388 NEXT AT END MOVE 'Y' TO K388-EOF                       
                  GO TO 0230-EXIT.                                              
           ADD 1 TO WS-K388-READ.                                               
                                                                                
       0230-EXIT.                                                               
           EXIT.                                                                
                                                                                
       0250-SETUP-APPTABLE.                                                     
      *-------------------------------------------------------------            
           IF K388-CDE-DAY-OF-WEEK = '1'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO MN-APPOINT(WS-CNT).          
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '2'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO TU-APPOINT(WS-CNT).          
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '3'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO WE-APPOINT(WS-CNT).          
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '4'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO TH-APPOINT(WS-CNT).          
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '5'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO FR-APPOINT(WS-CNT).          
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '6'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO SAT-APPOINT(WS-CNT).         
                                                                                
           IF K388-CDE-DAY-OF-WEEK = '7'                                        
               MOVE K388-TIMESLOT-TABLE(WS-CNT) TO SUN-APPOINT(WS-CNT).         
                                                                                
       0250-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      **  SET UP TIMESLOT FOR THE WHOLE MONTH                                   
                                                                                
       1000-MAIN-PROCESS.                                                       
      *-------------------------------------------------------------            
      **  FOR DISPLAY THE STARTING DATE ON CONTROL REPORT                       
           MOVE WS-DATE          TO  WS-F382-START-DATE.                        
           MOVE 01               TO  WS-F382-START-DD.                          
                                                                                
           IF  FEB-MTH                                                          
               PERFORM 6000-CALCULATE-LEAP-YEAR                                 
                  THRU 6000-EXIT.                                               
                                                                                
           IF  31DAY-MTH                                                        
               PERFORM 2000-ADD-TIME-TABLE                                      
                  THRU 2000-EXIT                                                
               VARYING WS-DAY-CNT FROM 1 BY 1                                   
                 UNTIL WS-DAY-CNT > 31                                          
           ELSE                                                                 
           IF 30DAY-MTH                                                         
               PERFORM 2000-ADD-TIME-TABLE                                      
                  THRU 2000-EXIT                                                
               VARYING WS-DAY-CNT FROM 1 BY 1                                   
                 UNTIL WS-DAY-CNT > 30                                          
           ELSE                                                                 
           IF FEB-MTH                                                           
              IF LEAP-YY-RR = 0                                                 
                 PERFORM 2000-ADD-TIME-TABLE                                    
                    THRU 2000-EXIT                                              
                 VARYING WS-DAY-CNT FROM 1 BY 1                                 
                   UNTIL WS-DAY-CNT > 29                                        
              ELSE                                                              
                 PERFORM 2000-ADD-TIME-TABLE                                    
                    THRU 2000-EXIT                                              
                 VARYING WS-DAY-CNT FROM 1 BY 1                                 
                   UNTIL WS-DAY-CNT > 28                                        
           ELSE                                                                 
              NEXT SENTENCE.                                                    
                                                                                
      **  FOR DISPLAY THE ENDING DATE ON CONTROL REPORT                         
           MOVE WS-DATE          TO  WS-F382-END-DATE.                          
           SUBTRACT 1            FROM WS-F382-END-DD.                           
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ** CP27K090 IS A FILE KEEPING THE HOLIDAY AND SUNDAY RECORD               
      ** IF K090-CDE-HOLIDAY = 'S' MEANS SUNDAY                                 
      ** IF K090-CDE-HOLIDAY = 'H' MEANS HOLIDAY                                
                                                                                
       2000-ADD-TIME-TABLE.                                                     
      *-------------------------------------------------------------            
           MOVE WS-DATE         TO  K090-KEY.                                   
                                                                                
           READ CP27K090.                                                       
           ADD 1            TO WS-K090-READ.                                    
           IF K090-NOTFND                                                       
              PERFORM 3000-SETUP-F382-REC  THRU 3000-EXIT                       
           ELSE                                                                 
           IF K090-FOUND                                                        
      *       IF K090-CDE-HOLIDAY = 'S'                                         
      *           PERFORM 3000-SETUP-F382-REC  THRU 3000-EXIT                   
      *       ELSE                                                              
                  ADD 1            TO WS-HOLIDAY-CNT                            
           ELSE                                                                 
              DISPLAY 'ERROR READING CP27K090   ' K090-STATUS                   
              MOVE K090-STATUS TO RETURN-CODE                                   
              PERFORM 9000-CLOSE-FILES                                          
                 THRU 9000-EXIT.                                                
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       3000-SETUP-F382-REC.                                                     
      *-------------------------------------------------------------            
           MOVE SPACES           TO  BP13F382-REC.                              
           MOVE WS-DATE          TO  F382-KEY-FLD.                              
           MOVE WS-CUR-DATE      TO  F382-DTE-UPDATE.                           
                                                                                
           PERFORM 3500-COMPUTE-DAY-OF-WEEK THRU 3500-EXIT.                     
                                                                                
           EVALUATE LINK-DAY-WEEK                                               
              WHEN 1                                                            
                 PERFORM 4000-PROCESS-MONDAY-TIME-TABLE                         
                    THRU 4000-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 2                                                            
                 PERFORM 4100-PROCESS-TUEDAY-TIME-TABLE                         
                    THRU 4100-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 3                                                            
                 PERFORM 4200-PROCESS-WEDDAY-TIME-TABLE                         
                    THRU 4200-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 4                                                            
                 PERFORM 4300-PROCESS-THRDAY-TIME-TABLE                         
                    THRU 4300-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 5                                                            
                 PERFORM 4500-PROCESS-FRI-TIME-TABLE                            
                    THRU 4500-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 6                                                            
                 PERFORM 5000-PROCESS-SAT-TIME-TABLE                            
                    THRU 5000-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              WHEN 7                                                            
                 PERFORM 5500-PROCESS-SUN-TIME-TABLE                            
                    THRU 5500-EXIT                                              
                 VARYING WS-CNT FROM 1 BY 1                                     
                   UNTIL WS-CNT > 50                                            
              END-EVALUATE.                                                     
                                                                                
      *    PERFORM 3800-COMPUTE-LASTDAY-OF-MTH THRU 3800-EXIT.                  
                                                                                
           WRITE BP13F382-REC.                                                  
           ADD 1 TO WS-F382-WRITE.                                              
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *                                                                         
      *  CALL SUBROUTINE BB12WDAY TO DETERMINE THE DAY OF THE WEEK,             
      *  IT RETURNS '1' FOR MONDAY, '7' FOR SUNDAY ACCORDINGLY                  
      *                                                                         
       3500-COMPUTE-DAY-OF-WEEK.                                                
      *-------------------------------------------------------------            
           MOVE 'DW'              TO WS-IN-OPTION.                              
           MOVE WS-DAY-CNT        TO LINK-DD.                                   
           MOVE WS-MONTH-CNT      TO LINK-MM.                                   
           MOVE WS-YY             TO LINK-YY.                                   
           IF WS-YY < 90                                                        
              MOVE 20 TO LINK-CC                                                
           ELSE                                                                 
              MOVE 19 TO LINK-CC                                                
           END-IF.                                                              
                                                                                
           DISPLAY 'LINK-DATE :' LINK-REC.                                      
                                                                                
           MOVE SPACES            TO LINK-DAY-WEEK1.                            
                                                                                
           CALL  'AV02C001' USING LINK-REC.                                     
                                                                                
           DISPLAY 'LINK-DATE :' LINK-REC.                                      
           EVALUATE LINK-DAY-WEEK1                                              
           WHEN 'MON'                                                           
                 MOVE '1'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  1    TO  LINK-DAY-WEEK                                   
           WHEN 'TUE'                                                           
                 MOVE '2'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  2    TO  LINK-DAY-WEEK                                   
           WHEN 'WED'                                                           
                 MOVE '3'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  3    TO  LINK-DAY-WEEK                                   
           WHEN 'THU'                                                           
                 MOVE '4'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  4    TO  LINK-DAY-WEEK                                   
           WHEN 'FRI'                                                           
                 MOVE '5'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  5    TO  LINK-DAY-WEEK                                   
           WHEN 'SAT'                                                           
                 MOVE '6'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  6    TO  LINK-DAY-WEEK                                   
           WHEN 'SUN'                                                           
                 MOVE '7'   TO  F382-CDE-DAY-OF-WEEK                            
                 MOVE  7    TO  LINK-DAY-WEEK                                   
           END-EVALUATE.                                                        
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
       3800-COMPUTE-LASTDAY-OF-MTH.                                             
      *-------------------------------------------------------------            
           IF (31DAY-MTH AND WS-DAY-CNT = 31) OR                                
              (30DAY-MTH AND WS-DAY-CNT = 30) OR                                
              (FEB-MTH AND LEAP-YY-RR = 0 AND WS-DAY-CNT = 28) OR               
              (FEB-MTH AND LEAP-YY-RR NOT = 0 AND WS-DAY-CNT = 29)              
              PERFORM 5800-PROCESS-LASTDAY-TABLE                                
                 THRU 5800-EXIT                                                 
              VARYING WS-CNT FROM 2 BY 1                                        
                UNTIL WS-CNT > 50.                                              
                                                                                
       3800-EXIT.                                                               
           EXIT.                                                                
      *                                                                         
      * SET UP WORKPLAN FOR MONDAY, TUES, WED, THURSDAY                         
      *                                                                         
                                                                                
       4000-PROCESS-MONDAY-TIME-TABLE.                                          
      *-------------------------------------------------------------            
           MOVE MN-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)               
           MOVE MN-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).          
           MOVE ZEROS TO    F382-NUM-TOT-RDE(WS-CNT).                           
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       4100-PROCESS-TUEDAY-TIME-TABLE.                                          
      *-------------------------------------------------------------            
           MOVE TU-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)               
           MOVE TU-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).          
           MOVE ZEROS TO    F382-NUM-TOT-RDE(WS-CNT).                           
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4200-PROCESS-WEDDAY-TIME-TABLE.                                          
      *-------------------------------------------------------------            
           MOVE WE-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)               
           MOVE WE-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).          
           MOVE ZEROS TO    F382-NUM-TOT-RDE(WS-CNT).                           
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
       4300-PROCESS-THRDAY-TIME-TABLE.                                          
      *-------------------------------------------------------------            
           MOVE TH-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)               
           MOVE TH-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).          
           MOVE ZEROS TO    F382-NUM-TOT-RDE(WS-CNT).                           
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *                                                                         
      * SET UP WORKPLAN FOR FRIDAY                                              
      *                                                                         
       4500-PROCESS-FRI-TIME-TABLE.                                             
      *-------------------------------------------------------------            
           MOVE FR-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)               
           MOVE FR-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).          
           MOVE ZEROS                    TO F382-NUM-TOT-RDE(WS-CNT).           
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       5000-PROCESS-SAT-TIME-TABLE.                                             
      *-------------------------------------------------------------            
      * SET UP WORKPLAN FOR SAT                                                 
      *                                                                         
           MOVE SAT-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)              
           MOVE SAT-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).         
           MOVE ZEROES                   TO F382-NUM-TOT-RDE(WS-CNT).           
                                                                                
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
       5500-PROCESS-SUN-TIME-TABLE.                                             
      *-------------------------------------------------------------            
      * SET UP WORKPLAN FOR SUNDAY                                              
      *                                                                         
           MOVE SUN-TME-SLOT(WS-CNT)      TO F382-TME-SLOT(WS-CNT)              
           MOVE SUN-NUM-MAX-CASE(WS-CNT)  TO F382-NUM-MAX-CASE(WS-CNT).         
           MOVE ZEROES                   TO F382-NUM-TOT-RDE(WS-CNT).           
                                                                                
                                                                                
       5500-EXIT.                                                               
           EXIT.                                                                
      *                                                                         
      * SET UP WORKPLAN FOR LAST DAY OF THE MONTH, ONLY SCHEDULE UNTIL          
      *  5:00 PM                                                                
                                                                                
       5800-PROCESS-LASTDAY-TABLE.                                              
      *-------------------------------------------------------------            
           MOVE ZEROS         TO F382-NUM-MAX-CASE(WS-CNT).                     
                                                                                
       5800-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6000-CALCULATE-LEAP-YEAR.                                                
      *-------------------------------------------------------------            
           DIVIDE WS-YEAR-R   BY 4 GIVING LEAP-YEAR                             
                  REMAINDER LEAP-YY-RR.                                         
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       7000-DISPLAY-TOTAL.                                                      
      *-------------------------------------------------------------            
           DISPLAY '********************************************'.              
           DISPLAY '     CONTROL REPORT FOR BP13C663            '.              
           DISPLAY '                                            '.              
           DISPLAY 'DATE JOB RUN              : ' WS-DTE-DISPLAY.               
           DISPLAY 'NO BP13K388(WPLAN) READ   : ' WS-K388-READ.                 
           DISPLAY 'NO CP27K090(HDAY)  READ   : ' WS-K090-READ.                 
           DISPLAY 'NO HOLIDAY FOUND IN K090  : ' WS-HOLIDAY-CNT.               
           DISPLAY 'NO OF BP13F382 REC WRITEN : ' WS-F382-WRITE.                
           DISPLAY 'F382 START DATE CREATED   : ' WS-F382-START-DATE.           
           DISPLAY 'F382 END   DATE CREATED   : ' WS-F382-END-DATE.             
           DISPLAY '                                            '.              
           DISPLAY '********************************************'.              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
       9000-CLOSE-FILES.                                                        
      *-------------------------------------------------------------            
           CLOSE BP13F382                                                       
                 BP13K382                                                       
                 BP13K388                                                       
                 CP27K090.                                                      
                                                                                
           IF K388-STATUS NOT = '00'                                            
              DISPLAY 'ERROR IN CLOSING BP13K388 : ' K388-STATUS                
              MOVE K388-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K090-STATUS NOT = '00'                                            
              DISPLAY 'ERROR IN CLOSING CP27K090 : ' K090-STATUS                
              MOVE K090-STATUS TO RETURN-CODE.                                  
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
