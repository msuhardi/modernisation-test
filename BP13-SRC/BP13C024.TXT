       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    BP13C024.                                         00020000
      *AUTHOR.        MICHAEL ARRIOLA.                                  00030004
      *DATE-WRITTEN.  30/09/2008.                                       00040000
      * ========================================================== *    00050000
      * SYSTEM OF COMMITMENT (BP13)                                     00060000
      * ========================================================== *    00070000
      *                                                            *    00080000
      * OBJECTIVES: VALIDATE ACCEPTANCE FILE FROM DEVELOPER        *    00090000
      *             CREATE VALID FILE BP13FA30.                    *    00100000
      *             BACKUP DEVELOPER CASE NO ASSIGN REGN-NO.       *    00110000
      *                                                            *    00120000
      * ---------------------------------------------------------- *    00130000
      * CHG REF   BY    DATE      DETAILS                          *    00140000
      * -------   ====  ========= ================================ *    00150000
      * BP133452  MSD1  20080930  NEW PGM                          *    00160000
      * BP133400  ZDD1  20090916  INCLUDE CHECKING ON NRIC         *    00170000
      *                           FOR BP13FB60                     *    00180000
      *           ZDD1  20091005  INCLUDE CHECKING ON OPT FEE      *    00190000
      * BP138971  KR13  20211215  CATER FOR NEW FIN SERIES 'M'     *    00191002
      * ========================================================== *    00200000
                                                                        00210000
       ENVIRONMENT DIVISION.                                            00220000
       CONFIGURATION SECTION.                                           00230000
                                                                        00240000
       SOURCE-COMPUTER. IBM-3090.                                       00250000
       OBJECT-COMPUTER. IBM-3090.                                       00260000
                                                                        00270000
       INPUT-OUTPUT SECTION.                                            00280000
       FILE-CONTROL.                                                    00290000
      *-------------------------------------------------------------    00300000
           SELECT BP13FB62  ASSIGN        TO BP13FB62                   00310000
                            FILE STATUS   IS BP13FB62-STATUS.           00320000
                                                                        00330000
           SELECT BP13FB60  ASSIGN        TO BP13FB60                   00340000
                            FILE STATUS   IS BP13FB60-STATUS.           00350000
                                                                        00360000
           SELECT BP13KA20  ASSIGN        TO BP13KA20                   00370000
                            ACCESS MODE   IS RANDOM                     00380000
                            ORGANIZATION  IS INDEXED                    00390000
                            RECORD KEY    IS KA20-KEY-FLD               00400000
                            FILE STATUS   IS BP13KA20-STATUS.           00410000
                                                                        00420000
           SELECT BP13KA30  ASSIGN        TO BP13KA30                   00430000
                            ACCESS MODE   IS RANDOM                     00440000
                            ORGANIZATION  IS INDEXED                    00450000
                            RECORD KEY    IS KA30-KEY-FLD               00460000
                            FILE STATUS   IS BP13KA30-STATUS.           00470000
                                                                        00480000
           SELECT BP13KB85  ASSIGN        TO BP13KB85                   00490000
                            ACCESS MODE   IS RANDOM                     00500000
                            ORGANIZATION  IS INDEXED                    00510000
                            RECORD KEY    IS KB85-KEY-FLD               00520000
                            FILE STATUS   IS BP13KB85-STATUS.           00530000
                                                                        00540000
           SELECT BP13FA30  ASSIGN        TO BP13FA30.                  00550000
           SELECT P13FB62A  ASSIGN        TO P13FB62A.                  00560000
           SELECT P13FB60A  ASSIGN        TO P13FB60A.                  00570000
           SELECT MAILFB60  ASSIGN        TO MAILFB60.                  00580000
                                                                        00590000
       DATA DIVISION.                                                   00600000
       FILE SECTION.                                                    00610000
      *-------------------------------------------------------------    00620000
       FD   BP13FB62                                                    00630000
            RECORD CONTAINS 180 CHARACTERS                              00640000
            BLOCK CONTAINS 0 RECORDS                                    00650000
            LABEL RECORDS ARE STANDARD                                  00660000
            RECORDING MODE IS F.                                        00670000
       COPY BP13FB62.                                                   00680000
                                                                        00690000
       FD   BP13FB60                                                    00700000
            RECORD CONTAINS 2843 CHARACTERS                             00710000
            BLOCK CONTAINS 0 RECORDS                                    00720000
            LABEL RECORDS ARE STANDARD                                  00730000
            RECORDING MODE IS F.                                        00740000
       COPY BP13FB60.                                                   00750000
                                                                        00760000
       FD   BP13KA20                                                    00770000
            RECORD CONTAINS 200 CHARACTERS.                             00780000
       COPY BP13KA20.                                                   00790000
                                                                        00800000
       FD   BP13KA30                                                    00810000
            RECORD CONTAINS 200 CHARACTERS.                             00820000
       COPY BP13KA30.                                                   00830000
                                                                        00840000
       FD   BP13KB85                                                    00850000
            RECORD CONTAINS 50 CHARACTERS.                              00860000
       COPY BP13KB85.                                                   00870000
                                                                        00880000
       FD   BP13FA30                                                    00890000
            RECORD CONTAINS 200 CHARACTERS                              00900000
            BLOCK CONTAINS 0 RECORDS                                    00910000
            LABEL RECORDS ARE STANDARD                                  00920000
            RECORDING MODE IS F.                                        00930000
       COPY BP13FA30.                                                   00940000
                                                                        00950000
       FD   P13FB62A                                                    00960000
            RECORD CONTAINS 180 CHARACTERS                              00970000
            BLOCK CONTAINS 0 RECORDS                                    00980000
            LABEL RECORDS ARE STANDARD                                  00990000
            RECORDING MODE IS F.                                        01000000
       01   P13FB62A-REC                 PIC X(180).                    01010000
                                                                        01020000
                                                                        01030000
       FD   P13FB60A                                                    01040000
            RECORD CONTAINS 2843 CHARACTERS                             01050000
            BLOCK CONTAINS 0 RECORDS                                    01060000
            LABEL RECORDS ARE STANDARD                                  01070000
            RECORDING MODE IS F.                                        01080000
       01   P13FB60A-REC PIC X(2843).                                   01090000
                                                                        01100000
       FD   MAILFB60                                                    01110000
            RECORD CONTAINS 47 CHARACTERS                               01120000
            BLOCK CONTAINS 0 RECORDS                                    01130000
            LABEL RECORDS ARE STANDARD                                  01140000
            RECORDING MODE IS F.                                        01150000
       01   MAILFB60-REC.                                               01160000
            05 MAIL-DEV-REF-NUM  PIC X(08).                             01170000
            05 MAIL-UIN          PIC X(09).                             01180000
            05 MAIL-REASON       PIC X(30).                             01190000
                                                                        01200000
       WORKING-STORAGE SECTION.                                         01210000
      *-------------------------------------------------------------    01220000
       01 WS-FILE-STATUS.                                               01230000
          05 BP13KA20-STATUS             PIC 9(02)  VALUE ZEROES.       01240000
          05 BP13KA30-STATUS             PIC 9(02)  VALUE ZEROES.       01250000
          05 BP13KB85-STATUS             PIC 9(02)  VALUE ZEROES.       01260000
          05 BP13FB62-STATUS             PIC 9(02)  VALUE ZEROES.       01270000
          05 BP13FB60-STATUS             PIC 9(02)  VALUE ZEROES.       01280000
                                                                        01290000
       01 WS-SWITCHES.                                                  01300000
          05 WS-FB62-EOF                 PIC X     VALUE 'N'.           01310000
          05 WS-FB60-EOF                 PIC X     VALUE 'N'.           01320000
          05 WS-KA20-FND                 PIC X     VALUE 'N'.           01330000
          05 WS-KA30-FND                 PIC X     VALUE 'N'.           01340000
          05 WS-ERROR                    PIC X     VALUE 'N'.           01350000
          05 WS-INVALID                  PIC X     VALUE 'N'.           01360000
          05 WS-VALID-REC                PIC X     VALUE 'N'.           01370000
                                                                        01380000
       01 WS-COUNTERS.                                                  01390000
          05 WS-FB62-READ                PIC 9(08)  VALUE ZEROES.       01400000
          05 WS-FB60-READ                PIC 9(08)  VALUE ZEROES.       01410000
          05 WS-FA30-WRITE               PIC 9(08)  VALUE ZEROES.       01420000
          05 WS-KA20-REWRITE             PIC 9(08)  VALUE ZEROES.       01430000
          05 WS-KB85-REWRITE             PIC 9(08)  VALUE ZEROES.       01440000
          05 WS-KA20-NFND                PIC 9(08)  VALUE ZEROES.       01450000
          05 WS-KA30-NFND                PIC 9(08)  VALUE ZEROES.       01460000
          05 WS-FB62-ERROR               PIC 9(08)  VALUE ZEROES.       01470000
          05 WS-INVALID-RECORD           PIC 9(08)  VALUE ZEROES.       01480000
          05 WS-INVALID-NRIC             PIC 9(08)  VALUE ZEROES.       01490000
          05 WS-VALID-RECORD             PIC 9(08)  VALUE ZEROES.       01500000
          05 WS-FEE-INVALID              PIC 9(08)  VALUE ZEROES.       01510000
          01 WS-I                        PIC 9(02)  VALUE ZEROES.       01520000
                                                                        01530000
       01 WS-VARIABLES.                                                 01540000
          05 WS-CURRENT-DATE             PIC  X(08) VALUE SPACES.       01550000
          05 WS-NRIC                     PIC X(09)  VALUE SPACES.       01560000
          05 WS-CURRENT-TIME             PIC  9(08) VALUE ZEROES.       01570000
          05 WS-CAT-AVAIL                PIC S9(05) VALUE ZERO.         01580000
          05 WS-COMP-OPT-FEE             PIC 9(7)V9(2) VALUE ZEROES.    01590000
                                                                        01600000
                                                                        01610000
      ************************************************************      01620000
      *    VARIABLES FOR CREATION OF REGN NO. CHECK DIGIT        *      01630000
      ************************************************************      01640000
          05 WS-REGN-TAB.                                               01650000
             10 FILLER                   PIC X(33) VALUE                01660000
               '01A02B03C04D05E06F07G08H09I10Z11J'.                     01670000
          05 WS-REGNO-TAB REDEFINES WS-REGN-TAB.                        01680000
             10 REGN-TAB  OCCURS 11 TIMES INDEXED BY WS-CDG.            01690000
                15 REGN-REMAINDER        PIC 9(02).                     01700000
                15 REGN-CDG              PIC X(01).                     01710000
          05 WS-NUM-LAST-REGN.                                          01720000
             10 WS-7-NUM-REGN            PIC 9(7).                      01730000
             10 WS-8-NUM-REGN            PIC X(1).                      01740000
          05 WS-NUM-LAST-REGN-R REDEFINES WS-NUM-LAST-REGN.             01750000
             10 WS-6-NUM-REGN-R          PIC 9(6).                      01760000
             10 WS-7-NUM-REGN-R          PIC X(1).                      01770000
             10 WS-8-NUM-REGN-R          PIC X(1).                      01780000
          05 WS-REGNO.                                                  01790000
             10 WS-REG-NUM               PIC 9(7).                      01800000
             10 WS-REG-CHK               PIC X.                         01810000
          05 WS-REG                      PIC X(08) VALUE SPACES.        01820000
          05 WS-REGN-NUMERIC.                                           01830000
             10 REGN-NUM OCCURS 7 TIMES  PIC 9(01).                     01840000
             10 REGN-FLD                 PIC X(01).                     01850000
          05 WS-FLD.                                                    01860000
             10 WS-FLD1                  PIC 9(04) VALUE 0.             01870000
             10 WS-FLD2                  PIC 9(04) VALUE 0.             01880000
             10 WS-FLD3                  PIC 9(02) VALUE 0.             01890000
          05 WS-CHK-DGT                  PIC X(01) VALUE SPACE.         01900000
                                                                        01910000
       01  WS-NRIC-CHK                 PIC X(1).                        01920000
           88  VALID-NRIC-CHK          VALUE '0' THRU '9'               01930000
                                             'A' THRU 'Z'               01940000
                                             SPACE.                     01950000
                                                                        01960000
      * ------------------------------------------------------------    01970000
      * COMMAREA FOR UINFIN CHECK                                       01980000
      * ------------------------------------------------------------    01990000
       01  LINK-UINFIN-COMM.                                            02000000
           05  LINK-UINFIN.                                             02010000
               10  LINK-UINFIN-1ST         PIC X.                       02020000
               10  LINK-UINFIN-2TO8        PIC X(7).                    02030000
               10  LINK-UINFIN-CHECKDGT    PIC X.                       02040000
           05  LINK-UINFIN-FLAG            PIC X.                       02050000
           05  LINK-UINFIN-TYPE            PIC X(3).                    02060000
                                                                        02070000
      *-------------------------------------------------------------    02080000
       PROCEDURE DIVISION.                                              02090000
      *-------------------------------------------------------------    02100000
       0000-MAIN.                                                       02110000
      *-------------------------------------------------------------    02120000
                                                                        02130000
           PERFORM 1000-OPEN-FILES     THRU 1000-EXIT.                  02140000
           PERFORM 2000-READ-BP13FB62  THRU 2000-EXIT.                  02150000
           PERFORM 3000-PROCESS-DATA   THRU 3000-EXIT                   02160000
              UNTIL WS-FB62-EOF  = 'Y'.                                 02170000
           PERFORM 9000-CLOSE-ROUTINE  THRU 9000-EXIT.                  02180000
                                                                        02190000
       0000-EXIT.                                                       02200000
           EXIT.                                                        02210000
                                                                        02220000
      *-------------------------------------------------------------    02230000
       1000-OPEN-FILES.                                                 02240000
      *-------------------------------------------------------------    02250000
                                                                        02260000
           OPEN INPUT  BP13FB62                                         02270000
                       BP13FB60                                         02280000
                       BP13KA30                                         02290000
                  I-O  BP13KA20                                         02300004
                       BP13KB85                                         02310000
               OUTPUT  BP13FA30                                         02320000
                       P13FB62A                                         02330000
                       P13FB60A                                         02340000
                       MAILFB60.                                        02350000
                                                                        02360000
           IF BP13KA20-STATUS  NOT =  00 AND 97                         02370000
              DISPLAY 'ERROR OPENING - BP13KA20 : ' BP13KA20-STATUS     02380000
              MOVE     BP13KA20-STATUS      TO RETURN-CODE              02390000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.               02400000
                                                                        02410000
           IF BP13KA30-STATUS  NOT =  00 AND 97                         02420000
              DISPLAY 'ERROR OPENING - BP13KA30 : ' BP13KA30-STATUS     02430000
              MOVE     BP13KA30-STATUS      TO RETURN-CODE              02440000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.               02450000
                                                                        02460000
           IF BP13KB85-STATUS  NOT =  00 AND 97                         02470000
              DISPLAY 'ERROR OPENING - BP13KB85 : ' BP13KB85-STATUS     02480000
              MOVE     BP13KB85-STATUS      TO RETURN-CODE              02490000
              PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT.               02500000
                                                                        02510000
           ACCEPT  WS-CURRENT-TIME  FROM TIME.                          02520000
           MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.               02530000
                                                                        02540000
       1000-EXIT.                                                       02550000
           EXIT.                                                        02560000
                                                                        02570000
      *-------------------------------------------------------------    02580000
       2000-READ-BP13FB62.                                              02590000
      *-------------------------------------------------------------    02600000
                                                                        02610000
           MOVE 'N'    TO WS-INVALID                                    02620000
           MOVE 'Y'    TO WS-VALID-REC                                  02630000
           MOVE ZEROES TO WS-COMP-OPT-FEE                               02640000
                                                                        02650000
           READ BP13FB60 AT END                                         02660000
                MOVE 'Y'         TO WS-FB62-EOF                         02670000
                GO TO 2000-EXIT.                                        02680000
                                                                        02690000
           READ BP13FB62 AT END                                         02700000
                MOVE 'Y'         TO WS-FB62-EOF                         02710000
                GO TO 2000-EXIT.                                        02720000
                                                                        02730000
           ADD 1   TO WS-FB62-READ.                                     02740000
           ADD 1   TO WS-FB60-READ.                                     02750000
                                                                        02760000
           PERFORM 2010-PROCESS-FB60  THRU 2010-EXIT.                   02770000
                                                                        02780000
       2000-EXIT.                                                       02790000
           EXIT.                                                        02800000
                                                                        02810000
      *-------------------------------------------------------------    02820000
       2010-PROCESS-FB60.                                               02830000
      *-------------------------------------------------------------    02840000
                                                                        02850000
           IF FB60-NUM-APPLT1-UIN NOT = SPACES AND LOW-VALUES           02860000
              MOVE SPACES                       TO WS-NRIC              02870000
              MOVE FB60-NUM-APPLT1-UIN          TO WS-NRIC              02880000
              PERFORM 2020-VALIDATE-NRIC        THRU 2020-EXIT          02890000
              IF WS-INVALID = 'Y'                                       02900000
                 ADD 1                          TO WS-INVALID-NRIC      02910000
                 MOVE 'N'                       TO WS-VALID-REC         02920000
                 MOVE WS-NRIC                   TO MAIL-UIN             02930000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     02940000
                 MOVE 'INVALID NRIC'            TO MAIL-REASON          02950000
                 WRITE MAILFB60-REC                                     02960000
              END-IF                                                    02970000
           END-IF.                                                      02980000
                                                                        02990000
           IF FB60-NUM-APPLT2-UIN NOT = SPACES AND LOW-VALUES           03000000
              MOVE SPACES                       TO WS-NRIC              03010000
              MOVE FB60-NUM-APPLT2-UIN          TO WS-NRIC              03020000
              PERFORM  2020-VALIDATE-NRIC       THRU 2020-EXIT          03030000
              IF WS-INVALID = 'Y'                                       03040000
                 ADD 1                          TO WS-INVALID-NRIC      03050000
                 MOVE 'N'                       TO WS-VALID-REC         03060000
                 MOVE WS-NRIC                   TO MAIL-UIN             03070000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     03080000
                 MOVE 'INVALID NRIC'            TO MAIL-REASON          03090000
                 WRITE MAILFB60-REC                                     03100000
              END-IF                                                    03110000
           END-IF.                                                      03120000
                                                                        03130000
           IF FB60-NUM-APPLT3-UIN NOT = SPACES AND LOW-VALUES           03140000
              MOVE SPACES                       TO WS-NRIC              03150000
              MOVE FB60-NUM-APPLT3-UIN          TO WS-NRIC              03160000
              PERFORM 2020-VALIDATE-NRIC        THRU 2020-EXIT          03170000
              IF WS-INVALID = 'Y'                                       03180000
                 ADD 1                          TO WS-INVALID-NRIC      03190000
                 MOVE 'N'                       TO WS-VALID-REC         03200000
                 MOVE WS-NRIC                   TO MAIL-UIN             03210000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     03220000
                 MOVE 'INVALID NRIC'            TO MAIL-REASON          03230000
                 WRITE MAILFB60-REC                                     03240000
              END-IF                                                    03250000
           END-IF.                                                      03260000
                                                                        03270000
           IF FB60-NUM-APPLT4-UIN NOT = SPACES AND LOW-VALUES           03280000
              MOVE SPACES                       TO WS-NRIC              03290000
              MOVE FB60-NUM-APPLT4-UIN          TO WS-NRIC              03300000
              PERFORM 2020-VALIDATE-NRIC        THRU 2020-EXIT          03310000
              IF WS-INVALID = 'Y'                                       03320000
                 ADD 1                          TO WS-INVALID-NRIC      03330000
                 MOVE 'N'                       TO WS-VALID-REC         03340000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     03350000
                 MOVE 'INVALID NRIC'            TO MAIL-REASON          03360000
                 WRITE MAILFB60-REC                                     03370000
              END-IF                                                    03380000
           END-IF.                                                      03390000
                                                                        03400000
                                                                        03410000
                                                                        03420000
       2010-EXIT.                                                       03430000
           EXIT.                                                        03440000
                                                                        03450000
      *-------------------------------------------------------------    03460000
       2020-VALIDATE-NRIC.                                              03470000
      *-------------------------------------------------------------    03480000
                                                                        03490000
           IF WS-NRIC(1:1) = 'S' OR 'T' OR 'F' OR 'G' OR 'M'            03500001
              MOVE WS-NRIC             TO LINK-UINFIN                   03510000
              CALL 'AV02C013' USING LINK-UINFIN LINK-UINFIN-FLAG        03520000
                                    LINK-UINFIN-TYPE                    03530000
                                                                        03540000
              IF LINK-UINFIN-FLAG = 'N'                                 03550000
                 MOVE 'Y'  TO WS-INVALID                                03560000
              END-IF                                                    03570000
           ELSE                                                         03580000
              IF WS-NRIC(2:8) = SPACES OR LOW-VALUES                    03590000
                 MOVE 'Y'  TO WS-INVALID                                03600000
              ELSE                                                      03610000
                 PERFORM 2030-CHECK-UINFIN THRU 2030-EXIT               03620000
                  VARYING WS-I FROM 1 BY 1 UNTIL WS-I > 8               03630000
              END-IF                                                    03640000
           END-IF.                                                      03650000
                                                                        03660000
                                                                        03670000
       2020-EXIT.                                                       03680000
           EXIT.                                                        03690000
      *-------------------------------------------------------------    03700000
       2030-CHECK-UINFIN.                                               03710000
      *-------------------------------------------------------------    03720000
                                                                        03730000
           MOVE WS-NRIC(WS-I:1)   TO WS-NRIC-CHK.                       03740000
           IF NOT VALID-NRIC-CHK                                        03750000
               MOVE 'Y'  TO WS-INVALID                                  03760000
           END-IF.                                                      03770000
                                                                        03780000
       2030-EXIT.                                                       03790000
           EXIT.                                                        03800000
                                                                        03810000
      *-------------------------------------------------------------    03820000
       2100-READ-BP13KA30.                                              03830000
      *-------------------------------------------------------------    03840000
                                                                        03850000
           MOVE 'N'                    TO WS-KA30-FND.                  03860000
                                                                        03870000
           READ BP13KA30.                                               03880000
                                                                        03890000
           EVALUATE BP13KA30-STATUS                                     03900000
           WHEN 00                                                      03910000
                MOVE 'Y'                    TO WS-KA30-FND              03920000
                PERFORM 2200-READ-BP13KA20  THRU 2200-EXIT              03930000
           WHEN 23                                                      03940000
                MOVE SPACES                    TO MAIL-UIN              03950000
                MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM      03960000
                MOVE 'NOT FOUND ON PIDB UNIT FILE'                      03970000
                                               TO MAIL-REASON           03980000
                WRITE MAILFB60-REC                                      03990000
                WRITE P13FB62A-REC        FROM BP13FB62-REC             04000000
                DISPLAY 'BP13KA30 REC NOT FOUND ' KA30-KEY-FLD          04010000
                ADD                       1 TO WS-KA30-NFND             04020000
                                               WS-FB62-ERROR            04030000
           WHEN OTHER                                                   04040000
                DISPLAY 'BP13KA30 READ ERROR, STATUS ' BP13KA30-STATUS  04050000
                        ', KA30-KEY-FLD ' KA30-KEY-FLD                  04060000
                MOVE BP13KA30-STATUS         TO RETURN-CODE             04070000
                PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT               04080000
           END-EVALUATE.                                                04090000
                                                                        04100000
       2100-EXIT.                                                       04110000
           EXIT.                                                        04120000
                                                                        04130000
      *-------------------------------------------------------------    04140000
       2200-READ-BP13KA20.                                              04150000
      *-------------------------------------------------------------    04160000
                                                                        04170000
           MOVE 'N'                    TO WS-KA20-FND.                  04180000
           MOVE FB62-NUM-PRJCT         TO KA20-NUM-PRJCT.               04190000
           MOVE FB62-NUM-BLK           TO KA20-NUM-BLK.                 04200000
                                                                        04210000
           READ BP13KA20.                                               04220000
                                                                        04230000
           EVALUATE BP13KA20-STATUS                                     04240000
           WHEN 00                                                      04250000
                MOVE 'Y'                   TO WS-KA20-FND               04260000
           WHEN 23                                                      04270000
                MOVE SPACES                    TO MAIL-UIN              04280000
                MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM      04290000
                MOVE 'NOT FOUND ON PIDB BLOCK FILE'                     04300000
                                               TO MAIL-REASON           04310000
                WRITE MAILFB60-REC                                      04320000
                WRITE P13FB62A-REC       FROM BP13FB62-REC              04330000
                DISPLAY 'BP13KA20 REC NOT FOUND ' KA20-KEY-FLD          04340000
                ADD                      1 TO WS-KA20-NFND              04350000
                                              WS-FB62-ERROR             04360000
           WHEN OTHER                                                   04370000
                DISPLAY 'BP13KA20 READ ERROR, STATUS ' BP13KA20-STATUS  04380000
                        ', KA20-KEY-FLD ' KA20-KEY-FLD                  04390000
                MOVE BP13KA20-STATUS       TO RETURN-CODE               04400000
                PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT               04410000
           END-EVALUATE.                                                04420000
                                                                        04430000
       2200-EXIT.                                                       04440000
           EXIT.                                                        04450000
                                                                        04460000
      *-------------------------------------------------------------    04470000
       3000-PROCESS-DATA.                                               04480000
      *-------------------------------------------------------------    04490000
                                                                        04500000
           IF WS-VALID-REC = 'Y'                                        04510000
              COMPUTE WS-COMP-OPT-FEE ROUNDED =                         04520000
                  FB62-AMT-TRNSCT-SELL-PRICE * 0.05                     04530000
              IF WS-COMP-OPT-FEE NOT = FB62-AMT-OPTION-FEE              04540000
                 MOVE 'N'            TO WS-VALID-REC                    04550000
                 MOVE SPACES                    TO MAIL-UIN             04560000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     04570000
                 MOVE 'OPT-FEE NOT 5%'          TO MAIL-REASON          04580000
                 WRITE MAILFB60-REC                                     04590000
                 WRITE P13FB62A-REC  FROM BP13FB62-REC                  04600000
                 ADD 1               TO WS-FEE-INVALID                  04610000
              END-IF                                                    04620000
           ELSE                                                         04630000
              WRITE P13FB62A-REC  FROM BP13FB62-REC                     04640000
           END-IF.                                                      04650000
                                                                        04660000
           IF WS-VALID-REC = 'Y'                                        04670000
              MOVE SPACES        TO   P13FB60A-REC                      04680000
              WRITE P13FB60A-REC FROM FB60-REC                          04690000
              ADD 1              TO   WS-VALID-RECORD                   04700000
                                                                        04710000
                                                                        04720000
              INSPECT BP13FB62-REC REPLACING ALL '=' BY SPACE           04730000
                                                                        04740000
              MOVE FB62-NUM-PRJCT         TO KA30-NUM-PRJCT             04750000
              MOVE FB62-NUM-BLK           TO KA30-NUM-BLK               04760000
              MOVE FB62-NUM-MAIN-UNIT     TO KA30-NUM-MAIN-UNIT         04770000
              MOVE FB62-NUM-SUB-UNIT      TO KA30-NUM-SUB-UNIT          04780000
              MOVE FB62-NUM-LEVEL         TO KA30-NUM-LEVEL             04790000
                                                                        04800000
              IF FB62-NUM-ACCEPT = 'A' OR 'R'                           04810000
                IF FB62-NUM-ETHNIC = SPACES OR LOW-VALUES               04820000
                   DISPLAY 'NUM-ETHNIC EMPTY ERROR '                    04830000
                           'KEY FIELD : ' KA30-KEY-FLD                  04840000
                   MOVE SPACES                    TO MAIL-UIN           04850000
                   MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM   04860000
                   MOVE 'ETHNIC IS BLANK'         TO MAIL-REASON        04870000
                   WRITE MAILFB60-REC                                   04880000
                   WRITE P13FB62A-REC          FROM BP13FB62-REC        04890000
                   ADD                         1 TO WS-FB62-ERROR       04900000
                                                                        04910000
                ELSE                                                    04920000
                   PERFORM 2100-READ-BP13KA30  THRU 2100-EXIT           04930000
                   PERFORM 4000-VALIDATE-DATA  THRU 4000-EXIT           04940000
                   PERFORM 5000-UPDATE-PROCESS THRU 5000-EXIT           04950000
                END-IF                                                  04960000
                                                                        04970000
              ELSE                                                      04980000
                MOVE SPACES                     TO MAIL-UIN             04990000
                MOVE FB60-NUM-REGN              TO MAIL-DEV-REF-NUM     05000000
                MOVE 'NUM ACCEPT IS NOT A OR R' TO MAIL-REASON          05010000
                WRITE MAILFB60-REC                                      05020000
                DISPLAY 'NUM-ACCEPT ERROR : ' FB62-NUM-ACCEPT           05030000
                        'KEY FIELD : ' KA30-KEY-FLD                     05040000
                WRITE P13FB62A-REC          FROM BP13FB62-REC           05050000
                ADD                         1 TO WS-FB62-ERROR          05060000
           ELSE                                                         05070000
              ADD 1 TO WS-INVALID-RECORD                                05080000
           END-IF.                                                      05090000
                                                                        05100000
           PERFORM 2000-READ-BP13FB62    THRU 2000-EXIT.                05110000
                                                                        05120000
       3000-EXIT.                                                       05130000
           EXIT.                                                        05140000
                                                                        05150000
      *-------------------------------------------------------------    05160000
       4000-VALIDATE-DATA.                                              05170000
      *-------------------------------------------------------------    05180000
                                                                        05190000
           MOVE 'N'    TO WS-ERROR.                                     05200000
                                                                        05210000
           IF WS-KA20-FND = 'N' OR                                      05220000
              WS-KA30-FND = 'N'                                         05230000
              MOVE 'Y' TO WS-ERROR                                      05240000
              GO TO 4000-EXIT.                                          05250000
                                                                        05260000
           IF KA30-NUM-REGN(1:1) NOT = SPACES AND '#'                   05270000
              AND LOW-VALUES                                            05280000
              MOVE 'Y'               TO WS-ERROR                        05290000
              DISPLAY 'REGN NOT EMPTY : ' KA30-NUM-REGN                 05300000
                      'KA30-KEY-FLD   : ' KA30-KEY-FLD                  05310000
              WRITE P13FB62A-REC   FROM BP13FB62-REC                    05320000
              MOVE SPACES                    TO MAIL-UIN                05330000
              MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM        05340000
              MOVE 'REG NUM EXIST'           TO MAIL-REASON             05350000
              WRITE MAILFB60-REC                                        05360000
              ADD                  1 TO WS-FB62-ERROR                   05370000
              GO TO 4000-EXIT.                                          05380000
                                                                        05390000
           IF KA20-NUM-MAX-CAT1 IS NOT NUMERIC                          05400000
              MOVE 'Y'               TO WS-ERROR                        05410000
              DISPLAY 'MAX-CAT1 IS NOT NUMERIC  '                       05420000
                      'KA20-KEY-FLD : ' KA20-KEY-FLD                    05430000
              WRITE P13FB62A-REC   FROM BP13FB62-REC                    05440000
              ADD                  1 TO WS-FB62-ERROR                   05450000
              GO TO 4000-EXIT.                                          05460000
                                                                        05470000
           IF KA20-NUM-MAX-CAT2 IS NOT NUMERIC                          05480000
              MOVE 'Y'               TO WS-ERROR                        05490000
              DISPLAY 'MAX-CAT2 IS NOT NUMERIC  '                       05500000
                      'KA20-KEY-FLD : ' KA20-KEY-FLD                    05510000
              WRITE P13FB62A-REC   FROM BP13FB62-REC                    05520000
              ADD                  1 TO WS-FB62-ERROR                   05530000
              GO TO 4000-EXIT.                                          05540000
                                                                        05550000
           IF KA20-NUM-MAX-CAT3 IS NOT NUMERIC                          05560000
              MOVE 'Y'               TO WS-ERROR                        05570000
              DISPLAY 'MAX-CAT3 IS NOT NUMERIC  '                       05580000
                      'KA20-KEY-FLD : ' KA20-KEY-FLD                    05590000
              WRITE P13FB62A-REC   FROM BP13FB62-REC                    05600000
              ADD                  1 TO WS-FB62-ERROR                   05610000
              GO TO 4000-EXIT.                                          05620000
                                                                        05630000
           IF KA20-NUM-TOT-CAT1 IS NOT NUMERIC                          05640000
              MOVE ZEROES            TO KA20-NUM-TOT-CAT1.              05650000
           IF KA20-NUM-TOT-CAT2 IS NOT NUMERIC                          05660000
              MOVE ZEROES            TO KA20-NUM-TOT-CAT2.              05670000
           IF KA20-NUM-TOT-CAT3 IS NOT NUMERIC                          05680000
              MOVE ZEROES            TO KA20-NUM-TOT-CAT3.              05690000
                                                                        05700000
           IF FB62-NUM-ACCEPT = 'A'                                     05710000
              PERFORM 4100-UPDATE-KA20-ACCEPTED THRU 4100-EXIT          05720000
           ELSE                                                         05730000
              PERFORM 4200-UPDATE-KA20-REJECTED THRU 4200-EXIT.         05740000
                                                                        05750000
       4000-EXIT.                                                       05760000
           EXIT.                                                        05770000
                                                                        05780000
      *-------------------------------------------------------------    05790000
       4100-UPDATE-KA20-ACCEPTED.                                       05800000
      *-------------------------------------------------------------    05810000
                                                                        05820000
           EVALUATE FB62-NUM-ETHNIC                                     05830000
           WHEN '1'                                                     05840000
           WHEN 'M'                                                     05850000
              IF KA20-NUM-CAT1-FULL NOT = 'F'                           05860000
                COMPUTE WS-CAT-AVAIL = KA20-NUM-MAX-CAT1                05870000
                                     - KA20-NUM-TOT-CAT1                05880000
                IF WS-CAT-AVAIL > 0                                     05890000
                   ADD 1            TO KA20-NUM-TOT-CAT1                05900000
                   IF KA20-NUM-TOT-CAT1 >= KA20-NUM-MAX-CAT1            05910000
                      MOVE 'F'      TO KA20-NUM-CAT1-FULL               05920000
                   END-IF                                               05930000
                ELSE                                                    05940000
                   MOVE 'Y'         TO WS-ERROR                         05950000
                   DISPLAY 'CATEGORY FOR RACE EXCEEDED'                 05960000
                         'KA20-KEY-FLD : ' KA20-KEY-FLD                 05970000
                END-IF                                                  05980000
              ELSE                                                      05990000
                 MOVE SPACES                    TO MAIL-UIN             06000000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     06010000
                 MOVE 'CAT 1 FULL'              TO MAIL-REASON          06020000
                 WRITE MAILFB60-REC                                     06030000
                 WRITE P13FB62A-REC             FROM BP13FB62-REC       06040000
                 MOVE 'Y'                       TO WS-ERROR             06050000
              END-IF                                                    06060000
           WHEN '2'                                                     06070000
           WHEN 'C'                                                     06080000
              IF KA20-NUM-CAT2-FULL  NOT  = 'F'                         06090000
                COMPUTE WS-CAT-AVAIL = KA20-NUM-MAX-CAT2                06100000
                                     - KA20-NUM-TOT-CAT2                06110000
                IF WS-CAT-AVAIL > 0                                     06120000
                   ADD 1            TO KA20-NUM-TOT-CAT2                06130000
                   IF KA20-NUM-TOT-CAT2 >= KA20-NUM-MAX-CAT2            06140000
                      MOVE 'F'      TO KA20-NUM-CAT2-FULL               06150000
                   END-IF                                               06160000
                ELSE                                                    06170000
                   MOVE 'Y'         TO WS-ERROR                         06180000
                   DISPLAY 'CATEGORY FOR RACE EXCEEDED'                 06190000
                         'KA20-KEY-FLD : ' KA20-KEY-FLD                 06200000
                END-IF                                                  06210000
              ELSE                                                      06220000
                 MOVE SPACES                    TO MAIL-UIN             06230000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     06240000
                 MOVE 'CAT 2 FULL'              TO MAIL-REASON          06250000
                 WRITE MAILFB60-REC                                     06260000
                 WRITE P13FB62A-REC             FROM BP13FB62-REC       06270000
                 MOVE 'Y'                       TO WS-ERROR             06280000
              END-IF                                                    06290000
           WHEN '3'                                                     06300000
           WHEN '4'                                                     06310000
           WHEN 'I'                                                     06320000
           WHEN 'O'                                                     06330000
              IF KA20-NUM-CAT3-FULL  NOT = 'F'                          06340000
                COMPUTE WS-CAT-AVAIL = KA20-NUM-MAX-CAT3                06350000
                                     - KA20-NUM-TOT-CAT3                06360000
                IF WS-CAT-AVAIL > 0                                     06370000
                   ADD 1         TO KA20-NUM-TOT-CAT3                   06380000
                   IF KA20-NUM-TOT-CAT3 >= KA20-NUM-MAX-CAT3            06390000
                      MOVE 'F'   TO KA20-NUM-CAT3-FULL                  06400000
                   END-IF                                               06410000
                ELSE                                                    06420000
                   MOVE 'Y'         TO WS-ERROR                         06430000
                   DISPLAY 'CATEGORY FOR RACE EXCEEDED'                 06440000
                         'KA20-KEY-FLD : ' KA20-KEY-FLD                 06450000
                END-IF                                                  06460000
              ELSE                                                      06470000
                 MOVE SPACES                    TO MAIL-UIN             06480000
                 MOVE FB60-NUM-REGN             TO MAIL-DEV-REF-NUM     06490000
                 MOVE 'CAT 3 / 4 FULL'          TO MAIL-REASON          06500000
                 WRITE MAILFB60-REC                                     06510000
                 WRITE P13FB62A-REC             FROM BP13FB62-REC       06520000
                 MOVE 'Y'                       TO WS-ERROR             06530000
              END-IF                                                    06540000
           END-EVALUATE.                                                06550000
                                                                        06560000
       4100-EXIT.                                                       06570000
           EXIT.                                                        06580000
                                                                        06590000
      *-------------------------------------------------------------    06600000
       4200-UPDATE-KA20-REJECTED.                                       06610000
      *-------------------------------------------------------------    06620000
                                                                        06630000
           EVALUATE FB62-NUM-ETHNIC                                     06640000
           WHEN '1'                                                     06650000
           WHEN 'M'                                                     06660000
                IF KA20-NUM-TOT-CAT1 > 0                                06670000
                   SUBTRACT     1 FROM KA20-NUM-TOT-CAT1                06680000
                   IF KA20-NUM-TOT-CAT1 < KA20-NUM-MAX-CAT1             06690000
                      MOVE ' '      TO KA20-NUM-CAT1-FULL               06700000
                   END-IF                                               06710000
                END-IF                                                  06720000
                                                                        06730000
           WHEN '2'                                                     06740000
           WHEN 'C'                                                     06750000
                IF KA20-NUM-TOT-CAT2 > 0                                06760000
                   SUBTRACT     1 FROM KA20-NUM-TOT-CAT2                06770000
                   IF KA20-NUM-TOT-CAT2 < KA20-NUM-MAX-CAT2             06780000
                      MOVE ' '      TO KA20-NUM-CAT2-FULL               06790000
                   END-IF                                               06800000
                END-IF                                                  06810000
                                                                        06820000
           WHEN '3'                                                     06830000
           WHEN '4'                                                     06840000
           WHEN 'I'                                                     06850000
           WHEN 'O'                                                     06860000
                IF KA20-NUM-TOT-CAT3 > 0                                06870000
                   SUBTRACT     1 FROM KA20-NUM-TOT-CAT3                06880000
                   IF KA20-NUM-TOT-CAT3 < KA20-NUM-MAX-CAT3             06890000
                      MOVE ' '      TO KA20-NUM-CAT3-FULL               06900000
                   END-IF                                               06910000
                END-IF                                                  06920000
           END-EVALUATE.                                                06930000
                                                                        06940000
       4200-EXIT.                                                       06950000
           EXIT.                                                        06960000
                                                                        06970000
      *-------------------------------------------------------------    06980000
       5000-UPDATE-PROCESS.                                             06990000
      *-------------------------------------------------------------    07000000
                                                                        07010000
           IF WS-ERROR = 'Y'                                            07020000
              GO TO 5000-EXIT.                                          07030000
                                                                        07040000
           MOVE  BP13KA30-REC     TO   BP13FA30-REC.                    07050000
                                                                        07060000
           PERFORM 6000-GENERATE-REGN THRU 6000-EXIT.                   07070000
           MOVE WS-REGNO          TO   FA30-NUM-REGN.                   07080000
                                                                        07090000
           EVALUATE FB62-NUM-ETHNIC                                     07100000
              WHEN '1'                                                  07110000
              WHEN 'M'                                                  07120000
                 MOVE '1'          TO FA30-NUM-ETHNIC                   07130000
              WHEN '2'                                                  07140000
              WHEN 'C'                                                  07150000
                 MOVE '2'          TO FA30-NUM-ETHNIC                   07160000
              WHEN '3'                                                  07170000
              WHEN 'I'                                                  07180000
                 MOVE '3'          TO FA30-NUM-ETHNIC                   07190000
              WHEN '4'                                                  07200000
              WHEN 'O'                                                  07210000
                 MOVE '4'          TO FA30-NUM-ETHNIC                   07220000
              WHEN OTHER                                                07230000
                 MOVE ' '          TO FA30-NUM-ETHNIC                   07240000
           END-EVALUATE.                                                07250000
                                                                        07260000
           MOVE FB62-NUM-ACCEPT    TO FA30-NUM-ACCEPT.                  07270000
                                                                        07280000
           IF FA30-NUM-ACCEPT = 'A'                                     07290000
              MOVE FB62-DTE-ACCEPT     TO FA30-DTE-ACCEPT               07300000
              MOVE FB62-TME-ACCEPT     TO FA30-TME-ACCEPT               07310000
              MOVE FB62-NUM-REGN       TO FA30-NUM-DVLP-CASENO          07320000
              MOVE FB62-AMT-OPTION-FEE TO FA30-AMT-OPTION-FEE           07330000
              MOVE FB62-AMT-TRNSCT-SELL-PRICE                           07340000
                                       TO FA30-AMT-TRNSCT-SELL-PRICE    07350000
      *--     FA30-NUM-ACCEPT = 'R'                                     07360000
           ELSE                                                         07370000
              MOVE SPACES              TO FA30-DTE-ACCEPT               07380000
                                          FA30-TME-ACCEPT               07390000
                                          FA30-NUM-DVLP-CASENO          07400000
              MOVE ZEROES              TO FA30-AMT-OPTION-FEE           07410000
                                          FA30-AMT-TRNSCT-SELL-PRICE.   07420000
                                                                        07430000
           MOVE WS-CURRENT-DATE   TO FA30-DTE-UPDATE KA20-DTE-UPDATE    07440000
           MOVE WS-CURRENT-TIME   TO FA30-TME-UPDATE KA20-TME-UPDATE    07450000
           MOVE 'BP13C024'        TO FA30-NUM-USERID KA20-NUM-USERID    07460000
                                                                        07470000
           PERFORM 5100-REWRITE-BP13KA20 THRU 5100-EXIT.                07480000
           WRITE BP13FA30-REC.                                          07490000
           ADD                  1 TO WS-FA30-WRITE.                     07500000
                                                                        07510000
       5000-EXIT.                                                       07520000
           EXIT.                                                        07530000
                                                                        07540000
      *-------------------------------------------------------------    07550000
       5100-REWRITE-BP13KA20.                                           07560000
      *-------------------------------------------------------------    07570000
                                                                        07580000
           REWRITE BP13KA20-REC.                                        07590004
                                                                        07600000
           IF BP13KA20-STATUS NOT = 0                                   07610000
               MOVE BP13KA20-STATUS TO RETURN-CODE                      07620000
               DISPLAY 'REWRITE ERROR - BP13KA20 ' BP13KA20-STATUS      07630000
               PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                07640000
           ELSE                                                         07650000
               ADD 1 TO  WS-KA20-REWRITE                                07660000
           END-IF.                                                      07670000
                                                                        07680000
       5100-EXIT.                                                       07690000
           EXIT.                                                        07700000
                                                                        07710000
      *-------------------------------------------------------------    07720000
       6000-GENERATE-REGN.                                              07730000
      *-------------------------------------------------------------    07740000
                                                                        07750000
           MOVE 'BP13' TO KB85-KEY-FLD.                                 07760000
                                                                        07770000
           READ BP13KB85.                                               07780000
                                                                        07790000
           EVALUATE BP13KB85-STATUS                                     07800000
           WHEN 00                                                      07810000
                PERFORM 6100-ASSIGN-REGN THRU 6100-EXIT                 07820000
                PERFORM 6200-SAVE-REGN   THRU 6200-EXIT                 07830000
           WHEN 23                                                      07840000
                DISPLAY 'BP13KB85 NOT FOUND - ' KB85-KEY-FLD            07850000
           WHEN OTHER                                                   07860000
                DISPLAY 'ERROR READING BP13KB85, STATUS  '              07870000
                  BP13KB85-STATUS ', KB85-KEY-FLD ' KB85-KEY-FLD        07880000
                MOVE BP13KB85-STATUS         TO RETURN-CODE             07890000
                PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT               07900000
           END-EVALUATE.                                                07910000
                                                                        07920000
       6000-EXIT.                                                       07930000
           EXIT.                                                        07940000
                                                                        07950000
      *---------------------------------------------------------------* 07960000
       6100-ASSIGN-REGN.                                                07970000
      *---------------------------------------------------------------* 07980000
                                                                        07990000
           MOVE KB85-NUM-LAST-REGN  TO WS-NUM-LAST-REGN                 08000000
                                                                        08010000
           IF WS-NUM-LAST-REGN(8:1) = SPACE                             08020000
              COMPUTE WS-REG-NUM = WS-6-NUM-REGN-R    + 1               08030000
           ELSE                                                         08040000
              COMPUTE WS-REG-NUM = WS-7-NUM-REGN      + 1.              08050000
                                                                        08060000
           MOVE WS-REG-NUM      TO WS-REG.                              08070000
           MOVE WS-REG          TO WS-REGN-NUMERIC.                     08080000
           COMPUTE WS-FLD1 = REGN-NUM (1) * 2 + REGN-NUM (2) * 7 +      08090000
                             REGN-NUM (3) * 6 + REGN-NUM (4) * 5 +      08100000
                             REGN-NUM (5) * 4 + REGN-NUM (6) * 3 +      08110000
                             REGN-NUM (7) * 2.                          08120000
           DIVIDE WS-FLD1 BY 11 GIVING WS-FLD2 REMAINDER WS-FLD3        08130000
               COMPUTE WS-FLD3 = 11 - WS-FLD3.                          08140000
                                                                        08150000
           SET WS-CDG TO 1.                                             08160000
           SEARCH REGN-TAB                                              08170000
                  AT END GO TO 6000-EXIT                                08180000
                  WHEN REGN-REMAINDER (WS-CDG) = WS-FLD3                08190000
                       MOVE REGN-CDG (WS-CDG) TO WS-CHK-DGT             08200000
           END-SEARCH.                                                  08210000
                                                                        08220000
           MOVE WS-CHK-DGT TO WS-REG-CHK.                               08230000
                                                                        08240000
       6100-EXIT.                                                       08250000
           EXIT.                                                        08260000
                                                                        08270000
      *---------------------------------------------------------------* 08280000
       6200-SAVE-REGN.                                                  08290000
      *---------------------------------------------------------------* 08300000
                                                                        08310000
           MOVE WS-REGNO              TO KB85-NUM-LAST-REGN.            08320000
           MOVE WS-CURRENT-DATE       TO KB85-DTE-UPDATE.               08330000
           MOVE WS-CURRENT-TIME       TO KB85-TME-UPDATE.               08340000
           MOVE 'C024'                TO KB85-NUM-USERID.               08350000
                                                                        08360000
           REWRITE BP13KB85-REC.                                        08370004
                                                                        08380000
           IF BP13KB85-STATUS NOT = 0                                   08390000
               MOVE BP13KB85-STATUS TO RETURN-CODE                      08400000
               DISPLAY 'REWRITE ERROR - BP13KB85 ' BP13KB85-STATUS      08410000
               PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                08420000
           ELSE                                                         08430000
               ADD 1 TO  WS-KB85-REWRITE                                08440000
           END-IF.                                                      08450000
                                                                        08460000
       6200-EXIT.                                                       08470000
           EXIT.                                                        08480000
                                                                        08490000
      *-------------------------------------------------------------    08500000
       9000-CLOSE-ROUTINE.                                              08510000
      *-------------------------------------------------------------    08520000
                                                                        08530000
           DISPLAY ' BP13C024 CONTROL TOTAL '.                          08540000
           DISPLAY '------------------------------------------'.        08550000
           DISPLAY SPACES.                                              08560000
           DISPLAY 'NO OF RECS READ      BP13FB62 :' WS-FB62-READ.      08570000
           DISPLAY 'NO OF RECS READ      BP13FB60 :' WS-FB60-READ.      08580000
           DISPLAY 'NO OF RECS NOT FOUND BP13KA30 :' WS-KA30-NFND.      08590000
           DISPLAY 'NO OF RECS NOT FOUND BP13KA20 :' WS-KA20-NFND.      08600000
           DISPLAY 'NO OF RECS WRITTEN   BP13FA30 :' WS-FA30-WRITE.     08610000
           DISPLAY 'NO OF RECS UPDATED   BP13KA20 :' WS-KA20-REWRITE.   08620000
           DISPLAY 'NO OF RECS VALID     BP13FB60 :' WS-VALID-RECORD.   08630000
           DISPLAY 'NO OF RECS INVALID   BP13FB60 :' WS-INVALID-RECORD. 08640000
           DISPLAY 'NO OF INVALID NRIC   BP13FB60 :' WS-INVALID-NRIC.   08650000
           DISPLAY 'NO OF INVALID FEE (NOT IN 5%) :' WS-FEE-INVALID.    08660000
                                                                        08670000
                                                                        08680000
           CLOSE BP13FB62                                               08690000
                 BP13FB60                                               08700000
                 BP13KA20                                               08710000
                 BP13KA30                                               08720000
                 BP13KB85                                               08730000
                 BP13FA30                                               08740000
                 P13FB62A                                               08750000
                 P13FB60A                                               08760000
                 MAILFB60.                                              08770000
                                                                        08780000
           IF BP13KA20-STATUS NOT = 00 AND 97                           08790000
              DISPLAY 'ERROR CLOSING - BP13KA20 : ' BP13KA20-STATUS     08800000
              MOVE BP13KA20-STATUS TO RETURN-CODE.                      08810000
                                                                        08820000
           IF BP13KA30-STATUS NOT = 00 AND 97                           08830000
              DISPLAY 'ERROR CLOSING - BP13KA30 : ' BP13KA30-STATUS     08840000
              MOVE BP13KA30-STATUS TO RETURN-CODE.                      08850000
                                                                        08860000
           IF BP13KB85-STATUS NOT = 00 AND 97                           08870000
              DISPLAY 'ERROR CLOSING - BP13KB85 : ' BP13KB85-STATUS     08880000
              MOVE BP13KB85-STATUS TO RETURN-CODE.                      08890000
                                                                        08900000
           STOP RUN.                                                    08910000
                                                                        08920000
       9000-EXIT.                                                       08930000
           EXIT.                                                        08940000
