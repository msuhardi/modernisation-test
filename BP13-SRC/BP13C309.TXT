      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.    BP13C309.                                                 
       AUTHOR.        RAYATHATHA ASHOK.                                         
      *DATE-WRITTEN.  18/12/92.                                                 
                                                                                
      * ====================================================== *                
      *                SYSTEM OF COMMITMENT                    *                
      * ====================================================== *                
      *                                                        *                
      *    OBJECTIVE : TO PRINT A LIST OF COMMITMENT DEPOSIT   *                
      *    NOT REFUNDED AFTER 2 MONTHS AFTER CANCELLATION OF   *                
      *    APPLICATION.                                        *                
      *                                                        *                
      *    INPUT FILES                                         *                
      *    1. BP13F380  -  TRANSACTION FILE.                   *                
      *    2. P10K020   -  RFF MASTER FILE.                    *                
      *                                                        *                
      *    SUB-PROGRAM                                         *                
      *    1. BP13C913  -  PIDB                                *                
      *                                                        *                
      *    OUTPUT-FILE                                         *                
      *    1. BP13OUT   -  TRANSACTION FILE.                   *                
      *                                                        *                
      *    LISTING                                             *                
      *    1. P13L309   -  LIST OF AMOUNT FORFEITED & REFUNDED *                
      *                    FOR REJECTION OF FLAT AFTER SA AFTER*                
      *                    2 MONTHS OF CANCELLATION OF APPLN.  *                
      *                                                        *                
      *    2. P13L309A  -  LIST OF AMOUNT FORFEITED & REFUNDED *                
      *                    FOR REJECTION OF FLAT AFTER SA      *                
      *                                                        *                
      * ====================================================== *                
      * CHG-NO   DATE     BY   DESCRIPTION                     *                
      * -------- -------- ---  -----------                     *                
      * C9210F3  03/01/93 RAZ  INCLUDE P13L309A REPORT         *                
      * I920718  11/01/93 LJL  CONVERT TO COBOL II             *                
      * SOCPH8   12/22/93 RML  REFER TO BP13K800               *                
      * SOC 8G   19/10/95 SSS  GET PROPERTY DATA FROM PIDB     *                
      *                        DEL BM06K211                    *                
      * BP130418 26/08/98 CLT  Y2K COMPLIANCE CHANGES.         *                
      * BP130883 04/08/00 RAS  TO CHANGE BP13C904 TO BP13C913  *                
      * ====================================================== *                
                                                                                
      *-----------------------*                                                 
       ENVIRONMENT DIVISION.                                                    
      *-----------------------*                                                 
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
      *-----------------------*                                                 
       INPUT-OUTPUT SECTION.                                                    
      *-----------------------*                                                 
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ACCESS MODE     IS RANDOM                                     
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K800-NUM-REGN                              
                  FILE STATUS     IS BP13K800-STATUS.                           
                                                                                
           SELECT BP13F380 ASSIGN TO BP13F380.                                  
                                                                                
           SELECT BP13OUT  ASSIGN TO BP13OUT.                                   
                                                                                
           SELECT BP13L309 ASSIGN TO BP13L309.                                  
                                                                                
           SELECT P13L309A ASSIGN TO P13L309A.                                  
                                                                                
                                                                                
      *-----------------------*                                                 
       DATA DIVISION.                                                           
      *-----------------------*                                                 
       FILE SECTION.                                                            
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13F380                                                            
            BLOCK  CONTAINS  0  RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
       COPY BP13F380.                                                           
                                                                                
       FD   BP13OUT                                                             
            BLOCK  CONTAINS  0  RECORDS                                         
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORD IS STANDARD.                                          
                                                                                
       01   BP13OUT-REC                  PIC X(150).                            
                                                                                
       FD   BP13L309                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
                                                                                
       01   L309-PRINT-REC               PIC X(132).                            
                                                                                
       FD   P13L309A                                                            
            RECORD CONTAINS 132 CHARACTERS                                      
            RECORDING MODE IS F                                                 
            LABEL  RECORDS ARE OMITTED.                                         
                                                                                
       01   L309A-PRINT-REC              PIC X(132).                            
                                                                                
                                                                                
      *-----------------------*                                                 
       WORKING-STORAGE SECTION.                                                 
      *-----------------------*                                                 
       01  WS-VARIABLES.                                                        
           05  WS-F380-EOF               PIC X     VALUE 'N'.                   
               88 F380-EOF                         VALUE 'Y'.                   
           05  WS-F380-READ              PIC 9(8)  VALUE ZEROES.                
           05  WS-K800-READ              PIC 9(8)  VALUE ZEROES.                
           05  WS-CNT-PIDB-FD            PIC 9(8)  VALUE ZEROES.                
           05  WS-L309-PRINT             PIC 9(8)  VALUE ZEROES.                
           05  WS-L309A-PRINT            PIC 9(8)  VALUE ZEROES.                
           05  WS-OUT-WRITE              PIC 9(8)  VALUE ZEROES.                
           05  WS-CNT-SNO                PIC 9(4)  VALUE 0.                     
           05  WS-CNT-LINE               PIC 9(2)  VALUE 66.                    
           05  WS-CNT-PAGE               PIC 9(4)  VALUE 0.                     
           05  WS-CNT-SNO1               PIC 9(4)  VALUE 0.                     
           05  WS-CNT-LINE1              PIC 9(2)  VALUE 66.                    
           05  WS-CNT-PAGE1              PIC 9(4)  VALUE 0.                     
           05  WS-COMP-MONTH             PIC 9(4)  VALUE 0.                     
           05  WS-PREV-MONTH             PIC 9(2)  VALUE 0.                     
           05  WS-COMP-AMOUNT            PIC 9(6)V99 VALUE 0.                   
           05  WS-TOT-AMOUNT             PIC 9(6)V99 VALUE 0.                   
           05  BP13K800-STATUS           PIC 9(2)  VALUE ZEROS.                 
           05  WS-CURRENT-DATE.                                                 
               10  WS-CCYY               PIC 9999.                              
               10  WS-MM                 PIC 99.                                
               10  WS-DD                 PIC 99.                                
           05  WS-PRINT-DATE.                                                   
               10  WS-DD                 PIC XX.                                
               10  FILLER                PIC X   VALUE '/'.                     
               10  WS-MM                 PIC XX.                                
               10  FILLER                PIC X   VALUE '/'.                     
               10  WS-CCYY               PIC XXXX.                              
           05  WS-EDIT-DATE.                                                    
               10  WS-EDIT-CC            PIC XX.                                
               10  WS-EDIT-YY            PIC XX.                                
               10  WS-EDIT-MM            PIC XX.                                
               10  WS-EDIT-DD            PIC XX.                                
           05  WS-PRT-DATE.                                                     
               10  WS-EDIT-DD            PIC XX.                                
               10  FILLER                PIC X   VALUE '/'.                     
               10  WS-EDIT-MM            PIC XX.                                
               10  FILLER                PIC X   VALUE '/'.                     
               10  WS-EDIT-CC            PIC XX.                                
               10  WS-EDIT-YY            PIC XX.                                
           05  WS-FORM-DATE.                                                    
               10  WS-FORM-CCYY          PIC XXXX.                              
               10  WS-FORM-MM            PIC XX.                                
               10  WS-FORM-DD            PIC XX.                                
           05  WS-CAN-DATE  REDEFINES   WS-FORM-DATE.                           
               10  WS-CAN-CCYY           PIC 9999.                              
               10  WS-CAN-MM             PIC 99.                                
               10  WS-CAN-DD             PIC 99.                                
           05  WS-ADDRESS.                                                      
               10  FILLER                PIC X(4)   VALUE 'BLK '.               
               10  WS-PRT-BLK            PIC X(5).                              
               10  FILLER                PIC X      VALUE SPACE.                
               10  WS-HSE-NO.                                                   
                   15  FILLER            PIC X      VALUE '#'.                  
                   15  WS-HSE-MAIN       PIC X(2).                              
                   15  FILLER            PIC X      VALUE '-'.                  
                   15  WS-HSE-SUB        PIC X(4).                              
               10  FILLER                PIC X      VALUE SPACE.                
               10  WS-PRT-STREET         PIC X(30).                             
               10  FILLER                PIC X      VALUE SPACE.                
           05  WS-TABLE.                                                        
               10  FILLER                PIC X(11) VALUE '01JANUARY  '.         
               10  FILLER                PIC X(11) VALUE '02FEBRURARY'.         
               10  FILLER                PIC X(11) VALUE '03MARCH    '.         
               10  FILLER                PIC X(11) VALUE '04APRIL    '.         
               10  FILLER                PIC X(11) VALUE '05MAY      '.         
               10  FILLER                PIC X(11) VALUE '06JUNE     '.         
               10  FILLER                PIC X(11) VALUE '07JULY     '.         
               10  FILLER                PIC X(11) VALUE '08AUGUST   '.         
               10  FILLER                PIC X(11) VALUE '09SEPTEMBER'.         
               10  FILLER                PIC X(11) VALUE '10OCTOBER  '.         
               10  FILLER                PIC X(11) VALUE '11NOVEMBER '.         
               10  FILLER                PIC X(11) VALUE '12DECEMBER '.         
           05  WS-MTH-TABLE REDEFINES   WS-TABLE.                               
               10  MONTH-TABLE  OCCURS 12 TIMES INDEXED BY WS-IND.              
                   15  WS-MTH-CODE       PIC XX.                                
                   15  WS-MTH-DESC       PIC X(9).                              
                                                                                
       01  SQL-CODE                      PIC 9(4).                              
                                                                                
      *-----------------------------------------------------------*             
      *        LINKAGE FOR SUB-PROGRAM BP13C913                   *             
      *-----------------------------------------------------------*             
       01  WS-LINK-REC.                                                         
           05  WS-LINK-NUM-SCH-ACC.                                             
               10  WS-LINK-NUM-SCH     PIC X(4).                                
               10  WS-LINK-NUM-ACC     PIC X(5).                                
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      *----------------------------------------------------------*              
      *      REPORT LAYOUT COMMON TO   L309  & L309A             *              
      *----------------------------------------------------------*              
       01  L309-PRT-HEAD-1.                                                     
           05  L309-HD1-DESC       PIC X(8)    VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE SPACES.                    
           05  FILLER              PIC X(18)   VALUE SPACES.                    
           05  FILLER              PIC X(39)   VALUE                            
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER              PIC X(29)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE 'SYSTEM DATE : '.          
           05  L309-HD1-DATE       PIC X(10)   VALUE SPACES.                    
                                                                                
       01  L309-PRT-HEAD-2.                                                     
           05  FILLER              PIC X(39)   VALUE SPACES.                    
           05  L309-HD1-HEADING2   PIC X(45)   VALUE                            
              'COMMITMENT DEPOSIT NOT REFUNDED / FORFEITED'.                    
           05  FILLER              PIC X(31)   VALUE SPACES.                    
           05  FILLER              PIC X(7)    VALUE 'PAGE : '.                 
           05  L309-HD1-PAGE-NO    PIC ZZZ9.                                    
                                                                                
       01  L309-PRT-HEAD-3.                                                     
           05  FILLER              PIC X(39)   VALUE SPACES.                    
           05  FILLER              PIC X(45)   VALUE                            
              'AFTER 2 MONTHS CANCELLATION OF APPLICATION'.                     
           05  FILLER              PIC X(31)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE 'AGREEMENT TEAM'.          
                                                                                
       01  L309-PRT-HEAD-3A.                                                    
           05  FILLER              PIC X(30)   VALUE SPACES.                    
           05  FILLER              PIC X(46)   VALUE                            
              'CANCELLATION OF APPLICATION AFTER EXECUTION OF'.                 
           05  FILLER              PIC X(20)   VALUE                            
              ' AGREEMENT FOR LEASE'.                                           
           05  FILLER              PIC X(22)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE 'AGREEMENT TEAM'.          
                                                                                
       01  L309-PRT-HEAD-3B.                                                    
           05  FILLER              PIC X(34)   VALUE SPACES.                    
           05  FILLER              PIC X(14)   VALUE SPACES.                    
           05  FILLER              PIC X(17)   VALUE                            
              'FOR THE MONTH OF '.                                              
           05  L309A-HD1-MONTH     PIC X(12).                                   
           05  L309A-HD1-CC        PIC X(2).                                    
           05  L309A-HD1-YY        PIC X(2).                                    
           05  FILLER              PIC X(29)   VALUE SPACES.                    
           05  FILLER              PIC X(22)   VALUE SPACES.                    
                                                                                
       01  L309-PRT-HEAD-4.                                                     
           05  FILLER              PIC X(65) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'RM'.                        
           05  FILLER              PIC X     VALUE SPACE.                       
           05  FILLER              PIC X(08) VALUE 'CANCELN.'.                  
           05  FILLER              PIC X(13) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'CPF AMT'.                   
           05  FILLER              PIC X(04) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'CASH AMT'.                  
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'CPF AMT'.                   
           05  FILLER              PIC X(05) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'CASH AMT'.                  
                                                                                
       01  L309-PRT-HEAD-5.                                                     
           05  FILLER              PIC X(04) VALUE ' S/N'.                      
           05  FILLER              PIC X(01) VALUE SPACE.                       
           05  FILLER              PIC X(07) VALUE 'REGN NO'.                   
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'ADDRESS'.                   
           05  FILLER              PIC X(44) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'TP'.                        
           05  FILLER              PIC X(01) VALUE SPACE.                       
           05  FILLER              PIC X(04) VALUE 'DATE'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NRIC'.                      
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'REFUNDED'.                  
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'REFUNDED'.                  
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(09) VALUE 'FORFEITED'.                 
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(09) VALUE 'FORFEITED'.                 
                                                                                
       01  L309-PRT-HEAD-4A.                                                    
           05  FILLER              PIC X(67) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'RM'.                        
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'CANCELN.'.                  
           05  FILLER              PIC X(18) VALUE SPACES.                      
           05  FILLER              PIC X(03) VALUE 'AMT'.                       
                                                                                
       01  L309-PRT-HEAD-5A.                                                    
           05  FILLER              PIC X(04) VALUE ' S/N'.                      
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'REGN NO'.                   
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(07) VALUE 'ADDRESS'.                   
           05  FILLER              PIC X(44) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'TP'.                        
           05  FILLER              PIC X(04) VALUE SPACE.                       
           05  FILLER              PIC X(04) VALUE 'DATE'.                      
           05  FILLER              PIC X(06) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NRIC'.                      
           05  FILLER              PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(09) VALUE 'FORFEITED'.                 
                                                                                
       01  L309-DETAILS.                                                        
           05  L309-DETAIL1.                                                    
               10  L309-SNO            PIC ZZZ9.                                
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-CUR-REG        PIC X(08) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-ADDRESS        PIC X(50) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-ROOM-TYPE      PIC X(02) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-CAN-DATE       PIC X(10) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACE.                   
           05  L309-DETAIL2.                                                    
               10  L309-NRIC           PIC X(09) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-RFCASH         PIC ZZZ,ZZ9.99.                          
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-RFCPF          PIC ZZZ,ZZ9.99.                          
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-FFCASH         PIC -ZZZ,ZZ9.99.                         
               10  FILLER              PIC X(01) VALUE SPACE.                   
               10  L309-FFCPF          PIC -ZZZ,ZZ9.99.                         
                                                                                
       01  L309A-DETAILS.                                                       
           05  L309A-DETAIL1.                                                   
               10  L309A-SNO           PIC ZZZ9.                                
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L309A-CUR-REG       PIC X(08) VALUE SPACES.                  
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L309A-ADDRESS       PIC X(50) VALUE SPACES.                  
               10  FILLER              PIC X(01) VALUE SPACES.                  
               10  L309A-ROOM-TYPE     PIC X(02) VALUE SPACES.                  
               10  FILLER              PIC X(03) VALUE SPACES.                  
               10  L309A-CAN-DATE      PIC X(10) VALUE SPACES.                  
               10  FILLER              PIC X(02) VALUE SPACES.                  
           05  L309A-DETAIL2.                                                   
               10  L309A-NRIC          PIC X(09) VALUE SPACES.                  
               10  FILLER              PIC X(02) VALUE SPACES.                  
               10  L309A-FFAMT         PIC -ZZZ,ZZ9.99.                         
                                                                                
       01   L309A-TOTAL.                                                        
               10  FILLER              PIC X(84) VALUE SPACES.                  
               10  FILLER              PIC X(05) VALUE 'TOTAL'.                 
               10  FILLER              PIC X(06) VALUE SPACES.                  
               10  L309A-TOTAL2        PIC $$$$,$$9.99.                         
                                                                                
                                                                                
      *-----------------------*                                                 
       PROCEDURE DIVISION.                                                      
      *-----------------------*                                                 
                                                                                
       0000-MAIN-ROUTINE.                                                       
      *==================*                                                      
           PERFORM 1000-OPEN-FILES    THRU 1000-EXIT.                           
           PERFORM 2000-READ-BP13F380 THRU 2000-EXIT.                           
           PERFORM 3000-MAIN-PROCESS  THRU 3000-EXIT                            
             UNTIL F380-EOF.                                                    
           PERFORM 8000-PRINT-LAST    THRU 8000-EXIT                            
           PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                           
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==============*                                                          
       1000-OPEN-FILES.                                                         
      *==============*                                                          
           OPEN INPUT  BP13F380                                                 
                       BP13K800                                                 
                OUTPUT BP13OUT                                                  
                       BP13L309                                                 
                       P13L309A.                                                
                                                                                
           IF BP13K800-STATUS NOT = 0 AND 97                                    
              DISPLAY 'ERROR OPENING BP13K800 FILE ' BP13K800-STATUS            
              MOVE BP13K800-STATUS TO  RETURN-CODE                              
              PERFORM 9999-CLOSE-ROUTINE THRU 9999-EXIT.                        
                                                                                
      * SET UP SYSTEM DATE FOR HEADINGS *                                       
           MOVE FUNCTION CURRENT-DATE    TO WS-CURRENT-DATE.                    
           MOVE CORR WS-CURRENT-DATE     TO WS-PRINT-DATE.                      
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *===================*                                                     
       2000-READ-BP13F380.                                                      
      *===================*                                                     
           READ BP13F380                 AT END                                 
           MOVE 'Y'                      TO WS-F380-EOF                         
           GO TO 2000-EXIT.                                                     
                                                                                
           ADD 1                         TO WS-F380-READ.                       
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *===================*                                                     
       3000-MAIN-PROCESS.                                                       
      *===================*                                                     
           MOVE F380-DTE-CANCELATION     TO WS-FORM-DATE.                       
                                                                                
           COMPUTE WS-COMP-MONTH = (((WS-CCYY OF WS-CURRENT-DATE * 12)          
                                    + WS-MM OF WS-CURRENT-DATE) -               
                                    ((WS-CAN-CCYY * 12) + WS-CAN-MM)).          
                                                                                
           DISPLAY ' WS-MTH : ' WS-COMP-MONTH.                                  
           IF WS-COMP-MONTH > 2 OR                                              
              WS-COMP-MONTH = 2                                                 
              PERFORM 4000-PROCESS-BP13L309 THRU 4000-EXIT                      
           ELSE                                                                 
              IF WS-COMP-MONTH = 1 OR                                           
                 WS-COMP-MONTH = 0                                              
                 PERFORM 6000-PROCESS-P13L309A THRU 6000-EXIT.                  
                                                                                
           PERFORM 2000-READ-BP13F380 THRU 2000-EXIT.                           
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=====================*                                                   
       4000-PROCESS-BP13L309.                                                   
      *=====================*                                                   
              MOVE F380-NUM-REGN   TO K800-NUM-REGN.                            
              READ BP13K800.                                                    
                                                                                
              IF BP13K800-STATUS = 00                                           
                 ADD 1             TO WS-K800-READ                              
                 IF K800-AMT-SOC-CASH  > 0 OR                                   
                    K800-AMT-CPF1-PAID > 0 OR                                   
                    K800-AMT-CPF2-PAID > 0 OR                                   
                    K800-AMT-CPF3-PAID > 0 OR                                   
                    K800-AMT-CPF4-PAID > 0                                      
                    PERFORM 4500-PRINT-BP13L309  THRU 4500-EXIT                 
                 ELSE                                                           
                    NEXT SENTENCE                                               
              ELSE                                                              
                 IF BP13K800-STATUS NOT = 00 AND 23                             
                    DISPLAY 'ERROR READING BP13K800 FILE '                      
                                          BP13K800-STATUS                       
                    MOVE BP13K800-STATUS TO  RETURN-CODE.                       
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       4500-PRINT-BP13L309.                                                     
      *==================*                                                      
           IF K800-NUM-STATUS =  'C'                                            
              PERFORM 5000-WRITE-BP13OUT    THRU 5000-EXIT                      
           ELSE                                                                 
              GO TO 4500-EXIT.                                                  
                                                                                
           IF  WS-CNT-LINE > 55                                                 
               PERFORM 4750-L309-HEAD    THRU 4750-EXIT.                        
                                                                                
           MOVE SPACES                   TO L309-DETAILS.                       
                                                                                
           ADD  1                        TO WS-CNT-SNO.                         
           MOVE WS-CNT-SNO               TO L309-SNO.                           
           MOVE F380-NUM-REGN            TO L309-CUR-REG.                       
           MOVE K800-NUM-FLAT-TYPE       TO L309-ROOM-TYPE.                     
           MOVE F380-DTE-CANCELATION     TO WS-EDIT-DATE.                       
           MOVE CORR WS-EDIT-DATE        TO WS-PRT-DATE.                        
           MOVE WS-PRT-DATE              TO L309-CAN-DATE.                      
                                                                                
           PERFORM 4800-READ-SUB-PROGRAM   THRU 4800-EXIT.                      
           MOVE WS-ADDRESS                 TO L309-ADDRESS.                     
                                                                                
           MOVE F380-NUM-NRIC (1)          TO L309-NRIC.                        
           MOVE F380-AMT-CPF-REFUNDED (1)  TO L309-RFCPF.                       
           MOVE F380-AMT-CPF-FORFEITED (1) TO L309-FFCPF.                       
           MOVE F380-AMT-CASH-FORFEITED    TO L309-FFCASH.                      
           MOVE F380-AMT-CASH-REFUNDED     TO L309-RFCASH.                      
                                                                                
           WRITE L309-PRINT-REC            FROM L309-DETAILS AFTER 2.           
                                                                                
           MOVE SPACES                        TO L309-DETAILS.                  
           IF F380-NUM-NRIC (2) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (2)          TO L309-NRIC                      
              MOVE F380-AMT-CPF-REFUNDED (2)  TO L309-RFCPF                     
              MOVE F380-AMT-CPF-FORFEITED (2) TO L309-FFCPF                     
              WRITE L309-PRINT-REC          FROM L309-DETAILS                   
           ELSE                                                                 
              WRITE L309-PRINT-REC          FROM L309-DETAILS.                  
                                                                                
           MOVE SPACES                        TO L309-DETAILS.                  
           IF F380-NUM-NRIC (3) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (3)          TO L309-NRIC                      
              MOVE F380-AMT-CPF-REFUNDED (3)  TO L309-RFCPF                     
              MOVE F380-AMT-CPF-FORFEITED (3) TO L309-FFCPF                     
              WRITE L309-PRINT-REC          FROM L309-DETAILS                   
           ELSE                                                                 
              WRITE L309-PRINT-REC          FROM L309-DETAILS.                  
                                                                                
           MOVE SPACES                        TO L309-DETAILS.                  
           IF F380-NUM-NRIC (4) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (4)          TO L309-NRIC                      
              MOVE F380-AMT-CPF-REFUNDED (4)  TO L309-RFCPF                     
              MOVE F380-AMT-CPF-FORFEITED (4) TO L309-FFCPF                     
              WRITE L309-PRINT-REC          FROM L309-DETAILS                   
           ELSE                                                                 
              WRITE L309-PRINT-REC          FROM L309-DETAILS.                  
                                                                                
           ADD 1                              TO WS-L309-PRINT.                 
           ADD 5                              TO WS-CNT-LINE.                   
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *===============*                                                         
       4750-L309-HEAD.                                                          
      *===============*                                                         
           MOVE 'BP13L309'             TO   L309-HD1-DESC.                      
           MOVE WS-PRINT-DATE          TO   L309-HD1-DATE.                      
           ADD  1                      TO   WS-CNT-PAGE.                        
           MOVE WS-CNT-PAGE            TO   L309-HD1-PAGE-NO.                   
           WRITE L309-PRINT-REC        FROM L309-PRT-HEAD-1 AFTER PAGE          
           WRITE L309-PRINT-REC        FROM L309-PRT-HEAD-2.                    
           WRITE L309-PRINT-REC        FROM L309-PRT-HEAD-3.                    
           WRITE L309-PRINT-REC        FROM L309-PRT-HEAD-4  AFTER 4.           
           WRITE L309-PRINT-REC        FROM L309-PRT-HEAD-5.                    
           MOVE SPACES                 TO   L309-PRINT-REC.                     
           WRITE L309-PRINT-REC.                                                
           MOVE 7                      TO   WS-CNT-LINE.                        
                                                                                
       4750-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=====================*                                                   
       4800-READ-SUB-PROGRAM.                                                   
      *=====================*                                                   
           MOVE BP13F380-REC        TO   BP13OUT-REC.                           
                                                                                
           IF (F380-SCHEME-ACCT-NO NOT = SPACES AND ZEROES                      
                        AND LOW-VALUES)                                         
              PERFORM 4850-CALL-BP13C913  THRU 4850-EXIT                        
              IF COMM8-CDE-SYSERR = 0                                           
                 ADD 1                    TO WS-CNT-PIDB-FD                     
                 MOVE COMM8-NUM-BLK       TO WS-PRT-BLK                         
                 MOVE COMM8-NUM-LEVEL     TO WS-HSE-MAIN                        
                 MOVE COMM8-NUM-UNIT-MAIN TO WS-HSE-SUB                         
                 MOVE COMM8-NME-STREET    TO WS-PRT-STREET                      
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       4850-CALL-BP13C913.                                                      
      *==================*                                                      
           MOVE SPACES                    TO BP13COMM8-REC.                     
           INITIALIZE                        BP13COMM8-REC.                     
                                                                                
           MOVE F380-SCHEME-ACCT-NO       TO WS-LINK-REC.                       
                                                                                
           CALL 'BP13C913'  USING WS-LINK-REC,                                  
                                  BP13COMM8-REC.                                
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0                                          
              MOVE COMM8-CDE-SYSERR TO SQL-CODE                                 
              IF COMM8-CDE-SYSERR = 100                                         
                 DISPLAY 'SCH-ACC NOT FOUND IN PIDB TABLE  ' SQL-CODE           
              ELSE                                                              
                 DISPLAY 'ERROR IN READING PIDB TABLE  ' SQL-CODE.              
                                                                                
       4850-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       5000-WRITE-BP13OUT.                                                      
      *===================*                                                     
           MOVE BP13F380-REC        TO  BP13OUT-REC.                            
           WRITE BP13OUT-REC.                                                   
           ADD   1                  TO  WS-OUT-WRITE.                           
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *===================*                                                     
       6000-PROCESS-P13L309A.                                                   
      *===================*                                                     
              MOVE F380-NUM-REGN        TO K800-NUM-REGN.                       
              READ BP13K800.                                                    
                                                                                
              IF BP13K800-STATUS = 00                                           
                 ADD 1                  TO WS-K800-READ                         
                 IF K800-AMT-SOC-CASH  > 0 OR                                   
                    K800-AMT-CPF1-PAID > 0 OR                                   
                    K800-AMT-CPF2-PAID > 0 OR                                   
                    K800-AMT-CPF3-PAID > 0 OR                                   
                    K800-AMT-CPF4-PAID > 0                                      
                    PERFORM 6500-PRINT-P13L309A  THRU 6500-EXIT                 
                    MOVE 'Y' TO F380-TAG-PRINT                                  
                    PERFORM 5000-WRITE-BP13OUT   THRU 5000-EXIT                 
                 ELSE                                                           
                    PERFORM 6500-PRINT-P13L309A  THRU 6500-EXIT                 
              ELSE                                                              
                 IF BP13K800-STATUS NOT = 00 AND 23                             
                    DISPLAY 'ERROR READING BP13K800 FILE '                      
                                          BP13K800-STATUS                       
                    MOVE BP13K800-STATUS TO  RETURN-CODE.                       
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       6500-PRINT-P13L309A.                                                     
      *==================*                                                      
           IF F380-TAG-PRINT = 'Y'                                              
              GO TO 6500-EXIT                                                   
           ELSE                                                                 
           IF K800-NUM-STATUS =  'C'                                            
                    NEXT SENTENCE                                               
           ELSE                                                                 
              GO TO 6500-EXIT.                                                  
                                                                                
           IF  WS-CNT-LINE1 > 55                                                
               PERFORM 6750-L309A-HEAD   THRU 6750-EXIT                         
           ELSE                                                                 
           IF  WS-PREV-MONTH NOT = WS-FORM-MM                                   
               PERFORM 8000-PRINT-LAST   THRU 8000-EXIT                         
               MOVE ZEROS TO WS-CNT-SNO1                                        
               PERFORM 6750-L309A-HEAD   THRU 6750-EXIT.                        
                                                                                
           MOVE SPACES                   TO L309A-DETAILS.                      
                                                                                
           ADD  1                        TO WS-CNT-SNO1.                        
           MOVE WS-CNT-SNO1              TO L309A-SNO.                          
           MOVE F380-NUM-REGN            TO L309A-CUR-REG.                      
           MOVE F380-NUM-REGN            TO L309A-CUR-REG.                      
           MOVE K800-NUM-FLAT-TYPE       TO L309A-ROOM-TYPE.                    
           MOVE F380-DTE-CANCELATION     TO WS-EDIT-DATE.                       
           MOVE CORR WS-EDIT-DATE        TO WS-PRT-DATE.                        
           MOVE WS-PRT-DATE              TO L309A-CAN-DATE.                     
           MOVE WS-FORM-MM               TO WS-PREV-MONTH.                      
                                                                                
           PERFORM 4800-READ-SUB-PROGRAM THRU 4800-EXIT.                        
           MOVE WS-ADDRESS               TO L309A-ADDRESS.                      
                                                                                
           MOVE F380-NUM-NRIC (1)          TO L309A-NRIC.                       
           COMPUTE WS-COMP-AMOUNT = F380-AMT-CASH-FORFEITED +                   
                                    F380-AMT-CPF-FORFEITED (1).                 
           COMPUTE WS-TOT-AMOUNT = WS-TOT-AMOUNT  + WS-COMP-AMOUNT.             
           MOVE WS-COMP-AMOUNT             TO L309A-FFAMT.                      
           WRITE L309A-PRINT-REC          FROM L309A-DETAILS AFTER 2.           
                                                                                
           MOVE SPACES                        TO L309A-DETAILS                  
           IF F380-NUM-NRIC (2) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (2)          TO L309A-NRIC                     
              MOVE F380-AMT-CPF-FORFEITED (2) TO L309A-FFAMT                    
              COMPUTE WS-TOT-AMOUNT = WS-TOT-AMOUNT  +                          
                                      F380-AMT-CPF-FORFEITED (2)                
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS                 
           ELSE                                                                 
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS.                
                                                                                
           MOVE SPACES                        TO L309A-DETAILS                  
           IF F380-NUM-NRIC (3) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (3)          TO L309A-NRIC                     
              MOVE F380-AMT-CPF-FORFEITED (3) TO L309A-FFAMT                    
              COMPUTE WS-TOT-AMOUNT = WS-TOT-AMOUNT  +                          
                                      F380-AMT-CPF-FORFEITED (3)                
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS                 
           ELSE                                                                 
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS.                
                                                                                
           MOVE SPACES                        TO L309A-DETAILS                  
           IF F380-NUM-NRIC (4) NOT = SPACES AND LOW-VALUES                     
              MOVE F380-NUM-NRIC (4)          TO L309A-NRIC                     
              MOVE F380-AMT-CPF-FORFEITED (4) TO L309A-FFAMT                    
              COMPUTE WS-TOT-AMOUNT = WS-TOT-AMOUNT  +                          
                                      F380-AMT-CPF-FORFEITED (4)                
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS                 
           ELSE                                                                 
              WRITE L309A-PRINT-REC          FROM L309A-DETAILS.                
                                                                                
           ADD 1                              TO WS-L309A-PRINT.                
           ADD 5                              TO WS-CNT-LINE1.                  
                                                                                
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       6750-L309A-HEAD.                                                         
      *==================*                                                      
           MOVE F380-DTE-CANCELATION     TO WS-EDIT-DATE.                       
                                                                                
           SET WS-IND                    TO 1.                                  
           SEARCH MONTH-TABLE            AT END                                 
           MOVE 'XXXXXXXXXXXX'           TO L309A-HD1-MONTH                     
           WHEN WS-MTH-CODE (WS-IND)     =  WS-EDIT-MM OF WS-EDIT-DATE          
           MOVE WS-MTH-DESC (WS-IND)     TO L309A-HD1-MONTH.                    
           MOVE WS-EDIT-CC OF WS-EDIT-DATE TO L309A-HD1-CC.                     
           MOVE WS-EDIT-YY OF WS-EDIT-DATE TO L309A-HD1-YY.                     
                                                                                
           MOVE 'P13L309A'               TO L309-HD1-DESC.                      
           MOVE WS-PRINT-DATE            TO L309-HD1-DATE.                      
           ADD  1                        TO WS-CNT-PAGE1.                       
           MOVE WS-CNT-PAGE1             TO L309-HD1-PAGE-NO.                   
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-1 AFTER PAGE         
           MOVE SPACES                  TO   L309-HD1-HEADING2.                 
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-2.                   
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-3A.                  
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-3B.                  
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-4A AFTER 3.          
           WRITE L309A-PRINT-REC        FROM L309-PRT-HEAD-5A.                  
           MOVE SPACES                  TO   L309A-PRINT-REC.                   
           WRITE L309A-PRINT-REC.                                               
           MOVE 7                       TO   WS-CNT-LINE1.                      
                                                                                
       6750-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *==================*                                                      
       8000-PRINT-LAST.                                                         
      *==================*                                                      
           IF  WS-CNT-LINE1 > 55                                                
               PERFORM 6750-L309A-HEAD   THRU 6750-EXIT.                        
                                                                                
              MOVE WS-TOT-AMOUNT              TO L309A-TOTAL2.                  
              WRITE L309A-PRINT-REC          FROM L309A-TOTAL.                  
              MOVE  ZEROS                     TO WS-TOT-AMOUNT.                 
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *=================*                                                       
       9999-CLOSE-ROUTINE.                                                      
      *=================*                                                       
           DISPLAY ' ****************** BP13C309 ****************** '.          
           DISPLAY 'NO OF RECORDS READ FROM TRANSACTION FILE(BP13F380)'         
                   ' = ' WS-F380-READ.                                          
           DISPLAY 'NO OF RECORDS READ FROM RFF MASTER      (BP13K800)'         
                   ' = ' WS-K800-READ.                                          
           DISPLAY 'NO OF SCHEME ACCOUNT FOUND IN PIDB       (BP13C913)'        
                   ' = ' WS-CNT-PIDB-FD                                         
           DISPLAY 'NO OF RECORDS WRITTEN TO TRANS FILE     (BP13OUT) '         
                   ' = ' WS-OUT-WRITE.                                          
           DISPLAY 'NO OF RECORDS PRINTED                   (BP13L309)'         
                   ' = ' WS-L309-PRINT.                                         
           DISPLAY 'NO OF RECORDS PRINTED                   (P13L309A)'         
                   ' = ' WS-L309A-PRINT.                                        
                                                                                
           CLOSE BP13F380                                                       
                 BP13K800                                                       
                 BP13OUT                                                        
                 BP13L309.                                                      
                                                                                
           IF BP13K800-STATUS NOT = 0                                           
              DISPLAY 'ERROR CLOSING BP13K800 FILE ' BP13K800-STATUS            
              MOVE BP13K800-STATUS TO RETURN-CODE.                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
