       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C054.                                                 
      *AUTHOR.        SAUL SIO.                                                 
      *DATE-WRITTEN.  13/06/2006.                                               
      * ========================================================== *            
      * SYSTEM OF COMMITMENT (BP13)                                *            
      * ========================================================== *            
      * OBJECTIVE  : EMAIL LIST OF REJECTED FLATS AFTER AO         *            
      *              TO RESPECTIVE BO                              *            
      *                                                            *            
      * INPUT      : BP13F310                                      *            
      * OUTPUT     : BP13MAIL - OUTPUT FILE FOR SENDING EMAIL      *            
      * ---------------------------------------------------------- *            
      * CHG REF  DATE     BY    DESCRIPTIONS                       *            
      * -------- -------- ----- ------------                       *            
      * BP132874 20060613 SSS2  NEW PROGRAM                        *            
      * BP132874 20060626 SSS2  INCL REGN NO                       *            
      * BP134216 20120418 ZDD1  CHANGE RECEPIENT AND CONTENTS      *            
      * BP135116 20131101 PCL4  TO CHANG THE EMAIL ALERT RECIPIENTS*            
      * BP135537 20150225 RJB1  CHANGE THE EMAIL RECIPIENT FROM    *            
      *                         NICKNAME INTO COMPLETE NAME        *            
      * BP135417 20150311 RJB1  FIX THE ISSUE ON WRONG BO CODE     *            
      * BP136082 20160126 KVL1  TO REPLACE  SU1 W/ HWM2 IN THE CC  *            
      *                         AND USE BP13CCNT TO GET EMAIL ADD- *            
      *                         RESS IN LONG NAME FORMAT           *            
      * BP136557 20161214 RJB1  ENHANCEMENT FOR EMAIL ALERT CONTENT*            
      * BP138257 20200319 KV5   REMOVED THE SANGEETHA FROM COMMENTS*            
      * BP138831 20210817 KV8   TO REPLACE LEE_LI_PENG TO          *            
      *                         BERNICE_JH_GAN                     *            
      * BP139608 20231125 KAR   TO REPLACE BERNICE_JH_GAN TO       *            
      *                         Janice_ML_OH@hdb.gov.sg            *            
      * BP139894 20240206 KAR   Change in sign off OIC for email to             
      *                         Branch on installation of doors for             
      *                         completed unit. amend from BERNICE              
      *                         JH GAN (MS) to HEE WAN MENG                     
      *                         Add <LAI_Yuin_Yuin@hdb.gov.sg> and              
      *                             <Kogila_RAMARAJAN@hdb.gov.sg>               
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13F310 ASSIGN TO BP13F310.                                  
                                                                                
           SELECT BP13MAIL  ASSIGN TO BP13MAIL.                                 
                                                                                
           SELECT BP13K022 ASSIGN TO BP13K022                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K022-KEY-FLD                               
                  ALTERNATE KEY   IS K022-NUM-REGN                              
                  FILE STATUS     IS WS-K022-STATUS.                            
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13F310                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 150 CHARACTERS                                      
            RECORDING MODE IS F.                                                
       COPY BP13F310.                                                           
                                                                                
       FD  BP13MAIL                                                             
           RECORD CONTAINS 80 CHARACTERS                                        
           RECORDING  MODE  IS F.                                               
       01  MAIL-PRTREC                       PIC X(80).                         
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01 WS-F310-EOF                    PIC X     VALUE 'N'.                   
       01 WS-F310-READ                   PIC 9(6)  VALUE ZEROS.                 
       01 WS-SNO                         PIC 9(4)  VALUE ZEROS.                 
       01 WS-K022-STATUS                 PIC 9(2)  VALUE 0.                     
                                                                                
       01 WS-DATE                        PIC X(8)  VALUE SPACES.                
                                                                                
       01 WS-PREV-BO-CODE                PIC X(2)  VALUE SPACES.                
       01 WS-CTR                         PIC 9(3)  VALUE ZEROES.                
       01 WS-CTR-2                       PIC 9(3)  VALUE ZEROES.                
                                                                                
      *--------------------------------*                                        
      *    for mail body               *                                        
      *--------------------------------*                                        
       01  WS-BODY-DETAILS.                                                     
           05  WS-DETAILS OCCURS 100 TIMES.                                     
              10 TABL-SNO              PIC 9(4)   VALUE ZEROS.                  
              10 TABL-ADDRESS          PIC X(60)  VALUE SPACES.                 
              10 TABL-NUM-HDB-REF      PIC X(14)  VALUE SPACES.                 
              10 TABL-NUM-REGN         PIC X(8)   VALUE SPACES.                 
              10 TABL-JOB-CODE         PIC X(4)   VALUE SPACES.                 
              10 TABL-GL-CODE          PIC X(18)  VALUE SPACES.                 
              10 TABL-CSMID            PIC X(50)  VALUE SPACES.                 
              10 TABL-CSMID1           PIC X(50)  VALUE SPACES.                 
                                                                                
      *-------------------------------------------------------------            
      * LAYOUT BP13MAIL  -  DATASET FOR EMAIL                                   
      *-------------------------------------------------------------            
       01  MAIL-HDR1.                                                           
           05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB1'.                 
           05  FILLER          PIC X(68)  VALUE SPACES.                         
                                                                                
       01  MAIL-HDR2.                                                           
           05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
           05  MAIL-SENDID     PIC X(04)  VALUE 'OPCP'.                         
           05  FILLER          PIC X(09)  VALUE '@SGPHDB1>'.                    
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
      *  for testing purpose -------                                            
      *01  MAIL-HDR1.                                                           
      *    05  FILLER          PIC X(12)  VALUE 'HELO SGPHDB3'.                 
      *    05  FILLER          PIC X(68)  VALUE SPACES.                         
      *                                                                         
      *01  MAIL-HDR2.                                                           
      *    05  FILLER          PIC X(11)  VALUE 'MAIL FROM:<'.                  
      *    05  MAIL-SENDID     PIC X(07)  VALUE 'CSXXXXX'.                      
      *    05  FILLER          PIC X(09)  VALUE '@SGPHDB3>'.                    
      *    05  FILLER          PIC X(53)  VALUE SPACES.                         
      *                                                                         
       01  MAIL-DTL1.                                                           
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-BOMAILID   PIC X(20)  VALUE SPACES.                         
           05  FILLER          PIC X(49)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2.                                                           
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CCMAILID   PIC X(60)  VALUE                                 
               'HEE_WAN_MENG@HDB.GOV.SG>'.                                      
           05  FILLER          PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2A.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CCMAILID   PIC X(60)  VALUE                                 
      *        'LEE_LI_PENG@HDB.GOV.SG>'.                                       
      *        'BERNICE_JH_GAN@HDB.GOV.SG>'.                                    
               'Janice_ML_OH@hdb.gov.sg>'.                                      
           05  FILLER          PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2B.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER          PIC X(60)  VALUE                                 
               'Kogila_RAMARAJAN@hdb.gov.sg>'.                                  
           05  FILLER          PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2BB.                                                         
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER          PIC X(60)  VALUE                                 
               '<LAI_Yuin_Yuin@hdb.gov.sg>'.                                    
           05  FILLER          PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2C.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER          PIC X(60)  VALUE                                 
               'DERRICK_WK_LOH@HDB.GOV.SG>'.                                    
           05  FILLER          PIC X(11)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2D.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  FILLER          PIC X(22)  VALUE                                 
               'EAPDSUFILE@HDB.GOV.SG>'.                                        
           05  FILLER          PIC X(45)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL2E.                                                          
           05  FILLER          PIC X(09)  VALUE 'RCPT TO:<'.                    
           05  MAIL-CSMID      PIC X(50)  VALUE SPACES.                         
           05  FILLER          PIC X(15)  VALUE SPACES.                         
                                                                                
                                                                                
       01  MAIL-DTL3.                                                           
           05  FILLER          PIC X(04)  VALUE 'DATA'.                         
           05  FILLER          PIC X(76)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL4.                                                           
           05  FILLER          PIC X(05)  VALUE 'FROM:'.                        
           05  MAIL-SENDMAILID PIC X(26)  VALUE                                 
               'SOC System - Email Alert'.                                      
           05  FILLER          PIC X(49)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL5.                                                           
           05  FILLER          PIC X(4)   VALUE 'TO:<'.                         
           05  MAIL-BOMAILID1  PIC X(20)  VALUE SPACES.                         
           05  FILLER          PIC X(56)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6.                                                           
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
      *        'SANGEETHA_UNBALAGAN@HDB.GOV.SG>'.                               
               'HEE_WAN_MENG@HDB.GOV.SG>'.                                      
           05  FILLER          PIC X(16)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6A.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID2  PIC X(60)  VALUE                                 
      *        'LEE_LI_PENG@HDB.GOV.SG>'.                                       
      *        'BERNICE_JH_GAN@HDB.GOV.SG>'.                                    
               'Janice_ML_OH@hdb.gov.sg>'.                                      
           05  FILLER          PIC X(16)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6B.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
               'Kogila_RAMARAJAN@hdb.gov.sg>'.                                  
           05  FILLER          PIC X(16)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6BB.                                                         
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
               '<LAI_Yuin_Yuin@hdb.gov.sg>'.                                    
           05  FILLER          PIC X(16)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6C.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(60)  VALUE                                 
               'DERRICK_WK_LOH@HDB.GOV.SG>'.                                    
           05  FILLER          PIC X(16)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6D.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CCMAILID1  PIC X(22)  VALUE                                 
               'EAPDSUFILE@HDB.GOV.SG>'.                                        
           05  FILLER          PIC X(50)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL6E.                                                          
           05  FILLER          PIC X(4)   VALUE 'CC:<'.                         
           05  MAIL-CSMID1     PIC X(51)  VALUE SPACES.                         
           05  FILLER          PIC X(45)  VALUE SPACES.                         
                                                                                
       01  MAIL-DTL7.                                                           
           05  FILLER          PIC X(10)  VALUE 'SUBJECT : '.                   
           05  MAIL-SUBJECT    PIC X(40)  VALUE                                 
               'INSTALLATION OF DOORS FOR COMPLETED UNIT'.                      
           05  FILLER          PIC X(30)  VALUE SPACES.                         
                                                                                
       01  MAIL-BODY01.                                                         
           05 FILLER                   PIC X(6)   VALUE 'DATE: '.               
           05 MAIL-DATE                PIC X(10)  VALUE SPACES.                 
                                                                                
       01  MAIL-BODY02.                                                         
           05 FILLER                   PIC X(5)   VALUE 'GM ( '.                
           05 MAIL-CODE-BO             PIC X(2)   VALUE SPACES.                 
           05 FILLER                   PIC X(2)   VALUE ' )'.                   
                                                                                
       01  MAIL-BODY03.                                                         
           05 FILLER                   PIC X(50)  VALUE                         
              'The following unit(s) was/were booked by applicant'.             
           05 FILLER                   PIC X(30)  VALUE                         
              '(s) who opted not to have the '.                                 
                                                                                
       01  MAIL-BODY03B.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'installation of INTERNAL TIMBER DOORS AND FITTINGS'.             
           05 FILLER                   PIC X(30)  VALUE                         
              '. We informed Consultants '.                                     
                                                                                
       01  MAIL-BODY03C.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'accordingly.'.                                                   
                                                                                
       01  MAIL-BODY04.                                                         
           05 FILLER                   PIC X(50)  VALUE                         
              'It was completed and handed over to Sales Operatio'.             
           05 FILLER                   PIC X(30)  VALUE                         
              'ns without such components.   '.                                 
                                                                                
       01  MAIL-BODY04B.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'However, the applicant rejected it before taking p'.             
           05 FILLER                   PIC X(30)  VALUE                         
              'ossession. Before we sell the'.                                  
                                                                                
       01  MAIL-BODY04C.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'unit to other applicants, we would appreciate it '.              
           05 FILLER                   PIC X(30)  VALUE                         
              'if you could get your Term '.                                    
                                                                                
       01  MAIL-BODY04D.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'Contractor to install the components and charge to'.             
           05 FILLER                   PIC X(30)  VALUE                         
              ' MA&B under the Job Code and '.                                  
                                                                                
       01  MAIL-BODY04E.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'GL Code listed below. '.                                         
                                                                                
       01  MAIL-BODY05.                                                         
           05 FILLER                   PIC X(50)  VALUE                         
              'Please collect the keys to the affected unit(s) fr'.             
           05 FILLER                   PIC X(30)  VALUE                         
              'om our Keys Custodian who can '.                                 
                                                                                
       01  MAIL-BODY05B.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'be contacted at 64903795 .  Please also let us hav'.             
           05 FILLER                   PIC X(30)  VALUE                         
              'e your confirmation once      '.                                 
                                                                                
       01  MAIL-BODY05C.                                                        
           05 FILLER                   PIC X(50)  VALUE                         
              'components are installed. Thank you.              '.             
           05 FILLER                   PIC X(30)  VALUE SPACES.                 
                                                                                
       01  MAIL-BODY06.                                                         
           05 FILLER                   PIC X(4)   VALUE SPACES.                 
           05 FILLER                   PIC X(5)   VALUE 'S/NO.'.                
           05 FILLER                   PIC X      VALUE SPACES.                 
           05 FILLER                   PIC X(13)  VALUE                         
              'FLAT/ HDB-REF'.                                                  
           05 FILLER                   PIC X(3)   VALUE SPACES.                 
           05 FILLER                   PIC X(4)   VALUE 'REGN'.                 
           05 FILLER                   PIC X(7)   VALUE SPACES.                 
           05 FILLER                   PIC X(8)   VALUE 'JOB CODE'.             
           05 FILLER                   PIC X(2)   VALUE SPACES.                 
           05 FILLER                   PIC X(7)   VALUE 'GL-CODE'.              
                                                                                
       01  MAIL-BODY07.                                                         
           05 FILLER                   PIC X(4)   VALUE SPACES.                 
           05 FILLER                   PIC X(67)  VALUE ALL '-'.                
                                                                                
       01  MAIL-BODY08.                                                         
           05 FILLER                   PIC X(4)   VALUE SPACES.                 
           05 MAIL-SNO                 PIC ZZZ9   VALUE ZEROS.                  
           05 FILLER                   PIC X(2)   VALUE SPACES.                 
           05 MAIL-ADDRESS             PIC X(60)  VALUE SPACES.                 
           05 FILLER                   PIC X(8)   VALUE SPACES.                 
                                                                                
       01  MAIL-BODY09.                                                         
           05 FILLER                   PIC X(10)  VALUE SPACES.                 
           05 MAIL-NUM-HDB-REF         PIC X(14)  VALUE SPACES.                 
           05 FILLER                   PIC X(2)   VALUE SPACES.                 
           05 MAIL-NUM-REGN            PIC X(8)   VALUE SPACES.                 
           05 FILLER                   PIC X(3)   VALUE SPACES.                 
           05 MAIL-JOB-CODE            PIC X(4)   VALUE SPACES.                 
           05 FILLER                   PIC X(6)   VALUE SPACES.                 
           05 MAIL-GL-CODE             PIC X(18)  VALUE SPACES.                 
                                                                                
       01  MAIL-BODY11.                                                         
           05 FILLER                   PIC X(17)  VALUE                         
              'Yours faithfully'.                                               
                                                                                
       01  MAIL-BODY12.                                                         
           05 FILLER                   PIC X(24)  VALUE                         
      *       'LEE LI PENG (MS)        '.                                       
              'HEE WAN MENG            '.                                       
           05 FILLER                   PIC X(60)  VALUE SPACES.                 
                                                                                
       01  MAIL-BODY12B.                                                        
           05 FILLER                   PIC X(26)  VALUE                         
              'SENIOR ESTATE MANAGER     '.                                     
                                                                                
       01  MAIL-BODY12C.                                                        
           05 FILLER                   PIC X(30)  VALUE                         
              'SALES OPERATIONS SECTION'.                                       
                                                                                
       01  MAIL-BODY12D.                                                        
           05 FILLER                   PIC X(29)  VALUE                         
              'ESTATE ADMIN & PROPERTY GROUP'.                                  
                                                                                
       01  MAIL-END.                                                            
           05 FILLER                   PIC X      VALUE '.'.                    
                                                                                
       01  MAIL-SPACES.                                                         
           05 FILLER                   PIC X(80)  VALUE SPACES.                 
                                                                                
      *-------------------------                                                
      *        LINKAGE FOR SUB-PROGRAM BP13CCNT                                 
      *-------------------------                                                
       01  WS-BP13CCNT-LINK.                                                    
           05  LINK-CNTCT-TYPE         PIC X(3)  VALUE SPACES.                  
           05  LINK-STAFF-NICK         PIC X(6)  VALUE SPACES.                  
           05  LINK-STAFF-NUM          PIC X(6)  VALUE SPACES.                  
           05  LINK-STAFF-CNTCT        PIC X(50) VALUE SPACES.                  
           05  LINK-SYSERR             PIC 9(4)  VALUE ZEROES.                  
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN.                                                               
      *-------------------------------------------------------------            
            PERFORM 1000-OPEN-ROUTINE     THRU 1000-EXIT.                       
            PERFORM 2000-READ-BP13F310    THRU 2000-EXIT.                       
            PERFORM 3000-PROCESS-DETAIL   THRU 3000-EXIT                        
                    UNTIL WS-F310-EOF = 'Y'.                                    
            PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT.                       
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-ROUTINE.                                                       
      *-------------------------------------------------------------            
            OPEN  INPUT  BP13F310                                               
                         BP13K022                                               
                  OUTPUT BP13MAIL.                                              
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 OPEN ERROR, STATUS IS ' WS-K022-STATUS          
              MOVE WS-K022-STATUS              TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-IF.                                                              
                                                                                
                                                                                
            MOVE FUNCTION CURRENT-DATE(1:8) TO WS-DATE.                         
            STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
                   DELIMITED BY SIZE INTO MAIL-DATE.                            
                                                                                
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2000-READ-BP13F310.                                                      
      *-------------------------------------------------------------            
            READ BP13F310                                                       
                 AT END MOVE 'Y' TO WS-F310-EOF                                 
                 GO TO 2000-EXIT.                                               
                                                                                
            ADD 1   TO WS-F310-READ.                                            
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       2100-CALL-BP13CCNT.                                                      
      *----------------------------------------------------------------*        
           CALL 'BP13CCNT' USING WS-BP13CCNT-LINK.                              
                                                                                
           EVALUATE LINK-SYSERR                                                 
           WHEN ZEROS                                                           
              STRING LINK-STAFF-CNTCT DELIMITED BY SPACE                        
                     '>' DELIMITED BY SIZE                                      
                     INTO TABL-CSMID(WS-CTR)                                    
           WHEN 100                                                             
              DISPLAY 'OIC NOT FOUND IN OFFICE_CNTCT TABLE - '                  
                  K022-NUM-OIC       ' REGN : ' F310-REGN-NO                    
           WHEN OTHER                                                           
              MOVE '98'                  TO RETURN-CODE                         
              DISPLAY 'ERROR READING OFFICE_CNTCT TABLE = '                     
                       LINK-SYSERR                                              
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-PROCESS-DETAIL.                                                     
      *-------------------------------------------------------------            
           MOVE SPACES         TO   MAIL-BODY08                                 
                                    MAIL-BODY09.                                
           MOVE ZEROES         TO   WS-CTR  WS-CTR-2.                           
                                                                                
           IF F310-CDE-BO NOT = WS-PREV-BO-CODE                                 
             MOVE F310-CDE-BO TO WS-PREV-BO-CODE                                
                                                                                
             PERFORM UNTIL WS-CTR = 100                                         
                    OR   WS-F310-EOF = 'Y'                                      
                    OR   F310-CDE-BO NOT = WS-PREV-BO-CODE                      
                MOVE F310-CDE-BO TO WS-PREV-BO-CODE                             
                ADD 1 TO WS-CTR                                                 
                MOVE WS-CTR TO TABL-SNO(WS-CTR)                                 
                STRING 'BLK ' F310-NUM-BLK ' #' F310-NUM-LEVEL                  
                    '-'  F310-NUM-MAIN                                          
                    '  ' F310-NME-STREET                                        
                    DELIMITED BY '      ' INTO TABL-ADDRESS(WS-CTR)             
                END-STRING                                                      
                MOVE F310-REGN-NO TO TABL-NUM-REGN(WS-CTR)                      
                                                                                
                STRING F310-SCH-ACC(1:4) '-'                                    
                       F310-SCH-ACC(5:4) '-'                                    
                       F310-SCH-ACC(9:1) '-'                                    
                       F310-SCH-ACC(10:2)                                       
                       DELIMITED BY SIZE INTO TABL-NUM-HDB-REF(WS-CTR)          
                END-STRING                                                      
                EVALUATE F310-CDE-FLAT-TYPE(1:1)                                
                WHEN '2'                                                        
                WHEN '3'                                                        
                WHEN '4'                                                        
                WHEN '5'                                                        
                     MOVE '0650'          TO TABL-JOB-CODE(WS-CTR)              
                     MOVE '0-00-00-00-20-3507' TO TABL-GL-CODE(WS-CTR)          
                WHEN OTHER                                                      
                     MOVE '0715'          TO TABL-JOB-CODE(WS-CTR)              
                     MOVE '8-20-23-00-40-7136' TO TABL-GL-CODE(WS-CTR)          
                END-EVALUATE                                                    
                PERFORM 4000-READ-BP13K022   THRU 4000-EXIT                     
                                                                                
                PERFORM 2000-READ-BP13F310 THRU 2000-EXIT                       
             END-PERFORM                                                        
                                                                                
           END-IF.                                                              
                                                                                
           IF F310-CDE-BO NOT = WS-PREV-BO-CODE                                 
              OR   WS-F310-EOF = 'Y'                                            
               PERFORM 5000-OUTPUT-EMAIL-HDR THRU 5000-EXIT                     
           END-IF                                                               
                                                                                
           MOVE ZEROES    TO WS-CTR-2.                                          
           PERFORM UNTIL WS-CTR-2 = WS-CTR                                      
              ADD 1 TO WS-CTR-2                                                 
              MOVE TABL-SNO(WS-CTR-2) TO MAIL-SNO                               
              MOVE TABL-ADDRESS(WS-CTR-2) TO MAIL-ADDRESS                       
              MOVE TABL-NUM-REGN(WS-CTR-2) TO MAIL-NUM-REGN                     
              MOVE TABL-NUM-HDB-REF(WS-CTR-2) TO MAIL-NUM-HDB-REF               
              MOVE TABL-JOB-CODE(WS-CTR-2) TO MAIL-JOB-CODE                     
              MOVE TABL-GL-CODE(WS-CTR-2) TO MAIL-GL-CODE                       
              WRITE MAIL-PRTREC FROM MAIL-BODY08                                
              WRITE MAIL-PRTREC FROM MAIL-BODY09                                
              MOVE  SPACES      TO   MAIL-PRTREC                                
              WRITE MAIL-PRTREC FROM MAIL-SPACES                                
                                                                                
           END-PERFORM.                                                         
                                                                                
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       4000-READ-BP13K022.                                                      
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES          TO     BP13K022-REC.                            
           MOVE F310-REGN-NO    TO     K022-NUM-REGN                            
                                                                                
           READ BP13K022 KEY IS K022-NUM-REGN                                   
                                                                                
           EVALUATE WS-K022-STATUS                                              
           WHEN 00                                                              
           EVALUATE WS-K022-STATUS                                              
           WHEN 00                                                              
              MOVE SPACES           TO WS-BP13CCNT-LINK                         
              INITIALIZE               WS-BP13CCNT-LINK                         
              MOVE 'EML'            TO LINK-CNTCT-TYPE                          
              MOVE K022-NUM-OIC     TO LINK-STAFF-NICK                          
              MOVE SPACES           TO LINK-STAFF-NUM                           
                                                                                
              PERFORM 2100-CALL-BP13CCNT THRU 2100-EXIT                         
      *       STRING K022-NUM-OIC                                               
      *             '@HDB.GOV.SG>' DELIMITED BY SPACE                           
      *             INTO TABL-CSMID(WS-CTR)                                     
              MOVE TABL-CSMID(WS-CTR)    TO TABL-CSMID1(WS-CTR)                 
                                                                                
           WHEN 23                                                              
                CONTINUE                                                        
           WHEN OTHER                                                           
              DISPLAY 'BP13K022 READ ERROR, STATUS IS ' WS-K022-STATUS          
              MOVE WS-K022-STATUS              TO RETURN-CODE                   
              PERFORM 9000-CLOSE-ROUTINE     THRU 9000-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5000-OUTPUT-EMAIL-HDR.                                                   
      *-------------------------------------------------------------            
           MOVE SPACES      TO MAIL-CODE-BO.                                    
           MOVE ZEROS       TO WS-SNO.                                          
                                                                                
           IF MAIL-BOMAILID(1:2) NOT = '  '                                     
              PERFORM 5500-OUTPUT-EMAIL-FOOTER THRU 5500-EXIT.                  
                                                                                
           MOVE WS-PREV-BO-CODE  TO MAIL-CODE-BO.                               
           STRING 'B' WS-PREV-BO-CODE DELIMITED BY ' '                          
                  'ADMIN@HDB.GOV.SG>' DELIMITED BY SIZE                         
                  INTO MAIL-BOMAILID.                                           
           MOVE MAIL-BOMAILID TO MAIL-BOMAILID1.                                
                                                                                
           WRITE MAIL-PRTREC FROM MAIL-HDR1                                     
           WRITE MAIL-PRTREC FROM MAIL-HDR2.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL1.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL2.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL2A.                                   
           WRITE MAIL-PRTREC FROM MAIL-DTL2B.                                   
           WRITE MAIL-PRTREC FROM MAIL-DTL2BB.                                  
           WRITE MAIL-PRTREC FROM MAIL-DTL2C.                                   
                                                                                
           MOVE ZEROES    TO WS-CTR-2.                                          
           PERFORM UNTIL WS-CTR-2 = WS-CTR                                      
              ADD 1 TO WS-CTR-2                                                 
              MOVE TABL-CSMID(WS-CTR-2)   TO  MAIL-CSMID                        
              WRITE MAIL-PRTREC FROM MAIL-DTL2E                                 
           END-PERFORM.                                                         
                                                                                
           WRITE MAIL-PRTREC FROM MAIL-DTL3.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL4.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL5.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL6.                                    
           WRITE MAIL-PRTREC FROM MAIL-DTL6B.                                   
           WRITE MAIL-PRTREC FROM MAIL-DTL6BB.                                  
           WRITE MAIL-PRTREC FROM MAIL-DTL6C.                                   
      *    WRITE MAIL-PRTREC FROM MAIL-DTL6D.                                   
           WRITE MAIL-PRTREC FROM MAIL-DTL6A.                                   
                                                                                
           MOVE ZEROES    TO WS-CTR-2.                                          
           PERFORM UNTIL WS-CTR-2 = WS-CTR                                      
              ADD 1 TO WS-CTR-2                                                 
              MOVE TABL-CSMID(WS-CTR-2)   TO  MAIL-CSMID1                       
              WRITE MAIL-PRTREC FROM MAIL-DTL6E                                 
           END-PERFORM.                                                         
                                                                                
           WRITE MAIL-PRTREC FROM MAIL-DTL7.                                    
           WRITE MAIL-PRTREC FROM MAIL-BODY01.                                  
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY02.                                  
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY03.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY03B.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY03C.                                 
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY04.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY04B.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY04C.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY04D.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY04E.                                 
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY05.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY05B.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY05C.                                 
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY06.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY07.                                  
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       5500-OUTPUT-EMAIL-FOOTER.                                                
      *-------------------------------------------------------------            
           MOVE SPACES TO MAIL-BOMAILID                                         
                          MAIL-BOMAILID1.                                       
                                                                                
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY11.                                  
           MOVE  SPACES      TO   MAIL-PRTREC.                                  
           WRITE MAIL-PRTREC FROM MAIL-SPACES.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY12.                                  
           WRITE MAIL-PRTREC FROM MAIL-BODY12B.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY12C.                                 
           WRITE MAIL-PRTREC FROM MAIL-BODY12D.                                 
           WRITE MAIL-PRTREC FROM MAIL-END.                                     
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
            IF MAIL-BOMAILID(1:2) NOT = '  '                                    
               PERFORM 5500-OUTPUT-EMAIL-FOOTER THRU 5500-EXIT.                 
                                                                                
            DISPLAY ' '.                                                        
            DISPLAY '- BP13C054 CONTROL LIST --'                                
                    ' DATE : ' MAIL-DATE                                        
            DISPLAY '---------------------------------------------'.            
            DISPLAY ' 1) TOT BP13F310 READ     : ' WS-F310-READ.                
            DISPLAY ' '.                                                        
                                                                                
            CLOSE  BP13F310                                                     
                   BP13K022                                                     
                   BP13MAIL.                                                    
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 CLOSE ERROR, STATUS IS ' WS-K022-STATUS         
              MOVE WS-K022-STATUS              TO RETURN-CODE                   
           END-IF.                                                              
                                                                                
                                                                                
            STOP RUN.                                                           
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
