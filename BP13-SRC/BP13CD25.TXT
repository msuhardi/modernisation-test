      *===============================================================*         
       IDENTIFICATION DIVISION.                                                 
      *===============================================================*         
       PROGRAM-ID.    BP13CD25.                                                 
       AUTHOR.        PAULO CAMIA LEGASPI.                                      
       DATE-WRITTEN.  FEBRUARY 25, 2009.                                        
      *===============================================================*         
      *   OBJECTIVE:  PRINT DBSS CASES WITH GRANT APPROVAL DATE AND   *         
      *               ENSURE ALL GRANT CASES ARE DEBARRED CORRECTLY.  *         
      *===============================================================*         
      *                                                               *         
      *     INPUT FILE :                                              *         
      *                  1. BP13FD00                                  *         
      *                  2. SY02F001                                  *         
      *                  3. BP13KD05                                  *         
      *                  4. BP13K800                                  *         
      *                  5. P04K010                                   *         
      *                  6. BM06K110                                  *         
      *                  7. BP13K022                                  *         
      *                  8. BP13K024                                  *         
      *                  9. BP13K425                                  *         
      *                                                               *         
      *     OUTPUT FILE: 1. BP13LD25                                  *         
      *                                                               *         
      *===============================================================*         
      * REF NO   DATE       BY   AMENDMENTS/ENHANCEMENTS              *         
      *---------------------------------------------------------------*         
      * BP133522 25/02/2009 PCL3 NEW PROGRAM.                         *         
      * BP133909 14/05/2010 PCL3 ADD CHECK ON APPROVAL DATE.          *         
      * BP134641 03/08/2012 MDT2 CHANGE LRECL OF BP13KD05 FROM 300 TO *         
      *                          500 IN FD                            *         
      *===============================================================*         
                                                                                
                                                                                
      **********************                                                    
       ENVIRONMENT DIVISION.                                                    
      **********************                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT  BP13FD00  ASSIGN        TO BP13FD00.                         
           SELECT  SY02F001  ASSIGN        TO SY02F001.                         
           SELECT  BP13K800  ASSIGN        TO BP13K800                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K800-NUM-REGN                     
                             FILE STATUS   IS WS-K800-STATUS.                   
           SELECT  BP13KD05  ASSIGN        TO BP13KD05                          
                             ACCESS MODE   IS DYNAMIC                           
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS KD05-KEY-FLD                      
                             FILE STATUS   IS WS-KD05-STATUS.                   
           SELECT  P04K010   ASSIGN        TO P04K010                           
                             ACCESS MODE  IS DYNAMIC                            
                             ORGANIZATION IS INDEXED                            
                             RECORD KEY   IS K010-PRIME-KEY                     
                             FILE STATUS  IS WS-K010-STATUS.                    
           SELECT  BM06K110  ASSIGN        TO BM06K110                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K110-KEY-FLD                      
                             FILE STATUS   IS WS-K110-STATUS.                   
           SELECT  BP13K022  ASSIGN       TO BP13K022                           
                             ACCESS MODE  IS RANDOM                             
                             ORGANIZATION IS INDEXED                            
                             RECORD KEY   IS K022-KEY-FLD                       
                             ALTERNATE RECORD KEY IS K022-NUM-REGN              
                             FILE STATUS  IS WS-K022-STATUS.                    
           SELECT  BP13K024  ASSIGN        TO BP13K024                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K024-KEY-FLD                      
                             FILE STATUS   IS WS-K024-STATUS.                   
           SELECT  BP13K425  ASSIGN        TO BP13K425                          
                             ACCESS MODE   IS RANDOM                            
                             ORGANIZATION  IS INDEXED                           
                             RECORD KEY    IS K425-KEY-FLD                      
                             FILE STATUS   IS WS-K425-STATUS.                   
           SELECT  BP13LD25  ASSIGN        TO BP13LD25.                         
                                                                                
      ***************                                                           
       DATA DIVISION.                                                           
      ***************                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13FD00                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 1600 CHARACTERS                                     
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       COPY BP13FD00.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K110.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K024                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K024.                                                           
                                                                                
       FD   BP13K425                                                            
            RECORD CONTAINS 20 CHARACTERS.                                      
       COPY BP13K425.                                                           
                                                                                
       FD   BP13KD05                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13KD05.                                                           
                                                                                
       FD   P04K010                                                             
            RECORD CONTAINS 300 CHARACTERS.                                     
       COPY P04K010.                                                            
                                                                                
       FD   BP13LD25                                                            
            BLOCK  CONTAINS 0 RECORDS                                           
            RECORD CONTAINS 132 CHARACTERS                                      
            LABEL RECORD IS OMITTED                                             
            RECORDING MODE IS F.                                                
       01   BP13LD25-REC               PIC X(132).                              
                                                                                
                                                                                
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                   WORKING-STORAGE AREA                         *        
      ******************************************************************        
       01  FILE-VARIABLES.                                                      
           05  WS-F001-EOF             PIC X(1)  VALUE 'N'.                     
               88 EOF-F001                       VALUE 'Y'.                     
           05  WS-EOF-FD00             PIC X(1)  VALUE 'N'.                     
           05  WS-EOF-KD05             PIC X(1)  VALUE 'N'.                     
           05  WS-EOF-K010             PIC X(1)  VALUE 'N'.                     
           05  WS-K800-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K110-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-KD05-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K010-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K022-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K024-STATUS          PIC 9(02) VALUE ZEROES.                  
           05  WS-K425-STATUS          PIC 9(02) VALUE ZEROES.                  
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-FD00-READ            PIC 9(7)  VALUE ZEROES.                  
           05  WS-FD00-SPACE           PIC 9(7)  VALUE ZEROES.                  
           05  WS-FD00-DATE            PIC 9(7)  VALUE ZEROES.                  
           05  WS-K800-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-KD05-NFND            PIC 9(7)  VALUE ZEROES.                  
           05  WS-P04KCODE-NFND        PIC 9(7)  VALUE ZEROES.                  
           05  WS-SNO                  PIC 9(7)  VALUE ZEROES.                  
           05  WS-LINE-CTR             PIC 9(2)  VALUE ZEROES.                  
           05  WS-PAGE-CTR             PIC 9(4)  VALUE ZEROES.                  
           05  WS-CNT-LD25-WRITE       PIC 9(7)  VALUE ZEROES.                  
           05  WS-CNT-P04K             PIC 9(7)  VALUE ZEROES.                  
           05  WS-CNT-WRITE            PIC 9(1)  VALUE 2.                       
           05  WS-MAX-LINE             PIC 9(2)  VALUE 55.                      
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-SYSTEM-DATE           PIC 9(8)  VALUE ZEROES.                  
           05 WS-HA                    PIC X(1)  VALUE SPACE.                   
           05 WS-AHG-CODE              PIC X(2)  VALUE SPACES.                  
           05 WS-CPF-CODE              PIC X(2)  VALUE SPACES.                  
           05 WS-REGN-NO               PIC X(8)  VALUE SPACES.                  
           05 WS-SNO-ZZZZ9             PIC ZZZZ9 VALUE ZEROES.                  
           05 WS-FIRST-WRITE           PIC X(1)  VALUE 'Y'.                     
           05 WS-NUM-PROJECT           PIC X(3)  VALUE SPACES.                  
           05 WS-DTE-LAST-WK           PIC 9(08) VALUE ZEROES.                  
           05 WS-DTE-NUM               PIC 9(07) VALUE ZEROES.                  
           05 WS-DAYS                  PIC 9     VALUE ZERO.                    
                                                                                
       01  WS-DATE.                                                             
           05  WS-CCYY                 PIC X(04) VALUE SPACES.                  
           05  WS-MM                   PIC X(02) VALUE SPACES.                  
           05  WS-DD                   PIC X(02) VALUE SPACES.                  
                                                                                
       01  WS-DEBT-SERIAL              PIC 9(07) VALUE ZEROES.                  
       01  WS-DEBT-YEARS.                                                       
           05 WS-DEBT-CC               PIC X(2)  VALUE SPACES.                  
           05 WS-DEBT-YY               PIC X(2)  VALUE SPACES.                  
                                                                                
       01  WS-DEB-REF-NO.                                                       
           05 WS-DEBREF-AO             PIC X(2)  VALUE SPACES.                  
           05 WS-DEBREF-ID             PIC X(7)  VALUE SPACES.                  
           05 WS-DEBREF-YR             PIC X(4)  VALUE SPACES.                  
                                                                                
       01  WS-DEBAR-CODE               PIC X(02).                               
           88 VALID-CPF-CODE     VALUE 'GD' 'GI' 'GK' 'GE'                      
                                       'GJ' 'GL' '71' 'GF'                      
                                       'GP' 'GY' 'GG' 'GM'                      
                                       'GH' 'GN' 'GQ' 'GS'                      
                                       'GU' 'GT' 'GV' 'GZ'                      
                                       'GF' 'SC' 'SP'.                          
           88 VALID-AHG-CODE     VALUE 'LE' 'LF' 'LG' 'LH'                      
                                       'JG' 'JH' 'JI' 'JJ'                      
                                       'JK' 'JL' 'NI' 'NJ'                      
                                       'NK' 'NL' 'NM' 'NN'                      
                                       'NO' 'NP' 'LI' 'LA'                      
                                       'LJ' 'LB' 'LK' 'LC'                      
                                       'LL' 'LD' 'JM' 'JA'                      
                                       'JN' 'JB' 'JO' 'JC'                      
                                       'JP' 'JD' 'JQ' 'JE'                      
                                       'JR' 'JF' 'NQ' 'NA'                      
                                       'NR' 'NB' 'NS' 'NC'                      
                                       'NT' 'ND' 'NU' 'NE'                      
                                       'NV' 'NF' 'NW' 'NG'                      
                                       'NX' 'NH'.                               
                                                                                
                                                                                
       01  LD25-HEADER01.                                                       
           05  FILLER              PIC X(8)      VALUE 'BP13LD25'.              
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                  'S Y S T E M   O F   '.                       
           05  FILLER              PIC X(19) VALUE                              
                                  'C O M M I T M E N T'.                        
           05  FILLER              PIC X(15)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'DATE : '.               
           05  LD25-DATE-HDR       PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(07)     VALUE 'PAGE : '.               
           05  LD25-PAGE-HDR       PIC ZZZ9      VALUE ZEROES.                  
                                                                                
       01  LD25-HEADER02.                                                       
           05  FILLER              PIC X(45)     VALUE SPACES.                  
           05  FILLER              PIC X(52)     VALUE                          
               'REPORT ON DBSS CASES WITH GRANT APPROVAL DATE'.                 
                                                                                
       01  LD25-HEADER03.                                                       
           05  LD25-NME-PRJCT      PIC X(08)     VALUE SPACES.                  
           05  FILLER              PIC X(08)     VALUE 'REGN NO '.              
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(09)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(11)     VALUE 'DEBAR      '.           
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'AHG '.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'GRNT'.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'P04K'.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(06)     VALUE 'HSGNT '.                
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(06)     VALUE 'AHG   '.                
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(27)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(04)     VALUE 'NAME'.                  
           05  FILLER              PIC X(20)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE 'CTZ'.                   
                                                                                
       01  LD25-HEADER04.                                                       
           05  FILLER              PIC X(01)    VALUE SPACES.                   
           05  FILLER              PIC X(05)    VALUE '  S/N'.                  
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(10)    VALUE 'APPRV DATE'.             
           05  FILLER              PIC X(09)    VALUE 'NRIC NO  '.              
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(11)    VALUE 'REFERENCE  '.            
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(04)    VALUE 'CODE'.                   
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(04)    VALUE 'TYPE'.                   
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(04)    VALUE 'CODE'.                   
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(06)    VALUE 'AMOUNT'.                 
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(06)    VALUE 'AMOUNT'.                 
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(27)                                    
                                       VALUE 'BLK/HSE NO/POSTAL CODE'.          
           05  FILLER              PIC X(02)    VALUE SPACES.                   
           05  FILLER              PIC X(03)    VALUE 'CSM'.                    
           05  FILLER              PIC X(21)    VALUE SPACES.                   
           05  FILLER              PIC X(03)    VALUE 'HH '.                    
                                                                                
       01  LD25-DETAIL01.                                                       
           05  FILLER              PIC X(01)        VALUE SPACES.               
           05  LD25-SN             PIC X(05)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-REGN           PIC X(08)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-NRIC           PIC X(09)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-DEB-REF-NO     PIC X(11)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-AHG-CODE       PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-GRNT-TYP       PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-P04-CODE       PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-HG-AMT         PIC ZZ,ZZ9       VALUE ZEROES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-AHG-AMT        PIC ZZ,ZZ9       VALUE ZEROES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-ADDRESS        PIC X(27)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-CSM            PIC X(22)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-CTZ-HH         PIC X(03)        VALUE SPACES.               
                                                                                
       01  LD25-DETAIL02.                                                       
           05  FILLER              PIC X(08)        VALUE SPACES.               
           05  LD25-APPRV-DTE-2    PIC X(10)        VALUE SPACES.               
           05  FILLER              PIC X(54)        VALUE SPACES.               
           05  LD25-AHG-CODE-2     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-GRNT-TYP-2     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
           05  LD25-P04-CODE-2     PIC X(04)        VALUE SPACES.               
           05  FILLER              PIC X(18)        VALUE SPACES.               
           05  LD25-ADDRESS-2      PIC X(27)        VALUE SPACES.               
           05  FILLER              PIC X(02)        VALUE SPACES.               
      *    05  LD25-CSM            PIC X(22)        VALUE SPACES.               
                                                                                
       COPY AV02COMM.                                                           
                                                                                
      ******************************************************************        
      *                   P R O G R A M     B O D Y                    *        
      ******************************************************************        
                                                                                
      ********************                                                      
       PROCEDURE DIVISION.                                                      
      ********************                                                      
                                                                                
      ******************************************************************        
       0000-MAIN.                                                               
      ******************************************************************        
                                                                                
           PERFORM 1000-OPEN-ROUTINE       THRU 1000-EXIT.                      
                                                                                
           PERFORM 2000-READ-BP13FD00      THRU 2000-EXIT.                      
                                                                                
           PERFORM 3000-PROCESS-RECORDS    THRU 3000-EXIT                       
             UNTIL WS-EOF-FD00 = 'Y'.                                           
                                                                                
           PERFORM 9999-CLOSE-ROUTINE      THRU  9999-EXIT.                     
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1000-OPEN-ROUTINE.                                                       
      ******************************************************************        
                                                                                
           OPEN INPUT  BP13FD00                                                 
                       SY02F001                                                 
                       P04K010                                                  
                       BP13K800                                                 
                       BP13KD05                                                 
                       BM06K110                                                 
                       BP13K022                                                 
                       BP13K024                                                 
                       BP13K425                                                 
              OUTPUT   BP13LD25.                                                
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR OPENING : ' WS-K800-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 - ERROR OPENING : ' WS-K110-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-KD05-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD05 - ERROR OPENING : ' WS-KD05-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'P04K010  - ERROR OPENING : ' WS-K010-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 - ERROR OPENING : ' WS-K022-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K024-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K024 - ERROR OPENING : ' WS-K024-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           IF WS-K425-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K425 - ERROR OPENING : ' WS-K425-STATUS              
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           END-IF.                                                              
                                                                                
           READ SY02F001 AT END MOVE 'Y'  TO WS-F001-EOF.                       
           IF EOF-F001                                                          
              DISPLAY 'RECORD NOT FOUND IN SY01F001 '                           
              DISPLAY 'PROCESSING TERMINATED '                                  
              PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                       
           ELSE                                                                 
              MOVE F001-DTE-CURRENT      TO   WS-SYSTEM-DATE                    
           END-IF.                                                              
                                                                                
           PERFORM 1100-CHECK-DATE      THRU 1100-EXIT.                         
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1100-CHECK-DATE.                                                         
      ******************************************************************        
                                                                                
           MOVE WS-SYSTEM-DATE                    TO WS-DTE-LAST-WK.            
                                                                                
           COMPUTE WS-DAYS = 0.                                                 
           PERFORM UNTIL WS-DAYS = 7                                            
                   COMPUTE WS-DTE-NUM =                                         
                           FUNCTION INTEGER-OF-DATE (WS-DTE-LAST-WK)            
                   COMPUTE WS-DTE-NUM = WS-DTE-NUM - 1                          
                   COMPUTE WS-DTE-LAST-WK =                                     
                           FUNCTION DATE-OF-INTEGER (WS-DTE-NUM)                
                                                                                
                   MOVE WS-DTE-LAST-WK            TO WS-IN-DATE                 
                   PERFORM 1200-VALIDATE-DATE   THRU 1200-EXIT                  
                                                                                
           END-PERFORM.                                                         
                                                                                
                                                                                
       1100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       1200-VALIDATE-DATE.                                                      
      ******************************************************************        
                                                                                
           MOVE 'DW'                   TO WS-IN-OPTION.                         
           MOVE '000'                  TO WS-RETURN.                            
                                                                                
           CALL 'AV02C001'          USING LINK-REC.                             
                                                                                
           IF WS-RETURN = 'SUN' OR 'MON' OR 'TUE' OR 'WED' OR                   
                          'THU' OR 'FRI' OR 'SAT'                               
              ADD 1                                    TO WS-DAYS               
           END-IF.                                                              
                                                                                
       1200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       2000-READ-BP13FD00.                                                      
      ******************************************************************        
                                                                                
           READ BP13FD00           AT   END                                     
                MOVE 'Y'           TO   WS-EOF-FD00                             
                GO                 TO   2000-EXIT.                              
                                                                                
           ADD  1                  TO   WS-FD00-READ.                           
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3000-PROCESS-RECORDS.                                                    
      ******************************************************************        
                                                                                
           IF FD00-NUM-REGN > SPACES                                            
               IF FD00-DTE-HSGNT-APPROVE NOT = SPACES AND LOW-VALUES            
                                                      AND ZEROES                
                  IF (FD00-DTE-HSGNT-APPROVE >= WS-DTE-LAST-WK) AND             
                     (FD00-DTE-HSGNT-APPROVE <= WS-SYSTEM-DATE)                 
                     PERFORM 3200-READ-BP13K800    THRU 3200-EXIT               
                  ELSE                                                          
                     ADD 1                           TO WS-FD00-DATE            
                  END-IF                                                        
               ELSE                                                             
                  ADD 1                              TO WS-FD00-SPACE           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP13FD00           THRU 2000-EXIT.                 
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       3200-READ-BP13K800.                                                      
      ******************************************************************        
                                                                                
           MOVE FD00-NUM-REGN TO K800-NUM-REGN.                                 
                                                                                
           READ BP13K800.                                                       
                                                                                
           EVALUATE WS-K800-STATUS                                              
               WHEN 00                                                          
                    PERFORM 3400-READ-BM06K110    THRU 3400-EXIT                
                    PERFORM 4000-START-BP13KD05   THRU 4000-EXIT                
               WHEN 23                                                          
                    ADD 1                           TO WS-K800-NFND             
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K800 : ' WS-K800-STATUS          
                            ' REGN = ' K800-NUM-REGN                            
                    PERFORM  9999-CLOSE-ROUTINE   THRU 9999-EXIT                
           END-EVALUATE.                                                        
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       3400-READ-BM06K110.                                                      
      ******************************************************************        
                                                                                
           MOVE K800-NUM-SCH-ACC TO K110-KEY-FLD.                               
                                                                                
           READ BM06K110.                                                       
                                                                                
           EVALUATE WS-K110-STATUS                                              
               WHEN 00                                                          
               WHEN 23                                                          
                    CONTINUE                                                    
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BM06K110 : ' WS-K110-STATUS          
                            ' SCHEME ACCT = ' K110-KEY-FLD                      
                    PERFORM  9999-CLOSE-ROUTINE    THRU 9999-EXIT               
           END-EVALUATE.                                                        
                                                                                
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4000-START-BP13KD05.                                                     
      ******************************************************************        
                                                                                
           MOVE SPACES                               TO BP13KD05-REC.           
           INITIALIZE                                   BP13KD05-REC.           
                                                                                
           MOVE 'N'                                  TO WS-EOF-KD05.            
           MOVE FD00-NUM-REGN                        TO KD05-NUM-REGN.          
                                                                                
           START BP13KD05 KEY = KD05-NUM-REGN.                                  
                                                                                
           EVALUATE WS-KD05-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 4200-READNEXT-BP13KD05 THRU 4200-EXIT               
                    PERFORM 4400-PROCESS-BP13KD05  THRU 4400-EXIT               
                            UNTIL WS-EOF-KD05 = 'Y'                             
               WHEN 20                                                          
               WHEN 23                                                          
                    ADD 1                            TO WS-KD05-NFND            
               WHEN OTHER                                                       
                  DISPLAY 'START ERROR BP13KD05 : ' WS-KD05-STATUS              
                          ' REGN : ' KD05-NUM-REGN                              
                  PERFORM 9999-CLOSE-ROUTINE       THRU 9999-EXIT               
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4200-READNEXT-BP13KD05.                                                  
      ******************************************************************        
                                                                                
           READ BP13KD05 NEXT RECORD                                            
                         AT END MOVE 'Y' TO WS-EOF-KD05.                        
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4400-PROCESS-BP13KD05.                                                   
      ******************************************************************        
                                                                                
           IF KD05-NUM-REGN = FD00-NUM-REGN                                     
             IF KD05-NUM-AHG-DEBAR = 'Y' OR KD05-NUM-CHG-DEBAR = 'Y'            
                IF KD05-NUM-AHG-DEBAR = 'Y'                                     
                   PERFORM 4500-DETERMINE-AHG-CODE THRU 4500-EXIT               
                END-IF                                                          
                                                                                
                IF KD05-NUM-CHG-DEBAR = 'Y'                                     
                   PERFORM 4600-DETERMINE-CPF-CODE THRU 4600-EXIT               
                END-IF                                                          
             END-IF                                                             
                                                                                
             PERFORM 4700-START-P04K010            THRU 4700-EXIT               
             PERFORM 4200-READNEXT-BP13KD05        THRU 4200-EXIT               
           ELSE                                                                 
             MOVE 'Y' TO WS-EOF-KD05                                            
           END-IF.                                                              
                                                                                
       4400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4500-DETERMINE-AHG-CODE.                                                 
      ******************************************************************        
                                                                                
            IF KD05-NUM-HA-TAG = '0'                                            
               MOVE 'N'                                TO WS-HA                 
            ELSE                                                                
               MOVE 'Y'                                TO WS-HA                 
            END-IF.                                                             
                                                                                
      *OCCUPIER                                                                 
            IF WS-HA = 'N'                                                      
               EVALUATE K800-NUM-AHG                                            
                  WHEN  'A05'                                                   
                        MOVE 'LE' TO WS-AHG-CODE                                
                  WHEN  'A10'                                                   
                        MOVE 'LF' TO WS-AHG-CODE                                
                  WHEN  'A15'                                                   
                        MOVE 'LG' TO WS-AHG-CODE                                
                  WHEN  'A20'                                                   
                        MOVE 'LH' TO WS-AHG-CODE                                
                  WHEN  'B05'                                                   
                        MOVE 'JG' TO WS-AHG-CODE                                
                  WHEN  'B10'                                                   
                        MOVE 'JH' TO WS-AHG-CODE                                
                  WHEN  'B15'                                                   
                        MOVE 'JI' TO WS-AHG-CODE                                
                  WHEN  'B20'                                                   
                        MOVE 'JJ' TO WS-AHG-CODE                                
                  WHEN  'B25'                                                   
                        MOVE 'JK' TO WS-AHG-CODE                                
                  WHEN  'B30'                                                   
                        MOVE 'JL' TO WS-AHG-CODE                                
                  WHEN  'C05'                                                   
                        MOVE 'NI' TO WS-AHG-CODE                                
                  WHEN  'C10'                                                   
                        MOVE 'NJ' TO WS-AHG-CODE                                
                  WHEN  'C15'                                                   
                        MOVE 'NK' TO WS-AHG-CODE                                
                  WHEN  'C20'                                                   
                        MOVE 'NL' TO WS-AHG-CODE                                
                  WHEN  'C25'                                                   
                        MOVE 'NM' TO WS-AHG-CODE                                
                  WHEN  'C30'                                                   
                        MOVE 'NN' TO WS-AHG-CODE                                
                  WHEN  'C35'                                                   
                        MOVE 'NO' TO WS-AHG-CODE                                
                  WHEN  'C40'                                                   
                        MOVE 'NP' TO WS-AHG-CODE                                
                  WHEN  OTHER                                                   
                        MOVE SPACES TO WS-AHG-CODE                              
               END-EVALUATE                                                     
            ELSE                                                                
      *HA                                                                       
               EVALUATE K800-NUM-AHG                                            
                  WHEN 'A05'                                                    
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'LI'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 5000 OR 2500                
                              MOVE 'LA'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'A10'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'LJ'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 10000 OR 5000               
                              MOVE 'LB'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'A15'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'LK'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 15000 OR 7500               
                              MOVE 'LC'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'A20'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'LL'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 20000 OR 10000              
                              MOVE 'LD'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN 'B05'                                                    
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JM' TO WS-AHG-CODE                             
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 5000 OR 2500                
                              MOVE 'JA'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'B10'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JN' TO WS-AHG-CODE                             
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 10000 OR 5000               
                              MOVE 'JB'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'B15'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JO'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 15000 OR 7500               
                              MOVE 'JC'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'B20'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JP'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 20000 OR 10000              
                              MOVE 'JD'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'B25'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JQ'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 25000 OR 12500              
                              MOVE 'JE'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'B30'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'JR'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 30000 OR 15000              
                              MOVE 'JF'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C05'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NQ'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 5000 OR 2500                
                              MOVE 'NA'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C10'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NR'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 10000 OR 5000               
                              MOVE 'NB'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C15'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NS'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 15000 OR 7500               
                              MOVE 'NC'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C20'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NT'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 20000 OR 10000              
                              MOVE 'ND'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C25'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NU'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 25000 OR 12500              
                              MOVE 'NE'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C30'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NV'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 30000 OR 15000              
                              MOVE 'NF'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C35'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NW'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 35000 OR 17500              
                              MOVE 'NG'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  'C40'                                                   
                        IF KD05-AMT-INCOME-AHG = 0                              
                           MOVE 'NX'      TO WS-AHG-CODE                        
                        ELSE                                                    
                           IF KD05-AMT-INCOME-AHG = 40000 OR 20000              
                              MOVE 'NH'   TO WS-AHG-CODE                        
                           ELSE                                                 
                              MOVE SPACES TO WS-AHG-CODE                        
                           END-IF                                               
                        END-IF                                                  
                  WHEN  OTHER                                                   
                        MOVE SPACES       TO WS-AHG-CODE                        
               END-EVALUATE                                                     
            END-IF.                                                             
                                                                                
       4500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       4600-DETERMINE-CPF-CODE.                                                 
      ******************************************************************        
                                                                                
           IF KD05-AMT-HSGNT NOT NUMERIC                                        
              MOVE ZEROES TO KD05-AMT-HSGNT                                     
           END-IF.                                                              
                                                                                
           IF KD05-NUM-HA-TAG  = '5' OR '6'                                     
              MOVE '71'   TO WS-CPF-CODE                                        
           ELSE                                                                 
           IF KD05-NUM-RELATIONSHIP  = '20'                                     
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'F' AND              
                     KD05-AMT-HSGNT NOT = 0                                     
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'F' AND              
                     (KD05-NUM-CITIZENSHIP = '20' OR 'SP') AND                  
                     KD05-AMT-HSGNT = 0                                         
                     MOVE 'GI' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     (FD00-NUM-HSGNT-ELIG = 'M') AND                            
                     (KD05-NUM-CITIZENSHIP = '20' OR 'SP') AND                  
                     KD05-AMT-HSGNT = 0                                         
                     MOVE 'GJ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'M')                            
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (FD00-NUM-HSGNT-ELIG = 'H')                                
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'H')                            
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND FD00-NUM-HSGNT-ELIG = 'F'                  
                     AND KD05-AMT-HSGNT = 0                                     
                     MOVE 'GK' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     KD05-AMT-HSGNT = 0   AND                                   
                     (FD00-NUM-HSGNT-ELIG = 'M')                                
                     MOVE 'GL' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND FD00-NUM-HSGNT-ELIG = 'T'                  
                     MOVE 'GM' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN FD00-NUM-HSGNT-ELIG = 'L' OR 'K'                           
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           ELSE                                                                 
           IF KD05-NUM-RELATIONSHIP  = '09'                                     
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'F' AND              
                     KD05-AMT-HSGNT NOT = 0                                     
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'M')                            
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (FD00-NUM-HSGNT-ELIG = 'H')                                
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'H')                            
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'F' AND              
                     (KD05-NUM-CITIZENSHIP = '20' OR 'SP') AND                  
                     KD05-AMT-HSGNT = 0                                         
                     MOVE 'GI' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND                                            
                     (FD00-NUM-HSGNT-ELIG = 'M') AND                            
                     (KD05-NUM-CITIZENSHIP = '20' OR 'SP') AND                  
                     KD05-AMT-HSGNT = 0                                         
                     MOVE 'GJ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     KD05-AMT-HSGNT = 0   AND                                   
                     (FD00-NUM-HSGNT-ELIG = 'M')                                
                     MOVE 'GL' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN FD00-NUM-HSGNT-ELIG = 'L' OR 'K'                           
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           ELSE                                                                 
              EVALUATE TRUE                                                     
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'M')                            
                     MOVE 'GE' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND                                            
                     (FD00-NUM-HSGNT-ELIG = 'H')                                
                     MOVE 'GZ' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND KD05-AMT-HSGNT NOT = 0                     
                     AND (FD00-NUM-HSGNT-ELIG = 'H')                            
                     MOVE 'GY' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'F' AND              
                     KD05-AMT-HSGNT NOT = 0                                     
                     MOVE 'GD' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'Y' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GF' TO WS-CPF-CODE                                   
                                                                                
                WHEN WS-HA = 'N' AND FD00-NUM-HSGNT-ELIG = 'S'                  
                     MOVE 'GP' TO WS-CPF-CODE                                   
                                                                                
                WHEN FD00-NUM-HSGNT-ELIG = 'T'                                  
                     MOVE 'GG' TO WS-CPF-CODE                                   
                                                                                
                WHEN FD00-NUM-HSGNT-ELIG = 'L' OR 'K'                           
                     PERFORM 4610-CHECK-DEBAR-HHG  THRU 4610-EXIT               
                                                                                
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      ******************************************************************        
       4610-CHECK-DEBAR-HHG.                                                    
      ******************************************************************        
                                                                                
           IF KD05-NUM-RELATIONSHIP  = '00' OR '20' OR '09'                     
              IF FD00-NUM-HSGNT-ELIG = 'L'                                      
                 IF KD05-AMT-HSGNT > 0                                          
                    MOVE 'GQ'    TO WS-CPF-CODE                                 
                 ELSE                                                           
                    IF WS-HA = 'Y'                                              
                       MOVE 'GS' TO WS-CPF-CODE                                 
                    ELSE                                                        
                       MOVE 'GU' TO WS-CPF-CODE                                 
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
                                                                                
              IF FD00-NUM-HSGNT-ELIG = 'K'                                      
                 IF KD05-AMT-HSGNT > 0                                          
                    MOVE 'GQ'    TO WS-CPF-CODE                                 
                 ELSE                                                           
                    IF WS-HA = 'Y'                                              
                       MOVE 'GT' TO WS-CPF-CODE                                 
                    ELSE                                                        
                       MOVE 'GV' TO WS-CPF-CODE                                 
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4610-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4700-START-P04K010.                                                      
      ******************************************************************        
                                                                                
           MOVE SPACES                              TO P04K010-REC.             
           INITIALIZE                                  P04K010-REC.             
                                                                                
           MOVE 'N'                                 TO WS-EOF-K010.             
           MOVE SPACES                              TO WS-DEBAR-CODE.           
           MOVE KD05-NUM-NRIC                       TO K010-NUM-UINFIN.         
                                                                                
           START P04K010  KEY = K010-NUM-UINFIN.                                
                                                                                
           EVALUATE WS-K010-STATUS                                              
               WHEN 00                                                          
               WHEN 02                                                          
                    PERFORM 4800-READNEXT-P04K010  THRU 4800-EXIT               
                    PERFORM 4900-PROCESS-P04K010   THRU 4900-EXIT               
                            UNTIL WS-EOF-K010 = 'Y'                             
               WHEN 20                                                          
               WHEN 23                                                          
                    MOVE SPACES                    TO K010-REASON-CODE          
                    PERFORM 5000-GET-FIELDS        THRU 5000-EXIT               
               WHEN OTHER                                                       
                    DISPLAY 'START ERROR P04K010 : ' WS-K010-STATUS             
                            ' NRIC : ' K010-NUM-UINFIN                          
                    PERFORM 9999-CLOSE-ROUTINE     THRU 9999-EXIT               
            END-EVALUATE.                                                       
                                                                                
       4700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       4800-READNEXT-P04K010.                                                   
      ******************************************************************        
                                                                                
           READ P04K010 NEXT RECORD                                             
                         AT END MOVE 'Y' TO WS-EOF-K010.                        
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       4900-PROCESS-P04K010.                                                    
      ******************************************************************        
                                                                                
           IF (K010-NUM-UINFIN = KD05-NUM-NRIC)                                 
               MOVE K010-REASON-CODE          TO WS-DEBAR-CODE                  
                                                                                
               IF  VALID-AHG-CODE OR VALID-CPF-CODE                             
                   ADD 1                      TO WS-CNT-P04K                    
                   PERFORM 5000-GET-FIELDS    THRU 5000-EXIT                    
               ELSE                                                             
                   ADD 1                      TO WS-P04KCODE-NFND               
               END-IF                                                           
                                                                                
               PERFORM 4800-READNEXT-P04K010  THRU 4800-EXIT                    
           ELSE                                                                 
               MOVE 'Y'                       TO WS-EOF-K010                    
               IF WS-CNT-P04K = 1                                               
                  PERFORM 6000-PRINT-REPORT   THRU 6000-EXIT                    
               END-IF                                                           
                                                                                
               MOVE 0                         TO WS-CNT-P04K                    
           END-IF.                                                              
                                                                                
       4900-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       5000-GET-FIELDS.                                                         
      ******************************************************************        
                                                                                
           MOVE SPACES                                TO LD25-DETAIL01          
                                                         LD25-DETAIL02.         
           INITIALIZE                                    LD25-DETAIL01          
                                                         LD25-DETAIL02.         
                                                                                
           STRING WS-SYSTEM-DATE(7:2) '/'                                       
                  WS-SYSTEM-DATE(5:2) '/'                                       
                  WS-SYSTEM-DATE(1:4)                                           
              DELIMITED BY SIZE INTO LD25-DATE-HDR.                             
                                                                                
                                                                                
           MOVE FD00-NUM-PROJECT               TO LD25-NME-PRJCT.               
           MOVE FD00-NUM-REGN                  TO LD25-REGN.                    
      *    MOVE KD05-NME-OCCP                  TO LD25-NME-OCCP.                
           MOVE KD05-NUM-NRIC                  TO LD25-NRIC.                    
                                                                                
           IF KD05-AMT-AHG-GRANT NOT NUMERIC                                    
              MOVE ZEROES                      TO KD05-AMT-AHG-GRANT            
           END-IF.                                                              
           MOVE KD05-AMT-AHG-GRANT             TO LD25-AHG-AMT.                 
                                                                                
           IF KD05-AMT-HSGNT NOT NUMERIC                                        
              MOVE ZEROES                      TO KD05-AMT-AHG-GRANT            
           END-IF.                                                              
           MOVE KD05-AMT-HSGNT                 TO LD25-HG-AMT.                  
                                                                                
           MOVE WS-AHG-CODE                    TO LD25-AHG-CODE.                
           MOVE FD00-NUM-HSGNT-ELIG            TO LD25-GRNT-TYP.                
           MOVE WS-DEBAR-CODE                  TO LD25-P04-CODE.                
           MOVE K800-CDE-CITIZENSHIP-HOUSEHOLD TO LD25-CTZ-HH.                  
                                                                                
           STRING K010-BLOCK ' #'                                               
                  K010-HOUSE-NO 'S('                                            
                  K010-POSTCODE ')'                                             
              DELIMITED BY SIZE INTO LD25-ADDRESS.                              
                                                                                
           IF WS-CNT-P04K > 1                                                   
              MOVE LD25-P04-CODE               TO LD25-P04-CODE-2               
              MOVE LD25-ADDRESS                TO LD25-ADDRESS-2                
           END-IF.                                                              
                                                                                
           PERFORM 6000-PRINT-REPORT         THRU 6000-EXIT.                    
                                                                                
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5200-GET-CSM-NAME.                                                       
      ******************************************************************        
                                                                                
            MOVE SPACES                                TO BP13K022-REC.         
            INITIALIZE                                    BP13K022-REC.         
                                                                                
            MOVE FD00-NUM-REGN TO K022-NUM-REGN.                                
                                                                                
            READ BP13K022 KEY IS K022-NUM-REGN.                                 
                                                                                
            EVALUATE WS-K022-STATUS                                             
                WHEN 00                                                         
                     PERFORM 5400-READ-BP13K024       THRU 5400-EXIT            
                WHEN 23                                                         
                     MOVE SPACES                        TO LD25-CSM             
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP13K022 : ' WS-K022-STATUS         
                             ' REGN NO = ' K022-NUM-REGN                        
                     PERFORM  9999-CLOSE-ROUTINE      THRU 9999-EXIT            
            END-EVALUATE.                                                       
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5300-GET-DEBAR-REF-NO.                                                   
      ******************************************************************        
                                                                                
           MOVE 'SL'                               TO K425-CDE-DEPT.            
                                                                                
           READ BP13K425.                                                       
                                                                                
           EVALUATE WS-K425-STATUS                                              
               WHEN 00                                                          
                    PERFORM 5500-PROCESS-DEB-REF THRU 5500-EXIT                 
               WHEN 23                                                          
                    MOVE SPACES                    TO LD25-DEB-REF-NO           
               WHEN OTHER                                                       
                    DISPLAY 'ERROR READING BP13K425: ' WS-K425-STATUS           
                            ' CODE = ' K425-CDE-DEPT                            
                    PERFORM  9999-CLOSE-ROUTINE  THRU 9999-EXIT                 
           END-EVALUATE.                                                        
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5400-READ-BP13K024.                                                      
      ******************************************************************        
                                                                                
            MOVE SPACES                                TO BP13K024-REC.         
            INITIALIZE                                    BP13K024-REC.         
                                                                                
            MOVE K022-NUM-OIC                          TO K024-NUM-OIC.         
                                                                                
            READ BP13K024.                                                      
                                                                                
            EVALUATE WS-K024-STATUS                                             
                WHEN 00                                                         
                     MOVE K024-NME-OIC                 TO LD25-CSM              
                WHEN 23                                                         
                     MOVE SPACES                       TO LD25-CSM              
                WHEN OTHER                                                      
                     DISPLAY 'ERROR READING BP13K024 : ' WS-K024-STATUS         
                             ' OIC  = ' K024-NUM-OIC                            
                     PERFORM  9999-CLOSE-ROUTINE     THRU 9999-EXIT             
            END-EVALUATE.                                                       
                                                                                
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       5500-PROCESS-DEB-REF.                                                    
      ******************************************************************        
                                                                                
            MOVE FD00-DTE-HSGNT-APPROVE  TO WS-DATE.                            
            MOVE K425-NUM-CC             TO WS-DEBT-CC.                         
            MOVE K425-NUM-YEAR           TO WS-DEBT-YY.                         
                                                                                
            IF WS-CCYY NOT = WS-DEBT-YEARS                                      
               MOVE ZEROES               TO K425-NUM-SERIAL                     
               COMPUTE WS-DEBT-SERIAL  = K425-NUM-SERIAL + 1                    
               MOVE WS-CCYY              TO WS-DEBT-YEARS                       
               MOVE WS-DEBT-CC           TO K425-NUM-CC                         
               MOVE WS-DEBT-YY           TO K425-NUM-YEAR                       
            ELSE                                                                
               COMPUTE WS-DEBT-SERIAL  = K425-NUM-SERIAL + 1                    
            END-IF.                                                             
                                                                                
            MOVE WS-DEBT-SERIAL          TO K425-NUM-SERIAL.                    
                                                                                
            MOVE K425-NUM-SERIAL         TO WS-DEBREF-ID.                       
            MOVE K425-CDE-DEPT           TO WS-DEBREF-AO.                       
            MOVE WS-DEBT-YEARS           TO WS-DEBREF-YR.                       
            MOVE WS-DEB-REF-NO           TO LD25-DEB-REF-NO.                    
                                                                                
       5500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      ******************************************************************        
       6000-PRINT-REPORT.                                                       
      ******************************************************************        
                                                                                
           PERFORM 6100-CHECK-WRITE-HEADER      THRU 6100-EXIT.                 
                                                                                
           IF WS-FIRST-WRITE = 'Y'                                              
              MOVE FD00-NUM-PROJECT               TO WS-NUM-PROJECT             
              MOVE 'N'                            TO WS-FIRST-WRITE             
           END-IF.                                                              
                                                                                
           IF FD00-NUM-PROJECT NOT = WS-NUM-PROJECT                             
              PERFORM 7000-PRINT-HEADER         THRU 7000-EXIT                  
              MOVE 0                              TO WS-SNO                     
              MOVE FD00-NUM-PROJECT               TO WS-NUM-PROJECT             
           END-IF.                                                              
                                                                                
           IF (FD00-NUM-REGN = WS-REGN-NO)                                      
               MOVE SPACES                        TO LD25-SN                    
                                                     LD25-REGN                  
           ELSE                                                                 
               ADD 1                              TO WS-SNO                     
               MOVE WS-SNO                        TO WS-SNO-ZZZZ9               
               MOVE WS-SNO-ZZZZ9                  TO LD25-SN                    
               MOVE FD00-NUM-REGN                 TO WS-REGN-NO                 
           END-IF.                                                              
                                                                                
           STRING FD00-DTE-HSGNT-APPROVE(7:2) '/'                               
                  FD00-DTE-HSGNT-APPROVE(5:2) '/'                               
                  FD00-DTE-HSGNT-APPROVE(1:4)                                   
                  DELIMITED BY SIZE INTO LD25-APPRV-DTE-2.                      
                                                                                
           PERFORM 5200-GET-CSM-NAME            THRU 5200-EXIT.                 
           PERFORM 5300-GET-DEBAR-REF-NO        THRU 5300-EXIT.                 
                                                                                
           IF (WS-CNT-P04K = 0 OR 1) AND WS-EOF-K010 = 'N'                      
               WRITE BP13LD25-REC               FROM LD25-DETAIL01              
           END-IF.                                                              
                                                                                
           IF WS-EOF-K010 = 'Y' OR WS-CNT-P04K = 0                              
              WRITE BP13LD25-REC                FROM LD25-DETAIL02              
           END-IF.                                                              
                                                                                
           IF WS-CNT-P04K > 1                                                   
              IF WS-CNT-P04K > 2                                                
                 MOVE SPACES                      TO LD25-CSM                   
              END-IF                                                            
              WRITE BP13LD25-REC                FROM LD25-DETAIL02              
           END-IF.                                                              
                                                                                
           ADD 1                                  TO WS-LINE-CTR.               
           ADD 1                                  TO WS-CNT-LD25-WRITE.         
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       6100-CHECK-WRITE-HEADER.                                                 
      ******************************************************************        
                                                                                
           IF (WS-LINE-CTR + WS-CNT-WRITE) > WS-MAX-LINE OR                     
                                             WS-FIRST-WRITE = 'Y'               
              PERFORM 7000-PRINT-HEADER      THRU 7000-EXIT                     
           END-IF.                                                              
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       7000-PRINT-HEADER.                                                       
      ******************************************************************        
                                                                                
           ADD 1                               TO WS-PAGE-CTR.                  
           MOVE ZEROES                         TO LD25-PAGE-HDR.                
           MOVE WS-PAGE-CTR                    TO LD25-PAGE-HDR.                
                                                                                
           WRITE BP13LD25-REC    FROM LD25-HEADER01 AFTER PAGE.                 
           WRITE BP13LD25-REC    FROM LD25-HEADER02.                            
           WRITE BP13LD25-REC    FROM LD25-HEADER03 AFTER 2.                    
           WRITE BP13LD25-REC    FROM LD25-HEADER04.                            
                                                                                
           INITIALIZE WS-LINE-CTR.                                              
           MOVE 5  TO WS-LINE-CTR.                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************************************************************        
       9999-CLOSE-ROUTINE.                                                      
      ******************************************************************        
                                                                                
           DISPLAY '*************** CONTROL    TOTALS ***************'.         
           DISPLAY 'PROGRAM-ID : BP13CD25'.                                     
           DISPLAY '-------------------------------------------------'.         
           DISPLAY '(1) NO OF BP13FD00 RECORDS READ............. : '            
                    WS-FD00-READ.                                               
           DISPLAY '(2) NO OF BP13K800 RECORDS NOT FOUND........ : '            
                    WS-K800-NFND.                                               
           DISPLAY '(3) NO OF BP13KD05 RECORDS NOT FOUND........ : '            
                    WS-KD05-NFND.                                               
           DISPLAY '(4) NO OF BP13FD00 RECORDS READ............. '.             
           DISPLAY '    WHERE DATE-HSGNT-APPROVE = SPACES....... : '            
                    WS-FD00-SPACE.                                              
           DISPLAY '(5) NO OF BP13FD00 RECORDS READ............. '.             
           DISPLAY '    OUTSIDE PREV WEEK DATE ............. : '                
                    WS-FD00-DATE.                                               
           DISPLAY '(6) NO OF P04K0100 RECORDS READ............  '.             
           DISPLAY '    WHERE CODES NOT FOUND..................  : '            
                    WS-P04KCODE-NFND.                                           
           DISPLAY '(7) NO OF S/N ROWS FOUND.................... : '            
                    WS-SNO.                                                     
           DISPLAY '(8) NO OF BP13LD25 RECORDS WRITTEN.......... : '            
                    WS-CNT-LD25-WRITE.                                          
           DISPLAY '(9) NO OF P04K010  RECORDS NOT FOUND ....... : '            
                    WS-CNT-LD25-WRITE.                                          
                                                                                
           CLOSE    BP13FD00                                                    
                    SY02F001                                                    
                    P04K010                                                     
                    BP13K800                                                    
                    BP13KD05                                                    
                    BM06K110                                                    
                    BP13K022                                                    
                    BP13K024                                                    
                    BP13K425                                                    
                    BP13LD25.                                                   
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 - ERROR CLOSING : ' WS-K800-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 - ERROR CLOSING : ' WS-K110-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-KD05-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13KD05 - ERROR CLOSING : ' WS-KD05-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K010-STATUS NOT = 00 AND 97                                    
              DISPLAY 'P04K010  - ERROR CLOSING : ' WS-K010-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K022 - ERROR CLOSING : ' WS-K022-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K024-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K024 - ERROR CLOSING : ' WS-K024-STATUS              
           END-IF.                                                              
                                                                                
           IF WS-K425-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K425 - ERROR CLOSING : ' WS-K425-STATUS              
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
