       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C49S.                                                 
      *AUTHOR.        KAVYA VAKA.                                               
      *DATE-WRITTEN.  SEP 21 2020.                                              
      * ============================================================            
      * SYSTEM OF COMMITMENT (SOC)                                              
      * ============================================================            
      * OBJECTIVE  - PRINT LETTERS ON NOTIFICATION OF                           
      *              REVISED COMPLETION DATE.                                   
      *                                                                         
      * FORM USED  BP13T1                                                       
      *                                                                         
      * INPUT FILES:  BM06F110                                                  
      *               BP13K022                                                  
      *               BP13K024                                                  
      *               BP13K800                                                  
      *               BP13K820                                                  
      *               BP13K830                                                  
      *               BM06K100                                                  
      *               BM06K510                                                  
      *               BP13K857                                                  
      *        I-O    BP13K491                                                  
      *               BP13F491                                                  
      * REPORT:       BP13L49J                                                  
      *               BP13P491                                                  
      * ------------------------------------------------------------            
      * REF NO    DATE  BY  DESCRIPTIONS                                        
      * -------- ------ --- ------------                                        
      * BP138634 210421 zar7 NEW PGM                                            
      * BP138678 260421 zar7 PRINT THE HEADER                                   
      * BP138678 260421 zar7 removed hardcode value                             
      * BP138678 260421 zar7 CALL BP13C913                                      
      * ============================================================            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13K022  ASSIGN       TO BP13K022                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K022-KEY-FLD                        
                            ALTERNATE RECORD KEY IS K022-NUM-REGN               
                            WITH DUPLICATES                                     
                            FILE STATUS  IS K022-STATUS.                        
                                                                                
           SELECT BP13K024  ASSIGN       TO BP13K024                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K024-KEY-FLD                        
                            FILE STATUS  IS K024-STATUS.                        
                                                                                
           SELECT BP13K800 ASSIGN        TO BP13K800                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K800-NUM-REGN                       
                           FILE STATUS   IS K800-STATUS.                        
                                                                                
           SELECT BP13K820 ASSIGN        TO BP13K820                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K820-KEY-FLD                        
                           FILE STATUS   IS K820-STATUS.                        
                                                                                
           SELECT BP13K830 ASSIGN        TO BP13K830                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K830-KEY-FLD                        
                           ALTERNATE KEY IS K830-NUM-REGN                       
                           FILE STATUS   IS K830-STATUS.                        
                                                                                
           SELECT BP13K857 ASSIGN        TO BP13K857                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K857-KEY-FLD                        
                           FILE STATUS   IS K857-STATUS.                        
           SELECT BM06K510 ASSIGN        TO BM06K510                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K510-ESTCDE                         
                           FILE STATUS   IS K510-STATUS.                        
                                                                                
           SELECT BP13K491 ASSIGN       TO BP13K491                             
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K491-KEY-FLD                        
                           FILE STATUS   IS K491-STATUS.                        
                                                                                
           SELECT BM06K100 ASSIGN        TO BM06K100                            
                           ORGANIZATION  IS INDEXED                             
                           ACCESS MODE   IS RANDOM                              
                           RECORD KEY    IS K100-KEY-FLD                        
                           FILE STATUS   IS K100-STATUS.                        
                                                                                
           SELECT BP13F491 ASSIGN       TO BP13F491.                            
           SELECT BP13L49J ASSIGN       TO BP13L49J.                            
           SELECT BP13P491 ASSIGN       TO BP13P491.                            
           SELECT BM06F110 ASSIGN       TO BM06F110.                            
           SELECT BP13INP1 ASSIGN       TO BP13INP1.                            
                                                                                
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K024                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K024.                                                           
                                                                                
       FD   BP13K800                                                            
            RECORD CONTAINS 2000 CHARACTERS.                                    
       COPY BP13K800.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   BP13K857                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K857.                                                           
                                                                                
       FD   BP13K491                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K491.                                                           
                                                                                
       FD   BM06K510                                                            
            RECORD CONTAINS 60 CHARACTERS.                                      
       COPY BM06K510.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BM06K100.                                                           
                                                                                
       FD   BM06F110                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 500 CHARACTERS                                      
            BLOCK  CONTAINS 0   RECORDS.                                        
       COPY BM06F110.                                                           
                                                                                
       FD   BP13F491                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 200 CHARACTERS                                      
            BLOCK  CONTAINS 0   RECORDS.                                        
       COPY BP13F491.                                                           
                                                                                
       FD   BP13INP1                                                            
            RECORDING MODE IS F                                                 
            RECORD CONTAINS 100 CHARACTERS                                      
            BLOCK  CONTAINS 0   RECORDS.                                        
       01   INP1-REC.                                                           
             05 INP1-EST-NEIG-CON PIC X(16).                                    
             05 INP1-PROJ-NAME    PIC X(40).                                    
             05 INP1-PCD-REV      PIC X(18).                                    
             05 INP1-DELAY-MONS   PIC X(02).                                    
             05 INP1-FILLER       PIC X(24).                                    
                                                                                
       FD   BP13L49J           RECORDING MODE IS F                              
                               RECORD CONTAINS 132 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   L49J-PRTREC        PIC X(132).                                      
                                                                                
       FD   BP13P491           RECORDING MODE IS F                              
                               RECORD CONTAINS 100 CHARACTERS                   
                               BLOCK  CONTAINS 0   RECORDS.                     
       01   P491-PRTREC        PIC X(100).                                      
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  K022-STATUS                   PIC 99    VALUE 0.                     
       01  K024-STATUS                   PIC 99    VALUE 0.                     
       01  K800-STATUS                   PIC 99    VALUE 0.                     
       01  K820-STATUS                   PIC 99    VALUE 0.                     
       01  K830-STATUS                   PIC 99    VALUE 0.                     
       01  K510-STATUS                   PIC 99    VALUE 0.                     
       01  K100-STATUS                   PIC 99    VALUE 0.                     
       01  K857-STATUS                   PIC 99    VALUE 0.                     
       01  K491-STATUS                   PIC 99    VALUE 0.                     
       01  WS-F110-EOF                   PIC X     VALUE 'N'.                   
       01  WS-F491-EOF                   PIC X     VALUE 'N'.                   
       01  WS-INP1-EOF                   PIC X     VALUE 'N'.                   
       01  WS-FOUND-K857                 PIC X     VALUE 'N'.                   
       01  WS-F491-FND                   PIC X     VALUE 'N'.                   
       01  WS-INP1-FND                   PIC X     VALUE 'N'.                   
       01  WS-FOUND-K491                 PIC X     VALUE 'N'.                   
                                                                                
       01  WS-OCCUPANTS.                                                        
           05  WS-NAME      OCCURS 4 TIMES   PIC X(66).                         
                                                                                
       01  WS-DATE                       PIC X(8)  VALUE SPACES.                
       01  WS-MONTH                      PIC X(3)  VALUE SPACES.                
       01  WS-QUARTER                    PIC X(11) VALUE SPACES.                
       01  WS-YEAR                       PIC 9(4).                              
       01  WS-NAME-EMAIL                 PIC X(66).                             
                                                                                
       01  WS-PREV-BLK-NO                PIC X(5).                              
       01  WS-OCCP-PTR                   PIC 9(2).                              
       01  WS-SQL-CODE                   PIC 9(4).                              
                                                                                
       01  WS-STOP                       PIC X(1)  VALUE SPACES.                
       01  WS-PROCESS                    PIC X(1)  VALUE SPACES.                
       01  WS-TEMP-PCD                   PIC X(15) VALUE SPACES.                
       01  WS-TEMP-PCD-A                 PIC X(15) VALUE SPACES.                
       01  WS-HP                         PIC X(08) VALUE SPACES.                
       01  WS-A                          PIC 9(02) VALUE ZEROS.                 
       01  WS-B                          PIC 9(02) VALUE ZEROS.                 
       01  WS-C                          PIC 9(02) VALUE ZEROS.                 
       01  WS-D                          PIC 9(02) VALUE ZEROS.                 
       01  WS-BP13C913                   PIC X(08) VALUE 'BP13C913'.            
                                                                                
       01  WS-CL49J-HEADER               PIC X(132) VALUE SPACES.               
       01  WS-DTE-TME.                                                          
           05 WS-DTE                     PIC X(08) VALUE SPACES.                
       01  WS-COUNTERS.                                                         
           05 WS-CNT-F110-READ           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-LETTER              PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K800-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K820-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K830-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K510-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K100-MISS           PIC 9(7)  VALUE 0.                     
           05 WS-CNT-K857-W-EMAIL        PIC 9(7)  VALUE 0.                     
           05 WS-CNTR                    PIC X(1)  VALUE 'N'.                   
           05 WS-IDX                     PIC 9(2)  VALUE 0.                     
           05 WS-CNT                     PIC 9(2)  VALUE 0.                     
           05 CTR                        PIC 9(2)  VALUE 0.                     
           05 WS-BLK-CNT                 PIC 9(7)  VALUE 0.                     
           05 WS-TOTAL-CNT               PIC 9(7)  VALUE 0.                     
           05 WS-TOTAL-CNT-A             PIC 9(7)  VALUE 0.                     
           05 WS-LINE-CNT                PIC 9(7)  VALUE 0.                     
           05 WS-PAGE-CNT                PIC 9(7)  VALUE 0.                     
           05 WS-LINE-CNT-A              PIC 9(7)  VALUE 0.                     
           05 WS-PAGE-CNT-A              PIC 9(7)  VALUE 0.                     
           05 WS-F491-WRT                PIC 9(7)  VALUE 0.                     
           05 WS-F491-REWRITE            PIC 9(7)  VALUE 0.                     
           05 WS-L49J-WRT                PIC 9(7)  VALUE 0.                     
           05 WS-P491-WRT                PIC 9(7)  VALUE 0.                     
           05 WS-F859-WRT                PIC 9(7)  VALUE 0.                     
           05 WS-BP13FY-CTR              PIC 9(6)  VALUE ZEROS.                 
           05 WS-RECORD-CNT              PIC ZZZ9.                              
                                                                                
           05 WS-ERROR-FL                PIC X(1) VALUE 'N'.                    
              88 WS-NO-ERROR             VALUE 'N'.                             
              88 WS-ERROR                VALUE 'Y'.                             
                                                                                
       01  WS-TEMP-INP1.                                                        
             05 TEMP-PROJ-NAME    PIC X(40).                                    
             05 TEMP-PCD-REV      PIC X(18).                                    
             05 TEMP-DELAY-MONS   PIC X(02).                                    
                                                                                
       01  WS-TEMP-MONTH                 PIC X(45) VALUE SPACES.                
       01  WS-TEMP-SPACE                 PIC X(22) VALUE                        
                                         'Update on Progress of '.              
       01  WS-TEMP-SPACE1                PIC X(04) VALUE SPACES.                
       01  WS-TEMP-SPACE3                PIC X(13) VALUE SPACES.                
       01  WS-TEMP-ADDRESS1              PIC X(85) VALUE SPACES.                
       01  WS-TEMP-ADDRESS2              PIC X(85) VALUE SPACES.                
       01  WS-TEMP-ADDRESS3              PIC X(85) VALUE SPACES.                
       01  WS-MONTHS-IN-DIGITS-AND-WORDS.                                       
           05 FILLER                   PIC X(06) VALUE                          
             '01 JAN'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '02 FEB'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '03 MAR'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '04 APR'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '05 MAY'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '06 JUN'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '07 JUL'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '08 AUG'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '09 SEP'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '10 OCT'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '11 NOV'.                                                          
           05 FILLER                   PIC X(06) VALUE                          
             '12 DEC'.                                                          
       01  FILLER  REDEFINES  WS-MONTHS-IN-DIGITS-AND-WORDS.                    
           05 WS-MONTH-TABLE               OCCURS 12                            
                                           INDEXED BY WS-MTH-IND.               
              10 WS-MONTH-IN-DIGITS    PIC X(02).                               
              10 FILLER                PIC X(01).                               
              10 WS-MONTH-IN-WORDS     PIC X(03).                               
                                                                                
                                                                                
       01 WS-REPORT-FIELDS.                                                     
           05  WS-DATE-RPT-DTL.                                                 
               10 FILLER                PIC X(6)  VALUE 'DATE: '.               
               10 WS-DATE-RPT           PIC X(10) VALUE SPACES.                 
           05  WS-MAIL-RPT1             PIC X(12) VALUE 'HELO SGPHDB1'.         
           05  WS-MAIL-RPT2             PIC X(27)                               
               VALUE 'MAIL FROM:<OPCP@SGPHDB1>'.                                
           05  WS-MAIL-RPT18.                                                   
               10 WS-ADDR-RPT           PIC X(98).                              
                                                                                
      *=======================================================*                 
      *    LINKAGE VARIABLES                                  *                 
      *=======================================================*                 
       01   WS-LINK-REC.                                                        
            05 WS-LINK-NUM-SCH            PIC X(4).                             
            05 WS-LINK-NUM-ACC            PIC X(4).                             
            05 WS-LINK-NUM-CHK            PIC X(1).                             
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      *-------------------------------------------------------------            
      *    LETTER LAYOUT                                                        
      *-------------------------------------------------------------            
       01  P491-LINE01.                                                         
           05 FILLER                     PIC X(63) VALUE SPACES.                
           05 P491-REGN-NO               PIC X(8)  VALUE SPACES.                
                                                                                
       01  P491-LINE02.                                                         
           05 FILLER                     PIC X(63) VALUE SPACES.                
           05 P491-DATE                  PIC X(10) VALUE SPACES.                
                                                                                
       01  P491-LINE03.                                                         
           05 FILLER                     PIC X(74) VALUE SPACES.                
           05 P491-OIC-TEL               PIC X(8)  VALUE SPACES.                
                                                                                
       01  P491-LINE04.                                                         
           05 FILLER                     PIC X(04)  VALUE SPACES.               
           05 P491-NAME1                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04B.                                                        
           05 FILLER                     PIC X(04)  VALUE SPACES.               
           05 P491-NAME2                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04C.                                                        
           05 FILLER                     PIC X(04)  VALUE SPACES.               
           05 P491-NAME3                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE04D.                                                        
           05 FILLER                     PIC X(04)  VALUE SPACES.               
           05 P491-NAME4                 PIC X(66)  VALUE SPACES.               
                                                                                
       01  P491-LINE05.                                                         
           05 FILLER                     PIC X(04)  VALUE SPACES.               
           05 P491-BLK                   PIC X(10)  VALUE SPACES.               
           05 FILLER                     PIC X(2)   VALUE SPACES.               
           05 P491-FLAT-NO.                                                     
              15  P491-CHAR              PIC X      VALUE SPACE.                
              15  P491-LEVEL             PIC X(2)   VALUE SPACES.               
              15  P491-DASH              PIC X      VALUE SPACE.                
              15  P491-HSE-MAIN          PIC X(4)   VALUE SPACES.               
              15  P491-HSE-SUB           PIC X(3)   VALUE SPACES.               
                                                                                
       01  P491-LINE05B.                                                        
           05 FILLER                     PIC X(04) VALUE SPACES.                
           05 P491-STREET                PIC X(32) VALUE SPACES.                
                                                                                
       01  P491-LINE05C.                                                        
           05 FILLER                     PIC X(04) VALUE SPACES.                
           05 FILLER                     PIC X(9)  VALUE 'SINGAPORE'.           
           05 FILLER                     PIC X(1)  VALUE SPACES.                
           05 P491-POSTAL                PIC X(6)  VALUE SPACES.                
                                                                                
       01  PECD-LINE06.                                                         
           05  FILLER                    PIC X(04) VALUE SPACES.                
           05  PECD-BAR-CODE             PIC X(09) VALUE SPACES.                
                                                                                
       01  PECD-LINE07.                                                         
           05 FILLER                     PIC X(20) VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE 'BLK'.                 
           05 P491-UNIT-BLK              PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 P491-UNIT-FLAT-NO.                                                
              10 FILLER                  PIC X     VALUE '#'.                   
              10 P491-UNIT-LVL-NO        PIC X(2)  VALUE SPACES.                
              10 FILLER                  PIC X     VALUE '-'.                   
              10 P491-UNIT-UNIT-NO       PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 P491-UNIT-STREET-POSTAL    PIC X(50) VALUE SPACES.                
                                                                                
       01  P491-LINE07A.                                                        
           05 FILLER                     PIC X(3)  VALUE SPACES.                
           05 P491-POSTAL1               PIC X(6)  VALUE SPACES.                
                                                                                
       01  PECD-LINE07B.                                                        
           05 FILLER                     PIC X(02) VALUE SPACES.                
           05 P491-PROJ-NAME             PIC X(40) VALUE SPACES.                
                                                                                
       01  PECD-LINE08A.                                                        
           05 FILLER                     PIC X(29) VALUE SPACES.                
           05 P491-DTE-COMPLT-MM         PIC X(03) VALUE SPACES.                
           05 FILLER                     PIC X(01) VALUE SPACES.                
           05 P491-DTE-COMPLT-YR         PIC X(05) VALUE SPACES.                
                                                                                
       01  PECD-LINE9.                                                          
           05 FILLER                     PIC X(22) VALUE SPACES.                
           05 P491-MAIL                  PIC X(67) VALUE                        
           '<https://services2.hdb.gov.sg/webapp/SX05AWSPCP/SX05PSPCPLog        
      -        'in.jsp>'.                                                       
                                                                                
       01  PECD-LINE09A.                                                        
           05 FILLER                     PIC X(04) VALUE SPACES.                
           05 P491-PROJ-NAME-9A          PIC X(35) VALUE SPACES.                
           05 FILLER                     PIC X(03) VALUE SPACES.                
           05 P491-PCD-REV               PIC X(18) VALUE SPACES.                
           05 FILLER                     PIC X(14) VALUE SPACES.                
           05 P491-ORIG-PCD              PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-LINE09C.                                                        
           05 FILLER                     PIC X(19) VALUE SPACES.                
           05 P491-DELAY-MONS            PIC X(02) VALUE SPACES.                
                                                                                
       01  PECD-LINE10.                                                         
           05 FILLER                     PIC X(52) VALUE SPACES.                
           05 P491-NEW-PCD               PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-LINE10A.                                                        
           05 FILLER                     PIC X(47) VALUE SPACES.                
           05 FILLER                     PIC X(12) VALUE SPACES.                
           05 P491-NEW-PCDA              PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-LINE10Q.                                                        
           05 FILLER                     PIC X(29) VALUE SPACES.                
           05 P491-NEW-PCDQ              PIC X(16) VALUE SPACES.                
                                                                                
       01  PECD-NOTE-LINE10A.                                                   
           05 FILLER                     PIC X(23) VALUE SPACES.                
           05 FILLER                     PIC X(73) VALUE SPACES.                
           05 P491-NOTEA-PCD             PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-NOTE-LINE10B.                                                   
           05 FILLER                     PIC X(49) VALUE SPACES.                
           05 FILLER                     PIC X(10) VALUE SPACES.                
           05 P491-NOTEB-PCD             PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-NOTE-LINE10C.                                                   
           05 FILLER                     PIC X(23) VALUE SPACES.                
           05 FILLER                     PIC X(57) VALUE SPACES.                
           05 P491-NOTEC-PCD             PIC X(18) VALUE SPACES.                
                                                                                
       01  PECD-NOTE-LINE10D.                                                   
           05 FILLER                     PIC X(29) VALUE SPACES.                
           05 P491-NOTED-PCD             PIC X(16) VALUE SPACES.                
                                                                                
                                                                                
       01  PECD-FT-OIC.                                                         
           05 FILLER                     PIC X(10) VALUE SPACES.                
           05 P491-NME-OIC               PIC X(30) VALUE SPACES.                
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT                                                        
      *-------------------------------------------------------------            
       01  L49J-HDR01.                                                          
           05 FILLER                     PIC X(14) VALUE 'BP13L49J'.            
           05 FILLER                     PIC X(30) VALUE 'HDB3'.                
           05 FILLER                     PIC X(42) VALUE                        
             'S Y S T E M   O F   C O M M I T M E N T'.                         
           05 FILLER                     PIC X(13) VALUE SPACES.                
           05 FILLER                     PIC X(7)  VALUE 'DATE: '.              
           05 L49J-DATE                  PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X(10) VALUE '   PAGE: '.           
           05 L49J-PAGE                  PIC ZZZZ9.                             
                                                                                
       01  L49J-HDR02.                                                          
           05 FILLER                     PIC X(40) VALUE SPACES.                
           05 FILLER                     PIC X(80) VALUE                        
             'LETTERS PRINTED FOR NOTIFICATION OF NEW PCD DATE'.                
                                                                                
       01  L49J-HDR03.                                                          
           05 FILLER                     PIC X(10) VALUE '  BLOCK: '.           
           05 L49J-BLOCK                 PIC X(5)  VALUE SPACES.                
           05 FILLER                     PIC X(4)  VALUE SPACES.                
           05 L49J-STREET-NAME           PIC X(32) VALUE SPACES.                
                                                                                
       01  L49J-HDR04.                                                          
           05 FILLER                     PIC X(9)  VALUE '   NO.   '.           
           05 FILLER                     PIC X(14) VALUE 'SCH-ACC NO'.          
           05 FILLER                     PIC X(10) VALUE '  REGN NO.'.          
           05 FILLER                     PIC X(34)                              
                    VALUE '  NAME(TRUNCATED) '.                                 
           05 FILLER                     PIC X(10) VALUE '  NRIC NO.'.          
           05 FILLER                     PIC X(7)  VALUE '  BLK '.              
           05 FILLER                     PIC X(26)                              
                    VALUE '      MAIL STREET NAME'.                             
           05 FILLER                     PIC X(10) VALUE '  FLAT NO.'.          
           05 FILLER                     PIC X(8)  VALUE '  PC'.                
                                                                                
       01  L49J-DETAIL.                                                         
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-NO                    PIC ZZZZ9.                             
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-SCH-ACC               PIC X(14) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-REGN-NO               PIC X(8)  VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-NAME                  PIC X(32) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-NRIC-NO               PIC X(9)  VALUE SPACES.                
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L49J-BLK-NO                PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X     VALUE SPACES.                
           05 L49J-STREET                PIC X(20) VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-FLAT-NO.                                                     
              10 FILLER                  PIC X     VALUE '#'.                   
              10 L49J-LVL-NO             PIC X(2)  VALUE SPACES.                
              10 FILLER                  PIC X     VALUE '-'.                   
              10 L49J-UNIT-NO            PIC X(4)  VALUE SPACES.                
           05 FILLER                     PIC X(2)  VALUE SPACES.                
           05 L49J-pOSTAL-CODE           PIC X(6)  VALUE SPACES.                
                                                                                
       01  L49J-PRT-TOTAL.                                                      
           05 FILLER                     PIC X(10) VALUE SPACES.                
           05 FILLER                     PIC X(30)                              
              VALUE 'TOTAL NUMBER OF LETTERS: '.                                
           05 L49J-TOTAL                 PIC Z,ZZZ,ZZ9.                         
                                                                                
      *------------------------------------------------------------*            
      *  DJDE LINE                                                 *            
      *------------------------------------------------------------*            
                                                                                
       01  DJDE-LINE-FY-PAGE1             PIC X(80)  VALUE                      
           '$DJDE$ JDE=13POT9,JDL=BP13,FORMS=BP137Z,NUMBER=(0000,29,65,3        
      -    '),DUPLEX=NO,END;'.                                                  
       01  DJDE-LINE-FX-PAGE2             PIC X(80)  VALUE                      
           '$DJDE$ FORMS=BP137Z,END;'.                                          
                                                                                
      *-------------------------------------------------------------            
      *    REPORT LAYOUT FOR LETTERS TO BE EMAILED                              
      *-------------------------------------------------------------            
      *-------------------------------------------------------------            
      *-------------------------------------------------------------            
      *  LINKAGE FOR BP13CB4A                                                   
      *-------------------------------------------------------------            
                                                                                
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-CONTROL.                                                            
      *-------------------------------------------------------------            
           PERFORM 1000-START-UP         THRU 1000-EXIT.                        
           PERFORM 2000-MAIN-ROUTINE     THRU 2000-EXIT                         
                   UNTIL WS-F110-EOF = 'Y'.                                     
           PERFORM 9999-WRAP-UP.                                                
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       1000-START-UP.                                                           
      *-------------------------------------------------------------            
            OPEN INPUT  BP13K022                                                
                        BP13K024                                                
                        BP13K800                                                
                        BP13K820                                                
                        BP13K830                                                
                        BM06K510                                                
                        BM06K100                                                
                        BM06F110                                                
                        BP13K857                                                
                        BP13INP1                                                
                OUTPUT  BP13L49J                                                
                        BP13P491                                                
                   I-O  BP13K491                                                
                        BP13F491.                                               
                                                                                
            IF K491-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K491,STATUS ' K491-STATUS           
               MOVE K491-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K022-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K022,STATUS ' K022-STATUS           
               MOVE K022-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K024-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K024,STATUS ' K024-STATUS           
               MOVE K024-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K800-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K800,STATUS ' K800-STATUS           
               MOVE K800-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K820-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K820,STATUS ' K820-STATUS           
               MOVE K820-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K830-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K830,STATUS ' K830-STATUS           
               MOVE K830-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K510-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BM06K510,STATUS ' K510-STATUS           
               MOVE K510-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K100-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BM06K100,STATUS ' K100-STATUS           
               MOVE K100-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            IF K857-STATUS NOT = 00 AND 97                                      
               DISPLAY 'OPEN FAILED FOR BP13K857,STATUS ' K857-STATUS           
               MOVE K857-STATUS TO RETURN-CODE                                  
               PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                         
            END-IF.                                                             
                                                                                
            READ BM06F110                                                       
                 AT END                                                         
                         MOVE 'Y'          TO WS-F110-EOF                       
                         GO TO 1000-EXIT                                        
                 NOT AT END                                                     
                  IF F110-REGN-NO(1:2) = '##'                                   
                     READ BM06F110                                              
                          AT END                                                
                                  MOVE 'Y'          TO WS-F110-EOF              
                                  GO TO 1000-EXIT                               
                  END-IF                                                        
            END-READ.                                                           
                                                                                
            MOVE 60                  TO WS-LINE-CNT.                            
            MOVE 60                  TO WS-LINE-CNT-A.                          
            ADD  1                   TO WS-CNT-F110-READ.                       
            MOVE F110-BLK-NO         TO WS-PREV-BLK-NO.                         
                                                                                
            MOVE FUNCTION CURRENT-DATE TO WS-DATE.                              
                                                                                
      *     STRING 'W-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
      *            DELIMITED BY SIZE INTO P491-DATE.                            
            MOVE '23/04/2021'   TO  P491-DATE.                                  
                                                                                
            STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
                   DELIMITED BY SIZE INTO L49J-DATE.                            
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2000-MAIN-ROUTINE.                                                       
      *-------------------------------------------------------------            
                                                                                
           IF F110-REGN-NO(1:2) = '##'                                          
              READ BM06F110 AT END                                              
                   MOVE 'Y' TO WS-F110-EOF                                      
                   GO TO 2000-EXIT                                              
                   NOT AT END                                                   
                   IF F110-REGN-NO(1:2) = '##'                                  
                      GO TO 2000-EXIT                                           
                   END-IF                                                       
           END-IF                                                               
                                                                                
           SET WS-NO-ERROR           TO TRUE.                                   
           INITIALIZE  WS-OCCUPANTS.                                            
           INITIALIZE  WS-NAME-EMAIL.                                           
           MOVE SPACES                   TO  BP13K491-REC BP13F491-REC          
                                             WS-F491-EOF WS-F491-FND.           
           INITIALIZE                        BP13K491-REC BP13F491-REC.         
                                                                                
      *-------------------------------------------------------------*           
      * READS BM06F110 AND PROCESS EACH RECORD UNTIL END OF FILE    *           
      *-------------------------------------------------------------*           
                                                                                
           MOVE 'N'     TO WS-PROCESS WS-FOUND-K857.                            
           MOVE SPACES  TO WS-HP.                                               
                                                                                
           MOVE SPACES                     TO BP13K491-REC.                     
           PERFORM 3003-READ-K491   THRU 3003-EXIT.                             
      *    IF WS-F491-FND = 'Y' OR WS-PROCESS = 'N'                             
              CLOSE BP13F491                                                    
              OPEN I-O BP13F491                                                 
      *    END-IF                                                               
           PERFORM 3004-READ-F491   THRU 3004-EXIT                              
             UNTIL WS-F491-EOF = 'Y' OR WS-F491-FND = 'Y'                       
           IF WS-F491-EOF = 'Y' AND WS-F491-FND = 'N'                           
              CLOSE BP13F491                                                    
              OPEN EXTEND BP13F491                                              
           END-IF                                                               
                                                                                
      ***NEW FLAT FILE                                                          
           MOVE SPACES    TO WS-INP1-EOF                                        
                             WS-INP1-FND.                                       
              CLOSE BP13INP1                                                    
              OPEN INPUT BP13INP1                                               
           PERFORM 3007-READ-INP1   THRU 3007-EXIT                              
             UNTIL WS-INP1-EOF = 'Y' OR WS-INP1-FND = 'Y'                       
           IF WS-INP1-FND = 'Y'                                                 
              MOVE INP1-PROJ-NAME  TO TEMP-PROJ-NAME                            
              MOVE INP1-PCD-REV    TO TEMP-PCD-REV                              
              MOVE INP1-DELAY-MONS TO TEMP-DELAY-MONS                           
           ELSE                                                                 
              MOVE SPACES          TO TEMP-PROJ-NAME                            
                                      TEMP-PCD-REV                              
                                      TEMP-DELAY-MONS                           
                                                                                
           END-IF.                                                              
           IF WS-INP1-EOF = 'Y' AND WS-INP1-FND = 'N'                           
              CLOSE BP13INP1                                                    
              OPEN  EXTEND BP13INP1                                             
           END-IF.                                                              
                                                                                
           PERFORM 2100-RETRIEVE-DATA   THRU 2100-EXIT.                         
           PERFORM 3000-FORMAT-LETTER   THRU 3000-EXIT                          
           PERFORM 4000-READ-K857       THRU 4000-EXIT                          
             IF WS-FOUND-K857 = 'Y'                                             
                IF K857-NUM-EMAIL NOT = SPACES AND LOW-VALUES                   
                 ADD 1 TO WS-CNT-K857-W-EMAIL                                   
                 IF WS-FOUND-K491 = 'N'                                         
                    PERFORM 3001-FORMAT-EMAIL    THRU 3001-EXIT                 
                 ELSE                                                           
                    PERFORM 3002-FORMAT-EMAIL    THRU 3002-EXIT                 
                 END-IF                                                         
                 IF WS-F491-FND = 'N'                                           
                    PERFORM 3005-FORMAT-EMAIL    THRU 3005-EXIT                 
                 ELSE                                                           
                    PERFORM 3006-FORMAT-EMAIL    THRU 3006-EXIT                 
                 END-IF                                                         
                 MOVE 'Y' TO WS-PROCESS                                         
                END-IF                                                          
             END-IF                                                             
             IF WS-PROCESS NOT = 'Y'                                            
                 IF K100-NUM-PACD = 'M' OR K100-NUM-PACD = 'Q'                  
                    PERFORM 3100-PRINT-LETTER THRU 3100-EXIT                    
                 END-IF                                                         
               PERFORM 3200-PRINT-AUDIT     THRU 3200-EXIT                      
             END-IF.                                                            
                                                                                
           READ BM06F110 AT END                                                 
                MOVE 'Y' TO WS-F110-EOF                                         
                GO TO 2000-EXIT                                                 
                 NOT AT END                                                     
                  IF F110-REGN-NO(1:2) = '##'                                   
                     READ BM06F110 AT END                                       
                          MOVE 'Y' TO WS-F110-EOF                               
                          GO TO 2000-EXIT                                       
                  END-IF                                                        
                END-READ.                                                       
                                                                                
           ADD  1                          TO WS-CNT-F110-READ.                 
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2100-RETRIEVE-DATA.                                                      
      *-------------------------------------------------------------            
           MOVE F110-REGN-NO               TO K800-NUM-REGN.                    
           MOVE SPACES                     TO WS-TEMP-PCD                       
                                              WS-TEMP-PCD-A.                    
           PERFORM 8100-READ-K800          THRU 8100-EXIT.                      
           IF WS-NO-ERROR                                                       
              PERFORM 2200-GET-NRIC-NAMES  THRU 2200-EXIT                       
              PERFORM 2300-GET-NRIC-ADDR   THRU 2300-EXIT                       
              PERFORM 2400-GET-BLK-ADDRESS THRU 2400-EXIT                       
              PERFORM 2500-GET-NEWTOWN     THRU 2500-EXIT                       
              PERFORM 2600-GET-PCD         THRU 2600-EXIT                       
           END-IF                                                               
                                                                                
           .                                                                    
       2100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2200-GET-NRIC-NAMES.                                                     
      *-------------------------------------------------------------            
           MOVE  4                         TO   WS-OCCP-PTR.                    
           MOVE SPACES                     TO   WS-NAME-EMAIL.                  
           IF K800-NUM-NRIC4 NOT = SPACES                                       
              MOVE SPACES                  TO   BP13K820-REC                    
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC4          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
              MOVE K820-NUM-HP-PGR         TO   WS-HP                           
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC3 NOT = SPACES AND WS-NO-ERROR                       
              MOVE SPACES                  TO   BP13K820-REC                    
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC3          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
              IF K820-NUM-HP-PGR NOT = SPACES AND LOW-VALUES                    
                 MOVE K820-NUM-HP-PGR         TO   WS-HP                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC2 NOT = SPACES AND WS-NO-ERROR                       
              MOVE SPACES                  TO   BP13K820-REC                    
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC2          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
              SUBTRACT   1                 FROM WS-OCCP-PTR                     
              IF K820-NUM-HP-PGR NOT = SPACES AND LOW-VALUES                    
                 MOVE K820-NUM-HP-PGR         TO   WS-HP                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF K800-NUM-NRIC1 NOT = SPACES AND WS-NO-ERROR                       
              MOVE SPACES                  TO   BP13K820-REC                    
              MOVE K800-NUM-REGN           TO   K820-NUM-REGN                   
              MOVE K800-NUM-NRIC1          TO   K820-NUM-NRIC                   
              PERFORM 8200-READ-K820       THRU 8200-EXIT                       
              MOVE K820-NME-OCCP           TO   WS-NAME(WS-OCCP-PTR)            
                                                WS-NAME-EMAIL                   
              MOVE K820-NUM-HP-PGR         TO   WS-HP                           
              IF K820-NUM-HP-PGR NOT = SPACES AND LOW-VALUES                    
                 MOVE K820-NUM-HP-PGR         TO   WS-HP                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       2200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2300-GET-NRIC-ADDR.                                                      
      *------------------------------------------------------                   
                                                                                
           MOVE F110-REGN-NO               TO  K830-NUM-REGN.                   
           PERFORM 8300-READ-K830          THRU 8300-EXIT.                      
                                                                                
       2300-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2400-GET-BLK-ADDRESS.                                                    
      *------------------------------------------------------                   
           MOVE SPACES           TO BP13COMM8-REC.                              
           MOVE K800-NUM-SCH     TO WS-LINK-NUM-SCH.                            
           MOVE K800-NUM-ACC     TO WS-LINK-NUM-ACC.                            
           MOVE K800-NUM-ACC-CK  TO WS-LINK-NUM-CHK.                            
                                                                                
           CALL WS-BP13C913 USING                                               
                 WS-LINK-REC, BP13COMM8-REC                                     
           END-CALL.                                                            
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0                                          
              MOVE COMM8-CDE-SYSERR  TO WS-SQL-CODE                             
              IF COMM8-CDE-SYSERR = 100                                         
                 DISPLAY 'SCH-ACC NOT FOUND IN PBF TABLE' WS-SQL-CODE           
              ELSE                                                              
                 DISPLAY 'ERROR READING PBF TABLE' WS-SQL-CODE                  
              END-IF                                                            
              MOVE SPACES        TO BP13COMM8-REC                               
              SET WS-ERROR       TO TRUE                                        
           END-IF.                                                              
                                                                                
       2400-EXIT.                                                               
            EXIT.                                                               
                                                                                
       2500-GET-NEWTOWN.                                                        
      *------------------------------------------------------                   
                                                                                
            MOVE F110-ESTATE        TO   K510-ESTCDE.                           
            PERFORM 8400-READ-K510  THRU 8400-EXIT.                             
                                                                                
       2500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2600-GET-PCD.                                                            
      *------------------------------------------------------                   
                                                                                
           MOVE F110-AIX1          TO   K100-KEY-FLD.                           
           PERFORM 8500-READ-K100  THRU 8500-EXIT.                              
                                                                                
           IF K100-NUM-PACD = 'M'                                               
              PERFORM 2700-MONTHLY-PACD   THRU 2700-EXIT                        
           ELSE                                                                 
             IF K100-NUM-PACD = 'Q'                                             
                PERFORM 2800-QUARTERLY-PACD   THRU 2800-EXIT                    
             END-IF                                                             
           END-IF.                                                              
                                                                                
       2600-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2700-MONTHLY-PACD.                                                       
      *------------------------------------------------------                   
           SET WS-MTH-IND TO 1.                                                 
                                                                                
           SEARCH WS-MONTH-TABLE                                                
               AT END                                                           
               MOVE '   ' TO WS-MONTH                                           
            WHEN WS-MONTH-IN-DIGITS(WS-MTH-IND) = K100-DTE-PACD-QTR(5:2)        
               MOVE WS-MONTH-IN-WORDS(WS-MTH-IND) TO WS-MONTH                   
           END-SEARCH.                                                          
                                                                                
           MOVE K100-DTE-PACD-QTR(1:4)       TO WS-YEAR.                        
                                                                                
           IF (F110-ESTATE = '201' AND                                          
              F110-NEIGHBOURHOOD  =  'N4  '  AND                                
              F110-CONTRACT-NO    =  'C18 '  AND                                
              F110-BLK-NO      =  ' 467A')                                      
               MOVE 'JAN/FEB' TO WS-MONTH                                       
           END-IF.                                                              
                                                                                
           IF (F110-ESTATE = '201' AND                                          
              F110-NEIGHBOURHOOD  =  'N4  '  AND                                
              F110-CONTRACT-NO    =  'C18 '  AND                                
              F110-BLK-NO      =  ' 467B')                                      
               MOVE 'JAN/FEB' TO WS-MONTH                                       
           END-IF.                                                              
                                                                                
           MOVE SPACES                 TO K491-DTE-PCD F491-DTE-PCD             
           STRING WS-MONTH ' ' WS-YEAR                                          
                  DELIMITED BY SIZE                                             
                  INTO K491-DTE-PCD                                             
           END-STRING.                                                          
           STRING WS-MONTH ' ' WS-YEAR                                          
                  DELIMITED BY SIZE                                             
                  INTO F491-DTE-PCD                                             
           END-STRING.                                                          
           MOVE WS-MONTH                     TO P491-DTE-COMPLT-MM              
           STRING WS-YEAR DELIMITED BY SIZE  INTO P491-DTE-COMPLT-YR            
                                                                                
           MOVE K491-DTE-PCD  TO WS-TEMP-PCD                                    
                                 P491-ORIG-PCD.                                 
                                                                                
       2700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       2800-QUARTERLY-PACD.                                                     
      *------------------------------------------------------                   
           IF K100-DTE-PACD-QTR(5:2) = '01' OR '02' OR '03'                     
              MOVE '1ST QUARTER' TO WS-QUARTER                                  
           ELSE                                                                 
              IF K100-DTE-PACD-QTR(5:2) = '04' OR '05' OR '06'                  
                 MOVE '2ND QUARTER' TO WS-QUARTER                               
              ELSE                                                              
                 IF K100-DTE-PACD-QTR(5:2) = '07' OR '08' OR '09'               
                    MOVE '3RD QUARTER' TO WS-QUARTER                            
                 ELSE                                                           
                    MOVE '4TH QUARTER' TO WS-QUARTER                            
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K100-DTE-PACD-QTR(1:4)       TO WS-YEAR.                        
                                                                                
           STRING WS-QUARTER ' ' WS-YEAR                                        
                  DELIMITED BY SIZE                                             
                  INTO P491-NEW-PCDQ                                            
           MOVE P491-NEW-PCDQ   TO P491-ORIG-PCD                                
                                                                                
           MOVE SPACES                 TO K491-DTE-PCD F491-DTE-PCD             
           STRING WS-QUARTER ' ' WS-YEAR                                        
                  DELIMITED BY SIZE                                             
                  INTO K491-DTE-PCD                                             
           END-STRING.                                                          
           STRING WS-QUARTER ' ' WS-YEAR                                        
                  DELIMITED BY SIZE                                             
                  INTO F491-DTE-PCD                                             
           END-STRING.                                                          
           MOVE K491-DTE-PCD  TO WS-TEMP-PCD                                    
                                 P491-ORIG-PCD.                                 
                                                                                
       2800-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------------------------------------------                   
       3000-FORMAT-LETTER.                                                      
      *------------------------------------------------------                   
           MOVE SPACES                   TO  P491-REGN-NO                       
                                             P491-NAME1                         
                                             P491-NAME2                         
                                             P491-NAME3                         
                                             P491-NAME4                         
                                             P491-OIC-TEL                       
                                             P491-NME-OIC.                      
                                                                                
           MOVE K800-NUM-REGN            TO  P491-REGN-NO.                      
           MOVE WS-NAME(1)               TO  P491-NAME1.                        
           MOVE WS-NAME(2)               TO  P491-NAME2.                        
           MOVE WS-NAME(3)               TO  P491-NAME3.                        
           MOVE WS-NAME(4)               TO  P491-NAME4.                        
           IF K830-NUM-MAIL-ADDR NOT = SPACES AND LOW-VALUES                    
              PERFORM 3050-FORMAT-MAIL-ADDR THRU 3050-EXIT                      
           ELSE                                                                 
              PERFORM 3055-FORMAT-HOME-ADDR THRU 3055-EXIT                      
           END-IF.                                                              
                                                                                
           MOVE COMM8-NUM-BLK            TO  P491-UNIT-BLK.                     
           MOVE COMM8-NME-STREET         TO  P491-UNIT-STREET-POSTAL.           
           MOVE COMM8-NUM-LEVEL          TO  P491-UNIT-LVL-NO.                  
           MOVE COMM8-NUM-UNIT-MAIN      TO  P491-UNIT-UNIT-NO.                 
           MOVE COMM8-NUM-POSTAL-CODE    TO  P491-POSTAL1.                      
                                                                                
      ***testing***                                                             
      *    MOVE '  114'                  TO  P491-UNIT-BLK.                     
      *    MOVE 'LORONG 1 TOA PAYOH'     TO  P491-UNIT-STREET-POSTAL.           
      *    MOVE '08'                     TO  P491-UNIT-LVL-NO.                  
      *    MOVE '242'                    TO  P491-UNIT-UNIT-NO.                 
      *    MOVE '310114'                 TO  P491-POSTAL1.                      
      ***testing***                                                             
                                                                                
            STRING WS-TEMP-SPACE1 WS-TEMP-SPACE  ' BLK' P491-UNIT-BLK' '        
                   P491-UNIT-FLAT-NO ' '                                        
                   P491-UNIT-STREET-POSTAL                                      
                   DELIMITED BY SIZE INTO WS-TEMP-ADDRESS1.                     
                                                                                
            STRING WS-TEMP-SPACE1 'SINGAPORE ' P491-POSTAL1                     
                   DELIMITED BY SIZE INTO WS-TEMP-ADDRESS2.                     
      *     STRING WS-TEMP-SPACE1 'SALES REG NO:'P491-REGN-NO                   
      *            DELIMITED BY SIZE INTO WS-TEMP-ADDRESS3.                     
                                                                                
                                                                                
           MOVE TEMP-PROJ-NAME      TO P491-PROJ-NAME                           
                                       P491-PROJ-NAME-9A                        
           MOVE TEMP-PCD-REV        TO P491-PCD-REV                             
           MOVE TEMP-PCD-REV        TO P491-PCD-REV                             
           MOVE 'Q3-2022'           TO P491-ORIG-PCD.                           
                                                                                
           PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3001-FORMAT-EMAIL.                                                       
      *------------------------------------------------------                   
                                                                                
           MOVE K800-NUM-REGN            TO  K491-NUM-REGN.                     
           IF K800-NUM-DEFER-INCOME-ASSESS = 'Y'                                
           MOVE 'Y'                      TO  K491-CDE-DA                        
           END-IF.                                                              
           MOVE K857-NUM-EMAIL           TO  K491-NUM-EMAIL                     
           MOVE COMM8-NUM-BLK            TO  K491-NUM-BLK                       
           MOVE COMM8-NUM-LEVEL          TO  K491-NUM-LEVEL                     
           MOVE COMM8-NUM-UNIT-MAIN      TO  K491-NUM-MAIN-UNIT                 
           MOVE COMM8-NME-STREET         TO  K491-NUM-STREET                    
           MOVE COMM8-NUM-POSTAL-CODE    TO  K491-NUM-POSTAL                    
           PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
           MOVE K024-NME-OIC             TO  K491-NME-OIC.                      
           MOVE WS-DATE                TO K491-DTE-UPDATE.                      
                                                                                
           WRITE BP13K491-REC.                                                  
                                                                                
           EVALUATE K491-STATUS                                                 
             WHEN 00                                                            
                 ADD 1 TO WS-F491-WRT                                           
             WHEN 02                                                            
             WHEN 22                                                            
                 DISPLAY 'DUP RECORD K491..STAT'    K491-STATUS                 
                          '/' K491-NUM-REGN                                     
             WHEN OTHER                                                         
                 DISPLAY 'ERROR WRITING THE RECORD K491..STAT'                  
                    K491-STATUS                                                 
                 DISPLAY 'KEY FIELD K028 ' K491-KEY-FLD                         
                 MOVE K491-STATUS           TO RETURN-CODE                      
                 PERFORM 9999-WRAP-UP        THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       3001-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3002-FORMAT-EMAIL.                                                       
      *------------------------------------------------------                   
                                                                                
           MOVE K800-NUM-REGN            TO  K491-NUM-REGN.                     
           MOVE K857-NUM-EMAIL           TO  K491-NUM-EMAIL                     
           MOVE COMM8-NUM-BLK            TO  K491-NUM-BLK                       
           MOVE COMM8-NUM-LEVEL          TO  K491-NUM-LEVEL                     
           MOVE COMM8-NUM-UNIT-MAIN      TO  K491-NUM-MAIN-UNIT                 
           MOVE COMM8-NME-STREET         TO  K491-NUM-STREET                    
           MOVE COMM8-NUM-POSTAL-CODE    TO  K491-NUM-POSTAL                    
           PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
           MOVE K024-NME-OIC             TO  K491-NME-OIC.                      
           MOVE WS-DATE                TO K491-DTE-UPDATE.                      
                                                                                
           REWRITE BP13K491-REC.                                                
                                                                                
           EVALUATE K491-STATUS                                                 
             WHEN 00                                                            
                 ADD 1 TO WS-F491-REWRITE                                       
             WHEN OTHER                                                         
                 DISPLAY 'ERROR REWRITING THE RECORD K491..STAT'                
                    K491-STATUS                                                 
                 DISPLAY 'KEY FIELD K491 ' K491-KEY-FLD                         
                 MOVE K491-STATUS           TO RETURN-CODE                      
                 PERFORM 9999-WRAP-UP        THRU 9999-EXIT                     
           END-EVALUATE.                                                        
                                                                                
       3002-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3003-READ-K491.                                                          
      *-------------------------------------------------------------            
           MOVE SPACES         TO BP13K491-REC.                                 
           MOVE 'N'            TO WS-FOUND-K491.                                
           MOVE F110-REGN-NO   TO K491-NUM-REGN.                                
           READ BP13K491.                                                       
                                                                                
           IF K491-STATUS = 00                                                  
              MOVE 'Y'  TO WS-FOUND-K491                                        
           ELSE                                                                 
           IF K491-STATUS = 23                                                  
              MOVE 'N'  TO WS-FOUND-K491                                        
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K491, STATUS ' K491-STATUS             
              MOVE K491-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       3003-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3004-READ-F491.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BP13F491                                                        
             AT END                                                             
                 MOVE 'Y'          TO WS-F491-EOF                               
                 MOVE 'N'          TO WS-F491-FND                               
             NOT AT END                                                         
              IF F491-NUM-REGN = F110-REGN-NO                                   
                 MOVE 'Y'          TO WS-F491-FND                               
              END-IF                                                            
           END-READ.                                                            
                                                                                
       3004-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3005-FORMAT-EMAIL.                                                       
      *------------------------------------------------------                   
                                                                                
           MOVE K800-NUM-REGN            TO  F491-NUM-REGN.                     
           MOVE K857-NUM-EMAIL           TO  F491-NUM-EMAIL                     
           MOVE COMM8-NUM-BLK            TO  F491-NUM-BLK                       
           MOVE COMM8-NUM-LEVEL          TO  F491-NUM-LEVEL                     
           MOVE COMM8-NUM-UNIT-MAIN      TO  F491-NUM-MAIN-UNIT                 
           MOVE COMM8-NME-STREET         TO  F491-NUM-STREET                    
           MOVE COMM8-NUM-POSTAL-CODE    TO  F491-NUM-POSTAL                    
           PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
           MOVE K024-NME-OIC             TO  F491-NME-OIC.                      
           MOVE WS-DATE                  TO  F491-DTE-UPDATE.                   
                                                                                
           WRITE BP13F491-REC.                                                  
                                                                                
       3005-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3006-FORMAT-EMAIL.                                                       
      *------------------------------------------------------                   
                                                                                
           MOVE K800-NUM-REGN            TO  F491-NUM-REGN.                     
           MOVE K857-NUM-EMAIL           TO  F491-NUM-EMAIL                     
           MOVE COMM8-NUM-BLK            TO  F491-NUM-BLK                       
           MOVE COMM8-NUM-LEVEL          TO  F491-NUM-LEVEL                     
           MOVE COMM8-NUM-UNIT-MAIN      TO  F491-NUM-MAIN-UNIT                 
           MOVE COMM8-NME-STREET         TO  F491-NUM-STREET                    
           MOVE COMM8-NUM-POSTAL-CODE    TO  F491-NUM-POSTAL                    
           PERFORM 5000-RETRIEVE-CSM THRU 5000-EXIT.                            
           MOVE K024-NME-OIC             TO  F491-NME-OIC.                      
           MOVE WS-DATE                  TO  F491-DTE-UPDATE.                   
                                                                                
           REWRITE BP13F491-REC.                                                
                                                                                
       3006-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3007-READ-INP1.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BP13INP1                                                        
             AT END                                                             
                 MOVE 'Y'          TO WS-INP1-EOF                               
                 MOVE 'N'          TO WS-INP1-FND                               
             NOT AT END                                                         
              IF INP1-EST-NEIG-CON = F110-AIX1                                  
                 MOVE 'Y'          TO WS-INP1-FND                               
              END-IF                                                            
           END-READ.                                                            
                                                                                
       3007-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       3050-FORMAT-MAIL-ADDR.                                                   
      *------------------------------------------------------                   
                                                                                
           IF K830-NUM-MAIL-ADDR-TYPE  = 'H'                                    
              MOVE K830-NME-MAIL-STR-BLDG TO P491-STREET                        
              MOVE K830-NUM-MAIL-LVL-CHAR TO P491-CHAR                          
              MOVE K830-NUM-MAIL-LVL-NUM  TO P491-LEVEL                         
              MOVE K830-NUM-MAIL-LVL-DASH TO P491-DASH                          
              MOVE K830-NUM-MAIL-HSEMAIN  TO P491-HSE-MAIN                      
              MOVE K830-NUM-MAIL-HSESUB   TO P491-HSE-SUB                       
           ELSE                                                                 
              MOVE K830-NUM-MAIL-FLAT     TO P491-FLAT-NO                       
              MOVE K830-NME-MAIL-STR-BLDG TO P491-STREET                        
           END-IF.                                                              
                                                                                
           MOVE K830-NUM-MAIL-BLK         TO P491-BLK.                          
                                                                                
           IF K830-NUM-MAIL-POSTAL = SPACES OR LOW-VALUES OR ZEROS              
              MOVE SPACES                   TO P491-LINE05C                     
           ELSE                                                                 
              MOVE 'SINGAPORE'              TO P491-LINE05C(05:9)               
           END-IF.                                                              
           MOVE K830-NUM-MAIL-POSTAL      TO P491-POSTAL.                       
                                                                                
           IF K830-NUM-MAIL-POSTAL = SPACES OR ZEROS                            
              DISPLAY '- MAIL POSTAL EMPTY ' K830-NUM-MAIL-POSTAL               
                      ', REGN IS ' K800-NUM-REGN.                               
                                                                                
       3050-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       3055-FORMAT-HOME-ADDR.                                                   
      *------------------------------------------------------                   
                                                                                
           IF K830-NUM-ADDR-TYPE  = 'H'                                         
              MOVE K830-NME-STREET      TO P491-STREET                          
              MOVE K830-NUM-LVL-CHAR    TO P491-CHAR                            
              MOVE K830-NUM-LVL-NUM     TO P491-LEVEL                           
              MOVE K830-NUM-LVL-DASH    TO P491-DASH                            
              MOVE K830-NUM-HSEMAIN     TO P491-HSE-MAIN                        
              MOVE K830-NUM-HSESUB      TO P491-HSE-SUB                         
           ELSE                                                                 
              MOVE K830-NUM-FLAT        TO P491-FLAT-NO                         
              MOVE K830-NME-STREET-BLDG TO P491-STREET                          
           END-IF.                                                              
                                                                                
           MOVE K830-NUM-BLK            TO P491-BLK.                            
           IF K830-NUM-POSTAL = SPACES OR LOW-VALUES OR ZEROS                   
              MOVE SPACES                  TO P491-LINE05C                      
           ELSE                                                                 
              MOVE 'SINGAPORE'             TO P491-LINE05C(05:9)                
           END-IF.                                                              
           MOVE K830-NUM-POSTAL         TO P491-POSTAL.                         
                                                                                
           IF K830-NUM-POSTAL = SPACES OR ZEROS                                 
              DISPLAY '- RES POSTAL EMPTY ' K830-NUM-MAIL-POSTAL                
                      ', REGN IS ' K800-NUM-REGN.                               
                                                                                
                                                                                
       3055-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
      *-------------------------------------------------------------            
       3100-PRINT-LETTER.                                                       
      *-------------------------------------------------------------            
                                                                                
      * LETTER TO BE SENT OUT FOR MONTHLY                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO WS-TEMP-MONTH                                         
           IF K100-NUM-PACD = 'M'                                               
            STRING WS-TEMP-SPACE3 P491-DTE-COMPLT-MM ' '                        
                   P491-DTE-COMPLT-YR                                           
                   DELIMITED BY SIZE INTO WS-TEMP-MONTH                         
           ELSE                                                                 
             IF K100-NUM-PACD = 'Q'                                             
                STRING WS-TEMP-SPACE3 P491-NEW-PCDQ                             
                       DELIMITED BY SIZE INTO WS-TEMP-MONTH                     
                IF P491-REGN-NO = '3402543F' OR '1555311A'                      
                 MOVE SPACES TO WS-TEMP-MONTH                                   
                 STRING WS-TEMP-SPACE3 '4TH QUARTER ' '2020'                    
                   DELIMITED BY SIZE INTO WS-TEMP-MONTH                         
                END-IF                                                          
             END-IF                                                             
           END-IF                                                               
           ADD   1                   TO WS-BP13FY-CTR.                          
           MOVE  SPACES              TO P491-PRTREC.                            
           MOVE  WS-BP13FY-CTR       TO WS-RECORD-CNT.                          
           MOVE  WS-RECORD-CNT       TO DJDE-LINE-FY-PAGE1(49:4).               
           MOVE  DJDE-LINE-FY-PAGE1  TO P491-PRTREC.                            
           WRITE P491-PRTREC      AFTER PAGE.                                   
                                                                                
           ADD   1                   TO WS-CNT-LETTER                           
                                        WS-P491-WRT                             
           WRITE P491-PRTREC FROM P491-LINE01.                                  
           WRITE P491-PRTREC FROM P491-LINE02.                                  
                                                                                
           WRITE P491-PRTREC FROM P491-LINE04 AFTER 4.                          
           WRITE P491-PRTREC FROM P491-LINE04B.                                 
           WRITE P491-PRTREC FROM P491-LINE04C.                                 
           WRITE P491-PRTREC FROM P491-LINE04D.                                 
                                                                                
           WRITE P491-PRTREC FROM P491-LINE05.                                  
           WRITE P491-PRTREC FROM P491-LINE05B.                                 
           IF P491-POSTAL = SPACES                                              
              MOVE SPACES   TO P491-LINE05C                                     
           END-IF                                                               
           WRITE P491-PRTREC FROM P491-LINE05C.                                 
                                                                                
           WRITE P491-PRTREC FROM WS-TEMP-ADDRESS1 AFTER 5.                     
           WRITE P491-PRTREC FROM WS-TEMP-ADDRESS2 AFTER 1.                     
                                                                                
           WRITE P491-PRTREC FROM PECD-LINE07B AFTER 1.                         
           WRITE P491-PRTREC FROM PECD-LINE09A AFTER 25.                        
           WRITE P491-PRTREC FROM PECD-LINE09C AFTER 1.                         
                                                                                
      **   WRITE P491-PRTREC FROM WS-TEMP-ADDRESS1 AFTER 7.                     
      **   WRITE P491-PRTREC FROM WS-TEMP-ADDRESS2 AFTER 1.                     
      *    WRITE P491-PRTREC FROM WS-TEMP-ADDRESS3 AFTER 1.                     
      **   WRITE P491-PRTREC FROM WS-TEMP-MONTH     AFTER 7.                    
                                                                                
           MOVE  SPACES              TO P491-PRTREC.                            
           MOVE  DJDE-LINE-FX-PAGE2  TO P491-PRTREC.                            
           WRITE P491-PRTREC      AFTER PAGE.                                   
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3200-PRINT-AUDIT.                                                        
      *-------------------------------------------------------------            
           IF WS-LINE-CNT > 55                                                  
           OR WS-PREV-BLK-NO NOT = F110-BLK-NO                                  
              PERFORM 5200-CREATE-EMAIL  THRU 5200-EXIT                         
              PERFORM 6000-PRINT-HEADING THRU 6000-EXIT                         
           END-IF.                                                              
                                                                                
           MOVE SPACES                       TO L49J-DETAIL                     
           INITIALIZE                           L49J-DETAIL.                    
           ADD 2                TO WS-LINE-CNT.                                 
           ADD 1                TO WS-BLK-CNT.                                  
                                                                                
           MOVE SPACES          TO L49J-PRTREC                                  
           INITIALIZE              L49J-PRTREC                                  
           MOVE WS-BLK-CNT      TO L49J-NO                                      
                                   WS-L49J-WRT.                                 
           STRING F110-SCHEME '-' F110-ACC '-' F110-CHK '-'                     
                  F110-ACC-TYPE                                                 
                  DELIMITED BY SIZE INTO L49J-SCH-ACC.                          
                                                                                
           MOVE F110-REGN-NO    TO L49J-REGN-NO.                                
                                                                                
           PERFORM VARYING WS-IDX FROM 1 BY 1                                   
             UNTIL WS-NAME(WS-IDX) NOT = SPACES                                 
                OR WS-IDX > 4                                                   
              CONTINUE                                                          
           END-PERFORM.                                                         
                                                                                
           IF WS-IDX > 4                                                        
              MOVE 1            TO WS-IDX                                       
           END-IF.                                                              
           MOVE WS-NAME(WS-IDX) TO L49J-NAME.                                   
           MOVE K800-NUM-NRIC1  TO L49J-NRIC-NO.                                
           MOVE P491-BLK        TO L49J-BLK-NO.                                 
           MOVE P491-STREET     TO L49J-STREET.                                 
           MOVE P491-FLAT-NO    TO L49J-FLAT-NO.                                
           MOVE P491-POSTAL     TO L49J-POSTAL-CODE.                            
                                                                                
           WRITE L49J-PRTREC FROM L49J-DETAIL AFTER 2.                          
                                                                                
       3200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4000-READ-K857.                                                          
      *-------------------------------------------------------------            
           MOVE SPACES         TO BP13K857-REC.                                 
           MOVE 'N'            TO WS-FOUND-K857.                                
           MOVE F110-REGN-NO   TO K857-NUM-REGN.                                
           READ BP13K857.                                                       
                                                                                
           IF K857-STATUS = 00                                                  
              MOVE 'Y'  TO WS-FOUND-K857                                        
           ELSE                                                                 
           IF K857-STATUS = 23                                                  
              MOVE 'N'  TO WS-FOUND-K857                                        
              DISPLAY '> NOT FOUND K857 FOR '                                   
                      K022-NUM-REGN                                             
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K857, STATUS ' K857-STATUS             
              MOVE K857-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       4000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       5000-RETRIEVE-CSM.                                                       
      *-------------------------------------------------------------            
           MOVE K800-NUM-REGN TO K022-NUM-REGN.                                 
           READ BP13K022 KEY IS K022-NUM-REGN.                                  
                                                                                
           IF K022-STATUS = 00                                                  
              MOVE K022-NUM-OIC TO K024-NUM-OIC                                 
              PERFORM 5100-READ-BP13K024 THRU 5100-EXIT                         
           ELSE                                                                 
           IF K022-STATUS = 23                                                  
              DISPLAY '> CSM FOR ' K022-NUM-REGN ' NOT FOUND.'                  
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K022, STATUS ' K022-STATUS             
              MOVE K022-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
       5100-READ-BP13K024.                                                      
      *-------------------------------------------------------------            
           READ BP13K024 KEY IS K024-KEY-FLD.                                   
                                                                                
           IF K024-STATUS = 00                                                  
              MOVE K024-NME-OIC TO P491-NME-OIC                                 
              MOVE K024-NUM-DID TO P491-OIC-TEL                                 
              CONTINUE                                                          
           ELSE                                                                 
           IF K024-STATUS = 23                                                  
              DISPLAY '> CSM DETAIL OF ' K024-NUM-OIC ' FOR '                   
                      K022-NUM-REGN ' NOT FOUND.'                               
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K024, STATUS ' K024-STATUS             
              MOVE K024-STATUS TO RETURN-CODE                                   
              PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT.                         
                                                                                
       5100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *================================================================*        
       5200-CREATE-EMAIL.                                                       
      *================================================================*        
                                                                                
            WRITE L49J-PRTREC  FROM WS-MAIL-RPT1                                
            WRITE L49J-PRTREC  FROM WS-MAIL-RPT2                                
                                                                                
            STRING WS-DATE(7:2) '/' WS-DATE(5:2) '/' WS-DATE(1:4)               
                   DELIMITED BY SIZE INTO WS-DATE-RPT                           
            WRITE L49J-PRTREC  FROM WS-DATE-RPT-DTL                             
            MOVE SPACES TO  L49J-PRTREC                                         
            WRITE   L49J-PRTREC.                                                
                                                                                
       5200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       6000-PRINT-HEADING.                                                      
      *-------------------------------------------------------------            
           ADD  1                    TO WS-PAGE-CNT.                            
           MOVE WS-PAGE-CNT          TO L49J-PAGE.                              
           MOVE F110-BLK-NO          TO L49J-BLOCK.                             
           MOVE COMM8-NME-STREET     TO L49J-STREET-NAME.                       
                                                                                
           MOVE  8                   TO WS-LINE-CNT.                            
                                                                                
           IF WS-PREV-BLK-NO  NOT = F110-BLK-NO                                 
              ADD WS-BLK-CNT         TO WS-TOTAL-CNT                            
              INITIALIZE                WS-BLK-CNT                              
           END-IF.                                                              
           MOVE F110-BLK-NO          TO WS-PREV-BLK-NO.                         
                                                                                
           MOVE SPACES               TO L49J-PRTREC.                            
           INITIALIZE                   L49J-PRTREC                             
           WRITE L49J-PRTREC         FROM L49J-HDR01 AFTER PAGE.                
           WRITE L49J-PRTREC         FROM L49J-HDR02.                           
           WRITE L49J-PRTREC         FROM L49J-HDR03 AFTER 2.                   
           WRITE L49J-PRTREC         FROM L49J-HDR04 AFTER 2.                   
           MOVE ALL '='              TO L49J-PRTREC.                            
           WRITE L49J-PRTREC            AFTER 1.                                
                                                                                
       6000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8100-READ-K800.                                                          
      *-------------------------------------------------------------            
           READ BP13K800 KEY IS K800-NUM-REGN.                                  
                                                                                
           EVALUATE K800-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K800-MISS                 
                    DISPLAY 'K800 REC NOT FOUND : ' F110-REGN-NO                
                            ' ; ' F110-SCH-ACC-NO                               
                    SET WS-ERROR            TO TRUE                             
                    GO TO 8100-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K800-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K800, STATUS '                   
                             K800-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8200-READ-K820.                                                          
      *-------------------------------------------------------------            
           READ BP13K820 KEY IS K820-KEY-FLD.                                   
                                                                                
           EVALUATE K820-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    MOVE SPACES             TO K820-NME-OCCP                    
                    ADD  1                  TO WS-CNT-K820-MISS                 
                    DISPLAY 'K820 REC NOT FOUND : ' K800-NUM-REGN               
                    GO TO 8200-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K820-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K820, STATUS '                   
                             K820-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8300-READ-K830.                                                          
      *-------------------------------------------------------------            
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
                                                                                
           EVALUATE K830-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    MOVE SPACES             TO BP13K830-REC                     
                    ADD  1                  TO WS-CNT-K830-MISS                 
                    DISPLAY 'REGN-NUM' K830-NUM-REGN                            
                    DISPLAY 'K830 REC NOT FOUND : ' K800-NUM-NRIC1              
                                                    K800-NUM-NRIC2              
                    SET WS-ERROR            TO TRUE                             
                    GO TO 8300-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K830-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BP13K830, STATUS '                   
                             K830-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8300-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8400-READ-K510.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BM06K510 KEY IS K510-ESTCDE.                                    
                                                                                
           EVALUATE K510-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K510-MISS                 
                    DISPLAY 'K510 REC NOT FOUND : ' K510-ESTCDE                 
                    GO TO 8400-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K510-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BM06K510, STATUS '                   
                             K510-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8400-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       8500-READ-K100.                                                          
      *-------------------------------------------------------------            
                                                                                
           READ BM06K100 KEY IS K100-KEY-FLD.                                   
                                                                                
           EVALUATE K100-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    CONTINUE                                                    
               WHEN 10                                                          
               WHEN 23                                                          
                    ADD  1                  TO WS-CNT-K100-MISS                 
                    DISPLAY 'K100 REC NOT FOUND : ' K100-KEY-FLD                
                    GO TO 8500-EXIT                                             
               WHEN OTHER                                                       
                    MOVE K100-STATUS              TO RETURN-CODE                
                    DISPLAY 'ERROR READING BM06K100, STATUS '                   
                             K100-STATUS                                        
                    PERFORM 9900-HANDLE-ABEND THRU 9900-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8500-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       9900-HANDLE-ABEND.                                                       
      *-------------------------------------------------------------            
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '- BP13C49S CONTROL TOTAL -------------'.                    
           DISPLAY 'TOTAL BM06F110 RECS READ  = ' WS-CNT-F110-READ.             
           DISPLAY 'TOTAL LETTERS PRINTED     = ' WS-CNT-LETTER.                
           DISPLAY 'TOTAL MISSING K800 REC    = ' WS-CNT-K800-MISS.             
           DISPLAY 'TOTAL MISSING K820 REC    = ' WS-CNT-K820-MISS.             
           DISPLAY 'TOTAL MISSING K830 REC    = ' WS-CNT-K830-MISS.             
           DISPLAY 'TOTAL MISSING K510 REC    = ' WS-CNT-K510-MISS.             
           DISPLAY 'TOTAL MISSING K100 REC    = ' WS-CNT-K100-MISS.             
           DISPLAY 'TOTAL CASES WITH EMAIL    = ' WS-CNT-K857-W-EMAIL.          
           DISPLAY 'TOTAL CASES WRITEN K491   = ' WS-F491-WRT.                  
           DISPLAY 'TOTAL CASES REWRITE K491  = ' WS-F491-REWRITE.              
           DISPLAY 'TOTAL CASES WRITEN L49J   = ' WS-L49J-WRT.                  
           DISPLAY 'TOTAL CASES WRITEN P491   = ' WS-P491-WRT.                  
                                                                                
           CLOSE BP13K022                                                       
                 BP13K024                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 BM06F110                                                       
                 BP13K491                                                       
                 BP13F491                                                       
                 BP13L49J                                                       
                 BP13P491.                                                      
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              MOVE K022-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K022 ' K022-STATUS                  
           END-IF.                                                              
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              MOVE K024-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K024-STATUS                  
           END-IF.                                                              
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              MOVE K800-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K800-STATUS                  
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              MOVE K820-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K820 ' K820-STATUS                  
           END-IF.                                                              
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              MOVE K830-STATUS TO RETURN-CODE                                   
              DISPLAY 'CLOSE FAILED FOR BP13K830 ' K830-STATUS                  
           END-IF.                                                              
                                                                                
           IF K510-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K510 ' K510-STATUS                  
              MOVE K510-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K100-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K100 ' K100-STATUS                  
              MOVE K100-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K857-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K857 ' K857-STATUS                  
              MOVE K857-STATUS TO RETURN-CODE.                                  
           STOP RUN.                                                            
                                                                                
       9900-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-------------------------------------------------------------            
       9999-WRAP-UP.                                                            
      *-------------------------------------------------------------            
           ADD WS-BLK-CNT                        TO WS-TOTAL-CNT.               
           MOVE WS-TOTAL-CNT                     TO L49J-TOTAL.                 
           WRITE L49J-PRTREC FROM L49J-PRT-TOTAL AFTER 2.                       
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '- BP13C49S CONTROL TOTAL -------------'.                    
           DISPLAY ' TOTAL BM06F110 REC READ : ' WS-CNT-F110-READ.              
           DISPLAY ' TOTAL LETTERS PRINTED   : ' WS-CNT-LETTER.                 
           DISPLAY ' TOTAL MISSING K800 REC  : ' WS-CNT-K800-MISS.              
           DISPLAY ' TOTAL MISSING K820 REC  : ' WS-CNT-K820-MISS.              
           DISPLAY ' TOTAL MISSING K830 REC  : ' WS-CNT-K830-MISS.              
           DISPLAY ' TOTAL MISSING K510 REC  : ' WS-CNT-K510-MISS.              
           DISPLAY ' TOTAL MISSING K100 REC  : ' WS-CNT-K100-MISS.              
           DISPLAY ' TOTAL CASES WITH EMAIL  : ' WS-CNT-K857-W-EMAIL.           
           DISPLAY ' TOTAL CASES WRITEN K491 :  ' WS-F491-WRT.                  
           DISPLAY ' TOTAL CASES REWRITE K491 : ' WS-F491-REWRITE.              
           DISPLAY ' TOTAL CASES WRITEN L49J  : ' WS-L49J-WRT.                  
           DISPLAY ' TOTAL CASES WRITEN P491  : ' WS-P491-WRT.                  
                                                                                
           CLOSE BP13K022                                                       
                 BP13K024                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 BM06K510                                                       
                 BM06K100                                                       
                 BM06F110                                                       
                 BP13K857                                                       
                 BP13K491                                                       
                 BP13L49J                                                       
                 BP13P491.                                                      
                                                                                
           IF K491-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K491 ' K491-STATUS                  
              MOVE K491-STATUS TO RETURN-CODE.                                  
                                                                                
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K022 ' K022-STATUS                  
              MOVE K022-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K024-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K024 ' K024-STATUS                  
              MOVE K024-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K800 ' K800-STATUS                  
              MOVE K800-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K820 ' K820-STATUS                  
              MOVE K820-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K830-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K830 ' K830-STATUS                  
              MOVE K830-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K510-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K510 ' K510-STATUS                  
              MOVE K510-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K100-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BM06K100 ' K100-STATUS                  
              MOVE K100-STATUS TO RETURN-CODE.                                  
                                                                                
           IF K857-STATUS NOT = 00 AND 97                                       
              DISPLAY 'CLOSE FAILED FOR BP13K857 ' K857-STATUS                  
              MOVE K857-STATUS TO RETURN-CODE.                                  
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
            EXIT.                                                               
