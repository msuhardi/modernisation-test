      *------------------------*                                                
       IDENTIFICATION DIVISION.                                                 
      *------------------------*                                                
       PROGRAM-ID.    BP13C26O.                                                 
       AUTHOR.        EDWIN A. ANGELES (EAA2).                                  
       DATE-WRITTEN.  19 MAY 2023.                                              
                                                                                
      * ====================================================== *                
      *    ONE-TIME PROGRAM.                                   *                
      *--------------------------------------------------------*                
      *    SYSTEM NAME : SYSTEM OF COMMITMENT                  *                
      *    SYSTEM ID   : BP13                                  *                
      *    OBJECTIVE   : TO FILTER THE APPOINTMENT DATE >=     *                
      *                 (SYSTEM DATE + NO. INPUT DAYS PROVIDED)*                
      *                  TO DETERMINE THE HOUSING SUBSIDY TAG  *                
      *                  UPDATE THE EXCEPTION REPORT           *                
      *--------------------------------------------------------*                
      * CHG-NO   BY   DATE     DETAILS                         *                
      * -------- ---  -------- -----------------------------   *                
      * BP139542 EAA2 19052023 NEW PROGRAM                     *                
      * BP139684 EAA2 15082023 ADDT'L REQUIREMENTS             *                
      *                        - MODIFIED EXCEPTION REPORT     *                
      *                        - SIMPLIFIED PROGRAM LOGIC      *                
      * BP139832 FKH2 20231207 TO ENHANCE THE FOLLOWING:       *                
      *                        A. SORT THE REPORT OUTPUT BY    *                
      *                           ASCENDING SALES MODE,        *                
      *                           BALLOT QUARTER, NEW TOWN,    *                
      *                           FLAT TYPE, QUEUE NUMBER,     *                
      *                           APPOINTMENT DATE AND         *                
      *                           APPOINTMENT TIME.            *                
      *                        B. REMOVE OUTPUT OF "SUBSIDY TAG*                
      *                           RCD FOUND" EXCEPTION.        *                
      *                        C. TO OUTPUT "SUBSIDY TAG NOT   *                
      *                           FOUND" EXCEPTION WHEN SUBSIDY*                
      *                           RECORD FOUND WITHOUT TAGGING *                
      *                           AND BYPASS SUBSIDY RECORD    *                
      *                           THAT HAS BEEN TAGGED.        *                
      *                        D. TO INCLUDE 'SAP' ALLOCATION  *                
      *                           SCHEME CODE FOR 'PA'         *                
      *                           ELIGIBILITY CRITERIA.        *                
      * BP139832 FKH2 20230116 TO ENHANCE THE FOLLOWING:       *                
      *                        A. TO PROCESS REGISTRATION      *                
      *                           NUMBER STARTING WITH '8'     *                
      *                           (BTO AND SBF).               *                
      *                        B. TO REMOVE:                   *                
      *                           1. BOOKED FLAT               *                
      *                           2. APPLICATION CANCELLED.    *                
      *                           3. BP13K800 NOT FOUND.       *                
      * ====================================================== *                
                                                                                
      *---------------------*                                                   
       ENVIRONMENT DIVISION.                                                    
      *---------------------*                                                   
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-4341.                                               
       OBJECT-COMPUTER. IBM-4341.                                               
                                                                                
      *---------------------*                                                   
       INPUT-OUTPUT SECTION.                                                    
      *---------------------*                                                   
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F200 ASSIGN TO BP13F200.                                  
                                                                                
           SELECT SY02F001 ASSIGN TO SY02F001.                                  
                                                                                
           SELECT BP13K800 ASSIGN TO BP13K800                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS RANDOM                                     
                  RECORD KEY      IS K800-NUM-REGN                              
                  FILE STATUS     IS K800-STATUS.                               
                                                                                
           SELECT BP13K820 ASSIGN TO BP13K820                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS DYNAMIC                                    
                  RECORD KEY      IS K820-KEY-FLD                               
                  FILE STATUS     IS K820-STATUS.                               
                                                                                
           SELECT BP13K862 ASSIGN TO BP13K862                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS DYNAMIC                                    
                  RECORD KEY      IS K862-KEY-FLD                               
                  FILE STATUS     IS K862-STATUS.                               
                                                                                
           SELECT BP13L26O ASSIGN TO BP13L26O.                                  
                                                                                
      *-------------*                                                           
       DATA DIVISION.                                                           
      *-------------*                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BP13F200                                                             
           BLOCK CONTAINS 0 RECORDS                                             
           RECORD CONTAINS 50 CHARACTERS                                        
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD.                                          
       01  BP13F200-REC.                                                        
           03  F200-NUM-REGN                  PIC X(8).                         
           03  FILLER                         PIC X(1).                         
           03  F200-DTE-BALLOT.                                                 
               05  F200-DTE-BALLOT-CCYY       PIC X(4).                         
               05  F200-DTE-BALLOT-MM         PIC X(2).                         
           03  FILLER                         PIC X(1).                         
           03  F200-DTE-BKAPPMT-DATE          PIC X(8).                         
           03  FILLER                         PIC X(1).                         
           03  F200-TME-BKAPPMT               PIC X(4).                         
           03  FILLER                         PIC X(1).                         
           03  F200-DTE-BKAPPMT-DATE-MGPS     PIC X(8).                         
           03  FILLER                         PIC X(1).                         
           03  F200-TME-BKAPPMT-MGPS          PIC X(4).                         
           03  FILLER                         PIC X(7).                         
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13K800.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
       COPY BP13K820.                                                           
                                                                                
       FD  BP13K862                                                             
           RECORD CONTAINS 100 CHARACTERS.                                      
       COPY BP13K862.                                                           
                                                                                
       FD  BP13L26O                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING MODE IS F                                                  
           LABEL RECORDS ARE STANDARD.                                          
       01  BP13L26O-REC                  PIC X(132).                            
                                                                                
      *-----------------------*                                                 
       WORKING-STORAGE SECTION.                                                 
      *-----------------------*                                                 
                                                                                
      **************************************************************            
      *            BP13L26O - R E P O R T   L A Y O U T            *            
      **************************************************************            
       01  WS-EXCEPTION-REPORT.                                                 
           05 WS-HEADER1.                                                       
              10 WS-RPT-HDR1-TITLE1         PIC X(14) VALUE                     
                 'BP13C26O_RPT01'.                                              
              10 FILLER                     PIC X(30) VALUE SPACES.             
              10 WS-RPT-HDR1-TITLE2         PIC X(20) VALUE                     
                 'SYSTEM OF COMMITMENT'.                                        
              10 FILLER                     PIC X(39) VALUE SPACES.             
              10 WS-RPT-PRT-DATE            PIC X(10) VALUE SPACES.             
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-PRT-TIME            PIC X(08) VALUE SPACES.             
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR1-TITLE3         PIC X(05) VALUE                     
                 'PAGE '.                                                       
              10 WS-RPT-PRT-PAGE            PIC ZZZ9  VALUE ZEROES.             
                                                                                
           05 WS-HEADER2.                                                       
              10 FILLER                     PIC X(27) VALUE SPACES.             
              10 WS-RPT-HDR2-TITLE1         PIC X(55) VALUE                     
              'REPORT ON SUBSIDY TAG NOT UPDATED BEFORE SELECTION APPT'.        
              10 FILLER                     PIC X(50) VALUE SPACES.             
                                                                                
           05 WS-HEADER3.                                                       
              10 WS-RPT-HDR3-TITLE1         PIC X(03) VALUE                     
                 'SNO'.                                                         
              10 FILLER                     PIC X(03) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE2         PIC X(05) VALUE                     
                 'REGNO'.                                                       
              10 FILLER                     PIC X(04) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE3         PIC X(05) VALUE                     
                 'HFENO'.                                                       
              10 FILLER                     PIC X(05) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE4         PIC X(08) VALUE                     
                 'HFE APPV'.                                                    
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE5         PIC X(05) VALUE                     
                 'SALES'.                                                       
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE6         PIC X(06) VALUE                     
                 'BALLOT'.                                                      
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE7         PIC X(03) VALUE                     
                 'NEW'.                                                         
              10 FILLER                     PIC X(02) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE8         PIC X(04) VALUE                     
                 'FLAT'.                                                        
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE9         PIC X(03) VALUE                     
                 'QNO'.                                                         
              10 FILLER                     PIC X(03) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE10        PIC X(05) VALUE                     
                 'HSHLD'.                                                       
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE11        PIC X(05) VALUE                     
                 'ALLOC'.                                                       
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE12        PIC X(04) VALUE                     
                 'ELIG'.                                                        
              10 FILLER                     PIC X(02) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE13        PIC X(04) VALUE                     
                 'APPT'.                                                        
              10 FILLER                     PIC X(10) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE14        PIC X(09) VALUE                     
                 'APPT MGPS'.                                                   
              10 FILLER                     PIC X(05) VALUE SPACES.             
              10 WS-RPT-HDR3-TITLE15        PIC X(07) VALUE                     
                 'REMARKS'.                                                     
              10 FILLER                     PIC X(16) VALUE SPACES.             
                                                                                
           05 WS-HEADER4.                                                       
              10 FILLER                     PIC X(25) VALUE SPACES.             
              10 WS-RPT-TITLE4-1            PIC X(03) VALUE                     
                 'DTE'.                                                         
              10 FILLER                     PIC X(06) VALUE SPACES.             
              10 WS-RPT-TITLE4-2            PIC X(04) VALUE                     
                 'MODE'.                                                        
              10 FILLER                     PIC X(02) VALUE SPACES.             
              10 WS-RPT-TITLE4-3            PIC X(03) VALUE                     
                 'QTR'.                                                         
              10 FILLER                     PIC X(04) VALUE SPACES.             
              10 WS-RPT-TITLE4-4            PIC X(04) VALUE                     
                 'TOWN'.                                                        
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-TITLE4-5            PIC X(04) VALUE                     
                 'TYPE'.                                                        
              10 FILLER                     PIC X(07) VALUE SPACES.             
              10 WS-RPT-TITLE4-6            PIC X(04) VALUE                     
                 'TYPE'.                                                        
              10 FILLER                     PIC X(02) VALUE SPACES.             
              10 WS-RPT-TITLE4-7            PIC X(05) VALUE                     
                 'SCHEM'.                                                       
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-TITLE4-8            PIC X(05) VALUE                     
                 'SCHEM'.                                                       
              10 FILLER                     PIC X(01) VALUE SPACES.             
              10 WS-RPT-TITLE4-9            PIC X(08) VALUE                     
                 'DTE TIME'.                                                    
              10 FILLER                     PIC X(06) VALUE SPACES.             
              10 WS-RPT-TITLE4-10           PIC X(08) VALUE                     
                 'DTE TIME'.                                                    
              10 FILLER                     PIC X(19) VALUE SPACES.             
                                                                                
           05 WS-HEADER5-LINE.                                                  
              10 FILLER                     PIC X(50) VALUE                     
                 '--------------------------------------------------'.          
              10 FILLER                     PIC X(50) VALUE                     
                 '--------------------------------------------------'.          
              10 FILLER                     PIC X(32) VALUE                     
                 '--------------------------------'.                            
                                                                                
           05 WS-HEADER6-BLANK.                                                 
              10 FILLER                     PIC X(132) VALUE SPACES.            
                                                                                
           05 WS-L26O-DETAILS-BLANK.                                            
              10 FILLER                     PIC X(132) VALUE SPACES.            
                                                                                
           05 WS-L26O-DETAILS.                                                  
              10 L26O-NUM-SNO               PIC ZZZZ9.                          
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-REGN              PIC X(8).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-HFE               PIC X(9).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-HFE-APPRV-DATE    PIC X(8).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-SALES-MODE        PIC X(3).                           
              10 FILLER                     PIC X(3).                           
              10 L26O-NUM-BALLOT-QUARTER    PIC X(6).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-NEW-TOWN          PIC X(3).                           
              10 FILLER                     PIC X(2).                           
              10 L26O-NUM-FLAT-TYPE         PIC X(2).                           
              10 FILLER                     PIC X(3).                           
              10 L26O-NUM-QUEUE-NUMBER      PIC X(5).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-HSHLD-TYPE        PIC X(1).                           
              10 FILLER                     PIC X(5).                           
              10 L26O-NUM-ALLO-SCHEME       PIC X(3).                           
              10 FILLER                     PIC X(3).                           
              10 L26O-NUM-ELIG-SCHEME       PIC X(3).                           
              10 FILLER                     PIC X(3).                           
              10 L26O-NUM-APPNT-DATE        PIC X(8).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-APPNT-TIME        PIC X(4).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-APPNT-MGPS-DATE   PIC X(8).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-APPNT-MGPS-TIME   PIC X(4).                           
              10 FILLER                     PIC X(1).                           
              10 L26O-NUM-REMARK            PIC X(22).                          
              10 FILLER                     PIC X(1).                           
                                                                                
           05 WS-L26O-DETAILS-NIL.                                              
              10 FILLER                     PIC X(11) VALUE                     
                 'NIL LISTING'.                                                 
              10 FILLER                     PIC X(121) VALUE SPACES.            
                                                                                
       01  WS-FILE-STATUS.                                                      
           05 K800-STATUS                   PIC 99    VALUE ZEROS.              
           05 K820-STATUS                   PIC 99    VALUE ZEROS.              
           05 K862-STATUS                   PIC 99    VALUE ZEROS.              
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-F200-READ                  PIC 9(5)  VALUE 0.                  
           05 WS-ACCEPTED-CNT               PIC 9(5)  VALUE 0.                  
           05 WS-REJECTED-CNT               PIC 9(5)  VALUE 0.                  
           05 WS-K800-FND-CNT               PIC 9(5)  VALUE 0.                  
           05 WS-K800-VALID-CNT             PIC 9(5)  VALUE 0.                  
           05 WS-BYPASS-CNT                 PIC 9(5)  VALUE 0.                  
           05 WS-K862-WRITE                 PIC 9(5)  VALUE 0.                  
           05 WS-K862-ACP-WRITE             PIC 9(5)  VALUE 0.                  
           05 WS-K862-REJ-WRITE             PIC 9(5)  VALUE 0.                  
      *BP139832 STARTS                                                          
           05 WS-K862-BYPASS                PIC 9(5)  VALUE 0.                  
           05 WS-CANCEL-CNT                 PIC 9(5)  VALUE 0.                  
           05 WS-BF-CNT                     PIC 9(5)  VALUE 0.                  
           05 WS-K800-NF-CNT                PIC 9(5)  VALUE 0.                  
           05 WS-K862-FND                   PIC X     VALUE SPACE.              
           05 WS-TAGGED-CNT                 PIC 9(5)  VALUE 0.                  
           05 WS-REJ-F200                   PIC X(1)  VALUE SPACES.             
      *BP139832 ENDS                                                            
           05 WS-L26O-WRITE                 PIC 9(5)  VALUE 0.                  
           05 WS-K820-CTR                   PIC 9(5)  VALUE 0.                  
           05 WS-K820-OCCP-CTR              PIC 9(2)  VALUE 0.                  
           05 WS-K820-CNT-OCCP              PIC 9(2)  VALUE 0.                  
           05 WS-K820-NUM-OCCP REDEFINES WS-K820-CNT-OCCP PIC X(2).             
           05 WS-CTR                        PIC 9(5)  VALUE 0.                  
           05 WS-A                          PIC 9(5)  VALUE 0.                  
           05 WS-B                          PIC 9(5)  VALUE 0.                  
           05 WS-SQLCODE                    PIC 9(4)  VALUE ZEROES.             
           05 WS-C26O-CNT                   PIC 9(5)  VALUE ZEROES.             
           05 WS-C26O-PAGE                  PIC 9(4)  VALUE ZEROES.             
                                                                                
       01  WS-EOF-F200                      PIC 9     VALUE 0.                  
           88 EOF-F200                                VALUE 1.                  
                                                                                
       01  WS-ALLO-SCHEME                   PIC X(3).                           
           88 VALID-ALLO-SCHEME             VALUE 'PA ', 'GRO', 'MCP',          
                                                  'TPS', 'REN', 'FSH',          
                                                  'TCP', 'FTS', 'STS',          
                                                  'SAP'.                        
                                                                                
       01  WS-ELIG-SCHEME                   PIC X(3).                           
           88 VALID-ELIG-SCHEME             VALUE 'FS ', 'PA ', 'TCP',          
                                                  'SSC', 'SSE', 'NCS',          
                                                  'NSE', 'JSS', 'JSE',          
                                                  'OR '.                        
                                                                                
       01  WS-FIANCE-FIANCEE                PIC X(2).                           
           88 VALID-FIANCE-FIANCEE          VALUE '09'.                         
                                                                                
       01  WS-SPOUSE                        PIC X(2).                           
           88 VALID-SPOUSE                  VALUE '20'.                         
                                                                                
       01  WS-CTZNSHP                       PIC X(2).                           
           88 VALID-SG-CITIZEN              VALUE '10'.                         
           88 VALID-SG-PR-RSDNT             VALUE '20'.                         
                                                                                
       01  WS-HOUSING-TAG-VARIABLES.                                            
           05 WS-CORE-NUCLEUS-COUNT         PIC 9(5)  VALUE ZEROES.             
           05 WS-K862-RECORD OCCURS 14 TIMES.                                   
              10 WS-K862-NUM-ROLE           PIC X(4).                           
              10 WS-K862-NUM-REGN           PIC X(8).                           
              10 WS-K862-NUM-NRIC           PIC X(9).                           
              10 WS-K862-NUM-SUBSIDY-TAG    PIC X(2).                           
              10 WS-K862-NUM-CORE-NUCLEUS   PIC X(1).                           
              10 WS-K862-NUM-RELATIONSHIP   PIC X(2).                           
              10 WS-HA-FND                  PIC X(1).                           
              10 WS-OC-FND                  PIC X(1).                           
              10 WS-HA-RLTNSHP              PIC X(2).                           
              10 WS-OC-RLTNSHP              PIC X(2).                           
              10 WS-HA-CTZNSHP              PIC X(2).                           
              10 WS-OC-CTZNSHP              PIC X(2).                           
           05 WS-NUM-HFE-APPRV-DATE         PIC X(8)  VALUE SPACES.             
           05 WS-REJ-REMARK                 PIC X(22) VALUE SPACES.             
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-F200-OK                    PIC X(1)  VALUE SPACES.             
           05 WS-K800-OK                    PIC X(1)  VALUE SPACES.             
           05 WS-K820-OK                    PIC X(1)  VALUE SPACES.             
           05 WS-K820-EOF                   PIC X(1)  VALUE SPACES.             
           05 WS-K862-OK                    PIC X(1)  VALUE SPACES.             
           05 WS-K862-EOF                   PIC X(1)  VALUE SPACES.             
           05 WS-TAG-OK                     PIC X(1)  VALUE SPACES.             
           05 WS-REJ                        PIC X(1)  VALUE SPACES.             
           05 WS-FS-FND                     PIC X(1)  VALUE SPACES.             
           05 WS-SP-FND                     PIC X(1)  VALUE SPACES.             
           05 WS-SP-NONCTZ-FND              PIC X(1)  VALUE SPACES.             
           05 WS-OCP-FND                    PIC X(1)  VALUE SPACES.             
           05 WS-K800-NUM-HLA               PIC X(9)  VALUE SPACES.             
           05 WS-C26O-MAX-LINE              PIC 9(5)  VALUE 60.                 
           05 WS-MAX-OCCUP-PER-REGNO        PIC 9(5)  VALUE 14.                 
           05 WS-MAX-HA                     PIC 9(5)  VALUE 4.                  
           05 WS-MAX-OC                     PIC 9(5)  VALUE 10.                 
                                                                                
       01  WS-DATE.                                                             
           05 WS-CCYY.                                                          
              10 WS-CC                      PIC  99.                            
              10 WS-YY                      PIC  99.                            
           05 WS-CCYY1 REDEFINES WS-CCYY    PIC  9(4).                          
           05 WS-MM                         PIC  99.                            
           05 WS-DD                         PIC  99.                            
       01  WS-FROM-DATE REDEFINES WS-DATE   PIC  X(8).                          
       01  WS-DATE9 REDEFINES WS-DATE       PIC  9(8).                          
       01  WS-INTEGER-CUR-DATE2             PIC S9(9) VALUE ZEROES.             
       01  WS-DATE2-N                       PIC  9(8) VALUE ZEROES.             
       01  WS-TO-DATE REDEFINES WS-DATE2-N  PIC  X(8).                          
       01  WS-BK-APPT-DTE                   PIC  X(8) VALUE SPACES.             
       01  WS-DATE-RUN                      PIC  X(8) VALUE SPACES.             
       01  WS-TIME-RUN                      PIC  9(8) VALUE ZEROES.             
       01  WS-NUM-TIME-RUN REDEFINES WS-TIME-RUN PIC X(08).                     
                                                                                
       01 INPUT-CHAR-DAYS                          PIC X(02).                   
       01 INPUT-NUM-DAYS REDEFINES INPUT-CHAR-DAYS PIC 9(02).                   
                                                                                
      *-----------DB2  TABLE -------------                                      
           EXEC SQL INCLUDE P13VFECA END-EXEC.                                  
           EXEC SQL INCLUDE SQLCA    END-EXEC.                                  
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
      ******************************************************************        
       000-MAIN-ROUTINE.                                                        
      ******************************************************************        
                                                                                
           PERFORM 100-INITIALIZATION THRU 100-EXIT.                            
           PERFORM 150-READ-SY02F001  THRU 150-EXIT.                            
           PERFORM 200-READ-BP13F200  THRU 200-EXIT                             
             UNTIL EOF-F200.                                                    
                                                                                
           IF WS-L26O-WRITE = ZEROES                                            
              DISPLAY 'BP13C26O-I01: BP13F200 IS EMPTY.'                        
              PERFORM 710-WRITE-EXCEPTION-HEADER THRU 710-EXIT                  
              PERFORM 720-WRITE-EXCEPTION-NIL    THRU 720-EXIT                  
           END-IF.                                                              
                                                                                
           PERFORM 999-CLOSE-FILES    THRU 999-EXIT.                            
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       100-INITIALIZATION.                                                      
      ******************************************************************        
                                                                                
           OPEN INPUT  BP13F200                                                 
                       BP13K800                                                 
                       BP13K820                                                 
                       SY02F001                                                 
                I-O    BP13K862                                                 
                OUTPUT BP13L26O.                                                
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E01: BP13K800 FILE OPENING ERROR.'              
              DISPLAY 'K800-STATUS : ' K800-STATUS                              
              MOVE 111                TO RETURN-CODE                            
              PERFORM 999-CLOSE-FILES    THRU 999-EXIT                          
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E02: BP13K820 FILE OPENING ERROR.'              
              DISPLAY 'K820-STATUS : ' K820-STATUS                              
              MOVE 111                TO RETURN-CODE                            
              PERFORM 999-CLOSE-FILES    THRU 999-EXIT                          
           END-IF.                                                              
                                                                                
           IF K862-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E03: BP13K862 FILE OPENING ERROR.'              
              DISPLAY 'K862-STATUS : ' K862-STATUS                              
              MOVE 111                TO RETURN-CODE                            
              PERFORM 999-CLOSE-FILES    THRU 999-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE ZEROS  TO WS-COUNTERS.                                          
                                                                                
           ACCEPT INPUT-CHAR-DAYS.                                              
                                                                                
           IF INPUT-CHAR-DAYS NOT NUMERIC                                       
              DISPLAY 'BP13C26O-E04: INVALID NO OF DAYS.'                       
              MOVE 111                TO RETURN-CODE                            
              PERFORM 999-CLOSE-FILES    THRU 999-EXIT                          
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE      TO WS-DATE-RUN.                      
           STRING WS-DATE-RUN(7:2) '/'                                          
                  WS-DATE-RUN(5:2) '/'                                          
                  WS-DATE-RUN(1:4)                                              
                  DELIMITED BY SIZE INTO WS-RPT-PRT-DATE.                       
                                                                                
           ACCEPT WS-TIME-RUN            FROM TIME.                             
           STRING WS-NUM-TIME-RUN(1:2) ':'                                      
                  WS-NUM-TIME-RUN(3:2) ':'                                      
                  WS-NUM-TIME-RUN(5:2)                                          
                  DELIMITED BY SIZE INTO WS-RPT-PRT-TIME.                       
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       150-READ-SY02F001.                                                       
      ******************************************************************        
                                                                                
           READ SY02F001                                                        
                AT END                                                          
                   DISPLAY 'BP13C26O-E05: SYS02F001 DATE FILE IS EMPTY.'        
                   MOVE 111                     TO RETURN-CODE                  
                   PERFORM 999-CLOSE-FILES    THRU 999-EXIT.                    
                                                                                
           MOVE F001-DTE-CURRENT TO WS-DATE.                                    
                                                                                
           COMPUTE WS-INTEGER-CUR-DATE2 =                                       
              FUNCTION INTEGER-OF-DATE(WS-DATE9) + INPUT-NUM-DAYS.              
                                                                                
           COMPUTE WS-DATE2-N =                                                 
              FUNCTION DATE-OF-INTEGER(WS-INTEGER-CUR-DATE2).                   
                                                                                
       150-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       200-READ-BP13F200.                                                       
      ******************************************************************        
                                                                                
      *BP139832 STARTS                                                          
           MOVE 'N'    TO  WS-F200-OK  WS-K800-OK WS-K820-OK                    
                           WS-K862-OK  WS-TAG-OK  WS-K820-EOF                   
                           WS-REJ      WS-FS-FND  WS-SP-FND                     
                           WS-OCP-FND  WS-SP-NONCTZ-FND                         
                           WS-REJ-F200 WS-K862-FND.                             
                                                                                
           MOVE SPACES TO  WS-L26O-DETAILS                                      
                           WS-BK-APPT-DTE                                       
                           WS-ALLO-SCHEME                                       
                           WS-REJ-REMARK                                        
                           WS-ELIG-SCHEME.                                      
                                                                                
           MOVE ZEROES TO  WS-TAGGED-CNT.                                       
      *BP139832 ENDS                                                            
                                                                                
           READ BP13F200                                                        
             AT END                                                             
                MOVE 1      TO WS-EOF-F200                                      
            NOT AT END                                                          
                ADD  1      TO WS-F200-READ                                     
                                                                                
      *BP139832 STARTS                                                          
      *         MOVE SPACES TO WS-BK-APPT-DTE                                   
      *                                                                         
      *         MOVE 'N'    TO  WS-F200-OK WS-K800-OK WS-K820-OK                
      *                         WS-K862-OK WS-TAG-OK  WS-K820-EOF               
      *                         WS-REJ     WS-FS-FND  WS-SP-FND                 
      *                         WS-OCP-FND WS-SP-NONCTZ-FND                     
      *         MOVE SPACES TO  WS-L26O-DETAILS                                 
      *BP139832 END                                                             
                                                                                
                MOVE F200-NUM-REGN TO L26O-NUM-REGN                             
                PERFORM 210-VALIDATE-F200-BOOKING-DATE  THRU 210-EXIT           
                PERFORM 220-PERSON-FIELDS-INITIALIZE    THRU 220-EXIT           
                                                                                
      *BP139832 STARTS                                                          
      *         IF WS-F200-OK = 'Y'                                             
      *            PERFORM 300-DETERMINE-BP13K862-EXIST THRU 300-EXIT           
      *         END-IF                                                          
      *                                                                         
      *         IF WS-F200-OK = 'Y' AND                                         
      *            WS-K862-OK = 'Y'                                             
      *            PERFORM 400-VALIDATE-BP13K800        THRU 400-EXIT           
      *         END-IF                                                          
                                                                                
                PERFORM 400-VALIDATE-BP13K800 THRU 400-EXIT                     
                                                                                
                IF WS-F200-OK = 'N' AND WS-REJ-F200 = 'Y'                       
                   MOVE 'INVALID BK APPT DATE' TO WS-REJ-REMARK                 
                END-IF                                                          
                                                                                
      *BP139832 END                                                             
                                                                                
                IF WS-F200-OK = 'Y' AND                                         
                   WS-K800-OK = 'Y'                                             
                                                                                
      *BP139832 START                                                           
      *            PERFORM 300-DETERMINE-BP13K862-EXIST THRU 300-EXIT           
                   PERFORM 300-VALIDATE-BP13K862 THRU 300-EXIT                  
      *BP139832 END                                                             
                                                                                
                END-IF                                                          
                                                                                
                IF WS-F200-OK = 'Y' AND                                         
                   WS-K862-OK = 'Y' AND                                         
                   WS-K800-OK = 'Y'                                             
                   PERFORM 500-DETERMINE-PERSON                                 
                      THRU 500-EXIT                                             
                   IF WS-K820-OK = 'Y'                                          
                      PERFORM 550-VALIDATE-CORE-PERSONS                         
                         THRU 550-EXIT                                          
                      IF WS-REJ = 'N'                                           
                         PERFORM 560-DETERMINE-SUBSIDY-TAG                      
                            THRU 560-EXIT                                       
                      END-IF                                                    
                   END-IF                                                       
                   PERFORM 570-MOVE-EMPTY-K862-RECORD-ARY                       
                      THRU 570-EXIT                                             
                END-IF                                                          
                                                                                
                IF (WS-TAG-OK = 'Y') AND                                        
                   (WS-REJ = 'N')                                               
                    PERFORM VARYING WS-CTR FROM 1 BY 1                          
                      UNTIL WS-CTR > WS-K820-CTR                                
                      IF WS-K862-NUM-REGN(WS-CTR) NOT = SPACES                  
                         PERFORM 600-WRITE-HSNG-SUBSIDY-TAG                     
                            THRU 600-EXIT                                       
                         ADD 1  TO  WS-K862-ACP-WRITE                           
                      END-IF                                                    
                    END-PERFORM                                                 
                    ADD 1  TO  WS-ACCEPTED-CNT                                  
                END-IF                                                          
                                                                                
                IF (WS-TAG-OK = 'N') AND                                        
                   (WS-REJ = 'Y')                                               
                    PERFORM 700-WRITE-EXCEPTION-RECORD THRU 700-EXIT            
      *BP139832 START                                                           
      *             PERFORM VARYING WS-CTR FROM 1 BY 1                          
      *               UNTIL WS-CTR > WS-K820-CTR                                
      *               IF WS-K862-NUM-REGN(WS-CTR) NOT = SPACES                  
      *                  PERFORM 600-WRITE-HSNG-SUBSIDY-TAG                     
      *                     THRU 600-EXIT                                       
      *                  ADD 1  TO  WS-K862-REJ-WRITE                           
      *               END-IF                                                    
      *             END-PERFORM                                                 
                                                                                
                    IF WS-K862-FND = 'N'                                        
                       PERFORM VARYING WS-CTR FROM 1 BY 1                       
                       UNTIL WS-CTR > WS-K820-CTR                               
                         IF WS-K862-NUM-REGN(WS-CTR) NOT = SPACES               
                            PERFORM 600-WRITE-HSNG-SUBSIDY-TAG                  
                            THRU 600-EXIT                                       
                            ADD 1  TO  WS-K862-REJ-WRITE                        
                         END-IF                                                 
                       END-PERFORM                                              
                    END-IF                                                      
      *BP139832 END                                                             
                    ADD 1  TO  WS-REJECTED-CNT                                  
                END-IF                                                          
                                                                                
           END-READ.                                                            
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       210-VALIDATE-F200-BOOKING-DATE.                                          
      ******************************************************************        
                                                                                
      *BP139832 START                                                           
           MOVE F200-DTE-BKAPPMT-DATE      TO L26O-NUM-APPNT-DATE.              
           MOVE F200-TME-BKAPPMT           TO L26O-NUM-APPNT-TIME.              
           MOVE F200-DTE-BKAPPMT-DATE-MGPS TO L26O-NUM-APPNT-MGPS-DATE.         
           MOVE F200-TME-BKAPPMT-MGPS      TO L26O-NUM-APPNT-MGPS-TIME.         
      *BP139832 END                                                             
                                                                                
           IF (F200-DTE-BKAPPMT-DATE      = SPACES OR                           
                                            LOW-VALUES OR                       
                                            ZEROES OR                           
                                            '00010101') AND                     
              (F200-DTE-BKAPPMT-DATE-MGPS = SPACES OR                           
                                            LOW-VALUES OR                       
                                            ZEROES OR                           
                                            '00010101')                         
              MOVE 'Y'                    TO WS-REJ                             
                                                                                
      *BP139832 STARTS                                                          
              MOVE 'N'                    TO WS-F200-OK                         
              MOVE 'Y'                    TO WS-REJ-F200                        
      *       MOVE 'INVALID BK APPT DATE' TO WS-REJ-REMARK                      
      *BP139832 ENDS                                                            
                                                                                
           ELSE                                                                 
              IF (F200-DTE-BKAPPMT-DATE   = SPACES OR                           
                                            LOW-VALUES OR                       
                                            ZEROES OR                           
                                            '00010101')                         
                 MOVE F200-DTE-BKAPPMT-DATE-MGPS TO WS-BK-APPT-DTE              
              ELSE                                                              
                 IF (F200-DTE-BKAPPMT-DATE-MGPS = SPACES OR                     
                                                  LOW-VALUES OR                 
                                                  ZEROES OR                     
                                                  '00010101')                   
                    MOVE F200-DTE-BKAPPMT-DATE   TO WS-BK-APPT-DTE              
                 ELSE                                                           
                    IF (F200-DTE-BKAPPMT-DATE <                                 
                        F200-DTE-BKAPPMT-DATE-MGPS)                             
                        MOVE F200-DTE-BKAPPMT-DATE TO WS-BK-APPT-DTE            
                    ELSE                                                        
                        MOVE F200-DTE-BKAPPMT-DATE-MGPS                         
                                                   TO WS-BK-APPT-DTE            
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
                                                                                
              IF (WS-BK-APPT-DTE >= WS-FROM-DATE) AND                           
                 (WS-BK-APPT-DTE <= WS-TO-DATE)                                 
                                                                                
      *BP139832 START                                                           
      *           MOVE F200-DTE-BKAPPMT-DATE                                    
      *                TO L26O-NUM-APPNT-DATE                                   
      *           MOVE F200-TME-BKAPPMT                                         
      *                TO L26O-NUM-APPNT-TIME                                   
      *           MOVE F200-DTE-BKAPPMT-DATE-MGPS                               
      *                TO L26O-NUM-APPNT-MGPS-DATE                              
      *           MOVE F200-TME-BKAPPMT-MGPS                                    
      *                TO L26O-NUM-APPNT-MGPS-TIME                              
      *BP139832 END                                                             
                                                                                
                  MOVE 'Y'  TO  WS-F200-OK                                      
              ELSE                                                              
                  ADD  1    TO  WS-BYPASS-CNT                                   
                  MOVE 'N'  TO  WS-F200-OK                                      
              END-IF                                                            
                                                                                
           END-IF.                                                              
                                                                                
       210-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *************************************************************             
       220-PERSON-FIELDS-INITIALIZE.                                            
      *************************************************************             
                                                                                
           MOVE ZEROES TO WS-CORE-NUCLEUS-COUNT.                                
                                                                                
           PERFORM VARYING WS-K820-CTR FROM 1 BY 1                              
              UNTIL WS-K820-CTR > WS-MAX-OCCUP-PER-REGNO                        
              MOVE SPACES  TO  WS-K862-NUM-ROLE(WS-K820-CTR)                    
                               WS-K862-NUM-REGN(WS-K820-CTR)                    
                               WS-K862-NUM-NRIC(WS-K820-CTR)                    
                               WS-K862-NUM-SUBSIDY-TAG(WS-K820-CTR)             
                               WS-K862-NUM-CORE-NUCLEUS(WS-K820-CTR)            
                               WS-K862-NUM-RELATIONSHIP(WS-K820-CTR)            
                               WS-HA-FND(WS-K820-CTR)                           
                               WS-OC-FND(WS-K820-CTR)                           
                               WS-HA-RLTNSHP(WS-K820-CTR)                       
                               WS-OC-RLTNSHP(WS-K820-CTR)                       
                               WS-HA-CTZNSHP(WS-K820-CTR)                       
                               WS-OC-CTZNSHP(WS-K820-CTR)                       
           END-PERFORM.                                                         
                                                                                
           MOVE ZEROES     TO  WS-K820-CTR.                                     
                                                                                
       220-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
      *BP139832 STARTS                                                          
      *300-DETERMINE-BP13K862-EXIST.                                            
       300-VALIDATE-BP13K862.                                                   
      *BP139832 END                                                             
      ******************************************************************        
                                                                                
      *BP139832 STARTS                                                          
           MOVE ZEROES              TO WS-TAGGED-CNT.                           
      *BP139832 ENDS                                                            
                                                                                
           MOVE 'N'                 TO WS-K862-OK WS-K862-EOF.                  
           MOVE SPACES              TO K862-KEY-FLD.                            
           MOVE F200-NUM-REGN       TO K862-NUM-REGN.                           
                                                                                
           PERFORM 310-STARTBR-BP13K862  THRU 310-EXIT.                         
                                                                                
      *BP139832 STARTS                                                          
      *    PERFORM 320-READNEXT-BP13K862 THRU 320-EXIT                          
      *      UNTIL WS-K862-EOF = 'Y'.                                           
                                                                                
           IF WS-K862-FND = 'Y'                                                 
              IF WS-TAGGED-CNT = ZEROES                                         
                 MOVE 'N' TO WS-K862-OK                                         
                 MOVE 'Y' TO WS-REJ                                             
                 MOVE 'SUBSIDY TAG NOT FOUND' TO WS-REJ-REMARK                  
              ELSE                                                              
                 ADD 1 TO WS-K862-BYPASS                                        
              END-IF                                                            
           ELSE                                                                 
              MOVE 'Y' TO WS-K862-OK                                            
              MOVE 'N' TO WS-REJ                                                
           END-IF.                                                              
                                                                                
      *BP139832 ENDS                                                            
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       310-STARTBR-BP13K862.                                                    
      ******************************************************************        
                                                                                
           START BP13K862 KEY >= K862-KEY-FLD.                                  
                                                                                
           IF K862-STATUS = 00 OR 02                                            
      *BP139832 STARTS                                                          
      *       IF K862-NUM-REGN = F200-NUM-REGN                                  
      *          MOVE 'N'                  TO WS-K862-OK                        
      *       ELSE                                                              
      *          MOVE 'Y'                  TO WS-K862-OK                        
      *       END-IF                                                            
                                                                                
              PERFORM 320-READNEXT-BP13K862 THRU 320-EXIT                       
              IF K862-NUM-REGN = F200-NUM-REGN                                  
                 MOVE 'Y' TO WS-K862-FND                                        
                 PERFORM 330-PROCESS-BP13K862 THRU 330-EXIT                     
                 UNTIL K862-NUM-REGN NOT = F200-NUM-REGN OR                     
                 WS-K862-EOF = 'Y'                                              
              ELSE                                                              
                 MOVE 'N' TO WS-K862-FND                                        
                 MOVE 'Y' TO WS-K862-OK                                         
                 MOVE 'Y' TO WS-K862-EOF                                        
              END-IF                                                            
      *BP139832 ENDS                                                            
                                                                                
           ELSE                                                                 
              IF K862-STATUS = 23 OR 10                                         
                 MOVE 'Y'                  TO WS-K862-OK                        
                 MOVE 'Y'                  TO WS-K862-EOF                       
              ELSE                                                              
                 DISPLAY 'BP13C26O-E06: BP13K862 START READ ERROR.'             
                 DISPLAY 'K862-STATUS : ' K862-STATUS                           
                 MOVE 111                  TO RETURN-CODE                       
                 PERFORM 999-CLOSE-FILES THRU 999-EXIT                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       310-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       320-READNEXT-BP13K862.                                                   
      ******************************************************************        
                                                                                
           READ BP13K862 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'    TO WS-K862-EOF                                      
                                                                                
            NOT AT END                                                          
                EVALUATE K862-STATUS                                            
                    WHEN 00                                                     
                    WHEN 02                                                     
      *BP139832 STARTS                                                          
      *                  IF K862-NUM-REGN = F200-NUM-REGN                       
      *                     MOVE 'N'                  TO WS-K862-OK             
      *                     MOVE 'Y'                  TO WS-K862-EOF            
      *                     MOVE 'Y'                  TO WS-REJ                 
      *                     MOVE 'SUBSIDY TAG RCD FOUND'                        
      *                                               TO WS-REJ-REMARK          
      *                  ELSE                                                   
      *                     MOVE 'Y'                  TO WS-K862-OK             
      *                     MOVE 'Y'                  TO WS-K862-EOF            
      *                  END-IF                                                 
                         CONTINUE                                               
      *BP139832 ENDS                                                            
                                                                                
                    WHEN 23                                                     
                    WHEN 10                                                     
                         MOVE 'Y'                     TO WS-K862-OK             
                         MOVE 'Y'                     TO WS-K862-EOF            
                                                                                
                    WHEN OTHER                                                  
                      DISPLAY 'BP13C26O-E07: BP13K862 READ NEXT ERROR.'         
                         DISPLAY 'K862-STATUS : ' K862-STATUS                   
                         MOVE 111                  TO RETURN-CODE               
                         PERFORM 999-CLOSE-FILES THRU 999-EXIT                  
                END-EVALUATE                                                    
           END-READ.                                                            
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
      **********************                                                    
       330-PROCESS-BP13K862.                                                    
      **********************                                                    
                                                                                
           IF K862-NUM-SUBSIDY-TAG NOT = SPACES                                 
              ADD 1 TO WS-TAGGED-CNT                                            
           END-IF.                                                              
                                                                                
           PERFORM 320-READNEXT-BP13K862 THRU 320-EXIT.                         
                                                                                
       330-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       400-VALIDATE-BP13K800.                                                   
      ******************************************************************        
                                                                                
           MOVE 'N'                     TO WS-K800-OK.                          
           MOVE F200-NUM-REGN           TO K800-NUM-REGN.                       
                                                                                
           READ BP13K800.                                                       
                                                                                
           IF K800-STATUS = 00                                                  
              ADD 1                         TO WS-K800-FND-CNT                  
              MOVE K800-NUM-HLA             TO L26O-NUM-HFE                     
                                               WS-K800-NUM-HLA                  
              MOVE K800-NUM-ALLO-CAT        TO L26O-NUM-SALES-MODE              
              MOVE K800-DTE-BALLOT          TO L26O-NUM-BALLOT-QUARTER          
              MOVE K800-NUM-NEW-TOWN        TO L26O-NUM-NEW-TOWN                
              MOVE K800-NUM-FLAT-TYPE       TO L26O-NUM-FLAT-TYPE               
              MOVE K800-NUM-NT-FT-QUEUE     TO L26O-NUM-QUEUE-NUMBER            
              MOVE K800-NUM-HOUSEHOLD       TO L26O-NUM-HSHLD-TYPE              
              MOVE K800-NUM-ALLO-SCHEME     TO L26O-NUM-ALLO-SCHEME             
              MOVE K800-NUM-ELIG-SCHEME     TO L26O-NUM-ELIG-SCHEME             
      *BP139832 STARTS                                                          
              IF WS-F200-OK = 'Y'                                               
                                                                                
                 IF K800-NUM-STATUS = 'C'                                       
      *             MOVE 'APPLICATION CANCELLED'    TO WS-REJ-REMARK            
      *             MOVE 'Y'                        TO WS-REJ                   
                    MOVE 'N'                        TO WS-K800-OK               
                    ADD   1                         TO WS-CANCEL-CNT            
                 ELSE                                                           
                    IF K800-NUM-SCH-ACC NOT = SPACES AND LOW-VALUES             
      *                MOVE 'BOOKED FLAT'           TO WS-REJ-REMARK            
      *                MOVE 'Y'                     TO WS-REJ                   
                       MOVE 'N'                     TO WS-K800-OK               
                       ADD   1                      TO WS-BF-CNT                
      *BP139832 ENDS                                                            
                    ELSE                                                        
                       MOVE K800-NUM-ALLO-SCHEME    TO WS-ALLO-SCHEME           
                       MOVE K800-NUM-ELIG-SCHEME    TO WS-ELIG-SCHEME           
                       IF NOT VALID-ALLO-SCHEME                                 
                          MOVE 'INVALID ALLO SCHEME'                            
                                                    TO WS-REJ-REMARK            
                          MOVE 'Y'                  TO WS-REJ                   
                       ELSE                                                     
                          IF NOT VALID-ELIG-SCHEME                              
                             MOVE 'INVALID ELIG SCHEME'                         
                                                    TO WS-REJ-REMARK            
                             MOVE 'Y'               TO WS-REJ                   
                          ELSE                                                  
                             MOVE 'Y'               TO WS-K800-OK               
                             ADD 1                 TO WS-K800-VALID-CNT         
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
      *BP139832 STARTS                                                          
              END-IF                                                            
      *BP139832 ENDS                                                            
           ELSE                                                                 
              IF K800-STATUS = 23                                               
      *BP139832 STARTS                                                          
      *          MOVE 'BP13K800 NOT FOUND'          TO WS-REJ-REMARK            
      *          MOVE 'Y'                           TO WS-REJ                   
                 IF WS-F200-OK = 'Y'                                            
                    MOVE 'N'                        TO WS-K800-OK               
                    ADD   1                         TO WS-K800-NF-CNT           
                 END-IF                                                         
      *BP139832 ENDS                                                            
              ELSE                                                              
                 DISPLAY 'BP13C26O-E08: BP13K800 READING ERROR.'                
                 DISPLAY 'K800-STATUS : ' K800-STATUS                           
                 MOVE 111                           TO RETURN-CODE              
                 PERFORM 999-CLOSE-FILES THRU 999-EXIT                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       500-DETERMINE-PERSON.                                                    
      ******************************************************************        
                                                                                
           MOVE 'N'                        TO WS-K820-EOF.                      
           MOVE SPACES                     TO K820-KEY-FLD.                     
           MOVE ZEROES                     TO WS-K820-CTR.                      
           MOVE WS-MAX-HA                  TO WS-K820-OCCP-CTR.                 
           MOVE F200-NUM-REGN              TO K820-NUM-REGN.                    
                                                                                
           PERFORM 510-STARTBR-BP13K820  THRU 510-EXIT.                         
           PERFORM 520-READNEXT-BP13K820 THRU 520-EXIT                          
             UNTIL WS-K820-EOF = 'Y'.                                           
                                                                                
           IF WS-CORE-NUCLEUS-COUNT > 2                                         
              MOVE 'CORE NUCLEUS > 2'      TO WS-REJ-REMARK                     
              MOVE 'Y'                     TO WS-REJ                            
              MOVE 'N'                     TO WS-K820-OK                        
           END-IF.                                                              
                                                                                
           IF (WS-K820-CTR > WS-MAX-OCCUP-PER-REGNO) AND                        
              (WS-REJ = 'N')                                                    
              STRING 'MORE THAN '                                               
                     WS-MAX-OCCUP-PER-REGNO                                     
                     ' PERSON'                                                  
                     DELIMITED BY SIZE INTO WS-REJ-REMARK                       
              MOVE 'Y'                     TO WS-REJ                            
              MOVE 'N'                     TO WS-K820-OK                        
              MOVE ZEROES                  TO WS-K820-CTR                       
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       510-STARTBR-BP13K820.                                                    
      ******************************************************************        
                                                                                
           START BP13K820 KEY >= K820-KEY-FLD.                                  
                                                                                
           IF K820-STATUS = 00 OR 02                                            
              IF F200-NUM-REGN = K820-NUM-REGN                                  
                 MOVE 'Y'                  TO WS-K820-OK                        
              ELSE                                                              
                 MOVE 'N'                  TO WS-K820-OK                        
                 MOVE 'Y'                  TO WS-K820-EOF                       
              END-IF                                                            
           ELSE                                                                 
              IF K820-STATUS = 23 OR 10                                         
                 MOVE 'N'                  TO WS-K820-OK                        
                 MOVE 'Y'                  TO WS-K820-EOF                       
              ELSE                                                              
                 DISPLAY 'BP13C26O-E09: BP13K820 START ERROR.'                  
                 DISPLAY 'K820-STATUS : ' K820-STATUS                           
                 MOVE 111                  TO RETURN-CODE                       
                 PERFORM 999-CLOSE-FILES THRU 999-EXIT                          
              END-IF                                                            
           END-IF.                                                              
                                                                                
       510-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       520-READNEXT-BP13K820.                                                   
      ******************************************************************        
                                                                                
           READ BP13K820 NEXT RECORD                                            
             AT END                                                             
                MOVE 'Y'    TO WS-K820-EOF                                      
                                                                                
            NOT AT END                                                          
                EVALUATE K820-STATUS                                            
                    WHEN 00                                                     
                    WHEN 02                                                     
                         IF F200-NUM-REGN = K820-NUM-REGN                       
                            ADD 1                         TO WS-K820-CTR        
                            MOVE 'Y'                      TO WS-K820-OK         
                            PERFORM 530-POPULATE-PERSON THRU 530-EXIT           
                         ELSE                                                   
                            MOVE 'Y'                      TO WS-K820-EOF        
                         END-IF                                                 
                                                                                
                    WHEN 23                                                     
                    WHEN 10                                                     
                         MOVE 'Y'                         TO WS-K820-EOF        
                                                                                
                    WHEN OTHER                                                  
                         DISPLAY 'BP13C26O-E10: BP13K820 READNXT ERROR.'        
                         DISPLAY 'K820-STATUS : ' K820-STATUS                   
                         MOVE 111                  TO RETURN-CODE               
                         PERFORM 999-CLOSE-FILES THRU 999-EXIT                  
                END-EVALUATE                                                    
           END-READ.                                                            
                                                                                
       520-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       530-POPULATE-PERSON.                                                     
      ******************************************************************        
                                                                                
           IF WS-K820-CTR <= WS-MAX-OCCUP-PER-REGNO                             
              IF K820-NUM-LESSEE-CHECK = 'Y'                                    
                 ADD 1           TO WS-CORE-NUCLEUS-COUNT                       
              END-IF                                                            
                                                                                
              EVALUATE TRUE                                                     
                  WHEN K820-NUM-NRIC = K800-NUM-NRIC1                           
                       MOVE 'Y'           TO WS-HA-FND(1)                       
                       MOVE 'HA1 '        TO WS-K862-NUM-ROLE(1)                
                       MOVE K820-NUM-REGN TO WS-K862-NUM-REGN(1)                
                       MOVE K820-NUM-NRIC TO WS-K862-NUM-NRIC(1)                
                       MOVE K820-NUM-LESSEE-CHECK                               
                                          TO WS-K862-NUM-CORE-NUCLEUS(1)        
                       MOVE K820-NUM-RELATIONSHIP                               
                                          TO WS-K862-NUM-RELATIONSHIP(1)        
                       MOVE K820-NUM-RELATIONSHIP TO WS-HA-RLTNSHP(1)           
                       MOVE K820-NUM-CITIZENSHIP  TO WS-HA-CTZNSHP(1)           
                       MOVE SPACES                TO WS-OC-FND(1)               
                                                     WS-OC-RLTNSHP(1)           
                                                     WS-OC-CTZNSHP(1)           
                  WHEN K820-NUM-NRIC = K800-NUM-NRIC2                           
                       MOVE 'Y'           TO WS-HA-FND(2)                       
                       MOVE 'HA2 '        TO WS-K862-NUM-ROLE(2)                
                       MOVE K820-NUM-REGN TO WS-K862-NUM-REGN(2)                
                       MOVE K820-NUM-NRIC TO WS-K862-NUM-NRIC(2)                
                       MOVE K820-NUM-LESSEE-CHECK                               
                                          TO WS-K862-NUM-CORE-NUCLEUS(2)        
                       MOVE K820-NUM-RELATIONSHIP                               
                                          TO WS-K862-NUM-RELATIONSHIP(2)        
                       MOVE K820-NUM-RELATIONSHIP TO WS-HA-RLTNSHP(2)           
                       MOVE K820-NUM-CITIZENSHIP  TO WS-HA-CTZNSHP(2)           
                       MOVE SPACES                TO WS-OC-FND(2)               
                                                     WS-OC-RLTNSHP(2)           
                                                     WS-OC-CTZNSHP(2)           
                  WHEN K820-NUM-NRIC = K800-NUM-NRIC3                           
                       MOVE 'Y'           TO WS-HA-FND(3)                       
                       MOVE 'HA3 '        TO WS-K862-NUM-ROLE(3)                
                       MOVE K820-NUM-REGN TO WS-K862-NUM-REGN(3)                
                       MOVE K820-NUM-NRIC TO WS-K862-NUM-NRIC(3)                
                       MOVE K820-NUM-LESSEE-CHECK                               
                                          TO WS-K862-NUM-CORE-NUCLEUS(3)        
                       MOVE K820-NUM-RELATIONSHIP                               
                                          TO WS-K862-NUM-RELATIONSHIP(3)        
                       MOVE K820-NUM-RELATIONSHIP TO WS-HA-RLTNSHP(3)           
                       MOVE K820-NUM-CITIZENSHIP  TO WS-HA-CTZNSHP(3)           
                       MOVE SPACES                TO WS-OC-FND(3)               
                                                     WS-OC-RLTNSHP(3)           
                                                     WS-OC-CTZNSHP(3)           
                  WHEN K820-NUM-NRIC = K800-NUM-NRIC4                           
                       MOVE 'Y'           TO WS-HA-FND(4)                       
                       MOVE 'HA4 '        TO WS-K862-NUM-ROLE(4)                
                       MOVE K820-NUM-REGN TO WS-K862-NUM-REGN(4)                
                       MOVE K820-NUM-NRIC TO WS-K862-NUM-NRIC(4)                
                       MOVE K820-NUM-LESSEE-CHECK                               
                                          TO WS-K862-NUM-CORE-NUCLEUS(4)        
                       MOVE K820-NUM-RELATIONSHIP                               
                                          TO WS-K862-NUM-RELATIONSHIP(4)        
                       MOVE K820-NUM-RELATIONSHIP TO WS-HA-RLTNSHP(4)           
                       MOVE K820-NUM-CITIZENSHIP  TO WS-HA-CTZNSHP(4)           
                       MOVE SPACES                TO WS-OC-FND(4)               
                                                     WS-OC-RLTNSHP(4)           
                                                     WS-OC-CTZNSHP(4)           
                  WHEN OTHER                                                    
                       ADD 1              TO WS-K820-OCCP-CTR                   
                       COMPUTE WS-K820-CNT-OCCP = WS-K820-OCCP-CTR -            
                                                  WS-MAX-HA                     
                       MOVE 'Y'    TO WS-OC-FND(WS-K820-OCCP-CTR)               
                       STRING 'OC'                                              
                              WS-K820-NUM-OCCP                                  
                              DELIMITED BY SIZE                                 
                              INTO WS-K862-NUM-ROLE(WS-K820-OCCP-CTR)           
                       MOVE K820-NUM-REGN                                       
                           TO WS-K862-NUM-REGN(WS-K820-OCCP-CTR)                
                       MOVE K820-NUM-NRIC                                       
                           TO WS-K862-NUM-NRIC(WS-K820-OCCP-CTR)                
                       MOVE K820-NUM-LESSEE-CHECK                               
                           TO WS-K862-NUM-CORE-NUCLEUS(WS-K820-OCCP-CTR)        
                       MOVE K820-NUM-RELATIONSHIP                               
                           TO WS-K862-NUM-RELATIONSHIP(WS-K820-OCCP-CTR)        
                       MOVE K820-NUM-RELATIONSHIP                               
                           TO WS-OC-RLTNSHP(WS-K820-OCCP-CTR)                   
                       MOVE K820-NUM-CITIZENSHIP                                
                           TO WS-OC-CTZNSHP(WS-K820-OCCP-CTR)                   
                       MOVE SPACES TO WS-HA-FND(WS-K820-OCCP-CTR)               
                                      WS-HA-RLTNSHP(WS-K820-OCCP-CTR)           
                                      WS-HA-CTZNSHP(WS-K820-OCCP-CTR)           
              END-EVALUATE                                                      
                                                                                
           ELSE                                                                 
              MOVE 'Y'                          TO WS-K820-EOF                  
           END-IF.                                                              
                                                                                
       530-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ****************************************************************          
       550-VALIDATE-CORE-PERSONS.                                               
      ****************************************************************          
                                                                                
      ***REJECTED CASE 1  FIANCE / FIANCEE NOT FOUND                            
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'PA ' OR 'GRO' OR                      
                                         'MCP' OR 'TPS' OR                      
                                         'REN' OR 'FSH') AND                    
                 (K800-NUM-ELIG-SCHEME = 'FS ')                                 
                 MOVE SPACES TO WS-FIANCE-FIANCEE                               
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-FND(WS-CTR) = 'Y' AND                              
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE WS-HA-RLTNSHP(WS-CTR) TO WS-FIANCE-FIANCEE           
                   ELSE                                                         
                      IF (WS-OC-FND(WS-CTR) = 'Y' AND                           
                          WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')               
                         MOVE WS-OC-RLTNSHP(WS-CTR) TO WS-FIANCE-FIANCEE        
                      END-IF                                                    
                   END-IF                                                       
                   IF VALID-FIANCE-FIANCEE                                      
                      MOVE 'Y'                    TO WS-FS-FND                  
                      MOVE WS-MAX-OCCUP-PER-REGNO TO WS-CTR                     
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 IF WS-FS-FND = 'N'                                             
                    MOVE 'FIANCE/FIANCEE NOT FND' TO WS-REJ-REMARK              
                    MOVE 'Y'                      TO WS-REJ                     
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 2 - SPOUSE NOT FOUND                                     
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'PA ' OR 'GRO' OR 'MCP' OR             
                                         'TCP' OR 'TPS' OR 'REN' OR             
      *BP139832 STARTS                                                          
                                         'FSH' OR 'SAP') AND                    
      *BP139832 ENDS                                                            
                 (K800-NUM-ELIG-SCHEME = 'PA ')                                 
                 MOVE SPACES TO WS-SPOUSE WS-CTZNSHP                            
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-FND(WS-CTR) = 'Y' AND                              
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE WS-HA-RLTNSHP(WS-CTR) TO WS-SPOUSE                   
                      MOVE WS-HA-CTZNSHP(WS-CTR) TO WS-CTZNSHP                  
                   ELSE                                                         
                      IF (WS-OC-FND(WS-CTR) = 'Y' AND                           
                          WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')               
                         MOVE WS-OC-RLTNSHP(WS-CTR) TO WS-SPOUSE                
                         MOVE WS-OC-CTZNSHP(WS-CTR) TO WS-CTZNSHP               
                      END-IF                                                    
                   END-IF                                                       
                   IF VALID-SPOUSE                                              
                      IF NOT VALID-SG-CITIZEN                                   
                         MOVE 'Y'                    TO WS-SP-NONCTZ-FND        
                      ELSE                                                      
                         MOVE 'Y'                    TO WS-SP-FND               
                      END-IF                                                    
                      MOVE WS-MAX-OCCUP-PER-REGNO    TO WS-CTR                  
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 IF WS-SP-NONCTZ-FND = 'Y'                                      
                    MOVE 'SPOUSE NOT SG CTZ' TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 ELSE                                                           
                    IF WS-SP-FND = 'N'                                          
                       MOVE 'SPOUSE NOT FOUND'  TO WS-REJ-REMARK                
                       MOVE 'Y'                 TO WS-REJ                       
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 3 - SPOUSE NOT FOUND                                     
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'TCP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'TCP')                                 
                 MOVE SPACES TO WS-SPOUSE WS-CTZNSHP                            
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-FND(WS-CTR) = 'Y' AND                              
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE WS-HA-RLTNSHP(WS-CTR) TO WS-SPOUSE                   
                      MOVE WS-HA-CTZNSHP(WS-CTR) TO WS-CTZNSHP                  
                   ELSE                                                         
                      IF (WS-OC-FND(WS-CTR) = 'Y' AND                           
                          WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')               
                         MOVE WS-OC-RLTNSHP(WS-CTR) TO WS-SPOUSE                
                         MOVE WS-OC-CTZNSHP(WS-CTR) TO WS-CTZNSHP               
                      END-IF                                                    
                   END-IF                                                       
                   IF VALID-SPOUSE                                              
                      IF NOT VALID-SG-CITIZEN                                   
                         MOVE 'Y'                    TO WS-SP-NONCTZ-FND        
                      ELSE                                                      
                         MOVE 'Y'                    TO WS-SP-FND               
                      END-IF                                                    
                      MOVE WS-MAX-OCCUP-PER-REGNO    TO WS-CTR                  
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 IF WS-SP-NONCTZ-FND = 'Y'                                      
                    MOVE 'SPOUSE NOT SG CTZ' TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 ELSE                                                           
                    IF WS-SP-FND = 'N'                                          
                       MOVE 'SPOUSE NOT FOUND'  TO WS-REJ-REMARK                
                       MOVE 'Y'                 TO WS-REJ                       
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 4  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSC')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 5  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSE')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 6  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'SAP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSC' OR 'SSE')                        
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 7  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NCS')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 8  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NSE')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 9  MAIN APPLICANT HA1 NOT FOUND                          
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'SAP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NCS' OR 'NSE' OR 'PA ')               
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 10  MAIN APPLICANT HA1 OR HA2 NOT FOUND                  
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'JSS')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
                                                                                
                 IF (WS-REJ NOT = 'Y' AND                                       
                     WS-K862-NUM-CORE-NUCLEUS(02) NOT = 'Y')                    
                    MOVE 'HA2 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 11  MAIN APPLICANT HA1 OR HA2 NOT FOUND                  
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'JSE')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
                                                                                
                 IF (WS-REJ NOT = 'Y' AND                                       
                     WS-K862-NUM-CORE-NUCLEUS(02) NOT = 'Y')                    
                    MOVE 'HA2 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***REJECTED CASE 12  MAIN APPLICANT HA1, HA2 OR OC NOT FOUND              
           IF WS-REJ = 'N'                                                      
              IF (K800-NUM-ALLO-SCHEME = 'PA ') AND                             
                 (K800-NUM-ELIG-SCHEME = 'OR ')                                 
                 IF (WS-HA-RLTNSHP(01) NOT = '00' AND                           
                     WS-K862-NUM-CORE-NUCLEUS(01) NOT = 'Y')                    
                    MOVE 'HA1 NOT FOUND'     TO WS-REJ-REMARK                   
                    MOVE 'Y'                 TO WS-REJ                          
                 END-IF                                                         
                                                                                
                 IF (WS-REJ NOT = 'Y' AND                                       
                     WS-K862-NUM-CORE-NUCLEUS(02) NOT = 'Y')                    
                    MOVE 'N' TO WS-OCP-FND                                      
                    PERFORM VARYING WS-CTR FROM 5 BY 1                          
                      UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                     
                      IF WS-OC-FND(WS-CTR) = 'Y'                                
                         MOVE 'Y'                    TO WS-OCP-FND              
                         MOVE WS-MAX-OCCUP-PER-REGNO TO WS-CTR                  
                      END-IF                                                    
                    END-PERFORM                                                 
                                                                                
                    IF (WS-OCP-FND = 'N')                                       
                       MOVE 'HA2/OC NOT FOUND'  TO WS-REJ-REMARK                
                       MOVE 'Y'                 TO WS-REJ                       
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       550-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ****************************************************************          
       560-DETERMINE-SUBSIDY-TAG.                                               
      ****************************************************************          
                                                                                
      ***CASE 1                                                                 
           IF (K800-NUM-ALLO-SCHEME = 'PA ' OR 'GRO' OR                         
                                      'MCP' OR 'TPS' OR                         
                                      'REN' OR 'FSH') AND                       
              (K800-NUM-ELIG-SCHEME = 'FS ')                                    
                                                                                
              MOVE 'N'                    TO WS-FS-FND                          
              PERFORM VARYING WS-CTR FROM 1 BY 1                                
                UNTIL WS-CTR > WS-MAX-HA                                        
                IF (WS-HA-RLTNSHP(WS-CTR) = '00' AND                            
                    WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                     
                   MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)                 
                END-IF                                                          
                IF (WS-HA-RLTNSHP(WS-CTR) = '09' AND                            
                    WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                     
                   MOVE 'Y'               TO WS-FS-FND                          
                   MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)                 
                END-IF                                                          
              END-PERFORM                                                       
                                                                                
              IF WS-FS-FND = 'N'                                                
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OC                                     
                   COMPUTE WS-A = WS-CTR + WS-MAX-HA                            
                   IF (WS-OC-RLTNSHP(WS-A) = '09' AND                           
                       WS-K862-NUM-CORE-NUCLEUS(WS-A) = 'Y')                    
                      MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-A)                
                   END-IF                                                       
                 END-PERFORM                                                    
              END-IF                                                            
                                                                                
              MOVE 'Y'                    TO WS-TAG-OK                          
           END-IF.                                                              
                                                                                
      ***CASE 2                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'PA ' OR 'GRO' OR 'MCP' OR             
                                         'TCP' OR 'TPS' OR 'REN' OR             
      *BP139832 STARTS                                                          
                                         'FSH' OR 'SAP') AND                    
      *BP139832 STARTS                                                          
                 (K800-NUM-ELIG-SCHEME = 'PA ')                                 
                                                                                
                 MOVE 'N'              TO WS-SP-FND                             
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-HA                                     
                   IF (WS-HA-RLTNSHP(WS-CTR) = '00' AND                         
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-HA-RLTNSHP(WS-CTR) = '20' AND                         
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'Y'               TO WS-SP-FND                       
                      MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 IF WS-SP-FND = 'N'                                             
                    PERFORM VARYING WS-CTR FROM 1 BY 1                          
                      UNTIL WS-CTR > WS-MAX-OC                                  
                      COMPUTE WS-A = WS-CTR + WS-MAX-HA                         
                      IF (WS-OC-RLTNSHP(WS-A) = '20' AND                        
                          WS-K862-NUM-CORE-NUCLEUS(WS-A) = 'Y')                 
                         MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-A)             
                      END-IF                                                    
                    END-PERFORM                                                 
                 END-IF                                                         
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 3                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'TCP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'TCP')                                 
                                                                                
                 MOVE 'N'                    TO WS-SP-FND                       
                 PERFORM VARYING WS-CTR FROM 1 BY 1                             
                   UNTIL WS-CTR > WS-MAX-HA                                     
                   IF (WS-HA-RLTNSHP(WS-CTR) = '00' AND                         
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-HA-RLTNSHP(WS-CTR) = '20' AND                         
                       WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'Y'               TO WS-SP-FND                       
                      MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 IF WS-SP-FND = 'N'                                             
                    PERFORM VARYING WS-CTR FROM 1 BY 1                          
                      UNTIL WS-CTR > WS-MAX-OC                                  
                      COMPUTE WS-A = WS-CTR + WS-MAX-HA                         
                      IF (WS-OC-RLTNSHP(WS-A) = '20' AND                        
                          WS-K862-NUM-CORE-NUCLEUS(WS-A) = 'Y')                 
                         MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-A)             
                      END-IF                                                    
                    END-PERFORM                                                 
                 END-IF                                                         
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 4                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSC')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES) OR                   
                      (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 5                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSE')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES) OR                   
                      (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 6                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'SAP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'SSC' OR 'SSE')                        
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES) OR                   
                      (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 7                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NCS')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-OC-RLTNSHP(WS-CTR) = '20') AND                        
                      (WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'WS' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   ELSE                                                         
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 8                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NSE')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-OC-RLTNSHP(WS-CTR) = '20') AND                        
                      (WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'WS' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   ELSE                                                         
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 9                                                                 
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'SAP') AND                             
                 (K800-NUM-ELIG-SCHEME = 'NCS' OR 'NSE' OR 'PA ')               
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WF' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                 PERFORM VARYING WS-CTR FROM 2 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-OC-RLTNSHP(WS-CTR) = '20') AND                        
                      (WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')                  
                      MOVE 'WS' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   ELSE                                                         
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 10                                                                
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'FTS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'JSS')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                                                                                
                 IF WS-K862-NUM-CORE-NUCLEUS(2) = 'Y'                           
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(2)                     
                 END-IF                                                         
                                                                                
                 PERFORM VARYING WS-CTR FROM 3 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 11                                                                
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'STS') AND                             
                 (K800-NUM-ELIG-SCHEME = 'JSE')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                                                                                
                 IF WS-K862-NUM-CORE-NUCLEUS(2) = 'Y'                           
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(2)                     
                 END-IF                                                         
                                                                                
                 PERFORM VARYING WS-CTR FROM 3 BY 1                             
                   UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                        
                   IF (WS-HA-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                   IF (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES)                      
                      MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)              
                   END-IF                                                       
                 END-PERFORM                                                    
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 12                                                                
           IF WS-TAG-OK = 'N'                                                   
              IF (K800-NUM-ALLO-SCHEME = 'PA ') AND                             
                 (K800-NUM-ELIG-SCHEME = 'OR ')                                 
                 IF (WS-HA-RLTNSHP(1) = '00' AND                                
                     WS-K862-NUM-CORE-NUCLEUS(1) = 'Y')                         
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(1)                     
                 END-IF                                                         
                                                                                
                 IF WS-K862-NUM-CORE-NUCLEUS(2) = 'Y'                           
                    MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(2)                     
                 ELSE                                                           
                    PERFORM VARYING WS-CTR FROM 3 BY 1                          
                      UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                     
                      IF (WS-OC-RLTNSHP(WS-CTR) NOT = SPACES AND                
                          WS-K862-NUM-CORE-NUCLEUS(WS-CTR) = 'Y')               
                         MOVE 'WH' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)           
                      ELSE                                                      
                         MOVE '  ' TO WS-K862-NUM-SUBSIDY-TAG(WS-CTR)           
                      END-IF                                                    
                    END-PERFORM                                                 
                 END-IF                                                         
                                                                                
                 MOVE 'Y'                    TO WS-TAG-OK                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
      ***CASE 13 (UNDETERMINE)                                                  
           IF (WS-REJ = 'N') AND                                                
              (WS-TAG-OK = 'N')                                                 
              MOVE 'UNDETERMINED'      TO WS-REJ-REMARK                         
              MOVE 'Y'                 TO WS-REJ                                
           END-IF.                                                              
                                                                                
       560-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ****************************************************************          
       570-MOVE-EMPTY-K862-RECORD-ARY.                                          
      ****************************************************************          
                                                                                
           PERFORM VARYING WS-CTR FROM 1 BY 1                                   
             UNTIL WS-CTR > WS-MAX-OCCUP-PER-REGNO                              
             IF WS-K862-NUM-ROLE(WS-CTR) = SPACES                               
                MOVE WS-CTR TO WS-B                                             
                ADD 1       TO WS-B                                             
                PERFORM VARYING WS-A FROM WS-B BY 1                             
                  UNTIL WS-A > WS-MAX-OCCUP-PER-REGNO                           
                  IF WS-K862-NUM-ROLE(WS-A) NOT = SPACES                        
                     MOVE WS-K862-NUM-ROLE(WS-A) TO                             
                          WS-K862-NUM-ROLE(WS-CTR)                              
                     MOVE WS-K862-NUM-REGN(WS-A) TO                             
                          WS-K862-NUM-REGN(WS-CTR)                              
                     MOVE WS-K862-NUM-NRIC(WS-A) TO                             
                          WS-K862-NUM-NRIC(WS-CTR)                              
                     MOVE WS-K862-NUM-SUBSIDY-TAG(WS-A) TO                      
                          WS-K862-NUM-SUBSIDY-TAG(WS-CTR)                       
                     MOVE WS-K862-NUM-CORE-NUCLEUS(WS-A) TO                     
                          WS-K862-NUM-CORE-NUCLEUS(WS-CTR)                      
                     MOVE WS-K862-NUM-RELATIONSHIP(WS-A) TO                     
                          WS-K862-NUM-RELATIONSHIP(WS-CTR)                      
                     MOVE WS-HA-FND(WS-A)     TO WS-HA-FND(WS-CTR)              
                     MOVE WS-OC-FND(WS-A)     TO WS-OC-FND(WS-CTR)              
                     MOVE WS-HA-RLTNSHP(WS-A) TO WS-HA-RLTNSHP(WS-CTR)          
                     MOVE WS-OC-RLTNSHP(WS-A) TO WS-OC-RLTNSHP(WS-CTR)          
                     MOVE WS-HA-CTZNSHP(WS-A) TO WS-HA-CTZNSHP(WS-CTR)          
                     MOVE WS-OC-CTZNSHP(WS-A) TO WS-OC-CTZNSHP(WS-CTR)          
                                                                                
                     MOVE SPACES  TO WS-K862-NUM-ROLE(WS-A)                     
                                     WS-K862-NUM-REGN(WS-A)                     
                                     WS-K862-NUM-NRIC(WS-A)                     
                                     WS-K862-NUM-SUBSIDY-TAG(WS-A)              
                                     WS-K862-NUM-CORE-NUCLEUS(WS-A)             
                                     WS-K862-NUM-RELATIONSHIP(WS-A)             
                                     WS-HA-FND(WS-A)                            
                                     WS-OC-FND(WS-A)                            
                                     WS-HA-RLTNSHP(WS-A)                        
                                     WS-OC-RLTNSHP(WS-A)                        
                                     WS-HA-CTZNSHP(WS-A)                        
                                     WS-OC-CTZNSHP(WS-A)                        
                                                                                
                     MOVE WS-MAX-OCCUP-PER-REGNO TO WS-A                        
                  END-IF                                                        
                END-PERFORM                                                     
             END-IF                                                             
           END-PERFORM.                                                         
                                                                                
       570-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       600-WRITE-HSNG-SUBSIDY-TAG.                                              
      ******************************************************************        
                                                                                
           MOVE SPACES                          TO BP13K862-REC.                
           MOVE WS-K862-NUM-REGN(WS-CTR)        TO K862-NUM-REGN.               
           MOVE WS-K862-NUM-NRIC(WS-CTR)        TO K862-NUM-NRIC.               
           MOVE WS-K862-NUM-SUBSIDY-TAG(WS-CTR) TO K862-NUM-SUBSIDY-TAG.        
           MOVE 'Y'                             TO K862-NUM-AUTO-TAG.           
           MOVE WS-DATE                         TO K862-DTE-UPDATE.             
           MOVE 'BP13C26O'                      TO K862-NUM-USERID.             
                                                                                
           WRITE BP13K862-REC.                                                  
                                                                                
           EVALUATE K862-STATUS                                                 
               WHEN 00                                                          
               WHEN 02                                                          
                    ADD 1                       TO WS-K862-WRITE                
               WHEN OTHER                                                       
                    DISPLAY 'BP13C26O-E11: BP13K862 WRITE ERROR.'               
                    DISPLAY 'BP13K862 KEY-FLD : ' K862-KEY-FLD                  
                    DISPLAY 'K862-STATUS      : ' K862-STATUS                   
                    MOVE 111                  TO RETURN-CODE                    
                    PERFORM 999-CLOSE-FILES THRU 999-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       600-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       700-WRITE-EXCEPTION-RECORD.                                              
      ******************************************************************        
                                                                                
           IF (WS-L26O-WRITE = ZEROES) OR                                       
              (WS-C26O-CNT > WS-C26O-MAX-LINE)                                  
              PERFORM 710-WRITE-EXCEPTION-HEADER THRU 710-EXIT                  
           END-IF.                                                              
                                                                                
           ADD 1                         TO WS-L26O-WRITE.                      
           MOVE WS-L26O-WRITE            TO L26O-NUM-SNO.                       
                                                                                
           IF WS-K800-NUM-HLA NOT = SPACES AND LOW-VALUES                       
              PERFORM 705-FLAT-ELGBTY-CASE THRU 705-EXIT                        
           ELSE                                                                 
              MOVE ZEROES                TO WS-NUM-HFE-APPRV-DATE               
           END-IF.                                                              
           MOVE WS-NUM-HFE-APPRV-DATE    TO L26O-NUM-HFE-APPRV-DATE.            
                                                                                
           MOVE WS-REJ-REMARK            TO L26O-NUM-REMARK.                    
                                                                                
           WRITE BP13L26O-REC          FROM WS-L26O-DETAILS.                    
           WRITE BP13L26O-REC          FROM WS-L26O-DETAILS-BLANK.              
           ADD 2                         TO WS-C26O-CNT.                        
                                                                                
       700-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *************************************************************             
       705-FLAT-ELGBTY-CASE.                                                    
      *************************************************************             
           EXEC SQL                                                             
             SELECT DTE_APRV                                                    
               INTO :DCLFLAT-ELGBTY-CASE.DTE-APRV                               
               FROM FLAT_ELGBTY_CASE                                            
              WHERE NUM_ELGBTY_CASE = :WS-K800-NUM-HLA                          
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
           WHEN ZEROES                                                          
                STRING DTE-APRV(1:4)                                            
                       DTE-APRV(6:2)                                            
                       DTE-APRV(9:2)                                            
                  DELIMITED BY SIZE INTO WS-NUM-HFE-APPRV-DATE                  
                                                                                
           WHEN 100                                                             
                MOVE ZEROES                 TO WS-NUM-HFE-APPRV-DATE            
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'BP13C26O-E12: SELECT FLAT_ELGBTY_CASE ERROR'           
                DISPLAY 'SQLCODE         : ' SQLCODE                            
                DISPLAY 'NUM_ELGBTY_CASE : ' WS-K800-NUM-HLA                    
                MOVE 111                    TO RETURN-CODE                      
                PERFORM 900-ABORT-PROCESS THRU 900-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       705-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       710-WRITE-EXCEPTION-HEADER.                                              
      ******************************************************************        
                                                                                
           ADD 1                      TO WS-C26O-PAGE.                          
           MOVE WS-C26O-PAGE          TO WS-RPT-PRT-PAGE.                       
                                                                                
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER1 AFTER PAGE.                 
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER2.                            
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER6-BLANK.                      
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER3.                            
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER4.                            
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER5-LINE                        
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-HEADER6-BLANK.                      
                                                                                
           MOVE 7                     TO WS-C26O-CNT.                           
                                                                                
       710-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       720-WRITE-EXCEPTION-NIL.                                                 
      ******************************************************************        
                                                                                
           MOVE SPACES                TO BP13L26O-REC.                          
           WRITE BP13L26O-REC       FROM WS-L26O-DETAILS-NIL.                   
                                                                                
       720-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       900-ABORT-PROCESS.                                                       
      ******************************************************************        
                                                                                
           MOVE SQLCODE                     TO WS-SQLCODE.                      
           CALL 'DBATIAR' USING SQLCA.                                          
           DISPLAY 'ABEND    SQLCODE = ' SQLCODE.                               
           EXEC SQL ROLLBACK END-EXEC.                                          
           DISPLAY 'ROLLBACK SQLCODE = ' SQLCODE.                               
           PERFORM 999-CLOSE-FILES          THRU 999-EXIT.                      
                                                                                
       900-EXIT.                                                                
           EXIT.                                                                
                                                                                
      ******************************************************************        
       999-CLOSE-FILES.                                                         
      ******************************************************************        
                                                                                
           DISPLAY SPACES.                                                      
           DISPLAY '*==========================================*'.              
           DISPLAY 'BP13C26O-I02: CONTROL SUMMARY'.                             
           DISPLAY 'NO. OF DAYS : ' INPUT-CHAR-DAYS.                            
           DISPLAY 'FROM DATE   : ' WS-FROM-DATE.                               
           DISPLAY 'TO   DATE   : ' WS-TO-DATE.                                 
           DISPLAY 'NO. OF BP13F200 RCD PROCESSED : ' WS-F200-READ.             
           DISPLAY 'NO. OF ACCEPTED REGN          : ' WS-ACCEPTED-CNT.          
           DISPLAY 'NO. OF REJECTED REGN          : ' WS-REJECTED-CNT.          
           DISPLAY 'NO. OF BYPASS REGN            : ' WS-BYPASS-CNT.            
      *BP139832 START                                                           
           DISPLAY 'NO. OF BYPASS TAGGED K862     : ' WS-K862-BYPASS.           
           DISPLAY 'NO. OF CANCELLED REGN         : ' WS-CANCEL-CNT.            
           DISPLAY 'NO. OF BOOKED FLAT            : ' WS-BF-CNT.                
           DISPLAY 'NO. OF BP13K800 NOT FOUND     : ' WS-K800-NF-CNT.           
      *BP139832 END                                                             
           DISPLAY SPACES.                                                      
           DISPLAY 'NO. OF SUBSIDY TAG WRITTEN    : ' WS-K862-WRITE.            
           DISPLAY 'NO. OF VALID TAG              : ' WS-K862-ACP-WRITE.        
           DISPLAY 'NO. OF EXCEPTION TAG          : ' WS-K862-REJ-WRITE.        
           DISPLAY '*==========================================*'.              
                                                                                
           CLOSE BP13F200                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K862                                                       
                 SY02F001                                                       
                 BP13L26O.                                                      
                                                                                
           IF K800-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E13: BP13K800 FILE CLOSING ERROR.'              
              DISPLAY 'K800-STATUS : ' K800-STATUS                              
              MOVE 111                TO RETURN-CODE                            
           END-IF.                                                              
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E14: BP13K820 FILE CLOSING ERROR.'              
              DISPLAY 'K820-STATUS : ' K820-STATUS                              
              MOVE 111                TO RETURN-CODE                            
           END-IF.                                                              
                                                                                
           IF K862-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13C26O-E15: BP13K862 FILE CLOSING ERROR.'              
              DISPLAY 'K862-STATUS : ' K862-STATUS                              
              MOVE 111                TO RETURN-CODE                            
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
        999-EXIT.                                                               
            EXIT.                                                               
