      *-------------------------*                                               
       IDENTIFICATION DIVISION.                                                 
      *-------------------------*                                               
       PROGRAM-ID.    BP13C277.                                                 
      *AUTHOR.        JIJO FRANCIS.                                             
      *DATE-WRITTEN.  19/04/2003.                                               
      *===============================================================*         
      *~~~~~~~~~~~~ SYSTEM OF COMMITMENT  (BP13) ~~~~~~~~~~~~~~~~~~~~~*         
      *===============================================================*         
      *  OBJECTIVE :  TO PRINT REPORT ON ONLINE UPDATE OF CURRENT     *         
      *               SELLING PRICE FOR APPLICATIONS UNDER RED SCHEME *         
      *               -AFTER ACCEPTANCE.                              *         
      *                                                               *         
      * CHG-NO   BY   ON          DESCRIPTION                         *         
      * -------- ---  ------      -----------                         *         
      * BP132337 JF4  19/04/2003  NEW PROGRAM.                        *         
      *****************************************************************         
                                                                                
      *----------------------*                                                  
       ENVIRONMENT DIVISION.                                                    
      *----------------------*                                                  
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13F310 ASSIGN TO BP13F310.                                  
                                                                                
           SELECT BM06K110 ASSIGN          TO BM06K110                          
                           ACCESS MODE     IS RANDOM                            
                           ORGANIZATION    IS INDEXED                           
                           RECORD KEY      IS K110-KEY-FLD                      
                           FILE STATUS     IS WS-K110-STATUS.                   
                                                                                
           SELECT BP13K800 ASSIGN          TO BP13K800                          
                           ACCESS MODE     IS RANDOM                            
                           ORGANIZATION    IS INDEXED                           
                           RECORD KEY      IS K800-NUM-REGN                     
                           FILE STATUS     IS WS-K800-STATUS.                   
                                                                                
           SELECT BP13K820 ASSIGN          TO BP13K820                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS DYNAMIC                           
                           RECORD KEY      IS K820-KEY-FLD                      
                           FILE STATUS     IS WS-K820-STATUS.                   
                                                                                
           SELECT BP13K830 ASSIGN          TO BP13K830                          
                           ORGANIZATION    IS INDEXED                           
                           ACCESS MODE     IS RANDOM                            
                           RECORD KEY      IS K830-KEY-FLD                      
                           ALTERNATE RECORD KEY IS K830-NUM-REGN                
                                            WITH DUPLICATES                     
                           FILE STATUS     IS WS-K830-STATUS.                   
                                                                                
           SELECT P13L277A ASSIGN TO P13L277A.                                  
                                                                                
           SELECT P13L277B ASSIGN TO P13L277B.                                  
                                                                                
      *---------------*                                                         
       DATA DIVISION.                                                           
      *---------------*                                                         
       FILE SECTION.                                                            
                                                                                
       FD  BP13F310                                                             
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 CHARACTERS                                         
           RECORD CONTAINS 150 CHARACTERS                                       
           LABEL RECORDS IS STANDARD.                                           
       COPY BP13F310.                                                           
                                                                                
       FD  BM06K110                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
       COPY BM06K110.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13K800.                                                           
                                                                                
       FD BP13K820                                                              
           RECORD CONTAINS 400 CHARACTERS.                                      
       COPY BP13K820.                                                           
                                                                                
       FD BP13K830                                                              
           RECORD CONTAINS 250 CHARACTERS.                                      
       COPY BP13K830.                                                           
                                                                                
       FD  P13L277A                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P13L277A-REC            PIC X(132).                                  
                                                                                
       FD  P13L277B                                                             
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           LABEL RECORDS ARE OMITTED.                                           
       01  P13L277B-REC            PIC X(132).                                  
                                                                                
                                                                                
      *-------------------------*                                               
       WORKING-STORAGE SECTION.                                                 
      *-------------------------*                                               
                                                                                
       01  WS-DATE                 PIC X(8)   VALUE SPACES.                     
                                                                                
       01  WS-SCH-ACC-NO.                                                       
           05  WS-SCHEME           PIC X(4)   VALUE SPACES.                     
           05  WS-ACC              PIC X(4)   VALUE SPACES.                     
           05  WS-CHK              PIC X      VALUE SPACES.                     
           05  WS-ACC-TY           PIC X(2)   VALUE SPACES.                     
                                                                                
       01  WS-TENANCY-DATE.                                                     
           05  WS-TEN-CC           PIC X(2).                                    
           05  WS-TEN-YY           PIC X(2).                                    
           05  WS-TEN-MM           PIC X(2).                                    
           05  WS-TEN-DD           PIC X(2).                                    
                                                                                
       01  WS-PERIOD-TENANCY       PIC 9(2).                                    
       01  WS-DIFF                 PIC 9(2)   VALUE ZEROS.                      
       01  WS-FLAT-DISC-ROUND      PIC 9(6)   VALUE ZEROS.                      
       01  WS-FLAT-DISCOUNT        PIC 9(6)   VALUE ZEROS.                      
       01  WS-TEMP-DISCOUNT        PIC 9(6)   VALUE ZEROS.                      
       01  WS-PRICE                PIC 9(8).                                    
                                                                                
       01  WS-K110-STATUS          PIC 99     VALUE ZEROS.                      
       01  WS-K800-STATUS          PIC 99     VALUE ZEROS.                      
       01  WS-K820-STATUS          PIC 99     VALUE ZEROS.                      
       01  WS-K830-STATUS          PIC 99     VALUE ZEROS.                      
       01  WS-K800-MATCH           PIC X.                                       
       01  WS-K110-MATCH           PIC X.                                       
       01  WS-K830-MATCH           PIC X.                                       
       01  WS-EOF-F310             PIC X.                                       
       01  WS-FLAG                 PIC X      VALUE 'N'.                        
       01  WS-CURR-SELLING-PRICE   PIC 9(8).                                    
       01  WS-TEMP-SELL-PRICE REDEFINES WS-CURR-SELLING-PRICE.                  
           05  WS-TEMP             PIC 9(6).                                    
           05  WS-TEMP-TENS        PIC 9(2).                                    
                                                                                
       01  WS-PCT20-SPRICE         PIC 9(8)   VALUE ZEROS.                      
       01  WS-MAX-DISCOUNT-AMT     PIC 9(5)   VALUE 30000.                      
       01  WS-CNT-READ-F310        PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-READ-K800        PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-READ-K820        PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-READ-K830        PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-READ-K110        PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-PRINT            PIC 9(8)   VALUE ZEROS.                      
       01  WS-REN-DISC             PIC 9(8)   VALUE ZEROS.                      
       01  WS-OCS-DISC             PIC 9(8)   VALUE ZEROS.                      
       01  WS-CURR-SPRICE          PIC 9(8)   VALUE ZEROS.                      
       01  WS-CNT-UPDATE           PIC 9(5)   VALUE ZEROS.                      
       01  WS-CNT-LOG              PIC 9(5)   VALUE ZEROS.                      
       01  WS-EDIT-CNT             PIC Z(7)9.                                   
                                                                                
       01  WS-LISTING-CONTROLS.                                                 
           05  WS-SEQ              PIC 9(5)   VALUE ZEROS.                      
           05  WS-SEQ1             PIC 9(5)   VALUE ZEROS.                      
           05  CNT-PAGE            PIC 9(5)   VALUE ZEROS.                      
           05  CNT-PAGE1           PIC 9(5)   VALUE ZEROS.                      
           05  CNT-NUM-LINE        PIC 9(5)   VALUE ZEROS.                      
           05  CNT-NUM-LINE1       PIC 9(5)   VALUE ZEROS.                      
                                                                                
      ******************************************************************        
      *    P13L277A-REC                                                *        
      ******************************************************************        
                                                                                
       01  L277A-PR-HEAD-01.                                                    
           05  FILLER              PIC X(8)      VALUE 'P13L277A'.              
           05  FILLER              PIC X(4)      VALUE SPACES .                 
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(33)     VALUE SPACES.                  
           05  FILLER              PIC X(22)     VALUE                          
                                    'SYSTEM OF COMMITMENT'.                     
           05  FILLER              PIC X(20)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE :'.                
           05  L277A-DATE          PIC X(10).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  L277A-PAGENO        PIC ZZZZ9 .                                  
           05  FILLER              PIC X(6)      VALUE SPACES.                  
                                                                                
       01  L277A-PR-HEAD-02.                                                    
           05  FILLER              PIC X(35)     VALUE SPACES.                  
           05  FILLER              PIC X(55)     VALUE                          
           'REPORT ON ONLINE UPDATE OF CURRENT SELLING PRICE FOR   '.           
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  FILLER              PIC X(27)     VALUE                          
           'USER : SALES UNIT, RHS, PPU'.                                       
                                                                                
       01  L277A-PR-HEAD-03.                                                    
           05  FILLER              PIC X(37)     VALUE SPACES.                  
           05  FILLER              PIC X(49)     VALUE                          
           'APPLICATIONS UNDER RED SCHEME - AFTER ACCEPTANCE'.                  
           05  FILLER              PIC X(08) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE ' USER ID : '.               
           05  L277A-USERID        PIC X(08).                                   
                                                                                
       01  L277A-PR-HEAD-04.                                                    
           05  FILLER              PIC X(14) VALUE ' S/NO  REGN NO'.            
           05  FILLER              PIC X(09) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NT  '.                      
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'FLAT'.                      
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'OFFER    '.                 
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'CURRENT  '.                 
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'REN DISC'.                  
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'OCS DISC'.                  
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(23) VALUE 'FLAT ADDRESS'.              
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'ACCEPTANCE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'PD'.                        
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE 'START'.                     
                                                                                
       01  L277A-PR-HEAD-05.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE 'HDB-REF    '.               
           05  FILLER              PIC X(10) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TYPE'.                      
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'SELL PRICE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'SELL PRICE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'AMOUNT    '.                
           05  FILLER              PIC X(33) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'DATE      '.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(03) VALUE 'TEN'.                       
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'DATE'.                      
                                                                                
       01  L277A-PR-HEAD-06.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(12) VALUE 'CORR-ADDRESS'.              
           05  FILLER              PIC X(39) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'BF ROUNDED'.                
                                                                                
       01  L277A-PR-HEAD-07.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE 'NRIC NO    '.               
           05  FILLER              PIC X(04) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NAME'.                      
           05  FILLER              PIC X(44) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE '   T1'.                     
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE '   T2'.                     
           05  FILLER              PIC X(40) VALUE SPACES.                      
                                                                                
      ******************************************************************        
      *    P13L277B-REC                                                *        
      ******************************************************************        
                                                                                
       01  L277B-PR-HEAD-01.                                                    
           05  FILLER              PIC X(8)      VALUE 'P13L277B'.              
           05  FILLER              PIC X(4)      VALUE SPACES .                 
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(35)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                    'SYSTEM OF COMMITMENT'.                     
           05  FILLER              PIC X(20)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE :'.                
           05  L277B-DATE          PIC X(10).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  L277B-PAGENO        PIC ZZZZ9 .                                  
           05  FILLER              PIC X(6)      VALUE SPACES.                  
                                                                                
       01  L277B-PR-HEAD-02.                                                    
           05  FILLER              PIC X(35)     VALUE SPACES.                  
           05  FILLER              PIC X(55)     VALUE                          
           'REPORT ON ONLINE UPDATE OF CURRENT SELLING PRICE FOR   '.           
           05  FILLER              PIC X(05)     VALUE SPACES.                  
           05  FILLER              PIC X(27)     VALUE                          
           'USER : SALES UNIT, RHS, PPU'.                                       
                                                                                
       01  L277B-PR-HEAD-03.                                                    
           05  FILLER              PIC X(37)     VALUE SPACES.                  
           05  FILLER              PIC X(49)     VALUE                          
           'APPLICATIONS UNDER RED SCHEME - AFTER ACCEPTANCE'.                  
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE ' USER ID : '.               
           05  L277B-USERID        PIC X(08).                                   
                                                                                
       01  L277B-PR-HEAD-04.                                                    
           05  FILLER              PIC X(14) VALUE ' S/NO  REGN NO'.            
           05  FILLER              PIC X(09) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NT  '.                      
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'FLAT'.                      
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'OFFER    '.                 
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'CURRENT  '.                 
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'REN DISC'.                  
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(08) VALUE 'OCS DISC'.                  
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(23) VALUE 'FLAT ADDRESS'.              
           05  FILLER              PIC X(01) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'ACCEPTANCE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(02) VALUE 'PD'.                        
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE 'START'.                     
                                                                                
       01  L277B-PR-HEAD-05.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE 'HDB-REF    '.               
           05  FILLER              PIC X(10) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'TYPE'.                      
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'SELL PRICE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'SELL PRICE'.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'AMOUNT    '.                
           05  FILLER              PIC X(33) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'DATE      '.                
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(03) VALUE 'TEN'.                       
           05  FILLER              PIC X(02) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'DATE'.                      
                                                                                
       01  L277B-PR-HEAD-06.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(12) VALUE 'CORR-ADDRESS'.              
           05  FILLER              PIC X(39) VALUE SPACES.                      
           05  FILLER              PIC X(10) VALUE 'BF ROUNDED'.                
                                                                                
       01  L277B-PR-HEAD-07.                                                    
           05  FILLER              PIC X(07) VALUE SPACES.                      
           05  FILLER              PIC X(11) VALUE 'NRIC NO    '.               
           05  FILLER              PIC X(04) VALUE SPACES.                      
           05  FILLER              PIC X(04) VALUE 'NAME'.                      
           05  FILLER              PIC X(44) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE '   T1'.                     
           05  FILLER              PIC X(03) VALUE SPACES.                      
           05  FILLER              PIC X(05) VALUE '   T2'.                     
           05  FILLER              PIC X(40) VALUE SPACES.                      
                                                                                
       01  L277B-PR-HEAD-08.                                                    
           05  FILLER              PIC X(13) VALUE 'CHECKED BY : '.             
           05  FILLER              PIC X(36) VALUE                              
                            '------------------------------------'.             
       01  L277B-PR-HEAD-09.                                                    
           05  FILLER              PIC X(34) VALUE                              
                      '            (NAME AND DESIGNATION)'.                     
                                                                                
       01  L277B-PR-HEAD-10.                                                    
           05  FILLER              PIC X(18) VALUE 'DATE AND INITIAL :'.        
           05  FILLER              PIC X(36) VALUE                              
                            '------------------------------------'.             
                                                                                
       01  L277A-PR-DETAIL.                                                     
           05  L277A-NO            PIC ZZZZ9.                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277A-CUR-REGN-NO   PIC X(8).                                    
           05  FILLER              PIC X(8)      VALUE SPACES.                  
           05  L277A-NT            PIC X(3).                                    
           05  FILLER              PIC X(04)      VALUE SPACES.                 
           05  L277A-FLAT          PIC X(2).                                    
           05  FILLER              PIC X(03)      VALUE SPACES.                 
           05  L277A-OFFR-SPRICE   PIC ZZ,ZZZ,ZZ9.                              
           05  FILLER              PIC X(1) VALUE SPACES.                       
           05  L277A-CURR-SPRICE   PIC ZZ,ZZZ,ZZ9.                              
           05  FILLER              PIC X(3)      VALUE SPACES.                  
           05  L277A-AMT-FLAT-DISC PIC ZZ,ZZ9.                                  
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277A-OCS-FLAT-DISC PIC ZZ,ZZ9.                                  
           05  FILLER              PIC X(4)      VALUE SPACES.                  
           05  L277A-BLK           PIC X(04)     VALUE 'BLK '.                  
           05  L277A-BLK-NO        PIC X(05).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277A-FLAT-NO.                                                   
               10  L277A-HEX       PIC X(02)     VALUE '# '.                    
               10  L277A-LEVEL-NO  PIC X(02).                                   
               10  L277A-DASH      PIC X(01)     VALUE '-'.                     
               10  L277A-UNIT-NO   PIC X(04).                                   
               10  L277A-SUB-UNIT  PIC X(03).                                   
           05  FILLER              PIC X(03)  VALUE SPACES.                     
           05  L277A-DTE-ACCEPT    PIC X(10)  VALUE SPACES.                     
           05  FILLER              PIC X(2)   VALUE SPACES.                     
           05  L277A-PERIOD-TENANCY PIC X(02) VALUE SPACES.                     
           05  FILLER              PIC X(2)   VALUE SPACES.                     
           05  L277A-ST-DATE       PIC X(10)  VALUE SPACES.                     
                                                                                
       01  L277A-PR-DETAIL-A.                                                   
           05  FILLER              PIC X(7) VALUE SPACES.                       
           05  L277A-SCHEME        PIC 9(4).                                    
           05  L277A-D1            PIC X.                                       
           05  L277A-ACC           PIC 9(4).                                    
           05  L277A-D2            PIC X.                                       
           05  L277A-CHK           PIC 9.                                       
           05  L277A-D3            PIC X.                                       
           05  L277A-ACC-TYPE      PIC 9(2).                                    
           05  FILLER              PIC X(24)     VALUE SPACES.                  
           05  L277A-ERR-DISC      PIC X(12).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277A-BF-DISC-ROUND PIC ZZ,ZZ9.                                  
           05  WS-BF-DISC-ROUND REDEFINES L277A-BF-DISC-ROUND.                  
               10 L277A-BF-DISC-ROUND1 PIC X(6).                                
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  L277A-STREET        PIC X(20).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X(2)      VALUE 'S('.                    
           05  L277A-POSTAL-CODE   PIC X(6).                                    
           05  FILLER              PIC X(1)      VALUE ')'.                     
           05  FILLER              PIC X(2)      VALUE SPACES.                  
                                                                                
       01  L277A-PR-DETAIL-B.                                                   
           05  FILLER              PIC X(7)      VALUE SPACES.                  
           05  L277A-NRIC          PIC X(9).                                    
           05  FILLER              PIC X(6)      VALUE SPACES.                  
           05  L277A-NAME          PIC X(40).                                   
           05  FILLER              PIC X(12)     VALUE SPACES.                  
           05  L277A-SHAP1         PIC X.                                       
           05  FILLER              PIC X(06)     VALUE SPACES.                  
           05  L277A-SHAP2         PIC X.                                       
           05  FILLER              PIC X(52)     VALUE SPACES.                  
                                                                                
       01  L277B-PR-DETAIL-B.                                                   
           05  FILLER              PIC X(7)      VALUE SPACES.                  
           05  L277B-BLK           PIC X(04)     VALUE SPACES.                  
           05  L277B-BLK-NO        PIC X(05).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277B-FLAT-NO.                                                   
               10  L277B-HEX       PIC X(02)     VALUE SPACES.                  
               10  L277B-LEVEL-NO  PIC X(02).                                   
               10  L277B-DASH      PIC X(01)     VALUE SPACES.                  
               10  L277B-UNIT-NO   PIC X(04).                                   
               10  L277B-SUB-UNIT  PIC X(03).                                   
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  L277B-STREET        PIC X(20).                                   
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  L277B-POSTAL1       PIC X(2)      VALUE SPACES.                  
           05  L277B-POSTAL-CODE   PIC X(6).                                    
           05  L277B-POSTAL2       PIC X(1)      VALUE SPACES.                  
                                                                                
       01  L277A-PR-LINE.                                                       
           05  FILLER              PIC X         VALUE SPACES.                  
           05  FILLER              PIC X(131)    VALUE ALL '-'.                 
                                                                                
      *****************************************************************         
       PROCEDURE DIVISION.                                                      
      *****************************************************************         
      *---------------------------------------------------------------*         
       0000-MAIN-ROUTINE.                                                       
      *---------------------------------------------------------------*         
           PERFORM 1000-OPEN-FILES       THRU 1000-EXIT.                        
           PERFORM 2000-READ-F310        THRU 2000-EXIT.                        
           PERFORM 3000-PROCESS-F310     THRU 3000-EXIT                         
                                UNTIL WS-EOF-F310 = 'Y'.                        
           PERFORM 9000-CLOSE-ROUTINE    THRU 9000-EXIT.                        
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       1000-OPEN-FILES.                                                         
      *---------------------------------------------------------------*         
           OPEN INPUT  BP13F310                                                 
                       BP13K800                                                 
                       BP13K820                                                 
                       BP13K830                                                 
                       BM06K110                                                 
                OUTPUT P13L277A                                                 
                       P13L277B.                                                
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 OPENING ERROR, STATUS: ' WS-K110-STATUS         
              MOVE WS-K110-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-ROUTINE                                        
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 OPENING ERROR, STATUS: ' WS-K800-STATUS         
              MOVE WS-K800-STATUS  TO RETURN-CODE                               
              PERFORM 9000-CLOSE-ROUTINE                                        
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K820 OPENING ERROR, STATUS: ' WS-K820-STATUS         
              MOVE WS-K820-STATUS  TO RETURN-CODE                               
              PERFORM 9000-CLOSE-ROUTINE                                        
           END-IF.                                                              
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K830 OPENING ERROR, STATUS: ' WS-K830-STATUS         
              MOVE WS-K830-STATUS  TO RETURN-CODE                               
              PERFORM 9000-CLOSE-ROUTINE                                        
           END-IF.                                                              
                                                                                
           MOVE 60                   TO CNT-NUM-LINE.                           
           MOVE 60                   TO CNT-NUM-LINE1.                          
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       2000-READ-F310.                                                          
      *---------------------------------------------------------------*         
            READ BP13F310 AT END                                                
                MOVE 'Y' TO WS-EOF-F310                                         
                GO TO 2000-EXIT.                                                
                                                                                
            ADD 1                    TO WS-CNT-READ-F310.                       
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3000-PROCESS-F310.                                                       
      *---------------------------------------------------------------*         
           MOVE    SPACES            TO WS-K800-MATCH.                          
           MOVE    SPACES            TO WS-K110-MATCH.                          
           MOVE    ZEROES            TO WS-OCS-DISC.                            
           MOVE    ZEROES            TO WS-REN-DISC.                            
           MOVE    F310-REGN-NO      TO K800-NUM-REGN.                          
           PERFORM 3100-BP13K800-READ  THRU 3100-EXIT.                          
                                                                                
           IF WS-K800-MATCH = 'Y'                                               
            IF  K800-NUM-TENANCY-DISC = 'Y'  AND                                
                     K800-NUM-ALLO-SCHEME = 'RED'                               
                IF F310-SCH-ACC = K800-NUM-SCH-ACC                              
                   PERFORM 3200-BP13K830-READ      THRU 3200-EXIT               
                   PERFORM 3300-BM06K110-READ      THRU 3300-EXIT               
                   IF WS-K110-MATCH = 'Y'                                       
                      PERFORM 3350-COMPUTE-WS-DISC THRU 3350-EXIT               
                      PERFORM 3400-PRINT-LIST1     THRU 3400-EXIT               
                      PERFORM 3500-PRINT-LIST2     THRU 3500-EXIT               
                      ADD  1    TO WS-CNT-PRINT                                 
                   END-IF                                                       
                ELSE                                                            
                    DISPLAY 'F310-SCH-ACC NOT TALLY '                           
                             F310-SCH-ACC ' REGN=' F310-REGN-NO                 
                    DISPLAY 'K800 --> SCH-ACC, REGN'                            
                             K800-NUM-SCH-ACC ',' K800-NUM-REGN                 
                END-IF                                                          
             ELSE                                                               
                 DISPLAY 'NOT RED CASE F310-SCH= '                              
                             F310-SCH-ACC ' REGN=' F310-REGN-NO                 
                 DISPLAY 'K800-ALLOC-SCHEME --> ' K800-NUM-ALLO-SCHEME          
            END-IF                                                              
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-F310 THRU 2000-EXIT.                               
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3100-BP13K800-READ.                                                      
      *---------------------------------------------------------------*         
           READ BP13K800.                                                       
           EVALUATE WS-K800-STATUS                                              
             WHEN 00                                                            
               MOVE 'Y' TO WS-K800-MATCH                                        
               ADD  1   TO WS-CNT-READ-K800                                     
             WHEN 23                                                            
               MOVE 'N' TO WS-K800-MATCH                                        
               DISPLAY 'REC NOT FOUND IN K800 : ' K800-NUM-REGN                 
             WHEN OTHER                                                         
               DISPLAY 'BP13K800 READ ERROR, STATUS: ' WS-K800-STATUS           
               DISPLAY 'K800-NUM-REGN = ' K800-NUM-REGN                         
               MOVE WS-K800-STATUS TO RETURN-CODE                               
               PERFORM  9000-CLOSE-ROUTINE                                      
           END-EVALUATE.                                                        
                                                                                
       3100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3200-BP13K830-READ.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE BP13K830-REC.                                             
           MOVE K800-NUM-REGN  TO K830-NUM-REGN.                                
           READ BP13K830 KEY IS K830-NUM-REGN.                                  
           EVALUATE WS-K830-STATUS                                              
             WHEN 00                                                            
             WHEN 02                                                            
               MOVE K830-NUM-BLK-HDR          TO L277B-BLK                      
               MOVE K830-NUM-MAIN-BLK         TO L277B-BLK-NO                   
               MOVE K830-NUM-LVL-CHAR         TO L277B-HEX                      
               MOVE K830-NUM-LVL-NUM          TO L277B-LEVEL-NO                 
               MOVE K830-NUM-LVL-DASH         TO L277B-DASH                     
               MOVE K830-NUM-HSEMAIN          TO L277B-UNIT-NO                  
               MOVE K830-NUM-HSESUB           TO L277B-SUB-UNIT                 
               MOVE K830-NME-STREET           TO L277B-STREET                   
               MOVE 'S('                      TO L277B-POSTAL1                  
               MOVE K830-NUM-POSTAL           TO L277B-POSTAL-CODE              
               MOVE ')'                       TO L277B-POSTAL2                  
               ADD  1   TO WS-CNT-READ-K830                                     
             WHEN 23                                                            
               MOVE 'N' TO WS-K830-MATCH                                        
               DISPLAY 'REC NOT FOUND IN K830 : ' K830-NUM-REGN                 
             WHEN OTHER                                                         
               DISPLAY 'BP13K830 READ ERROR, STATUS: ' WS-K830-STATUS           
               DISPLAY 'K830-NUM-REGN = ' K830-NUM-REGN                         
               MOVE WS-K830-STATUS TO RETURN-CODE                               
               PERFORM  9000-CLOSE-ROUTINE                                      
           END-EVALUATE.                                                        
                                                                                
        3200-EXIT.                                                              
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       3300-BM06K110-READ.                                                      
      *---------------------------------------------------------------*         
           INITIALIZE K110-REC.                                                 
           MOVE F310-SCH-ACC  TO K110-KEY-FLD.                                  
           READ BM06K110.                                                       
           EVALUATE WS-K110-STATUS                                              
             WHEN 00                                                            
               MOVE 'Y' TO WS-K110-MATCH                                        
               ADD  1   TO WS-CNT-READ-K110                                     
             WHEN 23                                                            
               MOVE 'N' TO WS-K110-MATCH                                        
               DISPLAY 'REC NOT FOUND IN K110 : ' K110-KEY-FLD                  
             WHEN OTHER                                                         
               DISPLAY 'BM06K110 READ ERROR, STATUS: ' WS-K110-STATUS           
               DISPLAY 'K110-KEY-FLD = ' K110-KEY-FLD                           
               MOVE WS-K110-STATUS TO RETURN-CODE                               
               PERFORM  9000-CLOSE-ROUTINE                                      
           END-EVALUATE.                                                        
                                                                                
       3300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3350-COMPUTE-WS-DISC.                                                    
      *---------------------------------------------------------------*         
           IF  K800-NUM-DISCOUNT-PERIOD IS NOT NUMERIC                          
               MOVE ZEROS TO K800-NUM-DISCOUNT-PERIOD                           
           END-IF.                                                              
                                                                                
           MOVE K800-NUM-DISCOUNT-PERIOD TO WS-PERIOD-TENANCY.                  
           COMPUTE WS-FLAT-DISCOUNT = (WS-PERIOD-TENANCY * 0.03) *              
                                       (K110-1ST-OFFER-SELLING-PRICE)           
                                                                                
           MOVE ZEROES                  TO L277A-BF-DISC-ROUND1                 
                                                                                
           IF WS-FLAT-DISCOUNT > 15000                                          
             MOVE 15000                 TO  WS-TEMP-DISCOUNT                    
             COMPUTE WS-CURR-SELLING-PRICE = (K110-CURR-SELLING-PRICE)          
                                              - (WS-TEMP-DISCOUNT)              
           ELSE                                                                 
             COMPUTE WS-CURR-SELLING-PRICE = (K110-CURR-SELLING-PRICE)          
                                              - (WS-FLAT-DISCOUNT)              
             IF WS-TEMP-TENS > ZEROES                                           
                ADD 1        TO  WS-TEMP                                        
                MOVE ZEROES  TO  WS-TEMP-TENS                                   
             END-IF                                                             
            COMPUTE WS-FLAT-DISC-ROUND = (K110-1ST-OFFER-SELLING-PRICE)         
                                         - (WS-CURR-SELLING-PRICE)              
                                                                                
              IF WS-FLAT-DISC-ROUND NOT = WS-FLAT-DISCOUNT                      
                 MOVE WS-FLAT-DISCOUNT     TO L277A-BF-DISC-ROUND1              
              END-IF                                                            
                                                                                
              COMPUTE WS-DIFF = WS-FLAT-DISCOUNT - WS-FLAT-DISC-ROUND           
               IF WS-DIFF > '99'                                                
                   MOVE 'ERR DISCOUNT'    TO L277A-ERR-DISC                     
               END-IF                                                           
           END-IF.                                                              
           IF L277A-BF-DISC-ROUND1 NOT = ZEROES                                 
               MOVE WS-FLAT-DISCOUNT  TO L277A-BF-DISC-ROUND                    
           ELSE                                                                 
               MOVE SPACES            TO L277A-BF-DISC-ROUND1                   
           END-IF.                                                              
                                                                                
       3350-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3400-PRINT-LIST1.                                                        
      *---------------------------------------------------------------*         
           MOVE 'N'               TO WS-FLAG.                                   
           IF CNT-NUM-LINE > 53                                                 
               PERFORM 4000-PRINT-HEADER THRU 4000-EXIT                         
           END-IF.                                                              
                                                                                
           ADD 1                  TO WS-SEQ.                                    
           MOVE WS-SEQ            TO L277A-NO.                                  
           PERFORM 4500-PREPARE-LIST  THRU 4500-EXIT.                           
                                                                                
       3400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3500-PRINT-LIST2.                                                        
      *---------------------------------------------------------------*         
           MOVE 'Y'               TO WS-FLAG.                                   
           IF CNT-NUM-LINE1 > 53                                                
               PERFORM 4000-PRINT-HEADER THRU 4000-EXIT                         
           END-IF.                                                              
                                                                                
           ADD 1                  TO WS-SEQ1.                                   
           MOVE WS-SEQ1           TO L277A-NO.                                  
           PERFORM 4500-PREPARE-LIST  THRU 4500-EXIT.                           
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4000-PRINT-HEADER.                                                       
      *---------------------------------------------------------------*         
           PERFORM 4100-HEADER-LINE  THRU 4100-EXIT.                            
           MOVE SPACES             TO P13L277A-REC.                             
           IF WS-FLAG = 'N'                                                     
             ADD 1                 TO CNT-NUM-LINE                              
           ELSE                                                                 
             ADD 1                 TO CNT-NUM-LINE1                             
           END-IF.                                                              
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4100-HEADER-LINE.                                                        
      *---------------------------------------------------------------*         
           IF WS-FLAG = 'N'                                                     
              ADD 1                 TO CNT-PAGE                                 
              MOVE CNT-PAGE         TO L277A-PAGENO                             
                                       L277B-PAGENO                             
              MOVE 10               TO CNT-NUM-LINE                             
           ELSE                                                                 
              ADD 1                 TO CNT-PAGE1                                
              MOVE CNT-PAGE1        TO L277A-PAGENO                             
                                       L277B-PAGENO                             
              MOVE 10               TO CNT-NUM-LINE1                            
           END-IF.                                                              
           MOVE FUNCTION CURRENT-DATE TO WS-DATE.                               
           STRING WS-DATE (7:2) '/'                                             
                  WS-DATE (5:2) '/'                                             
                  WS-DATE (1:4)                                                 
                  DELIMITED BY SIZE                                             
                  INTO L277A-DATE.                                              
           MOVE L277A-DATE   TO L277B-DATE.                                     
           MOVE F310-USERID           TO L277A-USERID L277B-USERID.             
           IF WS-FLAG = 'N'                                                     
              WRITE P13L277A-REC FROM L277A-PR-HEAD-01 AFTER PAGE               
              WRITE P13L277A-REC FROM L277A-PR-HEAD-02 AFTER 1                  
              WRITE P13L277A-REC FROM L277A-PR-HEAD-03 AFTER 1                  
              WRITE P13L277A-REC FROM L277A-PR-HEAD-04 AFTER 3                  
              WRITE P13L277A-REC FROM L277A-PR-HEAD-05 AFTER 1                  
              WRITE P13L277A-REC FROM L277A-PR-HEAD-07 AFTER 1                  
              WRITE P13L277A-REC FROM L277A-PR-LINE   AFTER 1                   
              MOVE SPACES           TO P13L277A-REC                             
              WRITE P13L277A-REC                                                
           ELSE                                                                 
              WRITE P13L277B-REC FROM L277B-PR-HEAD-01 AFTER PAGE               
              WRITE P13L277B-REC FROM L277B-PR-HEAD-02 AFTER 1                  
              WRITE P13L277B-REC FROM L277B-PR-HEAD-03 AFTER 1                  
              WRITE P13L277B-REC FROM L277B-PR-HEAD-04 AFTER 3                  
              WRITE P13L277B-REC FROM L277B-PR-HEAD-05 AFTER 1                  
              WRITE P13L277B-REC FROM L277B-PR-HEAD-06 AFTER 1                  
              WRITE P13L277B-REC FROM L277B-PR-HEAD-07 AFTER 1                  
              WRITE P13L277B-REC FROM L277A-PR-LINE   AFTER 1                   
                                                                                
              MOVE SPACES           TO P13L277B-REC                             
              WRITE P13L277B-REC                                                
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4500-PREPARE-LIST.                                                       
      *---------------------------------------------------------------*         
           MOVE F310-REGN-NO          TO L277A-CUR-REGN-NO.                     
           MOVE '-'                   TO L277A-D1 L277A-D2                      
                                        L277A-D3.                               
           MOVE K110-SCHEME           TO L277A-SCHEME.                          
           MOVE K110-ACC              TO L277A-ACC.                             
           MOVE K110-CHK              TO L277A-CHK.                             
           MOVE K110-ACC-TYPE         TO L277A-ACC-TYPE.                        
           MOVE K800-NUM-NEW-TOWN     TO L277A-NT.                              
           MOVE F310-CDE-FLAT-TYPE    TO L277A-FLAT.                            
           MOVE F310-NUM-BLK          TO L277A-BLK-NO.                          
           MOVE F310-NME-STREET       TO L277A-STREET.                          
           MOVE F310-NUM-LEVEL        TO L277A-LEVEL-NO.                        
           MOVE F310-NUM-MAIN (1:4)   TO L277A-UNIT-NO.                         
           MOVE F310-NUM-MAIN (5:1)   TO L277A-SUB-UNIT.                        
           MOVE F310-NUM-POSTAL       TO L277A-POSTAL-CODE.                     
                                                                                
           MOVE K800-NUM-DISCOUNT-PERIOD   TO L277A-PERIOD-TENANCY.             
           MOVE K800-DTE-TENANCY-COMMENCE TO WS-TENANCY-DATE.                   
              STRING WS-TEN-DD '/'                                              
                     WS-TEN-MM '/'                                              
                     WS-TEN-CC                                                  
                     WS-TEN-YY                                                  
                     DELIMITED BY SIZE                                          
                INTO L277A-ST-DATE.                                             
                                                                                
                                                                                
           STRING F310-DTE-DD '/'                                               
                  F310-DTE-MM '/'                                               
                  F310-DTE-CC                                                   
                  F310-DTE-YY                                                   
                  DELIMITED BY SIZE                                             
             INTO L277A-DTE-ACCEPT.                                             
                                                                                
           MOVE K110-1ST-OFFER-SELLING-PRICE TO L277A-OFFR-SPRICE.              
           MOVE K110-CURR-SELLING-PRICE       TO L277A-CURR-SPRICE.             
           MOVE K110-AMT-FLAT-DISCOUNT        TO L277A-AMT-FLAT-DISC.           
           MOVE K110-AMT-OCS-DISCOUNT         TO L277A-OCS-FLAT-DISC.           
                                                                                
           IF WS-FLAG = 'Y'                                                     
             WRITE P13L277B-REC          FROM L277A-PR-DETAIL  AFTER 1          
             WRITE P13L277B-REC          FROM L277A-PR-DETAIL-A AFTER 1         
             MOVE SPACES TO P13L277B-REC                                        
             WRITE P13L277B-REC                                                 
             WRITE P13L277B-REC          FROM L277B-PR-DETAIL-B AFTER 1         
             MOVE SPACES TO P13L277B-REC                                        
             WRITE P13L277B-REC                                                 
             PERFORM 5000-K820-PARA   THRU 5000-EXIT                            
             PERFORM 5500-MOVE        THRU 5500-EXIT 15 TIMES                   
             WRITE P13L277B-REC          FROM L277B-PR-HEAD-08 AFTER 1          
             WRITE P13L277B-REC          FROM L277B-PR-HEAD-09 AFTER 1          
             MOVE SPACES TO    P13L277B-REC                                     
             WRITE P13L277B-REC                                                 
             WRITE P13L277B-REC                                                 
             WRITE P13L277B-REC          FROM L277B-PR-HEAD-10 AFTER 1          
             MOVE SPACES TO   P13L277B-REC                                      
             WRITE P13L277B-REC                                                 
             WRITE P13L277B-REC                                                 
             ADD 50                      TO CNT-NUM-LINE1                       
           ELSE                                                                 
             WRITE P13L277A-REC          FROM L277A-PR-DETAIL  AFTER 1          
             WRITE P13L277A-REC          FROM L277A-PR-DETAIL-A AFTER 1         
             MOVE SPACES TO P13L277A-REC                                        
             WRITE P13L277A-REC                                                 
             PERFORM 5000-K820-PARA   THRU 5000-EXIT                            
             MOVE SPACES TO P13L277A-REC                                        
             WRITE P13L277A-REC                                                 
             ADD 4                  TO CNT-NUM-LINE                             
           END-IF.                                                              
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5000-K820-PARA.                                                          
      *---------------------------------------------------------------*         
            IF K800-NUM-NRIC1 NOT = SPACES                                      
               MOVE SPACES TO K820-KEY-FLD                                      
               MOVE K800-NUM-REGN   TO K820-NUM-REGN                            
               MOVE K800-NUM-NRIC1  TO K820-NUM-NRIC                            
               PERFORM 5100-BP13K820-READ  THRU 5100-EXIT                       
            END-IF.                                                             
            IF K800-NUM-NRIC2 NOT = SPACES                                      
               MOVE SPACES TO K820-KEY-FLD                                      
               MOVE K800-NUM-REGN   TO K820-NUM-REGN                            
               MOVE K800-NUM-NRIC2  TO K820-NUM-NRIC                            
               PERFORM 5100-BP13K820-READ  THRU 5100-EXIT                       
            END-IF.                                                             
            IF K800-NUM-NRIC3 NOT = SPACES                                      
               MOVE SPACES TO K820-KEY-FLD                                      
               MOVE K800-NUM-REGN   TO K820-NUM-REGN                            
               MOVE K800-NUM-NRIC3  TO K820-NUM-NRIC                            
               PERFORM 5100-BP13K820-READ  THRU 5100-EXIT                       
            END-IF.                                                             
            IF K800-NUM-NRIC4 NOT = SPACES                                      
               MOVE SPACES TO K820-KEY-FLD                                      
               MOVE K800-NUM-REGN   TO K820-NUM-REGN                            
               MOVE K800-NUM-NRIC4  TO K820-NUM-NRIC                            
               PERFORM 5100-BP13K820-READ  THRU 5100-EXIT                       
            END-IF.                                                             
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5100-BP13K820-READ.                                                      
      *---------------------------------------------------------------*         
           READ BP13K820 RECORD KEY IS K820-KEY-FLD                             
           EVALUATE WS-K820-STATUS                                              
              WHEN 00                                                           
                  MOVE K820-NUM-NRIC        TO L277A-NRIC                       
                  MOVE K820-NME-OCCP        TO L277A-NAME                       
                  IF K820-NUM-DEBAR-SHAP1 = SPACES                              
                     MOVE 'N'                  TO L277A-SHAP1                   
                  ELSE                                                          
                     MOVE K820-NUM-DEBAR-SHAP1 TO L277A-SHAP1                   
                  END-IF                                                        
                  IF K820-NUM-DEBAR-SHAP2 = SPACES                              
                     MOVE 'N'                  TO L277A-SHAP2                   
                  ELSE                                                          
                     MOVE K820-NUM-DEBAR-SHAP2 TO L277A-SHAP2                   
                  END-IF                                                        
                  IF WS-FLAG = 'N'                                              
                    WRITE P13L277A-REC   FROM L277A-PR-DETAIL-B AFTER 1         
                    ADD 1                  TO CNT-NUM-LINE                      
                  ELSE                                                          
                    WRITE P13L277B-REC   FROM L277A-PR-DETAIL-B AFTER 1         
                    ADD 1                  TO CNT-NUM-LINE1                     
                  END-IF                                                        
                  ADD  1   TO WS-CNT-READ-K820                                  
              WHEN 23                                                           
                  MOVE  SPACES TO BP13K820-REC                                  
                  INITIALIZE      BP13K820-REC                                  
              WHEN OTHER                                                        
                  DISPLAY 'BP13K820 READ ERROR, STATUS: '                       
                                                 WS-K820-STATUS                 
                  PERFORM 9000-CLOSE-ROUTINE                                    
           END-EVALUATE.                                                        
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5500-MOVE.                                                               
      *---------------------------------------------------------------*         
           MOVE SPACES TO P13L277B-REC.                                         
           WRITE P13L277B-REC.                                                  
                                                                                
       5500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       9000-CLOSE-ROUTINE.                                                      
      *---------------------------------------------------------------*         
           DISPLAY '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'.              
           DISPLAY '*** BP13C277 - CONTROL LIST *** ' L277A-DATE.               
           DISPLAY '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'.              
           MOVE WS-CNT-READ-F310   TO WS-EDIT-CNT.                              
           DISPLAY 'RECS READ FROM BP13F310 = ' WS-EDIT-CNT.                    
           MOVE WS-CNT-READ-K800   TO WS-EDIT-CNT.                              
           DISPLAY 'RECS READ FROM BP13K800 = ' WS-EDIT-CNT.                    
           MOVE WS-CNT-READ-K820   TO WS-EDIT-CNT.                              
           DISPLAY 'RECS READ FROM BP13K820 = ' WS-EDIT-CNT.                    
           MOVE WS-CNT-READ-K830   TO WS-EDIT-CNT.                              
           DISPLAY 'RECS READ FROM BP13K830 = ' WS-EDIT-CNT.                    
           MOVE WS-CNT-READ-K110   TO WS-EDIT-CNT.                              
           DISPLAY 'RECS READ FROM BM06K110 = ' WS-EDIT-CNT.                    
           MOVE WS-CNT-PRINT       TO WS-EDIT-CNT.                              
           DISPLAY 'RECS PRINTED TO LISTING = ' WS-EDIT-CNT.                    
           DISPLAY ' '.                                                         
           DISPLAY '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~'.              
                                                                                
           CLOSE BP13F310                                                       
                 BM06K110                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 BP13K830                                                       
                 P13L277A                                                       
                 P13L277B.                                                      
                                                                                
           IF WS-K110-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BM06K110 CLOSING ERROR, STATUS: ' WS-K110-STATUS         
              MOVE WS-K110-STATUS  TO RETURN-CODE                               
           END-IF.                                                              
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K800 CLOSING ERROR, STATUS: ' WS-K800-STATUS         
              MOVE WS-K800-STATUS  TO RETURN-CODE                               
           END-IF.                                                              
                                                                                
           IF WS-K820-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K820 CLOSING ERROR, STATUS: ' WS-K820-STATUS         
              MOVE WS-K820-STATUS  TO RETURN-CODE                               
           END-IF.                                                              
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'BP13K830 CLOSING ERROR, STATUS: ' WS-K830-STATUS         
              MOVE WS-K830-STATUS  TO RETURN-CODE                               
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
