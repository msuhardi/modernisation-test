       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CZ37.                                                 
      *AUTHOR.        LIZ PATIAG.                                               
      *DATE-WRITTEN.  22 MARCH 2018.                                            
      *========================================================*                
      * SYSTEM OF COMMITMENT (BP13)                            *                
      *========================================================*                
      *    OBJECTIVE :                                         *                
      *      1.  EXTRACT APPLICATIONS READY TO SIGN AGREEMENT  *                
      *          FOR LEASE BASED ON CERTAIN CONDITIONS         *                
      *                                                        *                
      *--------------------------------------------------------*                
      * CHG-NO    BY  DATE    DESCRIPTION                      *                
      * -------  ---  ------  -----------                      *                
      * BP137196 FNP1 220318  NEW PROGRAM                      *                
      * BP137196 ESA1 040618  TO CATER FOR 'APPT' CASE OWNER IN*                
      *                       GROUPING                         *                
      * BP138047 KAC1 251119  RECOMPILE FOR BP27 COPYBOOK UPDATE                
      * BP138565 KR13 250121  TO CATER FOR FLAT-TYPE - '1F'.   *                
      *========================================================*                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
           SELECT BP13F800   ASSIGN TO BP13F800.                                
                                                                                
           SELECT BP13KQ10  ASSIGN TO BP13KQ10                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS RANDOM                                    
                  RECORD KEY       IS KQ10-KEY-FLD                              
                  FILE STATUS      IS BP13KQ10-STATUS.                          
                                                                                
           SELECT BP13K022 ASSIGN TO BP13K022                                   
                  ACCESS MODE      IS RANDOM                                    
                  ORGANIZATION     IS INDEXED                                   
                  RECORD KEY       IS K022-KEY-FLD                              
                  ALTERNATE KEY    IS K022-NUM-REGN                             
                  FILE STATUS      IS BP13K022-STATUS.                          
                                                                                
           SELECT BP13K20A ASSIGN TO BP13K20A                                   
                  ACCESS MODE      IS RANDOM                                    
                  ORGANIZATION     IS INDEXED                                   
                  RECORD KEY       IS K20A-KEY-FLD                              
                  FILE STATUS      IS BP13K20A-STATUS.                          
                                                                                
           SELECT BP27K800 ASSIGN TO BP27K800                                   
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS DYNAMIC                                   
                  RECORD KEY       IS K800-NUM-HLA OF BP27K800-MASTER           
                  FILE STATUS      IS BP27K800-STATUS.                          
                                                                                
           SELECT BM06K110  ASSIGN TO BM06K110                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS DYNAMIC                                   
                  RECORD KEY       IS K110-KEY-FLD                              
                  FILE STATUS      IS BM06K110-STATUS.                          
                                                                                
           SELECT BM06K100  ASSIGN TO BM06K100                                  
                  ACCESS MODE      IS DYNAMIC                                   
                  ORGANIZATION     IS INDEXED                                   
                  RECORD KEY       IS K100-KEY-FLD                              
                  FILE STATUS      IS BM06K100-STATUS.                          
                                                                                
           SELECT BB24K510  ASSIGN TO BB24K510                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS DYNAMIC                                   
                  RECORD KEY       IS K510-KEY-FLD                              
                  FILE STATUS      IS BB24K510-STATUS.                          
                                                                                
           SELECT BB24K500  ASSIGN TO BB24K500                                  
                  ORGANIZATION     IS INDEXED                                   
                  ACCESS MODE      IS RANDOM                                    
                  RECORD KEY       IS K500-KEY-FLD                              
                  FILE STATUS      IS BB24K500-STATUS.                          
                                                                                
           SELECT BR10K010 ASSIGN TO BR10K010                                   
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K010-KEY-FLD                               
                  FILE STATUS     IS BR10K010-STATUS.                           
                                                                                
           SELECT P04K010  ASSIGN TO P04K010                                    
                  ACCESS MODE     IS DYNAMIC                                    
                  ORGANIZATION    IS INDEXED                                    
                  RECORD KEY      IS K010-PRIME-KEY                             
                  FILE STATUS     IS BP04K010-STATUS.                           
                                                                                
           SELECT BP13F322 ASSIGN TO BP13F322.                                  
           SELECT P13F322A ASSIGN TO P13F322A.                                  
           SELECT P13F322B ASSIGN TO P13F322B.                                  
           SELECT P13F800A ASSIGN TO P13F800A.                                  
           SELECT P13F800B ASSIGN TO P13F800B.                                  
           SELECT P13F800C ASSIGN TO P13F800C.                                  
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F800                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            BLOCK  CONTAINS 0   RECORDS                                         
            LABEL  RECORDS ARE  STANDARD                                        
            RECORDING MODE IS F.                                                
       COPY BP13F800.                                                           
                                                                                
       FD   BP13KQ10                                                            
            RECORD CONTAINS  400 CHARACTERS.                                    
       COPY BP13KQ10.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS  100 CHARACTERS.                                    
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K20A                                                            
            RECORD CONTAINS  200 CHARACTERS.                                    
       COPY BP13K20A.                                                           
                                                                                
       FD  BP27K800                                                             
           RECORD CONTAINS 1200 CHARACTERS.                                     
       COPY BP27K800.                                                           
                                                                                
       FD   BM06K110                                                            
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BM06K110.                                                           
                                                                                
       FD   BM06K100                                                            
            RECORD CONTAINS 500  CHARACTERS.                                    
       COPY BM06K100.                                                           
                                                                                
       FD   BB24K510                                                            
            RECORD CONTAINS 50 CHARACTERS.                                      
       COPY BB24K510.                                                           
                                                                                
       FD   BB24K500                                                            
            RECORD CONTAINS 1700 CHARACTERS.                                    
       COPY BB24K500.                                                           
                                                                                
       FD   BR10K010                                                            
            RECORD CONTAINS  300 CHARACTERS.                                    
       COPY BR10K010.                                                           
                                                                                
       FD   P04K010                                                             
            RECORD CONTAINS  300 CHARACTERS.                                    
       COPY P04K010.                                                            
                                                                                
       FD   BP13F322                                                            
            RECORD CONTAINS 400 CHARACTERS                                      
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       COPY BP13F322.                                                           
                                                                                
       FD   P13F322A                                                            
            RECORD CONTAINS 400 CHARACTERS                                      
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       01   P13F322A-REC            PIC X(400).                                 
                                                                                
       FD   P13F322B                                                            
            RECORD CONTAINS 400 CHARACTERS                                      
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       01   P13F322B-REC            PIC X(400).                                 
                                                                                
       FD   P13F800A                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       01   P13F800A-REC.                                                       
            05 FILLER              PIC X(923).                                  
            05 F800A-NUM-ALLO-CAT  PIC X(03).                                   
            05 FILLER              PIC X(1074).                                 
                                                                                
       FD   P13F800B                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       01   P13F800B-REC.                                                       
            05 FILLER              PIC X(923).                                  
            05 F800B-NUM-ALLO-CAT  PIC X(03).                                   
            05 FILLER              PIC X(1074).                                 
                                                                                
       FD   P13F800C                                                            
            RECORD CONTAINS 2000 CHARACTERS                                     
            RECORDING MODE F                                                    
            LABEL  RECORDS ARE  OMITTED.                                        
       01   P13F800C-REC.                                                       
            05 FILLER              PIC X(923).                                  
            05 F800C-NUM-ALLO-CAT  PIC X(03).                                   
            05 FILLER              PIC X(1074).                                 
                                                                                
       WORKING-STORAGE SECTION.                                                 
       01  BB24K500-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BB24K510-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BP13KQ10-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BP13K022-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BP13K20A-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BP27K800-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BR10K010-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BP04K010-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BM06K110-STATUS          PIC 9(2)    VALUE ZEROES.                   
       01  BM06K100-STATUS          PIC 9(2)    VALUE ZEROES.                   
                                                                                
       01  WS-K510-READ             PIC 9(8)    VALUE 0.                        
       01  WS-K500-READ             PIC 9(8)    VALUE 0.                        
       01  WS-F800-READ             PIC 9(8)    VALUE 0.                        
       01  WS-OUTPUT-F322           PIC 9(8)    VALUE 0.                        
       01  WS-OUTPUT-F322A          PIC 9(8)    VALUE 0.                        
       01  WS-OUTPUT-F322B          PIC 9(8)    VALUE 0.                        
       01  WS-REWRITE-K20A          PIC 9(8)    VALUE 0.                        
       01  WS-WRITE-K20A            PIC 9(8)    VALUE 0.                        
       01  WS-WRITE-F800A           PIC 9(8)    VALUE 0.                        
       01  WS-WRITE-F800B           PIC 9(8)    VALUE 0.                        
       01  WS-WRITE-F800C           PIC 9(8)    VALUE 0.                        
       01  WS-K510-NOTFD            PIC X       VALUE 'N'.                      
       01  WS-K010-FOUND            PIC X       VALUE 'N'.                      
       01  WS-K500-FOUND            PIC X       VALUE 'N'.                      
       01  WS-K510-EOF              PIC X       VALUE 'N'.                      
       01  WS-DEB-UPD-IND           PIC X       VALUE 'N'.                      
                                                                                
       01  EOF-BB24K510             PIC X       VALUE 'N'.                      
       01  EOF-BB24K500             PIC X       VALUE 'N'.                      
       01  EOF-F800                 PIC X       VALUE 'N'.                      
       01  WS-K010-EOF              PIC X       VALUE 'N'.                      
       01  WS-VALID-REC             PIC X       VALUE SPACES.                   
       01  WS-DEBAR-FND             PIC X       VALUE SPACES.                   
       01  WS-PPOS-FND              PIC X       VALUE SPACES.                   
       01  WS-RSL-FND               PIC X       VALUE SPACES.                   
       01  WS-DEB-FND               PIC X       VALUE SPACES.                   
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-CURR-DATE         PIC X(08)   VALUE SPACES.                   
           05  WS-DEBARMENT-CODE OCCURS 10 TIMES.                               
               10  WS-DEBAR-CDE     PIC X(2)    VALUE SPACES.                   
           05  CNT                  PIC 99      VALUE ZEROES.                   
           05  CNT2                 PIC 99      VALUE ZEROES.                   
           05  WS-CNT               PIC 99      VALUE ZEROES.                   
           05  WS-CNT2              PIC 99      VALUE ZEROES.                   
           05  WS-CNT3              PIC 99      VALUE ZEROES.                   
           05  WS-NUM-ESTATE        PIC X(3)    VALUE SPACES.                   
           05  WS-NUM-NEIG          PIC X(4)    VALUE SPACES.                   
           05  WS-NUM-CONT          PIC X(4)    VALUE SPACES.                   
           05  WS-NUM-BLOCK         PIC X(4)    VALUE SPACES.                   
           05  WS-NUM-NRIC          PIC X(9)    VALUE SPACES.                   
           05  WS-I                 PIC 9       VALUE ZEROES.                   
           05  WS-GRT-STAT          PIC X(01)   VALUE SPACES.                   
           05  WS-GRT-ELIG          PIC X(01)   VALUE SPACES.                   
           05  WS-GRT-QUANTUM       PIC X(03)   VALUE SPACES.                   
           05  WS-DTE-GRT-PAY       PIC X(8)    VALUE SPACES.                   
           05  WS-DTE-HLE-EXP       PIC 9(8)    VALUE ZEROES.                   
           05  WS-DTE-HLE-APR       PIC 9(8)    VALUE ZEROES.                   
           05  WS-DTE-CURRENT       PIC 9(8)    VALUE ZEROES.                   
           05  WS-DTE-KEY-AVAIL     PIC 9(8)    VALUE ZEROES.                   
           05  WS-DTE-ACCEPT        PIC 9(8)    VALUE ZEROES.                   
           05  WS-DTE-1ST-SOCA      PIC X(8)    VALUE SPACES.                   
           05  WS-RSL-STAT          PIC X(2)    VALUE SPACES.                   
           05  WS-SC-SPR-PREM       PIC 9(8)    VALUE ZEROES.                   
           05  WS-INT-EXP           PIC 9(7)    VALUE ZEROES.                   
           05  WS-INT-CUR           PIC 9(7)    VALUE ZEROES.                   
           05  WS-DIFF              PIC 9(7)    VALUE ZEROES.                   
           05  WS-REMARKS           PIC X(50)   VALUE SPACES.                   
           05  WS-TXT-REMARKS OCCURS 18 TIMES.                                  
               10  WS-TXT-REMARK    PIC X(5)    VALUE SPACES.                   
           05  WS-GROUPING          PIC X(3)    VALUE SPACES.                   
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-FT-NTBKD          PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-DTE-BAL       PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-DTE-AO        PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-PROV          PIC 9(8)    VALUE ZEROES.                   
           05  WS-CANCEL            PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-ALLO-SCH      PIC 9(8)    VALUE ZEROES.                   
           05  WS-SER               PIC 9(8)    VALUE ZEROES.                   
           05  WS-NPL               PIC 9(8)    VALUE ZEROES.                   
           05  WS-2F                PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-CA            PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-DTE-SOCA      PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-LOAN-TAG-N    PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-LOAN-TAG-H    PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-RSL           PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-PPOS          PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-CHK-DTE       PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-CHK-BY        PIC 9(8)    VALUE ZEROES.                   
           05  WS-INV-DEBAR         PIC 9(8)    VALUE ZEROES.                   
           05  WS-KEY-AVAIL         PIC 9(8)    VALUE ZEROES.                   
           05  WS-BANK-LOAN         PIC 9(8)    VALUE ZEROES.                   
           05  WS-HLE-LOAN          PIC 9(8)    VALUE ZEROES.                   
           05  WS-SKIP-AO           PIC 9(8)    VALUE ZEROES.                   
                                                                                
       01  WS-HEADER-LAYOUT.                                                    
           05  FILLER                PIC X(08) VALUE 'REGN NO '.                
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(03) VALUE 'NT '.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(04) VALUE 'NEI '.                    
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(04) VALUE 'CONT'.                    
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(05) VALUE 'BLOCK'.                   
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(04) VALUE 'FT  '.                    
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'DTE-ACCEPT'.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'KEY-AVAIL '.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(08) VALUE 'SPR-PREM'.                
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(07) VALUE 'DTE-BAL'.                 
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(03) VALUE 'SEL'.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'DTE-1ST-SA'.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'DTE-AO-APT'.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(03) VALUE 'SCH'.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'H'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(07) VALUE 'GRNT-ST'.                 
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'R'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'P'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'A'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(03) VALUE 'RST'.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(03) VALUE 'HHC'.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'C'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'L'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'DTE-HLE-EX'.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(10) VALUE 'DTE-HLE-AP'.              
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'P'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'P'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(08) VALUE 'DTE-PREE'.                
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(08) VALUE 'PRECHKBY'.                
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(01) VALUE 'P'.                       
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(05) VALUE 'CRM'.                     
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(29) VALUE                            
               'DEBARMENT CODES'.                                               
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(40) VALUE 'REMARKS'.                 
           05  FILLER                PIC X(01) VALUE ';'.                       
           05  FILLER                PIC X(08) VALUE 'DTE-UPD'.                 
           05  FILLER                PIC X(138).                                
                                                                                
      *-------------------------------------------------------------            
      *  LINKAGE FOR BP13CB4A                                                   
      *-------------------------------------------------------------            
       COPY P13COM73.                                                           
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
      *---------------------------------------------------------------*         
       0000-CONTROL.                                                            
      *---------------------------------------------------------------*         
                                                                                
           PERFORM 1000-OPEN-FILES        THRU 1000-EXIT.                       
           PERFORM 2000-READ-BP13F800     THRU 2000-EXIT.                       
           PERFORM 3000-PROCESS-BP13F800  THRU 3000-EXIT                        
             UNTIL EOF-F800 = 'Y'.                                              
           PERFORM 9000-CLOSE-FILES       THRU 9000-EXIT.                       
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       1000-OPEN-FILES.                                                         
      *---------------------------------------------------------------*         
           OPEN INPUT  BB24K510                                                 
                       BB24K500                                                 
                       BP13KQ10                                                 
                       BP13K022                                                 
                       BP27K800                                                 
                       BR10K010                                                 
                       BM06K110                                                 
                       BM06K100                                                 
                       P04K010                                                  
                       BP13F800                                                 
                OUTPUT BP13F322                                                 
                       P13F322A                                                 
                       P13F322B                                                 
                       P13F800A                                                 
                       P13F800B                                                 
                       P13F800C                                                 
                I-O    BP13K20A.                                                
                                                                                
           IF BB24K510-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BB24K510 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BB24K510-STATUS                        
               MOVE BB24K510-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BB24K500-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BB24K500 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BB24K500-STATUS                        
               MOVE BB24K500-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13KQ10-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BP13KQ10 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BP13KQ10-STATUS                        
               MOVE BP13KQ10-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13K022-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BP13K022 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BP13K022-STATUS                        
               MOVE BP13K022-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP13K20A-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BP13K20A OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BP13K20A-STATUS                        
               MOVE BP13K20A-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP27K800-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BP27K800 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BP27K800-STATUS                        
               MOVE BP27K800-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BR10K010-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BP13KQ10 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BR10K010-STATUS                        
               MOVE BR10K010-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BM06K110-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BM06K110 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BM06K110-STATUS                        
               MOVE BM06K110-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BM06K100-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE BM06K100 OPEN ERROR'                               
               DISPLAY 'ERROR STATUS = ' BM06K100-STATUS                        
               MOVE BM06K100-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           IF BP04K010-STATUS NOT = ZEROS AND 97                                
               DISPLAY 'FILE P04K010 OPEN ERROR'                                
               DISPLAY 'ERROR STATUS = ' BP04K010-STATUS                        
               MOVE BP04K010-STATUS TO RETURN-CODE                              
               PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                        
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8)  TO WS-CURR-DATE.                    
                                                                                
           MOVE WS-CURR-DATE                TO WS-DTE-CURRENT.                  
                                                                                
           COMPUTE WS-INT-CUR = FUNCTION                                        
                        INTEGER-OF-DATE(WS-DTE-CURRENT).                        
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       2000-READ-BP13F800.                                                      
      *---------------------------------------------------------------*         
                                                                                
           READ BP13F800 AT END                                                 
                MOVE 'Y' TO EOF-F800                                            
                GO TO 2000-EXIT.                                                
           ADD 1 TO WS-F800-READ.                                               
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3000-PROCESS-BP13F800.                                                   
      *---------------------------------------------------------------*         
           MOVE 'Y'           TO WS-VALID-REC.                                  
           MOVE SPACES        TO WS-RSL-STAT                                    
                                 WS-DTE-1ST-SOCA                                
                                 WS-REMARKS                                     
                                 WS-NUM-NEIG                                    
                                 WS-NUM-CONT                                    
                                 WS-GROUPING.                                   
           MOVE ZEROES        TO WS-CNT                                         
                                 WS-CNT2                                        
                                 WS-CNT3                                        
                                 WS-DTE-KEY-AVAIL                               
                                 WS-DTE-ACCEPT                                  
                                 WS-DTE-HLE-EXP                                 
                                 WS-DTE-HLE-APR                                 
                                 WS-INT-EXP                                     
                                 WS-INT-CUR                                     
                                 WS-DIFF.                                       
                                                                                
           PERFORM VARYING CNT FROM 1 BY 1 UNTIL CNT > 10                       
              MOVE SPACES      TO WS-DEBAR-CDE(CNT)                             
           END-PERFORM.                                                         
                                                                                
           PERFORM VARYING CNT FROM 1 BY 1 UNTIL CNT > 18                       
              MOVE SPACES      TO WS-TXT-REMARK(CNT)                            
           END-PERFORM.                                                         
                                                                                
           IF F800-DTE-AO-APPT >= WS-DTE-CURRENT                                
              ADD  1              TO WS-SKIP-AO                                 
           ELSE                                                                 
              PERFORM 3700-READ-BM06K110    THRU 3700-EXIT                      
              PERFORM 3900-CHECK-K100       THRU 3900-EXIT                      
              PERFORM 3950-CHECK-SOCA-DATE  THRU 3950-EXIT                      
              PERFORM 3600-CHECK-F800       THRU 3600-EXIT                      
              PERFORM 4000-READ-BP13KQ10    THRU 4000-EXIT                      
              PERFORM 4200-CHECK-DEBARMENT  THRU 4200-EXIT                      
              PERFORM 4500-CHECK-PPOS       THRU 4500-EXIT                      
              PERFORM 5000-CHECK-RESALE     THRU 5000-EXIT                      
              PERFORM 5500-CHECK-GRANT      THRU 5500-EXIT                      
              PERFORM 8000-WRITE-OUTPUT     THRU 8000-EXIT                      
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP13F800       THRU 2000-EXIT.                     
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3600-CHECK-F800.                                                         
      *---------------------------------------------------------------*         
                                                                                
           IF F800-NUM-PROV-TAG = 'Y'                                           
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-INV-PROV                                              
              ADD 1 TO WS-CNT3                                                  
              MOVE 'PROVI'        TO WS-TXT-REMARK(WS-CNT3)                     
           END-IF.                                                              
                                                                                
           IF F800-NUM-ALLO-SCHEME = 'MCP' OR 'REG' OR 'FSH' OR 'SHS'           
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-INV-ALLO-SCH                                          
              ADD 1 TO WS-CNT3                                                  
              MOVE 'ALC'          TO WS-TXT-REMARK(WS-CNT3)                     
           END-IF.                                                              
                                                                                
           IF F800-NUM-ALLO-CAT = 'NPL'                                         
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-NPL                                                   
              ADD 1 TO WS-CNT3                                                  
              MOVE 'NPL'          TO WS-TXT-REMARK(WS-CNT3)                     
           END-IF.                                                              
                                                                                
           IF F800-NUM-FLAT-TYPE = '2F' OR '1F'                                 
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-2F                                                    
              ADD 1 TO WS-CNT3                                                  
              MOVE '1F/2F'            TO WS-TXT-REMARK(WS-CNT3)                 
           END-IF.                                                              
                                                                                
           IF F800-NUM-CA-TAG = SPACES OR LOW-VALUES                            
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-INV-CA                                                
              ADD 1 TO WS-CNT3                                                  
              MOVE 'CA'               TO WS-TXT-REMARK(WS-CNT3)                 
           END-IF.                                                              
                                                                                
           IF F800-NUM-LOAN-TAG OF BP13F800-MASTER = 'B'                        
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-BANK-LOAN                                             
              ADD 1 TO WS-CNT3                                                  
              MOVE 'BANK'            TO WS-TXT-REMARK(WS-CNT3)                  
           END-IF.                                                              
                                                                                
           IF F800-NUM-LOAN-TAG OF BP13F800-MASTER = 'P'                        
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-HLE-LOAN                                              
              ADD 1 TO WS-CNT3                                                  
              MOVE 'HLE'            TO WS-TXT-REMARK(WS-CNT3)                   
           END-IF.                                                              
                                                                                
           IF (F800-NUM-LOAN-TAG OF BP13F800-MASTER = 'N' AND                   
              (F800-NUM-HLA = SPACES OR LOW-VALUES))                            
              CONTINUE                                                          
           END-IF.                                                              
                                                                                
      ***ADD CHECKING FOR LOAN-TAG = 'H' WITH HLE-APPROVAL DATE                 
           IF F800-NUM-LOAN-TAG = 'H'                                           
              PERFORM 4800-CHECK-HLE     THRU 4800-EXIT                         
           END-IF.                                                              
                                                                                
                                                                                
       3600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3700-READ-BM06K110.                                                      
      *---------------------------------------------------------------*         
           MOVE SPACES                  TO K110-REC.                            
           MOVE F800-NUM-SCH-ACC        TO K110-KEY-FLD.                        
                                                                                
           READ BM06K110                                                        
                                                                                
           EVALUATE BM06K110-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 PERFORM 3800-CHECK-K110   THRU 3800-EXIT                       
              WHEN 23                                                           
                 DISPLAY 'RECORD NOT FOUND IN BM06K110, KEY IS: '               
                     F800-NUM-REGN  '-' F800-NUM-SCH-ACC                        
              WHEN OTHER                                                        
                 DISPLAY 'ERROR READING BM06K110: ' BM06K110-STATUS             
                    ' KEY IS : ' K110-REGN-NO                                   
                 PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3800-CHECK-K110.                                                         
      *---------------------------------------------------------------*         
                                                                                
           IF K110-DTE-ACCEPTANCE = SPACES OR LOW-VALUE OR ZEROES               
              MOVE ZEROES    TO WS-DTE-ACCEPT                                   
           ELSE                                                                 
              MOVE K110-DTE-ACCEPTANCE  TO WS-DTE-ACCEPT                        
           END-IF.                                                              
                                                                                
           IF K110-DTE-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND                
                                       ZEROES                                   
              MOVE 'N'          TO WS-VALID-REC                                 
              ADD 1 TO WS-CNT3                                                  
              MOVE 'KEYAV'      TO WS-TXT-REMARK(WS-CNT3)                       
              ADD 1 TO WS-KEY-AVAIL                                             
           END-IF.                                                              
                                                                                
           IF F800-CDE-CITIZENSHIP-HOUSEHOLD = 'SCP'                            
              IF K110-AMT-SC-SPR-PREMIUM = ZEROES                               
                 MOVE 'N'       TO WS-VALID-REC                                 
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'SCP'     TO WS-TXT-REMARK(WS-CNT3)                       
              END-IF                                                            
           ELSE                                                                 
              IF F800-CDE-CITIZENSHIP-HOUSEHOLD = 'SCH'                         
                 IF K110-AMT-SC-SPR-PREMIUM NOT = ZEROES                        
                    MOVE 'N'    TO WS-VALID-REC                                 
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'SCH'  TO WS-TXT-REMARK(WS-CNT3)                       
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE K110-NEIGHBOURHOOD   TO WS-NUM-NEIG.                            
           MOVE K110-CONTRACT-NO     TO WS-NUM-CONT.                            
           MOVE K110-BLK-NO          TO WS-NUM-BLOCK.                           
           MOVE K110-DTE-KEY-AVAIL   TO WS-DTE-KEY-AVAIL.                       
           MOVE K110-AMT-SC-SPR-PREMIUM TO WS-SC-SPR-PREM.                      
                                                                                
       3800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3900-CHECK-K100.                                                         
      *---------------------------------------------------------------*         
                                                                                
           MOVE SPACES                 TO K100-KEY-FLD.                         
           MOVE K110-AIX1              TO K100-KEY-FLD.                         
                                                                                
           READ BM06K100.                                                       
                                                                                
           EVALUATE BM06K100-STATUS                                             
              WHEN 00                                                           
                 MOVE K100-DTE-1ST-SOCA  TO WS-DTE-1ST-SOCA                     
                                                                                
              WHEN 23                                                           
                 DISPLAY 'RECORD NOT FOUND IN BM06K100, KEY IS: '               
                        K100-KEY-FLD                                            
              WHEN OTHER                                                        
                 DISPLAY 'BM06K100 READ ERROR, STATUS IS '                      
                          BM06K100-STATUS ' KEY IS, ' K100-KEY-FLD              
                 PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       3900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       3950-CHECK-SOCA-DATE.                                                    
      *---------------------------------------------------------------*         
           IF (WS-DTE-1ST-SOCA    = SPACES OR LOW-VALUES)                       
              MOVE 'N'                TO WS-VALID-REC                           
              ADD 1 TO WS-INV-DTE-SOCA                                          
              ADD 1 TO WS-CNT3                                                  
              MOVE '1STSA'               TO WS-TXT-REMARK(WS-CNT3)              
           ELSE                                                                 
              IF (WS-DTE-1ST-SOCA        > WS-CURR-DATE)                        
                 MOVE 'N'                TO WS-VALID-REC                        
                 ADD 1 TO WS-INV-DTE-SOCA                                       
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'SADTE'            TO WS-TXT-REMARK(WS-CNT3)              
              END-IF                                                            
           END-IF.                                                              
                                                                                
       3950-EXIT.                                                               
           EXIT.                                                                
      *---------------------------------------------------------------*         
       4000-READ-BP13KQ10.                                                      
      *---------------------------------------------------------------*         
           MOVE SPACES                 TO BP13KQ10-REC.                         
           INITIALIZE                     BP13KQ10-REC.                         
                                                                                
           MOVE F800-NUM-REGN          TO KQ10-NUM-REGN.                        
                                                                                
           READ BP13KQ10.                                                       
           EVALUATE BP13KQ10-STATUS                                             
              WHEN 00                                                           
      *          PERFORM 4100-CHECK-KQ10   THRU 4100-EXIT                       
                 CONTINUE                                                       
              WHEN 23                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERROR READING BP13KQ10: ' BP13KQ10-STATUS             
                    ' KEY IS : ' KQ10-NUM-REGN                                  
                 PERFORM 9000-CLOSE-FILES  THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4100-CHECK-KQ10.                                                         
      *---------------------------------------------------------------*         
                                                                                
           IF KQ10-DTE-CHECKED = SPACES OR LOW-VALUES                           
              MOVE 'N'                  TO WS-VALID-REC                         
              ADD  1                    TO WS-INV-CHK-DTE                       
              ADD 1 TO WS-CNT3                                                  
              MOVE 'D-TEAM'             TO WS-TXT-REMARK(WS-CNT3)               
           END-IF                                                               
                                                                                
           IF KQ10-NUM-CHECK-BY = SPACES OR LOW-VALUES                          
              MOVE 'N'                  TO WS-VALID-REC                         
              ADD  1                    TO WS-INV-CHK-BY                        
              ADD 1 TO WS-CNT3                                                  
              MOVE 'REG TEAM'           TO WS-TXT-REMARK(WS-CNT3)               
           END-IF.                                                              
                                                                                
       4100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4200-CHECK-DEBARMENT.                                                    
      *---------------------------------------------------------------*         
                                                                                
           MOVE F800-NUM-NRIC1 TO WS-NUM-NRIC                                   
           PERFORM 4300-CHECK-DEBAR  THRU 4300-EXIT                             
           IF WS-K010-FOUND = 'N'                                               
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-DEBAR-FND NOT = 'Y'                                         
                 MOVE 'N'    TO WS-VALID-REC                                    
                 ADD 1       TO WS-INV-DEBAR                                    
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'DEB'  TO WS-TXT-REMARK(WS-CNT3)                          
                 GO TO 4200-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES                                       
              MOVE F800-NUM-NRIC2 TO WS-NUM-NRIC                                
              PERFORM 4300-CHECK-DEBAR  THRU 4300-EXIT                          
              IF WS-K010-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-DEBAR-FND NOT = 'Y'                                      
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-DEBAR                                 
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'DEB'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 4200-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES                                       
              MOVE F800-NUM-NRIC3 TO WS-NUM-NRIC                                
              PERFORM 4300-CHECK-DEBAR  THRU 4300-EXIT                          
              IF WS-K010-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-DEBAR-FND NOT = 'Y'                                      
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-DEBAR                                 
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'DEB'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 4200-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES                                       
              MOVE F800-NUM-NRIC4 TO WS-NUM-NRIC                                
              PERFORM 4300-CHECK-DEBAR  THRU 4300-EXIT                          
              IF WS-K010-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-DEBAR-FND NOT = 'Y'                                      
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-DEBAR                                 
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'DEB'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 4200-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4300-CHECK-DEBAR.                                                        
      *---------------------------------------------------------------*         
                                                                                
           MOVE SPACES          TO K010-PRIME-KEY.                              
           MOVE 'N'             TO WS-K010-EOF                                  
                                   WS-DEBAR-FND.                                
           MOVE 'N'             TO WS-K010-FOUND.                               
                                                                                
           MOVE WS-NUM-NRIC   TO K010-NUM-UINFIN.                               
                                                                                
           START P04K010  KEY >= K010-PRIME-KEY                                 
                                                                                
           EVALUATE BP04K010-STATUS                                             
           WHEN 00                                                              
           WHEN 02                                                              
                PERFORM 4400-READ-P04K010   THRU 4400-EXIT                      
                    UNTIL WS-K010-EOF = 'Y'                                     
           WHEN 10                                                              
           WHEN 23                                                              
                MOVE 'Y' TO WS-K010-EOF                                         
           WHEN OTHER                                                           
                DISPLAY 'READ ERROR, K010-STATUS ' BP04K010-STATUS              
                DISPLAY 'K010-NUM-UINFIN = ' K010-NUM-UINFIN                    
                PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                       
           END-EVALUATE.                                                        
                                                                                
       4300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------*                                                   
       4400-READ-P04K010.                                                       
      *---------------------*                                                   
                                                                                
           READ P04K010  NEXT RECORD                                            
                                                                                
           EVALUATE BP04K010-STATUS                                             
           WHEN 00                                                              
           WHEN 02                                                              
              IF K010-NUM-UINFIN(1:9) = WS-NUM-NRIC                             
                 IF K010-REASON-CODE = '19' OR '36' OR '37' OR '62' OR          
                                       '63' OR 'A5' OR 'A6' OR 'RL' OR          
                                       'RN' OR 'RR' OR 'S1' OR 'SC' OR          
                                       'SP' OR 'Z1' OR 'Z2' OR 'Z3' OR          
                                       'Z4' OR 'Z5' OR 'Z6' OR 'Z7' OR          
                                       'Z8' OR 'ZA' OR 'ZB' OR 'ZC' OR          
                                       'ZD' OR 'ZL' OR 'ZP' OR 'MA' OR          
                                       'ME'                                     
                    MOVE 'Y'              TO WS-DEBAR-FND                       
                 ELSE                                                           
                    GO TO 4400-EXIT                                             
                 END-IF                                                         
                 ADD 1   TO  WS-CNT2                                            
                 IF WS-CNT2 = 1                                                 
                    MOVE 1                TO WS-CNT                             
                    MOVE K010-REASON-CODE TO WS-DEBAR-CDE(WS-CNT)               
                 ELSE                                                           
                    MOVE 'N'              TO WS-DEB-FND                         
                    PERFORM VARYING CNT2 FROM 1 BY 1                            
                                   UNTIL CNT2 > WS-CNT                          
                      IF K010-REASON-CODE = WS-DEBAR-CDE(CNT2)                  
                         MOVE 'Y'         TO WS-DEB-FND                         
                      END-IF                                                    
                    END-PERFORM                                                 
                    IF WS-DEB-FND = 'N'                                         
                       ADD  1    TO WS-CNT                                      
                       MOVE K010-REASON-CODE TO WS-DEBAR-CDE(WS-CNT)            
                    END-IF                                                      
                 END-IF                                                         
                 MOVE 'Y'                 TO WS-K010-FOUND                      
              ELSE                                                              
                 MOVE 'Y'                 TO WS-K010-EOF                        
              END-IF                                                            
           WHEN 10                                                              
           WHEN 23                                                              
              MOVE 'Y'                    TO WS-K010-EOF                        
              MOVE 'N'                    TO WS-DEBAR-FND                       
              MOVE 'N'                    TO WS-K010-FOUND                      
           WHEN OTHER                                                           
              DISPLAY 'ERROR READING P04K010 , STATUS IS: '                     
                        BP04K010-STATUS  ' -' WS-NUM-NRIC                       
              PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                         
           END-EVALUATE.                                                        
                                                                                
       4400-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4500-CHECK-PPOS.                                                         
      *---------------------------------------------------------------*         
                                                                                
           MOVE F800-NUM-NRIC1 TO WS-NUM-NRIC                                   
           PERFORM 4600-READ-PPOS    THRU 4600-EXIT                             
           IF WS-PPOS-FND = 'Y'                                                 
              MOVE 'N'    TO WS-VALID-REC                                       
              ADD 1       TO WS-INV-PPOS                                        
              ADD 1 TO WS-CNT3                                                  
              MOVE 'PPO'  TO WS-TXT-REMARK(WS-CNT3)                             
              GO TO 4500-EXIT                                                   
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES                                       
              MOVE F800-NUM-NRIC2 TO WS-NUM-NRIC                                
              PERFORM 4600-READ-PPOS    THRU 4600-EXIT                          
              IF WS-PPOS-FND = 'Y'                                              
                 MOVE 'N'    TO WS-VALID-REC                                    
                 ADD 1       TO WS-INV-PPOS                                     
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'PPO'  TO WS-TXT-REMARK(WS-CNT3)                          
                 GO TO 4500-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES                                       
              MOVE F800-NUM-NRIC3 TO WS-NUM-NRIC                                
              PERFORM 4600-READ-PPOS    THRU 4600-EXIT                          
              IF WS-PPOS-FND = 'Y'                                              
                 MOVE 'N'    TO WS-VALID-REC                                    
                 ADD 1       TO WS-INV-PPOS                                     
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'PPO'  TO WS-TXT-REMARK(WS-CNT3)                          
                 GO TO 4500-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES                                       
              MOVE F800-NUM-NRIC4 TO WS-NUM-NRIC                                
              PERFORM 4600-READ-PPOS    THRU 4600-EXIT                          
              IF WS-PPOS-FND = 'Y'                                              
                 MOVE 'N'    TO WS-VALID-REC                                    
                 ADD 1       TO WS-INV-PPOS                                     
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'PPO' TO WS-TXT-REMARK(WS-CNT3)                           
                 GO TO 4500-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4600-READ-PPOS.                                                          
      *-------------------------------------------------------------            
           MOVE SPACES                  TO K010-KEY-FLD.                        
           MOVE 'N'                     TO WS-K010-EOF                          
                                           WS-PPOS-FND                          
           MOVE WS-NUM-NRIC             TO K010-NUM-UIN.                        
                                                                                
           START BR10K010  KEY >= K010-KEY-FLD.                                 
                                                                                
           IF BR10K010-STATUS = ZEROES OR 02                                    
              PERFORM 4700-READNXT-BR10K010  THRU 4700-EXIT                     
                 UNTIL K010-NUM-UIN NOT = WS-NUM-NRIC                           
                    OR WS-K010-EOF = 'Y'                                        
           ELSE                                                                 
              IF BR10K010-STATUS = 23 OR 10                                     
                 MOVE 'Y'               TO WS-K010-EOF                          
              ELSE                                                              
                 DISPLAY 'BR10K010 - STARTBR ERROR, ' BR10K010-STATUS           
                 MOVE BR10K010-STATUS     TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4700-READNXT-BR10K010.                                                   
      *-------------------------------------------------------------            
           READ BR10K010 NEXT AT END                                            
                MOVE HIGH-VALUES TO K010-NUM-UIN                                
                MOVE 'Y' TO WS-K010-EOF                                         
                GO TO 4700-EXIT.                                                
                                                                                
           EVALUATE BR10K010-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 IF K010-NUM-UIN = WS-NUM-NRIC                                  
                    MOVE  'Y'         TO WS-PPOS-FND                            
                 ELSE                                                           
                    MOVE  'Y'         TO WS-K010-EOF                            
                    MOVE  'N'         TO WS-PPOS-FND                            
                 END-IF                                                         
              WHEN 23                                                           
              WHEN 10                                                           
                 MOVE  'Y'         TO WS-K010-EOF                               
                 MOVE  'N'         TO WS-PPOS-FND                               
              WHEN OTHER                                                        
                 DISPLAY 'BR10K010 - READ ERROR, ' BR10K010-STATUS              
                 MOVE BR10K010-STATUS     TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       4700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4800-CHECK-HLE.                                                          
      *---------------------------------------------------------------*         
           MOVE SPACES             TO K800-NUM-HLA OF BP27K800-MASTER.          
           MOVE F800-NUM-HLA       TO K800-NUM-HLA OF BP27K800-MASTER.          
                                                                                
           READ  BP27K800                                                       
                                                                                
           EVALUATE BP27K800-STATUS                                             
           WHEN 00                                                              
              PERFORM 4850-CHECK-HLE-DATES   THRU 4850-EXIT                     
           WHEN 23                                                              
              MOVE ZEROES          TO K800-DTE-HLA-EXPIRY                       
              MOVE ZEROES          TO K800-DTE-HLA-APPROVE                      
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING IN BP27K800, STATUS IS '                 
                         BP27K800-STATUS                                        
           END-EVALUATE.                                                        
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       4850-CHECK-HLE-DATES.                                                    
      *---------------------------------------------------------------*         
           IF K800-DTE-HLA-EXPIRY NOT NUMERIC                                   
              MOVE ZEROES       TO WS-DTE-HLE-EXP                               
           ELSE                                                                 
              MOVE K800-DTE-HLA-EXPIRY TO WS-DTE-HLE-EXP                        
           END-IF.                                                              
                                                                                
           IF K800-DTE-HLA-APPROVE NOT NUMERIC                                  
              MOVE ZEROES       TO WS-DTE-HLE-APR                               
           ELSE                                                                 
              MOVE K800-DTE-HLA-APPROVE TO WS-DTE-HLE-APR                       
           END-IF.                                                              
                                                                                
                                                                                
           IF WS-DTE-HLE-EXP NOT = ZEROES                                       
              COMPUTE WS-INT-EXP = FUNCTION                                     
                        INTEGER-OF-DATE(WS-DTE-HLE-EXP)                         
           ELSE                                                                 
              MOVE ZEROES       TO WS-INT-EXP                                   
           END-IF.                                                              
                                                                                
           COMPUTE WS-DIFF = WS-INT-EXP - WS-INT-CUR.                           
                                                                                
           IF (WS-DTE-HLE-APR < WS-DTE-ACCEPT) OR                               
              ((WS-DTE-HLE-APR > WS-DTE-ACCEPT) AND WS-DIFF >= 30)              
              CONTINUE                                                          
           ELSE                                                                 
              MOVE 'N'    TO WS-VALID-REC                                       
              ADD 1       TO WS-INV-LOAN-TAG-H                                  
              ADD 1 TO WS-CNT3                                                  
              MOVE 'LNTAG' TO WS-TXT-REMARK(WS-CNT3)                            
           END-IF.                                                              
                                                                                
       4850-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5000-CHECK-RESALE.                                                       
      *---------------------------------------------------------------*         
                                                                                
           MOVE F800-NUM-NRIC1 TO WS-NUM-NRIC                                   
           PERFORM 5100-START-BB24K510 THRU 5100-EXIT                           
           IF WS-K500-FOUND = 'N'                                               
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-RSL-FND NOT = 'Y'                                           
                 MOVE 'N'    TO WS-VALID-REC                                    
                 ADD 1       TO WS-INV-RSL                                      
                 ADD 1 TO WS-CNT3                                               
                 MOVE 'RSL'  TO WS-TXT-REMARK(WS-CNT3)                          
                 GO TO 5000-EXIT                                                
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES                                       
              MOVE F800-NUM-NRIC2 TO WS-NUM-NRIC                                
              PERFORM 5100-START-BB24K510 THRU 5100-EXIT                        
              IF WS-K500-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-RSL-FND NOT = 'Y'                                        
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-RSL                                   
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'RSL'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 5000-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES                                       
              MOVE F800-NUM-NRIC3 TO WS-NUM-NRIC                                
              PERFORM 5100-START-BB24K510 THRU 5100-EXIT                        
              IF WS-K500-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-RSL-FND NOT = 'Y'                                        
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-RSL                                   
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'RSL'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 5000-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES                                       
              MOVE F800-NUM-NRIC4 TO WS-NUM-NRIC                                
              PERFORM 5100-START-BB24K510 THRU 5100-EXIT                        
              IF WS-K500-FOUND = 'N'                                            
                 CONTINUE                                                       
              ELSE                                                              
                 IF WS-RSL-FND NOT = 'Y'                                        
                    MOVE 'N' TO WS-VALID-REC                                    
                    ADD 1       TO WS-INV-RSL                                   
                    ADD 1 TO WS-CNT3                                            
                    MOVE 'RSL'  TO WS-TXT-REMARK(WS-CNT3)                       
                    GO TO 5000-EXIT                                             
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       5100-START-BB24K510.                                                     
      *-------------------------------------------------------------            
           MOVE 'N'                     TO WS-K500-FOUND.                       
           MOVE 'Y'                     TO WS-RSL-FND.                          
           MOVE SPACES                  TO K510-KEY-FLD.                        
           MOVE 'N'                     TO WS-K510-EOF                          
           MOVE WS-NUM-NRIC             TO K510-NUM-UIN.                        
                                                                                
           START BB24K510  KEY >= K510-KEY-FLD.                                 
                                                                                
           IF BB24K510-STATUS = ZEROES OR 02                                    
              PERFORM 5200-READNXT-BB24K510  THRU 5200-EXIT                     
                 UNTIL K510-NUM-UIN NOT = WS-NUM-NRIC                           
                    OR WS-K510-EOF = 'Y'                                        
           ELSE                                                                 
              IF BB24K510-STATUS = 23 OR 10                                     
                 MOVE 'Y'               TO WS-K510-EOF                          
                 MOVE 'N'               TO WS-K500-FOUND                        
              ELSE                                                              
                 DISPLAY 'BB24K510 - STARTBR ERROR, ' BB24K510-STATUS           
                 MOVE BB24K510-STATUS     TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
              END-IF                                                            
           END-IF.                                                              
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
       5200-READNXT-BB24K510.                                                   
      *-------------------------------------------------------------            
           READ BB24K510 NEXT AT END                                            
                MOVE HIGH-VALUES TO K510-KEY-FLD                                
                MOVE 'Y' TO WS-K510-EOF                                         
                GO TO 5200-EXIT.                                                
                                                                                
           EVALUATE BB24K510-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 IF K510-NUM-UIN = WS-NUM-NRIC                                  
                    PERFORM 5300-READ-BB24K500 THRU 5300-EXIT                   
                 ELSE                                                           
                    MOVE  'Y'         TO WS-K510-EOF                            
                    MOVE 'N'          TO WS-K500-FOUND                          
                 END-IF                                                         
              WHEN 23                                                           
              WHEN 10                                                           
                 MOVE  'Y'         TO WS-K510-EOF                               
                 MOVE 'N'          TO WS-K500-FOUND                             
              WHEN OTHER                                                        
                 DISPLAY 'BB24K510 - READ ERROR, ' BB24K510-STATUS              
                 MOVE BB24K510-STATUS     TO RETURN-CODE                        
                 PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                        
           END-EVALUATE.                                                        
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5300-READ-BB24K500.                                                      
      *---------------------------------------------------------------*         
                                                                                
           MOVE K510-NUM-HDB-REF   TO K500-NUM-HDB-REF.                         
           MOVE K510-DTE-APPROVAL  TO K500-DTE-APPROVAL.                        
                                                                                
           READ BB24K500.                                                       
                                                                                
           EVALUATE BB24K500-STATUS                                             
              WHEN 00                                                           
                 IF K500-CDE-RESALE-STATUS NOT = 'OM ' AND 'OMS' AND            
                                                 'NA ' AND 'BN '                
                    MOVE 'N'  TO WS-RSL-FND                                     
                    MOVE 'Y'  TO WS-K510-EOF                                    
                    GO TO 5300-EXIT                                             
                 END-IF                                                         
                 MOVE K500-CDE-RESALE-STATUS TO WS-RSL-STAT                     
                 MOVE 'Y'     TO WS-K500-FOUND                                  
              WHEN 23                                                           
                 MOVE 'Y'     TO WS-K510-EOF                                    
                 MOVE 'N'     TO WS-K500-FOUND                                  
              WHEN OTHER                                                        
                 DISPLAY 'ERROR READING BB24K500: ' BB24K500-STATUS             
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       5500-CHECK-GRANT.                                                        
      *---------------------------------------------------------------*         
                                                                                
           PERFORM 5600-CALL-BP13CB4A   THRU 5600-EXIT.                         
                                                                                
           IF WS-GRT-ELIG = 'N' OR 'W'                                          
              CONTINUE                                                          
           ELSE                                                                 
              IF WS-GRT-ELIG = 'Y'                                              
                 IF WS-GRT-STAT = 'A' AND                                       
                    (WS-DTE-GRT-PAY NOT = SPACES AND LOW-VALUES)                
                    CONTINUE                                                    
                 ELSE                                                           
                    IF WS-GRT-STAT = 'R'                                        
                       CONTINUE                                                 
                    ELSE                                                        
                       MOVE 'N' TO WS-VALID-REC                                 
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       5500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-----------------------------------------------------------------        
       5600-CALL-BP13CB4A.                                                      
      *-----------------------------------------------------------------        
           INITIALIZE COM73-COMMAREA.                                           
                                                                                
           MOVE 'R'                  TO  COM73-NUM-CALL-ACTION.                 
           MOVE F800-NUM-REGN        TO  COM73-NUM-RGSTRN-INPUT.                
           CALL 'BP13CB4A' USING COM73-COMMAREA.                                
                                                                                
           IF COM73-CDE-ERROR = SPACES OR ZEROES                                
              CONTINUE                                                          
           ELSE                                                                 
              MOVE SPACES            TO  COM73-COMMAREA                         
              INITIALIZE                 COM73-COMMAREA                         
           END-IF.                                                              
                                                                                
           PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > 5                      
              IF COM73-NUM-GRANT-TYPE(WS-I) = 'AHG' OR 'SHG'                    
                 MOVE COM73-GRANT-STATUS(WS-I) TO WS-GRT-STAT                   
                 MOVE COM73-GRANT-AMOUNT-ELGBL(WS-I) TO WS-GRT-QUANTUM          
                 MOVE COM73-ELGBL-GRANT(WS-I)  TO WS-GRT-ELIG                   
                 MOVE COM73-DTE-PYMNT(WS-I)(1:4) TO WS-DTE-GRT-PAY(1:4)         
                 MOVE COM73-DTE-PYMNT(WS-I)(6:2) TO WS-DTE-GRT-PAY(5:2)         
                 MOVE COM73-DTE-PYMNT(WS-I)(9:2) TO WS-DTE-GRT-PAY(7:2)         
              END-IF                                                            
           END-PERFORM.                                                         
                                                                                
       5600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7000-READ-BP13K022.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES        TO K022-NUM-REGN.                                 
                                                                                
           MOVE F800-NUM-REGN TO K022-NUM-REGN.                                 
                                                                                
           READ BP13K022 KEY IS K022-NUM-REGN.                                  
                                                                                
           IF BP13K022-STATUS = 00 OR 02                                        
              IF K022-NUM-OIC-APPL NOT = SPACES AND LOW-VALUES                  
                 MOVE K022-NUM-OIC-APPL   TO F322-NUM-CRM                       
              ELSE                                                              
                 MOVE K022-NUM-OIC        TO F322-NUM-CRM                       
              END-IF                                                            
           ELSE                                                                 
              IF BP13K022-STATUS = 23                                           
                 CONTINUE                                                       
              ELSE                                                              
                 DISPLAY 'ERROR READING BP13K022 = '  BP13K022-STATUS           
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       8000-WRITE-OUTPUT.                                                       
      *---------------------------------------------------------------*         
           IF WS-VALID-REC = 'Y'                                                
              IF WS-OUTPUT-F322 = ZEROES                                        
                 PERFORM 8200-WRITE-HEADER THRU 8200-EXIT                       
              END-IF                                                            
           ELSE                                                                 
               IF ((WS-GRT-ELIG = 'Y' OR 'F') AND                               
                   (WS-GRT-STAT = SPACES OR LOW-VALUES) AND                     
                   (WS-DTE-GRT-PAY = SPACES OR LOW-VALUES))                     
                  IF WS-OUTPUT-F322B = ZEROES                                   
                     PERFORM 8200-WRITE-HEADER THRU 8200-EXIT                   
                  END-IF                                                        
               ELSE                                                             
                  IF WS-DTE-KEY-AVAIL NOT = SPACES AND ZEROES                   
                     IF WS-OUTPUT-F322B = ZEROES                                
                        PERFORM 8200-WRITE-HEADER THRU 8200-EXIT                
                     END-IF                                                     
                  ELSE                                                          
                     IF F800-NUM-LOAN-TAG = 'B'                                 
                        IF WS-OUTPUT-F322B = ZEROES                             
                           PERFORM 8200-WRITE-HEADER THRU 8200-EXIT             
                        END-IF                                                  
                     ELSE                                                       
                        IF WS-OUTPUT-F322A = ZEROES                             
                           PERFORM 8200-WRITE-HEADER THRU 8200-EXIT             
                        END-IF                                                  
                     END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
           MOVE SPACES              TO BP13F322-REC                             
                                       P13F322A-REC                             
                                       P13F322B-REC.                            
           INITIALIZE                  BP13F322-REC.                            
           INITIALIZE                  P13F322A-REC.                            
           INITIALIZE                  P13F322B-REC.                            
                                                                                
           MOVE ';'                 TO FILLER01 FILLER02 FILLER03               
                                       FILLER04 FILLER05 FILLER06               
                                       FILLER07 FILLER08 FILLER09               
                                       FILLER10 FILLER11 FILLER12               
                                       FILLER13 FILLER14 FILLER15               
                                       FILLER16 FILLER17 FILLER18               
                                       FILLER19 FILLER20 FILLER21               
                                       FILLER22 FILLER23 FILLER24               
                                       FILLER25 FILLER26 FILLER27               
                                       FILLER28 FILLER29 FILLER30               
                                       FILLER31 FILLER33.                       
                                                                                
           PERFORM VARYING CNT FROM 1 BY 1 UNTIL CNT > 10                       
               MOVE ';'             TO FILLER32(CNT)                            
           END-PERFORM.                                                         
                                                                                
           IF (KQ10-DTE-CHECKED NOT = SPACES AND LOW-VALUES) AND                
              (KQ10-NUM-CHECK-BY NOT = SPACES AND LOW-VALUES)                   
              MOVE 'Y'                TO F322-NUM-PREE-CHECK                    
           ELSE                                                                 
              MOVE SPACES             TO F322-NUM-PREE-CHECK                    
           END-IF.                                                              
           MOVE KQ10-NUM-CHECK-BY     TO F322-NUM-PREE-CHECKBY.                 
           MOVE KQ10-DTE-CHECKED      TO F322-DTE-PREE.                         
                                                                                
           MOVE F800-NUM-REGN         TO F322-NUM-REGN.                         
           MOVE F800-NUM-NEW-TOWN     TO F322-NUM-NT.                           
           MOVE WS-NUM-NEIG           TO F322-NUM-NEIGH.                        
           MOVE WS-NUM-CONT           TO F322-NUM-CONTRACT.                     
           MOVE WS-NUM-BLOCK          TO F322-NUM-BLOCK.                        
           MOVE F800-NUM-FLAT-TYPE    TO F322-NUM-FLAT-TYPE.                    
           MOVE WS-DTE-ACCEPT         TO F322-DTE-ACCEPT.                       
           MOVE WS-DTE-1ST-SOCA       TO F322-DTE-1ST-SA.                       
           MOVE F800-NUM-HOUSEHOLD OF BP13F800-MASTER TO                        
                                      F322-NUM-HOUSEHOLD.                       
           MOVE F800-NUM-RESALE-LEVY-TAG TO F322-NUM-RSL-LEVY.                  
           MOVE F800-NUM-PROV-TAG     TO F322-NUM-PROVI.                        
                                                                                
           STRING WS-GRT-ELIG '/' WS-GRT-STAT '/'                               
                  WS-GRT-QUANTUM                                                
                  DELIMITED BY SIZE INTO F322-NUM-GRANT-STATUS                  
           END-STRING.                                                          
                                                                                
           PERFORM  VARYING CNT FROM 1 BY 1 UNTIL CNT > WS-CNT                  
              OR WS-DEBAR-CDE(CNT) = SPACES                                     
              MOVE WS-DEBAR-CDE(CNT)  TO F322-NUM-DEBAR(CNT)                    
           END-PERFORM.                                                         
                                                                                
           PERFORM 7000-READ-BP13K022 THRU 7000-EXIT.                           
                                                                                
           IF WS-DTE-HLE-EXP NOT = ZEROES AND SPACES AND LOW-VALUES             
              STRING WS-DTE-HLE-EXP(1:4) '/'                                    
                     WS-DTE-HLE-EXP(5:2) '/'                                    
                     WS-DTE-HLE-EXP(7:2)                                        
                     DELIMITED BY SIZE INTO F322-DTE-HLE-EXP                    
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                TO F322-DTE-HLE-EXP                    
           END-IF.                                                              
                                                                                
           IF F800-DTE-BALLOT NOT = ZEROES AND SPACES AND LOW-VALUES            
              STRING F800-DTE-BALLOT(1:4) '/'                                   
                     F800-DTE-BALLOT(5:2)                                       
                     DELIMITED BY SIZE INTO F322-DTE-BALLOT                     
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                TO F322-DTE-BALLOT                     
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-ALLO-CAT        TO F322-NUM-ALLO-CAT.                  
                                                                                
           IF F800-DTE-AO-APPT NOT = ZEROES AND SPACES AND LOW-VALUES           
              STRING F800-DTE-AO-APPT(1:4) '/'                                  
                     F800-DTE-AO-APPT(5:2) '/'                                  
                     F800-DTE-AO-APPT(7:2)                                      
                     DELIMITED BY SIZE INTO F322-DTE-AO-APPT                    
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                TO F322-DTE-AO-APPT                    
           END-IF.                                                              
                                                                                
           MOVE F800-NUM-ALLO-SCHEME  TO F322-NUM-ALLOC-SCH .                   
           MOVE WS-RSL-STAT           TO F322-NUM-RSL-STAT.                     
           MOVE WS-PPOS-FND           TO F322-NUM-PPOS.                         
           MOVE F800-CDE-CITIZENSHIP-HOUSEHOLD TO F322-NUM-CTZN-HH.             
           MOVE WS-SC-SPR-PREM        TO F322-NUM-SC-SP-PREM.                   
           MOVE F800-NUM-CA-TAG       TO F322-NUM-CA-TAG.                       
           MOVE F800-NUM-LOAN-TAG     TO F322-NUM-LOAN-TAG.                     
                                                                                
           IF WS-DTE-HLE-APR NOT = SPACES AND LOW-VALUES AND ZEROES             
              STRING WS-DTE-HLE-APR(1:4) '/'                                    
                     WS-DTE-HLE-APR(5:2) '/'                                    
                     WS-DTE-HLE-APR(7:2)                                        
                     DELIMITED BY SIZE INTO F322-DTE-HLE-APPRVD                 
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                TO F322-DTE-HLE-APPRVD                 
           END-IF.                                                              
                                                                                
           IF WS-DTE-KEY-AVAIL NOT = SPACES AND LOW-VALUES AND ZEROES           
              STRING WS-DTE-KEY-AVAIL(1:4) '/'                                  
                     WS-DTE-KEY-AVAIL(5:2) '/'                                  
                     WS-DTE-KEY-AVAIL(7:2)                                      
                     DELIMITED BY SIZE INTO F322-DTE-KEY-AVAIL                  
              END-STRING                                                        
           ELSE                                                                 
              MOVE SPACES                TO F322-DTE-KEY-AVAIL                  
           END-IF.                                                              
                                                                                
           MOVE SPACES                TO F322-NUM-APPEAL.                       
           MOVE SPACES                TO F322-NUM-POWER-ATTY.                   
                                                                                
           MOVE SPACES                TO WS-REMARKS.                            
           STRING WS-TXT-REMARK(1)  ' ' WS-TXT-REMARK(2)  ' '                   
                  WS-TXT-REMARK(3)  ' ' WS-TXT-REMARK(4)  ' '                   
                  WS-TXT-REMARK(5)  ' ' WS-TXT-REMARK(6)  ' '                   
                  WS-TXT-REMARK(7)  ' ' WS-TXT-REMARK(8)  ' '                   
                  WS-TXT-REMARK(9)  ' ' WS-TXT-REMARK(10) ' '                   
                  WS-TXT-REMARK(11) ' ' WS-TXT-REMARK(12) ' '                   
                  WS-TXT-REMARK(13) ' ' WS-TXT-REMARK(14) ' '                   
                  WS-TXT-REMARK(15) ' ' WS-TXT-REMARK(16) ' '                   
                  WS-TXT-REMARK(17) ' ' WS-TXT-REMARK(18)                       
                  DELIMITED BY SIZE                                             
                  INTO WS-REMARKS                                               
           END-STRING.                                                          
                                                                                
           MOVE WS-REMARKS            TO F322-NUM-REMARK.                       
                                                                                
           IF WS-VALID-REC = 'Y'                                                
              WRITE BP13F322-REC                                                
              ADD 1 TO WS-OUTPUT-F322                                           
              MOVE BP13F800-MASTER  TO P13F800A-REC                             
              IF KQ10-NUM-CASE-OWNER = 'APPT  '                                 
                 MOVE 'EAT'         TO F800A-NUM-ALLO-CAT                       
                                       WS-GROUPING                              
              ELSE                                                              
                 MOVE 'EOT'         TO F800A-NUM-ALLO-CAT                       
                                       WS-GROUPING                              
              END-IF                                                            
              WRITE P13F800A-REC                                                
              ADD 1 TO WS-WRITE-F800A                                           
           ELSE                                                                 
              IF ((WS-GRT-ELIG = 'Y' OR 'F') AND                                
                  (WS-GRT-STAT = SPACES OR LOW-VALUES) AND                      
                  (WS-DTE-GRT-PAY = SPACES OR LOW-VALUES))                      
                  WRITE P13F322B-REC FROM BP13F322-REC                          
                  ADD 1 TO WS-OUTPUT-F322B                                      
                  MOVE BP13F800-MASTER  TO P13F800C-REC                         
                  WRITE P13F800C-REC                                            
                  ADD 1 TO WS-WRITE-F800C                                       
              ELSE                                                              
                  IF WS-DTE-KEY-AVAIL NOT = SPACES AND ZEROES                   
                     WRITE P13F322B-REC FROM BP13F322-REC                       
                     ADD 1 TO WS-OUTPUT-F322B                                   
                     MOVE BP13F800-MASTER  TO P13F800C-REC                      
                     WRITE P13F800C-REC                                         
                     ADD 1 TO WS-WRITE-F800C                                    
                     MOVE SPACES      TO WS-GROUPING                            
                  ELSE                                                          
      *              IF F800-NUM-LOAN-TAG = 'B'                                 
      *                 WRITE P13F322B-REC FROM BP13F322-REC                    
      *                 ADD 1 TO WS-OUTPUT-F322B                                
      *                 MOVE BP13F800-MASTER  TO P13F800C-REC                   
      *                 WRITE P13F800C-REC                                      
      *                 ADD 1 TO WS-WRITE-F800C                                 
      *                 MOVE SPACES      TO WS-GROUPING                         
      *              ELSE                                                       
                        WRITE P13F322A-REC FROM BP13F322-REC                    
                        ADD 1 TO WS-OUTPUT-F322A                                
                        MOVE BP13F800-MASTER  TO P13F800B-REC                   
                        IF KQ10-NUM-CASE-OWNER = 'APPT  '                       
                           MOVE 'NAT'         TO F800B-NUM-ALLO-CAT             
                                                 WS-GROUPING                    
                        ELSE                                                    
                           MOVE 'NOT'         TO F800B-NUM-ALLO-CAT             
                                               WS-GROUPING                      
                        END-IF                                                  
                        WRITE P13F800B-REC                                      
                        ADD 1 TO WS-WRITE-F800B                                 
      *              END-IF                                                     
                  END-IF                                                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
           PERFORM 8100-READ-UPD-BP13K20A   THRU 8100-EXIT.                     
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------------------------------------------------------*         
       8100-READ-UPD-BP13K20A.                                                  
      *---------------------------------------------------------------*         
           MOVE F800-NUM-ALLO-CAT     TO K20A-NUM-ALLO-MODE.                    
           MOVE 'NEW'                 TO K20A-NUM-PREE-STATUS.                  
           MOVE F800-DTE-BALLOT       TO K20A-DTE-BALLOT.                       
           MOVE F800-DTE-ACCEPTANCE   TO K20A-DTE-ACCEPTANCE.                   
           MOVE F800-NUM-REGN         TO K20A-NUM-REGN.                         
                                                                                
           READ BP13K20A.                                                       
                                                                                
           EVALUATE BP13K20A-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 MOVE 'N'              TO WS-DEB-UPD-IND                        
                 PERFORM  VARYING CNT FROM 1 BY 1 UNTIL CNT > 10                
                    IF WS-DEBAR-CDE(CNT) NOT = K20A-NUM-DEBAR(CNT)              
                       MOVE 'Y'        TO WS-DEB-UPD-IND                        
                    END-IF                                                      
                 END-PERFORM                                                    
                 IF K20A-NUM-PPO       NOT = F800-NUM-PPO OR                    
                    K20A-NUM-REMARK    NOT = WS-REMARKS   OR                    
                    WS-DEB-UPD-IND         = 'Y'          OR                    
                    K20A-NUM-GROUPING  NOT = WS-GROUPING                        
                    PERFORM 8130-REWRITE-BP13K20A  THRU 8130-EXIT               
                 END-IF                                                         
              WHEN 23                                                           
                  PERFORM 8120-WRITE-BP13K20A    THRU 8120-EXIT                 
              WHEN OTHER                                                        
                 DISPLAY ' ERROR READING BP13K20A REC '                         
                         ' STATUS ' BP13K20A-STATUS                             
                 DISPLAY ' KEY IS ' K20A-NUM-REGN                               
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       8100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       8110-MOVE-BP13K20A.                                                      
      *---------------------------------------------------------------*         
                                                                                
           MOVE F800-NUM-NEW-TOWN     TO K20A-NUM-NEW-TOWN.                     
           MOVE F800-NUM-FLAT-TYPE    TO K20A-NUM-FLAT-TYPE.                    
           MOVE F800-NUM-ELIG-SCHEME  TO K20A-NUM-ELIG-SCH.                     
           MOVE F800-NUM-IDP-SCHEME   TO K20A-NUM-IDP-SCH.                      
           MOVE F800-NUM-PPO          TO K20A-NUM-PPO.                          
                                                                                
           PERFORM  VARYING CNT FROM 1 BY 1 UNTIL CNT > 10                      
              OR WS-DEBAR-CDE(CNT) = SPACES                                     
              MOVE WS-DEBAR-CDE(CNT)  TO K20A-NUM-DEBAR(CNT)                    
           END-PERFORM.                                                         
                                                                                
           MOVE WS-REMARKS            TO K20A-NUM-REMARK.                       
                                                                                
           IF WS-VALID-REC = 'Y'                                                
              IF KQ10-NUM-CASE-OWNER = 'APPT  '                                 
                 MOVE 'EAT'              TO K20A-NUM-GROUPING                   
              ELSE                                                              
                 MOVE 'EOT'              TO K20A-NUM-GROUPING                   
              END-IF                                                            
           ELSE                                                                 
               IF WS-DTE-KEY-AVAIL NOT = SPACES AND ZEROES                      
                  MOVE SPACES         TO K20A-NUM-GROUPING                      
               ELSE                                                             
                  IF F800-NUM-LOAN-TAG = 'B'                                    
                     MOVE SPACES      TO K20A-NUM-GROUPING                      
                  ELSE                                                          
                  IF KQ10-NUM-CASE-OWNER = 'APPT  '                             
                     MOVE 'NAT'       TO K20A-NUM-GROUPING                      
                  ELSE                                                          
                     MOVE 'NOT'       TO K20A-NUM-GROUPING                      
                  END-IF                                                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
       8110-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       8120-WRITE-BP13K20A.                                                     
      *---------------------------------------------------------------*         
                                                                                
           PERFORM 8110-MOVE-BP13K20A     THRU 8110-EXIT.                       
                                                                                
           WRITE BP13K20A-REC.                                                  
                                                                                
           EVALUATE BP13K20A-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 ADD 1 TO  WS-WRITE-K20A                                        
              WHEN OTHER                                                        
                 DISPLAY ' ERROR WRITING INTO BP13K20A REC '                    
                         ' STATUS ' BP13K20A-STATUS                             
                 DISPLAY ' KEY IS ' K20A-NUM-REGN                               
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       8120-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       8130-REWRITE-BP13K20A.                                                   
      *---------------------------------------------------------------*         
                                                                                
           PERFORM 8110-MOVE-BP13K20A     THRU 8110-EXIT.                       
                                                                                
           REWRITE BP13K20A-REC.                                                
                                                                                
           EVALUATE BP13K20A-STATUS                                             
              WHEN 00                                                           
              WHEN 02                                                           
                 ADD 1 TO  WS-REWRITE-K20A                                      
              WHEN OTHER                                                        
                 DISPLAY ' ERROR REWRITING INTO BP13K20A REC '                  
                         ' STATUS ' BP13K20A-STATUS                             
                 DISPLAY ' KEY IS ' K20A-NUM-REGN                               
                 PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       8130-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       8200-WRITE-HEADER.                                                       
      *---------------------------------------------------------------*         
           MOVE SPACES              TO BP13F322-REC                             
                                       P13F322A-REC                             
                                       P13F322B-REC.                            
           INITIALIZE                  BP13F322-REC.                            
           INITIALIZE                  P13F322A-REC.                            
           INITIALIZE                  P13F322B-REC.                            
                                                                                
           IF WS-VALID-REC = 'Y'                                                
              MOVE WS-HEADER-LAYOUT TO BP13F322-REC                             
              WRITE BP13F322-REC                                                
           ELSE                                                                 
               IF WS-DTE-KEY-AVAIL NOT = SPACES AND ZEROES                      
                  MOVE WS-HEADER-LAYOUT TO P13F322B-REC                         
                  WRITE P13F322B-REC                                            
               ELSE                                                             
                  IF F800-NUM-LOAN-TAG = 'B'                                    
                     MOVE WS-HEADER-LAYOUT TO P13F322B-REC                      
                     WRITE P13F322B-REC                                         
                  ELSE                                                          
                     MOVE WS-HEADER-LAYOUT TO P13F322A-REC                      
                     WRITE P13F322A-REC                                         
                  END-IF                                                        
               END-IF                                                           
           END-IF.                                                              
                                                                                
       8200-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------------------------------------------------*         
       9000-CLOSE-FILES.                                                        
      *---------------------------------------------------------------*         
                                                                                
           DISPLAY ' '.                                                         
           DISPLAY '     BP13CZ37     '.                                        
           DISPLAY ' '.                                                         
           DISPLAY '*-----------------------------------------------*'.         
           DISPLAY 'NO OF RECORDS READ FROM F800   ' WS-F800-READ.              
           DISPLAY 'NO OF RECORDS WRITTEN BP13F322 ' WS-OUTPUT-F322.            
           DISPLAY 'NO OF RECORDS WRITTEN P13F322A ' WS-OUTPUT-F322A.           
           DISPLAY 'NO OF RECORDS WRITTEN P13F322B ' WS-OUTPUT-F322B.           
           DISPLAY 'NO OF RECORDS WRITTEN BP13K20A ' WS-WRITE-K20A.             
           DISPLAY 'NO OF RECORDS WRITTEN P13F800A ' WS-WRITE-F800A.            
           DISPLAY 'NO OF RECORDS WRITTEN P13F800B ' WS-WRITE-F800B.            
           DISPLAY 'NO OF RECORDS WRITTEN P13F800C ' WS-WRITE-F800C.            
           DISPLAY 'NO OF RECORDS UPDATED BP13K20A ' WS-REWRITE-K20A.           
           DISPLAY ' '.                                                         
           DISPLAY '*-----------------------------------------------*'.         
           DISPLAY '****** INVALID CASES COUNTERS********************'.         
           DISPLAY '*-----------------------------------------------*'.         
           DISPLAY 'NO OF FT/2T WHO DID NOT BOOK   ' WS-FT-NTBKD.               
           DISPLAY 'NO OF APPL BEFORE FEB 2017     ' WS-INV-DTE-BAL.            
           DISPLAY 'NO OF APPL W/ SOCA APPT DATE   ' WS-INV-DTE-AO.             
           DISPLAY 'NO OF PROVI CASES              ' WS-INV-PROV.               
           DISPLAY 'NO OF CANCELLED APPL           ' WS-CANCEL.                 
           DISPLAY 'NO OF INVALID ALLOC SCH        ' WS-INV-ALLO-SCH.           
           DISPLAY 'NO OF SER CASES                ' WS-SER.                    
           DISPLAY 'NO OF NPL CASES                ' WS-NPL.                    
           DISPLAY 'NO OF 2F CASES                 ' WS-2F.                     
           DISPLAY 'NO OF CASES WITH BLANK CA TAG  ' WS-INV-CA.                 
           DISPLAY 'NO OF CASES 1ST SA DATE BLANK  ' WS-INV-DTE-SOCA.           
           DISPLAY 'NO OF CASES LOAN-TAG = N + HLE ' WS-INV-LOAN-TAG-N.         
           DISPLAY 'NO OF CASES LOAN-TAG = H INV   ' WS-INV-LOAN-TAG-H.         
           DISPLAY 'NO OF CASES W/ INV RSL STAT    ' WS-INV-RSL.                
           DISPLAY 'NO OF CASES W/ PPOS            ' WS-INV-PPOS.               
           DISPLAY 'NO OF CASES W/ BLANK CHK DATE  ' WS-INV-CHK-DTE.            
           DISPLAY 'NO OF CASES W/ BLANK CHK BY    ' WS-INV-CHK-BY.             
           DISPLAY 'NO OF CASES W/ INVALID DEBAR   ' WS-INV-DEBAR.              
           DISPLAY 'NO OF CASE KEY AVAIL NOT BLANK ' WS-KEY-AVAIL.              
           DISPLAY 'NO OF CASE UNDER BANK LOAN     ' WS-BANK-LOAN.              
           DISPLAY 'NO OF CASE UNDER HLE LOAN      ' WS-HLE-LOAN.               
           DISPLAY 'NO OF CASE SKIPPED FOR AO DATE ' WS-SKIP-AO.                
                                                                                
           CLOSE BP13F800                                                       
                 BP13K022                                                       
                 BP13K20A                                                       
                 BB24K500                                                       
                 BB24K510                                                       
                 BP13KQ10                                                       
                 BR10K010                                                       
                 BM06K110                                                       
                 BM06K100                                                       
                 BP27K800                                                       
                 P04K010                                                        
                 BP13F322                                                       
                 P13F322A                                                       
                 P13F322B                                                       
                 P13F800A                                                       
                 P13F800B                                                       
                 P13F800C.                                                      
                                                                                
           IF  BB24K510-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BB24K510-STATUS ' BB24K510-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BB24K500-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BB24K500-STATUS ' BB24K500-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BP13KQ10-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BP13KQ10-STATUS ' BP13KQ10-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BP13K022-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BP13K022-STATUS ' BP13K022-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BP13K20A-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BP13K20A-STATUS ' BP13K20A-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BR10K010-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BR10K010-STATUS ' BR10K010-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BP04K010-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BP04K010-STATUS ' BP04K010-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BM06K110-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BM06K110-STATUS ' BM06K110-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BM06K100-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BM06K100-STATUS ' BM06K100-STATUS                       
           END-IF.                                                              
                                                                                
           IF  BP27K800-STATUS NOT = ZEROS AND 97                               
               DISPLAY 'CLOSING ERROR '                                         
               DISPLAY 'BP27K800-STATUS ' BP27K800-STATUS                       
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
