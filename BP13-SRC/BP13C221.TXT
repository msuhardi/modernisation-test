       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C221.                                                 
      *AUTHOR.        CHETANA.                                                  
      *DATE-WRITTEN.  07 JAN 2019.                                              
      * ======================================================== *              
      * SYSTEM OF COMMITMENT (BP13)                              *              
      * ======================================================== *              
      *    OBJECTIVE  :                                          *              
      *      1.  CREATE F206 XML FILE                            *              
      *                                                          *              
      *     INPUT FILES:                                         *              
      *           1. BP13F800                                    *              
      *           2. BP13K022                                    *              
      *           3. BP13K820                                    *              
      *           4. SY02F001                                    *              
      *                                                          *              
      *     OUTPUT FILES:                                        *              
      *           1. BP13F206                                    *              
      * -------------------------------------------------------- *              
      *  CHG NO     DATE     BY   DESCRIPTION                    *              
      * -------- ----------  ---- ------------------------------ *              
      * BP13XXXX 07/01/2019  CC37 NEW PROGRAM                    *              
      * BP138201 21/07/2020  MRR5 HANDLE SPECIAL CHARS IN name   *              
      ************************************************************              
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
      *-------------------------------------------------------------            
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
                                                                                
           SELECT BP13F800  ASSIGN        TO  BP13F800.                         
                                                                                
           SELECT SY02F001  ASSIGN        TO  SY02F001.                         
                                                                                
           SELECT BP13F206  ASSIGN        TO  BP13F206                          
                            FILE STATUS IS F206-STATUS.                         
                                                                                
           SELECT BP13F290  ASSIGN        TO  BP13F290                          
                            FILE STATUS IS F290-STATUS.                         
                                                                                
           SELECT BP13K820  ASSIGN        TO  BP13K820                          
                            ORGANIZATION  IS  INDEXED                           
                            ACCESS MODE   IS  RANDOM                            
                            RECORD KEY    IS  K820-KEY-FLD                      
                            FILE STATUS   IS  K820-STATUS.                      
                                                                                
           SELECT BP13K022  ASSIGN        TO  BP13K022                          
                            ORGANIZATION  IS  INDEXED                           
                            ACCESS MODE   IS  RANDOM                            
                            RECORD KEY    IS  K022-KEY-FLD                      
                            ALTERNATE RECORD KEY IS  K022-NUM-REGN              
                            FILE STATUS   IS  K022-STATUS.                      
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *-------------------------------------------------------------            
                                                                                
       FD   BP13F800                                                            
            BLOCK  CONTAINS 0   RECORDS                                         
            LABEL  RECORDS  ARE STANDARD                                        
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 2000  CHARACTERS.                                   
       COPY BP13F800.                                                           
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD   BP13F206                                                            
            BLOCK CONTAINS 0 RECORDS                                            
            RECORD CONTAINS 150 CHARACTERS                                      
            LABEL RECORDS ARE STANDARD                                          
            RECORDING MODE IS F.                                                
       01   BP13F206-REC                  PIC X(150).                           
                                                                                
       FD  BP13F290                                                             
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 100 CHARACTERS                                       
           LABEL RECORD IS STANDARD                                             
           RECORDING MODE IS F.                                                 
       COPY BP13F290.                                                           
                                                                                
       FD   BP13K820                                                            
            RECORD CONTAINS 400 CHARACTERS.                                     
       COPY BP13K820.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
      *------------------------------------------------------------*            
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-INDICATORS.                                                       
           05  WS-EOF-F800                PIC X       VALUE 'N'.                
           05  WS-EOF-F001                PIC X       VALUE 'N'.                
           05  K820-STATUS                PIC 9(2)    VALUE  00.                
           05  K022-STATUS                PIC 9(2)    VALUE  00.                
           05  F206-STATUS                PIC 9(2)    VALUE  00.                
           05  F290-STATUS                PIC 9(2)    VALUE  00.                
                                                                                
       01  WS-COUNTERS-POINTERS.                                                
           05  WS-READ-CNT-F800           PIC 9(7)    VALUE ZEROS.              
           05  WS-WRITE-F206              PIC 9(6)    VALUE ZEROS.              
           05  WS-WRITE-F290              PIC 9(6)    VALUE ZEROS.              
           05  WS-MISSING-K022            PIC 9(7)    VALUE ZEROS.              
           05  WS-MISSING-F820            PIC 9(7)    VALUE ZEROS.              
           05  WS-MISSING-PIDB            PIC 9(7)    VALUE ZEROS.              
           05  WS-INTEGER-DTE-SO-APPT     PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-DTE-2ND-CONLOAN PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-DTE-SUBTRANSFER PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-DTE-AO-APPT     PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-DTE-BK-APPT     PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-DTE-SL-APPT     PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-CUR-DATE1       PIC S9(9)   VALUE ZEROS.              
           05  WS-INTEGER-CUR-DATE4       PIC S9(9)   VALUE ZEROS.              
           05  WS-DATE-CHECK              PIC X(8)    VALUE SPACES.             
           05  WS-INVALID                 PIC X       VALUE 'N'.                
           05  WS-F800-DTE-SO-APPT        PIC X(8).                             
           05  WS-F800-DTE-SO-APPT-9 REDEFINES WS-F800-DTE-SO-APPT              
                                          PIC 9(8).                             
           05  WS-F800-DTE-2ND-CONLOAN    PIC X(8).                             
           05  WS-F800-DTE-2ND-CONLOAN-9 REDEFINES                              
               WS-F800-DTE-2ND-CONLOAN    PIC 9(8).                             
           05  WS-F800-DTE-SUBTRANSFER    PIC X(8).                             
           05  WS-F800-DTE-SUBTRANSFER-9 REDEFINES                              
               WS-F800-DTE-SUBTRANSFER    PIC 9(8).                             
           05  WS-F800-DTE-AO-APPT        PIC X(8).                             
           05  WS-F800-DTE-AO-APPT-9 REDEFINES WS-F800-DTE-AO-APPT              
                                          PIC 9(8).                             
           05  WS-F800-DTE-BK-APPT        PIC X(8).                             
           05  WS-F800-DTE-BK-APPT-9 REDEFINES WS-F800-DTE-BK-APPT              
                                          PIC 9(8).                             
           05  WS-F800-DTE-SL-APPT        PIC X(8).                             
           05  WS-F800-DTE-SL-APPT-9 REDEFINES WS-F800-DTE-SL-APPT              
                                          PIC 9(8).                             
                                                                                
       01  WS-TIME-APPT                   PIC X(4).                             
       01  WS-DATE                        PIC X(8).                             
       01  WS-DATE9 REDEFINES WS-DATE     PIC 9(8).                             
       01  WS-NAME-OCC                    PIC X(66)   VALUE SPACES.             
       01  WS-X                           PIC 9(2).                             
       01  WS-APOS                        PIC X(1).                             
                                                                                
       01  LINK-VARIABLES.                                                      
           05 WS-LINK-REC.                                                      
              10 WS-IN-OPTION          PIC X(02).                               
              10 WS-IN-GEN.                                                     
                 15 WS-IN-DATE         PIC X(08).                               
              10 WS-RET-GEN.                                                    
                 15 WS-RETURN          PIC X(03).                               
                                                                                
       COPY F206XML.                                                            
       COPY P13COMM8.                                                           
                                                                                
       01  LINK-REC.                                                            
           05  LINK-NUM-SCH-ACC.                                                
               10  LINK-NUM-SCH             PIC X(4).                           
               10  LINK-NUM-ACC             PIC X(5).                           
                                                                                
       01  WS-VARS.                                                             
           05  XML-DECLARATION         PIC X(38) VALUE                          
               '<?xml version="1.0" encoding="UTF-8"?>'.                        
           05  XML-OPEN                PIC X(09) VALUE '<apntmts>'.             
           05  XML-CLOSE               PIC X(10) VALUE '</apntmts>'.            
           05  CSTMRS-OPEN             PIC X(10) VALUE '<cstmrs>'.              
           05  CSTMRS-CLOSE            PIC X(11) VALUE '</cstmrs>'.             
           05  CUSTOMER-OPEN           PIC X(10) VALUE '<cstmr>'.               
           05  CUSTOMER-CLOSE          PIC X(11) VALUE '</cstmr>'.              
           05  ADDRESS-OPEN            PIC X(06) VALUE '<adrs>'.                
           05  ADDRESS-CLOSE           PIC X(07) VALUE '</adrs>'.               
           05  RCRD-OPEN               PIC X(06) VALUE '<rcrd>'.                
           05  RCRD-CLOSE              PIC X(07) VALUE '</rcrd>'.               
      *    05  APPOINTMENT-OPEN.                                                
      *        10 FILLER               PIC X(12) VALUE '<appointment'.          
      *        10 FILLER               PIC X(09) VALUE ' rec-no="'.             
      *        10 REC-NO               PIC 9(06) VALUE ZEROES.                  
      *        10 FILLER               PIC X(02) VALUE '">'.                    
      *    05  APPOINTMENT-CLOSE       PIC X(14) VALUE '</appointment>'.        
           05  BLOCK-DETAILS.                                                   
               10 BLOCK-OPEN           PIC X(07) VALUE '<block>'.               
               10 WS-BLOCK             PIC X(05) VALUE SPACES.                  
               10 BLOCK-CLOSE          PIC X(08) VALUE '</block>'.              
           05  UNIT-DETAILS.                                                    
               10 UNIT-OPEN            PIC X(06) VALUE '<unit>'.                
               10 WS-UNIT              PIC X(07) VALUE SPACES.                  
               10 UNIT-CLOSE           PIC X(07) VALUE '</unit>'.               
                                                                                
       01  WRITE-REC                   PIC X(80) VALUE SPACES.                  
      *------------------------------------------------------------*            
       PROCEDURE DIVISION.                                                      
      *------------------------------------------------------------*            
       000-MAIN.                                                                
      *------------------------------------------------------------*            
           INITIALIZE C221-TAGS                                                 
           PERFORM  100-OPEN-FILES        THRU   100-EXIT.                      
           PERFORM  150-READ-SY02F001     THRU   150-EXIT                       
           PERFORM  200-READ-BP13F800     THRU   200-EXIT.                      
           WRITE BP13F206-REC FROM XML-DECLARATION                              
           MOVE SPACES              TO BP13F206-REC                             
           WRITE BP13F206-REC FROM XML-OPEN                                     
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           MOVE 'CREATE'            TO action                                   
           XML GENERATE WRITE-REC FROM action                                   
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           PERFORM  300-PROCESS-F800      THRU   300-EXIT                       
                        UNTIL WS-EOF-F800 = 'Y'.                                
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           MOVE WS-WRITE-F206       TO rcrds                                    
           XML GENERATE WRITE-REC FROM rcrds                                    
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           WRITE BP13F206-REC FROM XML-CLOSE                                    
                                                                                
           PERFORM  9999-CLOSE-ROUTINE    THRU   9999-EXIT.                     
                                                                                
       000-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       100-OPEN-FILES.                                                          
      *-------------------------------------------------------------            
           OPEN INPUT  BP13F800                                                 
                       SY02F001                                                 
                       BP13K820                                                 
                       BP13K022                                                 
                OUTPUT BP13F206                                                 
                       BP13F290.                                                
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13K820 - OPEN ERROR, K820-STATUS ' K820-STATUS         
              MOVE     K820-STATUS      TO       RETURN-CODE                    
              PERFORM  9999-CLOSE-ROUTINE.                                      
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13K022 - OPEN ERROR, K022-STATUS ' K022-STATUS         
              MOVE     K022-STATUS      TO       RETURN-CODE                    
              PERFORM  9999-CLOSE-ROUTINE.                                      
                                                                                
           MOVE ZEROS                       TO WS-COUNTERS-POINTERS.            
                                                                                
       100-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       150-READ-SY02F001.                                                       
      *-------------------------------------------------------------            
           READ SY02F001                                                        
                AT END MOVE 'Y'         TO     WS-EOF-F001                      
                       GO TO 150-EXIT.                                          
                                                                                
           MOVE F001-DTE-CURRENT TO WS-DATE.                                    
                                                                                
           COMPUTE WS-INTEGER-CUR-DATE1 =                                       
              FUNCTION INTEGER-OF-DATE(WS-DATE9) + 1                            
           COMPUTE WS-INTEGER-CUR-DATE4 =                                       
              FUNCTION INTEGER-OF-DATE(WS-DATE9) + 3.                           
                                                                                
       150-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       200-READ-BP13F800.                                                       
      *-------------------------------------------------------------            
           READ BP13F800                                                        
                AT END MOVE 'Y'         TO     WS-EOF-F800                      
                       GO TO 200-EXIT.                                          
                                                                                
           ADD     1                    TO     WS-READ-CNT-F800.                
           INITIALIZE C221-TAGS WS-BLOCK WS-UNIT                                
                                                                                
           IF F800-DTE-SO-APPT NOT = SPACES AND LOW-VALUES AND                  
                                     ZEROES AND                                 
             (F800-DTE-SO-APPT >= F800-DTE-2ND-CONC-LOAN-APPT) AND              
             (F800-DTE-SO-APPT >= F800-DTE-SUB-TRANSFER-APPT)  AND              
             (F800-DTE-SO-APPT >= F800-DTE-SL-APPT)            AND              
             (F800-DTE-SO-APPT >= F800-DTE-AO-APPT)                             
              MOVE 'N'                  TO  WS-INVALID                          
              MOVE F800-DTE-SO-APPT     TO  WS-DATE-CHECK                       
              PERFORM 500-VALIDATE-DATE     THRU  500-EXIT                      
              IF WS-INVALID = 'Y'                                               
                 DISPLAY 'REGN: ' F800-NUM-REGN                                 
                         '  SO-APPT: ' F800-DTE-SO-APPT                         
                 MOVE ZEROES  TO F800-DTE-SO-APPT                               
              END-IF                                                            
           ELSE                                                                 
              IF F800-DTE-2ND-CONC-LOAN-APPT NOT = SPACES AND LOW-VALUES        
                                                   AND ZEROES AND               
                (F800-DTE-2ND-CONC-LOAN-APPT >=                                 
                                      F800-DTE-SUB-TRANSFER-APPT) AND           
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-SL-APPT) AND           
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-AO-APPT)               
                 MOVE 'N'                  TO  WS-INVALID                       
                 MOVE F800-DTE-2ND-CONC-LOAN-APPT TO WS-DATE-CHECK              
                 PERFORM 500-VALIDATE-DATE     THRU  500-EXIT                   
                 IF WS-INVALID = 'Y'                                            
                    DISPLAY 'REGN: ' F800-NUM-REGN                              
                            '  2ND-CONC-LOAN: '                                 
                            F800-DTE-2ND-CONC-LOAN-APPT                         
                    MOVE ZEROES  TO F800-DTE-2ND-CONC-LOAN-APPT                 
                 END-IF                                                         
              ELSE                                                              
                 IF F800-DTE-SUB-TRANSFER-APPT NOT = SPACES AND                 
                                           LOW-VALUES AND ZEROES AND            
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-SL-APPT) AND         
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-AO-APPT)             
                    MOVE 'N'                  TO  WS-INVALID                    
                    MOVE F800-DTE-SUB-TRANSFER-APPT  TO WS-DATE-CHECK           
                    PERFORM 500-VALIDATE-DATE     THRU  500-EXIT                
                    IF WS-INVALID = 'Y'                                         
                       DISPLAY 'REGN: ' F800-NUM-REGN                           
                               ' SUB-TRANSFER-APPT: '                           
                               F800-DTE-SUB-TRANSFER-APPT                       
                       MOVE ZEROES  TO F800-DTE-SUB-TRANSFER-APPT               
                    END-IF                                                      
                 ELSE                                                           
                    IF F800-DTE-SL-APPT NOT = SPACES AND LOW-VALUES AND         
                                              ZEROES AND                        
                      (F800-DTE-SL-APPT >= F800-DTE-AO-APPT)                    
                       MOVE 'N'                  TO  WS-INVALID                 
                       MOVE F800-DTE-SL-APPT     TO  WS-DATE-CHECK              
                       PERFORM 500-VALIDATE-DATE     THRU  500-EXIT             
                       IF WS-INVALID = 'Y'                                      
                          DISPLAY 'REGN: ' F800-NUM-REGN                        
                                  '  SL-APPT: ' F800-DTE-SL-APPT                
                          MOVE ZEROES   TO F800-DTE-SL-APPT                     
                       END-IF                                                   
                    ELSE                                                        
                       IF F800-DTE-AO-APPT NOT = SPACES AND LOW-VALUES          
                                                 AND ZEROES                     
                          MOVE 'N'                  TO  WS-INVALID              
                          MOVE F800-DTE-AO-APPT     TO  WS-DATE-CHECK           
                          PERFORM 500-VALIDATE-DATE     THRU  500-EXIT          
                          IF WS-INVALID = 'Y'                                   
                             DISPLAY 'REGN: ' F800-NUM-REGN                     
                                     '  AO-APPT: ' F800-DTE-AO-APPT             
                             MOVE ZEROES   TO F800-DTE-AO-APPT                  
                          END-IF                                                
                       ELSE                                                     
                          IF F800-DTE-BK-APPT-MGPS NOT = SPACES AND             
                                                LOW-VALUES AND ZEROES           
                             MOVE 'N'                   TO  WS-INVALID          
                             MOVE F800-DTE-BK-APPT-MGPS TO WS-DATE-CHECK        
                             PERFORM 500-VALIDATE-DATE   THRU  500-EXIT         
                             IF WS-INVALID = 'Y'                                
                                DISPLAY 'REGN: ' F800-NUM-REGN                  
                                        '  BK-APPT-MGPS: '                      
                                        F800-DTE-BK-APPT-MGPS                   
                                MOVE ZEROES   TO F800-DTE-BK-APPT-MGPS          
                             END-IF                                             
                          ELSE                                                  
                             IF F800-DTE-BK-APPT NOT = SPACES AND               
                                             LOW-VALUES AND ZEROES              
                                MOVE 'N'               TO WS-INVALID            
                                MOVE F800-DTE-BK-APPT  TO WS-DATE-CHECK         
                                PERFORM 500-VALIDATE-DATE  THRU 500-EXIT        
                                IF WS-INVALID = 'Y'                             
                                   DISPLAY 'REGN: ' F800-NUM-REGN               
                                           '  BK-APPT: '                        
                                           F800-DTE-BK-APPT                     
                                   MOVE ZEROES   TO F800-DTE-BK-APPT            
                                END-IF                                          
                             END-IF                                             
                          END-IF                                                
                       END-IF                                                   
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
       200-EXIT.                                                                
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       300-PROCESS-F800.                                                        
      *-------------------------------------------------------------            
           MOVE SPACES TO BP13F206-REC.                                         
           INITIALIZE BP13F206-REC.                                             
           MOVE 'SALES'              TO  dptmnt.                                
           MOVE F800-NUM-NEW-TOWN    TO  townCode.                              
           MOVE F800-NUM-FLAT-TYPE   TO  flatType.                              
           MOVE F800-DTE-BALLOT      TO  ballotDate.                            
      *    MOVE F800-NUM-NRIC1       TO  nric.                                  
           MOVE F800-NUM-ALLO-CAT    TO  slctType.                              
           MOVE F800-DTE-REGN        TO  rgstrtnDate                            
           MOVE F800-NUM-REGN        TO  rfrnc.                                 
           MOVE 'APPLICANT'          TO  role.                                  
                                                                                
           IF F800-DTE-SO-APPT NOT = SPACES AND LOW-VALUES AND ZEROES           
                                     AND                                        
             (F800-DTE-SO-APPT >= F800-DTE-2ND-CONC-LOAN-APPT)  AND             
             (F800-DTE-SO-APPT >= F800-DTE-SUB-TRANSFER-APPT)   AND             
             (F800-DTE-SO-APPT >= F800-DTE-SL-APPT)             AND             
             (F800-DTE-SO-APPT >= F800-DTE-AO-APPT)                             
              MOVE F800-DTE-SO-APPT  TO  WS-F800-DTE-SO-APPT                    
              COMPUTE WS-INTEGER-DTE-SO-APPT =                                  
                 FUNCTION INTEGER-OF-DATE(WS-F800-DTE-SO-APPT-9)                
              IF WS-INTEGER-DTE-SO-APPT >= WS-INTEGER-CUR-DATE1 AND             
                 WS-INTEGER-DTE-SO-APPT <= WS-INTEGER-CUR-DATE4                 
                 IF F800-DTE-AO-APPT = SPACES OR LOW-VALUES OR ZEROES           
                    MOVE 'SATP'  TO  srvc                                       
                    MOVE F800-DTE-SO-APPT TO apntmtDate                         
                    MOVE F800-TME-SO-APPT TO WS-TIME-APPT                       
                    PERFORM 310-WRITE-F206 THRU 310-EXIT                        
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                        
                 ELSE                                                           
                    MOVE 'TP  '  TO  srvc                                       
                    MOVE F800-DTE-SO-APPT TO apntmtDate                         
                    MOVE F800-TME-SO-APPT TO WS-TIME-APPT                       
                    PERFORM 310-WRITE-F206 THRU 310-EXIT                        
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                        
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              IF F800-DTE-2ND-CONC-LOAN-APPT NOT = SPACES AND LOW-VALUES        
                                                   AND ZEROES AND               
                (F800-DTE-2ND-CONC-LOAN-APPT >=                                 
                                  F800-DTE-SUB-TRANSFER-APPT)     AND           
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-SL-APPT) AND           
                (F800-DTE-2ND-CONC-LOAN-APPT >= F800-DTE-AO-APPT)               
                 MOVE F800-DTE-2ND-CONC-LOAN-APPT                               
                                       TO WS-F800-DTE-2ND-CONLOAN               
                 COMPUTE WS-INTEGER-DTE-2ND-CONLOAN =                           
                   FUNCTION INTEGER-OF-DATE(WS-F800-DTE-2ND-CONLOAN-9)          
                 IF WS-INTEGER-DTE-2ND-CONLOAN >= WS-INTEGER-CUR-DATE1          
                    AND                                                         
                    WS-INTEGER-DTE-2ND-CONLOAN <= WS-INTEGER-CUR-DATE4          
                    MOVE 'LA  '           TO srvc                               
                    MOVE F800-DTE-2ND-CONC-LOAN-APPT TO apntmtDate              
                    MOVE F800-TME-2ND-CONC-LOAN-APPT TO WS-TIME-APPT            
                    PERFORM 310-WRITE-F206 THRU 310-EXIT                        
                    PERFORM 400-WRITE-F290 THRU 400-EXIT                        
                 END-IF                                                         
              ELSE                                                              
                 IF F800-DTE-SUB-TRANSFER-APPT  NOT = SPACES AND                
                                                  LOW-VALUES AND ZEROES         
                                                AND                             
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-SL-APPT) AND         
                   (F800-DTE-SUB-TRANSFER-APPT >= F800-DTE-AO-APPT)             
                    MOVE F800-DTE-SUB-TRANSFER-APPT                             
                                             TO WS-F800-DTE-SUBTRANSFER         
                    COMPUTE WS-INTEGER-DTE-SUBTRANSFER =                        
                    FUNCTION INTEGER-OF-DATE(WS-F800-DTE-SUBTRANSFER-9)         
                    IF WS-INTEGER-DTE-SUBTRANSFER >=                            
                       WS-INTEGER-CUR-DATE1 AND                                 
                       WS-INTEGER-DTE-SUBTRANSFER <=                            
                       WS-INTEGER-CUR-DATE4                                     
                       MOVE 'SOCT'           TO srvc                            
                       MOVE F800-DTE-SUB-TRANSFER-APPT TO                       
                                                      apntmtDate                
                       MOVE F800-TME-SUB-TRANSFER-APPT TO                       
                                                      WS-TIME-APPT              
                       PERFORM 310-WRITE-F206 THRU 310-EXIT                     
                       PERFORM 400-WRITE-F290 THRU 400-EXIT                     
                    END-IF                                                      
                 ELSE                                                           
                    IF F800-DTE-SL-APPT NOT = SPACES AND LOW-VALUES             
                                              AND ZEROES AND                    
                      (F800-DTE-SL-APPT >= F800-DTE-AO-APPT)                    
                       MOVE F800-DTE-SL-APPT TO WS-F800-DTE-SL-APPT             
                       COMPUTE WS-INTEGER-DTE-SL-APPT =                         
                       FUNCTION INTEGER-OF-DATE                                 
                                (WS-F800-DTE-SL-APPT-9)                         
                       IF WS-INTEGER-DTE-SL-APPT >=                             
                          WS-INTEGER-CUR-DATE1  AND                             
                          WS-INTEGER-DTE-SL-APPT <=                             
                          WS-INTEGER-CUR-DATE4                                  
                          MOVE 'SL  '  TO  srvc                                 
                          MOVE F800-DTE-SL-APPT TO apntmtDate                   
                          MOVE F800-TME-SL-APPT TO WS-TIME-APPT                 
                          MOVE F800-NUM-NT-FT-QUEUE to sales1queue              
                          PERFORM 310-WRITE-F206   THRU 310-EXIT                
                          PERFORM 400-WRITE-F290   THRU 400-EXIT                
                       END-IF                                                   
                    ELSE                                                        
                       IF F800-DTE-AO-APPT NOT = SPACES AND LOW-VALUES          
                                                 AND ZEROES                     
                          MOVE F800-DTE-AO-APPT TO  WS-F800-DTE-AO-APPT         
                          COMPUTE WS-INTEGER-DTE-AO-APPT = FUNCTION             
                                 INTEGER-OF-DATE(WS-F800-DTE-AO-APPT-9)         
                          IF WS-INTEGER-DTE-AO-APPT >=                          
                             WS-INTEGER-CUR-DATE1 AND                           
                             WS-INTEGER-DTE-AO-APPT <=                          
                             WS-INTEGER-CUR-DATE4                               
                             IF F800-NUM-ALLO-CAT = 'DBS'                       
                                MOVE 'DSNP'  TO  srvc                           
                             ELSE                                               
                                IF ((F800-NUM-FLAT-TYPE NOT = '1A' OR           
                                    '2A') AND F800-NUM-LOAN-TAG = 'N')          
                                   MOVE 'SOCN'  TO  srvc                        
                                ELSE                                            
                                   MOVE 'SOCA'  TO  srvc                        
                                END-IF                                          
                             END-IF                                             
                             MOVE F800-DTE-AO-APPT TO apntmtDate                
                             MOVE F800-TME-AO-APPT TO WS-TIME-APPT              
                             PERFORM 310-WRITE-F206 THRU 310-EXIT               
                             PERFORM 400-WRITE-F290 THRU 400-EXIT               
                          END-IF                                                
                       ELSE                                                     
                          IF F800-DTE-BK-APPT-MGPS NOT = SPACES AND             
                                              LOW-VALUES AND ZEROES             
                             MOVE F800-DTE-BK-APPT-MGPS                         
                                        TO WS-F800-DTE-BK-APPT                  
                             COMPUTE WS-INTEGER-DTE-BK-APPT =                   
                             FUNCTION INTEGER-OF-DATE                           
                                     (WS-F800-DTE-BK-APPT-9)                    
                             IF WS-INTEGER-DTE-BK-APPT >=                       
                                WS-INTEGER-CUR-DATE1  AND                       
                                WS-INTEGER-DTE-BK-APPT <=                       
                                WS-INTEGER-CUR-DATE4                            
                                MOVE 'BK  '  TO  srvc                           
                                MOVE F800-DTE-BK-APPT-MGPS                      
                                             TO apntmtDate                      
                                MOVE F800-TME-BK-APPT-MGPS                      
                                             TO WS-TIME-APPT                    
                                MOVE F800-NUM-QUEUE-MGPS                        
                                             TO sales1queue                     
                                PERFORM 310-WRITE-F206   THRU 310-EXIT          
                                PERFORM 400-WRITE-F290   THRU 400-EXIT          
                             END-IF                                             
                          END-IF                                                
                          IF F800-DTE-BK-APPT NOT = SPACES AND                  
                                                  LOW-VALUES AND ZEROES         
                             MOVE F800-DTE-BK-APPT TO                           
                                  WS-F800-DTE-BK-APPT                           
                             COMPUTE WS-INTEGER-DTE-BK-APPT =                   
                             FUNCTION INTEGER-OF-DATE                           
                                      (WS-F800-DTE-BK-APPT-9)                   
                             IF WS-INTEGER-DTE-BK-APPT >=                       
                                WS-INTEGER-CUR-DATE1  AND                       
                                WS-INTEGER-DTE-BK-APPT <=                       
                                WS-INTEGER-CUR-DATE4                            
                                MOVE 'BK  '  TO  srvc                           
                                MOVE F800-DTE-BK-APPT TO apntmtDate             
                                MOVE F800-TME-BK-APPT TO WS-TIME-APPT           
                                MOVE F800-NUM-NT-FT-QUEUE to sales1queue        
                                PERFORM 310-WRITE-F206   THRU 310-EXIT          
                                PERFORM 400-WRITE-F290   THRU 400-EXIT          
                             END-IF                                             
                          END-IF                                                
                      END-IF                                                    
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
           PERFORM  200-READ-BP13F800     THRU   200-EXIT.                      
                                                                                
       300-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *---------------*                                                         
       310-WRITE-F206.                                                          
      *---------------*                                                         
           IF WS-TIME-APPT NOT = SPACES                                         
              MOVE WS-TIME-APPT(1:2) TO apntmtTime(1:2)                         
              MOVE WS-TIME-APPT(3:2) TO apntmtTime(4:2)                         
              MOVE ':'               TO apntmtTime(3:1)                         
                                        apntmtTime(6:1)                         
              MOVE '.'               TO apntmtTime(9:1)                         
              MOVE ZEROES            TO apntmtTime(7:2)                         
                                        apntmtTime(10:3)                        
           END-IF                                                               
                                                                                
           IF srvc = 'BK'                                                       
              MOVE 'SLN'          TO srvc                                       
           END-IF                                                               
                                                                                
           IF srvc = 'BK' AND  F800-NUM-ALLO-SCHEME = 'FSH'                     
              MOVE 'FSH'          TO srvc                                       
           END-IF                                                               
                                                                                
           IF srvc = 'BK' AND  F800-NUM-COMBINED-APPT = 'Y'                     
              MOVE 'SSA'          TO srvc                                       
           END-IF                                                               
                                                                                
           PERFORM 330-GET-OIC         THRU 330-EXIT.                           
                                                                                
           IF srvc NOT = 'BK' AND 'SLN' AND 'FSH' AND 'SSA'                     
              PERFORM 340-GET-ADDRESS  THRU 340-EXIT                            
           END-IF                                                               
                                                                                
      *    COMPUTE REC-NO = WS-WRITE-F206 + 1                                   
           MOVE SPACES              TO BP13F206-REC                             
           WRITE BP13F206-REC FROM RCRD-OPEN                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM dptmnt                                   
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM srvc                                     
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM apntmtDate                               
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM apntmtTime                               
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM apntmtEnd                                
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM apntmtTyp                                
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM rgstrtnDate                              
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM rfrnc                                    
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO BP13F206-REC                             
           WRITE BP13F206-REC FROM CSTMRS-OPEN                                  
                                                                                
           IF F800-NUM-NRIC1 NOT = SPACES AND LOW-VALUES                        
              INITIALIZE BP13K820-REC                                           
              MOVE F800-NUM-NRIC1 TO K820-NUM-NRIC                              
              PERFORM 320-GET-OCCP-NAMES  THRU 320-EXIT                         
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC2 NOT = SPACES AND LOW-VALUES                        
              INITIALIZE BP13K820-REC                                           
              MOVE F800-NUM-NRIC2 TO K820-NUM-NRIC                              
              PERFORM 320-GET-OCCP-NAMES  THRU 320-EXIT                         
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC3 NOT = SPACES AND LOW-VALUES                        
              INITIALIZE BP13K820-REC                                           
              MOVE F800-NUM-NRIC3 TO K820-NUM-NRIC                              
              PERFORM 320-GET-OCCP-NAMES  THRU 320-EXIT                         
           END-IF.                                                              
                                                                                
           IF F800-NUM-NRIC4 NOT = SPACES AND LOW-VALUES                        
              INITIALIZE BP13K820-REC                                           
              MOVE F800-NUM-NRIC4 TO K820-NUM-NRIC                              
              PERFORM 320-GET-OCCP-NAMES  THRU 320-EXIT                         
           END-IF.                                                              
                                                                                
           MOVE SPACES              TO BP13F206-REC                             
           WRITE BP13F206-REC FROM CSTMRS-CLOSE                                 
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM corpPass                                 
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM OIC                                      
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM OICcntct                                 
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM queuePFx                                 
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM queuePstn                                
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM sales1queue                              
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM othrCaseNo                               
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM townCode                                 
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM flatType                                 
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM slctType                                 
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           XML GENERATE WRITE-REC FROM ballotDate                               
           WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM SpclRqstTag                              
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM rmrks                                    
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           IF ((street NOT = SPACES) OR (WS-BLOCK NOT = SPACES) OR              
              (level  NOT = SPACES) OR (WS-UNIT NOT = SPACES) OR                
              (postalCode NOT = SPACES))                                        
              MOVE SPACES              TO BP13F206-REC                          
              WRITE BP13F206-REC FROM ADDRESS-OPEN                              
           END-IF                                                               
                                                                                
           IF street NOT = SPACES                                               
              MOVE SPACES              TO WRITE-REC                             
              XML GENERATE WRITE-REC FROM street                                
              WRITE BP13F206-REC FROM WRITE-REC                                 
           END-IF                                                               
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           IF WS-BLOCK NOT = SPACES                                             
              STRING BLOCK-OPEN, WS-BLOCK, BLOCK-CLOSE                          
              DELIMITED BY SIZE                                                 
              INTO WRITE-REC                                                    
              WRITE BP13F206-REC FROM WRITE-REC                                 
      *    ELSE                                                                 
      *       STRING BLOCK-OPEN, ' ' , BLOCK-CLOSE                              
      *       DELIMITED BY SIZE                                                 
      *       INTO WRITE-REC                                                    
           END-IF                                                               
                                                                                
           IF level NOT = SPACES                                                
              MOVE SPACES              TO WRITE-REC                             
              XML GENERATE WRITE-REC FROM level                                 
              WRITE BP13F206-REC FROM WRITE-REC                                 
           END-IF                                                               
                                                                                
           MOVE SPACES              TO WRITE-REC                                
           IF WS-UNIT NOT = SPACES                                              
              STRING UNIT-OPEN, WS-UNIT, UNIT-CLOSE                             
              DELIMITED BY SIZE                                                 
              INTO WRITE-REC                                                    
              WRITE BP13F206-REC FROM WRITE-REC                                 
      *    ELSE                                                                 
      *       STRING UNIT-OPEN, ' ' , UNIT-CLOSE                                
      *       DELIMITED BY SIZE                                                 
      *       INTO WRITE-REC                                                    
           END-IF                                                               
                                                                                
           IF postalCode NOT = SPACES                                           
              MOVE SPACES              TO WRITE-REC                             
              XML GENERATE WRITE-REC FROM postalCode                            
              WRITE BP13F206-REC FROM WRITE-REC                                 
           END-IF                                                               
                                                                                
           IF ((street NOT = SPACES) OR (WS-BLOCK NOT = SPACES) OR              
              (level  NOT = SPACES) OR (WS-UNIT  NOT = SPACES) OR               
              (postalCode NOT = SPACES))                                        
              MOVE SPACES              TO BP13F206-REC                          
              WRITE BP13F206-REC FROM ADDRESS-CLOSE                             
           END-IF                                                               
                                                                                
           MOVE SPACES              TO BP13F206-REC                             
           WRITE BP13F206-REC FROM RCRD-CLOSE                                   
                                                                                
           ADD 1  TO WS-WRITE-F206.                                             
                                                                                
       310-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------*                                                     
       320-GET-OCCP-NAMES.                                                      
      *-------------------*                                                     
           MOVE F800-NUM-REGN       TO K820-NUM-REGN                            
           PERFORM 350-READ-K820    THRU 350-EXIT.                              
           MOVE K820-NUM-NRIC       TO  nric.                                   
           MOVE WS-NAME-OCC         TO  name.                                   
           MOVE K820-NUM-HP-PGR     TO  cntct.                                  
                                                                                
           MOVE SPACES              TO BP13F206-REC.                            
           WRITE BP13F206-REC FROM CUSTOMER-OPEN.                               
                                                                                
           MOVE SPACES              TO WRITE-REC.                               
           IF WS-APOS = 'Y'                                                     
              STRING '<name>' WS-NAME-OCC '</name>'                             
                   DELIMITED BY '   ' INTO WRITE-REC                            
              END-STRING                                                        
           ELSE                                                                 
              XML GENERATE WRITE-REC FROM name                                  
           END-IF.                                                              
           WRITE BP13F206-REC FROM WRITE-REC.                                   
                                                                                
           MOVE SPACES              TO WRITE-REC.                               
           XML GENERATE WRITE-REC FROM nric.                                    
           WRITE BP13F206-REC FROM WRITE-REC.                                   
                                                                                
      *    MOVE SPACES              TO WRITE-REC                                
      *    XML GENERATE WRITE-REC FROM pssprt                                   
      *    WRITE BP13F206-REC FROM WRITE-REC                                    
                                                                                
           MOVE SPACES              TO WRITE-REC.                               
           XML GENERATE WRITE-REC FROM role.                                    
           WRITE BP13F206-REC FROM WRITE-REC.                                   
                                                                                
           MOVE SPACES              TO WRITE-REC.                               
           XML GENERATE WRITE-REC FROM cntct.                                   
           WRITE BP13F206-REC FROM WRITE-REC.                                   
                                                                                
           MOVE SPACES              TO BP13F206-REC.                            
           WRITE BP13F206-REC FROM CUSTOMER-CLOSE.                              
                                                                                
       320-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------*                                                          
       330-GET-OIC.                                                             
      *--------------*                                                          
           MOVE SPACES        TO K022-KEY-FLD                                   
           MOVE F800-NUM-REGN TO K022-NUM-REGN                                  
                                                                                
           READ BP13K022 KEY IS K022-NUM-REGN                                   
                                                                                
           EVALUATE K022-STATUS                                                 
           WHEN 00                                                              
           WHEN 02                                                              
                MOVE K022-NUM-OIC  TO OIC                                       
           WHEN 23                                                              
                DISPLAY 'BP13K022 - RECORD NOT FOUND, KEY: '                    
                         F800-NUM-REGN                                          
                MOVE SPACES        TO OIC                                       
                ADD 1 TO WS-MISSING-K022                                        
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'BP13K022 - ERROR READING, KEY: '                       
                         F800-NUM-REGN                                          
                MOVE SPACES        TO OIC                                       
                ADD 1 TO WS-MISSING-K022                                        
                                                                                
           END-EVALUATE.                                                        
                                                                                
       330-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *----------------*                                                        
       340-GET-ADDRESS.                                                         
      *----------------*                                                        
           MOVE F800-NUM-SCH-ACC          TO LINK-NUM-SCH-ACC                   
                                                                                
           CALL 'BP13C913' USING LINK-REC, BP13COMM8-REC                        
                                                                                
           IF COMM8-CDE-SYSERR = ZERO                                           
              MOVE COMM8-NME-STREET       TO street                             
              MOVE COMM8-NUM-BLK          TO WS-BLOCK                           
              MOVE COMM8-NUM-LEVEL        TO level                              
              MOVE COMM8-NUM-POSTAL-CODE  TO postalCode                         
              STRING COMM8-NUM-UNIT-MAIN, COMM8-NUM-UNIT-SUB                    
                     DELIMITED BY SIZE                                          
                     INTO WS-UNIT                                               
           ELSE                                                                 
              IF COMM8-CDE-SYSERR = 100                                         
                 DISPLAY 'RECORD NOT FOUND IN PIDB: ' F800-NUM-SCH-ACC          
                 ADD 1 TO WS-MISSING-PIDB                                       
              ELSE                                                              
                 DISPLAY 'ERROR FETCHING FROM PIDB: ' F800-NUM-SCH-ACC          
                 ADD 1 TO WS-MISSING-PIDB                                       
              END-IF                                                            
           END-IF.                                                              
                                                                                
       340-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *--------------*                                                          
       350-READ-K820.                                                           
      *--------------*                                                          
           READ BP13K820.                                                       
           EVALUATE K820-STATUS                                                 
           WHEN 00                                                              
                MOVE K820-NME-OCCP TO WS-NAME-OCC                               
                MOVE 'N' TO WS-APOS                                             
                PERFORM VARYING WS-X FROM 1 BY 1 UNTIL WS-X > 66                
                   IF WS-NAME-OCC(WS-X:1) = "'"                                 
                      MOVE 'Y' TO WS-APOS                                       
                   END-IF                                                       
                   IF WS-NAME-OCC(WS-X:1) IS NOT ALPHABETIC AND                 
                      WS-NAME-OCC(WS-X:1) IS NOT NUMERIC AND                    
                      WS-NAME-OCC(WS-X:1) NOT = SPACES AND '/' AND '('          
                                          AND ')' AND ',' AND '-'               
                                          AND '@' AND '.' and "'"               
                      MOVE SPACES TO WS-NAME-OCC(WS-X:1)                        
                   END-IF                                                       
                END-PERFORM                                                     
           WHEN 23                                                              
                DISPLAY 'BP13K820 - RECORD NOT FOUND, KEY: '                    
                         K820-NUM-REGN K820-NUM-NRIC                            
                MOVE SPACES        TO WS-NAME-OCC                               
                ADD 1 TO WS-MISSING-F820                                        
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'BP13K820 - ERROR READING, KEY: '                       
                         K820-NUM-REGN K820-NUM-NRIC                            
                MOVE SPACES        TO WS-NAME-OCC                               
                ADD 1 TO WS-MISSING-F820                                        
                                                                                
           END-EVALUATE.                                                        
                                                                                
       350-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *---------------*                                                         
       400-WRITE-F290.                                                          
      *---------------*                                                         
           MOVE sales1queue      TO  F290-NUM-QUEUE.                            
           MOVE F290-NUM-QUEUE   TO  F290-NUM-QUEUE-ALT.                        
           MOVE F800-NUM-REGN    TO  F290-NUM-REGN.                             
           IF F800-NUM-ALLO-CAT = 'BTO'                                         
              MOVE F800-NUM-BTO-ZONE TO F290-NUM-ZONE                           
           ELSE                                                                 
              MOVE SPACES            TO F290-NUM-ZONE                           
           END-IF.                                                              
           MOVE F800-NUM-NEW-TOWN    TO F290-NUM-NEW-TOWN.                      
           MOVE F800-NUM-FLAT-TYPE   TO F290-NUM-FLAT-TYPE.                     
           MOVE apntmtDate           TO F290-DTE-APPMT.                         
           MOVE WS-TIME-APPT         TO F290-TME-APPMT.                         
           MOVE srvc                 TO F290-NUM-APPMT-TYPE.                    
           MOVE F800-NUM-ALLO-CAT    TO F290-NUM-SELECT-TYPE.                   
           MOVE F800-DTE-BALLOT      TO F290-DTE-BALLOT.                        
           STRING '##' F800-NUM-REGN(3:6)                                       
                DELIMITED BY SIZE INTO F290-NUM-CSO                             
           END-STRING.                                                          
           MOVE SPACES               TO F290-NUM-STATUS                         
                                        F290-NUM-USERID                         
                                        F290-DTE-UPDATE                         
                                        F290-TME-UPDATE                         
                                        F290-HOLD-UNIT                          
                                        F290-HOLD-BLOCK.                        
           MOVE F800-NUM-MGPS        TO F290-NUM-MGPS.                          
                                                                                
           WRITE BP13F290-REC.                                                  
           IF F290-STATUS NOT = ZEROES                                          
              DISPLAY 'BP13F290 - WRITE ERROR, CHECK SPACE ALLOCATION: '        
                       F290-STATUS                                              
              PERFORM  9999-CLOSE-ROUTINE                                       
           ELSE                                                                 
              ADD 1  TO WS-WRITE-F290.                                          
                                                                                
       400-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *------------------*                                                      
       500-VALIDATE-DATE.                                                       
      *------------------*                                                      
           MOVE 'CD'                     TO  WS-IN-OPTION.                      
           MOVE WS-DATE-CHECK            TO  WS-IN-DATE.                        
                                                                                
           CALL 'AV02C001' USING WS-LINK-REC.                                   
                                                                                
           IF WS-RETURN NOT = '000'                                             
              MOVE 'Y'                   TO  WS-INVALID                         
           END-IF.                                                              
                                                                                
       500-EXIT.                                                                
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9999-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
           DISPLAY '  '.                                                        
           DISPLAY '*----------- BP13C221 CONTROL LIST ----------*'.            
           DISPLAY '  '.                                                        
           DISPLAY 'NO OF BP13F800 READ        = ' WS-READ-CNT-F800.            
           DISPLAY 'NO OF F206 RECORDS WRITTEN = ' WS-WRITE-F206.               
           DISPLAY 'NO OF F290 RECORDS WRITTEN = ' WS-WRITE-F290.               
           DISPLAY 'NO OF PIDB MISSING RECORD  = ' WS-MISSING-PIDB.             
           DISPLAY 'NO OF F820 MISSING RECORD  = ' WS-MISSING-F820.             
           DISPLAY 'NO OF K022 MISSING RECORD  = ' WS-MISSING-K022.             
                                                                                
           CLOSE BP13F800                                                       
                 BP13K820                                                       
                 BP13K022                                                       
                 SY02F001                                                       
                 BP13F206                                                       
                 BP13F290.                                                      
                                                                                
           IF K820-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13K820 CLOSE ERROR, K820-STATUS ' K820-STATUS          
              MOVE     K820-STATUS      TO       RETURN-CODE.                   
                                                                                
           IF K022-STATUS NOT = 00 AND 97                                       
              DISPLAY 'BP13K022 CLOSE ERROR, K022-STATUS ' K022-STATUS          
              MOVE     K022-STATUS      TO       RETURN-CODE.                   
                                                                                
           STOP RUN.                                                            
                                                                                
       9999-EXIT.                                                               
           EXIT.                                                                
                                                                                
