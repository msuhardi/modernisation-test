      *-----------------------*                                                 
       IDENTIFICATION DIVISION.                                                 
      *-----------------------*                                                 
       PROGRAM-ID.   BP13CC11.                                                  
       AUTHOR.       NINO ANGELO GARILLO.                                       
       DATE-WRITTEN. 16/12/2005.                                                
      ******************************************************                    
      *                                                    *                    
      *  SYSTEM NAME : SYSTEM OF COMMITMENT                *                    
      *                                                    *                    
      *  SYSTEM ID   : BP13                                *                    
      *                                                    *                    
      *  OBJECTIVE   :                                     *                    
      *  1. TO UPDATE PROGRESS PAYMENT FOR APPLICANTS      *                    
      *     TO BP13KD40, BP13KD30.                         *                    
      *  2. TO UPDATE OPTION FEE PAID TO BP13KD00.         *                    
      *  3. TO UPDATE CONVEY FEE/STAMP FEE UNDER PP.       *                    
      *     TO BP13KD40.                                   *                    
      *                                                    *                    
      *  INPUT FILE(S):                                    *                    
      *  1. BP13F120 - SEQUENTIAL FILE, DBSS FILE          *                    
      *                                                    *                    
      *  I-O FILE(S):                                      *                    
      *  1. BP13KD40 - VSAM FILE - APPLICANT PAYMENTS      *                    
      *  2. BP13KD30 - VSAM FILE - PROGRESS PAYMENT DUEDTE *                    
      *  3. BP13KD00 - VSAM FILE - MASTER FILE             *                    
      *  4. BP13KD99 - VSAM FILE - LOG FILE OF BP13KD00    *                    
      *                                                    *                    
      *  OUTPUT FILE(S):                                   *                    
      *  1. BP13LC11 - INVENTORY FOR EXCEEDED PAYMENTS     *                    
      *====================================================*                    
      * CHNGE #  BY  DATE     DESCRIPTION                  *                    
      * -------- --- -------- -----------------------------*                    
      * BP132706 GAN 16122005 NEW PROGRAM                  *                    
      * BP132888 BA3 18092006 INCLUDE CONDITION FOR        *                    
      *                       KD40-AMT-PP-REQ =            *                    
      *                       KD40-AMT-PP-CASH-PD +        *                    
      *                       KD40-AMT-PP-CPF-PD.          *                    
      * BP132888 BA3 13102006 CHK > OR < PAID WITH REQ     *                    
      * BP132909 BA3 19102006 UPD OPTION FEE REIMBURSE     *                    
      *                       TO BP13KD00. WRITE RECORD TO *                    
      *                       LOG FILE BP13KD99.           *                    
      * BP132888 BA3 04122006 REMOVED THE FF FIELDS:       *                    
      *                       KD40-AMT-MORT-CONVY-CASH     *                    
      *                       KD40-AMT-MORT-CONVY-CPF1 TO  *                    
      *                       KD40-AMT-MORT-CONVY-CPF4.    *                    
      *                       INCLUDED KD40-AMT-CONVY-GST  *                    
      *              03012007 COMPUTE FOR LSE-ESCR-STAMP   *                    
      *                       AND MORT-ESCR-STAMP WHEN PP  *                    
      *                       SCHED IS NOT EQUAL TO '01'   *                    
      * BP133091 RB12  171007 EXPAND KD00 LENGTH FROM      *                    
      *                       1200 TO 1600                 *                    
      * BP133091 LMS1  151207 EXPAND KD99 LENGTH FROM      *                    
      *                       1250 TO 1650                 *                    
      * BP133450 JB8   111108 TO READ KD40 BY RIGHT SCHDL  *                    
      * BP133572 JB8   120609 TO CATER FOR SUB-TRANSFER    *                    
      * BP133737 JB8   200110 TO ADD SOL BILL FOR DSP CASH *                    
      ******************************************************                    
       ENVIRONMENT DIVISION.                                                    
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F120 ASSIGN TO BP13F120.                                  
                                                                                
           SELECT BP13KD30 ASSIGN TO BP13KD30                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS RANDOM                                     
                  RECORD KEY      IS KD30-KEY-FLD                               
                  FILE STATUS     IS WS-KD30-STATUS.                            
                                                                                
           SELECT BP13KD40 ASSIGN TO BP13KD40                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS DYNAMIC                                    
                  RECORD KEY      IS KD40-KEY-FLD                               
                  FILE STATUS     IS WS-KD40-STATUS.                            
                                                                                
           SELECT BP13KD00 ASSIGN TO BP13KD00                                   
                  ORGANIZATION    IS INDEXED                                    
                  ACCESS MODE     IS DYNAMIC                                    
                  RECORD KEY      IS KD00-KEY-FLD                               
                  FILE STATUS     IS WS-KD00-STATUS.                            
                                                                                
           SELECT BP13KD99  ASSIGN        TO BP13KD99                           
                  ACCESS MODE   IS DYNAMIC                                      
                  ORGANIZATION  IS INDEXED                                      
                  RECORD KEY    IS KD99-KEY-FLD                                 
                  FILE STATUS   IS WS-KD99-STATUS.                              
                                                                                
           SELECT BP13LC11 ASSIGN TO BP13LC11.                                  
                                                                                
      *-------------*                                                           
       DATA DIVISION.                                                           
      *-------------*                                                           
       FILE SECTION.                                                            
                                                                                
       FD BP13KD30                                                              
           RECORD CONTAINS 2000 CHARACTERS.                                     
       COPY BP13KD30.                                                   00320000
                                                                                
       FD BP13KD40                                                              
           RECORD CONTAINS 1500 CHARACTERS.                                     
       COPY BP13KD40.                                                   00320000
                                                                                
       FD BP13KD00                                                              
           RECORD CONTAINS 1600 CHARACTERS.                                     
       COPY BP13KD00.                                                   00320000
                                                                                
       FD  BP13KD99                                                             
           RECORD CONTAINS 1650 CHARACTERS.                                     
       COPY BP13KD99.                                                           
                                                                                
       FD BP13F120                                                              
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 150 CHARACTERS.                                      
       COPY BP13F120.                                                           
                                                                                
       FD BP13LC11    RECORD CONTAINS 132 CHARACTERS                            
                      RECORDING MODE IS F.                                      
       01 BP13LC11-REC                   PIC X(132).                            
                                                                                
                                                                                
      *-----------------------*                                                 
       WORKING-STORAGE SECTION.                                                 
      *-----------------------*                                                 
                                                                                
       01  WS-STATUS.                                                           
           05 WS-KD30-STATUS       PIC  9(02) VALUE 0.                          
           05 WS-KD40-STATUS       PIC  9(02) VALUE 0.                          
           05 WS-KD00-STATUS       PIC  9(02) VALUE 0.                          
           05 WS-KD99-STATUS       PIC  9(02) VALUE 0.                          
                                                                                
       01  WS-COUNTERS.                                                         
           05 WS-F120-CNT-READ     PIC  9(08) VALUE ZEROES.                     
           05 WS-KD30-REWRITTEN    PIC  9(08) VALUE ZEROES.                     
           05 WS-KD40-REWRITTEN    PIC  9(08) VALUE ZEROES.                     
           05 WS-KD00-REWRITTEN    PIC  9(08) VALUE ZEROES.                     
           05 WS-KD99-WRITTEN      PIC  9(08) VALUE ZEROES.                     
           05 WS-CTR               PIC  9(02) VALUE ZEROES.                     
           05 WS-CNT-HIST          PIC  9(02) VALUE ZEROES.                     
           05 WS-KD00-CNT-READ     PIC  9(08) VALUE ZEROES.                     
           05 WS-KD00-CNT-NOTFOUND PIC  9(08) VALUE ZEROES.                     
                                                                                
       01  WS-VARIABLES.                                                        
           05 WS-TEMP-AMOUNT            PIC S9(06)V99 VALUE ZEROES.             
           05 WS-SAVE-AMOUNT            PIC S9(06)V99 VALUE ZEROES.             
           05 WS-CONVY-FEE-CPF          PIC S9(06)V99 VALUE ZEROES.             
           05 WS-CONVY-FEE-CASH         PIC S9(06)V99 VALUE ZEROES.             
           05 WS-STAMP-FEE-CPF          PIC S9(06)V99 VALUE ZEROES.             
           05 WS-STAMP-FEE-CASH         PIC S9(06)V99 VALUE ZEROES.             
           05 WS-AMT-OPTION-RECV        PIC S9(06)V99 VALUE ZEROES.             
           05 WS-CHR-HIST               PIC  X(01) VALUE SPACE.                 
           05 WS-KD00-FOUND             PIC  X(01) VALUE SPACE.                 
           05 WS-TEMP-SCHED             PIC  X(02) VALUE ZEROES.                
           05 WS-LINE-CTR               PIC  9(6)  VALUE 60.                    
           05 WS-PAGE-CTR               PIC  9(6)  VALUE ZEROS.                 
           05 WS-SEQ-NO                 PIC  9(6)  VALUE ZEROS.                 
           05 WS-PREV-REGN              PIC  X(8)  VALUE SPACES.                
           05 WS-EX-HDB-REF.                                                    
              10 WS-EX-HDB-REF-ACC      PIC  X(9)  VALUE SPACES.                
              10 WS-EX-HDB-REF-LESSEE   PIC  X(2)  VALUE SPACES.                
           05 WS-TOT-PAID               PIC S9(08)V99 VALUE ZEROES.             
                                                                                
       01  WS-FILE-FLAGS.                                                       
           05 WS-F120-FLAG         PIC  X(01) VALUE 'N'.                        
              88 WS-F120-EOF                  VALUE 'Y'.                        
           05 WS-SCHED-FOUND       PIC  X(01) VALUE 'N'.                        
              88 SCHED-FOUND                  VALUE 'Y'.                        
                                                                                
       01  WS-SYSTEM-DATETIME.                                                  
           05  WS-SYS-DATE         PIC  9(08) VALUE ZEROES.                     
           05  WS-SYS-TIME         PIC  9(08) VALUE ZEROES.                     
           05  FILLER              PIC  X(05) VALUE SPACES.                     
                                                                                
      *------------------------------------------------------------*            
      *   REPORT LAYOUT                                                         
      *------------------------------------------------------------*            
       01  LC11-PR-HEAD-01.                                                     
           05  FILLER              PIC X(8)      VALUE 'BP13LC11'.              
           05  FILLER              PIC X(5)      VALUE SPACES .                 
           05  FILLER              PIC X(8)      VALUE 'HDBCAT 3'.              
           05  FILLER              PIC X(22)     VALUE SPACES.                  
           05  FILLER              PIC X(20)     VALUE                          
                                    'S Y S T E M   O F   '.                     
           05  FILLER              PIC X(19)     VALUE                          
                                    'C O M M I T M E N T'.                      
           05  FILLER              PIC X(19)     VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'DATE :'.                
           05  LC11-DATE           PIC X(10)     VALUE SPACES.                  
           05  FILLER              PIC X(2)      VALUE SPACES.                  
           05  FILLER              PIC X(7)      VALUE 'PAGE : '.               
           05  LC11-PAGENO         PIC ZZZZ9     VALUE ZEROES.                  
                                                                                
       01  LC11-PR-HEAD-02.                                                     
           05  FILLER              PIC X(39)     VALUE SPACES .                 
           05  FILLER              PIC X(48)     VALUE                          
               'REPORT ON EXCEEDED/INSUFFICIENT CPF PAYMENT (SS)'.              
                                                                                
       01  LC11-PR-HEAD-04.                                                     
           05  FILLER              PIC X(04)     VALUE SPACES .                 
           05  FILLER              PIC X(49)     VALUE                          
               'SEQ.  REGN NO   SCHD   SCHEME ACCT   I/C NO.   '.               
           05  FILLER              PIC X(51)     VALUE                          
               'TYPE  AMT REQUIRED   RECEIPT AMT  PAY TYPE  REMARKS'.           
           05  FILLER              PIC X(28)     VALUE SPACES.                  
                                                                                
       01  LC11-PR-DTL-01.                                                      
           05  FILLER              PIC X(04)     VALUE SPACES.                  
           05  LC11-SEQ-NO         PIC ZZZ9      VALUE ZEROES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-NUM-REGN       PIC X(08)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LC11-NUM-SCHD       PIC X(02)     VALUE SPACES.                  
           05  FILLER              PIC X(03)     VALUE SPACES.                  
           05  LC11-NUM-SCH-ACT    PIC X(14)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-NUM-NRIC       PIC X(09)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-CDE-TYPE       PIC X(04)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-AMT-REQUIRED   PIC Z,ZZZ,ZZ9.99    VALUE  ZEROES.           
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-AMT-RECEIPT    PIC Z,ZZZ,ZZ9.99    VALUE  ZEROES.           
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-AMT-PAYTYPE    PIC X(06)     VALUE SPACES.                  
           05  FILLER              PIC X(02)     VALUE SPACES.                  
           05  LC11-REMARKS        PIC X(35)     VALUE SPACES.                  
                                                                                
       01  LC11-PR-LINE            PIC X(132)    VALUE ALL '-'.                 
                                                                                
      *------------------*                                                      
       PROCEDURE DIVISION.                                                      
      *------------------*                                                      
                                                                                
       0000-MAIN-CONTROL.                                                       
           PERFORM 1000-OPEN-FILES    THRU 1000-EXIT.                           
           PERFORM 2000-F120-READ     THRU 2000-EXIT.                           
           PERFORM 3000-PROCESS-PARA  THRU 3000-EXIT                            
                   UNTIL WS-F120-EOF.                                           
           PERFORM 9000-CLOSE-FILES THRU 9000-EXIT.                             
                                                                                
       0000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------*                                                         
       1000-OPEN-FILES.                                                         
      *---------------*                                                         
                                                                                
           OPEN INPUT  BP13F120                                                 
                I-O    BP13KD30                                                 
                       BP13KD40                                                 
                       BP13KD00                                                 
                       BP13KD99                                                 
                OUTPUT BP13LC11.                                                
                                                                                
           IF WS-KD30-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN BP13KD30 FAIL STATUS = ' WS-KD30-STATUS             
              MOVE WS-KD30-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF WS-KD40-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN BP13KD40 FAIL STATUS = ' WS-KD40-STATUS             
              MOVE WS-KD40-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF WS-KD00-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN BP13KD00 FAIL STATUS = ' WS-KD00-STATUS             
              MOVE WS-KD00-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           IF WS-KD99-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPEN BP13KD99 FAIL STATUS = ' WS-KD99-STATUS             
              MOVE WS-KD99-STATUS TO RETURN-CODE                                
              PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                           
           END-IF.                                                              
                                                                                
           MOVE FUNCTION CURRENT-DATE   TO WS-SYSTEM-DATETIME.                  
           STRING WS-SYS-DATE(7:2) '/'                                          
                  WS-SYS-DATE(5:2) '/'                                          
                  WS-SYS-DATE(1:4)                                              
           DELIMITED BY SIZE          INTO LC11-DATE.                           
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *--------------*                                                          
       2000-F120-READ.                                                          
      *--------------*                                                          
            READ BP13F120                                                       
                 AT END MOVE 'Y' TO WS-F120-FLAG                                
                 GO TO 2000-EXIT.                                               
            ADD 1 TO WS-F120-CNT-READ.                                          
                                                                                
       2000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3000-PROCESS-PARA.                                                       
      *-----------------*                                                       
                                                                                
           IF F120-AMT-RECEIPT NOT NUMERIC                                      
              MOVE 0   TO F120-AMT-RECEIPT                                      
           END-IF.                                                              
           IF F120-AMT-RECEIPT > 0                                              
              MOVE F120-NUM-PP-SCHEDULE    TO   WS-TEMP-SCHED                   
              PERFORM 3100-KD40-PROC    THRU 3100-EXIT                          
              IF F120-CDE-PAYMENT-TYPE = 'PP '                                  
                  PERFORM 3600-KD30-PROC THRU 3600-EXIT                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 2000-F120-READ       THRU 2000-EXIT.                         
                                                                                
       3000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *--------------*                                                          
       3100-KD40-PROC.                                                          
      *--------------*                                                          
                                                                                
            MOVE SPACES           TO KD40-KEY-FLD.                              
            MOVE F120-NUM-REGN    TO KD40-NUM-REGN.                             
            MOVE F120-NUM-PP-SCHEDULE TO KD40-NUM-PP-SCHDL.                     
                                                                                
            READ BP13KD40.                                                      
                                                                                
            EVALUATE WS-KD40-STATUS                                             
               WHEN 00                                                          
                  IF KD40-NUM-REGN NOT = F120-NUM-REGN                          
                     MOVE HIGH-VALUES TO KD40-KEY-FLD                           
                  ELSE                                                          
                     PERFORM 3300-PROCESS-KD40    THRU 3300-EXIT                
                  END-IF                                                        
               WHEN 23                                                          
                  DISPLAY 'RECORD NOT FOUND IN BP13KD40: ' F120-NUM-REGN        
               WHEN OTHER                                                       
                  DISPLAY 'READ ERROR BP13KD40,STATUS '                         
                           WS-KD40-STATUS                                       
                  MOVE WS-KD40-STATUS        TO RETURN-CODE                     
                  PERFORM 9000-CLOSE-FILES   THRU 9000-EXIT                     
            END-EVALUATE.                                                       
                                                                                
       3100-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3300-PROCESS-KD40.                                                       
      *-----------------*                                                       
                                                                                
            IF F120-CDE-TRANS-TYPE = '11' OR '16'                               
               MOVE 'S'                    TO WS-CHR-HIST                       
               PERFORM 3350-PROCESS-CASH THRU 3350-EXIT                         
            ELSE                                                                
               IF F120-CDE-TRANS-TYPE = '12' OR '14'                            
                  MOVE 'N'                 TO WS-CHR-HIST                       
                  IF F120-CDE-PAYMENT-TYPE = 'DSP' OR 'DCV'                     
                     PERFORM 3305-UPD-STAMP-CONVY THRU 3305-EXIT                
                  ELSE                                                          
                  IF F120-NUM-NRIC = KD40-NUM-NRIC1                             
                     PERFORM 3310-PROCESS-CPF1 THRU 3310-EXIT                   
                  ELSE                                                          
                  IF F120-NUM-NRIC = KD40-NUM-NRIC2                             
                     PERFORM 3320-PROCESS-CPF2 THRU 3320-EXIT                   
                  ELSE                                                          
                  IF F120-NUM-NRIC = KD40-NUM-NRIC3                             
                     PERFORM 3330-PROCESS-CPF3 THRU 3330-EXIT                   
                  ELSE                                                          
                  IF F120-NUM-NRIC = KD40-NUM-NRIC4                             
                     PERFORM 3340-PROCESS-CPF4 THRU 3340-EXIT                   
                  END-IF                                                        
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3300-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *--------------------*                                                    
       3305-UPD-STAMP-CONVY.                                                    
      *--------------------*                                                    
                                                                                
            IF KD40-AMT-STAMP-CPF-PD NOT NUMERIC                                
               MOVE 0 TO   KD40-AMT-STAMP-CPF-PD                                
            END-IF.                                                             
            IF KD40-AMT-CONVY-CPF-PD NOT NUMERIC                                
               MOVE 0 TO   KD40-AMT-CONVY-CPF-PD                                
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DSP'                                    
               COMPUTE KD40-AMT-STAMP-CPF-PD =                                  
                       KD40-AMT-STAMP-CPF-PD + F120-AMT-RECEIPT                 
            ELSE                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DCV'                                    
               COMPUTE KD40-AMT-CONVY-CPF-PD =                                  
                       KD40-AMT-CONVY-CPF-PD + F120-AMT-RECEIPT                 
            END-IF.                                                             
                                                                                
            PERFORM 3400-REWRITE-KD40       THRU 3400-EXIT.                     
            PERFORM 3360-CHECK-CPF-TALLY    THRU 3360-EXIT.                     
                                                                                
       3305-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3310-PROCESS-CPF1.                                                       
      *-----------------*                                                       
                                                                                
            IF KD40-AMT-PP-CPF1-PD NOT NUMERIC                                  
               MOVE ZEROS TO   KD40-AMT-PP-CPF1-PD                              
            END-IF.                                                             
            IF KD40-AMT-PP-CPF1 NOT NUMERIC                                     
               MOVE ZEROS TO   KD40-AMT-PP-CPF1                                 
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               COMPUTE KD40-AMT-PP-CPF1-PD =                                    
                       KD40-AMT-PP-CPF1-PD + F120-AMT-RECEIPT                   
                                                                                
               PERFORM 3400-REWRITE-KD40     THRU 3400-EXIT                     
               IF KD40-AMT-PP-CPF1-PD > KD40-AMT-PP-CPF1                        
                  MOVE KD40-AMT-PP-CPF1      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF1 PAID > CPF1 REQ'                                
                                          TO   LC11-REMARKS                     
                 PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                      
               ELSE                                                             
               IF KD40-AMT-PP-CPF1-PD < KD40-AMT-PP-CPF1                        
                  MOVE KD40-AMT-PP-CPF1      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF1 PAID < CPF1 REQ'                                
                                          TO   LC11-REMARKS                     
                 PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                      
               END-IF                                                           
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF1 IS NOT NUMERIC                              
               MOVE ZEROS TO KD40-AMT-OPTION-CPF1                               
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'OPT'                                    
                                                                                
               PERFORM 3500-READ-KD00        THRU 3500-EXIT                     
               IF WS-KD00-FOUND = 'Y'                                           
                  PERFORM 3800-WRITE-KD99    THRU 3800-EXIT                     
                  IF KD00-AMT-OPTION-CPF1 IS NOT NUMERIC                        
                     MOVE ZEROS TO KD00-AMT-OPTION-CPF1                         
                  END-IF                                                        
                  COMPUTE KD00-AMT-OPTION-CPF1 =                                
                          KD00-AMT-OPTION-CPF1 + F120-AMT-RECEIPT               
                  PERFORM 3510-REWRITE-KD00  THRU 3510-EXIT                     
               END-IF                                                           
                                                                                
               IF F120-AMT-RECEIPT NOT = KD40-AMT-OPTION-CPF1                   
                  MOVE KD40-AMT-OPTION-CPF1  TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'OPTION FEE REIMBURSE ERROR'                             
                                             TO   LC11-REMARKS                  
                 PERFORM 5000-WRITE-LC11     THRU 5000-EXIT                     
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3310-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3320-PROCESS-CPF2.                                                       
      *-----------------*                                                       
                                                                                
            IF KD40-AMT-PP-CPF2-PD NOT NUMERIC                                  
               MOVE ZEROS TO KD40-AMT-PP-CPF2-PD                                
            END-IF.                                                             
            IF KD40-AMT-PP-CPF2 NOT NUMERIC                                     
               MOVE ZEROS TO KD40-AMT-PP-CPF2                                   
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               COMPUTE KD40-AMT-PP-CPF2-PD =                                    
                       KD40-AMT-PP-CPF2-PD + F120-AMT-RECEIPT                   
               PERFORM 3400-REWRITE-KD40     THRU 3400-EXIT                     
               IF KD40-AMT-PP-CPF2-PD > KD40-AMT-PP-CPF2                        
                  MOVE KD40-AMT-PP-CPF2      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF2 PAID > CPF2 REQ'                                
                                          TO   LC11-REMARKS                     
                 PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                      
              ELSE                                                              
              IF KD40-AMT-PP-CPF2-PD < KD40-AMT-PP-CPF2                         
                 MOVE KD40-AMT-PP-CPF2      TO   LC11-AMT-REQUIRED              
                 MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                  
                 MOVE 'CPF '                TO   LC11-CDE-TYPE                  
                 MOVE 'PP CPF2 PAID < CPF2 REQ'                                 
                                          TO   LC11-REMARKS                     
                PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                       
              END-IF                                                            
              END-IF                                                            
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF2 IS NOT NUMERIC                              
               MOVE ZEROS TO KD40-AMT-OPTION-CPF2                               
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'OPT'                                    
                                                                                
               PERFORM 3500-READ-KD00        THRU 3500-EXIT                     
               IF WS-KD00-FOUND = 'Y'                                           
                  PERFORM 3800-WRITE-KD99    THRU 3800-EXIT                     
                  IF KD00-AMT-OPTION-CPF2 IS NOT NUMERIC                        
                     MOVE ZEROS TO KD00-AMT-OPTION-CPF2                         
                  END-IF                                                        
                  COMPUTE KD00-AMT-OPTION-CPF2 =                                
                          KD00-AMT-OPTION-CPF2 + F120-AMT-RECEIPT               
                  PERFORM 3510-REWRITE-KD00  THRU 3510-EXIT                     
               END-IF                                                           
               IF F120-AMT-RECEIPT  NOT = KD40-AMT-OPTION-CPF2                  
                  MOVE KD40-AMT-OPTION-CPF2  TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'OPTION FEE REIMBURSE ERROR'                             
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11     THRU 5000-EXIT                    
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3320-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3330-PROCESS-CPF3.                                                       
      *-----------------*                                                       
                                                                                
            IF KD40-AMT-PP-CPF3-PD NOT NUMERIC                                  
               MOVE ZEROS TO KD40-AMT-PP-CPF3-PD                                
            END-IF.                                                             
            IF KD40-AMT-PP-CPF3 NOT NUMERIC                                     
               MOVE ZEROS TO KD40-AMT-PP-CPF3                                   
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               COMPUTE KD40-AMT-PP-CPF3-PD =                                    
                       KD40-AMT-PP-CPF3-PD + F120-AMT-RECEIPT                   
               PERFORM 3400-REWRITE-KD40     THRU 3400-EXIT                     
               IF KD40-AMT-PP-CPF3-PD > KD40-AMT-PP-CPF3                        
                   MOVE KD40-AMT-PP-CPF3      TO   LC11-AMT-REQUIRED            
                   MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                
                   MOVE 'CPF '                TO   LC11-CDE-TYPE                
                   MOVE 'PP CPF3 PAID > CPF3 REQ'                               
                                          TO   LC11-REMARKS                     
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               ELSE                                                             
               IF KD40-AMT-PP-CPF3-PD < KD40-AMT-PP-CPF3                        
                  MOVE KD40-AMT-PP-CPF3      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF3 PAID < CPF3 REQ'                                
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF KD40-AMT-OPTION-CPF3 IS NOT NUMERIC                              
               MOVE ZEROS TO KD40-AMT-OPTION-CPF3                               
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'OPT'                                    
                                                                                
               PERFORM 3500-READ-KD00        THRU 3500-EXIT                     
               IF WS-KD00-FOUND = 'Y'                                           
                  PERFORM 3800-WRITE-KD99    THRU 3800-EXIT                     
                  IF KD00-AMT-OPTION-CPF3 IS NOT NUMERIC                        
                     MOVE ZEROS TO KD00-AMT-OPTION-CPF3                         
                  END-IF                                                        
                  COMPUTE KD00-AMT-OPTION-CPF3 =                                
                          KD00-AMT-OPTION-CPF3 + F120-AMT-RECEIPT               
                  PERFORM 3510-REWRITE-KD00  THRU 3510-EXIT                     
               END-IF                                                           
               IF F120-AMT-RECEIPT   NOT = KD40-AMT-OPTION-CPF3                 
                  MOVE KD40-AMT-OPTION-CPF3  TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'OPTION FEE REIMBURSE ERROR'                             
                                             TO   LC11-REMARKS                  
                 PERFORM 5000-WRITE-LC11     THRU 5000-EXIT                     
               END-IF                                                           
            END-IF.                                                             
                                                                                
                                                                                
       3330-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *-----------------*                                                       
       3340-PROCESS-CPF4.                                                       
      *-----------------*                                                       
                                                                                
            IF KD40-AMT-PP-CPF4-PD NOT NUMERIC                                  
               MOVE ZEROS TO KD40-AMT-PP-CPF4-PD                                
            END-IF.                                                             
            IF KD40-AMT-PP-CPF4 NOT NUMERIC                                     
               MOVE ZEROS TO KD40-AMT-PP-CPF4                                   
            END-IF.                                                             
                                                                                
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               COMPUTE KD40-AMT-PP-CPF4-PD =                                    
                       KD40-AMT-PP-CPF4-PD + F120-AMT-RECEIPT                   
               PERFORM 3400-REWRITE-KD40     THRU 3400-EXIT                     
               IF KD40-AMT-PP-CPF4-PD > KD40-AMT-PP-CPF4                        
                  MOVE KD40-AMT-PP-CPF4      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF4 PAID > CPF4 REQ'                                
                                          TO   LC11-REMARKS                     
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               ELSE                                                             
               IF KD40-AMT-PP-CPF4-PD < KD40-AMT-PP-CPF4                        
                  MOVE KD40-AMT-PP-CPF4      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'PP CPF4 PAID < CPF4 REQ'                                
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
               END-IF                                                           
            END-IF.                                                             
                                                                                
                                                                                
            IF KD40-AMT-OPTION-CPF4 IS NOT NUMERIC                              
               MOVE ZEROS TO KD40-AMT-OPTION-CPF4                               
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'OPT'                                    
                                                                                
               PERFORM 3500-READ-KD00        THRU 3500-EXIT                     
               IF WS-KD00-FOUND = 'Y'                                           
                  PERFORM 3800-WRITE-KD99    THRU 3800-EXIT                     
                  IF KD00-AMT-OPTION-CPF4 IS NOT NUMERIC                        
                     MOVE ZEROS TO KD00-AMT-OPTION-CPF4                         
                  END-IF                                                        
                  COMPUTE KD00-AMT-OPTION-CPF4 =                                
                          KD00-AMT-OPTION-CPF4 + F120-AMT-RECEIPT               
                  PERFORM 3510-REWRITE-KD00  THRU 3510-EXIT                     
               END-IF                                                           
               IF WS-AMT-OPTION-RECV NOT = KD40-AMT-OPTION-CPF4                 
                  MOVE KD40-AMT-OPTION-CPF4  TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'OPTION FEE REIMBURSE ERROR'                             
                                             TO   LC11-REMARKS                  
                 PERFORM 5000-WRITE-LC11     THRU 5000-EXIT                     
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3340-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------*                                                      
       3350-PROCESS-CASH.                                                       
      *------------------*                                                      
                                                                                
            IF KD40-AMT-PP-CASH-PD NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-PP-CASH-PD                                  
            END-IF.                                                             
            IF KD40-AMT-PP-CASH NOT NUMERIC                                     
               MOVE 0 TO   KD40-AMT-PP-CASH                                     
            END-IF.                                                             
            IF KD40-AMT-STAMP-CASH-PD NOT NUMERIC                               
               MOVE 0 TO   KD40-AMT-STAMP-CASH-PD                               
            END-IF.                                                             
            IF KD40-AMT-CONVY-CASH-PD NOT NUMERIC                               
               MOVE 0 TO   KD40-AMT-CONVY-CASH-PD                               
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               COMPUTE KD40-AMT-PP-CASH-PD =                                    
                       KD40-AMT-PP-CASH-PD + F120-AMT-RECEIPT                   
            ELSE                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DSP'                                    
               COMPUTE KD40-AMT-STAMP-CASH-PD =                                 
                       KD40-AMT-STAMP-CASH-PD + F120-AMT-RECEIPT                
            ELSE                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DCV'                                    
               COMPUTE KD40-AMT-CONVY-CASH-PD =                                 
                       KD40-AMT-CONVY-CASH-PD + F120-AMT-RECEIPT                
            END-IF.                                                             
                                                                                
            PERFORM 3400-REWRITE-KD40        THRU 3400-EXIT.                    
            PERFORM 3370-CHECK-CASH-TALLY    THRU 3370-EXIT.                    
                                                                                
       3350-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *--------------------*                                                    
       3360-CHECK-CPF-TALLY.                                                    
      *--------------------*                                                    
                                                                                
            IF KD40-AMT-CONVY-CPF1 NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-CONVY-CPF1                                  
            END-IF.                                                             
            IF KD40-AMT-CONVY-CPF2 NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-CONVY-CPF2                                  
            END-IF.                                                             
            IF KD40-AMT-CONVY-CPF3 NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-CONVY-CPF3                                  
            END-IF.                                                             
            IF KD40-AMT-CONVY-CPF4 NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-CONVY-CPF4                                  
            END-IF.                                                             
            IF KD40-AMT-MORT-STAMP-CPF1 NOT NUMERIC                             
               MOVE 0 TO   KD40-AMT-MORT-STAMP-CPF1                             
            END-IF.                                                             
            IF KD40-AMT-MORT-STAMP-CPF2 NOT NUMERIC                             
               MOVE 0 TO   KD40-AMT-MORT-STAMP-CPF2                             
            END-IF.                                                             
            IF KD40-AMT-MORT-STAMP-CPF3 NOT NUMERIC                             
               MOVE 0 TO   KD40-AMT-MORT-STAMP-CPF3                             
            END-IF.                                                             
            IF KD40-AMT-MORT-STAMP-CPF4 NOT NUMERIC                             
               MOVE 0 TO   KD40-AMT-MORT-STAMP-CPF4                             
            END-IF.                                                             
            IF KD40-AMT-CAVEAT-CPF1 NOT NUMERIC                                 
               MOVE 0 TO   KD40-AMT-CAVEAT-CPF1                                 
            END-IF.                                                             
            IF KD40-AMT-CAVEAT-CPF2 NOT NUMERIC                                 
               MOVE 0 TO   KD40-AMT-CAVEAT-CPF2                                 
            END-IF.                                                             
            IF KD40-AMT-CAVEAT-CPF3 NOT NUMERIC                                 
               MOVE 0 TO   KD40-AMT-CAVEAT-CPF3                                 
            END-IF.                                                             
            IF KD40-AMT-CAVEAT-CPF4 NOT NUMERIC                                 
               MOVE 0 TO   KD40-AMT-CAVEAT-CPF4                                 
            END-IF.                                                             
            IF KD40-AMT-SNP-STAMP-CPF1 NOT NUMERIC                              
               MOVE 0 TO   KD40-AMT-SNP-STAMP-CPF1                              
            END-IF.                                                             
            IF KD40-AMT-SNP-STAMP-CPF2 NOT NUMERIC                              
               MOVE 0 TO   KD40-AMT-SNP-STAMP-CPF2                              
            END-IF.                                                             
            IF KD40-AMT-SNP-STAMP-CPF3 NOT NUMERIC                              
               MOVE 0 TO   KD40-AMT-SNP-STAMP-CPF3                              
            END-IF.                                                             
            IF KD40-AMT-SNP-STAMP-CPF4 NOT NUMERIC                              
               MOVE 0 TO   KD40-AMT-SNP-STAMP-CPF4                              
            END-IF.                                                             
            IF KD40-AMT-LSE-ESCR-STAMP-CPF1 NOT NUMERIC                         
               MOVE 0 TO   KD40-AMT-LSE-ESCR-STAMP-CPF1                         
            END-IF.                                                             
            IF KD40-AMT-LSE-ESCR-STAMP-CPF2 NOT NUMERIC                         
               MOVE 0 TO   KD40-AMT-LSE-ESCR-STAMP-CPF2                         
            END-IF.                                                             
            IF KD40-AMT-LSE-ESCR-STAMP-CPF3 NOT NUMERIC                         
               MOVE 0 TO   KD40-AMT-LSE-ESCR-STAMP-CPF3                         
            END-IF.                                                             
            IF KD40-AMT-LSE-ESCR-STAMP-CPF4 NOT NUMERIC                         
               MOVE 0 TO   KD40-AMT-LSE-ESCR-STAMP-CPF4                         
            END-IF.                                                             
            IF KD40-AMT-MORT-ESCR-STAMP-CPF1 NOT NUMERIC                        
               MOVE 0 TO   KD40-AMT-MORT-ESCR-STAMP-CPF1                        
            END-IF.                                                             
            IF KD40-AMT-MORT-ESCR-STAMP-CPF2 NOT NUMERIC                        
               MOVE 0 TO   KD40-AMT-MORT-ESCR-STAMP-CPF2                        
            END-IF.                                                             
            IF KD40-AMT-MORT-ESCR-STAMP-CPF3 NOT NUMERIC                        
               MOVE 0 TO   KD40-AMT-MORT-ESCR-STAMP-CPF3                        
            END-IF.                                                             
            IF KD40-AMT-MORT-ESCR-STAMP-CPF4 NOT NUMERIC                        
               MOVE 0 TO   KD40-AMT-MORT-ESCR-STAMP-CPF4                        
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DCV'                                    
               COMPUTE WS-CONVY-FEE-CPF  =                                      
                  KD40-AMT-CONVY-CPF1 +                                         
                  KD40-AMT-CONVY-CPF2 +                                         
                  KD40-AMT-CONVY-CPF3 +                                         
                  KD40-AMT-CONVY-CPF4                                           
               IF KD40-AMT-CONVY-CPF-PD > WS-CONVY-FEE-CPF                      
                  MOVE WS-CONVY-FEE-CPF      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'CONVY FEE PAID > CONVY FEE REQ'                         
                                             TO   LC11-REMARKS                  
               END-IF                                                           
            END-IF.                                                             
                                                                                
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DSP'                                    
               COMPUTE WS-STAMP-FEE-CPF  =                                      
                  KD40-AMT-MORT-STAMP-CPF1 +                                    
                  KD40-AMT-MORT-STAMP-CPF2 +                                    
                  KD40-AMT-MORT-STAMP-CPF3 +                                    
                  KD40-AMT-MORT-STAMP-CPF4 +                                    
                  KD40-AMT-CAVEAT-CPF1 +                                        
                  KD40-AMT-CAVEAT-CPF2 +                                        
                  KD40-AMT-CAVEAT-CPF3 +                                        
                  KD40-AMT-CAVEAT-CPF4 +                                        
                  KD40-AMT-SNP-STAMP-CPF1 +                                     
                  KD40-AMT-SNP-STAMP-CPF2 +                                     
                  KD40-AMT-SNP-STAMP-CPF3 +                                     
                  KD40-AMT-SNP-STAMP-CPF4 +                                     
                  KD40-AMT-SOLICITOR-BILL-CPF1 +                                
                  KD40-AMT-SOLICITOR-BILL-CPF2 +                                
                  KD40-AMT-SOLICITOR-BILL-CPF3 +                                
                  KD40-AMT-SOLICITOR-BILL-CPF4                                  
                                                                                
               IF KD40-NUM-PP-SCHDL NOT = '01'                                  
                  COMPUTE WS-STAMP-FEE-CPF =                                    
                          WS-STAMP-FEE-CPF +                                    
                          KD40-AMT-LSE-ESCR-STAMP-CPF1 +                        
                          KD40-AMT-LSE-ESCR-STAMP-CPF2 +                        
                          KD40-AMT-LSE-ESCR-STAMP-CPF3 +                        
                          KD40-AMT-LSE-ESCR-STAMP-CPF4 +                        
                          KD40-AMT-MORT-ESCR-STAMP-CPF1 +                       
                          KD40-AMT-MORT-ESCR-STAMP-CPF2 +                       
                          KD40-AMT-MORT-ESCR-STAMP-CPF3 +                       
                          KD40-AMT-MORT-ESCR-STAMP-CPF4                         
               END-IF                                                           
                                                                                
               IF KD40-AMT-STAMP-CPF-PD > WS-STAMP-FEE-CPF                      
                  MOVE WS-STAMP-FEE-CPF      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'STAMP FEE PAID > STAMP FEE REQ'                         
                                             TO   LC11-REMARKS                  
               END-IF                                                           
               IF KD40-AMT-STAMP-CPF-PD < WS-STAMP-FEE-CPF                      
                  MOVE WS-STAMP-FEE-CPF      TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CPF '                TO   LC11-CDE-TYPE                 
                  MOVE 'STAMP FEE PAID < STAMP FEE REQ'                         
                                             TO   LC11-REMARKS                  
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3360-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *---------------------*                                                   
       3370-CHECK-CASH-TALLY.                                                   
      *---------------------*                                                   
                                                                                
            IF KD40-AMT-MORT-STAMP-CASH NOT NUMERIC                             
               MOVE 0 TO   KD40-AMT-MORT-STAMP-CASH                             
            END-IF.                                                             
            IF KD40-AMT-CAVEAT-CASH NOT NUMERIC                                 
               MOVE 0 TO   KD40-AMT-CAVEAT-CASH                                 
            END-IF.                                                             
            IF KD40-AMT-SNP-STAMP-CASH NOT NUMERIC                              
               MOVE 0 TO   KD40-AMT-SNP-STAMP-CASH                              
            END-IF.                                                             
            IF KD40-AMT-LSE-ESCR-STAMP-CASH NOT NUMERIC                         
               MOVE 0 TO   KD40-AMT-LSE-ESCR-STAMP-CASH                         
            END-IF.                                                             
            IF KD40-AMT-MORT-ESCR-STAMP-CASH NOT NUMERIC                        
               MOVE 0 TO   KD40-AMT-MORT-ESCR-STAMP-CASH                        
            END-IF.                                                             
            IF KD40-AMT-CONVY-CASH NOT NUMERIC                                  
               MOVE 0 TO   KD40-AMT-CONVY-CASH                                  
            END-IF.                                                             
            IF KD40-AMT-CONVY-GST NOT NUMERIC                                   
               MOVE 0 TO   KD40-AMT-CONVY-GST                                   
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               IF KD40-AMT-PP-CASH-PD > KD40-AMT-PP-CASH                        
                  MOVE KD40-AMT-PP-CASH   TO   LC11-AMT-REQUIRED                
                  MOVE WS-TEMP-SCHED      TO   LC11-NUM-SCHD                    
                  MOVE 'CASH'             TO   LC11-CDE-TYPE                    
                  MOVE 'PP CASH PAID > CASH REQ'                                
                                          TO   LC11-REMARKS                     
                  PERFORM 5000-WRITE-LC11 THRU 5000-EXIT                        
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'PP '                                    
               IF KD40-AMT-PP-CASH-PD < KD40-AMT-PP-CASH                        
                  MOVE KD40-AMT-PP-CASH   TO   LC11-AMT-REQUIRED                
                  MOVE WS-TEMP-SCHED      TO   LC11-NUM-SCHD                    
                  MOVE 'CASH'             TO   LC11-CDE-TYPE                    
                  MOVE 'PP CASH PAID < CASH REQ'                                
                                          TO   LC11-REMARKS                     
                  PERFORM 5000-WRITE-LC11 THRU 5000-EXIT                        
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DSP'                                    
               COMPUTE WS-STAMP-FEE-CASH =                                      
                  KD40-AMT-MORT-STAMP-CASH +                                    
                  KD40-AMT-CAVEAT-CASH +                                        
                  KD40-AMT-SNP-STAMP-CASH +                                     
                  KD40-AMT-SOLICITOR-BILL-CASH                                  
               IF KD40-NUM-PP-SCHDL NOT = '01'                                  
                  COMPUTE WS-STAMP-FEE-CASH =                                   
                          WS-STAMP-FEE-CASH +                                   
                          KD40-AMT-LSE-ESCR-STAMP-CASH +                        
                          KD40-AMT-MORT-ESCR-STAMP-CASH                         
               END-IF                                                           
               IF KD40-AMT-STAMP-CASH-PD > WS-STAMP-FEE-CASH                    
                  MOVE WS-STAMP-FEE-CASH     TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CASH'                TO   LC11-CDE-TYPE                 
                  MOVE 'STAMP FEE PAID > STAMP FEE REQ'                         
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
               IF KD40-AMT-STAMP-CASH-PD < WS-STAMP-FEE-CASH                    
                  MOVE WS-STAMP-FEE-CASH     TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CASH'                TO   LC11-CDE-TYPE                 
                  MOVE 'STAMP FEE PAID < STAMP FEE REQ'                         
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
            END-IF.                                                             
                                                                                
            IF F120-CDE-PAYMENT-TYPE = 'DCV'                                    
               COMPUTE WS-CONVY-FEE-CASH = KD40-AMT-CONVY-CASH                  
               IF KD40-AMT-CONVY-CASH-PD > WS-CONVY-FEE-CASH                    
                  MOVE WS-CONVY-FEE-CASH     TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CASH'                TO   LC11-CDE-TYPE                 
                  MOVE 'CONVY FEE PAID > CONVY FEE REQ'                         
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
               IF KD40-AMT-CONVY-CASH-PD < WS-CONVY-FEE-CASH                    
                  MOVE WS-CONVY-FEE-CASH     TO   LC11-AMT-REQUIRED             
                  MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD                 
                  MOVE 'CASH'                TO   LC11-CDE-TYPE                 
                  MOVE 'CONVY FEE PAID < CONVY FEE REQ'                         
                                             TO   LC11-REMARKS                  
                  PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                     
               END-IF                                                           
            END-IF.                                                             
                                                                                
       3370-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------*                                                      
       3400-REWRITE-KD40.                                                       
      *------------------*                                                      
            MOVE WS-SYS-DATE        TO KD40-DTE-UPDATE.                         
            MOVE WS-SYS-TIME        TO KD40-TME-UPDATE.                         
                                                                                
            REWRITE BP13KD40-REC.                                               
            EVALUATE WS-KD40-STATUS                                             
            WHEN 00                                                             
               ADD  1   TO WS-KD40-REWRITTEN                                    
            WHEN OTHER                                                          
               DISPLAY 'ERROR REWRITING KD40 FILE  ' WS-KD40-STATUS             
               MOVE WS-KD40-STATUS  TO RETURN-CODE                              
               DISPLAY 'KD40-KEY-FLD = ' KD40-NUM-REGN KD40-NUM-PP-SCHDL        
               PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                          
            END-EVALUATE.                                                       
                                                                                
       3400-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------*                                                      
       3500-READ-KD00.                                                          
      *------------------*                                                      
           MOVE 'N'           TO WS-KD00-FOUND.                                 
           MOVE F120-NUM-REGN TO KD00-NUM-REGN.                                 
                                                                                
           READ BP13KD00                                                        
           EVALUATE WS-KD00-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y' TO WS-KD00-FOUND                                      
                 ADD   1  TO WS-KD00-CNT-READ                                   
              WHEN 23                                                           
                 ADD   1  TO WS-KD00-CNT-NOTFOUND                               
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BP13KD00 - STATUS '                  
                             WS-KD00-STATUS                                     
                 MOVE        WS-KD00-STATUS    TO RETURN-CODE                   
                 PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *------------------*                                                      
       3510-REWRITE-KD00.                                                       
      *------------------*                                                      
                                                                                
           MOVE WS-SYS-DATE TO KD00-DTE-UPDATE.                                 
           MOVE FUNCTION CURRENT-DATE(9:8) TO KD00-TME-UPDATE.                  
           MOVE 'BP13CC11'  TO KD00-NUM-USERID.                                 
                                                                                
           REWRITE BP13KD00-REC.                                                
                                                                                
           EVALUATE WS-KD00-STATUS                                              
              WHEN 00                                                           
                 CONTINUE                                                       
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN UPDATING BP13KD00 - STATUS '                 
                             WS-KD00-STATUS                                     
                 MOVE        WS-KD00-STATUS    TO RETURN-CODE                   
                 PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                   
           END-EVALUATE.                                                        
                                                                                
           ADD 1 TO WS-KD00-REWRITTEN.                                          
                                                                                
       3510-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *--------------*                                                          
       3600-KD30-PROC.                                                          
      *--------------*                                                          
                                                                                
            MOVE SPACES           TO KD30-KEY-FLD.                              
            MOVE F120-NUM-REGN    TO KD30-NUM-REGN.                             
                                                                                
            READ BP13KD30.                                                      
            EVALUATE WS-KD30-STATUS                                             
            WHEN 00                                                             
               CONTINUE                                                         
            WHEN 23                                                             
               GO TO 3600-EXIT                                                  
            WHEN OTHER                                                          
               DISPLAY 'ERROR READING KD30 FILE  ' WS-KD30-STATUS               
               MOVE WS-KD30-STATUS  TO RETURN-CODE                              
               DISPLAY 'KD30-NUM-REGN = ' KD30-NUM-REGN                         
               PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                          
            END-EVALUATE.                                                       
                                                                                
            IF F120-AMT-RECEIPT NOT NUMERIC                                     
               MOVE 0   TO F120-AMT-RECEIPT                                     
            END-IF.                                                             
            MOVE 'N'    TO WS-SCHED-FOUND                                       
            PERFORM VARYING WS-CTR FROM 1 BY 1 UNTIL (WS-CTR > 15)              
                 OR SCHED-FOUND                                                 
              IF KD30-NUM-PP-SCHDL(WS-CTR) = WS-TEMP-SCHED                      
                 MOVE 'Y'    TO WS-SCHED-FOUND                                  
                 IF KD30-AMT-PP-PAID(WS-CTR) NOT NUMERIC                        
                   MOVE 0 TO   KD30-AMT-PP-PAID(WS-CTR)                         
                 END-IF                                                         
                 IF KD30-AMT-PP-REQ(WS-CTR) NOT NUMERIC                         
                   MOVE 0 TO   KD30-AMT-PP-REQ(WS-CTR)                          
                 END-IF                                                         
                 COMPUTE KD30-AMT-PP-PAID(WS-CTR) =                             
                         KD30-AMT-PP-PAID(WS-CTR) + F120-AMT-RECEIPT            
                 MOVE KD30-AMT-PP-PAID(WS-CTR) TO   WS-SAVE-AMOUNT              
                 MOVE KD30-AMT-PP-REQ(WS-CTR)  TO   WS-TEMP-AMOUNT              
                 PERFORM 3700-REWRITE-KD30     THRU 3700-EXIT                   
                 IF WS-SAVE-AMOUNT > WS-TEMP-AMOUNT                             
                    MOVE WS-TEMP-AMOUNT        TO   LC11-AMT-REQUIRED           
                    MOVE WS-TEMP-SCHED         TO   LC11-NUM-SCHD               
                    MOVE SPACES                TO   LC11-CDE-TYPE               
                    MOVE 'KD30 PP PAID > PP REQUIRED'                           
                                               TO   LC11-REMARKS                
                    PERFORM 5000-WRITE-LC11    THRU 5000-EXIT                   
                 END-IF                                                         
              END-IF                                                            
            END-PERFORM.                                                        
                                                                                
       3600-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------*                                                      
       3700-REWRITE-KD30.                                                       
      *------------------*                                                      
                                                                                
            REWRITE BP13KD30-REC.                                               
            EVALUATE WS-KD30-STATUS                                             
            WHEN 00                                                             
               ADD  1   TO WS-KD30-REWRITTEN                                    
            WHEN OTHER                                                          
               DISPLAY 'ERROR REWRITING KD30 FILE  ' WS-KD30-STATUS             
               MOVE WS-KD30-STATUS  TO RETURN-CODE                              
               DISPLAY 'KD30-NUM-REGN = ' KD30-NUM-REGN                         
               PERFORM 9000-CLOSE-FILES THRU 9000-EXIT                          
            END-EVALUATE.                                                       
                                                                                
       3700-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *------------------*                                                      
       3800-WRITE-KD99.                                                         
      *------------------*                                                      
                                                                                
           MOVE BP13KD00-REC               TO BP13KD99-REC.                     
           MOVE KD00-NUM-REGN              TO KD99-NUM-REGN-LOG.                
           MOVE WS-SYS-DATE                TO KD99-DTE-UPDATE-LOG.              
           MOVE FUNCTION CURRENT-DATE(9:8) TO KD99-TME-UPDATE-LOG.              
                                                                                
           WRITE BP13KD99-REC.                                                  
           EVALUATE WS-KD99-STATUS                                              
              WHEN 00                                                           
                 CONTINUE                                                       
              WHEN 22                                                           
                 GO TO 3800-WRITE-KD99                                          
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN WRITING  BP13KD99 - STATUS '                 
                             WS-KD99-STATUS                                     
                 MOVE        WS-KD99-STATUS   TO RETURN-CODE                    
                 PERFORM 9000-CLOSE-FILES     THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
           ADD 1 TO WS-KD99-WRITTEN.                                            
                                                                                
       3800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *---------------*                                                         
       5000-WRITE-LC11.                                                         
      *---------------*                                                         
                                                                                
           MOVE F120-AMT-RECEIPT         TO LC11-AMT-RECEIPT.                   
           IF LC11-CDE-TYPE = SPACES OR LOW-VALUES                              
              MOVE WS-SAVE-AMOUNT        TO LC11-AMT-RECEIPT                    
           END-IF.                                                              
           MOVE F120-CDE-PAYMENT-TYPE    TO LC11-AMT-PAYTYPE.                   
           MOVE F120-NUM-NRIC            TO LC11-NUM-NRIC.                      
                                                                                
           STRING F120-NUM-SCH-ACCT(1:4)  '-'                                   
                  F120-NUM-SCH-ACCT(5:4)  '-'                                   
                  F120-NUM-SCH-ACCT(9:1)  '-'                                   
                  F120-NUM-SCH-ACCT(10:2)                                       
           DELIMITED BY SIZE           INTO LC11-NUM-SCH-ACT.                   
                                                                                
           IF WS-LINE-CTR > 55                                                  
              ADD  1              TO   WS-PAGE-CTR                              
              MOVE 8              TO   WS-LINE-CTR                              
              MOVE WS-PAGE-CTR    TO   LC11-PAGENO                              
              MOVE SPACES         TO   BP13LC11-REC                             
              WRITE BP13LC11-REC                       AFTER PAGE               
              WRITE BP13LC11-REC  FROM LC11-PR-HEAD-01 AFTER 3                  
              WRITE BP13LC11-REC  FROM LC11-PR-HEAD-02                          
              WRITE BP13LC11-REC  FROM LC11-PR-LINE    AFTER 2                  
              WRITE BP13LC11-REC  FROM LC11-PR-HEAD-04                          
              WRITE BP13LC11-REC  FROM LC11-PR-LINE                             
           END-IF.                                                              
                                                                                
           IF F120-NUM-REGN NOT = WS-PREV-REGN                                  
              ADD  1                        TO WS-SEQ-NO                        
              MOVE WS-SEQ-NO                TO LC11-SEQ-NO                      
              MOVE F120-NUM-REGN            TO LC11-NUM-REGN                    
           ELSE                                                                 
              MOVE ZEROES                   TO LC11-SEQ-NO                      
              MOVE SPACES                   TO LC11-NUM-REGN                    
           END-IF                                                               
                                                                                
           WRITE BP13LC11-REC  FROM LC11-PR-DTL-01.                             
           ADD   1             TO   WS-LINE-CTR .                               
                                                                                
           MOVE   F120-NUM-REGN             TO WS-PREV-REGN.                    
                                                                                
       5000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *----------------*                                                        
       9000-CLOSE-FILES.                                                        
      *----------------*                                                        
                                                                                
           DISPLAY '******  BP13CC11 *************'.                            
           DISPLAY 'NO OF F120 READ      (F120) : ' WS-F120-CNT-READ.           
           DISPLAY 'NO OF KD00 READ      (KD00) : ' WS-KD00-CNT-READ.           
           DISPLAY 'NO OF KD40 UPDATED   (KD40) : ' WS-KD40-REWRITTEN.          
           DISPLAY 'NO OF KD30 UPDATED   (KD30) : ' WS-KD30-REWRITTEN.          
           DISPLAY 'NO OF KD00 UPDATED   (KD00) : ' WS-KD00-REWRITTEN.          
           DISPLAY 'NO OF KD00 NOT FOUND (KD00) : '                             
                                                 WS-KD00-CNT-NOTFOUND.          
           DISPLAY 'NO OF KD99 WRITTEN   (KD99) : ' WS-KD99-WRITTEN.            
                                                                                
           CLOSE BP13F120, BP13KD30, BP13KD40,                                  
                 BP13KD00, BP13KD99, BP13LC11.                                  
                                                                                
           IF WS-KD30-STATUS NOT = ZEROES                                       
              DISPLAY 'CLOSE BP13KD30 FAIL STATUS = ' WS-KD30-STATUS            
           END-IF.                                                              
                                                                                
           IF WS-KD40-STATUS NOT = ZEROES                                       
              DISPLAY 'CLOSE BP13KD40 FAIL STATUS = ' WS-KD40-STATUS            
           END-IF.                                                              
                                                                                
           IF WS-KD00-STATUS NOT = ZEROES                                       
              DISPLAY 'CLOSE BP13KD00 FAIL STATUS = ' WS-KD00-STATUS            
           END-IF.                                                              
                                                                                
           IF WS-KD99-STATUS NOT = ZEROES                                       
              DISPLAY 'CLOSE BP13KD99 FAIL STATUS = ' WS-KD99-STATUS            
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
