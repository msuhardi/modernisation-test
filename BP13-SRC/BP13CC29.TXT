      *----------------------------------------------------------------*        
       IDENTIFICATION DIVISION.                                                 
      *----------------------------------------------------------------*        
       PROGRAM-ID.    BP13CC29.                                                 
       AUTHOR.        ABH.                                                      
       DATE-WRITTEN.  24/07/2006.                                               
                                                                                
      ******************************************************************        
      *                                                                *        
      *   SYSTEM NAME :  SYSTEM OF COMMITMENT  (SOC)                   *        
      *                                                                *        
      *   SYSTEM ID   :  BP13                                          *        
      *                                                                *        
      *   OBJECTIVE   :  TO CREATE CPF WITHDRAWAL  AB02F860.           *        
      *                                                                *        
      *   INPUT FILES :  1.  BP13FD38                                  *        
      *                  2.  SY02F001                                  *        
      *                  3.  BP13K800                                  *        
      *                  4.  BP13K820                                  *        
      *                  5.  BM06K100                                  *        
      *                  6.  BM06K110                                  *        
      *                  7.  BB14K500                                  *        
      *                                                                *        
      *   OUTPUT FILES:  1.  AB02F860                                  *        
      *                  2.  BP13LC29 - REPORT FOR CPF WIDRAWAL ON     *        
      *                                 REVISED INSTALMENT.            *        
      *                                                                *        
      *   CALLS THE FF SUBROUTINE:                                     *        
      *                  1.  BP13C913 - GET THE APPLICANT ADDRESS      *        
      *                  2.  AB02C902 - GET THE SERIAL NUMBER          *        
      *                                                                *        
      *----------------------------------------------------------------*        
      *                                                                *        
      *   CHGE-NO   BY    DATE      DESCRIPTION                        *        
      *   --------  ---  ---------- -----------                        *        
      *   BP132772  BA3  24/07/2006 NEW PROGRAM                        *        
      *   BP134872  ESD1 03/09/2013 CATER FOR MLP.                     *        
      *   BP136692  KSJ3 15/02/2017 EXPAND AB02F860 FROM 600 TO 2000   *        
      ******************************************************************        
                                                                                
      *----------------------------------------------------------------*        
       ENVIRONMENT DIVISION.                                                    
      *----------------------------------------------------------------*        
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13FD38  ASSIGN        TO BP13FD38.                          
           SELECT SY02F001  ASSIGN        TO SY02F001.                          
                                                                                
           SELECT BP13K800  ASSIGN        TO BP13K800                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K800-NUM-REGN                      
                            FILE STATUS   IS WS-K800-STATUS.                    
                                                                                
           SELECT BM06K110  ASSIGN        TO BM06K110                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K110-SCH-ACC-NO                    
                            FILE STATUS   IS WS-K110-STATUS.                    
                                                                                
           SELECT BM06K100  ASSIGN        TO BM06K100                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K100-KEY-FLD                       
                            FILE STATUS   IS WS-K100-STATUS.                    
                                                                                
           SELECT BB14K500  ASSIGN        TO BB14K500                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K500-KEY-FLD                       
                            FILE STATUS   IS WS-K500-STATUS.                    
                                                                                
           SELECT BP13K820  ASSIGN        TO BP13K820                           
                            ACCESS MODE   IS DYNAMIC                            
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K820-KEY-FLD                       
                            FILE STATUS   IS WS-K820-STATUS.                    
                                                                                
           SELECT AB02F860  ASSIGN        TO AB02F860.                          
           SELECT BP13LC29  ASSIGN        TO BP13LC29.                          
                                                                                
      *----------------------------------------------------------------*        
       DATA DIVISION.                                                           
      *----------------------------------------------------------------*        
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  BP13FD38                                                             
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 400 CHARACTERS                                       
           LABEL RECORDS ARE STANDARD.                                          
                                                                                
       COPY BP13FD38.                                                           
                                                                                
       COPY SY02F001.                                                           
                                                                                
       FD  BP13K800                                                             
           RECORD CONTAINS 2000 CHARACTERS.                                     
                                                                                
       COPY BP13K800.                                                           
                                                                                
       FD  BM06K110                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
                                                                                
       COPY BM06K110.                                                           
                                                                                
       FD  BM06K100                                                             
           RECORD CONTAINS 500 CHARACTERS.                                      
                                                                                
       COPY BM06K100.                                                           
                                                                                
       FD  BB14K500                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
                                                                                
       COPY BB14K500.                                                           
                                                                                
       FD  BP13K820                                                             
           RECORD CONTAINS 400 CHARACTERS.                                      
                                                                                
       COPY BP13K820.                                                           
                                                                                
       FD  AB02F860                                                             
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 2000 CHARACTERS                                      
           LABEL RECORDS ARE STANDARD.                                          
                                                                                
       COPY AB02F860.                                                           
                                                                                
       FD  BP13LC29                                                             
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING MODE  IS  F                                                
           DATA RECORD     IS  PRINT-REC.                                       
       01  PRINT-REC                    PIC X(132).                             
                                                                                
      *----------------------------------------------------------------*        
       WORKING-STORAGE SECTION.                                                 
      *----------------------------------------------------------------*        
                                                                                
       01  WS-EOF-FD38                  PIC X(01)    VALUE SPACES.              
       01  WS-K500-FOUND                PIC X(01)    VALUE SPACES.              
       01  WS-K100-FOUND                PIC X(01)    VALUE SPACES.              
       01  WS-K110-FOUND                PIC X(01)    VALUE SPACES.              
       01  WS-K800-FOUND                PIC X(01)    VALUE SPACES.              
       01  WS-K820-FOUND                PIC X(01)    VALUE SPACES.              
       01  WS-K500-STATUS               PIC 9(02)    VALUE ZEROES.              
       01  WS-K100-STATUS               PIC 9(02)    VALUE ZEROES.              
       01  WS-K110-STATUS               PIC 9(02)    VALUE ZEROES.              
       01  WS-K800-STATUS               PIC 9(02)    VALUE ZEROES.              
       01  WS-K820-STATUS               PIC 9(02)    VALUE ZEROES.              
       01  WS-F860-WRITE                PIC 9(05)    VALUE ZEROES.              
       01  WS-LC29-WRITE                PIC 9(05)    VALUE ZEROES.              
       01  WS-SN                        PIC 9(04)    VALUE ZEROES.              
       01  CNT-FD38-READ                PIC 9(05)    VALUE ZEROES.              
       01  CNT-K800-READ                PIC 9(08)    VALUE ZEROES.              
       01  CNT-K500-READ                PIC 9(08)    VALUE ZEROES.              
       01  CNT-K100-READ                PIC 9(08)    VALUE ZEROES.              
       01  CNT-K110-READ                PIC 9(08)    VALUE ZEROES.              
       01  CNT-K820-READ                PIC 9(08)    VALUE ZEROES.              
       01  CNT-K800-NOTFOUND            PIC 9(08)    VALUE ZEROES.              
       01  CNT-K500-NOTFOUND            PIC 9(08)    VALUE ZEROES.              
       01  CNT-K100-NOTFOUND            PIC 9(08)    VALUE ZEROES.              
       01  CNT-K110-NOTFOUND            PIC 9(08)    VALUE ZEROES.              
       01  CNT-K820-NOTFOUND            PIC 9(08)    VALUE ZEROES.              
                                                                                
       01  WS-AB02F860-REC              PIC X(600)   VALUE SPACES.              
                                                                                
       01  WS-DATES.                                                            
           05 WS-SYS-DATE               PIC X(8)     VALUE SPACES.              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-LINE-CNT             PIC 9(2)     VALUE 60.                   
           05  WS-PAGE-CNT             PIC 9(4)     VALUE ZEROES.               
                                                                                
       01  LC29-PR-HEAD-01.                                                     
           05  FILLER                  PIC X(8)  VALUE 'BP13LC29'.              
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(8)  VALUE 'HDBCAT 3'.              
           05  FILLER                  PIC X(24) VALUE SPACES.                  
           05  FILLER                  PIC X(20) VALUE                          
                                       'S Y S T E M   O F   '.                  
           05  FILLER                  PIC X(19) VALUE                          
                                       'C O M M I T M E N T'.                   
           05  FILLER                  PIC X(15) VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'DATE :'.                
           05  LC29-DATE               PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE 'PAGE : '.               
           05  LC29-PAGENO             PIC ZZZZ9 VALUE ZEROES.                  
                                                                                
       01  LC29-PR-HEAD-02.                                                     
           05  FILLER                  PIC X(44) VALUE SPACES.                  
           05  FILLER                  PIC X(51) VALUE                          
               ' CPF WITHDRAWAL ON REVISED INSTALMENT'.                         
                                                                                
       01  LC29-PR-HEAD-03.                                                     
           05  FILLER                  PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(4)  VALUE 'S/N'.                   
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(8)  VALUE 'REG NO '.               
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(14) VALUE 'SCH A/C NO.'.           
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  FILLER                  PIC X(6)  VALUE 'CPF NO'.                
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(15) VALUE                          
                                                'EFF INSTAL DATE'.              
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  FILLER                  PIC X(9)  VALUE '  AMOUNT'.              
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  FILLER                  PIC X(9)  VALUE 'SERIAL'.                
                                                                                
       01  LC29-PR-DETAILS.                                                     
           05  FILLER                  PIC X(10) VALUE SPACES.                  
           05  LC29-SN                 PIC ZZZ9  VALUE ZEROES.                  
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  LC29-REG-NO             PIC X(8)  VALUE SPACES.                  
           05  FILLER                  PIC X(6)  VALUE SPACES.                  
           05  LC29-SCHEME             PIC X(14) VALUE SPACES.                  
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  LC29-CPF-NO             PIC X(9)  VALUE SPACES.                  
           05  FILLER                  PIC X(5)  VALUE SPACES.                  
           05  LC29-EFF-INS-NEW-DTE    PIC X(10) VALUE SPACES.                  
           05  FILLER                  PIC X(7)  VALUE SPACES.                  
           05  LC29-AMOUNT             PIC $,$$$,$$9.99                         
                                                 VALUE ZEROES.                  
           05  FILLER                  PIC X(4)  VALUE SPACES.                  
           05  LC29-SERIAL             PIC X(9)  VALUE SPACES.                  
                                                                                
                                                                                
      *-----------------------------------------------------------*             
      *        LINKAGE FOR SUB-PROGRAM AB02C902                   *             
      *-----------------------------------------------------------*             
                                                                                
       COPY AB02902C.                                                           
                                                                                
                                                                                
      *-----------------------------------------------------------*             
      *        LINKAGE FOR SUB-PROGRAM BP13C913                   *             
      *-----------------------------------------------------------*             
       01  WS-LINK-REC.                                                         
           05  WS-LINK-NUM-SCH-ACC.                                             
               10  WS-LINK-NUM-SCH      PIC X(04).                              
               10  WS-LINK-NUM-ACC      PIC X(05).                              
                                                                                
       COPY P13COMM8.                                                           
                                                                                
      *----------------------------------------------------------------*        
       PROCEDURE DIVISION.                                                      
      *----------------------------------------------------------------*        
                                                                                
      *----------------------------------------------------------------*        
       0000-MAIN-ROUTINE.                                                       
      *----------------------------------------------------------------*        
                                                                                
           PERFORM  1000-OPEN-FILES        THRU    1000-EXIT.                   
           PERFORM  2000-READ-FD38         THRU    2000-EXIT.                   
           PERFORM  3000-PROCESS           THRU    3000-EXIT                    
                    UNTIL WS-EOF-FD38 = 'Y'.                                    
           PERFORM  9000-CLOSE-ROUTINE     THRU    9000-EXIT.                   
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       1000-OPEN-FILES.                                                         
      *----------------------------------------------------------------*        
                                                                                
           OPEN INPUT  BP13FD38                                                 
                       SY02F001                                                 
                       BP13K800                                                 
                       BB14K500                                                 
                       BM06K100                                                 
                       BM06K110                                                 
                       BP13K820                                                 
               OUTPUT  AB02F860                                                 
                       BP13LC29.                                                
                                                                                
           IF WS-K800-STATUS NOT = 00 AND 97                                    
               DISPLAY 'OPENING ERROR, BP13K800-STATUS ' WS-K800-STATUS         
               MOVE     WS-K800-STATUS     TO RETURN-CODE                       
               PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-IF.                                                              
           IF WS-K110-STATUS NOT = 00 AND 97                                    
               DISPLAY 'OPENING ERROR, BM06K110-STATUS ' WS-K110-STATUS         
               MOVE     WS-K110-STATUS     TO RETURN-CODE                       
               PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-IF.                                                              
           IF WS-K500-STATUS NOT = 00 AND 97                                    
               DISPLAY 'OPENING ERROR, BB14K500-STATUS ' WS-K500-STATUS         
               MOVE     WS-K500-STATUS     TO RETURN-CODE                       
               PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-IF.                                                              
           IF WS-K100-STATUS NOT = 00 AND 97                                    
               DISPLAY 'OPENING ERROR, BM06K100-STATUS ' WS-K100-STATUS         
               MOVE     WS-K100-STATUS     TO RETURN-CODE                       
               PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-IF.                                                              
           IF WS-K820-STATUS NOT = 00 AND 97                                    
               DISPLAY 'OPENING ERROR, BP13K820-STATUS ' WS-K820-STATUS         
               MOVE     WS-K820-STATUS     TO RETURN-CODE                       
               PERFORM  9000-CLOSE-ROUTINE THRU 9000-EXIT                       
           END-IF.                                                              
                                                                                
           PERFORM 2500-READ-SY02F001      THRU 2500-EXIT.                      
                                                                                
           STRING WS-SYS-DATE(7:2) '/'                                          
                  WS-SYS-DATE(5:2) '/'                                          
                  WS-SYS-DATE(1:4)                                              
                  DELIMITED BY SIZE INTO LC29-DATE.                             
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       2000-READ-FD38.                                                          
      *----------------------------------------------------------------*        
                                                                                
           READ BP13FD38                                                        
                AT END MOVE 'Y' TO WS-EOF-FD38                                  
                       GO TO 2000-EXIT                                          
           END-READ.                                                            
                                                                                
           ADD 1 TO CNT-FD38-READ.                                              
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       2500-READ-SY02F001.                                                      
      *----------------------------------------------------------------*        
                                                                                
           READ SY02F001.                                                       
           MOVE F001-DTE-CURRENT      TO WS-SYS-DATE.                           
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       3000-PROCESS.                                                            
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-K800-FOUND                     
                                              WS-K110-FOUND                     
                                              WS-K500-FOUND                     
                                              WS-K100-FOUND                     
                                              WS-K820-FOUND.                    
                                                                                
           PERFORM 4000-MOVE-COMMON-DATA   THRU 4000-EXIT.                      
                                                                                
           IF FD38-NUM-SCH-ACC NOT = SPACES                                     
              PERFORM 6000-CHECK-PIDB      THRU 6000-EXIT                       
           END-IF.                                                              
                                                                                
           PERFORM 7000-READ-K800          THRU 7000-EXIT.                      
           IF WS-K800-FOUND = 'Y'                                               
                                                                                
      *----   CKECK RECORD IN BP13K820                                          
      *----   GET THE SERIAL NUMBER                                             
      *----   WRITE RECORD TO AB02F860                                          
      *----   WRITE REPORT                                                      
                                                                                
              PERFORM 7100-PROCESS-K820-DATA    THRU 7100-EXIT                  
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-FD38          THRU 2000-EXIT.                      
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       4000-MOVE-COMMON-DATA.                                                   
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES TO AB02F860-REC.                                         
                                                                                
           MOVE ZEROES                     TO F860-DTE-INST-MTHLY               
           MOVE SPACES                     TO F860-CDE-REPYMT.                  
                                                                                
           MOVE '0'                        TO F860-NUM-PREFIX.                  
           MOVE SPACES                     TO F860-NUM-ORIG-REGN.               
           MOVE FD38-NUM-SCH-ACC           TO F860-NUM-HDB-REF.                 
           MOVE '2'                        TO F860-CDE-ACTION.                  
           MOVE SPACES                     TO F860-CDE-TRANS-TYPE.              
           MOVE SPACES                     TO F860-CDE-ADJ-TYPE.                
           MOVE SPACES                     TO F860-CDE-REPURCHASE.              
           MOVE ZEROES                     TO F860-AMT-MRKT-VALUE1.             
           MOVE ZEROES                     TO F860-AMT-MRKT-VALUE2.             
           MOVE ZEROES                     TO F860-AMT-PURCHASE-PRICE1.         
           MOVE ZEROES                     TO F860-AMT-PURCHASE-PRICE2.         
           MOVE ZEROES                     TO F860-AMT-UPG-COST.                
           MOVE ZEROES                     TO F860-AMT-ORIG-LOAN.               
           MOVE ZEROES                     TO F860-AMT-LOAN-OS.                 
                                                                                
           MOVE ZEROES                     TO F860-AMT-INST.                    
           MOVE SPACES                     TO F860-CDE-SURVEY-FEE.              
           MOVE ZEROES                     TO F860-AMT-SURVEY-FEE.              
           MOVE WS-SYS-DATE                TO F860-DTE-PRINT.                   
                                                                                
           MOVE 'BP13'                     TO F860-NUM-ORIGINATOR.              
           MOVE ZEROES                     TO F860-DTE-PAYMT-CEASE.             
           MOVE ZEROES                     TO F860-DTE-FINAL-REPYMT.            
           MOVE ZEROES                     TO F860-AMT-GRANT.                   
           MOVE ZEROES                     TO F860-AMT-EXISTING-BAL.            
           MOVE ZEROES                     TO F860-AMT-CPF-CONTRA.              
           MOVE ZEROES                     TO F860-NUM-MORTGAGE-RATE.           
                                                                                
           MOVE SPACES                     TO F860-CDE-TRANS-TYPE.              
      *    MOVE 'N'                        TO F860-CDE-REPURCHASE.              
           MOVE SPACES                     TO F860-CDE-STAMP-FEE.               
           MOVE SPACES                     TO F860-CDE-CONV-FEE.                
           MOVE 'P'                        TO F860-CDE-REPYMT-TYPE.             
           MOVE SPACES                     TO F860-CDE-ERL.                     
                                                                                
           MOVE ZEROES                     TO F860-AMT-STAMP-FEE                
                                              F860-AMT-CONV-FEE                 
                                              F860-AMT-LOAN-REPAY               
                                              F860-AMT-ARREARS                  
                                              F860-AMT-INST-FIRST               
                                              F860-DTE-INST-FIRST               
                                              F860-AMT-TOT-WDL                  
                                              F860-AMT-INST-MTHLY               
                                              F860-DTE-ORIG-LOAN-COMM           
                                              F860-DTE-LOAN-OS                  
                                              F860-CDE-REPYMT-PERIOD            
                                              F860-AMT-MSS                      
                                              F860-AMT-HPS-CONTRA               
                                              F860-AMT-CPF-PREMIUM              
                                              F860-AMT-CPF-BLOCK                
                                              F860-NUM-LEASE-DUR                
                                              F860-AMT-FULL-RESL-PRICE.         
                                                                                
      *--- EHPS VARIABLES ---------------------------------------------*        
                                                                                
           MOVE 'N'                        TO F860-TAG-EHPS-APPLN.              
           MOVE ZEROES                     TO F860-DATE-EHPS-SUB                
                                              F860-TIME-EHPS-SUB                
                                              F860-EHPS-COVER-PRCNT.            
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       5000-WRITE-F860.                                                         
      *----------------------------------------------------------------*        
           PERFORM 5100-GET-MLPINFO  THRU 5100-EXIT.                            
                                                                                
           WRITE AB02F860-REC.                                                  
           ADD 1                           TO WS-F860-WRITE.                    
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5100-GET-MLPINFO.                                                        
      *----------------------------------------------------------------*        
            MOVE  F860-NUM-HDB-REF  TO   K110-SCH-ACC-NO                        
            PERFORM 5200-READ-K110    THRU  5200-EXIT                           
            MOVE  K110-AIX1         TO   K100-KEY-FLD                           
            PERFORM 5300-READ-K100    THRU  5300-EXIT                           
            MOVE  K100-CDE-BLK      TO   K500-CDE-BLK                           
            PERFORM 5400-READ-K500    THRU 5400-EXIT                            
            IF K500-DTE-LEASE-COMM-FLAT = SPACES OR LOW-VALUES                  
               MOVE '00000000'      TO  F860-DTE-LEASE-COMM                     
            ELSE                                                                
               MOVE K500-DTE-LEASE-COMM-FLAT TO  F860-DTE-LEASE-COMM            
            END-IF.                                                             
            IF K800-DTE-REGN = SPACES OR LOW-VALUES                             
               MOVE '00000000'      TO  F860-DTE-APLCTN                         
            ELSE                                                                
               MOVE K800-DTE-REGN   TO  F860-DTE-APLCTN                         
            END-IF.                                                             
            MOVE 99              TO  F860-NUM-LEASE-DUR.                        
                                                                                
       5100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5200-READ-K110.                                                          
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-K110-FOUND.                    
                                                                                
           READ BM06K110                                                        
           EVALUATE WS-K110-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y'                  TO WS-K110-FOUND                     
                 ADD   1                   TO CNT-K110-READ                     
              WHEN 23                                                           
                 MOVE 'N'                  TO WS-K110-FOUND                     
                 ADD   1                   TO CNT-K110-NOTFOUND                 
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BM06K110 - STATUS '                  
                           WS-K110-STATUS                                       
                 MOVE      WS-K110-STATUS  TO RETURN-CODE                       
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5300-READ-K100.                                                          
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-K100-FOUND.                    
                                                                                
           READ BM06K100                                                        
           EVALUATE WS-K100-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y'                  TO WS-K100-FOUND                     
                 ADD   1                   TO CNT-K100-READ                     
              WHEN 23                                                           
                 MOVE 'N'                  TO WS-K100-FOUND                     
                 ADD   1                   TO CNT-K100-NOTFOUND                 
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BM06K100 - STATUS '                  
                           WS-K100-STATUS                                       
                 MOVE      WS-K100-STATUS  TO RETURN-CODE                       
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       5400-READ-K500.                                                          
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-K500-FOUND.                    
                                                                                
           READ BB14K500                                                        
           EVALUATE WS-K500-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y'                  TO WS-K500-FOUND                     
                 ADD   1                   TO CNT-K500-READ                     
              WHEN 23                                                           
                 MOVE 'N'                  TO WS-K500-FOUND                     
                 ADD   1                   TO CNT-K500-NOTFOUND                 
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BB14K500 - STATUS '                  
                           WS-K500-STATUS                                       
                 MOVE      WS-K500-STATUS  TO RETURN-CODE                       
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       5400-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       6000-CHECK-PIDB.                                                         
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO BP13COMM8-REC.                    
           INITIALIZE                         BP13COMM8-REC.                    
                                                                                
           MOVE FD38-NUM-SCH-ACC           TO WS-LINK-REC.                      
           CALL 'BP13C913' USING WS-LINK-REC,                                   
                                 BP13COMM8-REC.                                 
                                                                                
           IF COMM8-CDE-SYSERR NOT = 0 AND 100                                  
              DISPLAY 'ERROR IN READING PIDB TABLE  '                           
                      COMM8-CDE-SYSERR                                          
           ELSE                                                                 
              MOVE COMM8-NUM-BLK           TO F860-NUM-BLK                      
              MOVE COMM8-NUM-LEVEL         TO F860-NUM-HSE-LVL                  
              MOVE COMM8-NUM-UNIT-MAIN     TO F860-NUM-HSE-U-MAIN               
              MOVE COMM8-NME-STREET        TO F860-NME-STREET                   
              MOVE COMM8-NUM-POSTAL-CODE   TO F860-CDE-POST-CDE                 
           END-IF.                                                              
                                                                                
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       7000-READ-K800.                                                          
      *----------------------------------------------------------------*        
                                                                                
           MOVE FD38-NUM-REGN              TO K800-NUM-REGN.                    
                                                                                
           READ BP13K800                                                        
           EVALUATE WS-K800-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y'                  TO WS-K800-FOUND                     
                 ADD   1                   TO CNT-K800-READ                     
              WHEN 23                                                           
                 MOVE 'N'                  TO WS-K800-FOUND                     
                 ADD   1                   TO CNT-K800-NOTFOUND                 
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BP13K800 - STATUS '                  
                          WS-K800-STATUS                                        
                 MOVE     WS-K800-STATUS   TO RETURN-CODE                       
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       7100-PROCESS-K820-DATA.                                                  
      *----------------------------------------------------------------*        
                                                                                
           MOVE FD38-NUM-REGN                 TO K820-NUM-REGN.                 
           MOVE AB02F860-REC                  TO WS-AB02F860-REC.               
                                                                                
           IF FD38-AMT-INSTAL-NEW-CPF1 IS NOT NUMERIC                           
              MOVE ZEROES                 TO FD38-AMT-INSTAL-NEW-CPF1           
           END-IF.                                                              
           IF FD38-AMT-INSTAL-NEW-CPF2 IS NOT NUMERIC                           
              MOVE ZEROES                 TO FD38-AMT-INSTAL-NEW-CPF2           
           END-IF.                                                              
           IF FD38-AMT-INSTAL-NEW-CPF3 IS NOT NUMERIC                           
              MOVE ZEROES                 TO FD38-AMT-INSTAL-NEW-CPF3           
           END-IF.                                                              
           IF FD38-AMT-INSTAL-NEW-CPF4 IS NOT NUMERIC                           
              MOVE ZEROES                 TO FD38-AMT-INSTAL-NEW-CPF4           
           END-IF.                                                              
                                                                                
           IF FD38-AMT-INSTAL-NEW-CPF1 > 0                                      
              MOVE FD38-AMT-INSTAL-NEW-CPF1   TO F860-AMT-INST-MTHLY            
              MOVE K800-NUM-NRIC1             TO K820-NUM-NRIC                  
              PERFORM 8000-READ-K820          THRU 8000-EXIT                    
              IF WS-K820-FOUND = 'Y'                                            
                 PERFORM 8100-MOVE-K820-DATA  THRU 8100-EXIT                    
                 PERFORM 8500-GET-SERIAL-NO   THRU 8500-EXIT                    
                 PERFORM 8700-WRITE-LC29      THRU 8700-EXIT                    
                 PERFORM 5000-WRITE-F860      THRU 5000-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF FD38-AMT-INSTAL-NEW-CPF2 > 0                                      
              MOVE WS-AB02F860-REC            TO AB02F860-REC                   
              MOVE FD38-AMT-INSTAL-NEW-CPF2   TO F860-AMT-INST-MTHLY            
              MOVE K800-NUM-NRIC2             TO K820-NUM-NRIC                  
              PERFORM 8000-READ-K820          THRU 8000-EXIT                    
              IF WS-K820-FOUND = 'Y'                                            
                 PERFORM 8100-MOVE-K820-DATA  THRU 8100-EXIT                    
                 PERFORM 8500-GET-SERIAL-NO   THRU 8500-EXIT                    
                 PERFORM 8700-WRITE-LC29      THRU 8700-EXIT                    
                 PERFORM 5000-WRITE-F860      THRU 5000-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF FD38-AMT-INSTAL-NEW-CPF3 > 0                                      
              MOVE WS-AB02F860-REC            TO AB02F860-REC                   
              MOVE FD38-AMT-INSTAL-NEW-CPF3   TO F860-AMT-INST-MTHLY            
              MOVE K800-NUM-NRIC3             TO K820-NUM-NRIC                  
              PERFORM 8000-READ-K820          THRU 8000-EXIT                    
              IF WS-K820-FOUND = 'Y'                                            
                 PERFORM 8100-MOVE-K820-DATA  THRU 8100-EXIT                    
                 PERFORM 8500-GET-SERIAL-NO   THRU 8500-EXIT                    
                 PERFORM 8700-WRITE-LC29      THRU 8700-EXIT                    
                 PERFORM 5000-WRITE-F860      THRU 5000-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
           IF FD38-AMT-INSTAL-NEW-CPF4 > 0                                      
              MOVE WS-AB02F860-REC            TO AB02F860-REC                   
              MOVE FD38-AMT-INSTAL-NEW-CPF4   TO F860-AMT-INST-MTHLY            
              MOVE K800-NUM-NRIC4             TO K820-NUM-NRIC                  
              PERFORM 8000-READ-K820          THRU 8000-EXIT                    
              IF WS-K820-FOUND = 'Y'                                            
                 PERFORM 8100-MOVE-K820-DATA  THRU 8100-EXIT                    
                 PERFORM 8500-GET-SERIAL-NO   THRU 8500-EXIT                    
                 PERFORM 8700-WRITE-LC29      THRU 8700-EXIT                    
                 PERFORM 5000-WRITE-F860      THRU 5000-EXIT                    
              END-IF                                                            
           END-IF.                                                              
                                                                                
       7100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       8000-READ-K820.                                                          
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-K820-FOUND.                    
                                                                                
           READ BP13K820                                                        
           EVALUATE WS-K820-STATUS                                              
              WHEN 00                                                           
                 MOVE 'Y'                  TO WS-K820-FOUND                     
                 ADD   1                   TO CNT-K820-READ                     
              WHEN 23                                                           
                 MOVE 'N'                  TO WS-K820-FOUND                     
                 ADD   1                   TO CNT-K820-NOTFOUND                 
              WHEN OTHER                                                        
                 DISPLAY 'ERROR IN READING BP13K820 - STATUS '                  
                           WS-K820-STATUS                                       
                 MOVE      WS-K820-STATUS  TO RETURN-CODE                       
                 PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT                    
           END-EVALUATE.                                                        
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       8100-MOVE-K820-DATA.                                                     
      *----------------------------------------------------------------*        
                                                                                
           MOVE K820-NUM-CPF               TO F860-NUM-CPF-ACCT.                
           MOVE K820-NME-OCCP              TO F860-NME-ACCOUNT-HOLDER.          
                                                                                
       8100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *----------------------------------------------------------------*        
       8500-GET-SERIAL-NO.                                                      
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                     TO WS-B902-AREA.                     
           INITIALIZE                         WS-B902-AREA.                     
                                                                                
           MOVE 'PP'                       TO B902-NUM-OFFICE.                  
           CALL 'AB02C902' USING WS-B902-AREA.                                  
                                                                                
           IF B902-NUM-ERROR NOT = SPACES AND ZEROES                            
              DISPLAY 'ERROR IN CALLING AB02C902 '                              
                      B902-NUM-ERROR                                            
           ELSE                                                                 
              MOVE B902-NUM-SERIAL         TO F860-NUM-SNO                      
           END-IF.                                                              
                                                                                
       8500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8700-WRITE-LC29.                                                         
      *----------------------------------------------------------------*        
                                                                                
           MOVE SPACES                    TO LC29-PR-DETAILS.                   
           IF WS-LINE-CNT > 50                                                  
              PERFORM 8710-WRITE-HEADING  THRU 8710-EXIT                        
           END-IF.                                                              
                                                                                
           MOVE F860-NUM-SNO              TO LC29-SERIAL.                       
           STRING F860-NUM-HDB-REF(1:4) '-'                                     
                  F860-NUM-HDB-REF(5:4) '-'                                     
                  F860-NUM-HDB-REF(9:3)                                         
                  DELIMITED BY SIZE INTO LC29-SCHEME                            
           END-STRING.                                                          
                                                                                
           MOVE FD38-NUM-REGN             TO LC29-REG-NO.                       
           MOVE F860-NUM-CPF-ACCT         TO LC29-CPF-NO.                       
           MOVE F860-AMT-INST-MTHLY       TO LC29-AMOUNT.                       
           STRING FD38-DTE-INSTAL-NEW(7:2)  '/'                                 
                  FD38-DTE-INSTAL-NEW(5:2)  '/'                                 
                  FD38-DTE-INSTAL-NEW(1:4)                                      
                  DELIMITED BY SIZE INTO     LC29-EFF-INS-NEW-DTE.              
                                                                                
           ADD 1                          TO WS-SN                              
                                             WS-LINE-CNT                        
                                             WS-LC29-WRITE.                     
                                                                                
           MOVE WS-SN                     TO LC29-SN.                           
                                                                                
           WRITE PRINT-REC                FROM LC29-PR-DETAILS AFTER 1.         
                                                                                
       8700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       8710-WRITE-HEADING.                                                      
      *----------------------------------------------------------------*        
                                                                                
           ADD 1                          TO WS-PAGE-CNT.                       
           MOVE WS-PAGE-CNT               TO LC29-PAGENO.                       
                                                                                
           MOVE  SPACES                   TO PRINT-REC.                         
           WRITE PRINT-REC                      AFTER PAGE.                     
           WRITE PRINT-REC FROM LC29-PR-HEAD-01 AFTER 3.                        
           WRITE PRINT-REC FROM LC29-PR-HEAD-02 AFTER 1.                        
           WRITE PRINT-REC FROM LC29-PR-HEAD-03 AFTER 2.                        
           MOVE 7                         TO WS-LINE-CNT.                       
                                                                                
       8710-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *----------------------------------------------------------------*        
       9000-CLOSE-ROUTINE.                                                      
      *----------------------------------------------------------------*        
                                                                                
           CLOSE BP13FD38                                                       
                 SY02F001                                                       
                 BM06K110                                                       
                 BM06K100                                                       
                 BB14K500                                                       
                 BP13K800                                                       
                 BP13K820                                                       
                 AB02F860                                                       
                 BP13LC29.                                                      
                                                                                
           IF WS-K800-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR, BP13K800-STATUS ' WS-K800-STATUS.         
              MOVE WS-K800-STATUS     TO RETURN-CODE.                           
           IF WS-K110-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR, BM06K110-STATUS ' WS-K110-STATUS.         
              MOVE WS-K110-STATUS     TO RETURN-CODE.                           
           IF WS-K100-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR, BM06K100-STATUS ' WS-K100-STATUS.         
              MOVE WS-K100-STATUS     TO RETURN-CODE.                           
           IF WS-K500-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR, BM06K500-STATUS ' WS-K500-STATUS.         
              MOVE WS-K500-STATUS     TO RETURN-CODE.                           
           IF WS-K820-STATUS NOT = 00                                           
              DISPLAY 'CLOSING ERROR, BP13K820-STATUS ' WS-K820-STATUS.         
              MOVE WS-K820-STATUS     TO RETURN-CODE.                           
                                                                                
           DISPLAY '                                    '.                      
           DISPLAY '***** BP13CC29 CONTROL TOTALS ***** '.                      
           DISPLAY '                                    '.                      
           DISPLAY 'NO OF RECORDS READ FROM  (BP13FD38) = '                     
                    CNT-FD38-READ.                                              
           DISPLAY 'NO OF RECORDS READ FROM  (BP13K800) = '                     
                    CNT-K800-READ.                                              
           DISPLAY 'NO OF RECORDS READ FROM  (BM06K110) = '                     
                    CNT-K110-READ.                                              
           DISPLAY 'NO OF RECORDS READ FROM  (BM06K100) = '                     
                    CNT-K100-READ.                                              
           DISPLAY 'NO OF RECORDS READ FROM  (BB14K500) = '                     
                    CNT-K500-READ.                                              
           DISPLAY 'NO OF RECORDS NOT FOUND  (BP13K800) = '                     
                    CNT-K800-NOTFOUND.                                          
           DISPLAY 'NO OF RECORDS NOT FOUND  (BM06K110) = '                     
                    CNT-K110-NOTFOUND.                                          
           DISPLAY 'NO OF RECORDS NOT FOUND  (BM06K100) = '                     
                    CNT-K100-NOTFOUND.                                          
           DISPLAY 'NO OF RECORDS NOT FOUND  (BB14K500) = '                     
                    CNT-K500-NOTFOUND.                                          
           DISPLAY 'NO OF RECORDS READ FROM  (BP13K820) = '                     
                    CNT-K820-READ.                                              
           DISPLAY 'NO OF RECORDS NOT FOUND  (BP13K820) = '                     
                    CNT-K820-NOTFOUND.                                          
           DISPLAY 'NO OF RECORDS WRITTEN TO (AB02F860) = '                     
                    WS-F860-WRITE.                                              
           DISPLAY 'NO OF RECORDS WRITTEN TO (BP13LC29) = '                     
                    WS-LC29-WRITE.                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
                                                                                
                                                                                
