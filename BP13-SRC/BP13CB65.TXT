       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13CB65.                                                 
      *AUTHOR.        SMR2.                                                     
      *DATE-WRITTEN.  05/12/2017.                                               
      * ============================================================= *         
      *                  SYSTEM OF COMMITMENT (SOC)                   *         
      * ============================================================= *         
      *                                                               *         
      * OBJECTIVE   : GENERATE SHORTLISTING REPORTS TO BE USED FOR    *         
      *               CLEARANCE OF BALLOT RESULTS (2F ONLY)           *         
      *                                                               *         
      * INPUT FILES : BP13F740 - REQUEST FILE (ALL 2F)                *         
      *               BP13F730 - REQUEST FILE (2F SHORTLISTED IN APPZ)*         
      *               BP13K010 - TENDER FILE (ELDERLY)                *         
      *               BP13K01A - TENDER FILE (ACTUAL)                 *         
      *               BP13K030 - BALANCE FLAT FILE (BEFORE ADJUSTMENT)*         
      *               BP13K712 - REQUEST AND FLAT INFO FILE (ELDERLY) *         
      *               BP13K71A - REQUEST AND FLAT INFO FILE (ACTUAL)  *         
      *               BP13K813 - BTO/SBF SITE INFO FILE               *         
      * OUTPUT FILE : BP13LB65 - REPORT GENERATED                     *         
      *                                                               *         
      * ============================================================= *         
      * CHG-REF#  DATE      BY    DESCRIPTIONS                        *         
      * --------  --------  ----  ----------------------------------- *         
      * BP137052  05122017  SMR2  NEW PROGRAM                         *         
      * BP137173  09032018  JF7   CHANGES TO REPORTS                  *         
      * BP137455  17092018  FNP1  ADD NEW OUTPUT FILE BP13FW3I        *         
      * BP138078  03022020  AM25  UPDATE ON ETHNIC QUOTA AVAILABLE    *         
      * BP138214  10032020  AM25  FLAT SUPPLY W/ 1ST-TIMER APPLNS     *         
      * BP138924  22112021  SMP3  REMOVE HARDCODING ON ELDER-SPS AND  *         
      *                           ELDER-NONSPS                        *         
      * ============================================================= *         
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BP13F740 ASSIGN       TO BP13F740.                            
                                                                                
           SELECT BP13F730 ASSIGN       TO BP13F730.                            
           SELECT P13F730A ASSIGN       TO P13F730A.                            
                                                                                
           SELECT BP13K010 ASSIGN       TO BP13K010                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K010-KEY-FLD                         
                           FILE STATUS  IS WS-K010-STATUS.                      
                                                                                
           SELECT BP13K01A ASSIGN       TO BP13K01A                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS F010-KEY-FLD                         
                           FILE STATUS  IS WS-K01A-STATUS.                      
                                                                                
           SELECT BP13K030 ASSIGN       TO BP13K030                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K030-KEY-FLD                         
                           FILE STATUS  IS WS-K030-STATUS.                      
                                                                                
           SELECT BP13K712 ASSIGN       TO BP13K712                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K712-KEY-FLD                         
                           FILE STATUS  IS WS-K712-STATUS.                      
                                                                                
           SELECT BP13K71A ASSIGN       TO BP13K71A                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS F712-KEY-FLD                         
                           FILE STATUS  IS WS-K71A-STATUS.                      
                                                                                
           SELECT BP13K813 ASSIGN       TO BP13K813                             
                           ORGANIZATION IS INDEXED                              
                           ACCESS MODE  IS RANDOM                               
                           RECORD KEY   IS K813-KEY-FLD                         
                           FILE STATUS  IS WS-K813-STATUS.                      
                                                                                
           SELECT BP13LB65 ASSIGN       TO BP13LB65.                            
           SELECT BP13FW3I ASSIGN       TO BP13FW3I.                            
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD   BP13F740                                                            
            RECORDING MODE    IS F                                              
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BP13F740.                                                           
                                                                                
       FD   BP13F730                                                            
            RECORDING MODE    IS F                                              
            RECORD CONTAINS  500 CHARACTERS.                                    
       COPY BP13F730.                                                           
                                                                                
       FD   P13F730A                                                            
            RECORDING MODE    IS F                                              
            RECORD CONTAINS  500 CHARACTERS.                                    
       01   P13F730A-REC.                                                       
            05  FILLER                    PIC X(186).                           
            05  F730A-CDE-NT1             PIC X(3).                             
            05  FILLER                    PIC X(21).                            
            05  F730A-CDE-FLAT-TYPE       PIC X(2).                             
            05  FILLER                    PIC X(288).                           
                                                                                
       FD   BP13K010                                                            
            RECORD CONTAINS  600 CHARACTERS.                                    
       COPY BP13K010.                                                           
                                                                                
       FD   BP13K01A                                                            
            RECORD CONTAINS  600 CHARACTERS.                                    
       COPY BP13F010.                                                           
                                                                                
       FD   BP13K030                                                            
            RECORD CONTAINS  600 CHARACTERS.                                    
       COPY BP13K030.                                                           
                                                                                
       FD   BP13K712                                                            
            RECORD CONTAINS  350 CHARACTERS.                                    
       COPY BP13K712.                                                           
                                                                                
       FD   BP13K71A                                                            
            RECORD CONTAINS  350 CHARACTERS.                                    
       COPY BP13F712.                                                           
                                                                                
       FD   BP13K813                                                            
            RECORD CONTAINS 1000 CHARACTERS.                                    
       COPY BP13K813.                                                           
                                                                                
       FD   BP13LB65                                                            
            RECORDING MODE    IS F                                              
            RECORD CONTAINS  132 CHARACTERS.                                    
       01   BP13LB65-REC                 PIC X(132).                            
                                                                                
       FD   BP13FW3I                                                            
            RECORDING MODE    IS F                                              
            RECORD CONTAINS 4500 CHARACTERS.                                    
       COPY BP13FW3I.                                                           
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-FILE-STATUS.                                                      
           05  WS-K010-STATUS            PIC 9(02) VALUE ZEROES.                
           05  WS-K01A-STATUS            PIC 9(02) VALUE ZEROES.                
           05  WS-K030-STATUS            PIC 9(02) VALUE ZEROES.                
           05  WS-K712-STATUS            PIC 9(02) VALUE ZEROES.                
           05  WS-K71A-STATUS            PIC 9(02) VALUE ZEROES.                
           05  WS-K813-STATUS            PIC 9(02) VALUE ZEROES.                
                                                                                
       01  WS-SWITCHES.                                                         
           05  WS-F740-EOF               PIC X(01) VALUE 'N'.                   
           05  WS-F730-EOF               PIC X(01) VALUE 'N'.                   
           05  WS-F730A-EOF              PIC X(01) VALUE 'N'.                   
           05  WS-LB65-HDR               PIC X(01) VALUE 'N'.                   
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-TIME.                                                         
               10  WS-TIME-HH            PIC 9(02) VALUE 0.                     
               10  WS-TIME-MM            PIC 9(02) VALUE 0.                     
               10  WS-TIME-SS            PIC 9(02) VALUE 0.                     
           05  WS-F740-READ              PIC 9(06) VALUE ZEROES.                
           05  WS-FW3I-WRITE             PIC 9(06) VALUE ZEROES.                
           05  WS-CNT-PAGE               PIC 9(04) VALUE ZEROES.                
           05  WS-CNT                    PIC 9(01) VALUE ZEROES.                
           05  WS-XCNT                   PIC 9(01) VALUE ZEROES.                
           05  WS-PARM-NUM-CDE           PIC X(03).                             
           05  WS-EST-FT                 PIC X(10) VALUE SPACES.                
           05  WS-HARDLUCK-CNT           PIC 9(05) VALUE ZEROES.                
           05  WS-1ST-TIMER-CNT          PIC 9(05) VALUE ZEROES.                
                                                                                
       01  WS-TEMP-VAR.                                                         
           05  WS-F740-KEY-FLD.                                                 
               10  WS-F740-NT            PIC X(03).                             
               10  WS-F740-FT            PIC X(02).                             
           05  WS-F730-KEY-FLD.                                                 
               10  WS-F730-NT            PIC X(03).                             
               10  WS-F730-FT            PIC X(02).                             
           05  WS-F730A-KEY-FLD.                                                
               10  WS-F730A-NT           PIC X(03).                             
               10  WS-F730A-FT           PIC X(02).                             
           05  WS-PREV-KEY-FLD.                                                 
               10  WS-PREV-NT            PIC X(03).                             
               10  WS-PREV-FT            PIC X(02).                             
           05  WS-PREV-DTE-BAL           PIC X(06).                             
           05  WS-PREV-SMODE             PIC X(03).                             
                                                                                
       01  WS-COUNT-VAR.                                                        
           05  WS-FLAT-SUPPLY            PIC 9(05) VALUE ZEROES.                
           05  WS-PRIO-SHORTLIST         PIC 9(05) VALUE ZEROES.                
           05  WS-FLAT-SUPPLY-NOPRIO     PIC 9(05) VALUE ZEROES.                
           05  WS-ELDERLY                PIC 9(05) VALUE ZEROES.                
           05  WS-NON-ELDERLY            PIC 9(05) VALUE ZEROES.                
           05  WS-F740-CAT1              PIC 9(05) VALUE ZEROES.                
           05  WS-F740-CAT2              PIC 9(05) VALUE ZEROES.                
           05  WS-F740-CAT3              PIC 9(05) VALUE ZEROES.                
           05  WS-F740-TOTAL             PIC 9(05) VALUE ZEROES.                
           05  WS-K030-CAT1              PIC 9(05) VALUE ZEROES.                
           05  WS-K030-CAT2              PIC 9(05) VALUE ZEROES.                
           05  WS-K030-CAT3              PIC 9(05) VALUE ZEROES.                
           05  WS-K030-TOTAL             PIC 9(05) VALUE ZEROES.                
           05  WS-BF-ELD-SPS             PIC 9(05) VALUE ZEROES.                
           05  WS-BF-ELD-NSPS            PIC 9(05) VALUE ZEROES.                
           05  WS-BF-ELD-TOT             PIC 9(05) VALUE ZEROES.                
           05  WS-AF-ELD-SPS             PIC 9(05) VALUE ZEROES.                
           05  WS-AF-ELD-NSPS            PIC 9(05) VALUE ZEROES.                
           05  WS-AF-ELD-TOT             PIC 9(05) VALUE ZEROES.                
           05  WS-SIM-REQ-TOT            PIC 9(05) VALUE ZEROES.                
           05  WS-SIM-FLAT-TOT           PIC 9(05) VALUE ZEROES.                
           05  WS-SIM-REG-TOT            PIC 9(05) VALUE ZEROES.                
           05  WS-SIM-REQ-NH             PIC 9(05) VALUE ZEROES.                
           05  WS-ACT-REG-TOT            PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-ELD-SPS           PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-ELD-NSPS          PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-ELD-TOT           PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-NELD-NH           PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-NELD-UG           PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-NELD-FTS          PIC 9(05) VALUE ZEROES.                
           05  WS-APPZ-NELD-TOT          PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-ELD-SPS           PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-ELD-NSPS          PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-ELD-TOT           PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-NELD-NH           PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-NELD-UG           PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-NELD-FTS          PIC 9(05) VALUE ZEROES.                
           05  WS-SUCC-NELD-TOT          PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-ELD-SPS         PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-ELD-NSPS        PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-ELD-TOT         PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-NELD-NH         PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-NELD-UG         PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-NELD-FTS        PIC 9(05) VALUE ZEROES.                
           05  WS-UNSUCC-NELD-TOT        PIC 9(05) VALUE ZEROES.                
           05  WS-NUM-FLAT-NH            PIC 9(05) VALUE ZEROES.                
           05  WS-NUM-REG-NH             PIC 9(05) VALUE ZEROES.                
           05  WS-HARDLUCK-TOT           PIC 9(05) VALUE ZEROES.                
           05  WS-AF-HARDLUCK-TOT        PIC 9(05) VALUE ZEROES.                
           05  WS-1ST-TIMER-TOT          PIC 9(05) VALUE ZEROES.                
           05  WS-AF-1ST-TIMER-TOT       PIC 9(05) VALUE ZEROES.                
                                                                                
       01  WS-DTE-CURRENT.                                                      
           05  WS-YY                     PIC X(02).                             
           05  WS-MM                     PIC X(02).                             
           05  WS-DD                     PIC X(02).                             
                                                                                
       01  WS-DTE-TODATE.                                                       
           05  WS-DD                     PIC X(02).                             
           05  FILLER                    PIC X     VALUE '/'.                   
           05  WS-MM                     PIC X(02).                             
           05  FILLER                    PIC X     VALUE '/'.                   
           05  WS-YY                     PIC X(02).                             
                                                                                
      ***  NO OF APPLICATIONS SHORTLISTED - ELDERLY AND NON-ELDERLY             
       01  WS-SHORTLIST-TABLE.                                                  
           05  WS-SL-DESC             OCCURS 7 TIMES.                           
               10  WS-SL-DIV          OCCURS 7 TIMES.                           
                   15  WS-SL-QTY         PIC 9(5).                              
                                                                                
      ******************* REPORT LAYOUT *****************                       
                                                                                
       01  LB65-HEAD-1.                                                         
           05  FILLER                    PIC X(08) VALUE 'BP13LB65'.            
           05  FILLER                    PIC X(05) VALUE SPACES.                
           05  FILLER                    PIC X(07) VALUE 'HDBCAT3'.             
           05  FILLER                    PIC X(19) VALUE SPACES.                
           05  FILLER                    PIC X(42) VALUE                        
               'S Y S T E M     O F    C O M M I T M E N T'.                    
           05  FILLER                    PIC X(10) VALUE SPACES.                
           05  FILLER                    PIC X(07) VALUE 'DATE : '.             
           05  LB65-DTE-CURRENT          PIC X(08).                             
           05  FILLER                    PIC X(02) VALUE ' ('.                  
           05  LB65-TME-HH               PIC 9(02).                             
           05  FILLER                    PIC X(01) VALUE ':'.                   
           05  LB65-TME-MM               PIC 9(02).                             
           05  FILLER                    PIC X(02) VALUE ') '.                  
           05  FILLER                    PIC X(05) VALUE SPACES.                
           05  FILLER                    PIC X(07) VALUE 'PAGE : '.             
           05  LB65-CNT-PAGE             PIC ZZZ9.                              
                                                                                
       01  LB65-HEAD-2.                                                         
           05  FILLER                    PIC X(28) VALUE SPACES.                
           05  FILLER                    PIC X(64) VALUE                        
               'SHORTLISTING REPORTS BY ESTATE AND FLAT TYPE (2-ROOM FLE        
      -        'XI FLAT)'.                                                      
                                                                                
       01  LB65-HEAD-3.                                                         
           05  FILLER                    PIC X(25) VALUE                        
               'SALES MODE/BALLOT DATE : '.                                     
           05  LB65-SALES-MODE           PIC X(03) VALUE SPACES.                
           05  FILLER                    PIC X(01) VALUE '/'.                   
           05  LB65-DTE-BAL              PIC X(06) VALUE SPACES.                
                                                                                
       01  LB65-HEAD-4.                                                         
           05  FILLER                    PIC X(08) VALUE 'NT/FT : '.            
           05  LB65-EST-FT               PIC X(10) VALUE SPACES.                
                                                                                
       01  LB65-BLANK.                                                          
           05  FILLER                    PIC X(132) VALUE SPACES.               
                                                                                
      ***  REPORT A : FLAT SUPPLY (FIRST HUNDRED)                               
       01  LB65A-TITLE.                                                         
           05  FILLER                    PIC X(05)  VALUE                       
               '**** '.                                                         
           05  LB65A-PERCENT             PIC X(03)  VALUE SPACES.               
           05  FILLER                    PIC X(13)  VALUE                       
               '% FLAT SUPPLY'.                                                 
           05  FILLER                    PIC X(05)  VALUE                       
               ' ****'.                                                         
                                                                                
       01  LB65A-LINE-1.                                                        
           05  FILLER                    PIC X(64)  VALUE ALL '='.              
                                                                                
       01  LB65A-LINE-2.                                                        
           05  FILLER                    PIC X(51)  VALUE                       
               '--------------------------------------------------|'.           
           05  FILLER                    PIC X(13)  VALUE                       
               '-------------'.                                                 
                                                                                
       01  LB65A-DETAIL.                                                        
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  LB65A-DESC                PIC X(48)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE '|    '.              
           05  LB65A-UNIT                PIC ZZZZ9  VALUE ZEROES.               
                                                                                
      ***  REPORT B : FLAT SUPPLY FOR ELDERLY APPLICATIONS                      
       01  LB65B-TITLE.                                                         
           05  FILLER                    PIC X(05)  VALUE                       
               '**** '.                                                         
           05  FILLER                    PIC X(36)  VALUE                       
               'FLAT SUPPLY FOR ELDERLY APPLICATIONS'.                          
           05  FILLER                    PIC X(05)  VALUE                       
               ' ****'.                                                         
                                                                                
       01  LB65B-LINE-1.                                                        
           05  FILLER                    PIC X(77)  VALUE ALL '='.              
                                                                                
       01  LB65B-LINE-2.                                                        
           05  FILLER                    PIC X(48)  VALUE                       
               '-----------------------------------------------|'.              
           05  FILLER                    PIC X(29)  VALUE                       
               '---------|---------|---------'.                                 
                                                                                
       01  LB65B-HEAD.                                                          
           05  FILLER                    PIC X(47)  VALUE SPACES.               
           05  FILLER                    PIC X(28)  VALUE                       
               '|   SPS   | NON-SPS |  TOTAL'.                                  
                                                                                
       01  LB65B-DETAIL.                                                        
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  LB65B-DESC                PIC X(43)  VALUE SPACES.               
           05  FILLER                    PIC X(05)  VALUE '  |  '.              
           05  LB65B-SPS                 PIC ZZZZ9.                             
           05  FILLER                    PIC X(05)  VALUE '  |  '.              
           05  LB65B-NSPS                PIC ZZZZ9.                             
           05  FILLER                    PIC X(05)  VALUE '  |  '.              
           05  LB65B-TOT                 PIC ZZZZ9.                             
                                                                                
      ***  REPORT C : NO OF APPLICATIONS SHORTLISTED                            
       01  LB65C-TITLE.                                                         
           05  FILLER                    PIC X(05)  VALUE                       
               '**** '.                                                         
           05  FILLER                    PIC X(30)  VALUE                       
               'NO OF APPLICATIONS SHORTLISTED'.                                
           05  FILLER                    PIC X(05)  VALUE                       
               ' ****'.                                                         
                                                                                
       01  LB65C-LINE-1.                                                        
           05  FILLER                    PIC X(119) VALUE ALL '='.              
                                                                                
       01  LB65C-LINE-2.                                                        
           05  FILLER                    PIC X(49)  VALUE SPACES.               
           05  FILLER                    PIC X(30)  VALUE                       
               '|-----------------------------'.                                
           05  FILLER                    PIC X(40)  VALUE                       
               '|---------------------------------------'.                      
                                                                                
       01  LB65C-LINE-3.                                                        
           05  FILLER                    PIC X(49)  VALUE ALL '='.              
           05  FILLER                    PIC X(30)  VALUE                       
               '|=========|=========|========='.                                
           05  FILLER                    PIC X(40)  VALUE                       
               '|=========|=========|=========|========='.                      
                                                                                
       01  LB65C-LINE-4.                                                        
           05  FILLER                    PIC X(49)  VALUE ALL '-'.              
           05  FILLER                    PIC X(30)  VALUE                       
               '|---------|---------|---------'.                                
           05  FILLER                    PIC X(40)  VALUE                       
               '|---------|---------|---------|---------'.                      
                                                                                
       01  LB65C-HEAD-1.                                                        
           05  FILLER                    PIC X(49)  VALUE SPACES.               
           05  FILLER                    PIC X(30)  VALUE                       
               '|           ELDERLY           '.                                
           05  FILLER                    PIC X(40)  VALUE                       
               '|              NON-ELDERLY              '.                      
                                                                                
       01  LB65C-HEAD-2.                                                        
           05  FILLER                    PIC X(49)  VALUE SPACES.               
           05  FILLER                    PIC X(30)  VALUE                       
               '|   SPS   | NON-SPS |  TOTAL  '.                                
           05  FILLER                    PIC X(40)  VALUE                       
               '|    FT   |    ST   |   FTS   |  TOTAL  '.                      
                                                                                
       01  LB65C-DETAIL.                                                        
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  LB65C-DESC                PIC X(45)  VALUE SPACES.               
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  LB65C-DIV              OCCURS 7 TIMES.                           
               10  FILLER                PIC X(03)  VALUE '|  '.                
               10  LB65C-QTY             PIC ZZZZ9  VALUE ZEROES.               
               10  FILLER                PIC X(02)  VALUE SPACES.               
                                                                                
      ***  REPORT D : ETHNIC QUOTA (FIRST HUNDRED)                              
       01  LB65D-TITLE.                                                         
           05  FILLER                    PIC X(05)  VALUE                       
               '**** '.                                                         
           05  LB65D-PERCENT             PIC X(03)  VALUE SPACES.               
           05  FILLER                    PIC X(14)  VALUE                       
               '% ETHNIC QUOTA'.                                                
           05  FILLER                    PIC X(05)  VALUE                       
               ' ****'.                                                         
                                                                                
       01  LB65D-LINE-1.                                                        
           05  FILLER                    PIC X(81)  VALUE ALL '='.              
                                                                                
       01  LB65D-LINE-2.                                                        
           05  FILLER                    PIC X(54)  VALUE                       
               '-------------------------|-------------|-------------|'.        
           05  FILLER                    PIC X(27)  VALUE                       
               '-------------|-------------'.                                   
                                                                                
       01  LB65D-HEAD.                                                          
           05  FILLER                    PIC X(25)  VALUE SPACES.               
           05  FILLER                    PIC X(52)  VALUE                       
               '|    CAT 1    |    CAT 2    |  CAT 3 & 4  |    TOTAL'.          
                                                                                
       01  LB65D-DETAIL.                                                        
           05  FILLER                    PIC X(02)  VALUE SPACES.               
           05  LB65D-DESC                PIC X(22)  VALUE SPACES.               
           05  FILLER                    PIC X(06)  VALUE ' |    '.             
           05  LB65D-CAT1                PIC ZZZZ9.                             
           05  FILLER                    PIC X(09)  VALUE '    |    '.          
           05  LB65D-CAT2                PIC ZZZZ9.                             
           05  FILLER                    PIC X(09)  VALUE '    |    '.          
           05  LB65D-CAT3                PIC ZZZZ9.                             
           05  FILLER                    PIC X(09)  VALUE '    |    '.          
           05  LB65D-TOT                 PIC ZZZZ9.                             
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      ********************                                                      
       0000-MAIN-ROUTINE.                                                       
      ********************                                                      
                                                                                
           PERFORM 1000-OPEN-FILES          THRU 1000-EXIT.                     
           PERFORM 2000-READ-BP13F740       THRU 2000-EXIT.                     
           IF WS-F740-READ > ZEROES                                             
              PERFORM 2100-READ-BP13F730    THRU 2100-EXIT                      
              PERFORM 2200-READ-P13F730A    THRU 2200-EXIT                      
           END-IF.                                                              
           PERFORM 2500-PROCESS-BP13F740    THRU 2500-EXIT                      
             UNTIL WS-F740-EOF = 'Y'.                                           
           IF WS-F740-READ > ZEROES                                             
              PERFORM 3000-PROCESS-RECORDS  THRU 3000-EXIT                      
           END-IF.                                                              
           PERFORM 9000-CLOSE-FILES         THRU 9000-EXIT.                     
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************                                                        
       1000-OPEN-FILES.                                                         
      ******************                                                        
                                                                                
           OPEN INPUT  BP13F740                                                 
                       BP13F730                                                 
                       P13F730A                                                 
                       BP13K010                                                 
                       BP13K01A                                                 
                       BP13K030                                                 
                       BP13K712                                                 
                       BP13K71A                                                 
                       BP13K813                                                 
                OUTPUT BP13LB65                                                 
                       BP13FW3I.                                                
                                                                                
           IF WS-K010-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K010, STATUS ' WS-K010-STATUS          
              MOVE WS-K010-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-K01A-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K01A, STATUS ' WS-K01A-STATUS          
              MOVE WS-K01A-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-K030-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K030, STATUS ' WS-K030-STATUS          
              MOVE WS-K030-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-K712-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K712, STATUS ' WS-K712-STATUS          
              MOVE WS-K712-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-K71A-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K71A, STATUS ' WS-K71A-STATUS          
              MOVE WS-K71A-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           IF WS-K813-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR OPENING BP13K813, STATUS ' WS-K813-STATUS          
              MOVE WS-K813-STATUS           TO RETURN-CODE                      
              PERFORM 9000-CLOSE-FILES      THRU 9000-EXIT                      
           END-IF.                                                              
                                                                                
           ACCEPT WS-DTE-CURRENT            FROM DATE.                          
           MOVE CORR WS-DTE-CURRENT         TO WS-DTE-TODATE.                   
           MOVE WS-DTE-TODATE               TO LB65-DTE-CURRENT.                
                                                                                
           ACCEPT WS-TIME                   FROM TIME.                          
           MOVE WS-TIME-HH                  TO LB65-TME-HH.                     
           MOVE WS-TIME-MM                  TO LB65-TME-MM.                     
                                                                                
           MOVE ZEROES                      TO WS-COUNT-VAR                     
                                               WS-SHORTLIST-TABLE.              
                                                                                
      *** ACCEPT VALUE FROM JCL ***                                             
           ACCEPT WS-PARM-NUM-CDE.                                              
           MOVE WS-PARM-NUM-CDE             TO LB65A-PERCENT                    
                                               LB65D-PERCENT.                   
                                                                                
           MOVE SPACES TO BP13FW3I-REC.                                         
           INITIALIZE     BP13FW3I-REC.                                         
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       2000-READ-BP13F740.                                                      
      *********************                                                     
                                                                                
           READ BP13F740                                                        
             AT END                                                             
                MOVE 'Y'                    TO WS-F740-EOF                      
                GO TO 2000-EXIT.                                                
                                                                                
           ADD 1                            TO WS-F740-READ.                    
                                                                                
           IF WS-F740-READ = 1                                                  
              MOVE F740-CDE-NT1             TO WS-PREV-NT                       
              MOVE F740-CDE-FLAT-TYPE       TO WS-PREV-FT                       
              MOVE F740-DTE-BALLOT          TO WS-PREV-DTE-BAL                  
              MOVE F740-NUM-ALLO-CAT        TO WS-PREV-SMODE                    
           END-IF.                                                              
                                                                                
           MOVE F740-CDE-NT1                TO WS-F740-NT.                      
           MOVE F740-CDE-FLAT-TYPE          TO WS-F740-FT.                      
                                                                                
       2000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       2100-READ-BP13F730.                                                      
      *********************                                                     
                                                                                
           READ BP13F730                                                        
             AT END                                                             
                MOVE 'Y'                    TO WS-F730-EOF                      
                GO TO 2100-EXIT.                                                
                                                                                
           MOVE F730-CDE-NT1                TO WS-F730-NT.                      
           MOVE F730-CDE-FLAT-TYPE          TO WS-F730-FT.                      
                                                                                
       2100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       2200-READ-P13F730A.                                                      
      *********************                                                     
                                                                                
           READ P13F730A                                                        
             AT END                                                             
                MOVE 'Y'                    TO WS-F730A-EOF                     
                GO TO 2200-EXIT.                                                
                                                                                
           MOVE F730A-CDE-NT1               TO WS-F730A-NT.                     
           MOVE F730A-CDE-FLAT-TYPE         TO WS-F730A-FT.                     
                                                                                
       2200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ************************                                                  
       2500-PROCESS-BP13F740.                                                   
      ************************                                                  
                                                                                
           IF WS-F740-KEY-FLD = WS-PREV-KEY-FLD                                 
              IF F740-CDE-CATEGORY = '1'                                        
                 ADD 1                      TO WS-F740-CAT1                     
              ELSE                                                              
                 IF F740-CDE-CATEGORY = '2'                                     
                    ADD 1                   TO WS-F740-CAT2                     
                 ELSE                                                           
                    IF F740-CDE-CATEGORY = '3' OR '4'                           
                       ADD 1                TO WS-F740-CAT3                     
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           ELSE                                                                 
              PERFORM 3000-PROCESS-RECORDS  THRU 3000-EXIT                      
              MOVE ZEROES                   TO WS-COUNT-VAR                     
                                               WS-SHORTLIST-TABLE               
              MOVE ZEROES                   TO WS-HARDLUCK-CNT                  
                                               WS-1ST-TIMER-CNT                 
              IF F740-CDE-CATEGORY = '1'                                        
                 ADD 1                      TO WS-F740-CAT1                     
              ELSE                                                              
                 IF F740-CDE-CATEGORY = '2'                                     
                    ADD 1                   TO WS-F740-CAT2                     
                 ELSE                                                           
                    IF F740-CDE-CATEGORY = '3' OR '4'                           
                       ADD 1                TO WS-F740-CAT3                     
                    END-IF                                                      
                 END-IF                                                         
              END-IF                                                            
           END-IF.                                                              
                                                                                
           MOVE F740-CDE-NT1                TO WS-PREV-NT.                      
           MOVE F740-CDE-FLAT-TYPE          TO WS-PREV-FT.                      
           MOVE F740-DTE-BALLOT             TO WS-PREV-DTE-BAL.                 
           MOVE F740-NUM-ALLO-CAT           TO WS-PREV-SMODE.                   
                                                                                
           IF F740-NUM-HARDLUCK NOT = SPACES AND LOW-VALUES                     
              ADD  1                        TO WS-HARDLUCK-CNT                  
           END-IF.                                                              
                                                                                
           PERFORM 2000-READ-BP13F740       THRU 2000-EXIT.                     
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ************************                                                  
       2600-PROCESS-BP13F730.                                                   
      ************************                                                  
                                                                                
           IF F730-NUM-ELDERLY = 'F' OR 'S'                                     
              IF ((F730-NUM-APPS NOT = SPACES AND LOW-VALUES) AND               
                  (F730-NUM-APPS-ELIG-TAG = '1' OR 'T')) OR                     
                 ((F730-NUM-MCPS = 'P' OR 'C' OR 'M') AND                       
                  (F730-CDE-RESIDENT-HA1 = '1' OR 'A' OR 'T'))                  
                 ADD 1                      TO WS-APPZ-ELD-SPS                  
                                               WS-APPZ-ELD-TOT                  
              ELSE                                                              
                 ADD 1                      TO WS-APPZ-ELD-NSPS                 
                                               WS-APPZ-ELD-TOT                  
              END-IF                                                            
           ELSE                                                                 
              IF F730-CDE-BALLOT-HOUSEHOLD = 'H' OR 'T' OR 'F'                  
                 IF F730-CDE-ALLOC-SCH = 'FTS'                                  
                    ADD 1                   TO WS-APPZ-NELD-FTS                 
      **                                       WS-APPZ-NELD-NH                  
                                               WS-APPZ-NELD-TOT                 
                 ELSE                                                           
                    ADD 1                   TO WS-APPZ-NELD-NH                  
                                               WS-APPZ-NELD-TOT                 
                 END-IF                                                         
              ELSE                                                              
                 ADD 1                      TO WS-APPZ-NELD-UG                  
                                               WS-APPZ-NELD-TOT                 
              END-IF                                                            
           END-IF.                                                              
                                                                                
           PERFORM 2100-READ-BP13F730       THRU 2100-EXIT.                     
                                                                                
       2600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ************************                                                  
       2700-PROCESS-P13F730A.                                                   
      ************************                                                  
                                                                                
           IF WS-F730A-KEY-FLD = WS-PREV-KEY-FLD                                
              ADD 1                    TO WS-1ST-TIMER-CNT                      
           END-IF.                                                              
                                                                                
           PERFORM 2200-READ-P13F730A THRU 2200-EXIT.                           
                                                                                
       2700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***********************                                                   
       3000-PROCESS-RECORDS.                                                    
      ***********************                                                   
                                                                                
           PERFORM 2600-PROCESS-BP13F730    THRU 2600-EXIT                      
             UNTIL WS-F730-KEY-FLD > WS-PREV-KEY-FLD                            
                OR WS-F730-EOF = 'Y'.                                           
           PERFORM 2700-PROCESS-P13F730A    THRU 2700-EXIT                      
             UNTIL WS-F730A-KEY-FLD > WS-PREV-KEY-FLD                           
                OR WS-F730A-EOF = 'Y'.                                          
           PERFORM 4000-READ-BP13K010       THRU 4000-EXIT.                     
           PERFORM 4500-READ-BP13K01A       THRU 4500-EXIT.                     
           PERFORM 5000-READ-BP13K030       THRU 5000-EXIT.                     
           PERFORM 6000-READ-BP13K712       THRU 6000-EXIT.                     
           PERFORM 6500-READ-BP13K71A       THRU 6500-EXIT.                     
           PERFORM 7000-SETUP-SL-TABLE      THRU 7000-EXIT.                     
           PERFORM 7500-READ-BP13K813       THRU 7500-EXIT.                     
           PERFORM 8000-WRITE-BP13LB65      THRU 8000-EXIT.                     
           PERFORM 8700-WRITE-BP13FW3I      THRU 8700-EXIT.                     
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       4000-READ-BP13K010.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO BP13K010-TENDER.                 
           INITIALIZE                          BP13K010-TENDER.                 
                                                                                
           MOVE WS-PREV-KEY-FLD             TO K010-KEY-FLD.                    
                                                                                
           READ BP13K010.                                                       
           EVALUATE WS-K010-STATUS                                              
           WHEN ZEROES                                                          
                MOVE K010-NUM-TOT-UNIT      TO WS-FLAT-SUPPLY                   
                COMPUTE WS-PRIO-SHORTLIST = K010-REG-CCC1 +                     
                                            K010-REG-CCC2 +                     
                                            K010-REG-CCC3 +                     
                                            K010-REG-REN1 +                     
                                            K010-REG-REN2 +                     
                                            K010-REG-REN3 +                     
                                            K010-REG-JB1  +                     
                                            K010-REG-JB2  +                     
                                            K010-REG-JB3  +                     
                                            K010-REG-TCP1 +                     
                                            K010-REG-TCP2 +                     
                                            K010-REG-TCP3                       
                COMPUTE WS-FLAT-SUPPLY-NOPRIO = WS-FLAT-SUPPLY -                
                                                WS-PRIO-SHORTLIST               
                MOVE K010-NUM-TOT-ELDER     TO WS-ELDERLY                       
                MOVE K010-NUM-TOT-NON-ELDER TO WS-NON-ELDERLY                   
                                                                                
                COMPUTE K010-NUM-TOT-ELDER-NONSPS =                             
                       (K010-NUM-TOT-ELDER *                                    
                        K010-NUM-ELDER-NONSPS) / 100                            
                COMPUTE K010-NUM-TOT-ELDER-SPS    =                             
                        K010-NUM-TOT-ELDER - K010-NUM-TOT-ELDER-NONSPS          
                MOVE K010-NUM-TOT-ELDER-NONSPS TO WS-BF-ELD-NSPS                
                                                  WS-AF-ELD-NSPS                
                MOVE K010-NUM-TOT-ELDER-SPS    TO WS-BF-ELD-SPS                 
                                                  WS-AF-ELD-SPS                 
                IF K010-NUM-APP-ELDER-SPS < K010-NUM-TOT-ELDER-SPS              
                   IF K010-NUM-APP-ELDER-NONSPS >                               
                      K010-NUM-TOT-ELDER-NONSPS                                 
                      COMPUTE K010-NUM-TOT-ELDER-NONSPS =                       
                              K010-NUM-TOT-ELDER-NONSPS +                       
                             (K010-NUM-TOT-ELDER-SPS -                          
                              K010-NUM-APP-ELDER-SPS)                           
                      MOVE K010-NUM-TOT-ELDER-NONSPS TO WS-AF-ELD-NSPS          
                      COMPUTE WS-AF-ELD-SPS = K010-NUM-TOT-ELDER -              
                                              K010-NUM-TOT-ELDER-NONSPS         
                   END-IF                                                       
                END-IF                                                          
                IF K010-NUM-APP-ELDER-NONSPS < K010-NUM-TOT-ELDER-NONSPS        
                   IF K010-NUM-APP-ELDER-SPS > K010-NUM-TOT-ELDER-SPS           
                      COMPUTE K010-NUM-TOT-ELDER-SPS =                          
                              K010-NUM-TOT-ELDER-SPS +                          
                             (K010-NUM-TOT-ELDER-NONSPS -                       
                              K010-NUM-APP-ELDER-NONSPS)                        
                      MOVE K010-NUM-TOT-ELDER-SPS TO WS-AF-ELD-SPS              
                      COMPUTE WS-AF-ELD-NSPS = K010-NUM-TOT-ELDER -             
                                               K010-NUM-TOT-ELDER-SPS           
                   END-IF                                                       
                END-IF                                                          
                COMPUTE WS-BF-ELD-TOT = WS-BF-ELD-SPS + WS-BF-ELD-NSPS          
                COMPUTE WS-AF-ELD-TOT = WS-AF-ELD-SPS + WS-AF-ELD-NSPS          
                                                                                
      *         MOVE K010-NUM-APP-ELDER-SPS    TO WS-SL-QTY ( 1 , 1 )           
      *         MOVE K010-NUM-APP-ELDER-NONSPS TO WS-SL-QTY ( 1 , 2 )           
      *         MOVE K010-NUM-APP-ELDER        TO WS-SL-QTY ( 1 , 3 )           
      *         MOVE WS-AF-ELD-SPS             TO WS-SL-QTY ( 2 , 1 )           
      *         MOVE WS-AF-ELD-NSPS            TO WS-SL-QTY ( 2 , 2 )           
      *         MOVE WS-AF-ELD-TOT             TO WS-SL-QTY ( 2 , 3 )           
      *         MOVE K010-NUM-REG-ELDER-SPS    TO WS-SL-QTY ( 3 , 1 )           
      *         MOVE K010-NUM-REG-ELDER-NONSPS TO WS-SL-QTY ( 3 , 2 )           
      *         MOVE K010-NUM-REG-ELDER        TO WS-SL-QTY ( 3 , 3 )           
                                                                                
                IF WS-PARM-NUM-CDE = 100                                        
                   MOVE WS-HARDLUCK-CNT     TO WS-HARDLUCK-TOT                  
                ELSE                                                            
                   MOVE ZEROES              TO WS-HARDLUCK-TOT                  
                END-IF                                                          
                                                                                
                COMPUTE WS-AF-HARDLUCK-TOT   = WS-FLAT-SUPPLY-NOPRIO -          
                                               WS-HARDLUCK-TOT                  
                                                                                
                IF WS-PARM-NUM-CDE = 100                                        
                   MOVE WS-1ST-TIMER-CNT    TO WS-1ST-TIMER-TOT                 
                ELSE                                                            
                   MOVE ZEROES              TO WS-1ST-TIMER-TOT                 
                END-IF                                                          
                                                                                
                COMPUTE WS-AF-1ST-TIMER-TOT  = WS-AF-HARDLUCK-TOT -             
                                               WS-1ST-TIMER-TOT                 
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K010 - ' K010-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K010, STATUS ' WS-K010-STATUS        
                MOVE WS-K010-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       4500-READ-BP13K01A.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO BP13F010-TENDER.                 
           INITIALIZE                          BP13F010-TENDER.                 
                                                                                
           MOVE WS-PREV-KEY-FLD             TO F010-KEY-FLD.                    
                                                                                
           READ BP13K01A.                                                       
           EVALUATE WS-K01A-STATUS                                              
           WHEN ZEROES                                                          
                CONTINUE                                                        
      *         MOVE F010-NUM-REG-ELDER-SPS    TO WS-SL-QTY ( 4 , 1 )           
      *         MOVE F010-NUM-REG-ELDER-NONSPS TO WS-SL-QTY ( 4 , 2 )           
      *         MOVE F010-NUM-REG-ELDER        TO WS-SL-QTY ( 4 , 3 )           
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K01A - ' F010-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K01A, STATUS ' WS-K01A-STATUS        
                MOVE WS-K01A-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       5000-READ-BP13K030.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO BP13K030-TENDER.                 
           INITIALIZE                          BP13K030-TENDER.                 
                                                                                
           MOVE ZEROES                      TO WS-K030-TOTAL                    
                                               WS-K030-CAT1                     
                                               WS-K030-CAT2                     
                                               WS-K030-CAT3.                    
                                                                                
           MOVE WS-PREV-KEY-FLD             TO K030-KEY-FLD.                    
                                                                                
           READ BP13K030.                                                       
           EVALUATE WS-K030-STATUS                                              
           WHEN ZEROES                                                          
                COMPUTE WS-K030-CAT1 = K030-NUM-MAX-CCC1 +                      
                                       K030-NUM-MAX-REN1 +                      
                                       K030-NUM-MAX-JB1  +                      
                                       K030-NUM-MAX-PA1  +                      
                                       K030-NUM-MAX-TCP1                        
                COMPUTE WS-K030-CAT2 = K030-NUM-MAX-CCC2 +                      
                                       K030-NUM-MAX-REN2 +                      
                                       K030-NUM-MAX-JB2  +                      
                                       K030-NUM-MAX-PA2  +                      
                                       K030-NUM-MAX-TCP2                        
                COMPUTE WS-K030-CAT3 = K030-NUM-MAX-CCC3 +                      
                                       K030-NUM-MAX-REN3 +                      
                                       K030-NUM-MAX-JB3  +                      
                                       K030-NUM-MAX-PA3  +                      
                                       K030-NUM-MAX-TCP3                        
                MOVE K030-NUM-TOT-UNIT      TO WS-K030-TOTAL                    
                                                                                
                IF WS-PARM-NUM-CDE = '200' OR '300'                             
                   MOVE K030-NUM-TOT-UNIT   TO WS-K030-CAT1                     
                                               WS-K030-CAT2                     
                                               WS-K030-CAT3                     
                END-IF                                                          
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K030 - ' K030-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K030, STATUS ' WS-K030-STATUS        
                MOVE WS-K030-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       5000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       6000-READ-BP13K712.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO BP13K712-REC.                    
           INITIALIZE                          BP13K712-REC.                    
                                                                                
           MOVE WS-PREV-NT                  TO K712-CDE-NT-ZONE.                
           MOVE WS-PREV-FT                  TO K712-CDE-FLAT-TY.                
           MOVE 'PA'                        TO K712-CDE-COHORT                  
                                               K712-CDE-ALLOC-SCH.              
                                                                                
           READ BP13K712.                                                       
           EVALUATE WS-K712-STATUS                                              
           WHEN ZEROES                                                          
                COMPUTE WS-SIM-REQ-NH =                                         
                        K712-NUM-REQ-NH + K712-NUM-REQ-FTS                      
                COMPUTE WS-SIM-REQ-TOT =                                        
                        WS-SIM-REQ-NH + K712-NUM-REQ-UG                         
                COMPUTE WS-SIM-FLAT-TOT =                                       
                        K712-NUM-FLAT-NH + K712-NUM-FLAT-UG                     
                COMPUTE WS-SIM-REG-TOT =                                        
                        K712-NUM-REG-NH + K712-NUM-REG-UG                       
      *         MOVE WS-SIM-REQ-NH             TO WS-SL-QTY ( 1 , 4 )           
      *         MOVE K712-NUM-REQ-UG           TO WS-SL-QTY ( 1 , 5 )           
      *         MOVE K712-NUM-REQ-FTS          TO WS-SL-QTY ( 1 , 6 )           
      *         MOVE WS-SIM-REQ-TOT            TO WS-SL-QTY ( 1 , 7 )           
      *         MOVE K712-NUM-FLAT-NH          TO WS-SL-QTY ( 2 , 4 )           
      *         MOVE K712-NUM-FLAT-UG          TO WS-SL-QTY ( 2 , 5 )           
      *         MOVE K712-NUM-FLAT-FTS         TO WS-SL-QTY ( 2 , 6 )           
      *         MOVE WS-SIM-FLAT-TOT           TO WS-SL-QTY ( 2 , 7 )           
      *         MOVE K712-NUM-REG-NH           TO WS-SL-QTY ( 3 , 4 )           
      *         MOVE K712-NUM-REG-UG           TO WS-SL-QTY ( 3 , 5 )           
      *         MOVE K712-NUM-REG-FTS          TO WS-SL-QTY ( 3 , 6 )           
      *         MOVE WS-SIM-REG-TOT            TO WS-SL-QTY ( 3 , 7 )           
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K712 - ' K712-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K712, STATUS ' WS-K712-STATUS        
                MOVE WS-K712-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       6500-READ-BP13K71A.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO BP13F712-REC.                    
           INITIALIZE                          BP13F712-REC.                    
                                                                                
           MOVE WS-PREV-NT                  TO F712-CDE-NT-ZONE.                
           MOVE WS-PREV-FT                  TO F712-CDE-FLAT-TY.                
           MOVE 'PA'                        TO F712-CDE-COHORT                  
                                               F712-CDE-ALLOC-SCH.              
                                                                                
           READ BP13K71A.                                                       
           EVALUATE WS-K71A-STATUS                                              
           WHEN ZEROES                                                          
                COMPUTE WS-ACT-REG-TOT =                                        
                        F712-NUM-REG-NH + F712-NUM-REG-UG                       
      *         MOVE F712-NUM-REG-NH           TO WS-SL-QTY ( 4 , 4 )           
      *         MOVE F712-NUM-REG-UG           TO WS-SL-QTY ( 4 , 5 )           
      *         MOVE F712-NUM-REG-FTS          TO WS-SL-QTY ( 4 , 6 )           
      *         MOVE WS-ACT-REG-TOT            TO WS-SL-QTY ( 4 , 7 )           
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K71A - ' F712-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K71A, STATUS ' WS-K71A-STATUS        
                MOVE WS-K71A-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **********************                                                    
       7000-SETUP-SL-TABLE.                                                     
      **********************                                                    
                                                                                
           MOVE K010-NUM-APP-ELDER-SPS      TO WS-SL-QTY ( 1 , 1 ).             
           MOVE K010-NUM-APP-ELDER-NONSPS   TO WS-SL-QTY ( 1 , 2 ).             
           MOVE K010-NUM-APP-ELDER          TO WS-SL-QTY ( 1 , 3 ).             
      **   MOVE WS-SIM-REQ-NH               TO WS-SL-QTY ( 1 , 4 ).             
           MOVE K712-NUM-REQ-NH             TO WS-SL-QTY ( 1 , 4 ).             
           MOVE K712-NUM-REQ-UG             TO WS-SL-QTY ( 1 , 5 ).             
           MOVE K712-NUM-REQ-FTS            TO WS-SL-QTY ( 1 , 6 ).             
           MOVE WS-SIM-REQ-TOT              TO WS-SL-QTY ( 1 , 7 ).             
                                                                                
           MOVE WS-AF-ELD-SPS               TO WS-SL-QTY ( 2 , 1 ).             
           MOVE WS-AF-ELD-NSPS              TO WS-SL-QTY ( 2 , 2 ).             
           MOVE WS-AF-ELD-TOT               TO WS-SL-QTY ( 2 , 3 ).             
      **   MOVE K712-NUM-FLAT-NH            TO WS-SL-QTY ( 2 , 4 ).             
           COMPUTE WS-NUM-FLAT-NH   = K712-NUM-FLAT-NH -                        
                                      K712-NUM-FLAT-FTS.                        
           MOVE WS-NUM-FLAT-NH              TO WS-SL-QTY ( 2 , 4 ).             
           MOVE K712-NUM-FLAT-UG            TO WS-SL-QTY ( 2 , 5 ).             
           MOVE K712-NUM-FLAT-FTS           TO WS-SL-QTY ( 2 , 6 ).             
           MOVE WS-SIM-FLAT-TOT             TO WS-SL-QTY ( 2 , 7 ).             
                                                                                
           MOVE K010-NUM-REG-ELDER-SPS      TO WS-SL-QTY ( 3 , 1 ).             
           MOVE K010-NUM-REG-ELDER-NONSPS   TO WS-SL-QTY ( 3 , 2 ).             
           MOVE K010-NUM-REG-ELDER          TO WS-SL-QTY ( 3 , 3 ).             
      **   MOVE K712-NUM-REG-NH             TO WS-SL-QTY ( 3 , 4 ).             
           COMPUTE WS-NUM-REG-NH   = K712-NUM-REG-NH -                          
                                     K712-NUM-REG-FTS.                          
           MOVE WS-NUM-REG-NH               TO WS-SL-QTY ( 3 , 4 ).             
           MOVE K712-NUM-REG-UG             TO WS-SL-QTY ( 3 , 5 ).             
           MOVE K712-NUM-REG-FTS            TO WS-SL-QTY ( 3 , 6 ).             
           MOVE WS-SIM-REG-TOT              TO WS-SL-QTY ( 3 , 7 ).             
                                                                                
           MOVE F010-NUM-REG-ELDER-SPS      TO WS-SL-QTY ( 4 , 1 ).             
           MOVE F010-NUM-REG-ELDER-NONSPS   TO WS-SL-QTY ( 4 , 2 ).             
           MOVE F010-NUM-REG-ELDER          TO WS-SL-QTY ( 4 , 3 ).             
      **   MOVE F712-NUM-REG-NH             TO WS-SL-QTY ( 4 , 4 ).             
           COMPUTE WS-NUM-REG-NH   = F712-NUM-REG-NH -                          
                                     F712-NUM-REG-FTS.                          
           MOVE WS-NUM-REG-NH               TO WS-SL-QTY ( 4 , 4 ).             
           MOVE F712-NUM-REG-UG             TO WS-SL-QTY ( 4 , 5 ).             
           MOVE F712-NUM-REG-FTS            TO WS-SL-QTY ( 4 , 6 ).             
           MOVE WS-ACT-REG-TOT              TO WS-SL-QTY ( 4 , 7 ).             
                                                                                
           MOVE WS-APPZ-ELD-SPS             TO WS-SL-QTY ( 5 , 1 ).             
           MOVE WS-APPZ-ELD-NSPS            TO WS-SL-QTY ( 5 , 2 ).             
           MOVE WS-APPZ-ELD-TOT             TO WS-SL-QTY ( 5 , 3 ).             
           MOVE WS-APPZ-NELD-NH             TO WS-SL-QTY ( 5 , 4 ).             
           MOVE WS-APPZ-NELD-UG             TO WS-SL-QTY ( 5 , 5 ).             
           MOVE WS-APPZ-NELD-FTS            TO WS-SL-QTY ( 5 , 6 ).             
           MOVE WS-APPZ-NELD-TOT            TO WS-SL-QTY ( 5 , 7 ).             
                                                                                
           COMPUTE WS-SUCC-ELD-SPS  = F010-NUM-REG-ELDER-SPS +                  
                                      WS-APPZ-ELD-SPS.                          
           COMPUTE WS-SUCC-ELD-NSPS = F010-NUM-REG-ELDER-NONSPS +               
                                      WS-APPZ-ELD-NSPS.                         
           COMPUTE WS-SUCC-ELD-TOT  = F010-NUM-REG-ELDER +                      
                                      WS-APPZ-ELD-TOT.                          
      **   COMPUTE WS-SUCC-NELD-NH  = F712-NUM-REG-NH +                         
      **                              WS-APPZ-NELD-NH.                          
           COMPUTE WS-SUCC-NELD-NH  = (F712-NUM-REG-NH -                        
                                       F712-NUM-REG-FTS) +                      
                                      WS-APPZ-NELD-NH.                          
           COMPUTE WS-SUCC-NELD-UG  = F712-NUM-REG-UG +                         
                                      WS-APPZ-NELD-UG.                          
           COMPUTE WS-SUCC-NELD-FTS = F712-NUM-REG-FTS +                        
                                      WS-APPZ-NELD-FTS.                         
           COMPUTE WS-SUCC-NELD-TOT = WS-ACT-REG-TOT +                          
                                      WS-APPZ-NELD-TOT.                         
                                                                                
           MOVE WS-SUCC-ELD-SPS             TO WS-SL-QTY ( 6 , 1 ).             
           MOVE WS-SUCC-ELD-NSPS            TO WS-SL-QTY ( 6 , 2 ).             
           MOVE WS-SUCC-ELD-TOT             TO WS-SL-QTY ( 6 , 3 ).             
           MOVE WS-SUCC-NELD-NH             TO WS-SL-QTY ( 6 , 4 ).             
           MOVE WS-SUCC-NELD-UG             TO WS-SL-QTY ( 6 , 5 ).             
           MOVE WS-SUCC-NELD-FTS            TO WS-SL-QTY ( 6 , 6 ).             
           MOVE WS-SUCC-NELD-TOT            TO WS-SL-QTY ( 6 , 7 ).             
                                                                                
           COMPUTE WS-UNSUCC-ELD-SPS  = K010-NUM-APP-ELDER-SPS -                
                                        WS-SUCC-ELD-SPS.                        
           COMPUTE WS-UNSUCC-ELD-NSPS = K010-NUM-APP-ELDER-NONSPS -             
                                        WS-SUCC-ELD-NSPS.                       
           COMPUTE WS-UNSUCC-ELD-TOT  = K010-NUM-APP-ELDER -                    
                                        WS-SUCC-ELD-TOT.                        
      **   COMPUTE WS-UNSUCC-NELD-NH  = WS-SIM-REQ-NH -                         
      **                                WS-SUCC-NELD-NH.                        
           COMPUTE WS-UNSUCC-NELD-NH  = K712-NUM-REQ-NH -                       
                                        WS-SUCC-NELD-NH.                        
           COMPUTE WS-UNSUCC-NELD-UG  = K712-NUM-REQ-UG -                       
                                        WS-SUCC-NELD-UG.                        
           COMPUTE WS-UNSUCC-NELD-FTS = K712-NUM-REQ-FTS -                      
                                        WS-SUCC-NELD-FTS.                       
           COMPUTE WS-UNSUCC-NELD-TOT = WS-SIM-REQ-TOT -                        
                                        WS-SUCC-NELD-TOT.                       
                                                                                
           MOVE WS-UNSUCC-ELD-SPS           TO WS-SL-QTY ( 7 , 1 ).             
           MOVE WS-UNSUCC-ELD-NSPS          TO WS-SL-QTY ( 7 , 2 ).             
           MOVE WS-UNSUCC-ELD-TOT           TO WS-SL-QTY ( 7 , 3 ).             
           MOVE WS-UNSUCC-NELD-NH           TO WS-SL-QTY ( 7 , 4 ).             
           MOVE WS-UNSUCC-NELD-UG           TO WS-SL-QTY ( 7 , 5 ).             
           MOVE WS-UNSUCC-NELD-FTS          TO WS-SL-QTY ( 7 , 6 ).             
           MOVE WS-UNSUCC-NELD-TOT          TO WS-SL-QTY ( 7 , 7 ).             
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *********************                                                     
       7500-READ-BP13K813.                                                      
      *********************                                                     
                                                                                
           MOVE SPACES                      TO K813-KEY-FLD.                    
           INITIALIZE                          K813-KEY-FLD.                    
                                                                                
           MOVE WS-PREV-NT                  TO K813-NUM-ZONE.                   
           MOVE WS-PREV-FT                  TO K813-NUM-FLAT-TYPE.              
           MOVE WS-PREV-DTE-BAL             TO K813-DTE-BALLOT.                 
                                                                                
           READ BP13K813.                                                       
                                                                                
           EVALUATE WS-K813-STATUS                                              
           WHEN 00                                                              
                STRING K813-CDE-NT '/' K813-NUM-FLAT-TYPE '/'                   
                       K813-NUM-ZONE                                            
                       DELIMITED BY SIZE INTO WS-EST-FT                         
                                                                                
                MOVE FUNCTION UPPER-CASE(K813-NME-EST)                          
                                          TO FW3I-NME-NEW-TOWN                  
                MOVE FUNCTION UPPER-CASE(K813-NME-PROJECT-LTR)                  
                                          TO  FW3I-NME-LOCAL-PRCNCT             
                                                                                
                IF K813-NUM-GEN3-TAG = 'Y'                                      
                   MOVE K813-NUM-GEN3-TAG    TO  FW3I-NUM-GEN3-TAG              
                ELSE                                                            
                   MOVE 'N'                  TO  FW3I-NUM-GEN3-TAG              
                END-IF                                                          
                                                                                
           WHEN 23                                                              
                DISPLAY 'RECORD NOT FOUND IN BP13K813 : ' K813-KEY-FLD          
                                                                                
           WHEN OTHER                                                           
                DISPLAY 'ERROR READING BP13K813, STATUS ' WS-K813-STATUS        
                MOVE WS-K813-STATUS         TO RETURN-CODE                      
                PERFORM 9000-CLOSE-FILES    THRU 9000-EXIT                      
           END-EVALUATE.                                                        
                                                                                
       7500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      **********************                                                    
       8000-WRITE-BP13LB65.                                                     
      **********************                                                    
                                                                                
           IF WS-LB65-HDR = 'N'                                                 
              MOVE 'Y'                      TO WS-LB65-HDR                      
              ADD 1                         TO WS-CNT-PAGE                      
              MOVE WS-CNT-PAGE              TO LB65-CNT-PAGE                    
              WRITE BP13LB65-REC            FROM LB65-HEAD-1 AFTER PAGE         
              WRITE BP13LB65-REC            FROM LB65-HEAD-2                    
           END-IF.                                                              
                                                                                
           WRITE BP13LB65-REC               FROM LB65-BLANK.                    
           WRITE BP13LB65-REC               FROM LB65-BLANK.                    
                                                                                
           MOVE WS-PREV-SMODE               TO LB65-SALES-MODE                  
                                               FW3I-SALES-MODE.                 
           MOVE WS-PREV-DTE-BAL             TO LB65-DTE-BAL                     
                                               FW3I-DTE-BALLOT.                 
           WRITE BP13LB65-REC               FROM LB65-HEAD-3.                   
                                                                                
           MOVE WS-EST-FT                   TO LB65-EST-FT.                     
           MOVE WS-EST-FT(1:3)              TO FW3I-NUM-NT.                     
           MOVE WS-EST-FT(5:2)              TO FW3I-NUM-FLAT-TYPE.              
           MOVE WS-EST-FT(8:3)              TO FW3I-NUM-BTO-ZONE.               
           WRITE BP13LB65-REC               FROM LB65-HEAD-4.                   
                                                                                
           WRITE BP13LB65-REC               FROM LB65-BLANK.                    
           WRITE BP13LB65-REC               FROM LB65A-TITLE.                   
           WRITE BP13LB65-REC               FROM LB65A-LINE-1.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'TOTAL FLAT SUPPLY'         TO LB65A-DESC.                      
           MOVE WS-FLAT-SUPPLY              TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-TOT.               
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'FLATS TAKEN UP BY PRIORITY SCHEMES'                            
                                            TO LB65A-DESC.                      
           MOVE WS-PRIO-SHORTLIST           TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-PRIO.              
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'REMAINING FLAT SUPPLY AFTER PRIORITY'                          
                                            TO LB65A-DESC.                      
           MOVE WS-FLAT-SUPPLY-NOPRIO       TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-PRIO-BAL.          
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'FLAT TAKEN UP BY HARDLUCK APPLICATIONS'                        
                                            TO LB65A-DESC.                      
           MOVE WS-HARDLUCK-TOT             TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-HLUCK.             
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'REMAINING FLAT SUPPLY AFTER HARDLUCK'                          
                                            TO LB65A-DESC.                      
           MOVE WS-AF-HARDLUCK-TOT          TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-HLUCK-BAL.         
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'FLATS TAKEN UP BY FIRST-TIMERS(APPN RATE 1 OR <)'              
                                            TO LB65A-DESC.                      
           MOVE WS-1ST-TIMER-TOT            TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-1T.                
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65A-DESC.                      
           MOVE 'REMAINING FLAT SUPPLY AFTER FIRST-TIMERS'                      
                                            TO LB65A-DESC.                      
           MOVE WS-AF-1ST-TIMER-TOT         TO LB65A-UNIT                       
                                               FW3I-NUM-S-FT-1T-BAL.            
           WRITE BP13LB65-REC               FROM LB65A-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65A-LINE-2.                  
                                                                                
           WRITE BP13LB65-REC               FROM LB65-BLANK.                    
           WRITE BP13LB65-REC               FROM LB65C-TITLE.                   
           WRITE BP13LB65-REC               FROM LB65C-LINE-1.                  
           WRITE BP13LB65-REC               FROM LB65C-HEAD-1.                  
           WRITE BP13LB65-REC               FROM LB65C-LINE-2.                  
           WRITE BP13LB65-REC               FROM LB65C-HEAD-2.                  
           WRITE BP13LB65-REC               FROM LB65C-LINE-3.                  
                                                                                
           PERFORM 8500-PRINT-SHORTLIST     THRU 8500-EXIT                      
           VARYING WS-CNT FROM 1 BY 1                                           
             UNTIL WS-CNT > 7.                                                  
           WRITE BP13LB65-REC               FROM LB65C-LINE-1.                  
                                                                                
           WRITE BP13LB65-REC               FROM LB65-BLANK.                    
           WRITE BP13LB65-REC               FROM LB65D-TITLE.                   
           WRITE BP13LB65-REC               FROM LB65D-LINE-1.                  
           WRITE BP13LB65-REC               FROM LB65D-HEAD.                    
           WRITE BP13LB65-REC               FROM LB65D-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65D-DESC.                      
           MOVE 'ETHNIC QUOTA AVAILABLE'    TO LB65D-DESC.                      
           MOVE WS-K030-CAT1                TO LB65D-CAT1                       
                                               FW3I-NUM-S-EQA-C1.               
           MOVE WS-K030-CAT2                TO LB65D-CAT2                       
                                               FW3I-NUM-S-EQA-C2.               
           MOVE WS-K030-CAT3                TO LB65D-CAT3                       
                                               FW3I-NUM-S-EQA-C3.               
           MOVE WS-K030-TOTAL               TO LB65D-TOT                        
                                               FW3I-NUM-S-EQA-TOT.              
           WRITE BP13LB65-REC               FROM LB65D-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65D-LINE-2.                  
                                                                                
           MOVE SPACES                      TO LB65D-DESC.                      
           MOVE 'ETHNIC QUOTA TAKEN UP'     TO LB65D-DESC.                      
           MOVE WS-F740-CAT1                TO LB65D-CAT1                       
                                               FW3I-NUM-S-EQT-C1.               
           MOVE WS-F740-CAT2                TO LB65D-CAT2                       
                                               FW3I-NUM-S-EQT-C2.               
           MOVE WS-F740-CAT3                TO LB65D-CAT3                       
                                               FW3I-NUM-S-EQT-C3.               
           COMPUTE WS-F740-TOTAL = WS-F740-CAT1 + WS-F740-CAT2 +                
                                   WS-F740-CAT3.                                
           MOVE WS-F740-TOTAL               TO LB65D-TOT                        
                                               FW3I-NUM-S-EQT-TOT.              
           WRITE BP13LB65-REC               FROM LB65D-DETAIL.                  
           WRITE BP13LB65-REC               FROM LB65D-LINE-1.                  
                                                                                
       8000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***********************                                                   
       8500-PRINT-SHORTLIST.                                                    
      ***********************                                                   
                                                                                
           MOVE SPACES                      TO LB65C-DESC.                      
           EVALUATE WS-CNT                                                      
           WHEN 1                                                               
                MOVE 'DEMAND'               TO LB65C-DESC                       
           WHEN 2                                                               
                MOVE 'FLAT SUPPLY (SIMULATION)'                                 
                                            TO LB65C-DESC                       
           WHEN 3                                                               
                MOVE 'APPLICATIONS SHORTLISTED (SIMULATION)'                    
                                            TO LB65C-DESC                       
           WHEN 4                                                               
                MOVE 'APPLICATIONS SHORTLISTED (ACTUAL)'                        
                                            TO LB65C-DESC                       
           WHEN 5                                                               
                MOVE 'APPLICATIONS SHORTLISTED (BYPASS EIP)'                    
                                            TO LB65C-DESC                       
           WHEN 6                                                               
                MOVE 'TOTAL APPLICATIONS SHORTLISTED'                           
                                            TO LB65C-DESC                       
           WHEN 7                                                               
                MOVE 'TOTAL UNSUCCESSFUL APPLICATIONS'                          
                                            TO LB65C-DESC                       
           END-EVALUATE.                                                        
                                                                                
           IF WS-CNT  NOT =  2 AND 3                                            
              PERFORM 8510-SETUP-SHORTLIST     THRU 8510-EXIT                   
              VARYING WS-XCNT FROM 1 BY 1                                       
                UNTIL WS-XCNT > 7                                               
                                                                                
              WRITE BP13LB65-REC               FROM LB65C-DETAIL                
                                                                                
              IF WS-CNT < 7                                                     
                 WRITE BP13LB65-REC            FROM LB65C-LINE-4                
              END-IF                                                            
           END-IF.                                                              
                                                                                
       8500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ***********************                                                   
       8510-SETUP-SHORTLIST.                                                    
      ***********************                                                   
                                                                                
           MOVE WS-SL-QTY ( WS-CNT , WS-XCNT )                                  
             TO LB65C-QTY ( WS-XCNT ).                                          
                                                                                
           IF WS-CNT = 1                                                        
              EVALUATE WS-XCNT                                                  
                 WHEN 1                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-AP-SPS                 
                 WHEN 2                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-AP-NSPS                
                 WHEN 4                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-AP-FT                  
                 WHEN 5                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-AP-2T                  
                 WHEN 6                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-AP-FTS                 
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
           IF WS-CNT = 4                                                        
              EVALUATE WS-XCNT                                                  
                 WHEN 1                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APS-SPS                
                 WHEN 2                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APS-NSPS               
                 WHEN 4                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APS-FT                 
                 WHEN 5                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APS-2T                 
                 WHEN 6                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APS-FTS                
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
           IF WS-CNT = 5                                                        
              EVALUATE WS-XCNT                                                  
                 WHEN 1                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APSE-SPS               
                 WHEN 2                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APSE-NSPS              
                 WHEN 4                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APSE-FT                
                 WHEN 5                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APSE-2T                
                 WHEN 6                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APSE-FTS               
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
           IF WS-CNT = 7                                                        
              EVALUATE WS-XCNT                                                  
                 WHEN 1                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APU-SPS                
                 WHEN 2                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APU-NSPS               
                 WHEN 4                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APU-FT                 
                 WHEN 5                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APU-2T                 
                 WHEN 6                                                         
                    MOVE  WS-SL-QTY ( WS-CNT , WS-XCNT ) TO                     
                                              FW3I-NUM-S-APU-FTS                
              END-EVALUATE                                                      
           END-IF.                                                              
                                                                                
       8510-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *******************                                                       
       8700-WRITE-BP13FW3I.                                                     
      *******************                                                       
                                                                                
           PERFORM 8900-INITIALIZE-DELIMITER    THRU 8900-EXIT.                 
                                                                                
           MOVE WS-PARM-NUM-CDE       TO FW3I-NUM-PERCENT.                      
           WRITE BP13FW3I-REC.                                                  
           ADD 1 TO WS-FW3I-WRITE.                                              
           MOVE SPACES                TO BP13FW3I-REC.                          
           INITIALIZE                    BP13FW3I-REC.                          
                                                                                
       8700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      ******************                                                        
       8900-INITIALIZE-DELIMITER.                                               
      ******************                                                        
                                                                                
           MOVE ';'   TO  FIL001  FIL002  FIL003  FIL004  FIL005                
                          FIL006  FIL007  FIL008  FIL009  FIL010                
                          FIL09A                                                
                          FIL011  FIL012  FIL013  FIL014  FIL015                
                          FIL016  FIL017  FIL018  FIL019  FIL020                
                          FIL021  FIL022  FIL023  FIL024  FIL025                
                          FIL026  FIL027  FIL028  FIL029  FIL030                
                          FIL031  FIL032  FIL033  FIL034  FIL035                
                          FIL036  FIL037  FIL038  FIL039  FIL040                
                          FIL40A  FIL43A                                        
                          FIL041  FIL042  FIL043  FIL044  FIL045                
                          FIL046  FIL047  FIL048  FIL049  FIL050                
                          FIL051  FIL052  FIL053                                
                          FIL700  FIL701  FIL702  FIL703  FIL704                
                          FIL705  FIL706  FIL707  FIL708  FIL709                
                          FIL710  FIL711  FIL712  FIL713  FIL714                
                          FIL715  FIL716  FIL717  FIL718  FIL719                
                          FIL720  FIL721  FIL722  FIL723  FIL724                
                          FIL725  FIL726  FIL727  FIL728  FIL729                
                          FIL730  FIL731  FIL732  FIL733  FIL734                
                          FIL735  FIL736  FIL737  FIL738  FIL739                
                          FIL740  FIL741  FIL742  FIL743  FIL744                
                          FIL745  FIL746  FIL747  FIL748  FIL749                
                          FIL750  FIL751  FIL752  FIL753  FIL754                
                          FIL755  FIL756  FIL757  FIL758  FIL759                
                          FIL760  FIL761  FIL762  FIL763  FIL764                
                          FIL765  FIL766  FIL767  FIL768  FIL769                
                          FIL770  FIL771  FIL772  FIL773  FIL774                
                          FIL775  FIL776  FIL777  FIL778  FIL779                
                          FIL780  FIL781  FIL782  FIL783  FIL784                
                          FIL785  FIL786  FIL787  FIL788  FIL789                
                          FIL790  FIL791  FIL792  FIL793                        
                          FIL054  FIL055  FIL56A                                
                          FIL056  FIL057  FIL058  FIL059  FIL060                
                          FIL061  FIL062  FIL063  FIL064  FIL065                
                          FIL066  FIL067  FIL068  FIL069  FIL070                
                          FIL071  FIL072  FIL073  FIL074  FIL075                
                          FIL076  FIL077  FIL078  FIL079  FIL080                
                          FIL081  FIL082  FIL083  FIL084  FIL085                
                          FIL086  FIL087  FIL088  FIL089  FIL090                
                          FIL091  FIL092  FIL093  FIL094  FIL095                
                          FIL096  FIL097  FIL098  FIL099  FIL100                
                          FIL101  FIL102  FIL103  FIL104  FIL105                
                          FIL106  FIL107  FIL108  FIL109  FIL110                
                          FIL111  FIL112  FIL113  FIL114  FIL115                
                          FIL116  FIL117  FIL118  FIL119  FIL120                
                          FIL121  FIL122  FIL123  FIL124  FIL125                
                          FIL126  FIL127  FIL128  FIL129  FIL130                
                          FIL131  FIL132  FIL133  FIL134  FIL135                
                          FIL136  FIL137  FIL138  FIL139  FIL140                
                          FIL141  FIL142  FIL143  FIL144  FIL145                
                          FIL146  FIL147  FIL148  FIL149  FIL150                
                          FIL151  FIL152  FIL153  FIL154  FIL155                
                          FIL156  FIL157  FIL158  FIL159  FIL160                
                          FIL161  FIL162  FIL163  FIL164  FIL165                
                          FIL166  FIL167  FIL168  FIL169  FIL170                
                          FIL171  FIL162  FIL173  FIL174  FIL175                
                          FIL176  FIL177  FIL178  FIL179  FIL180                
                          FIL181  FIL182  FIL183  FIL184  FIL185                
                          FIL166  FIL167  FIL168  FIL169  FIL170                
                          FIL171  FIL172  FIL173  FIL174  FIL175                
                          FIL176  FIL177  FIL178  FIL179  FIL180                
                          FIL181  FIL182  FIL183  FIL184  FIL185                
                          FIL186  FIL187  FIL188  FIL189  FIL190                
                          FIL191  FIL192  FIL193  FIL194  FIL195                
                          FIL196  FIL197  FIL198  FIL199  FIL200                
                          FIL201  FIL202  FIL203  FIL204  FIL205                
                          FIL206  FIL207  FIL208  FIL209  FIL210                
                          FIL211  FIL212  FIL213  FIL214  FIL215                
                          FIL216  FIL217  FIL218  FIL219  FIL220                
                          FIL221  FIL222  FIL223  FIL224  FIL225                
                          FIL226  FIL227  FIL228  FIL229  FIL230                
                          FIL231  FIL232  FIL233  FIL234  FIL235                
                          FIL236  FIL237  FIL238  FIL239  FIL240                
                          FIL241  FIL242  FIL243  FIL244  FIL245                
                          FIL246  FIL247  FIL248  FIL249  FIL250                
                          FIL251  FIL252  FIL253  FIL254  FIL255                
                          FIL256  FIL257  FIL258  FIL259  FIL260                
                          FIL261  FIL262  FIL263  FIL264  FIL265                
                          FIL266  FIL267  FIL268  FIL269  FIL270                
                          FIL271  FIL272  FIL273  FIL274  FIL275                
                          FIL276  FIL277  FIL278  FIL279  FIL280                
                          FIL281  FIL282  FIL283  FIL284  FIL285                
                          FIL286  FIL287  FIL288  FIL289  FIL290                
                          FIL291  FIL292  FIL293  FIL294  FIL295                
                          FIL296  FIL297  FIL298  FIL299  FIL300                
                          FIL301  FIL302  FIL303  FIL304  FIL305                
                          FIL306  FIL307  FIL308  FIL309  FIL310                
                                  FIL312  FIL313  FIL314  FIL315                
                          FIL316  FIL317  FIL318  FIL319  FIL320                
                          FIL321  FIL322  FIL323  FIL324  FIL325                
                          FIL326  FIL327  FIL328  FIL329  FIL330                
                          FIL331  FIL332  FIL333  FIL334  FIL335                
                          FIL336  FIL337  FIL338  FIL339  FIL340                
                          FIL341  FIL342  FIL343  FIL344  FIL345                
                          FIL346  FIL347  FIL348  FIL349  FIL350                
                          FIL351  FIL352  FIL353  FIL354  FIL355                
                          FIL356  FIL357  FIL358  FIL359  FIL360                
                          FIL361  FIL362  FIL363  FIL364  FIL365                
                          FIL366  FIL367  FIL368  FIL369  FIL370                
                          FIL371  FIL372  FIL373  FIL374  FIL375                
                          FIL376  FIL377  FIL378  FIL379  FIL380                
                          FIL381  FIL382  FIL383  FIL384  FIL385                
                          FIL386  FIL387  FIL388  FIL389  FIL390                
                          FIL391  FIL392  FIL393  FIL394  FIL395                
                          FIL396  FIL397  FIL398  FIL399  FIL400                
                          FIL401  FIL402  FIL403  FIL404  FIL405                
                          FIL406  FIL407  FIL408  FIL409  FIL410                
                          FIL411  FIL412  FIL413  FIL414  FIL415                
                          FIL416  FIL417  FIL418  FIL419  FIL420                
                          FIL421  FIL422  FIL423  FIL424  FIL425                
                          FIL426  FIL427  FIL428  FIL429  FIL430                
                          FIL431  FIL432  FIL433  FIL434  FIL435                
                          FIL436  FIL437  FIL438  FIL439  FIL440                
                          FIL441  FIL442  FIL443  FIL444  FIL445                
                          FIL446  FIL447  FIL448  FIL449  FIL450                
                          FIL451  FIL452  FIL453  FIL454  FIL455                
                          FIL456  FIL457  FIL458  FIL459  FIL460                
                          FIL461  FIL462  FIL463  FIL464  FIL465                
                          FIL466  FIL467  FIL468  FIL469  FIL470                
                          FIL471  FIL472  FIL473  FIL474  FIL475                
                          FIL476  FIL477  FIL478  FIL479  FIL480                
                          FIL481  FIL482  FIL483  FIL484  FIL485                
                          FIL486  FIL487  FIL488  FIL489  FIL490                
                          FIL491  FIL492  FIL493  FIL494  FIL495                
                          FIL496  FIL497  FIL498  FIL499  FIL500                
                          FIL501  FIL502  FIL503  FIL504  FIL505                
                          FIL506  FIL507  FIL508  FIL509  FIL510                
                          FIL511  FIL512  FIL513  FIL514  FIL515                
                          FIL516  FIL517  FIL518  FIL519  FIL520                
                          FIL521  FIL522  FIL523  FIL524  FIL525                
                          FIL526  FIL527  FIL528  FIL529  FIL530                
                          FIL531  FIL532  FIL533  FIL534  FIL535                
                          FIL536  FIL537  FIL538  FIL539  FIL540                
                          FIL541  FIL542  FIL543  FIL544  FIL545                
                          FIL546  FIL547  FIL548  FIL549  FIL550                
                          FIL551  FIL552  FIL553  FIL554  FIL555                
                          FIL556  FIL557  FIL558  FIL559  FIL560                
                          FIL561  FIL562  FIL563  FIL564  FIL565                
                          FIL566  FIL567  FIL568  FIL569  FIL570                
                          FIL571  FIL572  FIL573  FIL574  FIL575                
                          FIL576  FIL577  FIL578  FIL579  FIL580                
                          FIL581  FIL582  FIL583  FIL584  FIL585                
                          FIL586.                                               
                                                                                
       8900-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *******************                                                       
       9000-CLOSE-FILES.                                                        
      *******************                                                       
                                                                                
           DISPLAY '***  TOTAL NUMBER OF RECORDS PROCESSED = '                  
           WS-F740-READ.                                                        
           DISPLAY '***  TOTAL RECORDS WRITTEN IN BP13FW3I = '                  
           WS-FW3I-WRITE.                                                       
                                                                                
           CLOSE BP13F740                                                       
                 BP13F730                                                       
                 P13F730A                                                       
                 BP13K010                                                       
                 BP13K01A                                                       
                 BP13K030                                                       
                 BP13K712                                                       
                 BP13K71A                                                       
                 BP13LB65                                                       
                 BP13FW3I.                                                      
                                                                                
           IF WS-K010-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR CLOSING BP13K010, STATUS ' WS-K010-STATUS          
              MOVE WS-K010-STATUS           TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K01A-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR CLOSING BP13K01A, STATUS ' WS-K01A-STATUS          
              MOVE WS-K01A-STATUS           TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K030-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR CLOSING BP13K030, STATUS ' WS-K030-STATUS          
              MOVE WS-K030-STATUS           TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K712-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR CLOSING BP13K712, STATUS ' WS-K712-STATUS          
              MOVE WS-K712-STATUS           TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           IF WS-K71A-STATUS NOT = ZEROES AND 97                                
              DISPLAY 'ERROR CLOSING BP13K71A, STATUS ' WS-K71A-STATUS          
              MOVE WS-K71A-STATUS           TO RETURN-CODE                      
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       9000-EXIT.                                                               
           EXIT.                                                                
                                                                                
