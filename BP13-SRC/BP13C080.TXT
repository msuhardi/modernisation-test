       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    BP13C080.                                                 
      *AUTHOR.        SHARON DUMDUM.                                            
      *DATE-WRITTEN.  05 APRIL 2005.                                            
      * ========================================================== *            
      * SYSTEM OF COMMITMENT  (BP13)                               *            
      * ========================================================== *            
      *                                                            *            
      *  OBJECTIVE   : 1.  PRINT BTO LETTER.                       *            
      *                                                            *            
      *  INPUT FILES : 1.  BP13F730  -  SOC REQ FILE               *            
      *                2.  BP13K825  -  OCCUPIER FILE              *            
      *                3.  BP13K830  -  ADDRESS FILE               *            
      *                4.  BP13K022  -  OIC FILE                   *            
      *                5.  BP13K024  -  OIC MASTER FILE            *            
      *                6.  BP13K060  -  CODE TRANSCRIPTION         *            
      *                                                            *            
      *  LISTINGS    : 1.  P13L080A  -  CONTROL LISTING            *            
      *                    P13L080B  -  BTO LETTER - FORM BP13AD   *            
      *                    P13L080C  -  BTO LETTER - FORM BP13AE   *            
      *  output FILE : 1.  BP13K730  -  SOC REQ FILE               *            
      *                                                            *            
      * ---------------------------------------------------------- *            
      * CHG REF  BY    DATE    DESCRIPTION                         *            
      * -------- ---  ------   -----------                         *            
      * BP132674 SSD  20050405 NEW PROGRAM.                        *            
      * BP134681 IMC1 20120924 CATER TO '91' K060-SERIAL-NO        *            
      * BP135944 SMR2 20150915 REMOVE REFERENCE TO CDE-NT6/7/8     *            
      * ========================================================== *            
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
                                                                                
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *-------------------------------------------------------------            
           SELECT BP13F730  ASSIGN       TO BP13F730.                           
                                                                                
           SELECT BP13K730  ASSIGN        TO BP13K730                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K730-KEY-NEW                       
                            FILE STATUS   IS WS-K730-STATUS.                    
                                                                                
           SELECT BP13K703  ASSIGN        TO BP13K703                           
                            ACCESS MODE   IS RANDOM                             
                            ORGANIZATION  IS INDEXED                            
                            RECORD KEY    IS K703-KEY-FLD                       
                            FILE STATUS   IS WS-K703-STATUS.                    
                                                                                
           SELECT BP13K825  ASSIGN       TO BP13K825                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K825-KEY-FLD                        
                            FILE STATUS  IS WS-K825-STATUS.                     
                                                                                
           SELECT BP13K830  ASSIGN       TO BP13K830                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K830-KEY-FLD                        
                            ALTERNATE RECORD KEY IS  K830-NUM-REGN              
                            FILE STATUS  IS WS-K830-STATUS.                     
                                                                                
           SELECT BP13K022 ASSIGN TO BP13K022                                   
                           ACCESS MODE   IS DYNAMIC                             
                           ORGANIZATION  IS INDEXED                             
                           RECORD KEY    IS K022-KEY-FLD                        
                           ALTERNATE KEY IS K022-NUM-REGN                       
                           FILE STATUS   IS WS-K022-STATUS.                     
                                                                                
           SELECT BP13K024 ASSIGN TO BP13K024                                   
                           ACCESS MODE   IS DYNAMIC                             
                           ORGANIZATION  IS INDEXED                             
                           RECORD KEY    IS K024-KEY-FLD                        
                           FILE STATUS   IS WS-K024-STATUS.                     
                                                                                
           SELECT BP13K060  ASSIGN       TO BP13K060                            
                            ACCESS MODE  IS RANDOM                              
                            ORGANIZATION IS INDEXED                             
                            RECORD KEY   IS K060-KEY-FLD                        
                            FILE STATUS  IS WS-K060-STATUS.                     
                                                                                
           SELECT P13L080A  ASSIGN       TO P13L080A.                           
           SELECT P13L080B  ASSIGN       TO P13L080B.                           
           SELECT P13L080C  ASSIGN       TO P13L080C.                           
                                                                                
      *-------------------------------------------------------------            
       DATA DIVISION.                                                           
      *-------------------------------------------------------------            
       FILE SECTION.                                                            
                                                                                
       FD   BP13F730                                                            
            RECORDING MODE  IS  F                                               
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13F730.                                                           
                                                                                
       FD   BP13K730                                                            
            RECORD CONTAINS 500 CHARACTERS.                                     
       COPY BP13K730.                                                           
                                                                                
       FD   BP13K703                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K703.                                                           
                                                                                
       FD   BP13K825                                                            
            RECORD CONTAINS 200 CHARACTERS.                                     
       COPY BP13K825.                                                           
                                                                                
       FD   BP13K830                                                            
            RECORD CONTAINS 250 CHARACTERS.                                     
       COPY BP13K830.                                                           
                                                                                
       FD   BP13K022                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K022.                                                           
                                                                                
       FD   BP13K024                                                            
            RECORD CONTAINS 100 CHARACTERS.                                     
       COPY BP13K024.                                                           
                                                                                
       FD   BP13K060                                                            
            RECORD CONTAINS 25 CHARACTERS.                                      
       COPY BP13K060.                                                           
                                                                                
       FD  P13L080A                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 132 CHARACTERS.                                      
       01  L080A-PRT-REC                    PIC X(132).                         
                                                                                
       FD  P13L080B                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 90 CHARACTERS.                                       
       01  L080B-PRT-REC                    PIC X(90).                          
                                                                                
       FD  P13L080C                                                             
           RECORDING MODE  IS  F                                                
           RECORD CONTAINS 90  CHARACTERS.                                      
       01  L080C-PRT-REC                    PIC X(90).                          
                                                                                
      *-------------------------------------------------------------            
       WORKING-STORAGE SECTION.                                                 
      *-------------------------------------------------------------            
       01  WS-STATUS.                                                           
           05  WS-K825-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K730-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K703-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K830-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K022-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K024-STATUS               PIC 99    VALUE ZEROS.              
           05  WS-K060-STATUS               PIC 99    VALUE ZEROS.              
                                                                                
       01  WS-COUNTERS.                                                         
           05  WS-F730-READ-CTR             PIC 9(06)  VALUE ZEROS.             
           05  WS-K730-UPDATE-CTR           PIC 9(6)  VALUE ZEROS.              
           05  WS-L080-WRT-CTR              PIC 9(06)  VALUE ZEROS.             
           05  WS-CNT-LINE-L080             PIC 9(2)   VALUE 60.                
           05  WS-CNT-PAGE-L080             PIC 9(4)   VALUE ZEROES.            
           05  WS-CNT-LETTERS               PIC 9(4)   VALUE ZEROES.            
                                                                                
       01  WS2-DEFAULT.                                                         
           05  WS2-MAX-LINES-L080           PIC 9(2)   VALUE 45.                
                                                                                
       01  WS-VARIABLES.                                                        
           05  WS-F730-EOF                  PIC X(01) VALUE 'N'.                
           05  WS-K703-FOUND                PIC X(01) VALUE 'N'.                
           05  WS-K730-FOUND                PIC X(01) VALUE 'N'.                
           05  WS-BALLOT-SW                 PIC X(02).                          
           05  WS-K825-NME-OCCP             PIC X(66) VALUE SPACES.             
           05  WS-POSTAL-CDE                PIC X(6)   VALUE SPACES.            
                                                                                
       01  WS-DATE-VARIABLES.                                                   
           05  WS-DATE.                                                         
               10  WS-CCYY                  PIC 9(4)  VALUE 0000.               
               10  WS-MM                    PIC 99    VALUE 00.                 
               10  WS-DD                    PIC 99    VALUE 00.                 
           05  WS-SENT-DATE                 PIC 9(08)   VALUE ZEROES.           
           05  WS-SENT-DATE-X REDEFINES WS-SENT-DATE PIC X(08).                 
           05  WS-APPMT-TIME.                                                   
               10  WS-APPMT-HR          PIC 9(2)   VALUE 00.                    
               10  WS-APPMT-MIN         PIC 9(2)   VALUE 00.                    
           05  WS-DTE-BALLOT                PIC X(6)  VALUE SPACES.             
                                                                                
       01  WS-TIME-DATES.                                                       
           05  WS-SYSTEM-DATE.                                                  
               10  WS-SYS-CCYY.                                                 
                   15  WS-SYS-CC              PIC 9(2).                         
                   15  WS-SYS-YY              PIC 9(2).                         
               10  WS-SYS-MM                  PIC 9(2).                         
               10  WS-SYS-DD                  PIC 9(2).                         
           05  WS-EDITED-DATE.                                                  
               10  WS-EDITED-DD               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-MM               PIC 9(2).                         
               10  FILLER                     PIC X(1)  VALUE '/'.              
               10  WS-EDITED-YY               PIC 9(4).                         
           05  WS-CURR-DATE                   PIC 9(8) VALUE ZEROES.            
           05  WS-NUM-OF-DATE                 PIC 9(8) VALUE ZEROES.            
           05  WS-DTE-POST                    PIC 9(8) VALUE ZEROES.            
                                                                                
       01  WS-MONTHS-IN-DIGITS-AND-WORDS.                                       
           05 FILLER                   PIC X(12) VALUE                          
             '01 JANUARY  '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '02 FEBRUARY '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '03 MARCH    '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '04 APRIL    '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '05 MAY      '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '06 JUNE     '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '07 JULY     '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '08 AUGUST   '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '09 SEPTEMBER'.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '10 OCTOBER  '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '11 NOVEMBER '.                                                    
           05 FILLER                   PIC X(12) VALUE                          
             '12 DECEMBER '.                                                    
       01  FILLER  REDEFINES  WS-MONTHS-IN-DIGITS-AND-WORDS.                    
           05 WS-MONTH-TABLE               OCCURS 12                            
                                           INDEXED BY WS-MTH-IND.               
              10 WS-MONTH-IN-DIGITS    PIC X(02).                               
              10 FILLER                PIC X(01).                               
              10 WS-MONTH-IN-WORDS     PIC X(09).                               
                                                                                
       01  WS-WORK-AREA.                                                        
           05 WS-DAY-CNT                    PIC 9(4) VALUE 0.                   
                                                                                
       01  WS-WORK-INDICATORS.                                                  
           05  PUBLIC-HOLIDAY               PIC X VALUE 'N'.                    
           05  SUNDAY                       PIC X VALUE 'N'.                    
                                                                                
       COPY AV02COMM.                                                           
                                                                                
                                                                                
      *===============================                                          
      *   LINKAGE SECTION FOR AV02C015                                          
      *===============================                                          
       01  WS-LINK-AV02C015.                                                    
           05  AV02C015-IN-POSTCODE             PIC X(6).                       
           05  AV02C015-OUT-POSTCODE-CHKSUM     PIC X(9).                       
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR LETTER TO APPLICANT                     *            
      *------------------------------------------------------------*            
       01  L080-LINE-01.                                                        
           05  FILLER                   PIC X(72) VALUE SPACES.                 
           05  L080-REFNO               PIC X(15).                              
                                                                                
       01  L080-LINE-02.                                                        
           05  FILLER                   PIC X(72) VALUE SPACES.                 
           05  P080-DATE                PIC X(13).                              
                                                                                
       01  L080-LINE-03.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-NAME                PIC X(66).                              
                                                                                
       01  L080-LINE-04.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-NAME2               PIC X(66).                              
                                                                                
       01  L080-LINE-05.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-BLK                 PIC X(10).                              
           05  FILLER                   PIC X(01) VALUE SPACES.                 
           05  L080-UNIT                PIC X(11).                              
                                                                                
       01  L080-LINE-06.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-ADDR-L2             PIC X(47).                              
                                                                                
       01  L080-LINE-07.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-ADDR-L3             PIC X(20).                              
                                                                                
       01  L080-LINE-08.                                                        
           05  FILLER                   PIC X(10) VALUE SPACES.                 
           05  L080-BAR-CODE            PIC X(09).                              
                                                                                
       01  L080-LINE-8A.                                                        
           05  FILLER                   PIC X(70) VALUE SPACES.                 
           05  L080-FILE-COPY           PIC X(09) VALUE 'FILE COPY'.            
                                                                                
       01  L080-LINE-8B.                                                        
           05  FILLER                   PIC X(22) VALUE SPACES.                 
           05  L080-MTH-BE              PIC X(09) VALUE SPACES.                 
           05  FILLER                   PIC X(01) VALUE SPACES.                 
           05  L080-YEAR-BE             PIC X(04) VALUE SPACES.                 
                                                                                
       01  L080-LINE-8C.                                                        
           05  FILLER                   PIC X(12) VALUE SPACES.                 
           05  L080-EST                 PIC X(20) VALUE SPACES.                 
           05  FILLER                   PIC X(48) VALUE SPACES.                 
                                                                                
       01  L080-LINE-09.                                                        
           05  FILLER                   PIC X(50) VALUE SPACES.                 
           05  L080-ROOM-BE             PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(12) VALUE SPACES.                 
                                                                                
       01  L080-LINE-10.                                                        
           05  FILLER                   PIC X(48) VALUE SPACES.                 
           05  L080-ROOM-BTO            PIC X(06) VALUE SPACES.                 
           05  FILLER                   PIC X(09) VALUE SPACES.                 
           05  L080-ESTATE              PIC X(25) VALUE SPACES.                 
                                                                                
       01  L080-LINE-12.                                                        
           05  FILLER                   PIC X(74) VALUE SPACES.                 
           05  L080-NUM-DID             PIC X(8)  VALUE SPACES.                 
                                                                                
       01  L080-LINE-13.                                                        
           05  FILLER                   PIC X(20) VALUE SPACES.                 
           05  L080-NUM-HP              PIC X(8)  VALUE SPACES.                 
                                                                                
       01  L080-LINE-14.                                                        
           05  FILLER                   PIC X(10) VALUE SPACES.                 
           05  L080-NME-OIC             PIC X(30) VALUE SPACES.                 
                                                                                
      *------------------------------------------------------------*            
      *        LAY-OUT FOR CONTROL LISTING                         *            
      *------------------------------------------------------------*            
       01  L080-HDG1.                                                           
           05  FILLER                   PIC X(14) VALUE 'P13L080A'.             
           05  FILLER                   PIC X(8)  VALUE 'HDB3'.                 
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(39) VALUE                         
               'S Y S T E M   O F   C O M M I T M E N T'.                       
           05  FILLER                   PIC X(18) VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'DATE: '.               
           05  L080-DATE                PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE ' PAGE: '.              
           05  L080-PAGE                PIC ZZZZ9.                              
                                                                                
       01  L080-HDG2.                                                           
           05  FILLER                   PIC X(35) VALUE SPACES.                 
           05  FILLER                   PIC X(45) VALUE                         
              'CONTROL LIST FOR SALE OF FLATS UNDER DEC 2004'.                  
           05  FILLER                   PIC X(13) VALUE                         
               ' BTO EXERCISE'.                                                 
                                                                                
       01  L080-HDG3.                                                           
           05  FILLER                   PIC X(7)  VALUE ' S/N   '.              
           05  FILLER                   PIC X(9)  VALUE 'REF-NO   '.            
           05  FILLER                   PIC X(15) VALUE                         
               'APPLICANT NAMES'.                                               
           05  FILLER                   PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE '  UIN  '.              
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE 'CAT  '.                
           05  FILLER                   PIC X(5)  VALUE 'ALLOC'.                
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'FLAT'.                 
           05  FILLER                   PIC X(5)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'PORT   '.              
           05  FILLER                   PIC X(2)  VALUE 'JB'.                   
           05  FILLER                   PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'JB     '.              
           05  FILLER                   PIC X(6)  VALUE 'SUCC'.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE 'NT1   '.               
           05  FILLER                   PIC X(4)  VALUE 'HHTY'.                 
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE 'EL-SCH  '.             
           05  FILLER                   PIC X(2)  VALUE 'ZE'.                   
                                                                                
       01  L080-HDG4.                                                           
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE 'REGN-NO'.              
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'SCH'.                  
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'JB NRIC'.              
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'TAG '.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(8)  VALUE 'REGN-NO'.              
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(5)  VALUE 'COUNT'.                
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(7)  VALUE 'NT/ZONE'.              
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'NT5'.                  
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'NT6'.                  
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE 'NT7'.                  
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE 'NT8'.                  
           05  FILLER                   PIC X(6)  VALUE 'SERIAL'.               
                                                                                
       01  L080C-DTL-1.                                                         
           05  L080C-SERIAL-NO          PIC ZZZ9.                               
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-REF-NO             PIC X(6)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-NAME-1             PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-NRIC-1             PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-CAT                PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-ALLOC              PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L080C-FLAT               PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L080C-PORT-TAG           PIC X(1)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  L080C-JB-REGN            PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  L080C-JB-CNT             PIC X(2)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  L080C-SUCC               PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(6)  VALUE SPACES.                 
           05  L080C-NT1                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-HHTY               PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-ELIG-SCH           PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(4)  VALUE SPACES.                 
           05  L080C-ZONE               PIC X(2)  VALUE SPACES.                 
                                                                                
       01  L080C-DTL-2.                                                         
           05  FILLER                   PIC X(7)  VALUE SPACES.                 
           05  L080C-REGN-NO            PIC X(8)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-NAME-2             PIC X(22) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-NRIC-2             PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(11) VALUE SPACES.                 
           05  L080C-JB-NRIC            PIC X(9)  VALUE SPACES.                 
           05  FILLER                   PIC X(40) VALUE SPACES.                 
           05  L080C-NT5                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-NT6                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(2)  VALUE SPACES.                 
           05  L080C-NT7                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-NT8                PIC X(3)  VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-SERIAL             PIC X(5)  VALUE SPACES.                 
                                                                                
       01  L080C-DTL-3.                                                         
           05  FILLER                   PIC X(16) VALUE SPACES.                 
           05  L080C-BLK                PIC X(10) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-UNIT               PIC X(11) VALUE SPACES.                 
           05  FILLER                   PIC X(1)  VALUE SPACES.                 
           05  L080C-ADDR2              PIC X(65) VALUE SPACES.                 
           05  FILLER                   PIC X(3)  VALUE SPACES.                 
           05  L080C-ADDR3              PIC X(20) VALUE SPACES.                 
                                                                                
                                                                                
      *-------------------------------------------------------------            
       PROCEDURE DIVISION.                                                      
      *-------------------------------------------------------------            
       0000-MAIN-ROUTINE.                                                       
      *-------------------------------------------------------------            
                                                                                
           PERFORM 1000-OPEN-ROUTINE        THRU 1000-EXIT.                     
           PERFORM 3500-READ-BP13F730       THRU 3500-EXIT.                     
           PERFORM 2500-READ-BP13K703       THRU 2500-EXIT.                     
                                                                                
           IF WS-K703-FOUND = 'Y'                                               
              PERFORM 3000-PROCESS-RECORDS  THRU 3000-EXIT                      
                      UNTIL WS-F730-EOF = 'Y'                                   
           END-IF.                                                              
                                                                                
           PERFORM 9000-CLOSE-ROUTINE       THRU 9000-EXIT.                     
                                                                                
       0000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       1000-OPEN-ROUTINE.                                                       
      *-------------------------------------------------------------            
           OPEN INPUT BP13F730                                                  
                      BP13K703                                                  
                      BP13K825                                                  
                      BP13K830                                                  
                      BP13K022                                                  
                      BP13K024                                                  
                      BP13K060                                                  
               I-O    BP13K730                                                  
               OUTPUT P13L080A                                                  
                      P13L080B                                                  
                      P13L080C.                                                 
                                                                                
           IF WS-K825-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K825 STATUS IS ' WS-K825-STATUS            
              MOVE     WS-K825-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K730-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K730 STATUS IS ' WS-K730-STATUS            
              MOVE     WS-K730-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K703-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K703 STATUS IS ' WS-K703-STATUS            
              MOVE     WS-K703-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K830-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K830 STATUS IS ' WS-K830-STATUS            
              MOVE     WS-K830-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K022-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K022 STATUS IS ' WS-K022-STATUS            
              MOVE     WS-K022-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K024-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K024 STATUS IS ' WS-K024-STATUS            
              MOVE     WS-K024-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           IF WS-K060-STATUS NOT = 00 AND 97                                    
              DISPLAY 'OPENING ERROR K060 STATUS IS ' WS-K060-STATUS            
              MOVE     WS-K060-STATUS TO RETURN-CODE                            
              PERFORM 9000-CLOSE-ROUTINE.                                       
                                                                                
           MOVE FUNCTION CURRENT-DATE(1:8) TO WS-DATE                           
                                              WS-SYSTEM-DATE                    
                                              WS-DTE-POST                       
                                              WS-CURR-DATE.                     
                                                                                
      *---------------------------------------------------------------*         
      * POSTED DATE IS CURRENT DATE + 3 WORKING DAYS                  *         
      *---------------------------------------------------------------*         
           MOVE  ZEROES               TO WS-DAY-CNT.                            
           MOVE  'N'                  TO PUBLIC-HOLIDAY                         
                                         SUNDAY.                                
                                                                                
           COMPUTE WS-NUM-OF-DATE  =                                            
                     FUNCTION INTEGER-OF-DATE(WS-CURR-DATE).                    
                                                                                
           STRING WS-DTE-POST(7:2)  '/'                                         
                  WS-DTE-POST(5:2)  '/'                                         
                  WS-DTE-POST(1:4)                                              
                  DELIMITED BY SIZE INTO P080-DATE.                             
                                                                                
           MOVE   WS-SYS-DD           TO WS-EDITED-DD.                          
           MOVE   WS-SYS-MM           TO WS-EDITED-MM.                          
           MOVE   WS-SYS-CCYY         TO WS-EDITED-YY.                          
           MOVE   WS-EDITED-DATE      TO L080-DATE.                             
                                                                                
       1000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       2500-READ-BP13K703.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES             TO BP13K703-REC.                             
           INITIALIZE                 BP13K703-REC.                             
           MOVE F730-NUM-ALLO-CAT  TO K703-NUM-SOCLIST.                         
           MOVE F730-NUM-ALLO-CAT  TO K703-NUM-NT.                              
           MOVE '00'               TO K703-NUM-FLAT.                            
           MOVE 'Y'                TO WS-K703-FOUND.                            
           READ BP13K703.                                                       
                                                                                
           EVALUATE WS-K703-STATUS                                              
              WHEN 00                                                           
                   MOVE K703-DTE-BALLOT-ORIGIN TO WS-DTE-BALLOT                 
                   CONTINUE                                                     
              WHEN 23                                                           
                   MOVE 'N'  TO WS-K703-FOUND                                   
              WHEN OTHER                                                        
                   MOVE WS-K703-STATUS TO RETURN-CODE                           
                   DISPLAY 'BP13K703 READ ERROR,STATUS=' WS-K703-STATUS         
                   PERFORM 9000-CLOSE-ROUTINE                                   
           END-EVALUATE.                                                        
                                                                                
           SET WS-MTH-IND TO 1.                                                 
                                                                                
           SEARCH WS-MONTH-TABLE                                                
               AT END                                                           
                  MOVE SPACES   TO L080-MTH-BE                                  
               WHEN WS-MONTH-IN-DIGITS (WS-MTH-IND) = WS-DTE-BALLOT(5:2)        
                  MOVE WS-MONTH-IN-WORDS (WS-MTH-IND) TO L080-MTH-BE            
           END-SEARCH.                                                          
                                                                                
           MOVE WS-DTE-BALLOT(1:4)         TO L080-YEAR-BE.                     
                                                                                
       2500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3000-PROCESS-RECORDS.                                                    
      *-------------------------------------------------------------            
                                                                                
           PERFORM 4500-MOVE-DETAILS        THRU 4500-EXIT.                     
           IF F730-CDE-BTO-REOPT = 'Y'                                          
              PERFORM 6000-PRT-LETTER-BP13AD     THRU 6000-EXIT                 
           ELSE                                                                 
              IF F730-CDE-BTO-REOPT = 'N'                                       
                 PERFORM 6100-PRT-LETTER-BP13AE  THRU 6100-EXIT                 
              END-IF                                                            
           END-IF                                                               
           PERFORM 6500-PRT-CONTROL-LIST    THRU 6500-EXIT.                     
                                                                                
           PERFORM 3500-READ-BP13F730       THRU 3500-EXIT.                     
                                                                                
       3000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       3500-READ-BP13F730.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13F730                                                        
                AT END MOVE 'Y' TO WS-F730-EOF                                  
                       GO TO 3500-EXIT.                                         
                                                                                
           ADD  1  TO  WS-F730-READ-CTR.                                        
                                                                                
       3500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4500-MOVE-DETAILS.                                                       
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES                    TO L080-ROOM-BE                       
                                             L080-ROOM-BTO.                     
                                                                                
           IF F730-CDE-FLAT-TYPE(1:1) = '1'                                     
              MOVE 'Studio Apartment'     TO L080-ROOM-BE                       
           ELSE                                                                 
              STRING F730-CDE-FLAT-TYPE(1:1) '-room flat'                       
                     DELIMITED BY SIZE INTO L080-ROOM-BE                        
              STRING F730-CDE-FLAT-TYPE(1:1) '-room'                            
                     DELIMITED BY SIZE INTO L080-ROOM-BTO                       
           END-IF.                                                              
                                                                                
           STRING F730-NUM-REGN          '/'                                    
                  F730-CDE-NT1           '/'                                    
                  F730-CDE-FLAT-TYPE                                            
                  DELIMITED BY SIZE INTO L080-REFNO.                            
                                                                                
           IF F730-CDE-NT1 = '20'                                               
              MOVE 'Coral Green (Sengkang)' TO  L080-ESTATE                     
           END-IF.                                                              
                                                                                
           IF F730-CDE-NT1 = '21' OR = '22'                                     
              MOVE 'The Anthias (Punggol)'  TO  L080-ESTATE                     
           END-IF.                                                              
                                                                                
           IF F730-CDE-NT1 = '23'                                               
              MOVE '   Tivela (Sengkang)'   TO  L080-ESTATE                     
           END-IF.                                                              
                                                                                
           MOVE SPACES                    TO K825-KEY-FLD.                      
           MOVE F730-NUM-REF              TO K825-NUM-REF.                      
                                                                                
           MOVE F730-NUM-NRIC1            TO K825-NUM-NRIC.                     
                                                                                
           PERFORM  4600-READ-K825        THRU 4600-EXIT.                       
           MOVE     WS-K825-NME-OCCP      TO   L080-NAME.                       
                                                                                
           IF F730-NUM-NRIC2 (2:1) = '#' OR SPACES OR LOW-VALUES                
              MOVE SPACES                 TO   L080-NAME2                       
           ELSE                                                                 
              MOVE SPACES                 TO   K825-KEY-FLD                     
              MOVE F730-NUM-REF           TO   K825-NUM-REF                     
              MOVE F730-NUM-NRIC2         TO   K825-NUM-NRIC                    
              PERFORM  4600-READ-K825     THRU 4600-EXIT                        
              MOVE     WS-K825-NME-OCCP      TO   L080-NAME2                    
           END-IF.                                                              
                                                                                
           IF F730-NUM-ALLO-CAT = 'BE'                                          
              PERFORM  4700-READ-K060     THRU 4700-EXIT                        
           END-IF.                                                              
                                                                                
           PERFORM  4800-GET-ADDR         THRU 4800-EXIT.                       
           PERFORM  7000-READ-BP13K022    THRU 7000-EXIT.                       
                                                                                
       4500-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4600-READ-K825.                                                          
      *-------------------------------------------------------------            
           MOVE    SPACES                TO  WS-K825-NME-OCCP                   
           READ BP13K825.                                                       
                                                                                
           IF WS-K825-STATUS = 00 OR 02                                         
              MOVE    K825-NME-OCCP      TO  WS-K825-NME-OCCP                   
           ELSE                                                                 
           IF WS-K825-STATUS = 23                                               
              DISPLAY 'K825 REC NOT FOUND : '   K825-KEY-FLD                    
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K825 = '   WS-K825-STATUS              
              DISPLAY '      K825-KEY-FLD     = '   K825-KEY-FLD                
              PERFORM 9000-CLOSE-ROUTINE   THRU 9000-EXIT.                      
       4600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4700-READ-K060.                                                          
      *-------------------------------------------------------------            
            MOVE SPACES                 TO BP13K060-REC.                        
                                                                                
            IF F730-NUM-ALLO-CAT = 'BTO'                                        
               MOVE '91'                TO K060-SERIAL-NO                       
            ELSE                                                                
               MOVE '02'                TO K060-SERIAL-NO                       
            END-IF                                                              
                                                                                
            MOVE F730-CDE-NT1           TO K060-CODE.                           
                                                                                
            READ BP13K060.                                                      
            EVALUATE WS-K060-STATUS                                             
               WHEN '00'                                                        
                  MOVE K060-DESC        TO L080-EST                             
               WHEN '23'                                                        
                  MOVE F730-CDE-NT1     TO L080-EST                             
                  DISPLAY 'RECORD NOT FOUND IN BP13K060, KEY IS '               
                  '02' F730-CDE-NT1                                             
               WHEN OTHER                                                       
                  DISPLAY 'ERROR IN READING BP13K060, STATUS - '                
                  WS-K060-STATUS                                                
            END-EVALUATE.                                                       
                                                                                
       4700-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4800-GET-ADDR.                                                           
      *-------------------------------------------------------------            
                                                                                
           MOVE SPACES TO L080-LINE-06 L080-LINE-07 L080-LINE-08.               
           MOVE SPACES TO L080-LINE-05.                                         
           MOVE SPACES            TO    K830-KEY-FLD.                           
                                                                                
           MOVE F730-NUM-REF      TO    K830-KEY-FLD.                           
           READ BP13K830.                                                       
                                                                                
           IF WS-K830-STATUS = 00                                               
              IF (K830-NUM-MAIL-ADDR =  SPACES OR LOW-VALUES) OR                
                 ((K830-NUM-MAIL-LVL-CHAR =  '#') AND                           
                 (K830-NUM-MAIL-LVL-NUM =  SPACES OR LOW-VALUES))               
                 MOVE K830-NUM-BLK         TO L080-BLK                          
                 IF K830-NUM-LVL-NUM = SPACES AND                               
                    K830-NUM-HSEMAIN = SPACES                                   
                    MOVE SPACES            TO L080-UNIT                         
                 ELSE                                                           
                    MOVE K830-NUM-FLAT     TO L080-UNIT                         
                 END-IF                                                         
                 MOVE K830-NME-STREET-BLDG(1:47) TO L080-ADDR-L2                
                 IF K830-NUM-POSTAL  = SPACES OR LOW-VALUES OR ZEROES           
                    MOVE SPACES            TO L080-ADDR-L3                      
                 ELSE                                                           
                    STRING 'SINGAPORE '  K830-NUM-POSTAL                        
                       DELIMITED BY SIZE INTO L080-ADDR-L3                      
                 END-IF                                                         
      *------ TO GET THE BAR CODE ------                                        
                                                                                
                 MOVE SPACES                   TO WS-LINK-AV02C015              
                 MOVE K830-NUM-POSTAL          TO AV02C015-IN-POSTCODE          
                 PERFORM 4950-CALL-AV02C015    THRU 4950-EXIT                   
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO L080-BAR-CODE             
              ELSE                                                              
                 MOVE K830-NUM-MAIL-BLK        TO L080-BLK                      
                 IF K830-NUM-MAIL-LVL-NUM = SPACES AND                          
                    K830-NUM-MAIL-HSEMAIN = SPACES                              
                    MOVE SPACES                TO L080-UNIT                     
                 ELSE                                                           
                    MOVE K830-NUM-MAIL-FLAT    TO L080-UNIT                     
                 END-IF                                                         
                 MOVE K830-NME-MAIL-STR-BLDG(1:47) TO L080-ADDR-L2              
                 IF K830-NUM-MAIL-POSTAL = SPACES OR LOW-VALUES OR ZEROS        
                    MOVE SPACES                TO L080-ADDR-L3                  
                 ELSE                                                           
                    STRING 'SINGAPORE '      K830-NUM-MAIL-POSTAL               
                           DELIMITED BY SIZE INTO L080-ADDR-L3                  
                 END-IF                                                         
      *------ TO GET THE BAR CODE ------                                        
                                                                                
                 MOVE SPACES                   TO WS-LINK-AV02C015              
                 MOVE K830-NUM-MAIL-POSTAL     TO AV02C015-IN-POSTCODE          
                 PERFORM 4950-CALL-AV02C015    THRU 4950-EXIT                   
                 MOVE AV02C015-OUT-POSTCODE-CHKSUM TO L080-BAR-CODE             
              END-IF                                                            
           ELSE                                                                 
           IF WS-K830-STATUS = 23                                               
              MOVE SPACES TO L080-LINE-06 L080-LINE-07 L080-LINE-08             
              MOVE SPACES TO L080-LINE-05                                       
              DISPLAY 'BP13K830 RECORD NOT FOUND = ' WS-K830-STATUS             
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K830 = ' WS-K830-STATUS                
                      ',  K830-KEY-FLD IS ' K830-KEY-FLD                        
              PERFORM 9000-CLOSE-ROUTINE THRU 9000-EXIT.                        
                                                                                
       4800-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       4950-CALL-AV02C015.                                                      
      *-------------------------------------------------------------            
           CALL 'AV02C015'          USING                                       
                                    AV02C015-IN-POSTCODE                        
                                    AV02C015-OUT-POSTCODE-CHKSUM.               
       4950-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       6000-PRT-LETTER-BP13AD.                                                  
      *-------------------------------------------------------------            
            MOVE  SPACES         TO    L080B-PRT-REC.                           
            WRITE L080B-PRT-REC   AFTER PAGE.                                   
                                                                                
            WRITE L080B-PRT-REC   FROM  L080-LINE-01  AFTER 1.                  
            WRITE L080B-PRT-REC   FROM  L080-LINE-02.                           
            WRITE L080B-PRT-REC   FROM  L080-LINE-03  AFTER 5.                  
            WRITE L080B-PRT-REC   FROM  L080-LINE-04.                           
            WRITE L080B-PRT-REC   FROM  L080-LINE-05.                           
            WRITE L080B-PRT-REC   FROM  L080-LINE-06.                           
            WRITE L080B-PRT-REC   FROM  L080-LINE-07.                           
            WRITE L080B-PRT-REC   FROM  L080-LINE-08  AFTER 2.                  
            WRITE L080B-PRT-REC   FROM  L080-LINE-12  AFTER 16.                 
            WRITE L080B-PRT-REC   FROM  L080-LINE-13  AFTER 1.                  
            WRITE L080B-PRT-REC   FROM  L080-LINE-14  AFTER 13.                 
                                                                                
            PERFORM 7200-READ-BP13K730    THRU 7200-EXIT.                       
                                                                                
       6000-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       6100-PRT-LETTER-BP13AE.                                                  
      *-------------------------------------------------------------            
            MOVE  SPACES         TO    L080C-PRT-REC.                           
            WRITE L080C-PRT-REC  AFTER PAGE.                                    
                                                                                
            WRITE L080C-PRT-REC  FROM  L080-LINE-01  AFTER 1.                   
            WRITE L080C-PRT-REC  FROM  L080-LINE-02.                            
            WRITE L080C-PRT-REC  FROM  L080-LINE-03  AFTER 5.                   
            WRITE L080C-PRT-REC  FROM  L080-LINE-04.                            
            WRITE L080C-PRT-REC  FROM  L080-LINE-05.                            
            WRITE L080C-PRT-REC  FROM  L080-LINE-06.                            
            WRITE L080C-PRT-REC  FROM  L080-LINE-07.                            
            WRITE L080C-PRT-REC  FROM  L080-LINE-08  AFTER 2.                   
            WRITE L080C-PRT-REC  FROM  L080-LINE-12  AFTER 16.                  
            WRITE L080C-PRT-REC  FROM  L080-LINE-13  AFTER 1.                   
            WRITE L080C-PRT-REC  FROM  L080-LINE-14  AFTER 13.                  
            ADD   1              TO    WS-L080-WRT-CTR.                         
                                                                                
            PERFORM 7200-READ-BP13K730    THRU 7200-EXIT.                       
                                                                                
       6100-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       6500-PRT-CONTROL-LIST.                                                   
      *-------------------------------------------------------------            
      *    PRINT CONTROL LISTING FOR SUCCESSFUL APPLICANTS                      
      *-------------------------------------------------------------            
           IF WS-CNT-LINE-L080 > WS2-MAX-LINES-L080                             
              PERFORM 6600-PRT-CONTROL-HEADING THRU  6600-EXIT.                 
                                                                                
           ADD    1                     TO    WS-CNT-LETTERS.                   
           MOVE   WS-CNT-LETTERS        TO    L080C-SERIAL-NO.                  
           MOVE   F730-NUM-REF          TO    L080C-REF-NO.                     
           MOVE   F730-NUM-REGN         TO    L080C-REGN-NO.                    
           MOVE   L080-NAME             TO    L080C-NAME-1.                     
           MOVE   F730-NUM-NRIC1        TO    L080C-NRIC-1.                     
           MOVE   F730-CDE-NT1          TO    L080C-NT1.                        
           MOVE   F730-CDE-HOUSEHOLD    TO    L080C-HHTY.                       
           MOVE   F730-CDE-ELIG-SCH     TO    L080C-ELIG-SCH.                   
           MOVE   F730-CDE-FLAT-TYPE    TO    L080C-FLAT.                       
           MOVE   F730-CDE-ALLOC-SCH    TO    L080C-ALLOC.                      
           MOVE   F730-NUM-PORT-ELIG-TAG TO   L080C-PORT-TAG.                   
           MOVE   F730-NUM-JB-REGN      TO    L080C-JB-REGN.                    
           MOVE   F730-NUM-JB-CNT       TO    L080C-JB-CNT.                     
           MOVE   F730-NUM-JB-NRIC      TO    L080C-JB-NRIC.                    
           MOVE   F730-CDE-CATEGORY     TO    L080C-CAT.                        
           MOVE   F730-CDE-SUCC-NT-ZONE TO    L080C-SUCC.                       
           MOVE   F730-CDE-ZONE         TO    L080C-ZONE.                       
           WRITE  L080A-PRT-REC         FROM  L080C-DTL-1 AFTER 2.              
           MOVE   SPACES                TO    L080A-PRT-REC.                    
           MOVE   L080-NAME2            TO    L080C-NAME-2.                     
           IF F730-NUM-NRIC2 (2:1) NOT = '#'                                    
              MOVE F730-NUM-NRIC2       TO    L080C-NRIC-2                      
           ELSE                                                                 
              MOVE SPACES               TO    L080C-NRIC-2.                     
           MOVE    F730-CDE-NT5         TO    L080C-NT5.                        
           MOVE    SPACES               TO    L080C-NT6.                        
           MOVE    SPACES               TO    L080C-NT7.                        
           MOVE    SPACES               TO    L080C-NT8.                        
           MOVE    F730-NUM-APPLN-SERIAL TO   L080C-SERIAL.                     
           WRITE   L080A-PRT-REC        FROM  L080C-DTL-2 AFTER 1.              
                                                                                
           MOVE SPACES                  TO    L080C-DTL-3.                      
           MOVE L080-BLK                TO    L080C-BLK.                        
           MOVE L080-UNIT               TO    L080C-UNIT.                       
           MOVE L080-ADDR-L2            TO    L080C-ADDR2.                      
           MOVE L080-ADDR-L3            TO    L080C-ADDR3.                      
           WRITE   L080A-PRT-REC        FROM  L080C-DTL-3 AFTER 1.              
                                                                                
           ADD     4                    TO    WS-CNT-LINE-L080.                 
                                                                                
       6500-EXIT.                                                               
           EXIT.                                                                
                                                                                
       6600-PRT-CONTROL-HEADING.                                                
      *-------------------------------------------------------------            
           ADD   1                  TO   WS-CNT-PAGE-L080.                      
           MOVE  WS-CNT-PAGE-L080   TO   L080-PAGE.                             
           WRITE L080A-PRT-REC      FROM L080-HDG1 AFTER PAGE.                  
           WRITE L080A-PRT-REC      FROM L080-HDG2.                             
           WRITE L080A-PRT-REC      FROM L080-HDG3 AFTER 2.                     
           WRITE L080A-PRT-REC      FROM L080-HDG4 AFTER 1.                     
           MOVE  SPACES             TO   L080A-PRT-REC.                         
           MOVE  5                  TO   WS-CNT-LINE-L080.                      
                                                                                
       6600-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7000-READ-BP13K022.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES        TO K022-NUM-REGN                                  
                                 L080-NME-OIC                                   
                                 L080-NUM-DID                                   
                                 L080-NUM-HP.                                   
                                                                                
           MOVE F730-NUM-REGN TO K022-NUM-REGN.                                 
           READ BP13K022 KEY IS K022-NUM-REGN.                                  
                                                                                
           IF WS-K022-STATUS = 00                                               
              MOVE K022-NUM-OIC           TO   K024-NUM-OIC                     
              PERFORM 7100-READ-BP13K024  THRU 7100-EXIT                        
           ELSE                                                                 
           IF WS-K022-STATUS = 23                                               
              DISPLAY 'K022 NOT FND, KEY IS ' K022-NUM-REGN                     
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K022 = '  WS-K022-STATUS.              
                                                                                
       7000-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       7100-READ-BP13K024.                                                      
      *-------------------------------------------------------------            
                                                                                
           READ BP13K024 KEY IS K024-KEY-FLD.                                   
                                                                                
           IF WS-K024-STATUS = 00                                               
              MOVE K024-NME-OIC          TO L080-NME-OIC                        
              MOVE K024-NUM-DID          TO L080-NUM-DID                        
              MOVE K024-NUM-HP           TO L080-NUM-HP                         
           ELSE                                                                 
           IF WS-K024-STATUS = 23                                               
              MOVE SPACES                TO L080-NME-OIC                        
                                            L080-NUM-DID                        
                                            L080-NUM-HP                         
              DISPLAY 'K024 NOT FND, KEY IS ' K024-KEY-FLD                      
           ELSE                                                                 
              DISPLAY 'ERROR READING BP13K024 = '  WS-K024-STATUS.              
                                                                                
       7100-EXIT.                                                               
           EXIT.                                                                
                                                                                
                                                                                
      *-------------------------------------------------------------            
       7200-READ-BP13K730.                                                      
      *-------------------------------------------------------------            
           MOVE SPACES             TO BP13K730-REC.                             
           INITIALIZE                 BP13K730-REC.                             
           MOVE SPACES             TO K730-KEY-NEW.                             
           MOVE F730-NUM-REF       TO K730-KEY-NEW.                             
           MOVE 'Y'                TO WS-K730-FOUND.                            
           READ BP13K730.                                                       
                                                                                
           EVALUATE WS-K730-STATUS                                              
              WHEN 00                                                           
                   MOVE 'P'           TO K730-CDE-PRINT-STATUS                  
                   PERFORM 7300-REWRITE-BP13K730  THRU 7300-EXIT                
              WHEN 23                                                           
                   MOVE 'N'  TO WS-K730-FOUND                                   
              WHEN OTHER                                                        
                   MOVE WS-K730-STATUS TO RETURN-CODE                           
                   DISPLAY 'BP13K730 READ ERROR,STATUS=' WS-K730-STATUS         
                   PERFORM 9000-CLOSE-ROUTINE                                   
           END-EVALUATE.                                                        
                                                                                
       7200-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       7300-REWRITE-BP13K730.                                                   
      *-------------------------------------------------------------            
                                                                                
           REWRITE BP13K730-REC.                                                
                                                                                
           EVALUATE WS-K730-STATUS                                              
               WHEN ZEROES                                                      
                    ADD 1         TO WS-K730-UPDATE-CTR                         
               WHEN 23                                                          
                    DISPLAY 'RECORD NOT FOUND IN BP13K730. KEY IS '             
                             K730-KEY-NEW                                       
              WHEN OTHER                                                        
                   MOVE WS-K730-STATUS TO RETURN-CODE                           
                   DISPLAY 'BP13K730 WRITE ERROR STATUS' WS-K730-STATUS         
                   PERFORM 9000-CLOSE-ROUTINE                                   
           END-EVALUATE.                                                        
                                                                                
       7300-EXIT.                                                               
           EXIT.                                                                
                                                                                
      *-------------------------------------------------------------            
       9000-CLOSE-ROUTINE.                                                      
      *-------------------------------------------------------------            
            DISPLAY ' '.                                                        
            DISPLAY ' - BP13C100 CONTROL TOTALS ------------'                   
            DISPLAY ' '.                                                        
            DISPLAY ' F730 RECORDS READ          : ' WS-F730-READ-CTR.          
            DISPLAY ' K730 RECORDS UPDATED       : ' WS-K730-UPDATE-CTR.        
            DISPLAY ' NO OF LETTERS PRINTED      : ' WS-L080-WRT-CTR.           
            DISPLAY ' TOTAL NUMBER OF CASES      : ' WS-CNT-LETTERS.            
            DISPLAY ' --------------------------------------'                   
                                                                                
            CLOSE BP13F730                                                      
                  BP13K703                                                      
                  BP13K825                                                      
                  BP13K830                                                      
                  BP13K022                                                      
                  BP13K024                                                      
                  BP13K060                                                      
                  P13L080C                                                      
                  P13L080B                                                      
                  P13L080A.                                                     
                                                                                
            IF WS-K825-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K825-STAT ' WS-K825-STATUS.           
                                                                                
            IF WS-K703-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K703-STAT ' WS-K703-STATUS.           
                                                                                
            IF WS-K830-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K830-STAT ' WS-K830-STATUS.           
                                                                                
            IF WS-K022-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K022-STAT ' WS-K022-STATUS.           
                                                                                
            IF WS-K024-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K024-STAT ' WS-K024-STATUS.           
                                                                                
            IF WS-K060-STATUS NOT = 00                                          
               DISPLAY 'CLOSING ERROR-BP13K060-STAT ' WS-K060-STATUS.           
                                                                                
            STOP RUN.                                                           
                                                                                
       9000-EXIT.                                                               
            EXIT.                                                               
